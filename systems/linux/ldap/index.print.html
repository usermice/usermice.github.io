<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <meta name="author" content="二哥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://usermice.github.io/images/s2-1.png">
    <meta name="twitter:title" content="LDAP :: Hugo Relearn Theme">
    <meta property="og:url" content="https://usermice.github.io/systems/linux/ldap/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="LDAP :: Hugo Relearn Theme">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://usermice.github.io/images/s2-1.png">
    <meta itemprop="name" content="LDAP :: Hugo Relearn Theme">
    <meta itemprop="datePublished" content="2024-06-13T00:31:41+08:00">
    <meta itemprop="dateModified" content="2024-06-13T00:31:41+08:00">
    <meta itemprop="image" content="https://usermice.github.io/images/s2-1.png">
    <title>LDAP :: Hugo Relearn Theme</title>
    <link href="../../../images/favicon.ico?1725531899" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../css/fontawesome-all.min.css?1725531900" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fontawesome-all.min.css?1725531900" rel="stylesheet"></noscript>
    <link href="../../../css/nucleus.css?1725531900" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1725531900" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/auto-complete.css?1725531900" rel="stylesheet"></noscript>
    <link href="../../../css/perfect-scrollbar.min.css?1725531900" rel="stylesheet">
    <link href="../../../css/fonts.css?1725531900" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fonts.css?1725531900" rel="stylesheet"></noscript>
    <link href="../../../css/theme.css?1725531900" rel="stylesheet">
    <link href="../../../css/theme-relearn-auto.css?1725531900" rel="stylesheet" id="R-variant-style">
    <link href="../../../css/chroma-relearn-auto.css?1725531900" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../css/variant.css?1725531900" rel="stylesheet">
    <link href="../../../css/print.css?1725531900" rel="stylesheet" media="print">
    <link href="../../../css/format-print.css?1725531900" rel="stylesheet">
    <script src="../../../js/variant.js?1725531900"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/usermice.github.io';
      window.index_js_url="../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../systems/linux/ldap/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">LDAP</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/kubernetes/configure_k8s_auth/" title="Configure_K8s_Auth (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/ldap/config_openldap/" title="Config_OpenLDAP (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="ldap">LDAP</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of LDAP</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="config_openldap">Config_OpenLDAP</h1>


            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_kerberos">Install_Kerberos</h1>

<h2 id="kerberos"><code>Kerberos</code></h2>
<blockquote>
<ul>
<li><a href="https://www.thegeekdiary.com/how-to-install-and-configure-kerberos-in-centos-rhel-7/" rel="external" target="_self">如何在<code>CentOS/RHEL 7</code>中安装和配置<code>Kerberos</code></a></li>
</ul>
</blockquote>
<hr>
<h3 id="安装kerberos">安装<code>Kerberos</code></h3>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_openldap">Install_OpenLDAP</h1>

<h2 id="openldap"><code>OpenLDAP</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://hebye.com/docs/ldap/ldap-1d97mtl9ifh1c" rel="external" target="_self"><code>OpenLDAP</code>的安装与配置</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/ibv/LDAP-Admin" rel="external" target="_self"><code>LDAP Admin for Linux</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://directory.apache.org/studio/" rel="external" target="_self"><code>Apache Directory Studio</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/uroesch/LdapAdminPortable/tags" rel="external" target="_self"><code>LDAP Admin for PortableApps.com</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.ldap-account-manager.org/lamcms/" rel="external" target="_self"><code>LDAP Account Manager</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/woshimrf/p/ldap.html" rel="external" target="_self"><code>openldap</code>介绍和使用</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://zhuanlan.zhihu.com/p/32732045" rel="external" target="_self"><code>LDAP</code>基础学习笔记</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.jianshu.com/p/243ff61b0552" rel="external" target="_self"><code>OpenLDAP</code>安装使用及与各系统的集成</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.ibm.com/docs/zh/samfess/8.2.2?topic=reports-creating-users-in-ldap" rel="external" target="_self">在<code>LDAP</code>中创建用户</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="openldap安装"><code>OpenLDAP</code>安装</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->安装<!-- raw HTML omitted --><code>Openldap</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install openldap-servers openldap-clients -y</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->修改配置文件<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->把<!-- raw HTML omitted --><code>/etc/openldap/</code><!-- raw HTML omitted -->目录下<!-- raw HTML omitted --><code>slapd.d</code><!-- raw HTML omitted -->默认文件夹备份<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /etc/openldap/
</span></span><span style="display:flex;"><span>$ cp -r slapd.d<span style="color:#f92672">{</span>,.bak<span style="color:#f92672">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->生成加密密钥<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ slappasswd
</span></span><span style="display:flex;"><span>New password: 
</span></span><span style="display:flex;"><span>Re-enter new password: 
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>SSHA<span style="color:#f92672">}</span>2OhbHFHD0Lx1JUS7IsQZnHlS65tKlAvf</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->拷贝、修改配置文件<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp /usr/share/openldap-servers/slapd.ldif /etc/openldap/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 修改配置文件，把中文注释行都删除</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/openldap/slapd.ldif<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcGlobal
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cn: config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcArgsFile: /var/run/openldap/slapd.args
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcPidFile: /var/run/openldap/slapd.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcTLSCACertificatePath: /etc/openldap/certs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcTLSCertificateFile: &#34;OpenLDAP Server&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcTLSCertificateKeyFile: /etc/openldap/certs/password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: cn=schema,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcSchemaConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cn: schema
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 添加/etc/openldap/schema/ 目录下属性类
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/core.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/collective.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/corba.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/cosine.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/duaconf.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/dyngroup.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/inetorgperson.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/java.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/misc.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/nis.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/openldap.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/pmi.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/ppolicy.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase=frontend,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcDatabaseConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcFrontendConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDatabase: frontend
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase=config,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcDatabaseConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDatabase: config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcAccess: to * by dn.base=&#34;gidNumber=0+uidNumber=0,cn=peercred,cn=external,c
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> n=auth&#34; manage by * none
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase=monitor,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcDatabaseConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDatabase: monitor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># dc=my-domain 修改为定义域名
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcAccess: to * by dn.base=&#34;gidNumber=0+uidNumber=0,cn=peercred,cn=external,c
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> n=auth&#34; read by dn.base=&#34;cn=Manager,dc=ladp.erge,dc=com&#34; read by * none
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase=hdb,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcDatabaseConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcHdbConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDatabase: hdb
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># my-domain 修改为定义域名
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcSuffix: dc=ladp.erge,dc=com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcRootDN: cn=Manager,dc=ladp.erge,dc=com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># olcRootPW 为新增字段
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcRootPW: {SSHA}2OhbHFHD0Lx1JUS7IsQZnHlS65tKlAvf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDbDirectory:	/var/lib/ldap
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDbIndex: objectClass eq,pres
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDbIndex: ou,cn,mail,surname,givenname eq,pres,sub
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->生成主配置文件<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>-n 0</code><!-- raw HTML omitted -->指定<code>0</code>号数据库<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>-F slapd.d</code><!-- raw HTML omitted -->指定生成的目录<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>-l slapd.ldif</code><!-- raw HTML omitted -->指定使用那个文件生成<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ slapadd -n <span style="color:#ae81ff">0</span> -F slapd.d -l slapd.ldif  	<span style="color:#75715e"># 返回以下：100.00% 代表成功，如果报错是：slapd.ldif 配置文件问题</span>
</span></span><span style="display:flex;"><span>_#################### 100.00% eta   none elapsed            none fast!
</span></span><span style="display:flex;"><span>Closing DB...</span></span></code></pre></div></li>
<li>
<p><!-- raw HTML omitted -->修改权限<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chown -R ldap:ldap /etc/openldap/slapd.d
</span></span><span style="display:flex;"><span>$ chown -R ldap:ldap /var/lib/ldap/ </span></span></code></pre></div></li>
<li>
<p><!-- raw HTML omitted -->拷贝数据库默认配置文件<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span></span></code></pre></div></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->启动并设置为开机自启<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start slapd <span style="color:#f92672">&amp;&amp;</span> systemctl enable slapd</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->配置基本域<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/openldap/config_init.ldif<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># dn 条目
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: dc=ladp.erge,dc=com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 对象类
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectclass: dcObject
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectclass: organization
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 组织名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">o: aishangwei
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># dc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dc: ladp.erge
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->添加基本域<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>系统会提示您输入<code>LDAP</code>密码。 输入您为<code>LDAP root</code>用户定义的纯文本密码</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ldapadd -x -D <span style="color:#e6db74">&#34;cn=Manager,dc=ldap.erge,dc=com&#34;</span> -W -f /etc/openldap/config_init.ldif</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->查询域<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ldapsearch -x -b <span style="color:#e6db74">&#39;dc=ldap.erge,dc=com&#39;</span>   <span style="color:#e6db74">&#39;(objectClass=*)&#39;</span>
</span></span><span style="display:flex;"><span>$ ldapsearch -H ldapi:/// -Y EXTERNAL -b <span style="color:#e6db74">&#34;cn=config&#34;</span> -LLL –Q
</span></span><span style="display:flex;"><span>$ ldapsearch -h 192.168.88.110 -b <span style="color:#e6db74">&#34;dc=ladp.erge,dc=com&#34;</span> -D <span style="color:#e6db74">&#34;cn=Manager,dc=erge,dc=com&#34;</span> -W |grep dn</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->取消匿名登录<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>openldap</code>在匿名情况下是可以被访问的。而且<code>openldap</code>的相关信息，除了用户的密码信息之外，其他<code>openldap</code>的信息完全被呈现出来。</p>
</li>
<li>
<p>从安全的角度考虑，这种情况是不被允许的，所以要取消<code>openldap</code>的匿名访问功能。</p>
</li>
<li>
<p>要取消<code>openldap</code>的匿名访问功能，操作方法也比较简单。我们只需要把以下<code>openldap</code>信息导入<code>openldap</code>中即可，而且是无需重启<code>openldap</code>服务即时生效的。</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/openldap/disable_anon.ldif<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">changetype: modify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">add: olcDisallows
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDisallows: bind_anon
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">changetype: modify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">add: olcRequires
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcRequires: authc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase={-1}frontend,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">changetype: modify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">add: olcRequires
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcRequires: authc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/disable_anon.ldif
</span></span><span style="display:flex;"><span>SASL/EXTERNAL authentication started
</span></span><span style="display:flex;"><span>SASL username: gidNumber<span style="color:#f92672">=</span>0+uidNumber<span style="color:#f92672">=</span>0,cn<span style="color:#f92672">=</span>peercred,cn<span style="color:#f92672">=</span>external,cn<span style="color:#f92672">=</span>auth
</span></span><span style="display:flex;"><span>SASL SSF: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>modifying entry <span style="color:#e6db74">&#34;cn=config&#34;</span>
</span></span><span style="display:flex;"><span>modifying entry <span style="color:#e6db74">&#34;cn=config&#34;</span>
</span></span><span style="display:flex;"><span>modifying entry <span style="color:#e6db74">&#34;olcDatabase={-1}frontend,cn=config&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看配置文件</span>
</span></span><span style="display:flex;"><span>$ cat /etc/openldap/slapd.d/cn<span style="color:#ae81ff">\=</span>config.ldif
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AUTO-GENERATED FILE - DO NOT EDIT!! Use ldapmodify.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CRC32 af9dbdcd</span>
</span></span><span style="display:flex;"><span>dn: cn<span style="color:#f92672">=</span>config
</span></span><span style="display:flex;"><span>objectClass: olcGlobal
</span></span><span style="display:flex;"><span>cn: config
</span></span><span style="display:flex;"><span>olcArgsFile: /var/run/openldap/slapd.args
</span></span><span style="display:flex;"><span>olcPidFile: /var/run/openldap/slapd.pid
</span></span><span style="display:flex;"><span>olcTLSCACertificatePath: /etc/openldap/certs
</span></span><span style="display:flex;"><span>olcTLSCertificateFile: <span style="color:#e6db74">&#34;OpenLDAP Server&#34;</span>
</span></span><span style="display:flex;"><span>olcTLSCertificateKeyFile: /etc/openldap/certs/password
</span></span><span style="display:flex;"><span>structuralObjectClass: olcGlobal
</span></span><span style="display:flex;"><span>entryUUID: 7b515fd2-ab06-103b-8cdb-d13498ff4586
</span></span><span style="display:flex;"><span>creatorsName: cn<span style="color:#f92672">=</span>config
</span></span><span style="display:flex;"><span>createTimestamp: 20210916065302Z
</span></span><span style="display:flex;"><span>olcDisallows: bind_anon
</span></span><span style="display:flex;"><span>olcRequires: authc   //取消匿名用户登录
</span></span><span style="display:flex;"><span>entryCSN: 20210916072755.667534Z#000000#000#000000
</span></span><span style="display:flex;"><span>modifiersName: gidNumber<span style="color:#f92672">=</span>0+uidNumber<span style="color:#f92672">=</span>0,cn<span style="color:#f92672">=</span>peercred,cn<span style="color:#f92672">=</span>external,cn<span style="color:#f92672">=</span>auth
</span></span><span style="display:flex;"><span>modifyTimestamp: 20210916072755Z</span></span></code></pre></div></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->开启<!-- raw HTML omitted --><code>Openldap</code><!-- raw HTML omitted -->日志<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/openldap/loglevel.ldif<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">changetype: modify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">replace: olcLogLevel
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcLogLevel: stats
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ldapmodify -Y EXTERNAL -H ldapi:/// -f /etc/openldap/loglevel.ldif
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;/etc/rsyslog.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">local4.* /var/log/slapd.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl restart rsyslog
</span></span><span style="display:flex;"><span>$ systemctl restart slapd</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->允许普通用户修改自己的密码<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/openldap/updatepass.ldif<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase={2}hdb,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">changetype: modify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">add: olcAccess
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcAccess: to attrs=userPassword
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     by self =xw
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     by anonymous auth
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     by * none
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcAccess: to *
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     by self write
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     by users read
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     by * none
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ldapmodify -Y EXTERNAL -H ldapi:/// -f /etc/openldap/updatepass.ldif</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->修改<!-- raw HTML omitted --><code>Openldap</code><!-- raw HTML omitted -->管理员密码<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 1. 查看openldap管理员密码字段放在哪个配置文件中</span>
</span></span><span style="display:flex;"><span>$ ldapsearch -H ldapi:// -LLL -Q -Y EXTERNAL -b <span style="color:#e6db74">&#34;cn=config&#34;</span> <span style="color:#e6db74">&#34;(olcRootDN=*)&#34;</span> dn olcRootDN olcRootPW
</span></span><span style="display:flex;"><span>dn: olcDatabase<span style="color:#f92672">={</span>2<span style="color:#f92672">}</span>hdb,cn<span style="color:#f92672">=</span>config
</span></span><span style="display:flex;"><span>olcRootDN: cn<span style="color:#f92672">=</span>admin,dc<span style="color:#f92672">=</span>hebye,dc<span style="color:#f92672">=</span>com
</span></span><span style="display:flex;"><span>olcRootPW: <span style="color:#f92672">{</span>SSHA<span style="color:#f92672">}</span>Z9XXRjQYHbjYXuOvXPgR/g+HRBoNmj/u
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. 设置openldap管理员最新的密码</span>
</span></span><span style="display:flex;"><span>$ slappasswd -s password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. 生成修改openldap管理员密码的ldif文件</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/root/newpasswd.ldif<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase={2}hdb,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">changetype: modify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">replace: olcRootPW
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcRootPW: {SSHA}YB8N9nZg9qKisiW/Xp6NVPeqhE66mQOB
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4. 导入文件</span>
</span></span><span style="display:flex;"><span>$ ldapmodify -H ldapi:// -Y EXTERNAL -f /root/newpasswd.ldif
</span></span><span style="display:flex;"><span>SASL/EXTERNAL authentication started
</span></span><span style="display:flex;"><span>SASL username: gidNumber<span style="color:#f92672">=</span>0+uidNumber<span style="color:#f92672">=</span>0,cn<span style="color:#f92672">=</span>peercred,cn<span style="color:#f92672">=</span>external,cn<span style="color:#f92672">=</span>auth
</span></span><span style="display:flex;"><span>SASL SSF: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>modifying entry <span style="color:#e6db74">&#34;olcDatabase={2}hdb,cn=config&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 5. 上述命令执行完毕后，openldap的管理员密码就已经被修改掉了</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="../../../js/clipboard.min.js?1725531900" defer></script>
    <script src="../../../js/perfect-scrollbar.min.js?1725531900" defer></script>
    <script src="../../../js/theme.js?1725531900" defer></script>
  </body>
</html>
