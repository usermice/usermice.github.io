<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <meta name="author" content="二哥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/s2-1.png">
    <meta name="twitter:title" content="Nosql :: Hugo Relearn Theme">
    <meta property="og:url" content="https://erge.blog/systems/linux/nosql/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Nosql :: Hugo Relearn Theme">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://erge.blog/images/s2-1.png">
    <meta itemprop="name" content="Nosql :: Hugo Relearn Theme">
    <meta itemprop="datePublished" content="2024-06-13T00:33:57+08:00">
    <meta itemprop="dateModified" content="2024-06-13T00:33:57+08:00">
    <meta itemprop="image" content="https://erge.blog/images/s2-1.png">
    <title>Nosql :: Hugo Relearn Theme</title>
    <link href="../../../images/favicon.ico?1721405970" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../css/fontawesome-all.min.css?1721405971" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fontawesome-all.min.css?1721405971" rel="stylesheet"></noscript>
    <link href="../../../css/nucleus.css?1721405971" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1721405971" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/auto-complete.css?1721405971" rel="stylesheet"></noscript>
    <link href="../../../css/perfect-scrollbar.min.css?1721405971" rel="stylesheet">
    <link href="../../../css/fonts.css?1721405971" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fonts.css?1721405971" rel="stylesheet"></noscript>
    <link href="../../../css/theme.css?1721405971" rel="stylesheet">
    <link href="../../../css/theme-relearn-auto.css?1721405971" rel="stylesheet" id="R-variant-style">
    <link href="../../../css/chroma-relearn-auto.css?1721405971" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../css/variant.css?1721405971" rel="stylesheet">
    <link href="../../../css/print.css?1721405971" rel="stylesheet" media="print">
    <link href="../../../css/format-print.css?1721405971" rel="stylesheet">
    <script src="../../../js/variant.js?1721405971"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../systems/linux/nosql/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Nosql</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/monitor/configure_open_falcon/" title="Configure_Open_Falcon (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/nosql/install_scylladb/" title="Install_Scylladb (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="nosql">Nosql</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Nosql</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_scylladb">Install_Scylladb</h1>

<h2 id="scylladb部署"><code>Scylladb</code>部署</h2>
<h3 id="单节点部署scylladb">单节点部署<code>Scylladb</code></h3>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.scylladb.com/stable/getting-started/os-support.html" rel="external" target="_self">系统要求</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.scylladb.com/" rel="external" target="_self"><code>ScyllaDB</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.scylladb.com/download/?platform=ubuntu-22.04&version=scylla-5.1#open-source" rel="external" target="_self"><code>ScyllaDB</code>文档</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/scylladb/scylladb/" rel="external" target="_self"><code>Github-Scylla</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://docs.scylladb.com/stable/operating-scylla/admin.html#cqlsh-networking" rel="external" target="_self"><code>Scylla</code>使用端口</a></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>端口</th>
<th>协议</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>9042</td>
<td><code>TCP</code></td>
<td><code>CQL</code>、本地传输端口： <code>native_transport_port</code></td>
</tr>
<tr>
<td>9142</td>
<td><code>TCP</code></td>
<td><code>SSL</code> <code>CQL</code>使用加密方式由客户端到节点</td>
</tr>
<tr>
<td>7000</td>
<td><code>TCP</code></td>
<td><code>Inter-node communication</code> (<code>RPC</code>) 节点间通信</td>
</tr>
<tr>
<td>7001</td>
<td><code>TCP</code></td>
<td><code>SSL inter-node communication</code> (<code>RPC</code>) 使用<code>SSL</code>节点间通信</td>
</tr>
<tr>
<td>7199</td>
<td><code>TCP</code></td>
<td><code>JMX management</code>、<code>JMX</code>管理</td>
</tr>
<tr>
<td>10000</td>
<td><code>TCP</code></td>
<td><code>Scylla REST API</code></td>
</tr>
<tr>
<td>9180</td>
<td><code>TCP</code></td>
<td><code>Prometheus API</code>普罗米修斯<code>API</code></td>
</tr>
<tr>
<td>9100</td>
<td><code>TCP</code></td>
<td><code>node_exporter</code> (<code>Optionally</code>：可选)</td>
</tr>
<tr>
<td>9160</td>
<td><code>TCP</code></td>
<td><code>Scylla client port</code> (<code>Thrift</code>) <code>Scylla</code>客户端端口</td>
</tr>
<tr>
<td>19042</td>
<td><code>TCP</code></td>
<td><code>Native shard-aware transport port</code>本机分片感知传输端口</td>
</tr>
<tr>
<td>19142</td>
<td><code>TCP</code></td>
<td><code>Native shard-aware transport port</code> (<code>ssl</code>) 本机分片感知传输端口 (<code>ssl</code>)</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><code>Install Openjdk 8 or 11</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /etc/apt/keyrings
</span></span><span style="display:flex;"><span>$ gpg --homedir /tmp --no-default-keyring --keyring /etc/apt/keyrings/scylladb.gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys d0a112e067426ab2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget -O /etc/apt/sources.list.d/scylla.list http://downloads.scylladb.com/deb/debian/scylla-5.1.list</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->安装<!-- raw HTML omitted --><code>scylla</code><!-- raw HTML omitted -->安装包<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ apt-get update
</span></span><span style="display:flex;"><span>$ apt-get install -y scylla </span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->列出可用安装包<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ apt-cache madison scylla</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->开始安装<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ apt-get install scylla<span style="color:#f92672">{</span>,-server,-jmx,-tools,-tools-core,-kernel-conf,-node-exporter,-conf,-python3<span style="color:#f92672">}=</span>4.6.1-0.20220328.2309d6b51-1  	<span style="color:#75715e"># 4.6.1-0.20220328.2309d6b51-1 为安装包</span></span></span></code></pre></div><ul>
<li>1.4 <!-- raw HTML omitted -->将<!-- raw HTML omitted --><code>Java</code><!-- raw HTML omitted -->设置为<!-- raw HTML omitted --><code>1.8</code><!-- raw HTML omitted -->版本<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ apt-get update
</span></span><span style="display:flex;"><span>$ apt-get install -y openjdk-8-jre-headless
</span></span><span style="display:flex;"><span>$ update-java-alternatives --jre-headless -s java-1.8.0-openjdk-amd64</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->运行<!-- raw HTML omitted --><code>scylla_setup</code><!-- raw HTML omitted -->脚本来调整系统设置<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ scylla_setup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to run check your kernel version?
</span></span><span style="display:flex;"><span>Yes - runs a  script to verify that the kernel <span style="color:#66d9ef">for</span> this instance qualifies to run Scylla. No - skips the kernel check.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># 是否检查内核版本</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to verify the ScyllaDB packages are installed?
</span></span><span style="display:flex;"><span>Yes - runs a script to confirm that ScyllaDB is installed. No - skips the installation check.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># 是否验证 ScyllaDB 软件包已安装</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want the Scylla server service to automatically start when the Scylla node boots?
</span></span><span style="display:flex;"><span>Yes - Scylla server service automatically starts on Scylla node boot. No - skips this step. Note you will have to start the Scylla Server service manually.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># 是否允许Scylla开机自启</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Created symlink /etc/systemd/system/multi-user.target.wants/scylla-server.service → /lib/systemd/system/scylla-server.service.
</span></span><span style="display:flex;"><span>Do you want to enable Scylla to check <span style="color:#66d9ef">if</span> there is a newer version of Scylla available?
</span></span><span style="display:flex;"><span>Yes - start the Scylla-housekeeping service to check <span style="color:#66d9ef">for</span> a newer version. This check runs periodically. No - skips this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>NO  	<span style="color:#75715e"># 是否检查Scylla 是不是最新版本</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to setup Network Time Protocol<span style="color:#f92672">(</span>NTP<span style="color:#f92672">)</span> to auto-synchronize the current time on the node?
</span></span><span style="display:flex;"><span>Yes - enables time-synchronization. This keeps the correct time on the node. No - skips this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># 是否启用NTP时间同步</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to setup RAID and XFS?
</span></span><span style="display:flex;"><span>It is recommended to use RAID and XFS <span style="color:#66d9ef">for</span> Scylla data. If you <span style="color:#66d9ef">select</span> yes, you will be prompted to choose the unmounted disks to use <span style="color:#66d9ef">for</span> Scylla data. Selected disks are formatted as part of the process.
</span></span><span style="display:flex;"><span>Yes - choose a disk/disks to format and setup <span style="color:#66d9ef">for</span> RAID and XFS. No - skip this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># 是否设置RAID和XFS 是：将会格式化磁盘</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to enable coredumps?
</span></span><span style="display:flex;"><span>Yes - sets up coredump to allow a post-mortem analysis of the Scylla state just prior to a crash. No - skips this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>  	<span style="color:#75715e"># 是否允许coredump在崩溃之前对Scylla状态进行事后分析</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to setup a system-wide customized configuration <span style="color:#66d9ef">for</span> Scylla?
</span></span><span style="display:flex;"><span>Yes - setup the sysconfig file. No - skips this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  <span style="color:#75715e"># 是否为Scylla设置系统范围自定义配置</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want IOTune to study your disks IO profile and adapt Scylla to it? <span style="color:#f92672">(</span>*WARNING* Saying NO here means the node will not boot in production mode unless you configure the I/O Subsystem manually!<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Yes - let iotune study my disk<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>. Note that this action will take a few minutes. No - skip this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># 是否让IOTune研究您的磁盘IO配置文件并使Scylla适应它，否”意味着手动配置 I/O 子系统，否则节点将不会以生产模式启动</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to set the CPU scaling governor to Performance level on boot?
</span></span><span style="display:flex;"><span>Yes - sets the CPU scaling governor to performance level. No - skip this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># 是否允许在引导时将CPU缩放调控器设置为性能级别</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to enable fstrim service?
</span></span><span style="display:flex;"><span>Yes - runs fstrim on your SSD. No - skip this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>yes/NO<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># 是否启用fstrim 服务</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Will Scylla be the only service on this host?
</span></span><span style="display:flex;"><span>Answer yes to lock all memory to Scylla, to prevent swapout. Answer no to <span style="color:#66d9ef">do</span> nothing.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># Scylla是不是该主机上的唯一服务，是：将内存锁定到Scylla，以防止换出</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to configure rsyslog to send log to a remote repository?
</span></span><span style="display:flex;"><span>Answer yes to setup rsyslog to a remote server, Answer no to <span style="color:#66d9ef">do</span> nothing.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>no  	<span style="color:#75715e"># 是否配置rsyslog将日志发送到远程存储库</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->启动<!-- raw HTML omitted --><code>Scylla</code><!-- raw HTML omitted -->数据库服务<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start scylla-server
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看是否启动</span>
</span></span><span style="display:flex;"><span>$ systemctl status scylla-server</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->检查节点状态<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nodetool status
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 运行cqlsh 连接到数据库</span>
</span></span><span style="display:flex;"><span>$ cqlsh
</span></span><span style="display:flex;"><span>$ cqlsh&gt; help  	<span style="color:#75715e"># 使用help帮助命令</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 运行 cassandra-stress</span>
</span></span><span style="display:flex;"><span>$ cqlsh&gt; cassandra-stress write -mode cql3 native</span></span></code></pre></div></blockquote>
<hr>
<h3 id="部署scylladb集群">部署<code>Scylladb</code>集群</h3>
<h4 id="单数据中心scylla集群模式">单数据中心<code>Scylla</code>集群模式</h4>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.scylladb.com/stable/operating-scylla/procedures/cluster-management/create-cluster.html" rel="external" target="_self">创建<code>Scylla</code>集群 - 单数据中心 <code>DC</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="多数据中心scylla集群模式">多数据中心<code>Scylla</code>集群模式</h4>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.scylladb.com/stable/operating-scylla/procedures/cluster-management/create-cluster-multidc.html" rel="external" target="_self">创建<code>Scylla</code>集群 - 多数据中心 <code>DC</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_redis">Install_Redis</h1>

<h2 id="redis安装"><code>Redis</code>安装</h2>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://download.redis.io/releases/" rel="external" target="_self"><code>Redis</code>安装包</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><code>Redis</code><!-- raw HTML omitted -->依赖<!-- raw HTML omitted --><code>gcc</code><!-- raw HTML omitted -->与<!-- raw HTML omitted --><code>gcc-c++</code><!-- raw HTML omitted -->，而<!-- raw HTML omitted --><code>Redis5.0</code><!-- raw HTML omitted -->以上需要更高版本<!-- raw HTML omitted --><code>gcc</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->安装<!-- raw HTML omitted --><code>Gcc</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Debian系统</span>
</span></span><span style="display:flex;"><span>$ sudo apt-get install wget gcc make pkg-config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install gcc gcc-c++ centos-release-scl wget git</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->安装高版本<!-- raw HTML omitted --><code>gcc</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 临时生效</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;scl enable devtoolset-9 bash&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加到环境变量永久生效</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;source /opt/rh/devtoolset-9/enable&#34;</span> &gt;&gt;/etc/profile
</span></span><span style="display:flex;"><span>$ source /etc/profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;scl enable devtoolset-9 bash&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span style="display:flex;"><span>$ source ~/.bashrc   <span style="color:#75715e"># 使更改生效</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如果出现不能跳转root执行</span>
</span></span><span style="display:flex;"><span>$ sudo scl enable devtoolset-9 bash</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->安装<!-- raw HTML omitted --><code>Redis</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->下载<!-- raw HTML omitted --><code>tar</code><!-- raw HTML omitted -->包到指定目并解压<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://download.redis.io/releases/redis-6.2.6.tar.gz  	<span style="color:#75715e"># 下载到指定目录</span>
</span></span><span style="display:flex;"><span>$ sudo wget -P /usr/local/src/ https://download.redis.io/redis-stable.tar.gz</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->解压到指定目录并重命名<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /usr/local/redis <span style="color:#f92672">&amp;&amp;</span> tar zxvf /usr/local/src/redis-6.2.6.tar.gz -C /usr/local/redis --strip-components <span style="color:#ae81ff">1</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->配置<!-- raw HTML omitted --><code>redis</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/redis
</span></span><span style="display:flex;"><span>$ make MALLOC<span style="color:#f92672">=</span>libc BUILD_TLS<span style="color:#f92672">=</span>yes  	<span style="color:#75715e"># 有些版本或者云需要 BUILD_TLS=yes 参数</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->执行安装<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ make PREFIX<span style="color:#f92672">=</span>/usr/local/redis install </span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->修改配置文件<!-- raw HTML omitted --><code>daemonize</code><!-- raw HTML omitted -->参数能后台启动以及使用密码连接<!-- raw HTML omitted --><!-- raw HTML omitted -->注释不可以在行尾<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;# redis后台运行
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">daemonize yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Redis的pid文件存放位置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pidfile /usr/local/redis/logs/redis_6379.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Redis的日志文件存放位置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">logfile /usr/local/redis/logs/redis_6379.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 端口号
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port 6379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 最好是本机IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">bind 192.168.176.131
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 超时时间300秒 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">timeout 300
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 缓存库的个数
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">databases 8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 将数据库转储到的文件名
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dbfilename dump-16379.db
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 数据存放目录
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dir /opt/data/redis/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 主库密码
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">masterauth password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 连接密码
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">requirepass password &#39;</span>&gt; /usr/local/redis/redis.conf</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->启动<!-- raw HTML omitted --><code>Redis</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/redis/bin/redis-server /usr/local/redis/redis.conf</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->编写常规启动文件<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;#!/bin/sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Simple Redis init.d script conceived to work on Linux systems
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># as it does use of the /proc filesystem.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># chkconfig:   2345 90 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># description:  Redis is a persistent key-value database
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">REDISPORT=6379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EXEC=/usr/local/redis/bin/redis-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CLIEXEC=/usr/local/redis/bin/redis-cli
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$CLIEXEC -a &#34;Redis&#34; -p $REDISPORT shutdown
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PIDFILE=/var/run/redis_${REDISPORT}.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CONF=&#34;/usr/local/redis/redis.conf&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">case &#34;$1&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  if [ -f $PIDFILE ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;$PIDFILE exists, process is already running or crashed&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Starting Redis server...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          $EXEC $CONF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  if [ ! -f $PIDFILE ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;$PIDFILE does not exist, process is not running&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          PID=$(cat $PIDFILE)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Stopping ...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          $CLIEXEC -p $REDISPORT shutdown
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          while [ -x /proc/${PID} ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#34;Waiting for Redis to shutdown ...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              sleep 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Redis stopped&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">*)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  echo &#34;Please use start or stop as first argument&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">esac&#39;</span> &gt; /etc/init.d/redis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chmod +x /etc/init.d/redis
</span></span><span style="display:flex;"><span>$ chkconfig redis on
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动并查看端口号</span>
</span></span><span style="display:flex;"><span>$ service redis start
</span></span><span style="display:flex;"><span>$ netstat -nuplt | grep <span style="color:#ae81ff">6379</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->编写指定目录启动文件<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;## 目录
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">REDIS_PATH=&#34;/opt/apps/redis&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sql_conf_dir=&#39;</span>/opt/apps/redis<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sql_conf_file=$(ls $sql_conf_dir/* |egrep conf$)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sql_user=&#39;</span>admin<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_redis(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  sql_pid=$(ps -ef |egrep redis-server |egrep -v root |awk &#39;</span><span style="color:#f92672">{</span>print $2<span style="color:#f92672">}</span><span style="color:#e6db74">&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  [ ! -z ${sql_pid} ] &amp;&amp; echo -e &#34;\n\033[31mredis running...\033[0m\n&#34; &amp;&amp; exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  su ${sql_user} -s /bin/bash -c &#34;${REDIS_PATH}/bin/redis-server ${sql_conf_file}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">stop_redis(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  sql_pid=$(ps -ef |egrep redis-server |egrep -v root |awk &#39;</span><span style="color:#f92672">{</span>print $2<span style="color:#f92672">}</span><span style="color:#e6db74">&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  [ -z ${sql_pid} ] &amp;&amp; echo -e &#34;\n\033[31mredis not run...\033[0m\n&#34; &amp;&amp; exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  su swadmin -s /bin/bash -c &#34;kill ${sql_pid}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">### Finally the input handling.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">case &#34;$1&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  start_redis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  stop_redis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">*)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  echo &#34;Usage: service redis {start|stop}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">esac
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">exit &#39;</span>&gt; /etc/init.d/redis
</span></span><span style="display:flex;"><span>$ chmod +x /etc/init.d/redis
</span></span><span style="display:flex;"><span>$ chkconfig redis on</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->部署脚本<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;redis-install.sh<span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#34;N;56isource /opt/rh/devtoolset-9/enable&#34;  /etc/profile  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">id swadmin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ $? -ne 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 创建普通用户部署运行Redis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">groupadd swadmin &amp;&amp; useradd -g swadmin swadmi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;20210623@123&#34;|passwd --stdin2 swadmin &amp;&gt;/dev/null   # 给swadmin用户设置密码
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mkdir -p /opt/{src,conf,data,apps} /opt/data/{data_17693,data_17694,data_17695,data_16303}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">chown -R swadmin. /opt/* 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;#####   Start/Stop Service   #####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Cmnd_Alias SWADMIN_START_SERVICES = /etc/init.d/redis, /opt/*  # 授予普通用户启动停止权限
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">swadmin ALL=(ALL)NOPASSWD:SWADMIN_START_SERVICES&#34; &gt;/etc/sudoers.d/swadmin 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">chmod 660 /etc/sudoers.d/swadmin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Redis依赖gcc 与gcc-c++,#Redis5.0以上需要高版本gcc  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum -y install gcc gcc-c++ centos-release-scl wget git
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#39;scl enable devtoolset-9 bash&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;source /opt/rh/devtoolset-9/enable&#34; &gt;&gt;/etc/profile
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">source /etc/profile
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## 如遇因缺少gcc报错先执行
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## make distclean 再meke
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">su swadmin -c &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">git clone https://admin:&#34;frTd3KbJct_pgoBstA5f&#34;@gitlab.com/usererge/redis-conf.git /opt/conf/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wget -P /opt/src/ http://download.redis.io/releases/redis-5.0.7.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mkdir -p /opt/apps/redis &amp;&amp; tar zxvf /opt/src/redis-5.0.7.tar.gz -C /opt/apps/redis --strip-components 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd /opt/apps/redis/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">make MALLOC=libc 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">make PREFIX=/opt/apps/redis install
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/redis/src/redis-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/conf/redis-conf/re_17693.conf &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">source /etc/profile  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_redis_cluster">Install_Redis_Cluster</h1>

<h2 id="redis集群部署"><code>Redis</code>集群部署</h2>
<h3 id="redis主从模式"><code>Redis</code>主从模式</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->单节点<!-- raw HTML omitted -->主从模式需要修改<!-- raw HTML omitted -->端口<!-- raw HTML omitted -->以及配置文件</li>
<li><!-- raw HTML omitted -->主节点<!-- raw HTML omitted --><code>redis.conf</code><!-- raw HTML omitted -->配置文件<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>daemonize yes  	<span style="color:#75715e"># redis后台运行</span>
</span></span><span style="display:flex;"><span>pidfile /usr/local/redis/logs/redis_6379.pid  	<span style="color:#75715e"># Redis的pid文件存放位置</span>
</span></span><span style="display:flex;"><span>logfile /usr/local/redis/logs/redis_6379.log  	<span style="color:#75715e"># Redis的日志文件存放位置</span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">6379</span>  	<span style="color:#75715e"># 端口号</span>
</span></span><span style="display:flex;"><span>bind 192.168.176.131  	<span style="color:#75715e"># 最好是本机IP</span>
</span></span><span style="display:flex;"><span>timeout <span style="color:#ae81ff">300</span>  	<span style="color:#75715e"># 超时时间300秒                                        </span>
</span></span><span style="display:flex;"><span>databases <span style="color:#ae81ff">8</span>  	<span style="color:#75715e"># 缓存库的个数 </span>
</span></span><span style="display:flex;"><span>dbfilename dump-16379.db  	<span style="color:#75715e"># 将数据库转储到的文件名</span>
</span></span><span style="display:flex;"><span>dir ./  	<span style="color:#75715e"># 数据存放目录</span>
</span></span><span style="display:flex;"><span>masterauth password  	<span style="color:#75715e"># 主库密码</span>
</span></span><span style="display:flex;"><span>requirepass password  	<span style="color:#75715e"># 登录连接密码</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->从节点<!-- raw HTML omitted --><code>redis.conf</code><!-- raw HTML omitted -->配置文件，第二台从节点修改：<!-- raw HTML omitted --><code>bind</code><!-- raw HTML omitted -->为自己服务器本身<!-- raw HTML omitted --><code>ip</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>daemonize yes  	<span style="color:#75715e"># redis后台运行</span>
</span></span><span style="display:flex;"><span>pidfile /usr/local/redis/logs/redis_6379.pid  	<span style="color:#75715e"># 不同实例修改为对应pid文件</span>
</span></span><span style="display:flex;"><span>logfile /usr/local/redis/logs/redis_6379.log
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>bind 192.168.176.132
</span></span><span style="display:flex;"><span>timeout <span style="color:#ae81ff">300</span>
</span></span><span style="display:flex;"><span>databases <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>dbfilename dump-16379.db
</span></span><span style="display:flex;"><span>dir ./  	<span style="color:#75715e"># 数据存放目录</span>
</span></span><span style="display:flex;"><span>masterauth <span style="color:#ae81ff">123456</span>  	<span style="color:#75715e"># 填写主库密码</span>
</span></span><span style="display:flex;"><span>requirepass <span style="color:#ae81ff">123456</span>  	<span style="color:#75715e"># 登录连接密码</span>
</span></span><span style="display:flex;"><span>slaveof 192.168.176.131 <span style="color:#ae81ff">6379</span>  	<span style="color:#75715e"># 连接的主库IP和端口号</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="redis-cluster模式"><code>Redis Cluster</code>模式</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->集群模式最少6个节点<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->修改配置文件<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dir /usr/local/redis-cluster/data/redis-6379  	<span style="color:#75715e"># 修改为对应实例数据存放目录</span>
</span></span><span style="display:flex;"><span>pidfile /usr/local/redis-cluster/logs/redis_6379.pid  	<span style="color:#75715e"># 修改为对应实例：Pid</span>
</span></span><span style="display:flex;"><span>logfile /usr/local/redis-cluster/logs/redis_6379.log  	<span style="color:#75715e"># 修改为对应实例 </span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">6379</span>  	<span style="color:#75715e"># 端口号</span>
</span></span><span style="display:flex;"><span>cluster-enabled yes  	<span style="color:#75715e"># 开启集群模式，把注释#去掉</span>
</span></span><span style="display:flex;"><span>cluster-config-file /usr/local/redis-cluster/conf/redis_16379.conf  	<span style="color:#75715e"># 不同实例修改为对应</span>
</span></span><span style="display:flex;"><span>cluster-node-timeout <span style="color:#ae81ff">10000</span>  	<span style="color:#75715e"># 请求超时，设置10秒</span>
</span></span><span style="display:flex;"><span>appendonly yes  	<span style="color:#75715e"># aof日志开启，有需要就开启，它会每次写操作都记录一条日志</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>Redis5.0</code><!-- raw HTML omitted -->以上版本使用<!-- raw HTML omitted --><code>Redis-cli</code><!-- raw HTML omitted -->客户端部署<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->部署集群需要<!-- raw HTML omitted --><!-- raw HTML omitted -->防火墙开放集群端口<!-- raw HTML omitted --><!-- raw HTML omitted -->互通如端口是：<!-- raw HTML omitted --><code>6379</code> <!-- raw HTML omitted -->集群端口就是：<!-- raw HTML omitted --><code>16379</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/apps/redis/bin/redis-cli -a password --cluster create --cluster-replicas <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> 192.168.213.128:6379 192.168.213.128:6380 192.168.213.128:6381 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> 192.168.213.129:6379 192.168.213.129:6380 192.168.213.129:6381</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->脚本部署<!-- raw HTML omitted --><code>Redis-Cluster</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;#!bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pkill redis-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd /opt/conf/redis-conf/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#39;</span>s/^#cluster-enabled/cluster-enabled/<span style="color:#e6db74">&#39; re_17693.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cat re_17693.conf |tee re_1769{4..5}.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">chown -R swadmin. *
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#34;s/17693/17694/g&#34; re_17694.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#34;s/17693/17695/g&#34; re_17695.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17693.conf &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17694.conf &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17695.conf &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --permanent --new-ipset=redis_whitelist --type=hash:ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --permanent --add-rich-rule &#39;</span>rule family<span style="color:#f92672">=</span>ipv4 source ipset<span style="color:#f92672">=</span>redis_whitelist port protocol<span style="color:#f92672">=</span>tcp port<span style="color:#f92672">=</span>27693-27695 accept<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --permanent --add-rich-rule &#39;</span>rule family<span style="color:#f92672">=</span>ipv4 source ipset<span style="color:#f92672">=</span>redis_whitelist port protocol<span style="color:#f92672">=</span>tcp port<span style="color:#f92672">=</span>17693-17695 accept<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">read -p &#34;请输入对方服务器IP:&#34; IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --permanent --ipset=redis_whitelist --add-entry=$IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --reload
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#echo &#39;</span>yes<span style="color:#e6db74">&#39; |/opt/apps/redis/bin/redis-cli -a \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9tN6GFGK60Jk8BNkBJM611GwA66uDFeG \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cluster create --cluster-replicas 1 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.213.128:17693  192.168.213.128:17694 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.213.128:17695  192.168.213.129:17693 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.213.129:17694  192.168.213.129:17695  #创建集群命令根据IP和端口修改
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>&gt;redis-cluster.sh</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="docker部署redis集群"><code>docker</code>部署<code>Redis</code>集群</h3>
<ul>
<li>
<ol>
<li><a href="https://www.jianshu.com/p/b7dea62bcd8b" rel="external" target="_self"><code>Docker</code>方式部署<code>redis-cluster</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;docker-install-redis-cluster.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#------------ bootstrap the cluster nodes --------------------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_cmd=&#39;redis-server --port 6379 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000 --appendonly yes --masterauth Redis --requirepass Redis&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">redis_image=&#39;redis:5.0-rc&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">network_name=&#39;redis_cluster_net&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker network create $network_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo $network_name &#34; created&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#---------- create the cluster ------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for port in `seq 6379 6384`; do \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker run -d --name &#34;redis-&#34;$port -p $port:6379 --net $network_name $redis_image $start_cmd;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;created redis cluster node redis-&#34;$port
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cluster_hosts=&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for port in `seq 6379 6384`; do \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hostip=`docker inspect -f &#39;{{(index .NetworkSettings.Networks &#34;redis_cluster_net&#34;).IPAddress}}&#39; &#34;redis-&#34;$port`;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;IP for cluster node redis-&#34;$port &#34;is&#34; $hostip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cluster_hosts=&#34;$cluster_hosts$hostip:6379 &#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;cluster hosts &#34;$cluster_hosts
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;creating cluster....&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#39;yes&#39; | docker run -i --rm --restart=always -v /etc/localtime:/etc/localtime --net $network_name $redis_image redis-cli  -a Redis --cluster create $cluster_hosts --cluster-replicas 1;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="redis-50以下版本"><code>Redis 5.0</code>以下版本</h3>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.myfreax.com/how-to-install-ruby-on-centos-7/" rel="external" target="_self">如何在<code>CentOS 7</code>上安装<code>Ruby</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.jianshu.com/p/e4847f3926d1" rel="external" target="_self"><code>CentOS 7</code>安装<code>Ruby on Rails</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/xuliangxing/p/7132656.html" rel="external" target="_self"><code>Linux</code>安装<code>Ruby</code>详解(在线和离线安装)</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/tommy-huang/p/7279796.html" rel="external" target="_self"><code>CentOS 7</code>通过<code>RVM</code>来安装指定版本的<code>Ruby</code></a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="安装ruby">安装<code>Ruby</code></h4>
<blockquote>
<ul>
<li><code>Redis 5.0</code>以下版本使用<code>Ruby</code>方式安装<code>Redis</code>集群</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum install gcc-c++ patch readline readline-devel zlib zlib-devel libyaml-devel libffi-devel openssl-devel make bzip2 autoconf automake libtool bison iconv-devel -y   #安装依赖库
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpg2 --keyserver hkp://keys.gnupg.net --recv-keys D39DC0E3    #安装RVM
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">curl -sSL https://rvm.io/mpapis.asc | gpg2 --import -
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">curl -sSL https://rvm.io/pkuczynski.asc | gpg2 --import -
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">curl -L get.rvm.io | bash -s stable
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">source /etc/profile.d/rvm.sh    #设定rvm环境
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm -v          #查看是否安装正常
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm list known  #查询当前Ruby的版本列表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm install 2.4.6   #安装指定版本的Ruby
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ruby -v             #测试是否成功
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm use 2.4.6  --default     #在安装多个版本ruby环境下指定默认版本：这里讲2.4.6 作为默认ruby版本
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm system --default    #使用会系统默认版本Ruby
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gem install redis       准备rubygem redis依赖
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span> &gt;install-ruby.sh</span></span></code></pre></div></blockquote>
<hr>
<h4 id="拷贝redis-tribrb到集群根目录">拷贝<code>redis-trib.rb</code>到集群根目录</h4>
<blockquote>
<ul>
<li><code>redis-trib.rb</code> 是<code>redis</code>官方推出的管理<code>redis</code>集群 的工具，集成在<code>redis</code>的源码<code>src</code>目录下，将基于 <code>redis</code>提供的 集群命令 封装成 简单、便捷、实用 的 操作工具</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp /opt/apps/redis/src/redis-trib.rb /opt/apps/redis/</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->查看<!-- raw HTML omitted --><code>redis-trib.rb</code><!-- raw HTML omitted -->命令环境是否正确，输出如下<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./redis-trib.rb 
</span></span><span style="display:flex;"><span>Usage: redis-trib &lt;command&gt; &lt;options&gt; &lt;arguments ...&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  create          host1:port1 ... hostN:portN
</span></span><span style="display:flex;"><span>                  --replicas &lt;arg&gt;
</span></span><span style="display:flex;"><span>  check           host:port
</span></span><span style="display:flex;"><span>  info            host:port
</span></span><span style="display:flex;"><span>  fix             host:port
</span></span><span style="display:flex;"><span>                  --timeout &lt;arg&gt;
</span></span><span style="display:flex;"><span>  reshard         host:port
</span></span><span style="display:flex;"><span>                  --from &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --to &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --slots &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --yes
</span></span><span style="display:flex;"><span>                  --timeout &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --pipeline &lt;arg&gt;
</span></span><span style="display:flex;"><span>  rebalance       host:port
</span></span><span style="display:flex;"><span>                  --weight &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --auto-weights
</span></span><span style="display:flex;"><span>                  --use-empty-masters
</span></span><span style="display:flex;"><span>                  --timeout &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --simulate
</span></span><span style="display:flex;"><span>                  --pipeline &lt;arg&gt;</span></span></code></pre></div><ul>
<li><code>redis-trib.rb</code><!-- raw HTML omitted -->是<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->作者用<!-- raw HTML omitted --><code>ruby</code><!-- raw HTML omitted -->完成的。<!-- raw HTML omitted --><code>redis-trib.rb</code><!-- raw HTML omitted -->命令行工具 的具体功能如下:  <!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>create</code></td>
<td>创建集群</td>
</tr>
<tr>
<td><code>check</code></td>
<td>检查集群</td>
</tr>
<tr>
<td><code>info</code></td>
<td>查看集群信息</td>
</tr>
<tr>
<td><code>fix</code></td>
<td>修复集群</td>
</tr>
<tr>
<td><code>reshard</code></td>
<td>在线迁移<code>slot</code></td>
</tr>
<tr>
<td><code>rebalance</code></td>
<td>平衡集群节点<code>slot</code>数量</td>
</tr>
<tr>
<td><code>add-node</code></td>
<td>将新节点加入集群</td>
</tr>
<tr>
<td><code>del-node</code></td>
<td>从集群中删除节点</td>
</tr>
<tr>
<td><code>set-timeout</code></td>
<td>设置集群节点间心跳连接的超时时间</td>
</tr>
<tr>
<td><code>call</code></td>
<td>在集群全部节点上执行命令</td>
</tr>
<tr>
<td><code>import</code></td>
<td>将外部<code>redis</code>数据导入集群</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->运行命令启动所有节点<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17693.conf &amp;
</span></span><span style="display:flex;"><span>$ /opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17694.conf &amp;
</span></span><span style="display:flex;"><span>$ /opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17695.conf &amp;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->在每个<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->节点的<!-- raw HTML omitted --><code>redis.conf</code><!-- raw HTML omitted -->文件中，我们都配置了<!-- raw HTML omitted --><code>cluster-config-file</code><!-- raw HTML omitted -->的文件路径，集群启动时<!-- raw HTML omitted --><code>conf</code><!-- raw HTML omitted -->目录会新生成 集群 节点配置文件。查看文件列表如下：<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install tree
</span></span><span style="display:flex;"><span>$ tree -L <span style="color:#ae81ff">3</span> .
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── bin
</span></span><span style="display:flex;"><span>│   ├── redis-benchmark
</span></span><span style="display:flex;"><span>│   ├── redis-check-aof
</span></span><span style="display:flex;"><span>│   ├── redis-check-rdb
</span></span><span style="display:flex;"><span>│   ├── redis-cli
</span></span><span style="display:flex;"><span>│   ├── redis-sentinel -&gt; redis-server
</span></span><span style="display:flex;"><span>│   └── redis-server
</span></span><span style="display:flex;"><span>├── nodes-6379.conf
</span></span><span style="display:flex;"><span>├── redis.conf
</span></span><span style="display:flex;"><span>└── redis-trib.rb</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->配置密码<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /usr/local/rvm/gems/ruby-2.4.6/gems/redis-4.1.3/lib/redis/client.rb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># frozen_string_literal: true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>require_relative <span style="color:#e6db74">&#34;errors&#34;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#34;socket&#34;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#34;cgi&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>class Redis
</span></span><span style="display:flex;"><span>class Client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> DEFAULTS <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   :url <span style="color:#f92672">=</span>&gt; lambda <span style="color:#f92672">{</span> ENV<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;REDIS_URL&#34;</span><span style="color:#f92672">]</span> <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>   :scheme <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;redis&#34;</span>,
</span></span><span style="display:flex;"><span>   :host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
</span></span><span style="display:flex;"><span>   :port <span style="color:#f92672">=</span>&gt; 6379,
</span></span><span style="display:flex;"><span>   :path <span style="color:#f92672">=</span>&gt; nil,
</span></span><span style="display:flex;"><span>   :timeout <span style="color:#f92672">=</span>&gt; 5.0,
</span></span><span style="display:flex;"><span>   :password <span style="color:#f92672">=</span>&gt; Redis,  	<span style="color:#75715e"># 配置密码</span>
</span></span><span style="display:flex;"><span>   :db <span style="color:#f92672">=</span>&gt; 0,
</span></span><span style="display:flex;"><span>   :driver <span style="color:#f92672">=</span>&gt; nil,
</span></span><span style="display:flex;"><span>   :id <span style="color:#f92672">=</span>&gt; nil,
</span></span><span style="display:flex;"><span>   :tcp_keepalive <span style="color:#f92672">=</span>&gt; 0,
</span></span><span style="display:flex;"><span>   :reconnect_attempts <span style="color:#f92672">=</span>&gt; 1,
</span></span><span style="display:flex;"><span>   :reconnect_delay <span style="color:#f92672">=</span>&gt; 0,
</span></span><span style="display:flex;"><span>   :reconnect_delay_max <span style="color:#f92672">=</span>&gt; 0.5,
</span></span><span style="display:flex;"><span>   :inherit_socket <span style="color:#f92672">=</span>&gt; false
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>redis-trib</code><!-- raw HTML omitted -->关联集群节点<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->按照从主到从的方式从左到右依次排列 6 个<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->节点，如果不通两个问题：密码、防火墙<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;yes&#39;</span>|./redis-trib.rb create --replicas <span style="color:#ae81ff">1</span> 192.168.176.142:6379 192.168.176.143:6379 192.168.176.144:6379 192.168.176.145:6379 192.168.176.142:6380 192.168.176.143:6380 192.168.176.144:6380 192.168.176.145:6380  
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Creating cluster
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing hash slots allocation on <span style="color:#ae81ff">8</span> nodes...
</span></span><span style="display:flex;"><span>Using <span style="color:#ae81ff">4</span> masters:
</span></span><span style="display:flex;"><span>192.168.176.142:6379
</span></span><span style="display:flex;"><span>192.168.176.143:6379
</span></span><span style="display:flex;"><span>192.168.176.144:6379
</span></span><span style="display:flex;"><span>192.168.176.145:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.176.143:6380 to 192.168.176.142:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.176.142:6380 to 192.168.176.143:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.176.145:6380 to 192.168.176.144:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.176.144:6380 to 192.168.176.145:6379
</span></span><span style="display:flex;"><span>M: 157bd250dd382b95a9289d8b44fd2cfd466fea98 192.168.176.142:6379
</span></span><span style="display:flex;"><span>   slots:0-4095 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>M: c6df79e7c60c03921b69e4d4342507e8d4d2afbd 192.168.176.143:6379
</span></span><span style="display:flex;"><span>   slots:4096-8191 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>M: a463232f96c66cd7f27395253b65d0be8909656e 192.168.176.144:6379
</span></span><span style="display:flex;"><span>   slots:8192-12287 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>M: 44b244a188185835b42d4489eac614e7f81b4cf8 192.168.176.145:6379
</span></span><span style="display:flex;"><span>   slots:12288-16383 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>S: 1cafdeeb6cb52bb96dd16ac84d2242f59973f83a 192.168.176.142:6380
</span></span><span style="display:flex;"><span>   replicates c6df79e7c60c03921b69e4d4342507e8d4d2afbd
</span></span><span style="display:flex;"><span>S: a6d87fb995f3f5e98e2a09f4b5a3078f7221a257 192.168.176.143:6380
</span></span><span style="display:flex;"><span>   replicates 157bd250dd382b95a9289d8b44fd2cfd466fea98
</span></span><span style="display:flex;"><span>S: 31a3f0b03244d30bbc7e47acc0ec06d327b62860 192.168.176.144:6380
</span></span><span style="display:flex;"><span>   replicates 44b244a188185835b42d4489eac614e7f81b4cf8
</span></span><span style="display:flex;"><span>S: fc22025eb5db7cc0d55fe7dc11a3c368daa468bb 192.168.176.145:6380
</span></span><span style="display:flex;"><span>   replicates a463232f96c66cd7f27395253b65d0be8909656e
</span></span><span style="display:flex;"><span>Can I set the above configuration? <span style="color:#f92672">(</span>type <span style="color:#e6db74">&#39;yes&#39;</span> to accept<span style="color:#f92672">)</span>: yes     <span style="color:#75715e">#此处输入：yes、然后redis-trib.rb 开始执行 节点握手 和 槽分配 操作，输出如下：</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Nodes configuration updated
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Assign a different config epoch to each node
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> the cluster to join....
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check <span style="color:#f92672">(</span>using node 192.168.176.142:6379<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 157bd250dd382b95a9289d8b44fd2cfd466fea98 192.168.176.142:6379
</span></span><span style="display:flex;"><span>   slots:0-4095 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: 31a3f0b03244d30bbc7e47acc0ec06d327b62860 192.168.176.144:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 44b244a188185835b42d4489eac614e7f81b4cf8
</span></span><span style="display:flex;"><span>M: a463232f96c66cd7f27395253b65d0be8909656e 192.168.176.144:6379
</span></span><span style="display:flex;"><span>   slots:8192-12287 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 44b244a188185835b42d4489eac614e7f81b4cf8 192.168.176.145:6379
</span></span><span style="display:flex;"><span>   slots:12288-16383 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: fc22025eb5db7cc0d55fe7dc11a3c368daa468bb 192.168.176.145:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates a463232f96c66cd7f27395253b65d0be8909656e
</span></span><span style="display:flex;"><span>M: c6df79e7c60c03921b69e4d4342507e8d4d2afbd 192.168.176.143:6379
</span></span><span style="display:flex;"><span>   slots:4096-8191 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: a6d87fb995f3f5e98e2a09f4b5a3078f7221a257 192.168.176.143:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 157bd250dd382b95a9289d8b44fd2cfd466fea98
</span></span><span style="display:flex;"><span>S: 1cafdeeb6cb52bb96dd16ac84d2242f59973f83a 192.168.176.142:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates c6df79e7c60c03921b69e4d4342507e8d4d2afbd
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check <span style="color:#66d9ef">for</span> open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All <span style="color:#ae81ff">16384</span> slots covered.</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>redis</code><!-- raw HTML omitted -->集群完整性检<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->使用<code>redis-trib.rb check</code>命令检测之前创建的 两个集群 是否成功，<code>check</code>命令只需要给出集群中 任意一个节点地址 就可以完成 整个集群 的 检查工作，命令如下：<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./redis-trib.rb check 192.168.176.145:6379 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check <span style="color:#f92672">(</span>using node 192.168.176.142:6379<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 157bd250dd382b95a9289d8b44fd2cfd466fea98 192.168.176.142:6379
</span></span><span style="display:flex;"><span>   slots:0-4095 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: 31a3f0b03244d30bbc7e47acc0ec06d327b62860 192.168.176.144:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 44b244a188185835b42d4489eac614e7f81b4cf8
</span></span><span style="display:flex;"><span>M: a463232f96c66cd7f27395253b65d0be8909656e 192.168.176.144:6379
</span></span><span style="display:flex;"><span>   slots:8192-12287 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 44b244a188185835b42d4489eac614e7f81b4cf8 192.168.176.145:6379
</span></span><span style="display:flex;"><span>   slots:12288-16383 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: fc22025eb5db7cc0d55fe7dc11a3c368daa468bb 192.168.176.145:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates a463232f96c66cd7f27395253b65d0be8909656e
</span></span><span style="display:flex;"><span>M: c6df79e7c60c03921b69e4d4342507e8d4d2afbd 192.168.176.143:6379
</span></span><span style="display:flex;"><span>   slots:4096-8191 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: a6d87fb995f3f5e98e2a09f4b5a3078f7221a257 192.168.176.143:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 157bd250dd382b95a9289d8b44fd2cfd466fea98
</span></span><span style="display:flex;"><span>S: 1cafdeeb6cb52bb96dd16ac84d2242f59973f83a 192.168.176.142:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates c6df79e7c60c03921b69e4d4342507e8d4d2afbd
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check <span style="color:#66d9ef">for</span> open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All <span style="color:#ae81ff">16384</span> slots covered.</span></span></code></pre></div></blockquote>
<hr>
<h3 id="redis-sentinel模式"><code>Redis Sentinel</code>模式</h3>
<blockquote>
<ul>
<li><code>Redis Sentinel</code>哨兵模式</li>
<li><!-- raw HTML omitted -->节点-1<!-- raw HTML omitted --><code>sentinel_16380.conf</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>protected-mode no
</span></span><span style="display:flex;"><span>bind 192.168.176.131  	<span style="color:#75715e"># 本机IP</span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">16380</span>
</span></span><span style="display:flex;"><span>daemonize yes
</span></span><span style="display:flex;"><span>sentinel monitor master 192.168.176.131 <span style="color:#ae81ff">6379</span> <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># 主IP与端口号</span>
</span></span><span style="display:flex;"><span>sentinel down-after-milliseconds master <span style="color:#ae81ff">5000</span>  	<span style="color:#75715e"># 指定主节点应答哨兵sentinel的最大时间间隔，超过这个时间，哨兵主观上认为主节点下线，默认30秒</span>
</span></span><span style="display:flex;"><span>sentinel failover-timeout master <span style="color:#ae81ff">180000</span>  	<span style="color:#75715e"># 故障转移的超时时间failover-timeout，默认三分钟，可以用在以下这些方面</span>
</span></span><span style="display:flex;"><span>sentinel parallel-syncs master <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># 指定了在发生failover主备切换时，最多可以有多少个slave同时对新的master进行同步。这个数字越小，完成failover所需的时间就越长；反之，但是如果这个数字越大，就意味着越多的slave因为replication而不可用。可以通过将这个值设为1，来保证每次只有一个slave，处于不能处理命令请求的状态。</span>
</span></span><span style="display:flex;"><span>sentinel auth-pass master <span style="color:#ae81ff">123456</span>  	<span style="color:#75715e"># 当在Redis实例中开启了requirepass &lt;foobared&gt;，所有连接Redis实例的客户端都要提供密码</span>
</span></span><span style="display:flex;"><span>logfile /var/log/redis/sentinel_16380.log</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->节点2~3<!-- raw HTML omitted --><code>centinel_16380.conf </code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>protected-mode no
</span></span><span style="display:flex;"><span>bind 192.168.176.132  	<span style="color:#75715e"># 此处修改为本机IP</span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">16380</span>
</span></span><span style="display:flex;"><span>daemonize yes
</span></span><span style="display:flex;"><span>sentinel monitor master 192.168.176.131 <span style="color:#ae81ff">6379</span> <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># 主IP与端口号</span>
</span></span><span style="display:flex;"><span>sentinel down-after-milliseconds master <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>sentinel failover-timeout master <span style="color:#ae81ff">180000</span>
</span></span><span style="display:flex;"><span>sentinel parallel-syncs master <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>sentinel auth-pass master <span style="color:#ae81ff">123456</span>
</span></span><span style="display:flex;"><span>logfile /var/log/redis/sentinel_16380.log</span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_cassandra">Install_Cassandra</h1>

<h2 id="cassandra"><code>Cassandra</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://cassandra.apache.org/doc/latest/cassandra/getting_started/index.html" rel="external" target="_self">开源<code>NoSQL</code>数据库<code>Cassandra</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_aerospike">Install_Aerospike</h1>

<h2 id="aerospike"><code>Aerospike</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://aerospike.com/" rel="external" target="_self"><code>Aerospike</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://docs.aerospike.com/server/operations/install" rel="external" target="_self"><code>Aerospike</code>安装文档</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_redis">Configure_Redis</h1>

<h2 id="编写启动文件">编写启动文件</h2>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://juejin.cn/post/6844903661223542792" rel="external" target="_self">深入剖析<code>Redis</code>系列</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/kismetv/p/9137897.html" rel="external" target="_self">深入学习<code>Redis</code>持久化</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/hopeofthevillage/p/11535683.html" rel="external" target="_self"><code>Redis</code>集群增加节点和删除节点</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/tair-opensource/RedisShake" rel="external" target="_self"><code>RedisShake</code></a>、<a href="https://github.com/tair-opensource/RedisShake/releases/download/v4.1.1/redis-shake-linux-amd64.tar.gz" rel="external" target="_self">redis-shake-linux-amd64.tar.gz</a></td>
<td><code>Redis</code>迁移工具</td>
</tr>
<tr>
<td><a href="https://www.volcengine.com/docs/6293/78099" rel="external" target="_self"><code>redis-shake</code>使用<code>RDB</code>文件迁移数据</a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="redis桌面连接工具"><code>Redis</code>桌面连接工具</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>https://github.com/uglide/RedisDesktopManager/releases/tag/0.8.8  	<span style="color:#75715e"># 下载客户端连接工具 Redis 0.8.8  </span>
</span></span><span style="display:flex;"><span>https://github.com/uglide/RedisDesktopManager/releases/tag/0.9.3  	<span style="color:#75715e"># 下载客户端连接工具 Redis 0.9.3</span>
</span></span><span style="display:flex;"><span>https://github.com/qishibo/AnotherRedisDesktopManager/releases  	<span style="color:#75715e"># windows系统远程连接工具</span>
</span></span><span style="display:flex;"><span>https://github.com/quick123official/quick_redis_blog/releases </span></span></code></pre></div></blockquote>
<hr>
<h3 id="redis常用命令"><code>Redis</code>常用命令</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 查看Redis具体IP连接数 </span>
</span></span><span style="display:flex;"><span>$ netstat -n |grep <span style="color:#ae81ff">17693</span> |awk <span style="color:#e6db74">&#39;/^tcp/ {print $5}&#39;</span>| awk -F: <span style="color:#e6db74">&#39;{print $1}&#39;</span>|sort | uniq -c | sort -rn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 统计Redis在线人数</span>
</span></span><span style="display:flex;"><span>$ redis-cli -h 127.0.0.1 -p <span style="color:#ae81ff">6379</span> -c -a <span style="color:#e6db74">&#34;password&#34;</span> KEYS SPORTS:session:* 2&lt;/dev/null | awk <span style="color:#e6db74">&#34;{print </span>$2<span style="color:#e6db74">}&#34;</span>| awk -F<span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#e6db74">&#39; {print $2,$3}&#39;</span>| sed -e <span style="color:#e6db74">&#34;s/^/</span><span style="color:#e6db74">${</span>date<span style="color:#e6db74">}</span><span style="color:#e6db74">: /g&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; type 键值  	<span style="color:#75715e">#  查看值的类型</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; HGET  	<span style="color:#75715e"># 获取键值数据</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; HGETALL  	<span style="color:#75715e"># 获取键值数据</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG GET databases  	<span style="color:#75715e"># 数据库的数量</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; INFO keyspace  	<span style="color:#75715e"># 使用以下命令列出定义了某些键的数据库</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; SELECT <span style="color:#ae81ff">14</span>  	<span style="color:#75715e"># 切换14db</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; info clients  	<span style="color:#75715e"># 查看客户端连接</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; client list  	<span style="color:#75715e"># 列出所有连接</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG GET maxclients  	<span style="color:#75715e"># 获取支持最大连接数</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; save  <span style="color:#75715e"># 收到触发rdb存储数据</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG SET appendonly yes  <span style="color:#75715e"># 动态配置</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; save
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; shutdown save <span style="color:#75715e"># 安全退出并存储数据</span>
</span></span><span style="display:flex;"><span>not connected&gt; </span></span></code></pre></div><p><a href="#R-image-ff75f4fd764c530dbdb98d17e7a1186a" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Redis_Server/Snipaste_2022-07-01_13-19-44.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ff75f4fd764c530dbdb98d17e7a1186a"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Redis_Server/Snipaste_2022-07-01_13-19-44.png"></a></p>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="../../../js/clipboard.min.js?1721405971" defer></script>
    <script src="../../../js/perfect-scrollbar.min.js?1721405971" defer></script>
    <script src="../../../js/theme.js?1721405971" defer></script>
  </body>
</html>
