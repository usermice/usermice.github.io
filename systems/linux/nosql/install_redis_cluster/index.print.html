<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="Redisé›†ç¾¤éƒ¨ç½² Redisä¸»ä»æ¨¡å¼ å•èŠ‚ç‚¹ä¸»ä»æ¨¡å¼éœ€è¦ä¿®æ”¹ç«¯å£ä»¥åŠé…ç½®æ–‡ä»¶ ä¸»èŠ‚ç‚¹redis.confé…ç½®æ–‡ä»¶ daemonize yes # redisåå°è¿è¡Œ pidfile /usr/local/redis/logs/redis_6379.pid # Redisçš„pidæ–‡ä»¶å­˜æ”¾ä½ç½® logfile /usr/local/redis/logs/redis_6379.">
    <meta name="author" content="äºŒå“¥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://usermice.github.io/images/s2-1.png">
    <meta name="twitter:title" content="Install_Redis_Cluster :: Hugo Relearn Theme">
    <meta name="twitter:description" content="Redisé›†ç¾¤éƒ¨ç½² Redisä¸»ä»æ¨¡å¼ å•èŠ‚ç‚¹ä¸»ä»æ¨¡å¼éœ€è¦ä¿®æ”¹ç«¯å£ä»¥åŠé…ç½®æ–‡ä»¶ ä¸»èŠ‚ç‚¹redis.confé…ç½®æ–‡ä»¶ daemonize yes # redisåå°è¿è¡Œ pidfile /usr/local/redis/logs/redis_6379.pid # Redisçš„pidæ–‡ä»¶å­˜æ”¾ä½ç½® logfile /usr/local/redis/logs/redis_6379.">
    <meta property="og:url" content="https://usermice.github.io/systems/linux/nosql/install_redis_cluster/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Install_Redis_Cluster :: Hugo Relearn Theme">
    <meta property="og:description" content="Redisé›†ç¾¤éƒ¨ç½² Redisä¸»ä»æ¨¡å¼ å•èŠ‚ç‚¹ä¸»ä»æ¨¡å¼éœ€è¦ä¿®æ”¹ç«¯å£ä»¥åŠé…ç½®æ–‡ä»¶ ä¸»èŠ‚ç‚¹redis.confé…ç½®æ–‡ä»¶ daemonize yes # redisåå°è¿è¡Œ pidfile /usr/local/redis/logs/redis_6379.pid # Redisçš„pidæ–‡ä»¶å­˜æ”¾ä½ç½® logfile /usr/local/redis/logs/redis_6379.">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Systems">
    <meta property="article:published_time" content="2024-06-21T15:40:06+08:00">
    <meta property="article:modified_time" content="2024-06-21T15:40:06+08:00">
    <meta property="og:image" content="https://usermice.github.io/images/s2-1.png">
    <meta itemprop="name" content="Install_Redis_Cluster :: Hugo Relearn Theme">
    <meta itemprop="description" content="Redisé›†ç¾¤éƒ¨ç½² Redisä¸»ä»æ¨¡å¼ å•èŠ‚ç‚¹ä¸»ä»æ¨¡å¼éœ€è¦ä¿®æ”¹ç«¯å£ä»¥åŠé…ç½®æ–‡ä»¶ ä¸»èŠ‚ç‚¹redis.confé…ç½®æ–‡ä»¶ daemonize yes # redisåå°è¿è¡Œ pidfile /usr/local/redis/logs/redis_6379.pid # Redisçš„pidæ–‡ä»¶å­˜æ”¾ä½ç½® logfile /usr/local/redis/logs/redis_6379.">
    <meta itemprop="datePublished" content="2024-06-21T15:40:06+08:00">
    <meta itemprop="dateModified" content="2024-06-21T15:40:06+08:00">
    <meta itemprop="wordCount" content="1135">
    <meta itemprop="image" content="https://usermice.github.io/images/s2-1.png">
    <title>Install_Redis_Cluster :: Hugo Relearn Theme</title>
    <link href="../../../../images/favicon.ico?1734019084" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../../css/fontawesome-all.min.css?1734019085" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/fontawesome-all.min.css?1734019085" rel="stylesheet"></noscript>
    <link href="../../../../css/nucleus.css?1734019085" rel="stylesheet">
    <link href="../../../../css/auto-complete.css?1734019085" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/auto-complete.css?1734019085" rel="stylesheet"></noscript>
    <link href="../../../../css/perfect-scrollbar.min.css?1734019085" rel="stylesheet">
    <link href="../../../../css/fonts.css?1734019085" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/fonts.css?1734019085" rel="stylesheet"></noscript>
    <link href="../../../../css/theme.css?1734019085" rel="stylesheet">
    <link href="../../../../css/theme-relearn-auto.css?1734019085" rel="stylesheet" id="R-variant-style">
    <link href="../../../../css/chroma-relearn-auto.css?1734019085" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../../css/variant.css?1734019085" rel="stylesheet">
    <link href="../../../../css/print.css?1734019085" rel="stylesheet" media="print">
    <link href="../../../../css/format-print.css?1734019085" rel="stylesheet">
    <script src="../../../../js/variant.js?1734019085"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/usermice.github.io';
      window.index_js_url="../../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../../systems/linux/nosql/install_redis_cluster/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/linux/nosql/"><span itemprop="name">Nosql</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Install_Redis_Cluster</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../../systems/linux/nosql/install_redis/" title="Install_Redis (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../../systems/linux/nosql/install_cassandra/" title="Install_Cassandra (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_redis_cluster">Install_Redis_Cluster</h1>

<h2 id="redisé›†ç¾¤éƒ¨ç½²"><code>Redis</code>é›†ç¾¤éƒ¨ç½²</h2>
<h3 id="redisä¸»ä»æ¨¡å¼"><code>Redis</code>ä¸»ä»æ¨¡å¼</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å•èŠ‚ç‚¹<!-- raw HTML omitted -->ä¸»ä»æ¨¡å¼éœ€è¦ä¿®æ”¹<!-- raw HTML omitted -->ç«¯å£<!-- raw HTML omitted -->ä»¥åŠé…ç½®æ–‡ä»¶</li>
<li><!-- raw HTML omitted -->ä¸»èŠ‚ç‚¹<!-- raw HTML omitted --><code>redis.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>daemonize yes  	<span style="color:#75715e"># redisåå°è¿è¡Œ</span>
</span></span><span style="display:flex;"><span>pidfile /usr/local/redis/logs/redis_6379.pid  	<span style="color:#75715e"># Redisçš„pidæ–‡ä»¶å­˜æ”¾ä½ç½®</span>
</span></span><span style="display:flex;"><span>logfile /usr/local/redis/logs/redis_6379.log  	<span style="color:#75715e"># Redisçš„æ—¥å¿—æ–‡ä»¶å­˜æ”¾ä½ç½®</span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">6379</span>  	<span style="color:#75715e"># ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>bind 192.168.176.131  	<span style="color:#75715e"># æœ€å¥½æ˜¯æœ¬æœºIP</span>
</span></span><span style="display:flex;"><span>timeout <span style="color:#ae81ff">300</span>  	<span style="color:#75715e"># è¶…æ—¶æ—¶é—´300ç§’                                        </span>
</span></span><span style="display:flex;"><span>databases <span style="color:#ae81ff">8</span>  	<span style="color:#75715e"># ç¼“å­˜åº“çš„ä¸ªæ•° </span>
</span></span><span style="display:flex;"><span>dbfilename dump-16379.db  	<span style="color:#75715e"># å°†æ•°æ®åº“è½¬å‚¨åˆ°çš„æ–‡ä»¶å</span>
</span></span><span style="display:flex;"><span>dir ./  	<span style="color:#75715e"># æ•°æ®å­˜æ”¾ç›®å½•</span>
</span></span><span style="display:flex;"><span>masterauth password  	<span style="color:#75715e"># ä¸»åº“å¯†ç </span>
</span></span><span style="display:flex;"><span>requirepass password  	<span style="color:#75715e"># ç™»å½•è¿æ¥å¯†ç </span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä»èŠ‚ç‚¹<!-- raw HTML omitted --><code>redis.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶ï¼Œç¬¬äºŒå°ä»èŠ‚ç‚¹ä¿®æ”¹ï¼š<!-- raw HTML omitted --><code>bind</code><!-- raw HTML omitted -->ä¸ºè‡ªå·±æœåŠ¡å™¨æœ¬èº«<!-- raw HTML omitted --><code>ip</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>daemonize yes  	<span style="color:#75715e"># redisåå°è¿è¡Œ</span>
</span></span><span style="display:flex;"><span>pidfile /usr/local/redis/logs/redis_6379.pid  	<span style="color:#75715e"># ä¸åŒå®ä¾‹ä¿®æ”¹ä¸ºå¯¹åº”pidæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>logfile /usr/local/redis/logs/redis_6379.log
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>bind 192.168.176.132
</span></span><span style="display:flex;"><span>timeout <span style="color:#ae81ff">300</span>
</span></span><span style="display:flex;"><span>databases <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>dbfilename dump-16379.db
</span></span><span style="display:flex;"><span>dir ./  	<span style="color:#75715e"># æ•°æ®å­˜æ”¾ç›®å½•</span>
</span></span><span style="display:flex;"><span>masterauth <span style="color:#ae81ff">123456</span>  	<span style="color:#75715e"># å¡«å†™ä¸»åº“å¯†ç </span>
</span></span><span style="display:flex;"><span>requirepass <span style="color:#ae81ff">123456</span>  	<span style="color:#75715e"># ç™»å½•è¿æ¥å¯†ç </span>
</span></span><span style="display:flex;"><span>slaveof 192.168.176.131 <span style="color:#ae81ff">6379</span>  	<span style="color:#75715e"># è¿æ¥çš„ä¸»åº“IPå’Œç«¯å£å·</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="redis-clusteræ¨¡å¼"><code>Redis Cluster</code>æ¨¡å¼</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é›†ç¾¤æ¨¡å¼æœ€å°‘6ä¸ªèŠ‚ç‚¹<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dir /usr/local/redis-cluster/data/redis-6379  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºå¯¹åº”å®ä¾‹æ•°æ®å­˜æ”¾ç›®å½•</span>
</span></span><span style="display:flex;"><span>pidfile /usr/local/redis-cluster/logs/redis_6379.pid  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºå¯¹åº”å®ä¾‹ï¼šPid</span>
</span></span><span style="display:flex;"><span>logfile /usr/local/redis-cluster/logs/redis_6379.log  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºå¯¹åº”å®ä¾‹ </span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">6379</span>  	<span style="color:#75715e"># ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>cluster-enabled yes  	<span style="color:#75715e"># å¼€å¯é›†ç¾¤æ¨¡å¼ï¼ŒæŠŠæ³¨é‡Š#å»æ‰</span>
</span></span><span style="display:flex;"><span>cluster-config-file /usr/local/redis-cluster/conf/redis_16379.conf  	<span style="color:#75715e"># ä¸åŒå®ä¾‹ä¿®æ”¹ä¸ºå¯¹åº”</span>
</span></span><span style="display:flex;"><span>cluster-node-timeout <span style="color:#ae81ff">10000</span>  	<span style="color:#75715e"># è¯·æ±‚è¶…æ—¶ï¼Œè®¾ç½®10ç§’</span>
</span></span><span style="display:flex;"><span>appendonly yes  	<span style="color:#75715e"># aofæ—¥å¿—å¼€å¯ï¼Œæœ‰éœ€è¦å°±å¼€å¯ï¼Œå®ƒä¼šæ¯æ¬¡å†™æ“ä½œéƒ½è®°å½•ä¸€æ¡æ—¥å¿—</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>Redis5.0</code><!-- raw HTML omitted -->ä»¥ä¸Šç‰ˆæœ¬ä½¿ç”¨<!-- raw HTML omitted --><code>Redis-cli</code><!-- raw HTML omitted -->å®¢æˆ·ç«¯éƒ¨ç½²<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->éƒ¨ç½²é›†ç¾¤éœ€è¦<!-- raw HTML omitted --><!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾é›†ç¾¤ç«¯å£<!-- raw HTML omitted --><!-- raw HTML omitted -->äº’é€šå¦‚ç«¯å£æ˜¯ï¼š<!-- raw HTML omitted --><code>6379</code> <!-- raw HTML omitted -->é›†ç¾¤ç«¯å£å°±æ˜¯ï¼š<!-- raw HTML omitted --><code>16379</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/apps/redis/bin/redis-cli -a password --cluster create --cluster-replicas <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> 192.168.213.128:6379 192.168.213.128:6380 192.168.213.128:6381 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> 192.168.213.129:6379 192.168.213.129:6380 192.168.213.129:6381</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è„šæœ¬éƒ¨ç½²<!-- raw HTML omitted --><code>Redis-Cluster</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;#!bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pkill redis-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd /opt/conf/redis-conf/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#39;</span>s/^#cluster-enabled/cluster-enabled/<span style="color:#e6db74">&#39; re_17693.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cat re_17693.conf |tee re_1769{4..5}.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">chown -R swadmin. *
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#34;s/17693/17694/g&#34; re_17694.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#34;s/17693/17695/g&#34; re_17695.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17693.conf &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17694.conf &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17695.conf &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --permanent --new-ipset=redis_whitelist --type=hash:ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --permanent --add-rich-rule &#39;</span>rule family<span style="color:#f92672">=</span>ipv4 source ipset<span style="color:#f92672">=</span>redis_whitelist port protocol<span style="color:#f92672">=</span>tcp port<span style="color:#f92672">=</span>27693-27695 accept<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --permanent --add-rich-rule &#39;</span>rule family<span style="color:#f92672">=</span>ipv4 source ipset<span style="color:#f92672">=</span>redis_whitelist port protocol<span style="color:#f92672">=</span>tcp port<span style="color:#f92672">=</span>17693-17695 accept<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">read -p &#34;è¯·è¾“å…¥å¯¹æ–¹æœåŠ¡å™¨IP:&#34; IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --permanent --ipset=redis_whitelist --add-entry=$IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --reload
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#echo &#39;</span>yes<span style="color:#e6db74">&#39; |/opt/apps/redis/bin/redis-cli -a \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9tN6GFGK60Jk8BNkBJM611GwA66uDFeG \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cluster create --cluster-replicas 1 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.213.128:17693  192.168.213.128:17694 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.213.128:17695  192.168.213.129:17693 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.213.129:17694  192.168.213.129:17695  #åˆ›å»ºé›†ç¾¤å‘½ä»¤æ ¹æ®IPå’Œç«¯å£ä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>&gt;redis-cluster.sh</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="dockeréƒ¨ç½²redisé›†ç¾¤"><code>docker</code>éƒ¨ç½²<code>Redis</code>é›†ç¾¤</h3>
<ul>
<li>
<ol>
<li><a href="https://www.jianshu.com/p/b7dea62bcd8b" rel="external" target="_self"><code>Docker</code>æ–¹å¼éƒ¨ç½²<code>redis-cluster</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;docker-install-redis-cluster.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#------------ bootstrap the cluster nodes --------------------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_cmd=&#39;redis-server --port 6379 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000 --appendonly yes --masterauth Redis --requirepass Redis&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">redis_image=&#39;redis:5.0-rc&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">network_name=&#39;redis_cluster_net&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker network create $network_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo $network_name &#34; created&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#---------- create the cluster ------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for port in `seq 6379 6384`; do \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker run -d --name &#34;redis-&#34;$port -p $port:6379 --net $network_name $redis_image $start_cmd;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;created redis cluster node redis-&#34;$port
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cluster_hosts=&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for port in `seq 6379 6384`; do \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hostip=`docker inspect -f &#39;{{(index .NetworkSettings.Networks &#34;redis_cluster_net&#34;).IPAddress}}&#39; &#34;redis-&#34;$port`;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;IP for cluster node redis-&#34;$port &#34;is&#34; $hostip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cluster_hosts=&#34;$cluster_hosts$hostip:6379 &#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;cluster hosts &#34;$cluster_hosts
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;creating cluster....&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#39;yes&#39; | docker run -i --rm --restart=always -v /etc/localtime:/etc/localtime --net $network_name $redis_image redis-cli  -a Redis --cluster create $cluster_hosts --cluster-replicas 1;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="redis-50ä»¥ä¸‹ç‰ˆæœ¬"><code>Redis 5.0</code>ä»¥ä¸‹ç‰ˆæœ¬</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.myfreax.com/how-to-install-ruby-on-centos-7/" rel="external" target="_self">å¦‚ä½•åœ¨<code>CentOS 7</code>ä¸Šå®‰è£…<code>Ruby</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.jianshu.com/p/e4847f3926d1" rel="external" target="_self"><code>CentOS 7</code>å®‰è£…<code>Ruby on Rails</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/xuliangxing/p/7132656.html" rel="external" target="_self"><code>Linux</code>å®‰è£…<code>Ruby</code>è¯¦è§£(åœ¨çº¿å’Œç¦»çº¿å®‰è£…)</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/tommy-huang/p/7279796.html" rel="external" target="_self"><code>CentOS 7</code>é€šè¿‡<code>RVM</code>æ¥å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„<code>Ruby</code></a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="å®‰è£…ruby">å®‰è£…<code>Ruby</code></h4>
<blockquote>
<ul>
<li><code>Redis 5.0</code>ä»¥ä¸‹ç‰ˆæœ¬ä½¿ç”¨<code>Ruby</code>æ–¹å¼å®‰è£…<code>Redis</code>é›†ç¾¤</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum install gcc-c++ patch readline readline-devel zlib zlib-devel libyaml-devel libffi-devel openssl-devel make bzip2 autoconf automake libtool bison iconv-devel -y   #å®‰è£…ä¾èµ–åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpg2 --keyserver hkp://keys.gnupg.net --recv-keys D39DC0E3    #å®‰è£…RVM
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">curl -sSL https://rvm.io/mpapis.asc | gpg2 --import -
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">curl -sSL https://rvm.io/pkuczynski.asc | gpg2 --import -
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">curl -L get.rvm.io | bash -s stable
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">source /etc/profile.d/rvm.sh    #è®¾å®šrvmç¯å¢ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm -v          #æŸ¥çœ‹æ˜¯å¦å®‰è£…æ­£å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm list known  #æŸ¥è¯¢å½“å‰Rubyçš„ç‰ˆæœ¬åˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm install 2.4.6   #å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Ruby
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ruby -v             #æµ‹è¯•æ˜¯å¦æˆåŠŸ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm use 2.4.6  --default     #åœ¨å®‰è£…å¤šä¸ªç‰ˆæœ¬rubyç¯å¢ƒä¸‹æŒ‡å®šé»˜è®¤ç‰ˆæœ¬ï¼šè¿™é‡Œè®²2.4.6 ä½œä¸ºé»˜è®¤rubyç‰ˆæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm system --default    #ä½¿ç”¨ä¼šç³»ç»Ÿé»˜è®¤ç‰ˆæœ¬Ruby
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gem install redis       å‡†å¤‡rubygem redisä¾èµ–
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span> &gt;install-ruby.sh</span></span></code></pre></div></blockquote>
<hr>
<h4 id="æ‹·è´redis-tribrbåˆ°é›†ç¾¤æ ¹ç›®å½•">æ‹·è´<code>redis-trib.rb</code>åˆ°é›†ç¾¤æ ¹ç›®å½•</h4>
<blockquote>
<ul>
<li><code>redis-trib.rb</code> æ˜¯<code>redis</code>å®˜æ–¹æ¨å‡ºçš„ç®¡ç†<code>redis</code>é›†ç¾¤ çš„å·¥å…·ï¼Œé›†æˆåœ¨<code>redis</code>çš„æºç <code>src</code>ç›®å½•ä¸‹ï¼Œå°†åŸºäº <code>redis</code>æä¾›çš„ é›†ç¾¤å‘½ä»¤ å°è£…æˆ ç®€å•ã€ä¾¿æ·ã€å®ç”¨ çš„ æ“ä½œå·¥å…·</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp /opt/apps/redis/src/redis-trib.rb /opt/apps/redis/</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>redis-trib.rb</code><!-- raw HTML omitted -->å‘½ä»¤ç¯å¢ƒæ˜¯å¦æ­£ç¡®ï¼Œè¾“å‡ºå¦‚ä¸‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./redis-trib.rb 
</span></span><span style="display:flex;"><span>Usage: redis-trib &lt;command&gt; &lt;options&gt; &lt;arguments ...&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  create          host1:port1 ... hostN:portN
</span></span><span style="display:flex;"><span>                  --replicas &lt;arg&gt;
</span></span><span style="display:flex;"><span>  check           host:port
</span></span><span style="display:flex;"><span>  info            host:port
</span></span><span style="display:flex;"><span>  fix             host:port
</span></span><span style="display:flex;"><span>                  --timeout &lt;arg&gt;
</span></span><span style="display:flex;"><span>  reshard         host:port
</span></span><span style="display:flex;"><span>                  --from &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --to &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --slots &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --yes
</span></span><span style="display:flex;"><span>                  --timeout &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --pipeline &lt;arg&gt;
</span></span><span style="display:flex;"><span>  rebalance       host:port
</span></span><span style="display:flex;"><span>                  --weight &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --auto-weights
</span></span><span style="display:flex;"><span>                  --use-empty-masters
</span></span><span style="display:flex;"><span>                  --timeout &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --simulate
</span></span><span style="display:flex;"><span>                  --pipeline &lt;arg&gt;</span></span></code></pre></div><ul>
<li><code>redis-trib.rb</code><!-- raw HTML omitted -->æ˜¯<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->ä½œè€…ç”¨<!-- raw HTML omitted --><code>ruby</code><!-- raw HTML omitted -->å®Œæˆçš„ã€‚<!-- raw HTML omitted --><code>redis-trib.rb</code><!-- raw HTML omitted -->å‘½ä»¤è¡Œå·¥å…· çš„å…·ä½“åŠŸèƒ½å¦‚ä¸‹:  <!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>create</code></td>
<td>åˆ›å»ºé›†ç¾¤</td>
</tr>
<tr>
<td><code>check</code></td>
<td>æ£€æŸ¥é›†ç¾¤</td>
</tr>
<tr>
<td><code>info</code></td>
<td>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</td>
</tr>
<tr>
<td><code>fix</code></td>
<td>ä¿®å¤é›†ç¾¤</td>
</tr>
<tr>
<td><code>reshard</code></td>
<td>åœ¨çº¿è¿ç§»<code>slot</code></td>
</tr>
<tr>
<td><code>rebalance</code></td>
<td>å¹³è¡¡é›†ç¾¤èŠ‚ç‚¹<code>slot</code>æ•°é‡</td>
</tr>
<tr>
<td><code>add-node</code></td>
<td>å°†æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</td>
</tr>
<tr>
<td><code>del-node</code></td>
<td>ä»é›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹</td>
</tr>
<tr>
<td><code>set-timeout</code></td>
<td>è®¾ç½®é›†ç¾¤èŠ‚ç‚¹é—´å¿ƒè·³è¿æ¥çš„è¶…æ—¶æ—¶é—´</td>
</tr>
<tr>
<td><code>call</code></td>
<td>åœ¨é›†ç¾¤å…¨éƒ¨èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤</td>
</tr>
<tr>
<td><code>import</code></td>
<td>å°†å¤–éƒ¨<code>redis</code>æ•°æ®å¯¼å…¥é›†ç¾¤</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->è¿è¡Œå‘½ä»¤å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17693.conf &amp;
</span></span><span style="display:flex;"><span>$ /opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17694.conf &amp;
</span></span><span style="display:flex;"><span>$ /opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17695.conf &amp;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åœ¨æ¯ä¸ª<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->èŠ‚ç‚¹çš„<!-- raw HTML omitted --><code>redis.conf</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬éƒ½é…ç½®äº†<!-- raw HTML omitted --><code>cluster-config-file</code><!-- raw HTML omitted -->çš„æ–‡ä»¶è·¯å¾„ï¼Œé›†ç¾¤å¯åŠ¨æ—¶<!-- raw HTML omitted --><code>conf</code><!-- raw HTML omitted -->ç›®å½•ä¼šæ–°ç”Ÿæˆ é›†ç¾¤ èŠ‚ç‚¹é…ç½®æ–‡ä»¶ã€‚æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨å¦‚ä¸‹ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install tree
</span></span><span style="display:flex;"><span>$ tree -L <span style="color:#ae81ff">3</span> .
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>â”œâ”€â”€ bin
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ redis-benchmark
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ redis-check-aof
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ redis-check-rdb
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ redis-cli
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ redis-sentinel -&gt; redis-server
</span></span><span style="display:flex;"><span>â”‚   â””â”€â”€ redis-server
</span></span><span style="display:flex;"><span>â”œâ”€â”€ nodes-6379.conf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ redis.conf
</span></span><span style="display:flex;"><span>â””â”€â”€ redis-trib.rb</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->é…ç½®å¯†ç <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /usr/local/rvm/gems/ruby-2.4.6/gems/redis-4.1.3/lib/redis/client.rb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># frozen_string_literal: true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>require_relative <span style="color:#e6db74">&#34;errors&#34;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#34;socket&#34;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#34;cgi&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>class Redis
</span></span><span style="display:flex;"><span>class Client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> DEFAULTS <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   :url <span style="color:#f92672">=</span>&gt; lambda <span style="color:#f92672">{</span> ENV<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;REDIS_URL&#34;</span><span style="color:#f92672">]</span> <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>   :scheme <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;redis&#34;</span>,
</span></span><span style="display:flex;"><span>   :host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
</span></span><span style="display:flex;"><span>   :port <span style="color:#f92672">=</span>&gt; 6379,
</span></span><span style="display:flex;"><span>   :path <span style="color:#f92672">=</span>&gt; nil,
</span></span><span style="display:flex;"><span>   :timeout <span style="color:#f92672">=</span>&gt; 5.0,
</span></span><span style="display:flex;"><span>   :password <span style="color:#f92672">=</span>&gt; Redis,  	<span style="color:#75715e"># é…ç½®å¯†ç </span>
</span></span><span style="display:flex;"><span>   :db <span style="color:#f92672">=</span>&gt; 0,
</span></span><span style="display:flex;"><span>   :driver <span style="color:#f92672">=</span>&gt; nil,
</span></span><span style="display:flex;"><span>   :id <span style="color:#f92672">=</span>&gt; nil,
</span></span><span style="display:flex;"><span>   :tcp_keepalive <span style="color:#f92672">=</span>&gt; 0,
</span></span><span style="display:flex;"><span>   :reconnect_attempts <span style="color:#f92672">=</span>&gt; 1,
</span></span><span style="display:flex;"><span>   :reconnect_delay <span style="color:#f92672">=</span>&gt; 0,
</span></span><span style="display:flex;"><span>   :reconnect_delay_max <span style="color:#f92672">=</span>&gt; 0.5,
</span></span><span style="display:flex;"><span>   :inherit_socket <span style="color:#f92672">=</span>&gt; false
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>redis-trib</code><!-- raw HTML omitted -->å…³è”é›†ç¾¤èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŒ‰ç…§ä»ä¸»åˆ°ä»çš„æ–¹å¼ä»å·¦åˆ°å³ä¾æ¬¡æ’åˆ— 6 ä¸ª<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->èŠ‚ç‚¹ï¼Œå¦‚æœä¸é€šä¸¤ä¸ªé—®é¢˜ï¼šå¯†ç ã€é˜²ç«å¢™<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;yes&#39;</span>|./redis-trib.rb create --replicas <span style="color:#ae81ff">1</span> 192.168.176.142:6379 192.168.176.143:6379 192.168.176.144:6379 192.168.176.145:6379 192.168.176.142:6380 192.168.176.143:6380 192.168.176.144:6380 192.168.176.145:6380  
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Creating cluster
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing hash slots allocation on <span style="color:#ae81ff">8</span> nodes...
</span></span><span style="display:flex;"><span>Using <span style="color:#ae81ff">4</span> masters:
</span></span><span style="display:flex;"><span>192.168.176.142:6379
</span></span><span style="display:flex;"><span>192.168.176.143:6379
</span></span><span style="display:flex;"><span>192.168.176.144:6379
</span></span><span style="display:flex;"><span>192.168.176.145:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.176.143:6380 to 192.168.176.142:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.176.142:6380 to 192.168.176.143:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.176.145:6380 to 192.168.176.144:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.176.144:6380 to 192.168.176.145:6379
</span></span><span style="display:flex;"><span>M: 157bd250dd382b95a9289d8b44fd2cfd466fea98 192.168.176.142:6379
</span></span><span style="display:flex;"><span>   slots:0-4095 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>M: c6df79e7c60c03921b69e4d4342507e8d4d2afbd 192.168.176.143:6379
</span></span><span style="display:flex;"><span>   slots:4096-8191 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>M: a463232f96c66cd7f27395253b65d0be8909656e 192.168.176.144:6379
</span></span><span style="display:flex;"><span>   slots:8192-12287 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>M: 44b244a188185835b42d4489eac614e7f81b4cf8 192.168.176.145:6379
</span></span><span style="display:flex;"><span>   slots:12288-16383 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>S: 1cafdeeb6cb52bb96dd16ac84d2242f59973f83a 192.168.176.142:6380
</span></span><span style="display:flex;"><span>   replicates c6df79e7c60c03921b69e4d4342507e8d4d2afbd
</span></span><span style="display:flex;"><span>S: a6d87fb995f3f5e98e2a09f4b5a3078f7221a257 192.168.176.143:6380
</span></span><span style="display:flex;"><span>   replicates 157bd250dd382b95a9289d8b44fd2cfd466fea98
</span></span><span style="display:flex;"><span>S: 31a3f0b03244d30bbc7e47acc0ec06d327b62860 192.168.176.144:6380
</span></span><span style="display:flex;"><span>   replicates 44b244a188185835b42d4489eac614e7f81b4cf8
</span></span><span style="display:flex;"><span>S: fc22025eb5db7cc0d55fe7dc11a3c368daa468bb 192.168.176.145:6380
</span></span><span style="display:flex;"><span>   replicates a463232f96c66cd7f27395253b65d0be8909656e
</span></span><span style="display:flex;"><span>Can I set the above configuration? <span style="color:#f92672">(</span>type <span style="color:#e6db74">&#39;yes&#39;</span> to accept<span style="color:#f92672">)</span>: yes     <span style="color:#75715e">#æ­¤å¤„è¾“å…¥ï¼šyesã€ç„¶åredis-trib.rb å¼€å§‹æ‰§è¡Œ èŠ‚ç‚¹æ¡æ‰‹ å’Œ æ§½åˆ†é… æ“ä½œï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Nodes configuration updated
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Assign a different config epoch to each node
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> the cluster to join....
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check <span style="color:#f92672">(</span>using node 192.168.176.142:6379<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 157bd250dd382b95a9289d8b44fd2cfd466fea98 192.168.176.142:6379
</span></span><span style="display:flex;"><span>   slots:0-4095 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: 31a3f0b03244d30bbc7e47acc0ec06d327b62860 192.168.176.144:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 44b244a188185835b42d4489eac614e7f81b4cf8
</span></span><span style="display:flex;"><span>M: a463232f96c66cd7f27395253b65d0be8909656e 192.168.176.144:6379
</span></span><span style="display:flex;"><span>   slots:8192-12287 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 44b244a188185835b42d4489eac614e7f81b4cf8 192.168.176.145:6379
</span></span><span style="display:flex;"><span>   slots:12288-16383 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: fc22025eb5db7cc0d55fe7dc11a3c368daa468bb 192.168.176.145:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates a463232f96c66cd7f27395253b65d0be8909656e
</span></span><span style="display:flex;"><span>M: c6df79e7c60c03921b69e4d4342507e8d4d2afbd 192.168.176.143:6379
</span></span><span style="display:flex;"><span>   slots:4096-8191 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: a6d87fb995f3f5e98e2a09f4b5a3078f7221a257 192.168.176.143:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 157bd250dd382b95a9289d8b44fd2cfd466fea98
</span></span><span style="display:flex;"><span>S: 1cafdeeb6cb52bb96dd16ac84d2242f59973f83a 192.168.176.142:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates c6df79e7c60c03921b69e4d4342507e8d4d2afbd
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check <span style="color:#66d9ef">for</span> open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All <span style="color:#ae81ff">16384</span> slots covered.</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>redis</code><!-- raw HTML omitted -->é›†ç¾¤å®Œæ•´æ€§æ£€<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<code>redis-trib.rb check</code>å‘½ä»¤æ£€æµ‹ä¹‹å‰åˆ›å»ºçš„ ä¸¤ä¸ªé›†ç¾¤ æ˜¯å¦æˆåŠŸï¼Œ<code>check</code>å‘½ä»¤åªéœ€è¦ç»™å‡ºé›†ç¾¤ä¸­ ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹åœ°å€ å°±å¯ä»¥å®Œæˆ æ•´ä¸ªé›†ç¾¤ çš„ æ£€æŸ¥å·¥ä½œï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./redis-trib.rb check 192.168.176.145:6379 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check <span style="color:#f92672">(</span>using node 192.168.176.142:6379<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 157bd250dd382b95a9289d8b44fd2cfd466fea98 192.168.176.142:6379
</span></span><span style="display:flex;"><span>   slots:0-4095 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: 31a3f0b03244d30bbc7e47acc0ec06d327b62860 192.168.176.144:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 44b244a188185835b42d4489eac614e7f81b4cf8
</span></span><span style="display:flex;"><span>M: a463232f96c66cd7f27395253b65d0be8909656e 192.168.176.144:6379
</span></span><span style="display:flex;"><span>   slots:8192-12287 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 44b244a188185835b42d4489eac614e7f81b4cf8 192.168.176.145:6379
</span></span><span style="display:flex;"><span>   slots:12288-16383 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: fc22025eb5db7cc0d55fe7dc11a3c368daa468bb 192.168.176.145:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates a463232f96c66cd7f27395253b65d0be8909656e
</span></span><span style="display:flex;"><span>M: c6df79e7c60c03921b69e4d4342507e8d4d2afbd 192.168.176.143:6379
</span></span><span style="display:flex;"><span>   slots:4096-8191 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: a6d87fb995f3f5e98e2a09f4b5a3078f7221a257 192.168.176.143:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 157bd250dd382b95a9289d8b44fd2cfd466fea98
</span></span><span style="display:flex;"><span>S: 1cafdeeb6cb52bb96dd16ac84d2242f59973f83a 192.168.176.142:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates c6df79e7c60c03921b69e4d4342507e8d4d2afbd
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check <span style="color:#66d9ef">for</span> open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All <span style="color:#ae81ff">16384</span> slots covered.</span></span></code></pre></div></blockquote>
<hr>
<h3 id="redis-sentinelæ¨¡å¼"><code>Redis Sentinel</code>æ¨¡å¼</h3>
<blockquote>
<ul>
<li><code>Redis Sentinel</code>å“¨å…µæ¨¡å¼</li>
<li><!-- raw HTML omitted -->èŠ‚ç‚¹-1<!-- raw HTML omitted --><code>sentinel_16380.conf</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>protected-mode no
</span></span><span style="display:flex;"><span>bind 192.168.176.131  	<span style="color:#75715e"># æœ¬æœºIP</span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">16380</span>
</span></span><span style="display:flex;"><span>daemonize yes
</span></span><span style="display:flex;"><span>sentinel monitor master 192.168.176.131 <span style="color:#ae81ff">6379</span> <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># ä¸»IPä¸ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>sentinel down-after-milliseconds master <span style="color:#ae81ff">5000</span>  	<span style="color:#75715e"># æŒ‡å®šä¸»èŠ‚ç‚¹åº”ç­”å“¨å…µsentinelçš„æœ€å¤§æ—¶é—´é—´éš”ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå“¨å…µä¸»è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼Œé»˜è®¤30ç§’</span>
</span></span><span style="display:flex;"><span>sentinel failover-timeout master <span style="color:#ae81ff">180000</span>  	<span style="color:#75715e"># æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´failover-timeoutï¼Œé»˜è®¤ä¸‰åˆ†é’Ÿï¼Œå¯ä»¥ç”¨åœ¨ä»¥ä¸‹è¿™äº›æ–¹é¢</span>
</span></span><span style="display:flex;"><span>sentinel parallel-syncs master <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æŒ‡å®šäº†åœ¨å‘ç”Ÿfailoverä¸»å¤‡åˆ‡æ¢æ—¶ï¼Œæœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªslaveåŒæ—¶å¯¹æ–°çš„masterè¿›è¡ŒåŒæ­¥ã€‚è¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆfailoveræ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ï¼›åä¹‹ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œå°±æ„å‘³ç€è¶Šå¤šçš„slaveå› ä¸ºreplicationè€Œä¸å¯ç”¨ã€‚å¯ä»¥é€šè¿‡å°†è¿™ä¸ªå€¼è®¾ä¸º1ï¼Œæ¥ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªslaveï¼Œå¤„äºä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚</span>
</span></span><span style="display:flex;"><span>sentinel auth-pass master <span style="color:#ae81ff">123456</span>  	<span style="color:#75715e"># å½“åœ¨Rediså®ä¾‹ä¸­å¼€å¯äº†requirepass &lt;foobared&gt;ï¼Œæ‰€æœ‰è¿æ¥Rediså®ä¾‹çš„å®¢æˆ·ç«¯éƒ½è¦æä¾›å¯†ç </span>
</span></span><span style="display:flex;"><span>logfile /var/log/redis/sentinel_16380.log</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->èŠ‚ç‚¹2~3<!-- raw HTML omitted --><code>centinel_16380.conf </code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>protected-mode no
</span></span><span style="display:flex;"><span>bind 192.168.176.132  	<span style="color:#75715e"># æ­¤å¤„ä¿®æ”¹ä¸ºæœ¬æœºIP</span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">16380</span>
</span></span><span style="display:flex;"><span>daemonize yes
</span></span><span style="display:flex;"><span>sentinel monitor master 192.168.176.131 <span style="color:#ae81ff">6379</span> <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># ä¸»IPä¸ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>sentinel down-after-milliseconds master <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>sentinel failover-timeout master <span style="color:#ae81ff">180000</span>
</span></span><span style="display:flex;"><span>sentinel parallel-syncs master <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>sentinel auth-pass master <span style="color:#ae81ff">123456</span>
</span></span><span style="display:flex;"><span>logfile /var/log/redis/sentinel_16380.log</span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

        </div>
      </main>
    </div>
    <script src="../../../../js/clipboard.min.js?1734019085" defer></script>
    <script src="../../../../js/perfect-scrollbar.min.js?1734019085" defer></script>
    <script src="../../../../js/theme.js?1734019085" defer></script>
  </body>
</html>
