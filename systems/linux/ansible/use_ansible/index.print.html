<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="使用Ansible 地址 名称 简介 ansible总结 — —- Ansible指南 —- —- 关于become属性 —- —- Ansible剧本的语法 —- —- Ansible的内置模块列表 —- —- Ansible批量自动化管理工具roles标准化 —- — ansible-playbook调用zabbix-api自动添加主机 —- —- Ansible批量安装zabbix-agent并使用zabbix自动添加主机 —- —- 选项 描述 详解 -a MODULE_ARGS, --args=MODULE_ARGS 模块参数 -C, --check、 运行检查，不执行任何操作 -e EXTRA_VARS, --extra-vars=EXTRA_VARS 设置附加变量key=value -f FORKS, --forks=FORKS 指定并行进程数量，默认5 -i INVENTORY, --inventory=INVENTORY 指定主机清单文件路径 --list-hosts 输出匹配的主机列表，不执行任何操作 -m MODULE_NAME, --module-name=MODULE_NAME 执行的模块名，默认command -o 简洁输出法 --syntax-check 语法检查playbook文件，不执行任何操作 -t TREE, --tree=TREE 将日志输出到此目录 -v, --verbose 详细信息：-vvv，更多：-vvvv debug --version 查看程序版本 连接选项 控制谁连接主机和如何连接 详解 -k, --ask-pass 请求连接密码 --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE 私钥文件 -u REMOTE_USER，--user=REMOTE_USER 连接用户，默认None -T TIMEOUT，--timeout=TIMEOUT 覆盖连接超时时间，默认10秒 提权选项 控制在目标主机以什么用户身份运行 详解 -b, --become 以另一个用户身份操作 --become-method=BECOME_METHOD 提权方法，默认sudo --become-user=BECOME_USER 提权后的用户身份，默认root -K, --ask-become-pass 提权密码 配置文件指令 描述 详解 ansible_ssh_host 指定主机别名对应的真实IP ansible_ssh_port 指定连接到这个主机的ssh端口，默认22 ansible_ssh_user 连接到该主机的ssh用户 ansible_ssh_pass 连接到该主机的ssh密码(连-k选项都省了)，安全考虑还是建议使用私钥或在命令行指定-k选项输入 ansible_sudo_pass sudo密码 ansible_sudo_exe(v1.">
    <meta name="author" content="二哥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://usermice.github.io/images/s2-1.png">
    <meta name="twitter:title" content="Use_Ansible :: Hugo Relearn Theme">
    <meta name="twitter:description" content="使用Ansible 地址 名称 简介 ansible总结 — —- Ansible指南 —- —- 关于become属性 —- —- Ansible剧本的语法 —- —- Ansible的内置模块列表 —- —- Ansible批量自动化管理工具roles标准化 —- — ansible-playbook调用zabbix-api自动添加主机 —- —- Ansible批量安装zabbix-agent并使用zabbix自动添加主机 —- —- 选项 描述 详解 -a MODULE_ARGS, --args=MODULE_ARGS 模块参数 -C, --check、 运行检查，不执行任何操作 -e EXTRA_VARS, --extra-vars=EXTRA_VARS 设置附加变量key=value -f FORKS, --forks=FORKS 指定并行进程数量，默认5 -i INVENTORY, --inventory=INVENTORY 指定主机清单文件路径 --list-hosts 输出匹配的主机列表，不执行任何操作 -m MODULE_NAME, --module-name=MODULE_NAME 执行的模块名，默认command -o 简洁输出法 --syntax-check 语法检查playbook文件，不执行任何操作 -t TREE, --tree=TREE 将日志输出到此目录 -v, --verbose 详细信息：-vvv，更多：-vvvv debug --version 查看程序版本 连接选项 控制谁连接主机和如何连接 详解 -k, --ask-pass 请求连接密码 --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE 私钥文件 -u REMOTE_USER，--user=REMOTE_USER 连接用户，默认None -T TIMEOUT，--timeout=TIMEOUT 覆盖连接超时时间，默认10秒 提权选项 控制在目标主机以什么用户身份运行 详解 -b, --become 以另一个用户身份操作 --become-method=BECOME_METHOD 提权方法，默认sudo --become-user=BECOME_USER 提权后的用户身份，默认root -K, --ask-become-pass 提权密码 配置文件指令 描述 详解 ansible_ssh_host 指定主机别名对应的真实IP ansible_ssh_port 指定连接到这个主机的ssh端口，默认22 ansible_ssh_user 连接到该主机的ssh用户 ansible_ssh_pass 连接到该主机的ssh密码(连-k选项都省了)，安全考虑还是建议使用私钥或在命令行指定-k选项输入 ansible_sudo_pass sudo密码 ansible_sudo_exe(v1.">
    <meta property="og:url" content="https://usermice.github.io/systems/linux/ansible/use_ansible/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Use_Ansible :: Hugo Relearn Theme">
    <meta property="og:description" content="使用Ansible 地址 名称 简介 ansible总结 — —- Ansible指南 —- —- 关于become属性 —- —- Ansible剧本的语法 —- —- Ansible的内置模块列表 —- —- Ansible批量自动化管理工具roles标准化 —- — ansible-playbook调用zabbix-api自动添加主机 —- —- Ansible批量安装zabbix-agent并使用zabbix自动添加主机 —- —- 选项 描述 详解 -a MODULE_ARGS, --args=MODULE_ARGS 模块参数 -C, --check、 运行检查，不执行任何操作 -e EXTRA_VARS, --extra-vars=EXTRA_VARS 设置附加变量key=value -f FORKS, --forks=FORKS 指定并行进程数量，默认5 -i INVENTORY, --inventory=INVENTORY 指定主机清单文件路径 --list-hosts 输出匹配的主机列表，不执行任何操作 -m MODULE_NAME, --module-name=MODULE_NAME 执行的模块名，默认command -o 简洁输出法 --syntax-check 语法检查playbook文件，不执行任何操作 -t TREE, --tree=TREE 将日志输出到此目录 -v, --verbose 详细信息：-vvv，更多：-vvvv debug --version 查看程序版本 连接选项 控制谁连接主机和如何连接 详解 -k, --ask-pass 请求连接密码 --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE 私钥文件 -u REMOTE_USER，--user=REMOTE_USER 连接用户，默认None -T TIMEOUT，--timeout=TIMEOUT 覆盖连接超时时间，默认10秒 提权选项 控制在目标主机以什么用户身份运行 详解 -b, --become 以另一个用户身份操作 --become-method=BECOME_METHOD 提权方法，默认sudo --become-user=BECOME_USER 提权后的用户身份，默认root -K, --ask-become-pass 提权密码 配置文件指令 描述 详解 ansible_ssh_host 指定主机别名对应的真实IP ansible_ssh_port 指定连接到这个主机的ssh端口，默认22 ansible_ssh_user 连接到该主机的ssh用户 ansible_ssh_pass 连接到该主机的ssh密码(连-k选项都省了)，安全考虑还是建议使用私钥或在命令行指定-k选项输入 ansible_sudo_pass sudo密码 ansible_sudo_exe(v1.">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Systems">
    <meta property="article:published_time" content="2024-06-17T18:28:10+08:00">
    <meta property="article:modified_time" content="2024-06-17T18:28:10+08:00">
    <meta property="og:image" content="https://usermice.github.io/images/s2-1.png">
    <meta itemprop="name" content="Use_Ansible :: Hugo Relearn Theme">
    <meta itemprop="description" content="使用Ansible 地址 名称 简介 ansible总结 — —- Ansible指南 —- —- 关于become属性 —- —- Ansible剧本的语法 —- —- Ansible的内置模块列表 —- —- Ansible批量自动化管理工具roles标准化 —- — ansible-playbook调用zabbix-api自动添加主机 —- —- Ansible批量安装zabbix-agent并使用zabbix自动添加主机 —- —- 选项 描述 详解 -a MODULE_ARGS, --args=MODULE_ARGS 模块参数 -C, --check、 运行检查，不执行任何操作 -e EXTRA_VARS, --extra-vars=EXTRA_VARS 设置附加变量key=value -f FORKS, --forks=FORKS 指定并行进程数量，默认5 -i INVENTORY, --inventory=INVENTORY 指定主机清单文件路径 --list-hosts 输出匹配的主机列表，不执行任何操作 -m MODULE_NAME, --module-name=MODULE_NAME 执行的模块名，默认command -o 简洁输出法 --syntax-check 语法检查playbook文件，不执行任何操作 -t TREE, --tree=TREE 将日志输出到此目录 -v, --verbose 详细信息：-vvv，更多：-vvvv debug --version 查看程序版本 连接选项 控制谁连接主机和如何连接 详解 -k, --ask-pass 请求连接密码 --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE 私钥文件 -u REMOTE_USER，--user=REMOTE_USER 连接用户，默认None -T TIMEOUT，--timeout=TIMEOUT 覆盖连接超时时间，默认10秒 提权选项 控制在目标主机以什么用户身份运行 详解 -b, --become 以另一个用户身份操作 --become-method=BECOME_METHOD 提权方法，默认sudo --become-user=BECOME_USER 提权后的用户身份，默认root -K, --ask-become-pass 提权密码 配置文件指令 描述 详解 ansible_ssh_host 指定主机别名对应的真实IP ansible_ssh_port 指定连接到这个主机的ssh端口，默认22 ansible_ssh_user 连接到该主机的ssh用户 ansible_ssh_pass 连接到该主机的ssh密码(连-k选项都省了)，安全考虑还是建议使用私钥或在命令行指定-k选项输入 ansible_sudo_pass sudo密码 ansible_sudo_exe(v1.">
    <meta itemprop="datePublished" content="2024-06-17T18:28:10+08:00">
    <meta itemprop="dateModified" content="2024-06-17T18:28:10+08:00">
    <meta itemprop="wordCount" content="2165">
    <meta itemprop="image" content="https://usermice.github.io/images/s2-1.png">
    <title>Use_Ansible :: Hugo Relearn Theme</title>
    <link href="../../../../images/favicon.ico?1734019084" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../../css/fontawesome-all.min.css?1734019085" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/fontawesome-all.min.css?1734019085" rel="stylesheet"></noscript>
    <link href="../../../../css/nucleus.css?1734019085" rel="stylesheet">
    <link href="../../../../css/auto-complete.css?1734019085" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/auto-complete.css?1734019085" rel="stylesheet"></noscript>
    <link href="../../../../css/perfect-scrollbar.min.css?1734019085" rel="stylesheet">
    <link href="../../../../css/fonts.css?1734019085" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/fonts.css?1734019085" rel="stylesheet"></noscript>
    <link href="../../../../css/theme.css?1734019085" rel="stylesheet">
    <link href="../../../../css/theme-relearn-auto.css?1734019085" rel="stylesheet" id="R-variant-style">
    <link href="../../../../css/chroma-relearn-auto.css?1734019085" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../../css/variant.css?1734019085" rel="stylesheet">
    <link href="../../../../css/print.css?1734019085" rel="stylesheet" media="print">
    <link href="../../../../css/format-print.css?1734019085" rel="stylesheet">
    <script src="../../../../js/variant.js?1734019085"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/usermice.github.io';
      window.index_js_url="../../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../../systems/linux/ansible/use_ansible/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/linux/ansible/"><span itemprop="name">Ansible</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Use_Ansible</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../../systems/linux/ansible/use_slatstack/" title="Use_Slatstack (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../../systems/linux/ansible/install_slatstack/" title="Install_Slatstack (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_ansible">Use_Ansible</h1>

<h2 id="使用ansible">使用<code>Ansible</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>地址</th>
<th>名称</th>
<th>简介</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.jianshu.com/p/7c4c47aa6b5a" rel="external" target="_self"><code>ansible</code>总结</a></td>
<td>&mdash;</td>
<td>&mdash;-</td>
</tr>
<tr>
<td><a href="https://www.kancloud.cn/louis1986/ansible/587918" rel="external" target="_self"><code>Ansible</code>指南</a></td>
<td>&mdash;-</td>
<td>&mdash;-</td>
</tr>
<tr>
<td><a href="http://docs.ansible.com/ansible/latest/become.html" rel="external" target="_self">关于<code>become</code>属性</a></td>
<td>&mdash;-</td>
<td>&mdash;-</td>
</tr>
<tr>
<td><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html" rel="external" target="_self"><code>Ansible</code>剧本的语法</a></td>
<td>&mdash;-</td>
<td>&mdash;-</td>
</tr>
<tr>
<td><a href="http://docs.ansible.com/ansible/latest/list_of_all_modules.html" rel="external" target="_self"><code>Ansible</code>的内置模块列表</a></td>
<td>&mdash;-</td>
<td>&mdash;-</td>
</tr>
<tr>
<td><a href="https://juejin.im/entry/5ba6e5e4e51d450e51628272" rel="external" target="_self"><code>Ansible</code>批量自动化管理工具<code>roles</code>标准化</a></td>
<td>&mdash;-</td>
<td>&mdash;</td>
</tr>
<tr>
<td><a href="https://blog.csdn.net/wh211212/article/details/82763493" rel="external" target="_self"><code>ansible-playbook</code>调用<code>zabbix-api</code>自动添加主机</a></td>
<td>&mdash;-</td>
<td>&mdash;-</td>
</tr>
<tr>
<td><a href="https://blog.csdn.net/wu2700222/article/details/80816988" rel="external" target="_self"><code>Ansible</code>批量安装<code>zabbix-agent</code>并使用<code>zabbix</code>自动添加主机</a></td>
<td>&mdash;-</td>
<td>&mdash;-</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>选项</strong></th>
<th><strong>描述</strong></th>
<th>详解</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-a MODULE_ARGS</code>, <!-- raw HTML omitted -->  <code>--args=MODULE_ARGS</code></td>
<td>模块参数</td>
<td></td>
</tr>
<tr>
<td><code>-C</code>, <code>--check</code>、</td>
<td>运行检查，不执行任何操作</td>
<td></td>
</tr>
<tr>
<td><code>-e EXTRA_VARS</code>, <!-- raw HTML omitted --> <code>--extra-vars=EXTRA_VARS</code></td>
<td>设置附加变量<code>key=value</code></td>
<td></td>
</tr>
<tr>
<td><code>-f FORKS</code>, <code>--forks=FORKS</code></td>
<td>指定并行进程数量，默认5</td>
<td></td>
</tr>
<tr>
<td><code>-i INVENTORY</code>,<!-- raw HTML omitted --> <code>--inventory=INVENTORY</code></td>
<td>指定主机清单文件路径</td>
<td></td>
</tr>
<tr>
<td><code>--list-hosts</code></td>
<td>输出匹配的主机列表，不执行任何操作</td>
<td></td>
</tr>
<tr>
<td><code>-m MODULE_NAME</code>,<!-- raw HTML omitted --> <code>--module-name=MODULE_NAME</code></td>
<td>执行的模块名，默认<code>command</code></td>
<td></td>
</tr>
<tr>
<td><code>-o</code></td>
<td>简洁输出法</td>
<td></td>
</tr>
<tr>
<td><code>--syntax-check</code></td>
<td>语法检查<code>playbook</code>文件，不执行任何操作</td>
<td></td>
</tr>
<tr>
<td><code>-t TREE</code>, <code>--tree=TREE</code></td>
<td>将日志输出到此目录</td>
<td></td>
</tr>
<tr>
<td><code>-v</code>, <code>--verbose</code></td>
<td>详细信息：<code>-vvv</code>，更多：<code>-vvvv debug</code></td>
<td></td>
</tr>
<tr>
<td><code>--version</code></td>
<td>查看程序版本</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>连接选项</strong></th>
<th><strong>控制谁连接主机和如何连接</strong></th>
<th>详解</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-k, --ask-pass</code></td>
<td>请求连接密码</td>
<td></td>
</tr>
<tr>
<td><code>--private-key=PRIVATE_KEY_FILE</code>, <!-- raw HTML omitted --><code>--key-file=PRIVATE_KEY_FILE</code></td>
<td>私钥文件</td>
<td></td>
</tr>
<tr>
<td><code>-u REMOTE_USER</code>，<!-- raw HTML omitted --><code>--user=REMOTE_USER</code></td>
<td>连接用户，默认<code>None</code></td>
<td></td>
</tr>
<tr>
<td><code>-T TIMEOUT</code>，<!-- raw HTML omitted --><code>--timeout=TIMEOUT</code></td>
<td>覆盖连接超时时间，默认10秒</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>提权选项</strong></th>
<th><strong>控制在目标主机以什么用户身份运行</strong></th>
<th>详解</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-b, --become</code></td>
<td>以另一个用户身份操作</td>
<td></td>
</tr>
<tr>
<td><code>--become-method=BECOME_METHOD</code></td>
<td>提权方法，默认<code>sudo</code></td>
<td></td>
</tr>
<tr>
<td><code>--become-user=BECOME_USER</code></td>
<td>提权后的用户身份，默认<code>root</code></td>
<td></td>
</tr>
<tr>
<td><code>-K, --ask-become-pass</code></td>
<td>提权密码</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>配置文件指令</strong></th>
<th><strong>描述</strong></th>
<th>详解</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ansible_ssh_host</code></td>
<td>指定主机别名对应的真实<code>IP</code></td>
<td></td>
</tr>
<tr>
<td><code>ansible_ssh_port</code></td>
<td>指定连接到这个主机的<code>ssh</code>端口，默认<code>22</code></td>
<td></td>
</tr>
<tr>
<td><code>ansible_ssh_user</code></td>
<td>连接到该主机的<code>ssh</code>用户</td>
<td></td>
</tr>
<tr>
<td><code>ansible_ssh_pass</code></td>
<td>连接到该主机的<code>ssh</code>密码(连<code>-k</code>选项都省了)，安全考虑还是建议使用私钥或在命令行指定<code>-k</code>选项输入</td>
<td></td>
</tr>
<tr>
<td><code>ansible_sudo_pass</code></td>
<td><code>sudo</code>密码</td>
<td></td>
</tr>
<tr>
<td><code>ansible_sudo_exe</code>(<code>v1.8+</code>的新特性)</td>
<td><code>sudo</code>命令路径</td>
<td></td>
</tr>
<tr>
<td><code>ansible_ssh_private_key_file</code></td>
<td>私钥文件路径</td>
<td></td>
</tr>
<tr>
<td><code>ansible_nodename</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ansible_connection</code></td>
<td>连接类型，可以是<code>local</code>、<code>ssh</code>或<code>paramiko</code>，<code>ansible1.2</code>之前默认为<code>paramiko</code></td>
<td></td>
</tr>
<tr>
<td><code>ansible_os_family</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ansible_pkg_mgr</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ansible_shell_type</code></td>
<td>目标系统的<code>shell</code>类型，默认为<code>sh</code>,如果设置<code>csh/fish</code>，那么命令需要遵循它们语法</td>
<td></td>
</tr>
<tr>
<td><code>ansible_processor</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ansible_processor_cores</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ansible_python_interpreter</code></td>
<td><code>python</code>解释器路径，默认是<code>/usr/bin/python</code>，但是如要要连<code>*BSD</code>系统的话，就需要该指令修改<code>python</code>路径</td>
<td></td>
</tr>
<tr>
<td><code>ansible_*_interpreter</code></td>
<td>这里的<code>*</code>可以是<code>ruby</code>或<code>perl</code>或其他语言的解释器，作用和<code>ansible_python_interpreter</code>类似</td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="主配置文件">主配置文件</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted -->主机名<!-- raw HTML omitted -->不能使用<!-- raw HTML omitted -->下划线<!-- raw HTML omitted --><!-- raw HTML omitted --><code>_</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/ansible/ansible.cfg<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[defaults] 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">inventory      = /etc/ansible/hosts
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># library        = /usr/share/my_modules/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># module_utils   = /usr/share/my_module_utils/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># remote_tmp     = ~/.ansible/tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># local_tmp      = ~/.ansible/tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># plugin_filters_cfg = /etc/ansible/plugin_filters.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">forks          = 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># poll_interval  = 15
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sudo_user      = root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ask_sudo_pass = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ask_pass      = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># transport      = smart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">remote_port    = 22
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># module_lang    = C
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># module_set_locale = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">become = root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host_key_checking = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">timeout = 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log_path = /var/log/ansible.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">private_key_file = /root/.ssh/id_rsa
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># gathering = implicit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># gather_subset = all
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># gather_timeout = 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># inject_facts_as_vars = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># remote_user = root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># roles_path    = /etc/ansible/roles
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># module_name = command
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># uncomment this to disable SSH key host checking
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host_key_checking = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># executable = /bin/sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># stdout_callback = skippy  	# 修改为 json
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># callback_whitelist = timer, mail  # timer：计算整个playbook运行时间
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># task_includes_static = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># handler_includes_static = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># error_on_missing_handler = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sudo_exe = sudo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sudo_flags = -H -S -n
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># hash_behaviour = replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># private_role_vars = yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># jinja2_extensions = jinja2.ext.do,jinja2.ext.i18n
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># private_key_file = /path/to/file
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># vault_password_file = /path/to/vault_password_file
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ansible_managed = Ansible managed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># display_skipped_hosts = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># display_args_to_stdout = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># error_on_undefined_vars = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># system_warnings = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># deprecation_warnings = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># command_warnings = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># set plugin path directories here, separate with colons
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># action_plugins     = /usr/share/ansible/plugins/action
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># become_plugins     = /usr/share/ansible/plugins/become
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cache_plugins      = /usr/share/ansible/plugins/cache
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># callback_plugins   = /usr/share/ansible/plugins/callback
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># connection_plugins = /usr/share/ansible/plugins/connection
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># lookup_plugins     = /usr/share/ansible/plugins/lookup
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># inventory_plugins  = /usr/share/ansible/plugins/inventory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># vars_plugins       = /usr/share/ansible/plugins/vars
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># filter_plugins     = /usr/share/ansible/plugins/filter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># test_plugins       = /usr/share/ansible/plugins/test
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># terminal_plugins   = /usr/share/ansible/plugins/terminal
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># strategy_plugins   = /usr/share/ansible/plugins/strategy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># strategy = free
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># bin_ansible_callbacks = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nocows = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cow_selection = default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cow_selection = random
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cow_whitelist=bud-frogs,bunny,cheese,daemon,default,dragon,elephant-in-snake,elephant,eyes,\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#              hellokitty,kitty,luke-koala,meow,milk,moofasa,moose,ren,sheep,small,stegosaurus,\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#              stimpy,supermilker,three-eyes,turkey,turtle,tux,udder,vader-koala,vader,www
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nocolor = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># fact_caching = memory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># For the redis plugin, the value is a host:port:database triplet: fact_caching_connection = localhost:6379:0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># fact_caching_connection=/tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># retry_files_enabled = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># retry_files_save_path = ~/.ansible-retry
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># squash_actions = apk,apt,dnf,homebrew,pacman,pkgng,yum,zypper
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># no_log = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># no_target_syslog = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># allow_world_readable_tmpfiles = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># var_compression_level = 9
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># module_compression = &#39;ZIP_DEFLATED&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># max_diff_size = 1048576
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># merge_multiple_cli_flags = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># show_custom_stats = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># inventory_ignore_extensions = ~, .orig, .bak, .ini, .cfg, .retry, .pyc, .pyo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># network_group_modules=eos, nxos, ios, iosxr, junos, vyos
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># allow_unsafe_lookups = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># any_errors_fatal = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[inventory]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># enable inventory plugins, default: &#39;host_list&#39;, &#39;script&#39;, &#39;auto&#39;, &#39;yaml&#39;, &#39;ini&#39;, &#39;toml&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># enable_plugins = host_list, virtualbox, yaml, constructed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ignore_extensions = .pyc, .pyo, .swp, .bak, ~, .rpm, .md, .txt, ~, .orig, .ini, .cfg, .retry
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ignore_patterns=
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># unparsed_is_failed=False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[privilege_escalation]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># become=True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># become_method=sudo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># become_user=root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># become_ask_pass=False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[paramiko_connection]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># record_host_keys=False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pty=False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># look_for_keys = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># host_key_auto_add = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ssh_connection]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ssh_args = -C -o ControlMaster=auto -o ControlPersist=60s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># control_path_dir = /tmp/.ansible/cp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># control_path_dir = ~/.ansible/cp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># control_path = %(directory)s/%%h-%%r
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># control_path =
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pipelining = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># scp_if_ssh = smart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># transfer_method = smart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sftp_batch_mode = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># usetty = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># retries = 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[persistent_connection]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># connect_timeout = 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># command_timeout = 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[accelerate]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># accelerate_port = 5099
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># accelerate_timeout = 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># accelerate_connect_timeout = 5.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># accelerate_daemon_timeout = 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># accelerate_multi_key = yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[selinux]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># special_context_filesystems=nfs,vboxsf,fuse,ramfs,9p,vfat
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># libvirt_lxc_noseclabel = yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[colors]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># highlight = white
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># verbose = blue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># warn = bright purple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># error = red
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># debug = dark gray
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># deprecate = purple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># skip = cyan
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># unreachable = red
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ok = green
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># changed = yellow
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># diff_add = green
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># diff_remove = red
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># diff_lines = cyan
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[diff]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># context = 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 示例1：未分组的主机
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">green.example.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">blue.example.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.100.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.100.10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 示例2：属于webservers组主机集合
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[webservers]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alpha.example.org
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">beta.example.org
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.1.100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.1.110
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">www[001:006].example.com 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 示例3：属于dbservers组主机集合
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[dbservers]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">db01.intranet.mydomain.net
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">db02.intranet.mydomain.net
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">10.25.1.56
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">10.25.1.57
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">db-[99:101]-node.example.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 主机和主机组变量：
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[webservers:vars]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http_port=8080
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server_name=www.ctnrs.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ansible_ssh_user=&#34;username&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ansible_ssh_pass=&#34;password&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ansible_ssh_port=&#34;port&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 子组，children：为固定写法
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[father:children]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">webservers
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dbservers
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SSH密码认证
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[webservers]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.1.10 ansible_ssh_user=root ansible_ssh_pass=&#39;123456’ http_port=80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.1.11 ansible_ssh_user=root ansible_ssh_pass=&#39;123456’ http_port=80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SSH密钥对认证
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[webservers]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.1.10:22 ansible_ssh_user=root ansible_ssh_key=/root/.ssh/id_rsa
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[master]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">k8s-master ansible_ssh_user=&#34;username&#34; ansible_ssh_pass=&#34;password&#34; ansible_ssh_port=&#34;port&#34; ansible_ssh_host=&#34;IP&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[node]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">k8s-node-1 ansible_ssh_user=&#34;username&#34; ansible_ssh_pass=&#34;password&#34; ansible_ssh_port=&#34;port&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 应用示例
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">aws_host ansible_ssh_private_key_file=/home/example/.ssh/aws.pem
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">freebsd_host ansible_python_interpreter=/usr/local/bin/python
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ruby_module_host ansible_ruby_interpreter=/usr/bin/ruby.1.9.3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->配置<!-- raw HTML omitted --><code>sshd</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm -iUvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed  -i <span style="color:#e6db74">&#39;s/^#host_key_checking/host_key_checking/g&#39;</span> /etc/ansible/ansible.cfg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/PasswordAuthentication[ \t]*no/PasswordAuthentication yes/&#39;</span> /etc/ssh/sshd_config
</span></span><span style="display:flex;"><span>$ systemctl restart sshd</span></span></code></pre></div></blockquote>
<hr>
<h3 id="子配置文件">子配置文件</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->对主机有效配置<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/etc/ansible/host_vars/all  	<span style="color:#75715e"># host_vars 目录用于存放 host 变量，all文件对所有主机有效</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/etc/ansible/host_vars/foosball  	<span style="color:#75715e"># 文件foosball要和hosts里面定义的主机名一样，表示只对 foosball主机有效</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->对组有效配置<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/etc/ansible/group_vars/all  	<span style="color:#75715e"># group_vars目录用于存放 group 变量，all文件对所有组有效</span>
</span></span><span style="display:flex;"><span>/etc/ansible/group_vars/raleigh  	<span style="color:#75715e"># 文件 raleigh 要和 hosts 里面定义的组名一样，表示对raleigh组下的所有主机有效</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/ansible/group_vars/webservers.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http_port: 8080
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server_name: www.ctnrs.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="命令使用">命令使用</h3>
<blockquote>
<ul>
<li><code>ansible-doc --help</code><!-- raw HTML omitted -->：获取使用帮助<!-- raw HTML omitted --></li>
<li><code>ansible-playbook --help</code><!-- raw HTML omitted -->：获取剧本使用帮助<!-- raw HTML omitted --></li>
<li><a href="https://docs.ansible.com/ansible/latest/module_plugin_guide/index.html" rel="external" target="_self">使用<code>Ansible</code>模块和插件</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 列出所有模块</span>
</span></span><span style="display:flex;"><span>$ ansible-doc -l 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看其中某一个模块使用方式，找到其中的：EXAMPLES(例子)</span>
</span></span><span style="display:flex;"><span>$ ansible-doc copy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看某个模块简单实用方式</span>
</span></span><span style="display:flex;"><span>$ ansible-doc -s copy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看回调插件列表</span>
</span></span><span style="display:flex;"><span>$ ansible-doc -t callback -l</span></span></code></pre></div><table>
<thead>
<tr>
<th><strong><a href="https://docs.ansible.com/ansible/latest/command_guide/intro_adhoc.html" rel="external" target="_self">常用模块</a></strong></th>
<th>**描述 **</th>
<th>详解</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>command</code>、<code>shell</code></td>
<td>执行<code>shell</code>命令，<code>shell</code>支持管道符等字符</td>
<td></td>
</tr>
<tr>
<td><code>script</code></td>
<td>脚本模块</td>
<td></td>
</tr>
<tr>
<td><code>copy</code>、<code>file</code>、<code>synchronize</code></td>
<td>文件传输，<code>copy{src,dest,mode}</code>，<code>file</code>模块可以直接操作远程服务器，<code>synchronize</code></td>
<td></td>
</tr>
<tr>
<td><code>yum</code></td>
<td>管理软件包</td>
<td></td>
</tr>
<tr>
<td><code>user</code></td>
<td>用户和组</td>
<td></td>
</tr>
<tr>
<td><code>git</code></td>
<td>从源代码管理系统部署</td>
<td></td>
</tr>
<tr>
<td><code>service</code></td>
<td>管理服务</td>
<td></td>
</tr>
<tr>
<td><code>setup</code></td>
<td>收集目标主机信息</td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>参数解释</li>
</ul>
<blockquote>
<ul>
<li><code>-i</code><!-- raw HTML omitted -->指定<!-- raw HTML omitted --><code>Ansible</code><!-- raw HTML omitted -->主机清单，可以指定外部<!-- raw HTML omitted --></li>
<li><code>-m</code><!-- raw HTML omitted -->指定要执行的模块，比如：<!-- raw HTML omitted --><code>ping</code>、<code>shell</code>、<code>copy</code></li>
<li><code>-a</code><!-- raw HTML omitted -->指定模块的参数， 例如：<!-- raw HTML omitted --><code>cppy</code>里的<code>src</code>、<code>dest</code></li>
<li><code>-o</code><!-- raw HTML omitted -->简洁输出法<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><code>ping</code><!-- raw HTML omitted -->测试<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ansible all -m ping
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 以bruce身份 ping 所有主机</span>
</span></span><span style="display:flex;"><span>$ ansible all -m ping -u bruce
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 用bruce用户 以root身份 ping</span>
</span></span><span style="display:flex;"><span>$ ansible all -m ping -u bruce --sudo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 用bruce用户 sudo到 batman用户 ping</span>
</span></span><span style="display:flex;"><span>$ ansible all -m ping -u bruce --sudo --sudo-user batman
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 在所有节点上执行命令</span>
</span></span><span style="display:flex;"><span>$ ansible all -a <span style="color:#e6db74">&#34;/bin/echo hello&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->并行性和<!-- raw HTML omitted --><code>shell</code><!-- raw HTML omitted -->命令<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 重启 altanta 主机组的所有机器，每次重启 10 台</span>
</span></span><span style="display:flex;"><span>$ ansible atlanta -a <span style="color:#e6db74">&#34;/sbin/reboot&#34;</span> -f <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 以 geekwolf 用户身份在 atlanta 组的所有主机运行 foo 命令</span>
</span></span><span style="display:flex;"><span>$ ansible atlanta -a <span style="color:#e6db74">&#34;/usr/bin/foo&#34;</span> -u geekwolf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 以 geekwolf 用户身份 sudo 执行命令 foo（--ask-sudo-pass (-K) 如果有 sudo 密码请使用此参数）</span>
</span></span><span style="display:flex;"><span>$ ansible atlanta -a <span style="color:#e6db74">&#34;/usr/bin/foo&#34;</span> -u geekwolf --sudo <span style="color:#f92672">[</span>--ask-sudo-pass<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 也可以 sudo 到其他用户执行命令非 root</span>
</span></span><span style="display:flex;"><span>$ ansible atlanta -a <span style="color:#e6db74">&#34;/usr/bin/foo&#34;</span> -u username -U otheruser <span style="color:#f92672">[</span>--ask-sudo-pass<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 默认情况下，ansible 使用的 module 是 command，这个模块并不支持 shell 变量和管道等，若想使用shell 来执行模块，请使用-m 参数指定 shell 模块</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用 shell 模块在远程主机执行命令</span>
</span></span><span style="display:flex;"><span>$ ansible raleigh -m shell -a <span style="color:#960050;background-color:#1e0010">&#39;</span>echo $TERM</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->传输文件<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>copy</code>模块</li>
</ul>
<blockquote>
<ul>
<li><code>src</code><!-- raw HTML omitted -->源<!-- raw HTML omitted --></li>
<li><code>dest</code><!-- raw HTML omitted -->目的地<!-- raw HTML omitted --></li>
<li><code>mode</code><!-- raw HTML omitted -->权限<!-- raw HTML omitted --></li>
<li><code>owner</code><!-- raw HTML omitted -->属主<!-- raw HTML omitted --></li>
<li><code>group</code><!-- raw HTML omitted -->属组<!-- raw HTML omitted --></li>
<li><code>backup</code><!-- raw HTML omitted -->备份<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 把本地/etc/hosts文件拷贝到 atlanta主机组所有主机的/tmp/hosts(空目录除外),如果使用playbooks 则可以充分利用 template 模块</span>
</span></span><span style="display:flex;"><span>$ ansible atlanta -m copy -a <span style="color:#e6db74">&#34;src=../../../../etc/hosts dest=/tmp/hosts&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>file</code>模块</li>
</ul>
<blockquote>
<ul>
<li></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># file 模块允许更改文件的用户及权限</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m file -a <span style="color:#e6db74">&#34;dest=/srv/foo/a.txt mode=600&#34;</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m file -a <span style="color:#e6db74">&#34;dest=/srv/foo/b.txt mode=600 owner=mdehaan group=mdehaan&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用 file 模块创建目录，类似 mkdir -p</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m file -a <span style="color:#e6db74">&#34;dest=/path/to/c mode=755 owner=mdehaan group=mdehaan state=directory&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用 file 模块删除文件或者目录</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m file -a <span style="color:#e6db74">&#34;dest=/path/to/c state=absent&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>synchronize</code></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->管理软件包<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>注释：<code>Ansible</code>支持很多操作系统的软件包管理，使用时<code>-m</code>指定相应的软件包管理工具模块，如果没有这样的模块，可以自己定义类似的模块或者使用<code>command</code>模块来安装软件包</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># present 确认安装， 但不更新</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m apt -a <span style="color:#e6db74">&#34;name=nginx state=present&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 确认安装一个特定版本</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m apt -a <span style="color:#e6db74">&#34;name=nginx-1.5 state=present&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># installed 确认安装</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m apt -a <span style="color:#e6db74">&#34;name=nginx state=installed&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># latest 确认安装包为最新</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m apt -a <span style="color:#e6db74">&#34;name=nginx state=latest&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># absent 和 removed 确认删除</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m apt -a <span style="color:#e6db74">&#34;name=nginx state=absent&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->用户和用户组<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 使用 user 或者 group 模块对于创建新用户和更改、删除已存在用户非常方便</span>
</span></span><span style="display:flex;"><span>$ ansible all -m user -a <span style="color:#e6db74">&#34;name=foo password=&lt;crypted password here&gt;&#34;</span>
</span></span><span style="display:flex;"><span>$ ansible all -m group -a <span style="color:#e6db74">&#34;name=foo state=absent&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>systemd</code>、<code>service</code><!-- raw HTML omitted -->服务管理<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>daemon_reload</code><!-- raw HTML omitted -->重新载入<!-- raw HTML omitted --><code>systemd</code></li>
<li><code>enabled</code><!-- raw HTML omitted -->是否开机启动<!-- raw HTML omitted --><code>yes|no</code></li>
<li><code>name</code><!-- raw HTML omitted -->服务名称<!-- raw HTML omitted --><code>httpd|sshd|nginx</code></li>
<li><code>state</code><!-- raw HTML omitted -->对当前服务操作， 例如：  启动、停止<!-- raw HTML omitted --><code>started</code>、<code>stopped</code>、<code>restarted</code>、<code>reloaded</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 确保 webservers 组所有主机的 httpd 是启动的</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m service -a <span style="color:#e6db74">&#34;name=httpd state=started&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 重启 webservers 组所有主机的 httpd 服务</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m service -a <span style="color:#e6db74">&#34;name=httpd state=restarted&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 确保 webservers 组所有主机的 httpd 是关闭的</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m service -a <span style="color:#e6db74">&#34;name=httpd state=stopped&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->后台运行<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>长时间运行的操作可以放到后台执行，<code>ansible</code>会检查任务的状态；在主机上执行的同一个任务会分配同一个<code>job ID</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 后台执行命令 3600s，-B 表示后台执行的时间</span>
</span></span><span style="display:flex;"><span>$ ansible all -B <span style="color:#ae81ff">3600</span> -a <span style="color:#e6db74">&#34;/usr/bin/long_running_operation --do-stuff&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 检查任务的状态</span>
</span></span><span style="display:flex;"><span>$ ansible all -m async_status -a <span style="color:#e6db74">&#34;jid=123456789&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 后台执行命令最大时间是 1800s 即 30 分钟，-P 每 60s 检查下状态默认 15s</span>
</span></span><span style="display:flex;"><span>$ ansible all -B <span style="color:#ae81ff">1800</span> -P <span style="color:#ae81ff">60</span> -a <span style="color:#e6db74">&#34;/usr/bin/long_running_operation --do-stuff&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->搜集系统信息<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>gather_facts: no</code><!-- raw HTML omitted -->关闭<!-- raw HTML omitted --><code>Facts</code><!-- raw HTML omitted -->变量<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Facts 在 playbooks 一章中会有详细的描述，这里只通过命令获取所有的系统信息搜集主机的所有系统信息</span>
</span></span><span style="display:flex;"><span>$ ansible all -m setup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 搜集系统信息并以主机名为文件名分别保存在/tmp/facts 目录</span>
</span></span><span style="display:flex;"><span>$ ansible all -i localhost, -m setup --tree /tmp/facts.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 搜集和内存相关的信息</span>
</span></span><span style="display:flex;"><span>$ ansible all -i localhost, -m setup -a <span style="color:#e6db74">&#39;filter=ansible_*_mb&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 搜集网卡信息 ansible_default_ipv4</span>
</span></span><span style="display:flex;"><span>$ ansible all -i localhost, -m setup -a <span style="color:#e6db74">&#39;filter=ansible_all_ipv4_addresses&#39;</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="使用galaxy">使用<code>Galaxy</code></h3>
<blockquote>
<ul>
<li>从<a href="https://galaxy.ansible.com/ui/" rel="external" target="_self"><code>Galaxy</code></a>和<code>Github</code>获得第三方的角色</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 初始化项目，生成默认目录</span>
</span></span><span style="display:flex;"><span>$ ansible-galaxy init nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用galaxy 安装服务</span>
</span></span><span style="display:flex;"><span>$ ansible-galaxy install -p roles darkraiden.ansible-pip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ansible-galaxy install -p roles git+https://github.com/avinetworks/ansible-role-docker,master</span></span></code></pre></div></blockquote>
<hr>
<h3 id="配置playbook">配置<code>Playbook</code></h3>
<ul>
<li>
<ol>
<li><code>Ansible-Playbook</code><!-- raw HTML omitted -->目录、字段定义<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.ansible.com/ansible/latest/tips_tricks/ansible_tips_tricks.html" rel="external" target="_self"><code>Ansible</code>官网文档</a></td>
<td><code>Ansible Playbook</code>官方文档</td>
</tr>
<tr>
<td><a href="https://github.com/ansible/ansible-examples" rel="external" target="_self"><code>Ansible</code>示例参考</a></td>
<td>示例参考网址</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ansible-playbook -i /etc/ansible/hosts example.yml -C  	<span style="color:#75715e"># -C 模拟运行查看流程是否会出错</span>
</span></span><span style="display:flex;"><span>$ ansible-playbook -i /etc/ansible/hosts example.yml --syntax-check  	<span style="color:#75715e"># 校验PlayBook脚本语法</span>
</span></span><span style="display:flex;"><span>$ ansible-playbook -i /etc/ansible/hosts example.yml --tags <span style="color:#e6db74">&#34;configuration,install&#34;</span>  	<span style="color:#75715e"># 指定安装</span>
</span></span><span style="display:flex;"><span>$ ansible-playbook -i /etc/ansible/hosts example.yml --skip-tags <span style="color:#e6db74">&#34;install&#34;</span>  <span style="color:#75715e"># 跳过 Install 步骤 </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 校验yaml文件</span>
</span></span><span style="display:flex;"><span>$ pip3 install pyyaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用sys标准输入验证</span>
</span></span><span style="display:flex;"><span>$ python3 -c <span style="color:#e6db74">&#39;import yaml,sys; print(yaml.safe_load(sys.stdin))&#39;</span>  &lt; my_yaml.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 其中，-i inventory_file 指定了你的 Ansible inventory 文件或者直接指定主机名</span>
</span></span><span style="display:flex;"><span>$ ansible-playbook -i inventory_file execute_local_script.yaml</span></span></code></pre></div><ul>
<li>执行时动态传入主机参数</li>
</ul>
<blockquote>
<ul>
<li><code>your_playbook.yaml</code> 是你的<code>Ansible playbook</code>文件名。</li>
<li><code>target_hosts</code> 是一个变量，可以根据需要设定为具体的主机组名称，比如 <code>web_servers</code>。</li>
<li><code>-l your_target_hosts</code> 是用来指定要执行的主机组的选项，指定执行目标为单个主机 <code>hostname</code>，指定执行目标为多个主机 <code>host1,host2</code>，使用模式匹配选择所有主机名以 <code>web*</code> 开头的主机</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ansible-playbook your_playbook.yaml -e <span style="color:#e6db74">&#34;target_hosts=your_target_hosts&#34;</span> -l your_target_hosts</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="roles角色"><code>Roles</code>角色</h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>playbook-roles/
</span></span><span style="display:flex;"><span>└── roles  <span style="color:#75715e"># 剧本</span>
</span></span><span style="display:flex;"><span>├── mysql
</span></span><span style="display:flex;"><span>│   ├── defaults
</span></span><span style="display:flex;"><span>│   │   └── main.yaml
</span></span><span style="display:flex;"><span>│   ├── files
</span></span><span style="display:flex;"><span>│   ├── handlers
</span></span><span style="display:flex;"><span>│   │   └── main.yaml
</span></span><span style="display:flex;"><span>│   ├── meta
</span></span><span style="display:flex;"><span>│   │   └── main.yaml
</span></span><span style="display:flex;"><span>│   ├── README.md
</span></span><span style="display:flex;"><span>│   ├── tasks
</span></span><span style="display:flex;"><span>│   │   └── main.yaml
</span></span><span style="display:flex;"><span>│   ├── templates
</span></span><span style="display:flex;"><span>│   ├── tests
</span></span><span style="display:flex;"><span>│   │   ├── inventory
</span></span><span style="display:flex;"><span>│   │   └── test.yaml
</span></span><span style="display:flex;"><span>│   └── vars
</span></span><span style="display:flex;"><span>│       └── main.yml
</span></span><span style="display:flex;"><span>├── nginx  	<span style="color:#75715e"># Nginx的角色剧本</span>
</span></span><span style="display:flex;"><span>│   ├── defaults/  	<span style="color:#75715e"># 存放默认变量文件</span>
</span></span><span style="display:flex;"><span>│   │   └── main.yaml
</span></span><span style="display:flex;"><span>│   ├── files/  	<span style="color:#75715e"># 存放需要传输的静态文件</span>
</span></span><span style="display:flex;"><span>│   │   └── index.html
</span></span><span style="display:flex;"><span>│   ├── handlers/  	<span style="color:#75715e"># 触发器目录，在变更时执行操作</span>
</span></span><span style="display:flex;"><span>│   │   └── main.yaml
</span></span><span style="display:flex;"><span>│   ├── meta/  	<span style="color:#75715e"># 存放 role 的元数据文件</span>
</span></span><span style="display:flex;"><span>│   │   └── main.yaml
</span></span><span style="display:flex;"><span>│   ├── README.md  	<span style="color:#75715e"># 用于描述 role 的 README 文件</span>
</span></span><span style="display:flex;"><span>│   ├── tasks/  	<span style="color:#75715e"># 存放主要任务文件，用来安装程序服务</span>
</span></span><span style="display:flex;"><span>│   │   └── main.yaml
</span></span><span style="display:flex;"><span>│   ├── templates/  	<span style="color:#75715e"># 存放模板文件</span>
</span></span><span style="display:flex;"><span>│   │   └── nginx.conf.j2
</span></span><span style="display:flex;"><span>│   ├── tests/  	<span style="color:#75715e"># 存放测试相关文件</span>
</span></span><span style="display:flex;"><span>│   │   ├── inventory
</span></span><span style="display:flex;"><span>│   │   └── test.yaml
</span></span><span style="display:flex;"><span>│   └── vars/  	<span style="color:#75715e"># 存放其他变量文件</span>
</span></span><span style="display:flex;"><span>│       └── main.yaml
</span></span><span style="display:flex;"><span>└── site.yaml  	<span style="color:#75715e"># 定义那个节点或者那组服务器执行，可以定义多个角色剧本</span></span></span></code></pre></div><ul>
<li><code>playbook-roles</code>→<code>site.yaml</code></li>
</ul>
<blockquote>
<ul>
<li><code>name</code><!-- raw HTML omitted -->：每个<!-- raw HTML omitted --><code>play</code><!-- raw HTML omitted -->名字<!-- raw HTML omitted --></li>
<li><code>hosts</code><!-- raw HTML omitted -->：每个<!-- raw HTML omitted --><code>play</code><!-- raw HTML omitted -->涉及被管理的服务器，同<!-- raw HTML omitted --><code>ad-hoc</code><!-- raw HTML omitted -->中的资产选择器<!-- raw HTML omitted --></li>
<li><code>tasks</code><!-- raw HTML omitted -->：每个<!-- raw HTML omitted --><code>play</code><!-- raw HTML omitted -->中具体要完成的任务，以列表的形式表达<!-- raw HTML omitted -->，<code>register: </code><!-- raw HTML omitted -->注册变量<!-- raw HTML omitted --></li>
<li><code>become</code><!-- raw HTML omitted -->：如果需要提权，则加上<!-- raw HTML omitted --><code>become</code><!-- raw HTML omitted -->相关属性<!-- raw HTML omitted --></li>
<li><code>become_user</code><!-- raw HTML omitted -->：若要提权的话，提权到那个用户上<!-- raw HTML omitted --></li>
<li><code>remote_user</code><!-- raw HTML omitted -->：指定连接到远程节点的用户，就是在远程服务器上执行具体操作的用户吗，若不指定，则默认使用当前执行<!-- raw HTML omitted --><code>ansible-playbook</code><!-- raw HTML omitted -->的用户<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->进阶剧本语法<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>when</code><!-- raw HTML omitted -->逻辑判断：<!-- raw HTML omitted --><code>==</code>、<code>!=</code>、<code>&gt; &gt;=</code>、<code>&lt; &lt;=</code>、<code>is defined</code>、<code>is not defined</code>、<code>true/false</code>、<code>and or</code>、</li>
<li><code>include</code><!-- raw HTML omitted -->剧本引用<!-- raw HTML omitted --></li>
<li><code>Handlers</code><!-- raw HTML omitted -->触发器<!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<hr>
<h5 id="rolesnginx"><code>Roles</code>→<code>Nginx</code></h5>
<ul>
<li>
<ol>
<li><code>Roles</code>→<code>Nginx</code><!-- raw HTML omitted -->目录下文件夹配置<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Files</code><!-- raw HTML omitted -->存放需要传输的静态文件<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/roles/nginx/files/index.html<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TEST
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>Handlers</code><!-- raw HTML omitted -->触发器目录<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/roles/nginx/handlers/main.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name: restart nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  service: name=nginx state=restarted
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>Tasks</code><!-- raw HTML omitted -->存放主要任务文件，用来安装程序服务<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/roles/nginx/tasks/main.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--- # 声明
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- hosts: webservers
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  vars:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    hello: Ansible
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  tasks:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Add repo 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    yum_repository:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: nginx repo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      baseurl: http://nginx.org/packages/centos/7/$basearch/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      gpgcheck: no
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      enabled: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    register: reposyntsx  	# 检测值
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# 定义执行项目名称，安装服务
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Install Nginx packge
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	yum: name={{ item }} state=lates # item 为内置变量
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	with_items:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	- epel-release
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	- nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	debug: var=reposyntsx  	# 判断是否成功
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	when: reposyntsx.rc == 0  	# 等于0 代表成功
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# 拷贝文件
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Copy index.html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	copy: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  src: index.html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  dest: /usr/local/nginx/html/index.html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# 拷贝文件
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Copy nginx.conf Teplate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	temlate: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  src: nginx.conf.j2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  dest: /usr/local/nginx/conf/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	notify: restart nginx  # nginx.conf.j2 文件拷贝成功，通知handlers(触发器) 重启使之生效
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# 启动服务
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: make sure nginx service running
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	service: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  name: nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  state: started
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  enabled: yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# 创建项目目录
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Create wwwroot directory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	file:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  dest: /var/www/html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  state: directory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# 创建一个索引文件  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Create test page index.html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	shell: echo &#34;hello {{hello}}&#34; &gt; /var/www/html/index.html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>Templates</code><!-- raw HTML omitted -->模板目录<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/roles/nginx/templates/nginx.conf.j2<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">user  nobody;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">worker_processes {{ ansible_processor_cores }};  	# 服务内置变量
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{# 我是注释 #}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">events {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    worker_connections {{ worker_connections }};  	# 自定义变量
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    include       mime.types;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    default_type  application/octet-stream;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sendfile        on;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    keepalive_timeout  65;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        listen       80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        server_name  localhost;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            root   html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            index  index.html index.htm;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        error_page   500 502 503 504  /50x.html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        location = /50x.html {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            root   html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>vars</code><!-- raw HTML omitted -->自定义变量目录<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/roles/nginx/vars/main.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">worker_connections: 10240;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>site.conf</code>目录</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;site.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	listen 80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	server_name www.ctnrs.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		root /var/www/html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		index index.html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->配置<!-- raw HTML omitted --><code>Ansible-Playbook</code><!-- raw HTML omitted -->下<!-- raw HTML omitted --><code>Roles</code><!-- raw HTML omitted -->目录下<!-- raw HTML omitted --><code>site.yaml</code>文件</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>site.yaml</code><!-- raw HTML omitted -->文件，定义那个节点或者那组服务器执行什么程序<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/roles/site.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- hosts: web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  roles:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- hosts: mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  roles:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="-playbook完整剧本示例"><code> Playbook</code>完整剧本示例</h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/nginx.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- hosts: web_server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vars:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    app_path: &#34;{{ base_path }}/app&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    http_port: 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    max_clients: 256
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  become: true  	# 需要目标主机的用户具有sudo权限
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  tasks:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: ensure apache is at the latest version
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    yum: name=httpd state=latest
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: ensure apahech is running
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    service: name=httpd state=started
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name:  	# 创建或修改文件&amp;目录
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    file:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      path: /tmp/demo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      state: directory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      mode: 0755
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name:  	# 拷贝文件到目标主机
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    copy:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      src: /etc/hostname
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      dest: /tmp/demo/hostname
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: disable selinux
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    command: /sbin/setenforce 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: run this command and ignore the result
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    shell: /usr/bin/somecommand || /bin/true 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ignore_errors: True  	# 忽略报错信息
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name:  	# 用模板生成配置文件
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    template:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      src: demo.j2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      dest: &#34;{{ ansible_user_dir }}/demo.cfg&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  handlers
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - name: restart apache
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      service: name=httpd state=restart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF &gt;roles/demo-role/tasks/main.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- include: yum.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  when: (ansible_distribution|lower == &#39;redhat&#39;) or (ansible_distribution|lower == &#39;centos&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- include: apt.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  when: (ansible_distribution|lower == &#39;debian&#39;) or (ansible_distribution|lower == &#39;ubuntu&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF &gt;roles/demo-role/tasks/yum.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name:  	# 使用Yum安装Apache服务
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  yum:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: &#34;{{ redhat_app }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    state: &#34;{{ app_state }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  notify:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF &gt;roles/demo-role/tasks/apt.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name:  	# 使用Apt安装Apache服务
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  apt:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: &#34;{{ debian_app }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    state: &#34;{{ app_state }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  notify:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF &gt;roles/demo-role/vars/main.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">redhat_app: httpd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">debian_app: apache2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF &gt;roles/demo-role/handlers/main.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name: done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  debug:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    msg: &#34;Apache服务已部署&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->自动部署<!-- raw HTML omitted --><code>Tomcat</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">webservers </span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">gather_facts</span>: <span style="color:#66d9ef">no</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">vars</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">tomcat_version</span>: <span style="color:#ae81ff">8.5.34</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">tomcat_install_dir</span>: <span style="color:#ae81ff">/usr/local</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tasks</span>:
</span></span><span style="display:flex;"><span>	- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install jdk1.8</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">yum</span>: <span style="color:#ae81ff">name=java-1.8.0-openjdk state=present</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Download tomcat</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">get_url</span>: <span style="color:#ae81ff">url=http://mirrors.hust.edu.cn/apache/tomcat/tomcat-</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8</span><span style="color:#ae81ff">/v{{ tomcat_version }}/bin/apache-tomcat-{{ tomcat_version }}.tar.gz dest=/tmp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Unarchive tomcat-{{ tomcat_version }}.tar.gz</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">unarchive</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">src</span>: <span style="color:#ae81ff">/tmp/apache-tomcat-{{ tomcat_version }}.tar.gz </span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">dest</span>: <span style="color:#e6db74">&#34;{{ tomcat_install_dir }}&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">copy</span>: <span style="color:#66d9ef">no</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Start tomcat </span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">shell</span>: <span style="color:#ae81ff">cd {{ tomcat_install_dir }} &amp;&amp;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">mv apache-tomcat-{{ tomcat_version }} tomcat8 &amp;&amp;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">cd tomcat8/bin &amp;&amp; nohup ./startup.sh &amp;</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

        </div>
      </main>
    </div>
    <script src="../../../../js/clipboard.min.js?1734019085" defer></script>
    <script src="../../../../js/perfect-scrollbar.min.js?1734019085" defer></script>
    <script src="../../../../js/theme.js?1734019085" defer></script>
  </body>
</html>
