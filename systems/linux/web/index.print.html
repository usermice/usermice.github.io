<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <meta name="author" content="äºŒå“¥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/s2-1.png">
    <meta name="twitter:title" content="Web :: Hugo Relearn Theme">
    <meta property="og:url" content="https://erge.blog/systems/linux/web/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Web :: Hugo Relearn Theme">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://erge.blog/images/s2-1.png">
    <meta itemprop="name" content="Web :: Hugo Relearn Theme">
    <meta itemprop="datePublished" content="2024-06-13T00:37:50+08:00">
    <meta itemprop="dateModified" content="2024-06-13T00:37:50+08:00">
    <meta itemprop="image" content="https://erge.blog/images/s2-1.png">
    <title>Web :: Hugo Relearn Theme</title>
    <link href="../../../images/favicon.ico?1722425298" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../css/fontawesome-all.min.css?1722425299" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fontawesome-all.min.css?1722425299" rel="stylesheet"></noscript>
    <link href="../../../css/nucleus.css?1722425299" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1722425299" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/auto-complete.css?1722425299" rel="stylesheet"></noscript>
    <link href="../../../css/perfect-scrollbar.min.css?1722425299" rel="stylesheet">
    <link href="../../../css/fonts.css?1722425299" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fonts.css?1722425299" rel="stylesheet"></noscript>
    <link href="../../../css/theme.css?1722425299" rel="stylesheet">
    <link href="../../../css/theme-relearn-auto.css?1722425299" rel="stylesheet" id="R-variant-style">
    <link href="../../../css/chroma-relearn-auto.css?1722425299" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../css/variant.css?1722425299" rel="stylesheet">
    <link href="../../../css/print.css?1722425299" rel="stylesheet" media="print">
    <link href="../../../css/format-print.css?1722425299" rel="stylesheet">
    <script src="../../../js/variant.js?1722425299"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../systems/linux/web/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Web</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/service_management/install_consul/" title="Install_Consul (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/web/website_optimization_advertise/" title="Website_Optimization_Advertise (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="web">Web</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Web</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="website_optimization_advertise">Website_Optimization_Advertise</h1>

<h2 id="ç½‘ç«™ä¼˜åŒ–">ç½‘ç«™ä¼˜åŒ–</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://juejin.cn/post/7015464868237017119" rel="external" target="_self">åšå®¢æ¥å…¥è°·æ­Œå¹¿å‘Š<code>Google Ads</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://blog.csdn.net/fullbug/article/details/123894727" rel="external" target="_self"><code>hexo</code>åšå®¢åŠ å…¥<code>51LA</code>ç½‘ç«™æµé‡ç»Ÿè®¡</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="website_http_status_messages">Website_HTTP_Status_Messages</h1>

<h2 id="webæœåŠ¡æ¶ˆæ¯çŠ¶æ€ç "><code>Web</code>æœåŠ¡æ¶ˆæ¯çŠ¶æ€ç </h2>
<h3 id="1xxä»£è¡¨ä¿¡æ¯"><code>1xx</code>ä»£è¡¨ï¼šä¿¡æ¯</h3>
<blockquote>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>100 Continue</code></td>
<td>æœåŠ¡å™¨ä»…æ¥æ”¶åˆ°éƒ¨åˆ†è¯·æ±‚ï¼Œä½†æ˜¯ä¸€æ—¦æœåŠ¡å™¨å¹¶æ²¡æœ‰æ‹’ç»è¯¥è¯·æ±‚ï¼Œå®¢æˆ·ç«¯åº”è¯¥ç»§ç»­å‘é€å…¶ä½™çš„è¯·æ±‚</td>
</tr>
<tr>
<td><code>101 Switching</code></td>
<td>æœåŠ¡å™¨è½¬æ¢åè®®ï¼šæœåŠ¡å™¨å°†éµå®ˆä»å®¢æˆ·çš„è¯·æ±‚è½¬æ¢åˆ°å¦å¤–ä¸€ç§åè®®</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="2xxä»£è¡¨æˆåŠŸ"><code>2XX</code>ä»£è¡¨ï¼šæˆåŠŸ</h3>
<blockquote>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>200 OK</code></td>
<td>è¯·æ±‚æˆåŠŸ(å…¶åæ˜¯å¯¹<code>GET</code>å’Œ<code>POST</code>è¯·æ±‚çš„åº”ç­”æ–‡æ¡£ã€‚)</td>
</tr>
<tr>
<td><code>201 Created</code></td>
<td>è¯·æ±‚è¢«åˆ›å»ºå®Œæˆï¼ŒåŒæ—¶æ–°çš„èµ„æºè¢«åˆ›å»ºã€‚</td>
</tr>
<tr>
<td><code>202 Accepted</code></td>
<td>ä¾›å¤„ç†çš„è¯·æ±‚å·²è¢«æ¥å—ï¼Œä½†æ˜¯å¤„ç†æœªå®Œæˆ</td>
</tr>
<tr>
<td><code>203 Non-authoritative information</code></td>
<td>æ–‡æ¡£å·²ç»æ­£å¸¸åœ°è¿”å›ï¼Œä½†ä¸€äº›åº”ç­”å¤´å¯èƒ½ä¸æ­£ç¡®ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯æ–‡æ¡£çš„æ‹·è´</td>
</tr>
<tr>
<td><code>204 No Content</code></td>
<td>æ²¡æœ‰æ–°æ–‡æ¡£ã€‚æµè§ˆå™¨åº”è¯¥ç»§ç»­æ˜¾ç¤ºåŸæ¥çš„æ–‡æ¡£ã€‚å¦‚æœç”¨æˆ·å®šæœŸåœ°åˆ·æ–°é¡µé¢è€Œ<code>Servlet</code>å¯ä»¥ç¡®å®šç”¨æˆ·æ–‡æ¡£è¶³å¤Ÿæ–°ï¼Œè¿™ä¸ªçŠ¶æ€ä»£ç æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</td>
</tr>
<tr>
<td><code>205 Reset</code></td>
<td>æ²¡æœ‰æ–°æ–‡æ¡£ã€‚ä½†æµè§ˆå™¨åº”è¯¥é‡ç½®å®ƒæ‰€æ˜¾ç¤ºçš„å†…å®¹ã€‚ç”¨æ¥å¼ºåˆ¶æµè§ˆå™¨æ¸…æ¥šè¡¨å•è¾“å…¥å†…å®¹ã€‚</td>
</tr>
<tr>
<td><code>206 Partial Content</code></td>
<td>å®¢æˆ·å‘é€äº†ä¸€ä¸ªå¸¦æœ‰<code>Range</code>çš„å¤´<code>GET</code>è¯·æ±‚ï¼ŒæœåŠ¡å™¨å®Œæˆäº†ä»–</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="3xxä»£è¡¨é‡å®šå‘"><code>3XX</code>ä»£è¡¨ï¼šé‡å®šå‘</h3>
<blockquote>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>300 Multiple Choices</code></td>
<td>å¤šé‡é€‰æ‹©ã€‚é“¾æ¥åˆ—è¡¨ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©æŸé“¾æ¥è¾¾åˆ°ç›®çš„åœ°ã€‚æœ€å¤šå…è®¸äº”ä¸ªåœ°å€ã€‚</td>
</tr>
<tr>
<td><code>301 MovedPermanently</code></td>
<td>æ‰€è¯·æ±‚çš„é¡µé¢å·²ç»è½¬ç§»è‡³æ–°çš„<code>url</code></td>
</tr>
<tr>
<td><code>302 Found</code></td>
<td>æ‰€è¯·æ±‚çš„é¡µé¢å·²ç»ä¸´æ—¶è½¬ç§»è‡³æ–°çš„<code>url</code></td>
</tr>
<tr>
<td><code>303 See Other</code></td>
<td>æ‰€è¯·æ±‚çš„é¡µé¢å†åˆ«çš„<code>url</code>ä¸‹è¢«æ‰¾åˆ°</td>
</tr>
<tr>
<td><code>303 Not Modified</code></td>
<td>æœªæŒ‰é¢„æœŸä¿®æ”¹æ–‡æ¡£ã€‚å®¢æˆ·ç«¯æœ‰ç¼“å†²çš„æ–‡æ¡£å¹¶å‘å‡ºäº†ä¸€ä¸ªæ¡ä»¶æ€§çš„è¯·æ±‚(ä¸€èˆ¬æ˜¯æä¾›<code>if-Modified-Since</code>å¤´è¡¨ç¤ºå®¢æˆ·åªæƒ³æ¯”æŒ‡å®šæ—¥æœŸæ›´æ–°çš„æ–‡æ¡£)ã€‚æœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ï¼ŒåŸæ¥ç¼“å†²çš„æ–‡æ¡£è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚</td>
</tr>
<tr>
<td><code>305 Use Proxy</code></td>
<td>å®¢æˆ·è¯·æ±‚çš„æ–‡æ¡£åº”è¯¥é€šè¿‡<code>Location</code>å¤´æ‰€æŒ‡æ˜çš„ä»£ç†æœåŠ¡å™¨æå–</td>
</tr>
<tr>
<td><code>306 Unused</code></td>
<td>æ­¤ä»£ç è¢«ç”¨äºå‰ä¸€ç‰ˆæœ¬ã€‚ç›®å‰å·²ä¸å†ä½¿ç”¨ï¼Œä½†æ˜¯ä»£ç ä¾ç„¶è¢«ä¿ç•™</td>
</tr>
<tr>
<td><code>307 Temporary Redirect</code></td>
<td>è¢«è¯·æ±‚çš„é¡µé¢å·²ç»ä¸´æ—¶ç§»è‡³æ–°çš„<code>url</code></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="4xxä»£è¡¨å®¢æˆ·ç«¯é”™è¯¯"><code>4XX</code>ä»£è¡¨ï¼šå®¢æˆ·ç«¯é”™è¯¯</h3>
<blockquote>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>400 Bad Request</code></td>
<td>æœåŠ¡å™¨æœªèƒ½ç†è§£è¯·æ±‚</td>
</tr>
<tr>
<td><code>401 Unauthorized</code></td>
<td>è¢«è¯·æ±‚çš„é¡µé¢éœ€è¦ç”¨æˆ·å’Œå¯†ç </td>
</tr>
<tr>
<td><code>401.1</code></td>
<td>ç™»å½•å¤±è´¥ã€‚</td>
</tr>
<tr>
<td><code>401.2</code></td>
<td>æœåŠ¡å™¨é…ç½®å¯¼è‡´ç™»å½•å¤±è´¥ã€‚</td>
</tr>
<tr>
<td><code>401.3</code></td>
<td>ç”±äº<code>ACL</code>å¯¹èµ„æºçš„é™åˆ¶è€Œæœªè·å¾—æˆæƒã€‚</td>
</tr>
<tr>
<td><code>401.4</code></td>
<td>ç­›é€‰å™¨æˆæƒå¤±è´¥ã€‚</td>
</tr>
<tr>
<td><code>401.5</code></td>
<td><code>ISAPI/CGI</code>åº”ç”¨ç¨‹åºæˆæƒå¤±è´¥</td>
</tr>
<tr>
<td><code>401.7</code></td>
<td>è®¿é—®è¢«<code>Web</code>æœåŠ¡å™¨ä¸Šçš„<code>URL</code>æˆæƒç­–ç•¥æ‹’ç»ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º<code>IIS 6.0</code>æ‰€ä¸“ç”¨</td>
</tr>
<tr>
<td><code>402 Payment Required</code></td>
<td>æ­¤ä»£ç å°šæ— æ³•ä½¿ç”¨</td>
</tr>
<tr>
<td><code>403 Forbidden</code></td>
<td>å¯¹è¢«è¯·æ±‚é¡µé¢çš„è®¿é—®è¢«ç¦æ­¢</td>
</tr>
<tr>
<td><code>403.1</code></td>
<td>æ‰§è¡Œè®¿é—®è¢«ç¦æ­¢</td>
</tr>
<tr>
<td><code>403.2</code></td>
<td>è¯»è®¿é—®è¢«ç¦æ­¢</td>
</tr>
<tr>
<td><code>403.3</code></td>
<td>å†™è®¿é—®è¢«ç¦æ­¢</td>
</tr>
<tr>
<td><code>403.4</code></td>
<td>è¦æ±‚<code>SSL</code></td>
</tr>
<tr>
<td><code>403.5</code></td>
<td>è¦æ±‚<code>SSL 128</code></td>
</tr>
<tr>
<td><code>403.6</code></td>
<td><code>IP</code>åœ°å€è¢«æ‹’ç»</td>
</tr>
<tr>
<td><code>403.7</code></td>
<td>è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦</td>
</tr>
<tr>
<td><code>403.8</code></td>
<td>ç«™ç‚¹è®¿é—®è¢«æ‹’ç»</td>
</tr>
<tr>
<td><code>403.9</code></td>
<td>ç”¨æˆ·æ•°è¿‡å¤š</td>
</tr>
<tr>
<td><code>403.10</code></td>
<td>é…ç½®æ— æ•ˆ</td>
</tr>
<tr>
<td><code>403.11</code></td>
<td>å¯†ç æ›´æ”¹</td>
</tr>
<tr>
<td><code>403.12</code></td>
<td>æ‹’ç»è®¿é—®æ˜ å°„è¡¨</td>
</tr>
<tr>
<td><code>403.13</code></td>
<td>å®¢æˆ·ç«¯è¯ä¹¦è¢«åŠé”€</td>
</tr>
<tr>
<td><code>403.14</code></td>
<td>æ‹’ç»ç›®å½•åˆ—è¡¨</td>
</tr>
<tr>
<td><code>403.15</code></td>
<td>è¶…å‡ºå®¢æˆ·ç«¯è®¿é—®è®¸å¯</td>
</tr>
<tr>
<td><code>403.16</code></td>
<td>å®¢æˆ·ç«¯è¯ä¹¦ä¸å—ä¿¡ä»»æˆ–æ— æ•ˆ</td>
</tr>
<tr>
<td><code>403.17</code></td>
<td>å®¢æˆ·ç«¯è¯ä¹¦å·²è¿‡æœŸæˆ–å°šæœªç”Ÿæ•ˆ</td>
</tr>
<tr>
<td><code>403.18</code></td>
<td>å†å½“å‰çš„åº”ç”¨ç¨‹åºæ± ä¸­ä¸èƒ½æ‰§è¡Œæ‰€è¯·æ±‚çš„URLã€‚è¿™ä¸ªé”™è¯¯ç ä¸º<code>IIS 6.0</code>æ‰€ä¸“ç”¨ã€‚</td>
</tr>
<tr>
<td><code>403.19</code></td>
<td>ä¸èƒ½ä¸ºè¿™ä¸ªåº”ç”¨ç¨‹åºæ± ä¸­çš„å®¢æˆ·ç«¯æ‰§è¡Œ<code>CGI</code>ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º<code>IIS 6.0</code>æ‰€ä¸“ç”¨</td>
</tr>
<tr>
<td><code>403.20</code></td>
<td><code>Passport</code>ç™»å½•å¤±è´¥ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º<code>IIS 6.0</code>æ‰€ä¸“ç”¨</td>
</tr>
<tr>
<td><code>404 Not Found</code></td>
<td>æœåŠ¡å™¨æ— æ³•æ‰¾åˆ°è¢«è¯·æ±‚çš„é¡µé¢</td>
</tr>
<tr>
<td><code>404.0</code></td>
<td>(æ— )-æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶æˆ–ç›®å½•</td>
</tr>
<tr>
<td><code>404.1</code></td>
<td>æ— æ³•åœ¨æ‰€è¯·æ±‚çš„ç«¯å£ä¸Šè®¿é—®<code>Web</code>ç«™ç‚¹</td>
</tr>
<tr>
<td><code>404.2</code></td>
<td><code>Web</code>æœåŠ¡æ‰©å±•é”å®šç­–ç•¥ç»„ç»‡æœ¬è¯·æ±‚</td>
</tr>
<tr>
<td><code>404.3</code></td>
<td><code>MIME</code>æ˜ å°„ç­–ç•¥é˜»æ­¢æœ¬è¯·æ±‚</td>
</tr>
<tr>
<td><code>405 Method Not Allowed</code></td>
<td>è¯·æ±‚ä¸­æŒ‡å®šçš„æ–¹æ³•ä¸è¢«å…è®¸</td>
</tr>
<tr>
<td><code>406 Not Acceptable</code></td>
<td>æœåŠ¡å™¨ç”Ÿæˆçš„å“åº”æ— æ³•è¢«å®¢æˆ·ç«¯æ‰€æ¥å—</td>
</tr>
<tr>
<td><code>407 Proxy Authentication Required</code></td>
<td>ç”¨æˆ·å¿…é¡»é¦–å…ˆä½¿ç”¨ä»£ç†æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼Œè¿™æ ·è¯·æ±‚æ‰ä¼šè¢«å¤„ç†</td>
</tr>
<tr>
<td><code>408 Request Timeout</code></td>
<td>è¯·æ±‚è¶…å‡ºäº†æœåŠ¡å™¨çš„ç­‰å¾…æ—¶é—´</td>
</tr>
<tr>
<td><code>409 Conflict</code></td>
<td>ç”±äºå†²çªï¼Œè¯·æ±‚æ— æ³•è¢«å®Œæˆ</td>
</tr>
<tr>
<td><code>410 Gone</code></td>
<td>è¢«è¯·æ±‚çš„é¡µé¢ä¸å¯ç”¨</td>
</tr>
<tr>
<td><code>411 Length Required</code></td>
<td><code>Centent-Length</code>æœªè¢«å®šä¹‰ã€‚å¦‚æœæ— æ­¤å†…å®¹ï¼ŒæœåŠ¡å™¨ä¸ä¼šæ¥å—è¯·æ±‚</td>
</tr>
<tr>
<td><code>412 Precondition Failed</code></td>
<td>è¯·æ±‚ä¸­çš„å‰ææ¡ä»¶è¢«æœåŠ¡å™¨è¯„ä¼°å¤±è´¥</td>
</tr>
<tr>
<td><code>413 Request Entity Too Large</code></td>
<td>ç”±äºæ‰€è¯·æ±‚çš„å®ä½“çš„å¤ªå¤§ï¼ŒæœåŠ¡å™¨ä¸ä¼šæ¥å—è¯·æ±‚</td>
</tr>
<tr>
<td><code>414 Requst-url Too Long</code></td>
<td>ç”±äº<code>url</code>å¤ªé•¿ï¼ŒæœåŠ¡å™¨ä¸ä¼šæ¥å—è¯·æ±‚ã€‚å½“<code>post</code>è¯·æ±‚è¢«è½¬æ¢ä¸ºå¸¦æœ‰å¾ˆé•¿çš„æŸ¥è¯¢ä¿¡æ¯çš„<code>get</code>è¯·æ±‚æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µ</td>
</tr>
<tr>
<td><code>415 Unsupported Medis  Type</code></td>
<td>ç”±äºåª’ä»‹ç±»å‹ä¸è¢«æ”¯æŒï¼ŒæœåŠ¡å™¨ä¸ä¼šæ¥å—è¯·æ±‚</td>
</tr>
<tr>
<td><code>416 Requested Range Not Satisfiable</code></td>
<td>æœåŠ¡å™¨ä¸èƒ½æ»¡è¶³å®¢æˆ·åœ¨è¯·æ±‚ä¸­æŒ‡å®šçš„<code>Range</code>å¤´</td>
</tr>
<tr>
<td><code>417 Expectation Failed</code></td>
<td>æ‰§è¡Œå¤±è´¥</td>
</tr>
<tr>
<td><code>423</code></td>
<td>é”å®šçš„é”™è¯¯</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="5xxä»£è¡¨æœåŠ¡å™¨é”™è¯¯"><code>5XX</code>ä»£è¡¨ï¼šæœåŠ¡å™¨é”™è¯¯</h3>
<blockquote>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>500 Internal Server Error</code></td>
<td>è¯·æ±‚æœªå®Œæˆã€‚æœåŠ¡å™¨é‡åˆ°ä¸å¯é¢„çŸ¥çš„æƒ…å†µ</td>
</tr>
<tr>
<td><code>500.12</code></td>
<td>åº”ç”¨ç¨‹åºæ­£å¿™äºåœ¨<code>Web</code>æœåŠ¡å™¨ä¸Šé‡å¯</td>
</tr>
<tr>
<td><code>500.13</code></td>
<td><code>Web</code>æœåŠ¡å™¨å¤ªå¿™</td>
</tr>
<tr>
<td><code>500.15</code></td>
<td>ä¸å…è®¸ç›´æ¥è¯·æ±‚<code>Global.asa</code></td>
</tr>
<tr>
<td><code>500.16</code></td>
<td><code>UNC</code>æˆæƒå‡­æ®ä¸æ­£ç¡®ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º<code>IIS 6.0</code>æ‰€ä¸“ç”¨</td>
</tr>
<tr>
<td><code>500.18</code></td>
<td><code>URL</code>æˆæƒå­˜å‚¨ä¸èƒ½æ‰“å¼€ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º<code>IIS 6.0</code>æ‰€ä¸“ç”¨</td>
</tr>
<tr>
<td><code>500.100</code></td>
<td>å†…éƒ¨<code>ASP</code>é”™è¯¯</td>
</tr>
<tr>
<td><code>501 Not Implemented</code></td>
<td>è¯·æ±‚æœªå®Œæˆã€‚æœåŠ¡å™¨ä¸æ”¯æŒæ‰€è¯·æ±‚çš„åŠŸèƒ½</td>
</tr>
<tr>
<td><code>502 Bad Gateway</code></td>
<td>è¯·æ±‚æœªå®Œæˆã€‚æœåŠ¡å™¨ä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªæ— æ•ˆçš„å“åº”</td>
</tr>
<tr>
<td><code>502.1</code></td>
<td><code>CGI</code>åº”ç”¨ç¨‹åºè¶…æ—¶</td>
</tr>
<tr>
<td><code>502.2</code></td>
<td><code>CGI</code>åº”ç”¨ç¨‹åºå‡ºé”™</td>
</tr>
<tr>
<td><code>503 Service Unavailable</code></td>
<td>è¯·æ±‚æœªå®Œæˆã€‚æœåŠ¡å™¨ä¸´æ—¶è¿‡è½½æˆ–å½“æœº</td>
</tr>
<tr>
<td><code>504 Gateway Timeout</code></td>
<td>ç½‘å…³è¶…æ—¶ã€<!-- raw HTML omitted -->åç«¯æœåŠ¡æ‰§è¡Œè¶…æ—¶ï¼ˆæ•°æ®åº“å–æ•°æ®å¾ˆæ…¢çš„æ—¶å€™ã€åç«¯è´Ÿè½½å¾ˆé«˜ã€è¿æ¥è¶…æ—¶ï¼‰ï¼Œ<code>Nginx</code>é»˜è®¤çš„ç­‰å¾…æ—¶é—´æ˜¯<code>60</code>ç§’ï¼Œè¶…è¿‡<code>60</code>ç§’<code>Nginx</code>å°±ä¼šè¿”å›<code>504</code><!-- raw HTML omitted --></td>
</tr>
<tr>
<td><code>505 HTTP Version Not Supported</code></td>
<td>æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚ä¸­æŒ‡æ˜çš„<code>HTTP</code>åè®®ç‰ˆæœ¬</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install-nginx">Install Nginx</h1>

<h2 id="å®‰è£…nginx">å®‰è£…<code>nginx</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.dedecms.com/" rel="external" target="_self"><code>DedeCms</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.discuz.net/" rel="external" target="_self"><code>Discuz!</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://wordpress.com/zh-cn/" rel="external" target="_self"><code>WordPress</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/bettershop/LaikeTui" rel="external" target="_self"><code>LaikeTui</code></a></td>
<td>æ¥å®¢æ¨å•†åŸ</td>
</tr>
<tr>
<td><a href="https://github.com/crmeb/CRMEB?tab=readme-ov-file" rel="external" target="_self"><code>CRMEB</code></a></td>
<td>å•†åŸ</td>
</tr>
<tr>
<td><a href="https://www.drupal.org/" rel="external" target="_self"><code>drupal CMS</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://openresty.org/cn/" rel="external" target="_self"><code>OpenResty</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://tengine.taobao.org/" rel="external" target="_self"><code>Nginx-Tengine</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://openresty.org/cn/" rel="external" target="_self"><code>Nginx-OpenResty</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cainiao.io/archives/988" rel="external" target="_self"><code>CentOS7</code>ä¸Šç¼–è¯‘å®‰è£…<code>Tengine</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://metasploit.com/" rel="external" target="_self"><code>Metasploit</code>æ¸—é€é¶æœº</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/digininja/DVWA" rel="external" target="_self"><code>DVWA</code>æ¸—é€æµ‹è¯•é¶æœº</a></td>
<td></td>
</tr>
<tr>
<td><a href="http://redtiger.labs.overthewire.org/" rel="external" target="_self">çº¢è™çš„é»‘å®¢<code>SQL</code>æ³¨å…¥</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/" rel="external" target="_self"><code>nginx documentation</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.businessprocessincubator.com/content/top-20-python-based-cms-that-every-developer-should-know/" rel="external" target="_self">æ¯ä¸ªå¼€å‘äººå‘˜éƒ½åº”è¯¥çŸ¥é“çš„åŸºäº<code>Python</code>çš„<code>20</code>å¤§<code>CMS</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.hws.com/soft/wzs/" rel="external" target="_self">æŠ¤å«ç¥</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…ä¾èµ–æ‰©å±•åŒ…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Debian ç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>$ sudo apt-get install libpcre3 libpcre3-dev zlib1g-dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install wget gcc gcc-c++ pcre-devel zlib-devel openssl openssl-devel</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>root</code><!-- raw HTML omitted -->ç”¨æˆ·ä¸‹è½½<!-- raw HTML omitted --><code>nginx</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget http://nginx.org/download/nginx-1.20.2.tar.gz -P /usr/local/src/
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/nginx-1.20.2.tar.gz  -C /usr/local/src/</span></span></code></pre></div><ul>
<li>2.1 <!-- raw HTML omitted -->è¿›å…¥åˆ°è§£å‹åçš„ç›®å½•è¿›è¡Œç¼–è¯‘å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/nginx-1.20.2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®</span>
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --with-http_ssl_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_v2_module --with-http_stub_status_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-pcre --with-http_gzip_static_module --with-http_dav_module  <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_addition_module  --with-http_sub_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_flv_module  --with-http_mp4_module
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¼–è¯‘ã€å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ make -j4 <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div><ul>
<li>2.2 <!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶ <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## chkconfig: - 99 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## description: Nginx Service Control Script
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PROG=&#34;/usr/local/nginx/sbin/nginx&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PIDF=&#34;/usr/local/nginx/logs/nginx.pid&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">case &#34;$1&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        $PROG
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        kill -3 $(cat $PIDF)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        $0 stop &amp;&gt; /dev/null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        if [ $? -ne 0 ] ; then continue ; fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        $0 start
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        reload)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        kill -1 $(cat $PIDF)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        *)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#34;Userage: $0 { start | stop | restart | reload }&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">esac
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">exit 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span> &gt;/etc/init.d/nginx</span></span></code></pre></div><ul>
<li>2.3 <!-- raw HTML omitted -->èµ‹äºˆæ‰§è¡Œæƒé™ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯  <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chmod +x /etc/init.d/nginx
</span></span><span style="display:flex;"><span>$ chkconfig --add nginx
</span></span><span style="display:flex;"><span>$ chkconfig nginx on
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨nginxæœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ /usr/local/nginx/sbin/nginx
</span></span><span style="display:flex;"><span>$ netstat -nuplt | grep :80</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->éå¸¸è§„å®‰è£…<!-- raw HTML omitted --><code>Nginx</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>3.1 <!-- raw HTML omitted -->åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ›å»ºï¼Œèµ‹äºˆæƒé™<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ¤æ–­æ˜¯å¦å­˜åœ¨  </span>
</span></span><span style="display:flex;"><span>$ id myadmin 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸å­˜åœ¨åˆ›å»º</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $? -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    groupadd group <span style="color:#f92672">&amp;&amp;</span> useradd -g myadmin myadmin
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;password&#34;</span>|passwd --stdin myadmin &amp;&gt;/dev/null
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># èµ‹äºˆæƒé™</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;#####  	Start/Stop Service  	#####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Cmnd_Alias MYADMIN_START_SERVICES = /opt/*, /usr/bin/kill, /etc/init.d/nginx, /opt/data/nginx/sbin/nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">myadmin ALL=(ALL)NOPASSWD:MYADMIN_START_SERVICES&#34;</span> &gt;/etc/sudoers.d/myadmin
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">660</span> /etc/sudoers.d/myadmin</span></span></code></pre></div><ul>
<li>3.2 <!-- raw HTML omitted -->åˆ›å»ºç›®å½•,èµ‹äºˆæƒé™  <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/<span style="color:#f92672">{</span>apps,src,conf,scripts<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chown -R admin:admin /opt/*</span></span></code></pre></div><ul>
<li>3.3 <!-- raw HTML omitted -->è¿›å…¥è§£å‹ç›®å½•ï¼Œé…ç½®ã€ç¼–è¯‘ã€å®‰è£… <!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p>3.3.1 <!-- raw HTML omitted --><code>nginx-auth-ldapã€--with-http_auth_request_module</code><!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ su admin -c <span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd /opt/src/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wget http://nginx.org/download/nginx-1.20.2.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">tar -zxvf nginx-1.20.2.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd nginx-1.20.2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">./configure --prefix=/opt/lucky/nginx \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-http_stub_status_module --with-http_ssl_module \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-http_gzip_static_module --with-ipv6 --with-stream \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-stream_ssl_module --with-http_v2_module \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-pcre --with-http_gzip_static_module \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-http_dav_module --with-http_addition_module \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-http_sub_module --with-http_flv_module \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-http_mp4_module --with-stream --user=myadmin --group=myadminÂ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">make -j4 &amp;&amp; make install
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo /opt/data/nginx/sbin/nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;</span>alias nginx<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sudo /etc/init.d/nginx&#39;</span><span style="color:#e6db74">&#34; &gt;&gt;/home/myadmin/.bashrc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>$ ss -unplt|grep <span style="color:#ae81ff">80</span></span></span></code></pre></div></blockquote>
<ul>
<li>3.4 <!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶ <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/init.d/nginx<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">NGINX_PATH=&#34;/opt/apps/nginx&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_nginx(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ${NGINX_PATH}/sbin/nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">stop_nginx(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	${NGINX_PATH}/sbin/nginx -s stop
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">reload_nginx(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	${NGINX_PATH}/sbin/nginx -s reload
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">check_nginx(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	${NGINX_PATH}/sbin/nginx -t
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">### Finally the input handling.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">case &#34;$1&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        start_nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        stop_nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  reload)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        reload_nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  -t)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        check_nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  *)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#34;Usage: service nginx {start|stop|reload|-t}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">esac
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>$ chmod +x /etc/init.d/nginx
</span></span><span style="display:flex;"><span>$ chkconfig --add nginx
</span></span><span style="display:flex;"><span>$ chkconfig nginx on</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/nginx.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=nginx - high performance web server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=http://nginx.org/en/docs/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network-online.target remote-fs.target nss-lookup.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=forking
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PidFile=/var/run/nginx.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecReload=/usr/local/nginx/sbin/nginx -s reload
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStop=/usr/local/nginx/sbin/nginx -s stop
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecQuit=/usr/local/nginx/sbin/nginx -s quit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ExecReload=/bin/kill -s HUP $MAINPID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ExecStop=/bin/kill -s QUIT $MAINPID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PrivateTmp=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable nginx.service <span style="color:#f92672">&amp;&amp;</span> systemctl start nginx</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ·»åŠ ç³»ç»Ÿç¯å¢ƒå˜é‡ã€é˜²ç«å¢™æ”¾è¡Œ<!-- raw HTML omitted --><code>httpã€https</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;N;56iexport PATH=/usr/local/nginx/sbin:</span>$PATH<span style="color:#e6db74">&#34;</span> /etc/profile
</span></span><span style="display:flex;"><span>$ source /etc/profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --zone<span style="color:#f92672">=</span>public --add-service<span style="color:#f92672">={</span>http,https<span style="color:#f92672">}</span> --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_nginx_third_party_modules">Install_Nginx_Third_Party_Modules</h1>

<h2 id="geoip2å®šä½æ¨¡å—"><code>GeoIP2</code>å®šä½æ¨¡å—</h2>
<blockquote>
<ul>
<li><code>GeoIP2</code><!-- raw HTML omitted -->æ¨¡å—ä¾èµ–<!-- raw HTML omitted --><code>libmaxminddb</code>åº“</li>
<li><a href="https://www.miyuru.lk/geoiplegacy" rel="external" target="_self"><code>GeoIP Legacy Databases</code></a></li>
</ul>
</blockquote>
<h3 id="libmaxminddbåº“"><code>libmaxminddb</code>åº“</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$  wget -c https://github.com/maxmind/libmaxminddb/releases/download/1.7.1/libmaxminddb-1.7.1.tar.gz -P /usr/local/src  	<span style="color:#75715e"># ä¸‹è½½åˆ°æŒ‡å®šç›®å½•ä¸‹:-cæ–­ç‚¹ç»­ä¼ ã€-Pä¸‹è½½æŒ‡å®šç›®å½•ï¼Œ  </span>
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/libmaxminddb-1.7.1.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/libmaxminddb-1.7.1
</span></span><span style="display:flex;"><span>$ ./configure
</span></span><span style="display:flex;"><span>$ make -j6 <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div></blockquote>
<h3 id="å®‰è£…geoip2">å®‰è£…<code>GeoIP2</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/leev/ngx_http_geoip2_module.git /usr/local/nginx/ngx_http_geoip2_module
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --add-module<span style="color:#f92672">=</span>/usr/local/nginx/ngx_http_geoip2_module</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ngx_brotliå‹ç¼©ç®—æ³•"><code>ngx_brotli</code>å‹ç¼©ç®—æ³•</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¸‹è½½ç®—æ³•åŒ…ï¼Œæ‰§è¡Œæ›´æ–°ngx_brotliä¾èµ–ç®—æ³•ï¼Œç®—æ³•ä¾èµ–è‡ªåŠ¨ä¸‹è½½</span>
</span></span><span style="display:flex;"><span>$ wget -c https://codeload.github.com/google/brotli/tar.gz/refs/tags/v1.1.0 -P /usr/local/src
</span></span><span style="display:flex;"><span>$ tar zxvf /usr/local/src/brotli-1.1.0.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸‹è½½å®‰è£…æ¨¡å—</span>
</span></span><span style="display:flex;"><span>$ git clone https://github.com/google/ngx_brotli /usr/local/nginx/ngx_brotli
</span></span><span style="display:flex;"><span>$ cd /usr/local/nginx/ngx_brotli
</span></span><span style="display:flex;"><span>$ git submodule update --init  	<span style="color:#75715e"># æ›´æ–°ngx_brotliä»¥æ¥ç®—æ³•</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mv /usr/local/src/brotli-1.1.0/* /usr/local/nginx/ngx_brotli/deps/brotli/</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åŠ¨æ€ç¼–è¯‘<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/nginx-1.20.2
</span></span><span style="display:flex;"><span>$ ./configure --with-compat --add-dynamic-module<span style="color:#f92672">=</span>/usr/local/src/ngx_brotli --prefix<span style="color:#f92672">=</span>/usr/local/nginx
</span></span><span style="display:flex;"><span>$ make modules
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‹·è´æ¨¡å—å’Œä¸»ç¨‹åºåˆ°Nginxå®‰è£…ç›®å½•ä¸‹æ–°åˆ›å»ºçš„æ–‡ä»¶å¤¹å†…ï¼šmodules</span>
</span></span><span style="display:flex;"><span>$ cp /usr/local/src/nginx-1.20.2/objs/ngx_http_brotli_static_module.so /usr/local/nginx/modules/ngx_http_brotli_static_module.so
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp /usr/local/src/nginx-1.20.2/objs/ngx_http_brotli_filter_module.so /usr/local/nginx/modules/ngx_http_brotli_filter_module.so
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp /usr/local/src/nginx-1.20.2/objs/nginx /usr/local/nginx/sbin/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨ngixn.confé…ç½®æ–‡ä»¶æœ€ä¸Šé¢åŠ¨æ€åŠ è½½æ¨¡å—</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/usr/local/nginx/conf/nginx.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">load_module /usr/local/nginx/modules/ngx_http_brotli_filter_module.so;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">load_module /usr/local/nginx/modules/ngx_http_brotli_static_module.so;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é™æ€ç¼–è¯‘<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/nginx-1.20.2
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --add-module<span style="color:#f92672">=</span>/usr/local/nginx/ngx_brotli</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h2 id="nginx-redis2æ¨¡å—"><code>Nginx-Redis2</code>æ¨¡å—</h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://github.com/openresty/redis2-nginx-module" rel="external" target="_self"><code>Redis2-Nginx-Module</code></a></li>
</ol>
</li>
<li><!-- raw HTML omitted -->å†™å…¥è¯·æ±‚<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>location <span style="color:#f92672">=</span> /foo <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    default_type text/html;
</span></span><span style="display:flex;"><span>    redis2_query auth password;
</span></span><span style="display:flex;"><span>    set $value <span style="color:#e6db74">&#39;first&#39;</span>;  	<span style="color:#75715e"># è®¾ç½®ä¸€ä¸ªå˜é‡</span>
</span></span><span style="display:flex;"><span>    redis2_query set one $value;  <span style="color:#75715e"># å˜é‡å†™å…¥å€¼</span>
</span></span><span style="display:flex;"><span>    redis2_pass 127.0.0.1:6379;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><ul>
<li><code>get</code><!-- raw HTML omitted -->è·å–å€¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>location <span style="color:#f92672">=</span> /get <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    default_type text/html;
</span></span><span style="display:flex;"><span>    redis2_pass 127.0.0.1:6379;
</span></span><span style="display:flex;"><span>    redis2_query auth password;
</span></span><span style="display:flex;"><span>    set_unescape_uri $key $arg_key;  <span style="color:#75715e"># ç¬¬ä¸‰æ–¹è½¬ä¹‰æ¨¡å—ï¼šngx_set_misc è¿›è¡Œurlç¼–ç è½¬ä¹‰</span>
</span></span><span style="display:flex;"><span>    redis2_query get $key;  	<span style="color:#75715e"># è·å–é”®å€¼</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h2 id="stickyä¼šè¯ä¿æŒæ¨¡å—"><code>Sticky</code>ä¼šè¯ä¿æŒæ¨¡å—</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#sticky" rel="external" target="_self">å®˜ç½‘<code>Sticky</code>æ–‡æ¡£</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/bymaximus/nginx-sticky-module-ng" rel="external" target="_self"><code>Github</code>ä»£ç æ‰˜ç®¡<code>Sticky</code>æ–‡æ¡£</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng/src/master/" rel="external" target="_self"><code>Google</code>å¼€å‘<code>Sticky</code>æ¨¡å—æ‰˜ç®¡åœ¨<code>Bitbuckey</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone git clone https://huanggua1234@bitbucket.org/nginx-goodies/nginx-sticky-module-ng.git
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --add-module<span style="color:#f92672">=</span>/usr/local/nginx/nginx_goodies-nginx-sticky-module-ng-c78b7dd79d0d
</span></span><span style="display:flex;"><span>$ make
</span></span><span style="display:flex;"><span>$ make upgrade  	<span style="color:#75715e"># æ£€æµ‹ç”„åˆ«ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œæ£€æŸ¥å¥½åæ‹·è´æ›¿æ¢makeåçš„å¯æ‰§è¡Œæ–‡ä»¶</span></span></span></code></pre></div><ul>
<li>
<ol>
<li><code>openssl</code><!-- raw HTML omitted -->ç¼–è¯‘æŠ¥é”™ä¿®æ”¹åŸæ–‡ä»¶ï¼Œåœ¨ç¬¬12è¡Œæ·»åŠ ä¸€ä¸‹ä¸¤è¡Œå†…å®¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;ngx_http_sticky_misc.c<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#include &lt;openssl/sha.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#include &lt;openssl/md5.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>
<ol start="2">
<li>ä½¿ç”¨<code>Sticky</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>name=route</code><!-- raw HTML omitted -->ä¸‹å‘<!-- raw HTML omitted --><code>cookie</code><!-- raw HTML omitted -->åç§°<!-- raw HTML omitted --></li>
<li><code>expires=6h;</code><!-- raw HTML omitted -->å®šä¹‰è¿‡æœŸæ—¶é—´<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;upstream.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sticky;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server 192.168.1.1:8080;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server 192.168.1.2:8080;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h2 id="concatåˆå¹¶è¯·æ±‚æ¨¡å—"><code>concat</code>åˆå¹¶è¯·æ±‚æ¨¡å—</h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://github.com/alibaba/nginx-http-concat" rel="external" target="_self"><code>Alibaba Concat</code>è¯·æ±‚åˆå¹¶æ¨¡å—</a></li>
</ol>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/alibaba/nginx-http-concat.git /usr/local/nginx/nginx-http-concat
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/nginx-1.20.2/
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --add-module<span style="color:#f92672">=</span>/usr/local/nginx/nginx-http-concat</span></span></code></pre></div></blockquote>
<hr>
<h2 id="upstream_checkåç«¯æœåŠ¡ç«¯å£æ£€æµ‹æ¨¡å—"><code>upstream_check</code>åç«¯æœåŠ¡ç«¯å£æ£€æµ‹æ¨¡å—</h2>
<blockquote>
<ul>
<li>
<ol>
<li>è®¿é—®<code>http://ip/status</code><!-- raw HTML omitted -->å°±çœ‹åˆ°ç›‘æ§é¡µé¢<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="http://tengine.taobao.org/document_cn/http_upstream_check_cn.html" rel="external" target="_self"><code>Tengine.taobao ngx_http_upstream_check_module</code></a></li>
</ol>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/yaoweibin/nginx_upstream_check_module.git /usr/local/nginx/nginx_upstream_check_module  	<span style="color:#75715e"># ä¸‹è½½æ£€æµ‹åŒ…  </span>
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/nginx-1.20.2/
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --add-module<span style="color:#f92672">=</span>/usr/local/nginx/nginx_upstream_check_module</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ngx_cache_purgeç¼“å­˜æ¸…ç†æ¨¡å—"><code>ngx_cache_purge</code>ç¼“å­˜æ¸…ç†æ¨¡å—</h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://github.com/FRICKLE/ngx_cache_purge" rel="external" target="_self"><code>Ngx_cache_purge</code></a></li>
</ol>
</li>
<li><!-- raw HTML omitted -->ç›¸åŒä½ç½®è¯­æ³•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    proxy_cache_path  /tmp/cache  keys_zone<span style="color:#f92672">=</span>tmpcache:10m;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            proxy_pass         http://127.0.0.1:8000;
</span></span><span style="display:flex;"><span>            proxy_cache        tmpcache;
</span></span><span style="display:flex;"><span>            proxy_cache_key    $uri$is_args$args;
</span></span><span style="display:flex;"><span>            proxy_cache_purge  PURGE from 127.0.0.1;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å•ç‹¬ä½ç½®è¯­æ³•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    proxy_cache_path  /tmp/cache  keys_zone<span style="color:#f92672">=</span>tmpcache:10m;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            proxy_pass         http://127.0.0.1:8000;
</span></span><span style="display:flex;"><span>            proxy_cache        tmpcache;
</span></span><span style="display:flex;"><span>            proxy_cache_key    $uri$is_args$args;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        location ~ /purge<span style="color:#f92672">(</span>/.*<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            allow              127.0.0.1;
</span></span><span style="display:flex;"><span>            deny               all;
</span></span><span style="display:flex;"><span>            proxy_cache_purge  tmpcache $1$is_args$args;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_nginx">Configure_Nginx</h1>

<h2 id="é…ç½®nginx">é…ç½®<code>Nginx</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.freenom.com/zh/index.html?lang=zh" rel="external" target="_self">å…è´¹åŸŸåç”³è¯·</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://vercel.com/" rel="external" target="_self"><code>Vercel CDN</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://beian.miit.gov.cn/#/Integrated/index" rel="external" target="_self">å·¥ä¿¡éƒ¨å¤‡æ¡ˆæŸ¥è¯¢</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.serverhunter.com/" rel="external" target="_self">æŸ¥æ‰¾ä¾¿å®œæœåŠ¡å™¨</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/zhongyehai/category/1406152.html?page=1" rel="external" target="_self">éšç¬”åˆ†ç±» - <code>Nginx</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://fly.io/" rel="external" target="_self"><code>fly.io</code>è¾¹ç¼˜æœåŠ¡å™¨</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://porkbun.com/" rel="external" target="_self"><code>Porkbun</code>åŸŸåè´­ä¹°å•†</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.domcomp.com/" rel="external" target="_self"><code>Domcomp</code>åŸŸåä»·æ ¼å¯¹æ¯”ç½‘ç«™</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://tld-list.com/" rel="external" target="_self"><code>TLD List</code>åŸŸåä»·æ ¼å¯¹æ¯”ç½‘ç«™</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/oneinstack/oneinstack" rel="external" target="_self"><code>Oneinstack</code></a></td>
<td>æœåŠ¡å®‰è£…è„šæœ¬</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><code>ab</code><!-- raw HTML omitted -->å‹åŠ›æµ‹è¯•å·¥å…·<!-- raw HTML omitted -->ï¼Œ<a href="https://www.charlesproxy.com/" rel="external" target="_self"><code>Charles</code>æŠ“åŒ…å·¥å…·</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install httpd-tools
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ab -n <span style="color:#ae81ff">50</span> -c <span style="color:#ae81ff">20</span> http://127.0.0.1/index.html  	<span style="color:#75715e"># -nï¼šæ€»å…±å‘èµ·çš„è¯·æ±‚æ•°ï¼Œè¿™é‡Œè®¾ç½®ä¸º50ã€</span>
</span></span><span style="display:flex;"><span>								<span style="color:#75715e"># -cï¼šåŒæ—¶å¹¶å‘çš„è¯·æ±‚ï¼Œè¿™é‡Œè®¾ç½®ä¸º20ä¸ªã€</span>
</span></span><span style="display:flex;"><span>								<span style="color:#75715e"># -kï¼šæ˜¯å¦å¼€å¯é•¿è¿æ¥</span></span></span></code></pre></div><ul>
<li><code>ab</code><!-- raw HTML omitted -->æ¢æµ‹åˆ°æ€§èƒ½æŒ‡æ ‡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Concurrency Level</code><!-- raw HTML omitted -->ï¼šè®¾å®šçš„å¹¶å‘æ•°<!-- raw HTML omitted --></li>
<li><code>Time taken for tests</code><!-- raw HTML omitted -->ï¼šå‹æµ‹æ€»å…±èŠ±è´¹çš„æ—¶é—´<!-- raw HTML omitted --></li>
<li><code>Complete requests</code><!-- raw HTML omitted -->ï¼šæ€»è¯·æ±‚æ•°<!-- raw HTML omitted --></li>
<li><code>Failed requests</code><!-- raw HTML omitted -->ï¼šå¤±è´¥çš„ä¸ªæ•°<!-- raw HTML omitted --></li>
<li><code>Requests per second</code><!-- raw HTML omitted -->ï¼šæ¯ç§’è¯·æ±‚æ•°<!-- raw HTML omitted --><code>TPS</code></li>
<li><code>Time per request</code><!-- raw HTML omitted -->ï¼šä»å®¢æˆ·ç«¯æ¥çœ‹ï¼Œä¸€ä¸ªè¯·æ±‚éœ€è¦ç”¨åˆ°çš„æ—¶é—´<!-- raw HTML omitted --></li>
<li><code>Time per request</code><!-- raw HTML omitted -->ï¼šä»æœåŠ¡ç«¯æ¥çœ‹ï¼Œå¤„ç†ä¸€ä¸ªè¯·æ±‚è¦èŠ±è´¹çš„æ—¶é—´<!-- raw HTML omitted --></li>
<li><code>Transfer rate</code><!-- raw HTML omitted -->ï¼šä¼ è¾“çš„é€Ÿç‡<!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>Nginx</code><!-- raw HTML omitted -->åŸºäº<!-- raw HTML omitted --><code>Lua</code><!-- raw HTML omitted -->åš<!-- raw HTML omitted --><code>Waf</code><!-- raw HTML omitted -->è§„åˆ™è¿‡æ»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://github.com/loveshell/ngx_lua_waf" rel="external" target="_self"><code>ngx_lua_waf</code></a></li>
</ul>
</blockquote>
<hr>
<h3 id="logrodateä½¿ç”¨"><code>logrodate</code>ä½¿ç”¨</h3>
<blockquote>
<ul>
<li></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ man logrotate  	<span style="color:#75715e">#  æŸ¥çœ‹ä½¿ç”¨è¯¦æƒ… </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/logrotate.d/nginx<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/nginx/logs/*.log{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">copytruncate  	# ç”¨äºè¿˜åœ¨æ‰“å¼€ä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼ŒæŠŠå½“å‰æ—¥å¿—å¤‡ä»½å¹¶æˆªæ–­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">daily  	# å®‰æ—¥æœŸè½®è½¬æ—¥å¿—ï¼šdaily(å¤©)ã€weekly(æœˆ)ã€monthly(æœˆ)ã€yearly(å¹´)ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dateext  	# æ–‡ä»¶åç¼€æ˜¯æ—¥æœŸæ ¼å¼,ä¹Ÿå°±æ˜¯åˆ‡å‰²åæ–‡ä»¶æ˜¯:xxx.log-20150828.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rotate 7  	# æŒ‡å®šæ—¥å¿—æ–‡ä»¶åˆ é™¤ä¹‹å‰è½¬å‚¨çš„æ¬¡æ•°ï¼Œ0æŒ‡æ²¡æœ‰å¤‡ä»½ï¼Œ7æŒ‡ä¿ç•™7ä¸ªå¤‡ä»½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">missingok  	# å¦‚æœæ—¥å¿—ä¸å­˜åœ¨åˆ™å¿½ç•¥è¯¥è­¦å‘Šä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">compress  	# é€šè¿‡gzipå‹ç¼©è½¬å‚¨ä»¥åçš„æ—¥å¿—ï¼ˆgzip -d xxx.gzè§£å‹ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notifempty  	# å¦‚æœæ˜¯ç©ºæ–‡ä»¶çš„è¯ï¼Œä¸è½¬å‚¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">size 100k	# åœ¨æ—¥å¿—å¤§å°å¤§äº logsizeï¼ˆä¾‹å¦‚ 100Kï¼Œ4Mï¼‰æ—¶è½®æ¢
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">su root root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰‹åŠ¨è°ƒè¯•éªŒè¯ï¼š-d</span>
</span></span><span style="display:flex;"><span>$ /usr/sbin/logrotate -d /etc/logrotate.d/nginx
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰‹åŠ¨å¼ºåˆ¶æ‰§è¡Œï¼š-f</span>
</span></span><span style="display:flex;"><span>$ /usr/sbin/logrotate -f /etc/logrotate.d/nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–°å¢åˆªé™¤7å¤©ä»¥å‰logå®šæ™‚è…³æœ¬  </span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;###nginxè¶…éä¸ƒå¤©logåˆªé™¤
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1 0 * * * /bin/bash /opt/scripts/DEL_NGINX.sh &gt;&gt; ~/del_tom.log 2&gt;&amp;1&#34;</span> &gt;&gt; /var/spool/cron/admin</span></span></code></pre></div></blockquote>
<hr>
<h3 id="jsonæ—¥å¿—æ ¼å¼"><code>Json</code>æ—¥å¿—æ ¼å¼</h3>
<blockquote>
<table>
<thead>
<tr>
<th>å˜é‡å</th>
<th>æè¿°</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>'&quot;@timestamp&quot;:&quot;$time_iso8601&quot;,'</code></td>
<td><code>ISO 8601</code>æ ‡å‡†æ ¼å¼çš„å½“åœ°æ—¶é—´</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;uri&quot;:&quot;$uri&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;args&quot;:&quot;$args&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;host&quot;:&quot;$host&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;https&quot;:&quot;$https&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;scheme&quot;:&quot;$scheme&quot;,' </code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;domain&quot;:&quot;$domain&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;status&quot;:&quot;$status&quot;,'</code></td>
<td><code>HTTP</code>è¯·æ±‚çŠ¶æ€ç </td>
<td><code>200 403 499 502 503</code></td>
</tr>
<tr>
<td><code>'&quot;request&quot;:&quot;$request&quot;,'</code></td>
<td>è¯·æ±‚çš„<code>URI</code>å’Œ<code>HTTP</code>åè®®</td>
<td><code>&quot;GET /api/img/home/logo-aipay.png HTTP/1.1&quot;</code></td>
</tr>
<tr>
<td><code>'&quot;hostname&quot;:&quot;$hostname&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_host&quot;:&quot;$http_host&quot;,'</code></td>
<td>è®¿é—®çš„åŸŸåæˆ–è€…<code>IP</code></td>
<td><code>www.domain.com</code><!-- raw HTML omitted -->192.168.1.1</td>
</tr>
<tr>
<td><code>'&quot;time_local&quot;:&quot;$time_local&quot;,'</code></td>
<td>é€šç”¨æ—¥å¿—æ ¼å¼ä¸­çš„æœ¬åœ°æ—¶é—´</td>
<td><code>18/Jul/2021:13:00:00 +0800</code></td>
</tr>
<tr>
<td><code>'&quot;ssl_cipher&quot;:&quot;$ssl_cipher&quot;,'</code></td>
<td>äº¤æ¢æ•°æ®ä¸­çš„ç®—æ³•</td>
<td><code>RC4-SHA</code></td>
</tr>
<tr>
<td><code>'&quot;requesturl&quot;:&quot;$request_uri&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;remote_addr&quot;:&quot;$remote_addr&quot;,'</code></td>
<td>å®¢æˆ·ç«¯åœ°å€</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;remote_user&quot;:&quot;$remote_user&quot;,'</code></td>
<td>å®¢æˆ·ç«¯ç”¨æˆ·åç§°</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;server_addr&quot;:&quot;$server_addr&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_cookie&quot;:&quot;$http_cookie&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_gp_xreal&quot;:&quot;$http_GP_IP&quot;,' </code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;ssl_protocol&quot;:&quot;$ssl_protocol&quot;,'</code></td>
<td><code>SSL</code>åè®®ç‰ˆæœ¬</td>
<td><code>TLSv1</code></td>
</tr>
<tr>
<td><code>'&quot;request_body&quot;:&quot;$request_body&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;request_time&quot;:&quot;$request_time&quot;,' </code></td>
<td>æ•´ä¸ªè¯·æ±‚çš„æ€»æ—¶é—´</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_referer&quot;:&quot;$http_referer&quot;,' </code></td>
<td>è·³è½¬æ¥æº</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;client_realip&quot;:&quot;$clientRealIp&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;upstream_addr&quot;:&quot;$upstream_addr&quot;,'</code></td>
<td><code>upstream</code>ä»£ç†çš„åç«¯æœåŠ¡åœ°å€</td>
<td><code>java tomcat php</code></td>
</tr>
<tr>
<td><code>'&quot;request_length&quot;:&quot;$request_length&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;upstream_status&quot;:&quot;$upstream_status&quot;,'</code></td>
<td><code>upstream</code>çŠ¶æ€ç </td>
<td><code>200 403 499 502 503</code></td>
</tr>
<tr>
<td><code>'&quot;body_bytes_sent&quot;:&quot;$body_bytes_sent&quot;,'</code></td>
<td>å‘é€ç»™å®¢æˆ·çš„æ–‡ä»¶å¤§å°</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,'</code></td>
<td>ç”¨æˆ·æµè§ˆå™¨è®¿é—®ç±»å‹</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_wangsu_xreal&quot;:&quot;$http_cdn_src_IP&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_ali_xreal&quot;:&quot;$http_Ali_CDN_Real_IP&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_cf_xreal&quot;:&quot;$http_CF_Connecting_IP&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_x_forwarded_for&quot;:&quot;$http_x_forwarded_for&quot;,'</code></td>
<td></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>'&quot;upstream_response_time&quot;:&quot;$upstream_response_time&quot;,'</code></td>
<td>è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œ<code>upstream</code>å“åº”æ—¶é—´</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>'&quot;proxy_add_x_forwarded_for&quot;:&quot;$proxy_add_x_forwarded_for&quot;,'</code></td>
<td>&mdash;</td>
<td>&mdash;</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">log_format</span> <span style="color:#e6db74">json</span> <span style="color:#e6db74">escape=json</span>  <span style="color:#e6db74">&#39;</span>{<span style="color:#f92672">&#34;@timestamp&#34;:&#34;$time_iso8601&#34;,&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;client_realip&#34;:&#34;</span>$clientRealIp&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;remote_addr&#34;:&#34;</span>$remote_addr&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;status&#34;:&#34;</span>$status&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;upstream_status&#34;:&#34;</span>$upstream_status&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request_time&#34;:&#34;</span>$request_time&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;upstream_response_time&#34;:&#34;</span>$upstream_response_time&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;upstream_addr&#34;:&#34;</span>$upstream_addr&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request&#34;:&#34;</span>$request&#34;,&#39;
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;&#34;http_scheme&#34;:&#34;</span>$http_X_Forwarded_Proto&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;server_name&#34;:&#34;</span>$host&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;uri&#34;:&#34;</span>$uri&#34;,&#39;
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;&#34;request_body&#34;:&#34;</span>$request_body&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;body_bytes_sent&#34;:&#34;</span>$body_bytes_sent&#34;,&#39;
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;&#34;bytes_sent&#34;:&#34;</span>$body_bytes_sent&#34;, <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request_length&#34;:&#34;</span>$request_length&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_referer&#34;:&#34;</span>$http_referer&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_wangsu_xreal&#34;:&#34;</span>$http_cdn_src_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_ali_xreal&#34;:&#34;</span>$http_Ali_CDN_Real_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_cf_xreal&#34;:&#34;</span>$http_CF_Connecting_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_gp_xreal&#34;:&#34;</span>$http_GP_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_x_forwarded_for&#34;:&#34;</span>$proxy_add_x_forwarded_for&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_user_agent&#34;:&#34;</span>$http_user_agent&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;xdevice&#34;:&#34;</span>$http_x_device&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;xversion&#34;:&#34;</span>$http_x_version&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;trace-id&#34;:&#34;</span>$http_x_trace_id&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;uid&#34;:&#34;</span>$http_x_id&#34;&#39;
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span><span style="color:#960050;background-color:#1e0010">}</span><span style="color:#e6db74">&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">è¿™é‡Œæ³¨æ„ä½¿ç”¨ä¸‹åˆ’çº¿ï¼Œ</span></span></span></code></pre></div><ul>
<li><code>Json</code><!-- raw HTML omitted -->æ–¹å¼æŸ¥çœ‹æ—¥å¿—<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tail -n1 /var/log/nginx/gitlab.log | awk -F <span style="color:#e6db74">&#39;&#34;&#39;</span> <span style="color:#e6db74">&#39;{if($3 == &#34;x.x.x.x&#34; &amp;&amp; $6 != &#34;403&#34;) {print $0}}&#39;</span> | jq</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ç³»ç»Ÿæ’æŸ¥">ç³»ç»Ÿæ’æŸ¥</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># URLè§£ç ã€ç¼–ç </span>
</span></span><span style="display:flex;"><span>$ yum -y install gridsite-clients
</span></span><span style="display:flex;"><span>$ tail -n10 nginx.logs | awk -F <span style="color:#e6db74">&#39;[:]&#39;</span> <span style="color:#e6db74">&#39;{print $24}&#39;</span> | xargs urlencode -d decode
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åå°åŠ ç™½</span>
</span></span><span style="display:flex;"><span>$ sed -Ei <span style="color:#e6db74">&#34;s@((([0-9]{1,3}\.?){4})+)@\1|{{ ip }}@&#34;</span> /usr/local/nginx/conf/vhosts/ white_list.ini
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤åŠ ç™½</span>
</span></span><span style="display:flex;"><span>$ sed -Ei <span style="color:#e6db74">&#34;s@((\|?){{ ip }}\|?)@\2@&#34;</span> /usr/local/nginx/conf/vhosts/ white_list.ini
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ’æŸ¥ç³»ç»Ÿä¸­å†…å­˜å ç”¨å‰ 5 çš„è¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>$ ps -eo pid,ppid,cmd,%mem,%cpu --sort<span style="color:#f92672">=</span>-%mem |head -5
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nginx</span>
</span></span><span style="display:flex;"><span>$ netstat -ntu|awk <span style="color:#e6db74">&#39;{print $5}&#39;</span>|cut -d: -f1|wc -l  	<span style="color:#75715e"># æŸ¥çœ‹æ–‡ä»¶æ‰“å¼€æ•°é‡</span>
</span></span><span style="display:flex;"><span>$ netstat -n | awk <span style="color:#e6db74">&#39;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&#39;</span>  	<span style="color:#75715e"># æŸ¥çœ‹æœåŠ¡å™¨ç½‘ç»œè´Ÿè½½</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tail -n100 /opt/logs/nginx/web_access.log |awk <span style="color:#e6db74">&#39;{print $1}&#39;</span> |sort -rn |uniq -c |sort -rn |head
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘½ä»¤è¡Œè·¨åŸŸæµ‹è¯• -iï¼šå…è®¸è·¨åŸŸçš„åŸŸåï¼Œ-Hï¼šè®¿é—®åŸŸå</span>
</span></span><span style="display:flex;"><span>$ curl -i https://baidu.com/text.txt -H <span style="color:#e6db74">&#34;Origin: http://www.example.com&#34;</span></span></span></code></pre></div><ul>
<li>æ‰“å¼€æµè§ˆå™¨æŒ‰<code>F12</code>ç„¶åè®¿é—®è·¨åŸŸåŸŸåï¼ŒæŸ¥çœ‹æ˜¯å¦æ˜¾ç¤ºæœ‰ï¼š<code>access-control-allow-origin: *</code>è·¨åŸŸå‚æ•°</li>
</ul>
</blockquote>
<hr>
<h3 id="nginxconfé…ç½®æ–‡ä»¶"><code>nginx.conf</code>é…ç½®æ–‡ä»¶</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># ç”¨æˆ·å’Œç»„: user nobody nogroup;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">user</span> <span style="color:#e6db74">nobody</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nginxè¿›ç¨‹æ•°ï¼Œautoä¸ºè‡ªåŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">worker_processes</span> <span style="color:#e6db74">auto</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">worker_cpu_affinity</span>  <span style="color:#e6db74">auto</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆulimit -nï¼‰ä¸ nginx è¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯ nginx åˆ†é…è¯·æ±‚å¹¶ä¸æ˜¯é‚£ä¹ˆå‡åŒ€ï¼Œæ‰€ä»¥æœ€å¥½ä¸ ulimit -n çš„å€¼ä¿æŒä¸€è‡´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">worker_rlimit_nofile</span> <span style="color:#ae81ff">51200</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">error_log</span> <span style="color:#e6db74">/usr/local/nginx/logs/web_error.log</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pid</span> <span style="color:#e6db74">/usr/local/nginx/logs/nginx.pid</span>;</span></span></code></pre></div><ul>
<li><code>events</code><!-- raw HTML omitted -->å‚æ•°é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">events</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ä½¿ç”¨epollçš„I/Oæ¨¡å‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">use</span> <span style="color:#e6db74">epoll</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># æ¯ä¸ªè¿›ç¨‹å…è®¸çš„æœ€å¤šè¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">worker_connections</span>  <span style="color:#ae81ff">2048</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">multi_accept</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>	}</span></span></code></pre></div></blockquote>
<ul>
<li><code>http</code><!-- raw HTML omitted -->å‚æ•°é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">http</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">log_format</span> <span style="color:#e6db74">main</span> <span style="color:#e6db74">&#39;</span>$remote_addr <span style="color:#e6db74">-</span> $remote_user <span style="color:#e6db74">[</span>$time_iso8601] <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;fwf[</span>$http_x_forwarded_for] <span style="color:#e6db74">tip[</span>$http_true_client_ip] <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;</span>$upstream_addr $upstream_response_time $request_time <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;</span>$http_host $request <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;&#34;</span>$status&#34; $body_bytes_sent $request_body <span style="color:#e6db74">&#34;</span>$http_referer&#34; <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;&#34;</span>$http_accept_language&#34; <span style="color:#e6db74">&#34;</span>$http_user_agent&#34; <span style="color:#e6db74">&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">access_log</span>  <span style="color:#e6db74">/usr/local/nginx/logs/web_access.log</span>  <span style="color:#e6db74">main</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># è°ƒç”¨ mime.types è¯·æ±‚å¤´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span>             <span style="color:#e6db74">mime.types</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># é»˜è®¤æ•°æ®æµæ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">default_type</span>        <span style="color:#e6db74">application/octet-stream</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># åŸºæœ¬é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/basic.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ç¼“å­˜é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e"># include inc.d/cache.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># fastcgi é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/fastcgi.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># å‹ç¼©é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/compaction.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> 	<span style="color:#75715e"># IP é™åˆ¶é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/ip-limits.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> 	<span style="color:#75715e"># è¯·æ±‚å¤´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/proxy_set_header.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> 	<span style="color:#75715e"># æ—¥å¿—é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/logs.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> 	<span style="color:#75715e"># è®¿é—®é¢‘ç‡é™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/limit-speed.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> 	<span style="color:#75715e"># è·¨åŸŸ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/cross-domain.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> 	<span style="color:#75715e"># åä»£ç¼“å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/reverse-proxy.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">vhosts/*.conf</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">vhosts/*/*.conf</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åŸºæœ¬é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/basic.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹luaè„šæœ¬åä¸é‡å¯nginxé…ç½®ï¼Œ å¯¹æœåŠ¡æ€§èƒ½ä¸å‹å¥½ï¼Œè„šæœ¬ç¼–å†™æœŸé—´ä½¿ç”¨æ­¤é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">lua_code_cache</span> <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿå‘½ä¸€ä¸ªåç§°ä¸ºï¼šshared_dataï¼Œå¤§å°ï¼š1Mbå†…å­˜ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">lua_shared_dict</span> <span style="color:#e6db74">shared_data</span> <span style="color:#ae81ff">1m</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ˜¾ç¤ºjsonæ•°æ®ä¸­æ–‡ä¹±ç é—®é¢˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">charset</span> <span style="color:#e6db74">utf-8</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é›¶æ‹·è´æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">sendfile</span>	<span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½œç”¨ï¼šsendfileå¼€å¯çš„æƒ…å†µä¸‹ï¼Œæé«˜ç½‘ç»œåŒ…çš„ä¼ è¾“æ•ˆç‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">tcp_nopush</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">tcp_nodelay</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># keepalive è¶…æ—¶æ—¶é—´ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">keepalive_timeout</span>  <span style="color:#ae81ff">90</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸€ä¸ªTcpå¤ç”¨ä¸­ï¼Œå¯ä»¥å¹¶å‘æ¥å—çš„è¯·æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">keepalive_requests</span> <span style="color:#ae81ff">1000</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">server_names_hash_max_size</span> <span style="color:#ae81ff">1024</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nginxå…³æ‰ç‰ˆæœ¬å·
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">server_tokens</span> <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">server_names_hash_bucket_size</span> <span style="color:#ae81ff">128</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">large_client_header_buffers</span> <span style="color:#ae81ff">8</span> <span style="color:#ae81ff">128k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">client_max_body_size</span> <span style="color:#ae81ff">8m</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">client_header_buffer_size</span> <span style="color:#ae81ff">4k</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸é…ç½®æˆ–è€…æ˜¯off,è¯·æ±‚å¤´ä¸­çš„è‡ªå®šä¹‰è¯·æ±‚å¤´ç”¨ - è¿æ¥æ˜¯æ”¯æŒçš„ï¼Œä¸è¦é…ç½® _ æ¥æ¥æ”¶,å¦‚æœæ˜¯ä¸‹åˆ’çº¿ _ è‡ªå®šä¹‰è¯·æ±‚å¤´ä¼šä¸¢å¤±
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">underscores_in_headers</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_buffer_size</span> <span style="color:#ae81ff">32k</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¯»å–ä¸Šæ¸¸æœåŠ¡å™¨èµ„æºï¼Œè¾¹è¯»è¾¹å‘é€æ•°æ®èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">proxy_buffering</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨å†…å­˜ä¸­åˆ’åˆ†32ä¸ª128Kå¤§å°çš„å†…å­˜ç¼“å†²å—ï¼Œç¼“å†²æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">proxy_buffers</span> <span style="color:#ae81ff">32</span> <span style="color:#ae81ff">128k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_connect_timeout</span> <span style="color:#ae81ff">60</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_read_timeout</span> <span style="color:#ae81ff">60</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_send_timeout</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¯»å–proxy_passæ•°æ®å†™å…¥åˆ°ç£ç›˜çš„æœ€å¤§å€¼ï¼Œé»˜è®¤1G
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">proxy_max_temp_file_size</span> <span style="color:#ae81ff">1024m</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_busy_buffers_size</span> <span style="color:#ae81ff">128k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_temp_file_write_size</span> <span style="color:#ae81ff">128k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_headers_hash_max_size</span> <span style="color:#ae81ff">51200</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_headers_hash_bucket_size</span> <span style="color:#ae81ff">6400</span>;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¼“å­˜é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/cache.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰“å¼€æ–‡ä»¶æŒ‡å®šç¼“å­˜ï¼Œé»˜è®¤æ²¡å¯ç”¨ï¼ŒmaxæŒ‡å®šç¼“å­˜æ•°é‡ï¼Œå»ºè®®å’Œæ‰“å¼€æ–‡ä»¶æ•°ä¸€è‡´ï¼Œinactiveæ˜¯æŒ‡ç»è¿‡å¤šé•¿æ—¶é—´æ–‡ä»¶æ²¡è¢«è¯·æ±‚ååˆ é™¤ç¼“å­˜ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">open_file_cache</span> <span style="color:#e6db74">max=102400</span> <span style="color:#e6db74">inactive=20s</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ˜¯æŒ‡å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡ç¼“å­˜çš„æœ‰æ•ˆä¿¡æ¯ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">open_file_cache_valid</span> <span style="color:#e6db74">30s</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># open_file_cache æŒ‡ä»¤ä¸­çš„ inactive å‚æ•°æ—¶é—´å†…æ–‡ä»¶çš„æœ€å°‘ä½¿ç”¨æ¬¡æ•°ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶åœ¨ inactive æ—¶é—´å†…ä¸€æ¬¡æ²¡è¢«ä½¿ç”¨ï¼Œå®ƒå°†è¢«ç§»é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">open_file_cache_min_uses</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡ä»¤ä¸º FastCGI ç¼“å­˜æŒ‡å®šä¸€ä¸ªè·¯å¾„ï¼Œç›®å½•ç»“æ„ç­‰çº§ï¼Œå…³é”®å­—åŒºåŸŸå­˜å‚¨æ—¶é—´å’Œéæ´»åŠ¨åˆ é™¤æ—¶é—´ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fastcgi_cache_path</span> <span style="color:#e6db74">/usr/local/nginx/fastcgi_cache</span> <span style="color:#e6db74">levels=1:2</span> <span style="color:#e6db74">keys_zone=TEST:10m</span> <span style="color:#e6db74">inactive=5m</span>;</span></span></code></pre></div><ul>
<li><code>fastcgi</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/fastcgi.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fastcgi_connect_timeout</span> <span style="color:#ae81ff">300</span>;  	<span style="color:#75715e"># æŒ‡å®šè¿æ¥åˆ°åç«¯ FastCGI çš„è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fastcgi_send_timeout</span> <span style="color:#ae81ff">300</span>;  	<span style="color:#75715e"># å‘ FastCGI ä¼ é€è¯·æ±‚çš„è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fastcgi_read_timeout</span> <span style="color:#ae81ff">300</span>;  	<span style="color:#75715e"># æ¥æ”¶ FastCGI åº”ç­”çš„è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fastcgi_buffer_size</span> <span style="color:#ae81ff">64k</span>;  	<span style="color:#75715e"># æŒ‡å®šè¯»å–FastCGIåº”ç­”ç¬¬ä¸€éƒ¨åˆ†éœ€ç”¨å¤šå¤§ç¼“å†²åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fastcgi_buffers</span> <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">64k</span>;  	<span style="color:#75715e"># æŒ‡å®šæœ¬åœ°éœ€ç”¨å¤šå°‘å’Œå¤šå¤§ç¼“å†²åŒºç¼“å†²FastCGIçš„åº”ç­”ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fastcgi_busy_buffers_size</span> <span style="color:#ae81ff">128k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fastcgi_temp_file_write_size</span> <span style="color:#ae81ff">128k</span>;  	<span style="color:#75715e"># åœ¨å†™å…¥ fastcgi_temp_path æ—¶å°†ç”¨å¤šå¤§çš„æ•°æ®å—ï¼Œé»˜è®¤å€¼æ˜¯ fastcgi_buffers çš„ä¸¤å€ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># fastcgi_cache TEST  	# å¼€å¯FastCGIç¼“å­˜å¹¶ä¸”ä¸ºå…¶åˆ¶å®šä¸€ä¸ªåç§°ï¼Œå¯ä»¥æœ‰æ•ˆé™ä½CPU è´Ÿè½½ï¼Œå¹¶ä¸”é˜²æ­¢ 502 é”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># fastcgi_cache_valid 200 302 1h;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># fastcgi_cache_valid 301 1d;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># fastcgi_cache_valid any 1m;  	# ä¸ºæŒ‡å®šåº”ç­”ä»£ç æŒ‡å®šç¼“å­˜æ—¶é—´,å¦‚å°†200,302åº”ç­”ç¼“å­˜ä¸€å°æ—¶,301åº”ç­”ç¼“å­˜1å¤©.å…¶ä»–ä¸º1åˆ†é’Ÿã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#66d9ef">fastcgi_cache_min_uses</span> <span style="color:#ae81ff">1</span>;  	<span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#66d9ef">ç¼“å­˜åœ¨</span> <span style="color:#e6db74">fastcgi_cache_pathæŒ‡ä»¤inactiveå‚æ•°å€¼æ—¶é—´å†…çš„æœ€å°‘ä½¿ç”¨æ¬¡æ•°,å¦‚æœåœ¨5åˆ†é’Ÿå†…æŸæ–‡ä»¶1æ¬¡ä¹Ÿæ²¡æœ‰è¢«ä½¿ç”¨,é‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°†è¢«ç§»é™¤ã€‚</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å‹ç¼©é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/compaction.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># brotliå‹ç¼©ç®—æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">brotli</span>			<span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">brotli_comp_level</span>	<span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">brotli_buffers</span>		<span style="color:#ae81ff">16</span> <span style="color:#ae81ff">8k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">brotli_min_length</span>	<span style="color:#ae81ff">256</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">brotli_types</span>		<span style="color:#e6db74">text/plain</span> <span style="color:#e6db74">application/javascript</span> <span style="color:#e6db74">application/x-javascript</span> <span style="color:#e6db74">text/javascript</span> <span style="color:#e6db74">text/css</span> <span style="color:#e6db74">application/xml</span> <span style="color:#e6db74">application/json</span> <span style="color:#e6db74">image/jpeg</span> <span style="color:#e6db74">image/gif</span> <span style="color:#e6db74">image/png</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">brotli_window</span>		<span style="color:#ae81ff">512k</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gzipå‹ç¼©ç®—æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">gzip</span>	<span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_comp_level</span>  <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©ï¼š64ä½æ“ä½œç³»ç»Ÿä¸ºï¼š16 8kï¼Œ32ä½æ“ä½œç³»ç»Ÿï¼š32 4k
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">gzip_buffers</span>     <span style="color:#ae81ff">16</span> <span style="color:#ae81ff">8k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_min_length</span>  <span style="color:#ae81ff">1k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_types</span>       <span style="color:#e6db74">text/plain</span> <span style="color:#e6db74">application/javascript</span> <span style="color:#e6db74">application/x-javascript</span> <span style="color:#e6db74">text/javascript</span> <span style="color:#e6db74">text/css</span> <span style="color:#e6db74">application/xml</span> <span style="color:#e6db74">application/xml+rss</span> <span style="color:#e6db74">application/json</span> <span style="color:#e6db74">text/xml</span> <span style="color:#e6db74">image/jpeg</span> <span style="color:#e6db74">image/gif</span> <span style="color:#e6db74">image/png</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_disable</span>     <span style="color:#e6db74">&#34;msie6&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_http_version</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">.1</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_vary</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_proxied</span>     <span style="color:#e6db74">any</span> <span style="color:#e6db74">expired</span> <span style="color:#e6db74">no-cache</span> <span style="color:#e6db74">no-store</span> <span style="color:#e6db74">private</span> <span style="color:#e6db74">auth</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_disable</span> <span style="color:#e6db74">&#34;MSIE</span> <span style="color:#e6db74">[1-6]\.&#34;</span>;</span></span></code></pre></div><ul>
<li><code>IP</code><!-- raw HTML omitted -->é™åˆ¶é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/ip-limits.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $http_upgrade $connection_upgrade {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">default</span> <span style="color:#e6db74">upgrade</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#39;&#39;</span>	<span style="color:#e6db74">close</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $http_cdn-src-IP $ali_xreal {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;&#34;</span>   $http_Ali-CDN-Real-IP;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">~^(?P&lt;firstAddr&gt;[0-9\.]+),?.*$</span> $firstAddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $ali_xreal $cf_xreal {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;&#34;</span>  $http_CF-Connecting-IP;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">~^(?P&lt;firstAddr&gt;[0-9\.]+),?.*$</span> $firstAddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $cf_xreal  $gp_xreal {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;&#34;</span> $http_GP_IP;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">~^(?P&lt;firstAddr&gt;[0-9\.]+),?.*$</span> $firstAddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $gp_xreal  $xrealip {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;&#34;</span> $http_x_forwarded_for ;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">~^(?P&lt;firstAddr&gt;[0-9\.]+),?.*$</span> $firstAddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $xrealip  $clientRealIp {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;&#34;</span> $remote_addr;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">~^(?P&lt;firstAddr&gt;[0-9\.]+),?.*$</span> $firstAddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####  	GeoIPè®¿é—®IPé™åˆ¶  #####
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># geoip_country	GeoIP/GeoIP.dat;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># geoip_city		GeoIP/GeoLiteCity.dat;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># geoip_proxy		0.0.0.0/0;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># geoip_proxy_recursive on;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># geo $remote_addr $ip_whitelist {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	default 0;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	include ip.conf;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">geoip2</span> <span style="color:#e6db74">/usr/local/nginx/conf/GeoLite2-Country/GeoLite2-Country.mmdb</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">$geoip2_data_country_code</span> <span style="color:#e6db74">country</span> <span style="color:#e6db74">iso_code</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">$geoip2_data_country_name</span> <span style="color:#e6db74">country</span> <span style="color:#e6db74">iso_code</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">geoip2</span> <span style="color:#e6db74">/usr/local/nginx/conf/GeoLite2-City/GeoLite2-City.mmdb</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">$geoip2_data_city_name</span> <span style="color:#e6db74">city</span> <span style="color:#e6db74">iso_code</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®1: å…è®¸æ‰€æœ‰å›½å®¶è®¿é—®ï¼Œé™¤äº†ç¾å›½å’Œæ—¥æœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">map</span> $geoip2_data_country_code $allowed_country {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">default</span> <span style="color:#e6db74">yes</span>;  	<span style="color:#75715e"># é»˜è®¤é…ç½® yesï¼šå…è®¸æ‰€æœ‰ï¼Œnoï¼šæ‹’ç»æ‰€æœ‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">US</span> <span style="color:#e6db74">no</span>;  	<span style="color:#75715e"># å•ç‹¬é…ç½®æ‹’ç»
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">JP</span> <span style="color:#e6db74">no</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">CN</span> <span style="color:#e6db74">yes</span>;  	<span style="color:#75715e"># å•ç‹¬é…ç½®å…è®¸ï¼Œå‰ææ˜¯ï¼šdefault no;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># geoip_country /usr/local/nginx/GeoIP/GeoIP.dat;  # Geoipæ‰€åœ¨ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># map $geoip_country_code $allowed_country {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	default yes;    # å…è®¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	CN no;      # ä¸­å›½å¤§é™†åŒºå‘½åä¸ºno
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#66d9ef">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è¯·æ±‚å¤´<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/proxy_set_header.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_set_header</span> <span style="color:#e6db74">X-Real-IP</span> $clientRealIp;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $remote_addr;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $proxy_add_x_forwarded_for;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ—¥å¿—é…ç½®ï¼Œä»¥åŠé…ç½®<!-- raw HTML omitted --><code>Json</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/logs.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $upstream_response_time $upstream_response_timer {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">default</span> $upstream_response_time;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;&#34;</span>        <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">log_format</span> <span style="color:#e6db74">json</span> <span style="color:#e6db74">escape=json</span>  <span style="color:#e6db74">&#39;</span>{<span style="color:#f92672">&#34;@timestamp&#34;:&#34;$time_iso8601&#34;,&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;client_realip&#34;:&#34;</span>$clientRealIp&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;remote_addr&#34;:&#34;</span>$remote_addr&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;status&#34;:&#34;</span>$status&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;upstream_status&#34;:&#34;</span>$upstream_status&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request_time&#34;:&#34;</span>$request_time&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;upstream_response_time&#34;:&#34;</span>$upstream_response_time&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;upstream_addr&#34;:&#34;</span>$upstream_addr&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request&#34;:&#34;</span>$request&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_scheme&#34;:&#34;</span>$http_X_Forwarded_Proto&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;server_name&#34;:&#34;</span>$host&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;uri&#34;:&#34;</span>$uri&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request_body&#34;:&#34;</span>$request_body&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;body_bytes_sent&#34;:&#34;</span>$body_bytes_sent&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;bytes_sent&#34;:&#34;</span>$body_bytes_sent&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request_length&#34;:&#34;</span>$request_length&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_referer&#34;:&#34;</span>$http_referer&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_wangsu_xreal&#34;:&#34;</span>$http_cdn_src_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_ali_xreal&#34;:&#34;</span>$http_Ali_CDN_Real_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_cf_xreal&#34;:&#34;</span>$http_CF_Connecting_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_gp_xreal&#34;:&#34;</span>$http_GP_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_x_forwarded_for&#34;:&#34;</span>$proxy_add_x_forwarded_for&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_user_agent&#34;:&#34;</span>$http_user_agent&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;xdevice&#34;:&#34;</span>$http_x_device&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;xversion&#34;:&#34;</span>$http_x_version&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;trace-id&#34;:&#34;</span>$http_x_trace_id&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;uid&#34;:&#34;</span>$http_x_id&#34;&#39;
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span><span style="color:#960050;background-color:#1e0010">}</span><span style="color:#e6db74">&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">è¿™é‡Œæ³¨æ„ä½¿ç”¨ä¸‹åˆ’çº¿ï¼Œ</span>		</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¿é—®é¢‘ç‡é™åˆ¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/limit-speed.ini; 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é™é€Ÿé…ç½®æŒ‡ä»¤
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">limit_conn_log_level</span> <span style="color:#e6db74">error</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®¢æˆ·ç«¯å¹¶å‘è®¿é—®æ•°é™åˆ¶ï¼Œåå­—ä¸ºip_limitï¼Œå¤§å°ä¸º15Mbçš„å†…å­˜ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">limit_conn_zone</span> $binary_remote_addr <span style="color:#e6db74">zone=ip_limit:15m</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®¢æˆ·ç«¯ qps é¢‘ç‡è®¿é—®é™åˆ¶é…ç½®ã€åˆ†é…ä¸€ä¸ª10Mbçš„å†…å­˜ç©ºé—´ï¼ŒåŒä¸€ä¸ªIPä¸€ç§’é’Ÿå…è®¸5r(5æ¬¡è¯·æ±‚)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">limit_req_zone</span>  $binary_remote_addr <span style="color:#e6db74">zone=one:10m</span> <span style="color:#e6db74">rate=5r/s</span>;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·¨åŸŸé…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/cross-domain.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">add_header</span> <span style="color:#e6db74">Access-Control-Allow-Origin</span> <span style="color:#e6db74">*</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">add_header</span> <span style="color:#e6db74">Access-Control-Allow-Methods</span> <span style="color:#e6db74">GET,POST,OPTIONS</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">add_header</span> <span style="color:#e6db74">Access-Control-Allow-Headers</span> <span style="color:#e6db74">DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization</span>;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åä»£ç¼“å­˜<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/reverse-proxy.ini; 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åä»£ç¼“å­˜é…ç½®ï¼Œkeys_zone=af:1024m ä¸­çš„ï¼š1024mæ˜¯åœ¨å†…å­˜ä¸­å ç”¨çš„ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">proxy_temp_path</span>   <span style="color:#e6db74">/var/www/temp</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_cache_path</span> <span style="color:#e6db74">/var/www/temp/baidu</span> <span style="color:#e6db74">levels=1:2</span> <span style="color:#e6db74">keys_zone=af:1024m</span> <span style="color:#e6db74">inactive=1h</span> <span style="color:#e6db74">max_size=10g</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_cache_path</span> <span style="color:#e6db74">/var/www/temp/ali</span> <span style="color:#e6db74">levels=1:2</span> <span style="color:#e6db74">keys_zone=yunlai01:1024m</span> <span style="color:#e6db74">inactive=1h</span> <span style="color:#e6db74">max_size=10g</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_cache_path</span> <span style="color:#e6db74">/var/www/temp/jd</span>  <span style="color:#e6db74">levels=1:2</span> <span style="color:#e6db74">keys_zone=vns01:1024m</span> <span style="color:#e6db74">inactive=1h</span> <span style="color:#e6db74">max_size=10g</span>;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="confå­é…ç½®æ–‡ä»¶"><code>conf</code>å­é…ç½®æ–‡ä»¶</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://zyan.cc/nginx_php_v5" rel="external" target="_self"><code>Nginx</code>ä¸»é…ç½®æ–‡ä»¶å‚è€ƒèµ„æ–™</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>server</code><!-- raw HTML omitted -->å‚æ•°é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><blockquote>
<ul>
<li><code>HSTS</code><!-- raw HTML omitted -->å®‰å…¨ç­–ç•¥æœºåˆ¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Strict-Transport-Security</code>è¿™æ˜¯<code>HSTS</code>å¤´éƒ¨çš„åç§°ã€‚<code>HSTS</code>æ˜¯ä¸€ç§<code>web</code>å®‰å…¨ç­–ç•¥æœºåˆ¶ï¼Œå¸®åŠ©ä¿æŠ¤ç½‘ç«™å…å—ä¸­é—´äººæ”»å‡»ï¼Œç¡®ä¿ç”¨æˆ·ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å§‹ç»ˆä½¿ç”¨<code>HTTPS</code></li>
<li><code>max-age</code>æŒ‡å®šäº†æµè§ˆå™¨åº”å½“ç¼“å­˜è¯¥ç­–ç•¥çš„æœ‰æ•ˆæ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œ<code>86400</code>ç§’ç­‰äº<code>24</code>å°æ—¶</li>
<li><code>includeSubdomains</code>è¿™ä¸ªå‚æ•°æŒ‡ç¤ºæµè§ˆå™¨å¯¹æ‰€æœ‰å­åŸŸåä¹Ÿåº”ç”¨<code>HSTS</code>ç­–ç•¥</li>
<li><code>preload</code>å‚æ•°åï¼Œåº”è¯¥ç¡®ä¿ç½‘ç«™å§‹ç»ˆæ”¯æŒ<code>HTTPS</code>ï¼Œå¦åˆ™ä¼šå¯¼è‡´è®¿é—®é”™è¯¯ã€‚</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">add_header</span> <span style="color:#e6db74">Strict-Transport-Security</span> <span style="color:#e6db74">&#34;max-age=86400</span>; <span style="color:#f92672">includeSubdomains</span>; <span style="color:#f92672">preload&#34;</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
<ul>
<li><code>server_name</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span> <span style="color:#e6db74">default_server</span>;  	<span style="color:#75715e"># å¦‚æœæ²¡æœ‰å…¶ä»–serverå—åŒ¹é…è¯·æ±‚çš„Hostå¤´ï¼Œä½¿ç”¨è¿™ä¸ªä½œä¸ºé»˜è®¤å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">443</span> <span style="color:#e6db74">ssl</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">8443</span> <span style="color:#e6db74">ssl</span> <span style="color:#e6db74">proxy_protocol</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">ssl</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># .domain.comåŒ¹é…æ‰€æœ‰ä»¥.domain.comç»“å°¾çš„è¯·æ±‚ åŒ…æ‹¬æ‰€æœ‰å­åŸŸåï¼Œ^baidu\d+\.com åŒ…å«ä»»æ„æ•°å­—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">server_name</span> <span style="color:#e6db74">domain.com</span> <span style="color:#e6db74">.domain.com</span>$ <span style="color:#e6db74">^baidu\d+\.com</span>$;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è¯ä¹¦é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">ssl_certificate</span>      <span style="color:#e6db74">certs/domain/domain.com.crt</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">ssl_certificate_key</span>  <span style="color:#e6db74">certs/domain/domain.com.key</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ssl_dhparam certs/domain/dhparam.pem;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">ssl_session_cache</span>    <span style="color:#e6db74">shared:SSL:10m</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">ssl_session_timeout</span>  <span style="color:#ae81ff">30m</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">ssl_protocols</span> <span style="color:#e6db74">TLSv1</span> <span style="color:#e6db74">TLSv1.1</span> <span style="color:#e6db74">TLSv1.2</span> <span style="color:#e6db74">TLSv1.3</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">ssl_ciphers</span> <span style="color:#e6db74">&#39;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:!RC4:!MD5:!aNULL:!NULL&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># ä¼˜å…ˆä½¿ç”¨æœåŠ¡å™¨é…ç½®çš„åŠ å¯†å¥—ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">ssl_prefer_server_ciphers</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">resolver</span> <span style="color:#ae81ff">8</span><span style="color:#e6db74">.8.8.8</span> <span style="color:#e6db74">valid=300</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">resolver_timeout</span> <span style="color:#e6db74">10s</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># å¼€å¯ OCSP Stapling
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">ssl_stapling</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># éªŒè¯ OCSP å“åº”
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">ssl_stapling_verify</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>} </span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¼ºè·³è¯ä¹¦ä»¥åŠä¸»åŸŸå<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># httpå¼ºè·³443ï¼Œ æˆ–ä½¿ç”¨ $host å­—æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span> $scheme = <span style="color:#e6db74">http</span> <span style="color:#e6db74">)</span>{ 
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">return</span> <span style="color:#ae81ff">301</span> <span style="color:#e6db74">https://</span>$server_name$request_uri; 
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># å¼ºè·³ä¸»åŸŸå
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span> $host <span style="color:#e6db74">!=</span> <span style="color:#e6db74">&#39;domain.com&#39;</span> <span style="color:#e6db74">)</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">rewrite</span> <span style="color:#e6db74">^(.*)</span>$ <span style="color:#e6db74">https://domain.com/</span>$1 <span style="color:#e6db74">permanent</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># é¿å…ç›´æ¥è¿”å› 404ï¼Œè€Œæ˜¯è¿”å›åº”ç”¨çš„ä¸»å…¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">try_files</span> $uri $uri/ <span style="color:#e6db74">/index.html</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><code>location</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>location</code><!-- raw HTML omitted -->åŒ¹é…è§„åˆ™ä»¥åŠä¼˜å…ˆçº§<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->ç²¾ç¡®åŒ¹é…<!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted -->å‰ç¼€åŒ¹é…<!-- raw HTML omitted -->ä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„ï¼Œä¸€æ—¦åŒ¹é…åˆ°ä¸€ä¸ªå°±ç›´æ¥èµ°æ­¤<code>location</code>ï¼Œåˆ™ä¸ä¼šå†å¾€ä¸‹åŒ¹é…ã€‚
<!-- raw HTML omitted -->æ­£åˆ™åŒ¹é…<!-- raw HTML omitted -->å°±ç®—åŒ¹é…åˆ°ä¸€ä¸ª<code>location</code>ï¼Œä¹Ÿè¿˜æ˜¯ä¼šæ¥ç€åŒ¹é…ï¼Œçœ‹æ—¶å€™è¿˜æœ‰æ¯”å½“å‰<code>location</code>æ›´å®Œæ•´ï¼Œæ›´åŒ¹é…çš„<code>location</code>å­˜åœ¨ï¼Œåé¢æ²¡æœ‰äº†ï¼Œæ‰åŒ¹é…æœ¬èº«</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>æ­£åˆ™ç¬¦å·</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>~</code></td>
<td>è¡¨ç¤ºå¼€å§‹æ­£åˆ™åŒ¹é…</td>
</tr>
<tr>
<td><code>~*</code></td>
<td>è¡¨ç¤ºæ­£åˆ™åŒ¹é…<!-- raw HTML omitted -->ä¸åŒºåˆ†å¤§å°å†™<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><code>=</code></td>
<td>è¿›è¡Œæ™®é€šå­—ç¬¦ç²¾ç¡®åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯å®Œå…¨åŒ¹é…</td>
</tr>
<tr>
<td><code>^~</code></td>
<td>è¡¨ç¤ºæ™®é€šå­—ç¬¦åŒ¹é…ï¼Œä½¿ç”¨å‰ç¼€åŒ¹é…</td>
</tr>
<tr>
<td><code>~ \~*</code></td>
<td>è¡¨ç¤ºæ‰§è¡Œä¸€ä¸ªæ­£åˆ™åŒ¹é…ï¼ˆï¼‰</td>
</tr>
<tr>
<td>`/(xxx</td>
<td>xxx</td>
</tr>
<tr>
<td><code>$</code></td>
<td>è¡¨ç¤º<!-- raw HTML omitted -->æ­£åˆ™ç»“æŸç¬¦<!-- raw HTML omitted -->å·</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># è¿™ä¸ªéå¸¸é‡è¦ï¼Œå¦‚æœgitåº“é‡Œæœ‰å¤§æ–‡ä»¶ï¼Œè®¾ç½®å¤ªå°ï¼Œæ–‡ä»¶pushä¼šå¤±è´¥ï¼Œæ ¹æ®æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">client_max_body_size</span> <span style="color:#ae81ff">50m</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ç¦ç”¨é‡å®šå‘å¤„ç†ï¼Œé»˜è®¤é‡å®šå‘ï¼šdefault
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_redirect</span> <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># ä»¥ä¸‹ç¡®ä¿ gitlabä¸­é¡¹ç›®çš„ url æ˜¯åŸŸåè€Œä¸æ˜¯ http://gitï¼Œä¸å¯ç¼ºå°‘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-IP</span> $remote_addr;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-Port</span> $remote_port;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_connect_timeout</span> <span style="color:#e6db74">15s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_read_timeout</span> <span style="color:#e6db74">600s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_send_timeout</span> <span style="color:#e6db74">60s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># è®¾ç½®httpç‰ˆæœ¬ä¸º1.1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_http_version</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">.1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å‡çº§åè®®å¤´ websocket
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Upgrade</span> $http_upgrade;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Connection</span> <span style="color:#e6db74">&#34;upgrade&#34;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å‡çº§åè®®å¤´ä¸ºhttps
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Upgrade-Insecure-Requests</span> <span style="color:#ae81ff">1</span>;   
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-Proto</span> <span style="color:#e6db74">https</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">add_header</span> <span style="color:#e6db74">Content-Security-Policy</span> <span style="color:#e6db74">upgrade-insecure-requests</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">add_header</span> <span style="color:#e6db74">Nginx-Cache</span> <span style="color:#e6db74">â€œ</span>$upstream_cache_statusâ€;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># nginx åå‘ä»£ç†åˆ° gitlab å®¹å™¨æš´éœ²çš„ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://127.0.0.1:8080</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">index</span> <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">.*\.(gif|jpg|jpeg|png|bmp|swf)$</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://127.0.0.1:8082</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_redirect</span> <span style="color:#e6db74">default</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $remote_addr;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">add_header</span> <span style="color:#e6db74">Nginx-Cache</span> <span style="color:#e6db74">&#34;</span>$upstream_cache_status&#34;;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">expires</span> <span style="color:#e6db74">30d</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">.*\.(js|css)?$</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">expires</span> <span style="color:#e6db74">12h</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">/\.</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">deny</span> <span style="color:#e6db74">all</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># è¿‡æ»¤åªå…è®¸GETï¼ŒHEADå’ŒPOSTæ–¹æ³•è¯·æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span>$request_method <span style="color:#e6db74">!~</span> <span style="color:#e6db74">^(GET|HEAD|POST)</span>$ <span style="color:#e6db74">)</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">return</span> <span style="color:#ae81ff">444</span>;
</span></span><span style="display:flex;"><span>	}   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">### é˜»æ­¢User-Agents,å¦‚æ‰«æå™¨ï¼Œæœºå™¨äººä»¥åŠæ»¥ç”¨ä½ æœåŠ¡å™¨çš„åƒåœ¾é‚®ä»¶å‘é€è€…ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span>$http_user_agent ~<span style="color:#e6db74">*</span> <span style="color:#e6db74">LWP::Simple|BBBike|wget|&#34;Windows</span> <span style="color:#ae81ff">5</span><span style="color:#e6db74">.1&#34;)</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">return</span> <span style="color:#ae81ff">405</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç¦æ­¢<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->è®¿é—®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><a href="https://developer.aliyun.com/article/548497" rel="external" target="_self"><code>Nginx</code>ç¦æ­¢<code>IP</code>è®¿é—® åªå…è®¸åŸŸåè®¿é—®</a></li>
<li><!-- raw HTML omitted -->æ–¹å¼ä¸€<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">server_name</span> <span style="color:#e6db74">www.domain.com</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span>$host <span style="color:#e6db74">!=</span> <span style="color:#e6db74">&#39;www.domain.com&#39;)</span>{ <span style="color:#f92672">return</span> <span style="color:#ae81ff">403</span>; }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ–¹å¼äºŒ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ ä¸€ä¸ª<!-- raw HTML omitted --><code>server</code>ï¼Œ<!-- raw HTML omitted -->æ–°åŠ çš„<!-- raw HTML omitted --><code>server</code><!-- raw HTML omitted -->ï¼ˆæ³¨æ„æ˜¯æ–°å¢ï¼Œå¹¶ä¸æ˜¯åœ¨åŸæœ‰çš„<!-- raw HTML omitted --><code>server</code><!-- raw HTML omitted -->åŸºç¡€ä¸Šä¿®æ”¹ï¼‰ <!-- raw HTML omitted --></li>
<li><code>rewrite</code><!-- raw HTML omitted -->é‡å®šå‘<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>å¼€å§‹å­—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.</code></td>
<td>åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦</td>
</tr>
<tr>
<td><code>?</code></td>
<td>é‡å¤0æ¬¡æˆ–1æ¬¡</td>
</tr>
<tr>
<td><code>+</code></td>
<td>é‡å¤1æ¬¡æˆ–å¤šæ¬¡</td>
</tr>
<tr>
<td><code>*</code></td>
<td>æœ€å°‘è¿æ¥æ•°ã€é‚£ä¸ªæœºå™¨è¿æ¥æ•°å°‘å°±åˆ†å‘</td>
</tr>
<tr>
<td><code>\d</code></td>
<td>åŒ¹é…æ•°å­—</td>
</tr>
<tr>
<td><code>^</code></td>
<td>åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹</td>
</tr>
<tr>
<td><code>$</code></td>
<td>åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ</td>
</tr>
<tr>
<td><code>{n}</code></td>
<td>é‡å¤<code>n</code>æ­¤</td>
</tr>
<tr>
<td><code>{n,}</code></td>
<td>é‡å¤<code>n</code>æˆ–æ›´å¤šæ¬¡</td>
</tr>
<tr>
<td><code>[c]</code></td>
<td>åŒ¹é…å•ä¸ªå­—ç¬¦<code>c</code></td>
</tr>
<tr>
<td><code>[a-z]</code>ï¼Œ<code>[A-Z]</code></td>
<td>åŒ¹é…<code>a-z</code>å°å†™å­—æ¯çš„ä»»æ„ä¸€ä¸ªï¼Œ<code>[^a-z]</code>è¡¨ç¤ºå–åï¼ŒåŒ¹é…<code>A-z</code>å¤§å†™å­—æ¯ä¸­ä»»æ„ä¸€ä¸ªï¼Œ<code>[^A-Z]</code>è¡¨ç¤ºå–å</td>
</tr>
<tr>
<td><code>[0-9]</code></td>
<td>åŒ¹é…<code>0-9</code>æ•°å­—çš„ä»»æ„ä¸€ä¸ªï¼Œ<code>[^0-9]</code>è¡¨ç¤ºå–å</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>ç»“å°¾å®šä¹‰å­—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>last</code></td>
<td>åŒ¹é…å®Œæˆåï¼Œç»§ç»­å‘ä¸‹åŒ¹é…æ–°çš„<code>location URL</code>è§„åˆ™</td>
</tr>
<tr>
<td><code>break</code></td>
<td>åŒ¹é…å®Œæˆå³åœæ­¢å‘ä¸‹åŒ¹é…</td>
</tr>
<tr>
<td><code>redirect</code></td>
<td>è¿”å›302ä¸´æ—¶é‡å®šå‘ã€åœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬ååœ°å€</td>
</tr>
<tr>
<td><code>permanent</code></td>
<td>è¿”å›301æ°¸ä¹…é‡å®šå‘ã€åœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬ååœ°å€</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span> <span style="color:#e6db74">dufault</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">server_name</span> <span style="color:#e6db74">_</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">return</span> <span style="color:#ae81ff">403</span>;  	<span style="color:#75715e"># ç›´æ¥è¿”å›ä¸€ä¸ª403
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">rewrite</span> <span style="color:#e6db74">^(.*)</span> <span style="color:#e6db74">http://domain.com</span> <span style="color:#e6db74">permanent</span>;  	<span style="color:#75715e"># æˆ–è€…è·³è½¬åˆ°å…¶ä»–åŸŸå
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¦æ­¢IPè®¿é—® 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">server</span> { 
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span> <span style="color:#e6db74">default</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">server_name</span> <span style="color:#e6db74">_</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">server_name</span>  <span style="color:#e6db74">domain.com</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">return</span> <span style="color:#ae81ff">500</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æ–‡ä»¶ä¸‹è½½<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># å¯ç”¨ç›®å½•æµè§ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">autoindex</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># è®¾ç½®ä¸ºoff æ—¶ï¼Œæ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼Œæ˜“äºç†è§£çš„å•ä½ï¼ˆå¦‚ KBã€MB ç­‰ï¼‰ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">autoindex_exact_size</span> <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># è®¾ç½®ä¸ºon æ—¶ï¼Œæ˜¾ç¤ºçš„æ—¶é—´å°†æ ¹æ®æœåŠ¡å™¨çš„æœ¬åœ°æ—¶é—´æ¥æ˜¾ç¤º
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">autoindex_localtime</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">location</span> ~ {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ—¥å¿—åˆ‡å‰²<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span>$time_iso8601 ~ <span style="color:#e6db74">&#34;^(\d</span>{<span style="color:#f92672">4})-(\d{2})-(\d{2})&#34;)</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">set</span> $year $1;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">set</span> $month $2;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">set</span> $day $3;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">error_page</span> <span style="color:#ae81ff">404</span> <span style="color:#e6db74">http://domain.com</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">access_log</span>  <span style="color:#e6db74">/home/logs/nginx/domain.access_</span>$year-$month-$day.log  <span style="color:#e6db74">main</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">error_log</span>   <span style="color:#e6db74">/home/logs/nginx/domain.error.log</span>  <span style="color:#e6db74">info</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®è·³è½¬<!-- raw HTML omitted --><code>Web</code><!-- raw HTML omitted -->æˆ–<!-- raw HTML omitted --><code>H5</code></li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://blog.csdn.net/weixin_43890705/article/details/112391597?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-3.vipsorttest&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-3.vipsorttest" rel="external" target="_self"><code>Nginx</code>åŒºåˆ†æ‰‹æœºç«¯å’Œ<code>PC</code>æ®µè·³è½¬ä¸åŒç›®å½•</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://blog.csdn.net/weixin_34128501/article/details/91370181?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-4.vipsorttest&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-4.vipsorttest" rel="external" target="_self"><code>nginx</code>é…ç½®æ‰‹æœºç«¯<code>PC</code>ç«¯è®¿é—®ä¸åŒçš„é¡¹ç›®</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://blog.csdn.net/weixin_37008947/article/details/105725236" rel="external" target="_self"><code>nginx</code>æ ¹æ®<code>PC</code>ç«¯è¿˜æ˜¯æ‰‹æœºç«¯è®¾ç½®ä¸åŒçš„ç½‘ç«™æ ¹ç›®å½•</a></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">root</span> <span style="color:#e6db74">/var/www/web/pc</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">index</span>  <span style="color:#e6db74">index.php</span> <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">location</span> <span style="color:#e6db74">^~</span> <span style="color:#e6db74">/api</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">rewrite</span> <span style="color:#e6db74">^/api/(.*)</span>$ <span style="color:#e6db74">/</span>$1 <span style="color:#e6db74">break</span>;
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://swofit/</span>;
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-IP</span> $remote_addr;
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-Port</span> $remote_port;
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å¦‚æœæ˜¯æ‰‹æœºç§»åŠ¨ç«¯è®¿é—®å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span> $http_user_agent ~<span style="color:#e6db74">*</span> <span style="color:#e6db74">&#34;(MIDP)|(WAP)|(UP.Browser)|(Smartphone)|(Obigo)|(Mobile)|(AU.Browser)|(wxd.Mms)|(WxdB.Browser)|(CLDC)|(UP.Link)|(KM.Browser)|(UCWEB)|(SEMC-Browser)|(Mini)|(Symbian)|(Palm)|(Nokia)|(Panasonic)|(MOT-)|(SonyEricsson)|(NEC-)|(Alcatel)|(Ericsson)|(BENQ)|(BenQ)|(Amoisonic)|(Amoi-)|(Capitel)|(PHILIPS)|(SAMSUNG)|(Lenovo)|(Mitsu)|(Motorola)|(SHARP)|(WAPPER)|(LG-)|(LG/)|(EG900)|(CECT)|(Compal)|(kejian)|(Bird)|(BIRD)|(G900/V1.0)|(Arima)|(CTL)|(TDG)|(Daxian)|(DAXIAN)|(DBTEL)|(Eastcom)|(EASTCOM)|(PANTECH)|(Dopod)|(Haier)|(HAIER)|(KONKA)|(KEJIAN)|(LENOVO)|(Soutec)|(SOUTEC)|(SAGEM)|(SEC-)|(SED-)|(EMOL-)|(INNO55)|(ZTE)|(iPhone)|(ipad)|(Android)|(Windows</span> <span style="color:#e6db74">CE)|(Wget)|(Java)|(curl)|(Opera)|(htc)|(blackberry)&#34;</span> <span style="color:#e6db74">)</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">root</span> <span style="color:#e6db74">/var/www/web/mobile</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">index</span> <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">try_files</span> $uri $uri/ <span style="color:#e6db74">@router</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">.*\.(gif|jpg|jpeg|png|bmp|swf)$</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">expires</span>      <span style="color:#e6db74">30d</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">.*\.(js|css)?$</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">expires</span>      <span style="color:#e6db74">12h</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">/\.</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">deny</span> <span style="color:#e6db74">all</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span>$time_iso8601 ~ <span style="color:#e6db74">&#34;^(\d</span>{<span style="color:#f92672">4})-(\d{2})-(\d{2})&#34;)</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">set</span> $year $1;
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">set</span> $month $2;
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">set</span> $day $3;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">error_page</span> <span style="color:#ae81ff">404</span> <span style="color:#e6db74">http://domian.com</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">access_log</span>  <span style="color:#e6db74">/home/logs/nginx/domain.access_</span>$year-$month-$day.log  <span style="color:#e6db74">main</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">error_log</span>   <span style="color:#e6db74">/home/logs/nginx/domain.error.log</span>  <span style="color:#e6db74">info</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆ–è€…ä½¿ç”¨ä¸‹é¢æ–¹æ³•ã€try_filesç”¨äºæŒ‰é¡ºåºæ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è¿”å›æ–‡ä»¶å†…å®¹ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œé…çš„å¯¹åº”è§„åˆ™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">root</span> <span style="color:#e6db74">/opt/www/cms-web</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">index</span>  <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">try_files</span> $uri $uri/ <span style="color:#e6db74">/index.html</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">location</span> <span style="color:#e6db74">/m/</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">alias</span> <span style="color:#e6db74">/opt/www/cms-web/m/</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">index</span>  <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">try_files</span> $uri $uri/ <span style="color:#e6db74">/m/index.html</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
<ul>
<li><code>Nginx</code><!-- raw HTML omitted -->ä»£ç†<!-- raw HTML omitted --><code>Gitlab</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">listen</span> <span style="color:#ae81ff">80</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">listen</span> <span style="color:#ae81ff">443</span> <span style="color:#e6db74">ssl</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">listen</span> <span style="color:#ae81ff">8081</span> <span style="color:#e6db74">ssl</span> <span style="color:#e6db74">default_server</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># æ­¤åŸŸåæ˜¯æä¾›ç»™æœ€ç»ˆç”¨æˆ·çš„è®¿é—®åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">server_name</span> <span style="color:#e6db74">gitlab.com</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># é¿å…ç›´æ¥è¿”å› 404ï¼Œè€Œæ˜¯è¿”å›åº”ç”¨çš„ä¸»å…¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">try_files</span> $uri $uri/ <span style="color:#e6db74">/index.html</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ä¸»é¡µé¢ä¸å…è®¸ç¼“å­˜ï¼ˆé¿å…é¡¹ç›®å‡çº§ ç©ºç™½é¡µçš„é—®é¢˜ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">location</span> <span style="color:#e6db74">/index.html</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">add_header</span> <span style="color:#e6db74">Expires</span> <span style="color:#e6db74">-1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">add_header</span> <span style="color:#e6db74">Cache-Control</span> <span style="color:#e6db74">no-cache</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># è¿™ä¸ªéå¸¸é‡è¦ï¼Œå¦‚æœgitåº“é‡Œæœ‰å¤§æ–‡ä»¶ï¼Œè®¾ç½®å¤ªå°ï¼Œæ–‡ä»¶pushä¼šå¤±è´¥ï¼Œæ ¹æ®æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">client_max_body_size</span> <span style="color:#ae81ff">50m</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_redirect</span> <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># ä»¥ä¸‹ç¡®ä¿ gitlabä¸­é¡¹ç›®çš„ url æ˜¯åŸŸåè€Œä¸æ˜¯ http://gitï¼Œä¸å¯ç¼ºå°‘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-IP</span> $remote_addr;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å‡çº§åè®®å¤´ websocket
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_http_version</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">.1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Upgrade</span> $http_upgrade;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Connection</span> <span style="color:#e6db74">&#34;upgrade&#34;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å‡çº§åè®®å¤´ä¸ºhttps
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Upgrade-Insecure-Requests</span> <span style="color:#ae81ff">1</span>;   
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-Proto</span> <span style="color:#e6db74">https</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">add_header</span> <span style="color:#e6db74">Content-Security-Policy</span> <span style="color:#e6db74">upgrade-insecure-requests</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># nginx åå‘ä»£ç†åˆ° gitlab å®¹å™¨æš´éœ²çš„ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://127.0.0.1:8080</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">index</span> <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">error_page</span> <span style="color:#ae81ff">404</span> <span style="color:#e6db74">http://gitlab.com</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">access_log</span>  <span style="color:#e6db74">/usr/local/nginx/logs/gitlab.access.log</span>  <span style="color:#e6db74">main</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">error_log</span>   <span style="color:#e6db74">/usr/local/nginx/logs/gitlab.error.log</span>  <span style="color:#e6db74">info</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="nginxé›†ç¾¤åå‘ä»£ç†"><code>nginx</code>é›†ç¾¤ï¼Œåå‘ä»£ç†</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->é›†ç¾¤ä»‹ç»<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>é›†ç¾¤å°±æ˜¯ä¸€ç»„ç›¸äº’ç‹¬ç«‹çš„è®¡ç®—æœºï¼Œåˆ©ç”¨é«˜é€Ÿç›¸åŒçš„é€šä¿¡ç½‘ç»œç»„æˆä¸€ä¸ªè¾ƒå¤§çš„è®¡ç®—æœºæœåŠ¡ç³»ç»Ÿï¼Œæ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹éƒ½å¯ä»¥å„è‡ªè¿è¡ŒæœåŠ¡ï¼Œå¹¶ä¸”èƒ½å½¼æ­¤é€šä¿¡ï¼ŒååŒå‘å®¢æˆ·æä¾›æœåŠ¡ã€‚ç»Ÿä¸€ç®¡ç†çš„æ¨¡å¼ã€‚ç”¨æˆ·è¯·æ±‚é›†ç¾¤ç³»ç»Ÿæ—¶ï¼Œé›†ç¾¤ç³»ç»Ÿç»™ç”¨æˆ·çš„æ„Ÿå—æ˜¯ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡å™¨ï¼Œå®é™…ä¸Šç”¨æˆ·è¯·æ±‚çš„æ˜¯ä¸€ç»„é›†ç¾¤æœåŠ¡å™¨</li>
<li>æ‰“å¼€è°·æ­Œã€ç™¾åº¦çš„é¡µé¢ï¼Œçœ‹åˆ°èµ·æ¥æ˜¯å¥½ç®€å•ã€ä¹Ÿè®¸ä½ è§‰å¾—å‡ åˆ†é’Ÿå¯ä»¥åˆ¶ä½œå‡ºç±»ä¼¼çš„ç½‘é¡µï¼Œè€Œå®é™…ä¸Šï¼Œè¿™ä¸ªé¡µé¢èƒŒåæ˜¯ç”±æˆåƒä¸Šä¸‡å°æœåŠ¡å™¨ååŒå·¥ä½œçš„ç»“æœã€‚é‚£ä¹ˆå¤šå°æœåŠ¡å™¨ç»´æŠ¤å’Œç®¡ç†ï¼Œä»¥åŠç›¸äº’åè°ƒå·¥ä½œå°±æ˜¯è¯»è€…æœªæ¥çš„å·¥ä½œèŒè´£</li>
<li>ä¸€èˆ¬æ˜¯æŒ‡åœ¨é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¤±æ•ˆçš„æƒ…å†µä¸‹ï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ä»»åŠ¡ä¼šè‡ªåŠ¨è½¬ç§»åˆ°å…¶ä»–æ­£å¸¸çš„èŠ‚ç‚¹ä¸Šã€‚æ­¤è¿‡ç¨‹å¹¶ä¸å½±å“æ•´ä¸ªé›†ç¾¤çš„è¿è¡Œ</li>
<li>å½“é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ç³»ç»Ÿå‘ç”Ÿæ•…éšœæ—¶ï¼Œè¿è¡Œç€çš„é›†ç¾¤æœåŠ¡ä¼šè¿…é€Ÿåšå‡ºååº”ï¼Œå°†è¯¥ç³»ç»Ÿçš„æœåŠ¡åˆ†é…åˆ°é›†ç¾¤ä¸­å…¶ä»–æ­£åœ¨å·¥ä½œçš„ç³»ç»Ÿä¸Šè¿è¡Œã€‚è€ƒè™‘åˆ°è®¡ç®—æœºç¡¬ä»¶å’Œè½¯ä»¶çš„å®¹é”™æ€§ï¼Œé«˜å¯ç”¨æ€§é›†ç¾¤çš„ä¸»è¦ç›®çš„æ˜¯ä½¿é›†ç¾¤çš„æ•´ä½“æœåŠ¡å°½å¯èƒ½å¯ç”¨ã€‚å¦‚æœé«˜å¯ç”¨æ€§é›†ç¾¤ä¸­çš„ä¸»èŠ‚ç‚¹å‘ç”Ÿäº†æ•…éšœï¼Œé‚£ä¹ˆè¿™æ®µæ—¶é—´å†…å°†ç”±å¤‡èŠ‚ç‚¹ä»£æ›¿å®ƒã€‚å¤‡èŠ‚ç‚¹é€šå¸¸æ˜¯ä¸»èŠ‚ç‚¹çš„é•œåƒã€‚å½“å®ƒä»£æ›¿ä¸»èŠ‚ç‚¹æ—¶ï¼Œå®ƒå¯ä»¥å®Œå…¨æ¥ç®¡ä¸»èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬<code>IP</code>åœ°å€åŠå…¶ä»–èµ„æºï¼‰æä¾›æœåŠ¡ï¼Œå› æ­¤ï¼Œä½¿é›†ç¾¤ç³»ç»Ÿç¯å¢ƒå¯¹äºç”¨æˆ·æ¥è¯´æ˜¯ä¸€è‡´çš„ï¼Œå³ä¸ä¼šå½±å“ç”¨æˆ·çš„è®¿é—®ã€‚é«˜å¯ç”¨æ€§é›†ç¾¤ä½¿æœåŠ¡å™¨ç³»ç»Ÿçš„è¿è¡Œé€Ÿåº¦å’Œå“åº”é€Ÿåº¦ä¼šå°½å¯èƒ½çš„å¿«ã€‚å®ƒä»¬ç»å¸¸åˆ©ç”¨åœ¨å¤šå°æœºå™¨ä¸Šè¿è¡Œçš„å†—ä½™èŠ‚ç‚¹å’ŒæœåŠ¡æ¥ç›¸äº’è·Ÿè¸ªã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹å¤±è´¥ï¼Œå®ƒçš„æ›¿è¡¥è€…å°†åœ¨å‡ ç§’é’Ÿæˆ–æ›´çŸ­æ—¶é—´å†…æ¥ç®¡å®ƒçš„èŒè´£ã€‚å› æ­¤ï¼Œå¯¹äºç”¨æˆ·è€Œè¨€ï¼Œé›†ç¾¤é‡Œçš„ä»»æ„ä¸€å°æœºå™¨å®•æœºï¼Œä¸šåŠ¡éƒ½ä¸ä¼šå—å½±å“</li>
<li>é«˜æ€§èƒ½è®¡ç®—é›†ç¾¤ä¹Ÿç§°å¹¶è¡Œè®¡ç®—ã€‚é€šå¸¸ï¼Œé«˜æ€§èƒ½è®¡ç®—é›†ç¾¤æ¶‰åŠä¸ºé›†ç¾¤å¼€å‘çš„å¹¶è¡Œåº”ç”¨ç¨‹åºï¼Œä»¥è§£å†³å¤æ‚çš„ç§‘å­¦é—®é¢˜ï¼ˆå¤©æ°”é¢„æŠ¥ã€çŸ³æ²¹å‹˜æ¢ã€æ ¸ååº”æ¨¡æ‹Ÿç­‰ï¼‰ã€‚é«˜æ€§èƒ½è®¡ç®—é›†ç¾¤å¯¹å¤–å°±å¥½åƒä¸€ä¸ªè¶…çº§è®¡ç®—æœºï¼Œè¿™ç§è¶…çº§è®¡ç®—æœºå†…éƒ¨ç”±æ•°åè‡³ä¸Šä¸‡ä¸ªç‹¬ç«‹æœåŠ¡å™¨ç»„æˆï¼Œå¹¶ä¸”åœ¨å…¬å…±æ¶ˆæ¯ä¼ é€’å±‚ä¸Šè¿›è¡Œé€šä¿¡ä»¥è¿è¡Œå¹¶è¡Œåº”ç”¨ç¨‹åºã€‚åœ¨è€ç”·å­©çš„å·¥ä½œä¸­å®é™…æ˜¯æŠŠä»»åŠ¡åˆ‡æˆè›‹ç³•ï¼Œç„¶åä¸‹å‘åˆ°é›†ç¾¤èŠ‚ç‚¹è®¡ç®—ï¼Œè®¡ç®—åè¿”å›ç»“æœï¼Œç„¶åç»§ç»­é¢†æ–°ä»»åŠ¡è®¡ç®—ï¼Œå¦‚æ­¤å¾€å¤</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é›†ç¾¤çš„ä¼˜åŠ¿ç‰¹ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é«˜æ€§èƒ½<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å»‰ä»·æ€§<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¯ä¼¸ç¼©æ€§<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é«˜å¯ç”¨æ€§<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é€æ˜æ€§<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¯ç®¡ç†æ€§<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¯ç¼–ç¨‹æ€§<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->é›†ç¾¤åˆ†ç±»<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è´Ÿè½½å‡è¡¡é›†ç¾¤<!-- raw HTML omitted -->(<code>Load balancing clusters</code>)ç®€ç§°<code>LBC</code>æˆ–è€…<code>LB</code></li>
<li><!-- raw HTML omitted -->é«˜å¯ç”¨æ€§é›†ç¾¤<!-- raw HTML omitted -->(<code>High-availavlability (HA) clusters</code>)ç®€ç§°<code>HAC</code></li>
<li><!-- raw HTML omitted -->é«˜æ€§èƒ½è®¡ç®—é›†ç¾¤<!-- raw HTML omitted -->(<code>Hight-perfomance (HPC) clusters</code>)ç®€ç§°<code>HPC</code></li>
<li><!-- raw HTML omitted -->ç½‘æ ¼è®¡ç®—<!-- raw HTML omitted -->(<code>Grid computing</code>)</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->è´Ÿè½½å‡è¡¡é›†ç¾¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>è´Ÿè½½å‡è¡¡é›†ç¾¤ä¸ºäº†å¼ºä¼ä¸šæä¾›æ›´ä¸ºå®ç”¨ã€æ€§ä»·æ¯”æ›´é«˜çš„ç³»ç»Ÿæ¶æ„è§£å†³æ–¹æ¡ˆã€‚è´Ÿè½½å‡è¡¡é›†ç¾¤å¯ä»¥å°†å¾ˆå¤šå®¢æˆ·é›†ä¸­è®¿é—®è´Ÿè½½å‹åŠ›å°½å¯èƒ½åœ°å¹³å‡åˆ†æ‘Šåœ¨è®¡ç®—æœºé›†ç¾¤ä¸­å¤„ç†ã€‚å®¢æˆ·è®¿é—®è¯·æ±‚è´Ÿè½½åŒ…æ‹¬åº”ç”¨ç¨‹åºå¤„ç†è´Ÿè½½å’Œç½‘ç»œæµé‡è´Ÿè½½ã€‚è¿™æ ·ä½¿åŒä¸€ç»„åº”ç”¨ç¨‹åºä¸ºå¤§é‡ç”¨æˆ·æä¾›æœåŠ¡çš„æ¨¡å¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ‰¿æ‹…ä¸€å®šçš„è®¿é—®æ±‚è´Ÿè½½å‹åŠ›å¹¶ä¸”å¯ä»¥å®ç°è®¿é—®è¯·æ±‚åœ¨å„èŠ‚ç‚¹ä¹‹é—´åŠ¨æ€åˆ†é…ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡</li>
<li>è´Ÿè½½å‡è¡¡ï¼ˆ<code>LoadBalance</code>ï¼‰é›†ç¾¤æä¾›äº†ä¸€ç§å»‰ä»·ã€æœ‰æ•ˆã€é€æ˜çš„æ–¹æ³•ï¼Œæ¥æ‰©å±•ç½‘ç»œè®¾å¤‡å’ŒæœåŠ¡å™¨çš„è´Ÿè½½ã€å¸¦å®½å’Œååé‡ï¼ŒåŒæ—¶åŠ å¼ºäº†ç½‘ç»œæ•°æ®å¤„ç†èƒ½åŠ›ï¼Œæé«˜äº†ç½‘ç»œçš„çµæ´»æ€§å’Œå¯ç”¨æ€§</li>
<li>æŠŠå•å°è®¡ç®—æœºæ— æ³•æ‰¿å—çš„å¤§è§„æ¨¡å¹¶å‘è®¿é—®æˆ–æ•°æ®æµé‡åˆ†æ‹…åˆ°å¤šå°èŠ‚ç‚¹è®¾å¤‡ä¸Šï¼Œåˆ†åˆ«è¿›è¡Œå¤„ç†ï¼Œå‡å°‘ç”¨æˆ·ç­‰å¾…å“åº”çš„æ—¶é—´ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li>
<li>å•ä¸ªé‡è´Ÿè½½çš„è¿ç®—åˆ†æ‹…åˆ°å¤šå°èŠ‚ç‚¹è®¾å¤‡ä¸Šåšå¹¶è¡Œå¤„ç†ï¼Œæ¯ä¸ªèŠ‚ç‚¹è®¾å¤‡å¤„ç†ç»“æŸåï¼Œå°†ç»“æœæ±‡æ€»ï¼Œè¿”å›ç»™ç”¨æˆ·ï¼Œç³»ç»Ÿå¤„ç†èƒ½åŠ›å¾—åˆ°å¤§å¹…åº¦æé«˜</li>
<li><code>7Ã—24</code>å°æ—¶çš„æœåŠ¡ä¿è¯ï¼Œä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰é™åé¢èŠ‚ç‚¹è®¾å¤‡å®•æœºï¼Œä¸èƒ½å½±å“ä¸šåŠ¡</li>
<li>åœ¨è´Ÿè½½å‡è¡¡é›†ç¾¤ä¸­ï¼ŒåŒç»„é›†ç¾¤çš„æ‰€æœ‰è®¡ç®—æœºèŠ‚ç‚¹éƒ½åº”è¯¥æä¾›ç›¸åŒçš„æœåŠ¡ã€‚é›†ç¾¤è´Ÿè½½å‡è¡¡å™¨ä¼šæˆªè·æ‰€æœ‰å¯¹è¯¥æœåŠ¡çš„å…¥ç«™è¯·æ±‚ã€‚ç„¶åå°†è¿™äº›è¯·æ±‚å°½å¯èƒ½åœ°å¹³å‡åœ°åˆ†é…åœ¨æ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹ä¸Š</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->è´Ÿè½½å‡è¡¡é›†ç¾¤çš„ä½œç”¨ <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ†æ‹…ç”¨æˆ·è®¿é—®è¯·æ±‚åŠæ•°æ®æµé‡ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ - ä¿æŒä¸šåŠ¡è¿ç»­æ€§ï¼Œå³<!-- raw HTML omitted --><code>7Ã—24</code><!-- raw HTML omitted -->å°æ—¶æœåŠ¡ï¼ˆé«˜å¯ç”¨æ€§ï¼‰<!-- raw HTML omitted --></li>
<li>äº<code>Web</code><!-- raw HTML omitted -->ä¸šåŠ¡åŠæ•°æ®åº“ä»åº“ç­‰æœåŠ¡å™¨çš„ä¸šåŠ¡<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->è´Ÿè½½å‡è¡¡é›†ç¾¤å…¸å‹çš„å¼€æºè½¯ä»¶åŒ…æ‹¬<!-- raw HTML omitted --><code>LVS</code>ã€<code>Nginx</code>ã€<code>Haproxy</code>ç­‰</li>
<li><!-- raw HTML omitted -->é«˜å¯ç”¨æ€§é›†ç¾¤çš„ä½œç”¨ <!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å½“ä¸€å°æœºå™¨å®•æœºæ—¶ï¼Œå¦å¤–ä¸€å°æœºå™¨æ¥ç®¡å®•æœºçš„æœºå™¨çš„<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->èµ„æºå’ŒæœåŠ¡èµ„æºï¼Œæä¾›æœåŠ¡<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¸¸ç”¨äºä¸æ˜“å®ç°è´Ÿè½½å‡è¡¡çš„åº”ç”¨ï¼Œæ¯”å¦‚è´Ÿè½½å‡è¡¡å™¨ï¼Œä¸»æ•°æ®åº“ã€ä¸»å­˜å‚¨å¯¹ä¹‹é—´<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é«˜å¯ç”¨æ€§é›†ç¾¤å¸¸ç”¨çš„å¼€æºè½¯ä»¶åŒ…æ‹¬<!-- raw HTML omitted --><code>Keepalived</code>ã€<code>Heartbeat</code>ç­‰</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->è¿ç»´ä¸­å¸¸è§çš„é›†ç¾¤è½¯ç¡¬ä»¶äº§å“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>äº’è”ç½‘ä¼ä¸šå¸¸ç”¨çš„å¼€æºé›†ç¾¤è½¯ä»¶æœ‰ï¼š<code>Nginx</code>ã€<code>LVS</code>ã€<code>Haproxy</code>ã€<code>Keepalived</code>ã€<code>Heartbeat</code>ã€‚äº’è”ç½‘ä¼ä¸šå¸¸ç”¨çš„å•†ä¸šé›†ç¾¤ç¡¬ä»¶æœ‰ï¼š<code>F5</code>ã€<code>Netscaler</code>ã€<code>Rad-ware</code>ã€<code>A10</code>ç­‰ï¼Œå·¥ä½œæ¨¡å¼ç›¸å½“äº<code>Haproxy</code>çš„å·¥ä½œæ¨¡å¼ã€‚æ·˜å®ã€èµ¶é›†ç½‘ã€æ–°æµªç­‰å…¬å¸æ›¾ä½¿ç”¨è¿‡<code>Netscaler</code>è´Ÿè½½å‡è¡¡äº§å“ã€‚é›†ç¾¤ç¡¬ä»¶<code>Netscaler</code>çš„äº§å“</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->é›†ç¾¤è½¯ç¡¬ä»¶äº§å“å¦‚ä½•é€‰å‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å½“ä¼ä¸šä¸šåŠ¡é‡è¦ï¼ŒæŠ€æœ¯åŠ›é‡åˆè–„å¼±ï¼Œå¹¶ä¸”å¸Œæœ›å‡ºé’±è´­ä¹°äº§å“åŠè·å–æ›´å¥½çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥é€‰æ‹©ç¡¬ä»¶è´Ÿè½½å‡è¡¡äº§å“ï¼Œå¦‚<code>F5</code>ã€<code>Netscaler</code>ã€<code>Radware</code>ç­‰ï¼Œæ­¤ç±»å…¬å¸å¤šä¸ºä¼ ç»Ÿçš„å¤§å‹éäº’è”ç½‘ä¼ä¸šï¼Œå¦‚é“¶è¡Œã€è¯åˆ¸ã€é‡‘èä¸šåŠå®é©¬ã€å¥”é©°å…¬å¸ç­‰</li>
<li>å¯¹äºé—¨æˆ·ç½‘ç«™æ¥è¯´ï¼Œå¤§å¤šä¼šå¹¶ç”¨è½¯ä»¶åŠç¡¬ä»¶äº§å“æ¥åˆ†æ‹…å•ä¸€äº§å“çš„é£é™©ï¼Œå¦‚æ·˜å®ã€è…¾è®¯ã€æ–°æµªç­‰ã€‚èèµ„äº†çš„ä¼ä¸šä¼šè´­ä¹°ç¡¬ä»¶äº§å“ï¼Œå¦‚èµ¶é›†ç­‰ç½‘ç«™</li>
<li>ä¸­å°å‹äº’è”ç½‘ä¼ä¸šï¼Œç”±äºèµ·æ­¥é˜¶æ®µæ— åˆ©æ¶¦å¯èµšæˆ–è€…åˆ©æ¶¦å¾ˆä½ï¼Œä¼šå¸Œæœ›é€šè¿‡ä½¿ç”¨å¼€æºå…è´¹çš„æ–¹æ¡ˆæ¥è§£å†³é—®é¢˜ï¼Œå› æ­¤ä¼šé›‡ä½£ä¸“é—¨çš„è¿ç»´äººå‘˜è¿›è¡Œç»´æŠ¤ã€‚ä¾‹å¦‚ï¼š<code>51CTO</code>ç­‰</li>
</ul>
</blockquote>
<p>ç›¸æ¯”è¾ƒè€Œè¨€ï¼Œå•†ä¸šçš„è´Ÿè½½å‡è¡¡äº§å“æˆæœ¬é«˜ï¼Œæ€§èƒ½å¥½ï¼Œæ›´ç¨³å®šï¼Œç¼ºç‚¹æ˜¯ä¸èƒ½äºŒæ¬¡å¼€å‘ï¼Œå¼€æºçš„è´Ÿè½½å‡è¡¡è½¯ä»¶å¯¹è¿ç»´äººå‘˜çš„èƒ½åŠ›è¦æ±‚è¾ƒé«˜ï¼Œå¦‚æœè¿ç»´åŠå¼€å‘èƒ½åŠ›å¼ºï¼Œé‚£ä¹ˆå¼€æºçš„è´Ÿè½½å‡è¡¡è½¯ä»¶æ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œç›®å‰çš„äº’è”ç½‘è¡Œä¸šæ›´å€¾å‘äºä½¿ç”¨å¼€æºçš„è´Ÿè½½å‡è¡¡è½¯ä»¶</p>
<ul>
<li><!-- raw HTML omitted -->å¦‚ä½•é€‰æ‹©å¼€æºé›†ç¾¤è½¯ä»¶äº§å“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ä¸­å°ä¼ä¸šäº’è”ç½‘å…¬å¸ç½‘ç«™åœ¨å¹¶å‘è®¿é—®å’Œæ€»è®¿é—®é‡ä¸æ˜¯å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œå»ºè®®é¦–é€‰<code>Nginx</code>è´Ÿè½½å‡è¡¡ï¼Œç†ç”±æ˜¯<code>Nginx</code>è´Ÿè½½å‡è¡¡é…ç½®ç®€å•ã€ä½¿ç”¨æ–¹ä¾¿ã€å®‰å…¨ç¨³å®šã€ç¤¾åŒºæ´»è·ƒï¼Œä½¿ç”¨çš„äººé€æ¸å¢å¤šï¼Œæˆä¸ºæµè¡Œè¶‹åŠ¿ï¼Œå¦å¤–ä¸€ä¸ªå®ç°è´Ÿè½½å‡è¡¡çš„ç±»ä¼¼äº§å“ä¸º<code>Haproxy</code>ï¼ˆæ”¯æŒ<code>L4</code>å’Œ<code>L7</code>è´Ÿè½½ï¼ŒåŒæ ·ä¼˜ç§€ï¼Œä½†ç¤¾åŒºä¸å¦‚<code>Nginx</code>æ´»è·ƒï¼‰</li>
<li>å¦‚æœè¦è€ƒè™‘<code>Nginx</code>è´Ÿè½½å‡è¡¡çš„é«˜å¯ç”¨åŠŸèƒ½ï¼Œå»ºè®®é¦–é€‰<code>Keepalived</code>è½¯ä»¶ï¼Œç†ç”±æ˜¯å®‰è£…å’Œé…ç½®ç®€å•ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œå®‰å…¨ç¨³å®šï¼Œä¸<code>Keepalived</code>æœåŠ¡ç±»ä¼¼çš„é«˜å¯ç”¨è½¯ä»¶è¿˜æœ‰<code>Heartbeat</code>ï¼ˆä½¿ç”¨æ¯”è¾ƒå¤æ‚ï¼Œä¸å»ºè®®åˆå­¦è€…ä½¿ç”¨ï¼‰</li>
<li>å¦‚æœæ˜¯å¤§å‹ä¼ä¸šäº’è”ç½‘å…¬å¸ï¼Œè´Ÿè½½å‡è¡¡äº§å“å¯ä»¥ä½¿ç”¨<code>LVS</code>+<code>Keepalived</code>åœ¨å‰ç«¯åšå››å±‚è½¬å‘ï¼ˆä¸€èˆ¬æ˜¯ä¸»å¤‡æˆ–ä¸»ä¸»ï¼Œå¦‚æœéœ€è¦æ‰©å±•å¯ä»¥ä½¿ç”¨<code>DNS</code>æˆ–å‰ç«¯ä½¿ç”¨<code>OSPF</code>ï¼‰ï¼Œåç«¯ä½¿ç”¨<code>Nginx</code>æˆ–è€…<code>Haproxy</code>åš<code>7</code>å±‚è½¬å‘ï¼ˆå¯ä»¥æ‰©å±•åˆ°ç™¾å°ï¼‰ï¼Œå†åé¢æ˜¯åº”ç”¨æœåŠ¡å™¨ï¼Œå¦‚æœæ˜¯æ•°æ®åº“ä¸å­˜å‚¨çš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨ï¼Œå»ºè®®é€‰æ‹©<code>LVS</code>+<code>Heart-beat</code>ï¼Œ<code>LVS</code>æ”¯æŒ<code>TCP</code>è½¬å‘ä¸”<code>DR</code>æ¨¡å¼æ•ˆç‡å¾ˆé«˜ï¼Œ<code>Heartbeat</code>å¯ä»¥é…åˆ<code>drbd</code>ï¼Œä¸ä½†å¯ä»¥è¿›è¡Œ<code>VIP</code>çš„åˆ‡æ¢ï¼Œè¿˜å¯ä»¥æ”¯æŒå—è®¾å¤‡çº§åˆ«çš„æ•°æ®åŒæ­¥ï¼ˆ<code>drbd</code>ï¼‰ï¼Œä»¥åŠèµ„æºæœåŠ¡çš„ç®¡ç†</li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡æ¦‚å¿µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>ä¸¥æ ¼åœ°è¯´ï¼Œ<code>Nginx</code>ä»…ä»…æ˜¯ä½œä¸º<code>Nginx Proxy</code>åå‘ä»£ç†ä½¿ç”¨çš„ï¼Œå› ä¸ºè¿™ä¸ªåå‘ä»£ç†åŠŸèƒ½è¡¨ç°çš„æ•ˆæœæ˜¯è´Ÿè½½å‡è¡¡é›†ç¾¤çš„æ•ˆæœï¼Œæ‰€ä»¥æœ¬æ–‡ç§°ä¹‹ä¸º<code>Nginx</code>è´Ÿè½½å‡è¡¡ã€‚é‚£ä¹ˆï¼Œåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</li>
<li>æ™®é€šè´Ÿè½½å‡è¡¡è½¯ä»¶ï¼Œä¾‹å¦‚å¤§åé¼é¼çš„<code>LVS</code>ï¼Œå…¶å®ç°çš„åŠŸèƒ½åªæ˜¯å¯¹è¯·æ±‚æ•°æ®åŒ…çš„è½¬å‘ï¼ˆä¹Ÿå¯èƒ½ä¼šæ”¹å†™æ•°æ®åŒ…ï¼‰ã€ä¼ é€’ï¼Œå…¶ä¸­<code>DR</code>æ¨¡å¼æ˜æ˜¾çš„ç‰¹å¾æ˜¯ä»è´Ÿè½½å‡è¡¡ä¸‹é¢çš„èŠ‚ç‚¹æœåŠ¡å™¨æ¥çœ‹ï¼Œæ¥æ”¶åˆ°çš„è¯·æ±‚è¿˜æ˜¯æ¥è‡ªè®¿é—®è´Ÿè½½å‡è¡¡å™¨çš„å®¢æˆ·ç«¯çš„çœŸå®ç”¨æˆ·ï¼Œè€Œåå‘ä»£ç†å°±ä¸ä¸€æ ·äº†ï¼Œåå‘ä»£ç†æ¥æ”¶è®¿é—®ç”¨æˆ·çš„è¯·æ±‚åï¼Œä¼šä»£ç†ç”¨æˆ·é‡æ–°å‘èµ·è¯·æ±‚ä»£ç†ä¸‹çš„èŠ‚ç‚¹æœåŠ¡å™¨ï¼Œæœ€åæŠŠæ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ç”¨æˆ·ï¼Œåœ¨èŠ‚ç‚¹æœåŠ¡å™¨çœ‹æ¥ï¼Œè®¿é—®çš„èŠ‚ç‚¹æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ç”¨æˆ·å°±æ˜¯åå‘ä»£ç†æœåŠ¡å™¨äº†ï¼Œè€ŒéçœŸå®çš„ç½‘ç«™è®¿é—®ç”¨æˆ·</li>
<li>ä¸€å¥è¯ï¼Œ<code>LVS</code>ç­‰çš„è´Ÿè½½å‡è¡¡æ˜¯è½¬å‘ç”¨æˆ·è¯·æ±‚çš„æ•°æ®åŒ…ï¼Œè€Œ<code>Nginx</code>åå‘ä»£ç†æ˜¯æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚ç„¶åé‡æ–°å‘èµ·è¯·æ±‚å»è¯·æ±‚å…¶åé¢çš„èŠ‚ç‚¹ã€‚2. å®ç°<code>Nginx</code>è´Ÿè½½å‡è¡¡çš„ç»„ä»¶è¯´æ˜å®ç°<code>Nginx</code>è´Ÿè½½å‡è¡¡çš„ç»„ä»¶ä¸»è¦æœ‰ä¸¤ä¸ª</li>
</ul>
<p><a href="#R-image-d1b77c43bd31130f893c33b55caaaa4b" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/37fcolxnhiou5s9t0pb0vm8l/image_1akuo4vrcpke1vb010f3rdd14gi9.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d1b77c43bd31130f893c33b55caaaa4b"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/37fcolxnhiou5s9t0pb0vm8l/image_1akuo4vrcpke1vb010f3rdd14gi9.png"></a></p>
<p><a href="#R-image-b6d437b1a618184f8262e586025798b4" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/xd2ms7ck0a33wxf36vwwktgs/image_1akv2ig1519723ljs261b4d1kbo9.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b6d437b1a618184f8262e586025798b4"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/xd2ms7ck0a33wxf36vwwktgs/image_1akv2ig1519723ljs261b4d1kbo9.png"></a></p>
<p><a href="#R-image-cea4ac7405c3af34ae45f6be227a2593" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/7dalazu3amny9rg192ing2l9/image_1akv2hcu286b1piavpv9jdsunm.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cea4ac7405c3af34ae45f6be227a2593"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/7dalazu3amny9rg192ing2l9/image_1akv2hcu286b1piavpv9jdsunm.png"></a></p>
<p><a href="#R-image-732918f9b0b6df736bb98ed0e41ecd19" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/c4i7xy39l9tymsjbb0fem2l1/image_1akv8kcjorbhsq917bq9h382t13.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-732918f9b0b6df736bb98ed0e41ecd19"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/c4i7xy39l9tymsjbb0fem2l1/image_1akv8kcjorbhsq917bq9h382t13.png"></a></p>
<p><a href="#R-image-e99616f7d3c77cbb970739ece64a996f" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/f3esrb2do4bgexfvltp6l9im/%E5%8F%82%E6%95%B01.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e99616f7d3c77cbb970739ece64a996f"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/f3esrb2do4bgexfvltp6l9im/%E5%8F%82%E6%95%B01.jpg"></a></p>
<p><a href="#R-image-5403880be4c234b7a8a6873155a23bae" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/x676usyjxgo3idhklzrkqaz5/%E5%8F%82%E6%95%B02.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5403880be4c234b7a8a6873155a23bae"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/x676usyjxgo3idhklzrkqaz5/%E5%8F%82%E6%95%B02.jpg"></a></p>
<p><a href="#R-image-99844b2cf9ae5ebde9ff83845beeca2a" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/i9cazzd6tqyik5hpa0opxjuc/image_1akvc4rs112et1noc12s3d711h49.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-99844b2cf9ae5ebde9ff83845beeca2a"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/i9cazzd6tqyik5hpa0opxjuc/image_1akvc4rs112et1noc12s3d711h49.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->å®ç°è´Ÿè½½å‡è¡¡ç»„ä»¶è¯´æ˜<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th><code>Nginx http</code>åŠŸèƒ½æ¨¡å—</th>
<th>æ¨¡å—è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ngx_http_proxy_module</code></td>
<td><code>proxy</code>ä»£ç†æ¨¡å—ï¼Œç”¨æˆ·æŠŠè¯·æ±‚æŠ›ç»™èŠ‚ç‚¹æœåŠ¡å™¨æˆ–<code>upstream</code>æœåŠ¡æ± </td>
</tr>
<tr>
<td><code>ngx_http_upstream_module</code></td>
<td>è´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œå¯ä»¥å®ç°ç½‘ç«™è´Ÿè½½å‡è¡¡åŠŸèƒ½åŠèŠ‚ç‚¹å¥åº·æ£€æŸ¥</td>
</tr>
</tbody>
</table>
<ul>
<li><code>nginx upstream</code><!-- raw HTML omitted -->æ¨¡å—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Nginx</code>çš„è´Ÿè½½å‡è¡¡åŸºäº<code>ngx_http_upstream_module</code>æ‰€æ”¯æŒçš„ä»£ç†æ–¹å¼åŒ…æ‹¬<code>proxy_pass</code>ã€<code>fastcgi_pass</code>ã€<code>memcached_pass</code>ç­‰</li>
<li><code>rr</code><!-- raw HTML omitted -->ï¼šè½®è¯¢ï¼ˆæ€§èƒ½ç›¸è¿‘ï¼Œä¸šåŠ¡ä¸€æ ·ï¼‰<!-- raw HTML omitted --></li>
<li><code>wrr</code><!-- raw HTML omitted -->ï¼šæƒé‡è½®è¯¢<!-- raw HTML omitted --></li>
<li><code>ip_hash;</code><!-- raw HTML omitted -->ï¼šæ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>hash</code><!-- raw HTML omitted -->ç»“æœåˆ†é…ã€åŒä¸€ä¸ª<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->å›ºå®šè®¿é—®åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨<!-- raw HTML omitted --></li>
<li><code>hash $request_uri;</code><!-- raw HTML omitted -->ï¼šæ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®<!-- raw HTML omitted --><code>IP</code>çš„<code>hash</code><!-- raw HTML omitted -->ç»“æœåˆ†é…ã€åŒä¸€ä¸ª<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->å›ºå®šè®¿é—®åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨<!-- raw HTML omitted -->ï¼Œ<code>$cookie_jsessionid;</code><!-- raw HTML omitted -->æŒ‰ç…§åç«¯åˆ†é…<!-- raw HTML omitted --><code>JSESSIONID</code><!-- raw HTML omitted -->è¿›è¡Œè´Ÿè½½<!-- raw HTML omitted --></li>
<li><code>least_conn;</code><!-- raw HTML omitted -->ï¼šæœ€å°‘è¿æ¥æ•°ã€åˆ†é…ç»™è¿æ¥æ•°æœ€å°‘çš„åç«¯æœåŠ¡å™¨<!-- raw HTML omitted --></li>
<li><code>serverÂ IP:port xxx;</code><!-- raw HTML omitted -->ï¼šå­—æ®µ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>down;</code><!-- raw HTML omitted -->ï¼š å½“å‰<!-- raw HTML omitted --><code>server</code><!-- raw HTML omitted -->æš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡<!-- raw HTML omitted --></li>
<li><code>backup;</code><!-- raw HTML omitted -->ï¼šé¢„ç•™å¤‡ä»½æœåŠ¡å™¨ï¼Œåªæœ‰ä¸»å‚ä¸èŠ‚ç‚¹<!-- raw HTML omitted --><code>down</code>æ‰æ‰å¯ç”¨</li>
<li><code>weigh=3;</code><!-- raw HTML omitted -->ï¼šåŠ æƒè½®è¯¢ã€å€¼è¶Šå¤§åˆ†é…åˆ°è®¿é—®å‡ ç‡è¶Šé«˜<!-- raw HTML omitted --></li>
<li><code>check=3</code><!-- raw HTML omitted -->ï¼šå¼€å¯å¯¹è¯¥æœåŠ¡å™¨å¥åº·æ£€æŸ¥<!-- raw HTML omitted --></li>
<li><code>inter</code><!-- raw HTML omitted -->ï¼šè®¾ç½®è¿ç»­ä¸¤æ¬¡å¥åº·æ£€æŸ¥çš„é—´éš”æ—¶é—´ï¼Œå•ä½æ¯«ç§’ï¼Œé»˜è®¤å€¼<!-- raw HTML omitted --><code>2000</code></li>
<li><code>rise</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šå¤šå°‘æ¬¡è¿ç»­æˆåŠŸå¥åº·æ£€æŸ¥åï¼Œå³å¯è®¤å®šæœåŠ¡å™¨å¯ç”¨çŠ¶æ€<!-- raw HTML omitted --></li>
<li><code>max_fails=3</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šå¤šå°‘æ¬¡ä¸æˆåŠŸåï¼Œå³è®¤ä¸ºå®•æœºçŠ¶æ€ï¼Œé»˜è®¤å€¼<!-- raw HTML omitted --><code>1</code></li>
<li><code>fail_timeout=10 </code><!-- raw HTML omitted -->ï¼šç»è¿‡<!-- raw HTML omitted --><code>max_fails</code><!-- raw HTML omitted -->å¤±è´¥åï¼Œåœ¨<!-- raw HTML omitted --><code>fail_timeout</code><!-- raw HTML omitted -->æ—¶é—´å†…ä¸å†å»è¯·æ±‚å®ƒï¼Œ<!-- raw HTML omitted --><code>fail_timeout</code><!-- raw HTML omitted -->é»˜è®¤æ˜¯<!-- raw HTML omitted --><code>10s</code></li>
<li><code>maxconnï¼š</code>ï¼š</li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è´Ÿè½½å‡è¡¡UDPè½¬å‘</span>
</span></span><span style="display:flex;"><span>stream <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    upstream dns <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®IPçš„hashç»“æœåˆ†é…ã€åŒä¸€ä¸ªIPå›ºå®šè®¿é—®åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨</span>
</span></span><span style="display:flex;"><span>        ip_hash;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># æœ€å°‘è¿æ¥æ•°ã€åˆ†é…ç»™è¿æ¥æ•°æœ€å°‘çš„åç«¯æœåŠ¡å™¨</span>
</span></span><span style="display:flex;"><span>        least_conn;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å½“å‰serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡</span>
</span></span><span style="display:flex;"><span>        server 192.168.111.99:10086 down;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># é¢„ç•™å¤‡ä»½æœåŠ¡å™¨ï¼Œåªæœ‰ä¸»å‚ä¸èŠ‚ç‚¹downæ‰æ‰å¯ç”¨</span>
</span></span><span style="display:flex;"><span>        server 192.168.111.100:10086 weigh<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> backup;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># weighï¼šåŠ æƒè½®è¯¢ã€å€¼è¶Šå¤§åˆ†é…åˆ°è®¿é—®å‡ ç‡è¶Šé«˜ï¼Œmax_failsï¼šå…è®¸è¯·æ±‚å¤±è´¥æ¬¡æ•°ï¼Œfail_timeoutï¼šç»è¿‡max_failså¤±è´¥åï¼ŒæœåŠ¡æš‚å®šæ—¶é—´ã€mac_connsï¼šé™åˆ¶æœ€å¤§è¿æ¥æ•°</span>
</span></span><span style="display:flex;"><span>        server 192.168.111.100:10086 weigh<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> max_fails<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> fail_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span> max_conns<span style="color:#f92672">=</span>128;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å‘ä¸Šæ¸¸æœåŠ¡å™¨ä¿ç•™çš„è¿æ¥æ•°</span>
</span></span><span style="display:flex;"><span>        keepalive 300;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># è¿æ¥ä¿ç•™æ—¶é—´ã€é»˜è®¤60ç§’ï¼Œ</span>
</span></span><span style="display:flex;"><span>		keepalive_timeout 60;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># ä¸€ä¸ªTcpå¤ç”¨ä¸­å¯ä»¥å¹¶å‘æ¥æ”¶çš„è¯·æ±‚æ•°</span>
</span></span><span style="display:flex;"><span>		keepalive_requests 1000;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>check interval<span style="color:#f92672">=</span><span style="color:#ae81ff">3000</span> rise<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> fall<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span> type<span style="color:#f92672">=</span>http;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># check interval=3000 rise=2 fall=5 timeout=1000 type=http;</span>
</span></span><span style="display:flex;"><span>ä¸Šé¢é…ç½®çš„æ„æ€æ˜¯ï¼Œå¯¹staticã€uploadã€è¿™ä¸ªè´Ÿè½½å‡è¡¡æ¡ç›®ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ¯éš”3ç§’æ£€æµ‹ä¸€æ¬¡ï¼Œè¯·æ±‚2æ¬¡æ­£å¸¸åˆ™æ ‡è®°realserverçŠ¶æ€ä¸ºupï¼Œå¦‚æœæ£€æµ‹5æ¬¡éƒ½å¤±è´¥ï¼Œåˆ™æ ‡è®°realserverçš„çŠ¶æ€ä¸ºdownï¼Œè¶…æ—¶æ—¶é—´ä¸º1ç§’ï¼Œæ£€æŸ¥çš„åè®®æ˜¯httpã€‚</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®è½¬å‘åˆ°<!-- raw HTML omitted --><code>Mysql</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ <!-- raw HTML omitted --><code>--with-stream</code><!-- raw HTML omitted -->æ¨¡å—æ”¯æŒ<!-- raw HTML omitted --><code>TCP/UDP</code><!-- raw HTML omitted -->åè®®<!-- raw HTML omitted --></li>
<li><a href="https://cloud.tencent.com/developer/article/1768431" rel="external" target="_self"><code>Nginx</code>ä»£ç†è½¬å‘<code>Mysql</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nginx -V
</span></span><span style="display:flex;"><span>configure arguments: --prefix<span style="color:#f92672">=</span>/usr/local/nginx --with-stream</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>conf</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸­<!-- raw HTML omitted --><code>server</code><!-- raw HTML omitted -->å­—æ®µ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">stream</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">upstream</span> <span style="color:#e6db74">cloudsocket</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">hash</span> $remote_addr <span style="color:#e6db74">consistent</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">server</span> 192.168.182.155:<span style="color:#ae81ff">3306</span> <span style="color:#e6db74">weight=5</span> <span style="color:#e6db74">max_fails=3</span> <span style="color:#e6db74">fail_timeout=30s</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">server</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">listen</span> <span style="color:#ae81ff">3306</span>;     <span style="color:#75715e"># æ•°æ®åº“æœåŠ¡å™¨ç›‘å¬ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_connect_timeout</span> <span style="color:#e6db74">10s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_timeout</span> <span style="color:#e6db74">300s</span>;      <span style="color:#75715e"># å®¢æˆ·ç«¯ä¸ä»£ç†ä¹‹é—´çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœ5åˆ†é’Ÿå†…æ²¡æ“ä½œå°†è‡ªåŠ¨æ–­å¼€ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">cloudsocket</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è´Ÿè½½å‡è¡¡UDPè½¬å‘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">stream</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">upstream</span> <span style="color:#e6db74">dns</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">ip_hash</span>;  	<span style="color:#75715e"># æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®IPçš„hashç»“æœåˆ†é…ã€åŒä¸€ä¸ªIPå›ºå®šè®¿é—®åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">hash</span> $request_uri;  	<span style="color:#75715e"># æŒ‰ç…§è®¿é—®URLçš„hashç»“æœåˆ†é…è¯·æ±‚ã€æ¯ä¸ªURLå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">least_conn</span>;  	<span style="color:#75715e"># æœ€å°‘è¿æ¥æ•°ã€åˆ†é…ç»™è¿æ¥æ•°æœ€å°‘çš„åç«¯æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">server</span> 192.168.111.99:<span style="color:#ae81ff">10086</span> <span style="color:#e6db74">down</span>;  	<span style="color:#75715e"># å½“å‰serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">server</span> 192.168.111.100:<span style="color:#ae81ff">10086</span> <span style="color:#e6db74">backup</span>;  	<span style="color:#75715e"># é¢„ç•™å¤‡ä»½æœåŠ¡å™¨ï¼Œåªæœ‰ä¸»å‚ä¸èŠ‚ç‚¹downæ‰æ‰å¯ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">server</span> 192.168.111.100:<span style="color:#ae81ff">10086</span> <span style="color:#e6db74">weigh=3</span> <span style="color:#e6db74">max_fails=3</span> <span style="color:#e6db74">fail_timeout=10</span> <span style="color:#e6db74">max_conns=128</span>;  	<span style="color:#75715e"># weighï¼šåŠ æƒè½®è¯¢ã€å€¼è¶Šå¤§åˆ†é…åˆ°è®¿é—®å‡ ç‡è¶Šé«˜ï¼Œmax_failsï¼šå…è®¸è¯·æ±‚å¤±è´¥æ¬¡æ•°ï¼Œfail_timeoutï¼šç»è¿‡max_failså¤±è´¥åï¼ŒæœåŠ¡æš‚å®šæ—¶é—´ã€mac_connsï¼šé™åˆ¶æœ€å¤§è¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">server</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">listen</span> 192.168.111.98:<span style="color:#ae81ff">10086</span> <span style="color:#e6db74">udp</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_responses</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_timeout</span> <span style="color:#e6db74">20s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_bind</span> $server_addr:$remote_port;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">dns</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
</blockquote>
</blockquote>
<hr>
<h3 id="nginxä½¿ç”¨luaè„šæœ¬"><code>Nginx</code>ä½¿ç”¨<code>Lua</code>è„šæœ¬</h3>
<blockquote>
<ul>
<li><code>set_by_lua</code><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->å˜é‡<!-- raw HTML omitted --></li>
<li><code>loa_by_lua</code><!-- raw HTML omitted -->æ—¥å¿—<!-- raw HTML omitted --></li>
<li><code>access_by_lua</code><!-- raw HTML omitted -->è®¿é—®æ§åˆ¶<!-- raw HTML omitted --></li>
<li><code>rewrite_by_lua</code><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>uri</code></li>
<li><code>boy_filter_by_lua</code><!-- raw HTML omitted -->ä¿®æ”¹å“åº”ä½“<!-- raw HTML omitted --></li>
<li><code>header_filter_by_lua</code><!-- raw HTML omitted -->ä¿®æ”¹å“åº”å¤´<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span> <span style="color:#e6db74">lua.erge.com</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/lua</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">default_type</span> <span style="color:#e6db74">text/html</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ç›´æ¥ä½¿ç”¨luaè¯­è¨€æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">content_by_lua</span> <span style="color:#e6db74">&#39;ngx_say(&#34;&lt;p&gt;Hello</span> <span style="color:#e6db74">World!!!&lt;/p&gt;&#34;)&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å¼•ç”¨luaè„šæœ¬æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">content_by_lua_file</span> <span style="color:#e6db74">conf/lua/hello.lua</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><code>lua</code><!-- raw HTML omitted -->è„šæœ¬<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/hello.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx_say(&#34;&lt;p&gt;Hello World!!!&lt;/p&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->è¯·æ±‚å¤´ä¿¡æ¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/headers.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">local headers = ngx_req.get_headers()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;Host : &#34;, headers[&#34;Host&#34;], &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;user-agent : &#34;, headers[&#34;user-agent&#34;], &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;user-agent : &#34;, headers.user_agent, &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for key, values in pairs(headers)do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   if type(values) == &#39;table&#39; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       ngx.say(key, &#34; : &#34;, table.concat(values, &#34;,&#34;), &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       ngx.say(key, &#34; : &#34;, values, &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–<!-- raw HTML omitted --><code>Post</code><!-- raw HTML omitted -->è¯·æ±‚å‚æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/post.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.req.read_body()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;Post Args Begin&#34;, &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">local post_args = ngx.req.get_post_args()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for key,values in pairs(post_args) do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    if type(values) == &#34;table&#34; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ngx.say(key, &#34; : &#34;, table.concat(values, &#34;, &#34;), &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ngx.say(key, &#34; : &#34;, values, &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->ç‰ˆæœ¬<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/nginx_version.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;http_version : &#34;, ngx.req.http_version(), &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–è¯·æ±‚æ–¹æ³•<!-- raw HTML omitted --><code>GETã€POSTã€PUT</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/method.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;get_method : &#34;, ngx.req.get_method(), &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åŸå§‹çš„è¯·æ±‚å†…å®¹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/original.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;raw_hader : &#34;, ngx.req.raw_header(), &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>body</code><!-- raw HTML omitted -->å†…å®¹ä½“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/body.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;get_body_date() : &#34;, ngx.req.get_body_data(), &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>Nginx</code><!-- raw HTML omitted -->å…¨å±€å†…å­˜ç¼“å­˜<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/shared.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">local shared_data = ngx.shared.shared_data  	# è·å–ç¼“å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">local key = shared_data:get(&#34;key&#34;)  	# ç¼“å­˜é‡Œé¢å–å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if not key then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    key = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    shared_data:set(&#34;key&#34;, key)  	# è°ƒç”¨set æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ngx.say(&#34;lazy set key &#34;, key, &#34;&lt;br/&gt;&#34;)  	# ç­‰äºä»€ä¹ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">key = shared_data:incr(&#34;key&#34;, 1)  	# è‡ªå¢åŠ ä¸€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;key=&#34;, key, &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><a href="https://github.com/openresty/lua-resty-lrucache" rel="external" target="_self"><code>lua-resty-lrucache</code></a><!-- raw HTML omitted -->ç¼“å­˜<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/vhosts/server.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    listen 80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server_name lua.erge.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    location /lua {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        default_type text/html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # ç›´æ¥ä½¿ç”¨luaè¯­è¨€æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        content_by_lua &#39;ngx_say(&#34;&lt;p&gt;Hello World!!!&lt;/p&gt;&#34;)&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # å¼•ç”¨luaè„šæœ¬æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        content_by_lua_file conf/lua/hello.lua;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        content_by_lua_block {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            require(&#34;my/cache&#34;).go()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="è¿‡æ»¤ç™»å½•å’ŒçŠ¶æ€ç ">è¿‡æ»¤ç™»å½•å’ŒçŠ¶æ€ç </h3>
<blockquote>
<ul>
<li>è„šæœ¬ä½¿ç”¨<code>nslookup</code>å‘½ä»¤è·å–ç”¨æˆ·<code>IP</code>åœ°å€çš„è¿œç¨‹ä¸»æœºåï¼Œå¹¶ä½¿ç”¨<code>curl</code>å‘½ä»¤è·å–è¿œç¨‹ä¸»æœºçš„çŠ¶æ€ç ã€‚ç„¶åï¼Œå®ƒå°†æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„åŸŸåå’ŒçŠ¶æ€ç æ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ˜¾ç¤º<code>Access granted</code>å¦åˆ™æ˜¾ç¤º<code>Access denied</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰å…è®¸ç™»å½•çš„åŸŸåå’ŒçŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>ALLOWED_DOMAINS<span style="color:#f92672">=(</span><span style="color:#e6db74">&#34;example.com&#34;</span> <span style="color:#e6db74">&#34;example.org&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>ALLOWED_STATUS_CODES<span style="color:#f92672">=(</span><span style="color:#e6db74">&#34;200&#34;</span> <span style="color:#e6db74">&#34;301&#34;</span> <span style="color:#e6db74">&#34;302&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–ç”¨æˆ·IPåœ°å€</span>
</span></span><span style="display:flex;"><span>USER_IP<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo $SSH_CLIENT | awk <span style="color:#e6db74">&#39;{print $1}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–ç”¨æˆ·ç™»å½•æ—¶è¿œç¨‹ä¸»æœºçš„åŸŸåå’ŒçŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>REMOTE_DOMAIN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>nslookup $USER_IP | awk -F<span style="color:#e6db74">&#39;=&#39;</span> <span style="color:#e6db74">&#39;/name/{print $2}&#39;</span> | sed <span style="color:#e6db74">&#39;s/\.$//&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>REMOTE_STATUS_CODE<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl -s -o /dev/null -I -w <span style="color:#e6db74">&#34;%{http_code}&#34;</span> http://$REMOTE_DOMAIN<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„åŸŸåå’ŒçŠ¶æ€ç æ˜¯å¦è¢«å…è®¸</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34; </span><span style="color:#e6db74">${</span>ALLOWED_DOMAINS[*]<span style="color:#e6db74">}</span><span style="color:#e6db74"> &#34;</span> <span style="color:#f92672">=</span>~ <span style="color:#e6db74">&#34; </span><span style="color:#e6db74">${</span>REMOTE_DOMAIN<span style="color:#e6db74">}</span><span style="color:#e6db74"> &#34;</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34; </span><span style="color:#e6db74">${</span>ALLOWED_STATUS_CODES[*]<span style="color:#e6db74">}</span><span style="color:#e6db74"> &#34;</span> <span style="color:#f92672">=</span>~ <span style="color:#e6db74">&#34; </span><span style="color:#e6db74">${</span>REMOTE_STATUS_CODE<span style="color:#e6db74">}</span><span style="color:#e6db74"> &#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Access granted to </span>$REMOTE_DOMAIN<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Access denied to </span>$REMOTE_DOMAIN<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span></span></span></code></pre></div></blockquote>
<ul>
<li>ç¤ºä¾‹è„šæœ¬ï¼Œå®ƒä¼šè¿‡æ»¤ç½‘ç«™åå°ç™»å½•çš„<code>IP</code>åœ°å€å’ŒçŠ¶æ€ç ï¼Œå°†ä¸åœ¨é¢„å®šä¹‰æ–‡ä»¶åˆ—è¡¨ä¸­çš„IPåœ°å€å‘é€åˆ°<code>Telegram</code>é€šçŸ¥ç»„ã€‚</li>
</ul>
<blockquote>
<ul>
<li>è„šæœ¬ä¼šæ£€æŸ¥è¿œç¨‹ä¸»æœºçš„çŠ¶æ€ç æ˜¯å¦ä¸º<code>200</code>ã€‚å¦‚æœæ˜¯ï¼Œåˆ™å®ƒå°†ä»æ–‡ä»¶ä¸­æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„IPåœ°å€æ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ˜¾ç¤º<code>Access granted</code>ï¼Œå¦åˆ™å°†å‘é€<code>Telegram</code>å‘Šè­¦ï¼Œå¹¶æ˜¾ç¤º<code>Access denied</code>ã€‚è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦å°†<code>YOUR_TELEGRAM_API_TOKEN</code>å’Œ<code>YOUR_TELEGRAM_CHAT_ID</code>æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„<code>Telegram API Token</code>å’Œ<code>Chat ID</code>ã€‚</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é¢„å®šä¹‰å…è®¸ç™»å½•çš„IPåœ°å€åˆ—è¡¨æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>ALLOWED_IP_LIST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;allowed_ips.txt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰Telegramé€šçŸ¥ç»„çš„API Tokenå’ŒChat ID</span>
</span></span><span style="display:flex;"><span>TELEGRAM_API_TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YOUR_TELEGRAM_API_TOKEN&#34;</span>
</span></span><span style="display:flex;"><span>TELEGRAM_CHAT_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YOUR_TELEGRAM_CHAT_ID&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–ç”¨æˆ·IPåœ°å€</span>
</span></span><span style="display:flex;"><span>USER_IP<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo $SSH_CLIENT | awk <span style="color:#e6db74">&#39;{print $1}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–ç”¨æˆ·ç™»å½•æ—¶è¿œç¨‹ä¸»æœºçš„çŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>REMOTE_STATUS_CODE<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl -s -o /dev/null -I -w <span style="color:#e6db74">&#34;%{http_code}&#34;</span> http://example.com/login<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„çŠ¶æ€ç æ˜¯å¦ä¸º200</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span> -eq <span style="color:#e6db74">&#34;200&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„IPåœ°å€æ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> grep -Fxq <span style="color:#e6db74">&#34;</span>$USER_IP<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span>$ALLOWED_IP_LIST<span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;Access granted to </span>$USER_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        exit <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å‘é€Telegramå‘Šè­¦</span>
</span></span><span style="display:flex;"><span>        MESSAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Unauthorized login attempt from IP </span>$USER_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://api.telegram.org/bot</span>$TELEGRAM_API_TOKEN<span style="color:#e6db74">/sendMessage&#34;</span>
</span></span><span style="display:flex;"><span>        curl -s -X POST $URL -d chat_id<span style="color:#f92672">=</span>$TELEGRAM_CHAT_ID -d text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$MESSAGE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;Access denied to </span>$USER_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Access denied to </span>$USER_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span></span></span></code></pre></div></blockquote>
<ul>
<li>ç¤ºä¾‹è„šæœ¬ï¼Œç”¨äºè¿‡æ»¤ç½‘ç«™åå°ç™»å½•<code>URL</code>çš„<code>IP</code>åœ°å€å’ŒçŠ¶æ€ç ï¼Œå°†ä¸åœ¨é¢„å®šä¹‰æ–‡ä»¶åˆ—è¡¨ä¸­çš„<code>IP</code>åœ°å€å‘é€åˆ°<code>Telegram</code>é€šçŸ¥ç»„ã€‚</li>
</ul>
<blockquote>
<ul>
<li>è„šæœ¬ä¼šå‘é€ä¸€ä¸ª<code>HTTP</code>è¯·æ±‚æ¥æ£€æŸ¥ç½‘ç«™åå°ç™»å½•<code>URL</code>çš„<code>IP</code>åœ°å€å’ŒçŠ¶æ€ç ã€‚å¦‚æœçŠ¶æ€ç ä¸º<code>200</code>ï¼Œåˆ™å®ƒå°†ä»<code>HTTP</code>å“åº”ä¸­æå–è¿œç¨‹ä¸»æœºçš„IPåœ°å€ï¼Œå¹¶ä»æ–‡ä»¶ä¸­æ£€æŸ¥å®ƒæ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ˜¾ç¤º<code>Access granted</code>ï¼Œå¦åˆ™å°†å‘é€<code>Telegram</code>å‘Šè­¦ï¼Œå¹¶æ˜¾ç¤º<code>Access denied</code>ã€‚è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦å°†<code>YOUR_TELEGRAM_API_TOKEN</code>å’Œ<code>YOUR_TELEGRAM_CHAT_ID</code>æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„<code>Telegram API Token</code>å’Œ<code>Chat ID</code>ï¼Œå¹¶æ ¹æ®éœ€è¦ä¿®æ”¹<code>LOGIN_URL</code>å’Œ<code>REQUEST_HEADERS</code>ã€‚</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é¢„å®šä¹‰å…è®¸ç™»å½•çš„IPåœ°å€åˆ—è¡¨æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>ALLOWED_IP_LIST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;allowed_ips.txt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰éœ€è¦æ£€æŸ¥çš„ç½‘ç«™åå°ç™»å½•URLå’Œè¯·æ±‚å¤´ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>LOGIN_URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://example.com/admin/login&#34;</span>
</span></span><span style="display:flex;"><span>REQUEST_HEADERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-H &#39;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:90.0) Gecko/20100101 Firefox/90.0&#39; -H &#39;Accept-Language: en-US,en;q=0.5&#39;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰Telegramé€šçŸ¥ç»„çš„API Tokenå’ŒChat ID</span>
</span></span><span style="display:flex;"><span>TELEGRAM_API_TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YOUR_TELEGRAM_API_TOKEN&#34;</span>
</span></span><span style="display:flex;"><span>TELEGRAM_CHAT_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YOUR_TELEGRAM_CHAT_ID&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–ç”¨æˆ·IPåœ°å€</span>
</span></span><span style="display:flex;"><span>USER_IP<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl -s -o /dev/null -w <span style="color:#e6db74">&#34;%{http_code}:%{remote_ip}&#34;</span> $LOGIN_URL -H <span style="color:#e6db74">&#34;</span>$REQUEST_HEADERS<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–è¿œç¨‹ä¸»æœºçš„çŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>REMOTE_STATUS_CODE<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$USER_IP<span style="color:#e6db74">&#34;</span> | cut -d<span style="color:#e6db74">&#39;:&#39;</span> -f1<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„çŠ¶æ€ç æ˜¯å¦ä¸º200</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span> -eq <span style="color:#e6db74">&#34;200&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è·å–è¿œç¨‹ä¸»æœºçš„IPåœ°å€</span>
</span></span><span style="display:flex;"><span>    REMOTE_IP<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$USER_IP<span style="color:#e6db74">&#34;</span> | cut -d<span style="color:#e6db74">&#39;:&#39;</span> -f2<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„IPåœ°å€æ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> grep -Fxq <span style="color:#e6db74">&#34;</span>$REMOTE_IP<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span>$ALLOWED_IP_LIST<span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;Access granted to </span>$REMOTE_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        exit <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å‘é€Telegramå‘Šè­¦</span>
</span></span><span style="display:flex;"><span>        MESSAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Unauthorized login attempt from IP </span>$REMOTE_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://api.telegram.org/bot</span>$TELEGRAM_API_TOKEN<span style="color:#e6db74">/sendMessage&#34;</span>
</span></span><span style="display:flex;"><span>        curl -s -X POST $URL -d chat_id<span style="color:#f92672">=</span>$TELEGRAM_CHAT_ID -d text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$MESSAGE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;Access denied to </span>$REMOTE_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Access denied with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span></span></span></code></pre></div></blockquote>
<ul>
<li>ç¨å¾®ä¿®æ”¹çš„è„šæœ¬ï¼Œç”¨äºè¿‡æ»¤ç½‘ç«™åå°ç™»å½•æ—¥å¿—æ–‡ä»¶ä¸­çš„<code>URL</code>ã€<code>IP</code>åœ°å€å’ŒçŠ¶æ€ç ï¼Œå°†ä¸åœ¨é¢„å®šä¹‰æ–‡ä»¶åˆ—è¡¨ä¸­çš„<code>IP</code>åœ°å€å‘é€åˆ°<code>Telegram</code>é€šçŸ¥ç»„ï¼š</li>
</ul>
<blockquote>
<ul>
<li>è¯¥è„šæœ¬ä¼šä»æ—¥å¿—æ–‡ä»¶ä¸­è¿‡æ»¤å‡ºç™»å½•<code>URL</code>ã€<code>IP</code>åœ°å€å’ŒçŠ¶æ€ç ä¿¡æ¯ï¼Œå¹¶éå†è¿™äº›ä¿¡æ¯ã€‚å¯¹äºæ¯ä¸ª<code>IP</code>åœ°å€å’ŒçŠ¶æ€ç ï¼Œå®ƒå°†æ£€æŸ¥çŠ¶æ€ç æ˜¯å¦ä¸º<code>200</code>ï¼Œç„¶åæ£€æŸ¥<code>IP</code>åœ°å€æ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ˜¾ç¤º<code>Access granted</code>ï¼Œå¦åˆ™å°†å‘é€<code>Telegram</code>å‘Šè­¦ï¼Œå¹¶æ˜¾ç¤º<code>Access denied</code>ã€‚è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦å°†<code>YOUR_TELEGRAM_API_TOKEN</code>å’Œ<code>YOUR_TELEGRAM_CHAT_ID</code>æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„<code>Telegram API Token</code>å’Œ<code>Chat ID</code>ï¼Œå¹¶æ ¹æ®éœ€è¦ä¿®æ”¹<code>ALLOWED_IP_LIST</code>å’Œ<code>LOG_FILE</code>ã€‚</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é¢„å®šä¹‰å…è®¸ç™»å½•çš„IPåœ°å€åˆ—è¡¨æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>ALLOWED_IP_LIST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;allowed_ips.txt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰éœ€è¦æ£€æŸ¥çš„ç½‘ç«™åå°ç™»å½•æ—¥å¿—æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>LOG_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/var/log/nginx/access.log&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰Telegramé€šçŸ¥ç»„çš„API Tokenå’ŒChat ID</span>
</span></span><span style="display:flex;"><span>TELEGRAM_API_TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YOUR_TELEGRAM_API_TOKEN&#34;</span>
</span></span><span style="display:flex;"><span>TELEGRAM_CHAT_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YOUR_TELEGRAM_CHAT_ID&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨grepå‘½ä»¤ä»æ—¥å¿—æ–‡ä»¶ä¸­è¿‡æ»¤å‡ºç™»å½•URLã€IPåœ°å€å’ŒçŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>LOG_FILTER<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>grep -E <span style="color:#e6db74">&#39;\/admin\/login.*HTTP\/1\.[01]&#34; 200&#39;</span> $LOG_FILE | awk <span style="color:#e6db74">&#39;{print $1, $7, $9}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># éå†è¿‡æ»¤å‡ºçš„æ—¥å¿—ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> read -r log_info; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># åˆ†åˆ«æå–IPåœ°å€å’ŒçŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>    REMOTE_IP<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$log_info<span style="color:#e6db74">&#34;</span> | awk <span style="color:#e6db74">&#39;{print $1}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>    REMOTE_STATUS_CODE<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$log_info<span style="color:#e6db74">&#34;</span> | awk <span style="color:#e6db74">&#39;{print $2}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æ£€æŸ¥çŠ¶æ€ç æ˜¯å¦ä¸º200</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span> -eq <span style="color:#e6db74">&#34;200&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># æ£€æŸ¥IPåœ°å€æ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> grep -Fxq <span style="color:#e6db74">&#34;</span>$REMOTE_IP<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span>$ALLOWED_IP_LIST<span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>            echo <span style="color:#e6db74">&#34;Access granted to </span>$REMOTE_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># å‘é€Telegramå‘Šè­¦</span>
</span></span><span style="display:flex;"><span>            MESSAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Unauthorized login attempt from IP </span>$REMOTE_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://api.telegram.org/bot</span>$TELEGRAM_API_TOKEN<span style="color:#e6db74">/sendMessage&#34;</span>
</span></span><span style="display:flex;"><span>            curl -s -X POST $URL -d chat_id<span style="color:#f92672">=</span>$TELEGRAM_CHAT_ID -d text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$MESSAGE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            echo <span style="color:#e6db74">&#34;Access denied to </span>$REMOTE_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span> <span style="color:#f92672">&lt;&lt;&lt;</span> <span style="color:#e6db74">&#34;</span>$LOG_FILTER<span style="color:#e6db74">&#34;</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="../../../js/clipboard.min.js?1722425299" defer></script>
    <script src="../../../js/perfect-scrollbar.min.js?1722425299" defer></script>
    <script src="../../../js/theme.js?1722425299" defer></script>
  </body>
</html>
