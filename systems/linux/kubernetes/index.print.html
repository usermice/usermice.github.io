<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <meta name="author" content="äºŒå“¥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/s2-1.png">
    <meta name="twitter:title" content="Kubernetes :: Hugo Relearn Theme">
    <meta property="og:url" content="https://erge.blog/systems/linux/kubernetes/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Kubernetes :: Hugo Relearn Theme">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://erge.blog/images/s2-1.png">
    <meta itemprop="name" content="Kubernetes :: Hugo Relearn Theme">
    <meta itemprop="datePublished" content="2024-06-13T00:31:03+08:00">
    <meta itemprop="dateModified" content="2024-06-13T00:31:03+08:00">
    <meta itemprop="image" content="https://erge.blog/images/s2-1.png">
    <title>Kubernetes :: Hugo Relearn Theme</title>
    <link href="../../../images/favicon.ico?1722425298" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../css/fontawesome-all.min.css?1722425299" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fontawesome-all.min.css?1722425299" rel="stylesheet"></noscript>
    <link href="../../../css/nucleus.css?1722425299" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1722425299" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/auto-complete.css?1722425299" rel="stylesheet"></noscript>
    <link href="../../../css/perfect-scrollbar.min.css?1722425299" rel="stylesheet">
    <link href="../../../css/fonts.css?1722425299" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fonts.css?1722425299" rel="stylesheet"></noscript>
    <link href="../../../css/theme.css?1722425299" rel="stylesheet">
    <link href="../../../css/theme-relearn-auto.css?1722425299" rel="stylesheet" id="R-variant-style">
    <link href="../../../css/chroma-relearn-auto.css?1722425299" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../css/variant.css?1722425299" rel="stylesheet">
    <link href="../../../css/print.css?1722425299" rel="stylesheet" media="print">
    <link href="../../../css/format-print.css?1722425299" rel="stylesheet">
    <script src="../../../js/variant.js?1722425299"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../systems/linux/kubernetes/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Kubernetes</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/keepalived/install_keepalived/" title="Install_Keepalived (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/kubernetes/kubernetes_template/" title="Kubernetes_Template (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="kubernetes">Kubernetes</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Kubernetes</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="kubernetes_template">Kubernetes_Template</h1>

<h1 id="èµ„æºæ§åˆ¶å™¨">èµ„æºæ§åˆ¶å™¨</h1>
<blockquote>

<pre class="mermaid align-center zoomable">graph LR
A[æ€ç»´å¯¼å›¾] --&gt;B[1.å‰è¨€]
A[æ€ç»´å¯¼å›¾] --&gt;C[2.Namespace]
A[æ€ç»´å¯¼å›¾] --&gt;D[3.Deployment]
A[æ€ç»´å¯¼å›¾] --&gt;E[4.StatefulSet]
A[æ€ç»´å¯¼å›¾] --&gt;F[5.DaemonSet]
A[æ€ç»´å¯¼å›¾] --&gt;G[6.HorizontalPodAutoscaler]
A[æ€ç»´å¯¼å›¾] --&gt;H[7.EndPoint]
A[æ€ç»´å¯¼å›¾] --&gt;I[8.Service]
A[æ€ç»´å¯¼å›¾] --&gt;J[9.Labelæ ‡ç­¾/Selectoré€‰æ‹©å™¨]
C[2.Namespace] --&gt;|a=1|C1[2.1æ¦‚è¿°]
C[2.Namespace] --&gt;|a=2|C2[2.2åº”ç”¨ç¤ºä¾‹]
D[3.Deployment] --&gt;|a=1|D1[3.1æ¦‚è¿°]
D[3.Deployment] --&gt;|a=2|D2[3.2è¯­æ³•ä»¥åŠåº”ç”¨ç¤ºä¾‹]
E[4.StatefulSet] --&gt;|a=1|E1[4.1æ¦‚è¿°]
E[4.StatefulSet] --&gt;|a=2|E2[4.2è¯­æ³•ä»¥åŠåº”ç”¨ç¤ºä¾‹]
F[5.DaemonSet] --&gt;|a=1|F1[5.1æ¦‚è¿°]
F[5.DaemonSet] --&gt;|a=2|F2[5.2è¯­æ³•ä»¥åŠåº”ç”¨ç¤ºä¾‹]
G[6.HorizontalPodAutoscaler] --&gt;|a=1|G1[6.1æ¦‚è¿°]
G[6.HorizontalPodAutoscaler] --&gt;|a=2|G2[6.2è¯­æ³•ä»¥åŠåº”ç”¨]
H[7.EndPoint] --&gt;|a=1|H1[7.1æ¦‚è¿°]
H[7.EndPoint] --&gt;|a=2|H2[7.2è¯­æ³•ä»¥åŠåº”ç”¨]
I[8.Service] --&gt;|a=1|I1[8.1æ¦‚è¿°]
I[8.Service] --&gt;|a=2|I2[8.2è¯­æ³•ä»¥åŠåº”ç”¨]
J[9.Labelæ ‡ç­¾/Selectoré€‰æ‹©å™¨] --&gt;|a=1|J1[9.1æ¦‚è¿°]
J[9.Labelæ ‡ç­¾/Selectoré€‰æ‹©å™¨] --&gt;|a=2|J2[9.2è¯­æ³•ä»¥åŠåº”ç”¨]

Z[æ¨ªå‘æµç¨‹å›¾]</pre>
<pre class="mermaid align-center zoomable">graph TD
A[Deployment] --&gt; D[ReplicaSet]
B[CronJob] --&gt; E[Job]
C[DaemonSet] --&gt; G{{å®¹å™¨}}
D[ReplicaSet] --&gt; G{{å®¹å™¨}}
E[Job] --&gt; G{{å®¹å™¨}}
F[StatefulSet] --&gt; G{{å®¹å™¨}}

G{{å®¹å™¨}} --&gt; J[/Volume\]
G{{å®¹å™¨}} --&gt; H(ServiceæœåŠ¡)

J[/Volume\] --&gt; K[/configMap\]
J[/Volume\] --&gt; L[/PVC\]
J[/Volume\] --&gt; M[/Secret\]

Z[Kubernetesæ§åˆ¶æµç¨‹]</pre><ul>
<li><!-- raw HTML omitted -->æ ‡ç­¾é€‰æ‹©å™¨<!-- raw HTML omitted --></li>
</ul>

<pre class="mermaid align-center zoomable">graph LR
A[Deployment&lt;br&gt;seletor:env=dev] -.- C[Label&lt;br&gt;]  
B{Service&lt;br&gt;seletor:env=dev} --- C[Label&lt;br&gt;]
C[Label&lt;br&gt;] --- C1((Pod&lt;br&gt;labe:env=dev))
C[Label&lt;br&gt;] --- C2((Pod&lt;br&gt;labe:env=dev))
C[Label&lt;br&gt;] --- C3((Pod&lt;br&gt;labe:env=dev))
    Z[Service]</pre>
<pre class="mermaid align-center zoomable">graph TD

A[user containerN&lt;br&gt;user ImageN&lt;br&gt;user container1&lt;br&gt;user Image1&lt;br&gt;Pause&lt;br&gt;gcr.io/google_containers/pause-amd64&lt;br&gt;] 
    Z[Pod]</pre></blockquote>
<hr>
<h2 id="èµ„æºåç§°">èµ„æºåç§°</h2>
<blockquote>
<ul>
<li>
<ol>
<li><code>kubectl api-resources -o wide</code><!-- raw HTML omitted -->ï¼šè·å–å‚æ•°å®šä¹‰å‘½ä»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<table>
<thead>
<tr>
<th><code>Name</code>(åç§°)</th>
<th><code>ShortNames</code>(ç®€å†™)</th>
<th><code>apiVersion</code>(<code>API</code>ç‰ˆæœ¬)</th>
<th><code>NameSpaced</code>(å‘½åç©ºé—´)</th>
<th>kind(ç±»å‹)</th>
<th>Verbs(å¯æ‰§è¡Œæ“ä½œå‘½ä»¤)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>configmaps</code></td>
<td>cm</td>
<td>v1</td>
<td>true</td>
<td>ConfigMap</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>events</td>
<td>ev</td>
<td>v1</td>
<td>true</td>
<td>Event</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td><code>limitranges</code></td>
<td>limits</td>
<td>v1</td>
<td>true</td>
<td>LimitRange</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>pods</td>
<td>po</td>
<td>v1</td>
<td>true</td>
<td>Pod</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>serviceaccounts</td>
<td>sa</td>
<td>v1</td>
<td>true</td>
<td>ServiceAccount</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>services</td>
<td>svc</td>
<td>v1</td>
<td>true</td>
<td>Service</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>daemonsets</td>
<td>ds</td>
<td>apps/v1</td>
<td>true</td>
<td>DaemonSet</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>deployments</td>
<td>deploy</td>
<td>apps/v1</td>
<td>true</td>
<td>Deployment</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>replicasets</td>
<td>rs</td>
<td>apps/v1</td>
<td>true</td>
<td>ReplicaSet</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>statefulsets</td>
<td>sts</td>
<td>apps/v1</td>
<td>true</td>
<td>StatefulSet</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>horizontalpodautoscalers</td>
<td>hpa</td>
<td>autoscaling/v2</td>
<td>true</td>
<td>HorizontalPodAutoscaler</td>
<td>create,delete,deletecollection,get,list,patch,update,watch   all</td>
</tr>
<tr>
<td>cronjobs</td>
<td>cj</td>
<td>batch/v1</td>
<td>true</td>
<td>CronJob</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>jobs</td>
<td></td>
<td>batch/v1</td>
<td>true</td>
<td>Job</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>events</td>
<td>ev</td>
<td>events.k8s.io/v1</td>
<td>true</td>
<td>Event</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>ingresses</td>
<td>ing</td>
<td>networking.k8s.io/v1</td>
<td>true</td>
<td>Ingress</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>networkpolicies</td>
<td>netpol</td>
<td>networking.k8s.io/v1</td>
<td>true</td>
<td>NetworkPolicy</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>poddisruptionbudgets</td>
<td>pdb</td>
<td>policy/v1</td>
<td>true</td>
<td>PodDisruptionBudget</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->èµ„æºæ§åˆ¶å™¨ä½œç”¨<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>èµ„æºåˆ†ç±»</th>
<th>èµ„æºåç§°</th>
<th>ç¼©å†™</th>
<th>èµ„æºä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Pod</code>èµ„æºæ§åˆ¶å™¨</td>
<td><code>replicasets</code></td>
<td><code>rs</code></td>
<td>ä¿è¯æŒ‡å®šæ•°é‡çš„<code>Pod</code>è¿è¡Œï¼Œå¹¶æ”¯æŒ<code>Pod</code>æ•°é‡å˜æ›´ï¼Œé•œåƒç‰ˆæœ¬å˜æ›´</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>deployments</code></td>
<td><code>deploy</code></td>
<td>é€šè¿‡æ§åˆ¶<code>ReplicaSet</code>æ¥æ§åˆ¶<code>Pod</code>ï¼Œå¹¶æ”¯æŒæ»šåŠ¨å‡çº§ã€ç‰ˆæœ¬å›é€€</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>daemonsets</code></td>
<td><code>ds</code></td>
<td>åœ¨é›†ç¾¤ä¸­çš„æŒ‡å®š<code>Node</code>ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬ç”¨äºæ—¥å¿—é‡‡é›†ã€ç›‘æ§ã€å®ˆæŠ¤è¿›ç¨‹ç±»çš„ä»»åŠ¡ã€‚</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>jobs</code></td>
<td>&mdash;</td>
<td>å®ƒåˆ›å»ºå‡ºæ¥çš„<code>Pod</code>åªè¦å®Œæˆä»»åŠ¡å°±ç«‹å³é€€å‡ºï¼Œç”¨äºæ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>cronjobs</code></td>
<td><code>cj</code></td>
<td>å®ƒåˆ›å»ºçš„Podä¼šå‘¨æœŸæ€§çš„æ‰§è¡Œï¼Œç”¨äºæ‰§è¡Œå‘¨æœŸæ€§çš„ä»»åŠ¡</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>horizontalpodautoscalers</code></td>
<td><code>hpa</code></td>
<td>å¯ä»¥æ ¹æ®é›†ç¾¤è´Ÿè½½è‡ªåŠ¨è°ƒæ•´<code>Pod</code>çš„æ•°é‡ï¼Œå®ç°å‰Šå³°å¡«è°·</td>
</tr>
<tr>
<td><code>Pod</code>èµ„æºæ§åˆ¶å™¨</td>
<td><code>statefulsets</code></td>
<td><code>sts</code></td>
<td>ç®¡ç†æœ‰çŠ¶æ€çš„åº”ç”¨ã€‚</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="èµ„æºæ§åˆ¶å™¨å­—æ®µç±»å‹ä½œç”¨">èµ„æºæ§åˆ¶å™¨å­—æ®µç±»å‹ä½œç”¨</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>explain</code><!-- raw HTML omitted -->é€‰é¡¹è·å–å­—æ®µä½¿ç”¨æ–¹å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain deployment.metadata  	<span style="color:#75715e"># è·å– deploymentçš„metadataä½¿ç”¨æ–¹å¼ï¼Œ è¿˜å¯ä»¥è·å–ï¼šspecã€kind</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl explain deployment.spec.selector  <span style="color:#75715e"># è·å–yamlåŸºç¡€æ ¼å¼å‘½ä»¤ </span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->èµ„æºæ§åˆ¶å™¨<!-- raw HTML omitted --><!-- raw HTML omitted -->å¿…é€‰å­—æ®µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>version</code></td>
<td><code>String</code></td>
<td><code>Kubernetes API </code>çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨<code>kubectl api-versions</code>å‘½ä»¤æŸ¥è¯¢</td>
</tr>
<tr>
<td><code>kind</code></td>
<td><code>String</code></td>
<td>æ ‡æ˜<code>YAML</code>å®šä¹‰çš„èµ„æºç±»å‹å’Œè§’è‰²ï¼Œå¦‚<code>Pod</code>ã€<code>Deployment</code>ç­‰</td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><code>String</code></td>
<td>å…ƒæ•°æ®å¯¹è±¡</td>
</tr>
<tr>
<td><code>metadata.name</code></td>
<td><code>String</code></td>
<td>å…ƒæ•°æ®å¯¹è±¡çš„åå­—ï¼Œå¯è‡ªå®šä¹‰ï¼Œæ¯”å¦‚å‘½å<code>Pod</code>çš„åå­—</td>
</tr>
<tr>
<td><code>spec</code></td>
<td><code>Object</code></td>
<td>è¯¦ç»†å®šä¹‰å¯¹è±¡</td>
</tr>
<tr>
<td><code>spec.containers[]</code></td>
<td><code>List</code></td>
<td>å®¹å™¨åˆ—è¡¨å®šä¹‰</td>
</tr>
<tr>
<td><code>spec.containers[].name</code></td>
<td><code>String</code></td>
<td>å®šä¹‰å®¹å™¨çš„åå­—</td>
</tr>
<tr>
<td><code>spec.containers[].image</code></td>
<td><code>String</code></td>
<td>å®šä¹‰å®¹å™¨ä½¿ç”¨çš„é•œåƒ</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>metadata</code><!-- raw HTML omitted -->å­—æ®µé€‰æ‹©<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>metadata.name</code></td>
<td></td>
<td><code>Pod</code>åç§°</td>
</tr>
<tr>
<td><code>metadata.uid</code></td>
<td></td>
<td><code>Pod</code>çš„<code>UID</code></td>
</tr>
<tr>
<td><code>metadata.namespace</code></td>
<td></td>
<td><code>Pod</code>åå­—ç©ºé—´</td>
</tr>
<tr>
<td><code>metadata.labels['&lt;KEY&gt;']</code></td>
<td></td>
<td><code>Pod</code>æ ‡ç­¾ <code>&lt;KEY&gt;</code> çš„å€¼ (ä¾‹å¦‚<code>metadata.labels['mylabel']</code>ï¼‰</td>
</tr>
<tr>
<td><code>metadata.annotations['&lt;KEY&gt;']</code></td>
<td></td>
<td><code>Pod</code>çš„æ³¨è§£ <code>&lt;KEY&gt;</code> çš„å€¼ï¼ˆä¾‹å¦‚, <code>metadata.annotations['myannotation']</code>ï¼‰</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="3">
<li><code>spec.containers</code><!-- raw HTML omitted -->å­—æ®µå®šä¹‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.containers[].name</td>
<td>String</td>
<td>å®šä¹‰å®¹å™¨çš„åå­—ã€‚</td>
</tr>
<tr>
<td>spec.containers[].image</td>
<td>String</td>
<td>å®šä¹‰å®¹å™¨ä½¿ç”¨çš„é•œåƒã€‚</td>
</tr>
<tr>
<td>spec.containers[].imagePullSecrets</td>
<td></td>
<td>è¦ä»ç§æœ‰ä»“åº“æ‹‰å–é•œåƒï¼Œ<code>Kubernetes</code>éœ€è¦å‡­è¯ã€‚ é…ç½®æ–‡ä»¶ä¸­çš„ <code>imagePullSecrets</code>å­—æ®µè¡¨æ˜<code>Kubernetes</code>åº”è¯¥é€šè¿‡åä¸º <code>regcred</code> çš„ Secret è·å–å‡­è¯</td>
</tr>
<tr>
<td>spec.containers[].imagePullPolicy</td>
<td>S</td>
<td>å®šé•œåƒæ‹‰å–æœ‰3ä¸ªå€¼å¯é€‰:<!-- raw HTML omitted --> <!-- raw HTML omitted --><code>Always</code><!-- raw HTML omitted -->ï¼šæ€»æ˜¯ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒã€<!-- raw HTML omitted --><!-- raw HTML omitted --><code>IfNotPresent</code><!-- raw HTML omitted -->ï¼šæœ¬åœ°æœ‰åˆ™ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒã€‚å¦‚ä¸Šé¢ 3ä¸ªå€¼éƒ½æ²¡è®¾ç½®ï¼Œé»˜è®¤æ˜¯<code>Always</code><!-- raw HTML omitted --><!-- raw HTML omitted --><code>Never</code><!-- raw HTML omitted -->ï¼šä»…ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰å°±æŠ¥é”™</td>
</tr>
<tr>
<td>spec.containers[].command[]</td>
<td>List</td>
<td>æŒ‡å®šå®¹å™¨å¯åŠ¨å‘½ä»¤ï¼Œå› ä¸ºæ˜¯æ•°ç»„å½¢å¼ï¼Œæ‰€ä»¥å¯ä»¥æŒ‡å®šå¤šä¸ªå¯åŠ¨å‘½ä»¤ï¼Œä¸æŒ‡å®šåˆ™ä½¿ç”¨é•œåƒæ‰“åŒ…æ—¶çš„å¯åŠ¨å‘½ä»¤ã€‚</td>
</tr>
<tr>
<td>spec.containers[].args[]</td>
<td>List</td>
<td>æŒ‡å®šå®¹å™¨å¯åŠ¨å‘½ä»¤å‚æ•°ï¼Œå› ä¸ºæ˜¯æ•°ç»„å½¢å¼ï¼Œæ‰€ä»¥å¯ä»¥æŒ‡å®šå¤šä¸ªå‚æ•°ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">imagePullSecrets</span>:  	<span style="color:#75715e"># é…ç½®ç™»å½• docker registry çš„ secret ä»“åº“</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker-harbor  	# æŒ‡å®šä½¿ç”¨çš„secretåº“æˆ¿åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨ï¼Œä¸€ä¸ªPodä¸­å¯ä»¥å®šä¹‰å¤šä¸ªå®¹å™¨</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">tomcat-demo   	# æŒ‡å®šå®¹å™¨åç§°ï¼Œä¸å¯æ›´æ–°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">192.168.80.210</span>:<span style="color:#ae81ff">8080</span><span style="color:#ae81ff">/test/tomcat-demo:v1 </span> <span style="color:#75715e"># é•œåƒä»“åº“åœ°å€</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">Always   	# å®¹å™¨ä¸‹è½½ç­–ç•¥ï¼šAlways|Never|IfNotPresentï¼Œä¸ç®¡æœ¬åœ°å­˜ä¸å­˜åœ¨ï¼Œéƒ½ä»ä»“åº“æ‹‰å–é•œåƒ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#ae81ff">string]   	# å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œæ›¿ä»£dockerçš„ENTRYPOINTæŒ‡ä»¤ã€å¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">args</span>:   	<span style="color:#75715e"># å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨ã€æ›¿ä»£dockerçš„CMDæŒ‡ä»¤</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">/bin/sh</span>
</span></span><span style="display:flex;"><span>    - -<span style="color:#ae81ff">c</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">touch /tmp/healthy; sleep 30; rm -fr /tmp/healthy; sleep 600</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>spec.containers.volumeMounts</code><!-- raw HTML omitted -->å®¹å™¨å·¥ä½œç›®å½•å®šä¹‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.containers[].workingDir</td>
<td>String</td>
<td>æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•</td>
</tr>
<tr>
<td>spec.containers[].volumeMounts[]</td>
<td>List</td>
<td>æŒ‡å®šå®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</td>
</tr>
<tr>
<td>spec.containers[].volumeMounts[].name</td>
<td>String</td>
<td>æŒ‡å®šå¯ä»¥è¢«å®¹å™¨æŒ‚è½½çš„å­˜å‚¨å·çš„åç§°</td>
</tr>
<tr>
<td>spec.containers[].volumeMounts[].mountPath</td>
<td>String</td>
<td>æŒ‡å®šå¯ä»¥è¢«å®¹å™¨æŒ‚è½½çš„å­˜å‚¨å·çš„è·¯å¾„ã€‚</td>
</tr>
<tr>
<td>spec.containers[].volumeMountsf].readOnly</td>
<td>String</td>
<td>è®¾ç½®å­˜å‚¨å·è·¯å¾„çš„è¯»å†™æ¨¡å¼ï¼Œtrue æˆ–è€… falseï¼Œé»˜è®¤ä¸ºè¯»å†™æ¨¡å¼ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">containers</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">workingDir</span>: <span style="color:#ae81ff">string   	# å®¹å™¨çš„å·¥ä½œç›®å½•ã€ä¸æŒ‡å®šåˆ™ä½¿ç”¨é•œåƒé»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMounts</span>:   	<span style="color:#75715e"># æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">data   	# å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/opt/data   	# å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">readOnly</span>: <span style="color:#ae81ff">boolean   	# æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>spec.containers.ports</code><!-- raw HTML omitted -->å®¹å™¨ç«¯å£å®šä¹‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain deployment.spec.containers.ports  	<span style="color:#75715e"># è·å–ç«¯å£ä½¿ç”¨æ–¹å¼</span></span></span></code></pre></div><table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.containers[].ports[]</td>
<td>List</td>
<td>æŒ‡å®šå®¹å™¨éœ€è¦ç”¨åˆ°çš„ç«¯å£åˆ—è¡¨ã€‚</td>
</tr>
<tr>
<td>spec.containers[].ports[].name</td>
<td>String</td>
<td>æŒ‡å®šç«¯å£åç§°ã€‚</td>
</tr>
<tr>
<td>spec.containers[].ports[].containerPort</td>
<td>String</td>
<td>æŒ‡å®šå®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·ã€‚</td>
</tr>
<tr>
<td>spec.containers[].ports[].hostPort</td>
<td>String</td>
<td>æŒ‡å®šå®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤å’Œ spec.containers[].ports[].containerPort ç›¸åŒã€‚æ³¨æ„ï¼Œè®¾ç½®äº†åˆ™åŒä¸€å°ä¸»æœºæ— æ³•å¯åŠ¨è¯¥å®¹å™¨çš„ç›¸åŒå‰¯æœ¬ï¼ˆä¸»æœºçš„ç«¯å£å·ä¸èƒ½ç›¸åŒï¼Œè‹¥ç›¸åŒï¼Œä¼šå¼•å‘å†²çªï¼‰ã€‚</td>
</tr>
<tr>
<td>spec.containers[].ports[].protocol</td>
<td>String</td>
<td>æŒ‡å®šç«¯å£åè®®ï¼Œæ”¯æŒ TCP å’Œ UDPï¼Œé»˜è®¤å€¼ä¸º TCP ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:  	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">containers</span>:  	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:  	<span style="color:#75715e"># å®¹å™¨æš´éœ²çš„ç«¯å£</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">http  	# æœåŠ¡åç§°ã€è¯¥åç§°å¯ä»¥åœ¨serviceç§è¢«å¼•ç”¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>  	<span style="color:#75715e"># å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">hostPort</span>: <span style="color:#ae81ff">int  	# å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP  	# ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>  	<span style="color:#75715e"># é›†ç¾¤ç«¯å£</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>  	<span style="color:#75715e"># Podç«¯å£</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nodePort</span>: <span style="color:#ae81ff">30080</span>  	<span style="color:#75715e"># èŠ‚ç‚¹å¯¹å¤–ç«¯å£</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><code>spec.containers.env</code><!-- raw HTML omitted -->å®¹å™¨å˜é‡å®šä¹‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.containers[].env[]</td>
<td>List</td>
<td>æŒ‡å®šå®¹å™¨è¿è¡Œå‰éœ€è¦è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ã€‚</td>
</tr>
<tr>
<td>spec.containers[].env[].name</td>
<td>String</td>
<td>æŒ‡å®šç¯å¢ƒå˜é‡åç§°ã€‚</td>
</tr>
<tr>
<td>spec.containers[].env[].value</td>
<td>String</td>
<td>æŒ‡å®šç¯å¢ƒå˜é‡å€¼ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">containers</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">env</span>:   	<span style="color:#75715e"># å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">JAVA_OPTS   	# ç¯å¢ƒå˜é‡åç§°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;-Xmx1g&#34;</span>   	<span style="color:#75715e"># å®šä¹‰ä½¿ç”¨å†…å­˜ã€ç¯å¢ƒå˜é‡çš„å€¼</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><code>spec.containers.resources</code><!-- raw HTML omitted -->å®¹å™¨èµ„æºé™åˆ¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.containers[].resources</td>
<td>Object</td>
<td>æŒ‡å®šèµ„æºé™åˆ¶å’Œèµ„æºè¯·æ±‚çš„å€¼ï¼ˆè¿™é‡Œå¼€å§‹å°±æ˜¯è®¾ç½®å®¹å™¨çš„èµ„æºä¸Šé™ï¼‰ã€‚</td>
</tr>
<tr>
<td>spec.containers[].resources.limits</td>
<td>Object</td>
<td>æŒ‡å®šè®¾ç½®å®¹å™¨è¿è¡Œæ—¶èµ„æºçš„è¿è¡Œä¸Šé™ã€‚</td>
</tr>
<tr>
<td>spec.containers[].resources.limits.cpu</td>
<td>String</td>
<td>æŒ‡å®š<code>CPU</code>çš„é™åˆ¶ï¼Œå•ä½ä¸º<code>core</code>ï¼Œæ˜¯ç”¨äºè¿è¡Œ <code>docker run --cpu-shares</code>å‘½ä»¤çš„å‚æ•°ã€‚</td>
</tr>
<tr>
<td>spec.containers[].resources.limits.memory</td>
<td>String</td>
<td>æŒ‡å®šå†…å­˜çš„é™åˆ¶ï¼Œå•ä½ä¸º MiB æˆ– GiBã€‚</td>
</tr>
<tr>
<td>spec.containers[].resources.requests</td>
<td>Object</td>
<td>æŒ‡å®šå®¹å™¨å¯åŠ¨å’Œè°ƒåº¦æ—¶çš„é™åˆ¶ã€‚</td>
</tr>
<tr>
<td>spec.containers[].resources.requests.cpu</td>
<td>String</td>
<td>CPU è¯·æ±‚ï¼Œå•ä½ä¸º coreï¼Œå®¹å™¨å¯åŠ¨æ—¶åˆå§‹åŒ–å¯ç”¨æ•°é‡ã€‚</td>
</tr>
<tr>
<td>spec.containers[].resources.requests.memory</td>
<td>String</td>
<td>å†…å­˜è¯·æ±‚ï¼Œå•ä½ä¸º MiB æˆ– GiBï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹åŒ–å¯ç”¨æ•°é‡ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># è®¾å®šé»˜è®¤requestå’Œlimit</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Namespace</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">apps</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">LimitRange</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">limit-resource  	# åœ¨ä¸€ä¸ªåç§°ç©ºé—´ä¸èƒ½é‡å¤</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default  	# æŒ‡å®šåç§°ç©ºé—´ï¼Œé»˜è®¤defalut</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">labels</span>:      <span style="color:#ae81ff">&lt;map[string]string&gt;  	# æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">annotations</span>: <span style="color:#ae81ff">&lt;map[string]string&gt;  	# æ³¨é‡Š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾å®šé»˜è®¤requestå’Œlimit</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">default</span>:  	<span style="color:#75715e"># é»˜è®¤çš„èµ„æºä¸Šé™, limit</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">1024Mi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">500m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">defaultRequest</span>:  	<span style="color:#75715e"># é»˜è®¤çš„èµ„æºç”³è¯·å€¼, required</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">100m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">max</span>:  	<span style="color:#75715e"># å£°æ˜çš„limitä¸Šé™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">2048Mi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">1000m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">min</span>:  	<span style="color:#75715e"># å£°æ˜çš„requiredä¸‹çº¿</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">64Mi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">50m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Container  	# è¢«é™åˆ¶çš„å¯¹è±¡ï¼ŒContainer</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">###############################################</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   	<span style="color:#75715e"># Podä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:   	<span style="color:#75715e"># Podä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>:   	<span style="color:#75715e"># èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">limits</span>:   	<span style="color:#75715e"># é™å®šPodæœ€å¤§ä½¿ç”¨ç¡¬ä»¶èµ„æºã€é€šå¸¸è®¾ç½®cpuå’Œmemory</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span>   	<span style="color:#75715e"># Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;1Gi&#34;</span>   	<span style="color:#75715e"># å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gib</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">requests</span>:   	<span style="color:#75715e"># æœ€ä½èµ„æºè¦æ±‚ï¼Œåœ¨schedulerä¸­è¢«ç”¨åˆ°ï¼Œé€šå¸¸è®¾ç½®cpuå’Œmemory</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;0.5&#34;</span>   	<span style="color:#75715e"># é™å®šä½¿ç”¨å‡ ä¸ªæ ¸å¿ƒCPUã€å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;256Mi&#34;</span>   	<span style="color:#75715e"># è®¾å®šä½¿ç”¨å†…å­˜ã€å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="8">
<li><!-- raw HTML omitted -->å®¹å™¨å¥åº·æ£€æŸ¥è®¾ç½®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><code>startupProbe</code><!-- raw HTML omitted -->ï¼š å¯åŠ¨æ¢æµ‹ï¼š<!-- raw HTML omitted -->å®¹å™¨å¯åŠ¨å®Œæ¯•çš„é…ç½®ï¼Œè¯¥é…ç½®ä¸<code>readinessProbe</code>ä¸€è‡´ï¼Œåœ¨<code>lifecycle</code>å’Œ<code>Probe</code>ä¹‹å‰è¿è¡Œï¼Œå¤±è´¥åˆ™é‡å¯</p>
<p><code>k8s1.16</code>ç‰ˆæœ¬åæ–°åŠ <code>startupProbe</code>æ¢æµ‹æ–¹å¼ï¼Œç”¨äºåˆ¤æ–­å®¹å™¨å†…åº”ç”¨ç¨‹åºæ˜¯å¦å·²ç»å¯åŠ¨ï¼Œå¦‚æœé…ç½®äº†<code>startuprobe</code>ï¼Œå°±ä¼šå…ˆç¦ç”¨å…¶ä»–çš„æ¢æµ‹ï¼Œç›´åˆ°å®ƒæˆåŠŸä¸ºæ­¢</p>
</li>
<li>
<p><code>liveness probe</code><!-- raw HTML omitted -->(å­˜æ´»æ¢é’ˆ)<!-- raw HTML omitted --><code>Kubelet</code> ä½¿ç”¨<code>liveness probe</code>ï¼ˆå­˜æ´»æ¢é’ˆï¼‰æ¥ç¡®å®šä½•æ—¶é‡å¯å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œå½“åº”ç”¨ç¨‹åºå¤„äºè¿è¡ŒçŠ¶æ€ä½†æ— æ³•åšè¿›ä¸€æ­¥æ“ä½œï¼Œ<code>liveness</code>æ¢é’ˆå°†æ•è·åˆ°<code>deadlock</code>é‡å¯å¤„äºè¯¥çŠ¶æ€ä¸‹çš„å®¹å™¨ï¼Œä½¿åº”ç”¨ç¨‹åºåœ¨å­˜åœ¨<code>bug</code>çš„æƒ…å†µä¸‹ä¾ç„¶èƒ½å¤Ÿç»§ç»­è¿è¡Œä¸‹å»ï¼ˆè°çš„ç¨‹åºè¿˜æ²¡å‡ ä¸ª<code>bug</code>å‘¢ï¼‰</p>
</li>
<li>
<p><code>readiness probe</code><!-- raw HTML omitted -->(å°±ç»ªæ¢é’ˆ)<!-- raw HTML omitted --><code>Kubelet</code>ä½¿ç”¨<code>readiness probe(å°±ç»ªæ¢é’ˆ)</code>æ¥ç¡®å®šå®¹å™¨æ˜¯å¦å·²ç»å°±ç»ªå¯ä»¥æ¥å—æµé‡ã€‚åªæœ‰å½“<code>Pod</code>ä¸­çš„å®¹å™¨éƒ½å¤„äºå°±ç»ªçŠ¶æ€æ—¶<code>kubelet</code>æ‰ä¼šè®¤å®šè¯¥<code>Pod</code>å¤„äºå°±ç»ªçŠ¶æ€ã€‚è¯¥ä¿¡å·çš„ä½œç”¨æ˜¯æ§åˆ¶å“ªäº›<code>Pod</code>åº”è¯¥ä½œä¸º<code>service</code>çš„åç«¯ã€‚å¦‚æœ<code>Pod</code>å¤„äºéå°±ç»ªçŠ¶æ€ï¼Œé‚£ä¹ˆå®ƒä»¬å°†ä¼šè¢«ä»<code>service</code>çš„<code>load balancer</code>ä¸­ç§»é™¤</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.containers[].livenessProbe(å­˜æ´»æ¢é’ˆ)</td>
<td>Object</td>
<td>æŒ‡å®š<code>Pod</code>å†…å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹å‡ æ¬¡æ— å“åº”åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ã€‚å‚æ•°å¯ä»¥è®¾ç½®ä¸º<code>exec</code>ã€<code>httpGet</code>ã€<code>tcpSocket</code>ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.exec</td>
<td>Object</td>
<td>æŒ‡å®š<code>Pod</code>å†…å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œç¡®å®šæ˜¯<code>exec</code>æ–¹å¼ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.exec.command[]</td>
<td>String</td>
<td>æŒ‡å®š<code>exec</code>æ–¹å¼åç”¨è¿™ä¸ªå‚æ•°è®¾ç½®éœ€è¦æŒ‡å®šçš„å‘½ä»¤æˆ–è€…è„šæœ¬ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.httpGet</td>
<td>Object</td>
<td>æŒ‡å®š Pod å†…å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œç¡®å®šæ˜¯<code>httpGet</code>æ–¹å¼ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.tcpSocket</td>
<td>Object</td>
<td>æŒ‡å®š Pod å†…å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œç¡®å®šæ˜¯ <code>tcpSocket</code>æ–¹å¼ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.initialDelaySeconds</td>
<td>Number</td>
<td>æŒ‡å®šå®¹å™¨å¯åŠ¨å®Œæˆåå»¶è¿Ÿå¤šä¹…å¼€å§‹é¦–æ¬¡æ¢æµ‹çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.timeoutSeconds</td>
<td>Number</td>
<td>å®¹å™¨å¥åº·æ£€æŸ¥çš„æ¢æµ‹ç­‰å¾…æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œé»˜è®¤ä¸º 1 ç§’ã€‚è‹¥è¶…è¿‡è¯¥æ—¶é—´ï¼Œåˆ™è®¤ä¸ºè¯¥æ¬¡æ¢æµ‹å¤±è´¥ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.periodSeconds</td>
<td>Number</td>
<td>å¯¹å®¹å™¨å¥åº·æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ä¸ºç§’ï¼Œé»˜è®¤æ¯ 10 ç§’æ¢æµ‹ä¸€æ¬¡ã€‚<code>Kubernetes</code>å¦‚æœè¿ç»­æ‰§è¡Œ3æ¬¡Livenessæ¢æµ‹å‡å¤±è´¥ï¼Œåˆ™ä¼šæ€æ‰å¹¶é‡å¯å®¹å™¨</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.failureThreshold</td>
<td>Number</td>
<td>è¿ç»­æ¢æµ‹å¤±è´¥å¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºå¤±è´¥ã€‚é»˜è®¤æ˜¯3ã€‚æœ€å°å€¼æ˜¯1</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.successThreshold</td>
<td>Number</td>
<td>è¿ç»­æ¢æµ‹æˆåŠŸå¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºæˆåŠŸã€‚é»˜è®¤æ˜¯1</td>
</tr>
</tbody>
</table>
<ul>
<li><code>infrastructure Container:</code><!-- raw HTML omitted -->åŸºç¡€å®¹å™¨ï¼Œç»´æŠ¤æ•´ä¸ª<code>Pod</code>ç½‘ç»œç©ºé—´<!-- raw HTML omitted --></li>
<li><code>initContainers:</code><!-- raw HTML omitted -->åˆå§‹åŒ–å®¹å™¨ï¼Œå…ˆäºä¸šåŠ¡å®¹å™¨å¼€å§‹è¿è¡Œ<!-- raw HTML omitted --></li>
<li><code>Containers:</code><!-- raw HTML omitted -->ä¸šåŠ¡å®¹å™¨ï¼Œå¹¶è¡Œå¯åŠ¨<!-- raw HTML omitted --></li>
<li><code>Pod</code><!-- raw HTML omitted -->å†…æ‰€æœ‰å®¹å™¨å…¬ç”¨ä¸€ä¸ª<!-- raw HTML omitted --><code>ip</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">initc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">initc-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">initContainers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">initc-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#39;sh&#39;</span>, <span style="color:#e6db74">&#39;-c&#39;</span>, <span style="color:#e6db74">&#39;sleep 10; echo &#34;Hello&#34; &gt;&gt;/tmp/hello.txt&#39;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-container</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#39;sh&#39;</span>, <span style="color:#e6db74">&#39;-c&#39;</span>, <span style="color:#e6db74">&#39;echo The app is running! &amp;&amp; sleep 3600&#39;</span>]</span></span></code></pre></div><ul>
<li><code>exec</code><!-- raw HTML omitted -->å‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡Œçš„é€€å‡ºç ä¸º<code>0</code>ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸<!-- raw HTML omitted --></li>
<li><code>Pod</code><!-- raw HTML omitted -->äº”ç§çŠ¶æ€<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Pending(æŒ‚èµ·)</code>ï¼š<code>API Server</code><!-- raw HTML omitted -->å·²ç»åˆ›å»ºäº†<code>Pod</code>èµ„æºå¯¹è±¡ï¼Œä½†å®ƒå°šæœªè¢«è°ƒåº¦å®Œæˆæˆ–è€…ä»å¤„äºä¸‹è½½é•œåƒçš„è¿‡ç¨‹ä¸­<!-- raw HTML omitted --></li>
<li><code>Running(è¿è¡Œä¸­)</code>ï¼š<code>Pod</code><!-- raw HTML omitted -->å·²ç»è¢«è°ƒåº¦åˆ°æŸèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ‰€æœ‰å®¹å™¨éƒ½å·²ç»è¢«<code>kubelet</code>åˆ›å»ºå®Œæˆ<!-- raw HTML omitted --></li>
<li><code>Succeeded(æˆåŠŸç»ˆæ­¢)</code>ï¼š<code>Pod</code><!-- raw HTML omitted -->ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»æˆåŠŸç»ˆæ­¢å¹¶ä¸”ä¸ä¼šè¢«é‡å¯<!-- raw HTML omitted --></li>
<li><code>Failed(å¤±è´¥)</code><!-- raw HTML omitted -->ï¼šæ‰€æœ‰å®¹å™¨éƒ½å·²ç»ç»ˆæ­¢ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ç»ˆæ­¢å¤±è´¥ï¼Œå³å®¹å™¨è¿”å›äº†é<code>0</code>å€¼çš„é€€å‡ºçŠ¶æ€<!-- raw HTML omitted --></li>
<li><code>Unknown(æœªçŸ¥)</code>ï¼š<code>API Server</code><!-- raw HTML omitted -->æ— æ³•æ­£å¸¸è·å–åˆ°<code>Pod</code>å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œé€šå¸¸ç”±äºç½‘ç»œé€šä¿¡å¤±è´¥æ‰€å¯¼è‡´<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">lifecycle</span>:   	<span style="color:#75715e"># ç”Ÿå‘½å‘¨æœŸé’©å­</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">postStart</span>:  	<span style="color:#75715e"># å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">exec</span>:  	<span style="color:#75715e"># é€šè¿‡æ‰§è¡Œç‰¹å®šå‘½ä»¤æ¥æ¢æµ‹å®¹å™¨å¥åº·çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;echo Hello from the postStart handler&gt; /usr/share/message&#34;</span>]
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">preStop</span>:  	<span style="color:#75715e"># å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">exec</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;nginx -s quit; while killall -0 nginx; do sleep 1; done&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e">#################  		å¯åŠ¨æ¢é’ˆ	  #####################</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">startupProbe</span>:  	<span style="color:#75715e"># å®¹å™¨å¯åŠ¨å®Œæ¯•çš„é…ç½®ï¼Œè¯¥é…ç½®ä¸readinessProbeä¸€è‡´ï¼Œåœ¨lifecycleå’ŒProbeä¹‹å‰è¿è¡Œï¼Œå¤±è´¥åˆ™é‡å¯</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">tcpSocket</span>:   		<span style="color:#75715e"># ä½¿ç”¨TcpSocketã€httpGetå¥åº·æ£€æŸ¥</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8010</span>   	<span style="color:#75715e"># æ¢æµ‹8010ç«¯å£</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>  	<span style="color:#75715e"># æ£€æµ‹å¤±è´¥5æ¬¡è¡¨ç¤ºæœªå°±ç»ª</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">60</span>   	<span style="color:#75715e"># æŒ‡å®šå®¹å™¨å¯åŠ¨60sä¹‹åå¼€å§‹æ‰§è¡ŒLivenessæ¢æµ‹ï¼Œ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>  	<span style="color:#75715e"># ä¸¤æ¬¡æ¢æµ‹çš„é—´éš”å¤šå°‘ç§’ï¼Œé»˜è®¤å€¼ä¸º10</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># è¿ç»­å¤šå°‘æ¬¡æ£€æµ‹æˆåŠŸè®¤ä¸ºå®¹å™¨æ­£å¸¸ï¼Œé»˜è®¤å€¼ä¸º1ã€‚ä¸æ”¯æŒä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">3</span>  	<span style="color:#75715e"># è¿ç»­å¤šå°‘æ¬¡æ£€æµ‹å¤±è´¥è®¤ä¸ºå®¹å™¨å¼‚å¸¸ï¼Œé»˜è®¤å€¼ä¸º3</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>  	<span style="color:#75715e"># æ¢æµ‹è¯·æ±‚è¶…æ—¶æ—¶é—´</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##################  	å­˜æ´»æ¢é’ˆç¼–å†™æ–¹å¼  	################</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">livenessprobe</span>:  	<span style="color:#75715e"># å­˜æ´»æ¢é’ˆæ£€æŸ¥,ä¸é€šè¿‡ä¸è½¬å‘æµé‡</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tcpSocket</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8010</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####################  		å°±ç»ªæ¢é’ˆç¼–å†™æ–¹å¼  		################</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">readinessProbe</span>:   	<span style="color:#75715e"># å°±ç»ªæ¢é’ˆæ£€æŸ¥ã€ä¸é€šè¿‡é‡å»ºpod</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">tcpSocket</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8010</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">####################  		httpGetç¼–å†™  		###########################</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">httpGet</span>:
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/  	# URIåœ°å€</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>  	<span style="color:#75715e"># ç«¯å£å·,æˆ–è€…åè®®ï¼šhttp/https</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">host</span>: <span style="color:#ae81ff">192.168.109.100</span>  	<span style="color:#75715e"># ä¸»æœºåœ°å€  </span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">HTTP  	# æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="9">
<li><code>spec.volumes</code><!-- raw HTML omitted -->æŒ‚è½½ç›®å½•å­—æ®µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.volumes[].name</td>
<td>String</td>
<td>å®šä¹‰<code>Pod</code>å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œå®¹å™¨å®šä¹‰éƒ¨åˆ† <code>spec.containers[].volumeMounts[].name</code>çš„å€¼å’Œè¿™é‡Œæ˜¯ä¸€æ ·çš„ã€‚</td>
</tr>
<tr>
<td>spec.volumes[].emptyDir</td>
<td>Object</td>
<td>æŒ‡å®š<code>Pod</code>çš„ä¸´æ—¶ç›®å½•ï¼Œå€¼ä¸ºä¸€ä¸ªç©ºå¯¹è±¡ï¼š<code>emptyDir:{}</code></td>
</tr>
<tr>
<td>spec.volumes[].hostPath</td>
<td>Object</td>
<td>æŒ‡å®šæŒ‚è½½<code>Pod</code>æ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ã€‚</td>
</tr>
<tr>
<td>spec.volumes[].hostPath.path</td>
<td>String</td>
<td>æŒ‡å®š<code>Pod</code>æ‰€åœ¨ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºå®¹å™¨ä¸­<code>mount</code>çš„ç›®å½•ã€‚</td>
</tr>
<tr>
<td>spec.volumes.nfs</td>
<td></td>
<td></td>
</tr>
<tr>
<td>spec.volumes[]</td>
<td>Object</td>
<td>æŒ‡å®šç±»å‹ä¸º<code>Secret</code>çš„å­˜å‚¨å·ï¼Œ<code>Secret</code>æ„ä¸ºç§å¯†ã€ç§˜å¯†ï¼Œè¿™å¾ˆå®¹æ˜“ç†è§£ï¼Œå®ƒå­˜å‚¨ä¸€äº›å¯†ç ã€å¯†é’¥ç­‰æ•æ„Ÿå®‰å…¨æ–‡ä»¶ã€‚æŒ‚è½½é›†ç¾¤é¢„å®šä¹‰çš„<code>Secret</code>å¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨ã€‚</td>
</tr>
<tr>
<td>spec.volumes[].configMap</td>
<td>Object</td>
<td>æŒ‡å®šç±»å‹ä¸º<code>ConfigMap</code>çš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½é›†ç¾¤é¢„å®šä¹‰çš„<code>ConfigMap</code>å¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain deployment.spec.volumes  	<span style="color:#75715e"># è·å– deploymentå­˜å‚¨ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl explain deployment.spec.volumes.hostPath.type  	<span style="color:#75715e"># ç±»å‹å£°æ˜  </span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç®€å•å­˜å‚¨æ¨¡å¼â†’<!-- raw HTML omitted --><code>volume-emptydir</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod  </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume-emptydir </span> <span style="color:#75715e"># å®šä¹‰åç§°</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">containers</span>:  	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>: <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­å¯¹åº”çš„ç›®å½•ï¼Œè¯¥ç›®å½•ä¸º/var/log/nginx</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log/nginx </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30  	# å¯ä»¥é€‰æ‹© 1.28.4ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /logs/access.log&#34;</span>] <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>: <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„å¯¹åº”ç›®å½•ï¼Œè¯¥ç›®å½•ä¸º/logs</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:   	<span style="color:#75715e"># å£°æ˜volumeï¼Œnameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºemptyDir</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume  	# å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">emptyDir</span>: {}   		<span style="color:#75715e"># ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç®€å•å­˜å‚¨æ¨¡å¼â†’<!-- raw HTML omitted --><code>volume-HostPath</code></li>
</ul>
<blockquote>
<ul>
<li><code>DirectoryOrCreate</code><!-- raw HTML omitted -->ï¼šç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨<!-- raw HTML omitted --></li>
<li><code>Directory</code><!-- raw HTML omitted -->ï¼šç›®å½•å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>FileOrCreate</code><!-- raw HTML omitted -->ï¼šæ–‡ä»¶å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨<!-- raw HTML omitted --></li>
<li><code>File</code><!-- raw HTML omitted -->ï¼šæ–‡ä»¶å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>Socket</code><!-- raw HTML omitted -->ï¼š<code>unix</code>å¥—æ¥å­—å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>CharDevice</code><!-- raw HTML omitted -->ï¼šå­—ç¬¦è®¾å¤‡å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>BlockDevice</code><!-- raw HTML omitted -->ï¼šå—è®¾å¤‡å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume-hostpath</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>: <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­å¯¹åº”çš„ç›®å½•ï¼Œè¯¥ç›®å½•ä¸º/var/log/nginx</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log/nginx</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /logs/access.log&#34;</span>] <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>: <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„å¯¹åº”ç›®å½•ï¼Œè¯¥ç›®å½•ä¸º/logs</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>: <span style="color:#75715e"># å£°æ˜volumeï¼Œnameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºhostPath</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">hostPath</span>:  <span style="color:#75715e"># ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/root/logs </span> <span style="color:#75715e"># Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate</span> <span style="color:#75715e"># ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºå†ä½¿ç”¨ </span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç®€å•å­˜å‚¨æ¨¡å¼â†’<!-- raw HTML omitted --><code>volume-nfs</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume-nfs</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>:  	<span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­å¯¹åº”çš„ç›®å½•ï¼Œè¯¥ç›®å½•ä¸º/var/log/nginx</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log/nginx</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /logs/access.log&#34;</span>]  	<span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>:  	<span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„å¯¹åº”ç›®å½•ï¼Œè¯¥ç›®å½•ä¸º/logs</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:  	<span style="color:#75715e"># å£°æ˜volume</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nfs</span>:  	<span style="color:#75715e"># å­˜å‚¨ç±»å‹ï¼Œå’Œåº•å±‚æ­£åˆ™çš„å­˜å‚¨å¯¹åº”</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.18.100</span>  	<span style="color:#75715e"># NFSæœåŠ¡å™¨åœ°å€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/root/data/nfs  	# å…±äº«æ–‡ä»¶è·¯å¾„</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é«˜çº§å­˜å‚¨æ¨¡å¼â†’<!-- raw HTML omitted --><code>volume-pv</code></li>
</ul>
<blockquote>
<ul>
<li><code>PVï¼škubernetes</code><!-- raw HTML omitted -->ç®¡ç†å‘˜ç»´æŠ¤<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pv2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">nfs</span>:  	<span style="color:#75715e"># å­˜å‚¨ç±»å‹ï¼Œå’Œåº•å±‚æ­£åˆ™çš„å­˜å‚¨å¯¹åº”</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/root/data/pv1</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.18.100</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">capacity</span>:  	<span style="color:#75715e"># å­˜å‚¨èƒ½åŠ›ï¼Œç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">2Gi</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">accessModes</span>:  	<span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>   - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">storageClassName</span>:  	<span style="color:#75715e"># å­˜å‚¨ç±»åˆ«</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">persistentVolumeReclaimPolicy</span>: <span style="color:#ae81ff">Retain  	# å›æ”¶ç­–ç•¥</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é«˜çº§å­˜å‚¨â†’<!-- raw HTML omitted --><code>volume-pvc</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pvc1</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">accessModes</span>:  	<span style="color:#75715e"># è®¿å®¢æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:  	<span style="color:#75715e"># é‡‡ç”¨æ ‡ç­¾å¯¹PVé€‰æ‹©</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>:  	<span style="color:#75715e"># å­˜å‚¨ç±»åˆ«</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:  	<span style="color:#75715e"># è¯·æ±‚ç©ºé—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">1Gi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#################################################### åˆ›å»º Pod è®¿é—® PVC ç±»å‹å­˜å‚¨</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;while true;do echo pod1 &gt;&gt; /root/out.txt; sleep 10; done;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/root/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">persistentVolumeClaim</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">claimName</span>: <span style="color:#ae81ff">pvc1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">false</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®å­˜å‚¨â†’<!-- raw HTML omitted --><code>volumes-secret</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Secret</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">type</span>: <span style="color:#ae81ff">Opaque</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:  	<span style="color:#75715e"># æå‰ç¼–ç å®åï¼šdataã€ä½¿ç”¨Kubernetesè¿›è¡Œç¼–ç ä½¿ç”¨ï¼šstringData</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">username</span>: <span style="color:#ae81ff">YWRtaW4=  	# ä½¿ç”¨kubernetesè¿›è¡Œç¼–ç å†™åŸæ•°æ®ï¼šadmin</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">password</span>: <span style="color:#ae81ff">MTIzNDU2  	# ä½¿ç”¨kubernetesè¿›è¡Œç¼–ç å†™åŸæ•°æ®ï¼š123456</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">############################################## é…ç½® pod-secret</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-secret</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/secret/config</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">secret</span>:  	<span style="color:#75715e"># ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="10">
<li><!-- raw HTML omitted -->é¢å¤–çš„å‚æ•°å¯¹è±¡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>å‚æ•°ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.restartPolicy</td>
<td>String</td>
<td>å®šä¹‰<code>Pod</code>çš„é‡å¯ç­–ç•¥ï¼Œå¯é€‰å€¼ä¸º<code>Always</code>ã€<code>OnFailure</code>ï¼Œé»˜è®¤å€¼ä¸º<code>Always</code>ã€‚<!-- raw HTML omitted -->(1) <!-- raw HTML omitted --><code>Always</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>ä¸€æ—¦ç»ˆæ­¢è¿è¡Œï¼Œæ— è®ºå®¹å™¨æ˜¯å¦‚ä½•ç»ˆæ­¢çš„ï¼Œ<code>kubelet</code>æœåŠ¡éƒ½å°†é‡å¯å®ƒ<!-- raw HTML omitted -->(2) <!-- raw HTML omitted --><code>OnFailure</code><!-- raw HTML omitted -->ï¼šåªæœ‰<code>Pod</code>ä»¥éé›¶é€€å‡ºç ç»ˆæ­¢æ—¶ï¼Œ<code>kubelet</code>æ‰ä¼šé‡å¯è¯¥å®¹å™¨ï¼Œå¦‚æœå®¹å™¨æ­£å¸¸ç»“æŸï¼ˆé€€å‡ºç ä¸º 0ï¼‰ï¼Œåˆ™<code>kubelet</code>å°†ä¸ä¼šé‡å¯å®ƒ<!-- raw HTML omitted --> (3)<!-- raw HTML omitted --><code>Never</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>ç»ˆæ­¢åï¼Œ<code>kubelet</code>å°†é€€å‡ºç æŠ¥å‘Šç»™<code>master</code>ï¼Œä¸ä¼šé‡å¯è¯¥ <code>Pod</code></td>
</tr>
<tr>
<td>spec.nodeName</td>
<td></td>
<td>å®šå‘è°ƒåº¦</td>
</tr>
<tr>
<td>spec.nodeSelector</td>
<td>Object</td>
<td>å®šå‘è°ƒåº¦ï¼Œå®šä¹‰èŠ‚ç‚¹çš„è¿‡æ»¤æ ‡ç­¾ï¼ˆä»¥<code>key:value</code>æ ¼å¼æŒ‡å®šï¼‰ã€‚</td>
</tr>
<tr>
<td>pod.spec.affinity</td>
<td>äº²å’Œè°ƒåº¦</td>
<td></td>
</tr>
<tr>
<td>pod.spec.affinity.nodeAffinity</td>
<td></td>
<td>ï¼ˆnodeäº²å’Œæ€§ï¼‰ï¼šä»¥Nodeä¸ºç›®æ ‡ï¼Œè§£å†³Podå¯ä»¥è°ƒåº¦åˆ°é‚£äº›Nodeçš„é—®é¢˜ã€‚</td>
</tr>
<tr>
<td>pod.spec.affinity.podAffinity</td>
<td></td>
<td>ï¼ˆpodäº²å’Œæ€§ï¼‰ï¼šä»¥Podä¸ºç›®æ ‡ï¼Œè§£å†³Podå¯ä»¥å’Œé‚£äº›å·²å­˜åœ¨çš„Podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜ã€‚</td>
</tr>
<tr>
<td>pod.spec.affinity.podAntiAffinity</td>
<td></td>
<td>ï¼ˆpodåäº²å’Œæ€§ï¼‰ï¼šä»¥Podä¸ºç›®æ ‡ï¼Œè§£å†³Podä¸èƒ½å’Œé‚£äº›å·²ç»å­˜åœ¨çš„Podéƒ¨ç½²åœ¨åŒä¸€æ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜ã€‚</td>
</tr>
<tr>
<td>pod.spec.tolerations</td>
<td>å®¹å¿è°ƒåº¦</td>
<td>æ±¡ç‚¹å°±æ˜¯æ‹’ç»ï¼Œå®¹å¿å°±æ˜¯å¿½ç•¥ï¼ŒNodeé€šè¿‡æ±¡ç‚¹æ‹’ç»Podè°ƒåº¦ä¸Šå»ï¼ŒPodé€šè¿‡å®¹å¿å¿½ç•¥æ‹’ç»</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>spec.imagePullSecrets</td>
<td>List</td>
<td>å®šä¹‰æ‹‰å–é•œåƒæ—¶ä½¿ç”¨<code>Secret</code>åç§°ï¼ˆä»¥<code>name:secretkey</code>æ ¼å¼æŒ‡å®šï¼‰ã€‚</td>
</tr>
<tr>
<td>spec.hostNetwork</td>
<td>Boolean</td>
<td>å®šä¹‰æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º falseã€‚ è®¾ç½® true è¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œï¼Œä¸ä½¿ç”¨ Docker ç½‘æ¡¥ï¼ŒåŒæ—¶è®¾ç½®äº† true å°†æ— æ³•åœ¨åŒä¸€å°å®¿ä¸»æœºä¸Šå¯åŠ¨ç¬¬äºŒä¸ªå‰¯æœ¬ã€‚</td>
</tr>
<tr>
<td>service.spec.type</td>
<td></td>
<td><code>type</code>ç¡®å®šæœåŠ¡çš„å…¬å¼€æ–¹å¼ã€‚ é»˜è®¤ä¸º<code>ClusterIP</code>ã€‚æœ‰æ•ˆçš„é€‰é¡¹æ˜¯<code>ExternalName</code>ã€<code>ClusterIP</code>ã€<code>NodePort</code>å’Œ<code>LoadBalancer</code></td>
</tr>
<tr>
<td>service.spec.type.ClusterIP</td>
<td></td>
<td><code>ClusterIP</code>ä¸ºè´Ÿè½½å‡è¡¡åˆ†é…é›†ç¾¤å†…éƒ¨<code>IP</code>åœ°å€ç«¯ç‚¹ã€‚ ç«¯ç‚¹ç”±é€‰æ‹©å™¨ç¡®å®šï¼Œæˆ–è€…å¦‚æœä¸æ˜¯é€šè¿‡æ‰‹åŠ¨æ„é€ <code>Endpoints</code>å¯¹è±¡æˆ–<code>EndpointSlice</code>æŒ‡å®šå¯¹è±¡ã€‚ å¦‚æœ<code>clusterIP</code>ä¸º<code>None</code>ï¼Œåˆ™ä¸åˆ†é…è™šæ‹Ÿ<code>IP</code>ï¼Œå¹¶ä¸”ç«¯ç‚¹ä½œä¸ºä¸€ç»„ç«¯ç‚¹è€Œä¸æ˜¯è™šæ‹Ÿ<code>IP</code>å‘å¸ƒã€‚</td>
</tr>
<tr>
<td>service.spec.type.NodePort</td>
<td></td>
<td><code>NodePort</code>å»ºç«‹åœ¨<code>ClusterIP</code>ä¹‹ä¸Šï¼Œå¹¶åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šåˆ†é…ä¸€ä¸ªç«¯å£è·¯ç”±åˆ°ä¸<code>clusterIP</code>ç›¸åŒçš„ç«¯ç‚¹ã€‚</td>
</tr>
<tr>
<td>service.spec.type.LoadBalancer</td>
<td></td>
<td><code>LoadBalancer</code>å»ºç«‹åœ¨<code>NodePort</code>å¹¶åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚æœå½“å‰æ”¯æŒ<code>cloud</code>) è·¯ç”±åˆ°ä¸<code>clusterIP</code>ç›¸åŒçš„ç«¯ç‚¹ã€‚</td>
</tr>
<tr>
<td>service.spec.type.ExternalName</td>
<td></td>
<td><code>ExternalName</code>å°†æ­¤æœåŠ¡åˆ«åä¸ºæŒ‡å®šçš„<code>externalName</code>ã€‚ å…¶ä»–å‡ ä¸ªé¢†åŸŸä¸é€‚ç”¨äº<code>ExternalName</code>æœåŠ¡</td>
</tr>
</tbody>
</table>
<ul>
<li><code>tolerations</code><!-- raw HTML omitted -->(å®¹å¿)é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain deployment.spec.template.spec.tolerations</span></span></code></pre></div><ul>
<li><code>affinity</code><!-- raw HTML omitted -->(äº²å’Œæ€§)é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain deployment.spec.template.spec.affinity  	<span style="color:#75715e"># æŸ¥çœ‹ Deployment äº²å’Œæ€§ä½¿ç”¨</span></span></span></code></pre></div><blockquote>
<ul>
<li><code>nodeAffinity</code><!-- raw HTML omitted -->èŠ‚ç‚¹äº²å’Œæ€§<!-- raw HTML omitted --></li>
<li><code>requiredDuringSchedulingIgnoredDuringExecution:</code><!-- raw HTML omitted -->ç¡¬æ€§è¦æ±‚ï¼Œå¿…é¡»æ»¡è¶³æ¡ä»¶<!-- raw HTML omitted --></li>
<li><code>preferredDuringSchedulingIgnoredDuringExecution:</code><!-- raw HTML omitted -->è½¯æ€§è¦æ±‚ï¼Œä¸å¼ºåˆ¶æ»¡è¶³<!-- raw HTML omitted --></li>
<li><code>In</code><!-- raw HTML omitted -->ï¼šæ»¡è¶³æ¡ä»¶ä¹‹ä¸€<!-- raw HTML omitted --></li>
<li><code>NotIn</code><!-- raw HTML omitted -->ï¼šæ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œåäº²å’Œæ€§<!-- raw HTML omitted --></li>
<li><code>Exists</code><!-- raw HTML omitted -->ï¼šå­˜åœ¨å°±æ»¡è¶³<!-- raw HTML omitted --></li>
<li><code>DoesNotExist</code><!-- raw HTML omitted -->ä¸å­˜åœ¨å°±æ»¡è¶³<!-- raw HTML omitted --></li>
<li><code>Gt</code><!-- raw HTML omitted -->å¤§äºèŠ‚ç‚¹ä¸Šçš„æ•°å€¼å°±æ»¡è¶³<!-- raw HTML omitted --></li>
<li><code>Lt</code><!-- raw HTML omitted -->å°äºèŠ‚ç‚¹ä¸Šçš„æ•°å€¼å°±æ»¡è¶³<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain deployment.spec.template.spec.affinity.nodeAffinity  	<span style="color:#75715e"># æŸ¥çœ‹Deployment nodesäº²å’Œæ€§ä½¿ç”¨</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">with-affinity-anti-affinity</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodeAffinity</span>:  	<span style="color:#75715e"># èŠ‚ç‚¹äº²å’Œæ€§  </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">requiredDuringSchedulingIgnoredDuringExecution</span>:  	<span style="color:#75715e"># å¿…é¡»æ»¡è¶³æ¡ä»¶</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">nodeSelectorTerms</span>:  	<span style="color:#75715e"># é€‰æ‹©å™¨ï¼ŒnodeSelectorTermsï¼šèŠ‚ç‚¹é€‰æ‹©å™¨ï¼ŒlabelSelectorï¼šæ ‡ç­¾é€‰æ‹©å™¨</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">matchExpressions</span>:  	<span style="color:#75715e"># è¡¨è¾¾å¼åŒ¹é…</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">kubernetes.io/os  	# å¿…é¡»å­˜åœ¨çš„Key</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In  	# åœ¨Keyä¸­æ»¡è¶³ä¸€ä¸ªæ¡ä»¶ï¼ŒåŒ¹é…ç±»å‹ï¼šInã€NotInã€Existsã€DoesNotExistã€Gtã€Lt</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>:  	<span style="color:#75715e"># ä¸‹æ–¹ value åœ¨ Key ä¸­å¿…é¡»å­˜åœ¨å…¶ä¸­ä¹‹ä¸€(value)</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">linux  	# å¿…é¡»æ˜¯Linuxæ‰éƒ¨ç½²  </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">preferredDuringSchedulingIgnoredDuringExecution</span>:  	<span style="color:#75715e"># è½¯æ€§è¦æ±‚ï¼Œä¸å¼ºåˆ¶æ»¡è¶³ï¼Œä¼˜å…ˆé€‰æ‹©äº²å’Œæ€§ç›®æ ‡</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">weight</span>: <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æƒé‡ï¼Œæ•°å€¼è¶Šå¤§ï¼Œä¼˜å…ˆéƒ¨ç½²</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">preference</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">label-1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">key-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">weight</span>: <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">preference</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">label-2</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">key-2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">with-node-affinity</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">registry.k8s.io/pause:2.0</span></span></span></code></pre></div><ul>
<li><code>podAffinity</code><!-- raw HTML omitted -->äº²å’Œæ€§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain pod.spec.affinity.podAffinity</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">with-pod-affinity</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">podAffinity</span>:  	<span style="color:#75715e"># Pod äº²å’Œæ€§</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">labelSelector</span>:  	<span style="color:#75715e"># é€‰æ‹©å™¨ï¼š</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">security</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">S1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">topologyKey</span>: <span style="color:#ae81ff">topology.kubernetes.io/zone  	# åŒ¹é…èŠ‚ç‚¹æ ‡ç­¾äº²å’Œæ€§</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">podAntiAffinity</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">weight</span>: <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">podAffinityTerm</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">labelSelector</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">security</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#ae81ff">S2</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">topologyKey</span>: <span style="color:#ae81ff">topology.kubernetes.io/zone</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">with-pod-affinity</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">registry.k8s.io/pause:2.0  </span></span></span></code></pre></div><ul>
<li><code>podAntiAffinity</code><!-- raw HTML omitted -->åäº²å’Œæ€§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain pod.spec.affinity.podAntiAffinity  </span></span></code></pre></div></blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:  	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># åˆ›å»ºPodä¸ªæ•°</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">selector</span>:  	<span style="color:#75715e"># æ ‡ç­¾é€‰æ‹©å™¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">matchLabels</span>:  	<span style="color:#75715e"># æ ‡ç­¾é€‰æ‹©æ–¹å¼:ç›´æ¥ç»™å®šæ ‡ç­¾é”®å€¼,è¿™é‡Œæ˜¯å–äº¤é›†çš„,ä¹Ÿå°±æ˜¯Podå¿…é¡»æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ ‡ç­¾æ‰èƒ½è¢«è°ƒåº¦</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">project</span>: <span style="color:#ae81ff">ms</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">product  	# æ­¤è¡Œä»¥ä¸Šå®šä¹‰æ§åˆ¶å™¨æœ¬èº«</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:  	<span style="color:#75715e"># å®šä¹‰Deploymentæ›´æ–°å›æ»š</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>         - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">annotations</span>:  	<span style="color:#75715e"># æ³¨é‡Šï¼Œä¸èƒ½ä½œä¸ºè¢«ç­›é€‰</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hostAliases</span>:  	<span style="color:#75715e"># /etc/hosts/æ‰‹åŠ¨æ·»åŠ è§£æ</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">ip</span>: <span style="color:#e6db74">&#34;192.168.4.110&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostnames</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;k8s.com&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">restartPolicy</span>: [<span style="color:#ae81ff">Alwaysã€Neverã€OnFailure] </span> <span style="color:#75715e">#é»˜è®¤K8S-Podçš„é‡å¯ç­–ç•¥,æ­¤å®¹å™¨é€€å‡ºåç«‹å³åˆ›å»ºä¸€ä¸ªç›¸åŒå®¹å™¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeName</span>: <span style="color:#ae81ff">k8s-node1</span> <span style="color:#75715e"># NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeSelector</span>: <span style="color:#ae81ff">obeject</span> <span style="color:#75715e"># nodeSelectorç”¨äºå°†Podè°ƒåº¦åˆ°æ·»åŠ äº†æŒ‡å®šæ ‡ç­¾çš„NodeèŠ‚ç‚¹ä¸Š</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">imagePullSecrets</span>:  	<span style="color:#75715e"># é…ç½®ç™»å½• docker registry çš„ secret ä»“åº“</span>
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker-harbor  	# æŒ‡å®šä½¿ç”¨çš„secretåº“æˆ¿åç§°</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">hostNetwork</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e">#æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="replicasetrsç±»å‹æ§åˆ¶å™¨"><code>ReplicaSet(RS)</code>ç±»å‹æ§åˆ¶å™¨</h3>
<blockquote>
<ul>
<li><code>ReplicaSet</code><!-- raw HTML omitted -->ï¼šä¸»è¦ä½œç”¨æ˜¯ä¿è¯ä¸€å®šæ•°é‡çš„<code>Pod</code>èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œå®ƒä¼šæŒç»­ç›‘å¬è¿™äº›<code>Pod</code>çš„è¿è¡ŒçŠ¶æ€ï¼Œä¸€æ—¦<code>Pod</code>å‘ç”Ÿæ•…éšœï¼Œå°±ä¼šé‡å¯æˆ–é‡å»ºã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒå¯¹<code>Pod</code>æ•°é‡çš„æ‰©ç¼©å®¹å’Œç‰ˆæœ¬é•œåƒçš„å‡çº§<!-- raw HTML omitted --></li>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/ReplicaSet/kubernetes-replicaset-template.yaml" rel="external" target="_self"><code>Kubernetes replicaset Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1    </span> <span style="color:#75715e"># ç‰ˆæœ¬å· </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ReplicaSet       </span> <span style="color:#75715e"># ç±»å‹ </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       <span style="color:#75715e"># å…ƒæ•°æ® </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">replicaset-template    </span> <span style="color:#75715e"># åç§°ã€åœ¨ä¸€ä¸ªåç§°ç©ºé—´å†…ä¸èƒ½é‡å¤</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># æŒ‡å®šåç§°ç©ºé—´ã€é»˜è®¤defalut</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:       <span style="color:#75715e"># æ ‡ç­¾ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">replicaset-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># è¯¦æƒ…æè¿° </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>   <span style="color:#75715e"># æŒ‡å®šå‰¯æœ¬æ•°é‡ï¼Œæ˜¯rsåˆ›å»ºå‡ºæ¥çš„Podçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:     <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯å»ºç«‹Podæ§åˆ¶å™¨å’ŒPodä¹‹é—´çš„å…³è”å…³ç³»ï¼Œé‡‡ç”¨äº†Label Selectoræœºåˆ¶ï¼ˆåœ¨Podæ¨¡å—ä¸Šå®šä¹‰Labelï¼Œåœ¨æ§åˆ¶å™¨ä¸Šå®šä¹‰é€‰æ‹©å™¨ï¼Œå°±å¯ä»¥è¡¨æ˜å½“å‰æ§åˆ¶å™¨èƒ½ç®¡ç†å“ªäº›Podäº†ï¼‰</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:        <span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™ï¼ŒmatchExpressionsï¼šExpressionsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">replicaset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:     <span style="color:#75715e"># æ¨¡å— å½“å‰¯æœ¬æ•°æ®ä¸è¶³çš„æ—¶å€™ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºPodå‰¯æœ¬</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">replicaset-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx    </span> <span style="color:#75715e"># å®¹å™¨åç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1    </span> <span style="color:#75715e"># å®¹å™¨éœ€è¦çš„é•œåƒåœ°å€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>     <span style="color:#75715e"># å®¹å™¨æ‰€ç›‘å¬çš„ç«¯å£</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">100m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">50m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="horizontalpodautoscalerç±»å‹"><code>HorizontalPodAutoscaler</code>ç±»å‹</h3>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/HPA/kubernetes-hpa-template.yaml" rel="external" target="_self"><code>Kubernetes HorizontalPodAutoscaler Template</code>æ¨¡æ¿</a></li>
</ul>
<blockquote>
<ul>
<li><code>deployment</code><!-- raw HTML omitted -->ï¼šç±»å‹æ§åˆ¶å™¨<!-- raw HTML omitted --></li>
<li><code>deployment-name</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>çš„åç§°<!-- raw HTML omitted --></li>
<li><code>--cpu-percent</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨<code>CPU</code>ç™¾åˆ†æ¯”<!-- raw HTML omitted --></li>
<li><code>--min</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>æœ€å°‘æ•°é‡<!-- raw HTML omitted --></li>
<li><code>--max</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>æœ€å¤šæ•°é‡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl autoscale deployment deployment-name --cpu-percent<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span> --min<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> --max<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span></span></span></code></pre></div></blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">autoscaling/v2   </span> <span style="color:#75715e"># ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">HorizontalPodAutoscaler  </span> <span style="color:#75715e"># ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:   <span style="color:#75715e"># å…ƒæ•°æ® </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># æŒ‡å®šåç§°ç©ºé—´ã€é»˜è®¤default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hpa-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">minReplicas</span>: <span style="color:#ae81ff">2</span>   <span style="color:#75715e"># æœ€å°Podæ•°é‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">maxReplicas</span>: <span style="color:#ae81ff">10</span>    <span style="color:#75715e"># æœ€å¤§Podæ•°é‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">metrics</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">resource</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cpu  	# æ‰©ç¼©å®¹åç§°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">averageUtilization</span>: <span style="color:#ae81ff">30</span>  	<span style="color:#75715e"># è®¾ç½®CPUä½¿ç”¨ç™¾åˆ†æ¯”ï¼Œè¶…è¿‡å°±æ‰©å®¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Utilization  	# åˆ©ç”¨ç‡ï¼šUtilizationï¼Œå¹³å‡å€¼ï¼šAverageValueï¼š1kã€1Mã€1G</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Resource</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">scaleTargetRef</span>:    <span style="color:#75715e"># æŒ‡å®šè¦æ§åˆ¶Podã€Deploymentä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-template</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">service-template</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  clusterIP: None       # å°†clusterIPè®¾ç½®ä¸ºNoneï¼Œå³å¯åˆ›å»ºheadliness Service</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort       </span> <span style="color:#75715e"># Podä½¿ç”¨çš„IPç±»å‹ï¼šClusterIPã€NodePort</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>    <span style="color:#75715e"># Serviceçš„ç«¯å£</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>      <span style="color:#75715e"># StatefulSet çš„Podç«¯å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1    </span> <span style="color:#75715e"># ç‰ˆæœ¬å· </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment       </span> <span style="color:#75715e"># ç±»å‹ </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       <span style="color:#75715e"># å…ƒæ•°æ® </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-template    </span> <span style="color:#75715e"># deploymentçš„åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># æŒ‡å®šåç§°ç©ºé—´ã€é»˜è®¤default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:       <span style="color:#75715e"># æ ‡ç­¾ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># è¯¦æƒ…æè¿° </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>   <span style="color:#75715e"># å‰¯æœ¬æ•°é‡ </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">3</span>       <span style="color:#75715e"># ä¿ç•™å†å²ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º10 </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">paused</span>: <span style="color:#66d9ef">false</span>         <span style="color:#75715e"># æš‚åœéƒ¨ç½²ï¼Œé»˜è®¤æ˜¯false </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>          <span style="color:#75715e"># éƒ¨ç½²è¶…æ—¶æ—¶é—´ï¼ˆsï¼‰ï¼Œé»˜è®¤æ˜¯600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:     <span style="color:#75715e"># podæ›´æ–°ç­–ç•¥ï¼Œå³å¦‚ä½•æ›¿æ¢å·²æœ‰çš„pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate        </span> <span style="color:#75715e"># æ›´æ–°ç­–ç•¥ã€æ”¯æŒ Recreate, RollingUpdateã€‚é»˜è®¤RollingUpdate</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:      <span style="color:#75715e"># å½“typeä¸ºRollingUpdateçš„æ—¶å€™ç”Ÿæ•ˆï¼Œç”¨äºä¸ºrollingUpdateè®¾ç½®å‚æ•°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%      </span> <span style="color:#75715e"># ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%    </span> <span style="color:#75715e"># ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:     <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:        <span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™ï¼ŒmatchExpressionsï¼šExpressionsåŒ¹é…è§„åˆ™ </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:     <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:   <span style="color:#75715e"># Pod çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:   <span style="color:#75715e"># Pod çš„æœŸæœ›ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:   <span style="color:#75715e"># Pod å®¹å™¨æè¿°</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx  </span> <span style="color:#75715e"># é•œåƒåç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent  </span> <span style="color:#75715e"># IfNotPresentï¼šå¦‚æœé•œåƒä¸å­˜åœ¨å°±æ‹‰å–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">100m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">50m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Always  </span> <span style="color:#75715e"># é‡å¯ç­–ç•¥ï¼ŒAlwaysï¼šä»£è¡¨ä¸€ç›´é‡å¯</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>   <span style="color:#75715e"># åˆ é™¤æ“ä½œå®½é™æ—¶é—´</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="deploymentdeployæ— çŠ¶æ€ç±»å‹"><code>Deployment(deploy)</code>æ— çŠ¶æ€ç±»å‹</h3>

<pre class="mermaid align-center zoomable">graph TD
A[&lt;p&gt;Deployment&lt;br&gt;seletor:env=dev] --&gt; A1((&lt;p&gt;Pod&lt;br&gt;label:env=dev))
A[&lt;p&gt;Deployment&lt;br&gt;seletor:env=dev] --&gt; A2((&lt;p&gt;Pod&lt;br&gt;label:env=dev))
A[&lt;p&gt;Deployment&lt;br&gt;seletor:env=dev] --&gt; A3((&lt;p&gt;Pod&lt;br&gt;label:env=dev))
    Z[Deploymentæ§åˆ¶Pod]  </pre><blockquote>
<ul>
<li><code>Deployment</code><!-- raw HTML omitted -->ï¼šä¸ºäº†æ›´å¥½çš„è§£å†³æœåŠ¡ç¼–æ’çš„é—®é¢˜ï¼Œ<!-- raw HTML omitted --><code>kubernetes</code>åœ¨<code>v1.2</code>ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†<code>Deployment</code>æ§åˆ¶å™¨ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<code>Deployment</code>æ§åˆ¶å™¨å¹¶ä¸ç›´æ¥ç®¡ç†<code>Pod</code>ï¼Œè€Œæ˜¯é€šè¿‡ç®¡ç†<code>ReplicaSet</code>æ¥é—´æ¥ç®¡ç†<code>Pod</code>ï¼Œå³ï¼š<code>Deployment</code>ç®¡ç†<code>ReplicaSet</code>ï¼Œ<code>ReplicaSet</code>ç®¡ç†<code>Pod</code>ã€‚æ‰€ä»¥<code>Deployment</code>çš„åŠŸèƒ½æ¯”<code>ReplicaSet</code>å¼ºå¤§</li>
<li>æ”¯æŒ<code>ReplicaSet</code>çš„æ‰€æœ‰åŠŸèƒ½</li>
<li><!-- raw HTML omitted -->æ”¯æŒå‘å¸ƒçš„åœæ­¢ã€ç»§ç»­<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æ”¯æŒç‰ˆæœ¬æ»šåŠ¨æ›´æ–°å’Œç‰ˆæœ¬å›é€€<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>Recreate</code><!-- raw HTML omitted -->é‡å»ºæ›´æ–°ï¼šåœ¨åˆ›å»ºå‡ºæ–°çš„<code>Pod</code>ä¹‹å‰ä¼šå…ˆæ€æ‰æ‰€æœ‰å·²ç»å­˜åœ¨çš„<!-- raw HTML omitted --><code>Pod</code></p>
</li>
<li>
<p><code>RollingUpdate</code><!-- raw HTML omitted -->æ»šåŠ¨æ›´æ–°ï¼šæ€æ­»ä¸€éƒ¨åˆ†ï¼Œå°±å¯åŠ¨ä¸€éƒ¨åˆ†ï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­å­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬çš„<!-- raw HTML omitted --><code>Pod</code>ï¼Œå½“<code>type</code>ä¸º<code>RollingUpdate</code>çš„æ—¶å€™ç”Ÿæ•ˆï¼Œç”¨äºä¸º<code>rollingUpdate</code>è®¾ç½®å‚æ•°ï¼Œ  æ”¯æŒä¸¤ä¸ªå±æ€§ï¼š</p>
</li>
<li>
<p><code>maxSurge</code><!-- raw HTML omitted -->ï¼šç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„<code>Pod</code>çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>maxUnavailable</code><!-- raw HTML omitted -->ï¼šç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨çš„<code>Pod</code>çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%<!-- raw HTML omitted --></p>
</li>
</ul>
</blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/Deployment/kubernetes-deployment-template.yaml" rel="external" target="_self"><code>Kubernetes Deployment Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1  	# ç‰ˆæœ¬å· </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment  	# ç±»å‹ </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:  	<span style="color:#75715e"># å…ƒæ•°æ® </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-template  	# deploymentçš„åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default  	# æŒ‡å®šåç§°ç©ºé—´ã€é»˜è®¤defalut</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:  	<span style="color:#75715e"># æ ‡ç­¾ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:  	<span style="color:#75715e"># è¯¦æƒ…æè¿° </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>  	<span style="color:#75715e"># å‰¯æœ¬æ•°é‡ </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">3</span>  	<span style="color:#75715e"># ä¿ç•™å†å²ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º10 </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">paused</span>: <span style="color:#66d9ef">false</span>  	<span style="color:#75715e"># æš‚åœéƒ¨ç½²ï¼Œé»˜è®¤æ˜¯false </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>  	<span style="color:#75715e"># éƒ¨ç½²è¶…æ—¶æ—¶é—´ï¼ˆsï¼‰ï¼Œé»˜è®¤æ˜¯600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:  	<span style="color:#75715e"># podæ›´æ–°ç­–ç•¥ï¼Œå³å¦‚ä½•æ›¿æ¢å·²æœ‰çš„pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:  	<span style="color:#75715e"># å½“typeä¸ºRollingUpdateçš„æ—¶å€™ç”Ÿæ•ˆï¼Œç”¨äºä¸ºrollingUpdateè®¾ç½®å‚æ•°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%  	# ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%  	# ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate  	# æ›´æ–°ç­–ç•¥ã€æ”¯æŒ Recreate, RollingUpdateã€‚é»˜è®¤RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:  	<span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:  	<span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™ï¼ŒmatchExpressionsï¼šExpressionsåŒ¹é…è§„åˆ™ </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:  	<span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:   <span style="color:#75715e"># Pod çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:   <span style="color:#75715e"># Pod çš„æœŸæœ›ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:   <span style="color:#75715e"># Pod å®¹å™¨æè¿°</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx  </span> <span style="color:#75715e"># é•œåƒåç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1    </span> <span style="color:#75715e"># fxgxxxxx/nginx:v1 åœ¨æ‰€æœ‰èŠ‚ç‚¹ç™»å½•è‡ªå·±çš„ hub.docker.com è´¦æˆ·</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent  </span> <span style="color:#75715e"># IfNotPresentï¼šå¦‚æœé•œåƒä¸å­˜åœ¨å°±æ‹‰å–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:   <span style="color:#75715e"># æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx_vhosts   </span> <span style="color:#75715e"># å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/usr/local/nginx/conf/vhosts  </span> <span style="color:#75715e"># å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx_logs</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/usr/local/nginx/logs</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx_html</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:      <span style="color:#75715e"># èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:   <span style="color:#75715e"># é™å®šPodæœ€å¤§ä½¿ç”¨ç¡¬ä»¶èµ„æºã€é€šå¸¸è®¾ç½®cpuå’Œmemory</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;6&#34;</span>    <span style="color:#75715e"># Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°ï¼Œ1000mç­‰äºä¸€ä¸ªæ ¸å¿ƒ</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;128Mi&#34;</span>     <span style="color:#75715e"># å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:     <span style="color:#75715e"># æœ€ä½èµ„æºè¦æ±‚ï¼Œåœ¨schedulerä¸­è¢«ç”¨åˆ°ï¼Œé€šå¸¸è®¾ç½®cpuå’Œmemory</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;3&#34;</span>    <span style="color:#75715e"># é™å®šä½¿ç”¨å‡ ä¸ªæ ¸å¿ƒCPUã€å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;64Mi&#34;</span>      <span style="color:#75715e"># è®¾å®šä½¿ç”¨å†…å­˜ã€å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Always  </span> <span style="color:#75715e"># é‡å¯ç­–ç•¥ï¼ŒAlwaysï¼šä»£è¡¨ä¸€ç›´é‡å¯</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>   <span style="color:#75715e"># åˆ é™¤æ“ä½œå®½é™æ—¶é—´</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:      <span style="color:#75715e"># åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx_vhosts    </span> <span style="color:#75715e"># å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰ </span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hostPath</span>:   <span style="color:#75715e"># ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/nginx/vhosts</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate  </span> <span style="color:#75715e"># ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºå†ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx_logs</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hostPath</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/nginx/logs</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx_html</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hostPath</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/nginx/html</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">status</span>: {}</span></span></code></pre></div></blockquote>
<hr>
<h3 id="statefulsetæœ‰çŠ¶æ€ç±»å‹"><code>StatefulSet</code>æœ‰çŠ¶æ€ç±»å‹</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ— çŠ¶æ€åº”ç”¨å®šä¹‰<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>è®¤ä¸º<code>Pod</code>éƒ½æ˜¯ä¸€æ ·çš„</li>
<li>æ²¡æœ‰é¡ºåºè¦æ±‚</li>
<li>ä¸ç”¨è€ƒè™‘åœ¨å“ªä¸ª<code>Node</code>èŠ‚ç‚¹ä¸Šè¿è¡Œ</li>
<li>éšæ„è¿›è¡Œä¼¸ç¼©å’Œæ‰©å±•</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æœ‰çŠ¶æ€åº”ç”¨å®šä¹‰<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>æœ‰é¡ºåºè¦æ±‚</li>
<li>è®¤ä¸ºæ¯ä¸ª<code>Pod</code>éƒ½æ˜¯ä¸ä¸€æ ·çš„</li>
<li>éœ€è¦è€ƒè™‘åœ¨å“ªä¸ª<code>Node</code>èŠ‚ç‚¹ä¸Šè¿è¡Œ</li>
<li>éœ€è¦æŒ‰ç…§é¡ºåºè¿›è¡Œä¼¸ç¼©å’Œæ‰©å±•</li>
<li>è®©æ¯ä¸ª<code>Pod</code>éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¿æŒ<code>Pod</code>å¯åŠ¨é¡ºåºå’Œå”¯ä¸€æ€§</li>
</ul>
</blockquote>
<ul>
<li><code>StatefulSet</code> æ˜¯<code>Kubernetes</code><!-- raw HTML omitted -->æä¾›çš„ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨çš„è´Ÿè½½ç®¡ç†æ§åˆ¶å™¨<!-- raw HTML omitted --></li>
<li><code>StatefulSet</code><!-- raw HTML omitted -->å¸¸ç”¨æ¥éƒ¨ç½²<!-- raw HTML omitted --><code>RabbitMQ</code>é›†ç¾¤ã€<code>Zookeeper</code>é›†ç¾¤ã€<code>MySQL</code>é›†ç¾¤ã€<code>Eureka</code>é›†ç¾¤ç­‰</li>
<li><code>StatefulSet</code><!-- raw HTML omitted -->éƒ¨ç½²éœ€è¦<!-- raw HTML omitted --><code>HeadLinessService</code>ï¼ˆæ— å¤´æœåŠ¡ï¼‰</li>
</ul>
<blockquote>
<ul>
<li>åœ¨ç”¨<code>Deployment</code>æ—¶ï¼Œæ¯ä¸€ä¸ª<code>Pod</code>åç§°æ˜¯æ²¡æœ‰é¡ºåºçš„ï¼Œæ˜¯éšæœºå­—ç¬¦ä¸²ï¼Œå› æ­¤æ˜¯<code>Pod</code>åç§°æ˜¯æ— åºçš„ï¼Œä½†æ˜¯åœ¨<code>StatefulSet</code>ä¸­è¦æ±‚å¿…é¡»æ˜¯æœ‰åº ï¼Œæ¯ä¸€ä¸ª<code>Pod</code>ä¸èƒ½è¢«éšæ„å–ä»£ï¼Œ<code>Pod</code>é‡å»ºå<code>pod</code>åç§°è¿˜æ˜¯ä¸€æ ·çš„</li>
<li>è€Œ<code>Pod IP</code>æ˜¯å˜åŒ–çš„ï¼Œæ‰€ä»¥æ˜¯ä»¥<code>Pod</code>åç§°æ¥è¯†åˆ«ã€‚<code>Pod</code>åç§°æ˜¯<code>Pod</code>å”¯ä¸€æ€§çš„æ ‡è¯†ç¬¦ï¼Œå¿…é¡»æŒä¹…ç¨³å®šæœ‰æ•ˆã€‚è¿™æ—¶å€™è¦ç”¨åˆ°<!-- raw HTML omitted -->æ— å¤´æœåŠ¡<!-- raw HTML omitted -->ï¼Œå®ƒå¯ä»¥ç»™æ¯ä¸ª<code>Pod</code>ä¸€ä¸ªå”¯ä¸€çš„åç§°</li>
</ul>
</blockquote>
<ul>
<li><code>Deployment</code>å’Œ<code>StatefulSet</code>åŒºåˆ«ï¼š<code>Deployment</code><!-- raw HTML omitted -->æ²¡æœ‰å”¯ä¸€æ ‡è¯†è€Œ<!-- raw HTML omitted --><code>StatefulSet</code>æœ‰å”¯ä¸€æ ‡è¯†</li>
<li><code>StatefulSet</code><!-- raw HTML omitted -->å”¯ä¸€æ ‡è¯†ç”Ÿæˆè§„åˆ™<!-- raw HTML omitted -->ï¼š  æ ¹æ®ä¸»æœºå+ä¸€å®šè§„åˆ™ç”Ÿæˆçš„ï¼š<!-- raw HTML omitted -->ä¸»æœºå.æ— å¤´<!-- raw HTML omitted --><code>Service</code>åç§°.å‘½åç©ºé—´<code>.svc.cluster.local</code></li>
<li><code>StatefulSet</code><!-- raw HTML omitted -->æ§åˆ¶å™¨æ”¯æŒä¸¤ç§æ›´æ–°ç­–ç•¥<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>OnDelete</code>ï¼š <code>OnDelete</code><!-- raw HTML omitted -->è¡¨ç¤ºåˆ é™¤ä¹‹åæ‰æ›´æ–°<!-- raw HTML omitted --></li>
<li>(é»˜è®¤)<code>RollingUpdate</code>ï¼š<code>RollingUpdate</code><!-- raw HTML omitted -->è¡¨ç¤ºæ»šåŠ¨æ›´æ–°<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/StatefulSet/kubernetes-statefulset-template.yaml" rel="external" target="_self"><code>Kubernetes StatefulSet Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">service-template</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">clusterIP</span>: <span style="color:#ae81ff">None      </span> <span style="color:#75715e"># å°†clusterIPè®¾ç½®ä¸ºNoneï¼Œå³å¯åˆ›å»ºheadliness Service</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP  	# ç±»å‹ï¼šNodePort</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>    <span style="color:#75715e"># Serviceçš„ç«¯å£</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>      <span style="color:#75715e"># StatefulSet çš„Podç«¯å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StatefulSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceName</span>: <span style="color:#ae81ff">service-template  </span> <span style="color:#75715e"># ä½¿ç”¨é‚£ä¸ªServiceç®¡ç†DNS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">updateStrategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate        </span> <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°ï¼ŒOnDeleteï¼šåˆ é™¤æ›´æ–°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:      <span style="color:#75715e"># å¦‚æœæ›´æ–°çš„ç­–ç•¥æ˜¯OnDeleteï¼Œé‚£ä¹ˆrollingUpdateå°±å¤±æ•ˆ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">partition</span>: <span style="color:#ae81ff">2</span>      <span style="color:#75715e"># è¡¨ç¤ºä»ç¬¬2ä¸ªåˆ†åŒºå¼€å§‹æ›´æ–°ï¼Œé»˜è®¤æ˜¯0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="daemonsetdså®ˆæŠ¤è¿›ç¨‹ç±»å‹"><code>DaemonSet(ds)</code>å®ˆæŠ¤è¿›ç¨‹ç±»å‹</h3>
<blockquote>
<ul>
<li>
<p><code>DaemonSet</code><!-- raw HTML omitted -->ï¼šæ§åˆ¶å™¨å¯ä»¥ä¿è¯é›†ç¾¤ä¸­çš„æ¯ä¸€å°ï¼ˆæˆ–æŒ‡å®šï¼‰èŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬é€‚ç”¨äºæ—¥å¿—(<code>elk</code>)æ”¶é›†ã€èŠ‚ç‚¹ç›‘æ§(<code>zabbix</code>)ç­‰åœºæ™¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<!-- raw HTML omitted -->å¦‚æœä¸€ä¸ª<code>Pod</code>æä¾›çš„åŠŸèƒ½æ˜¯èŠ‚ç‚¹çº§åˆ«çš„ï¼ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ä¸”åªéœ€è¦ä¸€ä¸ªï¼‰ï¼Œé‚£ä¹ˆè¿™ç±»<code>Pod</code>å°±é€‚åˆä½¿ç”¨<code>DaemonSet</code>ç±»å‹çš„æ§åˆ¶å™¨åˆ›å»º</p>
</li>
<li>
<p><code>DaemonSet</code><!-- raw HTML omitted -->æ§åˆ¶å™¨çš„ç‰¹ç‚¹<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->  æ¯å‘é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œ<!-- raw HTML omitted -->æŒ‡å®šçš„<code>Pod</code>å‰¯æœ¬ä¹Ÿå°†æ·»åŠ åˆ°è¯¥èŠ‚ç‚¹ä¸Š</p>
<p><!-- raw HTML omitted -->å½“èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤çš„æ—¶å€™ï¼Œ<!-- raw HTML omitted --><code>Pod</code>ä¹Ÿä¼šè¢«åƒåœ¾å›æ”¶</p>
</li>
<li>
<p><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/DaemonSet/kubernetes-daemonset-template.yaml" rel="external" target="_self"><code>Kubernetes DaemonSet Template</code>æ¨¡æ¿</a></p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1  </span> <span style="color:#75715e"># ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">DaemonSet        </span> <span style="color:#75715e"># ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">fluentd-daemonset      </span> <span style="color:#75715e"># Pod åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># æŒ‡å®šåç§°ç©ºé—´ã€é»˜è®¤default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:       <span style="color:#75715e"># æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#39;fluentd-es&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># Pod è¯¦æƒ…æè¿°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">3</span>       <span style="color:#75715e"># ä¿ç•™å†å²ç‰ˆæœ¬ã€é»˜è®¤ä¸ºæœ€å¤§å€¼(2^32)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">updateStrategy</span>:       <span style="color:#75715e"># æ›´æ–°ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate        </span> <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:      <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">1</span>         <span style="color:#75715e"># æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„Podçš„æœ€å¤§å€¼ï¼Œå¯ç”¨ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:     <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†é‚£äº›Pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels:        # LabelsåŒ¹é…è§„åˆ™ï¼ŒmatchExpressions</span>: <span style="color:#ae81ff">åŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#39;fluentd-es&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:     <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºPodæ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#39;fluentd-es&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">fluentd-es</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">agilestacks/fluentd-elasticsearch:v1.3.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:    <span style="color:#75715e"># ç¯å¢ƒå˜é‡é…ç½®</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">FLUENTD_ARGS   </span> <span style="color:#75715e"># ç¯å¢ƒå˜é‡çš„ key</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: -<span style="color:#ae81ff">qq   </span> <span style="color:#75715e"># ç¯å¢ƒå˜é‡çš„ value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:   <span style="color:#75715e"># åŠ è½½æ•°æ®å· é¿å…æ•°æ®ä¸¢å¤±</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">containers     </span> <span style="color:#75715e"># æ•°æ®å·åç§°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/lib/docker/containers        </span> <span style="color:#75715e"># å°†æ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨å†…é‚£ä¸ªç›®å½•</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">varlog</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:          <span style="color:#75715e"># å®šä¹‰æ•°æ®å·</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">containers       </span> <span style="color:#75715e"># å®šä¹‰æ•°æ®å·çš„åç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hostPath</span>:       <span style="color:#75715e"># æ•°æ®å·ç±»å‹ï¼Œä¸»æœºè·¯å¾„æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/var/lib/docker/containers     </span> <span style="color:#75715e"># node ä¸­å…±äº«ç›®å½•</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">varlog</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hostPath</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/var/log</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="serviceç±»å‹æ§åˆ¶å™¨"><code>Service</code>ç±»å‹æ§åˆ¶å™¨</h3>
<blockquote>
<ul>
<li>åœ¨<code>kubernetes</code>ä¸­ï¼Œ<code>Pod</code>æ˜¯åº”ç”¨ç¨‹åºçš„è½½ä½“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Pod</code>çš„<code>IP</code>æ¥è®¿é—®åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯<code>Pod</code>çš„<code>IP</code>åœ°å€ä¸æ˜¯å›ºå®šçš„ï¼Œè¿™å°±æ„å‘³ç€ä¸æ–¹ä¾¿ç›´æ¥é‡‡ç”¨<code>Pod</code>çš„<code>IP</code>å¯¹æœåŠ¡è¿›è¡Œè®¿é—®</li>
<li>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<code>kubernetes</code>æä¾›äº†<code>Service</code>èµ„æºï¼Œ<code>Service</code>ä¼šå¯¹æä¾›åŒä¸€ä¸ªæœåŠ¡çš„å¤šä¸ª<code>Pod</code>è¿›è¡Œèšåˆï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£åœ°å€ï¼Œé€šè¿‡è®¿é—®<code>Service</code>çš„å…¥å£åœ°å€å°±èƒ½è®¿é—®åˆ°åé¢çš„<code>Pod</code>æœåŠ¡</li>
<li><code>Service</code>åœ¨å¾ˆå¤šæƒ…å†µä¸‹åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼šçœŸæ­£èµ·ä½œç”¨çš„å…¶å®æ˜¯<code>kube-proxy</code>æœåŠ¡è¿›ç¨‹ï¼Œæ¯ä¸ª<code>Node</code>èŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œäº†ä¸€ä¸ª<code>kube-proxy</code>çš„æœåŠ¡è¿›ç¨‹ã€‚å½“åˆ›å»º<code>Service</code>çš„æ—¶å€™ä¼šé€šè¿‡<code>API Server</code>å‘<code>etcd</code>å†™å…¥åˆ›å»ºçš„Serviceçš„ä¿¡æ¯ï¼Œè€Œ<code>kube-proxy</code>ä¼šåŸºäºç›‘å¬çš„æœºåˆ¶å‘ç°è¿™ç§<code>Service</code>çš„å˜åŒ–ï¼Œç„¶åå®ƒä¼šå°†æœ€æ–°çš„<code>Service</code>ä¿¡æ¯è½¬æ¢ä¸ºå¯¹åº”çš„è®¿é—®è§„åˆ™</li>
<li>å‡å¦‚ï¼š<code>10.97.97.97:80</code>æ˜¯<code>service</code>æä¾›çš„è®¿é—®å…¥å£ï¼šå½“è®¿é—®è¿™ä¸ªå…¥å£çš„æ—¶å€™ï¼Œå¯ä»¥å‘ç°åé¢æœ‰ä¸‰ä¸ª<code>pod</code>çš„æœåŠ¡åœ¨ç­‰å¾…è°ƒç”¨ï¼Œ<code>kube-proxy</code>ä¼šåŸºäº<code>rr</code>ï¼ˆè½®è¯¢ï¼‰çš„ç­–ç•¥ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°å…¶ä¸­ä¸€ä¸ª<code>pod</code>ä¸Šå»ï¼Œè¿™ä¸ªè§„åˆ™ä¼šåŒæ—¶åœ¨é›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½ç”Ÿæˆï¼Œæ‰€ä»¥åœ¨ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè®¿é—®éƒ½å¯ä»¥</li>
<li><code>ClusterIP</code><!-- raw HTML omitted -->é»˜è®¤å€¼ï¼šå®ƒæ˜¯<code>kubernetes</code>ç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„è™šæ‹Ÿ<code>IP</code>(<code>VIP</code>)ï¼Œåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨ï¼ˆæ‰€æœ‰<code>Node</code>èŠ‚ç‚¹ï¼‰è®¿é—®<!-- raw HTML omitted --></li>
<li><code>NodePort</code><!-- raw HTML omitted -->ï¼šå°†<code>Service</code>é€šè¿‡æŒ‡å®šçš„<code>Node</code>ä¸Šçš„ç«¯å£æš´éœ²ç»™å¤–éƒ¨ï¼Œé€šè¿‡æ­¤æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼ˆä½¿ç”¨æµè§ˆå™¨åŸŸåæˆ–<code>IP</code>ç«¯å£è®¿é—®ï¼‰æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>åˆ›å»ºçš„<code>Service</code>çš„<code>IP</code>åœ°å€åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨æ‰å¯ä»¥è®¿é—®ï¼Œå¦‚æœå¸Œæœ›<code>Service</code>æš´éœ²ç»™é›†ç¾¤å¤–éƒ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨åˆ°å¦å¤–ä¸€ç§ç±»å‹çš„<code>Service</code>ï¼Œç§°ä¸º<code>NodePort</code>ç±»å‹çš„<code>Service</code>ã€‚<code>NodePort</code>çš„å·¥ä½œåŸç†å°±æ˜¯å°†<code>Service</code>çš„ç«¯å£æ˜ å°„åˆ°<code>Node</code>çš„ä¸€ä¸ªç«¯å£ä¸Šï¼Œç„¶åå°±å¯ä»¥é€šè¿‡<code>NodeIP:NodePort</code>æ¥è®¿é—®<code>Service</code>äº†</li>
</ul>
</blockquote>
<ul>
<li><code>LoadBalancer</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨å¤–æ¥è´Ÿè½½å‡è¡¡å™¨å®Œæˆåˆ°æœåŠ¡çš„è´Ÿè½½åˆ†å‘ï¼Œæ³¨æ„æ­¤æ¨¡å¼éœ€è¦å¤–éƒ¨äº‘ç¯å¢ƒçš„æ”¯æŒ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code> LoadBalancer</code>å’Œ<code>NodePort</code>å¾ˆç›¸ä¼¼ï¼Œç›®çš„éƒ½æ˜¯å‘å¤–éƒ¨æš´éœ²ä¸€ä¸ªç«¯å£ï¼ŒåŒºåˆ«åœ¨äº<code>LoadBalancer</code>ä¼šåœ¨é›†ç¾¤çš„å¤–éƒ¨å†æ¥åšä¸€ä¸ªè´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œè€Œè¿™ä¸ªè®¾å¤‡éœ€è¦å¤–éƒ¨ç¯å¢ƒçš„æ”¯æŒï¼Œå¤–éƒ¨æœåŠ¡å‘é€åˆ°è¿™ä¸ªè®¾å¤‡ä¸Šçš„è¯·æ±‚ï¼Œä¼šè¢«è®¾å¤‡è´Ÿè½½ä¹‹åè½¬å‘åˆ°é›†ç¾¤ä¸­</li>
</ul>
</blockquote>
<ul>
<li><code>ExternalName</code><!-- raw HTML omitted -->ï¼šæŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥é›†ç¾¤å†…éƒ¨ï¼Œç›´æ¥ä½¿ç”¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>ExternalName</code>ç±»å‹çš„<code>Service</code>ç”¨äºå¼•å…¥é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡ï¼Œå®ƒé€šè¿‡<code>externalName</code>å±æ€§æŒ‡å®šä¸€ä¸ªæœåŠ¡çš„åœ°å€ï¼Œç„¶ååœ¨é›†ç¾¤å†…éƒ¨è®¿é—®æ­¤<code>Service</code>å°±å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨çš„æœåŠ¡äº†</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain service.spec.type  	<span style="color:#75715e"># </span></span></span></code></pre></div></blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/Service/kubernetes-service-template.yaml" rel="external" target="_self"><code>Kubernetes Service Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1         </span> <span style="color:#75715e"># ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service  </span> <span style="color:#75715e"># ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">service-template       </span> <span style="color:#75715e"># Service åå­—</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># å‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx        </span> <span style="color:#75715e"># Service è‡ªå·±æœ¬èº«çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:     <span style="color:#75715e"># æ ‡ç­¾é€‰æ‹©å™¨ï¼Œç”¨äºç¡®å®šå½“å‰Serviceä»£ç†é‚£äº›Pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-deploymen      </span> <span style="color:#75715e"># æ‰€æœ‰åŒ¹é…åˆ°è¿™äº›æ ‡ç­¾çš„Pod éƒ½å¯ä»¥è¿›è¡Œè®¿é—®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort       </span> <span style="color:#75715e"># æŒ‡å®šServiceçš„ç±»å‹è®¿é—®æ–¹å¼ã€ClusterIPã€NodePortã€ExternalNameï¼ŒNodePortæ”¯æŒé›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œå¯ç”¨ingressè®¾ç½®ï¼šClusterIP</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">externalName</span>: <span style="color:#ae81ff">www.baidu.com  </span> <span style="color:#75715e"># æ”¹æˆIPåœ°å€ä¹Ÿå¯ä»¥,åªæœ‰typeç±»å‹ä¸ºï¼šExternalNameï¼ŒåŸŸåé…ç½®æ‰ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">clusterIP</span>: <span style="color:#ae81ff">10.64.0.47</span>        <span style="color:#75715e"># å®šservice IPï¼Œä¸æŒ‡å®šå°±éšæœºç”Ÿæˆï¼Œå¯ç”¨ingressè®¾ç½®ä¸ºï¼šNone</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sessionAffinity</span>: <span style="color:#ae81ff">None     </span> <span style="color:#75715e"># åˆ†å‘ç­–ç•¥ã€sessionäº²å’Œæ€§ï¼Œæ”¯æŒClientIPã€Noneä¸¤ä¸ªé€‰é¡¹ï¼Œé»˜è®¤å€¼ä¸ºNone</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:        <span style="color:#75715e"># ç«¯å£æ˜ å°„ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>          <span style="color:#75715e"># Service ç«¯å£ï¼Œåœ¨ä½¿ç”¨å†…ç½‘IPè®¿é—®æ—¶ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP      </span> <span style="color:#75715e"># åè®®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort </span>: <span style="color:#ae81ff">80</span>     <span style="color:#75715e"># ç›®æ ‡Podç«¯å£ï¼Œä¾‹å¦‚ï¼šdeploymentã€statefulsetç­‰ï¼ŒNginxï¼š80ï¼ŒTomcatï¼š8080</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodePort</span>: <span style="color:#ae81ff">30002</span>     <span style="color:#75715e"># ç»‘å®šåˆ°nodeä¸»æœºä¸Šçš„ç«¯å£(ç«¯å£ä½¿ç”¨èŒƒå›´ï¼š30000~32767)ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œä¼šé»˜è®¤åˆ†é…ï¼Œå¯ç”¨ingressåˆ é™¤æ­¤è¡Œ</span></span></span></code></pre></div><ul>
<li><code>kube-proxy</code>ç›®å‰æ”¯æŒçš„ä¸‰ç§å·¥ä½œæ¨¡å¼</li>
<li><code>userspace</code><!-- raw HTML omitted -->æ¨¡å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>userspace</code>æ¨¡å¼ä¸‹ï¼Œ<code>kube-proxy</code>ä¼šä¸ºæ¯ä¸€ä¸ª<code>Service</code>åˆ›å»ºä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œå‘å‘<code>Cluster IP</code>çš„è¯·æ±‚è¢«<code>iptables</code>è§„åˆ™é‡å®šå‘åˆ°<code>kube-proxy</code>ç›‘å¬çš„ç«¯å£ä¸Šï¼Œ<code>kube-proxy</code>æ ¹æ®<code>LB</code>ç®—æ³•ï¼ˆè´Ÿè½½å‡è¡¡ç®—æ³•ï¼‰é€‰æ‹©ä¸€ä¸ªæä¾›æœåŠ¡çš„<code>Pod</code>å¹¶å’Œå…¶å»ºç«‹è¿æ¥ï¼Œä»¥ä¾¿å°†è¯·æ±‚è½¬å‘åˆ°<code>Pod</code>ä¸Š</li>
<li><code>userspace</code>æ¨¡å¼ä¸‹ï¼Œ<code>kube-proxy</code>å……å½“äº†ä¸€ä¸ªå››å±‚è´Ÿè½½å‡è¡¡å™¨çš„è§’è‰²ã€‚ç”±äº<code>kube-proxy</code>è¿è¡Œåœ¨<code>userspace</code>ä¸­ï¼Œåœ¨è¿›è¡Œè½¬å‘å¤„ç†çš„æ—¶å€™ä¼šå¢åŠ å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´çš„æ•°æ®æ‹·è´ï¼Œè™½ç„¶æ¯”è¾ƒç¨³å®šï¼Œä½†æ˜¯æ•ˆç‡éå¸¸ä½ä¸‹</li>
</ul>
</blockquote>
<ul>
<li><code>iptables</code><!-- raw HTML omitted -->æ¨¡å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>iptables</code>æ¨¡å¼ä¸‹ï¼Œ<code>kube-proxy</code>ä¸º<code>Service</code>åç«¯çš„æ¯ä¸ª<code>Pod</code>åˆ›å»ºå¯¹åº”çš„<code>iptables</code>è§„åˆ™ï¼Œç›´æ¥å°†å‘å‘<code>Cluster IP</code>çš„è¯·æ±‚é‡å®šå‘åˆ°ä¸€ä¸ª<code>Pod</code>çš„<code>IP</code>ä¸Š</li>
<li><code>iptables</code>æ¨¡å¼ä¸‹<code>kube-proxy</code>ä¸æ‰¿æ‹…å››å±‚è´Ÿè½½å‡è¡¡å™¨çš„è§’è‰²ï¼Œåªè´Ÿè´£åˆ›å»º<code>iptables</code>è§„åˆ™ã€‚è¯¥æ¨¡å¼çš„ä¼˜ç‚¹åœ¨äºè¾ƒ<code>userspace</code>æ¨¡å¼æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯ä¸èƒ½æä¾›çµæ´»çš„<code>LB</code>ç­–ç•¥ï¼Œå½“åç«¯<code>Pod</code>ä¸å¯ç”¨çš„æ—¶å€™æ— æ³•è¿›è¡Œé‡è¯•</li>
</ul>
</blockquote>
<ul>
<li><code>ipvs</code><!-- raw HTML omitted -->æ¨¡å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>ipvs</code>æ¨¡å¼å’Œ<code>iptables</code>ç±»ä¼¼ï¼Œ<code>kube-proxy</code>ç›‘æ§<code>Pod</code>çš„å˜åŒ–å¹¶åˆ›å»ºç›¸åº”çš„<code>ipvs</code>è§„åˆ™ã€‚<code>ipvs</code>ç›¸å¯¹<code>iptables</code>è½¬å‘æ•ˆç‡æ›´é«˜ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œ<code>ipvs</code>æ”¯æŒæ›´å¤šçš„<code>LB</code>ç®—æ³•</p>
</li>
<li>
<p><code>ipvs</code><!-- raw HTML omitted -->çš„æ˜ å°„è§„åˆ™ï¼Œ<code>rr</code>è¡¨ç¤ºè½®è¯¢<!-- raw HTML omitted --></p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ipvsadm -Ln  	<span style="color:#75715e"># æŸ¥çœ‹kube-proxyå·¥ä½œæ¨¡å¼</span></span></span></code></pre></div></blockquote>
<ul>
<li>å¯¹<code>Service</code>çš„è®¿é—®è¢«åˆ†å‘åˆ°äº†åç«¯çš„<code>Pod</code>ä¸Šå»ï¼Œç›®å‰<code>kubernetes</code>æä¾›äº†<!-- raw HTML omitted -->ä¸¤ç§è´Ÿè½½åˆ†å‘<!-- raw HTML omitted -->ç­–ç•¥</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é»˜è®¤ä½¿ç”¨<code>kube-proxy</code>çš„ç­–ç•¥ï¼Œæ¯”å¦‚éšæœºã€è½®è¯¢ç­‰<!-- raw HTML omitted --></li>
<li><code>sessionAffinity</code>ï¼šåŸºäºå®¢æˆ·ç«¯åœ°å€çš„ä¼šè¯ä¿æŒæ¨¡å¼ï¼Œå³æ¥è‡ªåŒä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè½¬å‘åˆ°å›ºå®šçš„ä¸€ä¸ª<code>Pod</code>ä¸Šï¼Œè¿™å¯¹äºä¼ ç»ŸåŸºäº<code>Session</code>çš„è®¤è¯é¡¹ç›®æ¥è¯´å¾ˆå‹å¥½ï¼Œæ­¤æ¨¡å¼å¯ä»¥åœ¨<code>spec</code>ä¸­æ·»åŠ <code>sessionAffinity: ClusterIP</code>é€‰é¡¹</li>
</ul>
</blockquote>
<ul>
<li><code>HeadLiness</code>ç±»å‹è´Ÿè½½å‡çš„<code>Service</code></li>
</ul>
<blockquote>
<ul>
<li>åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œå¼€å‘äººå‘˜å¯èƒ½ä¸æƒ³ä½¿ç”¨<code>Service</code>æä¾›çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè€Œå¸Œæœ›è‡ªå·±æ¥æ§åˆ¶è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œ<code>kubernetes</code>æä¾›äº†<code>HeadLinesss Service</code>ï¼Œè¿™ç±»<code>Serviceä¸</code>ä¼šåˆ†é…<code>Cluster IP</code>ï¼Œå¦‚æœæƒ³è¦è®¿é—®<code>Service</code>ï¼Œåªèƒ½é€šè¿‡<code>Service</code>çš„åŸŸåè¿›è¡ŒæŸ¥è¯¢</li>
<li><code>clusterIP: None</code>ï¼šå°†<code>clusterIP</code>è®¾ç½®ä¸º<code>None</code>ï¼Œå³å¯åˆ›å»º<code>headliness Service</code></li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="endpointç±»å‹æ§åˆ¶å™¨"><code>Endpoint</code>ç±»å‹æ§åˆ¶å™¨</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®é™…ä¸­ä½¿ç”¨çš„ä¸å¤š<!-- raw HTML omitted --></li>
<li><code>Endpoint</code>ï¼šæ˜¯<code>kubernete</code>ä¸­çš„ä¸€ä¸ªèµ„æºå¯¹è±¡ï¼Œå­˜å‚¨åœ¨<code>etcd</code>ä¸­ï¼Œç”¨æ¥è®°å½•ä¸€ä¸ª<code>service</code>å¯¹åº”çš„æ‰€æœ‰<code>Pod</code>çš„è®¿é—®åœ°å€ï¼Œå®ƒæ˜¯æ ¹æ®<code>service</code>é…ç½®æ–‡ä»¶ä¸­çš„<code>selector</code>æè¿°äº§ç”Ÿçš„</li>
<li>ä¸€ä¸ª<code>service</code>ç”±ä¸€ç»„<code>Pod</code>ç»„æˆï¼Œè¿™äº›<code>Pod</code>é€šè¿‡<code>Endpoints</code>æš´éœ²å‡ºæ¥ï¼Œ<code>Endpoints</code>æ˜¯å®ç°å®é™…æœåŠ¡çš„ç«¯ç‚¹é›†åˆã€‚æ¢è¨€ä¹‹<code>servic</code>å’Œ<code>Pod</code>ä¹‹é—´çš„è”ç³»æ˜¯é€šè¿‡<code>Endpoints</code>å®ç°çš„</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl describe svc nginx-service -n app  
</span></span><span style="display:flex;"><span>$ kubectl get endpoints -n dev -o wide  </span></span></code></pre></div><ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/EndPoint/kubernetes-endpoint-template.yaml" rel="external" target="_self"><code>Kubernetes Endpoint Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Endpoints</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">endpoints-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx        </span> <span style="color:#75715e"># æ ‡ç­¾å’ŒService é‡Œçš„labelsä¸€è‡´</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subsets</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">addresses</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">ip</span>: <span style="color:#ae81ff">23.41.187.94</span>    <span style="color:#75715e"># ç›®æ ‡IPåœ°å€</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:        <span style="color:#75715e"># ä¸ Serviceä¸€è‡´</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1         </span> <span style="color:#75715e"># ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service  </span> <span style="color:#75715e"># ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">service-template       </span> <span style="color:#75715e"># Service åå­—</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># å‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx        </span> <span style="color:#75715e"># Service è‡ªå·±æœ¬èº«çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP       </span> <span style="color:#75715e"># æŒ‡å®šServiceçš„ç±»å‹è®¿é—®æ–¹å¼ã€ClusterIPã€NodePortã€ExternalName</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sessionAffinity</span>: <span style="color:#ae81ff">None        </span> <span style="color:#75715e"># åˆ†å‘ç­–ç•¥ã€sessionäº²å’Œæ€§ï¼Œæ”¯æŒClientIPã€Noneä¸¤ä¸ªé€‰é¡¹ï¼Œé»˜è®¤å€¼ä¸ºNone</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:        <span style="color:#75715e"># ç«¯å£æ˜ å°„ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>          <span style="color:#75715e"># Service ç«¯å£ï¼Œåœ¨ä½¿ç”¨å†…ç½‘IPè®¿é—®æ—¶ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP      </span> <span style="color:#75715e"># åè®®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort </span>: <span style="color:#ae81ff">80</span>     <span style="color:#75715e"># ç›®æ ‡Podç«¯å£ï¼Œä¾‹å¦‚ï¼šdeploymentã€statefulsetç­‰</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="jobç±»å‹æ§åˆ¶å™¨"><code>Job</code>ç±»å‹æ§åˆ¶å™¨</h3>
<blockquote>
<ul>
<li><code>Job</code><!-- raw HTML omitted -->ä¸»è¦ç”¨äºè´Ÿè´£æ‰¹é‡å¤„ç†çŸ­æš‚çš„ä¸€æ¬¡æ€§ä»»åŠ¡<!-- raw HTML omitted --></li>
<li><code>Job</code><!-- raw HTML omitted -->ç‰¹ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å½“<code>Job</code>åˆ›å»ºçš„<code>Pod</code>æ‰§è¡ŒæˆåŠŸç»“æŸæ—¶ï¼Œ<code>Job</code>å°†è®°å½•æˆåŠŸç»“æŸçš„<code>Pod</code>æ•°é‡</li>
<li>å½“æˆåŠŸç»“æŸçš„<code>Pod</code>è¾¾åˆ°æŒ‡å®šçš„æ•°é‡æ—¶ï¼Œ<code>Job</code>å°†å®Œæˆæ‰§è¡Œ</li>
</ul>
</blockquote>
<ul>
<li><code>Job</code><!-- raw HTML omitted -->æ¨¡æ¿ä½¿ç”¨é‡å¯ç­–ç•¥å®šä¹‰<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®ä¸ºï¼š<!-- raw HTML omitted --><code>OnFailure</code>ï¼Œ<code> Job</code>ä¼šåœ¨<code>Pod</code>å‡ºç°æ•…éšœçš„æ—¶å€™é‡å¯å®¹å™¨ï¼Œè€Œä¸æ˜¯åˆ›å»º<code>Pod</code>ï¼Œ<code>failed</code>æ¬¡æ•°ä¸å˜</li>
<li><!-- raw HTML omitted -->è®¾ç½®ä¸ºï¼š<!-- raw HTML omitted --><code>Never</code>ï¼Œ<code>Job</code>ä¼šåœ¨<code>Pod</code>å‡ºç°æ•…éšœçš„æ—¶å€™åˆ›å»ºæ–°çš„<code>Pod</code>ï¼Œå¹¶ä¸”æ•…éšœ<code>Pod</code>ä¸ä¼šæ¶ˆå¤±ä¹Ÿä¸ä¼šé‡å¯ï¼Œ<code>failed</code>æ¬¡æ•°+1</li>
<li><!-- raw HTML omitted -->è®¾ç½®ä¸ºï¼š<!-- raw HTML omitted --><code>Always</code>ï¼Œæ„å‘³<code>Job</code>ä¸€ç›´é‡å¯ï¼Œæ„å‘³<code>Pod</code>ä»»åŠ¡ä¼šé‡å¤æ‰§è¡Œï¼Œè¿™å’Œ<code>Job</code>çš„å®šä¹‰å†²çªï¼Œæ‰€ä»¥ä¸èƒ½è®¾ç½®ä¸º<code>Always</code></li>
</ul>
</blockquote>
<ul>
<li><code>Job</code><!-- raw HTML omitted -->èµ„æºæ¸…å•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">batch/v1  	# ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Job  	# ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:  	<span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">job-template  	# åç§°</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">namespace</span>:  <span style="color:#ae81ff">default  	# å‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">labels</span>:  	<span style="color:#75715e"># æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">controller</span>: <span style="color:#ae81ff">job</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:  	<span style="color:#75715e"># è¯¦æƒ…æè¿°</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">completions</span>: <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æŒ‡å®šJobéœ€è¦æˆåŠŸè¿è¡ŒPodçš„æ€»æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">parallelism</span>: <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æŒ‡å®šJobåœ¨ä»»ä¸€æ—¶åˆ»åº”è¯¥å¹¶å‘è¿è¡ŒPodçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">activeDeadlineSeconds</span>: <span style="color:#ae81ff">30</span>  	<span style="color:#75715e"># æŒ‡å®šJobå¯ä»¥è¿è¡Œçš„æ—¶é—´æœŸé™ï¼Œè¶…è¿‡æ—¶é—´è¿˜æ²¡ç»“æŸï¼Œç³»ç»Ÿå°†ä¼šå°è¯•è¿›è¡Œç»ˆæ­¢</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">backoffLimit</span>: <span style="color:#ae81ff">6</span>  	<span style="color:#75715e"># æŒ‡å®šJobå¤±è´¥åè¿›è¡Œé‡è¯•çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º6</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">manualSelector</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># æ˜¯å¦å¯ä»¥ä½¿ç”¨selectoré€‰æ‹©å™¨é€‰æ‹©Podï¼Œé»˜è®¤ä¸ºfalse</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">selector</span>:  	<span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†é‚£äº›Pod</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:  	<span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: <span style="color:#ae81ff">counter-pod</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchExpressions</span>:  	<span style="color:#75715e"># ExpressionsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">app</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#ae81ff">counter-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">template</span>:  	<span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºPodæ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: <span style="color:#ae81ff">counter-pod</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Never  	# é‡å¯ç­–ç•¥åªèƒ½è®¾ç½®ä¸ºNeveræˆ–OnFailure</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">counter</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;for i in 9 8 7 6 5 4 3 2 1;do echo $i;sleep 20;done&#34;</span>]</span></span></code></pre></div></blockquote>
<hr>
<h3 id="cronjobç±»å‹æ§åˆ¶å™¨"><code>CronJob</code>ç±»å‹æ§åˆ¶å™¨</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><code>CronJob</code>æ§åˆ¶å™¨<!-- raw HTML omitted -->ï¼šä»¥<code>Job</code>æ§åˆ¶å™¨ä¸ºå…¶ç®¡æ§å¯¹è±¡ï¼Œå¹¶å€ŸåŠ©å®ƒç®¡ç†<code>Pod</code>èµ„æºå¯¹è±¡ï¼Œ<code>Job</code>æ§åˆ¶å™¨å®šä¹‰çš„ä½œä¸šä»»åŠ¡åœ¨å…¶æ§åˆ¶å™¨èµ„æºåˆ›å»ºä¹‹åä¾¿ä¼šç«‹å³æ‰§è¡Œï¼Œä½†<code>CronJob</code>å¯ä»¥ä»¥ç±»ä¼¼<code>Linux</code>æ“ä½œç³»ç»Ÿçš„å‘¨æœŸæ€§ä»»åŠ¡ä½œä¸šè®¡åˆ’çš„æ–¹å¼æ§åˆ¶å™¨è¿è¡Œæ—¶é—´ç‚¹åŠé‡å¤è¿è¡Œçš„æ–¹å¼ï¼Œæ¢è¨€ä¹‹ï¼Œ<code>CronJob</code>å¯ä»¥åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹åå¤å»æ‰§è¡Œ<code>Job</code>ä»»åŠ¡</li>
<li><code>scheduleï¼šcron</code><!-- raw HTML omitted -->è¡¨è¾¾å¼ï¼Œç”¨äºæŒ‡å®šä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>/1  *</code><!-- raw HTML omitted -->ï¼šè¡¨ç¤ºåˆ†é’Ÿ  å°æ—¶  æ—¥  æœˆä»½  æ˜ŸæœŸ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->åˆ†é’Ÿå€¼ä»<code>0</code>åˆ°<!-- raw HTML omitted --><code>59</code></li>
<li><!-- raw HTML omitted -->å°æ—¶å€¼ä»<code>0</code>åˆ°<!-- raw HTML omitted --><code>23</code></li>
<li><!-- raw HTML omitted -->æ—¥(å¤©)çš„å€¼ä»<code>1</code>åˆ°<!-- raw HTML omitted --><code>31</code></li>
<li><!-- raw HTML omitted -->æœˆçš„å€¼ä»<code>1</code>åˆ°<!-- raw HTML omitted --><code>12</code></li>
<li><!-- raw HTML omitted -->æ˜ŸæœŸçš„å€¼ä»<code>0</code>åˆ°<code>6</code>ï¼Œ<!-- raw HTML omitted --><code>0</code><!-- raw HTML omitted -->è¡¨ç¤ºæ˜ŸæœŸæ—¥<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¤šä¸ªæ—¶é—´å¯ä»¥ç”¨é€—å·éš”å¼€ï¼ŒèŒƒå›´å¯ä»¥ç”¨è¿å­—ç¬¦ç»™å‡ºï¼š* å¯ä»¥ä½œä¸ºé€šé…ç¬¦ï¼Œ/è¡¨ç¤ºæ¯&hellip;<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><code>concurrencyPolicy</code><!-- raw HTML omitted -->å¹¶å‘æ‰§è¡Œç­–ç•¥<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Allow</code><!-- raw HTML omitted -->ï¼šè¿è¡Œ<code>Job</code>å¹¶å‘è°ƒåº¦ï¼ˆé»˜è®¤ï¼‰<!-- raw HTML omitted --></li>
<li><code>Forbid</code><!-- raw HTML omitted -->ï¼šç¦æ­¢å¹¶å‘è¿è¡Œï¼Œå¦‚æœä¹‹å‰çš„ä»»åŠ¡æ²¡å®Œæˆï¼Œåˆ™è·³è¿‡ï¼Œç›´æ¥æ‰§è¡Œæ–°çš„<!-- raw HTML omitted --></li>
<li><code>Replace</code><!-- raw HTML omitted -->ï¼šæ›¿æ¢ï¼Œå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„ä½œä¸šå¹¶ä½¿ç”¨æ–°ä½œä¸šæ›¿æ¢å®ƒ<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/kubernetes-cronjob-template.yaml" rel="external" target="_self"><code>Kubernetes CronJob Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">batch/v1   </span> <span style="color:#75715e"># ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">CronJob  </span> <span style="color:#75715e"># ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cronjob-template       </span> <span style="color:#75715e"># åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># å‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">controller</span>: <span style="color:#ae81ff">cronjob</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># è¯¦æƒ…æè¿°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">concurrencyPolicy</span>: <span style="color:#ae81ff">Allow   </span> <span style="color:#75715e"># å¹¶å‘æ‰§è¡Œç­–ç•¥ï¼ŒAllowï¼šå¹¶å‘è°ƒåº¦ï¼Œ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">failedJobsHistoryLimit</span>: <span style="color:#ae81ff">1</span>   <span style="color:#75715e"># ä¿ç•™å¤šå°‘ä¸ªå¤±è´¥çš„ä»»åŠ¡ï¼Œé»˜è®¤ä¸º1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">successfulJobsHistoryLimit</span>: <span style="color:#ae81ff">3</span>   <span style="color:#75715e"># ä¿ç•™å¤šå°‘ä¸ªæˆåŠŸçš„ä»»åŠ¡ï¼Œé»˜è®¤ä¸º3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># startingDeadlineSeconds: 30   # é—´éš”å¤šé•¿æ—¶é—´æ£€æµ‹å¤±è´¥çš„ä»»åŠ¡å¹¶é‡æ–°æ‰§è¡Œï¼Œæ—¶é—´ä¸èƒ½å°äºï¼š10</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">suspend</span>: <span style="color:#66d9ef">false</span>    <span style="color:#75715e"># æ˜¯å¦æŒ‚èµ·ä»»åŠ¡ï¼Œè‹¥ä¸ºï¼štrue åˆ™è¯¥ä»»åŠ¡ä¸æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schedule</span>: <span style="color:#e6db74">&#34;*/1 * * * * &#34;</span>    <span style="color:#75715e"># cronæ ¼å¼çš„ä½œä¸šè°ƒåº¦è¿è¡Œæ—¶é—´ç‚¹ï¼Œç”¨äºæ§åˆ¶ä»»åŠ¡ä»»åŠ¡æ—¶é—´æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">jobTemplate</span>:          <span style="color:#75715e"># jobæ§åˆ¶å™¨æ¨¡æ¿ï¼Œç”¨äºä¸ºcronjobæ§åˆ¶å™¨ç”Ÿæˆjobå¯¹è±¡ï¼Œä¸‹é¢å…¶å®å°±æ˜¯jobçš„å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">completions</span>: <span style="color:#ae81ff">1</span>    <span style="color:#75715e"># æŒ‡å®šJobéœ€è¦æˆåŠŸè¿è¡ŒPodçš„æ€»æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">parallelism</span>: <span style="color:#ae81ff">1</span>    <span style="color:#75715e"># æŒ‡å®šJobåœ¨ä»»ä¸€æ—¶åˆ»åº”è¯¥å¹¶å‘è¿è¡ŒPodçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">activeDeadlineSeconds</span>: <span style="color:#ae81ff">30</span>         <span style="color:#75715e"># æŒ‡å®šJobå¯ä»¥è¿è¡Œçš„æ—¶é—´æœŸé™ï¼Œè¶…è¿‡æ—¶é—´è¿˜æ²¡ç»“æŸï¼Œç³»ç»Ÿå°†ä¼šå°è¯•è¿›è¡Œç»ˆæ­¢</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">backoffLimit</span>: <span style="color:#ae81ff">6</span>   <span style="color:#75715e"># æŒ‡å®šJobå¤±è´¥åè¿›è¡Œé‡è¯•çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º6</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">template</span>:         <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºPodæ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Never         </span> <span style="color:#75715e"># é‡å¯ç­–ç•¥åªèƒ½è®¾ç½®ä¸ºNeveræˆ–OnFailure</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">container-name</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">command</span>: [ <span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;for i in 9 8 7 6 5 4 3 2 1;do echo $i;sleep 20;done&#34;</span> ]</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ¨¡æ¿è¯¦ç»†æè¿°">æ¨¡æ¿è¯¦ç»†æè¿°</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/bitnami/" rel="external" target="_self"><code>Bitnami</code>æ¨¡æ¿åº“</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/bitnami/charts/tree/main/bitnami" rel="external" target="_self"><code>Kubernetes</code>çš„<code>Bitnami</code>åº“</a></td>
<td><code>Helm</code>å®‰è£…<code>Kubernetes</code>æœåŠ¡<code>Zabbix</code>ã€<code>Redis</code>ã€<code>Mysql</code>æ¨¡æ¿</td>
</tr>
<tr>
<td><a href="https://github.com/bitnami/charts-docs/tree/main/charts" rel="external" target="_self"><code>Kubernetes</code>çš„<code>Charts-docs</code>åº“</a></td>
<td><code>Helm</code>å®‰è£…<code>Kubernetes</code>æœåŠ¡<code>Zabbix</code>ã€<code>Redis</code>ã€<code>Mysql</code>æ¨¡æ¿</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/kubernetes-template.yaml" rel="external" target="_self"><code>Kubernetes Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1   </span> <span style="color:#75715e"># ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment   </span> <span style="color:#75715e"># èµ„æºç±»å‹ï¼Œä¾‹å¦‚ Podã€Deploymentã€Serviceã€ReplicaSetã€StatefulSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:   <span style="color:#75715e"># POdç›¸å…³çš„å…ƒæ•°æ®ï¼Œç”¨äºæè¿°Podæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">java-demo  </span> <span style="color:#75715e"># Podåç§°ã€åœ¨åŒä¸€ä¸ªåç§°ç©ºé—´å†…ä¸èƒ½é‡å¤</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">string  </span> <span style="color:#75715e"># Podæ‰€å±çš„å‘½åç©ºé—´,é»˜è®¤ä¸º&#34;default&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:   <span style="color:#75715e"># å®šä¹‰Podçš„æ ‡ç­¾ï¼Œåªèƒ½ä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹ï¼šstring</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">java-demo  </span> <span style="color:#75715e"># è‡ªå®šä¹‰labelæ ‡ç­¾ï¼Œkey(é”®)ä¸ºï¼šnameï¼Œvalue(å€¼)ä¸ºï¼šjava-demo</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">version</span>: <span style="color:#ae81ff">v1.1.0  </span> <span style="color:#75715e"># è‡ªå®šä¹‰ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:    <span style="color:#75715e"># æ³¨é‡Šï¼Œä¸èƒ½ä½œä¸ºè¢«ç­›é€‰</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">java-demo</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># Podä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>   <span style="color:#75715e"># åˆ›å»ºçš„å‰¯æœ¬æ•°é‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">10</span>    <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°åä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:   <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œç”¨äºæ‰¾åˆ°åŒ¹é…çš„ ReplicaSet(å‰¯æœ¬)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:    <span style="color:#75715e"># æŒ‰ç…§Labelsæ ‡ç­¾åŒ¹é…å‰¯æœ¬</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">java-demo  </span> <span style="color:#75715e"># åŒ¹é…çš„keyï¼Œvalue</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">version</span>: <span style="color:#ae81ff">v1.1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:   <span style="color:#75715e"># æ›´æ–°ç­–ç•¥ï¼ŒStatefulSetæ›´æ–°ä½¿ç”¨ï¼šupdateStrategy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:    <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°é…ç½®</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">partition</span>: <span style="color:#ae81ff">3</span>    <span style="color:#75715e"># å®ç°ç°åº¦/é‡‘ä¸é›€å‘å¸ƒï¼ŒæŒ‰åºå·æ›´æ–°ï¼Œæ›´æ–°å¤§äºç­‰äº3çš„åºå·ï¼Œä¸å’Œç™¾åˆ†æ¯”å…±ç”¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%  </span> <span style="color:#75715e"># å¤šå°‘ä¸ª/ç™¾åˆ†ä¹‹å¤šå°‘Podså¤„äºæ›´æ–°ï¼Œæ•°å€¼è¶Šå¤§æ›´æ–°è¶Šå¿«ï¼Œä¸ç¨³å®š</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%  </span> <span style="color:#75715e"># å¤šå°‘ä¸ª/ç™¾åˆ†ä¹‹å¤šå°‘Podså¤„äºå…³é—­ï¼Œæ•°å€¼è¶Šå°æ›´æ–°æ…¢ï¼Œç¨³å®š</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate  </span> <span style="color:#75715e"># æ›´æ–°ç±»å‹é€‰æ‹©å™¨ï¼Œé‡‡ç”¨æ»šåŠ¨æ›´æ–°ï¼ŒOnDeleteï¼šæ–¹å¼æ›´æ–°ï¼Œåˆ é™¤podsæ—¶æ›´æ–°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:   <span style="color:#75715e"># Pod æ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:   <span style="color:#75715e"># Pod çš„å…ƒä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:   <span style="color:#75715e"># Pod çš„æ ‡ç­¾ </span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">java-demo</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">version</span>: <span style="color:#ae81ff">v1.1.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:   <span style="color:#75715e"># Podçš„æœŸæœ›ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nodeName</span>: <span style="color:#ae81ff">k8s-node1  </span> <span style="color:#75715e"># è®¾ç½®NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nodeSelector</span>: <span style="color:#ae81ff">obeject  </span> <span style="color:#75715e"># è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Š</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">hostNetwork</span>: <span style="color:#66d9ef">false</span>    <span style="color:#75715e"># æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">tolerations</span>:  	<span style="color:#75715e"># å®¹å¿é…ç½®</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">effect</span>: <span style="color:#e6db74">&#34;æ±¡ç‚¹çš„ç±»å‹&#34;</span>  <span style="color:#75715e"># Noschedule</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;æ±¡ç‚¹çš„Key&#34;</span>  	<span style="color:#75715e"># æ±¡ç‚¹çš„Key</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">operate</span>: <span style="color:#e6db74">&#34;Equal&#34;</span>  	<span style="color:#75715e"># Existsï¼šåŒ¹é…Keyï¼ŒEqualæ·»åŠ ï¼švalueé…ç½®ï¼Œ</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;æ±¡ç‚¹çš„value&#34;</span>  	<span style="color:#75715e"># æ±¡ç‚¹çš„value</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullSecrets</span>:   <span style="color:#75715e"># é…ç½®ç™»å½• docker registry çš„ secret ä»“åº“</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker-harbor  </span> <span style="color:#75715e"># æŒ‡å®šä½¿ç”¨çš„secretåº“æˆ¿åç§°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:   <span style="color:#75715e"># å¯¹äº Podä¸­å®¹å™¨æè¿°</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">tomcat-demo  </span> <span style="color:#75715e"># æŒ‡å®šå®¹å™¨åç§°ï¼Œä¸å¯æ›´æ–°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">192.168.80.210</span>:<span style="color:#ae81ff">8080</span><span style="color:#ae81ff">/test/tomcat-demo:v1   </span> <span style="color:#75715e"># é•œåƒä»“åº“åœ°å€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: [ <span style="color:#ae81ff">Always | Never | IfNotPresent ]   </span> <span style="color:#75715e"># é•œåƒæ‹‰å–æ–¹å¼</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#ae81ff">string]  </span> <span style="color:#75715e"># ä»¥æ•°ç»„æ–¹å¼æŒ‡å®šå®¹å™¨å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">args</span>:   <span style="color:#75715e"># ä»¥æ•°ç»„æ–¹å¼æŒ‡å®šå®¹å™¨å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨ï¼Œæ›¿ä»£dockerçš„CMDæŒ‡ä»¤</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">/bin/sh</span>
</span></span><span style="display:flex;"><span>        - -<span style="color:#ae81ff">c</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">touch /tmp/healthy; sleep 30; rm -fr /tmp/healthy; sleep 600   </span> <span style="color:#75715e"># ä¸èƒ½è¶…è¿‡æ¢é’ˆæ‰§è¡Œæ—¶é—´</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">workingDir</span>: <span style="color:#ae81ff">string   </span> <span style="color:#75715e"># å®¹å™¨å¯åŠ¨åè¿›å…¥çš„å·¥ä½œç›®å½•ï¼Œä¸æŒ‡å®šåˆ™ä½¿ç”¨é•œåƒé»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:   <span style="color:#75715e"># æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">data   </span> <span style="color:#75715e"># å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/opt/data   </span> <span style="color:#75715e"># å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">readOnly</span>: <span style="color:#ae81ff">boolean  </span> <span style="color:#75715e"># æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:    <span style="color:#75715e"># éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">http   </span> <span style="color:#75715e"># ä¸ºç«¯å£å–åï¼Œè¯¥åç§°å¯ä»¥åœ¨serviceç§è¢«å¼•ç”¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">int   </span> <span style="color:#75715e"># å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">hostPort</span>: <span style="color:#ae81ff">int  </span> <span style="color:#75715e"># å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP  </span> <span style="color:#75715e"># ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>    <span style="color:#75715e"># Pod æœ¬èº«æœåŠ¡ç«¯å£ï¼Œæ¯”å¦‚Nginxï¼š80ï¼ŒTomcatï¼š8080</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">nodePort</span>: <span style="color:#ae81ff">30001</span>   <span style="color:#75715e"># èŠ‚ç‚¹å¯¹å¤–ç«¯å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:    <span style="color:#75715e"># å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">JAVA_OPTS  </span> <span style="color:#75715e"># ç¯å¢ƒå˜é‡åç§°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;-Xmx1g&#34;</span>   <span style="color:#75715e"># ç¯å¢ƒå˜é‡çš„å€¼</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:    <span style="color:#75715e"># èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:   <span style="color:#75715e"># é™å®šPodæœ€å¤§ä½¿ç”¨ç¡¬ä»¶èµ„æºã€é€šå¸¸è®¾ç½®cpuå’Œmemory</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span>    <span style="color:#75715e"># Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°ï¼Œ1000mç­‰äºä¸€ä¸ªæ ¸å¿ƒ</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;1Gi&#34;</span>   <span style="color:#75715e"># å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:   <span style="color:#75715e"># æœ€ä½èµ„æºè¦æ±‚ï¼Œåœ¨schedulerä¸­è¢«ç”¨åˆ°ï¼Œé€šå¸¸è®¾ç½®cpuå’Œmemory</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;0.5&#34;</span>    <span style="color:#75715e"># é™å®šä½¿ç”¨å‡ ä¸ªæ ¸å¿ƒCPUã€å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;256Mi&#34;</span>   <span style="color:#75715e"># è®¾å®šä½¿ç”¨å†…å­˜ã€å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">lifecycle</span>:    <span style="color:#75715e"># ç”Ÿå‘½å‘¨æœŸé’©å­</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">postStart</span>:    <span style="color:#75715e"># å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">exec</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;echo Hello from the postStart handler &gt;/usr/share/message&#34;</span>]
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">preStop</span>:    <span style="color:#75715e"># å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">exec</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;nginx -s quit; while killall -0 nginx; do sleep 1; done&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">startupProbe</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">tcpSocket</span>:    <span style="color:#75715e"># ä½¿ç”¨TcpSocketã€httpGetå¥åº·æ£€æŸ¥</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8010</span>    <span style="color:#75715e"># æ¢æµ‹8010ç«¯å£</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>   <span style="color:#75715e"># æ£€æµ‹å¤±è´¥5æ¬¡è¡¨ç¤ºæœªå°±ç»ª</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">60</span>   <span style="color:#75715e"># æŒ‡å®šå®¹å™¨å¯åŠ¨60sä¹‹åå¼€å§‹æ‰§è¡ŒLivenessæ¢æµ‹ï¼Œ</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>   <span style="color:#75715e"># æŒ‡å®šæ¯10ç§’æ‰§è¡Œä¸€æ¬¡Livenessæ¢æµ‹ã€‚</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>   <span style="color:#75715e"># æ£€æŸ¥æˆåŠŸä¸º2æ¬¡è¡¨ç¤ºå°±ç»ª</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>   <span style="color:#75715e"># æ£€æµ‹å¤±è´¥1æ¬¡è¡¨ç¤ºæœªå°±ç»ª</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">livenessProbe</span>:    <span style="color:#75715e"># å¯¹Podå†…å„å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">exec</span>:   <span style="color:#75715e"># å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">command</span>:    <span style="color:#75715e"># execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">sh</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">c</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#e6db74">&#34;sleep 5; echo &#39;success&#39;;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">httpGet</span>:    <span style="color:#75715e"># å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/  </span> <span style="color:#75715e"># URIåœ°å€ï¼šhttp://:80/index.html</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8010</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">host</span>: <span style="color:#ae81ff">192.168.109.100</span>   <span style="color:#75715e"># ä¸»æœºåœ°å€</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">HTTP   </span> <span style="color:#75715e"># æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">HttpHeaders</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">value</span>: <span style="color:#ae81ff">string(å­—ç¬¦ä¸²)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">tcpSocket</span>:    <span style="color:#75715e"># å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8010</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">60</span>   <span style="color:#75715e"># å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>   <span style="color:#75715e"># å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>   <span style="color:#75715e"># å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>   <span style="color:#75715e"># é…ç½®ä¸ºï¼š1ï¼Œè¡¨ç¤ºæ£€æŸ¥ä¸€æ¬¡æˆåŠŸå°±æˆåŠŸï¼Œé…ç½®ä¸ºï¼š3ï¼Œè¡¨ç¤ºæ£€æŸ¥3æ¬¡</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>   <span style="color:#75715e"># å¤±è´¥æ¬¡æ•°ï¼Œæ£€æŸ¥5æ¬¡å¤±è´¥è¡¨ç¤ºå¤±è´¥</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">securityContext</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">privileged</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: [<span style="color:#ae81ff">Always | Never | OnFailure]  </span> <span style="color:#75715e"># Podçš„é‡å¯ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>   <span style="color:#75715e"># åˆ é™¤podsã€deploymentåç­‰å¾…æ—¶é—´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:    <span style="color:#75715e"># åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume  </span> <span style="color:#75715e"># å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">emptyDir</span>: {}    <span style="color:#75715e"># ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hostPath</span>:   <span style="color:#75715e"># ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/root/logs   </span> <span style="color:#75715e"># Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate  </span> <span style="color:#75715e"># ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºå†ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">secret</span>:   <span style="color:#75715e"># ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">scretname</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMap</span>:    <span style="color:#75715e"># ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="ç¼–å†™é€‚ç”¨javaçš„yaml">ç¼–å†™é€‚ç”¨<code>Java</code>çš„<code>yaml</code></h4>
<ul>
<li>
<ol>
<li>ä¸‹è½½<code>java demo</code>ä»£ç </li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/frankinbj/tomcat-java-demo.git     </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¿®æ”¹è¿æ¥æ•°æ®åº“é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;tomcat-java-demo/src/main/resources/application.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">datasource:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    url: jdbc:mysql://192.168.80.215:3306/test?characterEncoding=utf-8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    username: admin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    password: admin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li>æ‰“åŒ…<code>java war</code>åŒ…</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/tomcat-java-demo/
</span></span><span style="display:flex;"><span>$ mvn clean package -Dmaven.test.skip<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”ŸæˆwaråŒ…</span>
</span></span><span style="display:flex;"><span>$ ll /opt/tomcat-java-demo/target/ly-simple-tomcat-0.0.1-SNAPSHOT.war</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æŠŠæ•°æ®å¯¼å…¥æ•°æ®åº“ï¼Œåˆ›å»ºæˆæƒè¿æ¥ç”¨æˆ·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysql -uroot -p &lt; tomcat-java-demo/doc/db/tables_ly_tomcat.sql
</span></span><span style="display:flex;"><span>$ grant all privileges on *.* to admin@<span style="color:#e6db74">&#39;%&#39;</span> identified by <span style="color:#e6db74">&#39;admin&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>JDK</code>ã€<code>Maven</code><!-- raw HTML omitted -->é…ç½®ç¯å¢ƒå˜é‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;#####  	JDK ç’°å¢ƒè®Šæ•¸  	#####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JAVA_HOME=/usr/local/jdk
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JRE_HOME=</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/jre
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export CLASSPATH=</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/lib:</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/lib/tools.jar
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=</span><span style="color:#e6db74">${</span>PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/bin:</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/jre/bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=</span><span style="color:#e6db74">${</span>PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">:/usr/local/maven/bin &#34;</span>&gt;&gt;/etc/profile</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li>ä¿®æ”¹<code>Dockerfile</code>é…ç½®æ–‡ä»¶ï¼Œ<code>docker build</code>æˆé•œåƒ</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>6.1 ä½¿ç”¨<code>Tomcat</code>æœåŠ¡æ‰“åŒ…å¯åŠ¨å®¹å™¨</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/tomcat-java-demo/Dockerfile<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">FROM lizhenliang/tomcat
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RUN rm -rf /usr/local/tomcat/webapps/*
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ADD target/*.war /usr/local/tomcat/webapps/ROOT.war
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å£°æ˜æ—¶åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo &#39;Asia/Shanghai&#39; &gt;/etc/timezone
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>6.2 ä½¿ç”¨<code>java -jar</code><!-- raw HTML omitted -->æ‰“åŒ…é•œåƒï¼Œå¯ä»¥ä½¿ç”¨<!-- raw HTML omitted --><code>xxl-job</code>çš„<code>jar</code>åŒ…</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> openjdk</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">VOLUME</span><span style="color:#e6db74"> /tmp</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> ./target/live-server-1.0.0-SNAPSHOT.jar live-server-1.0.0-SNAPSHOT.jar<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> bash -c <span style="color:#e6db74">&#34;touch /live-server-1.0.0-SNAPSHOT.jar&#34;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># å£°æ˜æ—¶åŒº</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#39;Asia/Shanghai&#39;</span> &gt;/etc/timezone<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># å£°æ˜è¿è¡Œæ—¶å®¹å™¨æä¾›æœåŠ¡ç«¯å£ï¼Œè¿è¡Œæ—¶ä¸ä¼šå¼€å¯è¿™ä¸ªç«¯å£çš„æœåŠ¡ï¼Œéœ€è¦æŠŠç«¯å£æ˜ å°„</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 8080</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;java&#34;</span>,<span style="color:#e6db74">&#34;-jar&#34;</span>,<span style="color:#e6db74">&#34;/live-server-1.0.0-SNAPSHOT.jar&#34;</span>]</span></span></code></pre></div><ul>
<li>6.3 ç”Ÿæˆ<code>docker imagesï¼š</code>é•œåƒå¹¶æ¨é€åˆ°ç§äººä»“åº“</li>
</ul>
<blockquote>
<ul>
<li>
<p><code>-t,--tag list</code>ï¼šé•œåƒåç§°</p>
</li>
<li>
<p><code>-fï¼Œ--file string</code>ï¼šå¦‚æœæ–‡ä»¶åä¸æ˜¯<code>Dockerfile</code>ï¼Œ<code>-f</code>å¯ä»¥æŒ‡å®šå…¶ä»–æ–‡ä»¶</p>
</li>
<li>
<p><code>192.168.80.210:8080</code>ï¼šç§äººä»“åº“åœ°å€</p>
</li>
<li>
<p><code>test</code>ï¼šç§äººä»“åº“å</p>
</li>
<li>
<p><code>tomcat-demo:v1</code>ï¼šå®šä¹‰é•œåƒåç§°ä»¥åŠç‰ˆæœ¬</p>
</li>
<li>
<p>å¦‚æœæ‰“åŒ…æŠ¥é”™ï¼š<code>epository does not exist,</code>æ›´æ¢<code>Dockerfile</code>çš„<code>FROM</code>æºåœ°å€</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/tomcat-java-demo/
</span></span><span style="display:flex;"><span>$ docker build -t 192.168.80.210:8080/test/tomcat-demo:v1 .  	<span style="color:#75715e"># æ‰“åŒ…é•œåƒ</span>
</span></span><span style="display:flex;"><span>$ docker push 192.168.80.210:8080/test/tomcat-demo:v1  	<span style="color:#75715e"># æ¨é€åˆ°ç§äººä»“åº“ </span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="éƒ¨ç½²elkæ—¥å¿—æœåŠ¡">éƒ¨ç½²<code>ELK</code>æ—¥å¿—æœåŠ¡</h4>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/devops/Logs/kubernetes-elasticsearch.yaml" rel="external" target="_self"><code>Kubernetes Elasticsearch Template</code>æ¨¡æ¿</a></li>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/devops/Logs/kubernetes-logstash.yaml" rel="external" target="_self"><code>Kubernetes Logstash Template</code>æ¨¡æ¿</a></li>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/devops/Logs/kubernetes-filebeat.yaml" rel="external" target="_self"><code>Kubernetes Filebeat Template</code>æ¨¡æ¿</a></li>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/devops/Logs/kubernetes-kibana.yaml" rel="external" target="_self"><code>Kubernetes Kibana Template</code>æ¨¡æ¿</a></li>
</ul>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="kubernetes_command">Kubernetes_Command</h1>

<h1 id="kuberneteså‘½ä»¤ä½¿ç”¨"><code>Kubernetes</code>å‘½ä»¤ä½¿ç”¨</h1>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands" rel="external" target="_self"><code>Kubernetes</code>å®˜æ–¹å‘½ä»¤æ–‡æ¡£</a></td>
<td><code>Kubernetes</code>å®˜æ–¹æ–‡æ¡£è¯¦è§£</td>
</tr>
<tr>
<td><a href="https://github.com/cloudnativelabs/kube-shell" rel="external" target="_self"><code>Kube-shell</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><a href="#R-image-f6426c44ee62733d330c84724ff2075a" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/14d359426542433e871819e0de267de1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f6426c44ee62733d330c84724ff2075a"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/14d359426542433e871819e0de267de1.png"></a></p>
</blockquote>
<h2 id="kubectlè·å–èµ„æºåç§°ä½¿ç”¨å‘½ä»¤"><code>kubectl</code>è·å–èµ„æºåç§°ã€ä½¿ç”¨å‘½ä»¤</h2>
<blockquote>
<ul>
<li><code>kubectl</code><!-- raw HTML omitted -->æ˜¯<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->é›†ç¾¤çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡å®ƒèƒ½å¤Ÿå¯¹é›†ç¾¤æœ¬èº«è¿›è¡Œç®¡ç†ï¼Œå¹¶èƒ½å¤Ÿåœ¨é›†ç¾¤ä¸Šè¿›è¡Œå®¹å™¨åŒ–åº”ç”¨çš„å®‰è£…å’Œéƒ¨ç½²<!-- raw HTML omitted --></li>
<li><code>kubectl api-resources</code><!-- raw HTML omitted -->æ˜¯æŸ¥çœ‹<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->èµ„æºå‘½ä»¤<!-- raw HTML omitted --></li>
<li><code>Kubernetes</code><!-- raw HTML omitted -->ä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œæ‰€æœ‰å‘½ä»¤éƒ½æ˜¯å›´ç»•èµ„æºæ“ä½œã€æ‰§è¡Œ<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>èµ„æºåˆ†ç±»</th>
<th>èµ„æºåç§°</th>
<th>ç¼©å†™</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>é›†ç¾¤çº§åˆ«èµ„æº</td>
<td><code>nodes</code></td>
<td><code>no</code></td>
<td>é›†ç¾¤ç»„æˆéƒ¨åˆ†</td>
</tr>
<tr>
<td>é›†ç¾¤çº§åˆ«èµ„æº</td>
<td><code>namespaces</code></td>
<td><code>ns</code></td>
<td>éš”ç¦»<code>Pod</code></td>
</tr>
<tr>
<td><code>Pods</code></td>
<td><code>Pods</code></td>
<td><code>po</code></td>
<td>è£…è½½å®¹å™¨</td>
</tr>
<tr>
<td><code>Pod</code>èµ„æºæ§åˆ¶å™¨</td>
<td><code>replicationcontrollers</code></td>
<td><code>rc</code></td>
<td>æ¯”è¾ƒåŸå§‹çš„<code>Pod</code>æ§åˆ¶å™¨ï¼Œå·²ç»è¢«åºŸå¼ƒï¼Œç”±<code>ReplicaSet</code>æ›¿ä»£</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>replicasets</code></td>
<td><code>rs</code></td>
<td>ä¿è¯æŒ‡å®šæ•°é‡çš„<code>Pod</code>è¿è¡Œï¼Œå¹¶æ”¯æŒ<code>Pod</code>æ•°é‡å˜æ›´ï¼Œé•œåƒç‰ˆæœ¬å˜æ›´</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>deployments</code></td>
<td><code>deploy</code></td>
<td>é€šè¿‡æ§åˆ¶<code>ReplicaSet</code>æ¥æ§åˆ¶<code>Pod</code>ï¼Œå¹¶æ”¯æŒæ»šåŠ¨å‡çº§ã€ç‰ˆæœ¬å›é€€</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>daemonsets</code></td>
<td><code>ds</code></td>
<td>åœ¨é›†ç¾¤ä¸­çš„æŒ‡å®š<code>Node</code>ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬ç”¨äºå®ˆæŠ¤è¿›ç¨‹ç±»çš„ä»»åŠ¡</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>jobs</code></td>
<td>&mdash;</td>
<td>å®ƒåˆ›å»ºå‡ºæ¥çš„<code>Pod</code>åªè¦å®Œæˆä»»åŠ¡å°±ç«‹å³é€€å‡ºï¼Œç”¨äºæ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>cronjobs</code></td>
<td><code>cj</code></td>
<td>å®ƒåˆ›å»ºçš„<code>Pod</code>ä¼šå‘¨æœŸæ€§çš„æ‰§è¡Œï¼Œç”¨äºæ‰§è¡Œå‘¨æœŸæ€§çš„ä»»åŠ¡</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>horizontalpodautoscalers</code></td>
<td><code>hpa</code></td>
<td>å¯ä»¥æ ¹æ®é›†ç¾¤è´Ÿè½½è‡ªåŠ¨è°ƒæ•´<code>Pod</code>çš„æ•°é‡ï¼Œå®ç°å‰Šå³°å¡«è°·</td>
</tr>
<tr>
<td><code>Pod</code>èµ„æºæ§åˆ¶å™¨</td>
<td><code>statefulsets</code></td>
<td><code>sts</code></td>
<td>ç®¡ç†æœ‰çŠ¶æ€çš„åº”ç”¨</td>
</tr>
<tr>
<td>æœåŠ¡å‘ç°èµ„æº</td>
<td><code>services</code></td>
<td><code>svc</code></td>
<td>ç»Ÿä¸€<code>Pod</code>å¯¹å¤–æ¥å£</td>
</tr>
<tr>
<td>æœåŠ¡å‘ç°èµ„æº</td>
<td><code>ingress</code></td>
<td><code>ing</code></td>
<td>ç»Ÿä¸€<code>Pod</code>å¯¹å¤–æ¥å£</td>
</tr>
<tr>
<td>å­˜å‚¨èµ„æº</td>
<td><code>volumeattachments</code></td>
<td>&mdash;</td>
<td>å­˜å‚¨</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>persistentvolumes</code></td>
<td><code>pv</code></td>
<td>å­˜å‚¨</td>
</tr>
<tr>
<td>å­˜å‚¨èµ„æº</td>
<td><code>persistentvolumeclaims</code></td>
<td><code>pvc</code></td>
<td>å­˜å‚¨</td>
</tr>
<tr>
<td>é…ç½®èµ„æº</td>
<td><code>configmaps</code></td>
<td><code>cm</code></td>
<td>é…ç½®</td>
</tr>
<tr>
<td>é…ç½®èµ„æº</td>
<td><code>secrets</code></td>
<td>&mdash;</td>
<td>é…ç½®</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>å¸¸ç”¨å‘½ä»¤</strong></th>
<th>å‘½ä»¤</th>
<th>ç¿»è¯‘</th>
<th>å‘½ä»¤ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>&mdash;</td>
<td><code>run</code></td>
<td>è¿è¡Œ</td>
<td>åœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>get</code></td>
<td>è·å–</td>
<td>è·å–æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªèµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>set</code></td>
<td>è®¾ç½®</td>
<td>è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„ç‰¹å®šç‰¹å¾</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>create</code></td>
<td>åˆ›å»º</td>
<td>ä»æ–‡ä»¶æˆ–æ ‡å‡†è¾“å…¥åˆ›å»ºèµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>edit</code></td>
<td>ç¼–è¾‘</td>
<td>ç¼–è¾‘æœåŠ¡å™¨ä¸Šçš„èµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>patch</code></td>
<td>æ›´æ–°</td>
<td>æ›´æ–°ä¸€ä¸ªèµ„æºï¼Œæ›´æ–°èµ„æºçš„å­—æ®µ</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>apply</code></td>
<td>åº”ç”¨</td>
<td>é€šè¿‡æ–‡ä»¶åæˆ–æ ‡å‡†è¾“å…¥å°†é…ç½®åº”ç”¨äºèµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>replace</code></td>
<td>æ›¿æ¢</td>
<td>ç”¨æ–‡ä»¶åæˆ–æ ‡å‡†è¾“å…¥æ›¿æ¢èµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>delete</code></td>
<td>åˆ é™¤</td>
<td><code>delete</code>æŒ‰æ–‡ä»¶åã€æ ‡å‡†è¾“å…¥ã€èµ„æºå’Œåç§°ï¼Œæˆ–æŒ‰èµ„æºå’Œæ ‡ç­¾é€‰æ‹©å™¨åˆ é™¤èµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>api-resources</code></td>
<td>&mdash;</td>
<td>æ‰“å°æœåŠ¡å™¨ä¸Šæ”¯æŒçš„<code>API</code>èµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>api-versions</code></td>
<td>&mdash;</td>
<td>æ‰“å°æœåŠ¡å™¨ä¸Šæ”¯æŒçš„<code>API</code>ç‰ˆæœ¬ï¼Œæ ¼å¼ä¸º<code>group/version</code></td>
</tr>
<tr>
<td><strong>å¸¸ç”¨å‘½ä»¤</strong></td>
<td><code>version</code></td>
<td>ç‰ˆæœ¬</td>
<td>æ‰“å°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>ä¸­çº§å‘½ä»¤</strong></th>
<th>å‘½ä»¤</th>
<th>ç¿»è¯‘</th>
<th>å‘½ä»¤ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>&mdash;</td>
<td><code>cp</code></td>
<td>å¤åˆ¶</td>
<td>åœ¨<code>Pod</code>å†…å¤–å¤åˆ¶æ–‡ä»¶</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>exec</code></td>
<td>æ‰§è¡Œ</td>
<td>åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>label</code></td>
<td>æ ‡ç­¾</td>
<td>æ›´æ–°èµ„æºä¸Šçš„æ ‡ç­¾</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>logs</code></td>
<td>æ—¥å¿—</td>
<td>æ‰“å°<code>pod</code>ä¸­å®¹å™¨çš„æ—¥å¿—</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>attach</code></td>
<td>ç¼ ç»•</td>
<td>è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨ã€é™„åŠ åˆ°æ­£åœ¨è¿è¡Œçš„å®¹å™¨</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>describe</code></td>
<td>æè¿°</td>
<td><code>describe</code>æ˜¾ç¤ºç‰¹å®šèµ„æºæˆ–èµ„æºç»„çš„è¯¦ç»†ä¿¡æ¯</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>expose</code></td>
<td>æš´éœ²</td>
<td>å°†å¤åˆ¶æ§åˆ¶å™¨ã€æœåŠ¡ã€éƒ¨ç½²æˆ–<code>pod</code>æš´éœ²ä¸ºæ–°çš„<code>Kubernetes</code>æœåŠ¡<code>Service</code></td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>explain</code></td>
<td>è§£é‡Š</td>
<td>å±•ç¤ºèµ„æºç±»å‹ã€å±æ€§æ–‡æ¡£ï¼Œè·å–èµ„æºæ§åˆ¶å™¨å­—æ®µä½¿ç”¨</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>annotate</code></td>
<td>æ³¨é‡Š</td>
<td>æ›´æ–°èµ„æºä¸Šçš„æ³¨é‡Š</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>rollout</code></td>
<td>é¦–æ¬¡å±•ç¤º</td>
<td>ç®¡ç†èµ„æºçš„å‘å¸ƒï¼ŒæŸ¥çœ‹ã€æ›´æ–°<code>Pods</code>ç‰ˆæœ¬å‘å¸ƒ</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>scale</code></td>
<td>æ‰‹åŠ¨æ‰©å®¹ã€ç¼©å®¹</td>
<td>æ‰©(ç¼©)å®¹<code>Pod</code>çš„æ•°é‡,ä¸º<code>Deployment</code>ã€<!-- raw HTML omitted --><code>ReplicaSet</code>æˆ–<!-- raw HTML omitted --><code>Replication</code> <code>Controller</code>è®¾ç½®æ–°çš„å¤§å°</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>autoscale</code></td>
<td>ç›‘æ§<code>CPU</code>ã€å†…å­˜è‡ªåŠ¨æ‰©å®¹ã€ç¼©å®¹</td>
<td>è‡ªåŠ¨è°ƒæ•´<code>Pod</code>çš„æ•°é‡ï¼Œè‡ªåŠ¨ç¼©æ”¾<code>Deployment</code>ã€<!-- raw HTML omitted --><code>ReplicaSet</code>ã€<code>StatefulSet</code>æˆ–<code>ReplicationController</code></td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>plugin</code></td>
<td>&mdash;</td>
<td>æä¾›ä¸æ’ä»¶äº¤äº’çš„å®ç”¨ç¨‹åº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>taint</code></td>
<td>æ±¡ç‚¹</td>
<td><code>taint</code>èŠ‚ç‚¹ä¸Šè®¾ç½®æ±¡ç‚¹</td>
</tr>
<tr>
<td><strong>ä¸­çº§å‘½ä»¤</strong></td>
<td><code>config</code></td>
<td>&mdash;</td>
<td>ä¿®æ”¹<code>kubeconfig</code>æ–‡ä»¶</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>é«˜çº§å‘½ä»¤</strong></th>
<th>å‘½ä»¤</th>
<th>ç¿»è¯‘</th>
<th>å‘½ä»¤ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>&mdash;</td>
<td><code>top</code></td>
<td></td>
<td>é¡¶éƒ¨æ˜¾ç¤ºèµ„æºï¼ˆ<code>CPU</code>/å†…å­˜ï¼‰ä½¿ç”¨æƒ…å†µ</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>auth</code></td>
<td></td>
<td>æ£€æŸ¥æˆæƒ</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>diff</code></td>
<td>å¯¹æ¯”</td>
<td>å¯¹æ¯”å®æ—¶ç‰ˆæœ¬ä¸å°†è¦åº”ç”¨çš„ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>wait</code></td>
<td>ç­‰å¾…</td>
<td>ç­‰å¾…å®éªŒï¼šç­‰å¾…ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºçš„ç‰¹å®šæ¡ä»¶</td>
</tr>
<tr>
<td></td>
<td><code>proxy</code></td>
<td>ä»£ç†</td>
<td>è¿è¡Œåˆ°<code>Kubernetes API</code>æœåŠ¡å™¨çš„ä»£ç†</td>
</tr>
<tr>
<td></td>
<td><code>cordon</code></td>
<td>è­¦æˆ’çº¿</td>
<td>è­¦æˆ’çº¿ å°†èŠ‚ç‚¹æ ‡è®°ä¸ºä¸å¯è°ƒåº¦</td>
</tr>
<tr>
<td></td>
<td><code>uncordon</code></td>
<td></td>
<td><code>uncordon</code>å°†èŠ‚ç‚¹æ ‡è®°ä¸ºå¯è°ƒåº¦</td>
</tr>
<tr>
<td></td>
<td><code>drain</code></td>
<td>æ’æ°´</td>
<td>æ’æ°´èŠ‚ç‚¹å‡†å¤‡ç»´æŠ¤</td>
</tr>
<tr>
<td></td>
<td><code>completion</code></td>
<td></td>
<td>å®Œæˆè¾“å‡ºæŒ‡å®š<code>shell</code>çš„<code>shell</code>å®Œæˆä»£ç ï¼ˆ<code>bash</code>æˆ–<code>zsh</code>ï¼‰</td>
</tr>
<tr>
<td></td>
<td><code>certificate</code></td>
<td>è¯ä¹¦</td>
<td>ä¿®æ”¹è¯ä¹¦èµ„æº</td>
</tr>
<tr>
<td></td>
<td><code>cluster-info</code></td>
<td>é›†ç¾¤ä¿¡æ¯</td>
<td>æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯</td>
</tr>
<tr>
<td></td>
<td><code>port-forward</code></td>
<td>è½¬å‘</td>
<td>å°†ä¸€ä¸ªæˆ–å¤šä¸ªæœ¬åœ°ç«¯å£è½¬å‘åˆ°ä¸€ä¸ª<code>pod</code></td>
</tr>
<tr>
<td></td>
<td><code>debug</code></td>
<td>è°ƒè¯•</td>
<td>åˆ›å»ºè°ƒè¯•ä¼šè¯ä»¥å¯¹å·¥ä½œè´Ÿè½½å’ŒèŠ‚ç‚¹è¿›è¡Œæ•…éšœæ’é™¤</td>
</tr>
<tr>
<td><strong>é«˜çº§å‘½ä»¤</strong></td>
<td><code>kustomize</code></td>
<td></td>
<td>ä»ç›®å½•æˆ–<code>URL</code>æ„å»ºä¸€ä¸ª<code>kustomization</code>ç›®æ ‡</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>å“æ§çº§åˆ«(Track)</th>
<th>æ—¥æœŸã€æ—¶é—´</th>
<th>&mdash;</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¯å¤©</td>
<td><code>daily</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td>æ¯å‘¨</td>
<td><code>weekly</code></td>
<td>&mdash;</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="span-idå¸¸ç”¨å‘½ä»¤å¸¸ç”¨å‘½ä»¤åˆ›å»ºåˆ é™¤span"><!-- raw HTML omitted -->å¸¸ç”¨å‘½ä»¤ï¼šåˆ›å»ºã€åˆ é™¤<!-- raw HTML omitted --></h3>
<blockquote>
<ul>
<li><code>kubectl --help</code><!-- raw HTML omitted -->ï¼šå¯ä»¥é€šè¿‡<code>--help</code>æŸ¥çœ‹è¯¦ç»†çš„æ“ä½œå‘½ä»¤<!-- raw HTML omitted --></li>
<li><code>kubectl</code><!-- raw HTML omitted -->å‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹<!-- raw HTML omitted --><code>$ kubectl [command] [type] [name] [flags]</code></li>
</ul>
<blockquote>
<ul>
<li><code>command</code>:	<!-- raw HTML omitted -->æŒ‡å®šè¦å¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œï¼Œæ¯”å¦‚ï¼š<!-- raw HTML omitted --><code>create</code>ã€<code>get</code>ã€<code>delete</code></li>
<li><code>type</code>ï¼š<!-- raw HTML omitted -->æŒ‡å®šèµ„æºçš„ç±»å‹ï¼Œæ¯”å¦‚ï¼š<!-- raw HTML omitted --><code>deployment</code>ã€<code>pod</code>ã€<code>service</code></li>
<li><code>name</code>ï¼š <!-- raw HTML omitted -->æŒ‡å®šèµ„æºçš„åç§°ï¼Œåç§°å¤§å°å†™æ•æ„Ÿ <!-- raw HTML omitted --></li>
<li><code>flags</code>ï¼š <!-- raw HTML omitted -->æŒ‡å®šé¢å¤–çš„å¯é€‰å‚æ•°<!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>
<ol>
<li><code>kubectl run --help</code><!-- raw HTML omitted -->ï¼šå‘½ä»¤ä½¿ç”¨é•œåƒåˆ›å»ºå®¹å™¨ <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl run nginx --image<span style="color:#f92672">=</span>nginx:1.17.1 -n web</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>kubectl get --help</code><!-- raw HTML omitted -->ï¼šè·å–èµ„æºï¼Œé€‰æ‹©è¾“å‡ºçš„æ ¼å¼<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>3.1 <!-- raw HTML omitted --><code>-o wide</code><!-- raw HTML omitted --></li>
<li>3.2 <!-- raw HTML omitted --><code>-o json</code><!-- raw HTML omitted --></li>
<li>3.3 <!-- raw HTML omitted --><code>-o yaml</code><!-- raw HTML omitted --></li>
<li>3.4 <code>Service</code><!-- raw HTML omitted -->å¯ä»¥çœ‹åšæ˜¯ä¸€ç»„åŒç±»çš„<code>Pod</code>å¯¹å¤–çš„è®¿é—®æ¥å£ï¼Œå€ŸåŠ©<code>Service</code>ï¼Œåº”ç”¨å¯ä»¥æ–¹ä¾¿çš„å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get csr  	<span style="color:#75715e"># æŸ¥çœ‹ç”³è¯·åŠ å…¥kubernetesé›†ç¾¤çš„tokenä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl get endpoints  	<span style="color:#75715e"># è·å–serviceå¯¹åº”çš„æ‰€æœ‰podçš„è®¿é—®åœ°å€</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl get all --namespace<span style="color:#f92672">=</span>kube-system  	<span style="color:#75715e"># æŸ¥çœ‹æ‰€æœ‰namespaceä¸‹æ‰€æœ‰èµ„æº</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl get pods -n web -o wide -w  	<span style="color:#75715e"># æŸ¥çœ‹namespace webä¸‹çš„podï¼Œ-o wide:æŸ¥çœ‹æ›´å¤šä¿¡æ¯ï¼Œ-wï¼šåŠ¨æ€æŸ¥çœ‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨kubectl getå‘½ä»¤å¯¼å‡ºyamlæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ kubectl get pod coredns-558bd4d5db-9h55s  -n kube-system -o yaml &gt; /tmp/coredns-558bd4d5db-9h55s.yaml</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>kubectl set --help</code><!-- raw HTML omitted -->æ›´æ–°é•œåƒã€è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„ç‰¹å®šç‰¹å¾<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl set image deployment/web nginx<span style="color:#f92672">=</span>nginx1.15</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>kubectl create --help</code><!-- raw HTML omitted -->ï¼šåˆ›å»ºå‘½ä»¤ç”¨äºåˆ›å»ºèµ„æº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶è¯¦è§£ã€ä½¿ç”¨<!-- raw HTML omitted --><code>kubectl create</code><!-- raw HTML omitted -->å‘½ä»¤ç”Ÿæˆ<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>deployment</code><!-- raw HTML omitted -->ï¼šæ— çŠ¶æ€åº”ç”¨éƒ¨ç½²<!-- raw HTML omitted --></li>
<li><code>java-demo</code><!-- raw HTML omitted -->ï¼šè‡ªå®šä¹‰åç§°<!-- raw HTML omitted --></li>
<li><code> --image</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨é•œåƒ<!-- raw HTML omitted --></li>
<li><code> --dry-run</code><!-- raw HTML omitted -->ï¼šæµ‹è¯•<!-- raw HTML omitted --></li>
<li><code>-o</code><!-- raw HTML omitted -->ï¼šè¾“å‡º<!-- raw HTML omitted --></li>
<li><code>&gt;/tmp/deploy.yaml</code><!-- raw HTML omitted -->ï¼šå®šå‘è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œä¸åŠ <!-- raw HTML omitted --><code>&gt;/tmp/deploy.yaml</code><!-- raw HTML omitted --> è¾“å‡ºåˆ°å±å¹•æŸ¥çœ‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºä¸€ä¸ªnamespaceå‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>$ kubectl create namespace dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create deployment java-demo --image<span style="color:#f92672">=</span>192.168.80.210:8080/test/tomcat-demo:v1 --dry-run<span style="color:#f92672">=</span>client -o yaml &gt;/tmp/deploy.yaml  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create service clusterip ngx-dep --tcp<span style="color:#f92672">=</span>80:80  <span style="color:#75715e"># å‘½ä»¤è¡Œåˆ›å»ºservice</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create -f  ns-dev.yaml    <span style="color:#75715e"># æ ¹æ®yamlæ–‡ä»¶åˆ›å»ºèµ„æº</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>kubectl edit --help</code><!-- raw HTML omitted -->ï¼š<code>cm</code>ï¼šç¼–è¾‘<!-- raw HTML omitted --><code>configMap</code><!-- raw HTML omitted -->ä¸­çš„é…ç½®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹serviceä¸­çš„æœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ kubectl edit service/ingress-nginx-controller-admission -n ingress-nginx 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl edit cm kube-proxy -n kube-system <span style="color:#75715e"># ä¿®æ”¹ipvs(å¿…é¡»å®‰è£…ipvså†…æ ¸æ¨¡å—ï¼Œå¦åˆ™ä¼šé™çº§ä¸ºiptables) ä¿®æ”¹ï¼šmode: &#34;ipvs&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><code>kubectl patch --help</code><!-- raw HTML omitted -->ï¼šè¡¥ä¸ä¿®æ”¹ã€æ›´æ–°èµ„æºçš„å­—æ®µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl patch pod rc-nginx-2-kpiqt -p <span style="color:#e6db74">&#39;{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx-3&#34;}}}&#39;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><code>kubectl apply --help</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¦‚æœèµ„æºä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºï¼Œç›¸å½“äº<!-- raw HTML omitted --><code>kubectl create</code></li>
<li><!-- raw HTML omitted -->å¦‚æœèµ„æºå­˜åœ¨ï¼Œå°±æ›´æ–°ï¼Œç›¸å½“äº<!-- raw HTML omitted --><code>kubectl patch</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¿è¡Œæ„å»ºå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f ./  	<span style="color:#75715e"># åº”ç”¨å½“å‰ç›®å½•ä¸‹æ‰€æœ‰yamlæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f deploy.yaml  	<span style="color:#75715e"># K8Sé»˜è®¤æ‹‰å»GitHubä¸Šé•œåƒ</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f nginx-pod.yaml -n web --record</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="8">
<li><code>kubectl replace --help</code><!-- raw HTML omitted -->ï¼šæ ¹æ®<code>yaml</code>æ–‡ä»¶æ›´æ–°ä¿®æ”¹åé…ç½®èµ„æºï¼Œä¼šåœæ‰åŸæ¥çš„èµ„æºï¼Œé‡æ–°åˆ›å»º<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl replace -f rc-nginx.yaml  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="9">
<li><code>kubectl delete --help</code><!-- raw HTML omitted -->ï¼šåˆ é™¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://aws.amazon.com/cn/premiumsupport/knowledge-center/eks-terminated-namespaces/" rel="external" target="_self">åˆ é™¤<code>Terminating</code>(æ­£åœ¨ç»ˆæ­¢)çŠ¶æ€å‘½åç©ºé—´</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl delete svc/web
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl delete -f  deployment-nginx.yaml   <span style="color:#75715e">#åˆ é™¤è¯¥yamlä¸­åˆ›å»ºçš„èµ„æº</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl delete pod nginx-deployment-798444d598-87hlk -n web  <span style="color:#75715e">#åˆ é™¤podèµ„æº  </span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="10">
<li><code>kubectl api-resources --help</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl api-resources  	<span style="color:#75715e"># æŸ¥çœ‹k8sæ‰€æœ‰çš„èµ„æºä»¥åŠå¯¹åº”çš„apiversion</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl api-versions  	<span style="color:#75715e"># æŸ¥çœ‹k8sæ‰€æœ‰ ç‰ˆæœ¬å· </span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="span-idä¸­çº§å‘½ä»¤ä¸­çº§å‘½ä»¤è¿è¡Œè°ƒè¯•span"><!-- raw HTML omitted -->ä¸­çº§å‘½ä»¤ï¼šè¿è¡Œã€è°ƒè¯•<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><code>kubectl exec --help</code><!-- raw HTML omitted -->è¿›å…¥å®¹å™¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl exec -it nginx-deployment-798444d598-87hlk  -n web -- /bin/sh
</span></span><span style="display:flex;"><span>$ kubectl exec my-pod -it -- ls /opt/  	<span style="color:#75715e"># åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼ˆåªæœ‰ä¸€ä¸ªå®¹å™¨çš„æƒ…å†µä¸‹ï¼‰</span>
</span></span><span style="display:flex;"><span>$ kubectl exec my-pod -c my-container -- ls /  	<span style="color:#75715e"># åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼ˆpodä¸­æœ‰å¤šä¸ªå®¹å™¨çš„æƒ…å†µä¸‹ï¼‰ </span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>kubectl label --help</code><!-- raw HTML omitted -->ï¼šæ›´æ–°èµ„æºä¸Šçš„æ ‡ç­¾<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>æ ‡ç­¾<code>Key</code></th>
<th><code>Values</code></th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>release</code>(å‘å¸ƒ)</td>
<td>ç‰ˆæœ¬ï¼š<code>stable</code>(ç¨³å®šç‰ˆ)ã€<code>canary</code>(é‡‘ä¸é›€ç‰ˆ)ã€<code>alpha</code>(å†…æµ‹)ã€<code>bate</code>(å…¬æµ‹)</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>environment</code>(ç¯å¢ƒ)</td>
<td>ç¯å¢ƒï¼š<code>dev</code>(å¼€å‘)ã€<code>qa/test</code>(æµ‹è¯•)ã€<code>gray</code>(ç°åº¦)ã€<code>production</code>(ç”Ÿäº§)ã€<code>op</code>(è¿ç»´)ã€<code>ui,as,pc,sc</code>(åº”ç”¨ç±»(<code>app</code>))</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>tier</code>(å±‚çº§)</td>
<td>å±‚çº§ï¼š<code>frontend</code>(å‰ç«¯)ã€<code>backend</code>(åç«¯)ã€<code>cache</code>(ç¼“å­˜)</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>partition</code>(åˆ†åŒº/æ¨¡å—)</td>
<td>åˆ†åŒº/æ¨¡å—ï¼š<code>customerA</code>(ä¸šåŠ¡A/å®¢æˆ·A)ã€<code>customerB</code>(ä¸šåŠ¡B/å®¢æˆ·B)</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>version</code>(ç‰ˆæœ¬å·)</td>
<td>ç‰ˆæœ¬å·ï¼š<code>v1.1ã€v1.2</code></td>
<td>&mdash;</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->ç»™èŠ‚ç‚¹<!-- raw HTML omitted --><code>Nodes</code><!-- raw HTML omitted -->æ‰“æ ‡ç­¾ã€åˆ é™¤æ ‡ç­¾<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ˜¾ç¤º Nodes æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>$ kubectl get node --show-labels
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç»™ Nodes èŠ‚ç‚¹æ‰“ä¸Šï¼Œåå­—ä¸ºï¼šdata çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>$ kubectl label nodes nodes_name data<span style="color:#f92672">=</span>labels_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤ Nodes ä¸Šï¼Œåå­—ä¸ºï¼šdata çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>$ kubectl label nodes nodes_name data-</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç»™èŠ‚ç‚¹<!-- raw HTML omitted --><code>Pods</code><!-- raw HTML omitted -->æ‰“æ ‡ç­¾ã€åˆ é™¤æ ‡ç­¾<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ˜¾ç¤ºå‘½åç©ºé—´ä¸ºï¼šweb ä¸‹ Pods çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>$ kubectl get pods --show-labels -n web -o wide
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸º Pods æ‰“ä¸Šï¼Œåå­—ä¸ºï¼šversion çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>$ kucectl label pods pods_name version<span style="color:#f92672">=</span>1.0 -n web
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¦†ç›–åŸæ¥çš„æ ‡ç­¾ï¼š--overwrite</span>
</span></span><span style="display:flex;"><span>$ kucectl label pods pods_name version<span style="color:#f92672">=</span>2.0 --overwrite -n web
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤ Pods ä¸Šï¼Œåå­—ä¸ºï¼šversion çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>$ kucectl label pods pods_name version- -n web</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>kubectl describe --help</code><!-- raw HTML omitted -->æ˜¾ç¤ºèµ„æºå†…éƒ¨ä¿¡æ¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl describe namespace kube-system
</span></span><span style="display:flex;"><span>Name:         kube-system
</span></span><span style="display:flex;"><span>Labels:       kubernetes.io/metadata.name<span style="color:#f92672">=</span>kube-system
</span></span><span style="display:flex;"><span>Annotations:  &lt;none&gt;
</span></span><span style="display:flex;"><span>Status:       Active  	<span style="color:#75715e"># è¡¨ç¤ºæ­£åœ¨ä½¿ç”¨ä¸­ï¼ŒTerminating:è¡¨ç¤ºæ­£åœ¨åˆ é™¤å‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>No resource quota.  	<span style="color:#75715e"># è¡¨ç¤ºï¼šé’ˆå¯¹å‘½åç©ºé—´åšçš„èµ„æºé™åˆ¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>No LimitRange resource.  	<span style="color:#75715e"># è¡¨ç¤ºï¼šé’ˆå¯¹å‘½åç©ºé—´ä¸­çš„æ¯ä¸ªç»„ä»¶åšçš„èµ„æºé™åˆ¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl describe  pods -n web nginx-pod  	<span style="color:#75715e"># æŸ¥çœ‹pod çš„è¯¦ç»†ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>$ kubectl describe service -n web nginx-svc  	<span style="color:#75715e"># æŸ¥çœ‹serviceçš„ è¯¦ç»†ä¿¡æ¯ </span>
</span></span><span style="display:flex;"><span>$ kubectl describe node 192.168.3.125  	<span style="color:#75715e"># æŸ¥çœ‹nodeçš„è¯¦ç»†ä¿¡æ¯</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>kubectl logs --help</code><!-- raw HTML omitted -->æ—¥å¿—æŸ¥çœ‹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl logs -n web nginx-deployment-798444d598-87hlk  	<span style="color:#75715e"># æŸ¥çœ‹podæ—¥å¿—</span>
</span></span><span style="display:flex;"><span>$ kubectl logs -f  nginx-deployment-798444d598-87hlk -n web  <span style="color:#75715e"># å®æ—¶æŸ¥çœ‹æ—¥å¿—</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl log  nginx-deployment-798444d598-87hlk -c &lt;container_name&gt; -n web  <span style="color:#75715e"># æŸ¥çœ‹podä¸­å•ä¸ªå®¹å™¨çš„æ—¥å¿—</span>
</span></span><span style="display:flex;"><span>$ kubectl logs -l app<span style="color:#f92672">=</span>frontend  -n web    <span style="color:#75715e"># è¿”å›å…¨éƒ¨æ ‡è®°ä¸º app=frontend çš„ pod çš„åˆå¹¶æ—¥å¿—</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>kubectl expose --help</code><!-- raw HTML omitted -->ç«¯å£æš´éœ²<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>expose</code><!-- raw HTML omitted -->ç«¯å£è®¾ç½®å›ºå®šé€‰é¡¹<!-- raw HTML omitted --></li>
<li><code> java-demo</code><!-- raw HTML omitted -->ï¼š è‡ªå®šä¹‰åç§°<!-- raw HTML omitted --></li>
<li><code>--port</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>çš„<code>Service</code>æœåŠ¡ç«¯å£ï¼Œé›†ç¾¤å†…éƒ¨äº’é€šç«¯å£<!-- raw HTML omitted --></li>
<li><code>--target-port</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>å®¹å™¨å†…æœåŠ¡ç«¯å£ç«¯å£<!-- raw HTML omitted --></li>
<li><code>--type</code><!-- raw HTML omitted -->ï¼šéšæœºç”Ÿæˆå¤–éƒ¨è®¿é—®ç«¯å£<!-- raw HTML omitted --></li>
<li><code>&gt;java-demo-svc.yaml</code><!-- raw HTML omitted -->ï¼šå®šå‘è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œä¸åŠ <!-- raw HTML omitted --><code>&gt;java-demo-svc.yaml</code><!-- raw HTML omitted -->è¾“å‡ºåˆ°å±å¹•æŸ¥çœ‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl expose --help
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl expose deployment java-demo --port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span> --target-port<span style="color:#f92672">=</span><span style="color:#ae81ff">8080</span> --type<span style="color:#f92672">=</span>NodePort --dry-run<span style="color:#f92672">=</span>client -o yaml &gt;java-demo-svc.yaml  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f java-demo-svc.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯¹å¤–å‘å¸ƒå…è®¸å¤–ç½‘è®¿é—®</span>
</span></span><span style="display:flex;"><span>$ kubectl expose deployment web --port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span> --type<span style="color:#f92672">=</span>NodePort --target-port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span> --name<span style="color:#f92672">=</span>web
</span></span><span style="display:flex;"><span>$ kubectl get service
</span></span><span style="display:flex;"><span>$ kubectl get deploy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># PORT(S):80(é›†ç¾¤å†…éƒ¨äº’é€šç«¯å£)ã€30040/TCP(å¤–éƒ¨è®¿é—®ç«¯å£)</span>
</span></span><span style="display:flex;"><span>$ kubectl get pods,svc
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod/java-demo-56d54df448-2m8kr   1/1     Running   <span style="color:#ae81ff">0</span>          68m
</span></span><span style="display:flex;"><span>pod/java-demo-56d54df448-9k5dn   1/1     Running   <span style="color:#ae81ff">0</span>          68m
</span></span><span style="display:flex;"><span>pod/java-demo-56d54df448-wvqkf   1/1     Running   <span style="color:#ae81ff">0</span>          68m
</span></span><span style="display:flex;"><span>pod/nginx-6799fc88d8-5sxfn       1/1     Running   <span style="color:#ae81ff">0</span>          3h4m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>        AGE
</span></span><span style="display:flex;"><span>service/java-demo    NodePort    10.103.37.12   &lt;none&gt;        80:30040/TCP   105s
</span></span><span style="display:flex;"><span>service/kubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP        4h35m
</span></span><span style="display:flex;"><span>service/nginx        NodePort    10.106.61.55   &lt;none&gt;        80:31750/TCP   3h4m</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><code>kubectl explain --help</code><!-- raw HTML omitted -->ï¼šå±•ç¤ºèµ„æºä½¿ç”¨æ–‡æ¡£<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain pod.kind.replicasets <span style="color:#75715e"># æŸ¥çœ‹æŸç§èµ„æºå¯ä»¥é…ç½®çš„ä¸€çº§é…ç½®å¦‚ï¼špodã€deployment</span>
</span></span><span style="display:flex;"><span>$ kubectl explain pod.metadata       <span style="color:#75715e"># æŸ¥çœ‹èµ„æºçš„å­å±æ€§ï¼Œèµ„æºç±»å‹ï¼špodã€å±æ€§ï¼šmetadata</span>
</span></span><span style="display:flex;"><span>$ kubectl explain pod.spec 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nodes</span>
</span></span><span style="display:flex;"><span>$ kubectl explain pod.spec.nodeName.containers
</span></span><span style="display:flex;"><span>$ kubectl explain pod.spec.nodeSelector.containers</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><code>kubectl rollout --help</code><!-- raw HTML omitted -->ï¼šç®¡ç†èµ„æº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>status</code><!-- raw HTML omitted -->ï¼šæ˜¾ç¤ºå½“å‰å‡çº§çŠ¶æ€<!-- raw HTML omitted --></li>
<li><code>history</code><!-- raw HTML omitted -->ï¼šæ˜¾ç¤ºå‡çº§å†å²è®°å½•<!-- raw HTML omitted --></li>
<li><code>pause</code><!-- raw HTML omitted -->ï¼šæš‚åœç‰ˆæœ¬å‡çº§è¿‡ç¨‹<!-- raw HTML omitted --></li>
<li><code>resume</code><!-- raw HTML omitted -->ï¼šç»§ç»­å·²ç»æš‚åœçš„ç‰ˆæœ¬å‡çº§è¿‡ç¨‹<!-- raw HTML omitted --></li>
<li><code>restart</code><!-- raw HTML omitted -->ï¼šé‡å¯ç‰ˆæœ¬å‡çº§è¿‡ç¨‹<!-- raw HTML omitted --></li>
<li><code>undo</code><!-- raw HTML omitted -->ï¼šå›æ»šåˆ°ä¸Šä¸€çº§ç‰ˆæœ¬(å¯ä»¥ä½¿ç”¨<!-- raw HTML omitted --><code>--to-revision</code><!-- raw HTML omitted -->ï¼ŒæŒ‡å®šç‰ˆæœ¬)<!-- raw HTML omitted --></li>
<li><code>--record</code><!-- raw HTML omitted -->ï¼šè®°å½•<!-- raw HTML omitted --><code>CHANGE-CAUSE</code><!-- raw HTML omitted -->(æ”¹å˜åŸå› )æ“ä½œè®°å½•,ä¾¿äºå›æ»š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ–°å‘å¸ƒ</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f nginx-deployment.yml --record  <span style="color:#75715e"># --recordï¼Œè®°å½•æ“ä½œè®°å½•,ä¾¿äºå›æ»š</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pause æš‚å®šæ›´æ–°å‘å¸ƒ</span>
</span></span><span style="display:flex;"><span>$ kubectl rollout pause deployment nginx-deployment -n app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># resume ç»§ç»­æ›´æ–°å‘å¸ƒ</span>
</span></span><span style="display:flex;"><span>$ kubectl rollout resume deployment nginx-deployment -n app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å‡çº§çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>$ kubectl rollout status deployment/nginx-deployment
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å‡çº§å†å²ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ kubectl rollout history deployment/web
</span></span><span style="display:flex;"><span>$ kubectl rollout history deployment -n app
</span></span><span style="display:flex;"><span>$ kubectl rollout history deployment/web --revision<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># æŸ¥çœ‹æŸä¸ªæ›´æ–°å…·ä½“å†…å®¹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å›æ»š</span>
</span></span><span style="display:flex;"><span>$ kubectl rollout undo deployment/web --revision<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>$ kubectl rollout undo deployment/nginx-deployment --to-revision<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> -n app <span style="color:#75715e"># ç‰ˆæœ¬å›æ»šåˆ°v1</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="8">
<li><code>kubectl scale --help</code><!-- raw HTML omitted -->ï¼šæ‰‹åŠ¨æ‰©ç¼©å®¹<code>Pod</code>æ•°é‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>--replicas</code><!-- raw HTML omitted -->ï¼šå‚æ•°å®šä¹‰<code>Pod</code>æ•°é‡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl scale rc redis --replicas<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> -n web  	<span style="color:#75715e"># æ“ä½œpod çš„æ‰©å®¹å’Œç¼©å®¹</span>
</span></span><span style="display:flex;"><span>$ kubectl scale --replicas<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> -f redis-slave-deployment.yaml</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="9">
<li><code>kubectl autoscale --help</code><!-- raw HTML omitted -->ï¼šç›‘æ§<code>CPU</code>ä½¿ç”¨ç™¾åˆ†æ¯”è‡ªåŠ¨æ‰©ç¼©<code>Pod</code>æ•°é‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>deployment</code><!-- raw HTML omitted -->ï¼šç±»å‹æ§åˆ¶å™¨<!-- raw HTML omitted --></li>
<li><code>deployment-name</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>çš„åç§°<!-- raw HTML omitted --></li>
<li><code>--cpu-percent</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨<code>CPU</code>ç™¾åˆ†æ¯”<!-- raw HTML omitted --></li>
<li><code>--min</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>æœ€å°‘æ•°é‡<!-- raw HTML omitted --></li>
<li><code>--max</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>æœ€å¤šæ•°é‡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl autoscale deployment deployment-name --cpu-percent<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span> --min<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> --max<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="10">
<li><code>kubectl taint --help</code><!-- raw HTML omitted -->ï¼šæ±¡ç‚¹é…ç½®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹èŠ‚ç‚¹ä¸Šçš„æ±¡ç‚¹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl describe nodes k8s-node1 | grep Taints</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è®¾ç½®æ±¡ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>tag=webapps</code>ã€<code>tag</code><!-- raw HTML omitted -->ï¼šæ±¡ç‚¹åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œä¾<!-- raw HTML omitted --><code>Key=value</code></li>
<li><code>NoSchedule</code><!-- raw HTML omitted -->ï¼šå½±å“ï¼Œä¸ä¼šè°ƒåº¦åˆ°æ­¤èŠ‚ç‚¹<!-- raw HTML omitted --></li>
<li><code>NoExecute</code><!-- raw HTML omitted -->ï¼šé©±é™¤ï¼ŒæŠŠæ­¤èŠ‚ç‚¹ä¸Šçš„<code>Pods</code>é©±é™¤åˆ°å…¶ä»–èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl taint node k8s-node1 tag<span style="color:#f92672">=</span>webapps:NoSchedule</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å»é™¤æ±¡ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>-</code><!-- raw HTML omitted -->ï¼šæ±¡ç‚¹åç§°åé¢è·Ÿ<!-- raw HTML omitted --><!-- raw HTML omitted -->å‡å·<!-- raw HTML omitted --><!-- raw HTML omitted -->å°±æ˜¯å»é™¤æ±¡ç‚¹æ„æ€<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl taint node k8s-master-01 node-role.kubernetes.io/control-plane:NoSchedule-
</span></span><span style="display:flex;"><span>node/k8s-master-01 untainted  	<span style="color:#75715e"># è¿”å›ç»“æœ æ±¡ç‚¹å·²å»é™¤</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å»é™¤ä»¥ tag ä¸ºåè®¾ç½®çš„æ‰€æœ‰æ±¡ç‚¹</span>
</span></span><span style="display:flex;"><span>$ kubectl taint node k8s-node1 tag-</span></span></code></pre></div></blockquote>
<hr>
<h3 id="span-idé«˜çº§å‘½ä»¤é«˜çº§å‘½ä»¤ç®¡ç†æ’æŸ¥span"><!-- raw HTML omitted -->é«˜çº§å‘½ä»¤ï¼šç®¡ç†ã€æ’æŸ¥<!-- raw HTML omitted --></h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/kubernetes-sigs/metrics-server" rel="external" target="_self"><code>Kubernetes</code>æŒ‡æ ‡æœåŠ¡å™¨</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/cai11745/hybrid-cloud/blob/master/prometheus/2019-10-22-prometheus-1-install-and-metricsIngress.md" rel="external" target="_self">å®‰è£…<code>Prometheus</code>ç›‘æ§æœåŠ¡å™¨èµ„æº</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><code>kubectl top --help</code><!-- raw HTML omitted -->ï¼šç›‘æ§é›†ç¾¤å†…å­˜<code>CPU</code>æŒ‡æ ‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>metrics-server</code><!-- raw HTML omitted -->å¯ä»¥ç”¨æ¥æ”¶é›†é›†ç¾¤ä¸­çš„èµ„æºä½¿ç”¨æƒ…å†µã€éœ€è¦å•ç‹¬å®‰è£…<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æ–°å¢å‚æ•°ï¼š<!-- raw HTML omitted --><code>hostNetwork: true</code><!-- raw HTML omitted -->ï¼Œç”¨äºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å›½å†…ä¿®æ”¹ä¸ºé˜¿é‡Œäº‘åœ°å€ï¼š<!-- raw HTML omitted --><code>image: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6</code></li>
<li><!-- raw HTML omitted -->æ–°å¢å‚æ•°ï¼š<!-- raw HTML omitted --><code>- --kubelet-insecure-tls</code>ï¼Œä¸éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä»…ç”¨äºæµ‹è¯•ç›®çš„ï¼Œ<code>kubelet</code>çš„<code>10250</code>ç«¯å£ä½¿ç”¨çš„æ˜¯<code>https</code>åè®®ï¼Œè¿æ¥éœ€è¦éªŒè¯<code>tls</code>è¯ä¹¦</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml -O metrics-server.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›¿æ¢ä¸ºé˜¿é‡Œäº‘é•œåƒåœ°å€</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/k8s.io\/metrics-server/cn-hangzhou.aliyuncs.com\/google_containers/g&#39;</span> metrics-server.yaml</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>metrics-server.yaml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">k8s-app</span>: <span style="color:#ae81ff">metrics-server</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">metrics-server</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kube-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">k8s-app</span>: <span style="color:#ae81ff">metrics-server</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">k8s-app</span>: <span style="color:#ae81ff">metrics-server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">hostNetwork</span>: <span style="color:#66d9ef">true</span>   <span style="color:#75715e"># æ–°å¢å‚æ•°ï¼Œä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">args</span>:
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">cert-dir=/tmp</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">secure-port=4443</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">kubelet-use-node-status-port</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">metric-resolution=15s</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">kubelet-insecure-tls   </span> <span style="color:#75715e"># æ–°å¢å‚æ•°ï¼Œä¸æ ¡éªŒhttpsåè®®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server:v0.6.4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl apply -f metrics-server.yaml
</span></span><span style="display:flex;"><span>$ kubectl top node  --use-protocol-buffers
</span></span><span style="display:flex;"><span>$ kubectl top  pod/node  -n dev </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>kubectl port-forward --help</code><!-- raw HTML omitted -->è½¬å‘<code>Pod</code>ä¸­ç«¯å£<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl port-forward my-pod 5000:6000  	<span style="color:#75715e"># è½¬å‘podä¸­çš„6000ç«¯å£åˆ°æœ¬åœ°çš„ 5000 ç«¯å£</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ•…éšœæ’æŸ¥è§£å†³">æ•…éšœæ’æŸ¥ã€è§£å†³</h3>
<h5 id="nodesfont-colorredèŠ‚ç‚¹æ˜¾ç¤ºfontnotreadyfont-colorredæ˜¯èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œä¸é€šå¯¼è‡´font"><code>nodes</code><!-- raw HTML omitted -->èŠ‚ç‚¹æ˜¾ç¤º<!-- raw HTML omitted --><code>NotReady</code><!-- raw HTML omitted -->æ˜¯èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œä¸é€šå¯¼è‡´<!-- raw HTML omitted --></h5>
<blockquote>
<p><a href="#R-image-7e16504736d34795772f4bb7bc7d6736" class="lightbox-link"><img alt="get-nodes" class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407170459496.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7e16504736d34795772f4bb7bc7d6736"><img alt="get-nodes" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407170459496.png"></a></p>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get cs
</span></span><span style="display:flex;"><span>$ kubectl cluster-info
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨é•œåƒæµ‹è¯•å®¹å™¨å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ kubectl run -it --image busybox:1.28.4 container-name --restart<span style="color:#f92672">=</span>Never --rm /bin/sh
</span></span><span style="display:flex;"><span>$ ping pod-name.server-name</span></span></code></pre></div><p><a href="#R-image-9d327c689f82e1146b9495be71fd8ade" class="lightbox-link"><img alt="get-sc" class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407170643950.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9d327c689f82e1146b9495be71fd8ade"><img alt="get-sc" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407170643950.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å…ˆå¤„ç†ç½‘ç»œã€åå¤„ç†é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim  /etc/kubernetes/manifests/kube-controller-manager.yaml ï¼ˆæ³¨é‡Šæ‰ - --port<span style="color:#f92672">=</span>0ï¼‰
</span></span><span style="display:flex;"><span>$ vim  /etc/kubernetes/manifests/kube-scheduler.yaml          ï¼ˆæ³¨é‡Šæ‰ - --port<span style="color:#f92672">=</span>0ï¼‰
</span></span><span style="display:flex;"><span>$ systemctl start kubelet </span></span></code></pre></div><ul>
<li>2.1 <!-- raw HTML omitted -->å†æ¬¡æŸ¥çœ‹ï¼ŒèŠ‚ç‚¹æ­£å¸¸æ˜¾ç¤ºï¼šÂ <!-- raw HTML omitted --><code>Ready</code></li>
</ul>
<p><a href="#R-image-7c88d02065d5054b916ddb7aa72c3910" class="lightbox-link"><img alt="get-cs-2" class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407170817379.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7c88d02065d5054b916ddb7aa72c3910"><img alt="get-cs-2" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407170817379.png"></a></p>
<p><a href="#R-image-e79b5259d3e09e50a121f0c99d622c5e" class="lightbox-link"><img alt="get-nodes-2" class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407171343144.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e79b5259d3e09e50a121f0c99d622c5e"><img alt="get-nodes-2" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407171343144.png"></a></p>
</blockquote>
<hr>
<h5 id="é‡ç½®kubernetesé›†ç¾¤">é‡ç½®<code>Kubernetes</code>é›†ç¾¤</h5>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åœ¨masterã€nodeèŠ‚ç‚¹éƒ½æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ kubeadm reset 
</span></span><span style="display:flex;"><span>$ rm -rf /etc/cni/net.d
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨masterä¸Šæ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>$ kubeadm init --kubernetes-version<span style="color:#f92672">=</span>1.19.0 --apiserver-advertise-address<span style="color:#f92672">=</span>192.168.3.124 --service-cidr<span style="color:#f92672">=</span>10.64.0.0/24 --pod-network-cidr<span style="color:#f92672">=</span>10.244.0.0/16
</span></span><span style="display:flex;"><span>$ mkdir -p $HOME/.kube
</span></span><span style="display:flex;"><span>$ cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style="display:flex;"><span>$ chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config
</span></span><span style="display:flex;"><span>$ vim /etc/kubernetes/manifests/kube-controller-manager.yaml ï¼ˆæ³¨é‡Šæ‰ - --port<span style="color:#f92672">=</span>0ï¼‰
</span></span><span style="display:flex;"><span>$ vim /etc/kubernetes/manifests/kube-scheduler.yaml          ï¼ˆæ³¨é‡Šæ‰ - --port<span style="color:#f92672">=</span>0ï¼‰
</span></span><span style="display:flex;"><span>$ systemctl start kubelet 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨nodeèŠ‚ç‚¹æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>$ kubeadm reset
</span></span><span style="display:flex;"><span>$ kubeadm join 192.168.3.124:6443 --token f62e1g.exfdrr8bg2fxpdmu <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--discovery-token-ca-cert-hash sha256:7e4762cccce2e8306b6635cbc2091eae34bbf33577276413521a343c49fc026a</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_kubernetes">Install_Kubernetes</h1>

<h1 id="éƒ¨ç½²kubernetes">éƒ¨ç½²<code>Kubernetes</code></h1>
<blockquote>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li>
<p><code>Etcd</code><!-- raw HTML omitted -->ï¼šè´Ÿè´£å­˜å‚¨é›†ç¾¤ä¸­å„ç§èµ„æºå¯¹è±¡çš„ä¿¡æ¯<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Kubelet</code><!-- raw HTML omitted -->ï¼šè´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³é€šè¿‡æ§åˆ¶<!-- raw HTML omitted --><code>Docker</code><!-- raw HTML omitted -->ï¼Œæ¥åˆ›å»ºã€æ›´æ–°ã€é”€æ¯å®¹å™¨<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>KubeProxy</code><!-- raw HTML omitted -->ï¼šè´Ÿè´£æä¾›é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Docker</code><!-- raw HTML omitted -->ï¼šè´Ÿè´£èŠ‚ç‚¹ä¸Šå®¹å™¨çš„å„ç§æ“ä½œ<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Scheduler</code><!-- raw HTML omitted -->ï¼šè´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†<code>Pod</code>è°ƒåº¦åˆ°ç›¸åº”çš„<code>node</code>èŠ‚ç‚¹ä¸Š<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>API Server</code><!-- raw HTML omitted -->ï¼šé›†ç¾¤æ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæä¾›è®¤è¯ã€æˆæƒã€<code>API</code>æ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>ControllerManager</code><!-- raw HTML omitted -->ï¼šè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚ç¨‹åºéƒ¨ç½²å®‰æ’ã€æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•å’Œæ»šåŠ¨æ›´æ–°ç­‰<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Core DNS</code><!-- raw HTML omitted -->ï¼šå¯ä»¥ä¸ºé›†ç¾¤ä¸­çš„<code>SVC</code>åˆ›å»ºä¸€ä¸ªåŸŸå<code>IP</code>çš„å¯¹åº”å…³ç³»è§£æ<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Dashboard</code><!-- raw HTML omitted -->ï¼šç»™<code>K8S</code>é›†ç¾¤æä¾›ä¸€ä¸ª<code>B/S</code>ç»“æ„çš„ä½“ç³»è®¿é—®<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Ingress Controller</code><!-- raw HTML omitted -->ï¼šå®˜æ–¹åªèƒ½å®ç°å››å±‚ä»£ç†ï¼Œ<code>Ingress</code>å¯ä»¥å®ç°ä¸ƒå±‚ä»£ç†<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Fedetation</code><!-- raw HTML omitted -->ï¼šæä¾›ä¸€ä¸ªå¯ä»¥è·¨é›†ç¾¤ä¸­å¿ƒçš„å¤š<code>K8S</code>ç»Ÿä¸€ç®¡ç†åŠŸèƒ½<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Prometheus</code><!-- raw HTML omitted -->ï¼šæä¾›ä¸€ä¸ª<code>K8S</code>é›†ç¾¤ç›‘æ§èƒ½åŠ›<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>ELK</code><!-- raw HTML omitted -->ï¼šæä¾›<code>K8S</code>é›†ç¾¤æ—¥å¿—ç»Ÿä¸€åˆ†æä»‹å…¥å¹³å°<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>K8S</code>éƒ¨ç½²æ–¹å¼åˆ†ä¸º<!-- raw HTML omitted -->äºŒè¿›åˆ¶<!-- raw HTML omitted -->ä»¥åŠ<!-- raw HTML omitted -->å¿«é€Ÿéƒ¨ç½²<!-- raw HTML omitted -->æ–¹å¼ï¼Œå®˜æ–¹ç»™äºˆ<!-- raw HTML omitted -->ä¸‰ç§å¿«é€Ÿéƒ¨ç½²<!-- raw HTML omitted -->æ–¹å¼ï¼š<a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/" rel="external" target="_self">ä½¿ç”¨<code>kubeadm</code>å¼•å¯¼é›†ç¾¤</a>ã€<a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kops/" rel="external" target="_self">ä½¿ç”¨<code>Kops</code>å®‰è£…<code>Kubernetes</code></a>ã€<a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubespray/" rel="external" target="_self">ä½¿ç”¨<code>Kubespray</code>å®‰è£…<code>Kubernetes</code></a></p>
</li>
</ul>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/kubewharf" rel="external" target="_self"><code>KubeWharf</code>è½»é‡çº§å¤šç§Ÿæˆ·</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/kubernetes/perf-tests" rel="external" target="_self"><code>Kubernetes</code>æ€§èƒ½æµ‹è¯•</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://learnk8s.io/a/a-visual-guide-on-troubleshooting-kubernetes-deployments/troubleshooting-kubernetes.en_en.v3.pdf" rel="external" target="_self"><code>kubernetes</code>æ’é”™æ€ç»´</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://kubespray.io/#/docs/getting-started" rel="external" target="_self"><code>Ansible-playbook</code>ä½¿ç”¨<code>kubespray</code>å®‰è£…<code>K8S</code></a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<h2 id="æœåŠ¡å™¨ç«¯å£å‡†å¤‡">æœåŠ¡å™¨ã€ç«¯å£å‡†å¤‡</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->éƒ¨ç½²ä¸€ä¸»ä¸‰ä»<!-- raw HTML omitted --><code>kubernetes</code>æ¶æ„</li>
</ol>
</li>
</ul>
<blockquote>

<pre class="mermaid align-center zoomable">graph TD
F[ä¸€ä¸»å¤šä»] 
A{{K8S-Master}} ==&gt; B{{K8S-Nodes}}
A{{K8S-Master}} ==&gt; C{{K8S-Nodes}}
A{{K8S-Master}} ==&gt; D{{K8S-Nodes}}
Z[å¤šä¸»å¤šä»]
G{{K8S-Master}} ==&gt; J{{K8S-Nodes}}
G{{K8S-Master}} ==&gt; K{{K8S-Nodes}}
G{{K8S-Master}} ==&gt; L{{K8S-Nodes}}
H{{K8S-Master}} ==&gt; J{{K8S-Nodes}}
H{{K8S-Master}} ==&gt; K{{K8S-Nodes}}
H{{K8S-Master}} ==&gt; L{{K8S-Nodes}} </pre><table>
<thead>
<tr>
<th>è§’è‰²</th>
<th><code>IP</code>åœ°å€</th>
<th>é…ç½®</th>
<th>æ“ä½œç³»ç»Ÿ</th>
</tr>
</thead>
<tbody>
<tr>
<td>Master</td>
<td>192.168.35.128</td>
<td><code>2coreã€4Gã€80Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
<tr>
<td>node-1</td>
<td>192.168.35.129</td>
<td><code>2coreã€1Gã€60Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
<tr>
<td>node-2</td>
<td>192.168.35.130</td>
<td><code>2coreã€1Gã€60Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->é›†ç¾¤æ¶æ„<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>è§’è‰²</th>
<th><code>IP</code>åœ°å€</th>
<th>é…ç½®</th>
<th>æ“ä½œç³»ç»Ÿ</th>
</tr>
</thead>
<tbody>
<tr>
<td>Master-1</td>
<td>192.168.80.210</td>
<td><code>2coreã€4Gã€80Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
<tr>
<td>Master-2</td>
<td>192.168.80.211</td>
<td><code>2coreã€4Gã€80Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
<tr>
<td>node-1</td>
<td>192.168.80.212</td>
<td><code>2coreã€2Gã€60Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
<tr>
<td>node-2</td>
<td>192.168.80.213</td>
<td><code>2coreã€2Gã€60Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
<tr>
<td>node-3</td>
<td>192.168.80.215</td>
<td><code>2coreã€2Gã€60Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->æ§åˆ¶èŠ‚ç‚¹<!-- raw HTML omitted --><code>master</code>ï¼šé›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­–ï¼Œä»¥åŠéœ€è¦å¼€æ”¾çš„ç«¯å£</li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åè®®</th>
<th>æ–¹å‘</th>
<th>ç«¯å£èŒƒå›´</th>
<th>ä½œç”¨</th>
<th>ä½¿ç”¨è€…</th>
</tr>
</thead>
<tbody>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>6443</td>
<td><code>Kubernetes API</code> æœåŠ¡å™¨</td>
<td>æ‰€æœ‰ç»„ä»¶,ç®¡ç†å‘˜æ“ä½œ<code>Kubernetes</code>çš„æ¥å£ã€‚å› æ­¤ï¼Œ<code>API</code>æœåŠ¡å™¨é€šå¸¸æš´éœ²åœ¨æ§åˆ¶å¹³é¢ä¹‹å¤–ã€‚<code>API</code>æœåŠ¡å™¨è¢«è®¾è®¡æˆå¯æ‰©å±•çš„ï¼Œå¯èƒ½å­˜åœ¨äºå¤šä¸ªæ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸Š</td>
</tr>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>2379-2380</td>
<td><code>etcd</code>æœåŠ¡å™¨å®¢æˆ·ç«¯ <code>API</code></td>
<td><code>kube-apiserver, etcd</code>ï¼ŒæŒä¹…åŒ–çš„å¤‡ä»½å­˜å‚¨ï¼Œå…³äºé›†ç¾¤çŠ¶æ€çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¿å­˜åœ¨è¿™é‡Œã€‚<code>Etcd</code>ä¸åº”è¯¥è¢«ç›´æ¥æ“ä½œï¼Œè€Œåº”è¯¥é€šè¿‡ <code>API</code> æœåŠ¡å™¨æ¥ç®¡ç†ã€‚</td>
</tr>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>10250</td>
<td><code>Kubelet API</code></td>
<td><code>kubelet</code>è‡ªèº«ã€åœ¨æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œä»¥åè°ƒå’ŒéªŒè¯<code>Pod</code>çš„æ‰§è¡Œ</td>
</tr>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>10259</td>
<td><code>kube-scheduler</code></td>
<td><code>kube-scheduler</code>è‡ªèº«ï¼Œè·Ÿè¸ªå·¥ä½œèŠ‚ç‚¹çš„çŠ¶æ€å¹¶å†³å®šåœ¨å“ªé‡Œè¿è¡Œ Podã€‚<code>Kube-scheduler</code> åªå¯ä»¥ç”±æ§åˆ¶å¹³é¢å†…çš„èŠ‚ç‚¹è®¿é—®ã€‚</td>
</tr>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>10257</td>
<td><code>kube-controller-manager</code></td>
<td><code>kube-controller-manager</code>è‡ªèº«ï¼Œç›‘è§†<code>Kubernetes</code>é›†ç¾¤ï¼Œä»¥æ£€æµ‹å’Œç»´æŠ¤<code>Kubernetes</code>ç¯å¢ƒçš„å‡ ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬å°†<code>Pod</code>åŠ å…¥åˆ°æœåŠ¡ä¸­ï¼Œä¿æŒä¸€ç»„<code>Pod</code>çš„æ­£ç¡®æ•°é‡ï¼Œå¹¶å¯¹èŠ‚ç‚¹çš„ä¸¢å¤±åšå‡ºååº”</td>
</tr>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>10258</td>
<td><code>Cloud controller manager</code></td>
<td>ä¸€ä¸ªç”¨äºåŸºäºäº‘çš„éƒ¨ç½²çš„å¯é€‰ç»„ä»¶ã€‚äº‘æ§åˆ¶å™¨ä¸äº‘æœåŠ¡æä¾›å•†æ¥å£ï¼Œä»¥ç®¡ç†é›†ç¾¤çš„è´Ÿè½½å‡è¡¡å™¨å’Œè™šæ‹Ÿç½‘ç»œ</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å·¥ä½œèŠ‚ç‚¹<!-- raw HTML omitted --><code>node</code>ï¼šé›†ç¾¤çš„æ•°æ®å¹³é¢ï¼Œè´Ÿè´£ä¸ºå®¹å™¨æä¾›è¿è¡Œç¯å¢ƒ ï¼Œéœ€è¦å¼€æ”¾çš„ç«¯å£</li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åè®®</th>
<th>æ–¹å‘</th>
<th>ç«¯å£èŒƒå›´</th>
<th>ä½œç”¨</th>
<th>ä½¿ç”¨è€…</th>
</tr>
</thead>
<tbody>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>10250</td>
<td><code>Kubelet API</code></td>
<td><code>kubelet</code>è‡ªèº«ã€æ§åˆ¶å¹³é¢ç»„ä»¶</td>
</tr>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>30000-32767</td>
<td><code>NodePort</code>æœåŠ¡â€ </td>
<td>æ‰€æœ‰ç»„ä»¶</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="åˆå§‹åŒ–ç¯å¢ƒ">åˆå§‹åŒ–ç¯å¢ƒ</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è®¾ç½®ä¸‰å°ä¸»æœºå<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-master-128
</span></span><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-node-01-129
</span></span><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-node-02-130</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è®¾ç½®é›†ç¾¤çš„ä¸»æœºå<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-master-1-80-210
</span></span><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-master-2-80-211
</span></span><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-node-1-80-212
</span></span><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-node-2-80-213
</span></span><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-node-3-80-215</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ†åˆ«åœ¨ä¸‰å°æœåŠ¡å™¨åšæœ¬åœ°<!-- raw HTML omitted --><code>hosts</code><!-- raw HTML omitted -->è§£æ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;&gt;/etc/hosts<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.35.128 k8s-master-01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.35.129 k8s-node-01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.35.130 k8s-node-02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->äº”å°æœåŠ¡å™¨çš„é›†ç¾¤<!-- raw HTML omitted --><code>hosts</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;&gt;/etc/hosts<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.80.210 k8s-master-01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.80.211 k8s-master-02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.80.212 k8s-node-01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.80.213 k8s-node-02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.80.215 k8s-node-03
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.80.220 k8s-master-lb # VIP(è™šæ‹ŸIP)ç”¨äºLoadBalanceï¼Œå¦‚æœä¸æ˜¯é«˜å¯ç”¨é›†ç¾¤ï¼Œè¯¥IPå¯ä»¥æ˜¯k8s-master01çš„IP 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->è®¾ç½®æ—¶é—´åŒæ­¥ï¼Œä¿®æ”¹æ—¶åŒºä¸¤ç§æ–¹å¼<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>tzdata</code><!-- raw HTML omitted -->æ—¶åŒºè½¯ä»¶åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install tzdata 
</span></span><span style="display:flex;"><span>$ timedatectl set-timezone Asia/Shanghai</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¬¬ä¸€ç§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¬¬äºŒç§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl enable chronyd.service <span style="color:#f92672">&amp;&amp;</span> systemctl start chronyd.service</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å…³é—­é˜²ç«å¢™å¹¶ç¦æ­¢å¼€æœºè‡ªå¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl disable firewalld <span style="color:#f92672">&amp;&amp;</span> systemctl stop firewalld</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å…³é—­<!-- raw HTML omitted --><code>SElinux</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ setenforce <span style="color:#ae81ff">0</span>  	<span style="color:#75715e"># ä¸´æ—¶å…³é—­Selinux</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/^SELINUX=.*/SELINUX=disabled/&#39;</span> /etc/selinux/config  	<span style="color:#75715e"># æ°¸ä¹…å…³é—­Selinux</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->å…³é—­<!-- raw HTML omitted --><code>swap</code><!-- raw HTML omitted -->äº¤æ¢åˆ†åŒº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -ri <span style="color:#e6db74">&#39;s/.*swap.*/#&amp;/&#39;</span> /etc/fstab <span style="color:#f92672">&amp;&amp;</span> swapoff -a</span></span></code></pre></div><ul>
<li><code>Ubunt</code><!-- raw HTML omitted -->å…³é—­äº¤æ¢åˆ†åŒº<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;etc/fstab<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/dev/disk/by-uuid/95e38332-76fc-4d2f-81a4-04bc581f2ed3 none swap sw,noauto 0 0  	# æ·»åŠ ï¼šnoauto
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># /swap.img     none    swap    sw      0       0  	# æ·»åŠ æ³¨é‡Š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢éªŒè¯ï¼Œè¾“å‡ºä¸ºç©ºåˆ™ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>$ sudo swapon --show</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li>å…è®¸<code>iptables</code><!-- raw HTML omitted -->æ£€æŸ¥æ¡¥æ¥æµé‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç¡®ä¿<!-- raw HTML omitted --><code>br_netfilter</code><!-- raw HTML omitted -->æ¨¡å—è¢«åŠ è½½ã€‚è¿™ä¸€æ“ä½œå¯ä»¥é€šè¿‡è¿è¡Œ<!-- raw HTML omitted --><code>lsmod | grep br_netfilter</code><!-- raw HTML omitted -->æ¥å®Œæˆã€‚è‹¥è¦æ˜¾å¼åŠ è½½è¯¥æ¨¡å—ï¼Œå¯æ‰§è¡Œ<!-- raw HTML omitted --><code>modprobe br_netfilter</code></li>
<li><!-- raw HTML omitted -->ä¸ºäº†è®©ä½ çš„<!-- raw HTML omitted --><code>Linux</code><!-- raw HTML omitted -->èŠ‚ç‚¹ä¸Šçš„<!-- raw HTML omitted --><code>iptables</code><!-- raw HTML omitted -->èƒ½å¤Ÿæ­£ç¡®åœ°æŸ¥çœ‹æ¡¥æ¥æµé‡ï¼Œä½ éœ€è¦ç¡®ä¿åœ¨ä½ çš„<!-- raw HTML omitted --><code>sysctl</code><!-- raw HTML omitted -->é…ç½®ä¸­å°†<!-- raw HTML omitted --><code>net.bridge.bridge-nf-call-iptables</code><!-- raw HTML omitted -->è®¾ç½®ä¸º 1<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">br_netfilter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.ip_forward = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sysctl --system
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########################################################  ä½¿ç”¨è„šæœ¬å‡½æ•°</span>
</span></span><span style="display:flex;"><span>__k8s_kernel_iptables<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># åŠ è½½br_netfilteræ¨¡å—</span>
</span></span><span style="display:flex;"><span>    modprobe br_netfilter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æŸ¥çœ‹æ˜¯å¦åŠ è½½</span>
</span></span><span style="display:flex;"><span>    lsmod | grep br_netfilter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å†™å†…æ ¸é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    cat &gt;/etc/sysctl.d/k8s.conf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.ip_forward = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vm.swappiness = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å†…æ ¸å‚æ•°ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>    sysctl --system
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>__k8s_kernel_iptables</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="8">
<li><!-- raw HTML omitted -->å¼€å¯<!-- raw HTML omitted --><code>ipvs</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>åœ¨<code>kubernetes</code>ä¸­<code>service</code>æœ‰ä¸¤ç§ä»£ç†æ¨¡å‹ï¼Œä¸€ç§æ˜¯åŸºäº<code>iptables</code>ï¼Œå¦ä¸€ç§æ˜¯åŸºäº<code>ipvs</code>çš„ã€‚<code>ipvs</code>çš„æ€§èƒ½è¦é«˜äº<code>iptables</code>çš„ï¼Œä½†æ˜¯å¦‚æœè¦ä½¿ç”¨å®ƒï¼Œéœ€è¦æ‰‹åŠ¨è½½å…¥<code>ipvs</code>æ¨¡å—ã€‚</li>
<li><code>Centos</code><!-- raw HTML omitted -->ç³»ç»Ÿåœ¨æ¯ä¸ªèŠ‚ç‚¹å®‰è£…é…ç½®<!-- raw HTML omitted --><code>ipset</code>å’Œ<code>ipvsadm</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install ipset ipvsadm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œå¦‚ä¸‹è„šæœ¬</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/sysconfig/modules/ipvs.modules<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_rr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_wrr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- nf_conntrack_ipv4  	# é«˜ç‰ˆæœ¬æ›¿æ¢ä¸ºnf_conntrack
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆæƒã€è¿è¡Œã€æ£€æŸ¥æ˜¯å¦åŠ è½½</span>
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">755</span> /etc/sysconfig/modules/ipvs.modules <span style="color:#f92672">&amp;&amp;</span> bash /etc/sysconfig/modules/ipvs.modules
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥æ˜¯å¦åŠ è½½</span>
</span></span><span style="display:flex;"><span>$ lsmod | grep -e ipvs -e nf_conntrack_ipv4</span></span></code></pre></div><ul>
<li><code>Debian</code><!-- raw HTML omitted -->ç³»ç»Ÿåœ¨æ¯ä¸ªèŠ‚ç‚¹å®‰è£…é…ç½®<!-- raw HTML omitted --><code>ipset</code>å’Œ<code>ipvsadm</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -vp /etc/modules.d/
</span></span><span style="display:flex;"><span>$ tee /etc/modules.d/k8s.modules <span style="color:#e6db74">&lt;&lt;&#39;EOF&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># netfilter æ¨¡å— å…è®¸ iptables æ£€æŸ¥æ¡¥æ¥æµé‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- br_netfilter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># containerd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- overlay
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nf_conntrack
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- nf_conntrack
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ipvs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_lc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_lblc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_lblcr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_rr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_wrr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_dh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_fo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_nq
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_sed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_ftp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_tables
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_set
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ipt_set
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ipt_rpfilter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ipt_REJECT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ipip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- xt_set
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">755</span> /etc/modules.d/k8s.modules <span style="color:#f92672">&amp;&amp;</span> bash /etc/modules.d/k8s.modules <span style="color:#f92672">&amp;&amp;</span> lsmod | grep -e ip_vs -e nf_conntrack  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ip_vs_sh               16384  0  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ip_vs_wrr              16384  0  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ip_vs_rr               16384  0  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ip_vs                 155648  6 ip_vs_rr,ip_vs_sh,ip_vs_wrr  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nf_conntrack          139264  1 ip_vs  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nf_defrag_ipv6         24576  2 nf_conntrack,ip_vs  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nf_defrag_ipv4         16384  1 nf_conntrack  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># libcrc32c              16384  5 nf_conntrack,btrfs,xfs,raid456,ip_vs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sysctl --system</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="9">
<li><!-- raw HTML omitted -->æ‰€æœ‰èŠ‚ç‚¹é…ç½®<!-- raw HTML omitted --><code>Limit</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ulimit -SHn <span style="color:#ae81ff">65536</span>  	<span style="color:#75715e"># ä¸´æ—¶ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft nproc 65535  	# soft è½¯é™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nproc 65535  	# hard ç¡¬é™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft nofile 25535
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nofile 25535
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft memlock unlimited
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft memlock unlimited &#34;</span> &gt;&gt;/etc/security/limits.conf  	<span style="color:#75715e"># æ°¸ä¹…ç”Ÿæ•ˆ</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="10">
<li><code>k8s-master01</code><!-- raw HTML omitted -->èŠ‚ç‚¹è®¾ç½®å…å¯†ç™»å½•å…¶ä»–èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>ssh-keygen</code><!-- raw HTML omitted -->ï¼šç”¨äºåˆ›å»ºå¯†é’¥çš„ç¨‹åº<!-- raw HTML omitted --></li>
<li><code>-m PEM</code><!-- raw HTML omitted -->ï¼šå°†å¯†é’¥çš„æ ¼å¼è®¾ä¸º<!-- raw HTML omitted --><code>PEM</code></li>
<li><code>-t rsa</code><!-- raw HTML omitted -->ï¼šåˆ›å»ºå¯†é’¥ç±»å‹ä¸ºï¼š<code>RSA</code>æ ¼å¼ï¼Œç³»ç»Ÿé»˜è®¤æä¾›åä¸º <code>id_rsa</code> çš„å¯†é’¥å¯¹ï¼Œæœ‰äº›å·¥å…·å¯èƒ½è¦æ±‚ç§é’¥æ–‡ä»¶åä¸º<!-- raw HTML omitted --><code>id_rsa</code></li>
<li><code>-b 4096</code><!-- raw HTML omitted -->ï¼šå¯†é’¥çš„ä½æ•°ï¼Œæœ¬ä¾‹ä¸­ä¸º<!-- raw HTML omitted --><code>4096</code></li>
<li><code>-C &quot;xxx@myserver&quot;</code><!-- raw HTML omitted -->ï¼šè¿½åŠ åˆ°å…¬é’¥æ–‡ä»¶æœ«å°¾ä»¥ä¾¿äºè¯†åˆ«çš„æ³¨é‡Šã€‚ é€šå¸¸ä»¥ç”µå­é‚®ä»¶åœ°å€ç”¨ä½œæ³¨é‡Šï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•æœ€é€‚åˆä½ åŸºç¡€ç»“æ„çš„äº‹ç‰©<!-- raw HTML omitted --></li>
<li><code>-f ~/.ssh/</code><!-- raw HTML omitted -->ï¼šç§é’¥æ–‡ä»¶çš„æ–‡ä»¶åï¼ˆå¦‚æœé€‰æ‹©ä¸ä½¿ç”¨é»˜è®¤åç§°ï¼‰ã€‚ è¿½åŠ äº†<code>.pub</code>çš„ç›¸åº”å…¬é’¥æ–‡ä»¶åœ¨ç›¸åŒç›®å½•ä¸­ç”Ÿæˆã€‚ è¯¥ç›®å½•å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>-N mypassphrase</code><!-- raw HTML omitted -->ï¼šç”¨äºè®¿é—®ç§é’¥æ–‡ä»¶çš„å…¶ä»–å¯†ç <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ssh-keygen <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-m PEM <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-t rsa <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-b <span style="color:#ae81ff">4096</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-C <span style="color:#e6db74">&#34;xxx@163.com&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-f ~/.ssh/name_rsa <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-N mypassphrase
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#66d9ef">for</span> i in master-01 master-02 noder-01 noder-02 noder-03;<span style="color:#66d9ef">do</span> ssh-copy-id -i .ssh/id_rsa.pub $i;<span style="color:#66d9ef">done</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="11">
<li><!-- raw HTML omitted -->æ‰€æœ‰èŠ‚ç‚¹æ›´æ–°ç³»ç»Ÿå¹¶ä¸”é‡å¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y --exclude<span style="color:#f92672">=</span>kernel* update <span style="color:#f92672">&amp;&amp;</span> reboot</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="12">
<li><!-- raw HTML omitted -->å‡çº§ç³»ç»Ÿ<!-- raw HTML omitted --><code>Kernel</code>å†…æ ¸åˆ°<code>4.18+</code>ä»¥ä¸Š</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
</span></span><span style="display:flex;"><span>$ rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»¤åˆ—å‡ºå¯ç”¨çš„å†…æ ¸ç›¸å…³åŒ…</span>
</span></span><span style="display:flex;"><span>$ yum --disablerepo<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;*&#34;</span> --enablerepo<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;elrepo-kernel&#34;</span> list available
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…æœ€æ–°ä¸»çº¿ç¨³å®šå†…æ ¸</span>
</span></span><span style="display:flex;"><span>$ yum -y --enablerepo<span style="color:#f92672">=</span>elrepo-kernel install kernel-ml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½® GRUB é»˜è®¤çš„å†…æ ¸ç‰ˆæœ¬ï¼š</span>
</span></span><span style="display:flex;"><span>$ vim /etc/default/grub
</span></span><span style="display:flex;"><span>GRUB_DEFAULT<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>  	<span style="color:#75715e"># ä¿®æ”¹éƒ¨åˆ†ï¼Œ GRUB åˆå§‹åŒ–é¡µé¢çš„ç¬¬ä¸€ä¸ªå†…æ ¸å°†ä½œä¸ºé»˜è®¤å†…æ ¸</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°åˆ›å»ºå†…æ ¸é…ç½®</span>
</span></span><span style="display:flex;"><span>$ grub2-mkconfig -o /boot/grub2/grub.cfg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ reboot</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ‰€æœ‰èŠ‚ç‚¹éƒ½å®‰è£…docker">æ‰€æœ‰èŠ‚ç‚¹éƒ½å®‰è£…<code>docker</code></h3>
<ul>
<li>
<ol>
<li><code>yum</code><!-- raw HTML omitted -->æºçš„ä½¿ç”¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨å®˜æ–¹æº <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y yum-utils
</span></span><span style="display:flex;"><span>$ yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨é˜¿é‡Œäº‘å®˜æ–¹<code>repo</code>æº<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å¤‡ä»½æœåŠ¡å™¨ä¸ŠåŸæœ‰çš„CentOS-Baseå’Œepel</span>
</span></span><span style="display:flex;"><span>$ mv /etc/yum.repos.d/CentOS-Base.repo<span style="color:#f92672">{</span>,.bak<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$ mv /etc/yum.repos.d/epel.repo<span style="color:#f92672">{</span>,.bak<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…CentOS0-Baseå’Œepelæº </span>
</span></span><span style="display:flex;"><span>$ curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
</span></span><span style="display:flex;"><span>$ curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬ä¸€ç§æ–¹å¼å®‰è£…docker æº  </span>
</span></span><span style="display:flex;"><span>$ wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬äºŒç§æ–¹å¼dockeræº</span>
</span></span><span style="display:flex;"><span>$ yum install -y yum-utils device-mapper-persistent-data lvm2
</span></span><span style="display:flex;"><span>$ yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åšæ›¿æ¢</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s+download.docker.com+mirrors.aliyun.com/docker-ce+&#39;</span> /etc/yum.repos.d/docker-ce.repo</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¸è½½æœåŠ¡å™¨è‡ªå¸¦<!-- raw HTML omitted --><code>docker</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å®‰è£…å¯¹åº”<code>docker</code>ç‰ˆæœ¬æœåŠ¡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum makecache fast
</span></span><span style="display:flex;"><span>$ yum list docker-ce  --showduplicates|sort -r
</span></span><span style="display:flex;"><span>$ yum install -y docker-ce-20.10.4 docker-ce-cli-20.10.4 containerd.io docker-compose-plugin
</span></span><span style="display:flex;"><span>$ systemctl enable docker <span style="color:#f92672">&amp;&amp;</span> systemctl start docker</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>docker-compose</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo curl -L <span style="color:#e6db74">&#34;https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-</span><span style="color:#66d9ef">$(</span>uname -s<span style="color:#66d9ef">)</span><span style="color:#e6db74">-</span><span style="color:#66d9ef">$(</span>uname -m<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> -o /usr/local/bin/docker-compose
</span></span><span style="display:flex;"><span>$ chmod +x /usr/local/bin/docker-compose
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
</span></span><span style="display:flex;"><span>$ docker compose COMMAND --help  	<span style="color:#75715e"># æŸ¥çœ‹é•œåƒç¼–å†™æ–¹å¼</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><code>Kubernetes</code><!-- raw HTML omitted -->æ–‡ä»¶é©±åŠ¨é»˜è®¤ç”±<!-- raw HTML omitted --><code>systemd</code><!-- raw HTML omitted -->æ”¹æˆ<!-- raw HTML omitted --><code>cgroupfs</code><!-- raw HTML omitted -->, è€Œæˆ‘ä»¬å®‰è£…çš„<!-- raw HTML omitted --><code>docker</code><!-- raw HTML omitted -->ä½¿ç”¨çš„æ–‡ä»¶é©±åŠ¨æ˜¯<!-- raw HTML omitted --><code>systemd</code><!-- raw HTML omitted -->, é€ æˆä¸ä¸€è‡´, å¯¼è‡´é•œåƒæ— æ³•å¯åŠ¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>&quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;/etc/docker/daemon.json<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;registry-mirrors&#34;: [&#34;https://bn4ll166.mirror.aliyuncs.com&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;data-root&#34;: &#34;/data/docker-root&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;dns&#34;: [&#34;223.5.5.5&#34;,&#34;119.29.29.29&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;bip&#34;: &#34;172.31.255.254/16&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;storage-driver&#34;: &#34;overlay2&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;storage-opts&#34;: [&#34;overlay2.override_kernel_check=true&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;userland-proxy&#34;: false,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;log-driver&#34;: &#34;json-file&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;log-opts&#34;: {&#34;max-size&#34;: &#34;500m&#34;,&#34;max-file&#34;: &#34;1&#34;},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;live-restore&#34;: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><a href="https://www.qikqiak.com/k8s-book/docs/1.%E8%AF%BE%E7%A8%8B%E4%BB%8B%E7%BB%8D.html" rel="external" target="_self"><code>Docker</code>+<code>Kubernetes</code></a></li>
</ol>
</li>
</ul>
<hr>
<h3 id="æ‰€æœ‰èŠ‚ç‚¹é…ç½®kubernetes-yumæº">æ‰€æœ‰èŠ‚ç‚¹é…ç½®<code>kubernetes yum</code>æº</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å›½å†…ä¿®æ”¹ä¸ºé˜¿é‡Œäº‘<code>yum</code>æº <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/yum.repos.d/kubernetes.repo<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[kubernetes]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name=Kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">repo_gpgcheck=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç›´æ¥ä½¿ç”¨<code>kubernetes</code>å®˜æ–¹<code>yum</code>æº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;-EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[kubernetes]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name=Kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">exclude=kubelet kubeadm kubectl
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->é‡å¯æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ reboot</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ‰€æœ‰èŠ‚ç‚¹éƒ½å®‰è£…kubeadmkubeletkubectl">æ‰€æœ‰èŠ‚ç‚¹éƒ½å®‰è£…<code>kubeadmã€kubeletã€kubectl</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum list kubelet kubeadm kubectl  --showduplicates | sort -r
</span></span><span style="display:flex;"><span>$ yum -y install kubelet-1.24.5 kubeadm-1.24.5 kubectl-1.24.5</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><code>--cgroup-driver=systemd</code><!-- raw HTML omitted -->ï¼šä¸ºäº†å®ç°<!-- raw HTML omitted --><code>Docker</code><!-- raw HTML omitted -->ä½¿ç”¨çš„<!-- raw HTML omitted --><code>cgroup drvier</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>kubelet</code><!-- raw HTML omitted -->ä½¿ç”¨çš„<!-- raw HTML omitted --><code>cgroup</code><!-- raw HTML omitted -->é»˜è®¤å€¼ä¸ºä¸€è‡´ï¼Œ<!-- raw HTML omitted --><code>/etc/sysconfig/kubelet</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸­æ·»åŠ <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>--fail-swap-on=false</code><!-- raw HTML omitted -->å¿½ç•¥<code>swap</code>æŠ¥é”™<!-- raw HTML omitted --></li>
<li><code>--feature-gates EphemeralContainers=true</code><!-- raw HTML omitted -->å¼€å¯ä¸´æ—¶å®¹å™¨å‚æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubelet -h | grep EphemeralContainers</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/sysconfig/kubelet<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBELET_EXTRA_ARGS=&#34;--cgroup-driver=systemd --fail-swap-on=false&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBE_PROXY_MODE=&#34;ipvs&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨å³å¯ï¼Œç”±äºæ²¡æœ‰ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œé›†ç¾¤åˆå§‹åŒ–åè‡ªåŠ¨å¯åŠ¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl enable kubelet <span style="color:#f92672">&amp;&amp;</span> systemctl start kubelet</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ä½¿ç”¨kubeadméƒ¨ç½²kubernetes">ä½¿ç”¨<code>Kubeadm</code>éƒ¨ç½²<code>Kubernetes</code></h2>
<h3 id="æŸ¥çœ‹ä¸‹è½½æ‰€éœ€é•œåƒ">æŸ¥çœ‹ä¸‹è½½æ‰€éœ€é•œåƒ</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>k8s</code><!-- raw HTML omitted -->æ‰€éœ€é•œåƒ<!-- raw HTML omitted --><code>kubeadm config images list</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm config images list   <span style="color:#75715e"># listæ›¿æ¢ï¼špullã€æ‹‰å–é•œåƒ</span>
</span></span><span style="display:flex;"><span>k8s.gcr.io/kube-apiserver:v1.24.6
</span></span><span style="display:flex;"><span>k8s.gcr.io/kube-controller-manager:v1.24.6
</span></span><span style="display:flex;"><span>k8s.gcr.io/kube-scheduler:v1.24.6
</span></span><span style="display:flex;"><span>k8s.gcr.io/kube-proxy:v1.24.6
</span></span><span style="display:flex;"><span>k8s.gcr.io/pause:3.7
</span></span><span style="display:flex;"><span>k8s.gcr.io/etcd:3.5.3-0
</span></span><span style="display:flex;"><span>k8s.gcr.io/coredns/coredns:v1.8.6
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker images --digests  	<span style="color:#75715e"># éªŒè¯é•œåƒå®Œæ•´æ€§</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¸‹è½½<code>K8S</code>æ‰€éœ€é•œåƒ (å¦‚æœè¿‡ç¨‹ä¸­æœ‰æç¤ºå¤±è´¥è¿¹è±¡, é‚£ä¹ˆå¯èƒ½æ˜¯ç½‘ç»œåŸå› , å¤šæ‰§è¡Œå‡ æ¬¡)<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm config images list | xargs -n1 docker pull  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šæ‹‰å–é˜¿é‡Œäº‘æºçš„é•œåƒ  </span>
</span></span><span style="display:flex;"><span>$ kubeadm config images pull --kubernetes-version<span style="color:#f92672">=</span>v1.20.2 --image-repository<span style="color:#f92672">=</span>registry.aliyuncs.com/google_containers  </span></span></code></pre></div></blockquote>
<hr>
<h3 id="éƒ¨ç½²masterèŠ‚ç‚¹">éƒ¨ç½²<code>master</code>èŠ‚ç‚¹</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸¤ç§æ–¹å¼éƒ¨ç½²<!-- raw HTML omitted --><code>Master</code>èŠ‚ç‚¹ï¼š<strong>å‘½ä»¤è¡Œ</strong>å’Œ**<code>yaml</code>**</li>
<li><!-- raw HTML omitted -->**æ³¨æ„ï¼š**ä¸»æœºåä¸­ä¸èƒ½å¸¦æœ‰_ï¼ˆä¸‹åˆ’çº¿ï¼‰ï¼Œä¸ç„¶åˆå§‹åŒ–ä¼šæŠ¥é”™<!-- raw HTML omitted --><a href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/" rel="external" target="_self"><code>kubeadm init</code></a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼åˆå§‹åŒ–<!-- raw HTML omitted --><code>Kubernetes</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>--kubernetes-version</code>ï¼šæŒ‡å®šç‰ˆæœ¬</li>
<li><code>--apiserver-advertise-address</code>ï¼š<code>master</code>æœ¬æœº<code>IP</code></li>
<li><code>--service-cidr</code>ï¼š<!-- raw HTML omitted -->ç”¨äºæŒ‡å®šä¸º<code>Service</code>åˆ†é…ä½¿ç”¨ç½‘ç»œåœ°å€ï¼Œå®ƒç”±<code>kubernetes</code>ç®¡ç†ï¼Œé»˜è®¤ç½‘æ®µï¼š<code>10.96.0.0/12</code><!-- raw HTML omitted --></li>
<li><code>--pod-network-cidr</code>ï¼š<!-- raw HTML omitted -->å¯åŠ¨å®¹å™¨ç»™å®¹å™¨æ‰€åˆ†é…<code>IP</code>ï¼Œ<code>ip a</code>å¯ä»¥æŸ¥çœ‹æœåŠ¡å™¨æœ¬æœºç”Ÿæˆ<code>IP</code>æ®µï¼Œå½“æœ‰ä»é›†ç¾¤å¤–èŠ‚ç‚¹é€šè¿‡é™æ€è·¯ç”±æ–¹å¼è®¿é—®é›†ç¾¤å†…<code>Service</code>çš„éœ€æ±‚æ—¶ï¼Œéœ€è¦åœ¨åˆ›å»ºé›†ç¾¤æ—¶æŒ‡å®š<code>pod-network-cidr</code>ï¼Œ ä»¥å¯¹æ¥è‡ªé<code>Pod</code>ç½‘ç»œçš„æµé‡(å¤–éƒ¨æµé‡)æ‰§è¡Œ<code>MASQ</code>ï¼Œå¤–éƒ¨è®¿é—®podæœåŠ¡åš<code>nat</code>è½¬å‘,å®ƒé€šå¸¸åº”è¯¥ä¸éƒ¨ç½²ä½¿ç”¨çš„ç½‘ç»œæ’ä»¶(ä¾‹å¦‚ï¼š<code>flannel</code>ã€<code>calico</code>)é»˜è®¤è®¾å®šä¿æŒä¸€è‡´ï¼Œ<code>10.244.0.0/16</code>æ˜¯<code>flannel</code>é»˜è®¤ä½¿ç”¨ç½‘ç»œ<!-- raw HTML omitted --></li>
<li><code>--ignore-preflight-errors=Swap</code>ï¼š<!-- raw HTML omitted -->é€šè¿‡æ­¤å‚æ•°å¿½ç•¥swapæŠ¥é”™<!-- raw HTML omitted --></li>
<li><code>--image-repository registry.aliyuncs.com/google_containers</code>ï¼š<!-- raw HTML omitted -->æŒ‡å®šä»é˜¿é‡Œäº‘ä¸‹è½½<!-- raw HTML omitted --></li>
<li><code>--cri-socket</code>ï¼š<!-- raw HTML omitted -->é…ç½®<code>CRI</code>ç«¯ç‚¹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm init --kubernetes-version<span style="color:#f92672">=</span>v1.24.6 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--apiserver-advertise-address<span style="color:#f92672">=</span>192.168.35.128 --node-name<span style="color:#f92672">=</span>k8s-master <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--service-cidr<span style="color:#f92672">=</span>10.64.0.0/12 --pod-network-cidr<span style="color:#f92672">=</span>10.244.0.0/16 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--cri-socket unix:///var/run/containerd/containerd.sock  	<span style="color:#75715e"># é…ç½® CRI ç«¯ç‚¹</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é€šè¿‡é…ç½®æ–‡ä»¶åˆå§‹åŒ–<!-- raw HTML omitted --><code>Kubernetes</code>çš„<code>master</code>èŠ‚ç‚¹</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¾“å‡ºåˆå§‹åŒ–é…ç½®åˆ°æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ kubeadm config print init-defaults &gt;/opt/k8s/yaml/kubeadm-config.yaml
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>apiVersion: kubeadm.k8s.io/v1beta3
</span></span><span style="display:flex;"><span>bootstrapTokens:
</span></span><span style="display:flex;"><span>- groups:
</span></span><span style="display:flex;"><span>    - system:bootstrappers:kubeadm:default-node-token
</span></span><span style="display:flex;"><span>    token: abcdef.0123456789abcdef
</span></span><span style="display:flex;"><span>    ttl: 24h0m0s
</span></span><span style="display:flex;"><span>    usages:
</span></span><span style="display:flex;"><span>    - signing
</span></span><span style="display:flex;"><span>    - authentication
</span></span><span style="display:flex;"><span>kind: InitConfiguration
</span></span><span style="display:flex;"><span>localAPIEndpoint:
</span></span><span style="display:flex;"><span>    advertiseAddress: 1.2.3.4  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºmasteræœ¬æœºIP</span>
</span></span><span style="display:flex;"><span>    bindPort: <span style="color:#ae81ff">6443</span>  	<span style="color:#75715e"># ä½¿ç”¨ç«¯å£</span>
</span></span><span style="display:flex;"><span>nodeRegistration:
</span></span><span style="display:flex;"><span>    criSocket: unix:///var/run/containerd/containerd.sock  	<span style="color:#75715e"># é…ç½® CRI ç«¯ç‚¹</span>
</span></span><span style="display:flex;"><span>    imagePullPolicy: IfNotPresent
</span></span><span style="display:flex;"><span>    name: node  	<span style="color:#75715e"># é…ç½®ä¸»æœºåï¼Œ ä¸»æœºåä¸å…è®¸ä½¿ç”¨ä¸‹åˆ’çº¿</span>
</span></span><span style="display:flex;"><span>    taints: null
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>apiServer:
</span></span><span style="display:flex;"><span>    timeoutForControlPlane: 4m0s
</span></span><span style="display:flex;"><span>apiVersion: kubeadm.k8s.io/v1beta3
</span></span><span style="display:flex;"><span>certificatesDir: /etc/kubernetes/pki
</span></span><span style="display:flex;"><span>clusterName: kubernetes
</span></span><span style="display:flex;"><span>controllerManager: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>dns: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>etcd:
</span></span><span style="display:flex;"><span>    local:
</span></span><span style="display:flex;"><span>        dataDir: /var/lib/etcd
</span></span><span style="display:flex;"><span>imageRepository: k8s.gcr.io  	<span style="color:#75715e"># å®šä¹‰ä½¿ç”¨é•œåƒæº</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## imageRepository: registry.aliyuncs.com/google_containers  	# é˜¿é‡Œäº‘é•œåƒæº</span>
</span></span><span style="display:flex;"><span>kind: ClusterConfiguration
</span></span><span style="display:flex;"><span>kubernetesVersion: 1.24.6  	<span style="color:#75715e"># å®šä¹‰kubernetesç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>networking:
</span></span><span style="display:flex;"><span>    dnsDomain: cluster.local
</span></span><span style="display:flex;"><span>    serviceSubnet: 10.96.0.0/12  	<span style="color:#75715e"># 10.244.0.0/16 æ˜¯`flannel`é»˜è®¤ä½¿ç”¨ç½‘ç»œ</span>
</span></span><span style="display:flex;"><span>scheduler: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span><span style="display:flex;"><span>kind: KubeProxyConfiguration
</span></span><span style="display:flex;"><span>featureGates:
</span></span><span style="display:flex;"><span>    SupportIPVSProxyMode: true
</span></span><span style="display:flex;"><span>mode: ipvs  	<span style="color:#75715e"># å¯ç”¨ipvs  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubeadm init --config<span style="color:#f92672">=</span>/opt/k8s/yaml/kubeadm-config.yaml  	<span style="color:#75715e"># åˆå§‹åŒ–é…ç½®æ–‡ä»¶</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¦‚æœåˆå§‹åŒ–æŠ¥é”™æ‰§è¡Œä¸‹é¢å‘½ä»¤ã€ç„¶åé‡æ–°åˆå§‹åŒ–<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">############################################################# 	 é…ç½®containerdæœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ rm -rf /etc/containerd/config.toml
</span></span><span style="display:flex;"><span>$ containerd config default &gt;/etc/containerd/config.toml  	<span style="color:#75715e"># ç”Ÿæˆæ–°é…ç½®æ¥è¦†ç›–é»˜è®¤é…ç½®</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;&gt;/etc/containerd/config.toml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[plugins.&#34;io.containerd.grpc.v1.cri&#34;.containerd.runtimes.runc.options]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> SystemdCgroup = false  	# ä¿®æ”¹ä¸ºï¼štrue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>$ systemctl restart containerd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#############################################################  	kubelet é…ç½®æ–‡ä»¶ä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;&gt;/var/lib/kubelet/kubeadm-flags.env<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBELET_KUBEADM_ARGS=&#34;--container-runtime-endpoint=unix:///var/run/containerd/containerd.sock --pod-infra-container-image=registry.k8s.io/pause:3.9&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨é…ç½®å¢åŠ --container-runtime=remote --container-runtime-endpoint=unix:///var/run/containerd/containerd.sock</span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;&gt;/usr/lib/systemd/system/kubelet.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/usr/bin/kubelet --container-runtime=remote --container-runtime-endpoint=unix:///var/run/containerd/containerd.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">############################################################## 	 åˆ é™¤é…ç½®é‡è½½</span>
</span></span><span style="display:flex;"><span>$ swapoff -a <span style="color:#f92672">&amp;&amp;</span> kubeadm reset <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	<span style="color:#f92672">&amp;&amp;</span> systemctl daemon-reload <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	<span style="color:#f92672">&amp;&amp;</span> systemctl restart kubelet <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	<span style="color:#f92672">&amp;&amp;</span> iptables -F <span style="color:#f92672">&amp;&amp;</span> iptables -t nat -F <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	<span style="color:#f92672">&amp;&amp;</span> iptables -t mangle -F <span style="color:#f92672">&amp;&amp;</span> iptables -X</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æŸ¥çœ‹<code>node</code>ä¿¡æ¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get nodes
</span></span><span style="display:flex;"><span>NAME         STATUS   ROLES                  AGE   VERSION
</span></span><span style="display:flex;"><span>k8s-master   Ready    control-plane,master   23h   v1.21.12
</span></span><span style="display:flex;"><span>k8s-node1    Ready    &lt;none&gt;                 23h   v1.21.12
</span></span><span style="display:flex;"><span>k8s-node2    Ready    &lt;none&gt;                 23h   v1.21.12</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->æ ¹æ®æç¤ºæ¶ˆæ¯ï¼Œåœ¨<code>Master</code>èŠ‚ç‚¹ä¸Šä½¿ç”¨<code>kubectl</code>å·¥å…·ï¼Œå¯ä»¥æŠŠä¸‹åˆ—<code>.kube</code>ç›®å½•åŒæ­¥åˆ°<code>node</code>èŠ‚ç‚¹ï¼Œä»¥ä¾¿<code>node</code>èŠ‚ç‚¹ä½¿ç”¨<code>kubectl</code>å·¥å…·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><strong>æ³¨æ„ï¼š</strong><!-- raw HTML omitted -->å¦‚æœä¸æ‰§è¡Œ<!-- raw HTML omitted -->ä»¥ä¸‹å‘½ä»¤<!-- raw HTML omitted -->ï¼Œæ‰§è¡Œ<code>kubectl get nodes</code>å‘½ä»¤æŠ¥é”™ï¼š<code>couldn't get current server API group list: Get &quot;http://localhost:8080/api?timeout=32s&quot;: dial tcp [::1]:8080: connect: connection refused</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p $HOME/.kube
</span></span><span style="display:flex;"><span>$ cp -i /etc/kubernetes/admin.conf <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/config
</span></span><span style="display:flex;"><span>$ chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/config
</span></span><span style="display:flex;"><span>$ scp -r /root/.kube root@k8s-node-01:/root/</span></span></code></pre></div></blockquote>
<hr>
<h3 id="nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤"><code>node</code>èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å½“ä¸»èŠ‚ç‚¹å¯åŠ¨å®Œ<code>k8s</code>ä¹‹åä¼šç”ŸæˆåŠ å…¥èŠ‚ç‚¹çš„å‘½ä»¤ï¼Œè§†è‡ªå·±æœåŠ¡å™¨è€Œå®š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm join 192.168.35.128:6443 --token l37r7y.75gjs1ltufdp8kp2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	--discovery-token-ca-cert-hash sha256:9ebc670ec3f97b5f42d77908f378786ed806ef22e9ae2cf21fe5fb239483833c</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é»˜è®¤<code>token</code>æœ‰æ•ˆæœŸä¸º24å°æ—¶ï¼Œå½“è¿‡æœŸä¹‹åï¼Œè¯¥<code>token</code>å°±ä¸å¯ç”¨äº†ã€‚è¿™æ—¶å°±éœ€è¦é‡æ–°åˆ›å»º<code>token</code>ï¼Œæ“ä½œå¦‚ä¸‹ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm token list  	<span style="color:#75715e"># æŸ¥çœ‹Token</span>
</span></span><span style="display:flex;"><span>$ kubeadm token create --print-join-command
</span></span><span style="display:flex;"><span>$ kubeadm token create --ttl <span style="color:#ae81ff">0</span> --print-join-command  <span style="color:#75715e"># ç”Ÿæˆä¸€ä¸ªæ°¸ä¸è¿‡æœŸçš„token</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°è·å–sha56key</span>
</span></span><span style="display:flex;"><span>$ openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outfrom der 2&gt;dev/null | openssl dgst -sha256 -hex | sed <span style="color:#e6db74">&#39;s/^.* //&#39;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>master</code><!-- raw HTML omitted -->æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹æ˜¯å¦å·²åŠ å…¥<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get componentstatuses  	<span style="color:#75715e"># æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µï¼Œç¼©å†™ä¸ºï¼šcs</span>
</span></span><span style="display:flex;"><span>NAME                 STATUS    MESSAGE             ERROR
</span></span><span style="display:flex;"><span>scheduler            Healthy   ok                  
</span></span><span style="display:flex;"><span>controller-manager   Healthy   ok                  
</span></span><span style="display:flex;"><span>etcd-0               Healthy   <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;health&#34;</span>:<span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æŸ¥çœ‹éƒ¨ç½²å¥½çš„å‘½åç©ºé—´<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>default</code><!-- raw HTML omitted -->ï¼šæ‰€æœ‰æœªæŒ‡å®šçš„<code>Namespace</code>çš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åœ¨defaultå‘½åç©ºé—´<!-- raw HTML omitted --></li>
<li><code>kube-node-lease</code><!-- raw HTML omitted -->ï¼šé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„å¿ƒè·³ç»´æŠ¤ï¼Œ<code>v1.13</code>å¼€å§‹å¼•å…¥<!-- raw HTML omitted --></li>
<li><code>kube-public</code><!-- raw HTML omitted -->ï¼šæ­¤å‘½åç©ºé—´çš„èµ„æºå¯ä»¥è¢«æ‰€æœ‰äººè®¿é—®ï¼ˆåŒ…æ‹¬æœªè®¤è¯ç”¨æˆ·ï¼‰<!-- raw HTML omitted --></li>
<li><code>kube-system</code><!-- raw HTML omitted -->ï¼šæ‰€æœ‰ç”±<code>kubernetes</code>ç³»ç»Ÿåˆ›å»ºçš„èµ„æºéƒ½å¤„äºè¿™ä¸ªå‘½åç©ºé—´<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get namespace  <span style="color:#75715e"># ç¼©å†™ä¸ºï¼š ns</span>
</span></span><span style="display:flex;"><span>NAME              STATUS   AGE 
</span></span><span style="display:flex;"><span>default           Active   19h
</span></span><span style="display:flex;"><span>kube-node-lease   Active   19h
</span></span><span style="display:flex;"><span>kube-public       Active   19h
</span></span><span style="display:flex;"><span>kube-system       Active   19h</span></span></code></pre></div></blockquote>
<hr>
<h4 id="å¤„ç†é›†ç¾¤çŠ¶æ€statusnotreadyfont-colorredæ˜¯ç½‘ç»œä¸é€šéƒ¨ç½²fontcnifont-colorredç½‘ç»œæ’ä»¶font">å¤„ç†é›†ç¾¤çŠ¶æ€ï¼š<code>STATUSï¼šNotReady</code><!-- raw HTML omitted -->æ˜¯ç½‘ç»œä¸é€šéƒ¨ç½²ï¼š<!-- raw HTML omitted --><code>CNI</code><!-- raw HTML omitted -->ç½‘ç»œæ’ä»¶<!-- raw HTML omitted --></h4>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://segmentfault.com/a/1190000018698263" rel="external" target="_self">ç½‘ç»œï¼š<code>Flannel</code>ã€<code>Calico</code>ã€<code>Canal</code>å’Œ<code>Weave</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://dockone.io/article/10501" rel="external" target="_self">ç®€å•èŠèŠ<code>Calico</code>ä¸<code>Flannel</code></a></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>kubernetes</code><!-- raw HTML omitted -->æ”¯æŒå¤šç§ç½‘ç»œæ’ä»¶ï¼Œæ¯”å¦‚<!-- raw HTML omitted --><code>flannel</code>ã€<code>calico</code>ã€<code>canal</code><!-- raw HTML omitted -->ç­‰ï¼Œä»»é€‰ä¸€ç§å³å¯ï¼Œæœ¬æ¬¡é€‰æ‹©<!-- raw HTML omitted --><code>flannel</code><!-- raw HTML omitted -->ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å®‰è£…<!-- raw HTML omitted --><code>calico</code><!-- raw HTML omitted -->ï¼Œæ¨èå®‰è£…<!-- raw HTML omitted --><code>calico</code></li>
<li><!-- raw HTML omitted -->åœ¨<code>Master</code>èŠ‚ç‚¹ä¸Šè·å–<code>flannel</code>é…ç½®æ–‡ä»¶(å¯èƒ½ä¼šå¤±è´¥ï¼Œå¦‚æœå¤±è´¥ï¼Œè¯·ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åå®‰è£…)ï¼š<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><code>flannelã€calico</code><!-- raw HTML omitted -->ï¼šåŸºäºéš§é“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>éš§é“æ–¹æ¡ˆæœ€å…·æ™®é€‚æ€§ï¼Œåœ¨ä»»ä½•ç½‘ç»œç¯å¢ƒä¸‹éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œè¿™ä¸å®ƒçš„åŸç†å¯†ä¸å¯åˆ†ã€‚</li>
<li>æœ€å¸¸è§çš„éš§é“æ–¹æ¡ˆæ˜¯<code>flannel &quot;Type&quot;: &quot;vxlan&quot;</code>æ¨¡å¼ï¼Œä»¥åŠ<code>calico</code>çš„<code>ipip</code>æ¨¡å¼ï¼Œ</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>flannelã€calico</code><!-- raw HTML omitted -->ï¼šåŸºäºè·¯ç”±<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>è·¯ç”±æ–¹æ¡ˆæ€§èƒ½æœ€å¥½ï¼ŒåŸå› æ˜¯è¯¥æ–¹æ¡ˆä¸éœ€è¦å°åŒ…å’Œè§£åŒ…ï¼Œæ‰€ä»¥æ²¡æœ‰éš§é“æ–¹æ¡ˆçš„åŠ£åŠ¿ï¼Œç½‘ç»œæ€§èƒ½å¾ˆå¥½ã€‚</li>
<li>å¸¸è§çš„è·¯ç”±æ–¹æ¡ˆåŒ…æ‹¬äº†<code>flannel</code>çš„<code>&quot;Type&quot;: &quot;host-gw&quot;</code>æ¨¡å¼ï¼Œä»¥åŠ<code>calico</code>çš„<code>bgp</code>æ¨¡å¼ã€‚</li>
<li><code>master</code><!-- raw HTML omitted -->èŠ‚ç‚¹æ‰§è¡Œä¸€ä¸‹è¯­å¥å®‰è£…<!-- raw HTML omitted --><code>calico</code><!-- raw HTML omitted -->ç½‘ç»œæ’ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/calico.yaml -O
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># çœ‹æƒ…å†µä¿®æ”¹ calicoé…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;calico.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name: CALICO_IPV4POOL_CIDR  	# ä¿®æ”¹ CALICO_IPV4POOL_CIDRå¯¹åº”çš„å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  value: &#34;192.168.1.0/24&#34;  	# ä¿®æ”¹ä¸º --pod-network-cidr å¯¹åº”çš„ç½‘æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹calico é•œåƒåœ°å€</span>
</span></span><span style="display:flex;"><span>$ grep image calico.yaml
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s#docker.io/##g&#39;</span> calico.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f calico.yaml</span></span></code></pre></div><ul>
<li><code>master</code><!-- raw HTML omitted -->èŠ‚ç‚¹æ‰§è¡Œä¸€ä¸‹è¯­å¥å®‰è£…<code>flannel</code>ç½‘ç»œæ’ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /opt/k8s/yaml/ https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</span></span><span style="display:flex;"><span>$ kubectl get pods -n kube-system</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>kubernetes</code><!-- raw HTML omitted -->ä¸­<code>kubectl</code>å‘½ä»¤è‡ªåŠ¨è¡¥å…¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y bash-completion
</span></span><span style="display:flex;"><span>$ source /etc/profile.d/bash_completion.sh</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->é›†ç¾¤ä¸å¥åº·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->éœ€è¦æ³¨é‡Šæ‰<!-- raw HTML omitted --><code>etc/kubernetes/manifests</code>ç›®å½•ä¸‹çš„<code>kube-controller-manager.yaml</code>å’Œ<code>kube-scheduler.yaml</code>çš„<code>--port=0</code>ï¼š</p>
</li>
<li>
<p><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>kube-controller-manager.yaml</code>æ–‡ä»¶</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;&gt;/etc/kubernetes/manifests/kube-controller-manager.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - command:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kube-controller-manager
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --allocate-node-cidrs=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --authentication-kubeconfig=/etc/kubernetes/controller-manager.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --authorization-kubeconfig=/etc/kubernetes/controller-manager.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --bind-address=127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --client-ca-file=/etc/kubernetes/pki/ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --cluster-cidr=10.244.0.0/16
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --cluster-name=kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --cluster-signing-cert-file=/etc/kubernetes/pki/ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --cluster-signing-key-file=/etc/kubernetes/pki/ca.key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --controllers=*,bootstrapsigner,tokencleaner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --kubeconfig=/etc/kubernetes/controller-manager.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --leader-elect=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # ä¿®æ”¹éƒ¨åˆ†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # - --port=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --root-ca-file=/etc/kubernetes/pki/ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --service-account-private-key-file=/etc/kubernetes/pki/sa.key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --service-cluster-ip-range=10.96.0.0/12
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --use-service-account-credentials=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>kube-scheduler.yaml</code>æ–‡ä»¶</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;&gt;/etc/kubernetes/manifests/kube-scheduler.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - command:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kube-scheduler
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --authentication-kubeconfig=/etc/kubernetes/scheduler.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --authorization-kubeconfig=/etc/kubernetes/scheduler.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --bind-address=127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --kubeconfig=/etc/kubernetes/scheduler.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --leader-elect=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # ä¿®æ”¹éƒ¨åˆ†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # - --port=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨æ‰€æœ‰MasterèŠ‚ç‚¹å†æ¬¡æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µï¼š</span>
</span></span><span style="display:flex;"><span>$ kubectl get cs</span></span></code></pre></div></blockquote>
<hr>
<h2 id="éƒ¨ç½²kubernetesé›†ç¾¤">éƒ¨ç½²<code>Kubernetes</code>é›†ç¾¤</h2>
<h3 id="å®‰è£…é«˜å¯ç”¨ç»„ä»¶">å®‰è£…é«˜å¯ç”¨ç»„ä»¶</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ³¨æ„ï¼šå¦‚æœä¸æ˜¯é«˜å¯ç”¨é›†ç¾¤ï¼Œ<!-- raw HTML omitted --><code>haproxy</code>å’Œ<code>keepalived</code>æ— éœ€å®‰è£…</li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li>æ‰€æœ‰<code>Master</code>èŠ‚ç‚¹å®‰è£…<code>HAPROXY</code>å’Œ<code>Keepalived</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install keepalived haproxy</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ‰€æœ‰<!-- raw HTML omitted --><code>Master</code><!-- raw HTML omitted -->èŠ‚ç‚¹é…ç½®<!-- raw HTML omitted --><code>HAProxy</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/haproxy/haproxy.cfg<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	maxconn  2000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	ulimit-n  16384
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	log  127.0.0.1 local0 err
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats timeout 30s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaults
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	log global
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	mode  http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	option  httplog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	timeout connect 5000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	timeout client  50000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	timeout server  50000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	timeout http-request 15s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	timeout http-keep-alive 15s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">frontend monitor-in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	bind *:33305
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	mode http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	option httplog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	monitor-uri /monitor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listen stats
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	bind    *:8006
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	mode    http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats   enable
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats   hide-version
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats   uri       /stats
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats   refresh   30s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats   realm     Haproxy\ Statistics
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats   auth      admin:admin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">frontend k8s-master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	bind 0.0.0.0:16443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	bind 127.0.0.1:16443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	mode tcp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	option tcplog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tcp-request inspect-delay 5s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	default_backend k8s-master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backend k8s-master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	mode tcp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	option tcplog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	option tcp-check
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	balance roundrobin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# ä¸‹é¢çš„é…ç½®æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	server k8s-master-01 192.168.80.210:6443  check
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	server k8s-master-02 192.168.80.211:6443  check
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>Msster-01</code>çš„<code>Keepalived</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">! Configuration File for keepalived
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	global_defs {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# æ ‡è¯†æœ¬èŠ‚ç‚¹çš„å­—æ¡ä¸²ï¼Œé€šå¸¸ä¸º hostname
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		router_id k8s-master-01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		script_user root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		enable_script_security    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# æ£€æµ‹è„šæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# keepalivedä¼šå®šæ—¶æ‰§è¡Œè„šæœ¬å¹¶å¯¹è„šæœ¬æ‰§è¡Œçš„ç»“æœè¿›è¡Œåˆ†æï¼ŒåŠ¨æ€è°ƒæ•´vrrp_instanceçš„ä¼˜å…ˆçº§ã€‚å¦‚æœè„šæœ¬æ‰§è¡Œç»“æœä¸º0ï¼Œå¹¶ä¸”weighté…ç½®çš„å€¼å¤§äº0ï¼Œåˆ™ä¼˜å…ˆçº§ç›¸åº”çš„å¢åŠ ã€‚å¦‚æœè„šæœ¬æ‰§è¡Œç»“æœé0ï¼Œå¹¶ä¸”weighté…ç½®çš„å€¼å°äº0ï¼Œåˆ™ä¼˜å…ˆçº§ç›¸åº”çš„å‡å°‘ã€‚å…¶ä»–æƒ…å†µï¼Œç»´æŒåŸæœ¬é…ç½®çš„ä¼˜å…ˆçº§ï¼Œå³é…ç½®æ–‡ä»¶ä¸­priorityå¯¹åº”çš„å€¼ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_script chk_apiserver {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		script &#34;/etc/keepalived/check_apiserver.sh&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        interval 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # ä¸€æ—¦è„šæœ¬æ‰§è¡ŒæˆåŠŸï¼Œæƒé‡å‡å°‘5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        weight -5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        fall 3  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        rise 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# å®šä¹‰è™šæ‹Ÿè·¯ç”±ï¼ŒVI_1 ä¸ºè™šæ‹Ÿè·¯ç”±çš„æ ‡ç¤ºç¬¦ï¼Œè‡ªå·±å®šä¹‰åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_instance VI_1 {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# ä¸»èŠ‚ç‚¹ä¸º MASTERï¼Œå¯¹åº”çš„å¤‡ä»½èŠ‚ç‚¹ä¸º BACKUP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		state MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# ç»‘å®šè™šæ‹Ÿ IP çš„ç½‘ç»œæ¥å£ï¼Œä¸æœ¬æœº IP åœ°å€æ‰€åœ¨çš„ç½‘å¡åç§°ç›¸åŒ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		interface ens32
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# ä¸»æœºçš„IPåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		mcast_src_ip 192.168.80.210
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# è™šæ‹Ÿè·¯ç”±id
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		virtual_router_id 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# èŠ‚ç‚¹ä¼˜å…ˆçº§ï¼Œå€¼èŒƒå›´ 0-254ï¼ŒMASTER è¦æ¯” BACKUP é«˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		priority 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# ä¼˜å…ˆçº§é«˜çš„è®¾ç½® nopreempt è§£å†³å¼‚å¸¸æ¢å¤åå†æ¬¡æŠ¢å çš„é—®é¢˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		nopreempt 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# ç»„æ’­ä¿¡æ¯å‘é€é—´éš”ï¼Œæ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¿…é¡»ä¸€æ ·ï¼Œé»˜è®¤ 1s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		advert_int 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # è®¾ç½®éªŒè¯ä¿¡æ¯ï¼Œæ‰€æœ‰èŠ‚ç‚¹å¿…é¡»ä¸€è‡´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		authentication {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			auth_type PASS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			auth_pass K8SHA_KA_AUTH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# è™šæ‹Ÿ IP æ± , æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¿…é¡»ä¸€æ ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		virtual_ipaddress {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			# è™šæ‹Ÿ ipï¼Œå¯ä»¥å®šä¹‰å¤šä¸ª	
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			192.168.80.220/24
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		track_script {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			chk_apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>Master-02</code>çš„<code>Keepalived</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">! Configuration File for keepalived
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	global_defs {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		router_id k8s-master-02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		script_user root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		enable_script_security    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_script chk_apiserver {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		script &#34;/etc/keepalived/check_apiserver.sh&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		interval 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		weight -5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		fall 3  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		rise 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_instance VI_1 {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		state BACKUP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		interface ens32
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		mcast_src_ip 192.168.80.211
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		virtual_router_id 101
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		priority 99
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		advert_int 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		authentication {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			auth_type PASS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			auth_pass K8SHA_KA_AUTH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		virtual_ipaddress {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			192.168.80.220/24
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		track_script {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			chk_apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>æ‰€æœ‰<code>Master</code><!-- raw HTML omitted -->èŠ‚ç‚¹è®¾ç½®ç›‘æ§è„šæœ¬ï¼Œå¹¶ä¸”ç»™äºˆæ‰§è¡Œæƒé™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/check_apiserver.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">err=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for k in $(seq 1 5)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	check_code=$(pgrep kube-apiserver)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	if [[ $check_code == &#34;&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		err=$(expr $err + 1)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		continue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		err=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		break
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [[ $err != &#34;0&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	echo &#34;systemctl stop keepalived&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/usr/bin/systemctl stop keepalived
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	exit 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>$ chmod +x /etc/keepalived/check_apiserver.sh</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li>æ‰€æœ‰<code>Master</code><!-- raw HTML omitted -->èŠ‚ç‚¹å¯åŠ¨<!-- raw HTML omitted --><code>HAProxy</code>å’Œ<code>Keepalived</code>å¹¶ä¸”æµ‹è¯•<code>VIP(è™šæ‹ŸIP)</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable --now haproxy
</span></span><span style="display:flex;"><span>$ systemctl enable --now keepalived
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ping 192.168.80.220 -c <span style="color:#ae81ff">4</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆå§‹åŒ–kubernetes">åˆå§‹åŒ–<code>Kubernetes</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å‘½ä»¤è¡Œ<!-- raw HTML omitted --><!-- raw HTML omitted -->æ–¹å¼åˆå§‹åŒ–æ‰€æœ‰<!-- raw HTML omitted --><code>Master</code>èŠ‚ç‚¹</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>åœ¨<code>k8s-master01</code><!-- raw HTML omitted -->èŠ‚ç‚¹æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm init <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --apiserver-advertise-address<span style="color:#f92672">=</span>192.168.80.210 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --image-repository registry.aliyuncs.com/google_containers <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --control-plane-endpoint<span style="color:#f92672">=</span>192.168.80.225:16443 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --kubernetes-version v1.20.2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --service-cidr<span style="color:#f92672">=</span>10.96.0.0/12 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --pod-network-cidr<span style="color:#f92672">=</span>10.244.0.0/16 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --cri-socket unix:///var/run/containerd/containerd.sock  	<span style="color:#75715e"># é…ç½® CRI ç«¯ç‚¹</span>
</span></span><span style="display:flex;"><span>  --upload-certs</span></span></code></pre></div><ul>
<li>å°†<code>k8s-master02</code><!-- raw HTML omitted -->èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œå…¶ä»–<code>master</code>èŠ‚ç‚¹åŠ å…¥åŒæ ·å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm join 192.168.80.225:16443 --token povqsg.arg07e5ia1pywr71 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --discovery-token-ca-cert-hash sha256:9efd30b7f35747289b9de0c8d0768b9c2d5eb7d675cb86fa05b9a6d9526c3441 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --control-plane --certificate-key 363cc6296537b41607851c10f1f41ef23cf5cdc6965cb9c26e4b252315086855</span></span></code></pre></div><ul>
<li>é˜²æ­¢åœ¨<code>Master-02</code><!-- raw HTML omitted -->èŠ‚ç‚¹ä¸­ä¸èƒ½ä½¿ç”¨<!-- raw HTML omitted --><code>kubectl</code>å‘½ä»¤</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p $HOME/.kube
</span></span><span style="display:flex;"><span>$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style="display:flex;"><span>$ sudo chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config</span></span></code></pre></div><ul>
<li>å¦‚æœ<code>Token</code>è¿‡æœŸï¼Œéœ€è¦åœ¨<code>Master-01</code><!-- raw HTML omitted -->ç”Ÿæˆæ–°çš„<!-- raw HTML omitted --><code>Token</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm token create --print-join-command</span></span></code></pre></div><ul>
<li>å¦‚æœ<code>Master</code><!-- raw HTML omitted -->è¦åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œéœ€è¦åœ¨<!-- raw HTML omitted --><code>Master-01</code>ç”Ÿæˆ<code>--certificate-key</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm init phase upload-certs --upload-certs</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code> yaml</code><!-- raw HTML omitted -->æ–¹å¼åˆå§‹åŒ–æ‰€æœ‰<!-- raw HTML omitted --><code>Master</code>èŠ‚ç‚¹</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>åœ¨<code>k8s-master01</code><!-- raw HTML omitted -->åˆ›å»ºç›®å½•ç”Ÿæˆé…ç½®æ–‡ä»¶<!-- raw HTML omitted --><code>kubeadm-config.yaml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/k8s/yaml
</span></span><span style="display:flex;"><span>$ kubeadm config print init-defaults &gt;/opt/k8s/yaml/kubeadm-config.yaml
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>apiVersion: kubeadm.k8s.io/v1beta3
</span></span><span style="display:flex;"><span>bootstrapTokens:
</span></span><span style="display:flex;"><span>- groups:
</span></span><span style="display:flex;"><span>    - system:bootstrappers:kubeadm:default-node-token
</span></span><span style="display:flex;"><span>    token: abcdef.0123456789abcdef
</span></span><span style="display:flex;"><span>    ttl: 24h0m0s
</span></span><span style="display:flex;"><span>    usages:
</span></span><span style="display:flex;"><span>    - signing
</span></span><span style="display:flex;"><span>    - authentication
</span></span><span style="display:flex;"><span>kind: InitConfiguration
</span></span><span style="display:flex;"><span>localAPIEndpoint:
</span></span><span style="display:flex;"><span>    advertiseAddress: 1.2.3.4  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºmasteræœ¬æœºIP</span>
</span></span><span style="display:flex;"><span>    bindPort: <span style="color:#ae81ff">6443</span>  	<span style="color:#75715e"># ä½¿ç”¨ç«¯å£</span>
</span></span><span style="display:flex;"><span>nodeRegistration:
</span></span><span style="display:flex;"><span>    criSocket: unix:///var/run/containerd/containerd.sock  	<span style="color:#75715e"># é…ç½® CRI ç«¯ç‚¹</span>
</span></span><span style="display:flex;"><span>    imagePullPolicy: IfNotPresent
</span></span><span style="display:flex;"><span>    name: node  	<span style="color:#75715e"># é…ç½®ä¸»æœºåï¼Œ ä¸»æœºåä¸å…è®¸ä½¿ç”¨ä¸‹åˆ’çº¿</span>
</span></span><span style="display:flex;"><span>    taints: null
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>apiServer:
</span></span><span style="display:flex;"><span>    timeoutForControlPlane: 4m0s
</span></span><span style="display:flex;"><span>apiVersion: kubeadm.k8s.io/v1beta3
</span></span><span style="display:flex;"><span>certificatesDir: /etc/kubernetes/pki
</span></span><span style="display:flex;"><span>clusterName: kubernetes
</span></span><span style="display:flex;"><span>controllerManager: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>dns: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>etcd:
</span></span><span style="display:flex;"><span>    local:
</span></span><span style="display:flex;"><span>        dataDir: /var/lib/etcd
</span></span><span style="display:flex;"><span>imageRepository: k8s.gcr.io  	<span style="color:#75715e"># å®šä¹‰ä½¿ç”¨é•œåƒæº</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># imageRepository: registry.aliyuncs.com/google_containers  	# é˜¿é‡Œäº‘é•œåƒæº</span>
</span></span><span style="display:flex;"><span>kind: ClusterConfiguration
</span></span><span style="display:flex;"><span>kubernetesVersion: 1.24.0  	<span style="color:#75715e"># å®šä¹‰kubernetesç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>networking:
</span></span><span style="display:flex;"><span>    dnsDomain: cluster.local
</span></span><span style="display:flex;"><span>    serviceSubnet: 10.96.0.0/12
</span></span><span style="display:flex;"><span>scheduler: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span><span style="display:flex;"><span>kind: KubeProxyConfiguration
</span></span><span style="display:flex;"><span>featureGates:
</span></span><span style="display:flex;"><span>    SupportIPVSProxyMode: true
</span></span><span style="display:flex;"><span>mode: ipvs  	<span style="color:#75715e"># å¯ç”¨ipvs</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤æ›´æ–°<!-- raw HTML omitted --><code>kubeadm-config.yaml</code>æ–‡ä»¶ï¼Œéœ€è¦å°†<code>k8s</code>è®¾ç½®åˆ°å¯¹åº”çš„ç‰ˆæœ¬</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm config migrate --old-config /opt/k8s/yaml/kubeadm-config.yaml --new-config <span style="color:#e6db74">&#34;new.yaml&#34;</span></span></span></code></pre></div><ul>
<li>å°†<code>new.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶å¤åˆ¶åˆ°æ‰€æœ‰çš„<!-- raw HTML omitted --><code>master</code>èŠ‚ç‚¹</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ scp new.yaml k8s-master-02:/opt/k8s/yaml/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ä»¥åŠä¸‹è½½æ‰€æœ‰masterèŠ‚ç‚¹æå‰ä¸‹è½½é•œåƒ</span>
</span></span><span style="display:flex;"><span>$ kubeadm config images pull --config /opt/k8s/yaml/new.yaml  	<span style="color:#75715e"># pullæ›¿æ¢listå¯æŸ¥çœ‹æ‰€éœ€é•œåƒ</span></span></span></code></pre></div><ul>
<li><code>k8s-master01</code>èŠ‚ç‚¹åˆå§‹åŒ–åï¼Œä¼šåœ¨<code>/etc/kubernetes</code><!-- raw HTML omitted -->ç›®å½•ä¸‹ç”Ÿæˆå¯¹åº”çš„è¯ä¹¦å’Œé…ç½®æ–‡ä»¶ï¼Œä¹‹åå…¶ä»–çš„<!-- raw HTML omitted --><code>Master</code>èŠ‚ç‚¹åŠ å…¥åˆ°<code>k8s-master01</code>èŠ‚ç‚¹å³å¯</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm init --config /opt/k8s/yaml/new.yaml --upload-certs</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œé‡ç½®åå†æ¬¡åˆå§‹åŒ–ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm reset -f;ipvsadm --clear;rm -rf ~/.kube</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆå§‹åŒ–æˆåŠŸåï¼Œä¼šäº§ç”Ÿ<!-- raw HTML omitted --><code>token</code>å€¼ï¼Œç”¨äºå…¶ä»–èŠ‚ç‚¹åŠ å…¥æ—¶ä½¿ç”¨ï¼Œ</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Your Kubernetes control-plane has initialized successfully!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>To start using your cluster, you need to run the following as a regular user:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mkdir -p $HOME/.kube
</span></span><span style="display:flex;"><span>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style="display:flex;"><span>  sudo chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Alternatively, <span style="color:#66d9ef">if</span> you are the root user, you can run:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  export KUBECONFIG<span style="color:#f92672">=</span>/etc/kubernetes/admin.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>You should now deploy a pod network to the cluster.
</span></span><span style="display:flex;"><span>Run <span style="color:#e6db74">&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
</span></span><span style="display:flex;"><span>  https://kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>You can now join any number of the control-plane node running the following command on each as root:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># å…¶ä»– Master èŠ‚ç‚¹æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>  kubeadm join 192.168.80.210:16443 --token abcdef.0123456789abcdef <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --discovery-token-ca-cert-hash sha256:505e373bae6123fc3e27e778c5fedbccbf0f91a51efdcc11b32c4573605b8e71 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --control-plane --certificate-key 70aef5f76111a5824085c644b3f34cf830efad00c1b16b878701166bf069664e
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Please note that the certificate-key gives access to cluster sensitive data, keep it secret!
</span></span><span style="display:flex;"><span>As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;kubeadm init phase upload-certs --upload-certs&#34;</span> to reload certs afterward.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Then you can join any number of worker nodes by running the following on each as root:
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰€æœ‰ Node èŠ‚ç‚¹æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>kubeadm join 192.168.80.210:16443 --token abcdef.0123456789abcdef <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --discovery-token-ca-cert-hash sha256:505e373bae6123fc3e27e778c5fedbccbf0f91a51efdcc11b32c4573605b8e71</span></span></code></pre></div><ul>
<li><code>k8s-master01</code><!-- raw HTML omitted -->èŠ‚ç‚¹é…ç½®ç¯å¢ƒå˜é‡ï¼Œç”¨äºè®¿é—®<!-- raw HTML omitted --><code>kubernetes</code>é›†ç¾¤</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># rootç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/root/.bashrc<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export KUBECONFIG=/etc/kubernetes/admin.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ source ~/.bash_profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ™®é€šç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>$ mkdir -p $HOME/.kube
</span></span><span style="display:flex;"><span>$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style="display:flex;"><span>$ sudo chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># k8s-master-01ä¸­æŸ¥çœ‹èŠ‚ç‚¹çš„çŠ¶æ€ï¼š</span>
</span></span><span style="display:flex;"><span>$ kubectl get nodes</span></span></code></pre></div></blockquote>
<hr>
<h3 id="nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤-1"><code>Node</code>èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æ‰€æœ‰<!-- raw HTML omitted --><code>Node</code><!-- raw HTML omitted -->èŠ‚ç‚¹æ‰§è¡Œ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm join 192.168.80.225:16443 --token povqsg.arg07e5ia1pywr71 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --discovery-token-ca-cert-hash sha256:9efd30b7f35747289b9de0c8d0768b9c2d5eb7d675cb86fa05b9a6d9526c3441</span></span></code></pre></div></blockquote>
<hr>
<h2 id="font-colorredäºŒè¿›åˆ¶å®‰è£…fontkubernetes"><!-- raw HTML omitted -->äºŒè¿›åˆ¶å®‰è£…<!-- raw HTML omitted --><code>kubernetes</code></h2>
<h3 id="éƒ¨ç½²etcdå­˜å‚¨é›†ç¾¤ä¸‰å°ä¸»æœºä½œä¸ºèŠ‚ç‚¹">éƒ¨ç½²<code>Etcd</code>å­˜å‚¨é›†ç¾¤ã€ä¸‰å°ä¸»æœºä½œä¸ºèŠ‚ç‚¹</h3>
<ul>
<li>
<ol>
<li>é”®å€¼å¯¹æ•°æ®åº“ï¼Œå­˜å‚¨<code>K8S</code>é›†ç¾¤æ‰€æœ‰é‡è¦ä¿¡æ¯(æŒä¹…åŒ–)  <a href="https://blog.csdn.net/qq_27276045/article/details/115650151" rel="external" target="_self"><code>Kubernetes</code>å­˜å‚¨å¤§è„‘ä¹‹<code>etcd</code></a>ã€<a href="https://www.infoq.cn/article/rhzug069xvr5z5bhhtiv" rel="external" target="_self">çªç ´<code>etcd</code>é™åˆ¶ï¼å­—èŠ‚å¼€æºè‡ªç ”<code>K8s</code>å­˜å‚¨<code>KubeBrain</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>Etcd æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼ŒKubernetesä½¿ç”¨Etcdè¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œæ‰€ä»¥å…ˆå‡†å¤‡ä¸€ä¸ªEtcdæ•°æ®åº“ï¼Œä¸ºè§£å†³Etcdå•ç‚¹æ•…éšœï¼Œåº”é‡‡ç”¨é›†ç¾¤æ–¹å¼éƒ¨ç½²ï¼Œè¿™é‡Œä½¿ç”¨3å°ç»„å»ºé›†ç¾¤ï¼Œå¯å®¹å¿1å°æœºå™¨æ•…éšœï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨5å°ç»„å»ºé›†ç¾¤ï¼Œå¯å®¹å¿2å°æœºå™¨æ•…éšœ</span></span></code></pre></div><ul>
<li>1.1 æ³¨æ„è¿™é‡Œ<code>profiles</code>å­—æ®µä¸‹åç§°ï¼Œå…¶ä¸­<code>CjServer</code>ä¸‹æ³¨æ˜<code>server auth</code>ç”¨äºæœåŠ¡å™¨ç«¯è®¤è¯ï¼Œåç»­åœ¨ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨è¿™ä¸ªåç§°ä½œä¸º<code>cfssl</code>å‘½ä»¤çš„é…ç½®æ–‡ä»¶åç§°ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</li>
<li>1.2 æ³¨æ„è¿™é‡Œ<code>profiles</code>å­—æ®µä¸‹åç§°ï¼Œå…¶ä¸­<code>CjServer</code>ä¸‹æ³¨æ˜<code>server auth</code>ç”¨äºæœåŠ¡å™¨ç«¯è®¤è¯ï¼Œåç»­åœ¨ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨è¿™ä¸ªåç§°ä½œä¸º<code>cfssl</code>å‘½ä»¤çš„é…ç½®æ–‡ä»¶åç§°ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#34;code&#34;</span>:5100,<span style="color:#e6db74">&#34;message&#34;</span>:<span style="color:#e6db74">&#34;Invalid policy: no key usage available&#34;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>Failed to parse input: unexpected end of JSON input</span></span></code></pre></div><ul>
<li>1.3 å¾€å¾€æ˜¯æä¾›çš„<code>-profile</code>å‚æ•°ä¸­çš„é…ç½®æ–‡ä»¶ååœ¨<code>ca-config.json</code>ä¸­æ— æ³•åŒ¹é…</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 1.å‡†å¤‡cfsslè¯ä¹¦ç”Ÿæˆå·¥å…·ã€cfsslæ˜¯ä¸€ä¸ªå¼€æºçš„è¯ä¹¦ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨jsonæ–‡ä»¶ç”Ÿæˆè¯ä¹¦ï¼Œæ‰¾ä»»æ„ä¸€å°æœåŠ¡å™¨æ“ä½œï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /usr/local/src/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64  	# æ˜¯v1.2.0 æœ€å¥½å‡çº§åˆ°v1.3.4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ chmod +x cfssl_linux-amd64 cfssljson_linux-amd64 cfssl-certinfo_linux-amd64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ·»åŠ ç¯å¢ƒå˜é‡ç¬¬ä¸€ç§æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ vim /etc/profile
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=$PATH:/opt/kubernetes/bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ source /etc/profile
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æŠŠå¯æ‰§è¡Œæ–‡ä»¶æŒªç§»å¹¶æ”¹å
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ mv cfssl_linux-amd64 /usr/local/bin/cfssl
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ mv cfssljson_linux-amd64 /usr/local/bin/cfssljson
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ mv cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 2.ç”ŸæˆEtcdè¯ä¹¦ã€è‡ªç­¾è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰åˆ›å»ºå·¥ä½œç›®å½•ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt;/opt/kubernetes/ssl/ca-config.json&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;signing&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;default&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;expiry&#34;: &#34;87600h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;profiles&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;kubernetes&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         &#34;expiry&#34;: &#34;87600h&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         &#34;usages&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;signing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;key encipherment&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;server auth&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;client auth&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">###################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt;/opt/kubernetes/ssl/ca-csr.json&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;CN&#34;: &#34;etcd CA&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;key&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;algo&#34;: &#34;rsa&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;size&#34;: 2048
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;names&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;C&#34;: &#34;CN&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;L&#34;: &#34;Beijing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;ST&#34;: &#34;Beijing&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 3.ç”Ÿæˆè¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /opt/kubernetes/ssl/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cfssl gencert -initca ca-csr.json | cfssljson -bare ca -
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 4. ä½¿ç”¨è‡ªç­¾CAç­¾å‘Etcd HTTPSè¯ä¹¦:åˆ›å»ºè¯ä¹¦ç”³è¯·æ–‡ä»¶  #####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt;/opt/kubernetes/ssl/etcd-csr.json&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;CN&#34;: &#34;etcd&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;hosts&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;192.168.4.110&#34;, # ä¿®æ”¹IPã€ä¸ºäº†æ‰©å®¹æ–¹ä¾¿å¯ä»¥å¤šå†™å‡ ä¸ªIPã€å»æ‰æ³¨é‡Š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;192.168.4.111&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;192.168.4.112&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;xxx.xxx.xxx.xxx&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;xxx.xxx.xxx.xxx&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;xxx.xxx.xxx.xxx&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;key&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;algo&#34;: &#34;rsa&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;size&#34;: 2048
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;names&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;C&#34;: &#34;CN&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;L&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;ST&#34;: &#34;BeiJing&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 5. ç”Ÿæˆè¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /opt/kubernetes/ssl/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes etcd-csr.json | cfssljson -bare etcd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 6.åœ¨GitHubä¸Šä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /usr/local/src/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ wget https://github.com/etcd-io/etcd/releases/download/v3.4.14/etcd-v3.4.14-linux-amd64.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ tar zxvf etcd-v3.4.14-linux-amd64.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ mv etcd-v3.4.14-linux-amd64/{etcd,etcdctl} /opt/etcd/bin/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 6.åˆ›å»ºetcdé…ç½®æ–‡ä»¶ï¼šé’ˆå¯¹IPä¿®æ”¹ä¸ºæœ¬æœºIPï¼Œæ‹·è´è¿‡å»åæŠŠæ‰€æœ‰ç»“å°¾çš„â€œæ³¨é‡Šå–æ¶ˆæ‰â€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt;/opt/etcd/cfg/etcd.conf&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># [Member]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_NAME=&#34;etcd-node1&#34;  	# ä¿®æ”¹æ­¤å¤„ï¼ŒèŠ‚ç‚¹2æ”¹ä¸ºetcd-2ï¼ŒèŠ‚ç‚¹3æ”¹ä¸ºetcd-3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_DATA_DIR=&#34;/var/lib/etcd/default.etcd&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_LISTEN_PEER_URLS=&#34;https://192.168.4.110:2380&#34;  	# ä¿®æ”¹æ­¤å¤„ä¸ºå½“å‰æœåŠ¡å™¨IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_LISTEN_CLIENT_URLS=&#34;https://192.168.4.110:2379,https://127.0.0.1:2379&#34;  	# ä¿®æ”¹æ­¤å¤„ä¸ºå½“å‰æœåŠ¡å™¨IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># [Clustering]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_INITIAL_ADVERTISE_PEER_URLS=&#34;https://192.168.4.110:2380&#34;  	# ä¿®æ”¹æ­¤å¤„ä¸ºå½“å‰æœåŠ¡å™¨IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_ADVERTISE_CLIENT_URLS=&#34;https://192.168.4.110:2379&#34;  # ä¿®æ”¹æ­¤å¤„ä¸ºå½“å‰æœåŠ¡å™¨IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹ä¸ºæ‰€æœ‰èŠ‚ç‚¹IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_INITIAL_CLUSTER=&#34;etcd-node1=https://192.168.4.110:2380,etcd-node2=https://192.168.4.111:2380,etcd-node3=https://192.168.4.112:2380&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_INITIAL_CLUSTER_TOKEN=&#34;etcd-cluster&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_INITIAL_CLUSTER_STATE=&#34;new&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># [security]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># CLIENT_CERT_AUTH=&#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_CA_FILE=&#34;/opt/etcd/ssl/ca.pem&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_CERT_FILE=&#34;/opt/etcd/ssl/server.pem&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_KEY_FILE=&#34;/opt/etcd/ssl/server-key.pem&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># PEER_CLIENT_CERT_AUTH=&#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_PEER_CA_FILE=&#34;/opt/etcd/ssl/ca.pem&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_PEER_CERT_FILE=&#34;/opt/etcd/ssl/server.pem&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_PEER_KEY_FILE=&#34;/opt/etcd/ssl/server-key.pem&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#####################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_NAMEï¼šèŠ‚ç‚¹åç§°ï¼Œé›†ç¾¤ä¸­å”¯ä¸€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_DATA_DIRï¼šæ•°æ®ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_LISTEN_PEER_URLSï¼šé›†ç¾¤é€šä¿¡ç›‘å¬åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_LISTEN_CLIENT_URLSï¼šå®¢æˆ·ç«¯è®¿é—®ç›‘å¬åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_INITIAL_ADVERTISE_PEER_URLSï¼šé›†ç¾¤é€šå‘Šåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_ADVERTISE_CLIENT_URLSï¼šå®¢æˆ·ç«¯é€šå‘Šåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_INITIAL_CLUSTERï¼šé›†ç¾¤èŠ‚ç‚¹åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_INITIAL_CLUSTER_TOKENï¼šé›†ç¾¤Token
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_INITIAL_CLUSTER_STATEï¼šåŠ å…¥é›†ç¾¤çš„å½“å‰çŠ¶æ€ï¼Œnewæ˜¯æ–°é›†ç¾¤ï¼Œexistingè¡¨ç¤ºåŠ å…¥å·²æœ‰é›†ç¾¤
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 7.systemctlç®¡ç†etcd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt;/usr/lib/systemd/system/etcd.service&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Etcd Server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network-online.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Wants=network-online.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=notify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EnvironmentFile=/opt/etcd/cfg/etcd.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/etcd/bin/etcd \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cert-file=/opt/etcd/ssl/etcd.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--key-file=/opt/etcd/ssl/etcd-key.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--peer-cert-file=/opt/etcd/ssl/etcd.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--peer-key-file=/opt/etcd/ssl/etcd-key.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--trusted-ca-file=/opt/etcd/ssl/ca.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--peer-trusted-ca-file=/opt/etcd/ssl/ca.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--logger=zap
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">###################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 8.æ‹·è´åˆšåˆšç”Ÿæˆè¯ä¹¦åˆ°etcdç›®å½•ä¸‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /opt/kubernetes/ssl/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cp ca*.pem etcd*.pem /opt/etcd/ssl/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 9.èŠ‚ç‚¹1ç”Ÿæˆçš„æ‰€æœ‰æ–‡ä»¶æ‹·è´åˆ°å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹ã€ç„¶ååœ¨å…¶ä»–èŠ‚ç‚¹åˆ†åˆ«ä¿®æ”¹etcd.confé…ç½®æ–‡ä»¶ä¸­çš„èŠ‚ç‚¹åç§°å’Œå½“å‰æœåŠ¡å™¨IPï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ ansible node -i /etc/ansible/hosts -m copy -a &#34;src=../../../opt/etcd dest=/opt&#34; -f 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ ansible node -i /etc/ansible/hosts -m copy -a &#34;src=../../../usr/lib/systemd/system/etcd.service dest=/usr/lib/systemd/system&#34; -f 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ mkdir -p /var/lib/etcd  	# ä¸‰ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ chmod +x /opt/etcd/bin/*  	# å…¶ä»–ä¸¤ä¸ªèŠ‚ç‚¹æ‰§è¡Œè¯­å¥ç»™äºˆæ‰§è¡Œæƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 10.æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¼€æœºè‡ªå¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ systemctl daemon-reload
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ systemctl enable etcd &amp;&amp; systemctl start etcd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æµ‹è¯•etcdæ•°æ®åº“å¯ç”¨æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ etcdctl set testdir/testkey0 0  	# è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ etcdctl get testdir/testkey0  	# æŸ¥çœ‹æ˜¯å¦è·å–åˆ°æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ etcdctl -C http://localhost:2379 cluster-health
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 11.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ ETCDCTL_API=3 /opt/etcd/bin/etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/etcd.pem --key=/opt/etcd/ssl/etcd-key.pem --endpoints=&#34;https://192.168.4.110:2379,https://192.168.4.111:2379,https://192.168.4.112:2379&#34; endpoint health &#39;</span> &gt;&gt;install_etcd.sh</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ç½²master-nodeç”Ÿæˆkube-apiserverè¯ä¹¦è‡ªç­¾è¯ä¹¦é¢å‘æœºæ„ca">ç½²<code>Master Node</code>ï¼Œç”Ÿæˆ<code>kube-apiserver</code>è¯ä¹¦ï¼šè‡ªç­¾è¯ä¹¦é¢å‘æœºæ„<code>CA</code></h3>
<ul>
<li>
<ol>
<li><code>api-serverï¼š</code>æ‰€æœ‰æœåŠ¡è®¿é—®ç»Ÿä¸€å…¥å£</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 1.åˆ›å»ºè¯ä¹¦ç”³è¯·æ–‡ä»¶ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># hostså­—æ®µä¸­IPä¸ºæ‰€æœ‰Master/LB/VIP IP,ä¸€ä¸ªéƒ½ä¸èƒ½å°‘ï¼ä¸ºäº†æ–¹ä¾¿åæœŸæ‰©å®¹å¯ä»¥å¤šå†™å‡ ä¸ªé¢„ç•™çš„IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt; /opt/kubernetes/ssl/kube-apiserver-csr.json &lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;CN&#34;: &#34;kubernetes&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;hosts&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;10.0.0.1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;127.0.0.1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;192.168.4.110&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;192.168.4.111&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;192.168.4.112&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;xxx.xxx.xxx.xxx&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;xxx.xxx.xxx.xxx&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;kubernetes&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;kubernetes.default&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;kubernetes.default.svc&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;kubernetes.default.svc.cluster&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;kubernetes.default.svc.cluster.local&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;key&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;algo&#34;: &#34;rsa&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;size&#34;: 2048
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;names&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;C&#34;: &#34;CN&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;L&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;ST&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;O&#34;: &#34;k8s&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;OU&#34;: &#34;System&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">######################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 2.ç”Ÿæˆè¯ä¹¦:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /opt/kubernetes/ssl
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-apiserver-csr.json | cfssljson -bare api-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰“å¼€é“¾æ¥ä¸‹è½½äºŒè¿›åˆ¶åŒ…
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.20.md#v1202
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /usr/local/src
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ wget https://dl.k8s.io/v1.18.6/kubernetes-server-linux-amd64.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ tar zxvf kubernetes-server-linux-amd64.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd kubernetes/server/bin/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cp kube-apiserver kube-scheduler kube-controller-manager /opt/kubernetes/bin/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cp kubectl /usr/bin/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 3.éƒ¨ç½²kube-apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¸¤ä¸ª&#34;\\&#34;ç¬¬ä¸€ä¸ªæ˜¯è½¬ä¹‰ç¬¦ï¼Œç¬¬äºŒä¸ªæ˜¯æ¢è¡Œç¬¦ï¼Œä½¿ç”¨è½¬ä¹‰ç¬¦æ˜¯ä¸ºäº†ä½¿ç”¨EOFä¿ç•™æ¢è¡Œç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt;/opt/kubernetes/cfg/kube-apiserver.conf&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBE_APISERVER_OPTS=&#34;--logtostderr=false \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--v=2 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--log-dir=/opt/kubernetes/logs \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--etcd-servers=https://192.168.4.110:2379,https://192.168.4.111:2379,https://192.168.4.112:2379 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--bind-address=192.168.4.110 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--secure-port=6443 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--advertise-address=192.168.4.110 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--allow-privileged=true \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-cluster-ip-range=10.0.0.0/24 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--authorization-mode=RBAC,Node \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--enable-bootstrap-token-auth=true \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--token-auth-file=/opt/kubernetes/cfg/token.csv \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-node-port-range=30000-32767 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--kubelet-client-certificate=/opt/kubernetes/ssl/api-server.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--kubelet-client-key=/opt/kubernetes/ssl/api-server-key.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--tls-cert-file=/opt/kubernetes/ssl/api-server.pem  \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--tls-private-key-file=/opt/kubernetes/ssl/api-server-key.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--client-ca-file=/opt/kubernetes/ssl/ca.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-account-key-file=/opt/kubernetes/ssl/ca-key.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--etcd-cafile=/opt/etcd/ssl/ca.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--etcd-certfile=/opt/etcd/ssl/server.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--etcd-keyfile=/opt/etcd/ssl/server-key.pem \\  	# è¯ä¹¦éœ€è¦ä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--audit-log-maxbackup=3 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--audit-log-maxsize=100 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--audit-log-path=/opt/kubernetes/logs/k8s-audit.log&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#######################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“logtostderrï¼šå¯ç”¨æ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€”vï¼šæ—¥å¿—ç­‰çº§
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“log-dirï¼šæ—¥å¿—ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“etcd-serversï¼šetcdé›†ç¾¤åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“bind-addressï¼šç›‘å¬åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“secure-portï¼šhttpså®‰å…¨ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“advertise-addressï¼šé›†ç¾¤é€šå‘Šåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“allow-privilegedï¼šå¯ç”¨æˆæƒ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“service-cluster-ip-rangeï¼šServiceè™šæ‹ŸIPåœ°å€æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“enable-admission-pluginsï¼šå‡†å…¥æ§åˆ¶æ¨¡å—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“authorization-modeï¼šè®¤è¯æˆæƒï¼Œå¯ç”¨RBACæˆæƒå’ŒèŠ‚ç‚¹è‡ªç®¡ç†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“enable-bootstrap-token-authï¼šå¯ç”¨TLS bootstrapæœºåˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“token-auth-fileï¼šbootstrap tokenæ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“service-node-port-rangeï¼šService nodeportç±»å‹é»˜è®¤åˆ†é…ç«¯å£èŒƒå›´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“kubelet-client-xxxï¼šapiserverè®¿é—®kubeletå®¢æˆ·ç«¯è¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“tls-xxx-fileï¼šapiserver httpsè¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“etcd-xxxfileï¼šè¿æ¥Etcdé›†ç¾¤è¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“audit-log-xxxï¼šå®¡è®¡æ—¥å¿— &#39;</span>&gt;&gt; kube-apiserver.sh</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å¯ç”¨tls-bootstrappingæœºåˆ¶">å¯ç”¨<code>TLS Bootstrapping</code>æœºåˆ¶</h3>
<ul>
<li>
<ol>
<li><code>TLS Bootstrapingï¼šMaster apiserver</code>å¯ç”¨<code>TLS</code>è®¤è¯åï¼Œ<code>Node</code>èŠ‚ç‚¹<code>kubelet</code>å’Œ<code>kube-proxy</code>è¦ä¸<code>kube-apiserver</code>è¿›è¡Œé€šä¿¡ï¼Œå¿…é¡»ä½¿ç”¨<code>CA</code>ç­¾å‘çš„æœ‰æ•ˆè¯ä¹¦æ‰å¯ä»¥ï¼Œå½“<code>Node</code>èŠ‚ç‚¹å¾ˆå¤šæ—¶ï¼Œè¿™ç§å®¢æˆ·ç«¯è¯ä¹¦é¢å‘éœ€è¦å¤§é‡å·¥ä½œï¼ŒåŒæ ·ä¹Ÿä¼šå¢åŠ é›†ç¾¤æ‰©å±•å¤æ‚åº¦ã€‚ä¸ºäº†ç®€åŒ–æµç¨‹ï¼Œ<code>Kubernetes</code>å¼•å…¥äº†<code>TLS bootstraping</code>æœºåˆ¶æ¥è‡ªåŠ¨é¢å‘å®¢æˆ·ç«¯è¯ä¹¦ï¼Œ<code>kubelet</code>ä¼šä»¥ä¸€ä¸ªä½æƒé™ç”¨æˆ·è‡ªåŠ¨å‘<code>apiserver</code>ç”³è¯·è¯ä¹¦ï¼Œ<code>kubelet</code>çš„è¯ä¹¦ç”±<code>apiserver</code>åŠ¨æ€ç­¾ç½²ã€‚æ‰€ä»¥å¼ºçƒˆå»ºè®®åœ¨<code>Node</code>ä¸Šä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç›®å‰ä¸»è¦ç”¨äº<code>kubelet</code>ï¼Œ<code>kube-proxy</code>è¿˜æ˜¯ç”±æˆ‘ä»¬ç»Ÿä¸€é¢å‘ä¸€ä¸ªè¯ä¹¦</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cat &gt;/opt/kubernetes/cfg/token.csv&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$(head -c 16 /dev/urandom | od -An -t x | tr -d &#39;</span> <span style="color:#e6db74">&#39;),kubelet-bootstrap,10001,&#34;system:node-bootstrapper&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">###########################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è‡ªè¡Œç”Ÿæˆtoken
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># token=$(head -c 16 /dev/urandom | od -An -t x | tr -d &#39;</span> <span style="color:#e6db74">&#39;)  	# Cè¯­è¨€æ‰§è¡Œç”Ÿæˆæ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># token=`head -c 16 /dev/urandom | od -An -t x | tr -d &#39;</span> <span style="color:#e6db74">&#39;`  	# shellæ‰§è¡Œç”Ÿæˆæ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sed -i &#34;s/c47ffb939f5ca36231d9e3121a252940/${token}/g&#34;  /opt/kubernetes/cfg/token.csv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># systemctç®¡ç†apiserverã€å¹¶è®¾ç½®å¼€æœºè‡ªå¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cat &gt;/usr/lib/systemd/system/kube-apiserver.service&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes API Server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://github.com/kubernetes/kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EnvironmentFile=/opt/kubernetes/cfg/kube-apiserver.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/kubernetes/bin/kube-apiserver \$KUBE_APISERVER_OPTS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#######################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ systemctl daemon-reload
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ systemctl enable kube-apiserver &amp;&amp; systemctl start kube-apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># kube-apiserveræŠ¥é”™æ’æŸ¥
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat /var/log/messages|grep kube-apiserver|grep -i error  	# -iä¸åŒºåˆ†å¤§å°å†™
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">journalctl -xe -u kube-apiserver | more  	# å‘½ä»¤æ’é”™ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 3.è®¾ç½®æˆæƒkubelet-bootstrapç”¨æˆ·å…è®¸è¯·æ±‚è¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap &#39;</span> &gt;&gt;token-apiserver.sh</span></span></code></pre></div></blockquote>
<hr>
<h3 id="éƒ¨ç½²kube-controller-manageræ§åˆ¶å™¨">éƒ¨ç½²<code>kube-controller-manager</code>(æ§åˆ¶å™¨)</h3>
<ul>
<li>
<ol>
<li><code>Pod</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>1.1 <!-- raw HTML omitted -->æœ€å°éƒ¨ç½²å•å…ƒ<!-- raw HTML omitted --></li>
<li>1.2 <!-- raw HTML omitted -->ä¸€ç»„å®¹å™¨çš„é›†åˆ<!-- raw HTML omitted --></li>
<li>1.3 <!-- raw HTML omitted -->ä¸€ä¸ª<code>Pod</code>ä¸­çš„å®¹å™¨å…±äº«ç½‘ç»œå‘½åç©ºé—´<!-- raw HTML omitted --></li>
<li>1.4 <!-- raw HTML omitted --><code>Pod</code>æ˜¯çŸ­æš‚çš„<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>Controllers</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>2.1 <!-- raw HTML omitted --><code>Deploymentï¼š</code>æ— çŠ¶æ€åº”ç”¨éƒ¨ç½²<!-- raw HTML omitted --></li>
<li>2.2 <!-- raw HTML omitted --><code>StatefulSetï¼š</code>æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²<!-- raw HTML omitted --></li>
<li>2.3 <!-- raw HTML omitted --><code>DaemonSetï¼š</code>ç¡®ä¿æ‰€æœ‰çš„<code>Node</code>è¿è¡Œä¸€ä¸ª<code>Pod</code><!-- raw HTML omitted --></li>
<li>2.4 <!-- raw HTML omitted --><code>Jobï¼š</code>ä¸€æ¬¡æ€§ä»»åŠ¡<!-- raw HTML omitted --></li>
<li>2.5 <!-- raw HTML omitted --><code>Cronjobï¼š</code>å®šæ—¶ä»»åŠ¡<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æ›´é«˜çº§å±‚çº§å¯¹è±¡ï¼Œéƒ¨ç½²å’Œç®¡ç†<code>Pod</code><!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="4">
<li><code>Service</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>4.1 <!-- raw HTML omitted -->é˜²æ­¢<code>Pod</code>å¤±è”<!-- raw HTML omitted --></li>
<li>4.2 <!-- raw HTML omitted -->å®šä¹‰ä¸€ç»„<code>Pod</code>çš„è®¿é—®ç­–ç•¥<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted --><code>Labelï¼š</code>æ ‡ç­¾ï¼Œé™„åŠ åˆ°æŸä¸ªèµ„æºä¸Šï¼Œç”¨äºå…³è”å¯¹è±¡ï¼ŒæŸ¥è¯¢å’Œç­›é€‰<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="6">
<li><!-- raw HTML omitted --><code>Namespacesï¼š</code>å‘½åç©ºé—´ï¼Œå°†å¯¹è±¡é€»è¾‘ä¸Šéš”ç¦»<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="7">
<li><!-- raw HTML omitted --><code>Controllerï¼š</code>ç»´æŒå‰¯æœ¬æœŸæœ›æ•°ç›®,<code>ReplicaSet</code>æ›¿ä»£<code>ReplicationControlled</code><!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="8">
<li><!-- raw HTML omitted --><code>deployentï¼š</code>ç®¡ç†<code>RS</code>ï¼Œå®ç°æ»šåŠ¨æ›´æ–°<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>8.1 <!-- raw HTML omitted --><code>--kubeconfigï¼š</code>è¿æ¥<code>apiserver</code>é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
<li>8.2 <!-- raw HTML omitted --><code>--masterï¼š</code>é€šè¿‡æœ¬åœ°éå®‰å…¨æœ¬åœ°ç«¯å£<code>8080</code>è¿æ¥<code>apiserver</code><!-- raw HTML omitted --></li>
<li>8.3 <!-- raw HTML omitted --><code>--leader-electï¼š</code>å½“è¯¥ç»„ä»¶å¯åŠ¨å¤šä¸ªæ—¶ï¼Œè‡ªåŠ¨é€‰ä¸¾<code>HA</code><!-- raw HTML omitted --></li>
<li>8.4 <!-- raw HTML omitted --><code>--cluster-signing-cert-file/--cluster-signing-key-fileï¼š</code>è‡ªåŠ¨ä¸º<code>kubelet</code>é¢å‘è¯ä¹¦çš„<code>CA</code>ï¼Œä¸<code>apiserver</code>ä¿æŒä¸€è‡´<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºé…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/kube-controller-manager.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBE_CONTROLLER_MANAGER_OPTS=&#34;--logtostderr=false \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--v=2 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--log-dir=/opt/kubernetes/logs \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--leader-elect=true \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--kubeconfig=/opt/kubernetes/cfg/kube-controller-manager.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--master=127.0.0.1:8080 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--bind-address=127.0.0.1 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--allocate-node-cidrs=true \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cluster-cidr=10.244.0.0/16 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-cluster-ip-range=10.0.0.0/24 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cluster-signing-cert-file=/opt/kubernetes/ssl/ca.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cluster-signing-key-file=/opt/kubernetes/ssl/ca-key.pem  \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--root-ca-file=/opt/kubernetes/ssl/ca.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-account-private-key-file=/opt/kubernetes/ssl/ca-key.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--experimental-cluster-signing-duration=87600h0m0s&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºkube-controller-manager-csr.json è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œå¯ä»¥è¶Šè¿‡</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cat &gt;/opt/kubernetes/ssl/kube-controller-manager-csr.json&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;CN&#34;: &#34;system:kube-controller-manager&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;hosts&#34;: [],</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;key&#34;: {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    &#34;algo&#34;: &#34;rsa&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    &#34;size&#34;: 2048</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  },</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;names&#34;: [</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;C&#34;: &#34;CN&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;L&#34;: &#34;BeiJing&#34;, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;ST&#34;: &#34;BeiJing&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;O&#34;: &#34;system:masters&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;OU&#34;: &#34;System&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    }</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  ]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># }</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆè¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ cd /opt/kubernetes/ssl
</span></span><span style="display:flex;"><span>$ cfssl gencert -ca<span style="color:#f92672">=</span>ca.pem -ca-key<span style="color:#f92672">=</span>ca-key.pem -config<span style="color:#f92672">=</span>ca-config.json -profile<span style="color:#f92672">=</span>kubernetes kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="9">
<li><!-- raw HTML omitted -->ç”Ÿæˆ<code>kubeconfig</code>æ–‡ä»¶ï¼ˆä»¥ä¸‹æ˜¯<code>shell</code>å‘½ä»¤ï¼Œç›´æ¥åœ¨ç»ˆç«¯æ‰§è¡Œï¼‰ï¼šå¯ä»¥è¶Šè¿‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># KUBE_CONFIG=&#34;/opt/kubernetes/cfg/kube-controller-manager.kubeconfig&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># KUBE_APISERVER=&#34;https://192.168.4.110:6443&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>$ kubectl config set-cluster kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#75715e">#  --certificate-authority=/opt/kubernetes/ssl/ca.pem \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --embed-certs=true \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --server=${KUBE_APISERVER} \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-credentials kube-controller-manager <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#75715e">#  --client-certificate=./kube-controller-manager.pem \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --client-key=./kube-controller-manager-key.pem \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --embed-certs=true \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#75715e">#  --cluster=kubernetes \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --user=kube-controller-manager \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="systemdç®¡ç†controller-manager"><code>systemd</code>ç®¡ç†<code>controller-manager</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><code>Controller manager</code>ï¼ˆé»˜è®¤ç«¯å£ï¼š<code>10252</code>ï¼‰ç›‘è§†<code>Kubernetes</code>é›†ç¾¤ï¼Œä»¥æ£€æµ‹å’Œç»´æŠ¤<code>Kubernetes</code>ç¯å¢ƒçš„å‡ ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬å°†<code>Pod</code>åŠ å…¥åˆ°æœåŠ¡ä¸­ï¼Œä¿æŒä¸€ç»„<code>Pod</code>çš„æ­£ç¡®æ•°é‡ï¼Œå¹¶å¯¹èŠ‚ç‚¹çš„ä¸¢å¤±åšå‡ºååº”<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><code>Cloud controller manager</code>ï¼ˆé»˜è®¤ç«¯å£ï¼š10258ï¼‰ä¸€ä¸ªç”¨äºåŸºäºäº‘çš„éƒ¨ç½²çš„å¯é€‰ç»„ä»¶ã€‚äº‘æ§åˆ¶å™¨ä¸äº‘æœåŠ¡æä¾›å•†æ¥å£ï¼Œä»¥ç®¡ç†é›†ç¾¤çš„è´Ÿè½½å‡è¡¡å™¨å’Œè™šæ‹Ÿç½‘ç»œ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/kube-controller-manager.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes Controller Manager
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://github.com/kubernetes/kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EnvironmentFile=/opt/kubernetes/cfg/kube-controller-manager.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/kubernetes/bin/kube-controller-manager \$KUBE_CONTROLLER_MANAGER_OPTS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecReload=/bin/kill -HUP $MAINPID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨">å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable kube-controller-manager <span style="color:#f92672">&amp;&amp;</span> systemctl start kube-controller-manager</span></span></code></pre></div></blockquote>
<hr>
<h3 id="éƒ¨ç½²kube-scheduleråˆ›å»ºé…ç½®æ–‡ä»¶è°ƒåº¦å™¨è´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦ç»„ä»¶æŠ½ç¦»">éƒ¨ç½²<code>kube-scheduler</code>:åˆ›å»ºé…ç½®æ–‡ä»¶(è°ƒåº¦å™¨è´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦,ç»„ä»¶æŠ½ç¦»)</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><code>Schedulerï¼š</code>è´Ÿè´£ä»‹ç»ä»»åŠ¡ï¼Œé€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹è¿›è¡Œåˆ†é…ä»»åŠ¡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>1.1 <!-- raw HTML omitted --><code>--kubeconfig</code>ï¼šè¿æ¥<code>apiserver</code>é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
<li>1.2 <!-- raw HTML omitted --><code>--master</code>ï¼šé€šè¿‡æœ¬åœ°éå®‰å…¨æœ¬åœ°ç«¯å£8080è¿æ¥<code>apiserver</code><!-- raw HTML omitted --></li>
<li>1.3 <!-- raw HTML omitted --><code>--leader-elect</code>ï¼šå½“è¯¥ç»„ä»¶å¯åŠ¨å¤šä¸ªæ—¶ï¼Œè‡ªåŠ¨é€‰ä¸¾(HA) <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/kube-scheduler.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBE_SCHEDULER_OPTS=&#34;--logtostderr=false \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--v=2 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--log-dir=/opt/kubernetes/logs \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--leader-elect \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#--kubeconfig=/opt/kubernetes/cfg/kube-scheduler.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--master=127.0.0.1:8080 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--bind-address=127.0.0.1&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ›å»º<code>kube-scheduler-csr.json</code>è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼šå¯ä»¥è¶Šè¿‡æ­¤æ­¥éª¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># cat &gt;/opt/kubernetes/ssl/kube-scheduler-csr.json&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;CN&#34;: &#34;system:kube-scheduler&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;hosts&#34;: [],</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;key&#34;: {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    &#34;algo&#34;: &#34;rsa&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    &#34;size&#34;: 2048</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  },</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;names&#34;: [</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;C&#34;: &#34;CN&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;L&#34;: &#34;BeiJing&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;ST&#34;: &#34;BeiJing&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;O&#34;: &#34;system:masters&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;OU&#34;: &#34;System&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    }</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  ]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># }</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆè¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ cd /opt/kubernetes/ssl
</span></span><span style="display:flex;"><span>$ cfssl gencert -ca<span style="color:#f92672">=</span>ca.pem -ca-key<span style="color:#f92672">=</span>ca-key.pem -config<span style="color:#f92672">=</span>ca-config.json -profile<span style="color:#f92672">=</span>kubernetes kube-scheduler-csr.json | cfssljson -bare kube-scheduler</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç”Ÿæˆ<code>kubeconfig</code>æ–‡ä»¶(ä»¥ä¸‹æ˜¯<code>shell</code>å‘½ä»¤ï¼Œç›´æ¥åœ¨ç»ˆç«¯æ‰§è¡Œ)ï¼šæ­¤æ­¥éª¤å¯ä»¥è¶Šè¿‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># KUBE_CONFIG=&#34;/opt/kubernetes/cfg/kube-scheduler.kubeconfig&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># KUBE_APISERVER=&#34;https://192.168.100.11:6443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-cluster kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#75715e">#  --certificate-authority=/opt/kubernetes/ssl/ca.pem \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --embed-certs=true \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --server=${KUBE_APISERVER} \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-credentials kube-scheduler <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#75715e">#  --client-certificate=./kube-scheduler.pem \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --client-key=./kube-scheduler-key.pem \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --embed-certs=true \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#75715e">#  --cluster=kubernetes \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --user=kube-scheduler \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="systemdç®¡ç†scheduler"><code>systemd</code>ç®¡ç†<code>scheduler</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/kube-scheduler.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes Scheduler
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://github.com/kubernetes/kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EnvironmentFile=/opt/kubernetes/cfg/kube-scheduler.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/kubernetes/bin/kube-scheduler \$KUBE_SCHEDULER_OPTS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è®¾ç½®å¼€æœºè‡ªå·±å¹¶ä¸”å¯åŠ¨æœåŠ¡å™¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable kube-scheduler <span style="color:#f92672">&amp;&amp;</span> systemctl start kube-scheduler</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç”Ÿæˆ<code>kubectl</code>è¿æ¥é›†ç¾¤çš„è¯ä¹¦ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/ssl/admin-csr.json<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;CN&#34;: &#34;admin&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;hosts&#34;: [],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;key&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;algo&#34;: &#34;rsa&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;size&#34;: 2048
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;names&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;C&#34;: &#34;CN&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;L&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;ST&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;O&#34;: &#34;system:masters&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;OU&#34;: &#34;System&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç”Ÿæˆè¯ä¹¦<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/kubernetes/ssl/
</span></span><span style="display:flex;"><span>$ cfssl gencert -ca<span style="color:#f92672">=</span>ca.pem -ca-key<span style="color:#f92672">=</span>ca-key.pem -config<span style="color:#f92672">=</span>ca-config.json -profile<span style="color:#f92672">=</span>kubernetes admin-csr.json | cfssljson -bare admin</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ç”Ÿæˆ<code>kubeconfig</code>æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir /root/.kube
</span></span><span style="display:flex;"><span>$ KUBE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/root/.kube/config&#34;</span>
</span></span><span style="display:flex;"><span>$ KUBE_APISERVER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://192.168.4.110:6443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-cluster kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--certificate-authority<span style="color:#f92672">=</span>/opt/kubernetes/ssl/ca.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--server<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_APISERVER<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>$ kubectl config set-credentials cluster-admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--client-certificate<span style="color:#f92672">=</span>./admin.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--client-key<span style="color:#f92672">=</span>./admin-key.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>$ kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--cluster<span style="color:#f92672">=</span>kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--user<span style="color:#f92672">=</span>cluster-admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>$ kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->é€šè¿‡<code>kubectl</code>å·¥å…·æŸ¥çœ‹å½“å‰é›†ç¾¤ç»„ä»¶çŠ¶æ€<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get cs
</span></span><span style="display:flex;"><span>NAME                 STATUS    MESSAGE             ERROR
</span></span><span style="display:flex;"><span>controller-manager   Healthy   ok                  
</span></span><span style="display:flex;"><span>scheduler            Healthy   ok                  
</span></span><span style="display:flex;"><span>etcd-0               Healthy   <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;health&#34;</span>:<span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>etcd-1               Healthy   <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;health&#34;</span>:<span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>etcd-2               Healthy   <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;health&#34;</span>:<span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">}</span> </span></span></code></pre></div></blockquote>
<hr>
<h3 id="åœ¨masteræ“ä½œéƒ¨ç½²worker-node">åœ¨<code>Master</code>æ“ä½œéƒ¨ç½²<code>Worker Node</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><code>Kubeletï¼š</code>ç›´æ¥è·Ÿå®¹å™¨å¼•æ“äº¤äº’å®ç°å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><code>Kube proxyï¼š</code>è´Ÿè´£å†™å…¥è§„åˆ™è‡³<code>iptables</code>ã€<code>ipvs</code>å®ç°æœåŠ¡æ˜ å°„è®¿é—®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>2.1 <!-- raw HTML omitted --><code>--hostname-override</code>ï¼šæ˜¾ç¤ºåç§°ï¼Œé›†ç¾¤ä¸­å”¯ä¸€<!-- raw HTML omitted --></li>
<li>2.2 <!-- raw HTML omitted --><code>--network-plugin</code>ï¼šå¯ç”¨<code>CNI</code><!-- raw HTML omitted --></li>
<li>2.3 <!-- raw HTML omitted --><code>--kubeconfig</code>ï¼šç©ºè·¯å¾„ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œåé¢ç”¨äºè¿æ¥<code>apiserver</code><!-- raw HTML omitted --></li>
<li>2.4 <!-- raw HTML omitted --><code>--bootstrap-kubeconfig</code>ï¼šé¦–æ¬¡å¯åŠ¨å‘<code>apiserver</code>ç”³è¯·è¯ä¹¦<!-- raw HTML omitted --></li>
<li>2.5 <!-- raw HTML omitted --><code>--config</code>ï¼šé…ç½®å‚æ•°æ–‡ä»¶<!-- raw HTML omitted --></li>
<li>2.6 <!-- raw HTML omitted --><code>--cert-dir</code>ï¼š<code>kubelet</code>è¯ä¹¦ç”Ÿæˆç›®å½•<!-- raw HTML omitted --></li>
<li>2.7 <!-- raw HTML omitted --><code>--pod-infra-container-image</code>ï¼šç®¡ç†<code>Pod</code>ç½‘ç»œå®¹å™¨çš„é•œåƒ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/kubernetes/server/bin/
</span></span><span style="display:flex;"><span>$ cp kubelet kube-proxy /opt/kubernetes/bin   <span style="color:#75715e"># æœ¬åœ°æ‹·è´</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># éƒ¨ç½²bubelet</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/kubelet.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBELET_OPTS=&#34;--logtostderr=false \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--v=2 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--log-dir=/opt/kubernetes/logs \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--hostname-override=k8s-master \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--network-plugin=cni \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--config=/opt/kubernetes/cfg/kubelet-config.yml \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cert-dir=/opt/kubernetes/ssl \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--pod-infra-container-image=lizhenliang/pause-amd64:3.0&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="é…ç½®å‚æ•°æ–‡ä»¶">é…ç½®å‚æ•°æ–‡ä»¶</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/kubelet-config.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: KubeletConfiguration
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: kubelet.config.k8s.io/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">address: 0.0.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port: 10250
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">readOnlyPort: 10255
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cgroupDriver: cgroupfs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clusterDNS:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - 10.0.0.2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clusterDomain: cluster.local 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">failSwapOn: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">authentication:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  anonymous:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    enabled: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  webhook:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    cacheTTL: 2m0s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  x509:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    clientCAFile: /opt/kubernetes/ssl/ca.pem 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">authorization:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  mode: Webhook
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  webhook:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    cacheAuthorizedTTL: 5m0s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    cacheUnauthorizedTTL: 30s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">evictionHard:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  imagefs.available: 15%
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  memory.available: 100Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  nodefs.available: 10%
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  nodefs.inodesFree: 5%
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">maxOpenFiles: 1000000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">maxPods: 110
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="åœ¨masterèŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆkubeletåˆæ¬¡åŠ å…¥é›†ç¾¤å¼•å¯¼bootstrapkubeconfigæ–‡ä»¶">åœ¨<code>master</code>èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆ<code>kubelet</code>åˆæ¬¡åŠ å…¥é›†ç¾¤å¼•å¯¼<code>bootstrap.kubeconfig</code>æ–‡ä»¶</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ KUBE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/opt/kubernetes/cfg/bootstrap.kubeconfig&#34;</span>
</span></span><span style="display:flex;"><span>$ KUBE_APISERVER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://192.168.4.110:6443&#34;</span> <span style="color:#75715e"># apiserver IP:PORT</span>
</span></span><span style="display:flex;"><span>$ TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bed185231bd89516f68ed5031946b9f9&#34;</span>  	<span style="color:#75715e"># ä¸token.csvé‡Œä¿æŒä¸€è‡´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆ kubelet bootstrap kubeconfig é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ kubectl config set-cluster kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--certificate-authority<span style="color:#f92672">=</span>/opt/kubernetes/ssl/ca.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--server<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_APISERVER<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>Cluster <span style="color:#e6db74">&#34;kubernetes&#34;</span> set.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-credentials <span style="color:#e6db74">&#34;kubelet-bootstrap&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--token<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>User <span style="color:#e6db74">&#34;kubelet-bootstrap&#34;</span> set.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--cluster<span style="color:#f92672">=</span>kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--user<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;kubelet-bootstrap&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>Context <span style="color:#e6db74">&#34;default&#34;</span> created.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>Switched to context <span style="color:#e6db74">&#34;default&#34;</span>.</span></span></code></pre></div></blockquote>
<hr>
<h3 id="systemç®¡ç†kubelet"><code>system</code>ç®¡ç†<code>kubelet</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt; /usr/lib/systemd/system/kubelet.service <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes Kubelet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=docker.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EnvironmentFile=/opt/kubernetes/cfg/kubelet.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/kubernetes/bin/kubelet \$KUBELET_OPTS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">####################################################################</span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable kubelet systemctl start kubelet</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ‰¹å‡†kubeletè¯ä¹¦ç”³è¯·å¹¶åŠ å…¥é›†ç¾¤">æ‰¹å‡†<code>kubelet</code>è¯ä¹¦ç”³è¯·å¹¶åŠ å…¥é›†ç¾¤</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹kubeletè¯ä¹¦è¯·æ±‚</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get csr</span>
</span></span><span style="display:flex;"><span>NAME                                                   AGE     SIGNERNAME                                    REQUESTOR           CONDITION
</span></span><span style="display:flex;"><span>node-csr-Pbamt5FDLAwv0HlJpcgUP9B5c4ynIRe0Xa17zXq9I6E   4m16s   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰¹å‡†ç”³è¯·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl certificate approve node-csr-Pbamt5FDLAwv0HlJpcgUP9B5c4ynIRe0Xa17zXq9I6E</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>certificatesigningrequest.certificates.k8s.io/node-csr-Pbamt5FDLAwv0HlJpcgUP9B5c4ynIRe0Xa17zXq9I6E approved
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹èŠ‚ç‚¹,ç”±äºç½‘ç»œæ’ä»¶æ²¡æœ‰éƒ¨ç½²ï¼ŒèŠ‚ç‚¹çŠ¶æ€ NotReady</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get node</span>
</span></span><span style="display:flex;"><span>NAME         STATUS     ROLES    AGE   VERSION
</span></span><span style="display:flex;"><span>k8s-master   NotReady   &lt;none&gt;   71s   v1.18.3</span></span></code></pre></div></blockquote>
<hr>
<h3 id="éƒ¨ç½²kube-proxy">éƒ¨ç½²<code>kube-proxy</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 1. åˆ›å»ºé…ç½®kube-proxyæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/kube-proxy.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBE_PROXY_OPTS=&#34;--logtostderr=false \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--v=2 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--log-dir=/opt/kubernetes/logs \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--config=/opt/kubernetes/cfg/kube-proxy-config.yml&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. é…ç½®å‚æ•°æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/kube-proxy-config.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: KubeProxyConfiguration
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">bindAddress: 0.0.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metricsBindAddress: 0.0.0.0:10249
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clientConnection:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kubeconfig: /opt/kubernetes/cfg/kube-proxy.kubeconfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hostnameOverride: k8s-master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clusterCIDR: 10.0.0.0/24
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. ç”Ÿæˆkube-proxy.kubeconfigæ–‡ä»¶ï¼šç”Ÿæˆkube-proxyè¯ä¹¦ï¼š</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/ssl/kube-proxy-csr.json<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;CN&#34;: &#34;system:kube-proxy&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;hosts&#34;: [],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;key&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;algo&#34;: &#34;rsa&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;size&#34;: 2048
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;names&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;C&#34;: &#34;CN&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;L&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;ST&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;O&#34;: &#34;k8s&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;OU&#34;: &#34;System&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4.ç”Ÿæˆè¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ cd /opt/kubernetes/ssl/
</span></span><span style="display:flex;"><span>$ cfssl gencert -ca<span style="color:#f92672">=</span>ca.pem -ca-key<span style="color:#f92672">=</span>ca-key.pem -config<span style="color:#f92672">=</span>ca-config.json -profile<span style="color:#f92672">=</span>kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 5. ç”Ÿæˆkubeconfigæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ KUBE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/opt/kubernetes/cfg/kube-proxy.kubeconfig&#34;</span>
</span></span><span style="display:flex;"><span>$ KUBE_APISERVER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://192.168.4.110:6443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ssl<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl config set-cluster kubernetes \</span>
</span></span><span style="display:flex;"><span>--certificate-authority<span style="color:#f92672">=</span>/opt/kubernetes/ssl/ca.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--server<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_APISERVER<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>Cluster <span style="color:#e6db74">&#34;kubernetes&#34;</span> set.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ssl<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl config set-credentials kube-proxy \</span>
</span></span><span style="display:flex;"><span>--client-certificate<span style="color:#f92672">=</span>./kube-proxy.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--client-key<span style="color:#f92672">=</span>./kube-proxy-key.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>User <span style="color:#e6db74">&#34;kube-proxy&#34;</span> set.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ssl<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl config set-context default \</span>
</span></span><span style="display:flex;"><span>--cluster<span style="color:#f92672">=</span>kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--user<span style="color:#f92672">=</span>kube-proxy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>Context <span style="color:#e6db74">&#34;default&#34;</span> created.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ssl<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl config use-context default --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>Switched to context <span style="color:#e6db74">&#34;default&#34;</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 6.systemç®¡ç†kube-proxy</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/kube-proxy.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes Proxy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EnvironmentFile=/opt/kubernetes/cfg/kube-proxy.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/kubernetes/bin/kube-proxy \$KUBE_PROXY_OPTS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">########################################################################</span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable kube-proxy <span style="color:#f92672">&amp;&amp;</span> systemctl start kube-proxy</span></span></code></pre></div></blockquote>
<hr>
<h3 id="éƒ¨ç½²ç½‘ç»œç»„ä»¶">éƒ¨ç½²ç½‘ç»œç»„ä»¶</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><code>Calico</code>æ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„æ•°æ®ä¸­å¿ƒç½‘ç»œæ–¹æ¡ˆï¼Œæ˜¯ç›®å‰<code>Kubernetes</code>ä¸»æµçš„ç½‘ç»œæ–¹æ¡ˆã€‚éƒ¨ç½²<code>Calico</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/
</span></span><span style="display:flex;"><span>$ wget https://docs.projectcalico.org/v3.14/manifests/calico.yaml
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master src<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl apply -f calico.yaml  # ç­‰Calico Podéƒ½Runningï¼ŒèŠ‚ç‚¹ä¹Ÿä¼šå‡†å¤‡å°±ç»ª</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master src<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get node</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master src<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n kube-system</span>
</span></span><span style="display:flex;"><span>NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>calico-kube-controllers-65f8bc95db-27zj8   1/1     Running   <span style="color:#ae81ff">0</span>          37m
</span></span><span style="display:flex;"><span>calico-node-skvcj                          1/1     Running   <span style="color:#ae81ff">0</span>          37m</span></span></code></pre></div></blockquote>
<hr>
<h4 id="éƒ¨ç½²cniç½‘ç»œ">éƒ¨ç½²<code>CNI</code>ç½‘ç»œ</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å…ˆå‡†å¤‡å¥½<code>CNI</code>äºŒè¿›åˆ¶æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/cni/bin
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/
</span></span><span style="display:flex;"><span>$ wget https://github.com/containernetworking/plugins/releases/download/v0.8.6/cni-plugins-linux-amd64-v0.8.6.tgz  	<span style="color:#75715e"># ä¸‹è½½äºŒè¿›åˆ¶å®‰è£…åŒ…</span>
</span></span><span style="display:flex;"><span>$ tar zxvf cni-plugins-linux-amd64-v0.8.6.tgz -C /opt/cni/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># éƒ¨ç½²CNIç½‘ç»œ</span>
</span></span><span style="display:flex;"><span>$ cd /opt/kubernetes/cfg/
</span></span><span style="display:flex;"><span>$ wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</span></span><span style="display:flex;"><span>$ sed -i -r <span style="color:#e6db74">&#34;s#quay.io/coreos/flannel:.*-amd64#lizhenliang/flannel:v0.12.0-amd64#g&#34;</span> kube-flannel.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master cfg<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl apply -f kube-flannel.yml</span>
</span></span><span style="display:flex;"><span>podsecuritypolicy.policy/psp.flannel.unprivileged created
</span></span><span style="display:flex;"><span>clusterrole.rbac.authorization.k8s.io/flannel created
</span></span><span style="display:flex;"><span>clusterrolebinding.rbac.authorization.k8s.io/flannel created
</span></span><span style="display:flex;"><span>serviceaccount/flannel created
</span></span><span style="display:flex;"><span>configmap/kube-flannel-cfg created
</span></span><span style="display:flex;"><span>daemonset.apps/kube-flannel-ds created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master cfg<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n kube-system</span>
</span></span><span style="display:flex;"><span>NAME                    READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>kube-flannel-ds-xv7db   1/1     Running   <span style="color:#ae81ff">0</span>          58s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master cfg<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get node</span>
</span></span><span style="display:flex;"><span>NAME         STATUS   ROLES    AGE   VERSION
</span></span><span style="display:flex;"><span>k8s-master   Ready    &lt;none&gt;   23m   v1.18.3</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->æˆæƒ<code>apiserver</code>è®¿é—®<code>kubelet</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/apiserver-to-kubelet-rbac.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rbac.authorization.kubernetes.io/autoupdate: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kubernetes.io/bootstrapping: rbac-defaults
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name: system:kube-apiserver-to-kubelet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - apiGroups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes/proxy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes/stats
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes/log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes/spec
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes/metrics
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - pods/log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    verbs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#34;*&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRoleBinding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: system:kube-apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  namespace: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">roleRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: system:kube-apiserver-to-kubelet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjects:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: User
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##############################################################</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master cfg<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl apply -f apiserver-to-kubelet-rbac.yaml</span>
</span></span><span style="display:flex;"><span>clusterrole.rbac.authorization.k8s.io/system:kube-apiserver-to-kubelet created
</span></span><span style="display:flex;"><span>clusterrolebinding.rbac.authorization.k8s.io/system:kube-apiserver created</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ–°å¢åŠ worker-nodeæ‹·è´å·²éƒ¨ç½²å¥½çš„nodeç›¸å…³æ–‡ä»¶åˆ°æ–°èŠ‚ç‚¹">æ–°å¢åŠ <code>Worker Node:</code>æ‹·è´å·²éƒ¨ç½²å¥½çš„<code>Node</code>ç›¸å…³æ–‡ä»¶åˆ°æ–°èŠ‚ç‚¹</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœ¨<code>master</code>èŠ‚ç‚¹å°†<code>Worker Node</code>æ¶‰åŠæ–‡ä»¶æ‹·è´åˆ°å…¶ä»–å‡ ä¸ªæ–°èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># ansible node -i /etc/ansible/hosts -m copy -a &#34;src=../../../opt/kubernetes dest=/opt/&#34; -f 5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># ansible node -i /etc/ansible/hosts -m copy -a &#34;src=../../../opt/cni  dest=/opt/&#34; -f 5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># scp -r /usr/lib/systemd/system/{kubelet,kube-proxy}.service k8s-node-1:/usr/lib/systemd/system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># scp -r /usr/lib/systemd/system/{kubelet,kube-proxy}.service k8s-node-2:/usr/lib/systemd/system</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿™å‡ ä¸ªæ–‡ä»¶æ˜¯è¯ä¹¦ç”³è¯·å®¡æ‰¹åè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ¯ä¸ªNodeä¸åŒï¼Œå¿…é¡»åˆ é™¤å…¶ä»–å‡ ä¸ªèŠ‚ç‚¹åˆ é™¤kubeletè¯ä¹¦å’Œkubeconfigæ–‡ä»¶ï¼Œé‡æ–°ç”Ÿæˆ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># rm -rf /opt/kubernetes/cfg/kubelet.kubeconfig</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-2 ~<span style="color:#f92672">]</span><span style="color:#75715e"># rm -rf /opt/kubernetes/cfg/kubelet.kubeconfig </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># rm -f /opt/kubernetes/ssl/kubelet*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ä¸»æœºå</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#34;s/k8s-master/k8s-node-1/g&#34; /opt/kubernetes/cfg/kubelet.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#34;s/k8s-master/k8s-node-1/g&#34;  /opt/kubernetes/cfg/kube-proxy-config.yml </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-2 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#34;s/k8s-master/k8s-node-2/g&#34; /opt/kubernetes/cfg/kubelet.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-2 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#34;s/k8s-master/k8s-node-2/g&#34;  /opt/kubernetes/cfg/kube-proxy-config.yml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨å…¶ä»–å‡ ä¸ªå‡ ç‚¹ç»™äºˆå¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œæƒé™ï¼Œ</span>
</span></span><span style="display:flex;"><span>$ chmod +x /opt/cni/bin/*
</span></span><span style="display:flex;"><span>$ chmod +x /opt/etcd/bin/*
</span></span><span style="display:flex;"><span>$ chmod +x /opt/kubernetes/bin/*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable kubelet <span style="color:#f92672">&amp;&amp;</span> systemctl start kubelet
</span></span><span style="display:flex;"><span>$ systemctl enable kube-proxy <span style="color:#f92672">&amp;&amp;</span> systemctl start kube-proxy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨Masteræ“ä½œæ‰¹å‡†Node kubeletè¯ä¹¦ç”³è¯·</span>
</span></span><span style="display:flex;"><span>$ kubectl get csr
</span></span><span style="display:flex;"><span>NAME                                                   AGE     SIGNERNAME                                    REQUESTOR           CONDITION
</span></span><span style="display:flex;"><span>node-csr-4vSZMnrv8OUR-zfD7dQYcDdi1L84Tv_nkNHlS8Iltfk   2m46s   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending
</span></span><span style="display:flex;"><span>node-csr-KRMLTPJj4yvk5Cb6s0n5T4HtFPYJ152PpDjYHLM3Ass   10s     kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending
</span></span><span style="display:flex;"><span>node-csr-Pbamt5FDLAwv0HlJpcgUP9B5c4ynIRe0Xa17zXq9I6E   71m     kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Approved,Issued
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl certificate approve node-csr-KRMLTPJj4yvk5Cb6s0n5T4HtFPYJ152PpDjYHLM3Ass
</span></span><span style="display:flex;"><span>$ kubectl certificate approve node-csr-4vSZMnrv8OUR-zfD7dQYcDdi1L84Tv_nkNHlS8Iltfk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># STATUS éƒ½æ˜¯Ready</span>
</span></span><span style="display:flex;"><span>$ kubectl get node
</span></span><span style="display:flex;"><span>NAME         STATUS   ROLES    AGE     VERSION
</span></span><span style="display:flex;"><span>k8s-master   Ready    &lt;none&gt;   70m     v1.18.3
</span></span><span style="display:flex;"><span>k8s-node-1   Ready    &lt;none&gt;   3m21s   v1.18.3
</span></span><span style="display:flex;"><span>k8s-node-2   Ready    &lt;none&gt;   3m2s    v1.18.3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># STATUS éƒ½æ˜¯Runing</span>
</span></span><span style="display:flex;"><span>$ kubectl get pod -n kube-system
</span></span><span style="display:flex;"><span>NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>calico-kube-controllers-65f8bc95db-27zj8   1/1     Running   <span style="color:#ae81ff">0</span>          65m
</span></span><span style="display:flex;"><span>calico-node-skvcj                          1/1     Running   <span style="color:#ae81ff">0</span>          65m
</span></span><span style="display:flex;"><span>calico-node-wc72m                          1/1     Running   <span style="color:#ae81ff">0</span>          2m22s
</span></span><span style="display:flex;"><span>calico-node-z5kmp                          1/1     Running   <span style="color:#ae81ff">0</span>          2m2s</span></span></code></pre></div></blockquote>
<hr>
<h4 id="åˆ›å»ºlocalçš„storage-class">åˆ›å»º<code>local</code>çš„<code>Storage Class</code></h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/data
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/storage-class.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: StorageClass
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: storage.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name: local-storage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">provisioner: kubernetes.io/no-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">volumeBindingMode: WaitForFirstConsumer
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰§è¡Œå‘½ä»¤åˆ›å»º</span>
</span></span><span style="display:flex;"><span>$ kubectl create -f storage-class.yml
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ä¸€ä¸‹åˆ›å»ºçš„storage class</span>
</span></span><span style="display:flex;"><span>$ kubectl get sc</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åˆ›å»º<code>PV</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/pv-sdc.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: PersistentVolume
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name: local-pv-sdc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">capacity:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storage: 30Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">accessModes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - ReadWriteOnce
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  persistentVolumeReclaimPolicy: Retain
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  storageClassName: local-storage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  local:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    path: /opt/data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  nodeAffinity:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    required:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      nodeSelectorTerms:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - matchExpressions:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - key: kubernetes.io/hostname
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          operator: In
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          values:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - cka
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰§è¡Œåˆ›å»ºå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ kubectl create -f pv-sdc.yml
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master cfg<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pv</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ›å»º<code>PVC</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/pvc1.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: PersistentVolumeClaim
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name: pvc1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">accessModes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - ReadWriteOnce
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  storageClassName: local-storage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      storage: 10Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>$ kubectl create -f pvc1.yml</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted --><code>PVC</code>å°†ä¼šä¸€ç›´å¤„äº<code>Pending</code>çŠ¶æ€ç›´åˆ°æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>Pod</code>ä½¿ç”¨å®ƒ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master cfg<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pvc</span>
</span></span><span style="display:flex;"><span>NAME      STATUS    VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS    AGE
</span></span><span style="display:flex;"><span>pvc1      Pending                                       local-storage   5s</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_k8s_rancher">Install_K8s_Rancher</h1>

<h2 id="å®‰è£…rancherå›¾å½¢åŒ–ç®¡ç†">å®‰è£…<code>Rancher</code>å›¾å½¢åŒ–ç®¡ç†</h2>
<ul>
<li>
<ol>
<li><code>Rancher</code>æ˜¯ä¾›é‡‡ç”¨å®¹å™¨çš„å›¢é˜Ÿä½¿ç”¨çš„å®Œæ•´è½¯ä»¶å †æ ˆã€‚å®ƒè§£å†³äº†ç®¡ç†å¤šä¸ª</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>Kubernetes</code>é›†ç¾¤çš„è¿è¥å’Œå®‰å…¨æŒ‘æˆ˜ï¼Œå¹¶ä¸º<code>DevOps</code>å›¢é˜Ÿæä¾›ç”¨äºè¿è¡Œå®¹å™¨åŒ–å·¥ä½œè´Ÿè½½çš„é›†æˆå·¥å…·</li>
</ol>
</li>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --><code>Docker</code><!-- raw HTML omitted -->ç¯å¢ƒ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>æœåŠ¡å™¨</th>
<th><code>IP</code></th>
<th>å†…å­˜</th>
<th>CPU</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>master</code></td>
<td>192.168.35.128</td>
<td>8G</td>
<td>8<code>core</code></td>
</tr>
<tr>
<td><code>node-1</code></td>
<td>192.168.35.129</td>
<td>4G</td>
<td>4<code>core</code></td>
</tr>
<tr>
<td><code>node-2</code></td>
<td>192.168.35.130</td>
<td>4G</td>
<td>4<code>core</code></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="å®‰è£…åŸºç¡€ç¯å¢ƒ">å®‰è£…åŸºç¡€ç¯å¢ƒ</h3>
<ul>
<li>
<ol>
<li><code>Nano</code><!-- raw HTML omitted -->ï¼šè¶…è½»é‡çº§å¼€æºäº‘å¹³å°<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Naco</code>ï¼šåŸºäº<code>KVM</code>æŠ€æœ¯ï¼Œä½¿ç”¨<code>Go</code>è¯­è¨€å¼€å‘ï¼Œç®€å•æ˜“å­¦çš„è™šæ‹Ÿæœºç®¡ç†è½¯ä»¶ï¼Œä»<code>Web</code>ç®¡ç†é—¨æˆ·ã€ä¸»æœºç›‘æ§ã€é•œåƒå…‹éš†åˆ°æ•…éšœåˆ‡æ¢ï¼ŒåŠŸèƒ½å®Œå¤‡ï¼Œå¼€ç®±å³ç”¨ï¼Œæ•°åˆ†é’Ÿä¹‹å†…å³å¯å°†æ‚¨çš„æœåŠ¡å™¨é›†ç¾¤å‡çº§ä¸ºäº‘ä¸»æœºå¹³å°</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y nano</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åœ¨æ‰€æœ‰èŠ‚ç‚¹éƒ½å®‰è£…<!-- raw HTML omitted --><code>Docker</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ENV configuration  </span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/swap / s/^\(.*\)$/#\1/g&#39;</span> /etc/fstab  
</span></span><span style="display:flex;"><span>$ swapoff -a 
</span></span><span style="display:flex;"><span>$ modprobe br_netfilter  
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;br_netfilter&#34;</span> &gt; /etc/modules-load.d/br_netfilter.conf  
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;net.bridge.bridge-nf-call-iptables = 1&#34;</span> &gt;&gt; /etc/sysctl.conf  
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;net.ipv4.ip_forward = 1&#34;</span> &gt;&gt; /etc/sysctl.conf  
</span></span><span style="display:flex;"><span>$ sysctl -p  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/#AllowTcpForwarding/AllowTcpForwarding/g&#39;</span> /etc/ssh/sshd_config  
</span></span><span style="display:flex;"><span>$ systemctl reload sshd  
</span></span><span style="display:flex;"><span>$ systemctl stop firewalld <span style="color:#f92672">&amp;&amp;</span> systemctl disable firewalld  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;</span> /etc/selinux/config  
</span></span><span style="display:flex;"><span>$ setenforce <span style="color:#ae81ff">0</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># timedate configration  </span>
</span></span><span style="display:flex;"><span>$ timedatectl set-timezone Asia/Shanghai  
</span></span><span style="display:flex;"><span>$ yum install -y chrony  
</span></span><span style="display:flex;"><span>$ systemctl start chronyd <span style="color:#f92672">&amp;&amp;</span> sudo systemctl enable chronyd 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum install -y yum-utils  
</span></span><span style="display:flex;"><span>$ yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo  
</span></span><span style="display:flex;"><span>$ yum install -y docker-ce-19.03.9 docker-ce-cli-19.03.9 --nogpgcheck  
</span></span><span style="display:flex;"><span>$ systemctl enable docker <span style="color:#f92672">&amp;&amp;</span> systemctl start docker  </span></span></code></pre></div></blockquote>
<hr>
<h3 id="å®‰è£…rancher-v265">å®‰è£…<code>Rancher v2.6.5</code></h3>
<ul>
<li>
<ol>
<li><a href="https://rancher.com/docs/rancher/v2.6/en/installation/other-installation-methods/single-node-docker/" rel="external" target="_self">ä½¿ç”¨<code>Docker</code>åœ¨å•èŠ‚ç‚¹ä¸Šå®‰è£…<code>Rancher</code></a></li>
</ol>
</li>
<li>
<ol start="2">
<li><code>Rancher v2.6.5</code><!-- raw HTML omitted -->æ”¯æŒçš„<!-- raw HTML omitted --><code>Kubernetes Versions</code><!-- raw HTML omitted -->ç‰ˆæœ¬<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>v1.23.6 Default</code></li>
<li><code>v1.22.9</code></li>
<li><code>v1.21.12</code></li>
<li><code>v1.20.15</code></li>
<li><code>v1.19.16</code></li>
<li><code>v1.18.20</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker pull rancher/rancher:v2.6.5
</span></span><span style="display:flex;"><span>$ docker run -d --restart<span style="color:#f92672">=</span>unless-stopped -p 888:80 -p 4443:443 --privileged rancher/rancher:v2.6.5 </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><a href="https://rancher.com/docs/rancher/v2.6/en/installation/install-rancher-on-k8s/" rel="external" target="_self">åœ¨<code>Kubernetes</code>é›†ç¾¤ä¸Šå®‰è£…/å‡çº§<code>Rancher</code></a></li>
</ol>
</li>
</ul>
<hr>
<h3 id="font-colorredåœ¨fontkubernetesfont-colorredé›†ç¾¤ä¸Šå®‰è£…å‡çº§fontrancher"><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>Kubernetes</code><!-- raw HTML omitted -->é›†ç¾¤ä¸Šå®‰è£…/å‡çº§<!-- raw HTML omitted --><code>Rancher</code></h3>
<ul>
<li>
<ol>
<li><a href="https://helm.sh/docs/intro/install/" rel="external" target="_self">å®‰è£…<code>Helm</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://blog.csdn.net/qq_37481017/article/details/119002325" rel="external" target="_self">åŸºäº<code>K8S 1.21.2</code>é›†ç¾¤å®‰è£…<code>Rancher 2.5.9 HA</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨äºŒè¿›åˆ¶å®‰è£…Helm</span>
</span></span><span style="display:flex;"><span>$ wget https://get.helm.sh/helm-v3.9.0-linux-amd64.tar.gz  
</span></span><span style="display:flex;"><span>$ tar -zxvf helm-v3.9.0-linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv linux-amd64/helm /usr/local/bin/helm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è„šæœ¬å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">700</span> get_helm.sh
</span></span><span style="display:flex;"><span>$ ./get_helm.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æºä»£ç å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ git clone https://github.com/helm/helm.git
</span></span><span style="display:flex;"><span>$ cd helm
</span></span><span style="display:flex;"><span>$ make</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>cert-manager</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create namespace cert-manager
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ Jetstack Helmå­˜å‚¨åº“</span>
</span></span><span style="display:flex;"><span>$ helm repo add jetstack https://charts.jetstack.io
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ–°æœ¬åœ° Helm å›¾è¡¨å­˜å‚¨åº“ç¼“å­˜</span>
</span></span><span style="display:flex;"><span>$ helm repo update
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…cert-managerè‡ªå®šä¹‰æ‰€éœ€çš„è‡ªå®šä¹‰èµ„æº</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.7.1/cert-manager.crds.yaml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ helm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --version v1.7.1 --set installCRDs<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># éªŒè¯cert-managerè¯ä¹¦ç®¡ç†å™¨æ˜¯å¦å®‰è£…æˆåŠŸ</span>
</span></span><span style="display:flex;"><span>$ kubectl get pods --namespace cert-manager</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Helm</code><!-- raw HTML omitted -->å®‰è£…ç¨³å®šç‰ˆ<!-- raw HTML omitted --><code>Rancher</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¸ºRancheråˆ›å»ºå‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>$ kubectl create namespace cattle-system
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ  Helm æ·»åŠ  Rancher åº“</span>
</span></span><span style="display:flex;"><span>$ helm repo add rancher-stable https://releases.rancher.com/server-charts/stable</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>helm</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Rancher</code><!-- raw HTML omitted -->æ³¨æ„é€‰å¥½ç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¸å¯¹ä¼šæŠ¥é”™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install rancher rancher-stable/rancher --namespace cattle-system --set hostname<span style="color:#f92672">=</span>my.rancher.org --set bootstrapPassword<span style="color:#f92672">=</span>admin --set replicas<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> --version 2.6.3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --set ingress.tls.source=letsEncrypt \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --set letsEncrypt.email=&lt;caviardÃ©&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME: rancher
</span></span><span style="display:flex;"><span>LAST DEPLOYED: Wed May <span style="color:#ae81ff">25</span> 18:01:51 <span style="color:#ae81ff">2022</span>
</span></span><span style="display:flex;"><span>NAMESPACE: cattle-system
</span></span><span style="display:flex;"><span>STATUS: deployed
</span></span><span style="display:flex;"><span>REVISION: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>TEST SUITE: None
</span></span><span style="display:flex;"><span>NOTES:
</span></span><span style="display:flex;"><span>Rancher Server has been installed.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NOTE: Rancher may take several minutes to fully initialize. Please standby <span style="color:#66d9ef">while</span> Certificates are being issued, Containers are started and the Ingress rule comes up.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Check out our docs at https://rancher.com/docs/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>If you provided your own bootstrap password during installation, browse to https://my.rancher.org to get started.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>If this is the first time you installed Rancher, get started by running this command and clicking the URL it generates:</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo https://my.rancher.org/dashboard/?setup<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get secret --namespace cattle-system bootstrap-secret -o go-template<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{{.data.bootstrapPassword|base64decode}}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># To get just the bootstrap password on its own, run:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl get secret --namespace cattle-system bootstrap-secret -o go-template<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{{.data.bootstrapPassword|base64decode}}{{ &#34;\n&#34; }}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Happy Containering!</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ç­‰å¾…<!-- raw HTML omitted --><code>Rancher</code><!-- raw HTML omitted -->å®‰è£…æˆåŠŸ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl -n cattle-system rollout status deploy/rancher
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl get pods -o wide -n cattle-system
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl get pods --show-labels -n cattle-system</span></span></code></pre></div></blockquote>
<hr>
<h2 id="æµè§ˆå™¨ç™»å½•rancheré¡µé¢è®¾ç½®">æµè§ˆå™¨ç™»å½•<code>Rancher</code>é¡µé¢è®¾ç½®</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><strong>é»˜è®¤ç”¨æˆ·åï¼š</strong><!-- raw HTML omitted --><code>admin</code></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å¯†ç æ–°è®¾ç½®æˆ–è€…éšæœºç”Ÿæˆ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-77db5d318959200411c5c6972f133510" class="lightbox-link"><img alt="è®¾ç½®Rancherå¯†ç " class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_18-29-03.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-77db5d318959200411c5c6972f133510"><img alt="è®¾ç½®Rancherå¯†ç " class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_18-29-03.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>Rancher Server</code><!-- raw HTML omitted -->åœ°å€<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->æˆ–è€…åŸŸå<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-9ed8f1f0a95fde1794ca1dd09aba7644" class="lightbox-link"><img alt="è®¾å®šRancheråœ°å€" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_18-31-17.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9ed8f1f0a95fde1794ca1dd09aba7644"><img alt="è®¾å®šRancheråœ°å€" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_18-31-17.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>Rancher</code><!-- raw HTML omitted -->ä¸­æ–‡é¡µé¢<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-bc9c8b151a64d5abff85b79040148e9d" class="lightbox-link"><img alt="set-chinses" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/set-Chinses.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bc9c8b151a64d5abff85b79040148e9d"><img alt="set-chinses" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/set-Chinses.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ç™»å½•åå¯ä»¥çœ‹åˆ°ç›®å‰<!-- raw HTML omitted --><code>Rancher</code><!-- raw HTML omitted -->æ‰€ç®¡ç†åªæœ‰<!-- raw HTML omitted --><code>Rancher</code><!-- raw HTML omitted -->æœ¬èº«å­˜åœ¨<!-- raw HTML omitted --><code>K3S</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>5.1 <code>Rancher Labs</code>æ¨å‡º<code>Kubernetes</code>å¼€æº<code>K3S</code>æ˜¯ä¸€ä¸ªè½»é‡çº§ï¼Œåªæœ‰<code>40MB</code>å¤§å°ï¼Œæ˜“äºå®‰è£…<code>Kubernetes</code>å‘å¸ƒç‰ˆæœ¬ï¼Œè½¬ä¸ºèµ„æºæœ‰é™å’Œä½äº’åŠ¨ç³»ç»Ÿè®¾è®¡ï¼Œé€‚ç”¨äºè¾¹ç¼˜åº”ç”¨ã€ç‰©è”ç½‘ã€æŒç»­æ•´åˆä»¥åŠ<code>ARM</code>ç­‰</li>
</ul>
<p><a href="#R-image-27e5bfd27df74e890812a6f26afd99e4" class="lightbox-link"><img alt="åˆæ¬¡ç™»å½•é¡µé¢" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_18-34-35.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-27e5bfd27df74e890812a6f26afd99e4"><img alt="åˆæ¬¡ç™»å½•é¡µé¢" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_18-34-35.png"></a></p>
</blockquote>
<hr>
<h2 id="ä½¿ç”¨rancheråˆ›å»ºrke-kubernetesé›†ç¾¤">ä½¿ç”¨<code>Rancher</code>åˆ›å»º<code>RKE Kubernetes</code>é›†ç¾¤</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç­‰å¾…è¢«åˆ›å»ºçš„é›†ç¾¤éƒ½æ˜¯åŸºäºæ•°ä¸ªå®ä½“æœåŠ¡å™¨æˆ–è™šæ‹Ÿæœºç»„æˆï¼Œå…¶ä¸­è¿™äº›æœºå™¨ç¡¬ä»¶æœ€ä½è¦æ±‚<!-- raw HTML omitted --><code>1Cores</code>ã€<code>1GB</code><!-- raw HTML omitted -->å¹¶ä¸”éœ€è¦æå‰å®‰è£…å¥½<!-- raw HTML omitted --><code>Docker</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»ç¬¦åˆ<!-- raw HTML omitted --><code>RKE</code><a href="https://docs.rancher.cn/docs/rke/os/_index/" rel="external" target="_self">å®‰è£…è¦æ±‚</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç”Ÿäº§ç¯å¢ƒä¸‹ä¸å…è®¸æŠŠ<!-- raw HTML omitted --><code>worker</code><!-- raw HTML omitted -->è§’è‰²æ·»åŠ å…·æœ‰<!-- raw HTML omitted --><code>etcd</code><!-- raw HTML omitted -->æˆ–<!-- raw HTML omitted --><code>control plane</code><!-- raw HTML omitted -->è§’è‰²èŠ‚ç‚¹ä¸­<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<hr>
<h3 id="webé¡µé¢é…ç½®kubernetes-clusteré›†ç¾¤"><code>Web</code>é¡µé¢é…ç½®<code>Kubernetes Cluster</code>é›†ç¾¤</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>Rancher</code><!-- raw HTML omitted -->æµè§ˆå™¨é¡µé¢ä¸­æ·»åŠ <!-- raw HTML omitted --><code>Kubernetes Cluster</code></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-c50ce82d37f1df86153069fd3a93a8e4" class="lightbox-link"><img alt="Add-K8s-Cluster" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Add-Cluster.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c50ce82d37f1df86153069fd3a93a8e4"><img alt="Add-K8s-Cluster" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Add-Cluster.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é€‰æ‹©<!-- raw HTML omitted --><code>Existing nodes(è‡ªå®šä¹‰é›†ç¾¤)</code></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-00812c0cb32737c054f126e1a5012dc3" class="lightbox-link"><img alt="è‡ªå®šä¹‰é›†ç¾¤" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Add-Nodes.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-00812c0cb32737c054f126e1a5012dc3"><img alt="è‡ªå®šä¹‰é›†ç¾¤" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Add-Nodes.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å®šä¹‰é›†ç¾¤åç§°ã€ç„¶åä¸‹ä¸€æ­¥<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-5bf1006a3724d573a44bf84e78002eb4" class="lightbox-link"><img alt="å¡«å†™é›†ç¾¤åç§°" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_20-41-58.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5bf1006a3724d573a44bf84e78002eb4"><img alt="å¡«å†™é›†ç¾¤åç§°" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_20-41-58.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å…ˆé€‰æ‹©<!-- raw HTML omitted --><code>etcd</code>ã€<code>Control Plane</code><!-- raw HTML omitted -->è§’è‰²ï¼ŒæŠŠç”Ÿæˆçš„å‘½ä»¤å¤åˆ¶åˆ°èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œç„¶åä¸‹ä¸€æ­¥<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-d387dc02bcf214c9e6cc833fa8629164" class="lightbox-link"><img alt="éƒ¨ç½²etcd Control Plane" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_21-14-45.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d387dc02bcf214c9e6cc833fa8629164"><img alt="éƒ¨ç½²etcd Control Plane" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_21-14-45.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->é€‰æ‹©<!-- raw HTML omitted --><code>Worker</code><!-- raw HTML omitted -->å·¥ä½œèŠ‚ç‚¹,æŠŠç”Ÿæˆçš„å‘½ä»¤å¤åˆ¶åˆ°èŠ‚ç‚¹æ‰§è¡Œ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-418e2c8c85c559f511866baa249b3f26" class="lightbox-link"><img alt="é€‰æ‹©<code>Worker</code>å·¥ä½œèŠ‚ç‚¹" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_21-15-51.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-418e2c8c85c559f511866baa249b3f26"><img alt="é€‰æ‹©<code>Worker</code>å·¥ä½œèŠ‚ç‚¹" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_21-15-51.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œç­‰å¾…èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼ŒæˆåŠŸåä¸‹æ–¹æ˜¾ç¤ºæ·»åŠ æˆåŠŸ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-81810223a19af271340f4ec327d499dc" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_21-20-56.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-81810223a19af271340f4ec327d499dc"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_21-20-56.png"></a></p>
</blockquote>
<hr>
<h3 id="å¦‚æœé”™è¿‡å¤åˆ¶æ·»åŠ å‘½ä»¤é€‰æ‹©å‘½åç©ºé—´ç‚¹å‡»edit">å¦‚æœé”™è¿‡å¤åˆ¶æ·»åŠ å‘½ä»¤é€‰æ‹©å‘½åç©ºé—´ç‚¹å‡»<code>Edit</code></h3>
<blockquote>
<p><a href="#R-image-760951f40501294aaf55fca8d3d742fa" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-42-56.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-760951f40501294aaf55fca8d3d742fa"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-42-56.png"></a></p>
<p><a href="#R-image-aa10bce3632a0b792702c527ddd27001" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-44-52.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-aa10bce3632a0b792702c527ddd27001"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-44-52.png"></a></p>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_k8s_kubesphere">Install_K8s_KubeSphere</h1>

<h2 id="åœ¨ç°æœ‰kubernetesä¸Šå®‰è£…kubesphere-webç®¡ç†ç³»ç»Ÿ">åœ¨ç°æœ‰<code>Kubernetes</code>ä¸Šå®‰è£…<code>KubeSphere Web</code>ç®¡ç†ç³»ç»Ÿ</h2>
<!-- raw HTML omitted -->
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://kuboard.cn/" rel="external" target="_self"><code>Kuboard</code>ä¸€æ¬¾å…è´¹çš„<code>Kubernetes</code>ç®¡ç†ç•Œé¢</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="https://kubeoperator.io/" rel="external" target="_self"><code>KubeOperator</code>å¯è§†åŒ–çš„<code>Web UI</code></a></li>
</ol>
</li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li>å¦‚éœ€åœ¨<code>Kubernetes</code>ä¸Šå®‰è£…<code>KubeSphere 3.3.0</code>ï¼Œæ‚¨çš„<code>Kubernetes</code>ç‰ˆæœ¬å¿…é¡»ä¸ºï¼š<code>v1.19.xï¼Œv1.20.xï¼Œv1.21.xï¼Œv1.22.x æˆ– v1.23.x</code>ï¼ˆå®éªŒæ€§æ”¯æŒï¼‰</li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç¡®ä¿æ‚¨çš„æœºå™¨æ»¡è¶³æœ€ä½ç¡¬ä»¶è¦æ±‚ï¼š<!-- raw HTML omitted --><code>CPU &gt; 1æ ¸</code>ã€<code>å†…å­˜ &gt; 2GB</code></li>
</ol>
</li>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åœ¨å®‰è£…ä¹‹å‰ï¼Œéœ€è¦é…ç½®<!-- raw HTML omitted --><code>Kubernetes</code><!-- raw HTML omitted -->é›†ç¾¤ä¸­çš„<!-- raw HTML omitted --><code>é»˜è®¤</code><!-- raw HTML omitted -->å­˜å‚¨ç±»å‹ï¼Œä»¥ä¾¿å®ç°åŠ¨æ€ä¾›åº”<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>NFS</code><!-- raw HTML omitted -->çš„åŠ¨æ€ä¾›åº”çš„é»˜è®¤å­˜å‚¨ç±»<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/k8s/yaml/data-storage.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ›å»ºä¸€ä¸ªå­˜å‚¨ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: storage.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: StorageClass
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	name: nfs-storage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		storageclass.kubernetes.io/is-default-class: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">provisioner: k8s-sigs.io/nfs-subdir-external-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">parameters:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	archiveOnDelete: &#34;true&#34;  	# åˆ é™¤pvçš„æ—¶å€™ï¼Œpvçš„å†…å®¹æ˜¯å¦è¦å¤‡ä»½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: apps/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Deployment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	name: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		app: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# replace with namespace where provisioner is deployed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	replicas: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	strategy:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		type: Recreate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		matchLabels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			app: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	template:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				app: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			serviceAccountName: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				- name: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				  image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/nfs-subdir-external-provisioner:v4.0.2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				  # resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  # limits:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						  # cpu: 10m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  # requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						  # cpu: 10m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				  volumeMounts:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  - name: nfs-client-root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						mountPath: /persistentvolumes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				  env:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  - name: PROVISIONER_NAME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						value: k8s-sigs.io/nfs-subdir-external-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  - name: NFS_SERVER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						value: 192.168.94.110  	# æŒ‡å®šè‡ªå·±nfsæœåŠ¡å™¨åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  - name: NFS_PATH  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						value: /opt/data/kubesphere  	# nfsæœåŠ¡å™¨å…±äº«çš„ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			volumes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				- name: nfs-client-root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				  nfs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  server: 192.168.94.110
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  path: /opt/data/kubesphere
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # replace with namespace where provisioner is deployed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: nfs-client-provisioner-runner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups: [&#34;&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources: [&#34;nodes&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups: [&#34;&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources: [&#34;persistentvolumes&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;, &#34;create&#34;, &#34;delete&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups: [&#34;&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources: [&#34;persistentvolumeclaims&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;, &#34;update&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups: [&#34;storage.k8s.io&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources: [&#34;storageclasses&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups: [&#34;&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources: [&#34;events&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs: [&#34;create&#34;, &#34;update&#34;, &#34;patch&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRoleBinding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: run-nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjects:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      # replace with namespace where provisioner is deployed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">roleRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: nfs-client-provisioner-runner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Role
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: leader-locking-nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # replace with namespace where provisioner is deployed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups: [&#34;&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources: [&#34;endpoints&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;, &#34;create&#34;, &#34;update&#34;, &#34;patch&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: RoleBinding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: leader-locking-nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # replace with namespace where provisioner is deployed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjects:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      # replace with namespace where provisioner is deployed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">roleRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: Role
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: leader-locking-nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->é…ç½®é›†ç¾¤æŒ‡æ ‡ç›‘æ§ç»„ä»¶<!-- raw HTML omitted --><a href="https://github.com/kubernetes-sigs/metrics-server" rel="external" target="_self"><code>Kubernetes</code>æŒ‡æ ‡æœåŠ¡å™¨</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>5.1 <code>- --kubelet-insecure-tls</code>ï¼š<code>kubelet</code>çš„<code>10250</code>ç«¯å£ä½¿ç”¨çš„æ˜¯<code>https</code>åè®®ï¼Œè¿æ¥éœ€è¦éªŒè¯<code>tls</code>è¯ä¹¦ï¼Œ<code>--kubelet-insecure-tls</code><!-- raw HTML omitted -->ä¸éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä»…ç”¨äºæµ‹è¯•ç›®çš„<!-- raw HTML omitted --></li>
<li>5.2 <a href="https://github.com/kubernetes/kube-state-metrics" rel="external" target="_self"><code>kube-state-metrics</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/k8s/yaml/metrics_server.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        rbac.authorization.k8s.io/aggregate-to-admin: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        rbac.authorization.k8s.io/aggregate-to-edit: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        rbac.authorization.k8s.io/aggregate-to-view: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: system:aggregated-metrics-reader
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - metrics.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - pods
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - get
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - list
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - watch
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: system:metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - pods
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes/stats
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - namespaces
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - configmaps
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - get
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - list
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - watch
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: RoleBinding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: metrics-server-auth-reader
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">roleRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: Role
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: extension-apiserver-authentication-reader
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjects:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRoleBinding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: metrics-server:system:auth-delegator
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">roleRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: system:auth-delegator
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjects:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRoleBinding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: system:metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">roleRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: system:metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjects:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - name: https
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          port: 443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          protocol: TCP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          targetPort: https
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: apps/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Deployment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        matchLabels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    strategy:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        rollingUpdate:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            maxUnavailable: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    template:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                - args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    - --cert-dir=/tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    - --kubelet-insecure-tls
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    - --secure-port=4443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    - --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    - --kubelet-use-node-status-port
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    image: k8s.gcr.io/metrics-server/metrics-server:v0.6.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    # image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/metrics-server:v0.4.3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    imagePullPolicy: IfNotPresent
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    livenessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        failureThreshold: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        httpGet:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            path: /livez
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            port: https
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            scheme: HTTPS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        periodSeconds: 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        - containerPort: 4443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          name: https
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          protocol: TCP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    readinessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        failureThreshold: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        httpGet:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            path: /readyz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            port: https
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            scheme: HTTPS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        periodSeconds: 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    securityContext:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        readOnlyRootFilesystem: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        runAsNonRoot: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        runAsUser: 1000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    volumeMounts:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        - mountPath: /tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          name: tmp-dir
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            nodeSelector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                kubernetes.io/os: linux
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            priorityClassName: system-cluster-critical
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            serviceAccountName: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            volumes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                - emptyDir: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  name: tmp-dir
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: apiregistration.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: APIService
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: v1beta1.metrics.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    group: metrics.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    groupPriorityMinimum: 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    insecureSkipTLSVerify: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    service:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    version: v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    versionPriority: 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>5.1 <!-- raw HTML omitted -->æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹<!-- raw HTML omitted --><code>Node</code>èŠ‚ç‚¹ç»“æœ</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl top nodes
</span></span><span style="display:flex;"><span>NAME            CPU<span style="color:#f92672">(</span>cores<span style="color:#f92672">)</span>   CPU%   MEMORY<span style="color:#f92672">(</span>bytes<span style="color:#f92672">)</span>   MEMORY%   
</span></span><span style="display:flex;"><span>k8s-master-01   148m         7%     3690Mi          46%       
</span></span><span style="display:flex;"><span>k8s-node-01     35m          1%     492Mi           8%        
</span></span><span style="display:flex;"><span>k8s-node-02     32m          1%     358Mi           6%</span></span></code></pre></div><ul>
<li>5.2 <!-- raw HTML omitted -->æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹<!-- raw HTML omitted --><code>Pod</code>çŠ¶æ€</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$  kubectl top pods -A
</span></span><span style="display:flex;"><span>NAMESPACE       NAME                                        CPU<span style="color:#f92672">(</span>cores<span style="color:#f92672">)</span>  MEMORY<span style="color:#f92672">(</span>bytes<span style="color:#f92672">)</span>   
</span></span><span style="display:flex;"><span>default         nfs-client-provisioner-6f9769d4c4-h6jw9     3m           12Mi 
</span></span><span style="display:flex;"><span>ingress-nginx   ingress-nginx-controller-5fd8bfcbdc-bzppj   2m           96Mi
</span></span><span style="display:flex;"><span>kube-flannel    kube-flannel-ds-6tl2b                       5m           33Mi
</span></span><span style="display:flex;"><span>kube-flannel    kube-flannel-ds-n4k68                       3m           33Mi 
</span></span><span style="display:flex;"><span>kube-flannel    kube-flannel-ds-zkqhz                       3m           33Mi 
</span></span><span style="display:flex;"><span>kube-system     coredns-64897985d-6r9ds                     2m           17Mi
</span></span><span style="display:flex;"><span>kube-system     coredns-64897985d-fwmz5                     2m           14Mi
</span></span><span style="display:flex;"><span>kube-system     etcd-k8s-master-01                          20m          112Mi
</span></span><span style="display:flex;"><span>kube-system     kube-apiserver-k8s-master-01                63m          237Mi
</span></span><span style="display:flex;"><span>kube-system     kube-controller-manager-k8s-master-01       20m          50Mi 
</span></span><span style="display:flex;"><span>kube-system     kube-proxy-blnt7                            1m           18Mi 
</span></span><span style="display:flex;"><span>kube-system     kube-proxy-k5gkm                            1m           17Mi
</span></span><span style="display:flex;"><span>kube-system     kube-proxy-xpvqr                            1m           17Mi
</span></span><span style="display:flex;"><span>kube-system     kube-scheduler-k8s-master-01                5m           21Mi
</span></span><span style="display:flex;"><span>kube-system     metrics-server-658c4cf555-bpfcf             5m           19Mi</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->ä¸‹è½½ã€å®‰è£…<!-- raw HTML omitted --><code>KubeSphere</code>çš„<code>yaml</code>æ–‡ä»¶</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /opt/k8s/yaml/kubesphere/ https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/kubesphere-installer.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget -P /opt/k8s/yaml/kubesphere/ https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/cluster-configuration.yaml</span></span></code></pre></div><ul>
<li>6.1 ä¿®æ”¹<code>cluster-configuration</code>æ–‡ä»¶<code>å¯ç”¨å¯æ’æ‹”ç»„ä»¶</code></li>
</ul>
<blockquote>
<ul>
<li>6.1.1 <a href="https://kubesphere.com.cn/docs/v3.3/pluggable-components/overview/" rel="external" target="_self">å®˜ç½‘<!-- raw HTML omitted -->å¯ç”¨å¯æ’æ‹”ç»„ä»¶<!-- raw HTML omitted --></a></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterConfiguration</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ks-installer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kubesphere-system</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">version</span>: <span style="color:#ae81ff">v3.3.0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistence</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageClass</span>: <span style="color:#e6db74">&#34;&#34;</span>  	<span style="color:#75715e"># If there is no default StorageClass in your cluster, you need to specify an existing StorageClass here.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">authentication</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jwtSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>  	<span style="color:#75715e"># Keep the jwtSecret consistent with the Host Cluster. Retrieve the jwtSecret by executing &#34;kubectl -n kubesphere-system get cm kubesphere-config -o yaml | grep -v &#34;apiVersion&#34; | grep jwtSecret&#34; on the Host Cluster.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">local_registry</span>: <span style="color:#e6db74">&#34;&#34;</span>  	<span style="color:#75715e"># Add your private registry address if it is needed.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># dev_tag: &#34;&#34;  	# Add your kubesphere image tag you want to install, by default it&#39;s same as ks-installer release version.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">etcd</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">monitoring</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ etcd ç›‘æ§ä»ªè¡¨æ¿å®‰è£…ã€‚ åœ¨å¯ç”¨ä¹‹å‰ï¼Œæ‚¨å¿…é¡»ä¸º etcd åˆ›å»ºä¸€ä¸ª Secretï¼Œ å¯ç”¨ä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">endpointIps</span>: <span style="color:#ae81ff">192.168.94.110</span>  	<span style="color:#75715e"># etcd é›†ç¾¤ EndpointIpsã€‚ è¿™é‡Œå¯ä»¥æ˜¯ä¸€å †IPã€‚</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">2379</span>  	<span style="color:#75715e"># etcd port.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tlsEnable</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">common</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">core</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">console</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">enableMultiLogin</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># Enable or disable simultaneous logins. It allows different users to log in with the same account at the same time.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">port</span>: <span style="color:#ae81ff">30880</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># apiserver:  	# Enlarge the apiserver and controller manager&#39;s resource requests and limits for the large cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#  resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># controllerManager:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#  resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">redis</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨ Redis åŠŸèƒ½ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enableHA</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeSize</span>: <span style="color:#ae81ff">2Gi  	# Redis PVC size.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">openldap</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨è½»é‡çº§ç›®å½•åè®®ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeSize</span>: <span style="color:#ae81ff">2Gi  	# openldap PVC size.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">minio</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeSize</span>: <span style="color:#ae81ff">20Gi  	# Minio PVC size.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">monitoring</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># type: external  	# Whether to specify the external prometheus stack, and need to modify the endpoint at the next line.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">endpoint</span>: <span style="color:#ae81ff">http://prometheus-operated.kubesphere-monitoring-system.svc:9090</span> <span style="color:#75715e"># Prometheus endpoint to get metrics data.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">GPUMonitoring</span>:  	<span style="color:#75715e"># Enable or disable the GPU-related metrics. If you enable this switch but have no GPU resources, Kubesphere will set it to zero.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gpu</span>:  	<span style="color:#75715e"># Install GPUKinds. The default GPU kind is nvidia.com/gpu. Other GPU kinds can be added here according to your needs.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">kinds</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">resourceName</span>: <span style="color:#e6db74">&#34;nvidia.com/gpu&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resourceType</span>: <span style="color:#e6db74">&#34;GPU&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">default</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">es</span>:   <span style="color:#75715e"># Storage backend for logging, events and auditing.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># master:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   volumeSize: 4Gi  # The volume size of Elasticsearch master nodes.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   replicas: 1      # The total number of master nodes. Even numbers are not allowed.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># data:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   volumeSize: 20Gi  # The volume size of Elasticsearch data nodes.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   replicas: 1  	# The total number of data nodes.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">logMaxAge</span>: <span style="color:#ae81ff">7</span>  	<span style="color:#75715e"># Log retention time in built-in Elasticsearch. It is 7 days by default.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">elkPrefix</span>: <span style="color:#ae81ff">logstash  	# The string making up index names. The index name will be formatted as ks-&lt;elk_prefix&gt;-log.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">basicAuth</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">username</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">password</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">externalElasticsearchHost</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">externalElasticsearchPort</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">alerting:  	# (CPU: 0.1 Core, Memory</span>: <span style="color:#ae81ff">100</span> <span style="color:#ae81ff">MiB) It enables users to customize alerting policies to send messages to receivers in time with different time intervals and alerting levels to choose from.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ KubeSphere è­¦æŠ¥ç³»ç»Ÿï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># thanosruler:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   replicas: 1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">auditing</span>:  	<span style="color:#75715e"># Provide a security-relevant chronological set of recordsï¼Œrecording the sequence of activities happening on the platform, initiated by different tenants.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ KubeSphere å®¡è®¡æ—¥å¿—ç³»ç»Ÿï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># operator:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># webhook:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">devops:  	# (CPU: 0.47 Core, Memory</span>: <span style="color:#ae81ff">8.6</span> <span style="color:#ae81ff">G) Provide an out-of-the-box CI/CD system based on Jenkins, and automated workflow tools including Source-to-Image &amp; Binary-to-Image.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ KubeSphere DevOps ç³»ç»Ÿï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jenkinsMemoryLim</span>: <span style="color:#ae81ff">2Gi  	# Jenkins memory limit.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jenkinsMemoryReq</span>: <span style="color:#ae81ff">1500Mi  	# Jenkins memory request.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jenkinsVolumeSize</span>: <span style="color:#ae81ff">8Gi  	# Jenkins volume size.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jenkinsJavaOpts_Xms</span>: <span style="color:#ae81ff">1200m  	# The following three fields are JVM parameters.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jenkinsJavaOpts_Xmx</span>: <span style="color:#ae81ff">1600m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jenkinsJavaOpts_MaxRAM</span>: <span style="color:#ae81ff">2g</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">events</span>:  	<span style="color:#75715e"># Provide a graphical web console for Kubernetes Events exporting, filtering and alerting in multi-tenant Kubernetes clusters.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ KubeSphere äº‹ä»¶ç³»ç»Ÿï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># operator:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># exporter:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ruler:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   enabled: true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   replicas: 2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">logging:  	# (CPU: 57 m, Memory</span>: <span style="color:#ae81ff">2.76</span> <span style="color:#ae81ff">G) Flexible logging functions are provided for log query, collection and management in a unified console. Additional log collectors can be added, such as Elasticsearch, Kafka and Fluentd.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ KubeSphere æ—¥å¿—ç³»ç»Ÿï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">logsidecar</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">metrics_server:  	# (CPU: 56 m, Memory</span>: <span style="color:#ae81ff">44.35</span> <span style="color:#ae81ff">MiB) It enables HPA (Horizontal Pod Autoscaler).</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ç›‘æ§æŒ‡æ ‡æœåŠ¡å™¨ï¼Œä»hub.dockerå®˜æ–¹æ‹‰å–é•œåƒï¼Œç½‘ç»œä¸å¥½ä¼šæŠ¥ç½‘ç»œé”™è¯¯ï¼Œå¦‚æœå·²æå‰å®‰è£…è¯·å¿½ç•¥ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">monitoring</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageClass</span>: <span style="color:#e6db74">&#34;&#34;</span>  	<span style="color:#75715e"># If there is an independent StorageClass you need for Prometheus, you can specify it here. The default StorageClass is used by default.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">node_exporter</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">port</span>: <span style="color:#ae81ff">9100</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># kube_rbac_proxy:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># kube_state_metrics:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># prometheus:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   replicas: 1  # Prometheus replicas are responsible for monitoring different segments of data source and providing high availability.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   volumeSize: 20Gi  # Prometheus PVC size.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   operator:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># alertmanager:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   replicas: 1  	# AlertManager Replicas.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># notification_manager:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   operator:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   proxy:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gpu</span>:  	<span style="color:#75715e"># GPU monitoring-related plug-in installation.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nvidia_dcgm_exporter</span>:  	<span style="color:#75715e"># Ensure that gpu resources on your hosts can be used normally, otherwise this plug-in will not work properly.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>  	<span style="color:#75715e"># Check whether the labels on the GPU hosts contain &#34;nvidia.com/gpu.present=true&#34; to ensure that the DCGM pod is scheduled to these nodes.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">multicluster</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">clusterRole</span>: <span style="color:#ae81ff">none  # host | member | none </span> <span style="color:#75715e"># You can install a solo cluster, or specify it as the Host or Member Cluster.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">network</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networkpolicy</span>: <span style="color:#75715e"># Network policies allow network isolation within the same cluster, which means firewalls can be set up between certain instances (Pods).</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Make sure that the CNI network plugin used by the cluster supports NetworkPolicy. There are a number of CNI network plugins that support NetworkPolicy, including Calico, Cilium, Kube-router, Romana and Weave Net.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ç½‘ç»œç­–ç•¥ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ippool</span>: <span style="color:#75715e"># Use Pod IP Pools to manage the Pod network address space. Pods to be created can be assigned IP addresses from a Pod IP Pool.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">none</span> <span style="color:#75715e"># å¦‚æœ Calico ç”¨ä½œæ‚¨çš„ CNI æ’ä»¶ï¼Œè¯·ä¸ºæ­¤å­—æ®µæŒ‡å®šâ€œcalicoâ€ã€‚ â€œnoneâ€è¡¨ç¤º Pod IP æ± å·²ç¦ç”¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">topology</span>: <span style="color:#75715e"># Use Service Topology to view Service-to-Service communication based on Weave Scope.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">none</span> <span style="color:#75715e"># Specify &#34;weave-scope&#34; for this field to enable Service Topology. &#34;none&#34; means that Service Topology is disabled.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">openpitrix</span>: <span style="color:#75715e"># An App Store that is accessible to all platform tenants. You can use it to manage apps across their entire lifecycle.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">store</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ KubeSphere åº”ç”¨å•†åº—ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">servicemesh</span>:  	<span style="color:#75715e"># (0.3 Core, 300 MiB) Provide fine-grained traffic management, observability and tracing, and visualized traffic topology.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># åŸºç¡€ç»„ä»¶ï¼ˆè¯•ç‚¹ï¼‰ã€‚ å¯ç”¨æˆ–ç¦ç”¨ KubeSphere æœåŠ¡ç½‘æ ¼ï¼ˆåŸºäº Istioï¼‰å¾®æœåŠ¡æ²»ç†åŠŸèƒ½ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">istio</span>:  <span style="color:#75715e"># Customizing the istio installation configuration, refer to https://istio.io/latest/docs/setup/additional-setup/customize-installation/</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">components</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ingressGateways</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">istio-ingressgateway</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">cni</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">edgeruntime</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å°†è¾¹ç¼˜èŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤å¹¶åœ¨è¾¹ç¼˜èŠ‚ç‚¹ä¸Šéƒ¨ç½²å·¥ä½œè´Ÿè½½ï¼Œå¯åŠ¨è¾¹ç¼˜è®¡ç®—æœåŠ¡ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kubeedge</span>:  	<span style="color:#75715e"># kubeedge configurations</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cloudCore</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">cloudHub</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">advertiseAddress</span>: <span style="color:#75715e"># At least a public IP address or an IP address which can be accessed by edge nodes must be provided.</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#e6db74">&#34;&#34;</span>            <span style="color:#75715e"># Note that once KubeEdge is enabled, CloudCore will malfunction if the address is not provided.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cloudhubNodePort</span>: <span style="color:#e6db74">&#34;30000&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cloudhubQuicNodePort</span>: <span style="color:#e6db74">&#34;30001&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cloudhubHttpsNodePort</span>: <span style="color:#e6db74">&#34;30002&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cloudstreamNodePort</span>: <span style="color:#e6db74">&#34;30003&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">tunnelNodePort</span>: <span style="color:#e6db74">&#34;30004&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># resources: {}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># hostNetWork: false</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">iptables-manager</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">mode</span>: <span style="color:#e6db74">&#34;external&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># resources: {}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># edgeService:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">gatekeeper</span>:        <span style="color:#75715e"># Provide admission policy and rule management, A validating (mutating TBA) webhook that enforces CRD-based policies executed by Open Policy Agent.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e"># Enable or disable Gatekeeper.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># controller_manager:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># audit:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">terminal</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># image: &#39;alpine:3.15&#39; # There must be an nsenter program in the image</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeout</span>: <span style="color:#ae81ff">600</span>  	<span style="color:#75715e"># Container timeout, if set to 0, no timeout will be used. The unit is seconds</span></span></span></code></pre></div><ul>
<li>6.2 <!-- raw HTML omitted -->ä¿®æ”¹å¥½é…ç½®åå®‰è£…<!-- raw HTML omitted --><code>KubeSphere</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl apply -f kubesphere-installer.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f cluster-configuration.yaml</span></span></code></pre></div><ul>
<li>6.3 <!-- raw HTML omitted -->è·Ÿè¸ªå®‰è£…è¿›åº¦<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl logs -n kubesphere-system <span style="color:#66d9ef">$(</span>kubectl get pod -n kubesphere-system -l <span style="color:#e6db74">&#39;app in (ks-install, ks-installer)&#39;</span> -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.items[0].metadata.name}&#39;</span><span style="color:#66d9ef">)</span> -f</span></span></code></pre></div><ul>
<li>6.4 æŸ¥çœ‹æ‰€æœ‰<code>Pod</code>æ˜¯å¦åœ¨<code>KubeSphere</code><!-- raw HTML omitted -->çš„ç›¸å…³å‘½åç©ºé—´ä¸­æ­£å¸¸è¿è¡Œ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get svc/ks-console -n kubesphere-system</span></span></code></pre></div><ul>
<li>6.5 è§£å†³<code>prometheus-k8s</code>çš„<code>pods</code><!-- raw HTML omitted -->å› ä¸ºè¯ä¹¦ä¸èƒ½å¯åŠ¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl -n kubesphere-monitoring-system create secret generic kube-etcd-client-certs  --from-file<span style="color:#f92672">=</span>etcd-client-ca.crt<span style="color:#f92672">=</span>/etc/kubernetes/pki/etcd/ca.crt  --from-file<span style="color:#f92672">=</span>etcd-client.crt<span style="color:#f92672">=</span>/etc/kubernetes/pki/apiserver-etcd-client.crt  --from-file<span style="color:#f92672">=</span>etcd-client.key<span style="color:#f92672">=</span>/etc/kubernetes/pki/apiserver-etcd-client.key</span></span></code></pre></div><ul>
<li>6.6 <!-- raw HTML omitted -->ä½¿ç”¨æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted --><code>KubeSphere</code>æ”¾è¡Œï¼š<code>30880</code>ç«¯å£</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><strong>é»˜è®¤ç”¨æˆ·åï¼š</strong><!-- raw HTML omitted --><code>admin</code></li>
<li><!-- raw HTML omitted --><strong>é»˜è®¤å¯†ç ï¼š</strong><!-- raw HTML omitted --><code>P@88w0rd</code></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ http://IP:30880</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_k8s_harbor">Install_K8s_Harbor</h1>

<h2 id="å®‰è£…harborç§æœ‰é•œåƒåº“">å®‰è£…<code>Harbor</code>ç§æœ‰é•œåƒåº“</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><strong>é»˜è®¤ç”¨æˆ·åï¼š</strong><!-- raw HTML omitted --><code>admin </code></li>
<li><!-- raw HTML omitted --><strong>é»˜è®¤å¯†ç ï¼š</strong><!-- raw HTML omitted --><code>Harbor12345</code></li>
<li><!-- raw HTML omitted --><strong>å¿…é¡»å…ˆå®‰è£…</strong><!-- raw HTML omitted --><code>docker</code></li>
<li><code>Harbor</code><!-- raw HTML omitted --><strong>ä¾èµ–</strong><!-- raw HTML omitted --><code>docker-compose</code></li>
</ul>
</blockquote>
<hr>
<h3 id="å®‰è£…docker-compose">å®‰è£…<code>docker-compose</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -L https://get.daocloud.io/docker/compose/releases/download/1.21.2/docker-compose-<span style="color:#e6db74">`</span>uname -s<span style="color:#e6db74">`</span>-<span style="color:#e6db74">`</span>uname -m<span style="color:#e6db74">`</span> &gt; /usr/local/bin/docker-compose
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç»™äºˆæ‰§è¡Œæƒé™</span>
</span></span><span style="display:flex;"><span>$ chmod +x /usr/local/bin/docker-compose
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…Composeå‘½ä»¤è¡¥å…¨å·¥å…·</span>
</span></span><span style="display:flex;"><span>$ curl -L https://raw.githubusercontent.com/docker/compose/<span style="color:#66d9ef">$(</span>docker-compose version --short<span style="color:#66d9ef">)</span>/contrib/completion/bash/docker-compose -o /etc/bash_completion.d/docker-compose
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload <span style="color:#f92672">&amp;&amp;</span> systemctl restart docker</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å®‰è£…harbor">å®‰è£…<code>Harbor</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://github.com/goharbor/harbor/releases/download/v2.10.0/harbor-offline-installer-v2.10.0.tgz
</span></span><span style="display:flex;"><span>$ tar -zxvf harbor-offline-installer-v2.10.0.tgz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vim harbor/harbor.yml
</span></span><span style="display:flex;"><span>hostname: reg.mydomain.com  	<span style="color:#75715e"># ä¿®æ”¹ä¸»æœºåï¼š my.harbor.com</span>
</span></span><span style="display:flex;"><span>port: <span style="color:#ae81ff">80</span>  	<span style="color:#75715e"># ä¿®æ”¹httpé»˜è®¤ç«¯å£ï¼š8080</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># port: 443  	# æ³¨é‡Šhttpsåè®®ç«¯å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./install.sh</span></span></code></pre></div><ul>
<li><a href="https://goharbor.io/docs/2.0.0/install-config/configure-https/" rel="external" target="_self">é…ç½®å¯¹<code>Harbor</code>çš„<code>HTTPS</code>è®¿é—®</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆ CA è¯ä¹¦ç§é’¥</span>
</span></span><span style="display:flex;"><span>$ openssl genrsa -out ca.key <span style="color:#ae81ff">4096</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆ CA è¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ openssl req -x509 -new -nodes -sha512 -days <span style="color:#ae81ff">3650</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -subj <span style="color:#e6db74">&#34;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=yourdomain.com&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -key ca.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -out ca.crt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆç§é’¥</span>
</span></span><span style="display:flex;"><span>$ openssl genrsa -out yourdomain.com.key <span style="color:#ae81ff">4096</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ (CSR)</span>
</span></span><span style="display:flex;"><span>$ openssl req -sha512 -new <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -subj <span style="color:#e6db74">&#34;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=yourdomain.com&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -key yourdomain.com.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -out yourdomain.com.csr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆ x509 v3 æ‰©å±•æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt; v3.ext <span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">authorityKeyIdentifier=keyid,issuer
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basicConstraints=CA:FALSE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">extendedKeyUsage = serverAuth
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjectAltName = @alt_names
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[alt_names]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DNS.1=yourdomain.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DNS.2=yourdomain
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DNS.3=hostname
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨è¯¥v3.extæ–‡ä»¶ä¸ºæ‚¨çš„ Harbor ä¸»æœºç”Ÿæˆè¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ openssl x509 -req -sha512 -days <span style="color:#ae81ff">3650</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -extfile v3.ext <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -CA ca.crt -CAkey ca.key -CAcreateserial <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -in yourdomain.com.csr <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -out yourdomain.com.crt</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><code>docker</code><!-- raw HTML omitted -->ç™»å½•<!-- raw HTML omitted --><code>Harbor</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker login http://192.168.80.225:8080</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å¦‚æœæŠ¥é”™ï¼š<!-- raw HTML omitted --><code>Error response from daemon: Get  http: server gave HTTP response to HTTPS client</code></li>
</ol>
</li>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶(æŒ‡å®šç§æœ‰ä»“åº“ï¼Œå¯å¿½ç•¥è·³è¿‡)<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tee /etc/docker/daemon.json <span style="color:#e6db74">&lt;&lt;-&#39;EOF&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;storage-driver&#34;: &#34;overlay2&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;registry-mirrors&#34;:[&#34;https://r2hd8p9u.mirror.aliyuncs.com&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;insecure-registries&#34;:[&#34;*.*.*.*:5000&#34;,&#34;192.168.4.126&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /etc/docker/daemon.json
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;insecure-registries&#34;</span>: <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;harboræœåŠ¡å™¨IP:ç«¯å£&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload <span style="color:#f92672">&amp;&amp;</span> systemctl restart docker</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æŠ¥é”™ï¼š<!-- raw HTML omitted --><code>request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers) (Client.Timeout exceeded while awaiting headers)</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /etc/hosts  	<span style="color:#75715e"># ä¿®æ”¹hostsè§£æ</span>
</span></span><span style="display:flex;"><span>æœ¬æœºæœåŠ¡IP my.harbodomain.com</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ¨é€é•œåƒåˆ°harborä»“åº“">æ¨é€é•œåƒåˆ°<code>Harbor</code>ä»“åº“</h3>
<blockquote>
<ul>
<li><code>SOURCE_IMAGE[:TAG]</code><!-- raw HTML omitted -->ï¼šåŸé•œåƒåå­—å’Œ<!-- raw HTML omitted --><code>tag</code></li>
<li><code>test</code><!-- raw HTML omitted -->ï¼š<code>Harbor</code>é¡¹ç›®åç§°<!-- raw HTML omitted --></li>
<li><code>IMAGE[:TAG]</code><!-- raw HTML omitted -->ï¼šè‡ªå®šä¹‰å‘½åï¼Œä»¥åŠç‰ˆæœ¬æ ‡ç­¾<!-- raw HTML omitted --></li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<div class="highlight wrap-code"><pre tabindex="0"><code class="language-she" data-lang="she"># åœ¨é¡¹ç›®ä¸­æ ‡è®°é•œåƒ
$ docker tag SOURCE_IMAGE[:TAG] 192.168.35.128:9527/test/IMAGE[:TAG]

# æ¨é€é•œåƒåˆ°å½“å‰é¡¹ç›®
$ docker push 192.168.35.128:9527/test/IMAGE[:TAG]</code></pre></div></blockquote>
<hr>
<h3 id="font-colorredå…¶ä»–æœåŠ¡å™¨æ‹‰å–fontharborfont-colorredä»“åº“é•œåƒfont"><!-- raw HTML omitted -->å…¶ä»–æœåŠ¡å™¨æ‹‰å–<!-- raw HTML omitted --><code>Harbor</code><!-- raw HTML omitted -->ä»“åº“é•œåƒ<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><code>/etc/hosts</code><!-- raw HTML omitted -->åšå¥½è§£æ<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><code>daemon.json</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸­æ·»åŠ ç§äººä»“åº“å‚æ•°<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /etc/docker/daemon.json
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;insecure-registries&#34;</span>:<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;192.168.80.210:8080&#34;</span><span style="color:#f92672">]</span>,</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æ‹‰å–ç§äººä»“åº“é•œåƒï¼Œå‰æä»“åº“æ˜¯å…¬å¼€ç±»å‹ï¼Œç„¶åè·å–æ‹‰å–å‘½ä»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-b04d4584bdcc9823890464f9912abc4b" class="lightbox-link"><img alt="æ‹‰å–ç§äººä»“åº“å‘½ä»¤" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Harbor/Snipaste_2022-06-07_21-19-25.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b04d4584bdcc9823890464f9912abc4b"><img alt="æ‹‰å–ç§äººä»“åº“å‘½ä»¤" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Harbor/Snipaste_2022-06-07_21-19-25.png"></a></p>
</blockquote>
<hr>
<h3 id="é…ç½®k8sä½¿ç”¨harboré•œåƒä»“åº“">é…ç½®<code>K8S</code>ä½¿ç”¨<code>Harbor</code>é•œåƒä»“åº“</h3>
<blockquote>
<ul>
<li><code>docker-harbor</code>ï¼š<code>secret</code><!-- raw HTML omitted -->åç§°è‡ªå®šä¹‰<!-- raw HTML omitted --></li>
<li><code>--docker-server</code>ï¼š<code>Harbor</code><!-- raw HTML omitted -->ä»“åº“åœ°å€<!-- raw HTML omitted --></li>
<li><code>--docker-username</code>ï¼š<code>Harbor</code><!-- raw HTML omitted -->ç™»å½•ç”¨æˆ·å<!-- raw HTML omitted --></li>
<li><code>--docker-password</code>ï¼š<code>Harbor</code><!-- raw HTML omitted -->ä»“åº“ç™»å½•å¯†ç <!-- raw HTML omitted --></li>
<li><code>--docker-email</code><!-- raw HTML omitted -->ï¼šé‚®ç®±åœ°å€<!-- raw HTML omitted --></li>
<li><code>--namespace</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šå‘½åç©ºé—´ï¼Œä¸æŒ‡å®šé»˜è®¤ä¸ºï¼š<!-- raw HTML omitted --><code>default</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create secret docker-registry docker-harbor --docker-server<span style="color:#f92672">=</span>192.168.80.210:8080 --docker-username<span style="color:#f92672">=</span>admin --docker-password<span style="color:#f92672">=</span>Harbor12345 --docker-email<span style="color:#f92672">=</span>xxx@xxx.com --namespace<span style="color:#f92672">=</span>harbor</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å°†æœºå¯†æ•°æ®è½¬æ¢ä¸ºå¯è¯»æ ¼å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get secret docker-harbor --output<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;jsonpath={.data.\.dockerconfigjson}&#34;</span> | base64 --decode
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¾“å…¥ä»¥ä¸‹å†…å®¹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#34;auths&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;192.168.80.210:8080&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;username&#34;</span>:<span style="color:#e6db74">&#34;admin&#34;</span>,<span style="color:#e6db74">&#34;password&#34;</span>:<span style="color:#e6db74">&#34;Harbor12345&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;xxx@xxx.com&#34;</span>,<span style="color:#e6db74">&#34;auth&#34;</span>:<span style="color:#e6db74">&#34;YWRtaW46SGFyYm9yMTIzNDU=&#34;</span><span style="color:#f92672">}}}</span></span></span></code></pre></div><ul>
<li>å°†<code>base64</code><!-- raw HTML omitted -->ç¼–ç çš„æ•°æ®è½¬æ¢ä¸ºå¯è¯»æ ¼å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;YWRtaW46SGFyYm9yMTIzNDU=&#34;</span> | base64 --decode
</span></span><span style="display:flex;"><span>admin:Harbor12345  	<span style="color:#75715e"># è¾“å‡ºç»“æœ</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç”Ÿæˆ<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œå¹¶åœ¨<!-- raw HTML omitted --><code>spec.containers</code><!-- raw HTML omitted -->å­—æ®µä¸­ä¿®æ”¹ç§äººé•œåƒå‚æ•°<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>ç”Ÿæˆ<code>Deployment</code>çš„<code>yaml</code>æ–‡ä»¶å¹¶åº”ç”¨</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create deployment java-demo --image<span style="color:#f92672">=</span>192.168.80.210:8080/test/tomcat-demo:v1 --dry-run<span style="color:#f92672">=</span>client -o yaml &gt;/tmp/deploy.yaml</span></span></code></pre></div><ul>
<li><code>192.168.80.210:8080</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šä½¿ç”¨ç§äººä»“åº“åœ°å€ï¼ŒåŸŸåæˆ–è€…IPåœ°å€åŠ ç«¯å£å·<!-- raw HTML omitted --></li>
<li><code>test</code><!-- raw HTML omitted -->ï¼šç§äººä»“åº“åº“æˆ¿åç§°<!-- raw HTML omitted --></li>
<li><code>tomcat-demo</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨ç§äººä»“åº“çš„é•œåƒ<!-- raw HTML omitted --></li>
<li><code>v1</code><!-- raw HTML omitted -->ï¼šå¿…é¡»æŒ‡å®šè¦ä½¿ç”¨ç§äººä»“åº“é•œåƒçš„ç‰ˆæœ¬å·<!-- raw HTML omitted --></li>
<li><code>name: tomcat-demo</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šä½¿ç”¨çš„é•œåƒåå­—<!-- raw HTML omitted --></li>
<li><code>imagePullSecrets:</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šä½¿ç”¨å…¶ä»–é•œåƒåœ°å€<!-- raw HTML omitted --></li>
<li><code>- name: docker-harbor</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šå®šä¹‰çš„ç§äººä»“åº“åå­—<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">java-demo</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">java-demo</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: <span style="color:#ae81ff">java-demo</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: <span style="color:#ae81ff">java-demo</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">192.168.80.210</span>:<span style="color:#ae81ff">8080</span><span style="color:#ae81ff">/test/tomcat-demo:v1 </span> <span style="color:#75715e"># éœ€ä¿®æ”¹å¤„</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">tomcat-demo  	# é»˜è®¤ç”Ÿæˆ</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">imagePullSecrets</span>:  	<span style="color:#75715e"># æ‰‹åŠ¨æ·»åŠ å­—æ®µ</span>
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker-harbor  	# æŒ‡å®šä½¿ç”¨çš„secretåº“æˆ¿åç§°</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>Service</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œåº”ç”¨å¹¶è®¿é—®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl expose deployment java-demo --port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span> --target-port<span style="color:#f92672">=</span><span style="color:#ae81ff">8080</span> --type<span style="color:#f92672">=</span>NodePort --dry-run<span style="color:#f92672">=</span>client -o yaml &gt;/opt/yaml/java-demo-svc.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;/opt/yaml/java-demo-svc.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  app: java-demo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name: java-demo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - port: 8080  	# Service é›†ç¾¤ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          protocol: TCP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          targetPort: 8080  	# Pod æœ¬èº«æœåŠ¡ç«¯å£ï¼Œæ¯”å¦‚Nginxï¼š80ï¼ŒTomcatï¼š8080
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          nodePort: 30001  	# å¤–ç½‘è®¿é—®ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            app: java-demo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        type: NodePort
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create -f java-demo-svc.yaml
</span></span><span style="display:flex;"><span>$ kubectl get service
</span></span><span style="display:flex;"><span>$ http://192.168.80.210:30001/  	<span style="color:#75715e"># æµè§ˆå™¨è®¿é—®åœ°å€</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_k8s_dashboard">Install_K8s_Dashboard</h1>

<h2 id="éƒ¨ç½²dashboardç«¯å£æ˜ å°„å¯ä»¥ç”¨äºwebè®¿é—®">éƒ¨ç½²<code>Dashboard</code>(ç«¯å£æ˜ å°„ï¼Œå¯ä»¥ç”¨äº<code>web</code>è®¿é—®)</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/kubernetes/dashboard" rel="external" target="_self"><code>Kubernetes Dashboard</code></a></td>
<td>å®˜æ–¹å¯è§†åŒ–ç•Œé¢</td>
</tr>
<tr>
<td><a href="https://kubesphere.io/zh/" rel="external" target="_self"><code>KubeSphere</code></a></td>
<td>é’äº‘</td>
</tr>
<tr>
<td><a href="https://www.rancher.com/" rel="external" target="_self"><code>Rancher</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://kuboard.cn/" rel="external" target="_self"><code>Kuboard</code></a></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>kubernetes</code>å®˜æ–¹å¼€å‘äº†ä¸€ä¸ªåŸºäº<code>web</code>çš„ç”¨æˆ·ç•Œé¢<code>DashBoard</code>ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨<code>DashBoard</code>éƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ï¼Œè€Œä¸”è¿˜å¯ä»¥ç›‘æ§åº”ç”¨çš„çŠ¶æ€ï¼Œæ‰§è¡Œæ•…éšœæ’æŸ¥ä»¥åŠç®¡ç†<code>kubernetes</code>ä¸­çš„å„ç§èµ„æºã€‚</li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸‹è½½ç”¨äºéƒ¨ç½²<!-- raw HTML omitted --><code>DashBoard</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ä¿®æ”¹å¹¶è¿è¡Œ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>ä¸‹è½½éƒ¨ç½²æ–‡ä»¶</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/kubernetes/cfg/
</span></span><span style="display:flex;"><span>$ wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>recommended.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶çš„<!-- raw HTML omitted --><code>Service</code><!-- raw HTML omitted -->ç±»å‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">k8s-app</span>: <span style="color:#ae81ff">kubernetes-dashboard</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">kubernetes-dashboard</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kubernetes-dashboard</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span> - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">8443</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">nodePort</span>: <span style="color:#ae81ff">30001</span>       <span style="color:#75715e"># æ­¤å¤„æ–°å¢</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort      		# æ­¤å¤„æ–°å¢</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">k8s-app</span>: <span style="color:#ae81ff">kubernetes-dashboard</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->éƒ¨ç½²<!-- raw HTML omitted --><code>DashBoard</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create -f recommended.yaml</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>namespace</code><!-- raw HTML omitted -->ä¸‹åä¸º<!-- raw HTML omitted --><code>kubernetes-dashboard</code><!-- raw HTML omitted -->ä¸‹çš„èµ„æº<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get pods,svc -n kubernetes-dashboard
</span></span><span style="display:flex;"><span>NAME                                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod/dashboard-metrics-scraper-694557449d-mvnc8   1/1     Running   <span style="color:#ae81ff">0</span>          21s
</span></span><span style="display:flex;"><span>pod/kubernetes-dashboard-9774cc786-fm748         1/1     Running   <span style="color:#ae81ff">0</span>          21s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                                TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>         AGE
</span></span><span style="display:flex;"><span>service/dashboard-metrics-scraper   ClusterIP   10.0.0.248   &lt;none&gt;        8000/TCP        21s
</span></span><span style="display:flex;"><span>service/kubernetes-dashboard        NodePort    10.0.0.15    &lt;none&gt;        443:30001/TCP   22s</span></span></code></pre></div><ul>
<li><code>dashboard-admin.yaml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">dashboard-admin</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kubernetes-dashboard</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">kubernetes-dashboard</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">dashboard-admin</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">cluster-admin</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">dashboard-admin</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kubernetes-dashboard</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>service account</code><!-- raw HTML omitted -->å¹¶ç»‘å®šé»˜è®¤<!-- raw HTML omitted --><code>cluster-admin</code><!-- raw HTML omitted -->ç®¡ç†å‘˜é›†ç¾¤è§’è‰²ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æˆæƒï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create clusterrolebinding dashboard-admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--clusterrole<span style="color:#f92672">=</span>cluster-admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--serviceaccount<span style="color:#f92672">=</span>kubernetes-dashboard:dashboard-admin</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–è´¦å·<!-- raw HTML omitted --><code>token</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬ä¸€ç§æ–¹å¼</span>
</span></span><span style="display:flex;"><span>$ kubectl describe secrets -n kubernetes-dashboard <span style="color:#66d9ef">$(</span>kubectl -n kubernetes-dashboard get secret | awk <span style="color:#e6db74">&#39;/dashboard-admin/{print $1}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬äºŒç§æ–¹å¼</span>
</span></span><span style="display:flex;"><span>$ kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin
</span></span><span style="display:flex;"><span>$ kubectl describe secrets dashboard-admin-token-b992l -n kubernetes-dashboard</span></span></code></pre></div></blockquote>
<hr>
<h2 id="é€šè¿‡æµè§ˆå™¨è®¿é—®dashboardçš„ui">é€šè¿‡æµè§ˆå™¨è®¿é—®<code>DashBoard</code>çš„<code>UI</code></h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š<!-- raw HTML omitted --><code>https://NodeIP:30001</code></li>
<li><!-- raw HTML omitted -->æ‰“å¼€è°·æ­Œæµè§ˆå™¨æç¤ºï¼š<!-- raw HTML omitted --><code>NET::ERR_CERT_INVALID</code></li>
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>chrome</code><!-- raw HTML omitted -->è¯¥é¡µé¢ä¸Šï¼Œç›´æ¥é”®ç›˜æ•²å…¥è¿™12ä¸ªå­—ç¬¦ï¼š<!-- raw HTML omitted --><code>thisisunsafe</code></li>
<li><!-- raw HTML omitted --><strong>æ³¨æ„ï¼š</strong><!-- raw HTML omitted -->é¼ æ ‡ç‚¹å‡»å½“å‰é¡µé¢ä»»æ„ä½ç½®ï¼Œè®©é¡µé¢å¤„äºæœ€ä¸Šå±‚å³å¯è¾“å…¥</li>
<li><!-- raw HTML omitted -->å¤åˆ¶åˆ›å»º<!-- raw HTML omitted --><code>cluster-admin</code><!-- raw HTML omitted -->ç”Ÿæˆçš„<!-- raw HTML omitted --><code>token</code><!-- raw HTML omitted -->åˆ°æµè§ˆå™¨ç™»å½•<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_k8s_coredns">Install_K8s_CoreDNS</h1>

<h2 id="å®‰è£…coredns">å®‰è£…<code>CoreDNS</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å»å®˜ç½‘ä¸‹è½½<!-- raw HTML omitted --><a href="https://github.com/coredns/deployment/tree/master/kubernetes" rel="external" target="_self"><code>CoreDNS</code></a><code>deploy.sh</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>coredns.yam.sed</code><!-- raw HTML omitted -->ä¸¤ä¸ªæ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="https://kaerser.github.io/2019/03/11/coredns%E9%85%8D%E7%BD%AE/" rel="external" target="_self"><code>CoreDNS</code>é…ç½®</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://github.com/coredns/deployment/blob/08c2b11241ef67b5d22d2020c00001ce0baec566/kubernetes/deploy.sh
</span></span><span style="display:flex;"><span>$ wget https://github.com/coredns/deployment/blob/08c2b11241ef67b5d22d2020c00001ce0baec566/kubernetes/coredns.yaml.sed
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å¸®åŠ©</span>
</span></span><span style="display:flex;"><span>$ ./deploy.sh -h</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>REVERSE_CIDRS=&quot;10.254.0.0/16&quot;</code><!-- raw HTML omitted -->ï¼šé…ç½®<!-- raw HTML omitted --><code>kubernetes svc</code><!-- raw HTML omitted -->ç½‘æ®µ<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="4">
<li><code>CLUSTER_DNS_IP=&quot;10.254.0.2&quot;</code><!-- raw HTML omitted -->ï¼šé…ç½®<!-- raw HTML omitted --><code>kubernetes DNS IP</code></li>
</ol>
</li>
<li>
<ol start="5">
<li><code>CLUSTER_DOMAIN=&quot;cluster.local&quot;</code><!-- raw HTML omitted -->ï¼šé…ç½®<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->çš„åŸŸå<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->-r<!-- raw HTML omitted -->ï¼š<code>kubernetes svc</code>ç½‘æ®µã€<!-- raw HTML omitted -->-i<!-- raw HTML omitted -->ï¼š<code>kubernetes DNS IP</code>ã€<!-- raw HTML omitted -->-d<!-- raw HTML omitted -->ï¼š<code>kubernetes</code>çš„åŸŸå</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$  ./deploy.sh -s -r 10.254.0.0/16 -i 10.254.0.10 -d cluster.local &gt; coredns.yaml
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹å‰åå¯¹æ¯”</span>
</span></span><span style="display:flex;"><span>$ diff coredns.yaml coredns.yaml.sed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨Coredns</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f coredns.yaml</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_k8s_argo_cd">Install_K8s_Argo_CD</h1>

<h2 id="argo-cdä»‹ç»"><code>Argo CD</code>ä»‹ç»</h2>
<blockquote>
<ul>
<li><code>Argo CD</code>æ˜¯ä¸€ä¸ªä¸º<code>Kubernetes</code>è€Œç”Ÿçš„ï¼Œéµå¾ªå£°æ˜å¼<code>GitOps</code>ç†å¿µçš„æŒç»­éƒ¨ç½²<code>CD</code>å·¥å…·ã€‚<code>Argo CD</code>å¯åœ¨<code>Git</code>å­˜å‚¨åº“æ›´æ”¹æ—¶è‡ªåŠ¨åŒæ­¥å’Œéƒ¨ç½²åº”ç”¨ç¨‹åº</li>
<li>åº”ç”¨å®šä¹‰ã€é…ç½®å’Œç¯å¢ƒä¿¡æ¯æ˜¯å£°æ˜å¼çš„ï¼Œå¹¶å¯ä»¥è¿›è¡Œç‰ˆæœ¬æ§åˆ¶</li>
<li>åº”ç”¨éƒ¨ç½²å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†æ˜¯å…¨è‡ªåŠ¨åŒ–çš„ã€æ˜¯å¯å®¡è®¡çš„ï¼Œæ¸…æ™°æ˜“æ‡‚</li>
</ul>
</blockquote>
<hr>
<h2 id="å®‰è£…argo-cd">å®‰è£…<code>Argo CD</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>ArgoCD</code><!-- raw HTML omitted -->å‘½åç©ºé—´<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create namespace argocd</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¸‹è½½å¹¶å¯åŠ¨<!-- raw HTML omitted --><code>ArgoCD</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>NodePort</code><!-- raw HTML omitted -->æ–¹å¼æš´éœ²<!-- raw HTML omitted --><code>argocd ui</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl patch service -n argocd argocd-server -p <span style="color:#e6db74">&#39;{&#34;spec&#34;: {&#34;type&#34;: &#34;NodePort&#34;}}&#39;</span>  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->è·å–<!-- raw HTML omitted --><code>ArgoCD</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>admin</code><!-- raw HTML omitted -->ç™»é™†å¯†ç <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.data.password}&#34;</span> | base64 -d</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>cliï¼šCLI</code><!-- raw HTML omitted -->æ˜¯ç”¨äºç®¡ç†<!-- raw HTML omitted --><code>Argo CD</code><!-- raw HTML omitted -->çš„å‘½ä»¤è¡Œå·¥å…·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -sSL -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/download/v2.3.3/argocd-linux-amd64 <span style="color:#f92672">&amp;&amp;</span> chmod +x /usr/local/bin/argocd</span></span></code></pre></div></blockquote>
<ol start="6">
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>argocd-server</code><!-- raw HTML omitted -->æš´éœ²ç«¯å£<!-- raw HTML omitted --></li>
</ol>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get svc -n argocd</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_k8s_storage">Configure_K8s_Storage</h1>

<h1 id="kubernetesæ•°æ®å­˜å‚¨"><code>Kubernetes</code>æ•°æ®å­˜å‚¨</h1>
<ul>
<li>
<ol>
<li>éƒ½çŸ¥é“å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½å¾ˆçŸ­ï¼Œä¼šè¢«é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ã€‚é‚£ä¹ˆå®¹å™¨åœ¨é”€æ¯çš„æ—¶å€™ï¼Œä¿å­˜åœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚è¿™ç§ç»“æœå¯¹ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸ä¹æ„çœ‹åˆ°çš„ã€‚ä¸ºäº†æŒä¹…åŒ–ä¿å­˜å®¹å™¨ä¸­çš„æ•°æ®ï¼Œ<code>kubernetes</code>å¼•å…¥äº†<code>Volume</code>çš„æ¦‚å¿µ</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>Volume</code>æ˜¯<code>Pod</code>ä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨<code>Pod</code>ä¸Šï¼Œç„¶åè¢«ä¸€ä¸ª<code>Pod</code>é‡Œé¢çš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œ<code>kubernetes</code>é€šè¿‡<code>Volume</code>å®ç°åŒä¸€ä¸ª<code>Pod</code>ä¸­ä¸åŒå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ä»¥åŠæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚<code>Volume</code>çš„ç”Ÿå‘½å‘¨æœŸä¸å’Œ<code>Pod</code>ä¸­çš„å•ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæœ‰å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯çš„æ—¶å€™ï¼Œ<code>Volume</code>ä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>kubernetes</code>çš„<code>Volume</code>æ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‹é¢çš„å‡ ä¸ªï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç®€å•å­˜å‚¨<!-- raw HTML omitted -->ï¼š<code>EmptyDir</code>ã€<code>HostPath</code>ã€<code>NFS</code></li>
<li><!-- raw HTML omitted -->é«˜çº§å­˜å‚¨<!-- raw HTML omitted -->ï¼š<code>PV</code>ã€<code>PVC</code></li>
<li><!-- raw HTML omitted -->é…ç½®å­˜å‚¨<!-- raw HTML omitted -->ï¼š<code>ConfigMap</code>ã€<code>Secret</code></li>
</ul>
</blockquote>
<hr>
<h2 id="ç®€å•å­˜å‚¨">ç®€å•å­˜å‚¨</h2>
<h3 id="emptydir"><code>EmptyDir</code></h3>
<ul>
<li>
<ol>
<li><code>EmptyDir</code>æ˜¯æœ€åŸºç¡€çš„<code>Volume</code>ç±»å‹ï¼Œä¸€ä¸ª<code>EmptyDir</code>å°±æ˜¯<code>Host</code>ä¸Šçš„ä¸€ä¸ªç©ºç›®å½•</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>EmptyDir</code>æ˜¯åœ¨<code>Pod</code>è¢«åˆ†é…åˆ°<code>Node</code>æ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸º<code>kubernetes</code>ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç›®å½•ï¼Œå½“<code>Pod</code>é”€æ¯æ—¶ï¼Œ<code>EmptyDir</code>ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>EmptyDir</code>çš„ç”¨é€”å¦‚ä¸‹</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸´æ—¶ç©ºé—´<!-- raw HTML omitted -->ä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™</li>
<li><!-- raw HTML omitted -->å¤šå®¹å™¨å…±äº«ç›®å½•<!-- raw HTML omitted -->ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½•</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªå®¹å™¨ä¹‹é—´çš„å…±äº«æ¡ˆä¾‹æ¥ä½¿ç”¨æè¿°ä¸€ä¸ª<!-- raw HTML omitted --><code>EmptyDir</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨ä¸€ä¸ª<code>Pod</code>ä¸­å‡†å¤‡ä¸¤ä¸ªå®¹å™¨<!-- raw HTML omitted --><code>nginx</code>å’Œ<code>busybox</code>ç„¶åå£°æ˜ä¸€ä¸ª<code>volume</code>åˆ†åˆ«æŒ‚è½½åˆ°ä¸¤ä¸ªå®¹å™¨çš„ç›®å½•ä¸­ï¼Œç„¶å<code>nginx</code>å®¹å™¨è´Ÿè´£å‘<code>volume</code>ä¸­å†™æ—¥å¿—ï¼Œ<code>busybox</code>ä¸­é€šè¿‡å‘½ä»¤å°†æ—¥å¿—å†…å®¹è¯»åˆ°æ§åˆ¶å°</li>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-emptydir-template.yaml" rel="external" target="_self"><code>Kubernetes Emptydir Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod  </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">emptydir-volume-template       </span> <span style="color:#75715e"># å®šä¹‰åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:   <span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;bash&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;for i in {1..100};do echo $i &gt;&gt;/tmp/hello.txt;sleep 1;done&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­çš„ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/tmp</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e"># æ˜¯å¦åªè¯»ï¼Œé»˜è®¤false</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;bash&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /tmp/hello.txt&#34;</span>]     <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/tmp</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:      <span style="color:#75715e"># å£°æ˜volumeï¼Œnameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºemptyDir</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume  </span> <span style="color:#75715e"># å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">emptyDir</span>: {<span style="color:#f92672">}        # ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼ï¼Œä½¿ç”¨ emptyDir</span>: {} <span style="color:#ae81ff">è¡¨ä½¿ç”¨é»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># medium: string   # å­˜å‚¨ä»‹è´¨ï¼Œæ”¯æŒMemoryå’Œç©ºå­—ç¬¦ä¸²(é»˜è®¤)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># sizeLimit: string        # å¤§å°é™åˆ¶ï¼Œé»˜è®¤ä¸é™åˆ¶ã€‚ä¸€èˆ¬åœ¨ä½¿ç”¨Memoryæ—¶ä¼šé™åˆ¶</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="hostpath"><code>HostPath</code></h3>
<ul>
<li>
<ol>
<li>å·²ç»çŸ¥é“<code>EmptyDir</code>ä¸­çš„æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œå®ƒä¼šéšç€<code>Pod</code>çš„ç»“æŸè€Œé”€æ¯ï¼Œå¦‚æœæƒ³è¦ç®€å•çš„å°†æ•°æ®æŒä¹…åŒ–åˆ°ä¸»æœºä¸­ï¼Œå¯ä»¥é€‰æ‹©<!-- raw HTML omitted --><code>HostPath</code><!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><code>HostPath</code>å°±æ˜¯å°†<code>Node</code>ä¸»æœºä¸­çš„ä¸€ä¸ªå®é™…ç›®å½•æŒ‚è½½åˆ°<code>Pod</code>ä¸­ï¼Œä»¥ä¾›å®¹å™¨ä½¿ç”¨ï¼Œè¿™æ ·çš„è®¾è®¡å°±å¯ä»¥ä¿è¯<code>Pod</code>é”€æ¯äº†ï¼Œä½†æ˜¯æ•°æ®ä¾æ—§å¯ä»¥ä¿å­˜åœ¨<code>Node</code>ä¸»æœºä¸Š</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain Pod.spec.volumes.hostPath.type  	<span style="color:#75715e"># ç±»å‹å£°æ˜</span></span></span></code></pre></div><ul>
<li><code>Directory</code><!-- raw HTML omitted -->ï¼šç›®å½•ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>DirectoryOrCreate</code><!-- raw HTML omitted -->ï¼šç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨<!-- raw HTML omitted --></li>
<li><code>File</code><!-- raw HTML omitted -->ï¼šæ–‡ä»¶ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>FileOrCreate</code><!-- raw HTML omitted -->ï¼šæ–‡ä»¶å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨<!-- raw HTML omitted --></li>
<li><code>Socket</code><!-- raw HTML omitted -->ï¼š<code>unix</code>å¥—æ¥å­—ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>CharDevice</code><!-- raw HTML omitted -->ï¼šå­—ç¬¦è®¾å¤‡ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>BlockDevice</code><!-- raw HTML omitted -->ï¼šå—è®¾å¤‡ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-hostpath-template.yaml" rel="external" target="_self"><code>Kubernetes HostPath Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hostpath-volume-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­çš„ç›®å½•ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log/nginx</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /logs/access.log&#34;</span>]        <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„ç›®å½•ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:      <span style="color:#75715e"># å£°æ˜volumeï¼Œnameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºhostPath</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostPath</span>:   <span style="color:#75715e"># ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/logs  </span> <span style="color:#75715e"># Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate  </span> <span style="color:#75715e"># ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºå†ä½¿ç”¨</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="nfs"><code>NFS</code></h3>
<blockquote>
<ul>
<li><code>HostPath</code>è™½ç„¶å¯ä»¥è§£å†³æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦<code>Node</code>èŠ‚ç‚¹æ•…éšœäº†ï¼Œ<code>Pod</code>å¦‚æœè½¬ç§»åˆ°åˆ«çš„<code>Node</code>èŠ‚ç‚¹ä¸Šï¼Œåˆä¼šå‡ºç°é—®é¢˜ï¼Œæ­¤æ—¶éœ€è¦å‡†å¤‡å•ç‹¬çš„ç½‘ç»œå­˜å‚¨ç³»ç»Ÿï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯<code>NFS</code>å’Œ<code>CIFS</code></li>
<li><code>NFS</code>æ˜¯ä¸€ä¸ªç½‘ç»œæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥æ­å»ºä¸€å°<code>NFS</code>æœåŠ¡å™¨ï¼Œç„¶åå°†<code>Pod</code>ä¸­çš„å­˜å‚¨ç›´æ¥è¿æ¥åˆ°<code>NFS</code>ç³»ç»Ÿä¸Šï¼Œè¿™æ ·ï¼Œæ— è®º<code>Pod</code>åœ¨èŠ‚ç‚¹ä¸Šæ€ä¹ˆè½¬ç§»ï¼Œåªè¦<code>Node</code>å’Œ<code>NFS</code>çš„å¯¹æ¥æ²¡æœ‰é—®é¢˜ï¼Œæ•°æ®å°±å¯ä»¥æˆåŠŸè®¿é—®</li>
</ul>
</blockquote>
<hr>
<h4 id="font-colorredç¼–è¾‘fontnfs-volumeyamlfont-colorredæ–‡ä»¶æŒ‚è½½fontnfs"><!-- raw HTML omitted -->ç¼–è¾‘<!-- raw HTML omitted --><code>nfs-volume.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶æŒ‚è½½<!-- raw HTML omitted --><code>NFS</code></h4>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-nfs-template.yaml" rel="external" target="_self"><code>Kubernetes NFS Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-volume-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­çš„ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log/nginx</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /logs/access.log&#34;</span>]        <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:      <span style="color:#75715e"># å£°æ˜volume</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nfs</span>:        <span style="color:#75715e"># å­˜å‚¨ç±»å‹ï¼Œå’Œåº•å±‚æ­£åˆ™çš„å­˜å‚¨å¯¹åº”</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.18.100</span>    <span style="color:#75715e"># NFSæœåŠ¡å™¨åœ°å€</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/nfs     </span> <span style="color:#75715e"># å…±äº«æ–‡ä»¶è·¯å¾„</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e"># æ˜¯å¦åªè¯»ï¼Œé»˜è®¤false</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="é«˜çº§å­˜å‚¨">é«˜çº§å­˜å‚¨</h2>
<h3 id="pvæŒä¹…å·"><code>PV</code>æŒä¹…å·</h3>
<ul>
<li>
<ol>
<li><code>PV(Persistent Volume)</code><!-- raw HTML omitted -->æ˜¯æŒä¹…åŒ–å·çš„æ„æ€ï¼Œæ˜¯å¯¹åº•å±‚çš„å…±äº«å­˜å‚¨çš„ä¸€ç§æŠ½è±¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹<code>PV</code>ç”±<code>kubernetes</code>ç®¡ç†å‘˜è¿›è¡Œåˆ›å»ºå’Œé…ç½®ï¼Œå®ƒå’Œåº•å±‚å…·ä½“çš„å…±äº«å­˜å‚¨æŠ€æœ¯æœ‰å…³ï¼Œå¹¶é€šè¿‡æ’ä»¶å®Œæˆå’Œå…±äº«å­˜å‚¨çš„å¯¹æ¥<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><code>pv</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><!-- raw HTML omitted -->å…³é”®é…ç½®<!-- raw HTML omitted --><!-- raw HTML omitted -->å‚æ•°è¯´æ˜<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å­˜å‚¨ç±»å‹ï¼š<!-- raw HTML omitted -->åº•å±‚å®é™…å­˜å‚¨çš„ç±»å‹ï¼Œ<code>kubernetes</code>æ”¯æŒå¤šç§å­˜å‚¨ç±»å‹ï¼Œæ¯ç§å­˜å‚¨ç±»å‹çš„é…ç½®æœ‰æ‰€ä¸åŒ</li>
<li>
<ol start="2">
<li><code>capacity</code><!-- raw HTML omitted -->(å­˜å‚¨èƒ½åŠ›)ï¼š<!-- raw HTML omitted -->ç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®<code>storage=1Gi</code>ï¼Œä¸è¿‡æœªæ¥å¯èƒ½ä¼šåŠ å…¥<code>IOPS</code>ã€ååé‡ç­‰æŒ‡æ ‡çš„é…ç½®</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>accessModes</code><!-- raw HTML omitted -->(è®¿é—®æ¨¡å¼)ï¼š<!-- raw HTML omitted -->ç”¨æ¥æè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™ï¼Œè®¿é—®æƒé™åŒ…æ‹¬ä¸‹é¢å‡ ç§æ–¹å¼</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„è®¿é—®æ¨¡å¼ä¸åŒ<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>ReadWriteOnce(RWO)</code><!-- raw HTML omitted -->ï¼šè¯»å†™æƒé™ï¼Œ<!-- raw HTML omitted -->ä½†æ˜¯åªèƒ½è¢«å•ä¸ªèŠ‚ç‚¹æŒ‚è½½</p>
</li>
<li>
<p><code>ReadOnlyMany(ROX)</code><!-- raw HTML omitted -->ï¼šåªè¯»æƒé™ï¼Œ<!-- raw HTML omitted -->å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</p>
</li>
<li>
<p><code>ReadWriteMany(RWX)</code><!-- raw HTML omitted -->ï¼šè¯»å†™æƒé™ï¼Œ<!-- raw HTML omitted -->å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</p>
</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>persistentVolumeReclaimPolicy</code><!-- raw HTML omitted -->(å›æ”¶ç­–ç•¥)ï¼š<!-- raw HTML omitted -->å½“<code>PV</code>ä¸å†è¢«ä½¿ç”¨ä¹‹åï¼Œå¯¹å…¶çš„å¤„ç†æ–¹å¼ï¼Œç›®å‰æ”¯æŒä¸‰ç§ç­–ç•¥</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„å›æ”¶ç­–ç•¥ä¸åŒ<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Retain</code><!-- raw HTML omitted -->(ä¿ç•™)ï¼š<!-- raw HTML omitted -->ä¿ç•™æ•°æ®ï¼Œéœ€è¦ç®¡ç†å‘˜æ‰‹åŠ¨æ¸…ç†æ•°æ®</p>
</li>
<li>
<p><code>Recycle</code><!-- raw HTML omitted -->(å›æ”¶)ï¼š<!-- raw HTML omitted -->æ¸…é™¤<code>PV</code>ä¸­çš„æ•°æ®ï¼Œæ•ˆæœç›¸å½“äº<code>rm -rf /volume/*</code></p>
</li>
<li>
<p><code>Delete</code><!-- raw HTML omitted -->(åˆ é™¤)ï¼š<!-- raw HTML omitted -->å’Œ<code>PV</code>ç›¸è¿çš„åç«¯å­˜å‚¨å®Œæˆ<code>volume</code>çš„åˆ é™¤æ“ä½œï¼Œå¸¸è§äºäº‘æœåŠ¡å™¨å‚å•†çš„å­˜å‚¨æœåŠ¡</p>
</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="5">
<li><code>storageClassName</code><!-- raw HTML omitted -->(å­˜å‚¨ç±»åˆ«)ï¼š<!-- raw HTML omitted --><code>PV</code>å¯ä»¥é€šè¿‡<code>storageClassName</code>å‚æ•°æŒ‡å®šä¸€ä¸ªå­˜å‚¨ç±»åˆ«</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>å…·æœ‰ç‰¹å®šç±»å‹çš„<code>PV</code>åªèƒ½å’Œè¯·æ±‚äº†è¯¥ç±»åˆ«çš„<code>PVC</code>è¿›è¡Œç»‘å®š</li>
<li>æœªè®¾å®šç±»åˆ«çš„<code>PV</code>åªèƒ½å’Œä¸è¯·æ±‚ä»»ä½•ç±»åˆ«çš„<code>PVC</code>è¿›è¡Œç»‘å®š</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="6">
<li><code>status</code><!-- raw HTML omitted -->(çŠ¶æ€)ï¼š<!-- raw HTML omitted -->ä¸€ä¸ª<code>PV</code>çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯èƒ½ä¼šå¤„äº4ç§ä¸åŒçš„é˜¶æ®µ</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Available</code><!-- raw HTML omitted -->(å¯ç”¨)ï¼š<!-- raw HTML omitted -->è¡¨ç¤ºå¯ç”¨çŠ¶æ€ï¼Œè¿˜æœªè¢«ä»»ä½•<code>PVC</code>ç»‘å®š</li>
<li><code>Bound</code><!-- raw HTML omitted -->(å·²ç»‘å®š)ï¼š<!-- raw HTML omitted -->è¡¨ç¤º<code>PV</code>å·²ç»è¢«<code>PVC</code>ç»‘å®š</li>
<li><code>Released</code><!-- raw HTML omitted -->(å·²é‡Šæ”¾)ï¼š<!-- raw HTML omitted -->è¡¨ç¤º<code>PVC</code>è¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æ²¡æœ‰è¢«é›†ç¾¤é‡æ–°é‡Šæ”¾</li>
<li><code>Failed</code><!-- raw HTML omitted -->(å¤±è´¥)ï¼š<!-- raw HTML omitted -->è¡¨ç¤ºè¯¥<code>PV</code>çš„è‡ªåŠ¨å›æ”¶å¤±è´¥</li>
</ul>
</blockquote>
<ul>
<li><code>PV</code>ï¼š<code>kubernetes</code><!-- raw HTML omitted -->ç®¡ç†å‘˜ç»´æŠ¤<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<h4 id="æ„å»ºfont-colorredé™æ€fontpvå­˜å‚¨å·">æ„å»º<!-- raw HTML omitted -->é™æ€<!-- raw HTML omitted --><code>PV</code>å­˜å‚¨å·</h4>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-pv-template.yaml" rel="external" target="_self"><code>Kubernetes PV Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">##########   å®šä¹‰Redisçš„é™æ€ PVæŒä¹…å·   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pv-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pv-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">capacity</span>:     <span style="color:#75715e"># å­˜å‚¨èƒ½åŠ›ï¼Œç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Gi      </span> <span style="color:#75715e"># é™åˆ¶å®¹é‡ä¸º 10G</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMode</span>: <span style="color:#ae81ff">Filesystem   </span> <span style="color:#75715e"># å­˜å‚¨ç±»å‹ä¸ºæ–‡ä»¶ç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:          <span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany      </span> <span style="color:#75715e"># Readï¼šè¯»ã€Writeï¼šå†™ã€Onceï¼šå•èŠ‚ç‚¹ã€Manyï¼šä»£è¡¨å¤šèŠ‚ç‚¹ï¼ŒOnlyï¼šåªè¯»åªå†™</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeReclaimPolicy</span>: <span style="color:#ae81ff">Retain  </span> <span style="color:#75715e"># å›æ”¶ç­–ç•¥ï¼šRetainï¼šä¿ç•™ã€Recycleï¼šå›æ”¶ã€Deleteï¼šåˆ é™¤</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs        </span> <span style="color:#75715e"># åˆ›å»º PV çš„å­˜å‚¨ç±»çš„è‡ªå®šä¹‰åå­—ï¼ŒPVCéœ€è¦äºæ­¤ç›¸åŒï¼Œå­˜å‚¨ç±»å‹ï¼Œåˆ†åˆ«ä¸ºï¼š NFSã€CephFSã€iSCSI</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mountOptions</span>:         <span style="color:#75715e"># åŠ è½½é…ç½®</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">hard</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">nfsvers=4.1        </span> <span style="color:#75715e"># NFS ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nfs</span>:          <span style="color:#75715e"># å­˜å‚¨ç±»å‹ï¼Œå’ŒstorageClassNameçš„å­˜å‚¨ç±»åˆ«å¯¹åº”</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/redis      </span> <span style="color:#75715e"># nfs æˆæƒç›®å½•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.186.110</span>     <span style="color:#75715e"># nfs æ‰€åœ¨æœåŠ¡å™¨PVæŒä¹…å·</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--- <span style="color:#75715e"># åˆ†éš”ç¬¦å¯ä»¥å®šä¹‰å¤šä¸ª</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   å®šä¹‰Nginxçš„é™æ€ PVæŒä¹…å·   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pv-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pv-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">capacity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Gi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMode</span>: <span style="color:#ae81ff">Filesystem</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeReclaimPolicy</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mountOptions</span>:         <span style="color:#75715e"># åŠ è½½é…ç½®</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">hard</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">nfsvers=4.1        </span> <span style="color:#75715e"># NFS ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nfs</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.186.110</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="æ„å»ºfont-colorredåŠ¨æ€fontpvå­˜å‚¨å·">æ„å»º<!-- raw HTML omitted -->åŠ¨æ€<!-- raw HTML omitted --><code>PV</code>å­˜å‚¨å·</h4>
<ul>
<li>
<ol>
<li><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/" rel="external" target="_self"><code>StorageClass</code>åŠ¨æ€èµ„æºå­˜å‚¨</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-storageclass-template.yaml" rel="external" target="_self"><code>Kubernetes StorageClass Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">storage.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StorageClass   </span> <span style="color:#75715e"># åˆ›å»ºåŠ¨æ€å­˜å‚¨ç±»</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-storage-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageclass.kubernetes.io/is-default-class</span>: <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">provisioner</span>: <span style="color:#ae81ff">fuseim.pri/ifs    </span> <span style="color:#75715e"># å¤–éƒ¨åˆ¶å¤‡å™¨æä¾›è€…ï¼Œç¼–å†™ä¸ºæä¾›è€…çš„åç§°ï¼Œk8s-sigs.io/nfs-subdir-external-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">allowVolumeExpansion</span>: <span style="color:#66d9ef">true</span>      <span style="color:#75715e"># åŠ¨æ€è°ƒæ•´æŒä¹…å·å¤§å°</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">parameters</span>:     <span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">archiveOnDelete</span>: <span style="color:#e6db74">&#34;true&#34;</span>       <span style="color:#75715e"># æ˜¯å¦å­˜æ¡£ï¼Œfalseï¼šè¡¨ç¤ºä¸å­˜æ¡£ï¼Œä¼šåˆ é™¤oldPathä¸‹é¢çš„æ•°æ®ï¼Œtrueï¼šè¡¨ç¤ºå­˜æ¡£ï¼Œä¼šé‡å‘½åè·¯å¾„</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">reclaimPolicy</span>: <span style="color:#ae81ff">Retain  </span> <span style="color:#75715e"># å›æ”¶ç­–ç•¥ï¼Œé»˜è®¤ä¸ºï¼šDeleteï¼Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">volumeBindingMode</span>: <span style="color:#ae81ff">Immediate   </span> <span style="color:#75715e"># é»˜è®¤ä¸ºï¼šImmediateï¼Œè¡¨ç¤ºåˆ›å»º PVCç«‹å³è¿›è¡Œç»‘å®šï¼Œåªæœ‰ï¼šazurediskå’Œï¼šAWSelasticblockstore æ”¯æŒå…¶ä»–å€¼</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºæƒé™ï¼Œ<!-- raw HTML omitted --><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Permissions/kubernetes-permissions-template.yaml" rel="external" target="_self"><code>Kubernetes Permissions Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount   </span> <span style="color:#75715e"># æƒé™ç®¡ç†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole  </span> <span style="color:#75715e"># åˆ›å»ºé›†ç¾¤è§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner-runner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;nodes&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;persistentvolumes&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;delete&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;persistentvolumeclaims&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;storage.k8s.io&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;storageclasses&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;events&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;patch&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRoleBinding   </span> <span style="color:#75715e"># ç»‘å®šé›†ç¾¤è§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">run-nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner-runner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role   </span> <span style="color:#75715e"># åˆ›å»ºæ™®é€šè§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">leader-locking-nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;endpoints&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;patch&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">RoleBinding  </span> <span style="color:#75715e"># ç»‘å®šæ™®é€šè§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">leader-locking-nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">leader-locking-nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºé€‚ç”¨ä¸<!-- raw HTML omitted --><code>provisioner</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>Deployment</code><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-deployment-provisioner-nfs-template.yaml" rel="external" target="_self"><code>Kubernetes Deployment Provisioner NFS Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: apps/v1
</span></span><span style="display:flex;"><span>kind: Deployment
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: nfs-client-provisioner
</span></span><span style="display:flex;"><span>  namespace: default
</span></span><span style="display:flex;"><span>  labels:
</span></span><span style="display:flex;"><span>    app: nfs-client-provisioner
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  replicas: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  strategy:
</span></span><span style="display:flex;"><span>    type: Recreate      <span style="color:#75715e"># Recreate:ä¸æ»šåŠ¨æ›´æ–°ï¼Œ</span>
</span></span><span style="display:flex;"><span>  selector:
</span></span><span style="display:flex;"><span>    matchLabels:
</span></span><span style="display:flex;"><span>      app: nfs-client-provisioner
</span></span><span style="display:flex;"><span>  template:
</span></span><span style="display:flex;"><span>    metadata:
</span></span><span style="display:flex;"><span>      labels:
</span></span><span style="display:flex;"><span>        app: nfs-client-provisioner
</span></span><span style="display:flex;"><span>    spec:
</span></span><span style="display:flex;"><span>      hostNetwork: true
</span></span><span style="display:flex;"><span>      serviceAccountName: nfs-client-provisioner        <span style="color:#75715e"># å…³è”ï¼šnfs-client-provisioner è´¦å·æˆä¸è´¦æˆ·æƒé™</span>
</span></span><span style="display:flex;"><span>      containers:
</span></span><span style="display:flex;"><span>      - name: nfs-client-provisioner
</span></span><span style="display:flex;"><span>        image: registry.cn-beijing.aliyuncs.com/pylixm/nfs-subdir-external-provisioner:v4.0.0
</span></span><span style="display:flex;"><span>        resources:
</span></span><span style="display:flex;"><span>          limits:
</span></span><span style="display:flex;"><span>            cpu: 200m
</span></span><span style="display:flex;"><span>            memory: 128Mi
</span></span><span style="display:flex;"><span>          requests:
</span></span><span style="display:flex;"><span>            cpu: 50m
</span></span><span style="display:flex;"><span>            memory: 64Mi
</span></span><span style="display:flex;"><span>        volumeMounts:
</span></span><span style="display:flex;"><span>        - name: nfs-client-root
</span></span><span style="display:flex;"><span>          mountPath: /persistentvolumes
</span></span><span style="display:flex;"><span>        env:
</span></span><span style="display:flex;"><span>        - name: PROVISIONER_NAME
</span></span><span style="display:flex;"><span>          value: fuseim.pri/ifs   <span style="color:#75715e"># å¿…é¡»å’ŒStorageClassçš„å¤–éƒ¨åˆ¶å¤‡å™¨æä¾›è€…åå­—ç›¸åŒ</span>
</span></span><span style="display:flex;"><span>        - name: NFS_SERVER
</span></span><span style="display:flex;"><span>          value: 192.168.186.110        <span style="color:#75715e"># æŒ‡å®šè‡ªå·±nfsæœåŠ¡å™¨åœ°å€</span>
</span></span><span style="display:flex;"><span>        - name: NFS_PATH  
</span></span><span style="display:flex;"><span>          value: /opt/data/redis        <span style="color:#75715e"># nfsæœåŠ¡å™¨å…±äº«çš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>      volumes:
</span></span><span style="display:flex;"><span>      - name: nfs-client-root
</span></span><span style="display:flex;"><span>        nfs:
</span></span><span style="display:flex;"><span>          server: 192.168.186.110
</span></span><span style="display:flex;"><span>          path: /opt/data/redis</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>Service</code>ã€<code>StatefulSet</code>ã€<code>PVC</code><!-- raw HTML omitted -->ç”³è¯·åŠ¨æ€å­˜å‚¨å·<!-- raw HTML omitted --><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-svc-statefulset-storage-nfs-template.yaml" rel="external" target="_self"><code>Kubernetes Service StatefulSet NFS Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">service-template</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>    <span style="color:#75715e"># Serviceçš„ç«¯å£</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>      <span style="color:#75715e"># StatefulSet çš„Podç«¯å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StatefulSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceName</span>: <span style="color:#ae81ff">service-template  </span> <span style="color:#75715e"># ä½¿ç”¨é‚£ä¸ªServiceç®¡ç†DNS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">updateStrategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate        </span> <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°ï¼ŒOnDeleteï¼šåˆ é™¤æ›´æ–°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:      <span style="color:#75715e"># å¦‚æœæ›´æ–°çš„ç­–ç•¥æ˜¯OnDeleteï¼Œé‚£ä¹ˆrollingUpdateå°±å¤±æ•ˆ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">partition</span>: <span style="color:#ae81ff">2</span>      <span style="color:#75715e"># è¡¨ç¤ºä»ç¬¬2ä¸ªåˆ†åŒºå¼€å§‹æ›´æ–°ï¼Œé»˜è®¤æ˜¯0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pvc-test  	# å…³è” PVC åå­—ï¼Œä»¥ä¾¿ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/usr/share/nginx/html</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeClaimTemplates</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pvc-test   </span> <span style="color:#75715e"># å®šä¹‰ï¼šPVC åå­—</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs-storage-template   </span> <span style="color:#75715e"># å­˜å‚¨ç±»åå­—ï¼Œå¿…é¡»å’ŒStorageClassçš„podsåå­—ç›¸åŒ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">accessModes</span>:      <span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">ReadWriteMany  </span> <span style="color:#75715e"># å¤šèŠ‚ç‚¹è¯»å†™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resources</span>:        <span style="color:#75715e"># æœŸæœ›èµ„æº</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">2Gi         </span> <span style="color:#75715e"># æœŸæœ›çš„ç©ºé—´å®¹é‡</span></span></span></code></pre></div><ul>
<li><code>StatefulSet</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>Pods</code><!-- raw HTML omitted -->å¤„äº<!-- raw HTML omitted --><code>Pending</code><!-- raw HTML omitted -->çŠ¶æ€ï¼Œ<!-- raw HTML omitted --><code>describe</code><!-- raw HTML omitted -->å‘½ä»¤æŸ¥çœ‹æœ‰ä»¥ä¸‹æŠ¥é”™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>0/3 nodes are available: pod has unbound immediate PersistentVolumeClaims. preemption: 0/3 nodes are available: 3 No preemption victims found for incoming pod..</code></li>
<li><code>quay.io/external_storage/nfs-client-provisioner:latest</code><!-- raw HTML omitted -->å®˜æ–¹é•œåƒéœ€è¦ç”¨åˆ°<!-- raw HTML omitted --><code>K8S</code><!-- raw HTML omitted -->é‡Œçš„<!-- raw HTML omitted --><code>SelfLink</code><!-- raw HTML omitted -->å‚æ•°<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->è§£å†³æ–¹æ³•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ–¹æ³•ä¸€ï¼šæ›´æ¢é•œåƒï¼Œå»ºè®®ä½¿ç”¨æ­¤æ–¹æ³•</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é•œåƒä¸€</span>
</span></span><span style="display:flex;"><span>gcr.io/k8s/staging-sig-storage/nfs-subdir-external-provisioner:v4.0.0
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é•œåƒäºŒ</span>
</span></span><span style="display:flex;"><span>registry.cn-beijing.aliyuncs.com/pylixm/nfs-subdir-external-provisioner:v4.0.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ¢é•œåƒåé‡æ–°åº”ç”¨</span>
</span></span><span style="display:flex;"><span>$ kubectl replace -f kubernetes-deployment-provisioner-nfs-template.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–¹æ³•äºŒï¼šè§£å†³å®˜æ–¹ä¸æ”¯æŒæ–¹å¼</span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;&gt;/etc/kubernetes/manifests/kube-apiserver.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - command:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kube-apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --feafure-gates=RemoveSelfLink=false  	# æ–°å¢å‚æ•°ï¼Œé»˜è®¤æ˜¯ï¼štrue 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°åº”ç”¨</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f /etc/kubernetes/manifests/kube-apiserver.yaml</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>PVC</code> <!-- raw HTML omitted -->æ–¹å¼ç”³è¯·åŠ¨æ€<!-- raw HTML omitted --><code>StorageClass</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">200Mi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs-storage-template   </span> <span style="color:#75715e"># å­˜å‚¨ç±»åå­—ï¼Œå¿…é¡»å’ŒStorageClassçš„podsåå­—ç›¸	</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="pvcæŒä¹…å·ç”³è¯·ä¹¦"><code>PVC</code>æŒä¹…å·ç”³è¯·ä¹¦</h3>
<ul>
<li>
<ol>
<li><code>PVC(Persistent Volume Claim)</code>æ˜¯æŒä¹…åŒ–å·å£°æ˜çš„æ„æ€ï¼Œæ˜¯ç”¨æˆ·å¯¹äºå­˜å‚¨éœ€æ±‚çš„ä¸€ç§å£°æ˜ã€‚æ¢è¨€ä¹‹ï¼ŒPVCå…¶å®å°±æ˜¯ç”¨æˆ·å‘<code>kubernetes</code>ç³»ç»Ÿå‘å‡ºçš„ä¸€ç§èµ„æºéœ€æ±‚ç”³è¯·</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>PVC</code>ï¼š<code>kubernetes</code>ç”¨æˆ·ç»´æŠ¤</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>PVC</code>æ˜¯èµ„æºçš„ç”³è¯·ï¼Œç”¨æ¥å£°æ˜å¯¹å­˜å‚¨ç©ºé—´ã€è®¿é—®æ¨¡å¼ã€å­˜å‚¨ç±»åˆ«éœ€æ±‚ä¿¡æ¯</li>
</ol>
</li>
<li>
<ol start="4">
<li><code>PVC</code><!-- raw HTML omitted -->çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>accessModes</code>(è®¿å®¢æ¨¡å¼)ï¼šç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™</li>
</ul>
<blockquote>
<ul>
<li><code>selector</code>(é€‰æ‹©æ¡ä»¶)ï¼šé€šè¿‡<code>Label Selector</code>çš„è®¾ç½®ï¼Œå¯ä½¿<code>PVC</code>å¯¹äºç³»ç»Ÿä¸­å·²å­˜åœ¨çš„<code>PV</code>è¿›è¡Œç­›é€‰</li>
<li><code>storageClassName</code>(å­˜å‚¨ç±»åˆ«)ï¼š<code>PVC</code>åœ¨å®šä¹‰æ—¶å¯ä»¥è®¾å®šéœ€è¦çš„åç«¯å­˜å‚¨çš„ç±»åˆ«ï¼Œåªæœ‰è®¾ç½®äº†è¯¥<code>class</code>çš„<code>pv</code>æ‰èƒ½è¢«ç³»ç»Ÿé€‰å‡º</li>
<li><code>resources</code>(èµ„æºè¯·æ±‚)ï¼šæè¿°å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚</li>
</ul>
</blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-pvc-template.yaml" rel="external" target="_self"><code>Kubernetes PVC Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">##########   å®šä¹‰Redisçš„PVCç”³è¯·ä¹¦ï¼Œç”¨äºç”³è¯· Redisçš„PV   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pvc-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMode</span>: <span style="color:#ae81ff">Filesystem       </span> <span style="color:#75715e"># æ–‡ä»¶ç³»ç»Ÿä¹Ÿéœ€è¦ä¸ PVç›¸åŒæ‰èƒ½ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:          <span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany      </span> <span style="color:#75715e"># æƒé™éœ€è¦ä¸å¯¹åº”çš„PV ç›¸åŒï¼Œæ‰å¯ä»¥ä½¿ç”¨ï¼ŒReadï¼šè¯»ã€Writeï¼šå†™ã€Onceï¼šå•èŠ‚ç‚¹ã€Manyï¼šä»£è¡¨å¤šèŠ‚ç‚¹ï¼ŒOnlyï¼šåªè¯»åªå†™</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs        </span> <span style="color:#75715e"># éœ€è¦ä¸PVåå­—ç›¸åŒï¼ŒBlock:ä»£è¡¨å—å­˜å‚¨ã€Filesystem:ä»£è¡¨æ–‡ä»¶ç³»ç»Ÿã€nfs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:    <span style="color:#75715e"># è¯·æ±‚ç©ºé—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">5Gi     </span> <span style="color:#75715e"># å¯¹PVç”³è¯· 5G çš„å­˜å‚¨ç©ºé—´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   å®šä¹‰Nginxçš„PVCç”³è¯·ä¹¦ï¼Œç”¨äºç”³è¯· Redisçš„PV   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pvc-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMode</span>: <span style="color:#ae81ff">Filesystem</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:          <span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany      </span> <span style="color:#75715e"># Read:ä»£è¡¨å¯è¯»ã€Write:ä»£è¡¨å†™ã€Many:ä»£è¡¨å¤šèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs        </span> <span style="color:#75715e"># å­˜å‚¨ç±»å‹ ï¼ŒBlock:ä»£è¡¨å—å­˜å‚¨ã€Filesystem:ä»£è¡¨æ–‡ä»¶ç³»ç»Ÿã€nfs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:    <span style="color:#75715e"># è¯·æ±‚ç©ºé—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">5Gi     </span> <span style="color:#75715e"># å¯¹PVç”³è¯· 5G çš„å­˜å‚¨ç©ºé—´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########      åˆ›å»º Deployment è®¿é—® PVC ç±»å‹å­˜å‚¨   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pod-pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pod-pvc-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:      <span style="color:#75715e"># å½“typeä¸ºRollingUpdateçš„æ—¶å€™ç”Ÿæ•ˆï¼Œç”¨äºä¸ºrollingUpdateè®¾ç½®å‚æ•°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%      </span> <span style="color:#75715e"># ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%    </span> <span style="color:#75715e"># ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate        </span> <span style="color:#75715e"># æ›´æ–°ç­–ç•¥ã€æ”¯æŒ Recreate, RollingUpdateã€‚é»˜è®¤RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:     <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:        <span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™ï¼ŒmatchExpressionsï¼šExpressionsåŒ¹é…è§„åˆ™ </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:     <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:   <span style="color:#75715e"># Pod çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pvc-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#  nodeSelector:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#    kubernetes.io/hostname: kube-01     # æŒ‡å®šèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">reids</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">redis:6.2.7</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;while true;do echo pod1 &gt;&gt; /root/out.txt; sleep 10; done;&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-data       </span> <span style="color:#75715e"># å¿…é¡»ä¸volumeå®šä¹‰çš„åç§°ç›¸åŒ</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/opt/redis/conf       </span> <span style="color:#75715e"># å®¹å™¨å†…è·¯å¾„</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-data   </span> <span style="color:#75715e"># è‡ªå®šä¹‰åç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">persistentVolumeClaim</span>:      <span style="color:#75715e"># å…³è” PVC</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">claimName</span>: <span style="color:#ae81ff">redis-pvc-template    </span> <span style="color:#75715e"># å…³è” PVCï¼Œå¿…é¡»å’Œå®šä¹‰PVCåç§°ç›¸åŒä¸”ï¼Œå¿…é¡»å’Œå½“å‰podåœ¨åŒä¸€ä¸ªå‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e"># æ˜¯å¦åªè¯»ï¼Œé»˜è®¤false</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="pvfont-colorredå’Œfontpvc"><code>PV</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PVC</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>PVC</code><!-- raw HTML omitted -->åä¸€ç›´ç»‘å®šä¸äº†<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->çš„åŸå› <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p>â‘  <code>PVC</code><!-- raw HTML omitted -->çš„ç©ºé—´ç”³è¯·å¤§å°æ¯”<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->çš„ç©ºé—´è¦å¤§<!-- raw HTML omitted --></p>
<p>â‘¡ <code>PVC</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>storageClassName</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>storageClassName</code><!-- raw HTML omitted -->ä¸ä¸€è‡´<!-- raw HTML omitted --></p>
<p>â‘¢ <code>PVC</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>accessModes</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>accessModes</code><!-- raw HTML omitted -->ä¸ä¸€è‡´<!-- raw HTML omitted --></p>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>PVC</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->æ˜¯ä¸€ä¸€å¯¹åº”ï¼Œ<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PVC</code><!-- raw HTML omitted -->ä¹‹é—´çš„ç›¸äº’ä½œç”¨éµå¾ªå¦‚ä¸‹ç”Ÿå‘½å‘¨æœŸ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->èµ„æºä¾›åº”ï¼š<!-- raw HTML omitted -->ç®¡ç†å‘˜æ‰‹åŠ¨åˆ›å»ºåº•å±‚å­˜å‚¨å’Œ<code>PV</code></li>
<li><!-- raw HTML omitted -->èµ„æºç»‘å®š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ç”¨æˆ·åˆ›å»º<code>PVC</code>ï¼Œ<code>kubernetes</code>è´Ÿè´£æ ¹æ®<code>PVC</code>å£°æ˜å»å¯»æ‰¾<code>PV</code>ï¼Œå¹¶ç»‘å®šåœ¨ç”¨æˆ·å®šä¹‰å¥½<code>PVC</code>ä¹‹åï¼Œç³»ç»Ÿå°†æ ¹æ®<code>PVC</code>å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚åœ¨ä»¥å­˜åœ¨çš„<code>PV</code>ä¸­é€‰æ‹©ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„</li>
</ul>
<blockquote>
<ul>
<li>ä¸€æ—¦æ‰¾åˆ°å°±å°†è¯¥<code>PV</code>å’Œç”¨æˆ·å®šä¹‰çš„<code>PVC</code>è¿›è¡Œç»‘å®šï¼Œç”¨æˆ·çš„åº”ç”¨å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ª<code>PVC</code>äº†</li>
<li>å¦‚æœæ‰¾ä¸åˆ°<code>PVC</code>å°±ä¼šæ— é™æœŸçš„å¤„äº<code>Pending</code>çŠ¶æ€ï¼Œç›´åˆ°ç³»ç»Ÿç®¡ç†å‘˜åˆ›å»ºä¸€ä¸ªç¬¦åˆå…¶è¦æ±‚çš„<code>PV</code></li>
</ul>
</blockquote>
<ul>
<li><code>PV</code>ä¸€æ—¦ç»‘å®šåˆ°æŸä¸ª<code>PVC</code>ä¸Šå°±ä¼šè¢«è¿™ä¸ª<code>PVC</code>ç‹¬å ï¼Œä¸èƒ½å†å’Œå…¶ä»–çš„<code>PVC</code>è¿›è¡Œç»‘å®šäº†</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->èµ„æºä½¿ç”¨ï¼š<!-- raw HTML omitted -->ç”¨æˆ·å¯ä»¥åœ¨<code>Pod</code>ä¸­åƒ<code>volume</code>ä¸€æ ·ä½¿ç”¨<code>PVC</code>ï¼Œ<code>Pod</code>ä½¿ç”¨<code>Volume</code>çš„å®šä¹‰ï¼Œå°†<code>PVC</code>æŒ‚è½½åˆ°å®¹å™¨å†…çš„æŸä¸ªè·¯å¾„è¿›è¡Œä½¿ç”¨</li>
<li><!-- raw HTML omitted -->èµ„æºé‡Šæ”¾<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ç”¨æˆ·åˆ é™¤<code>PVC</code>æ¥é‡Šæ”¾<code>PV</code></li>
<li>å½“å­˜å‚¨èµ„æºä½¿ç”¨å®Œæ¯•åï¼Œç”¨æˆ·å¯ä»¥åˆ é™¤<code>PVC</code>ï¼Œå’Œè¯¥<code>PVC</code>ç»‘å®šçš„<code>PV</code>å°†ä¼šæ ‡è®°ä¸º<!-- raw HTML omitted -->å·²é‡Šæ”¾<!-- raw HTML omitted -->ä½†æ˜¯è¿˜ä¸èƒ½ç«‹åˆ»å’Œå…¶ä»–çš„<code>PVC</code>è¿›è¡Œç»‘å®šã€‚é€šè¿‡ä¹‹å‰<code>PVC</code>å†™å…¥çš„æ•°æ®å¯èƒ½è¿˜ç•™åœ¨å­˜å‚¨è®¾å¤‡ä¸Šï¼Œåªæœ‰åœ¨æ¸…é™¤ä¹‹åè¯¥<code>PV</code>æ‰èƒ½å†æ¬¡ä½¿ç”¨</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->èµ„æºå›æ”¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>kubernetes</code>æ ¹æ®<code>PV</code>è®¾ç½®çš„å›æ”¶ç­–ç•¥è¿›è¡Œèµ„æºçš„å›æ”¶</li>
<li>å¯¹äº<code>PV</code>ï¼Œç®¡ç†å‘˜å¯ä»¥è®¾å®šå›æ”¶ç­–ç•¥ï¼Œç”¨äºè®¾ç½®ä¸ä¹‹ç»‘å®šçš„<code>PVC</code>é‡Šæ”¾èµ„æºä¹‹åå¦‚ä½•å¤„ç†é—ç•™æ•°æ®çš„é—®é¢˜ã€‚åªæœ‰<code>PV</code>çš„å­˜å‚¨ç©ºé—´å®Œæˆå›æ”¶ï¼Œæ‰èƒ½ä¾›æ–°çš„<code>PVC</code>ç»‘å®šå’Œä½¿ç”¨</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h2 id="é…ç½®æ–‡ä»¶å­˜å‚¨ç®¡ç†">é…ç½®æ–‡ä»¶å­˜å‚¨ç®¡ç†</h2>
<h3 id="configmapfont-colorredfontsecretfont-colorredè¦†ç›–fontmarkçƒ­æ›´æ–°mark"><code>ConfigMap</code><!-- raw HTML omitted -->&amp;<!-- raw HTML omitted --><code>Secret</code><!-- raw HTML omitted -->è¦†ç›–<!-- raw HTML omitted --><!-- raw HTML omitted -->çƒ­æ›´æ–°<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æ³¨æ„äº‹é¡¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>SubPath</code><!-- raw HTML omitted -->è§£å†³<!-- raw HTML omitted --><code>ConfigMap</code><!-- raw HTML omitted -->&amp;&amp;<!-- raw HTML omitted --><code>Secret</code><!-- raw HTML omitted -->ç›®å½•è¦†ç›–é—®é¢˜ï¼Œ<!-- raw HTML omitted --><code>SubPath</code><!-- raw HTML omitted -->ä¸æ”¯æŒçƒ­æ›´æ–°<!-- raw HTML omitted --></li>
<li>å¦‚æœ<code>ConfigMap</code>å’Œ<code>Secret</code>æ˜¯ä»¥<code>subPath</code>çš„å½¢å¼æŒ‚è½½çš„ï¼Œé‚£ä¹ˆ<code>Pod</code>æ˜¯ä¸ä¼šæ„ŸçŸ¥åˆ°<code>ConfigMap</code>å’Œ<code>Secret</code>çš„æ›´æ–°çš„</li>
<li>å¦‚æœ<code>Pod</code>çš„å˜é‡æ¥è‡ª<code>ConfigMap</code>å’Œ<code>Secret</code>ä¸­å®šä¹‰çš„å†…å®¹ï¼Œé‚£ä¹ˆ<code>ConfigMap</code>å’Œ<code>Secret</code>æ›´æ–°åï¼Œä¹Ÿä¸ä¼šæ›´æ–°<code>Pod</code>ä¸­çš„å˜é‡</li>
<li><code>immutable: true</code><!-- raw HTML omitted -->ï¼šç¦æ­¢ä¿®æ”¹<!-- raw HTML omitted --><code>ConfigMap</code>ã€<code>Secret</code></li>
</ul>
</blockquote>
<hr>
<h3 id="configmapé…ç½®ç±»å‹"><code>ConfigMap</code>é…ç½®ç±»å‹</h3>
<h4 id="configmapç®€ä»‹ä»¥åŠæ³¨æ„äº‹é¡¹"><code>ConfigMap</code>ç®€ä»‹ä»¥åŠæ³¨æ„äº‹é¡¹</h4>
<blockquote>
<ul>
<li><code>ConfigMap</code><!-- raw HTML omitted -->ï¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„å­˜å‚¨å·ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å­˜å‚¨é…ç½®ä¿¡æ¯çš„<!-- raw HTML omitted --></li>
<li><code>ConfigMap</code>ä¸­çš„<code>key</code>æ˜ å°„ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œ<code>value</code>æ˜ å°„ä¸ºæ–‡ä»¶ä¸­çš„å†…å®¹ã€‚å¦‚æœæ›´æ–°äº†<code>ConfigMap</code>ä¸­çš„å†…å®¹ï¼Œå®¹å™¨ä¸­çš„å€¼ä¹Ÿä¼šåŠ¨æ€æ›´æ–°</li>
<li><code>ConfigMap</code>æ˜¯ä¸€ç§<code>API</code>å¯¹è±¡ï¼Œ<!-- raw HTML omitted -->ç”¨æ¥å°†éåŠ å¯†æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚å¯ä»¥ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>ConfigMap</code><!-- raw HTML omitted -->å¯ä»¥å°†ç¯å¢ƒå˜é‡é…ç½®ä¿¡æ¯å’Œå®¹å™¨é•œåƒè§£è€¦ï¼Œä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹ã€‚å¦‚æœéœ€è¦å­˜å‚¨åŠ å¯†ä¿¡æ¯æ—¶å¯ä»¥ä½¿ç”¨<!-- raw HTML omitted --><code>Secret</code>å¯¹è±¡</li>
<li>ä½¿ç”¨<code>ConfigMap</code><!-- raw HTML omitted -->æœ‰ä»¥ä¸‹å‡ ä¸ªé™åˆ¶æ¡ä»¶ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>ConfigMap</code><!-- raw HTML omitted -->å¿…é¡»<!-- raw HTML omitted -->åœ¨<code>pod</code>ä¹‹å‰åˆ›å»º</li>
<li><code>ConfigMap</code>å—<code>namespace</code>çš„é™åˆ¶ï¼Œ<!-- raw HTML omitted -->åªèƒ½<!-- raw HTML omitted -->ç›¸åŒ<code>namespace</code>çš„<code>pod</code>æ‰å¯ä»¥å¼•ç”¨</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æ³¨æ„äº‹é¡¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>ConfigMap</code><!-- raw HTML omitted -->åœ¨è®¾è®¡ä¸Šä¸æ˜¯ç”¨æ¥ä¿å­˜å¤§é‡æ•°æ®çš„<!-- raw HTML omitted -->åœ¨<code>ConfigMap</code>ä¸­ä¿å­˜çš„æ•°æ®ä¸å¯è¶…è¿‡<code>1 MiB</code></li>
<li>å¦‚æœéœ€è¦ä¿å­˜è¶…å‡ºæ­¤å°ºå¯¸é™åˆ¶çš„æ•°æ®ï¼Œéœ€è¦è€ƒè™‘æŒ‚è½½å­˜å‚¨å·æˆ–è€…ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“æˆ–è€…æ–‡ä»¶æœåŠ¡</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h4 id="configmapä½¿ç”¨ä»¥åŠé…ç½®"><code>ConfigMap</code>ä½¿ç”¨ä»¥åŠé…ç½®</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è·å–ä½¿ç”¨å¸®åŠ©<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create configmap -h  	<span style="color:#75715e"># æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap &lt;map-name&gt; &lt;data-source&gt;  	<span style="color:#75715e"># å‘½ä»¤ä½¿ç”¨æ–¹å¼  </span></span></span></code></pre></div><ul>
<li>ä»<!-- raw HTML omitted -->ç›®å½•<!-- raw HTML omitted -->ä¸­åˆ›å»º<code>ConfigMap</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -pv /opt/yaml/configmap/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;/opt/yaml/configmap/config/db.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port=3306
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">username=root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host=127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;/opt/yaml/configmap/config/redis.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port=6379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host=127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --from-fileï¼šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«ç”¨åœ¨ConfigMapé‡Œé¢åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®çš„åå­—å°±æ˜¯æ–‡ä»¶åï¼Œå€¼å°±æ˜¯æ–‡ä»¶çš„å†…å®¹ï¼Œ  </span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap configmap-template --from-file<span style="color:#f92672">=</span>/opt/yaml/configmap/config/</span></span></code></pre></div><ul>
<li>ä»<!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted -->ä¸­åˆ›å»º<code>ConfigMap</code><!-- raw HTML omitted -->ï¼Œå¹¶è‡ªå®šä¹‰<!-- raw HTML omitted --><code>ConfigMap</code><!-- raw HTML omitted -->ä¸­<!-- raw HTML omitted --><code>key</code><!-- raw HTML omitted -->çš„åç§°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># --from-fileï¼Œå¯ä»¥ä½¿ç”¨å¤šæ¬¡ï¼ŒåŒæ ·é”®ä¸ºæ–‡ä»¶åï¼Œå€¼ä¸ºæ–‡ä»¶ä¸­çš„å†…å®¹</span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap configmap-template-2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-file<span style="color:#f92672">=</span>rename1<span style="color:#f92672">=</span>/opt/yaml/configmap/config/db.properties <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-file<span style="color:#f92672">=</span>rename2<span style="color:#f92672">=</span>/opt/yaml/configmap/config/redis.properties  </span></span></code></pre></div><ul>
<li><code>--from-literal=key=value</code><!-- raw HTML omitted -->é”®å€¼å¯¹æ–¹å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨ï¼šliteral(key:value)ï¼Œæ–¹å¼ï¼Œ--from-literal=key1=123 --from-literal=key2=234</span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap configmap-template-3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-literal<span style="color:#f92672">=</span>key-1<span style="color:#f92672">=</span>value-1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-literal<span style="color:#f92672">=</span>key-2<span style="color:#f92672">=</span>value-2</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä»ç¯å¢ƒå˜é‡æ–‡ä»¶åˆ›å»º<!-- raw HTML omitted --><code>ConfigMap</code></li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->æ³¨æ„ï¼š<!-- raw HTML omitted -->å½“<code>--from-env-file</code>ä»å¤šä¸ªæ•°æ®æºåˆ›å»º<code>ConfigMap</code>çš„æ—¶å€™ï¼Œä»…ä»…æœ€åä¸€ä¸ª<code>env</code>æ–‡ä»¶æœ‰æ•ˆ</p>
</li>
<li>
<p><!-- raw HTML omitted -->è¯­æ³•è§„åˆ™ï¼š<!-- raw HTML omitted --></p>
<p><code>env</code>æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå¿…é¡»ä¸º<code>VAR = VAL</code>æ ¼å¼</p>
<p>ä»¥<code>ï¼ƒ</code>å¼€å¤´çš„è¡Œ(å³æ³¨é‡Š)å°†è¢«å¿½ç•¥</p>
<p>ç©ºè¡Œå°†è¢«å¿½ç•¥</p>
<p>å¼•å·æ²¡æœ‰ç‰¹æ®Šå¤„ç†(å³å®ƒä»¬å°†æˆä¸º<code>ConfigMap</code>å€¼çš„ä¸€éƒ¨åˆ†)</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create configmap configmap-template-3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --from-literal<span style="color:#f92672">=</span>password<span style="color:#f92672">=</span>passwd123 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --from-literal<span style="color:#f92672">=</span>APP_NAME<span style="color:#f92672">=</span>springboot-test <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --from-literal<span style="color:#f92672">=</span>JAVA_OPTS_TEST<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Xms512m -Xmx512&#39;</span>  </span></span></code></pre></div><ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-configmap-env-template.yaml" rel="external" target="_self"><code>Kubernetes ConfigMap ENV Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-env-test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: 
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-env-test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-env-test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">env-test</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">command</span>: [ <span style="color:#e6db74">&#34;/bin/sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;env;sleep 3600&#34;</span> ]
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">env</span>:          <span style="color:#75715e"># å®šä¹‰ç¯å¢ƒå˜é‡</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">APP_ENV_TEST_CM      </span> <span style="color:#75715e"># å®šä¹‰ç¯å¢ƒå˜é‡å</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">configMapKeyRef</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template-3     </span> <span style="color:#75715e"># ConfigMap çš„åå­—</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">key</span>: <span style="color:#ae81ff">APP_NAME  </span> <span style="color:#75715e"># è¡¨ç¤ºä» nameçš„ConfigMapä¸­è·å–åå­—ä¸ºKey çš„valueï¼Œå°†å…¶èµ‹å€¼ç»™å®¹å™¨å†…æœ¬åœ°çš„ç¯å¢ƒå˜é‡ APP_ENV_TEST_CM</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">JAVA_ENV_TEST_CM</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">configMapKeyRef</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template-3     </span> <span style="color:#75715e"># ConfigMap çš„åå­—</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">key</span>: <span style="color:#ae81ff">JAVA_OPTS_TEST    </span> <span style="color:#75715e"># ConfigMap çš„ key</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">volumeMounts</span>:   <span style="color:#75715e"># åŠ è½½æ•°æ®å·</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">passwd-config  </span> <span style="color:#75715e"># è¡¨ç¤ºåŠ è½½ volumes å±æ€§ä¸­é‚£ä¸ªæ•°æ®å·</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">mountPath</span>: <span style="color:#e6db74">&#34;/opt/&#34;</span>    <span style="color:#75715e"># æƒ³è¦å°†æ•°æ®å·ä¸­çš„æ–‡ä»¶åŠ è½½åˆ°é‚£ä¸ªç›®å½•ä¸‹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">true</span>    <span style="color:#75715e"># æ˜¯å¦åªè¯»</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>: <span style="color:#75715e"># ä¾æ•°æ®å·æ–¹å¼æŒ‚è½½ ConfigMap Secret</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">passwd-config  </span> <span style="color:#75715e"># è‡ªå®šä¹‰åå­—</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMap</span>:    <span style="color:#75715e"># æ•°æ®å·ç±»å‹ä¸ºï¼šConfigMap</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template-3   </span> <span style="color:#75715e"># ComfigMap çš„åå­—ï¼Œå¿…é¡»å’ŒåŠ è½½çš„ConfigMapç›¸åŒ</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">items</span>:    <span style="color:#75715e"># å¯¹ ConfigMapä¸­çš„Keyè¿›è¡Œæ˜ å°„ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šå°†ConfigMapä¸­æ‰€æœ‰Keyå…¨éƒ¨è½¬æ¢ä¸ºä¸€ä¸ªä¸ªåŒåæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;password&#34;</span>   <span style="color:#75715e"># ConfigMapä¸­çš„Key</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;password&#34;</span>    <span style="color:#75715e"># å°†è¯¥Keyçš„å€¼è½¬æ¢ä¸ºæ–‡ä»¶  </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Always</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;&gt;/opt/yaml/configmap/config/env-file.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enemies=aliens
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lives=3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">allowed=&#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create cm configmap-template-3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --from-env-file<span style="color:#f92672">=</span>/opt/yaml/configmap/config/env-file.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;env.txt<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å…¶ä¸­ï¼Œenv.txtçš„æ–‡ä»¶æ ¼å¼ä¸º:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">key1=***
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">key2=***
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap configmapå --from-env-file<span style="color:#f92672">=</span>env.txt </span></span></code></pre></div></blockquote>
<ul>
<li><code>ConfigMap</code><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>nginx.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶è¿›è¡Œæ›¿æ¢<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;&gt;nginx.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#user  nobody;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">worker_processes  1;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">events {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> worker_connections  1024;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#########   æˆ‘æ˜¯æµ‹è¯•é…ç½®æ–‡ä»¶   ##########
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> include       mime.types;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> default_type  application/octet-stream;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> sendfile        on;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> keepalive_timeout  65;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     listen       80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     server_name  localhost;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         root   html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         index  index.html index.htm;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     error_page   500 502 503 504  /50x.html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     location = /50x.html {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         root   html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>nginx.conf</code><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>ConfigMap</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create configmap nginxconf-cm-template --from-file<span style="color:#f92672">=</span>nginx.conf</span></span></code></pre></div><ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-configmap-template.yaml" rel="external" target="_self"><code>Kubernetes configmap Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">##########   é…ç½® Deployment å¼•ç”¨ ConfigMap åˆ›å»ºçš„æ–‡ä»¶   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-configmap-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: 
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-cm-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-cm-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">200m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">50m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config   </span> <span style="color:#75715e"># å¼•ç”¨å®šä¹‰çš„ vulumes åç§°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#e6db74">&#39;/etc/nginx/nginx.conf&#39;</span>    <span style="color:#75715e"># æ–‡ä»¶å…¨è·¯å¾„</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">subPath</span>: <span style="color:#ae81ff">etc/nginx/nginx.conf  </span> <span style="color:#75715e"># subPathï¼šè¦è¦†ç›–æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œåªè¦†ç›–å¿…è¦æ–‡ä»¶ï¼Œå¦‚æœç¼ºå°‘æ­¤é…ç½®ï¼Œå°†æ¸…ç©ºåŸæœ‰çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œä¸éœ€è¦æœ€å‰é¢çš„ï¼š/</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Always</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config   </span> <span style="color:#75715e"># å®šä¹‰ volumes çš„åç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMap</span>: <span style="color:#75715e"># ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginxconf-cm-template     </span> <span style="color:#75715e"># ConfigMapåç§°ï¼Œä½¿ç”¨åç§°è¿›è¡Œå…³è” ConfigMap</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">items</span>:   <span style="color:#75715e"># å°†configMapä¸­çš„Keyè¿›è¡Œæ˜ å°„ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šå°†configMapä¸­æ‰€æœ‰Keyå…¨éƒ¨è½¬ä¸ºä¸€ä¸ªä¸ªåŒåæ–‡æ¡£</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">nginx.conf   </span> <span style="color:#75715e"># configMapä¸­çš„Key</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">etc/nginx/nginx.conf  </span> <span style="color:#75715e"># å°†è¯¥Keyçš„å€¼è½¬ä¸ºæ–‡ä»¶ï¼Œæœ€å‰é¢ä¸éœ€è¦ï¼š/</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted --> è¿›å…¥<code>Pod</code>ä¸­æŸ¥çœ‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl exec -it nginx-configmap-pod --  /bin/sh
</span></span><span style="display:flex;"><span>$ more /etc/nginx/nginx.conf</span></span></code></pre></div></blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-configmap-simple-template.yaml" rel="external" target="_self"><code>Kubernetes ConfigMap Simple Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template   </span> <span style="color:#75715e"># ConfigMap</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:   <span style="color:#75715e"># &lt;map[string]string&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">info</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">username:admin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">password:123456</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   æŒ‚è½½æ•°æ®æ–¹å¼   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">stream.conf</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    stream.conf {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        listen 1550;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        proxy_pass  192.168.3.125:16303;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }</span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   æŒ‚è½½æ•°æ®æ–¹å¼   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">listen-port</span>: <span style="color:#e6db74">&#34;8080&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">server-name</span>: <span style="color:#ae81ff">www.erge.com</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">default-vhost: |      # æ­¤å†…å®¹ä¼ ç»™ Pod ä¸­ items: ä¸‹ path</span>: <span style="color:#ae81ff">è·¯å¾„ä¸­</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">server {</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">listen 8080 default;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">location / {</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">return 200 &#34;default-vhost!\r\n&#34;;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">blog-vhosts</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      listen 8080;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      server_name blog.erge.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        return 200 &#34;blog-vhosts!\r\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }</span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   é…ç½®envå¼•ç”¨æ–¹å¼ pod-configmap   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-pod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tier</span>: <span style="color:#ae81ff">configmap</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">role</span>: <span style="color:#ae81ff">slb</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">mountPath</span>: <span style="color:#e6db74">&#39;/etc/nginx&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">LISTEN_PORT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMapKeyRef</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">slb-vhosts-config</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">listen-port</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">SERVER_NAME</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMapKeyRef</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">slb-vhosts-config</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">server-name</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config  	# å®šä¹‰ volumes çš„åç§°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">configMap</span>: <span style="color:#75715e"># ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template </span> <span style="color:#75715e"># ConfigMapç”Ÿæˆçš„Pod åç§°ï¼Œä½¿ç”¨åç§°å…³è”</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># items:   # å°†configMapä¸­çš„Keyè¿›è¡Œæ˜ å°„ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šå°†configMapä¸­æ‰€æœ‰Keyå…¨éƒ¨è½¬ä¸ºä¸€ä¸ªä¸ªåŒåæ–‡æ¡£</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># - key: nginx.conf    # configMapä¸­çš„Key</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e">#   path: etc/nginx/nginx.conf   # å°†è¯¥Keyçš„å€¼è½¬ä¸ºæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   é…ç½®volumeå¼•ç”¨æ–¹å¼ pod-configmap   ########## </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-configmap</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/configmap/config     </span> <span style="color:#75715e"># æ²¡æœ‰åˆ™ä¼šè‡ªåŠ¨åˆ›å»º,ç›®å½•ä¸‹æœ‰æ–‡ä»¶åˆ™ä¼šè¦†ç›–æ‰</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config         </span> <span style="color:#75715e"># æ­¤åç§°å’Œ volumeMountså®šä¹‰nameåç§°ä¸€æ ·</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">configMap</span>:          <span style="color:#75715e"># ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap  </span> <span style="color:#75715e"># é…ç½®ä¸º configMap å®¹å™¨çš„åç§°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">defaultMode</span>: <span style="color:#ae81ff">integer      </span> <span style="color:#75715e"># æŒ‚è½½åˆ°Podä¸­åï¼Œæ–‡ä»¶æƒé™ï¼Œå¦‚0444</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">default-vhost       </span> <span style="color:#75715e"># configMapä¸­dataä¸‹çš„key</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">default.conf       </span> <span style="color:#75715e"># æŒ‚è½½è·¯å¾„ï¼Œè·å–Configmapä¸­dataå…³é”®å­—ä¸‹ å®šä¹‰é…ç½®æ–‡ä»¶åä¼ ç»™ volumeMounts ä¸‹çš„mountPathä¸­</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mode</span>: <span style="color:#ae81ff">integer    </span> <span style="color:#75715e"># æ–‡ä»¶æƒé™</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">blog-vhosts</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">blog.conf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">optional</span>: <span style="color:#66d9ef">true</span>      <span style="color:#75715e"># å½“keyä¸å­˜åœ¨æ—¶æ˜¯å¦æŠ¥é”™ï¼Œé»˜è®¤true</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="secretå¯†ç ä»¤ç‰Œç±»å‹"><code>Secret</code>å¯†ç ä»¤ç‰Œç±»å‹</h3>
<h4 id="secretç®€ä»‹ä»¥åŠæ³¨æ„äº‹é¡¹"><code>Secret</code>ç®€ä»‹ä»¥åŠæ³¨æ„äº‹é¡¹</h4>
<blockquote>
<ul>
<li><code>Secret</code><!-- raw HTML omitted -->ï¼šåœ¨<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->ä¸­ï¼Œè¿˜å­˜åœ¨ä¸€ç§å’Œ<!-- raw HTML omitted --><code>ConfigMap</code><!-- raw HTML omitted -->éå¸¸ç±»ä¼¼çš„å¯¹è±¡ï¼Œç§°ä¸º<!-- raw HTML omitted --><code>Secret</code><!-- raw HTML omitted -->å¯¹è±¡ï¼Œå®ƒä¸»è¦ç”¨æ¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€å¯†é’¥ã€è¯ä¹¦ç­‰ç­‰<!-- raw HTML omitted --></li>
<li><code>imagePullSecret</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>æ‹‰å–ç§æœ‰é•œåƒä»“åº“çš„æ—¶ä½¿ç”¨çš„è´¦æˆ·å¯†ç ï¼Œä¼šä¼ é€’ç»™<!-- raw HTML omitted --><code>kubelet</code><!-- raw HTML omitted -->ï¼Œç„¶å<!-- raw HTML omitted --><code>kubelet</code><!-- raw HTML omitted -->å°±å¯ä»¥æ‹‰å–æœ‰å¯†ç çš„ä»“åº“é‡Œé¢çš„é•œåƒ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¦‚æœåŒæ—¶ä½¿ç”¨<!-- raw HTML omitted --><code>data</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>stringData</code><!-- raw HTML omitted -->ï¼Œé‚£ä¹ˆ<!-- raw HTML omitted --><code>data</code><!-- raw HTML omitted -->ä¼šè¢«å¿½ç•¥<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h4 id="secretä½¿ç”¨ä»¥åŠé…ç½®"><code>Secret</code>ä½¿ç”¨ä»¥åŠé…ç½®</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è·å–ä½¿ç”¨å¸®åŠ©<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create secret -h  	<span style="color:#75715e"># æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create secret <span style="color:#f92672">[</span>flags<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span>  	<span style="color:#75715e"># å‘½ä»¤ä½¿ç”¨æ–¹å¼  	</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>base64</code><!-- raw HTML omitted -->å¯¹å‡†å¤‡çš„æ•°æ®è¿›è¡Œç¼–ç ï¼šå¯¹ç”¨æˆ·åã€å¯†ç è¿›è¡Œç¼–ç <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo -n <span style="color:#e6db74">&#39;user_name&#39;</span> | base64  		<span style="color:#75715e"># ç‰¹æ®Šå­—ç¬¦ä½¿ç”¨ï¼š&#39;&#39;(å•å¼•å·)</span>
</span></span><span style="display:flex;"><span>$ echo -n <span style="color:#e6db74">&#39;password&#39;</span> | base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è§£ç ä½¿ç”¨ï¼š--decode</span>
</span></span><span style="display:flex;"><span>$ echo -n <span style="color:#e6db74">&#39;dXNlcl9uYW1l&#39;</span> | base64 --decode</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä»å‘½ä»¤è¡Œåˆ›å»º<!-- raw HTML omitted --><code>Secret</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create secret generic secret-name <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-literal<span style="color:#f92672">=</span>username<span style="color:#f92672">=</span>admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-literal<span style="color:#f92672">=</span>password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;passwd@!3-&#39;</span>  	<span style="color:#75715e"># ç‰¹æ®Šå­—ç¬¦ä½¿ç”¨ï¼š&#39;&#39;(å•å¼•å·)</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>Secret</code><!-- raw HTML omitted -->è¿æ¥<!-- raw HTML omitted --><code>Harbor</code><!-- raw HTML omitted -->ç§äººä»“åº“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>docker-harbor-registrykey</code>ï¼š<code>Secret</code>çš„<code>Pods</code><!-- raw HTML omitted -->åç§°ï¼Œè‡ªå®šä¹‰<!-- raw HTML omitted --></li>
<li><code>--docker-server</code><!-- raw HTML omitted -->ï¼šé•œåƒä»“åº“åœ°å€<!-- raw HTML omitted --></li>
<li><code>--docker-username</code><!-- raw HTML omitted -->ï¼šé•œåƒä»“åº“ç”¨æˆ·å<!-- raw HTML omitted --></li>
<li><code>--docker-password</code><!-- raw HTML omitted -->ï¼šé•œåƒä»“åº“å¯†ç <!-- raw HTML omitted --></li>
<li><code>--docker-email</code><!-- raw HTML omitted -->ï¼šé‚®ç®±åœ°å€<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è·å– docker-registry ä½¿ç”¨å¸®åŠ©</span>
</span></span><span style="display:flex;"><span>$ kubectl create secret docker-registry -h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºä¸€ä¸ªImagePullSecret</span>
</span></span><span style="display:flex;"><span>$ kubectl create secret docker-registry docker-harbor-registrykey <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --docker-server<span style="color:#f92672">=</span>192.168.18.119:85:8080 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --docker-username<span style="color:#f92672">=</span>admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --docker-password<span style="color:#f92672">=</span>Harbor12345 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --docker-email<span style="color:#f92672">=</span>xxxxx@qq.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹æ˜¯å¦åˆ›å»ºæˆåŠŸ</span>
</span></span><span style="display:flex;"><span>$ kubectl get secret docker-harbor-registrykey</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>redis.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œè·å–<!-- raw HTML omitted --><code>Harbor</code><!-- raw HTML omitted -->ä»“åº“é•œåƒ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">imagePullSecrets</span>:  	<span style="color:#75715e"># é…ç½®ç™»å½• docker registry çš„ secret ä»“åº“</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker-harbor-registrykey  	# å¼•ç”¨Secretçš„Podsï¼Œå®¹å™¨åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">192.168.18.119</span>:<span style="color:#ae81ff">85</span><span style="color:#ae81ff">/yuncloud/redis</span> <span style="color:#75715e"># è¿™æ˜¯Harborçš„é•œåƒç§æœ‰ä»“åº“åœ°å€</span></span></span></code></pre></div></blockquote>
<ul>
<li>å‡†å¤‡<code>volumes-secret</code><!-- raw HTML omitted -->èµ„æºæ¸…å•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Secret</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Opaque</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:  	<span style="color:#75715e"># æå‰ç¼–ç ä½¿ç”¨ï¼šdataã€ä½¿ç”¨Kubernetesè¿›è¡Œç¼–ç ä½¿ç”¨ï¼šstringData</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">username</span>: <span style="color:#ae81ff">YWRtaW4=  	# ä½¿ç”¨kubernetesè¿›è¡Œç¼–ç å†™ï¼ŒåŸæ•°æ®ï¼šadmin</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#ae81ff">MTIzNDU2  	# ä½¿ç”¨kubernetesè¿›è¡Œç¼–ç å†™ï¼ŒåŸæ•°æ®ï¼š123456</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   é…ç½® secret-pod   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">secret-pod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/secret/config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">secret</span>:  	<span style="color:#75715e"># ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted --> æŸ¥çœ‹ç¼–ç åçš„ç›®å½•ä»¥åŠä¿¡æ¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å°†nginx.confå¯¼å‡ºåˆ°æœ¬åœ°</span>
</span></span><span style="display:flex;"><span>$ kubectl exec -it nginx -- cat /etc/nginx/nginx.conf &gt; nginx.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl exec -it secret-pod-name -n default -- /bin/sh
</span></span><span style="display:flex;"><span>$ ls /secret/config
</span></span><span style="display:flex;"><span>$ more /secret/config/username
</span></span><span style="display:flex;"><span>$ more /secret/config/password</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_k8s_rancher">Configure_K8s_Rancher</h1>

<h2 id="rancheræœåŠ¡å®•æœºæƒ…å†µä¸‹ä½¿ç”¨kubernetes-cluster"><code>Rancher</code>æœåŠ¡å®•æœºæƒ…å†µä¸‹ä½¿ç”¨<code>Kubernetes Cluster</code></h2>
<ul>
<li>
<ol>
<li><a href="https://docs.rancher.cn/docs/rancher2/cluster-admin/cleaning-cluster-nodes/_index/" rel="external" target="_self"><code>Rancher</code>æ¸…ç†èŠ‚ç‚¹</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>KUBE_SVC<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kubelet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kube-scheduler
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kube-proxy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kube-controller-manager
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kube-apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> kube_svc in <span style="color:#e6db74">${</span>KUBE_SVC<span style="color:#e6db74">}</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e"># åœæ­¢æœåŠ¡</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">`</span>systemctl is-active <span style="color:#e6db74">${</span>kube_svc<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;active&#39;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        systemctl stop <span style="color:#e6db74">${</span>kube_svc<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e"># ç¦æ­¢æœåŠ¡å¼€æœºå¯åŠ¨</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">`</span>systemctl is-enabled <span style="color:#e6db74">${</span>kube_svc<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;enabled&#39;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        systemctl disable <span style="color:#e6db74">${</span>kube_svc<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœæ­¢æ‰€æœ‰å®¹å™¨</span>
</span></span><span style="display:flex;"><span>docker stop <span style="color:#66d9ef">$(</span>docker ps -aq<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤æ‰€æœ‰å®¹å™¨</span>
</span></span><span style="display:flex;"><span>docker rm -f <span style="color:#66d9ef">$(</span>docker ps -qa<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤æ‰€æœ‰å®¹å™¨å·</span>
</span></span><span style="display:flex;"><span>docker volume rm <span style="color:#66d9ef">$(</span>docker volume ls -q<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¸è½½mountç›®å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> mount in <span style="color:#66d9ef">$(</span>mount | grep tmpfs | grep <span style="color:#e6db74">&#39;/var/lib/kubelet&#39;</span> | awk <span style="color:#e6db74">&#39;{ print $3 }&#39;</span><span style="color:#66d9ef">)</span> /var/lib/kubelet /var/lib/rancher;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>   umount $mount;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¤‡ä»½ç›®å½•</span>
</span></span><span style="display:flex;"><span>mv /etc/kubernetes /etc/kubernetes-bak-<span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#34;%Y%m%d%H%M&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>mv /var/lib/etcd /var/lib/etcd-bak-<span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#34;%Y%m%d%H%M&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>mv /var/lib/rancher /var/lib/rancher-bak-<span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#34;%Y%m%d%H%M&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>mv /opt/rke /opt/rke-bak-<span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#34;%Y%m%d%H%M&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤æ®‹ç•™è·¯å¾„</span>
</span></span><span style="display:flex;"><span>rm -rf /etc/ceph <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /etc/cni <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /opt/cni <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /run/secrets/kubernetes.io <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /run/calico <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /run/flannel <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/lib/calico <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/lib/cni <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/lib/kubelet <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/log/containers <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/log/kube-audit <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/log/pods <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/run/calico <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /usr/libexec/kubernetes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…ç†ç½‘ç»œæ¥å£</span>
</span></span><span style="display:flex;"><span>no_del_net_inter<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">eth
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ens
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">bond
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>network_interface<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>ls /sys/class/net<span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> net_inter in $network_interface;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> ! echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>no_del_net_inter<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> | grep -qE <span style="color:#e6db74">${</span>net_inter:0:3<span style="color:#e6db74">}</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        ip link delete $net_inter
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…ç†æ®‹ç•™è¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>port_list<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">6443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2376
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2380
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">8472
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9099
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">10250
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">10254
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> port in $port_list;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>   pid<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>netstat -atlnup | grep $port | awk <span style="color:#e6db74">&#39;{print $7}&#39;</span> | awk -F <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#e6db74">&#39;{print $1}&#39;</span> | grep -v - | sort -rnk2 | uniq<span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> -n $pid <span style="color:#f92672">]]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        kill -9 $pid
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kube_pid<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>ps -ef | grep -v grep | grep kube | awk <span style="color:#e6db74">&#39;{print $2}&#39;</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> -n $kube_pid <span style="color:#f92672">]]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>   kill -9 $kube_pid
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…ç†Iptablesè¡¨</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## æ³¨æ„ï¼šå¦‚æœèŠ‚ç‚¹Iptablesæœ‰ç‰¹æ®Šé…ç½®ï¼Œä»¥ä¸‹å‘½ä»¤è¯·è°¨æ…æ“ä½œ</span>
</span></span><span style="display:flex;"><span>sudo iptables --flush
</span></span><span style="display:flex;"><span>sudo iptables --flush --table nat
</span></span><span style="display:flex;"><span>sudo iptables --flush --table filter
</span></span><span style="display:flex;"><span>sudo iptables --table nat --delete-chain
</span></span><span style="display:flex;"><span>sudo iptables --table filter --delete-chain
</span></span><span style="display:flex;"><span>systemctl restart docker</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><code>Rancher Server</code>æ˜¯ä¸Šæ¸¸ä¸­å¿ƒç®¡ç†è§’è‰²ï¼Œæ§åˆ¶æˆ–åˆ›å»ºæ——ä¸‹<code>N</code>ä¸ª<code>Kubernetes Cluster</code>é›†ç¾¤ï¼Œä¸ç®¡æ˜¯æµ‹è¯•ä¸­çš„å•ä¸ªèŠ‚ç‚¹æˆ–è€…æ˜¯<code>Kubernetes Cluster</code>é›†ç¾¤å¤±æ•ˆéƒ½æ— æ³•è¯»å–ï¼Œè¿ç»´ä»éœ€è¦å¯¹ä¸‹æ¸¸æ‰€æœ‰<code>Kubernetes Cluster</code>é›†ç¾¤ç®¡æ§<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>æœåŠ¡å™¨</th>
<th>IP</th>
<th>CPU</th>
<th>å†…å­˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>master</td>
<td>192.168.35.128</td>
<td>8<code>core</code></td>
<td>8G</td>
</tr>
<tr>
<td>node-1</td>
<td>192.168.35.129</td>
<td>4<code>core</code></td>
<td>4G</td>
</tr>
<tr>
<td>node-2</td>
<td>192.168.35.130</td>
<td>4<code>core</code></td>
<td>4G</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="3">
<li>å‰ææ¡ä»¶</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>3.1 <!-- raw HTML omitted -->æ‰€æœ‰æœºå™¨éƒ½æ˜¯<code>CentOS 7</code><!-- raw HTML omitted --></li>
<li>3.2 <!-- raw HTML omitted --><code>Rancher Server</code>æ˜¯ä»¥<code>Docker</code>æ–¹å¼å•ç‹¬å»ºç«‹<!-- raw HTML omitted --></li>
<li>3.3 <!-- raw HTML omitted --><code>test-cluster Kubernetes Cluster</code>é›†ç¾¤æ˜¯ä»¥<code>Rancher Server</code>è‡ªå®šä¹‰æ–¹å¼åˆ›å»º<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ¨¡æ‹Ÿ<code>Racnher Server</code>æœåŠ¡å¤±æ•ˆå¯¹<code>Kubernetes Cluster</code>é›†ç¾¤è¿›è¡Œç®¡æ§<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>4.1 <!-- raw HTML omitted -->ç‚¹å‡»åˆ›å»ºé›†ç¾¤åç§°<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-d8d57bac1361f3189b85aab4957b165d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-47-45.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d8d57bac1361f3189b85aab4957b165d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-47-45.png"></a></p>
<ul>
<li>4.2 <!-- raw HTML omitted -->æå‰ä¸‹è½½<code>Kubernetesfig</code>æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-c8198e7e3fafd524e3cbbb98dfe5c1b3" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-49-19.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c8198e7e3fafd524e3cbbb98dfe5c1b3"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-49-19.png"></a></p>
<p><a href="#R-image-f7e0313d37d038d55e0fe71a002c08a6" class="lightbox-link"><img alt="ä¸‹k8s file" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_16-16-23.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f7e0313d37d038d55e0fe71a002c08a6"><img alt="ä¸‹k8s file" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_16-16-23.png"></a></p>
</blockquote>
<hr>
<h2 id="æ¨¡æ‹ŸrancheræœåŠ¡å®•æœº">æ¨¡æ‹Ÿ<code>Rancher</code>æœåŠ¡å®•æœº</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœæ­¢<code>Rancher Server</code>æœåŠ¡<code>docker stop rancher</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>1.1 <!-- raw HTML omitted --><code>æŸ¥çœ‹Kubernetes</code>é›†ç¾¤ç‰ˆæœ¬å·<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-2df7aadca9b7a0efb5c7f0fd2d4ee0e6" class="lightbox-link"><img alt="æŸ¥çœ‹<code>Rancher</code>å®‰è£…<code>Kubernetes</code>é›†ç¾¤ç‰ˆæœ¬" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-25_20-04-18.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2df7aadca9b7a0efb5c7f0fd2d4ee0e6"><img alt="æŸ¥çœ‹<code>Rancher</code>å®‰è£…<code>Kubernetes</code>é›†ç¾¤ç‰ˆæœ¬" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-25_20-04-18.png"></a></p>
</blockquote>
<h3 id="å®‰è£…kubectl">å®‰è£…<code>Kubectl</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœ¨èƒ½è¿æ¥<code>test-kubernetes-cluster</code>é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹éƒ¨ç½²<code>Kubectl</code><!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><code>Kubectl</code>ç‰ˆæœ¬éœ€å’Œ<code>test-cluster-cluster</code>ç‰ˆæœ¬ç›¸åŒæˆ–è€…é«˜äº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/yum.repos.d/kubernetes.repo<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[kubernetes] 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name=Kubernetes 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">repo_gpgcheck=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install kubectl-1.23.6-0</span></span></code></pre></div></blockquote>
<h3 id="åˆ›å»ºkubeç›®å½•ä¿®æ”¹æ–‡ä»¶">åˆ›å»º<code>.kube</code>ç›®å½•ä¿®æ”¹æ–‡ä»¶</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å¹¶ä¸”å°†ä¸‹è½½çš„<code>Kubernetesfig</code>æ–‡ä»¶æ”¹åä¸º<code>config</code>ï¼Œç„¶åæ”¾åˆ°<code>${HOME}/.kube/</code>ç›®å½•ä¸­<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mv <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/test-kubernetes-cluster.yaml <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/config</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><code>${HOME}/.kube/config</code>æ–‡ä»¶æ²¡ä¿®æ”¹å‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/config
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Config
</span></span><span style="display:flex;"><span>clusters:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style="display:flex;"><span>  cluster:
</span></span><span style="display:flex;"><span>    server: <span style="color:#e6db74">&#34;https://192.168.80.210:4443/k8s/clusters/c-gwknl&#34;</span>
</span></span><span style="display:flex;"><span>    certificate-authority-data: <span style="color:#e6db74">&#34;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJwekNDQ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      VUyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQTdNUnd3R2dZRFZRUUtFeE5rZVc1aGJXbGoKY\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      kdsemRHVnVaWEl0YjNKbk1Sc3dHUVlEVlFRREV4SmtlVzVoYldsamJHbHpkR1Z1WlhJdFkyRXdIa\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      GNOTWpJdwpOVEkxTVRFeE9UUXhXaGNOTXpJd05USXlNVEV4T1RReFdqQTdNUnd3R2dZRFZRUUtFe\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      E5rZVc1aGJXbGpiR2x6CmRHVnVaWEl0YjNKbk1Sc3dHUVlEVlFRREV4SmtlVzVoYldsamJHbHpkR\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      1Z1WlhJdFkyRXdXVEFUQmdjcWhrak8KUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVJTb3NwRzE4OHJBQ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      mZabTAwQnRqcjAyL29udnZGVnppU09wZUdVd09SUApoSHpUbk1acTRmazVpRFhPV2lIUy9iQ0hvT\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      WQra1VtYkx6QVRPNkd2azdtSm8wSXdRREFPQmdOVkhROEJBZjhFCkJBTUNBcVF3RHdZRFZSMFRBU\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      UgvQkFVd0F3RUIvekFkQmdOVkhRNEVGZ1FVZ1YzR1g0Z2tXN3hPZVZWQURWem0KVEpxSW95b3dDZ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      1lJS29aSXpqMEVBd0lEU0FBd1JRSWdlTHh3WTVGcGkweDBGNXhBQUNZMnNPbVQ4aHBqNjVCWApUc\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      1lsQk1sOGx0RUNJUURkNmlONTJmbG9hVzZybXpvWXRLQy9nOEJRRW00b2UrcGN0YldCaGY0UENRP\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      T0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ==&#34;</span>
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster-node-1-80-211&#34;</span>
</span></span><span style="display:flex;"><span>  cluster:
</span></span><span style="display:flex;"><span>    server: <span style="color:#e6db74">&#34;https://192.168.80.211:6443&#34;</span>
</span></span><span style="display:flex;"><span>    certificate-authority-data: <span style="color:#e6db74">&#34;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM0VENDQ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      WNtZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKT\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      FdOaE1CNFhEVEl5TURVeU5URXhNek0xTUZvWERUTXlNRFV5TWpFeE16TTFNRm93RWpFUU1BNEdBM\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      VVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      0VCQUtJSzVRVy84eHB3CkRHUzMrN0M2Q0lobS8zcWFUUENvVmdFeU91YkVtR1EzbnAvYk9qTUJKY\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3Ayck05cW5CV2M4ZmtUUWhCNHZsL24Kay8zSkUrMkdta1RBbVAwaGpLa3d6d1JiT2lrYzdYVEtnd\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ElTQ3I2cjRkOWhZTElERElzTTJtUzZYYnhNdGd1SApoamk3MTJYQmNoZ3lEamxjREl3S1k5WXRYc\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3lDY3hPejdFNXN4YmpLTk1nb2sxK3VZSTlHaHhYYUlGcGp0VWFUClJXUW00dE9JOFplWWlUWG9aT\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      nJldTU1SVkyZ3pQVjZ1dURTWGQybFRHMEtmVng0Y1FYSDJIekdSODJ4NWZkK3kKS01HY0M1N21DN\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      HpiM3pET1Z2NVNEdmxOZEhyQ0g3QmpVYzh0MlFpU2JyQUwrQ216NnhMVFF4dlp1YkVLejU2TApKe\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ElKUGFhNkdSY0NBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93U\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      UZNQU1CCkFmOHdIUVlEVlIwT0JCWUVGSkN3bmVCVXZUMUtoeWtCUjF6bmxWQ2I1T2RnTUEwR0NTc\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      UdTSWIzRFFFQkN3VUEKQTRJQkFRQnRwa0doRDJ1RFdYTmZaSUhaa0NNclNpSkZXaGxIUGNPa2VPZ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      TJwcmp1UEZ0bzFWMVpyNlloWWVpcQp1cGxRdWlpenBwbEthZncxR1lpSnY4SCsrcHpjUFZoS3JTM\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      2F5Ykp1T2hxdnFyYUVZbzJDbjVVbkFpVWxBb2g1CnRqY1lNcVFKdkVzODd5UlFtUVhMSVNEMkdYb\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3UwN24ySy9wTVZXQWpHYjRsUTk0VmpHcjI3dHppSlhIYkh2L04KbHNNZklJV2czbTFKSW9SMlBNa\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3gvY1FpcGl6a3JRVHRpalhMbW0xbUFGOEtMR2JZcnNaTk1sMFdITWZWWjdXcgplemRBVjhVNDdsb\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      GowKzUzQ0FkZk0rYWpiSk5uMUtYMWF1Sm8rb1JXVTJjVno0SkYydUllMnBjcFcxUUplY1NPCmZ2U\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ysyOU9FK09GZW5tenRINTdZTStTWk1jRE8KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>users:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style="display:flex;"><span>  user:
</span></span><span style="display:flex;"><span>    token: <span style="color:#e6db74">&#34;kubeconfig-user-j85xz8pbjt:ls679hfqpvf9c25nswd5gdfm2hf4qtxj2kvqmj6kzzrjkj48lwwlpd&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>contexts:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style="display:flex;"><span>  context:
</span></span><span style="display:flex;"><span>    user: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style="display:flex;"><span>    cluster: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster-node-1-80-211&#34;</span>
</span></span><span style="display:flex;"><span>  context:
</span></span><span style="display:flex;"><span>    user: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style="display:flex;"><span>    cluster: <span style="color:#e6db74">&#34;test-kubernetes-cluster-node-1-80-211&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>current-context: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted --><code>${HOME}/.kube/config</code>æ–‡ä»¶ä¿®æ”¹å<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/config
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Config
</span></span><span style="display:flex;"><span>clusters:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style="display:flex;"><span>  cluster:
</span></span><span style="display:flex;"><span>    server: <span style="color:#e6db74">&#34;https://192.168.80.211:6443&#34;</span>
</span></span><span style="display:flex;"><span>    certificate-authority-data: <span style="color:#e6db74">&#34;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM0VENDQ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      WNtZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKT\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      FdOaE1CNFhEVEl5TURVeU5URXhNek0xTUZvWERUTXlNRFV5TWpFeE16TTFNRm93RWpFUU1BNEdBM\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      VVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      0VCQUtJSzVRVy84eHB3CkRHUzMrN0M2Q0lobS8zcWFUUENvVmdFeU91YkVtR1EzbnAvYk9qTUJKY\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3Ayck05cW5CV2M4ZmtUUWhCNHZsL24Kay8zSkUrMkdta1RBbVAwaGpLa3d6d1JiT2lrYzdYVEtnd\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ElTQ3I2cjRkOWhZTElERElzTTJtUzZYYnhNdGd1SApoamk3MTJYQmNoZ3lEamxjREl3S1k5WXRYc\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3lDY3hPejdFNXN4YmpLTk1nb2sxK3VZSTlHaHhYYUlGcGp0VWFUClJXUW00dE9JOFplWWlUWG9aT\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      nJldTU1SVkyZ3pQVjZ1dURTWGQybFRHMEtmVng0Y1FYSDJIekdSODJ4NWZkK3kKS01HY0M1N21DN\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      HpiM3pET1Z2NVNEdmxOZEhyQ0g3QmpVYzh0MlFpU2JyQUwrQ216NnhMVFF4dlp1YkVLejU2TApKe\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ElKUGFhNkdSY0NBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93U\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      UZNQU1CCkFmOHdIUVlEVlIwT0JCWUVGSkN3bmVCVXZUMUtoeWtCUjF6bmxWQ2I1T2RnTUEwR0NTc\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      UdTSWIzRFFFQkN3VUEKQTRJQkFRQnRwa0doRDJ1RFdYTmZaSUhaa0NNclNpSkZXaGxIUGNPa2VPZ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      TJwcmp1UEZ0bzFWMVpyNlloWWVpcQp1cGxRdWlpenBwbEthZncxR1lpSnY4SCsrcHpjUFZoS3JTM\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      2F5Ykp1T2hxdnFyYUVZbzJDbjVVbkFpVWxBb2g1CnRqY1lNcVFKdkVzODd5UlFtUVhMSVNEMkdYb\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3UwN24ySy9wTVZXQWpHYjRsUTk0VmpHcjI3dHppSlhIYkh2L04KbHNNZklJV2czbTFKSW9SMlBNa\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3gvY1FpcGl6a3JRVHRpalhMbW0xbUFGOEtMR2JZcnNaTk1sMFdITWZWWjdXcgplemRBVjhVNDdsb\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      GowKzUzQ0FkZk0rYWpiSk5uMUtYMWF1Sm8rb1JXVTJjVno0SkYydUllMnBjcFcxUUplY1NPCmZ2U\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ysyOU9FK09GZW5tenRINTdZTStTWk1jRE8KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>users:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style="display:flex;"><span>  user:
</span></span><span style="display:flex;"><span>    token: <span style="color:#e6db74">&#34;kubeconfig-user-j85xz8pbjt:ls679hfqpvf9c25nswd5gdfm2hf4qtxj2kvqmj6kzzrjkj48lwwlpd&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>contexts:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style="display:flex;"><span>  context:
</span></span><span style="display:flex;"><span>    user: <span style="color:#e6db74">&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style="display:flex;"><span>    cluster: <span style="color:#e6db74">&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>current-context: <span style="color:#e6db74">&#34;test-kubernetes-cluster-rke-master&#34;</span></span></span></code></pre></div></blockquote>
<h3 id="ä½¿ç”¨kubectlæ§åˆ¶kubernetes-clusteré›†ç¾¤">ä½¿ç”¨<code>Kubectl</code>æ§åˆ¶<code>Kubernetes Cluster</code>é›†ç¾¤</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl --kubeconfig <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/config get pods -n kube-system
</span></span><span style="display:flex;"><span>$ kubectl create ns dev</span></span></code></pre></div></blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_k8s_jcr">Configure_K8s_Jcr</h1>

<h2 id="å®‰è£…é…ç½®jfrog-artifactory">å®‰è£…é…ç½®<code>JFrog Artifactory</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸‹è½½æœ€æ–°<!-- raw HTML omitted --><code>JFrog Artifactory</code>ç¤¾åŒºç‰ˆé•œåƒ</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker pull docker.bintray.io/jfrog/artifactory-jcr:latest</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¸ºç§æœ‰é•œåƒä»“åº“åšæŒä¹…åŒ–å­˜å‚¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/docker/volume/artifactory
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">777</span> -R /opt/docker
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ‡æ¢åˆ°ä¸Šè¿°ç›®å½•åæ‰§è¡Œæ•°æ®å·åˆ›å»ºå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ cd /opt/docker/volume/artifactory
</span></span><span style="display:flex;"><span>$ docker volume create data</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¯åŠ¨é•œåƒ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>3.1 <!-- raw HTML omitted -->é»˜è®¤ç”¨æˆ·åï¼š<!-- raw HTML omitted --><code>admin</code></li>
<li>3.2 <!-- raw HTML omitted -->é»˜è®¤å¯†ç ï¼š<!-- raw HTML omitted --><code>password</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run --name jfrog-artifactory -d -v /opt/docker/volume/artifactory:/var/opt/jfrog/artifactory -p 8081:8081 -p 8082:8082 docker.bintray.io/jfrog/artifactory-jcr:latest</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ‰“å¼€æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http://ip:8082  	<span style="color:#75715e"># æˆ–è€…é…ç½®NginxåŸŸå</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_k8s_helm">Configure_K8s_Helm</h1>

<h1 id="ä½¿ç”¨helmé…ç½®ç®¡ç†k8s">ä½¿ç”¨<code>Helm</code>é…ç½®ç®¡ç†<code>K8s</code></h1>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/bitnami/" rel="external" target="_self"><code>Bitnami</code>æ¨¡æ¿åº“</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/bitnami/charts/tree/main/bitnami" rel="external" target="_self"><code>Kubernetes</code>çš„<code>Bitnami</code>åº“</a></td>
<td><code>Helm</code>å®‰è£…<code>Kubernetes</code>æœåŠ¡<code>Zabbix</code>ã€<code>Redis</code>ã€<code>Mysql</code>æ¨¡æ¿</td>
</tr>
<tr>
<td><a href="https://github.com/bitnami/charts-docs/tree/main/charts" rel="external" target="_self"><code>Kubernetes</code>çš„<code>Charts-docs</code>åº“</a></td>
<td><code>Helm</code>å®‰è£…<code>Kubernetes</code>æœåŠ¡<code>Zabbix</code>ã€<code>Redis</code>ã€<code>Mysql</code>æ¨¡æ¿</td>
</tr>
<tr>
<td><a href="https://artifacthub.io/" rel="external" target="_self">æŸ¥æ‰¾ã€å®‰è£…å’Œå‘å¸ƒ<code>Kubernetes</code>åŒ…</a></td>
<td><code>Helm</code>å®‰è£…<code>Kubernetes</code>æœåŠ¡<code>Zabbix</code>ã€<code>Redis</code>ã€<code>Mysql</code>æ¨¡æ¿</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><code>kubernetes</code>ä¸Šçš„åº”ç”¨å¯¹è±¡ï¼Œéƒ½æ˜¯ç”±ç‰¹å®šçš„èµ„æºæè¿°ç»„æˆï¼ŒåŒ…æ‹¬<code>Deployment</code>ã€<code>Service</code>ç­‰ï¼Œéƒ½ä¿å­˜åœ¨å„è‡ªæ–‡ä»¶ä¸­æˆ–è€…é›†ä¸­å†™åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åé€šè¿‡<code>kubectl apply -f </code>éƒ¨ç½²ã€‚å¦‚æœåº”ç”¨åªç”±ä¸€ä¸ªæˆ–å‡ ä¸ªè¿™æ ·çš„æœåŠ¡ç»„æˆï¼Œä¸Šé¢çš„éƒ¨ç½²æ–¹å¼å°±è¶³å¤Ÿäº†ã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ªå¤æ‚çš„åº”ç”¨ï¼Œä¼šæœ‰å¾ˆå¤šç±»ä¼¼ä¸Šé¢çš„èµ„æºæè¿°æ–‡ä»¶ï¼Œä¾‹å¦‚å¾®æœåŠ¡æ¶æ„åº”ç”¨ï¼Œç»„æˆåº”ç”¨çš„æœåŠ¡å¯èƒ½å¤šè¾¾å‡ åã€ä¸Šç™¾ä¸ªï¼Œå¦‚æœæœ‰æ›´æ–°æˆ–å›æ»šåº”ç”¨çš„éœ€æ±‚ï¼Œå¯èƒ½è¦ä¿®æ”¹å’Œç»´æŠ¤æ‰€æ¶‰åŠåˆ°å¤§é‡çš„èµ„æºæ–‡ä»¶ï¼Œè€Œè¿™ç§ç»„ç»‡å’Œç®¡ç†åº”ç”¨çš„æ–¹å¼å°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒäº†ã€‚å¹¶ä¸”ç”±äºç¼ºå°‘å¯¹å‘å¸ƒè¿‡çš„åº”ç”¨è¿›è¡Œç‰ˆæœ¬ç®¡ç†å’Œæ§åˆ¶ï¼Œä½¿å¾—<code>kubernetes</code>ä¸Šçš„åº”ç”¨ç»´æŠ¤å’Œæ›´æ–°é¢ä¸´è¯¸å¤šçš„æŒ‘æˆ˜ï¼Œä¸»è¦é¢ä¸´ä»¥ä¸‹çš„é—®é¢˜ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>å¦‚ä½•å°†è¿™äº›æœåŠ¡ä½œä¸ºä¸€ä¸ªæ•´ä½“ç®¡ç†ï¼Ÿ</li>
<li>è¿™äº›èµ„æºæ–‡ä»¶å¦‚ä½•é«˜æ•ˆå¤ç”¨ï¼Ÿ</li>
<li>åº”ç”¨çº§åˆ«çš„ç‰ˆæœ¬å¦‚ä½•ç®¡ç†ï¼Ÿ</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>Helm</code><!-- raw HTML omitted -->æ˜¯ä¸€ä¸ª<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå°±åƒ<!-- raw HTML omitted --><code>Linux</code><!-- raw HTML omitted -->ä¸‹çš„åŒ…ç®¡ç†å™¨ï¼Œå¦‚<!-- raw HTML omitted --><code>yum</code>ã€<code>apt</code><!-- raw HTML omitted -->ç­‰ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†ä¹‹å‰æ‰“åŒ…å¥½çš„<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶éƒ¨ç½²åˆ°<!-- raw HTML omitted --><code>kubernetes</code>ä¸Š</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>Helm</code><!-- raw HTML omitted -->æœ‰3ä¸ªé‡è¦æ¦‚å¿µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>helm</code><!-- raw HTML omitted -->ï¼šä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯å·¥å…·ï¼Œä¸»è¦ç”¨äº<!-- raw HTML omitted --><code>kubernetes</code>åº”ç”¨<code>chart</code>çš„åˆ›å»ºã€æ‰“åŒ…ã€å‘å¸ƒå’Œç®¡ç†</li>
<li><code>chart</code><!-- raw HTML omitted -->ï¼šåº”ç”¨æè¿°ï¼Œä¸€ç³»åˆ—ç”¨äºæè¿°<!-- raw HTML omitted --><code>kubernetes</code>èµ„æºç›¸å…³æ–‡ä»¶çš„é›†åˆï¼Œç±»ä¼¼<code>Ansible</code>çš„<code>Playbook</code>å‰§æœ¬</li>
<li><code>release</code><!-- raw HTML omitted -->ï¼šåŸºäº<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->çš„éƒ¨ç½²å®ä½“ï¼Œä¸€ä¸ª<!-- raw HTML omitted --><code>chart</code>è¢«<code>Helm</code>è¿è¡Œåå°†ä¼šç”Ÿæˆå¯¹åº”çš„ä¸€ä¸ª<code>release</code>ï¼Œå°†åœ¨<code>kubernetes</code>ä¸­åˆ›å»ºå‡ºçœŸå®è¿è¡Œçš„èµ„æºå¯¹è±¡</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>Helm v3</code><!-- raw HTML omitted -->å˜åŒ–<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>æœ€æ˜æ˜¾å˜åŒ–åˆ é™¤<code>Tiller</code>ç»„ä»¶</li>
<li><code>release</code>åç§°å¯ä»¥åœ¨ä¸åŒçš„å‘½åç©ºé—´é‡ç”¨ã€‚</li>
<li>æ”¯æŒå°†<code>chart</code>æ¨åŠ¨åˆ°<code>Docker</code>é•œåƒä»“åº“ä¸­</li>
<li>ä½¿ç”¨<code>JSONSchema</code>éªŒè¯<code>chart values</code></li>
</ul>
</blockquote>
<hr>
<h2 id="helmå¸¸ç”¨å‘½ä»¤"><code>Helm</code>å¸¸ç”¨å‘½ä»¤</h2>
<blockquote>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>get</code></td>
<td>ä¸‹è½½ä¸€ä¸ª<code>release</code>ã€‚å¯ç”¨çš„å­å‘½ä»¤ï¼š<code>all</code>ã€<code>hooks</code>ã€<code>manifest</code>ã€<code>note</code>ã€<code>values</code></td>
</tr>
<tr>
<td><code>repo</code></td>
<td>æ·»åŠ ã€åˆ—å‡ºã€ç§»é™¤ã€æ›´æ–°å’Œç´¢å¼•<code>chart</code>ä»“åº“ã€‚å¯ç”¨çš„å­å‘½ä»¤ï¼š<code>add</code>ã€<code>index</code>ã€<code>list</code>ã€<code>remove</code>ã€<code>update</code></td>
</tr>
<tr>
<td><code>list</code></td>
<td>åˆ—å‡º<code>release</code></td>
</tr>
<tr>
<td><code>pull</code></td>
<td>ä»è¿œç¨‹ä»“åº“ä¸­ä¸‹è½½<code>chart</code>å¹¶è§£å‹åˆ°æœ¬åœ°ã€‚æ¯”å¦‚ï¼š<code>helm install stable/mysql --untar</code></td>
</tr>
<tr>
<td><code>show</code></td>
<td>æŸ¥çœ‹<code>chart</code>çš„è¯¦ç»†ä¿¡æ¯ã€‚å¯ç”¨çš„å­å‘½ä»¤ï¼š<code>all</code>ã€<code>chart</code>ã€<code>readme</code>ã€<code>values</code></td>
</tr>
<tr>
<td><code>search</code></td>
<td>æ ¹æ®å…³é”®å­—æœç´¢<code>chart</code>ã€‚å¯ç”¨çš„å­å‘½ä»¤ï¼š<code>all</code>ã€<code>chart</code>ã€<code>readme</code>ã€<code>values</code></td>
</tr>
<tr>
<td><code>create</code></td>
<td>åˆ›å»ºä¸€ä¸ª<code>chart</code>å¹¶æŒ‡å®šåå­—</td>
</tr>
<tr>
<td><code>install</code></td>
<td>å®‰è£…ä¸€ä¸ª<code>chart</code></td>
</tr>
<tr>
<td><code>status</code></td>
<td>æ˜¾ç¤ºå·²å‘½åç‰ˆæœ¬çš„çŠ¶æ€</td>
</tr>
<tr>
<td><code>upgrade</code></td>
<td>æ›´æ–°å‡çº§ä¸€ä¸ª<code>release</code></td>
</tr>
<tr>
<td><code>history</code></td>
<td>è·å–<code>release</code>å†å²</td>
</tr>
<tr>
<td><code>package</code></td>
<td>å°†<code>chart</code>ç›®å½•æ‰“åŒ…åˆ°<code>chart</code>å­˜æ¡£æ–‡ä»¶ä¸­</td>
</tr>
<tr>
<td><code>template</code></td>
<td>æœ¬åœ°å‘ˆç°æ¨¡æ¿</td>
</tr>
<tr>
<td><code>rollback</code></td>
<td>ä»ä¹‹å‰çš„ç‰ˆæœ¬å›é€€</td>
</tr>
<tr>
<td><code>uninstall</code></td>
<td>å¸è½½ä¸€ä¸ª<code>release</code></td>
</tr>
<tr>
<td><code>dependency</code></td>
<td>ç®¡ç†<code>chart</code>ä¾èµ–</td>
</tr>
<tr>
<td><code>version</code></td>
<td>æŸ¥çœ‹<code>Helm</code>å®¢æˆ·ç«¯ç‰ˆæœ¬</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="font-colorredå®‰è£…fonthelm"><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Helm</code></h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨äºŒè¿›åˆ¶å®‰è£…<!-- raw HTML omitted --><code>Helm</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://get.helm.sh/helm-v3.9.0-linux-amd64.tar.gz  
</span></span><span style="display:flex;"><span>$ tar -zxvf helm-v3.9.0-linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv linux-amd64/helm /usr/local/bin/helm</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è„šæœ¬å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">700</span> get_helm.sh
</span></span><span style="display:flex;"><span>$ ./get_helm.sh</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æºä»£ç å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/helm/helm.git
</span></span><span style="display:flex;"><span>$ cd helm
</span></span><span style="display:flex;"><span>$ make</span></span></code></pre></div></blockquote>
<hr>
<h2 id="é…ç½®chartä»“åº“">é…ç½®<code>chart</code>ä»“åº“</h2>
<blockquote>
<ul>
<li><code>Helm</code><!-- raw HTML omitted -->æ·»åŠ ä»“åº“æ–¹å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo add ä»“åº“å ä»“åº“åœ°å€</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨å®˜æ–¹ä»“åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo add helm https://hub.kubeapps.com/charts/incubator</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ·»åŠ å…¶å®ƒä»“åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Bitnami</span>
</span></span><span style="display:flex;"><span>$ helm repo add bitnami https://charts.bitnami.com/bitnami
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨å¾®è½¯ä»“åº“</span>
</span></span><span style="display:flex;"><span>$ helm repo add microsoft http://mirror.azure.cn/kubernetes/charts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å›½å†…æ·»åŠ é˜¿é‡Œäº‘ã€å¾®è½¯ä»“åº“</span>
</span></span><span style="display:flex;"><span>$ helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ›´æ–°ä»“åº“å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo update</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ é™¤å­˜å‚¨åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo remove ä»“åº“å</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–é…ç½®çš„å­˜å‚¨åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo list</span></span></code></pre></div></blockquote>
<hr>
<h2 id="helmåŸºæœ¬ä½¿ç”¨"><code>Helm</code>åŸºæœ¬ä½¿ç”¨</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ ¹æ®å…³é”®å­—æœç´¢<!-- raw HTML omitted --><code>chart</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm search repo | hub chartåç§°
</span></span><span style="display:flex;"><span>$ helm search repo redis    <span style="color:#75715e"># ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span>  DEPRECATED  	<span style="color:#75715e"># è¡¨ç¤ºå·²è¿‡æœŸ</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ä¿¡æ¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm show chart ä»“åº“å/chartåç§°
</span></span><span style="display:flex;"><span>$ helm show chart bitnami/redis</span></span></code></pre></div><ul>
<li><code>readme</code><!-- raw HTML omitted -->æŸ¥çœ‹å®‰è£…æ–‡æ¡£è¯´æ˜<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm show readme bitnami/redis</span></span></code></pre></div></blockquote>
<hr>
<h3 id="font-colorredå®‰è£…fontchartfont-colorredå½¢æˆfontrelease"><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ï¼Œå½¢æˆ<!-- raw HTML omitted --><code>release</code></h3>
<ul>
<li>
<ol>
<li>è‡ªå®šä¹‰é€‰é¡¹æ˜¯å› ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰çš„<code>chart</code>éƒ½èƒ½æŒ‰ç…§é»˜è®¤é…ç½®è¿è¡ŒæˆåŠŸï¼Œå¯èƒ½ä¼šéœ€è¦ä¸€äº›ç¯å¢ƒä¾èµ–ï¼Œä¾‹å¦‚<code>PV</code>ã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li>æ‰€ä»¥éœ€è¦è‡ªå®šä¹‰<code>chart</code>é…ç½®é€‰é¡¹ï¼Œå®‰è£…è¿‡ç¨‹ä¸­æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä¼ é€’é…ç½®æ•°æ®ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>--values</code><!-- raw HTML omitted -->ï¼šçš„ä½¿ç”¨(éº»çƒ¦ã€ä¸æ¨è)<!-- raw HTML omitted --></li>
<li><code>--set</code><!-- raw HTML omitted -->ï¼šåœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šæ›¿ä»£ã€‚å¦‚æœä¸¤ç§éƒ½ç”¨ï¼Œé‚£ä¹ˆ<!-- raw HTML omitted --><code>--set</code>çš„ä¼˜å…ˆçº§é«˜</li>
<li><code>--values æˆ– -f</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šå¸¦æœ‰è¦†ç›–çš„<!-- raw HTML omitted --><code>YAML</code>æ–‡ä»¶ã€‚è¿™é‡Œå¯ä»¥å¤šæ¬¡æŒ‡å®šï¼Œæœ€å³è¾¹çš„æ–‡ä»¶ä¼˜å…ˆ</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å®‰è£…å¯èƒ½æŠ¥é”™ï¼Œéœ€è¦è‡ªå·±æ‰‹åŠ¨å®‰è£…<!-- raw HTML omitted --><code>PV</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å…ˆå°†ä¿®æ”¹çš„å˜é‡å†™åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä¿®æ”¹æ­¤æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm show values stable/mysql &gt; config.yaml</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>config.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>-- <span style="color:#ae81ff">ä¿®æ”¹éƒ¨åˆ†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">persistence</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">accessMode</span>: <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">size</span>: <span style="color:#ae81ff">8Gi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">mysqlUser</span>: <span style="color:#e6db74">&#34;k8s&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">mysqlPassword</span>: <span style="color:#e6db74">&#34;123456&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">mysqlDatabase</span>: <span style="color:#e6db74">&#34;k8s&#34;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>-f</code><!-- raw HTML omitted -->æ¥æ›¿æ¢é»˜è®¤çš„é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install -f config.yaml self-mysql stable/mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ¨èä½¿ç”¨å‘½ä»¤è¡Œæ›¿ä»£å˜é‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install db --set persistence.storageClass<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;managed-nfs-storage&#34;</span> stable/mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>chart</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install å®‰è£…ä¹‹åçš„åç§° ä»“åº“å/chartçš„åç§°<span style="color:#f92672">(</span>å³æœç´¢ä¹‹åçš„åº”ç”¨åç§°<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>$ helm install k8s_ui stable/weave-scope  	<span style="color:#75715e"># å®‰è£… stable/weave-scopeï¼Œå¹¶å°†å…¶å‘½åä¸º k8s_ui</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å½“å‰çš„ release åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>$ helm list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å·²å‘½å release çš„çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>$ helm status k8s_ui å®‰è£…ä¹‹åçš„åç§°</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Helm</code><!-- raw HTML omitted -->æ„å»ºä¸€ä¸ª<!-- raw HTML omitted --><code>Chart</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>helm create</code><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>chart</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm create mychart  <span style="color:#75715e"># chartåç§°</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è¿›å…¥è‡ªå®šä¹‰<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ç›®å½•çš„<!-- raw HTML omitted --><code>templates</code><!-- raw HTML omitted -->ç›®å½•ä¸­ï¼Œä¿®æ”¹å…¶ä¸­çš„<!-- raw HTML omitted --><code>deployment.yaml</code>å’Œ<code>service.yaml</code><!-- raw HTML omitted -->ç­‰æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>charts</code><!-- raw HTML omitted -->ï¼šè¯¥ç›®å½•ä¿å­˜å…¶ä»–ä¾èµ–çš„<!-- raw HTML omitted --><code>chart(å­chart)</code></li>
<li><code>Chart.yaml</code><!-- raw HTML omitted -->ï¼šå®šä¹‰å½“å‰<!-- raw HTML omitted --><code>Chart</code><!-- raw HTML omitted -->å±æ€§ä¿¡æ¯<!-- raw HTML omitted --></li>
<li><code>templates</code><!-- raw HTML omitted -->ï¼š<code>chart</code>é…ç½®æ¨¡æ¿ï¼Œç›®å½•å­˜æ”¾æ‰€æœ‰<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Deployment.yaml</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
<li><code>_helpers.tpl</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
<li><code>hpa.yaml</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
<li><code>ingress.yaml</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
<li><code>NOTES.txt</code><!-- raw HTML omitted -->ï¼šç”¨äºä»‹ç»<code>Chart</code>çš„å¸®åŠ©ä¿¡æ¯ï¼Œ<code>HelmÂ install</code>éƒ¨ç½²åå±•ç¤ºç»™ç”¨æˆ·<!-- raw HTML omitted --></li>
<li><code>serviceaccount.yaml</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
<li><code>service.yaml</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
<li><code>tests</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>tests-connection.yaml</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<ul>
<li><code>values.yaml</code><!-- raw HTML omitted -->ï¼šå®šä¹‰æ‰€æœ‰<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->å…¨å±€å˜é‡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd chartåç§°/templates</span></span></code></pre></div><p><a href="#R-image-047832c37600ebd7b4d2ebba89e7ec62" class="lightbox-link"><img alt="Chartä¸­çš„ä¿¡æ¯" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Helm/Chart%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-047832c37600ebd7b4d2ebba89e7ec62"><img alt="Chartä¸­çš„ä¿¡æ¯" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Helm/Chart%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->é€šè¿‡åˆšæ‰åˆ›å»ºçš„<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ç›®å½•ï¼Œå°†å…¶éƒ¨ç½²<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install web mychart  <span style="color:#75715e"># web:è‡ªå®šä¹‰åç§°ï¼Œchartåç§°</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ‰“åŒ…<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ï¼Œè®©åˆ«äººå…±äº«<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm package mychart  <span style="color:#75715e"># chartåç§°</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="font-colorredæŸ¥çœ‹fontservicefont-colorredå¹¶å°†å…¶æ”¹ä¸ºfontnodeport"><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>Service</code><!-- raw HTML omitted -->ï¼Œå¹¶å°†å…¶æ”¹ä¸º<!-- raw HTML omitted --><code>NodePort</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl edit svc xxx
</span></span><span style="display:flex;"><span>$ kubectl edit svc ui-weave-scope</span></span></code></pre></div></blockquote>
<hr>
<h3 id="font-colorredåº”ç”¨ç¤ºä¾‹font"><!-- raw HTML omitted -->åº”ç”¨ç¤ºä¾‹<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><code>root</code><!-- raw HTML omitted -->ç›®å½•ä¸‹æ“ä½œçš„<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li>åˆ›å»º<code>chart</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm create nginx</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->è¿›å…¥<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ç›®å½•ï¼Œä¿®æ”¹<!-- raw HTML omitted --><code>values.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;&gt;nginx/values.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">replicas: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">image: nginx 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">tag: 1.17 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">serviceport: 80 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">targetport: 80 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">label: nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->åˆ é™¤<!-- raw HTML omitted --><code>templates</code><!-- raw HTML omitted -->ç›®å½•ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rm -rf emplates/*</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>deployment.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;&gt;deployment.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: apps/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Deployment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     app: {{ .Values.label }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> name: {{ .Release.Name }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> replicas: {{ .Values.replicas }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     matchLabels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         app: {{ .Values.label }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> strategy: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> template:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             app: {{ .Values.label }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - image: {{ .Values.image }}:{{ .Values.tag }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          name: {{ .Values.image }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>service.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;&gt;service.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion:   v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     app: {{ .Values.label }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> name:  {{ .Release.Name }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        -  port: {{ .Values.serviceport }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">           protocol: TCP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">           targetPort: {{ .Values.targetport }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        app: {{ .Values.label }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: NodePort
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><!-- raw HTML omitted -->åˆ‡æ¢åˆ°<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ç›®å½•çš„ä¸Šä¸€å±‚ç›®å½•ã€å¹¶ä¸”å®‰è£…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd ~
</span></span><span style="display:flex;"><span>$ helm install nginx nginx/</span></span></code></pre></div></blockquote>
<hr>
<h3 id="font-colorredè°ƒè¯•font"><!-- raw HTML omitted -->è°ƒè¯•<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><code>Helm</code>ä¹Ÿæä¾›äº†<code>--dry-run</code>å’Œ<code>--debug</code>è°ƒè¯•å‚æ•°ï¼Œå¸®åŠ©ä½ éªŒè¯æ¨¡æ¿çš„æ­£ç¡®æ€§ã€‚åœ¨æ‰§è¡Œ<code>helm install</code>çš„æ—¶å€™å¸¦ä¸Šè¿™ä¸¤ä¸ªå‚æ•°å°±å¯ä»¥æŠŠå¯¹åº”çš„<code>values</code>å€¼å’Œæ¸²æŸ“çš„èµ„æºæ¸…å•æ‰“å°å‡ºæ¥ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„åšéƒ¨ç½²ä¸€ä¸ª<code>release</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install nginx nginx/ --dry-run --debug</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¸€äº›å¸¸ç”¨çš„å†…ç½®å¯¹è±¡ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å†…ç½®å¯¹è±¡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Release.Name</code></td>
<td><code>release</code>çš„åç§°</td>
</tr>
<tr>
<td><code>Release.Namespace</code></td>
<td><code>release</code>çš„å‘½åç©ºé—´</td>
</tr>
<tr>
<td><code>Release.Service</code></td>
<td><code>release</code>çš„æœåŠ¡çš„åç§°</td>
</tr>
<tr>
<td><code>Release.Revision</code></td>
<td><code>release</code>çš„ä¿®è®¢ç‰ˆæœ¬å·ï¼Œä»1å¼€å§‹ç´¯åŠ </td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="font-colorredvaluesfont"><!-- raw HTML omitted --><code>Values</code><!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><code>Values</code>å¯¹è±¡æ˜¯ä¸º<code>Chart</code>æ¨¡æ¿æä¾›å€¼ï¼Œè¿™ä¸ªå¯¹è±¡çš„å€¼æœ‰<code>4</code>ä¸ªæ¥æºï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>chart</code>åŒ…ä¸­çš„<code>values.yaml</code>æ–‡ä»¶</li>
<li>çˆ¶<code>chart</code>åŒ…çš„<code>values.yaml</code>æ–‡ä»¶</li>
<li>é€šè¿‡<code>helm install</code>æˆ–è€…<code>helm upgrade</code>çš„<code>-f</code>æˆ–è€…<code>--values</code>å‚æ•°ä¼ å…¥çš„è‡ªå®šä¹‰çš„<code>yaml</code>æ–‡ä»¶</li>
<li>é€šè¿‡<code>--set</code>å‚æ•°ä¼ å…¥çš„å€¼</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>Chart</code>çš„<code>values.yaml</code>æä¾›çš„å€¼å¯ä»¥è¢«ç”¨æˆ·æä¾›çš„<code>values</code>æ–‡ä»¶è¦†ç›–ï¼Œè€Œè¯¥æ–‡ä»¶åŒæ ·å¯ä»¥è¢«<code>--set</code>å‚æ•°æ‰€è¦†ç›–ï¼Œæ¢è¨€ä¹‹ï¼Œ<code>--set</code>å‚æ•°çš„ä¼˜å…ˆçº§é«˜</li>
</ol>
</li>
</ul>
<hr>
<h2 id="å‡çº§å›æ»šå’Œå¸è½½å‘è¡Œç‰ˆæœ¬">å‡çº§ã€å›æ»šå’Œå¸è½½å‘è¡Œç‰ˆæœ¬</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å‡çº§<!-- raw HTML omitted -->å‘å¸ƒæ–°ç‰ˆæœ¬çš„<code>chart</code>æ—¶ï¼Œæˆ–è€…å½“æˆ‘ä»¬éœ€è¦æ›´æ”¹å‘å¸ƒçš„é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨<code>helm upgrade</code>å‘½ä»¤</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm upgrade --set imageTag<span style="color:#f92672">=</span>1.18 nginx nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ helm upgrade web mychart  <span style="color:#75715e"># web:è‡ªå®šä¹‰åç§°ï¼Œchartåç§°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ helm upgrade -f values.yaml nginx nginx</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å›æ»š<!-- raw HTML omitted -->å¦‚æœåœ¨å‘å¸ƒåæ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„æ•ˆæœï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>helm rollback</code>å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm history redis -n default  	<span style="color:#75715e"># æŸ¥çœ‹å†å²ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ helm rollback nginx <span style="color:#ae81ff">1</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¸è½½<!-- raw HTML omitted -->å¯ä»¥ä½¿ç”¨<code>helm uninstall</code>å‘½ä»¤</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm uninstall nginx</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted --> æŸ¥çœ‹å†å²ç‰ˆæœ¬é…ç½®ä¿¡æ¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm get all --revision <span style="color:#ae81ff">1</span> nginx</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ç®¡é“å‡½æ•°">ç®¡é“ã€å‡½æ•°</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç®¡é“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>quote</code>  <code>.Values.label.app</code><!-- raw HTML omitted -->å°†åé¢çš„å€¼ä½œä¸ºå‚æ•°ä¼ é€’è¿‡<!-- raw HTML omitted --><code>quote</code><!-- raw HTML omitted -->å‡½æ•°<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æ¨¡æ¿å‡½æ•°è°ƒç”¨è¯­æ³•ä¸ºï¼š<!-- raw HTML omitted --><code>functionName arg1 arg2...</code></li>
<li>åœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œå…¶å®æ˜¯å°†å€¼ä¼ é€’ç»™æ¨¡æ¿å¼•æ“è¿›è¡Œæ¸²æŸ“ï¼Œæ¨¡æ¿å¼•æ“è¿˜æ”¯æŒå¯¹æ‹¿åˆ°çš„æ•°æ®è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼Œç¤ºä¾‹ï¼šä»<code>.Values</code>ä¸­è¯»å–çš„å€¼å˜æˆå­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨<code>quote</code>å‡½æ•°å®ç°</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat templates/deployment.yaml
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç•¥...</span>
</span></span><span style="display:flex;"><span>app: <span style="color:#f92672">{{</span> quote  .Values.label.app    <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç•¥...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ helm install --dry-run nginx ../nginx/ app:<span style="color:#e6db74">&#34;nginx&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å‡½æ•°<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>default</code><!-- raw HTML omitted -->å‡½æ•°è¿è¡Œåœ¨æ¨¡æ¿ä¸­æŒ‡å®šé»˜è®¤å€¼ï¼Œä»¥é˜²æ­¢è¯¥å€¼ä¼šå¿½ç•¥æ‰ã€‚å¦‚æœå¿˜è®°å®šä¹‰ï¼Œæ‰§è¡Œ<!-- raw HTML omitted --><code>helm install</code><!-- raw HTML omitted -->çš„æ—¶å€™ä¼šå› ä¸ºç¼ºå°‘å­—æ®µè€Œæ— æ³•åˆ›å»ºèµ„æºï¼Œè¿™æ—¶å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªé»˜è®¤å€¼äº†ï¼Œç¤ºä¾‹ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;&gt;templates/deployment.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: apps/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Deployment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        app: {{ .Values.label }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: {{ .Release.Name }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    replicas: {{ .Values.replicas }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        matchLabels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            app: {{ .Values.label }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    strategy: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    template:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                app: {{ .Values.label }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            - image: {{ .Values.image| default &#34;nginx&#34; }}:{{ .Values.tag }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              name: {{ .Values.image }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¼©è¿›å‡½æ•°ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{ <span style="color:#ae81ff">.Values.resources | indent 12 }}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¤§å†™å‡½æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{ <span style="color:#ae81ff">upper .Values.resources }}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é¦–å­—æ¯å¤§å†™å‡½æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{ <span style="color:#ae81ff">title .Values.resources }}</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="æµç¨‹æ§åˆ¶">æµç¨‹æ§åˆ¶</h2>
<ul>
<li>
<ol>
<li>æµç¨‹æ§åˆ¶æ˜¯ä¸ºæ¨¡æ¿æä¾›äº†ä¸€ç§èƒ½åŠ›ï¼Œæ»¡è¶³æ›´å¤æ‚çš„æ•°æ®é€»è¾‘å¤„ç†</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>Helm</code>æ¨¡æ¿è¯­è¨€æä¾›ä»¥ä¸‹æµç¨‹æ§åˆ¶è¯­å¥ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>if/else</code><!-- raw HTML omitted -->æ¡ä»¶å—<!-- raw HTML omitted --></li>
<li><code>with</code><!-- raw HTML omitted -->æŒ‡å®šèŒƒå›´<!-- raw HTML omitted --></li>
<li><code>range</code><!-- raw HTML omitted -->å¾ªç¯å—<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><code>if/else</code><!-- raw HTML omitted -->ï¼šå—æ˜¯ç”¨äºåœ¨æ¨¡æ¿æœ‰æ¡ä»¶çš„åŒ…å«æ–‡æœ¬å—çš„æ–¹æ³•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ¡ä»¶åˆ¤æ–­ï¼š<!-- raw HTML omitted -->å°±æ˜¯åˆ¤æ–­æ¡ä»¶æ˜¯å¦ä¸ºçœŸï¼Œå¦‚æœå€¼ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µåˆ™ä¸º<code>false</code>ï¼Œå¦åˆ™ä¸º<code>true</code>ï¼š</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„<!-- raw HTML omitted --><code>false</code></li>
<li><!-- raw HTML omitted -->ä¸€ä¸ªæ•°å­—<!-- raw HTML omitted --><code>0</code></li>
<li><!-- raw HTML omitted -->ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²<!-- raw HTML omitted --></li>
<li>ä¸€ä¸ªç©ºçš„é›†åˆ(<code>map</code>ã€<code>slice</code>ã€<code>tuple</code>ã€<code>dict</code>ã€<code>array</code>)</li>
</ul>
</blockquote>
<ul>
<li>è¿˜å¯ä»¥ä½¿ç”¨<code>ne</code>ã€<code>lt</code>ã€<code>gt</code>ã€<code>and</code>ã€<code>or</code>ç­‰è¿ç®—ç¬¦</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{ <span style="color:#ae81ff">if æ¡ä»¶è¡¨è¾¾å¼ }}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># xxx</span>
</span></span><span style="display:flex;"><span>{{ <span style="color:#ae81ff">else if æ¡ä»¶è¡¨è¾¾å¼ }}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># xxx</span>
</span></span><span style="display:flex;"><span>{{ <span style="color:#ae81ff">else }}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># xxx</span>
</span></span><span style="display:flex;"><span>{{ <span style="color:#ae81ff">end }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Release.Name }}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">replicas</span>: {{ <span style="color:#ae81ff">.Values.replicas }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">strategy</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">image</span>: {{ <span style="color:#ae81ff">.Values.image| default &#34;nginx&#34; }}:{{ .Values.tag }}</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Values.image }}</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>                  {{ <span style="color:#ae81ff">if eq .Values.devops &#34;k8s&#34; }}</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;123&#34;</span>
</span></span><span style="display:flex;"><span>                {{ <span style="color:#ae81ff">else }}</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;456&#34;</span>
</span></span><span style="display:flex;"><span>                {{ <span style="color:#ae81ff">end }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¨¡æ¿å¼•æ“æ¸²æŸ“ä¸€ä¸‹ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹çš„ç»“æœï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">$ helm install --dry-run nginx nginx</span></span></span></code></pre></div><ul>
<li>å¯ä»¥çœ‹åˆ°æ¸²æŸ“å‡ºæ¥ä¼šæœ‰å¤šä½™çš„ç©ºè¡Œï¼Œè¿™æ˜¯å› ä¸ºå½“æ¨¡æ¿å¼•æ“è¿è¡Œçš„æ—¶å€™ï¼Œä¼šå°†æ§åˆ¶æŒ‡ä»¤åˆ é™¤ï¼Œæ‰€ä»¥ä¹‹å‰å çš„ä½ç½®ä¹Ÿå°±ç©ºç™½äº†ï¼Œéœ€è¦ä½¿ç”¨<code>{{- if ...}}</code>çš„æ–¹å¼æ¶ˆé™¤æ­¤ç©ºè¡Œ</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Release.Name }}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">replicas</span>: {{ <span style="color:#ae81ff">.Values.replicas }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">strategy</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">image</span>: {{ <span style="color:#ae81ff">.Values.image| default &#34;nginx&#34; }}:{{ .Values.tag }}</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Values.image }}</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>                      {{- <span style="color:#ae81ff">if eq .Values.devops &#34;k8s&#34; }}</span>
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;123&#34;</span>
</span></span><span style="display:flex;"><span>                  {{- <span style="color:#ae81ff">else }}</span>
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;456&#34;</span>
</span></span><span style="display:flex;"><span>                  {{- <span style="color:#ae81ff">end }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é€šè¿‡æ¨¡æ¿å¼•æ“æ¸²æŸ“ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹çš„ç»“æœ</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">$ helm install --dry-run nginx nginx</span></span></span></code></pre></div><ul>
<li>å¦‚æœä½¿ç”¨<code>{{- if ... -}}</code>é‚£ä¹ˆå°±éœ€è¦è°¨æ…ï¼Œæ¯”å¦‚ï¼š</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Release.Name }}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">replicas</span>: {{ <span style="color:#ae81ff">.Values.replicas }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">strategy</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">image</span>: {{ <span style="color:#ae81ff">.Values.image| default &#34;nginx&#34; }}:{{ .Values.tag }}</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Values.image }}</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>                      {{- <span style="color:#ae81ff">if eq .Values.devops &#34;k8s&#34; -}}</span>
</span></span><span style="display:flex;"><span>                  - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;123&#34;</span>
</span></span><span style="display:flex;"><span>                    {{- <span style="color:#ae81ff">else }}</span>
</span></span><span style="display:flex;"><span>                  - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;456&#34;</span>
</span></span><span style="display:flex;"><span>                    {{- <span style="color:#ae81ff">end }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é€šè¿‡æ¨¡æ¿å¼•æ“æ¸²æŸ“ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹çš„ç»“æœï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">$ helm install --dry-run nginx nginx</span></span></span></code></pre></div><ul>
<li>ç›¸å½“äºä¸‹é¢è¿™ç§æ ¼å¼</li>
</ul>
<blockquote>
<ul>
<li>å½“ç„¶ä¸å¯¹ï¼Œå› ä¸º<code>{{- if ... -}}</code>åˆ é™¤äº†åŒæ–¹çš„æ¢è¡Œç¬¦</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">NAME</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">LAST DEPLOYED</span>: <span style="color:#ae81ff">Mon Jan 11 20:46:10 2021</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">NAMESPACE</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">STATUS</span>: <span style="color:#ae81ff">pending-install</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">REVISION</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">TEST SUITE</span>: <span style="color:#ae81ff">None</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">HOOKS</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">MANIFEST</span>:
</span></span><span style="display:flex;"><span>---  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Source: nginx/templates/service.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>:   <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>:  <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        -  <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span> 
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Source: nginx/templates/deployment.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">strategy</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">env: - name: hello value</span>: <span style="color:#ae81ff">123</span></span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>range</code><!-- raw HTML omitted -->å¾ªç¯å—<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>åœ¨<code>Helm</code>æ¨¡æ¿è¯­è¨€ä¸­ï¼Œä½¿ç”¨<code>range</code>å…³é”®å­—æ¥è¿›è¡Œå¾ªç¯æ“ä½œ</li>
<li>åœ¨<code>values.yaml</code>ä¸­æ·»åŠ ä¸€ä¸ªå˜é‡åˆ—è¡¨ï¼š</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">test</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">1</span> 
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">2</span> 
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">3</span></span></span></code></pre></div><ul>
<li>4.3 å¾ªç¯æ‰“å°è¯¥åˆ—è¡¨ï¼š</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1 </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>:    {{   <span style="color:#ae81ff">.Release.Name    }} </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">test</span>:    
</span></span><span style="display:flex;"><span>        {{- <span style="color:#ae81ff">range . Values.test }}</span>
</span></span><span style="display:flex;"><span>            {{   <span style="color:#ae81ff">.    }}</span>
</span></span><span style="display:flex;"><span>        {{-   <span style="color:#ae81ff">end   }}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>with</code><!-- raw HTML omitted -->æŒ‡å®šèŒƒå›´<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>with</code><!-- raw HTML omitted -->å¯ä»¥ç”¨æ¥æ§åˆ¶å˜é‡ä½œç”¨åŸŸ<!-- raw HTML omitted --></li>
<li>å‰é¢æˆ‘ä»¬ä½¿ç”¨<code>{{ .Release.xxx }}</code>æˆ–è€…<code>{{ .Values.xxx }}</code>ï¼Œå…¶ä¸­.å°±æ˜¯è¡¨ç¤ºå¯¹å½“å‰èŒƒå›´çš„å¼•ç”¨ï¼Œ<code>.values</code>å°±æ˜¯å‘Šè¯‰æ¨¡æ¿åœ¨å½“å‰èŒƒå›´ä¸­æŸ¥æ‰¾Valueså¯¹è±¡çš„å€¼</li>
<li><code>with</code><!-- raw HTML omitted -->è¯­å¥å°±å¯ä»¥ç”¨æ¥æ§åˆ¶å˜é‡çš„ä½œç”¨åŸŸèŒƒå›´ï¼Œå…¶è¯­æ³•å’Œä¸€ä¸ªç®€å•çš„ifè¯­å¥ç±»ä¼¼ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{ <span style="color:#ae81ff">with æ¡ä»¶è¡¨è¾¾å¼ }}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># xxx</span>
</span></span><span style="display:flex;"><span>{{ <span style="color:#ae81ff">end }}</span></span></span></code></pre></div><ul>
<li><code>with</code><!-- raw HTML omitted -->è¯­å¥å¯ä»¥å…è®¸å°†å½“å‰èŒƒå›´çš„.è®¾ç½®ä¸ºç‰¹å®šçš„å¯¹è±¡ï¼Œæ¯”å¦‚æˆ‘ä»¬å‰é¢ä¸€ç›´ä½¿ç”¨çš„<code>.Values.label</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨withæ¥å°†.èŒƒå›´æŒ‡å‘<!-- raw HTML omitted --><code>.Values.label</code>ç¤ºä¾‹ï¼š<code>values.yaml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">nodeSelector</span>: 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">team</span>: <span style="color:#ae81ff">a </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gpu</span>:   <span style="color:#66d9ef">yes</span></span></span></code></pre></div><ul>
<li><code>deployment.yaml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>:   <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>:   <span style="color:#ae81ff">Deployment </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Release.Name }}-deployment </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>: 
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">template</span>: 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>: 
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            {{- <span style="color:#ae81ff">with .Values.nodeSelector }}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">nodeSelector</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">team</span>: {{  <span style="color:#ae81ff">.team }}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">gpu</span>: {{  <span style="color:#ae81ff">.gpu  }}</span>
</span></span><span style="display:flex;"><span>            {{- <span style="color:#ae81ff">end }}</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="å‘½åæ¨¡æ¿">å‘½åæ¨¡æ¿</h2>
<ul>
<li>
<ol>
<li>éœ€è¦å¤ç”¨ä»£ç çš„åœ°æ–¹å¯ä»¥ä½¿ç”¨å‘½åæ¨¡æ¿</li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å‘½åæ¨¡æ¿ï¼š<!-- raw HTML omitted -->ä½¿ç”¨<code>define</code>å®šä¹‰ï¼Œ<code>template</code>å¼•å…¥ï¼Œåœ¨<code>templates</code>ç›®å½•ä¸­é»˜è®¤ä¸‹åˆ’çº¿å¼€å¤´çš„æ–‡ä»¶ä¸ºå…¬å…±æ¨¡æ¿,æ¯”å¦‚ï¼š<code>_helpers.tpl</code>ã€‚</li>
</ol>
</li>
<li>
<ol start="3">
<li>ç¤ºä¾‹ï¼š<code> _helpers.tpl</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{-   <span style="color:#ae81ff">define   &#34;demo.fullname&#34;   -}}</span>
</span></span><span style="display:flex;"><span>{{- <span style="color:#ae81ff">.Chart.Name -}}-{{ .Release.Name }}</span>
</span></span><span style="display:flex;"><span>{{-   <span style="color:#ae81ff">end   -}}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>deployment.yaml</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>:   <span style="color:#ae81ff">apps/v1 </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>:   <span style="color:#ae81ff">Deployment </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>:  {{   <span style="color:#ae81ff">template&#34;demo.fullname&#34;   .    }}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å…¶ä»–ç•¥</span></span></span></code></pre></div><ul>
<li><code>template</code><!-- raw HTML omitted -->æŒ‡ä»¤æ˜¯å°†ä¸€ä¸ªæ¨¡æ¿åŒ…å«åœ¨å¦ä¸€ä¸ªæ¨¡æ¿ä¸­çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œ<code>template</code>å‡½æ•°ä¸èƒ½ç”¨äº<code>Go</code>æ¨¡æ¿ç®¡é“ï¼Œä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œå¢åŠ äº†<code>include</code>åŠŸèƒ½<!-- raw HTML omitted --></li>
<li><code>_helpers.tplï¼š</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{-   <span style="color:#ae81ff">define   &#34;demo.labels&#34;    -}}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">app</span>:   {{   <span style="color:#ae81ff">template&#34;demo.fullname&#34;   .   }}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">chart</span>:   <span style="color:#e6db74">&#34;{{   .Chart.Name   }}-{{    .Chart.Version   }}&#34;</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">release</span>:   <span style="color:#e6db74">&#34;{{   .Release.Name   }}&#34;</span>
</span></span><span style="display:flex;"><span>{{-   <span style="color:#ae81ff">end   -}}</span></span></span></code></pre></div><ul>
<li>4.3 <code>deployment.yaml</code></li>
</ul>
<blockquote>
<p>ä¸‹é¢åŒ…å«ä¸€ä¸ªåä¸º<code>demo.labels</code>çš„æ¨¡æ¿ï¼Œç„¶åå°†å€¼  . ä¼ é€’ç»™æ¨¡æ¿ï¼Œæœ€åå°†è¯¥æ¨¡æ¿çš„ è¾“å‡ºä¼ é€’ç»™<code>nindent</code>å‡½æ•°ã€‚</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>:   <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>:   <span style="color:#ae81ff">Deployment </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>:    {{   <span style="color:#ae81ff">include&#34;demo.fullname&#34;   .    }} </span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        {{-   <span style="color:#ae81ff">include   &#34;demo.labels&#34;   .    |   nindent   4    }}</span>
</span></span><span style="display:flex;"><span>...</span></span></code></pre></div></blockquote>
</blockquote>

<pre class="mermaid align-center zoomable">graph LR
A(åˆ›å»ºæ¨¡æ¿) --&gt;B(ä¿®æ”¹Chart.yaml Values.yamlæ–‡ä»¶&lt;br&gt;æ·»åŠ å¸¸ç”¨å˜é‡&lt;br&gt;)
    B --&gt; C(åœ¨Templatesç›®å½•ä¸‹åˆ›å»ºéƒ¨ç½²é•œåƒæ‰€éœ€çš„yamlæ–‡ä»¶&lt;br&gt;å¹¶ä¸”ä½¿ç”¨å˜é‡&lt;br&gt;å¼•ç”¨yamlæ–‡ä»¶é‡Œé¢çš„å¸¸å˜åŠ¨å­—æ®µ&lt;br&gt;)
    
    C --&gt;|a=1| D{æš‚æœªå¯ç”¨}
    C --&gt;|a=2| E[æš‚æœªå¯ç”¨]
    F[å¼€å‘è‡ªå·±çš„chart]</pre><hr>
<h2 id="ä½¿ç”¨helmå®‰è£…jenkins">ä½¿ç”¨<code>Helm</code>å®‰è£…<code>Jenkins</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è·å–æ›´æ–°ä»“åº“ä¿¡æ¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo add jenkins https://charts.jenkins.io
</span></span><span style="display:flex;"><span>$ helm repo update</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->æŸ¥çœ‹å·²ç»æ·»åŠ çš„<!-- raw HTML omitted --><code>helm</code><!-- raw HTML omitted -->ä»“åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo list</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æœç´¢ä»“åº“ä¸­çš„<!-- raw HTML omitted --><code>Jenkins</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm search repo jenkins
</span></span><span style="display:flex;"><span>NAME           	CHART VERSION	APP VERSION	DESCRIPTION                                       
</span></span><span style="display:flex;"><span>jenkins/jenkins	4.2.5        	2.361.1    	Jenkins - Build great things at any scale! The ...</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted --> æŸ¥çœ‹ã€ä¸‹è½½<!-- raw HTML omitted --><code>Jenkins</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm show values jenkins/jenkins
</span></span><span style="display:flex;"><span>$ helm pull jenkins/jenkins  	<span style="color:#75715e"># ä¸‹è½½ Jenkins å®‰è£…åŒ…</span>
</span></span><span style="display:flex;"><span>$ tar -zxvf jenkins-3.5.9.tgz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i -e <span style="color:#e6db74">&#39;/#/d;/^$/d&#39;</span> values.yaml  	<span style="color:#75715e"># å»æ‰æ³¨é‡Šå’Œç©ºè¡Œåä¿®æ”¹</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å®‰è£…ä»¥åŠæŸ¥çœ‹ç™»å½•åå’Œå¯†ç <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install jenkins ./jenkins
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ç™»å½•çš„ç”¨æˆ·å</span>
</span></span><span style="display:flex;"><span>$  kubectl exec jenkins-0 -- cat /run/secrets/chart-admin-username
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ç™»å½•çš„å¯†ç </span>
</span></span><span style="display:flex;"><span>$  kubectl exec jenkins-0 -- cat /run/secrets/chart-admin-password</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ä½¿ç”¨helmå®‰è£…redis">ä½¿ç”¨<code>Helm</code>å®‰è£…<code>Redis</code></h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ <!-- raw HTML omitted --><code>Bitnami</code><!-- raw HTML omitted -->ä»“åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo add bitnami https://charts.bitnami.com/bitnami
</span></span><span style="display:flex;"><span>$ helm repo list
</span></span><span style="display:flex;"><span>$ helm search repo redis</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¸‹è½½ã€é…ç½®å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm pull bitnami/redis
</span></span><span style="display:flex;"><span>$ tar xvf redis-18.8.0.tgz</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>values.yaml</code></li>
</ul>
<blockquote>
<ul>
<li><code>StorageClass</code><!-- raw HTML omitted -->çš„åå­—ï¼Œå¦‚æœ<!-- raw HTML omitted --><code>storageClass</code><!-- raw HTML omitted -->ä¸æ­£å¸¸ï¼Œ<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->å¯åŠ¨ä¸äº†<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">global</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">imageRegistry</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">imagePullSecrets</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClass</span>: <span style="color:#e6db74">&#34;nfs-storage-template&#34;</span>    <span style="color:#75715e"># StorageClass çš„åå­—ï¼Œå¦‚æœstorageClassä¸æ­£å¸¸ï¼Œrediså¯åŠ¨ä¸äº†</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">redis</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">password</span>: <span style="color:#e6db74">&#34;Password&#34;</span>    <span style="color:#75715e"># redis è¿æ¥å¯†ç </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kubeVersion</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">nameOverride</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">fullnameOverride</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">namespaceOverride</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">commonLabels</span>: {}
</span></span><span style="display:flex;"><span><span style="color:#f92672">commonAnnotations</span>: {}
</span></span><span style="display:flex;"><span><span style="color:#f92672">secretAnnotations</span>: {}
</span></span><span style="display:flex;"><span><span style="color:#f92672">clusterDomain</span>: <span style="color:#ae81ff">cluster.local</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">extraDeploy</span>: []
</span></span><span style="display:flex;"><span><span style="color:#f92672">useHostnames</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">nameResolutionThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">nameResolutionTimeout</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">diagnosticMode</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">sleep</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">args</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">infinity</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">registry</span>: <span style="color:#ae81ff">docker.io</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">repository</span>: <span style="color:#ae81ff">bitnami/redis</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">7.2.4</span>-<span style="color:#ae81ff">debian-11-r2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">digest</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pullSecrets</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">debug</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">architecture</span>: <span style="color:#ae81ff">replication  </span> <span style="color:#75715e"># standalone:å•èŠ‚ç‚¹éƒ¨ç½²ï¼Œreplicationï¼šä¸€ä¸»ä¸‰ä»é…ç½®</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">auth</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sentinel</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">existingSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">existingSecretPasswordKey</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">usePasswordFiles</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">commonConfiguration</span>: |-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  appendonly yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  save &#34;&#34;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">existingConfigmap</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">master</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">count</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">configuration</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">disableCommands</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">FLUSHDB</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">FLUSHALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">args</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enableServiceLinks</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">preExecCmds</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraFlags</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVars</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVarsCM</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVarsSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerPorts</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">redis</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">startupProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">readinessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customStartupProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customLivenessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customReadinessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">limits</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">fsGroupChangePolicy</span>: <span style="color:#ae81ff">Always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sysctls</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">supplementalGroups</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">fsGroup</span>: <span style="color:#ae81ff">1001</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seLinuxOptions</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsUser</span>: <span style="color:#ae81ff">1001</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsGroup</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsNonRoot</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">allowPrivilegeEscalation</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seccompProfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RuntimeDefault</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">capabilities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">drop</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">ALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StatefulSet</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schedulerName</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">updateStrategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">minReadySeconds</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">priorityClassName</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">automountServiceAccountToken</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hostAliases</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podLabels</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAnnotations</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">shareProcessNamespace</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAffinityPreset</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAntiAffinityPreset</span>: <span style="color:#ae81ff">soft</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeAffinityPreset</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">values</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeSelector</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tolerations</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">topologySpreadConstraints</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dnsPolicy</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dnsConfig</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">lifecycleHooks</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumes</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumeMounts</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sidecars</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">initContainers</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistence</span>:    <span style="color:#75715e"># æŒä¹…åŒ–é…ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>   <span style="color:#75715e"># é»˜è®¤å¯ç”¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">medium</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sizeLimit</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/data  </span> <span style="color:#75715e"># å­˜å‚¨ç›®å½•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subPath</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subPathExpr</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">size</span>: <span style="color:#ae81ff">2Gi  </span> <span style="color:#75715e"># Master ä¸»èŠ‚ç‚¹é»˜è®¤ä½¿ç”¨ç©ºé—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">dataSource</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">existingClaim</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeClaimRetentionPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">whenScaled</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">whenDeleted</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">service</span>:    <span style="color:#75715e"># æœåŠ¡ç«¯å£é…ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodePorts</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">externalTrafficPolicy</span>: <span style="color:#ae81ff">Cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">extraPorts</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">internalTrafficPolicy</span>: <span style="color:#ae81ff">Cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">clusterIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerSourceRanges</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">externalIPs</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sessionAffinity</span>: <span style="color:#ae81ff">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sessionAffinityConfig</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceAccount</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">create</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">automountServiceAccountToken</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">replica</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StatefulSet</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicaCount</span>: <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># ä»èŠ‚ç‚¹å‰¯æœ¬æ•°é‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">configuration</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">disableCommands</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">FLUSHDB</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">FLUSHALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">args</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enableServiceLinks</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">preExecCmds</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraFlags</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVars</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVarsCM</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVarsSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">externalMaster</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">host</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerPorts</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">redis</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">startupProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">readinessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customStartupProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customLivenessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customReadinessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">limits</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   cpu: 250m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   memory: 256Mi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   cpu: 250m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   memory: 256Mi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">fsGroupChangePolicy</span>: <span style="color:#ae81ff">Always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sysctls</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">supplementalGroups</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">fsGroup</span>: <span style="color:#ae81ff">1001</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seLinuxOptions</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsUser</span>: <span style="color:#ae81ff">1001</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsGroup</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsNonRoot</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">allowPrivilegeEscalation</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seccompProfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RuntimeDefault</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">capabilities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">drop</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">ALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schedulerName</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">updateStrategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">minReadySeconds</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">priorityClassName</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podManagementPolicy</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">automountServiceAccountToken</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hostAliases</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podLabels</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAnnotations</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">shareProcessNamespace</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAffinityPreset</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAntiAffinityPreset</span>: <span style="color:#ae81ff">soft</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeAffinityPreset</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">values</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeSelector</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tolerations</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">topologySpreadConstraints</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dnsPolicy</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dnsConfig</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">lifecycleHooks</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumes</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumeMounts</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sidecars</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">initContainers</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistence</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">medium</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sizeLimit</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subPath</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subPathExpr</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">size</span>: <span style="color:#ae81ff">2Gi  	# ä»èŠ‚ç‚¹ä½¿ç”¨ç£ç›˜ç©ºé—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">dataSource</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">existingClaim</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeClaimRetentionPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">whenScaled</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">whenDeleted</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodePorts</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">externalTrafficPolicy</span>: <span style="color:#ae81ff">Cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">internalTrafficPolicy</span>: <span style="color:#ae81ff">Cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">extraPorts</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">clusterIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerSourceRanges</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sessionAffinity</span>: <span style="color:#ae81ff">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sessionAffinityConfig</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">autoscaling</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">minReplicas</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">maxReplicas</span>: <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetCPU</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetMemory</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceAccount</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">create</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">automountServiceAccountToken</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">sentinel</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">registry</span>: <span style="color:#ae81ff">docker.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">repository</span>: <span style="color:#ae81ff">bitnami/redis-sentinel</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">7.2.4</span>-<span style="color:#ae81ff">debian-11-r3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">digest</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullSecrets</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">debug</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">masterSet</span>: <span style="color:#ae81ff">mymaster</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">quorum</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">getMasterTimeout</span>: <span style="color:#ae81ff">90</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">automateClusterRecovery</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">redisShutdownWaitFailover</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">downAfterMilliseconds</span>: <span style="color:#ae81ff">60000</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">failoverTimeout</span>: <span style="color:#ae81ff">180000</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">parallelSyncs</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">configuration</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">args</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enableServiceLinks</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">preExecCmds</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVars</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVarsCM</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVarsSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">externalMaster</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">host</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerPorts</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sentinel</span>: <span style="color:#ae81ff">26379</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">startupProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">readinessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customStartupProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customLivenessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customReadinessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistence</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">size</span>: <span style="color:#ae81ff">100Mi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">dataSource</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">medium</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sizeLimit</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeClaimRetentionPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">whenScaled</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">whenDeleted</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">limits</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seLinuxOptions</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsUser</span>: <span style="color:#ae81ff">1001</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsGroup</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsNonRoot</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">allowPrivilegeEscalation</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seccompProfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RuntimeDefault</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">capabilities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">drop</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">ALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">lifecycleHooks</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumes</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumeMounts</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">sentinel</span>: <span style="color:#ae81ff">26379</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodePorts</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">sentinel</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">externalTrafficPolicy</span>: <span style="color:#ae81ff">Cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">extraPorts</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">clusterIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerSourceRanges</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sessionAffinity</span>: <span style="color:#ae81ff">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sessionAffinityConfig</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">headless</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">serviceBindings</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">networkPolicy</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">allowExternal</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraIngress</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEgress</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ingressNSMatchLabels</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ingressNSPodMatchLabels</span>: {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">metrics</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">allowExternal</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ingressNSMatchLabels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ingressNSPodMatchLabels</span>: {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">podSecurityPolicy</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">create</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rbac</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">create</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rules</span>: []
</span></span><span style="display:flex;"><span><span style="color:#f92672">serviceAccount</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">create</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">automountServiceAccountToken</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span><span style="color:#f92672">pdb</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">create</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">minAvailable</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">maxUnavailable</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">tls</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">authClients</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">autoGenerated</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">existingSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">certificatesSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">certFilename</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">certKeyFilename</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">certCAFilename</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dhParamsFilename</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metrics</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">registry</span>: <span style="color:#ae81ff">docker.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">repository</span>: <span style="color:#ae81ff">bitnami/redis-exporter</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">1.56.0</span>-<span style="color:#ae81ff">debian-11-r1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">digest</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullSecrets</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">startupProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">readinessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customStartupProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customLivenessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customReadinessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">redisTargetHost</span>: <span style="color:#e6db74">&#34;localhost&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraArgs</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVars</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seLinuxOptions</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsUser</span>: <span style="color:#ae81ff">1001</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsGroup</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsNonRoot</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">allowPrivilegeEscalation</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seccompProfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RuntimeDefault</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">capabilities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">drop</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">ALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumes</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumeMounts</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">limits</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podLabels</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAnnotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">prometheus.io/scrape</span>: <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">prometheus.io/port</span>: <span style="color:#e6db74">&#34;9121&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">9121</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">externalTrafficPolicy</span>: <span style="color:#ae81ff">Cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">extraPorts</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerSourceRanges</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">clusterIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceMonitor</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">30s</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">scrapeTimeout</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">relabellings</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metricRelabelings</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">honorLabels</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">additionalLabels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">podTargetLabels</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sampleLimit</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetLimit</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podMonitor</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">30s</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">scrapeTimeout</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">relabellings</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metricRelabelings</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">honorLabels</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">additionalLabels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">podTargetLabels</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sampleLimit</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetLimit</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">prometheusRule</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">additionalLabels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rules</span>: []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">volumePermissions</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">registry</span>: <span style="color:#ae81ff">docker.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">repository</span>: <span style="color:#ae81ff">bitnami/os-shell</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">11</span>-<span style="color:#ae81ff">debian-11-r94</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">digest</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullSecrets</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">limits</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seLinuxOptions</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsUser</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">sysctl</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">registry</span>: <span style="color:#ae81ff">docker.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">repository</span>: <span style="color:#ae81ff">bitnami/os-shell</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">11</span>-<span style="color:#ae81ff">debian-11-r94</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">digest</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullSecrets</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mountHostSys</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">limits</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>: {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">useExternalDNS</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">suffix</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotationKey</span>: <span style="color:#ae81ff">external-dns.alpha.kubernetes.io/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">additionalAnnotations</span>: {}</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Redis</code><!-- raw HTML omitted -->å½¢æˆ<!-- raw HTML omitted --><code>Release</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install release-name project-dir -n namespace
</span></span><span style="display:flex;"><span>$ helm install redis ./redis/ -n default</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç™»å½•<!-- raw HTML omitted --><code>Redis</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl exec --tty -i redis-master-0 --namespace default -- bash
</span></span><span style="display:flex;"><span>$ kubectl exec --tty -i redis-replicas-1 --namespace default -- bash</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å‡çº§<!-- raw HTML omitted --><code>Redis</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm upgrade redis ./redis/ -n default</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ä½¿ç”¨helmå®‰è£…prometheus">ä½¿ç”¨<code>Helm</code>å®‰è£…<code>Prometheus</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/prometheus-operator/kube-prometheus" rel="external" target="_self"><code>kube-prometheus</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="ä½¿ç”¨helmå®‰è£…elk">ä½¿ç”¨<code>Helm</code>å®‰è£…<code>ELK</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_k8s_auth">Configure_K8s_Auth</h1>

<h2 id="å®‰å…¨æ§åˆ¶">å®‰å…¨æ§åˆ¶</h2>
<h3 id="è®¿é—®æ§åˆ¶">è®¿é—®æ§åˆ¶</h3>
<ul>
<li>
<ol>
<li><code>kubernetes</code>ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤çš„ç®¡ç†å·¥å…·ï¼Œä¿è¯é›†ç¾¤çš„å®‰å…¨æ€§æ˜¯å…¶ä¸€ä¸ªé‡è¦çš„ä»»åŠ¡ã€‚æ‰€è°“çš„å®‰å…¨æ€§å…¶å®å°±æ˜¯ä¿è¯å¯¹<code>kubernetes</code>çš„å„ç§å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯å’Œæˆæƒæ“ä½œ</li>
</ol>
</li>
<li>
<ol start="2">
<li>åœ¨<code>kubernetes</code>é›†ç¾¤ä¸­ï¼Œå®¢æˆ·ç«¯é€šå¸¸ç”±ä¸¤ç±»ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>User Account</code><!-- raw HTML omitted -->ï¼šä¸€èˆ¬æ˜¯ç‹¬ç«‹äº<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->ä¹‹å¤–çš„å…¶ä»–æœåŠ¡ç®¡ç†çš„ç”¨æˆ·è´¦å·<!-- raw HTML omitted --></li>
<li><code>Service Account</code>ï¼š<code>kubernetes</code><!-- raw HTML omitted -->ç®¡ç†çš„è´¦å·ï¼Œç”¨äºä¸º<!-- raw HTML omitted --><code>Pod</code><!-- raw HTML omitted -->çš„æœåŠ¡è¿›ç¨‹åœ¨è®¿é—®<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->æ—¶æä¾›èº«ä»½æ ‡è¯†<!-- raw HTML omitted --></li>
</ul>

<pre class="mermaid align-center zoomable">graph LR
C1((ç”¨æˆ·)) --&gt; B1(User&lt;br&gt;Account) --&gt; A((Kubernetes))
C2((Pod)) --&gt; B2(Service&lt;br&gt;Account) --&gt; A((Kubernetes))</pre></blockquote>
<hr>
<h3 id="è®¤è¯æˆæƒå’Œå‡†å…¥æ§åˆ¶">è®¤è¯ã€æˆæƒå’Œå‡†å…¥æ§åˆ¶</h3>
<ul>
<li>
<ol>
<li><code>API Server</code><!-- raw HTML omitted -->æ˜¯è®¿é—®å’Œç®¡ç†èµ„æºå¯¹è±¡çš„å”¯ä¸€å…¥å£ã€‚ä»»ä½•ä¸€ä¸ªè¯·æ±‚è®¿é—®<!-- raw HTML omitted --><code>API Server</code>ï¼Œ<!-- raw HTML omitted -->éƒ½è¦ç»è¿‡ä¸‹é¢çš„ä¸‰ä¸ªæµç¨‹ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Authentication</code>(è®¤è¯)<!-- raw HTML omitted -->ï¼šèº«ä»½é‰´åˆ«ï¼Œåªæœ‰æ­£ç¡®çš„è´¦å·æ‰èƒ½é€šè¿‡è®¤è¯<!-- raw HTML omitted --></li>
<li><code>Authorization</code>(æˆæƒ)<!-- raw HTML omitted -->ï¼šæƒé™é‰´åˆ«ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å¯¹è®¿é—®çš„èµ„æºæ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œ<!-- raw HTML omitted --></li>
<li><code>Admission Control</code>(å‡†å…¥æ§åˆ¶)<!-- raw HTML omitted -->ï¼šç²¾ç»†è®¿é—®æ§åˆ¶ï¼Œç”¨äºè¡¥å……æˆæƒæœºåˆ¶ä»¥å®ç°æ›´åŠ ç²¾ç»†çš„è®¿é—®æ§åˆ¶åŠŸèƒ½<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->éœ€è¦æ³¨æ„ï¼š<!-- raw HTML omitted -->åœ¨<code>Kubernetes</code>ä¸­ä¸èƒ½é€šè¿‡<code>API</code>è°ƒç”¨å°†æ™®é€šç”¨æˆ·æ·»åŠ åˆ°é›†ç¾¤ä¸­</li>
</ul>
<blockquote>
<ul>
<li>æ™®é€šè´¦æˆ·æ˜¯é’ˆå¯¹ï¼ˆäººï¼‰ç”¨æˆ·çš„ï¼ŒæœåŠ¡è´¦æˆ·é’ˆå¯¹<code>Pods</code>è¿›ç¨‹</li>
<li>æ™®é€šè´¦æˆ·æ˜¯å…¨å±€æ€§ï¼Œåœ¨é›†ç¾¤æ‰€æœ‰<code>namespaces</code>ä¸­ï¼Œåç§°å…·æœ‰å”¯ä¸€æ€§</li>
<li>é€šå¸¸ï¼Œé›†ç¾¤çš„æ™®é€šè´¦æˆ·å¯ä»¥ä¸ä¼ä¸šæ•°æ®åº“åŒæ­¥ï¼Œæ–°çš„æ™®é€šè´¦æˆ·åˆ›å»ºéœ€è¦ç‰¹æ®Šæƒé™ï¼ŒæœåŠ¡è´¦æˆ·åˆ›å»ºç›®çš„æ˜¯æ›´è½»é‡åŒ–ï¼Œå…è®¸é›†ç¾¤ç”¨æˆ·ä¸ºç‰¹å®šä»»åŠ¡åˆ›å»ºæœåŠ¡è´¦æˆ·</li>
<li>æ™®é€šè´¦æˆ·å’ŒæœåŠ¡è´¦æˆ·çš„å®¡æ ¸æ³¨æ„äº‹é¡¹ä¸åŒ</li>
<li>å¯¹äºå¤æ‚ç³»ç»Ÿçš„é…ç½®åŒ…ï¼Œå¯ä»¥åŒ…æ‹¬å¯¹è¯¥ç³»ç»Ÿçš„å„ç§ç»„ä»¶çš„æœåŠ¡è´¦æˆ·çš„å®šä¹‰</li>
</ul>
</blockquote>

<pre class="mermaid align-center zoomable">graph LR
A((è¯·æ±‚)) --&gt; B[Authentication&lt;br&gt;è®¤è¯&lt;br&gt;èº«ä»½é‰´åˆ«&lt;br&gt;] --&gt; C[Authorization&lt;br&gt;æˆæƒ&lt;br&gt;æƒé™é‰´åˆ«&lt;br&gt;] --&gt; D[Admission Control&lt;br&gt;æ³¨å…¥æ§åˆ¶&lt;br&gt;ç²¾ç»†è®¿é—®æ§åˆ¶&lt;br&gt;] --&gt; E((Kubernetes&lt;br&gt;èµ„æº))</pre></blockquote>
<hr>
<h4 id="è®¤è¯ç®¡ç†">è®¤è¯ç®¡ç†</h4>
<h5 id="user-accountsæ™®é€šè´¦æˆ·"><code>User Accounts</code>(æ™®é€šè´¦æˆ·)</h5>
<hr>
<h5 id="service-accountsæœåŠ¡è´¦æˆ·"><code>Service Accounts</code>(æœåŠ¡è´¦æˆ·)</h5>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount   </span> <span style="color:#75715e"># æƒé™ç®¡ç†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span></span></span></code></pre></div></blockquote>
<hr>
<h5 id="kubernetesfont-colorredçš„å®¢æˆ·ç«¯fonthttpfont-colorredå’Œfonthttpsfont-colorredèº«ä»½è®¤è¯æ–¹å¼font"><code>kubernetes</code><!-- raw HTML omitted -->çš„å®¢æˆ·ç«¯<!-- raw HTML omitted --><code>http</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>https</code><!-- raw HTML omitted -->èº«ä»½è®¤è¯æ–¹å¼<!-- raw HTML omitted --></h5>
<ul>
<li>
<ol>
<li><code>kubernetes</code><!-- raw HTML omitted -->å…è®¸åŒæ—¶é…ç½®å¤šç§è®¤è¯æ–¹å¼ï¼Œ<!-- raw HTML omitted -->åªè¦å…¶ä¸­ä»»æ„ä¸€ç§æ–¹å¼è®¤è¯é€šè¿‡å³å¯</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>kubernetes</code>é›†ç¾¤å®‰å…¨çš„å…³é”®ç‚¹åœ¨äºå¦‚ä½•è¯†åˆ«å¹¶è®¤è¯å®¢æˆ·ç«¯èº«ä»½ï¼Œå®ƒæä¾›äº†<code>3</code>ç§å®¢æˆ·ç«¯èº«ä»½è®¤è¯æ–¹å¼</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>2.1 <code>HTTP Base</code><!-- raw HTML omitted -->è®¤è¯ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é€šè¿‡ç”¨æˆ·å+å¯†ç çš„æ–¹å¼è¿›è¡Œè®¤è¯ï¼Œ<!-- raw HTML omitted -->è¿™ç§æ–¹å¼æ˜¯æŠŠ<code>ç”¨æˆ·å:å¯†ç </code>ç”¨<code>BASE64</code>ç®—æ³•è¿›è¡Œç¼–ç åçš„å­—ç¬¦ä¸²æ”¾åœ¨<code>HTTP</code>è¯·æ±‚ä¸­çš„<code>Header</code>çš„<code>Authorization</code>åŸŸé‡Œé¢å‘é€ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯æ”¶åˆ°åè¿›è¡Œè§£ç ï¼Œè·å–ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹</li>
</ul>
</blockquote>
<ul>
<li>2.2 <code>HTTP Token</code><!-- raw HTML omitted -->è®¤è¯ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é€šè¿‡ä¸€ä¸ª<code>Token</code>æ¥è¯†åˆ«åˆæ³•ç”¨æˆ·ï¼Œ<!-- raw HTML omitted -->è¿™ç§è®¤è¯æ–¹å¼æ˜¯ç”¨ä¸€ä¸ªå¾ˆé•¿çš„éš¾ä»¥è¢«æ¨¡ä»¿çš„å­—ç¬¦ä¸²<code>--Token</code>æ¥è¡¨æ˜å®¢æˆ·ç«¯èº«ä»½çš„ä¸€ç§æ–¹å¼ã€‚æ¯ä¸ª<code>Token</code>å¯¹åº”ä¸€ä¸ªç”¨æˆ·åï¼Œå½“å®¢æˆ·ç«¯å‘èµ·<code>API</code>è°ƒç”¨è¯·æ±‚çš„æ—¶å€™ï¼Œéœ€è¦åœ¨<code>HTTP</code>çš„<code>Header</code>ä¸­æ”¾å…¥<code>Token</code>ï¼Œ<code>API Server</code>æ¥å—åˆ°<code>Token</code>åä¼šå’ŒæœåŠ¡å™¨ä¸­ä¿å­˜çš„<code>Token</code>è¿›è¡Œæ¯”å¯¹ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚</li>
</ul>
</blockquote>
<ul>
<li>2.3 <code>HTTPS</code><!-- raw HTML omitted -->è¯ä¹¦è®¤è¯ï¼š <!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åŸºäº<code>CA</code>æ ¹è¯ä¹¦ç­¾åçš„åŒå‘æ•°å­—è¯ä¹¦è®¤è¯æ–¹å¼ï¼Œ<!-- raw HTML omitted -->è¿™ç§è®¤è¯æ–¹å¼æ˜¯å®‰å…¨æ€§æœ€é«˜çš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿæ˜¯æ“ä½œèµ·æ¥æœ€éº»çƒ¦çš„ä¸€ç§æ–¹å¼</li>
<li><!-- raw HTML omitted -->è¯ä¹¦ç”³è¯·å’Œä¸‹å‘ï¼š<!-- raw HTML omitted --><code>HTTPS</code>é€šä¿¡åŒæ–¹çš„æœåŠ¡å™¨å‘<code>CA</code>æœºæ„ç”³è¯·è¯ä¹¦ï¼Œ<code>CA</code>æœºæ„å‘æ ¹è¯ä¹¦ã€æœåŠ¡ç«¯è¯ä¹¦åŠç§é’¥ç»™ç”³è¯·è€…</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„åŒå‘è®¤è¯<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚ï¼Œ<!-- raw HTML omitted -->æœåŠ¡ç«¯ä¸‹å‘è‡ªå·±çš„è¯ä¹¦ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ï¼Œåœ¨è¯ä¹¦ä¸­è·å–æœåŠ¡ç«¯çš„ç§é’¥ã€‚å®¢æˆ·ç«¯åˆ©ç”¨æœåŠ¡å™¨ç«¯çš„å…¬é’¥è®¤è¯è¯ä¹¦ä¸­çš„ä¿¡æ¯ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™è®¤å¯è¿™ä¸ªæœåŠ¡å™¨ã€‚</li>
<li><!-- raw HTML omitted -->å®¢æˆ·ç«¯å‘é€è‡ªå·±çš„è¯ä¹¦ç»™æœåŠ¡å™¨ç«¯ï¼Œ<!-- raw HTML omitted -->æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ã€‚åœ¨è¯ä¹¦ä¸­è·å–å®¢æˆ·ç«¯çš„å…¬é’¥ï¼Œå¹¶ç”¨è¯¥å…¬é’¥è®¤è¯è¯ä¹¦ä¿¡æ¯ï¼Œç¡®è®¤å®¢æˆ·ç«¯æ˜¯å¦åˆæ³•ã€‚</li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯åå•†å¥½åŠ å¯†æ–¹æ¡ˆåï¼Œå®¢æˆ·ç«¯ä¼šäº§ç”Ÿä¸€ä¸ªéšæœºçš„ç§é’¥å¹¶åŠ å¯†ï¼Œç„¶åå‘é€åˆ°æœåŠ¡å™¨ç«¯</li>
<li>æœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°è¿™ä¸ªç§é’¥åï¼ŒåŒæ–¹æ¥ä¸‹æ¥é€šä¿¡çš„æ‰€æœ‰å†…å®¹éƒ½é€šè¿‡è¯¥éšæœºç§é’¥åŠ å¯†</li>
</ul>
</blockquote>
</blockquote>

<pre class="mermaid align-center zoomable">graph TB
A((CAæœºæ„)) -- ç”³è¯·è¯ä¹¦ --&gt;B((æœåŠ¡ç«¯))
A((CAæœºæ„)) -- ç”³è¯·è¯ä¹¦ --&gt; C((å®¢æˆ·ç«¯))
B((æœåŠ¡ç«¯)) -- ä¸‹å‘è¯ä¹¦ --&gt; A((CAæœºæ„))
C((å®¢æˆ·ç«¯)) -- ä¸‹å‘è¯ä¹¦ --&gt; A((CAæœºæ„))

B((æœåŠ¡ç«¯)) &lt;-- åŒå‘èº«ä»½è®¤è¯ --&gt; C((å®¢æˆ·ç«¯))
B((æœåŠ¡ç«¯)) &lt;-- åŒå‘é€šä¿¡ --&gt; C((å®¢æˆ·ç«¯))</pre></blockquote>
<hr>
<h4 id="æˆæƒç®¡ç†">æˆæƒç®¡ç†</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æˆæƒå‘ç”Ÿåœ¨è®¤è¯æˆåŠŸä¹‹åï¼Œ<!-- raw HTML omitted -->é€šè¿‡è®¤è¯å°±å¯ä»¥çŸ¥é“è¯·æ±‚ç”¨æˆ·æ˜¯è°ï¼Œç„¶å<code>kubernetes</code>ä¼šæ ¹æ®äº‹å…ˆå®šä¹‰çš„æˆæƒç­–ç•¥æ¥å†³å®šç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºæˆæƒ</li>
</ol>
</li>
<li>
<ol start="2">
<li>æ¯ä¸ªå‘é€åˆ°<code>API Server</code>çš„è¯·æ±‚éƒ½å¸¦ä¸Šäº†ç”¨æˆ·å’Œèµ„æºçš„ä¿¡æ¯ï¼šæ¯”å¦‚å‘é€è¯·æ±‚çš„ç”¨æˆ·ã€è¯·æ±‚çš„è·¯å¾„ã€è¯·æ±‚çš„åŠ¨ä½œç­‰ï¼Œæˆæƒå°±æ˜¯æ ¹æ®è¿™äº›ä¿¡æ¯å’Œæˆæƒç­–ç•¥è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç¬¦åˆç­–ç•¥ï¼Œåˆ™è®¤ä¸ºæˆæƒé€šè¿‡ï¼Œå¦åˆ™ä¼šè¿”å›é”™è¯¯ã€‚</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>API Server</code>ç›®å‰æ”¯æŒçš„å‡ ç§æˆæƒç­–ç•¥</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>AlwaysDeny</code><!-- raw HTML omitted -->ï¼šè¡¨ç¤ºæ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•<!-- raw HTML omitted --></li>
<li><code>AlwaysAllow</code><!-- raw HTML omitted -->ï¼šå…è®¸æ¥æ”¶æ‰€æœ‰çš„è¯·æ±‚ï¼Œç›¸å½“äºé›†ç¾¤ä¸éœ€è¦æˆæƒæµç¨‹ï¼ˆ<code>kubernetes</code>é»˜è®¤çš„ç­–ç•¥ï¼‰<!-- raw HTML omitted --></li>
<li><code>ABAC</code><!-- raw HTML omitted -->ï¼šåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼Œè¡¨ç¤ºä½¿ç”¨ç”¨æˆ·é…ç½®çš„æˆæƒè§„åˆ™å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡ŒåŒ¹é…å’Œæ§åˆ¶<!-- raw HTML omitted --></li>
<li><code>Webhook</code><!-- raw HTML omitted -->ï¼šé€šè¿‡è°ƒç”¨å¤–éƒ¨<code>REST</code>æœåŠ¡å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒ<!-- raw HTML omitted --></li>
<li><code>Node</code><!-- raw HTML omitted -->ï¼šæ˜¯ä¸€ç§ä¸“ç”¨æ¨¡å¼ï¼Œç”¨äºå¯¹<code>kubelet</code>å‘å‡ºçš„è¯·æ±‚è¿›è¡Œè®¿é—®æ§åˆ¶<!-- raw HTML omitted --></li>
<li><code>RBAC</code><!-- raw HTML omitted -->ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆ<code>kubeadm</code>å®‰è£…æ–¹å¼ä¸‹çš„é»˜è®¤é€‰é¡¹ï¼‰<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h5 id="rbacåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶"><code>RBAC</code>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶</h5>
<blockquote>
<ul>
<li><code>RBAC</code><!-- raw HTML omitted -->åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶<!-- raw HTML omitted -->(<code>Role Based Access Control</code>)<!-- raw HTML omitted -->ä¸»è¦æ˜¯åœ¨æè¿°ä¸€ä»¶äº‹æƒ…ï¼šç»™å“ªäº›å¯¹è±¡æˆæƒäº†å“ªäº›æƒé™<!-- raw HTML omitted --></li>
<li><code>RBAC</code>æ¶‰åŠåˆ°äº†ä¸‹é¢å‡ ä¸ªæ¦‚å¿µï¼š</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯¹è±¡ï¼š<!-- raw HTML omitted --><code>User</code>ã€<code>Groups</code>ã€<code>ServiceAccount</code>ã€‚</li>
<li><!-- raw HTML omitted -->è§’è‰²ï¼š<!-- raw HTML omitted -->ä»£è¡¨ç€ä¸€ç»„å®šä¹‰åœ¨èµ„æºä¸Šçš„å¯æ“ä½œçš„åŠ¨ä½œï¼ˆæƒé™ï¼‰çš„é›†åˆ</li>
<li><!-- raw HTML omitted -->ç»‘å®šï¼š<!-- raw HTML omitted -->å°†å®šä¹‰å¥½çš„è§’è‰²å’Œç”¨æˆ·ç»‘å®šåœ¨ä¸€èµ·</li>
</ul>
</blockquote>
<ul>
<li><code>RBAC</code>å¼•å…¥çš„<code>4</code>ä¸ªé¡¶çº§èµ„æºå¯¹è±¡ï¼š</li>
</ul>
<blockquote>
<ul>
<li><code>Role</code>(è§’è‰²)<!-- raw HTML omitted -->ï¼Œç”¨äºæŒ‡å®šä¸€ç»„æƒé™<!-- raw HTML omitted --></li>
<li><code>ClusterRole</code>(é›†ç¾¤è§’è‰²)<!-- raw HTML omitted -->ï¼Œç”¨äºæŒ‡å®šä¸€ç»„æƒé™<!-- raw HTML omitted --></li>
<li><code>RoleBinding</code>(è§’è‰²ç»‘å®š)<!-- raw HTML omitted -->ï¼Œç”¨äºå°†è§’è‰²ï¼ˆæƒé™çš„é›†åˆï¼‰èµ‹äºˆç»™å¯¹è±¡<!-- raw HTML omitted --></li>
<li><code>ClusterRoleBinding</code>(é›†ç¾¤è§’è‰²ç»‘å®š)<!-- raw HTML omitted -->ï¼Œç”¨äºå°†è§’è‰²ï¼ˆæƒé™çš„é›†åˆï¼‰èµ‹äºˆç»™å¯¹è±¡<!-- raw HTML omitted --></li>
</ul>
</blockquote>

<pre class="mermaid align-center zoomable">graph TB
A1(Group) --- A[RoleBinding]
A2(User) --- A[RoleBinding]
A3(Service&lt;br&gt;Account) --- A[RoleBinding]

A[RoleBinding] --- B[Role]

B[Role] --- Pod --- |a=1|B1[List]
B[Role] --- Pod --- |a=2|B2[Get]
B[Role] --- Pod --- |a=3|B3[Watch]

B[Role] --- Deployment --- |b=1|B4[List]
B[Role] --- Deployment --- |b=2|B5[Get]
B[Role] --- Deployment --- |b=3|B6[Watch]</pre></blockquote>
<hr>
<h5 id="roleæ™®é€šè§’è‰²"><code>Role</code>(æ™®é€šè§’è‰²)</h5>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸€ä¸ªè§’è‰²å°±æ˜¯ä¸€ç»„æƒé™çš„é›†åˆï¼Œè¿™é‡Œçš„æƒé™éƒ½æ˜¯è®¸å¯å½¢å¼çš„ï¼ˆç™½åå•ï¼‰<!-- raw HTML omitted --></li>
<li><code>Role</code><!-- raw HTML omitted -->åªèƒ½å¯¹å‘½åç©ºé—´çš„èµ„æºè¿›è¡Œæˆæƒï¼Œéœ€è¦æŒ‡å®š<!-- raw HTML omitted --><code>namespace</code></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><code>rules:</code><!-- raw HTML omitted -->ä¸­çš„å‚æ•°è¯´æ˜ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain role.rules.resources  	<span style="color:#75715e"># æ˜¾ç¤º resources ä½¿ç”¨æ–¹å¼</span></span></span></code></pre></div><ul>
<li>1.1 <code>apiGroups:</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ”¯æŒçš„<!-- raw HTML omitted --><code>API</code><!-- raw HTML omitted -->ç»„åˆ—è¡¨ï¼Œ<!-- raw HTML omitted --><code>&quot;&quot;</code>,<code>&quot;apps&quot;</code>,<code>&quot;autoscaling</code>&quot;&quot;,<code>&quot;batch&quot;</code>ã€‚</li>
</ul>
</blockquote>
<ul>
<li>1.2 <code>resources:</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨ï¼Œ<!-- raw HTML omitted --><code>&quot;namespaces&quot;</code>,<code>&quot;services&quot;</code>,<code>&quot;endpoints&quot;</code>,<code>&quot;pods&quot;</code>,<code>&quot;secrets&quot;</code>,<code>&quot;configmaps&quot;</code>,<code>&quot;crontabs&quot;</code>,<code>&quot;deployments&quot;</code>,<code>&quot;jobs&quot;</code>,<code>&quot;nodes&quot;</code>,<code>&quot;rolebindings&quot;</code>,<code>&quot;clusterroles&quot;</code>,<code>&quot;daemonsets&quot;</code>,<code>&quot;replicasets&quot;</code>,<code>&quot;statefulsets&quot;</code>,<code>&quot;horizontalpodautoscalers&quot;</code>,<code>&quot;replicationcontrollers&quot;</code>,<code>&quot;cronjobs&quot;</code></li>
</ul>
</blockquote>
<ul>
<li>1.3 <code>verbs:</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯¹èµ„æºå¯¹è±¡çš„æ“ä½œæ–¹æ³•åˆ—è¡¨ï¼Œ<!-- raw HTML omitted --><code>&quot;get&quot;</code>,<code> &quot;list&quot;</code>,<code> &quot;watch&quot;</code>,<code> &quot;create&quot;</code>,<code> &quot;update&quot;</code>,<code> &quot;patch&quot;</code>, <code>&quot;delete&quot;</code>,<code>&quot;exec&quot;</code></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-role</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]  	<span style="color:#75715e"># æ”¯æŒçš„APIç»„åˆ—è¡¨ï¼Œ&#34;&#34;ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ ¸å¿ƒAPIç¾¤</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;pods&#34;</span>]  	<span style="color:#75715e"># æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>,<span style="color:#e6db74">&#34;watch&#34;</span>,<span style="color:#e6db74">&#34;list&#34;</span>]</span></span></code></pre></div></blockquote>
<hr>
<h5 id="rolebindingæ™®é€šè§’è‰²ç»‘å®š"><code>RoleBinding</code>(æ™®é€šè§’è‰²ç»‘å®š)</h5>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è§’è‰²ç»‘å®šç”¨æ¥æŠŠä¸€ä¸ªè§’è‰²ç»‘å®šåˆ°ä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¸Šï¼Œç»‘å®šç›®æ ‡å¯ä»¥æ˜¯<!-- raw HTML omitted --><code>User</code>ã€<code>Group</code>æˆ–è€…<code>ServiceAccount</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>RoleBinding</code>å¯ä»¥å°†åŒä¸€<code>namespace</code>ä¸­çš„<code>subject</code>å¯¹è±¡ç»‘å®šåˆ°æŸä¸ª<code>Role</code>ä¸‹ï¼Œåˆ™æ­¤<code>Subject</code>å…·æœ‰è¯¥<code>Role</code>å®šä¹‰çš„æƒé™</li>
<li><code>subjects:</code><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
<li><code>roleRef:</code><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">RoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-role-binding</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">User  	# Userï¼ŒGroupï¼ŒServiceAccoun  </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">user-name</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io  </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-role</span></span></span></code></pre></div></blockquote>
<hr>
<h5 id="clusterroleé›†ç¾¤è§’è‰²"><code>ClusterRole</code>(é›†ç¾¤è§’è‰²)</h5>
<ul>
<li>
<ol>
<li><code>ClusterRole</code><!-- raw HTML omitted -->å¯ä»¥å¯¹é›†ç¾¤èŒƒå›´å†…çš„èµ„æºã€è·¨<code>namespace</code>çš„èŒƒå›´èµ„æºã€éèµ„æºç±»å‹è¿›è¡Œæˆæƒ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-clusterrole</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]  	<span style="color:#75715e"># æ”¯æŒçš„APIç»„åˆ—è¡¨ï¼Œ&#34;&#34;ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ ¸å¿ƒAPIç¾¤</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;pods&#34;</span>]  	<span style="color:#75715e"># æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>,<span style="color:#e6db74">&#34;watch&#34;</span>,<span style="color:#e6db74">&#34;list&#34;</span>]</span></span></code></pre></div></blockquote>
<hr>
<h5 id="clusterrolebindingé›†ç¾¤è§’è‰²ç»‘å®š"><code>ClusterRoleBinding</code>(é›†ç¾¤è§’è‰²ç»‘å®š)</h5>
<blockquote>
<ul>
<li><code>ClusterRoleBinding</code>åœ¨æ•´ä¸ªé›†ç¾¤çº§åˆ«å’Œæ‰€æœ‰<code>namespaces</code>å°†ç‰¹å®šçš„<code>subject</code>ä¸<code>ClusterRole</code>ç»‘å®šï¼Œæˆäºˆæƒé™</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-clusterrole-binding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:  <span style="color:#75715e"># åº”ç”¨ä»€ä¹ˆç±»å‹çš„ä¸»ä½“  </span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">User  	# Userï¼ŒGroupï¼ŒServiceAccoun </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">user-name  	# å¯¹åº”çš„åå­—</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:  	<span style="color:#75715e"># è§’è‰²ç»‘å®š </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io  	# å¯¹åº”çš„Apiåˆ†ç»„  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole  	# è§’è‰²ç±»å‹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-clusterrole</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="å‡†å…¥æ§åˆ¶">å‡†å…¥æ§åˆ¶</h4>
<ul>
<li>
<ol>
<li>é€šè¿‡äº†å‰é¢çš„è®¤è¯å’Œæˆæƒä¹‹åï¼Œè¿˜éœ€è¦ç»è¿‡å‡†å…¥æ§åˆ¶é€šè¿‡ä¹‹åï¼Œ<code>API Server</code>æ‰ä¼šå¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li>å‡†å…¥æ§åˆ¶æ˜¯ä¸€ä¸ªå¯é…ç½®çš„æ§åˆ¶å™¨åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡åœ¨<code>API Server</code>ä¸Šé€šè¿‡å‘½ä»¤è¡Œè®¾ç½®é€‰æ‹©æ‰§è¡Œå“ªäº›æ³¨å…¥æ§åˆ¶å™¨ã€‚</li>
</ol>
</li>
<li>
<ol start="3">
<li>åªæœ‰å½“æ‰€æœ‰çš„æ³¨å…¥æ§åˆ¶å™¨éƒ½æ£€æŸ¥é€šè¿‡ä¹‹åï¼Œ<code>API Server</code>æ‰ä¼šæ‰§è¡Œè¯¥è¯·æ±‚ï¼Œå¦åˆ™è¿”å›æ‹’ç»ã€‚</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds</span></span></code></pre></div></blockquote>
<hr>
<h5 id="admission-controlfont-colorredå‡†å…¥æ§åˆ¶font"><code>Admission Control</code><!-- raw HTML omitted -->(å‡†å…¥æ§åˆ¶)<!-- raw HTML omitted --></h5>
<blockquote>
<ul>
<li><code>AlwaysAdmit</code><!-- raw HTML omitted -->ï¼šå…è®¸æ‰€æœ‰è¯·æ±‚<!-- raw HTML omitted --></li>
<li><code>AlwaysDeny</code><!-- raw HTML omitted -->ï¼šç¦æ­¢æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•<!-- raw HTML omitted --></li>
<li><code>AlwaysPullImages</code><!-- raw HTML omitted -->ï¼šåœ¨å¯åŠ¨å®¹å™¨ä¹‹å‰æ€»å»ä¸‹è½½é•œåƒ<!-- raw HTML omitted --></li>
<li><code>DenyExecOnPrivileged</code>ï¼šå®ƒä¼šæ‹¦æˆªæ‰€æœ‰æƒ³åœ¨<code>Privileged Container</code>ä¸Šæ‰§è¡Œå‘½ä»¤çš„è¯·æ±‚</li>
<li><code>ImagePolicyWebhook</code>ï¼šè¿™ä¸ªæ’ä»¶å°†å…è®¸åç«¯çš„ä¸€ä¸ª<code>Webhook</code>ç¨‹åºæ¥å®Œæˆ<code>admission controller</code>çš„åŠŸèƒ½</li>
<li><code>Service Account</code>ï¼šå®ç°<code>ServiceAccount</code>å®ç°äº†è‡ªåŠ¨åŒ–</li>
<li><code>SecurityContextDeny</code>ï¼šè¿™ä¸ªæ’ä»¶å°†ä½¿ç”¨<code>SecurityContext</code>çš„<code>Pod</code>ä¸­çš„å®šä¹‰å…¨éƒ¨å¤±æ•ˆ</li>
<li><code>ResourceQuota</code>ï¼šç”¨äºèµ„æºé…é¢ç®¡ç†ç›®çš„ï¼Œè§‚å¯Ÿæ‰€æœ‰è¯·æ±‚ï¼Œç¡®ä¿åœ¨<code>namespace</code>ä¸Šçš„é…é¢ä¸ä¼šè¶…æ ‡</li>
<li><code>LimitRanger</code>ï¼šç”¨äºèµ„æºé™åˆ¶ç®¡ç†ï¼Œä½œç”¨äº<code>namespace</code>ä¸Šï¼Œç¡®ä¿å¯¹<code>Pod</code>è¿›è¡Œèµ„æºé™åˆ¶</li>
<li><code>InitialResources</code>ï¼šä¸ºæœªè®¾ç½®èµ„æºè¯·æ±‚ä¸é™åˆ¶çš„<code>Pod</code>ï¼Œæ ¹æ®å…¶é•œåƒçš„å†å²èµ„æºçš„ä½¿ç”¨æƒ…å†µè¿›è¡Œè®¾ç½®</li>
<li><code>NamespaceLifecycle</code>ï¼šå¦‚æœå°è¯•åœ¨ä¸€ä¸ªä¸å­˜åœ¨çš„<code>namespace</code>ä¸­åˆ›å»ºèµ„æºå¯¹è±¡ï¼Œåˆ™è¯¥åˆ›å»ºè¯·æ±‚å°†è¢«æ‹’ ç»ã€‚å½“åˆ é™¤ä¸€ä¸ª<code>namespace</code>æ—¶ï¼Œç³»ç»Ÿå°†ä¼šåˆ é™¤è¯¥<code>namespace</code>ä¸­æ‰€æœ‰å¯¹è±¡</li>
<li><code>DefaultStorageClass</code>ï¼šä¸ºäº†å®ç°å…±äº«å­˜å‚¨çš„åŠ¨æ€ä¾›åº”ï¼Œä¸ºæœªæŒ‡å®š<code>StorageClass</code>æˆ–<code>PV</code>çš„<code>PVC</code>å°è¯•åŒ¹é…é»˜è®¤<code>StorageClass</code>ï¼Œå°½å¯èƒ½å‡å°‘ç”¨æˆ·åœ¨ç”³è¯·<code>PVC</code>æ—¶æ‰€éœ€äº†è§£çš„åç«¯å­˜å‚¨ç»†èŠ‚</li>
<li><code>DefaultTolerationSeconds</code>ï¼šè¿™ä¸ªæ’ä»¶ä¸ºé‚£äº›æ²¡æœ‰è®¾ç½®<code>forgiveness tolerations</code>å¹¶å…·æœ‰<code>notready:NoExecute</code>å’Œ<code>unreachable:NoExecute</code>ä¸¤ç§<code>taints</code>çš„<code>Pod</code>è®¾ç½®é»˜è®¤çš„<code>â€œå®¹å¿â€</code>æ—¶é—´ï¼Œä¸º<code>5min</code></li>
<li><code>PodSecurityPolicy</code>ï¼šè¿™ä¸ªæ’ä»¶ç”¨äºåœ¨åˆ›å»ºæˆ–ä¿®æ”¹Podæ—¶å†³å®šæ˜¯å¦æ ¹æ®<code>Pod</code>çš„<code>security context</code>å’Œå¯ç”¨çš„<code>PodSecurityPolicy</code>å¯¹<code>Pod</code>çš„å®‰å…¨ç­–ç•¥è¿›è¡Œæ§åˆ¶</li>
</ul>
</blockquote>
<hr>
<h3 id="rbacå®æˆ˜"><code>RBAC</code>å®æˆ˜</h3>
<ul>
<li>
<ol>
<li>åˆ›å»ºä¸€ä¸ªåªèƒ½ç®¡ç†<code>dev</code>å‘½åç©ºé—´ä¸‹<code>Pods</code>èµ„æºçš„è´¦å·ã€‚</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»ºå¯†é’¥<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /etc/kubernetes/pki/
</span></span><span style="display:flex;"><span>$ <span style="color:#f92672">(</span>umask 077;openssl genrsa -out user-name.key 2048<span style="color:#f92672">)</span></span></span></code></pre></div><ul>
<li>ç”¨<code>API Server</code>çš„å¯†é’¥å»ç­¾ç½²è¯ä¹¦</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è¯ä¹¦ç”³è¯·ï¼š<!-- raw HTML omitted -->ç”³è¯·çš„ç”¨æˆ·æ˜¯<code>user-name</code>ï¼Œç»„æ˜¯<code>group-name</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl req -new -key user-name.key -out user-name.csr -subj <span style="color:#e6db74">&#34;/CN=user-name/O=group-name&#34;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç­¾ç½²è¯ä¹¦<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl x509 -req -in user-name.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out user-name.crt -days <span style="color:#ae81ff">3650</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl config set-cluster kubernetes --embed-certs<span style="color:#f92672">=</span>true --certificate-authority<span style="color:#f92672">=</span>/etc/kubernetes/pki/ca.crt --server<span style="color:#f92672">=</span>https://192.168.18.100:6443
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-credentials user-name --embed-certs<span style="color:#f92672">=</span>true --client-certificate<span style="color:#f92672">=</span>/etc/kubernetes/pki/user-name.crt --client-key<span style="color:#f92672">=</span>/etc/kubernetes/pki/user-name.key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-context user-name@kubernetes --cluster<span style="color:#f92672">=</span>kubernetes --user<span style="color:#f92672">=</span>user-name</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æµ‹è¯•è´¦æˆ·ã€åˆ‡æ¢<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ‡æ¢è´¦å·åˆ°<!-- raw HTML omitted --><code>user-name</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl config use-context user-name@kubernetes</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<code>default</code>ä¸‹çš„<code>Pod</code>ï¼Œå‘ç°æ²¡æœ‰æƒé™ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get pods -n default</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ‡æ¢åˆ°<code>admin</code>è´¦æˆ·ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl config use-context kubernetes-admin@kubernetes</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="rolebindingfont-colorredå¼•ç”¨fontclusterrolefont-colorredè¿›è¡Œæˆæƒfont"><code>RoleBinding</code><!-- raw HTML omitted -->å¼•ç”¨<!-- raw HTML omitted --><code>ClusterRole</code><!-- raw HTML omitted -->è¿›è¡Œæˆæƒ<!-- raw HTML omitted --></h4>
<ul>
<li>
<ol>
<li><code>RoleBinding</code>(è§’è‰²ç»‘å®š)å¯ä»¥å¼•ç”¨<code>ClusterRole</code>(é›†ç¾¤è§’è‰²)ï¼Œå¯¹å±äºåŒä¸€å‘½åç©ºé—´å†…<code>ClusterRole</code>å®šä¹‰çš„èµ„æºä¸»ä½“è¿›è¡Œæˆæƒã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li>ä¸€ç§å¾ˆå¸¸ç”¨çš„åšæ³•æ˜¯ï¼Œé›†ç¾¤ç®¡ç†å‘˜ä¸ºé›†ç¾¤èŒƒå›´é¢„å®šä¹‰å¥½ä¸€ç»„è§’è‰²<code>ClusterRole</code>ï¼Œç„¶ååœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­é‡å¤ä½¿ç”¨è¿™äº›<code>ClusterRole</code>ã€‚è¿™æ ·å¯ä»¥å¤§å¹…åº¦æé«˜æˆæƒç®¡ç†å·¥ä½œæ•ˆç‡ï¼Œä¹Ÿä½¿å¾—å„ä¸ªå‘½åç©ºé—´ä¸‹çš„åŸºç¡€æ€§æˆæƒè§„åˆ™å’Œä½¿ç”¨ä½“éªŒä¿æŒä¸€è‡´ã€‚</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>è™½ç„¶<code>authorization-clusterrole</code>æ˜¯ä¸€ä¸ªé›†ç¾¤è§’è‰²ï¼Œä½†æ˜¯å› ä¸ºä½¿ç”¨äº†<code>RoleBinding</code>ï¼Œæ‰€ä»¥<code>xudaxian</code>åªèƒ½è¯»å–<code>default</code>å‘½åç©ºé—´ä¸­çš„èµ„æº</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">RoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-clusterrole-binding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">xudaxian</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">User</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-clusterrole</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="font-colorredåˆ›å»ºfontrolefont-colorredå’Œfontrolebindingfont-colorredä¸ºfontuser-namefont-colorredæˆæƒfont"><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>Role</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>RoleBinding</code><!-- raw HTML omitted -->ï¼Œä¸º<!-- raw HTML omitted --><code>user-name</code><!-- raw HTML omitted -->æˆæƒ<!-- raw HTML omitted --></h4>
<ul>
<li>
<ol>
<li>åˆ›å»º<code>dev-role.yaml</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dev-role</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]  	<span style="color:#75715e"># æ”¯æŒçš„APIç»„åˆ—è¡¨ï¼Œ&#34;&#34;ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ ¸å¿ƒAPIç¾¤</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;pods&#34;</span>]  	<span style="color:#75715e"># æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>,<span style="color:#e6db74">&#34;watch&#34;</span>,<span style="color:#e6db74">&#34;list&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">RoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-role-binding </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">User</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">user-name</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dev-role</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>åˆ›å»º<code>Role</code>å’Œ<code>RoleBinding</code>ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create -f dev-role.yaml</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li>åˆ‡æ¢è´¦æˆ·åˆ°<code>user-name</code>ç”¨æˆ·ï¼Œå†æ¬¡éªŒè¯ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl config use-context user-name@kubernetes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†æ¬¡æŸ¥çœ‹ï¼š</span>
</span></span><span style="display:flex;"><span>$ kubectl get pod -n default
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ‡å›adminè´¦æˆ·ï¼š</span>
</span></span><span style="display:flex;"><span>$ kubectl config use-context kubernetes-admin@kubernetes</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="../../../js/clipboard.min.js?1722425299" defer></script>
    <script src="../../../js/perfect-scrollbar.min.js?1722425299" defer></script>
    <script src="../../../js/d3/d3-color.min.js?1722425299" defer></script>
    <script src="../../../js/d3/d3-dispatch.min.js?1722425299" defer></script>
    <script src="../../../js/d3/d3-drag.min.js?1722425299" defer></script>
    <script src="../../../js/d3/d3-ease.min.js?1722425299" defer></script>
    <script src="../../../js/d3/d3-interpolate.min.js?1722425299" defer></script>
    <script src="../../../js/d3/d3-selection.min.js?1722425299" defer></script>
    <script src="../../../js/d3/d3-timer.min.js?1722425299" defer></script>
    <script src="../../../js/d3/d3-transition.min.js?1722425299" defer></script>
    <script src="../../../js/d3/d3-zoom.min.js?1722425299" defer></script>
    <script src="../../../js/js-yaml.min.js?1722425299" defer></script>
    <script src="../../../js/mermaid.min.js?1722425299" defer></script>
    <script>
      window.themeUseMermaid = JSON.parse("{ \"securityLevel\": \"loose\" }");
    </script>
    <script src="../../../js/theme.js?1722425299" defer></script>
  </body>
</html>
