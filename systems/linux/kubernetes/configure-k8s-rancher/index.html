<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.125.4"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="Configure K8s Rancher"><meta itemprop=description content="Configure-K8s-Rancher"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://erge.blog/imgs/s2-1.jpg"><meta itemprop=keywords content="Kubernetes,Rancher"><meta property="og:type" content="article"><meta property="og:title" content="Configure K8s Rancher"><meta property="og:description" content="Configure-K8s-Rancher"><meta property="og:image" content="/imgs/s2-1.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://erge.blog/systems/linux/kubernetes/configure-k8s-rancher/"><meta property="og:site_name" content="二哥"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="二哥"><meta property="article:published_time" content="2022-05-19 21:51:25 +0800 CST"><meta property="article:modified_time" content="2022-11-14 21:51:25 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.0d420b6f564e6674edd4354ea71c0458a83f95ad464a75114b23d72515b1456c.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"configure-k8s-rancher","permalink":"https://erge.blog/systems/linux/kubernetes/configure-k8s-rancher/","title":"Configure K8s Rancher","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>Configure K8s Rancher - 二哥</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>二哥</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Linux、Kubernetes、Docker、Python、CI/CD、Jenkins、Mysql、Nginx、Gitlab、Ansible、Zabbix</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-Home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-th hvr-icon"></i>分类</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>0</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-tools"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-tools hvr-icon"></i>工具</a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>站点示例</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-Commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#rancher服务宕机情况下使用kubernetes-cluster><code>Rancher</code>服务宕机情况下使用<code>Kubernetes Cluster</code></a></li><li><a href=#模拟rancher服务宕机>模拟<code>Rancher</code>服务宕机</a><ul><li><a href=#安装kubectl>安装<code>Kubectl</code></a></li><li><a href=#创建kube目录修改文件>创建<code>.kube</code>目录修改文件</a></li><li><a href=#使用kubectl控制kubernetes-cluster集群>使用<code>Kubectl</code>控制<code>Kubernetes Cluster</code>集群</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=二哥 src=/imgs/img-lazy-loading.gif data-src=/imgs/s2-1.jpg><p class=site-author-name itemprop=name>二哥</p><div class=site-description itemprop=description>The man who has made up his mind to win will never say impossible – Napoleon Bonaparte</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>0</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>51</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>150</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=qq%e5%8f%b7 title="QQ → qq号" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-qq fa-fw hvr-icon"></i>
QQ
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/lisenhui title="知乎 → https://www.zhihu.com/people/lisenhui" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=qq@qq.com title="E-Mail → qq@qq.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://weibo.com/yourname title="Weibo → https://weibo.com/yourname" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-weibo fa-fw hvr-icon"></i>
Weibo
</a></span><span class=links-of-social-item><a href="https://www.youtube.com/watch?v=RgKAFK5djSk" title="Youtube → https://www.youtube.com/watch?v=RgKAFK5djSk" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
Youtube
</a></span><span class=links-of-social-item><a href=https://github.com/elkan1788 title="Github → https://github.com/elkan1788" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/hugo-next rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://erge.blog/systems/linux/kubernetes/configure-k8s-rancher/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/s2-1.jpg"><meta itemprop=name content="二哥"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="二哥"><meta itemprop=description content="The man who has made up his mind to win will never say impossible – Napoleon Bonaparte"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Configure K8s Rancher"><meta itemprop=description content="Configure-K8s-Rancher"></span><header class=post-header><h1 class=post-title itemprop="name headline">Configure K8s Rancher
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/Systems/Linux/Kubernetes/Configure-K8s-Rancher.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2022-05-19 21:51:25 +0800 CST" itemprop="dateCreated datePublished" datetime="2022-05-19 21:51:25 +0800 CST">2022-05-19
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title=修改时间：2022-11-14T21:51:25+08:00 itemprop=dateModified datetime=2022-11-14T21:51:25+08:00>2022-11-14</time>
</span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/kubernetes itemprop=url rel=index><span itemprop=name>Kubernetes</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>1152</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>3分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/systems/linux/kubernetes/configure-k8s-rancher/><i class="fa fa-sync fa-spin"></i>
</span></span><span class=post-meta-item title><span class=post-meta-item-icon><i class="far fa-comments"></i>
</span><span class=post-meta-item-text title=评论>评论：
</span><span id=comments-count class=waline-comment-count data-path=/systems/linux/kubernetes/configure-k8s-rancher/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=rancher服务宕机情况下使用kubernetes-cluster><code>Rancher</code>服务宕机情况下使用<code>Kubernetes Cluster</code>
<a class=header-anchor href=#rancher%e6%9c%8d%e5%8a%a1%e5%ae%95%e6%9c%ba%e6%83%85%e5%86%b5%e4%b8%8b%e4%bd%bf%e7%94%a8kubernetes-cluster></a></h2><div class="note info"><ul><li><ol><li><a href=https://docs.rancher.cn/docs/rancher2/cluster-admin/cleaning-cluster-nodes/_index/ title="<code>Rancher</code>清理节点" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Rancher</code>清理节点
<i class="fa fa-external-link-alt"></i></a></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>KUBE_SVC<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kubelet
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kube-scheduler
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kube-proxy
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kube-controller-manager
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kube-apiserver
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> kube_svc in <span style=color:#e6db74>${</span>KUBE_SVC<span style=color:#e6db74>}</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 停止服务</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>`</span>systemctl is-active <span style=color:#e6db74>${</span>kube_svc<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;active&#39;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>           systemctl stop <span style=color:#e6db74>${</span>kube_svc<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 禁止服务开机启动</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>`</span>systemctl is-enabled <span style=color:#e6db74>${</span>kube_svc<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;enabled&#39;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>           systemctl disable <span style=color:#e6db74>${</span>kube_svc<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 停止所有容器</span>
</span></span><span style=display:flex><span>docker stop <span style=color:#66d9ef>$(</span>docker ps -aq<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除所有容器</span>
</span></span><span style=display:flex><span>docker rm -f <span style=color:#66d9ef>$(</span>docker ps -qa<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除所有容器卷</span>
</span></span><span style=display:flex><span>docker volume rm <span style=color:#66d9ef>$(</span>docker volume ls -q<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 卸载mount目录</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> mount in <span style=color:#66d9ef>$(</span>mount | grep tmpfs | grep <span style=color:#e6db74>&#39;/var/lib/kubelet&#39;</span> | awk <span style=color:#e6db74>&#39;{ print $3 }&#39;</span><span style=color:#66d9ef>)</span> /var/lib/kubelet /var/lib/rancher;
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      umount $mount;
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 备份目录</span>
</span></span><span style=display:flex><span>mv /etc/kubernetes /etc/kubernetes-bak-<span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y%m%d%H%M&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>mv /var/lib/etcd /var/lib/etcd-bak-<span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y%m%d%H%M&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>mv /var/lib/rancher /var/lib/rancher-bak-<span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y%m%d%H%M&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>mv /opt/rke /opt/rke-bak-<span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%Y%m%d%H%M&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除残留路径</span>
</span></span><span style=display:flex><span>rm -rf /etc/ceph <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /etc/cni <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /opt/cni <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /run/secrets/kubernetes.io <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /run/calico <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /run/flannel <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /var/lib/calico <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /var/lib/cni <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /var/lib/kubelet <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /var/log/containers <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /var/log/kube-audit <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /var/log/pods <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /var/run/calico <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    /usr/libexec/kubernetes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 清理网络接口</span>
</span></span><span style=display:flex><span>no_del_net_inter<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>lo
</span></span></span><span style=display:flex><span><span style=color:#e6db74>docker0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>eth
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ens
</span></span></span><span style=display:flex><span><span style=color:#e6db74>bond
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>network_interface<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>ls /sys/class/net<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> net_inter in $network_interface;
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> ! echo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>no_del_net_inter<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> | grep -qE <span style=color:#e6db74>${</span>net_inter:0:3<span style=color:#e6db74>}</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>           ip link delete $net_inter
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 清理残留进程</span>
</span></span><span style=display:flex><span>port_list<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>80
</span></span></span><span style=display:flex><span><span style=color:#e6db74>443
</span></span></span><span style=display:flex><span><span style=color:#e6db74>6443
</span></span></span><span style=display:flex><span><span style=color:#e6db74>2376
</span></span></span><span style=display:flex><span><span style=color:#e6db74>2379
</span></span></span><span style=display:flex><span><span style=color:#e6db74>2380
</span></span></span><span style=display:flex><span><span style=color:#e6db74>8472
</span></span></span><span style=display:flex><span><span style=color:#e6db74>9099
</span></span></span><span style=display:flex><span><span style=color:#e6db74>10250
</span></span></span><span style=display:flex><span><span style=color:#e6db74>10254
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> port in $port_list;
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>      pid<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>netstat -atlnup | grep $port | awk <span style=color:#e6db74>&#39;{print $7}&#39;</span> | awk -F <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#e6db74>&#39;{print $1}&#39;</span> | grep -v - | sort -rnk2 | uniq<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -n $pid <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>           kill -9 $pid
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kube_pid<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>ps -ef | grep -v grep | grep kube | awk <span style=color:#e6db74>&#39;{print $2}&#39;</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -n $kube_pid <span style=color:#f92672>]]</span>;<span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>      kill -9 $kube_pid
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 清理Iptables表</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 注意：如果节点Iptables有特殊配置，以下命令请谨慎操作</span>
</span></span><span style=display:flex><span>sudo iptables --flush
</span></span><span style=display:flex><span>sudo iptables --flush --table nat
</span></span><span style=display:flex><span>sudo iptables --flush --table filter
</span></span><span style=display:flex><span>sudo iptables --table nat --delete-chain
</span></span><span style=display:flex><span>sudo iptables --table filter --delete-chain
</span></span><span style=display:flex><span>systemctl restart docker
</span></span></code></pre></div></blockquote><ul><li><ol start=2><li><font color=red><code>Rancher Server</code>是上游中心管理角色，控制或创建旗下<code>N</code>个<code>Kubernetes Cluster</code>集群，不管是测试中的单个节点或者是<code>Kubernetes Cluster</code>集群失效都无法读取，运维仍需要对下游所有<code>Kubernetes Cluster</code>集群管控</font></li></ol></li></ul><blockquote><table><thead><tr><th>服务器</th><th>IP</th><th>CPU</th><th>内存</th></tr></thead><tbody><tr><td>master</td><td>192.168.35.128</td><td>8<code>core</code></td><td>8G</td></tr><tr><td>node-1</td><td>192.168.35.129</td><td>4<code>core</code></td><td>4G</td></tr><tr><td>node-2</td><td>192.168.35.130</td><td>4<code>core</code></td><td>4G</td></tr></tbody></table></blockquote><ul><li><ol start=3><li>前提条件</li></ol></li></ul><blockquote><ul><li>3.1 <font color=red>所有机器都是<code>CentOS 7</code></font></li><li>3.2 <font color=red><code>Rancher Server</code>是以<code>Docker</code>方式单独建立</font></li><li>3.3 <font color=red><code>test-cluster Kubernetes Cluster</code>集群是以<code>Rancher Server</code>自定义方式创建</font></li></ul></blockquote><ul><li><ol start=4><li><font color=red>模拟<code>Racnher Server</code>服务失效对<code>Kubernetes Cluster</code>集群进行管控</font></li></ol></li></ul><blockquote><ul><li>4.1 <font color=red>点击创建集群名称</font></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/Kubernetes_server/Rancher/Snipaste_2022-05-20_15-47-45.png alt></p><ul><li>4.2 <font color=red>提前下载<code>Kubernetesfig</code>文件</font></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/Kubernetes_server/Rancher/Snipaste_2022-05-20_15-49-19.png alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/Kubernetes_server/Rancher/Snipaste_2022-05-20_16-16-23.png alt="下k8s file"></p></blockquote></div><h2 id=模拟rancher服务宕机>模拟<code>Rancher</code>服务宕机
<a class=header-anchor href=#%e6%a8%a1%e6%8b%9francher%e6%9c%8d%e5%8a%a1%e5%ae%95%e6%9c%ba></a></h2><ul><li><ol><li><font color=red>停止<code>Rancher Server</code>服务<code>docker stop rancher</code></font></li></ol></li></ul><blockquote><ul><li>1.1 <font color=red><code>查看Kubernetes</code>集群版本号</font></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/Kubernetes_server/Rancher/Snipaste_2022-05-25_20-04-18.png alt="查看<code>Rancher</code>安装<code>Kubernetes</code>集群版本"></p></blockquote><h3 id=安装kubectl>安装<code>Kubectl</code>
<a class=header-anchor href=#%e5%ae%89%e8%a3%85kubectl></a></h3><ul><li><ol><li><font color=red>在能连接<code>test-kubernetes-cluster</code>集群中任意一个节点部署<code>Kubectl</code></font></li></ol></li><li><ol start=2><li><font color=red><code>Kubectl</code>版本需和<code>test-cluster-cluster</code>版本相同或者高于</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat &gt;/etc/yum.repos.d/kubernetes.repo<span style=color:#e6db74>&lt;&lt;-EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[kubernetes] 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name=Kubernetes 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
</span></span></span><span style=display:flex><span><span style=color:#e6db74>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgcheck=0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>repo_gpgcheck=0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ yum -y install kubectl-1.23.6-0
</span></span></code></pre></div></blockquote><h3 id=创建kube目录修改文件>创建<code>.kube</code>目录修改文件
<a class=header-anchor href=#%e5%88%9b%e5%bb%bakube%e7%9b%ae%e5%bd%95%e4%bf%ae%e6%94%b9%e6%96%87%e4%bb%b6></a></h3><ul><li><ol><li><font color=red>并且将下载的<code>Kubernetesfig</code>文件改名为<code>config</code>，然后放到<code>${HOME}/.kube/</code>目录中</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ mkdir <span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span>/.kube
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ mv <span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span>/.kube/test-kubernetes-cluster.yaml <span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span>/.kube/config
</span></span></code></pre></div></blockquote><ul><li><ol start=2><li><font color=red><code>${HOME}/.kube/config</code>文件没修改前</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat <span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span>/.kube/config
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>- name: <span style=color:#e6db74>&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style=display:flex><span>  cluster:
</span></span><span style=display:flex><span>    server: <span style=color:#e6db74>&#34;https://192.168.80.210:4443/k8s/clusters/c-gwknl&#34;</span>
</span></span><span style=display:flex><span>    certificate-authority-data: <span style=color:#e6db74>&#34;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJwekNDQ\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      VUyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQTdNUnd3R2dZRFZRUUtFeE5rZVc1aGJXbGoKY\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      kdsemRHVnVaWEl0YjNKbk1Sc3dHUVlEVlFRREV4SmtlVzVoYldsamJHbHpkR1Z1WlhJdFkyRXdIa\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      GNOTWpJdwpOVEkxTVRFeE9UUXhXaGNOTXpJd05USXlNVEV4T1RReFdqQTdNUnd3R2dZRFZRUUtFe\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      E5rZVc1aGJXbGpiR2x6CmRHVnVaWEl0YjNKbk1Sc3dHUVlEVlFRREV4SmtlVzVoYldsamJHbHpkR\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      1Z1WlhJdFkyRXdXVEFUQmdjcWhrak8KUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVJTb3NwRzE4OHJBQ\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      mZabTAwQnRqcjAyL29udnZGVnppU09wZUdVd09SUApoSHpUbk1acTRmazVpRFhPV2lIUy9iQ0hvT\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      WQra1VtYkx6QVRPNkd2azdtSm8wSXdRREFPQmdOVkhROEJBZjhFCkJBTUNBcVF3RHdZRFZSMFRBU\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      UgvQkFVd0F3RUIvekFkQmdOVkhRNEVGZ1FVZ1YzR1g0Z2tXN3hPZVZWQURWem0KVEpxSW95b3dDZ\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      1lJS29aSXpqMEVBd0lEU0FBd1JRSWdlTHh3WTVGcGkweDBGNXhBQUNZMnNPbVQ4aHBqNjVCWApUc\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      1lsQk1sOGx0RUNJUURkNmlONTJmbG9hVzZybXpvWXRLQy9nOEJRRW00b2UrcGN0YldCaGY0UENRP\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      T0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ==&#34;</span>
</span></span><span style=display:flex><span>- name: <span style=color:#e6db74>&#34;test-kubernetes-cluster-node-1-80-211&#34;</span>
</span></span><span style=display:flex><span>  cluster:
</span></span><span style=display:flex><span>    server: <span style=color:#e6db74>&#34;https://192.168.80.211:6443&#34;</span>
</span></span><span style=display:flex><span>    certificate-authority-data: <span style=color:#e6db74>&#34;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM0VENDQ\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      WNtZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKT\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      FdOaE1CNFhEVEl5TURVeU5URXhNek0xTUZvWERUTXlNRFV5TWpFeE16TTFNRm93RWpFUU1BNEdBM\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      VVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      0VCQUtJSzVRVy84eHB3CkRHUzMrN0M2Q0lobS8zcWFUUENvVmdFeU91YkVtR1EzbnAvYk9qTUJKY\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      3Ayck05cW5CV2M4ZmtUUWhCNHZsL24Kay8zSkUrMkdta1RBbVAwaGpLa3d6d1JiT2lrYzdYVEtnd\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ElTQ3I2cjRkOWhZTElERElzTTJtUzZYYnhNdGd1SApoamk3MTJYQmNoZ3lEamxjREl3S1k5WXRYc\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      3lDY3hPejdFNXN4YmpLTk1nb2sxK3VZSTlHaHhYYUlGcGp0VWFUClJXUW00dE9JOFplWWlUWG9aT\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      nJldTU1SVkyZ3pQVjZ1dURTWGQybFRHMEtmVng0Y1FYSDJIekdSODJ4NWZkK3kKS01HY0M1N21DN\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      HpiM3pET1Z2NVNEdmxOZEhyQ0g3QmpVYzh0MlFpU2JyQUwrQ216NnhMVFF4dlp1YkVLejU2TApKe\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ElKUGFhNkdSY0NBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93U\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      UZNQU1CCkFmOHdIUVlEVlIwT0JCWUVGSkN3bmVCVXZUMUtoeWtCUjF6bmxWQ2I1T2RnTUEwR0NTc\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      UdTSWIzRFFFQkN3VUEKQTRJQkFRQnRwa0doRDJ1RFdYTmZaSUhaa0NNclNpSkZXaGxIUGNPa2VPZ\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      TJwcmp1UEZ0bzFWMVpyNlloWWVpcQp1cGxRdWlpenBwbEthZncxR1lpSnY4SCsrcHpjUFZoS3JTM\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      2F5Ykp1T2hxdnFyYUVZbzJDbjVVbkFpVWxBb2g1CnRqY1lNcVFKdkVzODd5UlFtUVhMSVNEMkdYb\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      3UwN24ySy9wTVZXQWpHYjRsUTk0VmpHcjI3dHppSlhIYkh2L04KbHNNZklJV2czbTFKSW9SMlBNa\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      3gvY1FpcGl6a3JRVHRpalhMbW0xbUFGOEtMR2JZcnNaTk1sMFdITWZWWjdXcgplemRBVjhVNDdsb\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      GowKzUzQ0FkZk0rYWpiSk5uMUtYMWF1Sm8rb1JXVTJjVno0SkYydUllMnBjcFcxUUplY1NPCmZ2U\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ysyOU9FK09GZW5tenRINTdZTStTWk1jRE8KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>users:
</span></span><span style=display:flex><span>- name: <span style=color:#e6db74>&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style=display:flex><span>  user:
</span></span><span style=display:flex><span>    token: <span style=color:#e6db74>&#34;kubeconfig-user-j85xz8pbjt:ls679hfqpvf9c25nswd5gdfm2hf4qtxj2kvqmj6kzzrjkj48lwwlpd&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- name: <span style=color:#e6db74>&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style=display:flex><span>  context:
</span></span><span style=display:flex><span>    user: <span style=color:#e6db74>&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style=display:flex><span>    cluster: <span style=color:#e6db74>&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style=display:flex><span>- name: <span style=color:#e6db74>&#34;test-kubernetes-cluster-node-1-80-211&#34;</span>
</span></span><span style=display:flex><span>  context:
</span></span><span style=display:flex><span>    user: <span style=color:#e6db74>&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style=display:flex><span>    cluster: <span style=color:#e6db74>&#34;test-kubernetes-cluster-node-1-80-211&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>current-context: <span style=color:#e6db74>&#34;test-kubernetes-cluster&#34;</span>
</span></span></code></pre></div></blockquote><ul><li><ol start=3><li><font color=red><code>${HOME}/.kube/config</code>文件修改后</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat <span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span>/.kube/config
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>- name: <span style=color:#e6db74>&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style=display:flex><span>  cluster:
</span></span><span style=display:flex><span>    server: <span style=color:#e6db74>&#34;https://192.168.80.211:6443&#34;</span>
</span></span><span style=display:flex><span>    certificate-authority-data: <span style=color:#e6db74>&#34;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM0VENDQ\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      WNtZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKT\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      FdOaE1CNFhEVEl5TURVeU5URXhNek0xTUZvWERUTXlNRFV5TWpFeE16TTFNRm93RWpFUU1BNEdBM\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      VVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      0VCQUtJSzVRVy84eHB3CkRHUzMrN0M2Q0lobS8zcWFUUENvVmdFeU91YkVtR1EzbnAvYk9qTUJKY\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      3Ayck05cW5CV2M4ZmtUUWhCNHZsL24Kay8zSkUrMkdta1RBbVAwaGpLa3d6d1JiT2lrYzdYVEtnd\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ElTQ3I2cjRkOWhZTElERElzTTJtUzZYYnhNdGd1SApoamk3MTJYQmNoZ3lEamxjREl3S1k5WXRYc\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      3lDY3hPejdFNXN4YmpLTk1nb2sxK3VZSTlHaHhYYUlGcGp0VWFUClJXUW00dE9JOFplWWlUWG9aT\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      nJldTU1SVkyZ3pQVjZ1dURTWGQybFRHMEtmVng0Y1FYSDJIekdSODJ4NWZkK3kKS01HY0M1N21DN\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      HpiM3pET1Z2NVNEdmxOZEhyQ0g3QmpVYzh0MlFpU2JyQUwrQ216NnhMVFF4dlp1YkVLejU2TApKe\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ElKUGFhNkdSY0NBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93U\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      UZNQU1CCkFmOHdIUVlEVlIwT0JCWUVGSkN3bmVCVXZUMUtoeWtCUjF6bmxWQ2I1T2RnTUEwR0NTc\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      UdTSWIzRFFFQkN3VUEKQTRJQkFRQnRwa0doRDJ1RFdYTmZaSUhaa0NNclNpSkZXaGxIUGNPa2VPZ\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      TJwcmp1UEZ0bzFWMVpyNlloWWVpcQp1cGxRdWlpenBwbEthZncxR1lpSnY4SCsrcHpjUFZoS3JTM\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      2F5Ykp1T2hxdnFyYUVZbzJDbjVVbkFpVWxBb2g1CnRqY1lNcVFKdkVzODd5UlFtUVhMSVNEMkdYb\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      3UwN24ySy9wTVZXQWpHYjRsUTk0VmpHcjI3dHppSlhIYkh2L04KbHNNZklJV2czbTFKSW9SMlBNa\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      3gvY1FpcGl6a3JRVHRpalhMbW0xbUFGOEtMR2JZcnNaTk1sMFdITWZWWjdXcgplemRBVjhVNDdsb\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      GowKzUzQ0FkZk0rYWpiSk5uMUtYMWF1Sm8rb1JXVTJjVno0SkYydUllMnBjcFcxUUplY1NPCmZ2U\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ysyOU9FK09GZW5tenRINTdZTStTWk1jRE8KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>users:
</span></span><span style=display:flex><span>- name: <span style=color:#e6db74>&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style=display:flex><span>  user:
</span></span><span style=display:flex><span>    token: <span style=color:#e6db74>&#34;kubeconfig-user-j85xz8pbjt:ls679hfqpvf9c25nswd5gdfm2hf4qtxj2kvqmj6kzzrjkj48lwwlpd&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>- name: <span style=color:#e6db74>&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style=display:flex><span>  context:
</span></span><span style=display:flex><span>    user: <span style=color:#e6db74>&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style=display:flex><span>    cluster: <span style=color:#e6db74>&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>current-context: <span style=color:#e6db74>&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span></code></pre></div></blockquote><h3 id=使用kubectl控制kubernetes-cluster集群>使用<code>Kubectl</code>控制<code>Kubernetes Cluster</code>集群
<a class=header-anchor href=#%e4%bd%bf%e7%94%a8kubectl%e6%8e%a7%e5%88%b6kubernetes-cluster%e9%9b%86%e7%be%a4></a></h3><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl --kubeconfig <span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span>/.kube/config get pods -n kube-system
</span></span><span style=display:flex><span>$ kubectl create ns dev
</span></span></code></pre></div></blockquote></div><footer class=post-footer><div class=post-tags><a href=/tags/kubernetes>Kubernetes
</a><a href=/tags/rancher>Rancher</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="二哥 - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="二哥 - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
Configure K8s Rancher</li><li class=post-copyright-author><strong>本文作者： </strong>二哥</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://erge.blog/systems/linux/kubernetes/configure-k8s-rancher/ title="Configure K8s Rancher">https://erge.blog/systems/linux/kubernetes/configure-k8s-rancher/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i>
</span><span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/atom.xml><span class=icon><i class="fa fa-rss"></i>
</span><span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/systems/linux/web/install-nginx-third-party-modules/ rel=next title="Install Nginx Third Party Modules"><i class="fa fa-chevron-left"></i> Install Nginx Third Party Modules</a></div><div class="post-nav-prev post-nav-item"><a href=/systems/linux/kubernetes/install-k8s-rancher/ rel=prev title="Install K8s Rancher">Install K8s Rancher
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div><div class=comment-switch><span class=first-comment>Giscus</span>
<span class=switch-btn></span>
<span class=second-comment>Waline</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=waline-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2024
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>二哥</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.125.4 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>粤ICP备 18047355-1 号</a>
<img src=/imgs/gongan.png alt=沪公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011402009770" target=_blank>沪公网安备 31011402009770 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel>
</a><a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云>
</a><a target=_blank href=https://webify.cloudbase.net title=Webify>Webify
</a><span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script><script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://erge.blog/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.b0c78e5a4df586ee46d02716ffa91a4a322e56763e04e91eb2ba052c9469ed02.js defer></script></body></html>