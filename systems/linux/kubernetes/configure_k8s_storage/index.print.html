<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="Kubernetesæ•°æ®å­˜å‚¨ éƒ½çŸ¥é“å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½å¾ˆçŸ­ï¼Œä¼šè¢«é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ã€‚é‚£ä¹ˆå®¹å™¨åœ¨é”€æ¯çš„æ—¶å€™ï¼Œä¿å­˜åœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚è¿™ç§ç»“æœå¯¹ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸ä¹æ„çœ‹åˆ°çš„ã€‚ä¸ºäº†æŒä¹…åŒ–ä¿å­˜å®¹å™¨ä¸­çš„æ•°æ®ï¼Œkuberneteså¼•å…¥äº†Volumeçš„æ¦‚å¿µ Volumeæ˜¯Podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨Podä¸Šï¼Œç„¶åè¢«ä¸€ä¸ªPodé‡Œé¢çš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œkubernetesé€šè¿‡Volumeå®ç°åŒä¸€ä¸ªPodä¸­ä¸åŒå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ä»¥åŠæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚Volumeçš„ç”Ÿå‘½å‘¨æœŸä¸å’ŒPodä¸­çš„å•ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæœ‰å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯çš„æ—¶å€™ï¼ŒVolumeä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤± kubernetesçš„Volumeæ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‹é¢çš„å‡ ä¸ªï¼š ç®€å•å­˜å‚¨ï¼šEmptyDirã€HostPathã€NFS é«˜çº§å­˜å‚¨ï¼šPVã€PVC é…ç½®å­˜å‚¨ï¼šConfigMapã€Secret ç®€å•å­˜å‚¨ EmptyDir EmptyDiræ˜¯æœ€åŸºç¡€çš„Volumeç±»å‹ï¼Œä¸€ä¸ªEmptyDirå°±æ˜¯Hostä¸Šçš„ä¸€ä¸ªç©ºç›®å½• EmptyDiræ˜¯åœ¨Podè¢«åˆ†é…åˆ°Nodeæ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸ºkubernetesä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç›®å½•ï¼Œå½“Podé”€æ¯æ—¶ï¼ŒEmptyDirä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚ EmptyDirçš„ç”¨é€”å¦‚ä¸‹ ä¸´æ—¶ç©ºé—´ä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™ å¤šå®¹å™¨å…±äº«ç›®å½•ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½• æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªå®¹å™¨ä¹‹é—´çš„å…±äº«æ¡ˆä¾‹æ¥ä½¿ç”¨æè¿°ä¸€ä¸ªEmptyDir åœ¨ä¸€ä¸ªPodä¸­å‡†å¤‡ä¸¤ä¸ªå®¹å™¨nginxå’Œbusyboxç„¶åå£°æ˜ä¸€ä¸ªvolumeåˆ†åˆ«æŒ‚è½½åˆ°ä¸¤ä¸ªå®¹å™¨çš„ç›®å½•ä¸­ï¼Œç„¶ånginxå®¹å™¨è´Ÿè´£å‘volumeä¸­å†™æ—¥å¿—ï¼Œbusyboxä¸­é€šè¿‡å‘½ä»¤å°†æ—¥å¿—å†…å®¹è¯»åˆ°æ§åˆ¶å° Kubernetes Emptydir Templateæ¨¡æ¿ apiVersion: v1 kind: Pod metadata: name: emptydir-volume-template # å®šä¹‰åç§° namespace: default spec: # å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰ containers: # å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨ - name: nginx image: nginx:1.">
    <meta name="author" content="äºŒå“¥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/s2-1.png">
    <meta name="twitter:title" content="Configure_K8s_Storage :: Hugo Relearn Theme">
    <meta name="twitter:description" content="Kubernetesæ•°æ®å­˜å‚¨ éƒ½çŸ¥é“å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½å¾ˆçŸ­ï¼Œä¼šè¢«é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ã€‚é‚£ä¹ˆå®¹å™¨åœ¨é”€æ¯çš„æ—¶å€™ï¼Œä¿å­˜åœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚è¿™ç§ç»“æœå¯¹ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸ä¹æ„çœ‹åˆ°çš„ã€‚ä¸ºäº†æŒä¹…åŒ–ä¿å­˜å®¹å™¨ä¸­çš„æ•°æ®ï¼Œkuberneteså¼•å…¥äº†Volumeçš„æ¦‚å¿µ Volumeæ˜¯Podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨Podä¸Šï¼Œç„¶åè¢«ä¸€ä¸ªPodé‡Œé¢çš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œkubernetesé€šè¿‡Volumeå®ç°åŒä¸€ä¸ªPodä¸­ä¸åŒå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ä»¥åŠæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚Volumeçš„ç”Ÿå‘½å‘¨æœŸä¸å’ŒPodä¸­çš„å•ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæœ‰å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯çš„æ—¶å€™ï¼ŒVolumeä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤± kubernetesçš„Volumeæ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‹é¢çš„å‡ ä¸ªï¼š ç®€å•å­˜å‚¨ï¼šEmptyDirã€HostPathã€NFS é«˜çº§å­˜å‚¨ï¼šPVã€PVC é…ç½®å­˜å‚¨ï¼šConfigMapã€Secret ç®€å•å­˜å‚¨ EmptyDir EmptyDiræ˜¯æœ€åŸºç¡€çš„Volumeç±»å‹ï¼Œä¸€ä¸ªEmptyDirå°±æ˜¯Hostä¸Šçš„ä¸€ä¸ªç©ºç›®å½• EmptyDiræ˜¯åœ¨Podè¢«åˆ†é…åˆ°Nodeæ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸ºkubernetesä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç›®å½•ï¼Œå½“Podé”€æ¯æ—¶ï¼ŒEmptyDirä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚ EmptyDirçš„ç”¨é€”å¦‚ä¸‹ ä¸´æ—¶ç©ºé—´ä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™ å¤šå®¹å™¨å…±äº«ç›®å½•ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½• æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªå®¹å™¨ä¹‹é—´çš„å…±äº«æ¡ˆä¾‹æ¥ä½¿ç”¨æè¿°ä¸€ä¸ªEmptyDir åœ¨ä¸€ä¸ªPodä¸­å‡†å¤‡ä¸¤ä¸ªå®¹å™¨nginxå’Œbusyboxç„¶åå£°æ˜ä¸€ä¸ªvolumeåˆ†åˆ«æŒ‚è½½åˆ°ä¸¤ä¸ªå®¹å™¨çš„ç›®å½•ä¸­ï¼Œç„¶ånginxå®¹å™¨è´Ÿè´£å‘volumeä¸­å†™æ—¥å¿—ï¼Œbusyboxä¸­é€šè¿‡å‘½ä»¤å°†æ—¥å¿—å†…å®¹è¯»åˆ°æ§åˆ¶å° Kubernetes Emptydir Templateæ¨¡æ¿ apiVersion: v1 kind: Pod metadata: name: emptydir-volume-template # å®šä¹‰åç§° namespace: default spec: # å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰ containers: # å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨ - name: nginx image: nginx:1.">
    <meta property="og:url" content="https://erge.blog/systems/linux/kubernetes/configure_k8s_storage/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Configure_K8s_Storage :: Hugo Relearn Theme">
    <meta property="og:description" content="Kubernetesæ•°æ®å­˜å‚¨ éƒ½çŸ¥é“å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½å¾ˆçŸ­ï¼Œä¼šè¢«é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ã€‚é‚£ä¹ˆå®¹å™¨åœ¨é”€æ¯çš„æ—¶å€™ï¼Œä¿å­˜åœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚è¿™ç§ç»“æœå¯¹ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸ä¹æ„çœ‹åˆ°çš„ã€‚ä¸ºäº†æŒä¹…åŒ–ä¿å­˜å®¹å™¨ä¸­çš„æ•°æ®ï¼Œkuberneteså¼•å…¥äº†Volumeçš„æ¦‚å¿µ Volumeæ˜¯Podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨Podä¸Šï¼Œç„¶åè¢«ä¸€ä¸ªPodé‡Œé¢çš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œkubernetesé€šè¿‡Volumeå®ç°åŒä¸€ä¸ªPodä¸­ä¸åŒå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ä»¥åŠæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚Volumeçš„ç”Ÿå‘½å‘¨æœŸä¸å’ŒPodä¸­çš„å•ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæœ‰å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯çš„æ—¶å€™ï¼ŒVolumeä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤± kubernetesçš„Volumeæ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‹é¢çš„å‡ ä¸ªï¼š ç®€å•å­˜å‚¨ï¼šEmptyDirã€HostPathã€NFS é«˜çº§å­˜å‚¨ï¼šPVã€PVC é…ç½®å­˜å‚¨ï¼šConfigMapã€Secret ç®€å•å­˜å‚¨ EmptyDir EmptyDiræ˜¯æœ€åŸºç¡€çš„Volumeç±»å‹ï¼Œä¸€ä¸ªEmptyDirå°±æ˜¯Hostä¸Šçš„ä¸€ä¸ªç©ºç›®å½• EmptyDiræ˜¯åœ¨Podè¢«åˆ†é…åˆ°Nodeæ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸ºkubernetesä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç›®å½•ï¼Œå½“Podé”€æ¯æ—¶ï¼ŒEmptyDirä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚ EmptyDirçš„ç”¨é€”å¦‚ä¸‹ ä¸´æ—¶ç©ºé—´ä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™ å¤šå®¹å™¨å…±äº«ç›®å½•ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½• æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªå®¹å™¨ä¹‹é—´çš„å…±äº«æ¡ˆä¾‹æ¥ä½¿ç”¨æè¿°ä¸€ä¸ªEmptyDir åœ¨ä¸€ä¸ªPodä¸­å‡†å¤‡ä¸¤ä¸ªå®¹å™¨nginxå’Œbusyboxç„¶åå£°æ˜ä¸€ä¸ªvolumeåˆ†åˆ«æŒ‚è½½åˆ°ä¸¤ä¸ªå®¹å™¨çš„ç›®å½•ä¸­ï¼Œç„¶ånginxå®¹å™¨è´Ÿè´£å‘volumeä¸­å†™æ—¥å¿—ï¼Œbusyboxä¸­é€šè¿‡å‘½ä»¤å°†æ—¥å¿—å†…å®¹è¯»åˆ°æ§åˆ¶å° Kubernetes Emptydir Templateæ¨¡æ¿ apiVersion: v1 kind: Pod metadata: name: emptydir-volume-template # å®šä¹‰åç§° namespace: default spec: # å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰ containers: # å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨ - name: nginx image: nginx:1.">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Systems">
    <meta property="article:published_time" content="2024-06-25T01:33:15+08:00">
    <meta property="article:modified_time" content="2024-06-25T01:33:15+08:00">
    <meta property="og:image" content="https://erge.blog/images/s2-1.png">
    <meta itemprop="name" content="Configure_K8s_Storage :: Hugo Relearn Theme">
    <meta itemprop="description" content="Kubernetesæ•°æ®å­˜å‚¨ éƒ½çŸ¥é“å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½å¾ˆçŸ­ï¼Œä¼šè¢«é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ã€‚é‚£ä¹ˆå®¹å™¨åœ¨é”€æ¯çš„æ—¶å€™ï¼Œä¿å­˜åœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚è¿™ç§ç»“æœå¯¹ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸ä¹æ„çœ‹åˆ°çš„ã€‚ä¸ºäº†æŒä¹…åŒ–ä¿å­˜å®¹å™¨ä¸­çš„æ•°æ®ï¼Œkuberneteså¼•å…¥äº†Volumeçš„æ¦‚å¿µ Volumeæ˜¯Podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨Podä¸Šï¼Œç„¶åè¢«ä¸€ä¸ªPodé‡Œé¢çš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œkubernetesé€šè¿‡Volumeå®ç°åŒä¸€ä¸ªPodä¸­ä¸åŒå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ä»¥åŠæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚Volumeçš„ç”Ÿå‘½å‘¨æœŸä¸å’ŒPodä¸­çš„å•ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæœ‰å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯çš„æ—¶å€™ï¼ŒVolumeä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤± kubernetesçš„Volumeæ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‹é¢çš„å‡ ä¸ªï¼š ç®€å•å­˜å‚¨ï¼šEmptyDirã€HostPathã€NFS é«˜çº§å­˜å‚¨ï¼šPVã€PVC é…ç½®å­˜å‚¨ï¼šConfigMapã€Secret ç®€å•å­˜å‚¨ EmptyDir EmptyDiræ˜¯æœ€åŸºç¡€çš„Volumeç±»å‹ï¼Œä¸€ä¸ªEmptyDirå°±æ˜¯Hostä¸Šçš„ä¸€ä¸ªç©ºç›®å½• EmptyDiræ˜¯åœ¨Podè¢«åˆ†é…åˆ°Nodeæ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸ºkubernetesä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç›®å½•ï¼Œå½“Podé”€æ¯æ—¶ï¼ŒEmptyDirä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚ EmptyDirçš„ç”¨é€”å¦‚ä¸‹ ä¸´æ—¶ç©ºé—´ä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™ å¤šå®¹å™¨å…±äº«ç›®å½•ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½• æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªå®¹å™¨ä¹‹é—´çš„å…±äº«æ¡ˆä¾‹æ¥ä½¿ç”¨æè¿°ä¸€ä¸ªEmptyDir åœ¨ä¸€ä¸ªPodä¸­å‡†å¤‡ä¸¤ä¸ªå®¹å™¨nginxå’Œbusyboxç„¶åå£°æ˜ä¸€ä¸ªvolumeåˆ†åˆ«æŒ‚è½½åˆ°ä¸¤ä¸ªå®¹å™¨çš„ç›®å½•ä¸­ï¼Œç„¶ånginxå®¹å™¨è´Ÿè´£å‘volumeä¸­å†™æ—¥å¿—ï¼Œbusyboxä¸­é€šè¿‡å‘½ä»¤å°†æ—¥å¿—å†…å®¹è¯»åˆ°æ§åˆ¶å° Kubernetes Emptydir Templateæ¨¡æ¿ apiVersion: v1 kind: Pod metadata: name: emptydir-volume-template # å®šä¹‰åç§° namespace: default spec: # å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰ containers: # å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨ - name: nginx image: nginx:1.">
    <meta itemprop="datePublished" content="2024-06-25T01:33:15+08:00">
    <meta itemprop="dateModified" content="2024-06-25T01:33:15+08:00">
    <meta itemprop="wordCount" content="2101">
    <meta itemprop="image" content="https://erge.blog/images/s2-1.png">
    <title>Configure_K8s_Storage :: Hugo Relearn Theme</title>
    <link href="../../../../images/favicon.ico?1719333223" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../../css/fontawesome-all.min.css?1719333224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/fontawesome-all.min.css?1719333224" rel="stylesheet"></noscript>
    <link href="../../../../css/nucleus.css?1719333224" rel="stylesheet">
    <link href="../../../../css/auto-complete.css?1719333224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/auto-complete.css?1719333224" rel="stylesheet"></noscript>
    <link href="../../../../css/perfect-scrollbar.min.css?1719333224" rel="stylesheet">
    <link href="../../../../css/fonts.css?1719333224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/fonts.css?1719333224" rel="stylesheet"></noscript>
    <link href="../../../../css/theme.css?1719333224" rel="stylesheet">
    <link href="../../../../css/theme-relearn-auto.css?1719333224" rel="stylesheet" id="R-variant-style">
    <link href="../../../../css/chroma-relearn-auto.css?1719333224" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../../css/variant.css?1719333224" rel="stylesheet">
    <link href="../../../../css/print.css?1719333224" rel="stylesheet" media="print">
    <link href="../../../../css/format-print.css?1719333224" rel="stylesheet">
    <script src="../../../../js/variant.js?1719333224"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../../systems/linux/kubernetes/configure_k8s_storage/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/linux/kubernetes/"><span itemprop="name">Kubernetes</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Configure_K8s_Storage</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../../systems/linux/kubernetes/install_k8s_argo_cd/" title="Install_K8s_Argo_CD (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../../systems/linux/kubernetes/configure_k8s_rancher/" title="Configure_K8s_Rancher (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_k8s_storage">Configure_K8s_Storage</h1>

<h1 id="kubernetesæ•°æ®å­˜å‚¨"><code>Kubernetes</code>æ•°æ®å­˜å‚¨</h1>
<ul>
<li>
<ol>
<li>éƒ½çŸ¥é“å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½å¾ˆçŸ­ï¼Œä¼šè¢«é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ã€‚é‚£ä¹ˆå®¹å™¨åœ¨é”€æ¯çš„æ—¶å€™ï¼Œä¿å­˜åœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚è¿™ç§ç»“æœå¯¹ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸ä¹æ„çœ‹åˆ°çš„ã€‚ä¸ºäº†æŒä¹…åŒ–ä¿å­˜å®¹å™¨ä¸­çš„æ•°æ®ï¼Œ<code>kubernetes</code>å¼•å…¥äº†<code>Volume</code>çš„æ¦‚å¿µ</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>Volume</code>æ˜¯<code>Pod</code>ä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨<code>Pod</code>ä¸Šï¼Œç„¶åè¢«ä¸€ä¸ª<code>Pod</code>é‡Œé¢çš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œ<code>kubernetes</code>é€šè¿‡<code>Volume</code>å®ç°åŒä¸€ä¸ª<code>Pod</code>ä¸­ä¸åŒå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ä»¥åŠæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚<code>Volume</code>çš„ç”Ÿå‘½å‘¨æœŸä¸å’Œ<code>Pod</code>ä¸­çš„å•ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæœ‰å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯çš„æ—¶å€™ï¼Œ<code>Volume</code>ä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>kubernetes</code>çš„<code>Volume</code>æ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‹é¢çš„å‡ ä¸ªï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç®€å•å­˜å‚¨<!-- raw HTML omitted -->ï¼š<code>EmptyDir</code>ã€<code>HostPath</code>ã€<code>NFS</code></li>
<li><!-- raw HTML omitted -->é«˜çº§å­˜å‚¨<!-- raw HTML omitted -->ï¼š<code>PV</code>ã€<code>PVC</code></li>
<li><!-- raw HTML omitted -->é…ç½®å­˜å‚¨<!-- raw HTML omitted -->ï¼š<code>ConfigMap</code>ã€<code>Secret</code></li>
</ul>
</blockquote>
<hr>
<h2 id="ç®€å•å­˜å‚¨">ç®€å•å­˜å‚¨</h2>
<h3 id="emptydir"><code>EmptyDir</code></h3>
<ul>
<li>
<ol>
<li><code>EmptyDir</code>æ˜¯æœ€åŸºç¡€çš„<code>Volume</code>ç±»å‹ï¼Œä¸€ä¸ª<code>EmptyDir</code>å°±æ˜¯<code>Host</code>ä¸Šçš„ä¸€ä¸ªç©ºç›®å½•</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>EmptyDir</code>æ˜¯åœ¨<code>Pod</code>è¢«åˆ†é…åˆ°<code>Node</code>æ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸º<code>kubernetes</code>ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç›®å½•ï¼Œå½“<code>Pod</code>é”€æ¯æ—¶ï¼Œ<code>EmptyDir</code>ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>EmptyDir</code>çš„ç”¨é€”å¦‚ä¸‹</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸´æ—¶ç©ºé—´<!-- raw HTML omitted -->ä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™</li>
<li><!-- raw HTML omitted -->å¤šå®¹å™¨å…±äº«ç›®å½•<!-- raw HTML omitted -->ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½•</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªå®¹å™¨ä¹‹é—´çš„å…±äº«æ¡ˆä¾‹æ¥ä½¿ç”¨æè¿°ä¸€ä¸ª<!-- raw HTML omitted --><code>EmptyDir</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨ä¸€ä¸ª<code>Pod</code>ä¸­å‡†å¤‡ä¸¤ä¸ªå®¹å™¨<!-- raw HTML omitted --><code>nginx</code>å’Œ<code>busybox</code>ç„¶åå£°æ˜ä¸€ä¸ª<code>volume</code>åˆ†åˆ«æŒ‚è½½åˆ°ä¸¤ä¸ªå®¹å™¨çš„ç›®å½•ä¸­ï¼Œç„¶å<code>nginx</code>å®¹å™¨è´Ÿè´£å‘<code>volume</code>ä¸­å†™æ—¥å¿—ï¼Œ<code>busybox</code>ä¸­é€šè¿‡å‘½ä»¤å°†æ—¥å¿—å†…å®¹è¯»åˆ°æ§åˆ¶å°</li>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-emptydir-template.yaml" rel="external" target="_self"><code>Kubernetes Emptydir Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod  </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">emptydir-volume-template       </span> <span style="color:#75715e"># å®šä¹‰åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:   <span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;bash&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;for i in {1..100};do echo $i &gt;&gt;/tmp/hello.txt;sleep 1;done&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­çš„ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/tmp</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e"># æ˜¯å¦åªè¯»ï¼Œé»˜è®¤false</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;bash&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /tmp/hello.txt&#34;</span>]     <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/tmp</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:      <span style="color:#75715e"># å£°æ˜volumeï¼Œnameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºemptyDir</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume  </span> <span style="color:#75715e"># å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">emptyDir</span>: {<span style="color:#f92672">}        # ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼ï¼Œä½¿ç”¨ emptyDir</span>: {} <span style="color:#ae81ff">è¡¨ä½¿ç”¨é»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># medium: string   # å­˜å‚¨ä»‹è´¨ï¼Œæ”¯æŒMemoryå’Œç©ºå­—ç¬¦ä¸²(é»˜è®¤)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># sizeLimit: string        # å¤§å°é™åˆ¶ï¼Œé»˜è®¤ä¸é™åˆ¶ã€‚ä¸€èˆ¬åœ¨ä½¿ç”¨Memoryæ—¶ä¼šé™åˆ¶</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="hostpath"><code>HostPath</code></h3>
<ul>
<li>
<ol>
<li>å·²ç»çŸ¥é“<code>EmptyDir</code>ä¸­çš„æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œå®ƒä¼šéšç€<code>Pod</code>çš„ç»“æŸè€Œé”€æ¯ï¼Œå¦‚æœæƒ³è¦ç®€å•çš„å°†æ•°æ®æŒä¹…åŒ–åˆ°ä¸»æœºä¸­ï¼Œå¯ä»¥é€‰æ‹©<!-- raw HTML omitted --><code>HostPath</code><!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><code>HostPath</code>å°±æ˜¯å°†<code>Node</code>ä¸»æœºä¸­çš„ä¸€ä¸ªå®é™…ç›®å½•æŒ‚è½½åˆ°<code>Pod</code>ä¸­ï¼Œä»¥ä¾›å®¹å™¨ä½¿ç”¨ï¼Œè¿™æ ·çš„è®¾è®¡å°±å¯ä»¥ä¿è¯<code>Pod</code>é”€æ¯äº†ï¼Œä½†æ˜¯æ•°æ®ä¾æ—§å¯ä»¥ä¿å­˜åœ¨<code>Node</code>ä¸»æœºä¸Š</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain Pod.spec.volumes.hostPath.type  	<span style="color:#75715e"># ç±»å‹å£°æ˜</span></span></span></code></pre></div><ul>
<li><code>Directory</code><!-- raw HTML omitted -->ï¼šç›®å½•ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>DirectoryOrCreate</code><!-- raw HTML omitted -->ï¼šç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨<!-- raw HTML omitted --></li>
<li><code>File</code><!-- raw HTML omitted -->ï¼šæ–‡ä»¶ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>FileOrCreate</code><!-- raw HTML omitted -->ï¼šæ–‡ä»¶å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨<!-- raw HTML omitted --></li>
<li><code>Socket</code><!-- raw HTML omitted -->ï¼š<code>unix</code>å¥—æ¥å­—ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>CharDevice</code><!-- raw HTML omitted -->ï¼šå­—ç¬¦è®¾å¤‡ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>BlockDevice</code><!-- raw HTML omitted -->ï¼šå—è®¾å¤‡ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-hostpath-template.yaml" rel="external" target="_self"><code>Kubernetes HostPath Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hostpath-volume-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­çš„ç›®å½•ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log/nginx</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /logs/access.log&#34;</span>]        <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„ç›®å½•ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:      <span style="color:#75715e"># å£°æ˜volumeï¼Œnameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºhostPath</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostPath</span>:   <span style="color:#75715e"># ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/logs  </span> <span style="color:#75715e"># Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate  </span> <span style="color:#75715e"># ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºå†ä½¿ç”¨</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="nfs"><code>NFS</code></h3>
<blockquote>
<ul>
<li><code>HostPath</code>è™½ç„¶å¯ä»¥è§£å†³æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦<code>Node</code>èŠ‚ç‚¹æ•…éšœäº†ï¼Œ<code>Pod</code>å¦‚æœè½¬ç§»åˆ°åˆ«çš„<code>Node</code>èŠ‚ç‚¹ä¸Šï¼Œåˆä¼šå‡ºç°é—®é¢˜ï¼Œæ­¤æ—¶éœ€è¦å‡†å¤‡å•ç‹¬çš„ç½‘ç»œå­˜å‚¨ç³»ç»Ÿï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯<code>NFS</code>å’Œ<code>CIFS</code></li>
<li><code>NFS</code>æ˜¯ä¸€ä¸ªç½‘ç»œæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥æ­å»ºä¸€å°<code>NFS</code>æœåŠ¡å™¨ï¼Œç„¶åå°†<code>Pod</code>ä¸­çš„å­˜å‚¨ç›´æ¥è¿æ¥åˆ°<code>NFS</code>ç³»ç»Ÿä¸Šï¼Œè¿™æ ·ï¼Œæ— è®º<code>Pod</code>åœ¨èŠ‚ç‚¹ä¸Šæ€ä¹ˆè½¬ç§»ï¼Œåªè¦<code>Node</code>å’Œ<code>NFS</code>çš„å¯¹æ¥æ²¡æœ‰é—®é¢˜ï¼Œæ•°æ®å°±å¯ä»¥æˆåŠŸè®¿é—®</li>
</ul>
</blockquote>
<hr>
<h4 id="font-colorredç¼–è¾‘fontnfs-volumeyamlfont-colorredæ–‡ä»¶æŒ‚è½½fontnfs"><!-- raw HTML omitted -->ç¼–è¾‘<!-- raw HTML omitted --><code>nfs-volume.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶æŒ‚è½½<!-- raw HTML omitted --><code>NFS</code></h4>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-nfs-template.yaml" rel="external" target="_self"><code>Kubernetes NFS Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-volume-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­çš„ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log/nginx</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /logs/access.log&#34;</span>]        <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:      <span style="color:#75715e"># å£°æ˜volume</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nfs</span>:        <span style="color:#75715e"># å­˜å‚¨ç±»å‹ï¼Œå’Œåº•å±‚æ­£åˆ™çš„å­˜å‚¨å¯¹åº”</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.18.100</span>    <span style="color:#75715e"># NFSæœåŠ¡å™¨åœ°å€</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/nfs     </span> <span style="color:#75715e"># å…±äº«æ–‡ä»¶è·¯å¾„</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e"># æ˜¯å¦åªè¯»ï¼Œé»˜è®¤false</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="é«˜çº§å­˜å‚¨">é«˜çº§å­˜å‚¨</h2>
<h3 id="pvæŒä¹…å·"><code>PV</code>æŒä¹…å·</h3>
<ul>
<li>
<ol>
<li><code>PV(Persistent Volume)</code><!-- raw HTML omitted -->æ˜¯æŒä¹…åŒ–å·çš„æ„æ€ï¼Œæ˜¯å¯¹åº•å±‚çš„å…±äº«å­˜å‚¨çš„ä¸€ç§æŠ½è±¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹<code>PV</code>ç”±<code>kubernetes</code>ç®¡ç†å‘˜è¿›è¡Œåˆ›å»ºå’Œé…ç½®ï¼Œå®ƒå’Œåº•å±‚å…·ä½“çš„å…±äº«å­˜å‚¨æŠ€æœ¯æœ‰å…³ï¼Œå¹¶é€šè¿‡æ’ä»¶å®Œæˆå’Œå…±äº«å­˜å‚¨çš„å¯¹æ¥<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><code>pv</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><!-- raw HTML omitted -->å…³é”®é…ç½®<!-- raw HTML omitted --><!-- raw HTML omitted -->å‚æ•°è¯´æ˜<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å­˜å‚¨ç±»å‹ï¼š<!-- raw HTML omitted -->åº•å±‚å®é™…å­˜å‚¨çš„ç±»å‹ï¼Œ<code>kubernetes</code>æ”¯æŒå¤šç§å­˜å‚¨ç±»å‹ï¼Œæ¯ç§å­˜å‚¨ç±»å‹çš„é…ç½®æœ‰æ‰€ä¸åŒ</li>
<li>
<ol start="2">
<li><code>capacity</code><!-- raw HTML omitted -->(å­˜å‚¨èƒ½åŠ›)ï¼š<!-- raw HTML omitted -->ç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®<code>storage=1Gi</code>ï¼Œä¸è¿‡æœªæ¥å¯èƒ½ä¼šåŠ å…¥<code>IOPS</code>ã€ååé‡ç­‰æŒ‡æ ‡çš„é…ç½®</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>accessModes</code><!-- raw HTML omitted -->(è®¿é—®æ¨¡å¼)ï¼š<!-- raw HTML omitted -->ç”¨æ¥æè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™ï¼Œè®¿é—®æƒé™åŒ…æ‹¬ä¸‹é¢å‡ ç§æ–¹å¼</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„è®¿é—®æ¨¡å¼ä¸åŒ<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>ReadWriteOnce(RWO)</code><!-- raw HTML omitted -->ï¼šè¯»å†™æƒé™ï¼Œ<!-- raw HTML omitted -->ä½†æ˜¯åªèƒ½è¢«å•ä¸ªèŠ‚ç‚¹æŒ‚è½½</p>
</li>
<li>
<p><code>ReadOnlyMany(ROX)</code><!-- raw HTML omitted -->ï¼šåªè¯»æƒé™ï¼Œ<!-- raw HTML omitted -->å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</p>
</li>
<li>
<p><code>ReadWriteMany(RWX)</code><!-- raw HTML omitted -->ï¼šè¯»å†™æƒé™ï¼Œ<!-- raw HTML omitted -->å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</p>
</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>persistentVolumeReclaimPolicy</code><!-- raw HTML omitted -->(å›æ”¶ç­–ç•¥)ï¼š<!-- raw HTML omitted -->å½“<code>PV</code>ä¸å†è¢«ä½¿ç”¨ä¹‹åï¼Œå¯¹å…¶çš„å¤„ç†æ–¹å¼ï¼Œç›®å‰æ”¯æŒä¸‰ç§ç­–ç•¥</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„å›æ”¶ç­–ç•¥ä¸åŒ<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Retain</code><!-- raw HTML omitted -->(ä¿ç•™)ï¼š<!-- raw HTML omitted -->ä¿ç•™æ•°æ®ï¼Œéœ€è¦ç®¡ç†å‘˜æ‰‹åŠ¨æ¸…ç†æ•°æ®</p>
</li>
<li>
<p><code>Recycle</code><!-- raw HTML omitted -->(å›æ”¶)ï¼š<!-- raw HTML omitted -->æ¸…é™¤<code>PV</code>ä¸­çš„æ•°æ®ï¼Œæ•ˆæœç›¸å½“äº<code>rm -rf /volume/*</code></p>
</li>
<li>
<p><code>Delete</code><!-- raw HTML omitted -->(åˆ é™¤)ï¼š<!-- raw HTML omitted -->å’Œ<code>PV</code>ç›¸è¿çš„åç«¯å­˜å‚¨å®Œæˆ<code>volume</code>çš„åˆ é™¤æ“ä½œï¼Œå¸¸è§äºäº‘æœåŠ¡å™¨å‚å•†çš„å­˜å‚¨æœåŠ¡</p>
</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="5">
<li><code>storageClassName</code><!-- raw HTML omitted -->(å­˜å‚¨ç±»åˆ«)ï¼š<!-- raw HTML omitted --><code>PV</code>å¯ä»¥é€šè¿‡<code>storageClassName</code>å‚æ•°æŒ‡å®šä¸€ä¸ªå­˜å‚¨ç±»åˆ«</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>å…·æœ‰ç‰¹å®šç±»å‹çš„<code>PV</code>åªèƒ½å’Œè¯·æ±‚äº†è¯¥ç±»åˆ«çš„<code>PVC</code>è¿›è¡Œç»‘å®š</li>
<li>æœªè®¾å®šç±»åˆ«çš„<code>PV</code>åªèƒ½å’Œä¸è¯·æ±‚ä»»ä½•ç±»åˆ«çš„<code>PVC</code>è¿›è¡Œç»‘å®š</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="6">
<li><code>status</code><!-- raw HTML omitted -->(çŠ¶æ€)ï¼š<!-- raw HTML omitted -->ä¸€ä¸ª<code>PV</code>çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯èƒ½ä¼šå¤„äº4ç§ä¸åŒçš„é˜¶æ®µ</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Available</code><!-- raw HTML omitted -->(å¯ç”¨)ï¼š<!-- raw HTML omitted -->è¡¨ç¤ºå¯ç”¨çŠ¶æ€ï¼Œè¿˜æœªè¢«ä»»ä½•<code>PVC</code>ç»‘å®š</li>
<li><code>Bound</code><!-- raw HTML omitted -->(å·²ç»‘å®š)ï¼š<!-- raw HTML omitted -->è¡¨ç¤º<code>PV</code>å·²ç»è¢«<code>PVC</code>ç»‘å®š</li>
<li><code>Released</code><!-- raw HTML omitted -->(å·²é‡Šæ”¾)ï¼š<!-- raw HTML omitted -->è¡¨ç¤º<code>PVC</code>è¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æ²¡æœ‰è¢«é›†ç¾¤é‡æ–°é‡Šæ”¾</li>
<li><code>Failed</code><!-- raw HTML omitted -->(å¤±è´¥)ï¼š<!-- raw HTML omitted -->è¡¨ç¤ºè¯¥<code>PV</code>çš„è‡ªåŠ¨å›æ”¶å¤±è´¥</li>
</ul>
</blockquote>
<ul>
<li><code>PV</code>ï¼š<code>kubernetes</code><!-- raw HTML omitted -->ç®¡ç†å‘˜ç»´æŠ¤<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<h4 id="æ„å»ºfont-colorredé™æ€fontpvå­˜å‚¨å·">æ„å»º<!-- raw HTML omitted -->é™æ€<!-- raw HTML omitted --><code>PV</code>å­˜å‚¨å·</h4>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-pv-template.yaml" rel="external" target="_self"><code>Kubernetes PV Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">##########   å®šä¹‰Redisçš„é™æ€ PVæŒä¹…å·   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pv-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pv-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">capacity</span>:     <span style="color:#75715e"># å­˜å‚¨èƒ½åŠ›ï¼Œç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Gi      </span> <span style="color:#75715e"># é™åˆ¶å®¹é‡ä¸º 10G</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMode</span>: <span style="color:#ae81ff">Filesystem   </span> <span style="color:#75715e"># å­˜å‚¨ç±»å‹ä¸ºæ–‡ä»¶ç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:          <span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany      </span> <span style="color:#75715e"># Readï¼šè¯»ã€Writeï¼šå†™ã€Onceï¼šå•èŠ‚ç‚¹ã€Manyï¼šä»£è¡¨å¤šèŠ‚ç‚¹ï¼ŒOnlyï¼šåªè¯»åªå†™</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeReclaimPolicy</span>: <span style="color:#ae81ff">Retain  </span> <span style="color:#75715e"># å›æ”¶ç­–ç•¥ï¼šRetainï¼šä¿ç•™ã€Recycleï¼šå›æ”¶ã€Deleteï¼šåˆ é™¤</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs        </span> <span style="color:#75715e"># åˆ›å»º PV çš„å­˜å‚¨ç±»çš„è‡ªå®šä¹‰åå­—ï¼ŒPVCéœ€è¦äºæ­¤ç›¸åŒï¼Œå­˜å‚¨ç±»å‹ï¼Œåˆ†åˆ«ä¸ºï¼š NFSã€CephFSã€iSCSI</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mountOptions</span>:         <span style="color:#75715e"># åŠ è½½é…ç½®</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">hard</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">nfsvers=4.1        </span> <span style="color:#75715e"># NFS ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nfs</span>:          <span style="color:#75715e"># å­˜å‚¨ç±»å‹ï¼Œå’ŒstorageClassNameçš„å­˜å‚¨ç±»åˆ«å¯¹åº”</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/redis      </span> <span style="color:#75715e"># nfs æˆæƒç›®å½•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.186.110</span>     <span style="color:#75715e"># nfs æ‰€åœ¨æœåŠ¡å™¨PVæŒä¹…å·</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--- <span style="color:#75715e"># åˆ†éš”ç¬¦å¯ä»¥å®šä¹‰å¤šä¸ª</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   å®šä¹‰Nginxçš„é™æ€ PVæŒä¹…å·   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pv-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pv-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">capacity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Gi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMode</span>: <span style="color:#ae81ff">Filesystem</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeReclaimPolicy</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mountOptions</span>:         <span style="color:#75715e"># åŠ è½½é…ç½®</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">hard</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">nfsvers=4.1        </span> <span style="color:#75715e"># NFS ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nfs</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.186.110</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="æ„å»ºfont-colorredåŠ¨æ€fontpvå­˜å‚¨å·">æ„å»º<!-- raw HTML omitted -->åŠ¨æ€<!-- raw HTML omitted --><code>PV</code>å­˜å‚¨å·</h4>
<ul>
<li>
<ol>
<li><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/" rel="external" target="_self"><code>StorageClass</code>åŠ¨æ€èµ„æºå­˜å‚¨</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-storageclass-template.yaml" rel="external" target="_self"><code>Kubernetes StorageClass Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">storage.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StorageClass   </span> <span style="color:#75715e"># åˆ›å»ºåŠ¨æ€å­˜å‚¨ç±»</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-storage-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageclass.kubernetes.io/is-default-class</span>: <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">provisioner</span>: <span style="color:#ae81ff">fuseim.pri/ifs    </span> <span style="color:#75715e"># å¤–éƒ¨åˆ¶å¤‡å™¨æä¾›è€…ï¼Œç¼–å†™ä¸ºæä¾›è€…çš„åç§°ï¼Œk8s-sigs.io/nfs-subdir-external-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">allowVolumeExpansion</span>: <span style="color:#66d9ef">true</span>      <span style="color:#75715e"># åŠ¨æ€è°ƒæ•´æŒä¹…å·å¤§å°</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">parameters</span>:     <span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">archiveOnDelete</span>: <span style="color:#e6db74">&#34;true&#34;</span>       <span style="color:#75715e"># æ˜¯å¦å­˜æ¡£ï¼Œfalseï¼šè¡¨ç¤ºä¸å­˜æ¡£ï¼Œä¼šåˆ é™¤oldPathä¸‹é¢çš„æ•°æ®ï¼Œtrueï¼šè¡¨ç¤ºå­˜æ¡£ï¼Œä¼šé‡å‘½åè·¯å¾„</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">reclaimPolicy</span>: <span style="color:#ae81ff">Retain  </span> <span style="color:#75715e"># å›æ”¶ç­–ç•¥ï¼Œé»˜è®¤ä¸ºï¼šDeleteï¼Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">volumeBindingMode</span>: <span style="color:#ae81ff">Immediate   </span> <span style="color:#75715e"># é»˜è®¤ä¸ºï¼šImmediateï¼Œè¡¨ç¤ºåˆ›å»º PVCç«‹å³è¿›è¡Œç»‘å®šï¼Œåªæœ‰ï¼šazurediskå’Œï¼šAWSelasticblockstore æ”¯æŒå…¶ä»–å€¼</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºæƒé™ï¼Œ<!-- raw HTML omitted --><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Permissions/kubernetes-permissions-template.yaml" rel="external" target="_self"><code>Kubernetes Permissions Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount   </span> <span style="color:#75715e"># æƒé™ç®¡ç†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole  </span> <span style="color:#75715e"># åˆ›å»ºé›†ç¾¤è§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner-runner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;nodes&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;persistentvolumes&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;delete&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;persistentvolumeclaims&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;storage.k8s.io&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;storageclasses&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;events&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;patch&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRoleBinding   </span> <span style="color:#75715e"># ç»‘å®šé›†ç¾¤è§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">run-nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner-runner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role   </span> <span style="color:#75715e"># åˆ›å»ºæ™®é€šè§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">leader-locking-nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;endpoints&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;patch&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">RoleBinding  </span> <span style="color:#75715e"># ç»‘å®šæ™®é€šè§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">leader-locking-nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">leader-locking-nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºé€‚ç”¨ä¸<!-- raw HTML omitted --><code>provisioner</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>Deployment</code><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-deployment-provisioner-nfs-template.yaml" rel="external" target="_self"><code>Kubernetes Deployment Provisioner NFS Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: apps/v1
</span></span><span style="display:flex;"><span>kind: Deployment
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: nfs-client-provisioner
</span></span><span style="display:flex;"><span>  namespace: default
</span></span><span style="display:flex;"><span>  labels:
</span></span><span style="display:flex;"><span>    app: nfs-client-provisioner
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  replicas: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  strategy:
</span></span><span style="display:flex;"><span>    type: Recreate      <span style="color:#75715e"># Recreate:ä¸æ»šåŠ¨æ›´æ–°ï¼Œ</span>
</span></span><span style="display:flex;"><span>  selector:
</span></span><span style="display:flex;"><span>    matchLabels:
</span></span><span style="display:flex;"><span>      app: nfs-client-provisioner
</span></span><span style="display:flex;"><span>  template:
</span></span><span style="display:flex;"><span>    metadata:
</span></span><span style="display:flex;"><span>      labels:
</span></span><span style="display:flex;"><span>        app: nfs-client-provisioner
</span></span><span style="display:flex;"><span>    spec:
</span></span><span style="display:flex;"><span>      hostNetwork: true
</span></span><span style="display:flex;"><span>      serviceAccountName: nfs-client-provisioner        <span style="color:#75715e"># å…³è”ï¼šnfs-client-provisioner è´¦å·æˆä¸è´¦æˆ·æƒé™</span>
</span></span><span style="display:flex;"><span>      containers:
</span></span><span style="display:flex;"><span>      - name: nfs-client-provisioner
</span></span><span style="display:flex;"><span>        image: registry.cn-beijing.aliyuncs.com/pylixm/nfs-subdir-external-provisioner:v4.0.0
</span></span><span style="display:flex;"><span>        resources:
</span></span><span style="display:flex;"><span>          limits:
</span></span><span style="display:flex;"><span>            cpu: 200m
</span></span><span style="display:flex;"><span>            memory: 128Mi
</span></span><span style="display:flex;"><span>          requests:
</span></span><span style="display:flex;"><span>            cpu: 50m
</span></span><span style="display:flex;"><span>            memory: 64Mi
</span></span><span style="display:flex;"><span>        volumeMounts:
</span></span><span style="display:flex;"><span>        - name: nfs-client-root
</span></span><span style="display:flex;"><span>          mountPath: /persistentvolumes
</span></span><span style="display:flex;"><span>        env:
</span></span><span style="display:flex;"><span>        - name: PROVISIONER_NAME
</span></span><span style="display:flex;"><span>          value: fuseim.pri/ifs   <span style="color:#75715e"># å¿…é¡»å’ŒStorageClassçš„å¤–éƒ¨åˆ¶å¤‡å™¨æä¾›è€…åå­—ç›¸åŒ</span>
</span></span><span style="display:flex;"><span>        - name: NFS_SERVER
</span></span><span style="display:flex;"><span>          value: 192.168.186.110        <span style="color:#75715e"># æŒ‡å®šè‡ªå·±nfsæœåŠ¡å™¨åœ°å€</span>
</span></span><span style="display:flex;"><span>        - name: NFS_PATH  
</span></span><span style="display:flex;"><span>          value: /opt/data/redis        <span style="color:#75715e"># nfsæœåŠ¡å™¨å…±äº«çš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>      volumes:
</span></span><span style="display:flex;"><span>      - name: nfs-client-root
</span></span><span style="display:flex;"><span>        nfs:
</span></span><span style="display:flex;"><span>          server: 192.168.186.110
</span></span><span style="display:flex;"><span>          path: /opt/data/redis</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>Service</code>ã€<code>StatefulSet</code>ã€<code>PVC</code><!-- raw HTML omitted -->ç”³è¯·åŠ¨æ€å­˜å‚¨å·<!-- raw HTML omitted --><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-svc-statefulset-storage-nfs-template.yaml" rel="external" target="_self"><code>Kubernetes Service StatefulSet NFS Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">service-template</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>    <span style="color:#75715e"># Serviceçš„ç«¯å£</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>      <span style="color:#75715e"># StatefulSet çš„Podç«¯å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StatefulSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceName</span>: <span style="color:#ae81ff">service-template  </span> <span style="color:#75715e"># ä½¿ç”¨é‚£ä¸ªServiceç®¡ç†DNS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">updateStrategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate        </span> <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°ï¼ŒOnDeleteï¼šåˆ é™¤æ›´æ–°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:      <span style="color:#75715e"># å¦‚æœæ›´æ–°çš„ç­–ç•¥æ˜¯OnDeleteï¼Œé‚£ä¹ˆrollingUpdateå°±å¤±æ•ˆ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">partition</span>: <span style="color:#ae81ff">2</span>      <span style="color:#75715e"># è¡¨ç¤ºä»ç¬¬2ä¸ªåˆ†åŒºå¼€å§‹æ›´æ–°ï¼Œé»˜è®¤æ˜¯0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pvc-test  	# å…³è” PVC åå­—ï¼Œä»¥ä¾¿ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/usr/share/nginx/html</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeClaimTemplates</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pvc-test   </span> <span style="color:#75715e"># å®šä¹‰ï¼šPVC åå­—</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs-storage-template   </span> <span style="color:#75715e"># å­˜å‚¨ç±»åå­—ï¼Œå¿…é¡»å’ŒStorageClassçš„podsåå­—ç›¸åŒ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">accessModes</span>:      <span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">ReadWriteMany  </span> <span style="color:#75715e"># å¤šèŠ‚ç‚¹è¯»å†™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resources</span>:        <span style="color:#75715e"># æœŸæœ›èµ„æº</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">2Gi         </span> <span style="color:#75715e"># æœŸæœ›çš„ç©ºé—´å®¹é‡</span></span></span></code></pre></div><ul>
<li><code>StatefulSet</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>Pods</code><!-- raw HTML omitted -->å¤„äº<!-- raw HTML omitted --><code>Pending</code><!-- raw HTML omitted -->çŠ¶æ€ï¼Œ<!-- raw HTML omitted --><code>describe</code><!-- raw HTML omitted -->å‘½ä»¤æŸ¥çœ‹æœ‰ä»¥ä¸‹æŠ¥é”™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>0/3 nodes are available: pod has unbound immediate PersistentVolumeClaims. preemption: 0/3 nodes are available: 3 No preemption victims found for incoming pod..</code></li>
<li><code>quay.io/external_storage/nfs-client-provisioner:latest</code><!-- raw HTML omitted -->å®˜æ–¹é•œåƒéœ€è¦ç”¨åˆ°<!-- raw HTML omitted --><code>K8S</code><!-- raw HTML omitted -->é‡Œçš„<!-- raw HTML omitted --><code>SelfLink</code><!-- raw HTML omitted -->å‚æ•°<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->è§£å†³æ–¹æ³•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ–¹æ³•ä¸€ï¼šæ›´æ¢é•œåƒï¼Œå»ºè®®ä½¿ç”¨æ­¤æ–¹æ³•</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é•œåƒä¸€</span>
</span></span><span style="display:flex;"><span>gcr.io/k8s/staging-sig-storage/nfs-subdir-external-provisioner:v4.0.0
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é•œåƒäºŒ</span>
</span></span><span style="display:flex;"><span>registry.cn-beijing.aliyuncs.com/pylixm/nfs-subdir-external-provisioner:v4.0.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ¢é•œåƒåé‡æ–°åº”ç”¨</span>
</span></span><span style="display:flex;"><span>$ kubectl replace -f kubernetes-deployment-provisioner-nfs-template.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–¹æ³•äºŒï¼šè§£å†³å®˜æ–¹ä¸æ”¯æŒæ–¹å¼</span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;&gt;/etc/kubernetes/manifests/kube-apiserver.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - command:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kube-apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --feafure-gates=RemoveSelfLink=false  	# æ–°å¢å‚æ•°ï¼Œé»˜è®¤æ˜¯ï¼štrue 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°åº”ç”¨</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f /etc/kubernetes/manifests/kube-apiserver.yaml</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>PVC</code> <!-- raw HTML omitted -->æ–¹å¼ç”³è¯·åŠ¨æ€<!-- raw HTML omitted --><code>StorageClass</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">200Mi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs-storage-template   </span> <span style="color:#75715e"># å­˜å‚¨ç±»åå­—ï¼Œå¿…é¡»å’ŒStorageClassçš„podsåå­—ç›¸	</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="pvcæŒä¹…å·ç”³è¯·ä¹¦"><code>PVC</code>æŒä¹…å·ç”³è¯·ä¹¦</h3>
<ul>
<li>
<ol>
<li><code>PVC(Persistent Volume Claim)</code>æ˜¯æŒä¹…åŒ–å·å£°æ˜çš„æ„æ€ï¼Œæ˜¯ç”¨æˆ·å¯¹äºå­˜å‚¨éœ€æ±‚çš„ä¸€ç§å£°æ˜ã€‚æ¢è¨€ä¹‹ï¼ŒPVCå…¶å®å°±æ˜¯ç”¨æˆ·å‘<code>kubernetes</code>ç³»ç»Ÿå‘å‡ºçš„ä¸€ç§èµ„æºéœ€æ±‚ç”³è¯·</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>PVC</code>ï¼š<code>kubernetes</code>ç”¨æˆ·ç»´æŠ¤</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>PVC</code>æ˜¯èµ„æºçš„ç”³è¯·ï¼Œç”¨æ¥å£°æ˜å¯¹å­˜å‚¨ç©ºé—´ã€è®¿é—®æ¨¡å¼ã€å­˜å‚¨ç±»åˆ«éœ€æ±‚ä¿¡æ¯</li>
</ol>
</li>
<li>
<ol start="4">
<li><code>PVC</code><!-- raw HTML omitted -->çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>accessModes</code>(è®¿å®¢æ¨¡å¼)ï¼šç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™</li>
</ul>
<blockquote>
<ul>
<li><code>selector</code>(é€‰æ‹©æ¡ä»¶)ï¼šé€šè¿‡<code>Label Selector</code>çš„è®¾ç½®ï¼Œå¯ä½¿<code>PVC</code>å¯¹äºç³»ç»Ÿä¸­å·²å­˜åœ¨çš„<code>PV</code>è¿›è¡Œç­›é€‰</li>
<li><code>storageClassName</code>(å­˜å‚¨ç±»åˆ«)ï¼š<code>PVC</code>åœ¨å®šä¹‰æ—¶å¯ä»¥è®¾å®šéœ€è¦çš„åç«¯å­˜å‚¨çš„ç±»åˆ«ï¼Œåªæœ‰è®¾ç½®äº†è¯¥<code>class</code>çš„<code>pv</code>æ‰èƒ½è¢«ç³»ç»Ÿé€‰å‡º</li>
<li><code>resources</code>(èµ„æºè¯·æ±‚)ï¼šæè¿°å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚</li>
</ul>
</blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-pvc-template.yaml" rel="external" target="_self"><code>Kubernetes PVC Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">##########   å®šä¹‰Redisçš„PVCç”³è¯·ä¹¦ï¼Œç”¨äºç”³è¯· Redisçš„PV   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pvc-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMode</span>: <span style="color:#ae81ff">Filesystem       </span> <span style="color:#75715e"># æ–‡ä»¶ç³»ç»Ÿä¹Ÿéœ€è¦ä¸ PVç›¸åŒæ‰èƒ½ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:          <span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany      </span> <span style="color:#75715e"># æƒé™éœ€è¦ä¸å¯¹åº”çš„PV ç›¸åŒï¼Œæ‰å¯ä»¥ä½¿ç”¨ï¼ŒReadï¼šè¯»ã€Writeï¼šå†™ã€Onceï¼šå•èŠ‚ç‚¹ã€Manyï¼šä»£è¡¨å¤šèŠ‚ç‚¹ï¼ŒOnlyï¼šåªè¯»åªå†™</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs        </span> <span style="color:#75715e"># éœ€è¦ä¸PVåå­—ç›¸åŒï¼ŒBlock:ä»£è¡¨å—å­˜å‚¨ã€Filesystem:ä»£è¡¨æ–‡ä»¶ç³»ç»Ÿã€nfs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:    <span style="color:#75715e"># è¯·æ±‚ç©ºé—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">5Gi     </span> <span style="color:#75715e"># å¯¹PVç”³è¯· 5G çš„å­˜å‚¨ç©ºé—´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   å®šä¹‰Nginxçš„PVCç”³è¯·ä¹¦ï¼Œç”¨äºç”³è¯· Redisçš„PV   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pvc-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMode</span>: <span style="color:#ae81ff">Filesystem</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:          <span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany      </span> <span style="color:#75715e"># Read:ä»£è¡¨å¯è¯»ã€Write:ä»£è¡¨å†™ã€Many:ä»£è¡¨å¤šèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs        </span> <span style="color:#75715e"># å­˜å‚¨ç±»å‹ ï¼ŒBlock:ä»£è¡¨å—å­˜å‚¨ã€Filesystem:ä»£è¡¨æ–‡ä»¶ç³»ç»Ÿã€nfs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:    <span style="color:#75715e"># è¯·æ±‚ç©ºé—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">5Gi     </span> <span style="color:#75715e"># å¯¹PVç”³è¯· 5G çš„å­˜å‚¨ç©ºé—´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########      åˆ›å»º Deployment è®¿é—® PVC ç±»å‹å­˜å‚¨   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pod-pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pod-pvc-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:      <span style="color:#75715e"># å½“typeä¸ºRollingUpdateçš„æ—¶å€™ç”Ÿæ•ˆï¼Œç”¨äºä¸ºrollingUpdateè®¾ç½®å‚æ•°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%      </span> <span style="color:#75715e"># ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%    </span> <span style="color:#75715e"># ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate        </span> <span style="color:#75715e"># æ›´æ–°ç­–ç•¥ã€æ”¯æŒ Recreate, RollingUpdateã€‚é»˜è®¤RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:     <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:        <span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™ï¼ŒmatchExpressionsï¼šExpressionsåŒ¹é…è§„åˆ™ </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:     <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:   <span style="color:#75715e"># Pod çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pvc-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#  nodeSelector:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#    kubernetes.io/hostname: kube-01     # æŒ‡å®šèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">reids</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">redis:6.2.7</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;while true;do echo pod1 &gt;&gt; /root/out.txt; sleep 10; done;&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-data       </span> <span style="color:#75715e"># å¿…é¡»ä¸volumeå®šä¹‰çš„åç§°ç›¸åŒ</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/opt/redis/conf       </span> <span style="color:#75715e"># å®¹å™¨å†…è·¯å¾„</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-data   </span> <span style="color:#75715e"># è‡ªå®šä¹‰åç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">persistentVolumeClaim</span>:      <span style="color:#75715e"># å…³è” PVC</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">claimName</span>: <span style="color:#ae81ff">redis-pvc-template    </span> <span style="color:#75715e"># å…³è” PVCï¼Œå¿…é¡»å’Œå®šä¹‰PVCåç§°ç›¸åŒä¸”ï¼Œå¿…é¡»å’Œå½“å‰podåœ¨åŒä¸€ä¸ªå‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e"># æ˜¯å¦åªè¯»ï¼Œé»˜è®¤false</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="pvfont-colorredå’Œfontpvc"><code>PV</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PVC</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>PVC</code><!-- raw HTML omitted -->åä¸€ç›´ç»‘å®šä¸äº†<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->çš„åŸå› <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p>â‘  <code>PVC</code><!-- raw HTML omitted -->çš„ç©ºé—´ç”³è¯·å¤§å°æ¯”<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->çš„ç©ºé—´è¦å¤§<!-- raw HTML omitted --></p>
<p>â‘¡ <code>PVC</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>storageClassName</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>storageClassName</code><!-- raw HTML omitted -->ä¸ä¸€è‡´<!-- raw HTML omitted --></p>
<p>â‘¢ <code>PVC</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>accessModes</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>accessModes</code><!-- raw HTML omitted -->ä¸ä¸€è‡´<!-- raw HTML omitted --></p>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>PVC</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->æ˜¯ä¸€ä¸€å¯¹åº”ï¼Œ<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PVC</code><!-- raw HTML omitted -->ä¹‹é—´çš„ç›¸äº’ä½œç”¨éµå¾ªå¦‚ä¸‹ç”Ÿå‘½å‘¨æœŸ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->èµ„æºä¾›åº”ï¼š<!-- raw HTML omitted -->ç®¡ç†å‘˜æ‰‹åŠ¨åˆ›å»ºåº•å±‚å­˜å‚¨å’Œ<code>PV</code></li>
<li><!-- raw HTML omitted -->èµ„æºç»‘å®š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ç”¨æˆ·åˆ›å»º<code>PVC</code>ï¼Œ<code>kubernetes</code>è´Ÿè´£æ ¹æ®<code>PVC</code>å£°æ˜å»å¯»æ‰¾<code>PV</code>ï¼Œå¹¶ç»‘å®šåœ¨ç”¨æˆ·å®šä¹‰å¥½<code>PVC</code>ä¹‹åï¼Œç³»ç»Ÿå°†æ ¹æ®<code>PVC</code>å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚åœ¨ä»¥å­˜åœ¨çš„<code>PV</code>ä¸­é€‰æ‹©ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„</li>
</ul>
<blockquote>
<ul>
<li>ä¸€æ—¦æ‰¾åˆ°å°±å°†è¯¥<code>PV</code>å’Œç”¨æˆ·å®šä¹‰çš„<code>PVC</code>è¿›è¡Œç»‘å®šï¼Œç”¨æˆ·çš„åº”ç”¨å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ª<code>PVC</code>äº†</li>
<li>å¦‚æœæ‰¾ä¸åˆ°<code>PVC</code>å°±ä¼šæ— é™æœŸçš„å¤„äº<code>Pending</code>çŠ¶æ€ï¼Œç›´åˆ°ç³»ç»Ÿç®¡ç†å‘˜åˆ›å»ºä¸€ä¸ªç¬¦åˆå…¶è¦æ±‚çš„<code>PV</code></li>
</ul>
</blockquote>
<ul>
<li><code>PV</code>ä¸€æ—¦ç»‘å®šåˆ°æŸä¸ª<code>PVC</code>ä¸Šå°±ä¼šè¢«è¿™ä¸ª<code>PVC</code>ç‹¬å ï¼Œä¸èƒ½å†å’Œå…¶ä»–çš„<code>PVC</code>è¿›è¡Œç»‘å®šäº†</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->èµ„æºä½¿ç”¨ï¼š<!-- raw HTML omitted -->ç”¨æˆ·å¯ä»¥åœ¨<code>Pod</code>ä¸­åƒ<code>volume</code>ä¸€æ ·ä½¿ç”¨<code>PVC</code>ï¼Œ<code>Pod</code>ä½¿ç”¨<code>Volume</code>çš„å®šä¹‰ï¼Œå°†<code>PVC</code>æŒ‚è½½åˆ°å®¹å™¨å†…çš„æŸä¸ªè·¯å¾„è¿›è¡Œä½¿ç”¨</li>
<li><!-- raw HTML omitted -->èµ„æºé‡Šæ”¾<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ç”¨æˆ·åˆ é™¤<code>PVC</code>æ¥é‡Šæ”¾<code>PV</code></li>
<li>å½“å­˜å‚¨èµ„æºä½¿ç”¨å®Œæ¯•åï¼Œç”¨æˆ·å¯ä»¥åˆ é™¤<code>PVC</code>ï¼Œå’Œè¯¥<code>PVC</code>ç»‘å®šçš„<code>PV</code>å°†ä¼šæ ‡è®°ä¸º<!-- raw HTML omitted -->å·²é‡Šæ”¾<!-- raw HTML omitted -->ä½†æ˜¯è¿˜ä¸èƒ½ç«‹åˆ»å’Œå…¶ä»–çš„<code>PVC</code>è¿›è¡Œç»‘å®šã€‚é€šè¿‡ä¹‹å‰<code>PVC</code>å†™å…¥çš„æ•°æ®å¯èƒ½è¿˜ç•™åœ¨å­˜å‚¨è®¾å¤‡ä¸Šï¼Œåªæœ‰åœ¨æ¸…é™¤ä¹‹åè¯¥<code>PV</code>æ‰èƒ½å†æ¬¡ä½¿ç”¨</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->èµ„æºå›æ”¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>kubernetes</code>æ ¹æ®<code>PV</code>è®¾ç½®çš„å›æ”¶ç­–ç•¥è¿›è¡Œèµ„æºçš„å›æ”¶</li>
<li>å¯¹äº<code>PV</code>ï¼Œç®¡ç†å‘˜å¯ä»¥è®¾å®šå›æ”¶ç­–ç•¥ï¼Œç”¨äºè®¾ç½®ä¸ä¹‹ç»‘å®šçš„<code>PVC</code>é‡Šæ”¾èµ„æºä¹‹åå¦‚ä½•å¤„ç†é—ç•™æ•°æ®çš„é—®é¢˜ã€‚åªæœ‰<code>PV</code>çš„å­˜å‚¨ç©ºé—´å®Œæˆå›æ”¶ï¼Œæ‰èƒ½ä¾›æ–°çš„<code>PVC</code>ç»‘å®šå’Œä½¿ç”¨</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h2 id="é…ç½®æ–‡ä»¶å­˜å‚¨ç®¡ç†">é…ç½®æ–‡ä»¶å­˜å‚¨ç®¡ç†</h2>
<h3 id="configmapfont-colorredfontsecretfont-colorredè¦†ç›–fontmarkçƒ­æ›´æ–°mark"><code>ConfigMap</code><!-- raw HTML omitted -->&amp;<!-- raw HTML omitted --><code>Secret</code><!-- raw HTML omitted -->è¦†ç›–<!-- raw HTML omitted --><!-- raw HTML omitted -->çƒ­æ›´æ–°<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æ³¨æ„äº‹é¡¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>SubPath</code><!-- raw HTML omitted -->è§£å†³<!-- raw HTML omitted --><code>ConfigMap</code><!-- raw HTML omitted -->&amp;&amp;<!-- raw HTML omitted --><code>Secret</code><!-- raw HTML omitted -->ç›®å½•è¦†ç›–é—®é¢˜ï¼Œ<!-- raw HTML omitted --><code>SubPath</code><!-- raw HTML omitted -->ä¸æ”¯æŒçƒ­æ›´æ–°<!-- raw HTML omitted --></li>
<li>å¦‚æœ<code>ConfigMap</code>å’Œ<code>Secret</code>æ˜¯ä»¥<code>subPath</code>çš„å½¢å¼æŒ‚è½½çš„ï¼Œé‚£ä¹ˆ<code>Pod</code>æ˜¯ä¸ä¼šæ„ŸçŸ¥åˆ°<code>ConfigMap</code>å’Œ<code>Secret</code>çš„æ›´æ–°çš„</li>
<li>å¦‚æœ<code>Pod</code>çš„å˜é‡æ¥è‡ª<code>ConfigMap</code>å’Œ<code>Secret</code>ä¸­å®šä¹‰çš„å†…å®¹ï¼Œé‚£ä¹ˆ<code>ConfigMap</code>å’Œ<code>Secret</code>æ›´æ–°åï¼Œä¹Ÿä¸ä¼šæ›´æ–°<code>Pod</code>ä¸­çš„å˜é‡</li>
<li><code>immutable: true</code><!-- raw HTML omitted -->ï¼šç¦æ­¢ä¿®æ”¹<!-- raw HTML omitted --><code>ConfigMap</code>ã€<code>Secret</code></li>
</ul>
</blockquote>
<hr>
<h3 id="configmapé…ç½®ç±»å‹"><code>ConfigMap</code>é…ç½®ç±»å‹</h3>
<h4 id="configmapç®€ä»‹ä»¥åŠæ³¨æ„äº‹é¡¹"><code>ConfigMap</code>ç®€ä»‹ä»¥åŠæ³¨æ„äº‹é¡¹</h4>
<blockquote>
<ul>
<li><code>ConfigMap</code><!-- raw HTML omitted -->ï¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„å­˜å‚¨å·ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å­˜å‚¨é…ç½®ä¿¡æ¯çš„<!-- raw HTML omitted --></li>
<li><code>ConfigMap</code>ä¸­çš„<code>key</code>æ˜ å°„ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œ<code>value</code>æ˜ å°„ä¸ºæ–‡ä»¶ä¸­çš„å†…å®¹ã€‚å¦‚æœæ›´æ–°äº†<code>ConfigMap</code>ä¸­çš„å†…å®¹ï¼Œå®¹å™¨ä¸­çš„å€¼ä¹Ÿä¼šåŠ¨æ€æ›´æ–°</li>
<li><code>ConfigMap</code>æ˜¯ä¸€ç§<code>API</code>å¯¹è±¡ï¼Œ<!-- raw HTML omitted -->ç”¨æ¥å°†éåŠ å¯†æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚å¯ä»¥ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>ConfigMap</code><!-- raw HTML omitted -->å¯ä»¥å°†ç¯å¢ƒå˜é‡é…ç½®ä¿¡æ¯å’Œå®¹å™¨é•œåƒè§£è€¦ï¼Œä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹ã€‚å¦‚æœéœ€è¦å­˜å‚¨åŠ å¯†ä¿¡æ¯æ—¶å¯ä»¥ä½¿ç”¨<!-- raw HTML omitted --><code>Secret</code>å¯¹è±¡</li>
<li>ä½¿ç”¨<code>ConfigMap</code><!-- raw HTML omitted -->æœ‰ä»¥ä¸‹å‡ ä¸ªé™åˆ¶æ¡ä»¶ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>ConfigMap</code><!-- raw HTML omitted -->å¿…é¡»<!-- raw HTML omitted -->åœ¨<code>pod</code>ä¹‹å‰åˆ›å»º</li>
<li><code>ConfigMap</code>å—<code>namespace</code>çš„é™åˆ¶ï¼Œ<!-- raw HTML omitted -->åªèƒ½<!-- raw HTML omitted -->ç›¸åŒ<code>namespace</code>çš„<code>pod</code>æ‰å¯ä»¥å¼•ç”¨</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æ³¨æ„äº‹é¡¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>ConfigMap</code><!-- raw HTML omitted -->åœ¨è®¾è®¡ä¸Šä¸æ˜¯ç”¨æ¥ä¿å­˜å¤§é‡æ•°æ®çš„<!-- raw HTML omitted -->åœ¨<code>ConfigMap</code>ä¸­ä¿å­˜çš„æ•°æ®ä¸å¯è¶…è¿‡<code>1 MiB</code></li>
<li>å¦‚æœéœ€è¦ä¿å­˜è¶…å‡ºæ­¤å°ºå¯¸é™åˆ¶çš„æ•°æ®ï¼Œéœ€è¦è€ƒè™‘æŒ‚è½½å­˜å‚¨å·æˆ–è€…ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“æˆ–è€…æ–‡ä»¶æœåŠ¡</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h4 id="configmapä½¿ç”¨ä»¥åŠé…ç½®"><code>ConfigMap</code>ä½¿ç”¨ä»¥åŠé…ç½®</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è·å–ä½¿ç”¨å¸®åŠ©<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create configmap -h  	<span style="color:#75715e"># æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap &lt;map-name&gt; &lt;data-source&gt;  	<span style="color:#75715e"># å‘½ä»¤ä½¿ç”¨æ–¹å¼  </span></span></span></code></pre></div><ul>
<li>ä»<!-- raw HTML omitted -->ç›®å½•<!-- raw HTML omitted -->ä¸­åˆ›å»º<code>ConfigMap</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -pv /opt/yaml/configmap/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;/opt/yaml/configmap/config/db.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port=3306
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">username=root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host=127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;/opt/yaml/configmap/config/redis.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port=6379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host=127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --from-fileï¼šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«ç”¨åœ¨ConfigMapé‡Œé¢åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®çš„åå­—å°±æ˜¯æ–‡ä»¶åï¼Œå€¼å°±æ˜¯æ–‡ä»¶çš„å†…å®¹ï¼Œ  </span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap configmap-template --from-file<span style="color:#f92672">=</span>/opt/yaml/configmap/config/</span></span></code></pre></div><ul>
<li>ä»<!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted -->ä¸­åˆ›å»º<code>ConfigMap</code><!-- raw HTML omitted -->ï¼Œå¹¶è‡ªå®šä¹‰<!-- raw HTML omitted --><code>ConfigMap</code><!-- raw HTML omitted -->ä¸­<!-- raw HTML omitted --><code>key</code><!-- raw HTML omitted -->çš„åç§°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># --from-fileï¼Œå¯ä»¥ä½¿ç”¨å¤šæ¬¡ï¼ŒåŒæ ·é”®ä¸ºæ–‡ä»¶åï¼Œå€¼ä¸ºæ–‡ä»¶ä¸­çš„å†…å®¹</span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap configmap-template-2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-file<span style="color:#f92672">=</span>rename1<span style="color:#f92672">=</span>/opt/yaml/configmap/config/db.properties <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-file<span style="color:#f92672">=</span>rename2<span style="color:#f92672">=</span>/opt/yaml/configmap/config/redis.properties  </span></span></code></pre></div><ul>
<li><code>--from-literal=key=value</code><!-- raw HTML omitted -->é”®å€¼å¯¹æ–¹å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨ï¼šliteral(key:value)ï¼Œæ–¹å¼ï¼Œ--from-literal=key1=123 --from-literal=key2=234</span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap configmap-template-3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-literal<span style="color:#f92672">=</span>key-1<span style="color:#f92672">=</span>value-1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-literal<span style="color:#f92672">=</span>key-2<span style="color:#f92672">=</span>value-2</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä»ç¯å¢ƒå˜é‡æ–‡ä»¶åˆ›å»º<!-- raw HTML omitted --><code>ConfigMap</code></li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->æ³¨æ„ï¼š<!-- raw HTML omitted -->å½“<code>--from-env-file</code>ä»å¤šä¸ªæ•°æ®æºåˆ›å»º<code>ConfigMap</code>çš„æ—¶å€™ï¼Œä»…ä»…æœ€åä¸€ä¸ª<code>env</code>æ–‡ä»¶æœ‰æ•ˆ</p>
</li>
<li>
<p><!-- raw HTML omitted -->è¯­æ³•è§„åˆ™ï¼š<!-- raw HTML omitted --></p>
<p><code>env</code>æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå¿…é¡»ä¸º<code>VAR = VAL</code>æ ¼å¼</p>
<p>ä»¥<code>ï¼ƒ</code>å¼€å¤´çš„è¡Œ(å³æ³¨é‡Š)å°†è¢«å¿½ç•¥</p>
<p>ç©ºè¡Œå°†è¢«å¿½ç•¥</p>
<p>å¼•å·æ²¡æœ‰ç‰¹æ®Šå¤„ç†(å³å®ƒä»¬å°†æˆä¸º<code>ConfigMap</code>å€¼çš„ä¸€éƒ¨åˆ†)</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create configmap configmap-template-3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --from-literal<span style="color:#f92672">=</span>password<span style="color:#f92672">=</span>passwd123 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --from-literal<span style="color:#f92672">=</span>APP_NAME<span style="color:#f92672">=</span>springboot-test <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --from-literal<span style="color:#f92672">=</span>JAVA_OPTS_TEST<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Xms512m -Xmx512&#39;</span>  </span></span></code></pre></div><ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-configmap-env-template.yaml" rel="external" target="_self"><code>Kubernetes ConfigMap ENV Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-env-test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: 
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-env-test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-env-test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">env-test</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">command</span>: [ <span style="color:#e6db74">&#34;/bin/sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;env;sleep 3600&#34;</span> ]
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">env</span>:          <span style="color:#75715e"># å®šä¹‰ç¯å¢ƒå˜é‡</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">APP_ENV_TEST_CM      </span> <span style="color:#75715e"># å®šä¹‰ç¯å¢ƒå˜é‡å</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">configMapKeyRef</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template-3     </span> <span style="color:#75715e"># ConfigMap çš„åå­—</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">key</span>: <span style="color:#ae81ff">APP_NAME  </span> <span style="color:#75715e"># è¡¨ç¤ºä» nameçš„ConfigMapä¸­è·å–åå­—ä¸ºKey çš„valueï¼Œå°†å…¶èµ‹å€¼ç»™å®¹å™¨å†…æœ¬åœ°çš„ç¯å¢ƒå˜é‡ APP_ENV_TEST_CM</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">JAVA_ENV_TEST_CM</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">configMapKeyRef</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template-3     </span> <span style="color:#75715e"># ConfigMap çš„åå­—</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">key</span>: <span style="color:#ae81ff">JAVA_OPTS_TEST    </span> <span style="color:#75715e"># ConfigMap çš„ key</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">volumeMounts</span>:   <span style="color:#75715e"># åŠ è½½æ•°æ®å·</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">passwd-config  </span> <span style="color:#75715e"># è¡¨ç¤ºåŠ è½½ volumes å±æ€§ä¸­é‚£ä¸ªæ•°æ®å·</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">mountPath</span>: <span style="color:#e6db74">&#34;/opt/&#34;</span>    <span style="color:#75715e"># æƒ³è¦å°†æ•°æ®å·ä¸­çš„æ–‡ä»¶åŠ è½½åˆ°é‚£ä¸ªç›®å½•ä¸‹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">true</span>    <span style="color:#75715e"># æ˜¯å¦åªè¯»</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>: <span style="color:#75715e"># ä¾æ•°æ®å·æ–¹å¼æŒ‚è½½ ConfigMap Secret</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">passwd-config  </span> <span style="color:#75715e"># è‡ªå®šä¹‰åå­—</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMap</span>:    <span style="color:#75715e"># æ•°æ®å·ç±»å‹ä¸ºï¼šConfigMap</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template-3   </span> <span style="color:#75715e"># ComfigMap çš„åå­—ï¼Œå¿…é¡»å’ŒåŠ è½½çš„ConfigMapç›¸åŒ</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">items</span>:    <span style="color:#75715e"># å¯¹ ConfigMapä¸­çš„Keyè¿›è¡Œæ˜ å°„ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šå°†ConfigMapä¸­æ‰€æœ‰Keyå…¨éƒ¨è½¬æ¢ä¸ºä¸€ä¸ªä¸ªåŒåæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;password&#34;</span>   <span style="color:#75715e"># ConfigMapä¸­çš„Key</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;password&#34;</span>    <span style="color:#75715e"># å°†è¯¥Keyçš„å€¼è½¬æ¢ä¸ºæ–‡ä»¶  </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Always</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;&gt;/opt/yaml/configmap/config/env-file.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enemies=aliens
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lives=3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">allowed=&#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create cm configmap-template-3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --from-env-file<span style="color:#f92672">=</span>/opt/yaml/configmap/config/env-file.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;env.txt<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å…¶ä¸­ï¼Œenv.txtçš„æ–‡ä»¶æ ¼å¼ä¸º:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">key1=***
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">key2=***
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap configmapå --from-env-file<span style="color:#f92672">=</span>env.txt </span></span></code></pre></div></blockquote>
<ul>
<li><code>ConfigMap</code><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>nginx.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶è¿›è¡Œæ›¿æ¢<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;&gt;nginx.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#user  nobody;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">worker_processes  1;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">events {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> worker_connections  1024;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#########   æˆ‘æ˜¯æµ‹è¯•é…ç½®æ–‡ä»¶   ##########
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> include       mime.types;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> default_type  application/octet-stream;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> sendfile        on;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> keepalive_timeout  65;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     listen       80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     server_name  localhost;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         root   html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         index  index.html index.htm;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     error_page   500 502 503 504  /50x.html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     location = /50x.html {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         root   html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>nginx.conf</code><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>ConfigMap</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create configmap nginxconf-cm-template --from-file<span style="color:#f92672">=</span>nginx.conf</span></span></code></pre></div><ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-configmap-template.yaml" rel="external" target="_self"><code>Kubernetes configmap Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">##########   é…ç½® Deployment å¼•ç”¨ ConfigMap åˆ›å»ºçš„æ–‡ä»¶   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-configmap-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: 
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-cm-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-cm-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">200m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">50m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config   </span> <span style="color:#75715e"># å¼•ç”¨å®šä¹‰çš„ vulumes åç§°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#e6db74">&#39;/etc/nginx/nginx.conf&#39;</span>    <span style="color:#75715e"># æ–‡ä»¶å…¨è·¯å¾„</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">subPath</span>: <span style="color:#ae81ff">etc/nginx/nginx.conf  </span> <span style="color:#75715e"># subPathï¼šè¦è¦†ç›–æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œåªè¦†ç›–å¿…è¦æ–‡ä»¶ï¼Œå¦‚æœç¼ºå°‘æ­¤é…ç½®ï¼Œå°†æ¸…ç©ºåŸæœ‰çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œä¸éœ€è¦æœ€å‰é¢çš„ï¼š/</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Always</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config   </span> <span style="color:#75715e"># å®šä¹‰ volumes çš„åç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMap</span>: <span style="color:#75715e"># ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginxconf-cm-template     </span> <span style="color:#75715e"># ConfigMapåç§°ï¼Œä½¿ç”¨åç§°è¿›è¡Œå…³è” ConfigMap</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">items</span>:   <span style="color:#75715e"># å°†configMapä¸­çš„Keyè¿›è¡Œæ˜ å°„ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šå°†configMapä¸­æ‰€æœ‰Keyå…¨éƒ¨è½¬ä¸ºä¸€ä¸ªä¸ªåŒåæ–‡æ¡£</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">nginx.conf   </span> <span style="color:#75715e"># configMapä¸­çš„Key</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">etc/nginx/nginx.conf  </span> <span style="color:#75715e"># å°†è¯¥Keyçš„å€¼è½¬ä¸ºæ–‡ä»¶ï¼Œæœ€å‰é¢ä¸éœ€è¦ï¼š/</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted --> è¿›å…¥<code>Pod</code>ä¸­æŸ¥çœ‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl exec -it nginx-configmap-pod --  /bin/sh
</span></span><span style="display:flex;"><span>$ more /etc/nginx/nginx.conf</span></span></code></pre></div></blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-configmap-simple-template.yaml" rel="external" target="_self"><code>Kubernetes ConfigMap Simple Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template   </span> <span style="color:#75715e"># ConfigMap</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:   <span style="color:#75715e"># &lt;map[string]string&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">info</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">username:admin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">password:123456</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   æŒ‚è½½æ•°æ®æ–¹å¼   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">stream.conf</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    stream.conf {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        listen 1550;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        proxy_pass  192.168.3.125:16303;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }</span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   æŒ‚è½½æ•°æ®æ–¹å¼   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">listen-port</span>: <span style="color:#e6db74">&#34;8080&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">server-name</span>: <span style="color:#ae81ff">www.erge.com</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">default-vhost: |      # æ­¤å†…å®¹ä¼ ç»™ Pod ä¸­ items: ä¸‹ path</span>: <span style="color:#ae81ff">è·¯å¾„ä¸­</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">server {</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">listen 8080 default;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">location / {</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">return 200 &#34;default-vhost!\r\n&#34;;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">blog-vhosts</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      listen 8080;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      server_name blog.erge.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        return 200 &#34;blog-vhosts!\r\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }</span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   é…ç½®envå¼•ç”¨æ–¹å¼ pod-configmap   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-pod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tier</span>: <span style="color:#ae81ff">configmap</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">role</span>: <span style="color:#ae81ff">slb</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">mountPath</span>: <span style="color:#e6db74">&#39;/etc/nginx&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">LISTEN_PORT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMapKeyRef</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">slb-vhosts-config</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">listen-port</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">SERVER_NAME</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMapKeyRef</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">slb-vhosts-config</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">server-name</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config  	# å®šä¹‰ volumes çš„åç§°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">configMap</span>: <span style="color:#75715e"># ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template </span> <span style="color:#75715e"># ConfigMapç”Ÿæˆçš„Pod åç§°ï¼Œä½¿ç”¨åç§°å…³è”</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># items:   # å°†configMapä¸­çš„Keyè¿›è¡Œæ˜ å°„ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šå°†configMapä¸­æ‰€æœ‰Keyå…¨éƒ¨è½¬ä¸ºä¸€ä¸ªä¸ªåŒåæ–‡æ¡£</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># - key: nginx.conf    # configMapä¸­çš„Key</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e">#   path: etc/nginx/nginx.conf   # å°†è¯¥Keyçš„å€¼è½¬ä¸ºæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   é…ç½®volumeå¼•ç”¨æ–¹å¼ pod-configmap   ########## </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-configmap</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/configmap/config     </span> <span style="color:#75715e"># æ²¡æœ‰åˆ™ä¼šè‡ªåŠ¨åˆ›å»º,ç›®å½•ä¸‹æœ‰æ–‡ä»¶åˆ™ä¼šè¦†ç›–æ‰</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config         </span> <span style="color:#75715e"># æ­¤åç§°å’Œ volumeMountså®šä¹‰nameåç§°ä¸€æ ·</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">configMap</span>:          <span style="color:#75715e"># ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap  </span> <span style="color:#75715e"># é…ç½®ä¸º configMap å®¹å™¨çš„åç§°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">defaultMode</span>: <span style="color:#ae81ff">integer      </span> <span style="color:#75715e"># æŒ‚è½½åˆ°Podä¸­åï¼Œæ–‡ä»¶æƒé™ï¼Œå¦‚0444</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">default-vhost       </span> <span style="color:#75715e"># configMapä¸­dataä¸‹çš„key</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">default.conf       </span> <span style="color:#75715e"># æŒ‚è½½è·¯å¾„ï¼Œè·å–Configmapä¸­dataå…³é”®å­—ä¸‹ å®šä¹‰é…ç½®æ–‡ä»¶åä¼ ç»™ volumeMounts ä¸‹çš„mountPathä¸­</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mode</span>: <span style="color:#ae81ff">integer    </span> <span style="color:#75715e"># æ–‡ä»¶æƒé™</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">blog-vhosts</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">blog.conf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">optional</span>: <span style="color:#66d9ef">true</span>      <span style="color:#75715e"># å½“keyä¸å­˜åœ¨æ—¶æ˜¯å¦æŠ¥é”™ï¼Œé»˜è®¤true</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="secretå¯†ç ä»¤ç‰Œç±»å‹"><code>Secret</code>å¯†ç ä»¤ç‰Œç±»å‹</h3>
<h4 id="secretç®€ä»‹ä»¥åŠæ³¨æ„äº‹é¡¹"><code>Secret</code>ç®€ä»‹ä»¥åŠæ³¨æ„äº‹é¡¹</h4>
<blockquote>
<ul>
<li><code>Secret</code><!-- raw HTML omitted -->ï¼šåœ¨<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->ä¸­ï¼Œè¿˜å­˜åœ¨ä¸€ç§å’Œ<!-- raw HTML omitted --><code>ConfigMap</code><!-- raw HTML omitted -->éå¸¸ç±»ä¼¼çš„å¯¹è±¡ï¼Œç§°ä¸º<!-- raw HTML omitted --><code>Secret</code><!-- raw HTML omitted -->å¯¹è±¡ï¼Œå®ƒä¸»è¦ç”¨æ¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€å¯†é’¥ã€è¯ä¹¦ç­‰ç­‰<!-- raw HTML omitted --></li>
<li><code>imagePullSecret</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>æ‹‰å–ç§æœ‰é•œåƒä»“åº“çš„æ—¶ä½¿ç”¨çš„è´¦æˆ·å¯†ç ï¼Œä¼šä¼ é€’ç»™<!-- raw HTML omitted --><code>kubelet</code><!-- raw HTML omitted -->ï¼Œç„¶å<!-- raw HTML omitted --><code>kubelet</code><!-- raw HTML omitted -->å°±å¯ä»¥æ‹‰å–æœ‰å¯†ç çš„ä»“åº“é‡Œé¢çš„é•œåƒ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¦‚æœåŒæ—¶ä½¿ç”¨<!-- raw HTML omitted --><code>data</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>stringData</code><!-- raw HTML omitted -->ï¼Œé‚£ä¹ˆ<!-- raw HTML omitted --><code>data</code><!-- raw HTML omitted -->ä¼šè¢«å¿½ç•¥<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h4 id="secretä½¿ç”¨ä»¥åŠé…ç½®"><code>Secret</code>ä½¿ç”¨ä»¥åŠé…ç½®</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è·å–ä½¿ç”¨å¸®åŠ©<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create secret -h  	<span style="color:#75715e"># æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create secret <span style="color:#f92672">[</span>flags<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span>  	<span style="color:#75715e"># å‘½ä»¤ä½¿ç”¨æ–¹å¼  	</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>base64</code><!-- raw HTML omitted -->å¯¹å‡†å¤‡çš„æ•°æ®è¿›è¡Œç¼–ç ï¼šå¯¹ç”¨æˆ·åã€å¯†ç è¿›è¡Œç¼–ç <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo -n <span style="color:#e6db74">&#39;user_name&#39;</span> | base64  		<span style="color:#75715e"># ç‰¹æ®Šå­—ç¬¦ä½¿ç”¨ï¼š&#39;&#39;(å•å¼•å·)</span>
</span></span><span style="display:flex;"><span>$ echo -n <span style="color:#e6db74">&#39;password&#39;</span> | base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è§£ç ä½¿ç”¨ï¼š--decode</span>
</span></span><span style="display:flex;"><span>$ echo -n <span style="color:#e6db74">&#39;dXNlcl9uYW1l&#39;</span> | base64 --decode</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä»å‘½ä»¤è¡Œåˆ›å»º<!-- raw HTML omitted --><code>Secret</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create secret generic secret-name <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-literal<span style="color:#f92672">=</span>username<span style="color:#f92672">=</span>admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-literal<span style="color:#f92672">=</span>password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;passwd@!3-&#39;</span>  	<span style="color:#75715e"># ç‰¹æ®Šå­—ç¬¦ä½¿ç”¨ï¼š&#39;&#39;(å•å¼•å·)</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>Secret</code><!-- raw HTML omitted -->è¿æ¥<!-- raw HTML omitted --><code>Harbor</code><!-- raw HTML omitted -->ç§äººä»“åº“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>docker-harbor-registrykey</code>ï¼š<code>Secret</code>çš„<code>Pods</code><!-- raw HTML omitted -->åç§°ï¼Œè‡ªå®šä¹‰<!-- raw HTML omitted --></li>
<li><code>--docker-server</code><!-- raw HTML omitted -->ï¼šé•œåƒä»“åº“åœ°å€<!-- raw HTML omitted --></li>
<li><code>--docker-username</code><!-- raw HTML omitted -->ï¼šé•œåƒä»“åº“ç”¨æˆ·å<!-- raw HTML omitted --></li>
<li><code>--docker-password</code><!-- raw HTML omitted -->ï¼šé•œåƒä»“åº“å¯†ç <!-- raw HTML omitted --></li>
<li><code>--docker-email</code><!-- raw HTML omitted -->ï¼šé‚®ç®±åœ°å€<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è·å– docker-registry ä½¿ç”¨å¸®åŠ©</span>
</span></span><span style="display:flex;"><span>$ kubectl create secret docker-registry -h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºä¸€ä¸ªImagePullSecret</span>
</span></span><span style="display:flex;"><span>$ kubectl create secret docker-registry docker-harbor-registrykey <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --docker-server<span style="color:#f92672">=</span>192.168.18.119:85:8080 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --docker-username<span style="color:#f92672">=</span>admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --docker-password<span style="color:#f92672">=</span>Harbor12345 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --docker-email<span style="color:#f92672">=</span>xxxxx@qq.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹æ˜¯å¦åˆ›å»ºæˆåŠŸ</span>
</span></span><span style="display:flex;"><span>$ kubectl get secret docker-harbor-registrykey</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>redis.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œè·å–<!-- raw HTML omitted --><code>Harbor</code><!-- raw HTML omitted -->ä»“åº“é•œåƒ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">imagePullSecrets</span>:  	<span style="color:#75715e"># é…ç½®ç™»å½• docker registry çš„ secret ä»“åº“</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker-harbor-registrykey  	# å¼•ç”¨Secretçš„Podsï¼Œå®¹å™¨åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">192.168.18.119</span>:<span style="color:#ae81ff">85</span><span style="color:#ae81ff">/yuncloud/redis</span> <span style="color:#75715e"># è¿™æ˜¯Harborçš„é•œåƒç§æœ‰ä»“åº“åœ°å€</span></span></span></code></pre></div></blockquote>
<ul>
<li>å‡†å¤‡<code>volumes-secret</code><!-- raw HTML omitted -->èµ„æºæ¸…å•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Secret</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Opaque</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:  	<span style="color:#75715e"># æå‰ç¼–ç ä½¿ç”¨ï¼šdataã€ä½¿ç”¨Kubernetesè¿›è¡Œç¼–ç ä½¿ç”¨ï¼šstringData</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">username</span>: <span style="color:#ae81ff">YWRtaW4=  	# ä½¿ç”¨kubernetesè¿›è¡Œç¼–ç å†™ï¼ŒåŸæ•°æ®ï¼šadmin</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#ae81ff">MTIzNDU2  	# ä½¿ç”¨kubernetesè¿›è¡Œç¼–ç å†™ï¼ŒåŸæ•°æ®ï¼š123456</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   é…ç½® secret-pod   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">secret-pod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/secret/config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">secret</span>:  	<span style="color:#75715e"># ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted --> æŸ¥çœ‹ç¼–ç åçš„ç›®å½•ä»¥åŠä¿¡æ¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å°†nginx.confå¯¼å‡ºåˆ°æœ¬åœ°</span>
</span></span><span style="display:flex;"><span>$ kubectl exec -it nginx -- cat /etc/nginx/nginx.conf &gt; nginx.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl exec -it secret-pod-name -n default -- /bin/sh
</span></span><span style="display:flex;"><span>$ ls /secret/config
</span></span><span style="display:flex;"><span>$ more /secret/config/username
</span></span><span style="display:flex;"><span>$ more /secret/config/password</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

        </div>
      </main>
    </div>
    <script src="../../../../js/clipboard.min.js?1719333224" defer></script>
    <script src="../../../../js/perfect-scrollbar.min.js?1719333224" defer></script>
    <script src="../../../../js/theme.js?1719333224" defer></script>
  </body>
</html>
