<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <meta name="author" content="äºŒå“¥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/s2-1.png">
    <meta name="twitter:title" content="Logs :: Hugo Relearn Theme">
    <meta property="og:url" content="https://erge.blog/systems/linux/logs/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Logs :: Hugo Relearn Theme">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://erge.blog/images/s2-1.png">
    <meta itemprop="name" content="Logs :: Hugo Relearn Theme">
    <meta itemprop="datePublished" content="2024-06-13T00:32:08+08:00">
    <meta itemprop="dateModified" content="2024-06-13T00:32:08+08:00">
    <meta itemprop="image" content="https://erge.blog/images/s2-1.png">
    <title>Logs :: Hugo Relearn Theme</title>
    <link href="../../../images/favicon.ico?1722425298" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../css/fontawesome-all.min.css?1722425299" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fontawesome-all.min.css?1722425299" rel="stylesheet"></noscript>
    <link href="../../../css/nucleus.css?1722425299" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1722425299" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/auto-complete.css?1722425299" rel="stylesheet"></noscript>
    <link href="../../../css/perfect-scrollbar.min.css?1722425299" rel="stylesheet">
    <link href="../../../css/fonts.css?1722425299" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fonts.css?1722425299" rel="stylesheet"></noscript>
    <link href="../../../css/theme.css?1722425299" rel="stylesheet">
    <link href="../../../css/theme-relearn-auto.css?1722425299" rel="stylesheet" id="R-variant-style">
    <link href="../../../css/chroma-relearn-auto.css?1722425299" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../css/variant.css?1722425299" rel="stylesheet">
    <link href="../../../css/print.css?1722425299" rel="stylesheet" media="print">
    <link href="../../../css/format-print.css?1722425299" rel="stylesheet">
    <script src="../../../js/variant.js?1722425299"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../systems/linux/logs/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Logs</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/ldap/install_openldap/" title="Install_OpenLDAP (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/logs/use_logrotate/" title="Use_Logrotate (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="logs">Logs</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Logs</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_logrotate">Use_Logrotate</h1>

<h2 id="logrotateæ—¥å¿—åˆ‡å‰²"><code>logrotate</code>æ—¥å¿—åˆ‡å‰²</h2>
<blockquote>
<ul>
<li><code>man logrotate</code><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>logrodate</code><!-- raw HTML omitted -->ä½¿ç”¨è¯¦æƒ…<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¦‚æœæ—¥å¿—åˆ‡å‰²åœ¨ï¼š<!-- raw HTML omitted --><code>/usr</code>, <code>boot</code>, <code>/etc</code>, <code>efi</code><!-- raw HTML omitted -->ç­‰ç›®å½•ä¸‹æ—¶ï¼Œä¼šæç¤ºï¼š<!-- raw HTML omitted --><code>error: error opening /usr/local/nginx/logs/nginx.log: Read-only file system</code><!-- raw HTML omitted -->è¿™æ˜¯å› ä¸ºå¯åŠ¨æ–‡ä»¶é…ç½®ï¼š<!-- raw HTML omitted --><code>ProtectSystem=full</code></li>
</ul>
<blockquote>
<ul>
<li>ä¿®æ”¹<code>/lib/systemd/system/logrotate.service</code>é…ç½®æ–‡ä»¶</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl status logrotate.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/lib/systemd/system/logrotate.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ReadWritePaths=/usr/local/nginx/logs  	# æ–‡ä»¶æœ«å°¾æ·»åŠ æ­¤è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload 
</span></span><span style="display:flex;"><span>$ systemctl restart logrotate.service</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="é…ç½®nginxæ—¥å¿—åˆ‡å‰²">é…ç½®<code>Nginx</code>æ—¥å¿—åˆ‡å‰²</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://blog.csdn.net/weixin_45203131/article/details/113186186" rel="external" target="_self"><code>centos7 logrotate</code>æ—¥å¿—åˆ‡å‰²</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/diantong/p/10717926.html" rel="external" target="_self"><code>CentOS</code>ä¸‹ä½¿ç”¨<code>Logrotate</code>æ—¥å¿—åˆ‡å‰²</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://bypass007.github.io/Emergency-Response-Notes/" rel="external" target="_self"><code>Logs</code>æ—¥å¿—åˆ†ææ’æŸ¥<code>GitBook</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/Bypass007/Emergency-Response-Notes" rel="external" target="_self"><code>Logs</code>æ—¥å¿—åˆ†ææ’æŸ¥<code>Github</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/kevingrace/p/6307298.html" rel="external" target="_self">æ—¥å¿—åˆ‡å‰²æ–¹æ³•å°ç»“<code>Logrotateã€pythonã€shell</code>è„šæœ¬å®ç° </a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ man logrotate
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–°å¢nginx log æ¯æ—¥åˆ‡å‰²</span>
</span></span><span style="display:flex;"><span>$ grep <span style="color:#e6db74">&#34;nginx&#34;</span> /etc/logrotate.d/nginx  &amp;&gt;/dev/null  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/logrotate.d/nginx<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;/opt/apps/nginx/logs/*.jsonl&#34; /opt/apps/nginx/logs/*.log{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">daily  	# å®‰æ—¥æœŸè½®è½¬æ—¥å¿—ï¼šhourly(å°æ—¶)ã€daily(å¤©)ã€weekly(æœˆ)ã€monthly(æœˆ)ã€yearly(å¹´)ï¼Œå¦‚æœè®¾ç½®(size)åˆ™ä¸ç”¨è¯¥å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dateext  	# æ–‡ä»¶åç¼€æ˜¯æ—¥æœŸæ ¼å¼,ä¹Ÿå°±æ˜¯åˆ‡å‰²åæ–‡ä»¶æ˜¯:xxx.log-20150828ï¼Œè¯¥è®¾ç½®å¯èƒ½å’Œå¤§å°åˆ‡å‰²å†²çªï¼Œè¯¥è®¾ç½®æŒ‰æ—¥æœŸç”Ÿæˆ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">size 100k	# åœ¨æ—¥å¿—å¤§å°å¤§äº logsizeï¼ˆä¾‹å¦‚ 100Kï¼Œ100Mï¼Œ100Gï¼‰æ—¶è½®æ¢ã€minsizeã€maxsizeï¼Œè¯¥é€‰é¡¹ä¸æ—¥æœŸè®¾ç½®æ˜¯äº’æ–¥çš„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rotate 15  	# æŒ‡å®šæ—¥å¿—æ–‡ä»¶åˆ é™¤ä¹‹å‰è½¬å‚¨çš„æ¬¡æ•°ï¼Œ0æŒ‡æ²¡æœ‰å¤‡ä»½ï¼Œ15æŒ‡ä¿ç•™15ä¸ªå¤‡ä»½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">compress  	# é€šè¿‡gzipå‹ç¼©è½¬å‚¨ä»¥åçš„æ—¥å¿—ï¼ˆgzip -d xxx.gzè§£å‹ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">missingok  	# å¦‚æœæ—¥å¿—ä¸å­˜åœ¨åˆ™å¿½ç•¥è¯¥è­¦å‘Šä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notifempty  	# å¦‚æœæ˜¯ç©ºæ–‡ä»¶çš„è¯ï¼Œä¸è½¬å‚¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">copytruncate  	# ç”¨äºè¿˜åœ¨æ‰“å¼€ä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼ŒæŠŠå½“å‰æ—¥å¿—å¤‡ä»½å¹¶æˆªæ–­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">delaycompress  	# å’Œcompressä¸€èµ·ä½¿ç”¨æ—¶ï¼Œdelaycompressé€‰é¡¹æŒ‡ç¤ºlogrotateä¸è¦å°†æœ€è¿‘çš„å½’æ¡£å‹ç¼©ï¼Œå‹ç¼©å°†åœ¨ä¸‹ä¸€æ¬¡è½®å¾ªå‘¨æœŸè¿›è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sharedscripts  	# è¿è¡Œpostrotateè„šæœ¬ï¼Œåœ¨æ‰€æœ‰æ—¥å¿—éƒ½è½®è½¬åç»Ÿä¸€æ‰§è¡Œä¸€æ¬¡è„šæœ¬ã€‚å¦‚æœæ²¡é…è¯¥é€‰é¡¹ï¼Œæ¯ä¸ªæ—¥å¿—è½®è½¬åéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡è„šæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">postrotate  	# è¿è¡Œpostrotateè„šæœ¬ï¼Œä½œç”¨æ˜¯åœ¨æ‰€æœ‰æ—¥å¿—éƒ½è½®è½¬åç»Ÿä¸€æ‰§è¡Œä¸€æ¬¡è„šæœ¬ï¼Œå¦‚é‡å¯ï¼ˆkill -HUPï¼‰æœåŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    [ -f /var/run/nginx.pid ] &amp;&amp; kill -USR1 `cat /var/run/nginx.pid`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">endscript  	# æœ€é€šå¸¸çš„ä½œç”¨æ˜¯è®©åº”ç”¨é‡å¯ï¼Œä»¥ä¾¿åˆ‡æ¢åˆ°æ–°çš„æ—¥å¿—æ–‡ä»¶, åœ¨æ‰€æœ‰å…¶å®ƒæŒ‡ä»¤å®Œæˆåï¼Œpostrotateå’Œendscripté‡Œé¢æŒ‡å®šçš„å‘½ä»¤å°†è¢«æ‰§è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œnginx è¿›ç¨‹å°†ç«‹å³å†æ¬¡è¯»å–å…¶é…ç½®å¹¶ç»§ç»­è¿è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">create 640 www root 	# ä»¥æŒ‡å®šçš„æƒé™ç”¨æˆ·å’Œç»„åˆ›å»ºå…¨æ–°çš„æ—¥å¿—æ–‡ä»¶ï¼ŒåŒæ—¶logrotateä¹Ÿä¼šé‡å‘½ååŸå§‹æ—¥å¿—æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">su root root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰‹åŠ¨è°ƒè¯•éªŒè¯ä¸æ‰§è¡Œï¼š-d</span>
</span></span><span style="display:flex;"><span>$ /usr/sbin/logrotate -d /etc/logrotate.d/nginx
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰‹åŠ¨å¼ºåˆ¶æ‰§è¡Œï¼š-f</span>
</span></span><span style="display:flex;"><span>$ /usr/sbin/logrotate -f /etc/logrotate.d/nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–°å¢åˆªé™¤7å¤©ä»¥å‰logå®šæ™‚è…³æœ¬  </span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;###nginxè¶…éä¸ƒå¤©logåˆªé™¤
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1 0 * * * /bin/bash /opt/scripts/DEL_NGINX.sh &gt;&gt; ~/del_tom.log 2&gt;&amp;1&#34;</span> &gt;&gt; /var/spool/cron/admin</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_quickwit">Install_Quickwit</h1>

<h2 id="quickwit"><code>Quickwit</code></h2>
<blockquote>
<ul>
<li><a href="https://quickwit.io/docs/" rel="external" target="_self"><code>Quickwit</code>æ—¥å¿—ç®¡ç†ã€åˆ†æ</a></li>
<li><a href="https://opentelemetry.io/docs/" rel="external" target="_self"><code>OpenTelemetry</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_logkit">Install_Logkit</h1>

<h2 id="logkit"><code>LogKit</code></h2>
<blockquote>
<ul>
<li><a href="https://github.com/qiniu/logkit" rel="external" target="_self"><code>LogKit</code></a></li>
</ul>
<blockquote>
<ul>
<li>éå¸¸å¼ºå¤§çš„æœåŠ¡å™¨ä»£ç†ï¼Œç”¨äºé€šè¿‡æ˜“äºä½¿ç”¨çš„<code>Web</code>æ§åˆ¶å°æ”¶é›†å’Œå‘é€æ—¥å¿—å’ŒæŒ‡æ ‡</li>
</ul>
</blockquote>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_graylog">Install_Graylog</h1>

<h2 id="graylogæ—¥å¿—æœåŠ¡"><code>GrayLog</code>æ—¥å¿—æœåŠ¡</h2>
<blockquote>
<ul>
<li><a href="https://docs.graylog.org/docs/operating-system-packages" rel="external" target="_self"><code>GrayLog</code></a>æ—¥å¿—æœåŠ¡</li>
<li><a href="https://testerhome.com/topics/3026" rel="external" target="_self"><code>Graylog</code>â€”æ—¥å¿—èšåˆå·¥å…·ä¸­çš„åèµ·ä¹‹ç§€</a></li>
<li><a href="https://my.oschina.net/HeAlvin/blog/378262" rel="external" target="_self">æ¨èï¼å›½å¤–ç¨‹åºå‘˜æ•´ç†çš„ç³»ç»Ÿç®¡ç†å‘˜èµ„æºå¤§å…¨</a></li>
</ul>
<blockquote>
<ul>
<li><code>Java ( &gt;= 8 )</code></li>
<li><code>MongoDB (4.0, 4.2 or 4.4)</code></li>
<li><code>Elasticsearch (6.x or 7.x)</code></li>
<li><code>GrayLog-Server</code></li>
<li><code>GrayLog-Web</code></li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="å®‰è£…graylogæ‰€éœ€æœåŠ¡">å®‰è£…<code>GrayLog</code>æ‰€éœ€æœåŠ¡</h3>
<ul>
<li>
<ol>
<li><a href="https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-red-hat/" rel="external" target="_self"><code>Mongodb</code></a>æ•°æ®åº“</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Mongodb</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>yum</code><!-- raw HTML omitted -->å­˜å‚¨åº“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/yum.repos.d/mongodb-org.repo<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[mongodb-org-4.2]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name=MongoDB Repository
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.2/x86_64/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey=https://www.mongodb.org/static/pgp/server-4.2.asc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…å¹¶å¯åŠ¨<!-- raw HTML omitted --><code>MongoDB</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install mongodb-org
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable mongod.service <span style="color:#f92672">&amp;&amp;</span> systemctl start mongod.service
</span></span><span style="display:flex;"><span>$ systemctl --type<span style="color:#f92672">=</span>service --state<span style="color:#f92672">=</span>active | grep mongod</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>Elasticsearch</code>æ•°æ®å­˜å‚¨æœåŠ¡</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>GrayLog</code>æ‰€éœ€æœåŠ¡<code>Elasticsearch</code>å¼¹æ€§æœç´¢ã€æ•°æ®å­˜å‚¨æœåŠ¡</li>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Elasticsearch</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>yum</code><!-- raw HTML omitted -->å­˜å‚¨åº“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>GrayLog</code><!-- raw HTML omitted -->ä¸æ”¯æŒ<!-- raw HTML omitted --><code>Elasticsearch 7.11</code><!-- raw HTML omitted -->åŠæ›´é«˜ç‰ˆæœ¬ã€‚å®ƒä¼šç ´åä½ çš„<!-- raw HTML omitted --><code>Graylog</code><!-- raw HTML omitted -->å®ä¾‹ï¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch  	<span style="color:#75715e"># æ·»åŠ å¯†é’¥</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/yum.repos.d/elasticsearch.repo<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[elasticsearch-7.x]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name=Elasticsearch repository for 7.x packages
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl=https://artifacts.elastic.co/packages/oss-7.x/yum
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autorefresh=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">type=rpm-md
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>elasticsearch-oss</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install elasticsearch-oss</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Elasticsearch</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†é›†ç¾¤åç§°è®¾ç½®ä¸º<!-- raw HTML omitted --><code>Graylog</code><!-- raw HTML omitted -->å¹¶å–æ¶ˆæ³¨é‡Š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tee -a /etc/elasticsearch/elasticsearch.yml &gt;/dev/null <span style="color:#e6db74">&lt;&lt;-EOT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cluster.name: graylog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">action.auto_create_index: false  	# å¹¶å–æ¶ˆæ³¨é‡Šï¼Œå¯ç”¨è¯¥æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOT</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Elasticsearch</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable elasticsearch.service <span style="color:#f92672">&amp;&amp;</span> systemctl restart elasticsearch.service
</span></span><span style="display:flex;"><span>$ systemctl --type<span style="color:#f92672">=</span>service --state<span style="color:#f92672">=</span>active | grep elasticsearch</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="å®‰è£…graylogæœåŠ¡">å®‰è£…<code>GrayLog</code>æœåŠ¡</h3>
<blockquote>
<ul>
<li><code>GrayLog</code><!-- raw HTML omitted -->å„æ’ä»¶åŠŸèƒ½<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>graylog-enterprise-integrations-plugins</code><!-- raw HTML omitted -->ä¼ä¸šé›†æˆæ’ä»¶<!-- raw HTML omitted --></li>
<li><code>graylog-enterprise-plugins</code><!-- raw HTML omitted -->ä¼ä¸šæ’ä»¶<!-- raw HTML omitted --></li>
<li><code>graylog-integrations-plugins</code><!-- raw HTML omitted -->é›†æˆæ’ä»¶<!-- raw HTML omitted --></li>
<li><code>graylog-server</code><!-- raw HTML omitted -->æœåŠ¡ç«¯<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm -Uvh https://packages.graylog2.org/repo/packages/graylog-4.2-repository_latest.rpm
</span></span><span style="display:flex;"><span>$ yum install graylog-server graylog-enterprise-plugins graylog-integrations-plugins graylog-enterprise-integrations-plugins</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>GrayLog</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é˜…è¯»é…ç½®æ–‡ä»¶ä¸­çš„è¯´æ˜å¹¶æ ¹æ®éœ€è¦è¿›è¡Œç¼–è¾‘ï¼Œä½äº<!-- raw HTML omitted --><code>/etc/graylog/server/server.conf</code><!-- raw HTML omitted -->å¦å¤–æ·»åŠ <!-- raw HTML omitted --><code>password_secret</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>root_password_sha2</code><!-- raw HTML omitted -->å› ä¸ºè¿™äº›æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œæ²¡æœ‰å®ƒä»¬<!-- raw HTML omitted --><code>Graylog</code><!-- raw HTML omitted -->å°†æ— æ³•å¯åŠ¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ln -s /usr/local/src/jdk1.8.0_221/bin/java /usr/bin/java  	<span style="color:#75715e"># ç»™Javaåšä¸ªè½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo -n <span style="color:#e6db74">&#34;Enter Password: &#34;</span> <span style="color:#f92672">&amp;&amp;</span> head -1 &lt;/dev/stdin | tr -d <span style="color:#e6db74">&#39;\n&#39;</span> | sha256sum | cut -d<span style="color:#e6db74">&#34; &#34;</span> -f1  	<span style="color:#75715e"># ä¸ºï¼špassword_secretï¼Œç”Ÿæˆ64ä½å¯†ç å­—ç¬¦</span>
</span></span><span style="display:flex;"><span>$ echo -n yourpassword | sha256sum  	<span style="color:#75715e"># ä¸ºï¼šroot_password_sha2ï¼Œç”Ÿæˆå“ˆå¸Œå€¼</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat //etc/graylog/server/server.conf 
</span></span><span style="display:flex;"><span>password_secret <span style="color:#f92672">=</span>   	<span style="color:#75715e"># 57è¡Œå·¦å³ï¼Œ æ·»åŠ ç”¨æˆ·é›†ç¾¤æ•°æ®åº“ä¸­æ‰€ç”¨</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root_password_sha2 <span style="color:#f92672">=</span>   	<span style="color:#75715e"># 68è¡Œå·¦å³ï¼Œæ·»åŠ ç”Ÿæˆçš„å“ˆå¸Œå€¼ï¼Œ ç”¨äºç™»å½•webç•Œé¢</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>http_bind_address <span style="color:#f92672">=</span> 127.0.0.1:9000  	<span style="color:#75715e"># 105è¡Œå·¦å³ä¿®æ”¹ä¸ºï¼šhttp_bind_address = 0.0.0.0:9000</span></span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>GrayLog</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable graylog-server.service <span style="color:#f92672">&amp;&amp;</span> systemctl start graylog-server.service
</span></span><span style="display:flex;"><span>$ systemctl --type<span style="color:#f92672">=</span>service --state<span style="color:#f92672">=</span>active | grep graylog</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Selinux</code><!-- raw HTML omitted -->å¼€æ”¾ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å…è®¸<!-- raw HTML omitted --><code>Web</code><!-- raw HTML omitted -->æœåŠ¡å™¨è®¿é—®ç½‘ç»œ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ setsebool -P httpd_can_network_connect <span style="color:#ae81ff">1</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é’ˆå¯¹ç«¯å£é…ç½®<!-- raw HTML omitted --><code>Selinux</code><!-- raw HTML omitted -->å¼€æ”¾<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ semanage port -a -t http_port_t -p tcp <span style="color:#ae81ff">9000</span>  	<span style="color:#75715e"># Graylog REST API å’Œ Web ç•Œé¢</span>
</span></span><span style="display:flex;"><span>$ semanage port -a -t http_port_t -p tcp <span style="color:#ae81ff">9200</span>  	<span style="color:#75715e"># Elasticsearchï¼ˆä»…å½“ä½¿ç”¨ HTTP API æ—¶ï¼‰</span>
</span></span><span style="display:flex;"><span>$ semanage port -a -t mongod_port_t -p tcp <span style="color:#ae81ff">27017</span>  	<span style="color:#75715e"># å…è®¸ä½¿ç”¨ MongoDB çš„é»˜è®¤ç«¯å£ (27017/tcp)</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ firewall-cmd --add-port<span style="color:#f92672">=</span>9000/tcp --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‰“å¼€æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted --><code>GrayLog</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ http://IP:9000  	<span style="color:#75715e"># é»˜è®¤ç”¨æˆ·åï¼šadminï¼Œæ‰€å®šä¹‰çš„root_password_sha2å¯†ç </span></span></span></code></pre></div><ul>
<li><code>Google</code><!-- raw HTML omitted -->æµè§ˆå™¨è®¿é—®æŠ¥é”™æ›´æ¢æµè§ˆå™¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>While rendering this widget, the following error occurred:
</span></span><span style="display:flex;"><span>NotFoundError: Failed to execute <span style="color:#e6db74">&#39;removeChild&#39;</span> on <span style="color:#e6db74">&#39;Node&#39;</span>: The node to be removed is not a child of this node.</span></span></code></pre></div></blockquote>
</blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_fluentd">Install_Fluentd</h1>

<h2 id="fluentd"><code>Fluentd</code></h2>
<blockquote>
<ul>
<li>
<p><a href="https://www.fluentd.org/" rel="external" target="_self"><code>Fluentd</code></a></p>
<p><code>Fluentd</code>æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®æ”¶é›†å™¨ï¼Œç”¨ä½œç»Ÿä¸€åŒ–æ•°æ®æ”¶é›†å’Œä½¿ç”¨</p>
</li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_finder">Install_Finder</h1>

<h2 id="finderæ—¥å¿—ç³»ç»Ÿ"><code>Finder</code>æ—¥å¿—ç³»ç»Ÿ</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><code>JDK1.8</code><!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted --><code>Tomcat8</code><!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨rootç™»å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. åˆ›å»ºç”¨æˆ·: tomcat</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¦‚æœå·²æœ‰å¯å¿½ç•¥</span>
</span></span><span style="display:flex;"><span>$ useradd tomcat
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. è®¾ç½®ä¸´æ—¶å˜é‡: TOMCAT_HOME</span>
</span></span><span style="display:flex;"><span>TOMCAT_HOME<span style="color:#f92672">=</span>Tomcatæ ¹ç›®å½•
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. åˆ é™¤å¹¶é‡å»ºROOTç›®å½•, å¦‚æœ‰é‡è¦èµ„æ–™è¯·æ³¨æ„å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>$ rm -rf $TOMCAT_HOME/webapps/ROOT
</span></span><span style="display:flex;"><span>$ mkdir -p $TOMCAT_HOME/webapps/ROOT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4. ä¸‹è½½å¹¶è§£å‹åˆ°ROOTç›®å½•</span>
</span></span><span style="display:flex;"><span>$ wget -O /tmp/finder-web-2.5.8.zip http://www.finderweb.net/download/finder-web-2.5.8.war
</span></span><span style="display:flex;"><span>$ unzip -o -d $TOMCAT_HOME/webapps/ROOT /tmp/finder-web-2.5.8.zip
</span></span><span style="display:flex;"><span><span style="color:#75715e"># rm -f /tmp/finder-web-2.5.8.zip</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 5. ä¸ºåº”ç”¨ç›®å½•èµ‹æƒé™</span>
</span></span><span style="display:flex;"><span>$ chown -R tomcat:tomcat $TOMCAT_HOME
</span></span><span style="display:flex;"><span>$ chmod -R <span style="color:#ae81ff">755</span> $TOMCAT_HOME
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 6. å¯åŠ¨Tomcat</span>
</span></span><span style="display:flex;"><span>$ sudo -u tomcat $TOMCAT_HOME/bin/startup.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 7. è®¿é—®åœ°å€ï¼šhttp://ip:8080/finder</span>
</span></span><span style="display:flex;"><span>tomcaté»˜è®¤çš„ç«¯å£å·ä¸º8080ï¼Œå¦‚éœ€ä¿®æ”¹ï¼Œè¯·æ‰‹åŠ¨ç¼–è¾‘TOMCAT_HOME/conf/server.xmlï¼Œéœ€é‡å¯Tomcatã€‚
</span></span><span style="display:flex;"><span>é»˜è®¤çš„ç”¨æˆ·åå¯†ç ï¼š
</span></span><span style="display:flex;"><span>admin <span style="color:#ae81ff">1234</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 8. ä¿®æ”¹æŒ‚è½½æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;finder/webapps/ROOT/WEB-INF/finderweb/workspaces.xml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;finderweb&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &lt;workspace name=&#34;nginx&#34; displayName=&#34;nginx&#34; work=&#34;/opt/logs/nginx&#34; charset=&#34;utf8&#34; readonly=&#34;true&#34; orderNum=&#34;1&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &lt;workspace name=&#34;mysql&#34; displayName=&#34;mysql&#34; work=&#34;/opt/logs/mysql&#34; charset=&#34;utf8&#34; readonly=&#34;true&#34; orderNum=&#34;2&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;/finderweb&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>Docker</code>æ–¹å¼å®‰è£…<code>Finder</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;1.0&#39;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:   
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tomcat</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">tomcat:8.5.15-jre8</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">tomcat_finder</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">8090</span>:<span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asiz/Shanghai </span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">/opt/finder/webapps:/usr/local/tomcat/webapps</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">/opt/finder/conf:/usr/local/tomcat/conf</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">/opt/finder/logs:/usr/local/tomcat/logs</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">/opt/finder/project/logs/nginx:/opt/hwc-logs/nginx</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_es_head">Install_Es_Head</h1>

<h2 id="elasticsearch-head"><code>elasticsearch-head</code></h2>
<blockquote>
<ul>
<li><a href="https://github.com/mobz/elasticsearch-head" rel="external" target="_self"><code>elasticsearch-head Github</code>åœ°å€</a></li>
</ul>
</blockquote>
<h3 id="å®‰è£…nodejsnpm">å®‰è£…<code>nodejsã€npm</code></h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>nodejs</code><!-- raw HTML omitted -->å‰å…ˆå®‰è£…<!-- raw HTML omitted --><code>epel-release</code><!-- raw HTML omitted -->æº<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install epel-release</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>nodejsã€npm</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install nodejs npm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ–°npm</span>
</span></span><span style="display:flex;"><span>$ npm install -g npm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£… n æ¨¡å—</span>
</span></span><span style="display:flex;"><span>$ npm install -g n</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="å›½å†…å®‰è£…cnpm">å›½å†…å®‰è£…<code>cnpm</code></h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ›´æ¢å›½å†…é˜¿é‡Œäº‘æº<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹npm ä½¿ç”¨åœ°å€</span>
</span></span><span style="display:flex;"><span>$ npm config get registry
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ¢æº</span>
</span></span><span style="display:flex;"><span>$ npm config set registry https://registry.npm.taobao.org
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨cnpm</span>
</span></span><span style="display:flex;"><span>$ npm install -g cnpm --registry<span style="color:#f92672">=</span>https://registry.npm.taobao.org</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="å®‰è£…elasticsearch-head">å®‰è£…<code>elasticsearch-head</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://github.com/mobz/elasticsearch-head/archive/refs/tags/v5.0.0.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxvf v5.0.0.tar.gz
</span></span><span style="display:flex;"><span>$ cd elasticsearch-head
</span></span><span style="display:flex;"><span>$ npm install
</span></span><span style="display:flex;"><span>$ npm run start</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_elk">Install_ELK</h1>

<h2 id="elasticsearchéƒ¨ç½²"><code>Elasticsearch</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><code>Elasticsearch</code><!-- raw HTML omitted -->ç®€ä»‹<!-- raw HTML omitted --><a href="https://www.elastic.co/guide/index.html" rel="external" target="_self">å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://blog.csdn.net/u012332735/article/details/54946355" rel="external" target="_self"><code>Elasticsearch</code>å¸¸ç”¨æ’ä»¶é›†åˆ</a></li>
<li><a href="https://www.cnblogs.com/hahaha111122222/p/13139809.html" rel="external" target="_self"><code>ELK</code>åŸºäº<code>ElastAlert</code>å®ç°æ—¥å¿—çš„å¾®ä¿¡æŠ¥è­¦</a></li>
</ul>
<blockquote>
<ul>
<li><code>Elasticsearch</code>æ˜¯ä¸€ä¸ªåŸºäº<code>Lucene</code>çš„å¼¹æ€§æ•°æ®å­˜å‚¨ã€æœç´¢ã€å¼€æºåˆ†å¸ƒå¼æœç´¢æœåŠ¡ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäº<code>RESTful web</code>æ¥å£ï¼Œåœ¨<code>elasticsearch</code>ä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®æ˜¯å‡ç­‰çš„ã€‚</li>
<li>ç‰¹ç‚¹ï¼šåˆ†å¸ƒå¼ï¼Œé›¶é…ç½®ï¼Œè‡ªåŠ¨å‘ç°ï¼Œç´¢å¼•è‡ªåŠ¨åˆ†ç‰‡ï¼Œç´¢å¼•å‰¯æœ¬æœºåˆ¶ï¼Œ<code>restful</code>é£æ ¼æ¥å£ï¼Œå¤šæ•°æ®æºï¼Œ è‡ªåŠ¨æœç´¢è´Ÿè½½ç­‰ã€‚</li>
<li><code>Elasticsearch</code>æ˜¯ç”¨<code>Java</code>å¼€å‘çš„ï¼Œå¹¶ä½œä¸º<code>Apache</code>è®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯ç¬¬äºŒæµè¡Œçš„ä¼ä¸šæœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚</li>
</ul>
</blockquote>
<ul>
<li><a href="https://www.elastic.co/cn/downloads/elasticsearch" rel="external" target="_self">ä¸‹è½½<code>elasticsearch-8.1</code></a></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.1.3-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span>$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.1.3-linux-x86_64.tar.gz.sha512
</span></span><span style="display:flex;"><span>$ sha512sum -c elasticsearch-8.1.3-linux-x86_64.tar.gz.sha512
</span></span><span style="display:flex;"><span>$ tar -xzf elasticsearch-8.1.3-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span>$ cd elasticsearch-8.1.3/ </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Elasticsearch</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Elasticsearch</code><!-- raw HTML omitted -->ä¸»é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/elasticsearch/config
</span></span><span style="display:flex;"><span>$ cp elasticsearch.yml<span style="color:#f92672">{</span>,.bak<span style="color:#f92672">}</span>  	<span style="color:#75715e"># æå‰ç»™é…ç½®æ–‡ä»¶åšä¸ªå¤‡ä»½</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 17è¡Œã€ç»„å(åŒä¸€ä¸ªç»„ï¼Œç»„åå¿…é¡»ä¸€è‡´)</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/cluster.name:/a\\cluster.name: cluster-1&#34;</span> elasticsearch.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 23è¡Œã€èŠ‚ç‚¹åç§°ï¼Œå»ºè®®å’Œä¸»æœºåä¸€è‡´</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/node.name:/a\\node.name: server-1&#34;</span> elasticsearch.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 33è¡Œã€æ•°æ®å­˜æ”¾çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/path.data:/a\\path.data: /opt/elasticsearch/data&#34;</span> elasticsearch.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 37è¡Œã€æ—¥å¿—å­˜æ”¾çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/path.logs:/a\\path.logs: /opt/elasticsearch/logs&#34;</span> elasticsearch.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 43è¡Œã€ é”ä½å†…å­˜ï¼Œä¸è¢«ä½¿ç”¨åˆ°äº¤æ¢åˆ†åŒºå»(é€šå¸¸åœ¨å†…éƒ¨ä¸è¶³æ—¶ï¼Œä¼‘çœ çš„ç¨‹åºå†…å­˜ä¿¡æ¯ä¼šäº¤æ¢åˆ°äº¤æ¢åˆ†åŒº)</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/bootstrap.memory_lock:/a\\bootstrap.memory_lock: false&#34;</span> elasticsearch.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 56è¡Œã€ç½‘ç»œè®¾ç½®ï¼Œå»ºè®®å¡«å†™æœ¬æœºIPæˆ–è€…0.0.0.0</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/network.host:/a\\network.host: 0.0.0.0&#34;</span> elasticsearch.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 61è¡Œã€å¼€å¯ç«¯å£</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/http.port:/a\\http.port: 9200&#34;</span> elasticsearch.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 74è¡Œã€å’ŒèŠ‚ç‚¹åç§°ä¸€è‡´</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/cluster.initial_master_nodes:/a\\cluster.initial_master_nodes: [&#34;</span>server_1<span style="color:#e6db74">&#34;]&#34;</span> elasticsearch.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;http.cors.enabled: true  	# æ”¯æŒè·¨åŸŸ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">xpack.security.enabled: true  	# å¯ç”¨å®‰å…¨æ€§æ£€æŸ¥
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">xpack.security.transport.ssl.enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># discovery.zen.ping.multicast.enabled: false  	# é›†ç¾¤æ¨¡å¼ï¼Œä»èŠ‚ç‚¹å…³é—­å¤šæ’­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># discovery.zen.ping.unicast.hosts: [&#34;</span>10.18.41.31<span style="color:#e6db74">&#34;,&#34;</span>10.18.41.137<span style="color:#e6db74">&#34;  	# é›†ç¾¤æ¨¡å¼ï¼Œä»èŠ‚ç‚¹é…ç½®ä¸»æœåŠ¡å™¨å’Œè‡ªå·±çš„åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http.cors.allow-origin: &#34;</span>*<span style="color:#e6db74">&#34;  	# èŒƒå›´  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰‹åŠ¨åˆ›å»ºç³»ç»Ÿç´¢å¼•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">action.auto_create_index: .monitoring*,.watches,.triggered_watches,.watcher-history*,.ml* &#34;</span> &gt;&gt;elasticsearch.yml</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Elasticsearch</code><!-- raw HTML omitted -->èµ„æºé™åˆ¶é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è°ƒæ•´jvm.optionsæ–‡ä»¶çš„32ã€å’Œ33è¡Œ</span>
</span></span><span style="display:flex;"><span>$ cd /opt/elasticsearch/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/## -Xms4g/a\\-Xms512m&#34;</span> jvm.options
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/## -Xmx4g/a\\-Xmx512m&#34;</span> jvm.options</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨æœåŠ¡å¹¶å¼€å¯<!-- raw HTML omitted -->é˜²ç«å¢™ï¼š9200<!-- raw HTML omitted -->ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Ulimit</code><!-- raw HTML omitted -->è°ƒæ•´è¿›ç¨‹çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ulimit -n <span style="color:#ae81ff">65535</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;* soft nofile 65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nofile 65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft nproc 32000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nproc 32000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard memlock unlimited
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft memlock unlimited &#34;</span>&gt;&gt;/etc/security/limits.conf</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>vm.max_map_count</code><!-- raw HTML omitted -->æœ€å¤§è™šæ‹Ÿå†…å­˜åŒºåŸŸ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;vm.max_map_count=655360&#34;</span> &gt;&gt;/etc/sysctl.conf</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹æƒé™å¯åŠ¨æœåŠ¡å¼€æ”¾é˜²ç«å¢™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted --><strong>9200ç«¯å£</strong>ï¼š<!-- raw HTML omitted -->ç”¨äºæ‰€æœ‰é€šè¿‡<code>HTTP</code>åè®®è¿›è¡Œçš„<code>API</code>è°ƒç”¨ã€‚åŒ…æ‹¬æœç´¢ã€èšåˆã€ç›‘æ§ã€ä»¥åŠå…¶ä»–ä»»ä½•ä½¿ç”¨<code>HTTP</code>åè®®çš„è¯·æ±‚ã€‚æ‰€æœ‰çš„å®¢æˆ·ç«¯åº“éƒ½ä¼šä½¿ç”¨è¯¥ç«¯å£ä¸<code>ElasticSearch</code>è¿›è¡Œäº¤äº’ã€‚</p>
</li>
<li>
<p><!-- raw HTML omitted --><strong>9300ç«¯å£</strong>ï¼š<!-- raw HTML omitted -->æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„äºŒè¿›åˆ¶åè®®ï¼Œç”¨äºé›†ç¾¤ä¸­å„èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ã€‚ç”¨äºè¯¸å¦‚é›†ç¾¤å˜æ›´ã€ä¸»èŠ‚ç‚¹é€‰ä¸¾ã€èŠ‚ç‚¹åŠ å…¥/ç¦»å¼€ã€åˆ†ç‰‡åˆ†é…ç­‰äº‹é¡¹ã€‚</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chown -R user:user /opt/elasticsearch  	<span style="color:#75715e"># æ™®é€šç”¨æˆ·å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd /opt/elasticsearch/
</span></span><span style="display:flex;"><span>$ ./bin/elasticsearch-setup-passwords interactive  	<span style="color:#75715e"># è®¾ç½®å¯†ç ï¼Œä¿®æ”¹å¯†ç ä¹Ÿæ˜¯ä¸€æ ·ã€‚</span>
</span></span><span style="display:flex;"><span>$ ./bin/elasticsearch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ­¤å‘½ä»¤æ¥åˆ¤æ–­æ˜¯initå¯åŠ¨è¿˜æ˜¯systemctlå¯åŠ¨</span>
</span></span><span style="display:flex;"><span>$ ps -p <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å½“systemdå¯ç”¨äº†æ—¥å¿—è®°å½•ï¼Œæ—¥å¿—ä¿¡æ¯ä½¿ç”¨å¯ç”¨journalctlçš„å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ journalctl - f
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ—å‡ºelasticsearchæœåŠ¡çš„æ—¥è®°å¸åˆ†å½•</span>
</span></span><span style="display:flex;"><span>$ journalctl - unit elasticsearch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¦ä»ç»™å®šæ—¶é—´å¼€å§‹åˆ—å‡ºelasticsearchæœåŠ¡çš„æ—¥è®°å¸åˆ†å½•ï¼š</span>
</span></span><span style="display:flex;"><span>$ journalctl --unit elasticsearch --since  <span style="color:#e6db74">&#34;2016-10-30 18:17:16&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥Elasticsearch</span>
</span></span><span style="display:flex;"><span>$  curl -i -XGET http://127.0.0.1:9200</span></span></code></pre></div></li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<hr>
<h3 id="elasticsearch-headæ’ä»¶å®‰è£…"><code>elasticsearch-head</code>æ’ä»¶å®‰è£…</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½å¯åŠ¨<!-- raw HTML omitted --><code>elasticsearch-head</code><!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾ï¼š9100<!-- raw HTML omitted --><!-- raw HTML omitted -->ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/
</span></span><span style="display:flex;"><span>$ git clone git://github.com/mobz/elasticsearch-head.git
</span></span><span style="display:flex;"><span>$ cd elasticsearch-head
</span></span><span style="display:flex;"><span>$ npm install
</span></span><span style="display:flex;"><span>$ npm run start
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  grunt server  	# æˆ–è€…ä½¿ç”¨  grunt å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>$ curl http://localhost:9100/  	<span style="color:#75715e"># ç™»å½•æµè§ˆå™¨è¾“å…¥åœ°å€è®¿é—®</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="logstashéƒ¨ç½²"><code>Logstash</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><code>Logstash</code><!-- raw HTML omitted -->ç®€ä»‹<!-- raw HTML omitted -->ã€<a href="https://www.elastic.co/guide/en/logstash/master/index.html" rel="external" target="_self">å®˜æ–¹æ–‡æ¡£</a></li>
</ul>
<blockquote>
<ul>
<li><code>Logstash</code>æ˜¯ä¸€ä¸ªå®Œå…¨å¼€æºå·¥å…·ï¼Œå¯ä»¥å¯¹ä½ çš„æ—¥å¿—è¿›è¡Œæ”¶é›†ã€è¿‡æ»¤ã€åˆ†æï¼Œå¹¶å°†å…¶å­˜å‚¨ä¾›ä»¥åä½¿ç”¨ï¼ˆå¦‚ï¼Œæœç´¢ï¼‰ï¼Œ<code>logstash</code>å¸¦æœ‰ä¸€ä¸ª<code>web</code>ç•Œé¢ï¼Œæœç´¢å’Œå±•ç¤ºæ‰€æœ‰æ—¥å¿—ã€‚</li>
</ul>
</blockquote>
<ul>
<li><a href="https://www.elastic.co/cn/downloads/logstash" rel="external" target="_self">ä¸‹è½½ã€è§£å‹<code>Logstash</code></a></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://artifacts.elastic.co/downloads/logstash/logstash-8.3.3-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxvf logstash-8.3.3-linux-x86_64.tar.gz</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Logstash</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>conf</code><!-- raw HTML omitted -->æ–‡ä»¶æ”¶é›†<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->æ—¥å¿—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.elastic.co/guide/en/logstash/current/configuration.html" rel="external" target="_self">å‚è€ƒå®˜ç½‘æ ‡å‡†è¾“å…¥è¾“å‡º</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.elastic.co/guide/en/logstash/current/configuration-file-structure.html" rel="external" target="_self">å‚è€ƒå®˜ç½‘å‡½æ•°è¾“å…¥è¾“å‡º</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html" rel="external" target="_self">å‚è€ƒå®˜ç½‘æ”¶é›†ç³»ç»Ÿæ—¥å¿—</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.elastic.co/guide/en/logstash/current/event-dependent-configuration.html" rel="external" target="_self">å‚è€ƒå®˜ç½‘æ”¶é›†<code>Java</code>æ—¥å¿—</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.elastic.co/guide/en/logstash/current/plugins-codecs-multiline.html" rel="external" target="_self">å‚è€ƒå®˜ç½‘ä½¿ç”¨<code>multiline</code>å¤šè¡Œæ¨¡å¼</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>input{}</code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»æ—¥å¿—æ–‡ä»¶ä¸­è°ƒç”¨å‡½æ•°è¾“å…¥<!-- raw HTML omitted --></li>
<li><code>output{}</code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»æ—¥å¿—æ–‡ä»¶ä¸­è°ƒç”¨å‡½æ•°è¾“å‡º<!-- raw HTML omitted --></li>
<li><code>stdin{}</code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»æ ‡å‡†è¾“å…¥ä¸­æ”¶é›†æ—¥å¿—<!-- raw HTML omitted --></li>
<li><code>stdout{} </code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»æ ‡å‡†è¾“å‡ºæ—¥å¿—<!-- raw HTML omitted --></li>
<li><code>syslog</code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»ç³»ç»Ÿæ—¥å¿—ç¨‹åºä¸­æ”¶é›†æ—¥å¿—<!-- raw HTML omitted --></li>
<li><code>tcp</code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»<!-- raw HTML omitted --><code>TCP</code><!-- raw HTML omitted -->ç¨‹åºç«¯å£ä¸­æ”¶é›†æ—¥å¿—<!-- raw HTML omitted --></li>
<li><code>udp</code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»<!-- raw HTML omitted --><code>UDP</code><!-- raw HTML omitted -->ç¨‹åºç«¯å£ä¸­æ”¶é›†æ—¥å¿—<!-- raw HTML omitted --></li>
<li><code>rubuydebug</code>ï¼š<!-- raw HTML omitted -->é€šè¿‡<!-- raw HTML omitted --><code>rubuy</code><!-- raw HTML omitted -->åº“è¿›è¡Œæ”¶é›†<!-- raw HTML omitted --></li>
<li><code>multiline</code>ï¼š<!-- raw HTML omitted -->å¤šè¡Œæ¨¡å—<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;Settings: Default filter workers: 4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Logstash startup completed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">input {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">type =&gt; &#34;</span>nginx-error-log<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">path =&gt; &#34;</span>/usr/local/nginx/logs/*error*.log<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_position =&gt; &#34;</span>beginning<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}file {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">type =&gt; &#34;</span>nginx-access-log<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">path =&gt; &#34;</span>/usr/local/nginx/logs/*access*.log<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_position =&gt; &#34;</span>beginning<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">codec =&gt; json
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">output {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [type] =~ &#34;</span>nginx-error-log<span style="color:#e6db74">&#34; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">elasticsearch {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hosts =&gt; [&#34;</span>elasticsearchæœåŠ¡æ‰€åœ¨IP:9200<span style="color:#e6db74">&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">index =&gt; &#34;</span>mayi-nginx-error--%<span style="color:#f92672">{</span>+YYYY.MM.dd<span style="color:#f92672">}</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}else if [type] =~ &#34;</span>nginx-access-log<span style="color:#e6db74">&#34; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">elasticsearch {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hosts =&gt; [&#34;</span>elasticsearchæœåŠ¡æ‰€åœ¨IP:9200<span style="color:#e6db74">&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">index =&gt; &#34;</span>mayi-nginx-access-%<span style="color:#f92672">{</span>+YYYY.MM.dd<span style="color:#f92672">}</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">} &#34;</span> &gt;&gt;/opt/elk/logstash/data/nginx-log.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#######  </span>
</span></span><span style="display:flex;"><span>$ cat &gt;logstash.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">input {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> redis {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     host =&gt; &#34;Redis æœåŠ¡æ‰€åœ¨IP&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port =&gt; &#34;6379&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     password =&gt; &#34;password&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     data_type =&gt; &#34;list&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     key =&gt; &#34;filebeat&#34; #ä»redisä¸­å¯¼å…¥çš„keyï¼Œä¸filebeatè¾“å‡ºå¯¹åº”
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     type =&gt; &#34;redis-input&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     db =&gt; 0 #å¯¼å…¥keyçš„æ•°æ®åº“ï¼Œé»˜è®¤ä¸º0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">filter {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # åˆ¤æ–­rediså­—ç¬¦ä¸²åœ¨ä¸åœ¨è‡ªå·±å®šä¹‰çš„æ–°å­—æ®µä¸­ï¼Œç”¨äºåŒºåˆ†æ—¥å¿—ç±»å‹ï¼Œåšå¯¹åº”çš„å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> if &#39;redis&#39; in [app] {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     # èšåˆredisæ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     grok {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		   # è‡ªå®šä¹‰åŒ¹é…æ—¥å¿—å†…å®¹ï¼Œé»˜è®¤ä¸€æ¡æ—¥å¿—ä»ä¸Šåˆ°ä¸‹åªä¼šåŒ¹é…ä¸€æ¬¡å¯¹çš„ã€‚ä¸”åªä¼šåŒ¹é…ä¸€ä¸ªå­—æ®µï¼Œå¦‚éœ€è¦åŒ¹é…å¤šä¸ªå­—æ®µï¼Œéœ€è¿›è¡Œä¸¥æ ¼åŒ¹é…
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		   patterns_dir =&gt; [&#34;/opt/elk/patterns_time&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		   # grokæä¾›å¾ˆå¤šè‡ªå¸¦çš„æ­£åˆ™ï¼Œå¯ä¾›ä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        match =&gt; { &#34;message&#34; =&gt; &#34;%{LOGTIME</span>:log_time<span style="color:#f92672">}</span><span style="color:#e6db74">&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		   # ï¼ˆ?&lt;è‡ªå®šä¹‰çš„&gt;è¦åŒ¹é…çš„å†…å®¹ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        match =&gt; { &#34;</span>message<span style="color:#e6db74">&#34; =&gt; &#34;</span><span style="color:#f92672">(</span>?&lt;log_time&gt;%<span style="color:#f92672">{</span>TIMESTAMP_ISO8601<span style="color:#f92672">})</span>.*session <span style="color:#f92672">(</span>?&lt;session&gt;.*<span style="color:#ae81ff">\S</span>$<span style="color:#f92672">)</span><span style="color:#e6db74">&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     date {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		    # ä¿®æ”¹é‡‡é›†æ—¶é—´ä¸ºæ—¥å¿—é‡Œçš„æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         match =&gt; [&#34;</span>log_time<span style="color:#e6db74">&#34;, &#34;</span>yyyy-MM-dd HH:mm<span style="color:#e6db74">&#34;,&#34;</span>dd MMM yyyy HH:mm:ss.SSS<span style="color:#e6db74">&#34; ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         locale =&gt; &#34;</span>en<span style="color:#e6db74">&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     ruby {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         code =&gt; &#34;</span>event.set<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;timestamp&#39;</span>, event.get<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;@timestamp&#39;</span><span style="color:#f92672">)</span>.time.localtime - 8*60*60<span style="color:#f92672">)</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     ruby {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         code =&gt; &#34;</span>event.set<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;@timestamp&#39;</span>,event.get<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;timestamp&#39;</span><span style="color:#f92672">))</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     mutate {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		      # è½¬æ¢å­—æ®µç±»å‹ï¼Œç”¨äºèšåˆæ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">           convert =&gt; { &#34;</span>session<span style="color:#e6db74">&#34; =&gt; &#34;</span>string<span style="color:#e6db74">&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			  # åˆ é™¤æ— ç”¨å­—æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">           remove_field =&gt; [&#34;</span>log_time<span style="color:#e6db74">&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	 # å°†logstashæ—¶é—´è½¬åŒ–ä¸­å›½æ—¶é—´,logstashé»˜è®¤ä¸ºutcæ—¶é—´ï¼Œæ¯”ä¸­å›½æ—¶é—´æ…¢8ä¸ªå°æ—¶ï¼ˆä¿®æ”¹çš„æ˜¯é‡‡é›†æ—¶é—´ï¼Œå¯¹æ—¥å¿—æ—¶é—´æ²¡æœ‰å½±å“ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ruby {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     code =&gt; &#34;</span>event.set<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;timestamp&#39;</span>, event.get<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;@timestamp&#39;</span><span style="color:#f92672">)</span>.time.localtime + 8*60*60<span style="color:#f92672">)</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ruby {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     code =&gt; &#34;</span>event.set<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;@timestamp&#39;</span>,event.get<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;timestamp&#39;</span><span style="color:#f92672">))</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  mutate {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     remove_field =&gt; [&#34;</span>timestamp<span style="color:#e6db74">&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">output {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ç”¨äºè°ƒè¯•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # stdout{ codec =&gt; rubydebug }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #####  åˆ›å»ºçº¿ä¸Šç¯å¢ƒç´¢å¼•  ######
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if &#39;online_82&#39; in [app] {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     elasticsearch {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       action =&gt; &#34;</span>index<span style="color:#e6db74">&#34; #The operation on ES
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       hosts =&gt; &#34;</span>127.0.0.1:9200<span style="color:#e6db74">&#34; # ElasticSearch host, can be array.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		  # è¾“å‡ºåˆ°esä¸­çš„ç´¢å¼•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       index =&gt; &#34;</span>online_82_%<span style="color:#f92672">{</span>+YYYY.MM.dd<span style="color:#f92672">}</span><span style="color:#e6db74">&#34; #The index to write data to.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       user =&gt; &#34;</span>elastic<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       password =&gt; &#34;</span>dtyn!@<span style="color:#e6db74">$&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 # å¯¹åº”filebeatä¸­[tags],ç”¨å¯¹åº”ç´¢å¼•è¿›è¡Œåˆ¤æ–­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   if [tags][0] == &#39;count&#39; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     elasticsearch {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       action =&gt; &#34;</span>index<span style="color:#e6db74">&#34; #The operation on ES
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       hosts =&gt; &#34;</span>127.0.0.1:9200<span style="color:#e6db74">&#34; #ElasticSearch host, can be array.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       index =&gt; &#34;</span>online_82_redis_count<span style="color:#e6db74">&#34; #The index to write data to.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       user =&gt; &#34;</span>elastic<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       password =&gt; &#34;</span>dtyn!@$<span style="color:#e6db74">&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ£€æŸ¥é…ç½®ã€å¯åŠ¨æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ &#34;--configtest&#34;æˆ–è€…&#34;-t&#34;å‚æ•°æ£€æŸ¥é…ç½®è¯­æ³•æ˜¯å¦æœ‰è¯¯</span>
</span></span><span style="display:flex;"><span>$ /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/nginx.conf --config.test_and_exit
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨ç¨‹åºåå°è¿è¡Œ&#34;&amp;&#34;</span>
</span></span><span style="display:flex;"><span>$ nohup /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/nginx.conf &amp;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &#34;screen&#34; å¯åŠ¨å¦ä¸€ä¸ªç»ˆç«¯ </span>
</span></span><span style="display:flex;"><span>$ /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/nginx.conf
</span></span><span style="display:flex;"><span>$ screen -ls
</span></span><span style="display:flex;"><span>$ screen -r <span style="color:#ae81ff">16582</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h2 id="beatséƒ¨ç½²"><code>Beats</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><code>Beats</code>æ˜¯ç”±<code>Elastic</code>å…¬å¸å¼€å‘å’Œç»´æŠ¤çš„ä¸€ç»„å¼€æºæ•°æ®é‡‡é›†å™¨ã€‚å®ƒä»¬è®¾è®¡ç”¨äºä»å„ç§æ•°æ®æºæ”¶é›†æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€åˆ°<code>Elasticsearch</code>æˆ–è€…<code>Logstash</code>ç­‰åç«¯å­˜å‚¨å’Œåˆ†æç³»ç»Ÿä¸­</li>
</ul>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.elastic.co/guide/en/beats/libbeat/current/index.html" rel="external" target="_self">å®˜æ–¹æ–‡æ¡£</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.elastic.co/cn/downloads/beats/" rel="external" target="_self">é€‰æ‹©ä¸€ä¸ª<code>Beat</code>ä»»ä½•<code>Beat</code>çš†å¯</a></td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="filebeatéƒ¨ç½²"><code>Filebeat</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><code>Filebeat</code>ç”¨äºè½»é‡çº§æ—¥å¿—å’Œæ–‡ä»¶æ•°æ®æ”¶é›†ã€‚<code>Filebeat</code>å¯ä»¥ç›‘æ§æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶æˆ–ä½ç½®ï¼Œæ”¶é›†æ—¥å¿—æ•°æ®ï¼Œå¹¶å°†å…¶å‘é€åˆ°<code>Elasticsearch</code>æˆ–<code>Logstash</code>è¿›è¡Œå­˜å‚¨å’Œåˆ†æ</li>
<li><a href="https://www.elastic.co/cn/downloads/beats/filebeat" rel="external" target="_self">ä¸‹è½½å®‰è£…<code>Filebeat</code></a></li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation-configuration.html" rel="external" target="_self"><code>Filebeat</code>å®‰è£…é…ç½®ç¼–è¾‘</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.3.3-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span>$ tar xzvf filebeat-8.3.3-linux-x86_64.tar.gz</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Filebeat</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># elasticsearch</span>
</span></span><span style="display:flex;"><span>output.elasticsearch:
</span></span><span style="display:flex;"><span>hosts: <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;https://myEShost:9200&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>username: <span style="color:#e6db74">&#34;filebeat_internal&#34;</span>
</span></span><span style="display:flex;"><span>password: <span style="color:#e6db74">&#34;YOUR_PASSWORD&#34;</span> 
</span></span><span style="display:flex;"><span>ssl:
</span></span><span style="display:flex;"><span>enabled: true
</span></span><span style="display:flex;"><span>ca_trusted_fingerprint: <span style="color:#e6db74">&#34;b9a10bbe64ee9826abeda6546fc988c8bf798b41957c33d05db736716513dc9c&#34;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># kibana</span>
</span></span><span style="display:flex;"><span>setup.kibana:
</span></span><span style="display:flex;"><span>host: <span style="color:#e6db74">&#34;mykibanahost:5601&#34;</span> 
</span></span><span style="display:flex;"><span>username: <span style="color:#e6db74">&#34;my_kibana_user&#34;</span>  
</span></span><span style="display:flex;"><span>password: <span style="color:#e6db74">&#34;{pwd}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;filebeat.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">filebeat.inputs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- type: log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  enabled: True # Trueè¡¨ç¤ºæ”¶é›†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # pasthsé…ç½®æ”¶é›†æ—¥å¿—çš„è·¯å¾„ï¼Œæ”¯æŒé…ç½®å¤šæ¡è·¯å¾„ï¼ŒåŠå¤šç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  paths:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - /opt/app/nacos-1.3.2/nacos/bin/logs/*.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # tags æ ‡è®°;å¯ä»¥ç”¨æ¥åŒºåˆ†æ—¥å¿—,è¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨å¯ä»¥å†™å¤šä¸ªæ ‡è®°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  tags: [&#34;nacos&#34;] 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # filedsåˆ›å»ºæ–°çš„å­—æ®µï¼Œé»˜è®¤æ˜¯äºŒçº§å­—æ®µï¼Œå¯ä»¥è‡ªå®šä¹‰å¤šä¸ªkey: value
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  fields:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    app: test_71_nacos-1.3.2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # è®©æ–°å»ºçš„å­—æ®µå˜æˆé¡¶çº§å­—æ®µï¼Œå‡å°‘ä¸å¿…è¦çš„èµ„æºå¼€é”€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  fields_under_root: true 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # è®©filebeaté‡‡é›†æœ€æ–°çš„æ—¥å¿—å˜åŒ–ï¼Œå¿½ç•¥æ‰ä¹‹å‰æ—§æ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  tail_files: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # ä¸‹è¾¹è¿™å‡ é¡¹å¯ä»¥ä¸ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # filebeatä¾é æ–‡ä»¶æè¿°ç¬¦è¯†åˆ«æ–‡ä»¶ï¼Œå½“å‘ç”Ÿé‡å‘½åæˆ–ç§»åŠ¨ï¼Œfilebeatä¾ç„¶é‡‡é›†çš„åŸæ–‡ä»¶ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  close_renamed: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # ç­‰å¾…å†æ¬¡æ£€æŸ¥æ–‡ä»¶çš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯10s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  max_backoff: 1s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # æ­¤é€‰é¡¹æŒ‡å®šç­‰å¾…æ—¶é—´çš„å¢åŠ é€Ÿåº¦,1è¡¨ç¤ºç¦ç”¨å›ç®—ç®—æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  backoff_factor: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ====== Outputs ======
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># --------- reids output ------------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">output.redis:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  hosts: [&#34;RedisæœåŠ¡æ‰€åœ¨IP:6379&#34;] # è¾“å‡ºåˆ°redisçš„ipç«¯å£å·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  password: &#34;password&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  key: &#34;filebeat&#34; # è¾“å‡ºåˆ°redisä¸­çš„keyï¼Œè¿™ä¸ªkeyæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œllen keyæŸ¥çœ‹é•¿åº¦  lrange key 0 -1 æŸ¥çœ‹åˆ—è¡¨æ‰€æœ‰çš„å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  timeout: 30 # è¿æ¥redisè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º5s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">output.elasticsearch:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> hosts: [&#34;&lt;èŠ‚ç‚¹01çš„IP&gt;:9200&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> template.name: &#34;filebeat&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> template.path: &#34;filebeat.template.json&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> template.overwrite: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> username: &#34;elastic&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> password: &#34;changeme&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‹“å±•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">filbeatä¹Ÿå¯ä»¥é‡‡é›†jarå †æ ˆæ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å †æ ˆæ—¥å¿—çš„æ ¼å¼ï¼šå¤šè¡Œæ—¥å¿—å†…å®¹ä¸ºä¸€æ¡æ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- type: log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  enabled: True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  paths:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - /opt/app/nacos-1.3.2/nacos/bin/logs/*.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  multiline:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # è‡ªå®šä¹‰æ¯æ¡æ—¥å¿—çš„å¼€å¤´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    pattern: &#39;\# Time: \d{4}-\d{2}-\d{2}&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# å®šä¹‰æ¨¡å¼æ˜¯å¦è¢«å¦å®š,é»˜è®¤å€¼ä¸ºfalse
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	negate: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# ä¸æ¨¡å¼ä¸åŒ¹é…çš„è¿ç»­è¡Œå°†è¿½åŠ åˆ°åŒ¹é…çš„ä¸Šä¸€è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	match: after
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;filebeat.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">filebeat.config.inputs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  path: /etc/filebeat/input.d/*.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  reload.enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  reload.period: 10s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">filebeat.config.modules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  path: ${path.config}/modules.d/*.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  reload.enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">setup.template.settings:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  index.number_of_shards: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">processors:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - drop_fields:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      fields: [&#34;agent.ephemeral_id&#34;, &#34;agent.hostname&#34;, &#34;agent.id&#34;, &#34;agent.name&#34;, &#34;agent.type&#34;, &#34;agent.version&#34;, &#34;headers&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - rename:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      fields:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - from: &#34;url&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          to: &#34;url_host&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ignore_missing: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      fail_on_error: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">output.elasticsearch:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  hosts: [&#34;&#34;&lt;èŠ‚ç‚¹01çš„IP&gt;:9200&#34;&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  api_key: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  index: &#34;nginx-%{[fields.application]}-%{+yyyy.MM.dd}&#34;  # fields.applicationå‚æ•°ä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  indices:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    when.equals:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      fields.application: [&#39;app-docker-nginx_access&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">setup.ilm.enabled: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è‡ªå®šä¹‰æ¨¡æ¿æ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">setup.template.name: &#34;nginx&#34;  	# æ¨¡æ¿åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">setup.template.pattern: &#34;nginx-*&#34;  	# åŒ¹é…æ¨¡æ¿ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">setup.template.enabled: false  	# falseï¼šä¸ä½¿ç”¨é»˜è®¤æ¨¡æ¿ï¼Œtrueï¼šä½¿ç”¨é»˜è®¤æ¨¡æ¿
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">setup.template.overwrite: true  	# æ˜¯å¦è¦†ç›–åŸæ¥æ¨¡æ¿
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/filebeat/input.d/app-docker-nginx_access.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">filebeat.inputs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- type: log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  paths:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - /usr/local/nginx/logs/gitlab.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  fields:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    application: app-docker-nginx_access
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # å¼€å¯ jsonæ—¥å¿—æ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  json.keys_under_root: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  json.overwrite_keys: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  json.message_key: message
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  json.add_error_key: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è¾“å‡ºä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">output.elasticsearch:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  hosts: [&#34;192.168.1.1:9200&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ—å‡ºä»¥åŠä½¿ç”¨æ¨¡å—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./filebeat modules list
</span></span><span style="display:flex;"><span>$ ./filebeat modules enable nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- module: nginx
</span></span><span style="display:flex;"><span>  access:
</span></span><span style="display:flex;"><span>    enabled: true
</span></span><span style="display:flex;"><span>    var.paths: <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/var/log/nginx/access.log*&#34;</span><span style="color:#f92672">]</span> </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ£€æµ‹å¯åŠ¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./filebeat setup -e
</span></span><span style="display:flex;"><span>$ chown root filebeat.yml 
</span></span><span style="display:flex;"><span>$ chown root modules.d/nginx.yml 
</span></span><span style="display:flex;"><span>$ ./filebeat -e</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="metricbeatéƒ¨ç½²"><code>Metricbeat</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><code>Metricbeat</code>ç”¨äºå®šæ—¶æ”¶é›†ç³»ç»Ÿå’ŒæœåŠ¡çš„æŒ‡æ ‡æ•°æ®ã€‚<code>Metricbeat</code>æ”¯æŒæ”¶é›†å„ç§æœåŠ¡ï¼ˆå¦‚<code>Redis</code>ã€<code>Apache</code>ã€<code>MySQL</code>ç­‰ï¼‰çš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶å°†è¿™äº›æ•°æ®å‘é€åˆ°<code>Elasticsearch</code>æˆ–è€…å…¶ä»–æ•°æ®å­˜å‚¨å’Œå¯è§†åŒ–å·¥å…·ä¸­</li>
</ul>
</blockquote>
<hr>
<h3 id="packetbeatéƒ¨ç½²"><code>Packetbeat</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><code>Packetbeat</code>ç”¨äºå®æ—¶ç½‘ç»œæ•°æ®åˆ†æã€‚<code>Packetbeat</code>å¯ä»¥ç›‘æ§ç½‘ç»œæµé‡ï¼Œæ•è·å’Œåˆ†æåº”ç”¨å±‚åè®®ï¼ˆå¦‚<code>HTTP</code>ã€MySQL<code>ã€</code>DNS`ç­‰ï¼‰çš„æ•°æ®ï¼Œå¸®åŠ©è¯†åˆ«é—®é¢˜å’Œä¼˜åŒ–ç½‘ç»œæ€§èƒ½</li>
</ul>
</blockquote>
<hr>
<h3 id="heartbeatéƒ¨ç½²"><code>Heartbeat</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><code>Heartbeat</code>ç”¨äºç›‘æ§æœåŠ¡çš„å¯ç”¨æ€§ã€‚<code>Heartbeat</code>å¯ä»¥å®šæœŸæ£€æŸ¥æœåŠ¡ã€ç½‘ç«™æˆ–è€…ä¸»æœºçš„å¯è®¿é—®æ€§ï¼Œå¹¶è®°å½•å“åº”æ—¶é—´å’ŒçŠ¶æ€ï¼Œä»¥å¸®åŠ©è¿ç»´äººå‘˜å¿«é€Ÿå‘ç°å’Œè§£å†³æ•…éšœã€‚</li>
</ul>
</blockquote>
<hr>
<h3 id="auditbeatéƒ¨ç½²"><code>Auditbeat</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><code>Auditbeat</code>ç”¨äºæ”¶é›†ç³»ç»Ÿå®¡è®¡æ—¥å¿—ã€‚<code>Auditbeat</code>ç›‘æ§æ“ä½œç³»ç»Ÿå’Œæ–‡ä»¶ç³»ç»Ÿçš„æ´»åŠ¨ï¼ŒåŒ…æ‹¬æ–‡ä»¶è®¿é—®ã€ç”¨æˆ·ç™»å½•ç­‰å®‰å…¨ç›¸å…³äº‹ä»¶ï¼Œå¹¶å°†è¿™äº›äº‹ä»¶å‘é€åˆ°ä¸­å¿ƒåŒ–çš„æ—¥å¿—ç®¡ç†ç³»ç»Ÿ</li>
</ul>
</blockquote>
<hr>
<h2 id="kibanaéƒ¨ç½²"><code>Kibana</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li>
<p><a href="https://www.elastic.co/guide/en/kibana/current/index.html" rel="external" target="_self">éƒ¨ç½²<code>Kibana</code>å›¾å½¢åŒ–å±•ç¤ºå®˜æ–¹æ–‡æ¡£</a></p>
</li>
<li>
<p><code>Kibana</code>æ˜¯ç”±<code>Elastic</code>å…¬å¸å¼€å‘çš„å¼€æºæ•°æ®å¯è§†åŒ–å·¥å…·ï¼Œç”¨äºå¯¹<code>Elasticsearch</code>ç´¢å¼•ä¸­çš„æ•°æ®è¿›è¡Œæœç´¢ã€åˆ†æå’Œå¯è§†åŒ–ã€‚å®ƒæ˜¯<code>Elastic Stack</code>ï¼ˆä¹Ÿç§°ä¸º<code>ELK Stack</code>ï¼‰ä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œä¸<code>Elasticsearch</code>ã€<code>Logstash</code>å’Œ<code>Beats</code>ä¸€èµ·æ„æˆäº†ä¸€ä¸ªå¼ºå¤§çš„æ•°æ®åˆ†æå¹³å°</p>
</li>
<li>
<p>æ˜¯ä¸€ä¸ªåŸºäºæµè§ˆå™¨é¡µé¢çš„<code>Elasticsearch</code>å‰ç«¯å±•ç¤ºå·¥å…·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¼€æºå’Œå…è´¹çš„å·¥å…·ï¼Œ<code>Kibana</code>å¯ä»¥ä¸º<code>Logstash</code>å’Œ<code>ElasticSearch</code>æä¾›çš„æ—¥å¿—åˆ†æå‹å¥½çš„<code>Web</code>ç•Œé¢ï¼Œå¯ä»¥å¸®ä½ æ±‡æ€»ã€åˆ†æå’Œæœç´¢é‡è¦æ•°æ®æ—¥å¿—</p>
</li>
<li>
<p><strong>ä¸»è¦åŠŸèƒ½å’Œç‰¹ç‚¹ï¼š</strong></p>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>æ•°æ®æŸ¥è¯¢å’Œæœç´¢</strong>ï¼š</p>
<p><code>Kibana</code>æä¾›äº†ä¸€ä¸ªç›´è§‚çš„æœç´¢å’ŒæŸ¥è¯¢ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·åœ¨<code>Elasticsearch</code>ç´¢å¼•ä¸­æ‰§è¡Œå¤æ‚çš„æœç´¢æ“ä½œã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨<code>Lucene</code>&gt; æŸ¥è¯¢è¯­æ³•æˆ–è€…ç»“æ„åŒ–çš„æŸ¥è¯¢æ„å»ºå™¨æ¥ç­›é€‰å’ŒæŸ¥æ‰¾æ•°æ®ã€‚</p>
</li>
<li>
<p><strong>æ•°æ®å¯è§†åŒ–</strong>ï¼š</p>
<p><code>Kibana</code>å…è®¸ç”¨æˆ·å°†<code>Elasticsearch</code>&gt; ä¸­çš„æ•°æ®é€šè¿‡å„ç§å›¾è¡¨ï¼ˆå¦‚æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ã€é¥¼å›¾ç­‰ï¼‰å’Œå›¾å½¢åŒ–å±•ç¤ºæ–¹å¼è¿›è¡Œå¯è§†åŒ–ã€‚è¿™äº›å›¾è¡¨å¯ä»¥å¸®åŠ©ç”¨æˆ·ç›´è§‚åœ°ç†è§£æ•°æ®çš„è¶‹åŠ¿ã€å…³ç³»å’Œæ¨¡å¼</p>
</li>
<li>
<p><strong>ä»ªè¡¨ç›˜å’Œè§†å›¾</strong>ï¼š</p>
<p>ç”¨æˆ·å¯ä»¥é€šè¿‡åˆ›å»ºä»ªè¡¨ç›˜<code>Dashboard</code>&gt; æ¥é›†æˆå¤šä¸ªæ•°æ®å¯è§†åŒ–ç»„ä»¶ï¼Œå½¢æˆä¸€ä¸ªå…¨é¢çš„æ•°æ®å±•ç¤ºå’Œç›‘æ§é¢æ¿ã€‚ä»ªè¡¨ç›˜å¯ä»¥åŒ…å«å¤šä¸ªå›¾è¡¨ã€æŒ‡æ ‡å’Œæ•°æ®è¡¨æ ¼ï¼Œä¸ºç”¨æˆ·æä¾›å…¨é¢çš„æ•°æ®æ´å¯ŸåŠ›</p>
</li>
<li>
<p><strong>å®æ—¶æ•°æ®åˆ†æ</strong>ï¼š</p>
<p><code>Kibana</code>æ”¯æŒå®æ—¶æ•°æ®åˆ†æå’Œå®æ—¶æŸ¥è¯¢ï¼Œç”¨æˆ·å¯ä»¥å³æ—¶æŸ¥çœ‹å’Œåˆ†ææ•°æ®çš„å˜åŒ–å’Œè¶‹åŠ¿ã€‚è¿™å¯¹äºç›‘æ§å’Œæ“ä½œå®æ—¶ç³»ç»Ÿç‰¹åˆ«æœ‰ç”¨</p>
</li>
<li>
<p><strong>ç”¨æˆ·æƒé™å’Œå®‰å…¨æ€§</strong>ï¼š</p>
<p><code>Kibana</code>æä¾›äº†çµæ´»çš„ç”¨æˆ·æƒé™ç®¡ç†å’Œå®‰å…¨åŠŸèƒ½ï¼Œå…è®¸ç®¡ç†å‘˜å®šä¹‰å’Œæ§åˆ¶ç”¨æˆ·å¯¹ä¸åŒæ•°æ®å’ŒåŠŸèƒ½çš„è®¿é—®æƒé™ã€‚è¿™å¯¹äºå¤šç”¨æˆ·å’Œå¤šå›¢é˜Ÿåä½œä½¿ç”¨çš„ç¯å¢ƒéå¸¸é‡è¦ã€‚</p>
</li>
<li>
<p><strong>æ’ä»¶å’Œæ‰©å±•æ€§</strong>ï¼š</p>
<p><code>Kibana</code>æä¾›äº†ä¸°å¯Œçš„æ’ä»¶å’Œå¯æ‰©å±•çš„<code>API</code>ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œåœºæ™¯å®šåˆ¶å’Œæ‰©å±•<code>Kibana</code>çš„åŠŸèƒ½ã€‚ç¤¾åŒºå’Œç¬¬ä¸‰æ–¹å¼€å‘è€…å¯ä»¥é€šè¿‡æ’ä»¶æ‰©å±•<code>Kibana</code>çš„åŠŸèƒ½ï¼Œå¢åŠ æ–°çš„æ•°æ®å¤„ç†å’Œå¯è§†åŒ–èƒ½åŠ›ã€‚</p>
</li>
</ul>
</blockquote>
<ul>
<li><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>æ—¥å¿—åˆ†æå’Œç›‘æ§</strong>ï¼š</p>
<p>é€šè¿‡ç»“åˆ<code>Elasticsearch</code>å’Œ<code>Beats</code>ï¼Œ<code>Kibana</code>å¯ä»¥å®æ—¶åˆ†æå’Œç›‘æ§æ—¥å¿—æ•°æ®ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå‘ç°å’Œè§£å†³ç³»ç»Ÿé—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>åº”ç”¨æ€§èƒ½ç›‘æ§</strong>ï¼š</p>
<p>é€šè¿‡é›†æˆ<code>Metricbeat</code>å’Œ<code>Elasticsearch</code>ï¼Œ<code>Kibana</code>å¯ä»¥å®æ—¶å±•ç¤ºå’Œåˆ†æåº”ç”¨ç¨‹åºçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¸®åŠ©å¼€å‘å›¢é˜Ÿä¼˜åŒ–åº”ç”¨æ€§èƒ½ã€‚</p>
</li>
<li>
<p><strong>å®‰å…¨äº‹ä»¶åˆ†æ</strong>ï¼š</p>
<p>ç»“åˆ<code>Auditbeat</code>å’Œ<code>Elasticsearch</code>ï¼Œ<code>Kibana</code>å¯ä»¥ç›‘æ§å’Œåˆ†æç³»ç»Ÿå’Œåº”ç”¨çš„å®‰å…¨äº‹ä»¶ï¼Œå¸®åŠ©å®‰å…¨å›¢é˜ŸåŠæ—¶å“åº”å’Œè°ƒæŸ¥å®‰å…¨äº‹ä»¶ã€‚</p>
</li>
</ul>
</blockquote>
<ul>
<li><a href="https://elastic.co/cn/downloads/kibana" rel="external" target="_self">ä¸‹è½½ã€è§£å‹<code>Kibana</code>å›¾å½¢åŒ–å±•ç¤ºå·¥å…·</a></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -O https://artifacts.elastic.co/downloads/kibana/kibana-8.3.3-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span>$ curl https://artifacts.elastic.co/downloads/kibana/kibana-8.3.3-linux-x86_64.tar.gz.sha512 | sha512sum -c - 
</span></span><span style="display:flex;"><span>$ tar -zxvf kibana-8.3.3-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span>$ cd kibana-8.3.3/ </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/kibana-8.3.3/config
</span></span><span style="display:flex;"><span>$ cp kibana.yml<span style="color:#f92672">{</span>,.bak<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 6è¡Œå·¦å³ã€å»æ‰æ³¨é‡Š</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/server.port:/a\\server.port: 5601&#34;</span> kibana.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 11è¡Œå·¦å³ã€å»æ‰æ³¨é‡Šï¼Œä¿®æ”¹ä¸ºæœ¬æœºIP</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/server.host:/a\\server.host: &#34;KibanaæœåŠ¡æ‰€åœ¨IP&#34;&#39;</span> kibana.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 43è¡Œå·¦å³ã€å»æ‰æ³¨é‡Šï¼Œä¿®æ”¹ä¸ºelssticsearchçš„IPåœ°å€å’Œç«¯å£</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/elasticsearch.host:/a\\elasticsearch.host: [&#34;http://elssticsearchæœåŠ¡æ‰€åœ¨IP:9200&#34;]&#39;</span> kibana.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 49è¡Œå·¦å³ã€è®¾ç½®è®¿é—®ç”¨æˆ·åå¯†ç </span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/#elasticsearch.username:/a\\elasticsearch.username: &#34;username&#34;&#39;</span> kibana.yml
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/#elasticsearch.password:/a\\elasticsearch.password: &#34;password&#34;&#39;</span> kibana.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sed -i &#39;/kibana.index:/a\\kibana.index: &#34;.kibana&#34;&#39; kibana.yml  	# æ–°ç‰ˆä¸å­˜åœ¨æ­¤å‚æ•°</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨æœåŠ¡ã€å¤„ç†ä¸èƒ½åˆ é™¤ç´¢å¼•é—®é¢˜<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾ï¼š5601<!-- raw HTML omitted --><!-- raw HTML omitted -->ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ£€æµ‹å¯åŠ¨æ–¹å¼  </span>
</span></span><span style="display:flex;"><span>$ ps -p <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./bin/kibana
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘½ä»¤è¡Œæ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>$ curl -XPUT -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> http://localhost:9200/_all/_settings -d <span style="color:#e6db74">&#39;{&#34;index.blocks.read_only_allow_delete&#34;:null}&#39;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æµè§ˆå™¨</span>
</span></span><span style="display:flex;"><span>PUT _settings
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;index&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;blocks&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;read_only_allow_delete&#34;</span>: <span style="color:#e6db74">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;delete-es-index.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">date=`date -d &#34;7 days ago&#34; +%Y.%m.%d`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">curl -XDELETE -u &#39;elastic:dtyn!@$&#39; http://localhost:9200/*{$date}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_elk">Configure_ELK</h1>

<h2 id="é…ç½®elasticsearchredis">é…ç½®<code>elasticsearch+redis</code></h2>
<ul>
<li>
<ol>
<li><code>elasticsearch</code><!-- raw HTML omitted -->å‡ºç°é—®é¢˜æ€ä¹ˆå¤„ç†<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>æ¥ä¸‹æ¥æè¿°ä¼šé‡è§åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼šä¸€æ—¦æˆ‘ä»¬çš„<code>elasticsearch</code>å‡ºç°é—®é¢˜ï¼Œå°±ä¸èƒ½è¿›è¡Œæ—¥å¿—é‡‡é›†å¤„ç†äº†ï¼è¿™ç§æƒ…å†µä¸‹è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</li>
<li><!-- raw HTML omitted -->è§£å†³æ–¹æ¡ˆï¼š<!-- raw HTML omitted -->å¯ä»¥åœ¨<code>client</code>å’Œ<code>elasticsearch</code>ä¹‹é—´æ·»åŠ ä¸€ä¸ªä¸­é—´ä»¶ä½œä¸ºç¼“å­˜ï¼Œå…ˆå°†é‡‡é›†åˆ°çš„æ—¥å¿—å†…å®¹å†™åˆ°ä¸­é—´ä»¶ä¸Šï¼Œç„¶åå†ä»ä¸­é—´ä»¶è¾“å…¥åˆ°<code>elasticsearch</code>ä¸­ã€‚
è¿™å°±å®Œç¾çš„è§£å†³äº†ä¸Šè¿°çš„é—®é¢˜äº†ã€‚<code>ELK</code>ä¸­ä½¿ç”¨<code>redis</code>ä½œä¸ºä¸­é—´ä»¶ï¼Œç¼“å­˜æ—¥å¿—é‡‡é›†å†…å®¹</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl <span style="color:#e6db74">&#39;localhost:9200/_cat/health?v&#39;</span>  	<span style="color:#75715e"># æ£€æµ‹é›†ç¾¤æ˜¯å¦å¥åº·</span>
</span></span><span style="display:flex;"><span>$ curl <span style="color:#e6db74">&#39;localhost:9200/_cat/nodes?v&#39;</span>  	<span style="color:#75715e"># è·å–é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>$ curl <span style="color:#e6db74">&#39;localhost:9200/_cat/indices?v&#39;</span>  	<span style="color:#75715e"># åˆ—å‡ºæ‰€æœ‰ç´¢å¼•</span>
</span></span><span style="display:flex;"><span>$ curl -XPUT <span style="color:#e6db74">&#39;localhost:9200/customer?pretty&#39;</span>  	<span style="color:#75715e"># åˆ›å»ºä¸€ä¸ªåä¸º&#34;customer&#34;çš„ç´¢å¼•</span>
</span></span><span style="display:flex;"><span>$ curl -XDELETE <span style="color:#e6db74">&#39;localhost:9200/customer?pretty&#39;</span>  	<span style="color:#75715e"># åˆ é™¤ä¸€ä¸ªåä¸º&#34;customer&#34;çš„ç´¢å¼•</span>
</span></span><span style="display:flex;"><span>$ curl localhost:9200/_cat/segments/<span style="color:#f92672">{</span>indexName<span style="color:#f92672">}</span>|wc -l  	<span style="color:#75715e"># æŸ¥çœ‹æŸä¸ªç´¢å¼•çš„æ®µæ•°é‡ï¼šGET /nginx-2022-*/_segments</span>
</span></span><span style="display:flex;"><span>$ curl -XPOST 192.168.60.7:9200/indexName/_forcemerge?max_num_segments<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># åˆå¹¶æŸä¸ªç´¢å¼•çš„æ®µ</span>
</span></span><span style="display:flex;"><span>POST /nginx-2022-*/_forcemerge?max_num_segments<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æ”¯æŒé€šé…ç¬¦</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;delete_es_index.sh<span style="color:#e6db74">&lt;&lt;-EOF 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®šæœŸåˆ é™¤ä¸¤ä¸ªæœˆä¹‹å‰elasticsearchç´¢å¼•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">date=`date -d &#34;-2 months&#34; &#34;+%Y.%m&#34;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/usr/bin/curl -v --user elastic:elasticç”¨æˆ·å¯†ç  -XDELETE &#34;http://esæœºå™¨IP:9200/*-$date&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Redis</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /etc/redis.conf  	<span style="color:#75715e"># ä¿®æ”¹ä¸‹é¢ä¸¤è¡Œå†…å®¹</span>
</span></span><span style="display:flex;"><span>daemonize yes
</span></span><span style="display:flex;"><span>bind 192.168.1.160
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl start redis
</span></span><span style="display:flex;"><span>$ lsof -i:6379
</span></span><span style="display:flex;"><span>COMMAND     PID  USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME
</span></span><span style="display:flex;"><span>redis-ser <span style="color:#ae81ff">19474</span> redis    4u  IPv4 <span style="color:#ae81ff">1344465</span>      0t0  TCP elk-node1:6379 <span style="color:#f92672">(</span>LISTEN<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ redis-cli -h 192.168.1.160
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; info
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Server</span>
</span></span><span style="display:flex;"><span>redis_version:2.8.19
</span></span><span style="display:flex;"><span>.......</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç¼–å†™ä»<!-- raw HTML omitted --><code>Client</code><!-- raw HTML omitted -->ç«¯æ”¶é›†æ•°æ®çš„æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /opt/logstash/data/redis-out.conf
</span></span><span style="display:flex;"><span>input <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>stdin <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ‰§è¡Œæ”¶é›†æ•°æ®çš„æ–‡ä»¶ï¼Œå¹¶è¾“å…¥æ•°æ®<!-- raw HTML omitted --><code>hello redis</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f redis-out.conf 
</span></span><span style="display:flex;"><span>Settings: Default filter workers: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Logstash startup completed  	<span style="color:#75715e"># ä¸‹é¢è¾“å…¥æ•°æ®hello redis</span>
</span></span><span style="display:flex;"><span>hello redis</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->ä¸­æŸ¥çœ‹æ•°æ®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ redis-cli -h 192.168.1.160
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; info
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Server</span>
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Keyspace</span>
</span></span><span style="display:flex;"><span>db6:keys<span style="color:#f92672">=</span>1,expires<span style="color:#f92672">=</span>0,avg_ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>  	<span style="color:#75715e"># åœ¨æœ€ä¸‹é¢ä¸€è¡Œï¼Œæ˜¾ç¤ºæ˜¯db6</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; keys *
</span></span><span style="display:flex;"><span>1<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; LINDEX demo -1
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;{\&#34;message\&#34;:\&#34;hello redis\&#34;,\&#34;@version\&#34;:\&#34;1\&#34;,\&#34;@timestamp\&#34;:\&#34;2016-11-14T08:04:25.981Z\&#34;,\&#34;host\&#34;:\&#34;elk-node1\&#34;}&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->ç»§ç»­éšä¾¿å†™ç‚¹æ•°æ®æµ‹è¯•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f redis-out.conf
</span></span><span style="display:flex;"><span>Settings: Default filter workers: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Logstash startup completed
</span></span><span style="display:flex;"><span>hello redis
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">123456</span>
</span></span><span style="display:flex;"><span>asdf
</span></span><span style="display:flex;"><span>ert
</span></span><span style="display:flex;"><span>wang
</span></span><span style="display:flex;"><span>shi
</span></span><span style="display:flex;"><span>bo
</span></span><span style="display:flex;"><span>guohuihui
</span></span><span style="display:flex;"><span>as
</span></span><span style="display:flex;"><span>we
</span></span><span style="display:flex;"><span>r
</span></span><span style="display:flex;"><span>g
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>asdfjkdfsak
</span></span><span style="display:flex;"><span>5423wer
</span></span><span style="display:flex;"><span>34rt3
</span></span><span style="display:flex;"><span>6y
</span></span><span style="display:flex;"><span>7uj
</span></span><span style="display:flex;"><span>u
</span></span><span style="display:flex;"><span>io9
</span></span><span style="display:flex;"><span>sdjfhsdk890
</span></span><span style="display:flex;"><span>huanqiu
</span></span><span style="display:flex;"><span>huanqiuchain
</span></span><span style="display:flex;"><span>hqsb
</span></span><span style="display:flex;"><span>asda    </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->ä¸­æŸ¥çœ‹é•¿åº¦<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ redis-cli -h 192.168.1.160
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; info
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Server</span>
</span></span><span style="display:flex;"><span>redis_version:2.8.19
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Keyspace</span>
</span></span><span style="display:flex;"><span>db6:keys<span style="color:#f92672">=</span>1,expires<span style="color:#f92672">=</span>0,avg_ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>  	<span style="color:#75715e"># æ˜¾ç¤ºæ˜¯db6</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; keys *
</span></span><span style="display:flex;"><span>1<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; LLEN demo
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>integer<span style="color:#f92672">)</span> <span style="color:#ae81ff">24</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="8">
<li><!-- raw HTML omitted -->å°†<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->ä¸­çš„å†…å®¹å†™åˆ°<!-- raw HTML omitted --><code>elasticsearch</code><!-- raw HTML omitted -->ä¸­<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim redis-in.conf
</span></span><span style="display:flex;"><span>input <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span> port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span> db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span> data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span> key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>elasticsearch <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> hosts <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;192.168.1.160:9200&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span> index <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;redis-in-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="9">
<li><!-- raw HTML omitted -->æ‰§è¡Œ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f  redis-in.conf --configtest
</span></span><span style="display:flex;"><span>Configuration OK
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f  redis-in.conf &amp;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨redisä¸­æŸ¥çœ‹ï¼Œå‘ç°æ•°æ®å·²è¢«è¯»å‡ºï¼š</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; LLEN demo
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>integer<span style="color:#f92672">)</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç™»é™†elasticsearchç•Œé¢æŸ¥çœ‹</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="10">
<li><!-- raw HTML omitted -->å°†æ”¶é›†åˆ°çš„æ‰€æœ‰æ—¥å¿—å†™å…¥åˆ°<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->ä¸­ã€‚è¿™äº†é‡æ–°å®šä¹‰ä¸€ä¸ªæ·»åŠ <!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->ç¼“å­˜åçš„æ€»æ–‡ä»¶<!-- raw HTML omitted --><code>shipper.conf</code><!-- raw HTML omitted -->ã€‚ï¼ˆå¯ä»¥å°†ä¹‹å‰æ‰§è¡Œçš„æ€»æ–‡ä»¶<!-- raw HTML omitted --><code>file.conf</code><!-- raw HTML omitted -->åœæ‰ï¼‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim shipper.conf
</span></span><span style="display:flex;"><span>input <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>file <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> path <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;/var/log/messages&#34;</span>
</span></span><span style="display:flex;"><span> type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system&#34;</span>
</span></span><span style="display:flex;"><span> start_position <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;beginning&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>file <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  path <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;/var/log/elasticsearch/huanqiu.log&#34;</span>
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;es-error&#34;</span>
</span></span><span style="display:flex;"><span>  start_position <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;beginning&#34;</span>
</span></span><span style="display:flex;"><span>  codec <span style="color:#f92672">=</span>&gt; multiline <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      pattern <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;^\[&#34;</span>
</span></span><span style="display:flex;"><span>      negate <span style="color:#f92672">=</span>&gt; true
</span></span><span style="display:flex;"><span>      what <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;previous&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>file <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   path <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;/var/log/nginx/access_json.log&#34;</span>
</span></span><span style="display:flex;"><span>   codec <span style="color:#f92672">=</span>&gt; json
</span></span><span style="display:flex;"><span>   start_position <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;beginning&#34;</span>
</span></span><span style="display:flex;"><span>   type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;nginx-log&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>syslog <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system-syslog&#34;</span>
</span></span><span style="display:flex;"><span>    host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>    port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;514&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;system&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>    port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>    db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>    data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;es-error&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>   port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>   db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>   data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>   key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;nginx-log&#34;</span><span style="color:#f92672">{</span>   
</span></span><span style="display:flex;"><span>   redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>      port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>      db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>      data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>      key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;nginx-log&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;system-syslog&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>      port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>      db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>      data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>      key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system-syslog&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="11">
<li><!-- raw HTML omitted -->æ‰§è¡Œä¸Šé¢çš„æ–‡ä»¶ï¼ˆæå‰å°†ä¸Šé¢ä¹‹å‰å¯åŠ¨çš„<!-- raw HTML omitted --><code>file.conf</code><!-- raw HTML omitted -->æ–‡ä»¶çš„æ‰§è¡Œç»™ç»“æŸæ‰ï¼ï¼‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$  /opt/logstash/bin/logstash -f shipper.conf --configtest
</span></span><span style="display:flex;"><span>Configuration OK
</span></span><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f shipper.conf
</span></span><span style="display:flex;"><span>Settings: Default filter workers: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Logstash startup completed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨redisä¸­æŸ¥çœ‹ï¼š</span>
</span></span><span style="display:flex;"><span>$ redis-cli -h 192.168.1.160
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; info
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Server</span>
</span></span><span style="display:flex;"><span>redis_version:2.8.19
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Keyspace</span>
</span></span><span style="display:flex;"><span>db6:keys<span style="color:#f92672">=</span>1,expires<span style="color:#f92672">=</span>0,avg_ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>  	<span style="color:#75715e"># æ˜¾ç¤ºæ˜¯db6</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; keys *
</span></span><span style="display:flex;"><span>1<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span>2<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;system&#34;</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; keys *
</span></span><span style="display:flex;"><span>1<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;nginx-log&#34;</span>
</span></span><span style="display:flex;"><span>2<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span>3<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;system&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¦å¼€ä¸€ä¸ªçª—å£ï¼Œæ·»åŠ ç‚¹æ—¥å¿—:</span>
</span></span><span style="display:flex;"><span>$ logger <span style="color:#e6db74">&#34;12325423&#34;</span>
</span></span><span style="display:flex;"><span>$ logger <span style="color:#e6db74">&#34;12325423&#34;</span>
</span></span><span style="display:flex;"><span>$ logger <span style="color:#e6db74">&#34;12325423&#34;</span>
</span></span><span style="display:flex;"><span>$ logger <span style="color:#e6db74">&#34;12325423&#34;</span>
</span></span><span style="display:flex;"><span>$ logger <span style="color:#e6db74">&#34;12325423&#34;</span>
</span></span><span style="display:flex;"><span>$ logger <span style="color:#e6db74">&#34;12325423&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆä¼šå¢åŠ æ—¥å¿—ï¼š</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; keys *
</span></span><span style="display:flex;"><span>1<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;system-syslog&#34;</span>
</span></span><span style="display:flex;"><span>2<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;nginx-log&#34;</span>
</span></span><span style="display:flex;"><span>3<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span>4<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;system&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="12">
<li><!-- raw HTML omitted -->å¯ä»¥åœ¨ä»»æ„çš„ä¸€å°<!-- raw HTML omitted --><code>ES</code><!-- raw HTML omitted -->ä¸­å°†æ•°æ®ä»<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->è¯»å–åˆ°<!-- raw HTML omitted --><code>ES</code><!-- raw HTML omitted -->ä¸­ã€‚
ä¸‹é¢å’±ä»¬åœ¨<!-- raw HTML omitted --><code>elk-node2</code><!-- raw HTML omitted -->èŠ‚ç‚¹ï¼Œå°†æ•°æ®ä»<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->è¯»å–åˆ°<!-- raw HTML omitted --><code>ES</code><!-- raw HTML omitted -->ä¸­ï¼š
ç¼–å†™æ–‡ä»¶ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat file.conf
</span></span><span style="display:flex;"><span>input <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system&#34;</span>
</span></span><span style="display:flex;"><span>   host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>   port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>   db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>   data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>   key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;es-error&#34;</span>
</span></span><span style="display:flex;"><span>   host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>   port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>   db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>   data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>   key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;es-error&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;nginx-log&#34;</span>
</span></span><span style="display:flex;"><span>      host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>      port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>      db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>      data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>      key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;nginx-log&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system-syslog&#34;</span>
</span></span><span style="display:flex;"><span>      host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>      port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>      db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>      data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>      key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system-syslog&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;system&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    elasticsearch <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       hosts <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;192.168.1.160:9200&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>       index <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;es-error&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    elasticsearch <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       hosts <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;192.168.1.160:9200&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>       index <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;es-error-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;nginx-log&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   elasticsearch <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      hosts <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;192.168.1.160:9200&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>      index <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;nignx-log-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;system-syslog&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    elasticsearch <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       hosts <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;192.168.1.160:9200&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>       index <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system-syslog-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f file.conf --configtest
</span></span><span style="display:flex;"><span>Configuration OK
</span></span><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f file.conf &amp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å»redisä¸­æ£€æŸ¥ï¼Œå‘ç°æ•°æ®å·²ç»è¢«è¯»å‡ºåˆ°elasticsearchä¸­äº†ã€åŒæ—¶ç™»é™†logstashå’Œkibanaçœ‹ï¼Œå‘ç°å¯ä»¥æ­£å¸¸æ”¶é›†åˆ°æ—¥å¿—äº†ã€‚</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; keys *
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>empty list or set<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯ä»¥æ‰§è¡Œè¿™ä¸ª å»æŸ¥çœ‹nginxæ—¥å¿—ã€ä¹Ÿå¯ä»¥å¯åŠ¨å¤šä¸ªrediså†™åˆ°ESä¸­ï¼Œå…·ä½“æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè€Œå®šã€‚</span>
</span></span><span style="display:flex;"><span>$ ab -n10000 -c1 http://192.168.1.160/ </span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="../../../js/clipboard.min.js?1722425299" defer></script>
    <script src="../../../js/perfect-scrollbar.min.js?1722425299" defer></script>
    <script src="../../../js/theme.js?1722425299" defer></script>
  </body>
</html>
