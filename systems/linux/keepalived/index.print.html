<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <meta name="author" content="äºŒå“¥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/s2-1.png">
    <meta name="twitter:title" content="Keepalived :: Hugo Relearn Theme">
    <meta property="og:url" content="https://erge.blog/systems/linux/keepalived/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Keepalived :: Hugo Relearn Theme">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://erge.blog/images/s2-1.png">
    <meta itemprop="name" content="Keepalived :: Hugo Relearn Theme">
    <meta itemprop="datePublished" content="2024-06-13T00:30:23+08:00">
    <meta itemprop="dateModified" content="2024-06-13T00:30:23+08:00">
    <meta itemprop="image" content="https://erge.blog/images/s2-1.png">
    <title>Keepalived :: Hugo Relearn Theme</title>
    <link href="../../../images/favicon.ico?1719333223" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../css/fontawesome-all.min.css?1719333224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fontawesome-all.min.css?1719333224" rel="stylesheet"></noscript>
    <link href="../../../css/nucleus.css?1719333224" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1719333224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/auto-complete.css?1719333224" rel="stylesheet"></noscript>
    <link href="../../../css/perfect-scrollbar.min.css?1719333224" rel="stylesheet">
    <link href="../../../css/fonts.css?1719333224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fonts.css?1719333224" rel="stylesheet"></noscript>
    <link href="../../../css/theme.css?1719333224" rel="stylesheet">
    <link href="../../../css/theme-relearn-auto.css?1719333224" rel="stylesheet" id="R-variant-style">
    <link href="../../../css/chroma-relearn-auto.css?1719333224" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../css/variant.css?1719333224" rel="stylesheet">
    <link href="../../../css/print.css?1719333224" rel="stylesheet" media="print">
    <link href="../../../css/format-print.css?1719333224" rel="stylesheet">
    <script src="../../../js/variant.js?1719333224"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../systems/linux/keepalived/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Keepalived</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/kubernetes/configure_k8s_auth/" title="Configure_K8s_Auth (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/keepalived/install_keepalived/" title="Install_Keepalived (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="keepalived">Keepalived</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Keepalived</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_keepalived">Install_Keepalived</h1>

<h2 id="keepalivedç®€ä»‹"><code>Keepalived</code>ç®€ä»‹</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ ‡ç­¾ï¼š é«˜å¯ç”¨<!-- raw HTML omitted --><code>vrrp</code></li>
<li><code>Keepalived</code>å•¥è½¯ä»¶èµ·åˆæ˜¯å‡†å°‰<code>LVS</code>è´Ÿè½½è½¯ä»¶è®¾è®¡çš„ï¼Œç”¨æ¥ç®¡ç†å¹¶ç›‘æ§<code>LVS</code>é›†ç¾¤ç³»ç»Ÿä¸­å„ä¸ªæœåŠ¡èŠ‚ç‚¹çš„è£…é˜¿æï¼Œåæ¥åŠ å…¥äº†é«˜å¯ç”¨çš„<code>VRRP</code>åŠŸèƒ½ã€‚ <code>VRRP</code>æ˜¯<code>Virtual Router Redundancy Protocol(è™šæ‹Ÿè·¯ç”±å™¨å†—ä½™åè®®)</code>çš„ç¼©å†™ï¼Œä¸ºè§£å†³é™æ€è·¯ç”±å™¨å•ç‚¹æ•…éšœé—®é¢˜ï¼Œç¡®ä¿ä¸ªåˆ«èŠ‚ç‚¹å®•æœºæ—¶ï¼ŒçœŸå“¥å“¥ç½‘ç»œå¯ä»¥ä¸é—´æ–­åœ°è¿è¡Œã€‚ <code>Keepalived</code>å¦ä¸€æ–¹é¢å…·æœ‰é…ç½®é…ç½®ç®¡ç†<code>LVS</code>çš„åŠŸèƒ½ï¼ŒåŒæ—¶è¿˜å…·æœ‰å¯¹<code>LVS</code>ä¸‹é¢èŠ‚è¿›è¡Œå¥åº·æ£€æŸ¥çš„åŠŸèƒ½ã€‚</li>
<li><code>VRRP</code>åŸç†ä»‹ç»</li>
</ul>
<blockquote>
<ul>
<li><code>VRRP</code>ï¼Œå…¨ç§°<code>Virtual Router Redundancy Protocol</code>ä¸­æ–‡åä¸ºè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ï¼Œ<code>VRRP</code>çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³é™æ€è·¯ç”±çš„å•</li>
<li><code>keepalived</code>é€šè¿‡<code>vrrp</code>é€šä¿¡ï¼Œé€šè¿‡ç«é€‰ç¡®å®šä¸»å¤‡åè®®æœºåˆ¶æ¥å°†è·¯ç”±ä»»åŠ¡äº¤ç»™æŸå°<code>VRRP</code>è·¯ç”±å™¨çš„ï¼Œä¸»ä¼˜å…ˆçº§é«˜äºå¤‡ã€‚å› æ­¤ï¼Œå·¥ä½œæ—¶ä¸»ä¼šè·å¾—æ‰€æœ‰èµ„æºï¼Œå¤‡èŠ‚ç‚¹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå½“ä¸»èŠ‚ç‚¹å®•æœºï¼Œé‚£ä¹ˆå¤‡èŠ‚ç‚¹å¯ç”¨æ¥ç®¡ç¨‹åºæ¥ç®¡ä¸»èŠ‚ç‚¹èµ„æºï¼Œé¡¶æ›¿ä¸»èŠ‚ç‚¹æä¾›æœåŠ¡ã€‚</li>
<li><code>VRRP</code>æŠ¥æ–‡å°è£…åœ¨<code>IP</code>æŠ¥æ–‡ä¸­ï¼Œåªæœ‰ä¸€ç§<code>VRRP</code>é€šå‘ŠæŠ¥æ–‡ï¼Œ åªæœ‰å¤„äº<code>master</code>çŠ¶æ€ä¸‹çš„è·¯ç”±å™¨ä¼šå‘é€ï¼Œ<code>VRRP</code>ç”¨<code>IP</code>å¤šæ’­çš„æ–¹å¼ï¼ˆé»˜è®¤å¤šæ’­åœ°å€ï¼ˆ224.0.0.18ï¼‰ï¼‰å®ç°é«˜å¯ç”¨å¯¹ä¹‹é—´é€šä¿¡ã€‚</li>
<li>åœ¨<code>Keepalived</code>æœåŠ¡å¯¹ä¹‹é—´ï¼Œåªæœ‰ä½œä¸ºä¸»çš„æœåŠ¡å™¨ä¼šä¸€ç›´å‘é€<code>VRRP</code>å¹¿æ’­åŒ…ï¼Œå‘Šè¯‰å¤‡å®ƒè¿˜æ´»ç€ï¼Œæ­¤æ—¶å¤‡ä¸ä¼šæŠ¢å ä¸»ï¼Œå½“ä¸»ä¸å¯ç”¨æ—¶ï¼Œå³ç›‘å¬ä¸åˆ°ä¸»å‘é€çš„å¹¿æ’­åŒ…æ—¶ï¼Œå°±ä¼šå¯åŠ¨ç›¸å…³æœåŠ¡æ¥ç®¡èµ„æºï¼Œä¿è¯ä¸šåŠ¡çš„è¿ç»­æ€§ã€‚æ¥ç®¡é€Ÿåº¦æœ€å¿«å¯ä»¥å°äº1ç§’ï¼Œå¤‡èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªï¼Œé€šè¿‡ä¼˜å…ˆçº§ç«é€‰ï¼Œä½†ä¸€èˆ¬<code>Keepalived</code>ç³»ç»Ÿè¿ç»´å·¥ä½œä¸­éƒ½æ˜¯ä¸€å¯¹ã€‚</li>
<li><code>VRRP</code>ä½¿ç”¨äº†åŠ å¯†åè®®åŠ å¯†æ•°æ®ï¼Œä½†<code>Keepalived</code>å®˜æ–¹ç›®å‰è¿˜æ˜¯æ¨èç”¨æ˜æ–‡çš„æ–¹å¼é…ç½®è®¤è¯ç±»å‹å’Œå¯†ç ã€‚</li>
</ul>
<blockquote>
<ul>
<li><code>VRID</code>è™šæ‹Ÿè·¯ç”±å™¨è¡¨ç¤ºï¼Œæ‹¥æœ‰ç›¸åŒ<code>VRID</code>çš„ä¸€ç»„è·¯ç”±å™¨æ„æˆä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨ï¼Œä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹Ÿ<code>IP</code>åœ°å€</li>
<li>è™šæ‹Ÿ<code>MAC</code>åœ°å€<code>00-00-5E-00-01ï¼ˆVRIDï¼‰</code></li>
<li>åˆ†ä¸ºæŠ¢å å’Œä¸æŠ¢å </li>
<li>ä¼˜å…ˆçº§é«˜çš„æˆä¸º<code>master</code>è·¯ç”±å™¨ï¼ŒèŒƒå›´æ˜¯0-255ï¼Œ0è¡¨ç¤ºè·¯ç”±å™¨æ”¾å¼ƒ<code>master</code>çŠ¶æ€ï¼Œ255è¡¨ç¤ºè™šæ‹Ÿ<code>IP</code>åœ°å€å®é™…æ‹¥æœ‰è€…ã€‚é»˜è®¤ä¸º100</li>
<li><code>backup</code>è·¯ç”±å™¨åˆ‡æ¢åˆ°<code>master</code>è·¯ç”±å™¨çš„æ—¶é—´ä¸º<code>skew time=256-backup</code>è·¯ç”±å™¨ä¼˜å…ˆçº§/256</li>
<li><code>master</code>å¤±æ•ˆï¼Œ<code>backup</code>è½¬æ¢æˆ<code>master</code>éœ€è¦çš„æ—¶é—´ä¸º<code>3*V</code>éš”<code>RRP</code>æŠ¥æ–‡é—´<code>Skew tim</code></li>
</ul>
</blockquote>
</blockquote>
<ul>
<li><code>Keepalived</code>æœåŠ¡çš„ä¸‰ä¸ªé‡è¦åŠŸèƒ½</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->ç®¡ç†<!-- raw HTML omitted --><code>LVS</code><!-- raw HTML omitted -->è´Ÿè½½å‡è¡¡è½¯ä»¶<!-- raw HTML omitted --></p>
<p><code>Keepalived</code>è½¯ä»¶èµ·åˆæ˜¯ä¸ºäº†è§£å†³<code>LVS</code>çš„é—®é¢˜è€Œè¯ç”Ÿçš„ã€‚å› æ­¤ï¼Œ<code>Keepalived</code>å’Œ<code>LVS</code>çš„æ„Ÿæƒ…å¾ˆæ·±ï¼Œå‘å¤«å¦»ä¸€æ ·å¯ä»¥ç´§å¯†ç»“åˆï¼Œæ„‰å¿«åœ°å·¥ä½œã€‚ <code>Keepalived</code>é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶ï¼Œå®ç°é€šè¿‡æ›´åº•å±‚çš„æ¥å£ç›´æ¥ç®¡ç†<code>LVS</code>åŠæ§åˆ¶æœåŠ¡å™¨çš„å¯åŠ¨ã€åœæ­¢ç­‰åŠŸèƒ½ï¼Œä½¿å¾—<code>LVS</code>åº”ç”¨æ›´åŠ ç®€å•æ–¹ä¾¿ã€‚</p>
</li>
<li>
<p><!-- raw HTML omitted -->å®ç°å¯¹<!-- raw HTML omitted --><code>LVS</code><!-- raw HTML omitted -->é›†ç¾¤å¥åº·æ£€æŸ¥çš„åŠŸèƒ½<!-- raw HTML omitted --></p>
<p><code>Keepalived</code>å¯ä»¥é€šè¿‡åœ¨è‡ªèº«çš„<code>keepalived.conf</code>æ–‡ä»¶é‡Œé…ç½®<code>LVS</code>çš„èŠ‚ç‚¹<code>IP</code>å’Œç›¸å…³å‚æ•°å®ç°å¯¹<code>LVS</code>çš„ç›´æ¥ç®¡ç†ï¼›å½“æ•…éšœçš„èŠ‚ç‚¹æœåŠ¡å™¨è¢«ä¿®å¤ä»¥åï¼Œ<code>Keepalived</code>æœåŠ¡åˆä¼šè‡ªåŠ¨åœ°æŠŠå®ƒä»¬åŠ å…¥åˆ°æ­£å¸¸è½¬å‘é˜Ÿåˆ—ä¸­ï¼Œå¯¹å®¢æˆ·æä¾›æœåŠ¡ã€‚</p>
</li>
<li>
<p><!-- raw HTML omitted -->ä½œä¸ºç³»ç»Ÿç½‘ç»œæœåŠ¡çš„é«˜å¯ç”¨<!-- raw HTML omitted --></p>
<p><code>Keepalived</code>å¯ä»¥å®ç°ä»»æ„ä¸¤å°ä¸»æœºä¹‹é—´ï¼Œä¾‹å¦‚<code>Master</code>å’Œ<code>Backup</code>ä¸»æœºä¹‹é—´çš„æ•…éšœè½¬ç§»å’Œè‡ªåŠ¨åˆ‡æ¢ï¼Œè¿™ä¸ªä¸»æœºå¯ä»¥æ˜¯æ™®é€šçš„ä¸èƒ½åœæœºçš„ä¸šåŠ¡æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯<code>LVS</code>è´Ÿè½½å‡è¡¡ã€<code>Nginx</code>åå‘ä»£ç†è¿™æ ·çš„æœåŠ¡å™¨ã€‚</p>
</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="vipæ¼‚ç§»å®æˆ˜"><code>VIP</code>æ¼‚ç§»å®æˆ˜</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æœåŠ¡å™¨è§„åˆ’<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">æœåŠ¡å™¨</th>
<th style="text-align:left"><code>ip</code></th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>keepalived-01</code></td>
<td style="text-align:left">10.0.0.7</td>
<td style="text-align:left"><code>keepalived</code>ä¸»æœåŠ¡å™¨</td>
</tr>
<tr>
<td style="text-align:left"><code>keepalived-02</code></td>
<td style="text-align:left">10.0.0.8</td>
<td style="text-align:left"><code>keepalived</code>å¤‡æœåŠ¡å™¨</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">10.0.0.3</td>
<td style="text-align:left">VIP</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…ã€é…ç½®<!-- raw HTML omitted --><code>Keepalived</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸¤å°<!-- raw HTML omitted -->æœåŠ¡å™¨éƒ½å®‰è£…<code>Keepalived</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install keepalived -y</span></span></code></pre></div></blockquote>
<ul>
<li>ä¿®æ”¹<!-- raw HTML omitted -->ä¸»<!-- raw HTML omitted -->æœåŠ¡å™¨<code>Keepalived</code>é…ç½®æ–‡ä»¶</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">! Configuration File for keepalived
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global_defs {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# è®¾ç½®çš„é‚®ä»¶æŠ¥è­¦ï¼Œè¿™éƒ¨åˆ†ä¸€èˆ¬ç”±nagiosã€zabbixç›‘æ§è½¯ä»¶æ¥è´Ÿè´£ï¼Œè¿™é‡Œçš„å†…å®¹å¾ˆé¸¡è‚‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	notification_email {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		31333741@qq.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	notification_email_from  31333741@qq.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	smtp_server 192.168.200.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	smtp_connect_timeout 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	router_id LVS_lb01  	# ä¸»èŠ‚ç‚¹id ä¸èƒ½å’Œå¤‡èŠ‚ç‚¹é‡å
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_skip_check_adv_addr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# ä½¿ç”¨ unicast_src_ip éœ€è¦æ³¨é‡Š vrrp_strictï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ ping è¿›è¡Œæµ‹è¯•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# vrrp_strict
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_garp_interval 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_gna_interval 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	script_user root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	enable_script_security
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å®šä¹‰vrrpæ£€æµ‹è„šæœ¬ï¼Œæª¢æŸ¥nginxç‹€æ³
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vrrp_script chk_nginx {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰§è¡Œè„šæœ¬ï¼Œå½“nginxæœåŠ¡æœ‰é—®é¢˜çš„æ™‚å€™å°±åœæ‰keepalivedæœåŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">script &#34;/opt/script/chk_nginx.sh&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é—´éš”1ç§’
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">interval 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">weight 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># VRRPå®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vrrp_instance VI_1 {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æŒ‡å®škeepalivedçš„è§’è‰²ï¼ŒMASTERè¡¨ç¤ºæ­¤ä¸»æ©Ÿæ˜¯ä¸»æœå‹™å™¨ï¼ŒBACKUPè¡¨ç¤ºä¸»æ©Ÿç‚ºå‚™ç”¨æœå‹™å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">state MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®çš„é€šä¿¡ç½‘å¡åç§° å¤‡èŠ‚ç‚¹è®¾ç½®ä¸€æ ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">interface eth0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è™šæ‹Ÿè·¯ç”±æ ‡å¿—ï¼Œæ”¯æŒä¸€ä¸ªæ•°å­—ï¼ŒåŒä¸€ä¸ªvrrpå®ä¾‹ä½¿ç”¨å”¯ä¸€çš„æ ‡å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åŒä¸€å€‹vrrp_instanceåº•ä¸‹ï¼ŒMASTERè·ŸBACKUPå¿…é¡»ä¸€è‡´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">virtual_router_id 51
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å®šä¹‰ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜(0-255)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">priority 150
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾å®šMASTERè·ŸBACKUPä¹‹é—´åŒæ­¥æ£€æŸ¥çš„æ—¶é—´é—´éš”ï¼Œå•ä½æ˜¯ç§’ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">advert_int 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¦‚æœèŠ‚ç‚¹ä¹‹é—´ç¦ç”¨äº†ç¾¤å‘çš„è©±ï¼Œåˆ™é‡‡ç”¨vrrpå•å‘é€šå‘Šçš„æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">unicast_src_ip 10.0.0.11
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">unicast_peer {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  10.0.0.12
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®éªŒè¯ç±»å‹ä¸å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">authentication {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # è®¾ç½®éªŒè¯ç±»å‹ï¼Œä¸»è¦æœ‰PASSè·ŸHAä¸¤ç§
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  auth_type PASS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # è®¾ç½®éªŒè¯å¯†ç ï¼Œåœ¨åŒä¸€å€‹vrrp_instanceåº•ä¸‹ï¼ŒMASTERè·ŸBACKUPå¿…é¡»ä½¿ç”¨ç›¸åŒå¾—å¯†ç æ‰èƒ½æ­£å¸¸æ²Ÿé€š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  auth_pass 1111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šå€‹è™šæ‹ŸIPåœ°å€ï¼Œæ¯è¡Œè®¾å®šä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">virtual_ipaddress {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # è™šæ‹ŸVIPçš„åœ°å€ ä¸ç½‘å¡æ ‡ç­¾
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  10.0.0.3/24 dev eth0 label eth0:1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">track_script {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # è§¦å‘æ£€æŸ¥
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  chk_nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>ä¿®æ”¹<!-- raw HTML omitted -->å¤‡ç”¨<!-- raw HTML omitted -->æœåŠ¡å™¨<code>Keepalived</code>é…ç½®æ–‡ä»¶</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">! Configuration File for keepalived
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global_defs {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®çš„é‚®ä»¶æŠ¥è­¦ï¼Œè¿™éƒ¨åˆ†ä¸€èˆ¬ç”±nagiosã€zabbixç›‘æ§è½¯ä»¶æ¥è´Ÿè´£ï¼Œè¿™é‡Œçš„å†…å®¹å¾ˆé¸¡è‚‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  31333741@qq.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email_from  31333741@qq.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_server 192.168.200.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_connect_timeout 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¤‡èŠ‚ç‚¹id ä¸èƒ½å’Œå¤‡èŠ‚ç‚¹é‡å
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">router_id LVS_lb02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># VRRPå®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vrrp_instance VI_1 {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®ä¸»æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">state MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®é€šä¿¡ç½‘å¡  å¤‡èŠ‚ç‚¹è®¾ç½®ä¸€æ ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">interface eth0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åŒç»„è·¯ç”±å™¨å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">virtual_router_id 51
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¼˜å…ˆçº§ è¿™é‡Œå¿…é¡»æ¯”å¤‡èŠ‚ç‚¹é«˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">priority 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¯éš”ä¸€ç§’å‘ä¸€æ¬¡å¿ƒè·³
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">advert_int 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æˆæƒå¯†ç   
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">authentication {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  auth_type PASS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  auth_pass 1111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">virtual_ipaddress {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # è™šæ‹ŸVIPçš„åœ°å€ ä¸ç½‘å¡æ ‡ç­¾
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  10.0.0.3/24 dev eth0 label eth0:1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨ä¸»èŠ‚ç‚¹<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡å¹¶æ£€æŸ¥<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /etc/init.d/keepalived start
</span></span><span style="display:flex;"><span>æ­£åœ¨å¯åŠ¨ keepalivedï¼š            <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@kepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ps -ef|grep keep|grep -v grep</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">7428</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 10:54 ?        00:00:00 /usr/sbin/keepalived -D
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">7430</span>   <span style="color:#ae81ff">7428</span>  <span style="color:#ae81ff">0</span> 10:54 ?        00:00:00 /usr/sbin/keepalived -D
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">7431</span>   <span style="color:#ae81ff">7428</span>  <span style="color:#ae81ff">0</span> 10:54 ?        00:00:00 /usr/sbin/keepalived -D</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ£€æŸ¥é…ç½®åçš„è™šæ‹Ÿ<!-- raw HTML omitted --><code>IP</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å‡ºç°å¸¦æœ‰<!-- raw HTML omitted --><code>vipï¼š10.0.0.3</code><!-- raw HTML omitted -->è¡Œçš„ç»“æœè¡¨ç¤º<!-- raw HTML omitted --><code>kepalived-01</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡å•å®ä¾‹é…ç½®æˆåŠŸ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ip add|grep 10.0.0.3
</span></span><span style="display:flex;"><span>    inet 10.0.0.3/24 scope global secondary eth0:1</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨å¤‡èŠ‚ç‚¹<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å¤‡ç”¨æœåŠ¡å™¨æ˜¯å¦æœ‰<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->æ²¡æœ‰è¿”å›ä»»ä½•ç»“æœå°±å¯¹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived start</span>
</span></span><span style="display:flex;"><span>æ­£åœ¨å¯åŠ¨ keepalivedï¼š  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># </span></span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å•å®ä¾‹ä¸»å¤‡æ¨¡å¼<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶å¯¹æ¯”<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ä¸»å¤‡å•å®ä¾‹<code>keepalived.conf</code>é…ç½®å·®åˆ«é¡¹</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left"><code>Keepalived</code>é…ç½®å‚æ•°</th>
<th style="text-align:left"><code>Master</code>èŠ‚ç‚¹ç‰¹æ®Šå‚æ•°</th>
<th style="text-align:left"><code>Backup</code>èŠ‚ç‚¹ç‰¹æ®Šå‚æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>Router_id</code> (å”¯ä¸€æ ‡è¯†)</td>
<td style="text-align:left"><code>router_id lb01</code></td>
<td style="text-align:left"><code>router_id lb02</code></td>
</tr>
<tr>
<td style="text-align:left"><code>State</code>ï¼ˆè§’è‰²çŠ¶æ€ï¼‰</td>
<td style="text-align:left"><code>Stat master</code></td>
<td style="text-align:left"><code>Stat backup</code></td>
</tr>
<tr>
<td style="text-align:left"><code>Priority</code> ï¼ˆç«é€‰ä¼˜å…ˆçº§ï¼‰</td>
<td style="text-align:left"><code>Priority 150</code></td>
<td style="text-align:left"><code>Priority 100</code></td>
</tr>
</tbody>
</table>
</blockquote>
</blockquote>
<hr>
<h3 id="keepalivedä¸»å¤‡åˆ‡æ¢"><code>Keepalived</code>ä¸»å¤‡åˆ‡æ¢</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœæ‰ä¸»æœåŠ¡ä¸Šçš„<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡æˆ–å…³é—­ä¸»æœåŠ¡å™¨ï¼Œæ“ä½œåŠæ£€æŸ¥æ­¥éª¤<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3</span>
</span></span><span style="display:flex;"><span>inet 10.0.0.3/24 scope global secondary eth0:1
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived stop</span>
</span></span><span style="display:flex;"><span>åœæ­¢ keepalivedï¼š                                          <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3  	# æŸ¥çœ‹vipæ¶ˆå¤±</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯ä»¥çœ‹åˆ°ä¸»æœåŠ¡å™¨<!-- raw HTML omitted --><code>vip10.00.3</code><!-- raw HTML omitted -->æ¶ˆå¤±äº†ï¼Œæ­¤æ—¶æŸ¥çœ‹<!-- raw HTML omitted --><code>backup</code><!-- raw HTML omitted -->å¤‡ä»½æœåŠ¡å™¨ï¼Œçœ‹æ˜¯å¦ä¼šæœ‰<!-- raw HTML omitted --><code>vip10.0.0.3</code><!-- raw HTML omitted -->å‡ºç°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å¯ä»¥çœ‹åˆ°å¤‡èŠ‚ç‚¹<code>keepalived-02</code>å·²ç»æ¥ç®¡ç»‘å®šäº†<code>10.0.0.3</code>è¿™ä¸ª<code>vip</code>ï¼Œè¿™æœŸé—´å¤‡èŠ‚ç‚¹è¿˜ä¼šå‘é€<code>ARP</code>å¹¿æ’­ï¼Œè®©æ‰€æœ‰çš„å®¢æˆ·ç«¯æ›´æ–°æœ¬åœ°çš„<code>ARP</code>è¡¨ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯è®¿é—®æ–°æ¥ç®¡<code>vip</code>æœåŠ¡èŠ‚ç‚¹ã€‚</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3        </span>
</span></span><span style="display:flex;"><span>    inet 10.0.0.3/24 scope global secondary eth0:1</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ­¤æ—¶å¦‚æœåœ¨å¯åŠ¨ä¸»æœåŠ¡å™¨çš„<!-- raw HTML omitted --><code>keepalived</code>æœåŠ¡ï¼Œä¸»æœåŠ¡å™¨å°±ä¼šæ¥ç®¡å›<code>vip 10.0.0.3</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3       </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived start</span>
</span></span><span style="display:flex;"><span>æ­£åœ¨å¯åŠ¨ keepalivedï¼š                                      <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3        </span>
</span></span><span style="display:flex;"><span>inet 10.0.0.3/24 scope global secondary eth0:1</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ­¤æ—¶å¤‡èŠ‚ç‚¹ä¸Šçš„<!-- raw HTML omitted --><code>vip 10.0.0.3</code><!-- raw HTML omitted -->åˆ™è¢«é‡Šæ”¾äº†ï¼Œå¦‚ä¸‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3    </span></span></span></code></pre></div></blockquote>
<ul>
<li>è¿™æ ·å°±å®ç°äº†å•å®ä¾‹<code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->è‡ªåŠ¨æ¼‚ç§»æ¥ç®¡äº†ï¼Œ<!-- raw HTML omitted --><code>vip</code>æ¼‚ç§»åˆ°äº†æ–°æœºå™¨æ–°æœåŠ¡ä¸Šï¼Œç”¨æˆ·çš„è®¿é—®è¯·æ±‚è‡ªç„¶å°±ä¼šæ‰¾åˆ°æ–°æœºå™¨æ–°æœåŠ¡äº†</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ³¨æ„ï¼šè¿™é‡Œä»…å®ç°äº†<!-- raw HTML omitted --><code>VIP</code>è‡ªåŠ¨æ¼‚ç§»åˆ‡æ¢ï¼Œå› æ­¤ä»…é€‚åˆä¸¤å°æœåŠ¡å™¨æä¾›çš„æœåŠ¡å‡ä¿æŒå¼€å¯çš„åº”ç”¨åœºæ™¯ï¼Œè¿™ä¹Ÿæ˜¯å·¥ä½œä¸­å¸¸ç”¨çš„é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="keepalivedåŒä¸»æ¨¡å¼"><code>keepalived</code>åŒä¸»æ¨¡å¼</h3>
<blockquote>
<ul>
<li><code>keepalived</code><!-- raw HTML omitted -->åŒå®ä¾‹åŒä¸»æ¨¡å¼é…ç½®å®æˆ˜<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Keepalived</code>è¿˜æ”¯æŒå¤šå®ä¾‹å¤šä¸šåŠ¡åŒå‘ä¸»å¤‡æ¨¡å¼ï¼Œå³<code>A</code>ä¸šåŠ¡åœ¨<code>keepalived-01</code>ä¸Šä¸»æ¨¡å¼æ˜¯ä¸»æ¨¡å¼ï¼Œåœ¨<code>keepalived-02</code>ä¸Šæ˜¯å¤‡æ¨¡å¼ï¼Œè€Œ<code>B</code>ä¸šåŠ¡åœ¨<code>keepalived-02</code>ä¸Šæ˜¯å¤‡æ¨¡å¼ï¼Œåœ¨<code>keepalived-02</code>ä¸Šæ˜¯ä¸»æ¨¡å¼.</li>
</ul>
</blockquote>
<ul>
<li><code>Keepalived</code><!-- raw HTML omitted -->åŒå®ä¾‹åŒä¸»æ¨¡å¼çš„<!-- raw HTML omitted --><code>ip</code><!-- raw HTML omitted -->åŠ<!-- raw HTML omitted --><code>VIP</code><!-- raw HTML omitted -->è§„åˆ’<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th style="text-align:left"><code>Hostname</code></th>
<th style="text-align:left"><code>IP</code></th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>keepalived-01</code></td>
<td style="text-align:left">10.0.0.5</td>
<td style="text-align:left"><code>VIPï¼š10.0.0.3</code>ï¼ˆç”¨äºç»‘å®š<code>A</code>æœåŠ¡www.etiantian.orgï¼‰</td>
</tr>
<tr>
<td style="text-align:left"><code>keepalived-02</code></td>
<td style="text-align:left">10.0.0.4</td>
<td style="text-align:left"><code>VIPï¼š10.0.0.4</code>ï¼ˆç”¨äºç»‘å®š<code>B</code>æœåŠ¡<code>blog.etiantian.org</code>ï¼‰</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->é¦–å…ˆé…ç½®<!-- raw HTML omitted --><code>keepalived-01</code> <code>10.0.0.5</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>keepalived.conf</code><!-- raw HTML omitted -->ï¼Œåœ¨å•å®ä¾‹çš„åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ª<!-- raw HTML omitted --><code>VIP_instance VI_2</code><!-- raw HTML omitted -->æ­¥éª¤åŠå†…å®¹å¦‚ä¸‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span>! Configuration File <span style="color:#66d9ef">for</span> keepalived
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>global_defs <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	notification_email <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		31333741@qq.com
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	notification_email_from  31333741@qq.com
</span></span><span style="display:flex;"><span>	smtp_server 127.0.0.1
</span></span><span style="display:flex;"><span>	smtp_connect_timeout <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>	router_id lb01
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># vrrp_script chk_nginx {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    script &#34;/root/chk_nginx.sh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    interval 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    weight 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># }</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_1 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state MASTER
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">51</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">150</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1111</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  10.0.0.3/24 dev eth0 label eth0:1  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_2 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state BACKUP
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1112</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  10.0.0.4/24 dev eth0 label eth0:2
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æç¤ºï¼šä»¥<!-- raw HTML omitted --><code>vrrp_instance VI_1</code><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>keepalived-01 10.0.0.5</code><!-- raw HTML omitted -->æœåŠ¡å™¨ä¸Šçš„è§’è‰²ä¸ºä¸»ï¼Œ<!-- raw HTML omitted --><code>vrrp_instance VI_2</code><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>keepalived-01 10.0.0.5</code><!-- raw HTML omitted -->æœåŠ¡å™¨ä¸Šçš„è§’è‰²ä¸ºå¤‡ ç„¶åå¸ƒç½®<!-- raw HTML omitted --><code>keepalived-02 10.0.0.6</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>keepalived.conf</code><!-- raw HTML omitted -->ï¼Œåœ¨å•å®ä¾‹çš„åŸºç¡€ä¸Šå¢åŠ <!-- raw HTML omitted --><code>vrrp_instance VI_2</code><!-- raw HTML omitted -->å®ä¾‹ï¼Œæ­¥éª¤å¦‚ä¸‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span>! Configuration File <span style="color:#66d9ef">for</span> keepalived
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>global_defs <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> notification_email <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     31333741@qq.com
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> notification_email_from  31333741@qq.com
</span></span><span style="display:flex;"><span> smtp_server 127.0.0.1
</span></span><span style="display:flex;"><span> smtp_connect_timeout <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span> router_id lb02
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_1 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state BACKUP
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">51</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1111</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>10.0.0.3/24 dev eth0 label eth0:1  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_2 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state MASTER
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">150</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1112</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>10.0.0.4/24 dev eth0 label eth0:2
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æç¤ºï¼šä»¥<!-- raw HTML omitted --><code>vrrp_instance VI_1</code>åœ¨<code>keepalived-02 10.0.0.6</code><!-- raw HTML omitted -->æœåŠ¡å™¨ä¸Šçš„è§’è‰²ä¸ºå¤‡ï¼Œ<!-- raw HTML omitted --><code>vrrp_instance VI_2</code>åœ¨<code>keepalived-02 10.0.0.6</code><!-- raw HTML omitted -->æœåŠ¡å™¨ä¸Šçš„è§’è‰²ä¸ºä¸» æ¥ç€åœ¨<!-- raw HTML omitted --><code>keepalived-01</code>ã€<code>keepalived-02</code><!-- raw HTML omitted -->ä¸Šåˆ†åˆ«é‡å¯<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œè§‚å¯Ÿåˆå§‹<!-- raw HTML omitted --><code>VIP</code><!-- raw HTML omitted -->è®¾ç½®æƒ…å†µ<!-- raw HTML omitted --><code> Lb01</code><!-- raw HTML omitted -->æ“ä½œæƒ…å†µå¦‚ä¸‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived restart</span>
</span></span><span style="display:flex;"><span>åœæ­¢ keepalivedï¼š                                        <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>æ­£åœ¨å¯åŠ¨ keepalivedï¼š                                    <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep -E &#34;10.0.0.3|0.4&#34;</span>
</span></span><span style="display:flex;"><span>inet 10.0.0.3/24 scope global secondary eth0:1
</span></span><span style="display:flex;"><span>inet 10.0.0.4/24 scope global secondary eth0:2</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æç¤ºï¼šå¯åŠ¨<!-- raw HTML omitted --><code>keepalived-02</code><!-- raw HTML omitted -->åï¼Œåˆå§‹çŠ¶æ€å·²ç»å¯åŠ¨äº†<!-- raw HTML omitted --><code>10.0.0.4VIP</code>ï¼Œå³<code>keepalived-02</code>ç”±<code>VI_2</code><!-- raw HTML omitted -->å®ä¾‹é…ç½®çš„<!-- raw HTML omitted --><code>VIP</code><!-- raw HTML omitted -->å¯¹å¤–æä¾›æœåŠ¡ï¼Œåˆ—å…¥å¯ä»¥æŠŠ<!-- raw HTML omitted --><code>blog.etiantian.org</code><!-- raw HTML omitted -->è§£æåˆ°<!-- raw HTML omitted --><code>10.0.0.4</code><!-- raw HTML omitted -->ä¸Š ä¸‹é¢åœæ‰ä»»æ„ä¸€ç«¯æœåŠ¡å™¨æˆ–è€…<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œç„¶åæŸ¥çœ‹<!-- raw HTML omitted --><code>vip</code><!-- raw HTML omitted -->æ˜¯ä¸æ˜¯ä¼šæ¼‚ç§»åˆ°å¦ä¸€ç«¯ã€‚åœæ‰<!-- raw HTML omitted --><code>keepalived-01</code>çš„<code>keepalived</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived stop</span>
</span></span><span style="display:flex;"><span>åœæ­¢ keepalivedï¼š                                        <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep -E &#34;10.0.0.3|0.4&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># # æ­¤å¤„æ— ä»»ä½•ä¿¡æ¯</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åœæ‰<!-- raw HTML omitted --><code>keepalived-01</code><!-- raw HTML omitted -->åï¼Œ<!-- raw HTML omitted --><code>vip 10.0.0.3</code><!-- raw HTML omitted -->å³è¢«é‡Šæ”¾,æ£€æŸ¥<!-- raw HTML omitted --><code>keepalived-02</code>æœåŠ¡å™¨ä¸Š<code>vip</code><!-- raw HTML omitted -->çš„æ¥ç®¡æƒ…å†µ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>keepalived-02</code>å·²å°†æ¥ç®¡äº†<code>keepalived-01</code>çš„<code>vip 10.0.0.3</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep -E &#34;10.0.0.3|0.4&#34;</span>
</span></span><span style="display:flex;"><span>    inet 10.0.0.4/24 scope global secondary eth0:2
</span></span><span style="display:flex;"><span>    inet 10.0.0.3/24 scope global secondary eth0:1</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="é—®é¢˜æ’æŸ¥">é—®é¢˜æ’æŸ¥</h3>
<h4 id="è£‚è„‘é—®é¢˜">è£‚è„‘é—®é¢˜</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä»€ä¹ˆæ˜¯è£‚è„‘<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ç”±äºæŸäº›åŸå› ï¼Œå¯¼è‡´ä¸¤å°é«˜å¯ç”¨æœåŠ¡å™¨å¯¹åœ¨æŒ‡å®šæ—¶é—´å†…æ— æ³•æ£€æµ‹åˆ°å¯¹æ–¹çš„å¿ƒè·³æ¶ˆæ¯ã€‚å„è‡ªå–å¾—èµ„æºåŠæœåŠ¡çš„æ‰€æœ‰æƒï¼Œè€Œæ­¤æ—¶çš„ä¸¤å°é«˜å¯ç”¨æœåŠ¡å™¨å¯¹éƒ½è¿˜æ´»ç€å¹¶åœ¨æ­£å¸¸è¿è¡Œç€ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´åŒä¸€ä¸ª<code>ip</code>æˆ–æœåŠ¡åœ¨ä¸¤ç«¯åŒæ—¶å­˜åœ¨è€Œå‘ç”Ÿå†²çªï¼Œæœ€ä¸¥é‡çš„æ˜¯ä¸¤å°ä¸»æœºå ç”¨ä¸€ä¸ªVIPåœ°å€ï¼Œå½“ç”¨æˆ·å†™å…¥æ•°æ®æ—¶å¯èƒ½ä¼šåˆ†åˆ«å†™å…¥åˆ°ä¸¤ç«¯ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨ä¸¤ç«¯æ•°æ®ä¸ä¸€è‡´æˆ–é€ æˆæ•°æ®ä¸¢å¤±ï¼Œè¿™ç§æƒ…å†µç§°ä¸ºè„‘è£‚</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯¼è‡´è„‘è£‚å‘ç”Ÿçš„åŸå› <!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ä¸€èˆ¬æ¥è¯´è„‘è£‚çš„å‘ç”Ÿï¼Œæœ‰ä»¥ä¸‹å‡ ç§åŸå› ï¼š é«˜å¯ç”¨æœåŠ¡å™¨ä¹‹é—´å¿ƒè·³çº¿è·¯å‘ç”Ÿæ•…éšœï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸é€šä¿¡</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¿ƒè·³çº¿åäº†(åŒ…æ‹¬æ–­äº†ï¼Œè€åŒ–)<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ç½‘å¡åŠç›¸å…³é©±åŠ¨åäº†ï¼Œ<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->é…ç½®åŠå†²çª<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¿ƒè·³çº¿è¿æ¥çš„è®¾å¤‡æ•…éšœï¼ˆç½‘å¡åŠäº¤æ¢æœºï¼‰<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä»²è£çš„æœºå™¨å‡ºé—®é¢˜<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>é«˜å¯ç”¨æœåŠ¡å™¨ä¸Šå¼€å¯äº†<code>iptableable</code>é˜²ç«å¢™é˜»æŒ¡äº†å¿ƒè·³æ¶ˆæ¯ä¼ è¾“</li>
<li>é«˜å¯ç”¨æœåŠ¡å™¨ä¸Šå¿ƒè·³ç½‘å¡åœ°å€ç­‰ä¿¡æ¯é…ç½®ä¸æ­£ç¡®ï¼Œå¯¼è‡´å‘é€å¿ƒè·³å¤±è´¥</li>
<li>å…¶ä»–æœåŠ¡å™¨é…ç½®ä¸å½“ç­‰åŸå› ï¼Œå¿ƒè·³å¹¿æ’­å†²çªã€‚è½¯ä»¶<code>BUG</code>ç­‰</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æç¤ºï¼š<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->é…ç½®é‡ŒåŒä¸€<!-- raw HTML omitted --><code>VRRP</code><!-- raw HTML omitted -->å®ä¾‹å¦‚æœ<!-- raw HTML omitted --><code>virtual_router_id</code><!-- raw HTML omitted -->ä¸¤ç«¯å‚æ•°é…ç½®ä¸ä¸€è‡´ï¼Œä¹Ÿä¼šå¯¼è‡´è„‘è£‚é—®é¢˜å‘ç”Ÿ<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h5 id="è„‘è£‚æ’æŸ¥">è„‘è£‚æ’æŸ¥</h5>
<blockquote>
<ul>
<li>å‡ºç°ä¸Šè¿°æ— ä»»ä½•ç»“æœçš„ç°è±¡ï¼Œè¡¨ç¤º<code>keepalived-02</code>çš„<code>keepalived</code>æœåŠ¡å•å®ä¾‹é…ç½®æˆåŠŸã€‚å¦‚æœ<code>keepalived-02</code>é…ç½®è¿‡æ»¤åå‡ºç°<code>10.0.0.3</code>çš„<code>ip</code>ã€‚åˆ™è¡¨ç¤º<code>keepalived</code>å·¥ä½œä¸æ­£å¸¸ï¼ŒåŒä¸€ä¸ª<code>IP</code>åœ°å€åŒä¸€æ—¶åˆ»åº”è¯¥åªèƒ½å‡ºç°ä¸€å°æœåŠ¡å™¨ã€‚</li>
<li>å¦‚æœæŸ¥çœ‹<code>backup</code>å¤‡èŠ‚ç‚¹<code>vip</code>æœ‰å¦‚ä¸‹ä¿¡æ¯ï¼Œè¯´æ˜<!-- raw HTML omitted -->é«˜å¯ç”¨<!-- raw HTML omitted -->è„‘è£‚äº†ï¼Œè£‚è„‘æ˜¯ä¸¤å°æœåŠ¡å™¨äº‰æŠ¢åŒä¸€èµ„æºå¯¼è‡´çš„ï¼Œä¾‹å¦‚:ä¸¤è¾¹éƒ½é…ç½®äº†åŒä¸€ä¸ª<code>ip</code>ï¼Œä¸€èˆ¬è¦å…ˆè€ƒè™‘æ’æŸ¥ä¸¤ä¸ªåœ°æ–¹</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸»å¤‡ä¸¤å°æœåŠ¡å™¨ä¹‹é—´æ˜¯å¦é€šä¿¡æ­£å¸¸ï¼Œå¦‚æœä¸æ­£å¸¸æ˜¯å¦æœ‰<!-- raw HTML omitted --><code>iptables</code><!-- raw HTML omitted -->é˜²ç«å¢™é˜»æŒ¡<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä¸»å¤‡ä¸¤å°æœåŠ¡å™¨å¯¹åº”çš„<!-- raw HTML omitted --><code>keepalived.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é”™è¯¯ï¼Ÿä¾‹å¦‚ï¼šæ˜¯å¦åŒä¸€å®ä¾‹çš„<!-- raw HTML omitted --><code>virtual_router_id</code><!-- raw HTML omitted -->é…ç½®ä¸ä¸€è‡´<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3</span>
</span></span><span style="display:flex;"><span>  inet 10.0.0.3/24 scope global secondary eth0:1</span></span></code></pre></div></blockquote>
</blockquote>
</blockquote>
<hr>
<h5 id="è„‘è£‚è§£å†³å¸¸è§æ–¹æ¡ˆ">è„‘è£‚è§£å†³å¸¸è§æ–¹æ¡ˆ</h5>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åŒæ—¶ä½¿ç”¨ä¸²è¡Œç”µç¼†å’Œä»¥å¤ªç½‘ç”µç¼†è¿æ¥ï¼ŒåŒæ—¶ç”¨ä¸¤æ¡å¿ƒè·³çº¿è·¯ï¼Œè¿™æ ·ä¸€æ¡çº¿è·¯åäº†ï¼Œå¦ä¸€æ¡çº¿è·¯è¿˜æ˜¯å¥½çš„ï¼Œä¾ç„¶èƒ½å¤Ÿä¼ é€å¿ƒè·³ä¿¡æ¯<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å½“æ£€æµ‹åˆ°è„‘è£‚æ—¶å¼ºè¡Œå…³é—­ä¸€ä¸ªå¿ƒè·³èŠ‚ç‚¹ï¼ˆè¿™ä¸ªåŠŸèƒ½éœ€è¦ç‰¹æ®Šè®¾å¤‡æ”¯æŒï¼Œå¦‚<!-- raw HTML omitted --><code>Stonithã€fenceï¼‰</code><!-- raw HTML omitted -->ã€‚ç›¸å½“äºèŠ‚ç‚¹ä¿¡æ¯æ¥æ”¶ä¸åˆ°å¿ƒè·³ä¿¡æ¯ï¼Œé€šè¿‡å•ç‹¬çš„çº¿è·¯å‘é€æœºå…³å‘½ä»¤å…³é—­ä¸»èŠ‚ç‚¹ç”µæº<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->åšå¥½è£‚è„‘çš„ç›‘æ§è­¦æŠ¥<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h5 id="ç¼–å†™ç›‘æ§keepalivedè„‘è£‚è„šæœ¬">ç¼–å†™ç›‘æ§<code>Keepalived</code>è„‘è£‚è„šæœ¬</h5>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ£€æµ‹æ€è·¯ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>åœ¨å¤‡èŠ‚ç‚¹ä¸Šæ‰§è¡Œè„šæœ¬ï¼Œå¦‚æœå¯ä»¥<code>ping</code>é€šä¸»èŠ‚ç‚¹å¹¶ä¸”å¤‡èŠ‚ç‚¹æœ‰<code>VIP</code>å°±æŠ¥è­¦</li>
<li>è®©äººå‘˜ä»‹å…¥æ£€æŸ¥æ˜¯å¦è£‚è„‘ã€‚</li>
<li>åœ¨<code>keepalived-02</code>å¤‡èŠ‚ç‚¹å¼€å‘è„šæœ¬å¹¶æ‰§è¡Œ</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;check_split_brain.sh&lt;&lt;-EOF </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/sh</span>
</span></span><span style="display:flex;"><span>keepalived-01_vip<span style="color:#f92672">=</span>10.0.0.12
</span></span><span style="display:flex;"><span>keepalived-01_ip<span style="color:#f92672">=</span>10.0.0.7
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> true
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span> ping -c <span style="color:#ae81ff">2</span> -W <span style="color:#ae81ff">3</span> <span style="color:#e6db74">${</span><span style="color:#e6db74">&#34;keepalived-01_ip&#34;</span><span style="color:#e6db74">}</span> &amp;&gt;/dev/null 
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $ -eq <span style="color:#ae81ff">0</span> -a <span style="color:#e6db74">`</span>ip add|grep <span style="color:#e6db74">${</span><span style="color:#e6db74">&#34;keepalived-01_vip&#34;</span><span style="color:#e6db74">}</span>|wc -l<span style="color:#e6db74">`</span> -eq <span style="color:#ae81ff">1</span> <span style="color:#f92672">]</span>  
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">then</span>    
</span></span><span style="display:flex;"><span>     echo <span style="color:#e6db74">&#34;ha is split brain.warning.&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">else</span>    
</span></span><span style="display:flex;"><span>     echo <span style="color:#e6db74">&#34;ha is ok&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span> sleep <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>EOF
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sh check_split_brain.sh  </span>
</span></span><span style="display:flex;"><span>ha is okha is ok</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ­£å¸¸æƒ…å†µä¸‹ä¸»èŠ‚ç‚¹æ´»ç€ï¼Œ<!-- raw HTML omitted --><code>VIP 10.0.0.12</code><!-- raw HTML omitted -->åœ¨ä¸»èŠ‚ç‚¹ï¼Œå› æ­¤ä¸ä¼šæŠ¥è­¦æç¤º<!-- raw HTML omitted --><code>ha is ok</code>ã€‚ <code>keepalived-01</code> åœæ­¢<code>Keepalived</code><!-- raw HTML omitted -->æœåŠ¡çœ‹<!-- raw HTML omitted --><code>keepalived-02</code><!-- raw HTML omitted -->è„šæœ¬æ‰§è¡Œæƒ…å†µ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived stop</span>
</span></span><span style="display:flex;"><span>åœæ­¢ keepalivedï¼š                                          <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.12 </span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>keepalived-02</code><!-- raw HTML omitted -->ä¸Šè§‚å¯Ÿå³å¯ï¼Œæ­¤å‰è„šæœ¬å·²ç»æ‰§è¡Œ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sh check_split_brain.sh</span>
</span></span><span style="display:flex;"><span>ha is okha is ok
</span></span><span style="display:flex;"><span>ha is split brain.warning.
</span></span><span style="display:flex;"><span>ha is split brain.warning.
</span></span><span style="display:flex;"><span>ha is split brain.warning.</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å…³æ‰<!-- raw HTML omitted --><code>keepalived-01</code><!-- raw HTML omitted -->æœåŠ¡å™¨ï¼Œç„¶åå†è§‚å¯Ÿ<!-- raw HTML omitted --><code>keepalived-02</code><!-- raw HTML omitted -->è„šæœ¬çš„è¾“å‡º<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sh check_split_brain.sh </span>
</span></span><span style="display:flex;"><span>ha is okha is ok
</span></span><span style="display:flex;"><span>ha is split brain.warning.
</span></span><span style="display:flex;"><span>ha is split brain.warning.
</span></span><span style="display:flex;"><span>ha is split brain.warning.
</span></span><span style="display:flex;"><span>ha is ok
</span></span><span style="display:flex;"><span>ha is ok
</span></span><span style="display:flex;"><span>ha is ok</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="nginxé…ç½®è´Ÿè½½"><code>nginx</code>é…ç½®è´Ÿè½½</h4>
<blockquote>
<ul>
<li>ç»“åˆ<code>nginx</code>è´Ÿè½½å‡è¡¡çš„ç¯å¢ƒï¼Œä¸¤è¾¹<code>keepalived-01</code>å’Œ<code>keepalived-02</code>çš„é…ç½®ç¯å¢ƒä¸€æ · <strong>è¿™é‡Œä½¿ç”¨<code>nginx</code>è´Ÿè½½å‡è¡¡çš„é…ç½®å¦‚ä¸‹ï¼š</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/usr/local/nginx/conf/nginx.conf&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span>worker_processes  1;
</span></span><span style="display:flex;"><span>events <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>worker_connections  1024;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>http <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>include       mime.types;
</span></span><span style="display:flex;"><span>default_type  application/octet-stream;
</span></span><span style="display:flex;"><span>sendfile        on;
</span></span><span style="display:flex;"><span>keepalive_timeout  65;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>upstream server_pools <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   server 10.0.0.7:80  weight<span style="color:#f92672">=</span>1;
</span></span><span style="display:flex;"><span>   server 10.0.0.8:80  weight<span style="color:#f92672">=</span>1;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  listen       10.0.0.3:80;
</span></span><span style="display:flex;"><span>  server_name  www.etiantian.org;
</span></span><span style="display:flex;"><span>  location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      proxy_pass http://server_pools;
</span></span><span style="display:flex;"><span>  include proxy.conf;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  listen       10.0.0.3:80;
</span></span><span style="display:flex;"><span>  server_name  bbs.etiantian.org;
</span></span><span style="display:flex;"><span>  location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      proxy_pass http://server_pools;
</span></span><span style="display:flex;"><span>   include proxy.conf;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  listen       10.0.0.4:80;
</span></span><span style="display:flex;"><span>  server_name  blog.etiantian.org;
</span></span><span style="display:flex;"><span>  location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      proxy_pass http://server_pools;
</span></span><span style="display:flex;"><span>     include proxy.conf;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
<ul>
<li><code>keepalived-01</code><!-- raw HTML omitted -->ä¸Šé…ç½®<!-- raw HTML omitted --><code>keepalived.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span>! Configuration File <span style="color:#66d9ef">for</span> keepalived
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>global_defs <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>notification_email <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>31333741@qq.com
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>notification_email_from  31333741@qq.com
</span></span><span style="display:flex;"><span>smtp_server 127.0.0.1
</span></span><span style="display:flex;"><span>smtp_connect_timeout <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>router_id lb01
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_1 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state MASTER
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">51</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">150</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1111</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>10.0.0.3/24 dev eth0 label eth0:1  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_2 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state BACKUP
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1112</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>10.0.0.4/24 dev eth0 label eth0:2
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
<ul>
<li><code>keepalived-02</code><!-- raw HTML omitted -->ä¸Šé…ç½®<!-- raw HTML omitted --><code>keepalived.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span>! Configuration File <span style="color:#66d9ef">for</span> keepalived
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>global_defs <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>notification_email <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>31333741@qq.com
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>notification_email_from  31333741@qq.com
</span></span><span style="display:flex;"><span>smtp_server 127.0.0.1
</span></span><span style="display:flex;"><span>smtp_connect_timeout <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>router_id lb02
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_1 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state BACKUP
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">51</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1111</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>10.0.0.3/24 dev eth0 label eth0:1  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_2 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state MASTER
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">150</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1112</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>10.0.0.4/24 dev eth0 label eth0:2
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="è§£å†³ç›‘å¬çš„æœåŠ¡ç½‘å¡ä¸Šä¸å­˜åœ¨ipåœ°å€é—®é¢˜">è§£å†³ç›‘å¬çš„æœåŠ¡ç½‘å¡ä¸Šä¸å­˜åœ¨<code>IP</code>åœ°å€é—®é¢˜</h4>
<blockquote>
<ul>
<li>å¦‚æœé…ç½®ä½¿ç”¨<code>listen 10.0.0.3:80</code> çš„æ–¹å¼æŒ‡å®š<code>IP</code>ç›‘å¬æœåŠ¡ï¼Œè€Œæœ¬åœ°çš„ç½‘å¡ä¸Šæ²¡æœ‰<code>10.0.0.3</code>è¿™ä¸ª<code>IPï¼Œnginx</code>å°±ä¼šæŠ¥é”™ï¼Œå¦‚ï¼šå‡ºç°ä¸Šè¿°çš„åŸå› æ˜¯åœ¨ç‰©ç†ç½‘å¡ä¸Šæ²¡æœ‰é…ç½®ä¸æ–‡ä»¶é‡Œç›‘å¬çš„<code>IP</code>ç›¸å¯¹åº”çš„<code>IP</code>ï¼Œè§£å†³åŠæ³•æ˜¯åœ¨<code>/etc/sysctl.conf</code>ä¸­åŠ å…¥å¦‚ä¸‹å‚æ•°ï¼š</li>
<li>æ­¤é¡¹è¡¨ç¤ºå¯åŠ¨<code>nginx</code>è€Œå¿½è§†é…ç½®ä¸­ç›‘å¬çš„VIPæ˜¯å¦å­˜åœ¨ï¼Œå®ƒåŒæ ·é€‚åˆ<code>Haproxy</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># echo &#34;net.ipv4.ip_nonlocal_bind = 1&#34; &gt;&gt;/etc/sysctl.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sysctl -p</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="è§£å†³é«˜å¯ç”¨æœåŠ¡åªé’ˆå¯¹ç‰©ç†æœåŠ¡å™¨çš„é—®é¢˜">è§£å†³é«˜å¯ç”¨æœåŠ¡åªé’ˆå¯¹ç‰©ç†æœåŠ¡å™¨çš„é—®é¢˜</h4>
<blockquote>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹<code>keepalived</code>è½¯ä»¶ä»…ä»…åœ¨å¯¹æ–¹æœºå™¨å®•æœºæˆ–<code>keepalived</code>åœæ‰çš„æ—¶å€™æ‰ä¼šæ¥ç®¡ä¸šåŠ¡ï¼Œä½†åœ¨å®é™…è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸šåŠ¡æœåŠ¡åœæ­¢è€Œ<code>keepalived</code>æœåŠ¡è¿˜åœ¨å·¥ä½œçš„æƒ…å†µï¼Œè¿™å°±ä¼šå¯¼è‡´ç”¨æˆ·è®¿é—®<code>VIP</code>æ— æ³•æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡</li>
<li><!-- raw HTML omitted -->æ–¹æ³•ä¸€ï¼š<!-- raw HTML omitted -->å¯ä»¥å†™å®ˆæŠ¤è¿›ç¨‹è„šæœ¬æ¥å¤„ç†ã€‚å½“<code>nginx</code>ä¸šåŠ¡æœ‰é—®é¢˜æ—¶ï¼Œå°±åœæ‰æœ¬åœ°çš„<code>keepalived</code>æœåŠ¡ï¼Œå®ç°<code>IP</code>æ¼‚ç§»åˆ°å¯¹ç«¯ç»§ç»­æä¾›æœåŠ¡ã€‚å®é™…å·¥ä½œä¸­éƒ¨ç½²åŠå¼€å‘çš„ç¤ºä¾‹è„šæœ¬</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ­¤è„šæœ¬çš„æ€è·¯æ˜¯å¦‚æ²¡æœ‰<!-- raw HTML omitted --><code>80</code><!-- raw HTML omitted -->ç«¯å£å­˜åœ¨ï¼Œå°±åœæ‰<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡å®ç°é‡Šæ”¾æœ¬åœ°çš„<!-- raw HTML omitted --><code>VIP</code><!-- raw HTML omitted -->åœ¨åå°æ‰§è¡Œä¸Šè¿°è„šæœ¬<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/server/scripts/check_nginx.sh&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/sh</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> true
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">`</span>netstat -lntup|grep nginx|wc -l<span style="color:#e6db74">`</span> -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    /etc/init.d/keepalived stop
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>  sleep <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>EOF
</span></span><span style="display:flex;"><span>$ sh server/scripts/check_nginx.sh &amp;
</span></span><span style="display:flex;"><span>$ ps -ef|grep check|grep -v grep
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">8580</span>   <span style="color:#ae81ff">8394</span>  <span style="color:#ae81ff">0</span> 16:19 pts/0    00:00:00 sh check_nginx.s</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¡®å®š<!-- raw HTML omitted --><code>nginx</code><!-- raw HTML omitted -->ä»¥åŠ<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡æ˜¯å¦æ­£å¸¸<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># netstat -lntup|grep nginx</span>
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 10.0.0.4:80                 0.0.0.0:*                   LISTEN      8541/nginx          
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 10.0.0.3:80                 0.0.0.0:*                   LISTEN      8541/nginx          
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived status</span>
</span></span><span style="display:flex;"><span>keepalived <span style="color:#f92672">(</span>pid  8438<span style="color:#f92672">)</span> æ­£åœ¨è¿è¡Œ...</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç„¶åæ¨¡æ‹Ÿ<!-- raw HTML omitted --><code>nginx</code><!-- raw HTML omitted -->æœåŠ¡æŒ‚æ‰ï¼Œçœ‹<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->æ˜¯å¦ä¼šå‘ç”Ÿåˆ‡æ¢<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /usr/local/nginx/sbin/nginx -s stop</span>
</span></span><span style="display:flex;"><span> åœæ­¢ keepalivedï¼š       <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived status</span>
</span></span><span style="display:flex;"><span>keepalived       å·²åœ
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># netstat -lntup|grep nginx            </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ­¤æ—¶å¤‡èŠ‚ç‚¹æ¥ç®¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep -E &#34;10.0.0.3|0.4&#34;</span>
</span></span><span style="display:flex;"><span>    inet 10.0.0.3/24 scope global secondary eth0:1
</span></span><span style="display:flex;"><span>    inet 10.0.0.4/24 scope global secondary eth0:2</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ–¹æ³•äºŒï¼š<!-- raw HTML omitted -->å¯ä»¥ä½¿ç”¨<code>keepalived</code>çš„é…ç½®è„šæœ¬å‚æ•°è§¦å‘å†™å¥½çš„ç›‘æµ‹æœåŠ¡è„šæœ¬ é¦–å…ˆè¦å¼€å‘ç›‘æµ‹æœåŠ¡è„šæœ¬ï¼Œæ³¨æ„:è¿™ä¸ªè„šæœ¬ä¸ä¸Šä¸€ä¸ªçš„ä¸åŒ</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/server/scripts/chk_nginx_proxy.sh&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/sh</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">`</span>netstat -lntup|grep nginx|wc -l<span style="color:#e6db74">`</span> -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>/etc/init.d/keepalived stop
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>EOF
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># chmod +x /server/scripts/chk_nginx_proxy.sh </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll /server/scripts/chk_nginx_proxy.sh </span>
</span></span><span style="display:flex;"><span>-rwxr-xr-x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">99</span> 6æœˆ  <span style="color:#ae81ff">10</span> 16:30 chk_nginx_proxy.sh
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ­¤æ—¶<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡çš„å®Œæ•´é…ç½®ä¸º<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span>! Configuration File <span style="color:#66d9ef">for</span> keepalived
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>global_defs <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   notification_email <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   31333741@qq.com
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   notification_email_from  31333741@qq.com
</span></span><span style="display:flex;"><span>   smtp_server 127.0.0.1
</span></span><span style="display:flex;"><span>   smtp_connect_timeout <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>   router_id lb01
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>vrrp_script chk_nginx_proxy <span style="color:#f92672">{</span>  	<span style="color:#75715e"># å®šä¹‰vrrpè„šæœ¬ï¼Œæ£€æµ‹HTTPç«¯å£ã€‚</span>
</span></span><span style="display:flex;"><span>script <span style="color:#e6db74">&#34;/server/scripts/chk_nginx_proxy.sh&#34;</span>  	<span style="color:#75715e"># æ‰§è¡Œè„šæœ¬ï¼Œå½“nginxæœåŠ¡æœ‰é—®é¢˜ï¼Œå°±åœæ‰keepalivedæœåŠ¡ã€‚</span>
</span></span><span style="display:flex;"><span>interval <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># é—´éš”2ç§’</span>
</span></span><span style="display:flex;"><span>weight <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_1 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    state MASTER
</span></span><span style="display:flex;"><span>    interface eth0
</span></span><span style="display:flex;"><span>    virtual_router_id <span style="color:#ae81ff">51</span>
</span></span><span style="display:flex;"><span>    priority <span style="color:#ae81ff">150</span>
</span></span><span style="display:flex;"><span>    advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        auth_type PASS
</span></span><span style="display:flex;"><span>        auth_pass <span style="color:#ae81ff">1111</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     10.0.0.3/24 dev eth0 label eth0:1  
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     track_script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    chk_nginx_proxy        <span style="color:#75715e">#è§¦å‘æ£€æŸ¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_2 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    state BACKUP
</span></span><span style="display:flex;"><span>    interface eth0
</span></span><span style="display:flex;"><span>    virtual_router_id <span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>    priority <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>    advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        auth_type PASS
</span></span><span style="display:flex;"><span>        auth_pass <span style="color:#ae81ff">1112</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     10.0.0.4/24 dev eth0 label eth0:2
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ³¨æ„ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vrrp_script chk_nginx_proxy <span style="color:#f92672">{</span>  <span style="color:#75715e"># &lt;==å®šä¹‰vrrpè„šæœ¬ï¼Œæ£€æµ‹HTTPç«¯å£ã€‚</span>
</span></span><span style="display:flex;"><span>script <span style="color:#e6db74">&#34;/server/scripts/chk_nginx_proxy.sh&#34;</span>  <span style="color:#75715e"># &lt;==æ‰§è¡Œè„šæœ¬ï¼Œå½“nginxæœåŠ¡æœ‰é—®é¢˜ï¼Œå°±åœæ‰keepalivedæœåŠ¡ã€‚</span>
</span></span><span style="display:flex;"><span>interval <span style="color:#ae81ff">2</span> <span style="color:#75715e"># &lt;==é—´éš”2ç§’</span>
</span></span><span style="display:flex;"><span>weight <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="è§£å†³å¤šç»„keepalivedæœåŠ¡å™¨åœ¨ä¸€ä¸ªå±€åŸŸç½‘çš„å†²çªé—®é¢˜">è§£å†³å¤šç»„<code>keepalived</code>æœåŠ¡å™¨åœ¨ä¸€ä¸ªå±€åŸŸç½‘çš„å†²çªé—®é¢˜</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯ä»¥åœ¨åŒç»„çš„<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡å™¨æ‰€æœ‰é…ç½®æ–‡ä»¶é‡ŒæŒ‡å®šç‹¬ä¸€æ— äºŒçš„å¤šæ’­åœ°å€<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä¸åŒå®ä¾‹çš„è®¤è¯å¯†ç æœ€å¥½ä¸åŒ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>global_defs <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>router_id LVS_19
</span></span><span style="display:flex;"><span>vrrp_mcast_group4 224.0.0.19 <span style="color:#75715e"># &lt;==è¿™ä¸ªå°±æ˜¯æŒ‡å®šå¤šæ’­åœ°å€çš„é…ç½®</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="é…ç½®æŒ‡å®šæ–‡ä»¶æ¥æ”¶keepalivedæœåŠ¡æ—¥è®°">é…ç½®æŒ‡å®šæ–‡ä»¶æ¥æ”¶<code>keepalived</code>æœåŠ¡æ—¥è®°</h3>
<blockquote>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹<code>keepalived</code>æœåŠ¡æ—¥è®°ä¼šè¾“å‡ºåˆ°ç³»ç»Ÿæ—¥è®°<code>/var/log/messages</code>å’Œå…¶ä»–æ—¥è®°ä¿¡æ¯ä¼šæ··åˆåœ¨ä¸€èµ·ï¼Œå¾ˆä¸æ–¹ä¾¿ï¼Œå¯ä»¥å°†å…¶è°ƒæ•´ä¸ºç”±ç‹¬ç«‹çš„æ–‡ä»¶è®°å½•<code>keepalived</code>æœåŠ¡æ—¥è®°;æ“ä½œæ­¥éª¤å¦‚ä¸‹</li>
<li>ç¼–è¾‘é…ç½®æ–‡ä»¶<code>/etc/sysconfig/keepalived</code>ï¼Œå°†ç¬¬14è¡Œçš„<code>KEEPALIVED_OPTIONS=&quot;-D&quot;</code>ä¿®æ”¹ä¸º<code>KEEPALIVED_OPTIONS=&quot;-D -d -S 0&quot;</code>å¿«é€Ÿä¿®æ”¹æ–¹æ³•ï¼š</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#39;14 s#KEEPALIVED_OPTIONS=&#34;-D&#34;#KEEPALIVED_OPTIONS=&#34;-D -d -S 0&#34;#g&#39; /etc/sysconfig/keepalived </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -n &#39;14p&#39;  /etc/sysconfig/keepalived</span>
</span></span><span style="display:flex;"><span>KEEPALIVED_OPTIONS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-D -d -S 0&#34;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è¯´æ˜ï¼šå¯ä»¥æŸ¥çœ‹<!-- raw HTML omitted --><code>/etc/sysconfig/keepalived</code><!-- raw HTML omitted -->é‡Œæ³¨é‡Šè·å¾—ä¸Šè¿°å‚æ•°çš„è¯´æ˜<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># --dump-conf       -d     å¯¼å‡ºå¤‡ä»½é…ç½®æ•°æ®</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --log-detail      -D     è¯¦ç»†æ—¥å¿—</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --log-facility    -S     è®¾ç½®æœ¬åœ°çš„syslogè®¾å¤‡ï¼Œç¼–å·0-7ï¼ˆdefault=LOG_DAEMONï¼‰</span>
</span></span><span style="display:flex;"><span>* -S <span style="color:#ae81ff">0</span> è¡¨ç¤ºæŒ‡å®šä¸ºlocal0è®¾å¤‡</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>rsyslog</code><!-- raw HTML omitted -->çš„é…ç½®æ–‡ä»¶<!-- raw HTML omitted --><code>vim /etc/rsyslog.conf</code><!-- raw HTML omitted -->ï¼Œåœ¨ç»“å°¾å¤„åŠ å…¥å¦‚ä¸‹2è¡Œå†…å®¹ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>é…ç½®è¡¨ç¤ºæ¥è‡ª<code>local0è®¾</code>å¤‡çš„æ‰€æœ‰æ—¥å¿—ä¿¡æ¯éƒ½è®°å½•åˆ°<code>/var/log/keepalived.log</code>æ–‡ä»¶ã€‚ ç„¶ååœ¨çº¦ç¬¬42è¡Œå¦‚ä¸‹ä¿¡æ¯çš„ç¬¬ä¸€åˆ—ç»“å°¾åŠ å…¥<code>â€œï¼›local0.noneâ€ï¼š</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># keepalived</span>
</span></span><span style="display:flex;"><span>local0.*  /var/log/keepalived.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®è¡¨ç¤ºæ¥è‡ªlocal0è®¾å¤‡çš„æ‰€æœ‰æ—¥å¿—ä¿¡æ¯ä¸å†è®°å½•äº/var/log/messagesé‡Œã€‚ 3 é…ç½®å®Œæˆåï¼Œé‡å¯rsyslogæœåŠ¡ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#39;42 s#*.info;mail.none;authpriv.none;cron.none#*.info;mail.none;authpriv.none;cron.none;local0.none#g&#39; /etc/rsyslog.conf </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -n &#39;42p&#39; /etc/rsyslog.conf </span>
</span></span><span style="display:flex;"><span>*.info;mail.none;authpriv.none;cron.none;local0.none                /var/log/messages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/rsyslog restart</span>
</span></span><span style="display:flex;"><span>å…³é—­ç³»ç»Ÿæ—¥å¿—è®°å½•å™¨ï¼š     <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>å¯åŠ¨ç³»ç»Ÿæ—¥å¿—è®°å½•å™¨ï¼š            <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æµ‹è¯•<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->æ—¥å¿—è®°å½•ç»“æœã€‚åœ¨é‡å¯<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->æœåŠ¡åï¼Œå°±ä¼šæŠŠæ—¥å¿—ä¿¡æ¯è¾“å‡ºåˆ°<!-- raw HTML omitted --><code>rsyslog</code><!-- raw HTML omitted -->å®šä¹‰çš„<!-- raw HTML omitted --><code>/var/log/ keepalived.log</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å¦‚æœè¦æ±‚æ›´é«˜ï¼Œè¿˜å¯ä»¥åœ¨<code>/var/log/messages</code>ä¸Šè®¾ç½®å¯¹<code>/var/log/keepalived.log</code>è¿›è¡Œè½®è¯¢ï¼Œä»¥é˜²å•ä¸ªæ—¥å¿—æ–‡ä»¶å˜å¾—å¤ªå¤§</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived<span style="color:#f92672">[</span>10852<span style="color:#f92672">]</span>: Stopping Keepalived v1.2.13 <span style="color:#f92672">(</span>03/19,2015<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived_vrrp<span style="color:#f92672">[</span>10855<span style="color:#f92672">]</span>: VRRP_Instance<span style="color:#f92672">(</span>VI_1<span style="color:#f92672">)</span> sending <span style="color:#ae81ff">0</span> priority
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived_vrrp<span style="color:#f92672">[</span>10855<span style="color:#f92672">]</span>: VRRP_Instance<span style="color:#f92672">(</span>VI_1<span style="color:#f92672">)</span> removing protocol VIPs.
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived_vrrp<span style="color:#f92672">[</span>10855<span style="color:#f92672">]</span>: VRRP_Instance<span style="color:#f92672">(</span>VI_2<span style="color:#f92672">)</span> sending <span style="color:#ae81ff">0</span> priority
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived_vrrp<span style="color:#f92672">[</span>10855<span style="color:#f92672">]</span>: VRRP_Instance<span style="color:#f92672">(</span>VI_2<span style="color:#f92672">)</span> removing protocol VIPs.
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived_healthcheckers<span style="color:#f92672">[</span>10854<span style="color:#f92672">]</span>: Netlink reflector reports IP 10.0.0.3 removed
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived_healthcheckers<span style="color:#f92672">[</span>10854<span style="color:#f92672">]</span>: Netlink reflector reports IP 10.0.0.4 removed
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived<span style="color:#f92672">[</span>10884<span style="color:#f92672">]</span>: Starting Keepalived v1.2.13 <span style="color:#f92672">(</span>03/19,2015<span style="color:#f92672">)</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="../../../js/clipboard.min.js?1719333224" defer></script>
    <script src="../../../js/perfect-scrollbar.min.js?1719333224" defer></script>
    <script src="../../../js/theme.js?1719333224" defer></script>
  </body>
</html>
