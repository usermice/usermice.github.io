<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <meta name="author" content="二哥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/s2-1.png">
    <meta name="twitter:title" content="Monitor :: Hugo Relearn Theme">
    <meta property="og:url" content="https://erge.blog/systems/linux/monitor/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Monitor :: Hugo Relearn Theme">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://erge.blog/images/s2-1.png">
    <meta itemprop="name" content="Monitor :: Hugo Relearn Theme">
    <meta itemprop="datePublished" content="2024-06-13T00:33:22+08:00">
    <meta itemprop="dateModified" content="2024-06-13T00:33:22+08:00">
    <meta itemprop="image" content="https://erge.blog/images/s2-1.png">
    <title>Monitor :: Hugo Relearn Theme</title>
    <link href="../../../images/favicon.ico?1719330258" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../css/fontawesome-all.min.css?1719330259" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fontawesome-all.min.css?1719330259" rel="stylesheet"></noscript>
    <link href="../../../css/nucleus.css?1719330259" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1719330259" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/auto-complete.css?1719330259" rel="stylesheet"></noscript>
    <link href="../../../css/perfect-scrollbar.min.css?1719330259" rel="stylesheet">
    <link href="../../../css/fonts.css?1719330259" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fonts.css?1719330259" rel="stylesheet"></noscript>
    <link href="../../../css/theme.css?1719330259" rel="stylesheet">
    <link href="../../../css/theme-relearn-auto.css?1719330259" rel="stylesheet" id="R-variant-style">
    <link href="../../../css/chroma-relearn-auto.css?1719330259" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../css/variant.css?1719330259" rel="stylesheet">
    <link href="../../../css/print.css?1719330259" rel="stylesheet" media="print">
    <link href="../../../css/format-print.css?1719330259" rel="stylesheet">
    <script src="../../../js/variant.js?1719330259"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../systems/linux/monitor/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Monitor</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/nosql/configure_redis/" title="Configure_Redis (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/monitor/install_zabbix/" title="Install_Zabbix (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="monitor">Monitor</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Monitor</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_zabbix">Install_Zabbix</h1>

<h2 id="部署zabbix监控系统">部署<code>Zabbix</code>监控系统</h2>
<h3 id="基础配置环境要求">基础配置环境要求</h3>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.zabbix.com/manuals" rel="external" target="_self"><code>Zabbix</code>部署文档</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.zabbix.com/cn/download" rel="external" target="_self">下载安装<code>Zabbix</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->部署<!-- raw HTML omitted --><code>Zabbix</code><!-- raw HTML omitted -->硬件要求<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>平台</th>
<th>CPU/内存</th>
<th>数据库</th>
<th>受监控的主机</th>
</tr>
</thead>
<tbody>
<tr>
<td>小型</td>
<td><code>CentOS</code></td>
<td>虚拟设备</td>
<td><code>MySQL InnoDB</code></td>
<td>100</td>
</tr>
<tr>
<td>中型</td>
<td><code>CentOS</code></td>
<td><code>2个CPU内核/2GB</code></td>
<td><code>MySQL InnoDB</code></td>
<td>500</td>
</tr>
<tr>
<td>大型</td>
<td><code>RedHat Enterprise Linux</code></td>
<td><code>4个CPU内核/8GB RAID10</code></td>
<td><code>MySQL InnoDB</code>或 <code>PostgreSQL</code></td>
<td>&gt;1000</td>
</tr>
<tr>
<td>超大型</td>
<td><code>RedHat Enterprise Linux</code></td>
<td><code>8个CPU内核/16GB RAID10</code></td>
<td><code>MySQL InnoDB</code>或 <code>PostgreSQL</code></td>
<td>&gt;10000</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->部署<!-- raw HTML omitted --><code>Zabbix</code><!-- raw HTML omitted -->数据库版本要求<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>数据库</th>
<th>支持版本</th>
<th>推荐版本</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MySQL/Percona</code></td>
<td><code>5.7.28-8.0.X</code></td>
<td><code>8.0.X</code></td>
<td>如果<code>MySQL</code>或<code>Percona</code>用作<code>Zabbix</code>后端数据库，则需要。需要<code>InnoDB</code>引擎。我们建议使用<code>MariaDB Connector/C</code>库来构建服务器/代理</td>
</tr>
<tr>
<td><code>MariaDB</code></td>
<td><code>10.0.37-10.6.X</code></td>
<td><code>10.5.X</code></td>
<td><code>InnoDB</code>引擎是必需的。我们建议使用<code>MariaDB Connector/C</code> 库来构建服务器/代理</td>
</tr>
<tr>
<td><code>PostgreSQL</code></td>
<td><code>10.9-13.X</code></td>
<td><code>12.X.X</code>或更新</td>
<td>使用<code>PostgreSQL</code>作为<code>Zabbix</code>后端数据库。<!-- raw HTML omitted -->建议使用<code>PostgreSQL 8.3</code>以上的版本, 以 <a href="http://www.postgresql.org/docs/8.3/static/release-8-3.html" rel="external" target="_self">提供更好的VACUUM性能</a>。</td>
</tr>
<tr>
<td><code>SQLite</code></td>
<td><code>3.3.5-3.34.X</code></td>
<td><code>3.3X.X</code></td>
<td>仅支持<code>Zabbix</code>代理。如果<code>SQLite</code>用作<code>Zabbix</code>代理数据库</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start mariadb
</span></span><span style="display:flex;"><span>$ mysql -uroot -e <span style="color:#e6db74">&#34;create database zabbix character set utf8mb4 collate utf8mb4_bin;&#34;</span> 
</span></span><span style="display:flex;"><span>$ mysql -uroot -e <span style="color:#e6db74">&#34;create user &#39;zabbix&#39;@&#39;localhost&#39; identified by &#39;zabbix&#39;;&#34;</span>   
</span></span><span style="display:flex;"><span>$ mysql -uroot -e <span style="color:#e6db74">&#34;grant all privileges on zabbix.* to &#39;zabbix&#39;@&#39;localhost&#39;;&#34;</span>
</span></span><span style="display:flex;"><span>$ mysql -uroot -e <span style="color:#e6db74">&#34;flush privileges;&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->安装<!-- raw HTML omitted --><code>Zabbix</code><!-- raw HTML omitted -->前准备<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->卸载原有数据库，安装高版本<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum remove -y mariadb*</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->创建用户<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ groupadd --system zabbix
</span></span><span style="display:flex;"><span>$ useradd --system -g zabbix -d /usr/lib/zabbix -s /sbin/nologin -c <span style="color:#e6db74">&#34;Zabbix Monitoring System&#34;</span> zabbix</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->创建所需目录<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir /opt/<span style="color:#f92672">{</span>src,zabbix<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$ chown zabbix:zabbix /opt/*</span></span></code></pre></div><ul>
<li>3.4 <!-- raw HTML omitted -->安装依赖<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install epel-release wget unixODBC-devel net-snmp-devel libevent-devel <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>libxml2-devel libcurl-devel java-1.6.0-openjdk-devel gcc gcc-c++ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>mariadb mariadb-server mariadb-devel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install go
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Debian 系统</span>
</span></span><span style="display:flex;"><span>$ sudo apt-get install libxml2 libxml2-dev libsnmp-dev libevent-dev openjdk-11-jdk <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>libcurl4-openssl-dev </span></span></code></pre></div></blockquote>
<hr>
<h3 id="安装zabbix-server">安装<code>Zabbix Server</code></h3>
<ul>
<li>
<ol>
<li><a href="https://cdn.zabbix.com/zabbix/sources/stable/" rel="external" target="_self">下载<code>Zabbix Server</code>编译安装包</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /opt/src/ https://cdn.zabbix.com/zabbix/sources/stable/6.0/zabbix-6.0.14.tar.gz</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->解压配置<!-- raw HTML omitted --><code>Zabbix Server</code><!-- raw HTML omitted -->安装包<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tar -zxvf /opt/src/zabbix-6.0.14.tar.gz -C /opt/src/
</span></span><span style="display:flex;"><span>$ cd /opt/src/zabbix-6.0.14/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 编译安装路径</span>
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/opt/zabbix --enable-server --enable-agent --enable-ipv6 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-net-snmp --with-libcurl --with-libxml2 --enable-java --with-openssl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-mysql<span style="color:#f92672">=</span>/usr/local/mysql/bin/mysql_config
</span></span><span style="display:flex;"><span>$ make -j2 <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->拷贝<!-- raw HTML omitted --><code>Zabbix Server</code><!-- raw HTML omitted -->启动文件给予执行权限<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp /opt/src/zabbix-6.0.14/misc/init.d/fedora/core/zabbix_* /etc/init.d/  
</span></span><span style="display:flex;"><span>$ chmod +x /etc/init.d/zabbix_*</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->启动数据库导入<!-- raw HTML omitted --><code>Zabbix SQL</code><!-- raw HTML omitted -->文件后再启动<!-- raw HTML omitted --><code>Zabbix Server</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ll /opt/src/zabbix-6.0.14/database/mysql/ | grep *.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mysql -uzabbix -p<span style="color:#e6db74">&#39;zabbix&#39;</span> zabbix &lt; /opt/src/zabbix-6.0.14/database/mysql/schema.sql
</span></span><span style="display:flex;"><span>$ mysql -uzabbix -p<span style="color:#e6db74">&#39;zabbix&#39;</span> zabbix &lt; /opt/src/zabbix-6.0.14/database/mysql/images.sql
</span></span><span style="display:flex;"><span>$ mysql -uzabbix -p<span style="color:#e6db74">&#39;zabbix&#39;</span> zabbix &lt; /opt/src/zabbix-6.0.14/database/mysql/data.sql
</span></span><span style="display:flex;"><span>$ mysql -uzabbix -p<span style="color:#e6db74">&#39;zabbix&#39;</span> zabbix &lt; /opt/src/zabbix-6.0.14/database/mysql/double.sql
</span></span><span style="display:flex;"><span>$ mysql -uzabbix -p<span style="color:#e6db74">&#39;zabbix&#39;</span> zabbix &lt; /opt/src/zabbix-6.0.14/database/mysql/history_pk_prepare.sql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->修改<!-- raw HTML omitted --><code>zabbix_server</code><!-- raw HTML omitted -->配置文件<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/zabbix/etc/zabbix_server.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DBHost=localhost  	# 数据库地址
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DBName=zabbix  	# 数据库名
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DBUser=root  	# 连接数据库的用户
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DBPassword=123456  	# 密码
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DBSocket=/home/ops/opt/mysql/mysql.sock  	# 数据库sock文件路径
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DBPort=3306  	# 端口
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LogFile=/opt/zabbix_server/logs/zabbix_server.log  	# 日志文件
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PidFile=/opt/zabbix_server/logs/zabbix_server.pid  	# 保存pid的文件
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SocketDir=/opt/zabbix/logs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->拷贝<!-- raw HTML omitted --><code>Zabbix</code><!-- raw HTML omitted -->前端文件，到<!-- raw HTML omitted --><code>Nginx</code>的<code>web</code><!-- raw HTML omitted -->目录<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cp -rf /opt/src/zabbix-6.0.14/ui/* /usr/local/nginx/html/zabbix/</span></span></code></pre></div></blockquote>
<hr>
<h3 id="docker安装zabbix-server"><code>Docker</code>安装<code>Zabbix Server</code></h3>
<blockquote>
<ul>
<li><a href="https://www.zabbix.com/documentation/6.0/en/manual/installation/containers" rel="external" target="_self">从<code>Docker</code>容器安装</a>、<a href="https://www.leeks.info/zh_CN/latest/index.html" rel="external" target="_self">欢迎使用<code>Leeks</code>的笔记</a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li>创建专用于<code>Zabbix</code>组件容器的网络</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker network create --subnet 172.20.0.0/16 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--ip-range 172.20.100.0/20 zabbix-net</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>启动空<code>MySQL</code>服务器实例数据库<code>8.0</code>以上</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -v /etc/localtime:/etc/localtime <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --name mysql-server -t <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e MYSQL_DATABASE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e MYSQL_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e MYSQL_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>zabbix_pwd<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>root_pwd<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --network<span style="color:#f92672">=</span>zabbix-net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --restart unless-stopped <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -d mysql:8.0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --character-set-server<span style="color:#f92672">=</span>utf8 --collation-server<span style="color:#f92672">=</span>utf8_bin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --default-authentication-plugin<span style="color:#f92672">=</span>mysql_native_password</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li>启动<code>Zabbix Java</code>网关实例</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -v /etc/localtime:/etc/localtime <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --name zabbix-java-gateway -t <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --network<span style="color:#f92672">=</span>zabbix-net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --restart unless-stopped <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -d zabbix/zabbix-java-gateway:alpine-6.0-latest</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li>启动<code>Zabbix</code>服务器实例并将该实例与创建的<code>MySQL</code>服务器实例链接</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>启动<code>Zabbix</code>服务器实例并将该实例与创建的<code>MySQL</code>服务器实例链接</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker volume create zabbix-server-volume
</span></span><span style="display:flex;"><span>$ docker run -v /etc/localtime:/etc/localtime <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --name zabbix-server-mysql -t <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --link zabbix-web-service:zabbix-web-service <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e DB_SERVER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mysql-server&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_DATABASE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>zabbix_pwd<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>root_pwd<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e ZBX_JAVAGATEWAY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix-java-gateway&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e ZBX_STARTREPORTWRITERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e ZBX_WEBSERVICEURL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://zabbix-web-service:10053/report&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -v zabbix-server-volume:/etc/zabbix <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -v <span style="color:#e6db74">${</span>server_dir<span style="color:#e6db74">}</span>/server/alertscripts:/usr/lib/zabbix/alertscripts <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -v <span style="color:#e6db74">${</span>server_dir<span style="color:#e6db74">}</span>/server/externalscripts:/usr/lib/zabbix/externalscripts <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -v <span style="color:#e6db74">${</span>server_dir<span style="color:#e6db74">}</span>/server/modules:/usr/lib/zabbix/modules <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --network<span style="color:#f92672">=</span>zabbix-net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -p 10051:10051 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --restart unless-stopped <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -d zabbix/zabbix-server-mysql:alpine-6.0-latest</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li>启动<code>Zabbix Web</code>界面并将实例与创建的<code>MySQL</code>服务器和<code>Zabbix</code>服务器实例链接</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Zabbix Web</code>界面实例向主机公开<code>80/TCP</code>端口 <code>HTTP</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -v /etc/localtime:/etc/localtime <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --name zabbix-web-nginx-mysql -t <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e ZBX_SERVER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix-server-mysql&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e DB_SERVER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mysql-server&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_DATABASE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>zabbix_pwd<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>root_pwd<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e ZBX_SERVER_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>zabbix_server_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --network<span style="color:#f92672">=</span>zabbix-net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -p 8080:8080 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --restart unless-stopped <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -d zabbix/zabbix-web-nginx-mysql:alpine-6.0-latest</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li>安装<code>Zabbix Proxy</code>服务</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run --name zabbix-proxy-mysql <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e DB_SERVER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mysql-server&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e MYSQL_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;user&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e MYSQL_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;some-password&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e ZBX_HOSTNAME<span style="color:#f92672">=</span>some-hostname <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e ZBX_SERVER_HOST<span style="color:#f92672">=</span>some-zabbix-server <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -d zabbix/zabbix-proxy-mysql:alpine-6.0-latest</span></span></code></pre></div></blockquote>
<hr>
<h3 id="配置nginx使浏览器访问zabbix">配置<code>Nginx</code>使浏览器访问<code>Zabbix</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;/usr/local/nginx/conf/vhosts/zabbix.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> listen 80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server_name zabbix.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     root   /usr/local/nginx/html/zabbix;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     index  index.php index.html index.htm;  	# 添加&#34;index.php&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # tcp socket 通信模式
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> location ~ \.php$ {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     root	/usr/local/nginx/html/zabbix;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_pass  127.0.0.1:9000;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_index index.php;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;  	# fastcgi_param行改成这个。
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     include  fastcgi_params;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # Unix socke 通信模式
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> location ~ \.php(.*)$ {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     root	/usr/local/nginx/html/zabbix;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_pass unix:/tmp/php7.sock;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_index index.php;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_split_path_info ^((?U).+\.php)(/?.+)$;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_param PATH_INFO $fastcgi_path_info;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     include  fastcgi_params;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> } 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> error_page 404 http://zabbix.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> access_log  /usr/local/nginx/logs/zabbix-access.log  main;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> error_log   /usr/local/nginx/logs/zabbix-error.log  info;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="启动zabbix服务端和客户端">启动<code>Zabbix</code>服务端和客户端</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Debian 系统需执行</span>
</span></span><span style="display:flex;"><span>$ sudo ln -s /usr/local/mysql/lib/libmysqlclient.so.20 /usr/lib/libmysqlclient.so.20
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /opt/zabbix/sbin/zabbix_server  	<span style="color:#75715e"># 启动 Zabbix Server</span>
</span></span><span style="display:flex;"><span>$ /opt/zabbix/sbin/zabbix_agentd  	<span style="color:#75715e"># 启动 Zabbix Agentd</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="处理访问页面后没有中文选项">处理访问页面后没有中文选项</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 列出说有支持的语言</span>
</span></span><span style="display:flex;"><span>$ locale -a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如果没有想要的语言环境，打开下方文件找到需要的语言取消注释</span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;/etc/locale.gen<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># zh_CN.UTF-8 UTF-8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 重载语言环境</span>
</span></span><span style="display:flex;"><span>$ sudo locale-gen
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 重启PHP使配置生效，然后刷新浏览器</span>
</span></span><span style="display:flex;"><span>$ sudo /etc/init.d/php-fpm restart</span></span></code></pre></div></blockquote>
<hr>
<h3 id="web页面配置zabbix"><code>web</code>页面配置<code>zabbix</code></h3>
<blockquote>
<p><a href="#R-image-1fa5fe27bf736253883d8583c9f51ec2" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-08-45.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1fa5fe27bf736253883d8583c9f51ec2"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-08-45.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->下方图片显示要修改的<!-- raw HTML omitted --><code>PHP</code><!-- raw HTML omitted -->配置文件,修改后重启<!-- raw HTML omitted --><code>php-fpm</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/post_max_size = 8M/post_max_size = 16M/g&#34;</span> /usr/local/php/etc/php.ini  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/max_execution_time = 30/max_execution_time = 300/g&#34;</span> /usr/local/php/etc/php.ini  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/max_input_time = 60/max_input_time = 300/g&#34;</span> /usr/local/php/etc/php.ini </span></span></code></pre></div><p><a href="#R-image-421e1a14ce741b48d426b7e634b05ce8" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-11-47.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-421e1a14ce741b48d426b7e634b05ce8"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-11-47.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->连接数据库报错<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ln -s /var/lib/mysql/mysql.sock /tmp/</span></span></code></pre></div><p><a href="#R-image-9a9e62f2bd789b4e5080fa44d8781ec7" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-13-46.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9a9e62f2bd789b4e5080fa44d8781ec7"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-13-46.png"></a></p>
<p><a href="#R-image-c78d8b1e43f9b09954b79e4433c84ede" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-15-02.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c78d8b1e43f9b09954b79e4433c84ede"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-15-02.png"></a></p>
<p><a href="#R-image-893ebe55aa901bd39811208004cf7d0b" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-15-52.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-893ebe55aa901bd39811208004cf7d0b"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-15-52.png"></a></p>
<p><a href="#R-image-bdbae6608fa8d743b9f6d9d6e673e592" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-16-37.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bdbae6608fa8d743b9f6d9d6e673e592"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-16-37.png"></a></p>
<p><a href="#R-image-a29607182efd2c4ff9daf2b4fa25eed1" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-17-40.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a29607182efd2c4ff9daf2b4fa25eed1"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-17-40.png"></a></p>
<p><a href="#R-image-d7621073de0bb32c3f0f8092348906de" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-18-45.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d7621073de0bb32c3f0f8092348906de"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-18-45.png"></a></p>
<ul>
<li><!-- raw HTML omitted --><strong>默认帐户：</strong><!-- raw HTML omitted --><code>Admin</code><!-- raw HTML omitted -->，<strong>默认密码：</strong><!-- raw HTML omitted --><code>zabbix</code></li>
</ul>
<p><a href="#R-image-f2398c2e921c9d3cb5da5a2270d655ee" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-20-31.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f2398c2e921c9d3cb5da5a2270d655ee"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-20-31.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->处理图形汉字乱码<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rz /usr/local/nginx/html/assets/fonts
</span></span><span style="display:flex;"><span>$ mv simhei.ttf DejaVuSans.ttf</span></span></code></pre></div></blockquote>
<hr>
<h2 id="编译安装zabbix-agent">编译安装<code>Zabbix Agent</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->部署前准备<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir /opt/<span style="color:#f92672">{</span>src,zabbix-agent<span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><a href="https://cdn.zabbix.com/zabbix/binaries/stable/" rel="external" target="_self">下载安装包</a><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install wget
</span></span><span style="display:flex;"><span>$ wget -P /opt/src/ 
</span></span><span style="display:flex;"><span>https://cdn.zabbix.com/zabbix/binaries/stable/6.0/6.0.14/zabbix_agent-6.0.14-linux-3.0-amd64-static.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar -zxvf /opt/src/zabbix_agent-6.0.14-linux-3.0-amd64-static.tar.gz -C /opt/zabbix-agent </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->修改<!-- raw HTML omitted --><code>Zabbix Agent</code><!-- raw HTML omitted -->配置文件<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/zabbix-agent/conf/zabbix_agentd.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Server=127.0.0.1  	# 添加Zabbix Server服务器IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ServerActive=127.0.0.1  	# 替换为Zabbix Server服务器IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Hostname=本机主机名  	# 被监控端自己的主机名
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">AllowKey=system.run[*]  	# 监控异常后，是否允许服务器远程过来执行命令，如重启某个服务
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">UnsafeUserParameters=1  	# 是否允许自定义key监控
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->启动<!-- raw HTML omitted --><code>Zabbix Agent</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/zabbix-agent/sbin/zabbix_agentd -c /opt/zabbix-agent/conf/zabbix_agentd.conf</span></span></code></pre></div></blockquote>
<hr>
<h2 id="配置zabbix通信加密">配置<code>Zabbix</code>通信加密</h2>
<ul>
<li>
<ol>
<li>申请证书</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 生成ca私钥</span>
</span></span><span style="display:flex;"><span>$ openssl genrsa <span style="color:#ae81ff">2048</span> &gt; ca.key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用ca私钥建立ca证书</span>
</span></span><span style="display:flex;"><span>$ openssl req -new -x509 -nodes -days <span style="color:#ae81ff">1000</span> -key ca.key -subj /CN<span style="color:#f92672">=</span>Signing<span style="color:#ae81ff">\ </span>CA/OU<span style="color:#f92672">=</span>Development<span style="color:#ae81ff">\ </span>group/O<span style="color:#f92672">=</span>Zabbix<span style="color:#ae81ff">\ </span>SIA/DC<span style="color:#f92672">=</span>zabbix/DC<span style="color:#f92672">=</span>com &gt; ca.crt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 生成服务器csr证书请求文件</span>
</span></span><span style="display:flex;"><span>$ openssl req -newkey rsa:2048 -days <span style="color:#ae81ff">1000</span> -nodes -keyout server.key -subj /CN<span style="color:#f92672">=</span>server/OU<span style="color:#f92672">=</span>Development<span style="color:#ae81ff">\ </span>group/O<span style="color:#f92672">=</span>Zabbix<span style="color:#ae81ff">\ </span>SIA/DC<span style="color:#f92672">=</span>zabbix/DC<span style="color:#f92672">=</span>com &gt; server.csr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用ca证书与私钥签发服务器证书</span>
</span></span><span style="display:flex;"><span>$ openssl x509 -req -in server.csr -days <span style="color:#ae81ff">1000</span> -CA ca.crt -CAkey ca.key -set_serial <span style="color:#ae81ff">01</span> &gt; server.crt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 生成客户端csr证书请求文件</span>
</span></span><span style="display:flex;"><span>$ openssl req -newkey rsa:2048 -days <span style="color:#ae81ff">1000</span> -nodes -keyout client.key -subj /CN<span style="color:#f92672">=</span>client/OU<span style="color:#f92672">=</span>Development<span style="color:#ae81ff">\ </span>group/O<span style="color:#f92672">=</span>Zabbix<span style="color:#ae81ff">\ </span>SIA/DC<span style="color:#f92672">=</span>zabbix/DC<span style="color:#f92672">=</span>com &gt; client.csr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用ca证书与私钥签发客户端证书</span>
</span></span><span style="display:flex;"><span>$ openssl x509 -req -in client.csr -days <span style="color:#ae81ff">1000</span> -CA ca.crt -CAkey ca.key -set_serial <span style="color:#ae81ff">01</span> &gt; client.crt</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>配置<code>Zabbix Server</code>服务端</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/zabbix/etc/zabbix_server.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 修改TLSCAFile配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSCAFile=/opt/zabbix_server/zabbix_crt/ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 修改TLSCertFile配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSCertFile=/opt/zabbix_server/zabbix_crt/server.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 修改TLSKeyFile配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSKeyFile=/opt/zabbix_server/zabbix_crt/server.key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li>配置<code>Zabbix Agent</code>端</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>配置<code>PSK</code>加密</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/zabbix-agent/conf/zabbix_agentd.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSPSKIdentity= PSK Name  	# 一致性共享密钥名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSPSKFile= PSK File  	# PSK 共享密钥文件存放路径
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>配置证书加密</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/zabbix-agent/conf/zabbix_agentd.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 修改agent连接模式
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSConnect=cert
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 修改传入数据连接模式
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSAccept=cert
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 修改TLSCAFile配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSCAFile=/opt/zabbix_agent/zabbix_crt/ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 修改TLSCertFile配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSCertFile=/opt/zabbix_agent/zabbix_crt/client.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 修改TLSKeyFile配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSKeyFile=/opt/zabbix_agent/zabbix_crt/client.key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_prometheus">Install_Prometheus</h1>

<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="prometheus"><code>Prometheus</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://prometheus.io/docs/introduction/first_steps/" rel="external" target="_self"><code>Prometheus</code>官网</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://yunlzheng.gitbook.io/prometheus-book" rel="external" target="_self"><code>prometheus-book</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/prometheus" rel="external" target="_self"><code>Github-Prometheus</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://blog.gmem.cc/prometheus-study-note" rel="external" target="_self"><code>Prometheus</code>学习笔记</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://blog.51cto.com/qiangsh/3093700" rel="external" target="_self"><code>Prometheus</code>介绍和使用</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://juejin.im/post/5d79d804e51d453b7779d5ce" rel="external" target="_self"><code>Prometheus</code>+<code>Grafana</code>详解</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/qianjingchen/articles/9578341.html" rel="external" target="_self"><code>Prometheus</code>自定义监控部署</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://prometheus.io/docs/instrumenting/clientlibs/" rel="external" target="_self"><code>Prometheus  CLIENT LIBRARIES</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://juejin.im/post/5d397c2fe51d45775e33f64a" rel="external" target="_self">使用<code>Prometheus</code>+<code>Grafana</code>快速打造高逼格监控平台</a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->概述<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><code>Prometheus</code>是一个开源监控系统，它前身是<a href="https://soundcloud.com" rel="external" target="_self"><code>SoundCloud</code></a>的告警工具包。从<code>2012</code>年开始，许多公司和组织开始使用<code>Prometheus</code>。该项目的开发人员和用户社区非常活跃，越来越多的开发人员和用户参与到该项目中。目前它是一个独立的开源项目，且不依赖于任何公司。为了强调这点和明确该项目治理结构，<code>Prometheus</code>在<code>2016</code>年继<a href="https://kubernetes.io" rel="external" target="_self"><code>Kurberntes</code></a>之后，加入了<a href="https://www.cncf.io" rel="external" target="_self"><code>Cloud Native Computing Foundation</code></a></p>
<ul>
<li>1.1 <code>prometheus</code><!-- raw HTML omitted -->特点<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->多维度数据模型，一个时间序列由一个度量指标和多个标签键值对确定<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->灵活的查询语言，对收集的时许数据进行重组<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->强大的数据可视化功能，除了内置的浏览器，也支持<!-- raw HTML omitted --><code>grafana</code><!-- raw HTML omitted -->集成<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->高效存储，内存加本地磁盘，可通过功能分片和联盟来拓展性能<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->运维简单，只依赖于本地磁盘，<!-- raw HTML omitted --><code>go</code><!-- raw HTML omitted -->二进制安装包没有任何其他依赖 <!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->精简告警<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->非常多的客户端库<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->提供了许多导出器来收集常用系统指标<!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->数据模型 <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><code>Prometheus</code>从根本上存储的所有数据都是时间序列数据（<code>Time Serie Data</code>，简称时序数据）。时序数据是具有时间戳的数据流，该数据流属于某个度量指标（<code>Metric</code>）和该度量指标下的多个标签（<code>Label</code>）。除了提供存储功能，<code>Prometheus</code>还可以利用查询表达式来执行非常灵活和复杂的查询。</p>
<ul>
<li>
<p><!-- raw HTML omitted -->度量指标和标签<!-- raw HTML omitted --></p>
<p>每个时间序列（<code>Time Serie</code>，简称时序）由度量指标和一组标签键值对唯一确定。</p>
</li>
<li>
<p>度量指标名称描述了被监控系统的某个测量特征（比如<code>http_requests_total</code>表示<code>http</code>请求总数）。度量指标名称由<code>ASCII</code>字母、数字、下划线和冒号组成，须匹配正则表达式<code>[a-zA-Z_:][a-zA-Z0-9_:]*</code>。</p>
</li>
<li>
<p>标签开启了<code>Prometheus</code>的多维数据模型。对于同一个度量指标，不同标签值组合会形成特定维度的时序。<code>Prometheus</code>的查询语言可以通过度量指标和标签对时序数据进行过滤和聚合。改变任何度量指标上的任何标签值，都会形成新的时序。标签名称可以包含<code>ASCII</code>字母、数字和下划线，须匹配正则表达式<code>[a-zA-Z_][a-zA-Z0-9_]*</code>，带有 _ 下划线的标签名称保留为内部使用。标签值可以包含任意<code>Unicode</code>字符，包括中文。</p>
</li>
<li>
<p><!-- raw HTML omitted -->采样值(<code>Sample</code>)<!-- raw HTML omitted --></p>
</li>
</ul>
<blockquote>
<p>时序数据其实就是一系列采样值。每个采样值包括：</p>
<ul>
<li><!-- raw HTML omitted -->一个<code>64</code>位的浮点数值  <!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->一个精确到毫秒的时间戳  <!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->注解(<code>Notation</code>)<!-- raw HTML omitted --></li>
</ul>
<p>一个注解由一个度量指标和一组标签键值对构成。形式如下：</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>metric name<span style="color:#f92672">]{[</span>label name<span style="color:#f92672">]=[</span>label value<span style="color:#f92672">]</span>, ...<span style="color:#f92672">}</span>  </span></span></code></pre></div><p>例如，度量指标为<code>api_http_requests_total</code>，标签为<code>method=&quot;POST&quot;</code>、<code>handler=&quot;/messages&quot;</code>的注解表示如下：</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>api_http_requests_total<span style="color:#f92672">{</span>method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span>, handler<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/messages&#34;</span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->度量指标类型 <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->计数器(<code>Counter</code>)<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>计数器是一种累计型的度量指标，它是一个只能递增的数值。计数器主要用于统计类似于服务请求数、任务完成数和错误出现次数这样的数据</code></pre></div><ul>
<li><!-- raw HTML omitted -->计量器(<code>Gauge</code>)<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>计量器表示一个既可以增加, 又可以减少的度量指标值。计量器主要用于测量类似于温度、内存使用量这样的瞬时数据</code></pre></div><ul>
<li><!-- raw HTML omitted -->直方图(<code>Histogram</code>)<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>直方图对观察结果（通常是请求持续时间或者响应大小这样的数据）进行采样，并在可配置的桶中对其进行统计。有以下几种方式来产生直方图（假设度量指标为 ）：  </code></pre></div><ul>
<li><!-- raw HTML omitted -->按桶计数<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>相当于&lt;basename&gt;_bucket{le=&#34;&lt;upper inclusive bound&gt;&#34;}</code></pre></div><ul>
<li><!-- raw HTML omitted -->采样值总和<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>相当于 &lt;basename&gt;_sum  </code></pre></div><ul>
<li><!-- raw HTML omitted -->采样值总数<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>相当于 &lt;basename&gt;_count ，也等同于把所有采样值放到一个桶里来计数 &lt;basename&gt;_bucket{le=&#34;+Inf&#34;}</code></pre></div><ul>
<li><!-- raw HTML omitted -->汇总(<code>Summary</code>)<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>类似于直方图，汇总也对观察结果进行采样。除了可以统计采样值总和和总数，它还能够按分位数统计。有以下几种方式来产生汇总（假设度量指标为 ）：</code></pre></div><ul>
<li><!-- raw HTML omitted -->采样值总和<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>相当于 &lt;basename&gt;_sum</code></pre></div><ul>
<li><!-- raw HTML omitted -->采样值总数<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>相当于 &lt;basename&gt;_count  </code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->任务(<code>Job</code>)和实例(<code>Instance</code>)<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p>在<code>Prometheus</code>里，可以从中抓取采样值的端点称为实例，为了性能扩展而复制出来的多个这样的实例形成了一个任务</p>
<ul>
<li><!-- raw HTML omitted -->例如下面的<!-- raw HTML omitted --><code>api-server</code><!-- raw HTML omitted -->任务有四个相同的实例<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>job: api-server
instance 1: 1.2.3.4:5670
instance 2: 1.2.3.4:5671
instance 3: 5.6.7.8:5670
instance 4: 5.6.7.8:5671</code></pre></div><p>​	<code>Prometheus</code>抓取完采样值后，会自动给采样值添加下面的标签和值：</p>
<ul>
<li>
<p><code>job:</code><!-- raw HTML omitted --> 抓取所属任务<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>instance</code><!-- raw HTML omitted -->： 抓取来源实例<!-- raw HTML omitted --></p>
<p>另外每次抓取时，<code>Prometheus</code>还会自动在以下时序里插入采样值：</p>
</li>
<li>
<p><code>up{job=&quot;[job-name]&quot;, instance=&quot;instance-id&quot;}</code><!-- raw HTML omitted -->：采样值为 1 表示实例健康，否则为不健康<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>scrape_duration_seconds{job=&quot;[job-name]&quot;, instance=&quot;[instance-id]&quot;}</code><!-- raw HTML omitted -->：采样值为本次抓取消耗时间<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>scrape_samples_post_metric_relabeling{job=&quot;&lt;job-name&gt;&quot;, instance=&quot;&lt;instance-id&gt;&quot;}</code><!-- raw HTML omitted -->：采样值为重新打标签后的采样值个数  <!-- raw HTML omitted --></p>
</li>
<li>
<p><code>scrape_samples_scraped{job=&quot;&lt;job-name&gt;&quot;, instance=&quot;&lt;instance-id&gt;&quot;}</code><!-- raw HTML omitted -->：采样值为本次抓取到的采样值个数  <!-- raw HTML omitted --></p>
</li>
</ul>
</blockquote>
<hr>
<h3 id="prometheus与其他监控系统对比"><code>Prometheus</code>与其他监控系统对比</h3>
<ul>
<li>
<ol>
<li><code>Prometheus vs Zabbix</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.zabbix.com" rel="external" target="_self"><code>Zabbix</code></a><!-- raw HTML omitted -->使用的是<!-- raw HTML omitted --><code>C</code><!-- raw HTML omitted -->和<!-- raw HTML omitted --><code>PHP</code>, <code>Prometheus</code><!-- raw HTML omitted -->使用<!-- raw HTML omitted --><code>Golang</code><!-- raw HTML omitted -->整体而言<!-- raw HTML omitted --><code>Prometheus</code><!-- raw HTML omitted -->运行速度更快一点<!-- raw HTML omitted --></li>
<li><code>Zabbix</code><!-- raw HTML omitted -->属于传统主机监控，主要用于物理主机、交换机、网络等监控，<!-- raw HTML omitted --><code>Prometheus</code><!-- raw HTML omitted -->不仅适用主机监控，还适用于<!-- raw HTML omitted --><code>Cloud</code>、<code>SaaS</code>、<code>Openstack</code>、<code>Container</code><!-- raw HTML omitted -->监控<!-- raw HTML omitted --></li>
<li><code>Zabbix</code><!-- raw HTML omitted -->在传统主机监控方面，有更丰富的插件<!-- raw HTML omitted --></li>
<li><code>Zabbix</code><!-- raw HTML omitted -->可以在<!-- raw HTML omitted --><code>WebGui</code><!-- raw HTML omitted -->中配置很多事情，<!-- raw HTML omitted --><code>Prometheus</code><!-- raw HTML omitted -->需要手动修改文件配置<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>Prometheus vs Nagios</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.nagios.org" rel="external" target="_self"><code>Nagios</code></a><!-- raw HTML omitted -->数据不支持自定义<!-- raw HTML omitted --><code>Labels</code><!-- raw HTML omitted -->, 不支持查询，告警也不支持去噪、分组, 没有数据存储，如果想查询历史状态，需要安装插件<!-- raw HTML omitted --></li>
<li><code>Nagios</code><!-- raw HTML omitted -->是上世纪 90 年代的监控系统，比较适合小集群或静态系统的监控<!-- raw HTML omitted --><code>Nagios</code><!-- raw HTML omitted -->太古老，很多特性都没有<!-- raw HTML omitted --><code>Prometheus</code><!-- raw HTML omitted -->要优秀很多<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><code>Prometheus vs Sensu</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://sensu.io" rel="external" target="_self"><code>Sensu</code></a><!-- raw HTML omitted -->广义上讲是<!-- raw HTML omitted --><code>Nagios</code><!-- raw HTML omitted -->的升级版本，它解决了很多<!-- raw HTML omitted --><code>Nagios</code><!-- raw HTML omitted -->的问题，如果你对<!-- raw HTML omitted --><code>Nagios</code><!-- raw HTML omitted -->很熟悉，使用<!-- raw HTML omitted --><code>Sensu</code><!-- raw HTML omitted -->是个不错的选择<!-- raw HTML omitted --></li>
<li><code>Sensu</code><!-- raw HTML omitted -->依赖<!-- raw HTML omitted --><code>RabbitMQ</code><!-- raw HTML omitted -->和<!-- raw HTML omitted --><code>Redis</code><!-- raw HTML omitted -->，数据存储上扩展性更好<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>Prometheus vs InfluxDB</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.influxdata.com" rel="external" target="_self"><code>InflusDB</code></a><!-- raw HTML omitted -->是一个开源的时序数据库，主要用于存储数据，如果想搭建监控告警系统，需要依赖其他系统<!-- raw HTML omitted --></li>
<li><code>InfluxDB</code><!-- raw HTML omitted -->在存储水平扩展以及高可用方面做的更好, 毕竟核心是数据库<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h3 id="altermanager核心概念"><code>altermanager</code>核心概念</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->分组<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>分组将类似性质的警报分类为单个通知。在许多系统一次性失败并且数百到数千个警报可能同时发生的较大中断期间，这尤其有用</li>
<li>示例：发生网络分区时，群集中正在运行数十或数百个服务实例。一半的服务实例无法再访问数据库。<code>Prometheus</code>中的警报规则配置为在每个服务实例无法与数据库通信时发送警报。结果，数百个警报被发送到<code>Alertmanager</code></li>
<li>作为用户，人们只想获得单个页面，同时仍能够确切地看到哪些服务实例受到影响。因此，可以将<code>Alertmanager</code>配置为按群集和<code>alertname</code>对警报进行分组，以便发送单个紧凑通知</li>
<li>通过配置文件中的路由树配置警报的分组，分组通知的定时以及这些通知的接收器</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->抑制<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>如果某些其他警报已经触发，则抑制是抑制某些警报的通知的概念。示例：正在触发警报，通知无法访问整个集群。<code>Alertmanager</code>可以配置为在该特定警报触发时将与该集群有关的所有其他警报静音。这可以防止数百或数千个与实际问题无关的触发警报的通知。通过<code>Alertmanager</code>的配置文件配置禁止</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->沉默<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>3沉默是在给定时间内简单地静音警报的简单方法。基于匹配器配置静默，就像路由树一样。检查传入警报它们是否匹配活动静默的所有相等或正则表达式匹配器。如果他们这样做，则不会发送该警报的通知。在<code>Alertmanager</code>的<code>Web</code>界面中配置了静音</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->客户端行为<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Alertmanager</code>对其客户的行为有特殊要求。这些仅适用于不使用<code>Prometheus</code>发送警报的高级用例</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->高可用<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Alertmanager</code>支持配置以创建用于高可用性的集群。这可以使用<code>--cluster- *</code>标志进行配置。重要的是不要在<code>Prometheus</code>和它的<code>Alertmanagers</code>之间加载平衡流量，而是将<code>Prometheus</code>指向所有<code>Alertmanagers</code>的列表</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->监控要点<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>监控方式</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>硬件监控</td>
<td>温度、硬件故障等</td>
</tr>
<tr>
<td>系统监控</td>
<td><code>CPU</code>、内存、硬盘、网卡流量、<code>TCP</code>状态、进程数</td>
</tr>
<tr>
<td>应用监控</td>
<td><code>Nginx</code>、<code>Tomcat</code>、<code>PHP</code>、<code>MySQL</code>、<code>Redis</code>等</td>
</tr>
<tr>
<td>日志监控</td>
<td>系统日志、服务日志、访问日志、错误日志</td>
</tr>
<tr>
<td>安全监控</td>
<td><code>WAF</code>、敏感文件监控</td>
</tr>
<tr>
<td><code>API</code>监控</td>
<td>可用性、接口请求、相应时间</td>
</tr>
<tr>
<td>业务监控</td>
<td>例如电商网站、每分钟生成多少订单、注册用户多少、推广活动效果</td>
</tr>
<tr>
<td>流量分析</td>
<td>根据流量获取用户相关信息，例如用户地理位置、某页面访问状态、页面停留时间等</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>名称</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Counter</code></td>
<td>递增计数器 <code>eg</code>： <code>API</code></td>
</tr>
<tr>
<td><code>Gauge</code></td>
<td>可以任意变化的数值 <code>eg. cpu</code>占用率</td>
</tr>
<tr>
<td><code>Histogram</code></td>
<td>对一段时间范围内数据进行采样，并对所有数值求和与统计数量<code>eg</code>柱状图</td>
</tr>
<tr>
<td><code>Summary</code></td>
<td>与<code>Histogram</code>类似</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="安装部署">安装部署</h3>
<h4 id="prometheus安装"><code>prometheus</code>安装</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><a href="https://prometheus.io/docs/prometheus/latest/installation/" rel="external" target="_self"><code>docker</code>安装</a><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/prometheus/<span style="color:#f92672">{</span>conf,logs,data<span style="color:#f92672">}</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker run --detach --name prometheus <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--restart always --publish 19090:9090 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume /opt/prometheus/data:/data <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume /opt/prometheus/conf:/etc/prometheus <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--config.file<span style="color:#f92672">=</span>/opt/prometheus/conf/prometheus.yml <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>prom/prometheus:v2.40.0  	<span style="color:#75715e"># --config.file 使用额外卷</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/docker-compost/prometheus/docker-compose.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">version: &#34;3&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">services:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">prometheus:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">container_name: prometheus  # 启动后名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">image: &#39;prom/prometheus:v2.40.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># image: &#39;prom/prometheus:v2.40.4&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># image: &#39;prom/prometheus:v2.40.3&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">restart: always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hostname: &#39;prometheus&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">environment:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  TZ: Asia/Shanghai
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;19090:9090&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      volumes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;/opt/prometheus/data:/data&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;/opt/prometheus/conf:/etc/prometheus&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker-compose up -d</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><a href="https://prometheus.io/docs/prometheus/latest/getting_started/" rel="external" target="_self">二进制安装</a><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/src <span style="color:#f92672">&amp;&amp;</span> wget https://github.com/prometheus/prometheus/releases/download/v2.40.0/prometheus-2.40.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar -zxf prometheus-2.40.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv prometheus-2.40.0.linux-amd64 prometheus  
</span></span><span style="display:flex;"><span>$ chown root.root prometheus -R </span></span></code></pre></div><ul>
<li>2.1 <!-- raw HTML omitted -->编写启动文件<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/prometheus.service <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Prometheus
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://prometheus.io/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=simple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/prometheus/prometheus --config.file=/opt/prometheus/prometheus.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecReload=/bin/kill -HUP $MAINPID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure  	# 或者使用 always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StandardOutput=syslog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StandardError=syslog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogIdentifier=prometheus
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">User=user_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Group=user_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=65535
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>启动服务、以及设置开机自启<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup ./prometheus --config.file<span style="color:#f92672">=</span>prometheus.yml 2&gt;&amp;<span style="color:#ae81ff">1</span> 1&gt;prometheus.log &amp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl enable prometheus
</span></span><span style="display:flex;"><span>$ systemctl start prometheus</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->查看服务<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ netstat -lntup |grep prometheus
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::9090                 :::*                    LISTEN      16655/prometheus</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->源码安装<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ go get github.com/prometheus/prometheus/cmd/...  
</span></span><span style="display:flex;"><span>$ prometheus --config.file<span style="color:#f92672">=</span>your_config.yml  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 或者make build  </span>
</span></span><span style="display:flex;"><span>$ mkdir -p $GOPATH/src/github.com/prometheus
</span></span><span style="display:flex;"><span>$ cd $GOPATH/src/github.com/prometheus
</span></span><span style="display:flex;"><span>$ git clone https://github.com/prometheus/prometheus.git
</span></span><span style="display:flex;"><span>$ cd prometheus
</span></span><span style="display:flex;"><span>$ make build
</span></span><span style="display:flex;"><span>$ ./prometheus --config.file<span style="color:#f92672">=</span>your_config.yml</span></span></code></pre></div></blockquote>
<hr>
<h4 id="alertmanager安装"><code>alertmanager</code>安装</h4>
<ul>
<li>
<ol>
<li><code>docker</code><!-- raw HTML omitted -->安装<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://quay.io/repository/prometheus/alertmanager?tab=tags&tag=latest" rel="external" target="_self"><code>Alertmanager</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/alertmanager/<span style="color:#f92672">{</span>conf,logs,data<span style="color:#f92672">}</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker run --detach --name alertmanager <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --restart always --publish 19093:9093 --publish 19094:9094 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --volume /opt/alertmanager/data:/data <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --volume /opt/alertmanager/conf:/etc/alertmanager <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  quay.io/prometheus/alertmanager:latest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/docker-compost/alertmanager/docker-compose.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">version: &#34;3&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  services:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    alertmanager:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      container_name: alertmanager  # 启动后名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      image: &#39;quay.io/prometheus/alertmanager:latest&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      # image: &#39;quay.io/prometheus/alertmanager:v0.24.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      # image: &#39;quay.io/prometheus/alertmanager:v0.23.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      restart: always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      hostname: &#39;alertmanager&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      environment:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        TZ: Asia/Shanghai
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;19093:9093&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;19094:9094&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      volumes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;/opt/alertmanager/data:/data&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;/opt/alertmanager/conf:/etc/alertmanager&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker-compose up -d</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->二进制安装<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt <span style="color:#f92672">&amp;&amp;</span> wget -c https://github.com/prometheus/alertmanager/releases/download/v0.24.0/alertmanager-0.24.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxf alertmanager-0.24.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv alertmanager-0.24.0.linux-amd64 alertmanager
</span></span><span style="display:flex;"><span>$ chown root.root alertmanager -R</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->编写启动文件<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/alertmanager.service <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Alertmanager
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://prometheus.io/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=simple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/alertmanager/alertmanager --config.file=/opt/alertmanager/alertmanager.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->启动服务、以及设置开机自启<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup ./alertmanager --config.file<span style="color:#f92672">=</span>alertmanager.yml 2&gt;&amp;<span style="color:#ae81ff">1</span> 1&gt;alertmanager.log &amp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl enable alertmanager
</span></span><span style="display:flex;"><span>$ systemctl start alertmanager</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->查看启动服务的端口<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ netstat -lntup |grep alertmanager
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::9094                 :::*                    LISTEN      17237/alertmanager
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::9093                 :::*                    LISTEN      17237/alertmanager
</span></span><span style="display:flex;"><span>udp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::9094                 :::*                                17237/alertmanager</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->编译安装<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ GO15VENDOREXPERIMENT<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> go get github.com/prometheus/alertmanager/cmd/...
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cd $GOPATH/src/github.com/prometheus/alertmanager</span>
</span></span><span style="display:flex;"><span>$ alertmanager --config.file<span style="color:#f92672">=</span>&lt;your_file&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 手动源码构建</span>
</span></span><span style="display:flex;"><span>$ mkdir -p $GOPATH/src/github.com/prometheus
</span></span><span style="display:flex;"><span>$ cd $GOPATH/src/github.com/prometheus
</span></span><span style="display:flex;"><span>$ git clone https://github.com/prometheus/alertmanager.git
</span></span><span style="display:flex;"><span>$ cd alertmanager
</span></span><span style="display:flex;"><span>$ make build
</span></span><span style="display:flex;"><span>$ ./alertmanager --config.file<span style="color:#f92672">=</span>&lt;your_file&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># amtool构建</span>
</span></span><span style="display:flex;"><span>$ make build BINARIES<span style="color:#f92672">=</span>amtool</span></span></code></pre></div></blockquote>
<hr>
<h4 id="节点安装node_export">节点安装<code>node_export</code></h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->利用<!-- raw HTML omitted --><code>node_export</code><!-- raw HTML omitted -->来监控主机，官方也提供了很多其他的<!-- raw HTML omitted --><code>export</code><!-- raw HTML omitted -->可以用来直接使用<!-- raw HTML omitted --></li>
<li><a href="https://prometheus.io/docs/instrumenting/exporters/" rel="external" target="_self"><code>EXPORTERS AND INTEGRATIONS</code></a></li>
<li><a href="https://prometheus.io/docs/guides/node-exporter/" rel="external" target="_self">使用<code>NODE EXPORTER</code>监控<code>LINUX</code>主机指标</a></li>
<li><a href="https://grafana.com/grafana/dashboards/8919-1-node-exporter-for-prometheus-dashboard-cn-0413-consulmanager/" rel="external" target="_self"><code>1 Node Exporter Dashboard 22/04/13 ConsulManager</code>自动同步版</a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->二进制安装  <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt <span style="color:#f92672">&amp;&amp;</span> wget -c https://github.com/prometheus/node_exporter/releases/download/v1.4.0/node_exporter-1.4.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxvf node_exporter-1.4.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv node_exporter-1.4.0.linux-amd64 node_exporter
</span></span><span style="display:flex;"><span>$ chown root.root node_exporter -R</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->编写启动文件<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/node_exporter.service <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=node_exporter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://prometheus.io/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=simple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/node_exporter/node_exporter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->启动服务、以及设置开机自启<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup ./node_exporter --config.file<span style="color:#f92672">=</span>node_exporter.yml 2&gt;&amp;<span style="color:#ae81ff">1</span> 1&gt;node_exporter.log &amp;  
</span></span><span style="display:flex;"><span>$ systemctl enable node_exporter
</span></span><span style="display:flex;"><span>$ systemctl start node_exporter</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->查看启动的服务端口<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ netstat -lntup |grep node_export
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::9100                 :::*                    LISTEN      4551/node_exporter</span></span></code></pre></div></blockquote>
<hr>
<h4 id="部署cadvisor采集源">部署<code>cAdvisor</code>采集源</h4>
<ul>
<li>
<ol>
<li><code>Docker</code><!-- raw HTML omitted -->部署<!-- raw HTML omitted --><code>cAdvisor</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://grafana.com/grafana/dashboards/893-main/" rel="external" target="_self"><code>Docker and system monitoring Grafana dashboard</code></a></li>
<li><a href="https://grafana.com/grafana/dashboards/10585-docker-dashboard/" rel="external" target="_self"><code>Grafana Docker Dashboard</code></a></li>
<li><a href="https://grafana.com/grafana/dashboards/16314-docker-container-os-node-node-exporter-cadvisor/?tab=revisions" rel="external" target="_self"><code>docker container &amp; OS node(node_exporter, cadvisor)</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -d --name<span style="color:#f92672">=</span>cadvisor <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -p 8080:8080 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /:/rootfs:ro <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /var/run:/var/run:rw <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /sys:/sys:ro <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /var/lib/docker/:/var/lib/docker:ro <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  google/cadvisor:v0.33.0</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->查看指标<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ http://&lt;目标节点IP&gt;:8080/metrics</span></span></code></pre></div></blockquote>
<hr>
<h4 id="数据库服务器部署mysqld_exporter">数据库服务器部署<code>mysqld_exporter</code></h4>
<blockquote>
<ul>
<li><a href="https://grafana.com/grafana/dashboards/17320-1-mysqld-exporter-dashboard-22-11-06/" rel="external" target="_self"><code>1 Mysqld Exporter Dashboard 22/11/06中文版</code></a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->二进制安装  <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt <span style="color:#f92672">&amp;&amp;</span> wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.14.0/mysqld_exporter-0.14.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxvf mysqld_exporter-0.14.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv mysqld_exporter-0.14.0.linux-amd64 mysqld_exporter  
</span></span><span style="display:flex;"><span>$ chown -R root. mysqld_exporter  </span></span></code></pre></div><ul>
<li><code>mysqld_exporter</code><!-- raw HTML omitted -->需要连接<!-- raw HTML omitted --><code>Mysql</code><!-- raw HTML omitted -->，首先为它创建用户并赋予所需的权限<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> REPLICATION CLIENT, PROCESS <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;exporter&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123456&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">ON</span> performance_schema.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;exporter&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">flush</span> <span style="color:#66d9ef">privileges</span>;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->在数据库服务器<!-- raw HTML omitted --><code>mysqld_exporter</code><!-- raw HTML omitted -->目录下创建<!-- raw HTML omitted --><code>.my.cnf</code><!-- raw HTML omitted -->文件<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/mysqld_exporter/.my.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[client]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">user=mysql_monitor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=mysql_monitor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->编写启动文件<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/mysqld_exporter.service <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=mysql_exporter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://prometheus.io/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=simple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/mysqld_exporter/mysqld_exporter --config.my-cnf=/opt/mysqld_exporter/.my.cnf 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->启动服务、以及设置开机自启<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./mysqld_exporter  --config.my-cnf<span style="color:#f92672">=</span>/opt/mysqld_exporter/.my.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl enable mysqld_exporter
</span></span><span style="display:flex;"><span>$ systemctl start mysqld_exporter</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->查看启动的服务端口<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ss -unplt|grep mysqld_exporter
</span></span><span style="display:flex;"><span>tcp    LISTEN     <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">128</span>    <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:9104               <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:*                   users:<span style="color:#f92672">((</span><span style="color:#e6db74">&#34;mysqld_exporter&#34;</span>,pid<span style="color:#f92672">=</span>7339,fd<span style="color:#f92672">=</span>3<span style="color:#f92672">))</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="部署pushgateway推送网关">部署<code>pushgateway</code>(推送网关)</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->二进制安装  <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt <span style="color:#f92672">&amp;&amp;</span> wget -c https://github.com/prometheus/pushgateway/releases/download/v1.4.3/pushgateway-1.4.3.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxf pushgateway-1.4.3.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv pushgateway-1.4.3.linux-amd64 pushgateway
</span></span><span style="display:flex;"><span>$ chown root.root pushgateway -R</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->编写启动文件<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/pushgateway.service <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=pushgateway
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://prometheus.io/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=simple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/pushgateway/pushgateway
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->启动服务、以及设置开机自启<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup ./pushgateway --config.file<span style="color:#f92672">=</span>node_exporter.yml 2&gt;&amp;<span style="color:#ae81ff">1</span> 1&gt;node_exporter.log &amp;  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl enable pushgateway
</span></span><span style="display:flex;"><span>$ systemctl start pushgateway</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->查看启动的服务端口<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ netstat -lntup |grep push
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::9091                 :::*                    LISTEN      5982/pushgateway</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_open_falcon">Install_Open_Falcon</h1>

<h2 id="部署open-falcon服务">部署<code>Open Falcon</code>服务</h2>
<h3 id="open-falcon架构"><code>Open-falcon</code>架构</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->介绍<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><code>OpenFalcon</code>是一款企业级、高可用、可扩展的开源监控解决方案。此项目最初由小米公司发起，小米运维团队从互联网公司的需求出发，根据多年的运维经验，结合<code>SRE</code>、<code>SA</code>、<code>DEVS</code>的使用经验和反馈，开发的一套面向互联网的企业级开源监控产品，最新版本为<code>v2.0</code>。目前有几十家公司不同程度使用<code>OpenFalcon</code>作为分布式系统的监控解决方案。</p>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->优点<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>采集器自动发现，支持<code>falcon-agent</code>、<code>snmp</code>、支持用户主动push数据、用户自定义插件</li>
<li>支持每个周期上亿次的数据采集、告警判定、历史数据存储和查询</li>
<li>高效的分区、支持监控策略模板、模板继承和覆盖、多种告警方式、支持告警回调</li>
<li>单节点能支持200万<code>metric</code>的上报、归档、存储</li>
<li>其存储采用<code>rrdtool</code>归档，秒级返回上百个<code>metric</code>一年的历史数据</li>
<li>多维度的数据展示，可由用户自定义<code>Screen</code></li>
<li>通过各种插件目前支持<code>Linux</code>、<code>Windows</code>、<code>Mysql</code>、<code>Redis</code>、<code>Memache</code>、<code>RabbitMQ</code>和交换机监控</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->监控范围<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>OpenFalcon</code>支持系统基础监控，第三方服务监控，<code>JVM</code>监控，业务应用监控</li>
<li>基础监控指<code>Linux</code>平台的系统指标监控，包括<code>CPU</code>、<code>Load</code>、内存、磁盘、<code>IO</code>、网络等，这些指标由<code>OpenFalcon</code>的<code>agent</code>节点直接支持，无需插件</li>
<li><code>JVM</code>监控主要通过插件完成，插件通过<code>JVM</code>开放的<code>JMX</code>通信端口，获取到<code>JVM</code>参数指标，并推送到<code>agent</code>节点，再由<code>agent</code>发送到<code>OpenFalcon</code></li>
<li>第三方服务监控指一些常见服务监控，包括<code>MySQL</code>、<code>Redis</code>、<code>Nginx</code>等，<code>OpenFalcon</code>官网提供了很多第三方服务的监控插件，也可以自己实现插件，定义采集指标。而采集到的指标，也是通过插件先发送给<code>agent</code>，再由agent发送到<code>OpenFalcon</code></li>
<li>业务应用监控主要是监控企业自主开发的应用服务。由企业根据业务需要定义采集指标，自实现插件。将获取到的采集指标发送到<code>agen</code>t，再由<code>agent</code>发送到<code>OpenFalcon</code></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>openfalcon</code><!-- raw HTML omitted -->数据流向<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>常见的<code>OpenFalcon</code>包含<code>transfer</code>、<code>hbs</code>、<code>agent</code>、<code>judge</code>、<code>graph</code>、<code>API</code>几个进程。但没有提供用户界面。用户界面的解决方案是<code>OpenFalcon</code>官方提供的<code>Dashboard</code>，由<code>python</code>编写的一个Web服务。<code>Dashboard</code>调用<code>OpenFalcon</code>的<code>API</code>节点<code>REST</code>，完成用户认证，查询历史等操作。</li>
<li>以下是各个节点的数据流向图，主数据流向是<code>agent</code>-&gt;<code>transfer</code>-&gt;<code>judge/graph</code>：</li>
</ul>
<p><a href="#R-image-a10605b32ba4d579622f9e23ca3e74c7" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a10605b32ba4d579622f9e23ca3e74c7"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer.jpg"></a></p>
<p><a href="#R-image-f6386271bcd200f60ac9d469a9174235" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f6386271bcd200f60ac9d469a9174235"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-1.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->模块<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-d95b9adbd134d11635fa38e0b50549dc" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-2.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d95b9adbd134d11635fa38e0b50549dc"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-2.jpg"></a></p>
<p><a href="#R-image-69fa5f1bdadfe20defb1732a61e1c1d0" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-3.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-69fa5f1bdadfe20defb1732a61e1c1d0"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-3.png"></a></p>
<p><a href="#R-image-0b8d04e0aafda156afa0b501e9467fa8" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-4.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0b8d04e0aafda156afa0b501e9467fa8"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-4.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->组件<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><code>Agent</code>: 是用于采集被部署机器上的监控数据，每隔<code>60</code>秒<code>push</code>给<code>Transfer</code>模块。<code>agent</code>与<code>Transfer</code>建立的是长连接（毕竟每分钟发送一次，短连接开销太大）。每台要被监控的机器都要部署该模块，它消耗的资源很小，不用太担心这一点。同时<code>agent</code>提供了一个<code>http</code>接口<code>/v1/push</code>用于接收用户手工<code>push</code>的一些数据，然后通过长连接迅速转发给<code>Transfer</code>，在实际使用中，我们对于某些自己项目接口的监控就是通过此方式来进行上传的</p>
</li>
<li>
<p><code>transfer</code>： 是数据转发服务。它接收<code>agent</code>上报的数据，然后按照哈希规则进行数据分片、并将分片后的数据分别<code>push</code>给<code>graph</code>和<code>judge</code>等组件</p>
</li>
<li>
<p><code>graph</code>是存储绘图数据的组件。<code>graph</code>组件接收<code>transfer</code>组件推送上来的监控数据，同时处理<code>query</code>组件的查询请求、返回绘图数据</p>
</li>
<li>
<p><code>query</code>组件，提供统一的绘图数据查询入口。<code>query</code>组件接收查询请求，根据一致性哈希算法去相应的<code>graph</code>实例查询不同监控项的数据，然后汇总拿到的数据，最后统一返回给用户</p>
</li>
<li>
<p><code>dashboard</code>是面向用户的查询界面。在这里，用户可以看到<code>push</code>到<code>graph</code>中的所有数据，并查看其趋势图</p>
</li>
<li>
<p>邮件短信发送模块，这个组件没有代码，需要各个公司自行提供。监控系统产生报警事件之后需要发送报警邮件或者报警短信，各个公司可能有自己的邮件服务器，有自己的邮件发送方法；有自己的短信通道，有自己的短信发送方法。<code>falcon</code>为了适配各个公司，在接入方案上做了一个规范，需要各公司提供<code>http</code>的短信和邮件发送接口</p>
</li>
<li>
<p><code>Sender</code>： 6 中提到各个公司会提供邮件、短信发送接口，但是产生了报警之后就立马调用这些接口发送报警，是不合适的。因为这些接口可能无法处理巨大的并发量，而且接口本身的处理速度可能也比较慢，这会拖慢我们的处理逻辑。所以一个比较好的方式是把邮件、短信发送这个事情做成异步的。<code>Sender</code>提供一个短信<code>redis</code>队列，提供一个邮件<code>redis</code>队列。当有短信要发送的时候，直接将短信内容写入短信<code>redis</code>队列即可，当有邮件要发送的时候，直接将邮件内容写入邮件<code>redis</code>队列。针对每个队列，后面有一个预设大小的<code>worker</code>线程池来处理。有了队列的缓冲，即便某个时刻产生了大量报警，造成邮件、短信发送的突发流量，也不会对邮件、短信发送接口造成冲击</p>
</li>
<li>
<p><code>Fe</code>这是<code>Go</code>版本的<code>UIC</code>，也是一个统一的<code>web</code>入口，因为监控组件众多，记忆<code>ip</code>、<code>port</code>去访问还是比较麻烦。<code>fe</code>像是一个监控的<code>hao123.</code>就是为了用户使用方便配置的一个web浏览器操作界面</p>
</li>
<li>
<p><code>Portal</code>是用来配置报警策略的,和<code>HBS</code>一起描述</p>
</li>
<li>
<p><code>HBS(Heartbeat Server)</code>：</p>
</li>
</ul>
<blockquote>
<ul>
<li><code>Portal</code>的数据库中有一个<code>host</code>表，维护了公司所有机器的信息，比如<code>hostname</code>、<code>ip</code>等等。<code>HBS</code>第一个功能：<code>agent</code>发送心跳信息给<code>HBS</code>的时候，会把<code>hostname</code>、<code>ip</code>、<code>agent</code> <code>version</code>、<code>plugin version</code>等信息告诉<code>HBS</code>，<code>HBS</code>负责更新<code>host</code>表</li>
<li><code>Agent</code>只采集用户配置的监控项。比如用户配置了对某个机器<code>80</code>端口的监控，我们才会去采集这个机器<code>80</code>端口的存活性。那<code>agent</code>如何知道自己应该采集哪些端口和进程呢？向<code>HBS</code>要，<code>HBS</code>去读取<code>Portal</code>的数据库，返回给<code>agent</code></li>
<li><code>Judge</code>需要获取所有的报警策略，让<code>Judge</code>去读取<code>Portal</code>的<code>DB</code>么？不太好。因为<code>Judge</code>的实例数目比较多，如果公司有几十万机器，<code>Judge</code>实例数目可能会是几百个，几百个<code>Judge</code>实例去访问<code>Portal</code>数据库，也是一个比较大的压力。既然<code>HBS</code>无论如何都要访问<code>Portal</code>的数据库了，那就让<code>HBS</code>去获取所有的报警策略缓存在内存里，然后<code>Judge</code>去向<code>HBS</code>请求。这样一来，对<code>Portal DB</code>的压力就会大大减小</li>
</ul>
</blockquote>
<ul>
<li><code>Judge Judge</code>用于告警判断，<code>agent</code>将数据<code>push</code>给<code>Transfer</code>，<code>Transfer</code>不但会转发给<code>Graph</code>组件来绘图，还会转发给<code>Judge</code>用于判断是否触发告警。因为监控系统数据量比较大，一台机器显然是搞不定的，所以必须要有个数据分片方案。<code>Transfer</code>通过一致性哈希来分片，每个<code>Judge</code>就只需要处理一小部分数据就可以了。所以判断告警的功能不能放在直接的数据接收端<code>Transfer</code>，而应该放到<code>Transfer</code>后面的组件里，就有了<code>Judge.</code></li>
<li><code>Links</code>是为报警合并功能写的组件。如果你不想使用报警合并功能，这个组件是无需安装的。一般不会用到</li>
<li><code>alarm</code>模块是处理报警<code>event</code>的，<code>judge</code>产生的报警<code>event</code>写入<code>redis</code>，<code>alarm</code>从<code>redis</code>读取处理，报警<code>event</code>的处理逻辑并非仅仅是发邮件、发短信这么简单。为了能够自动化对<code>event</code>做处理，<code>alarm</code>需要支持在产生<code>event</code>的时候回调用户提供的接口；有的时候报警短信、邮件太多，对于优先级比较低的报警，希望做报警合并，这些逻辑都是在<code>alarm</code>中做的</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="7">
<li><!-- raw HTML omitted -->流程<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>目标服务器运行<code>agent</code></li>
<li><code>agent</code>采集各类监控项数值，传给<code>transfer</code></li>
<li><code>transfer</code>校验和整理监控项数值，做一致性<code>hash</code>分片，传给对应的<code>judge</code>模块以验证是否触发告警</li>
<li><code>transfer</code>整理监控项数值，做一致性<code>hash</code>分片，传输给<code>graph</code>以进行数据的存储</li>
<li><code>judge</code>根据具体报警策略或阈值进行告警判断，如触发告警则组装告警<code>event</code>事件，写入缓存队列</li>
<li><code>alarm</code>和<code>sender</code>根据<code>event</code>事件中的判定结果，执行<code>event</code>，像用户组发送短信或邮件</li>
<li><code>graph</code>收到监控项数据后，将数据存储成<code>RRD</code>文件格式，进行归档，并提供查询接口</li>
<li><code>query</code>将调用<code>graph</code>的查询接口，将监控数据传送到<code>dashboard</code>以进行页面展示</li>
<li><code>dashboard</code>则渲染页面，展示曲线报表图等</li>
<li><code>portal</code>提供页面供用户配置机器分组、报警策略、表达式、<code>nodata</code>等配置</li>
</ul>
</blockquote>
<hr>
<h3 id="open-falcon部署"><code>Open-falcon</code>部署</h3>
<blockquote>
<ul>
<li><code>Open-Falcon</code><!-- raw HTML omitted -->为前后端分离的架构，包含<!-- raw HTML omitted --><code>backend</code><!-- raw HTML omitted -->和<!-- raw HTML omitted --><code>frontend</code><!-- raw HTML omitted -->两部分<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->前端(客户端)和后端(服务端)<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->环境准备<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->安装<!-- raw HTML omitted --><code>redis</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y redis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动</span>
</span></span><span style="display:flex;"><span>$ redis-server &amp;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->装<!-- raw HTML omitted --><code>mysql</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->解压到<!-- raw HTML omitted --><code>/usr/local</code><!-- raw HTML omitted -->目录<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget http://ftp.iij.ad.jp/pub/db/mysql/Downloads/MySQL-5.7/mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->移动至该目录<!-- raw HTML omitted --><code>cd /usr/local/mysql</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mv mysql-5.7.22-linux-glibc2.12-x86_64 /usr/local/mysql</span></span></code></pre></div><ul>
<li><code>rpm -qa | grep mariadb</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm -e mariadb-libs –nodeps</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->创建数据库目录<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir data</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->创建<!-- raw HTML omitted --><code>mysql</code><!-- raw HTML omitted -->系统组和系统用户并不建立家目录<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ groupadd -r mysql <span style="color:#f92672">&amp;&amp;</span> useradd -r -g mysql -s /bin/false -M mysql</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->授权给<!-- raw HTML omitted --><code>mysql</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chown -R mysql:mysql .</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->做个软链接<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ln -s /usr/local/mysql/bin/* /usr/local/bin</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->编写主配置文件<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/my.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[mysqld]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basedir=/usr/local/mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">datadir=/usr/local/mysql/data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pid-file=/usr/local/mysql/data/mysqld.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socket=/usr/local/mysql/mysql.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-error=/usr/local/mysql/data/mysql.err
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[client]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socket=/usr/local/mysql/mysql.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->初始化数据库<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqld --initialize --user<span style="color:#f92672">=</span>mysql --basedir<span style="color:#f92672">=</span>/usr/local/mysql --datadir<span style="color:#f92672">=</span>/usr/local/mysql/data</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->移动至<!-- raw HTML omitted --><code>support-files</code><!-- raw HTML omitted -->目录下<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd support-files</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->复制启动服务至<!-- raw HTML omitted --><code>/etc/init.d/mysqld</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp mysql.server /etc/init.d/mysqld</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->启动<!-- raw HTML omitted --><code>mysql</code><!-- raw HTML omitted -->服务<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /etc/init.d/mysqld start</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->找密码<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /usr/local/mysql/data/mysql.err</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->登录<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysql -uroot -p<span style="color:#e6db74">&#39;密码&#39;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->修改密码<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ alter user root@localhost identified by <span style="color:#e6db74">&#39;123&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->初始化<!-- raw HTML omitted --><code>mysql</code><!-- raw HTML omitted -->表结构<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /tmp/ <span style="color:#f92672">&amp;&amp;</span> git clone https://github.com/open-falcon/falcon-plus.git 
</span></span><span style="display:flex;"><span>$ cd /tmp/falcon-plus/scripts/mysql/db_schema/
</span></span><span style="display:flex;"><span>$ mysql -h 127.0.0.1 -u root -p &lt; 1_uic-db-schema.sql
</span></span><span style="display:flex;"><span>$ mysql -h 127.0.0.1 -u root -p &lt; 2_portal-db-schema.sql
</span></span><span style="display:flex;"><span>$ mysql -h 127.0.0.1 -u root -p &lt; 3_dashboard-db-schema.sql
</span></span><span style="display:flex;"><span>$ mysql -h 127.0.0.1 -u root -p &lt; 4_graph-db-schema.sql
</span></span><span style="display:flex;"><span>$ mysql -h 127.0.0.1 -u root -p &lt; 5_alarms-db-schema.sql
</span></span><span style="display:flex;"><span>$ rm -rf /tmp/falcon-plus/</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->配置<!-- raw HTML omitted --><code>Go</code><!-- raw HTML omitted -->语言开发环境(需要<code>epel</code>源)<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install golang -y</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->查看<!-- raw HTML omitted --><code>go</code><!-- raw HTML omitted -->的安装路径<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ find / -name go</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->设置环境变量<!-- raw HTML omitted --><code>GOROOT</code>和<code>GOPATH</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export GOROOT<span style="color:#f92672">=</span>/usr/lib/golang
</span></span><span style="display:flex;"><span>$ export GOPATH<span style="color:#f92672">=</span>/home</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->下载编译好的二进制版本<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://github.com/open-falcon/falcon-plus/releases/download/v0.2.1/open-falcon-v0.2.1.tar.gz</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->启动后端<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->创建工作目录<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export FALCON_HOME<span style="color:#f92672">=</span>/home/work
</span></span><span style="display:flex;"><span>$ export WORKSPACE<span style="color:#f92672">=</span>$FALCON_HOME/open-falcon
</span></span><span style="display:flex;"><span>$ mkdir -p $WORKSPACE</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->解压二进制包<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tar -xzvf open-falcon-v0.2.1.tar.gz -C $WORKSPACE</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->在一台机器上启动所有的后端组件<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->修改配置文件<!-- raw HTML omitted --><code>cfg.json</code></p>
<p>部分模块依赖连接数据库，因为如果不修改配置文件，<code>aggregator</code>模块会出现无法启动，<code>graph</code>、<code>hbs</code>、<code>nodata</code>、<code>api</code>、<code>alarm</code>模块会出现开启不报错但是状态为开启失败的情况。</p>
<p>如果需要每个模块都能正常启动，需要将上面模块的<code>cfg.json</code>的数据库信息进行修改，需要修改配置文件所在的目录</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>模块</th>
<th>配置文件所在路径</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aggregator</code></td>
<td><code>/home/work/aggregator/config/cfg.json</code></td>
</tr>
<tr>
<td><code>graph</code></td>
<td><code>/home/work/graph/config/cfg.json</code></td>
</tr>
<tr>
<td><code>hbs</code></td>
<td><code>/home/work/hbs/config/cfg.json</code></td>
</tr>
<tr>
<td><code>nodata</code></td>
<td><code>/home/work/nodata/config/cfg.json</code></td>
</tr>
<tr>
<td><code>api</code></td>
<td><code>/home/work/api/config/cfg.json</code></td>
</tr>
<tr>
<td><code>alarm</code></td>
<td><code>/home/work/alarm/config/cfg.json</code></td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->启动<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd $WORKSPACE
</span></span><span style="display:flex;"><span>$ ./open-falcon start
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 检查所有模块的启动状况</span>
</span></span><span style="display:flex;"><span>$ ./open-falcon check</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->安装前端<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->创建工作目录<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export HOME<span style="color:#f92672">=</span>/home/work
</span></span><span style="display:flex;"><span>$ export WORKSPACE<span style="color:#f92672">=</span>$HOME/open-falcon
</span></span><span style="display:flex;"><span>$ mkdir -p $WORKSPACE
</span></span><span style="display:flex;"><span>$ cd $WORKSPACE</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->克隆前端组件<!-- raw HTML omitted --><code>diamante</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd $WORKSPACE
</span></span><span style="display:flex;"><span>$ git clone https://github.com/open-falcon/dashboard.git</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->安装依赖包<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y python-virtualenv
</span></span><span style="display:flex;"><span>$ yum install -y python-devel
</span></span><span style="display:flex;"><span>$ yum install -y openldap-devel
</span></span><span style="display:flex;"><span>$ yum install -y mysql-devel
</span></span><span style="display:flex;"><span>$ yum groupinstall <span style="color:#e6db74">&#34;Development tools&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd $WORKSPACE/dashboard/
</span></span><span style="display:flex;"><span>$ virtualenv ./env
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./env/bin/pip install -r pip_requirements.txt -i https://pypi.douban.com/simple</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->修改配置<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dashboard的配置文件为： <span style="color:#e6db74">&#39;rrd/config.py&#39;</span>，请根据实际情况修改
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># API_ADDR 表示后端api组件的地址</span>
</span></span><span style="display:flex;"><span>API_ADDR <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://127.0.0.1:8080/api/v1&#34;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 根据实际情况，修改PORTAL_DB_*, 默认用户名为root，默认密码为&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 根据实际情况，修改ALARM_DB_*, 默认用户名为root，默认密码为&#34;&#34;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->在生产环境启动<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ bash control start
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 停止</span>
</span></span><span style="display:flex;"><span>$ bash control stop
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看日志</span>
</span></span><span style="display:flex;"><span>$ Bash control tail</span></span></code></pre></div><ul>
<li><code>dashboard</code><!-- raw HTML omitted -->用户管理<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>dashbord没有默认创建任何账号包括管理账号，需要你通过页面进行注册账号。
想拥有管理全局的超级管理员账号，需要手动注册用户名为root的账号（第一个帐号名称为root的用户会被自动设置为超级管理员）。
超级管理员可以给普通用户分配权限管理。

小提示：注册账号能够被任何打开dashboard页面的人注册，所以当给相关的人注册完账号后，需要去关闭注册账号功能。只需要去修改api组件的配置文件cfg.json，将signup_disable配置项修改为true，重启api即可。当需要给人开账号的时候，再将配置选项改回去，用完再关掉即可。</code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->被监控端配置<!-- raw HTML omitted --><code>agent</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>agent</code><!-- raw HTML omitted -->需要部署到所有要被监控的机器上，比如公司有10万台机器，那就要部署10万个<!-- raw HTML omitted --><code>agent</code>。<code>agent</code><!-- raw HTML omitted -->本身资源消耗很少，不用担心<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->配置说明：配置文件必须叫<!-- raw HTML omitted --><code>cfg.json</code><!-- raw HTML omitted -->，可以基于<!-- raw HTML omitted --><code>cfg.example.json</code><!-- raw HTML omitted -->修改<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;debug&#34;</span>: true,  	<span style="color:#75715e"># 控制一些debug信息的输出，生产环境通常设置为false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;hostname&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,  	<span style="color:#75715e"># agent采集了数据发给transfer，endpoint就设置为了hostname，默认通过`hostname`获取，如果配置中配置了hostname，就用配置中的</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;ip&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#75715e"># agent与hbs心跳的时候会把自己的ip地址发给hbs，agent会自动探测本机ip，如果不想让agent自动探测，可以手工修改该配置</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;plugin&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;enabled&#34;</span>: false,  	<span style="color:#75715e"># 默认不开启插件机制</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;dir&#34;</span>: <span style="color:#e6db74">&#34;./plugin&#34;</span>,  	<span style="color:#75715e"># 把放置插件脚本的git repo clone到这个目录</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;git&#34;</span>: <span style="color:#e6db74">&#34;https://github.com/open-falcon/plugin.git&#34;</span>, <span style="color:#75715e"># 放置插件脚本的git repo地址</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logs&#34;</span>: <span style="color:#e6db74">&#34;./logs&#34;</span>  	<span style="color:#75715e"># 插件执行的log，如果插件执行有问题，可以去这个目录看log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;heartbeat&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;enabled&#34;</span>: true,  	<span style="color:#75715e"># 此处enabled要设置为true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;addr&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1:6030&#34;</span>, <span style="color:#75715e"># hbs的地址，端口是hbs的rpc端口</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;interval&#34;</span>: 60,  	<span style="color:#75715e"># 心跳周期，单位是秒</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;timeout&#34;</span>: <span style="color:#ae81ff">1000</span>  	<span style="color:#75715e"># 连接hbs的超时时间，单位是毫秒</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;transfer&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;enabled&#34;</span>: true, 
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;addrs&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;127.0.0.1:18433&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">]</span>,  	<span style="color:#75715e"># transfer的地址，端口是transfer的rpc端口, 可以支持写多个transfer的地址，agent会保证HA</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;interval&#34;</span>: 60,  	<span style="color:#75715e"># 采集周期，单位是秒，即agent一分钟采集一次数据发给transfer</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;timeout&#34;</span>: <span style="color:#ae81ff">1000</span>  	<span style="color:#75715e"># 连接transfer的超时时间，单位是毫秒</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;http&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;enabled&#34;</span>: true,  	<span style="color:#75715e"># 是否要监听http端口</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;listen&#34;</span>: <span style="color:#e6db74">&#34;:1988&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;backdoor&#34;</span>: false
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;collector&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ifacePrefix&#34;</span>: <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;eth&#34;</span>, <span style="color:#e6db74">&#34;em&#34;</span><span style="color:#f92672">]</span>,  	<span style="color:#75715e"># 默认配置只会采集网卡名称前缀是eth、em的网卡流量，配置为空就会采集所有的，lo的也会采集。可以从/proc/net/dev看到各个网卡的流量信息</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mountPoint&#34;</span>: <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;default_tags&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;ignore&#34;</span>: <span style="color:#f92672">{</span>  	<span style="color:#75715e"># 默认采集了200多个metric，可以通过ignore设置为不采集</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cpu.busy&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.bytes.free&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.bytes.total&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.bytes.used&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.bytes.used.percent&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.inodes.total&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.inodes.free&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.inodes.used&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.inodes.used.percent&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.memtotal&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.memused&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.memused.percent&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.memfree&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.swaptotal&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.swapused&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.swapfree&#34;</span>: true
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->进程管理<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./open-falcon start agent  	<span style="color:#75715e"># 启动进程</span>
</span></span><span style="display:flex;"><span>$ ./open-falcon stop agent  	<span style="color:#75715e"># 停止进程</span>
</span></span><span style="display:flex;"><span>$ ./open-falcon monitor agent  	<span style="color:#75715e"># 查看日志</span></span></span></code></pre></div><ul>
<li>
<p><!-- raw HTML omitted -->验证<!-- raw HTML omitted --></p>
<p>看<code>var</code>目录下的<code>log</code>是否正常，或者浏览器访问其<code>1988</code>端口。另外<code>agent</code>提供了一个<code>--check</code>参数，可以检查<code>agent</code>是否可以正常跑在当前机器上</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./falcon-agent --check</span></span></code></pre></div><ul>
<li>
<p><code>/v1/push</code><!-- raw HTML omitted -->接口<!-- raw HTML omitted --></p>
<p>设计初衷是不希望用户直接连到<code>Transfer</code>发送数据，而是通过<code>agent</code>的<code>/v1/push</code>接口转发，接口使用范例：</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ts<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>date +%s<span style="color:#e6db74">`</span>; curl -X POST -d <span style="color:#e6db74">&#34;[{\&#34;metric\&#34;: \&#34;metric.demo\&#34;, \&#34;endpoint\&#34;: \&#34;qd-open-falcon-judge01.hd\&#34;, \&#34;timestamp\&#34;: </span>$ts<span style="color:#e6db74">,\&#34;step\&#34;: 60,\&#34;value\&#34;: 9,\&#34;counterType\&#34;: \&#34;GAUGE\&#34;,\&#34;tags\&#34;: \&#34;project=falcon,module=judge\&#34;}]&#34;</span> http://127.0.0.1:1988/v1/push</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_nightingale">Install_Nightingale</h1>

<h2 id="nightingale部署"><code>Nightingale</code>部署</h2>
<blockquote>
<ul>
<li><a href="https://github.com/ccfos/nightingale" rel="external" target="_self"><code>Nightingale</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_grafana">Install_Grafana</h1>

<h2 id="部署grafana">部署<code>Grafana</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://grafana.com/grafana/download?platform=linux" rel="external" target="_self"><code>Download Grafana</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://grafana.com/grafana/download?pg=graf-deployment-options&plcmt=deploy-box-1" rel="external" target="_self"><code>Download Grafana</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><code>Docker</code><!-- raw HTML omitted -->安装<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -d --name<span style="color:#f92672">=</span>grafana -p 3000:3000 grafana/grafana-enterprise</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>tar.gz</code><!-- raw HTML omitted -->二进制包安装<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://dl.grafana.com/enterprise/release/grafana-enterprise-9.4.7.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar -zxvf grafana-enterprise-9.4.7.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv grafana-enterprise-9.4.7 /opt/apps/grafana
</span></span><span style="display:flex;"><span>$ /opt/apps/grafana/bin/grafana-server</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>rpm</code><!-- raw HTML omitted -->安装<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://dl.grafana.com/enterprise/release/grafana-enterprise-9.3.0-1.x86_64.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum localinstall grafana-6.3.3-1.x86_64.rpm -y</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->设置开机自启：<!-- raw HTML omitted --><code>web</code><!-- raw HTML omitted -->页面<!-- raw HTML omitted --><code>3000</code><!-- raw HTML omitted -->登录信息：<!-- raw HTML omitted --><strong><code>admin/admin</code></strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl enable grafana-server.service
</span></span><span style="display:flex;"><span>$ systemctl start grafana-server.service</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->安装插件<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ grafana-cli plugins install grafana-piechart-panel
</span></span><span style="display:flex;"><span>$ systemctl restart grafana-server</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_zabbix">Configure_Zabbix</h1>

<h2 id="配置zabbix-job">配置<code>Zabbix Job</code></h2>
<ul>
<li>
<ol>
<li><code>Zabbix-Agen</code><!-- raw HTML omitted -->测试服务端<!-- raw HTML omitted -->、<a href="https://www.cnblogs.com/zhuochong/p/10361947.html" rel="external" target="_self"><code>Zabbix</code>监控配置</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><code>abbix_get</code>：<code>-s</code>：客户端地址，<code>-p</code>：客户端端口，<code>-k</code>：键值<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ bin/zabbix_get -s <span style="color:#e6db74">&#34;zabbix_agent IP&#34;</span> -k agent.ping -p <span style="color:#ae81ff">10050</span> <span style="color:#75715e"># get value</span>
</span></span><span style="display:flex;"><span>$ cp /usr/share/fonts/wqy-microhei/wqy-microhei.ttc nginx/html/zabbix/fonts/DejaVuSans.ttf</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->压力测试<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ab -c <span style="color:#ae81ff">10</span> -n <span style="color:#ae81ff">1000000</span> http://192.168.56.11:8080/</span></span></code></pre></div></blockquote>
<hr>
<h3 id="配置zabbix用户">配置<code>Zabbix</code>用户</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->创建配置用户<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-c742d564fd11aac36180340a69db8cf8" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-28-48.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c742d564fd11aac36180340a69db8cf8"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-28-48.png"></a></p>
<p><a href="#R-image-de73fd454b713b6880000932f6f37a04" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-34-55.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-de73fd454b713b6880000932f6f37a04"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-34-55.png"></a></p>
</blockquote>
<hr>
<h3 id="创建主机或者主机组">创建主机或者主机组</h3>
<blockquote>
<p><a href="#R-image-76e67695a6868d83eaa68cab74f13d03" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/host_groups_redis.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-76e67695a6868d83eaa68cab74f13d03"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/host_groups_redis.png"></a></p>
<p><a href="#R-image-71729f6892f3394271d14cc45cda0851" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/host_groups_web.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-71729f6892f3394271d14cc45cda0851"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/host_groups_web.png"></a></p>
<p><a href="#R-image-7df85f6f8475e53d47d73285316f1cd5" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-38-06.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7df85f6f8475e53d47d73285316f1cd5"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-38-06.png"></a></p>
<p><a href="#R-image-eb0e16b2b9c4d8bcc9a0a73dc7b4cf33" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-43-33.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-eb0e16b2b9c4d8bcc9a0a73dc7b4cf33"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-43-33.png"></a></p>
</blockquote>
<hr>
<h3 id="配置zabbix监控端口告警">配置<code>Zabbix</code>监控端口告警</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->监控端口<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->创建、配置监控项<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-72f03e44a1ac5bd9ee96a612ee63098d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-26-45.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-72f03e44a1ac5bd9ee96a612ee63098d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-26-45.png"></a></p>
<p><a href="#R-image-6b4169d4d11c391651e996b09f1b19f4" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-28-55.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6b4169d4d11c391651e996b09f1b19f4"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-28-55.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->创建、配置触发器<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-17e884feabc6f61da36a393647799260" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-30-18.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-17e884feabc6f61da36a393647799260"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-30-18.png"></a></p>
<p><a href="#R-image-407504e20cb3a04cd1a5b4e50c3c6b4d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-31-54.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-407504e20cb3a04cd1a5b4e50c3c6b4d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-31-54.png"></a></p>
</blockquote>
</blockquote>
<hr>
<h3 id="配置linux系统登录告警">配置<code>Linux</code>系统登录告警</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->配置<!-- raw HTML omitted --><code>sshd</code><!-- raw HTML omitted -->登录告警<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ env
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/ssh/sshrc<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">a_user=$USER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">a_ip=`echo $SSH_CLIENT | awk &#39;{print $1}&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">a_time=$(date +&#34;%F %H:%M:%S&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">a_server=`/sbin/ifconfig eth0|sed -n &#39;2p&#39; |awk &#39;{print $2}&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">msg=&#34;Someone logged in the Machine, please verify the IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Time: ${a_time}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">User: ${a_user}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Host: ${a_server}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Login ip: ${a_ip}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#####   dash unsupport array   #####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TrustIp=&#39;192.168.0.61 192.168.0.37&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">result=$(echo ${TrustIp} | grep &#34;${a_ip}&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ &#34;${result}&#34; != &#34;&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">curl -X POST &#34;https://api.telegram.org/botID:KEY/sendMessage&#34; -d &#34;chat_id=GrouID&amp;text=${msg}&#34; &gt; /dev/null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_zabbix_grafana">Configure_Zabbix_Grafana</h1>

<h2 id="配置zabbixgrafana监控展示">配置<code>Zabbix+Grafana</code>监控展示</h2>
<blockquote>
<table>
<thead>
<tr>
<th>名称地址</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.zabbix.com/cn/integrations/grafana" rel="external" target="_self"><code>Zabbix+Grafana</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://grafana.com/grafana/dashboards/?plcmt=footer&dataSource=alexanderzobnin-zabbix-datasource" rel="external" target="_self"><code>Grafana Dashboards</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://blog.csdn.net/sinat_33622098/article/details/116007072" rel="external" target="_self"><code>Grafana</code>之<code>telegram</code>报警配置</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/starsliao/ConsulManager" rel="external" target="_self"><code>ConsulManager</code>实现<code>Prometheus</code>监控目标</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://grafana.com/grafana/dashboards/9965-1-blackbox-exporter-dashboard-20220412/" rel="external" target="_self"><code>Blackbox Exporter Dashboard 2022/04/12</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://grafana.com/grafana/dashboards/8919-1-node-exporter-for-prometheus-dashboard-cn-0413-consulmanager/" rel="external" target="_self"><code>1 Node Exporter Dashboard 22/04/13 ConsulManager</code>自动同步版</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->配置<!-- raw HTML omitted --><code>Grafana</code><!-- raw HTML omitted -->中文界面<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/apps/grafana/conf/defaults.ini<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_language = en-US  	# 修改为：default_language = zh-CN
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ grafana-cli plugins install grafana-zh-cn-panel</span></span></code></pre></div></blockquote>
<ul>
<li><code>Grafana</code><!-- raw HTML omitted -->安装<!-- raw HTML omitted --><a href="https://grafana.com/grafana/plugins/alexanderzobnin-zabbix-app/?tab=installation" rel="external" target="_self"><code>Zabbix</code>插件</a><!-- raw HTML omitted -->到指定目录<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>--pluginsDir=</code><!-- raw HTML omitted -->指定插件安装目录<!-- raw HTML omitted --></li>
<li><code>alexanderzobnin-zabbix-app</code><!-- raw HTML omitted -->要安装的插件<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/apps/grafana/bin/grafana-cli --pluginsDir<span style="color:#f92672">=</span>/opt/apps/grafana/data/plugins plugins install alexanderzobnin-zabbix-app</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->安装<a href="https://grafana.com/grafana/plugins/grafana-image-renderer/?tab=installation" rel="external" target="_self"><code>Grafana Image Renderer</code></a>图像插件<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/apps/grafana/bin/grafana-cli --pluginsDir<span style="color:#f92672">=</span>/opt/apps/grafana/data/plugins plugins install grafana-image-renderer</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->启用图片发送参数<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/apps/grafana/conf/defaults.ini<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">capture = false  	# 修改为：true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">upload_external_image_storage = false  	# 修改为：true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>Grafana</code><!-- raw HTML omitted -->页面配置<!-- raw HTML omitted --><code>Zabbix</code><!-- raw HTML omitted -->数据源<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-eb43e860d7a9ae8e5b7119138c44e80b" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-04-35.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-eb43e860d7a9ae8e5b7119138c44e80b"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-04-35.png"></a></p>
<p><a href="#R-image-5b7fcb3dd4ed6cec3515d57cee3c846b" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-02-57.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5b7fcb3dd4ed6cec3515d57cee3c846b"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-02-57.png"></a></p>
<p><a href="#R-image-e4177fbba142a4222ce89fdddd0b3536" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-05-53.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e4177fbba142a4222ce89fdddd0b3536"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-05-53.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->使用<!-- raw HTML omitted --><code>Zabbix</code><!-- raw HTML omitted -->数据源创建<!-- raw HTML omitted --><code>Grafana</code><!-- raw HTML omitted -->仪表盘<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-d1cabcd07c6e201cbcbdefd88c05a015" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-18-40.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d1cabcd07c6e201cbcbdefd88c05a015"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-18-40.png"></a></p>
</blockquote>
<ul>
<li><code>Grafana</code><!-- raw HTML omitted -->配置<!-- raw HTML omitted --><code>Telegram</code><!-- raw HTML omitted -->告警<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-4509c4d9b5fc7f7ddb75f9b407f38a70" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Telegram/Snipaste_2023-04-04_20-40-56.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4509c4d9b5fc7f7ddb75f9b407f38a70"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Telegram/Snipaste_2023-04-04_20-40-56.png"></a></p>
<p><a href="#R-image-8b1d7e12ca1180aaa64d288d7712e807" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Telegram/Snipaste_2023-04-04_21-09-21.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8b1d7e12ca1180aaa64d288d7712e807"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Telegram/Snipaste_2023-04-04_21-09-21.png"></a></p>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_prometheus">Configure_Prometheus</h1>

<h2 id="配置prometheus">配置<code>Prometheus</code></h2>
<h3 id="prometheus的yaml文件编写"><code>Prometheus</code>的<code>yaml</code>文件编写</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/prometheus/prometheus.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># my global config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global:  	# 全局配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">scrape_interval:     15s # 默认情况下，每15s拉取一次目标采样点数据
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># scrape_timeout is set to the global default (10s).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Alertmanager configuration
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alerting:  	# 报警配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alertmanagers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - static_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - targets:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      # - alertmanager:9093
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#remote_write:  	# 用于远程存储写配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#remote_read:  	# 用于远程读配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Load rules once and periodically evaluate them according to the global &#39;evaluation_interval&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rule_files:  	# 规则配置，主要是配置：报警规则
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # - &#34;rules/*.yml&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # - &#34;first_rules.yml&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # - &#34;second_rules.yml&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># A scrape configuration containing exactly one endpoint to scrape:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Here it&#39;s Prometheus itself.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">scrape_configs:  	# 抓取配置，主要配置抓取客户端相关
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - job_name: &#39;prometheus&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # metrics_path defaults to &#39;/metrics&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # scheme defaults to &#39;http&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    static_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - targets: [&#39;localhost:9090&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - job_name: &#39;node&#39;  	# 任务名，使用node_export插件获取服务器监控数据
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    static_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - targets:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;localhost:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;swoft_1:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;swoft_2:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;175_web:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;176_web:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;177_admin:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_0:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_1:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_2:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_3:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - job_name: &#39;mysql&#39;  	# 使用mysqld_exporter插件获取Mysql监控数据
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    static_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - targets:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_0:9104&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_1:9104&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_2:9104&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_3:9104&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - job_name: &#39;container&#39;  	# 使用cAdvisor 获取到的容器监控数据
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    static_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - targets: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;&lt;节点01的IP&gt;:8080&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;&lt;节点02的IP&gt;:8080&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="配置prometheus-web页面">配置<code>Prometheus web</code>页面</h3>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->浏览器访问：<!-- raw HTML omitted --><code>IP:9090</code></p>
</li>
<li>
<p><code>shell</code><!-- raw HTML omitted -->命令创建<!-- raw HTML omitted --></p>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;some_metric 3.14&#34;</span> | curl --data-binary @- http://localhost:9091/metrics/job/some_job</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->发送复杂数据<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF | curl --data-binary @- http://localhost:9091/metrics/job/some_job/instance/some_instance
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># TYPE some_metric counter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">some_metric{label=&#34;val1&#34;} 42
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># TYPE another_metric gauge
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># HELP another_metric Just an example.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">another_metric 2398.283
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->添加数据源<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->添加<!-- raw HTML omitted --><code>prometheus</code><!-- raw HTML omitted -->，填写<!-- raw HTML omitted --><code>prometheus</code><!-- raw HTML omitted -->的管理地址<!-- raw HTML omitted --></p>
</li>
<li>
<p><!-- raw HTML omitted -->导入<!-- raw HTML omitted --><code>dashboard</code></p>
</li>
<li>
<p><!-- raw HTML omitted -->通过<!-- raw HTML omitted --><a href="https://grafana.com/grafana/dashboards" rel="external" target="_self"><code>grafana</code>官网</a><!-- raw HTML omitted -->仪表盘添加对应仪表盘<!-- raw HTML omitted --></p>
</li>
<li>
<p><!-- raw HTML omitted -->常用仪表盘<!-- raw HTML omitted --></p>
</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="配置grafana">配置<code>grafana</code></h3>
<blockquote>
<ul>
<li><code>grafana</code><!-- raw HTML omitted -->告警邮件配置<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->修改<!-- raw HTML omitted --><code>grafana</code><!-- raw HTML omitted -->配置文件，添加<!-- raw HTML omitted --><code>Email</code><!-- raw HTML omitted -->配置<!-- raw HTML omitted --></li>
<li><a href="https://grafana.com/grafana/dashboards/" rel="external" target="_self"><code>Grafana Dashboards</code></a></li>
<li><a href="https://github.com/starsliao/ConsulManager" rel="external" target="_self"><code>ConsulManager</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/grafana/grafana.ini<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[smtp]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled = true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host = smtp.163.com:465
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">user = 18329903316
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># If the password contains # or ; you have to wrap it with trippel quotes. Ex &#34;&#34;&#34;#password;&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password = xxxxxxxxxxxx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;cert_file =
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;key_file =
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;skip_verify = false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">from_address = 18329903316@163.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;from_name = Grafana
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;ehlo_identity = dashboard.exmple.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>grafana web</code><!-- raw HTML omitted -->界面配置<!-- raw HTML omitted --><code>Notification channels</code></li>
</ul>
<blockquote>
</blockquote>
<ul>
<li><code>alter</code><!-- raw HTML omitted -->配置<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->⚠️：<!-- raw HTML omitted --><code>Template variables are not supported in alert queries</code><!-- raw HTML omitted -->在查询中不能使用模版语法，不然无法创建告警<!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="配置prometheus监控nginx">配置<code>Prometheus</code>监控<code>Nginx</code></h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->下载<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->监控插件<!-- raw HTML omitted --><code>nginx-module-vts</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone git://github.com/vozlt/nginx-module-vts.git </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->重新编译<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->支持插件<!-- raw HTML omitted --><code>nginx-module-vts</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx-1.12.2 --user<span style="color:#f92672">=</span>nginx --group<span style="color:#f92672">=</span>nginx --with-http_stub_status_module  --with-http_ssl_module &gt; --add-module<span style="color:#f92672">=</span>/usr/local/nginx-module-vts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ make</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->拷贝重新编译后的<!-- raw HTML omitted --><code>Nginx</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nginx -s stop
</span></span><span style="display:flex;"><span>$ <span style="color:#ae81ff">\c</span>p ./objs/nginx /usr/local/nginx/sbin/</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->修改<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->主配置文件<!-- raw HTML omitted --><code>nginx.conf</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;nginx.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.....
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">### Prometheus 配置   
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vhost_traffic_status_zone;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vhost_traffic_status_filter_by_host on;  	# 打开vhost过滤
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">### Prometheus 配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.....
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">location /status {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         # vhost_traffic_status off;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         vhost_traffic_status_display;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         vhost_traffic_status_display_format html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->下载<!-- raw HTML omitted --><code>nginx-vts-exporter</code><!-- raw HTML omitted -->监控插件<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt <span style="color:#f92672">&amp;&amp;</span> wget -c https://github.com/hnlq715/nginx-vts-exporter/releases/download/&gt; v0.10.3/nginx-vts-exporter-0.10.3.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar xf nginx-vts-exporter-0.10.3.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>./nginx-vts-exporter -nginx.scrape_timeout <span style="color:#ae81ff">10</span> -nginx.scrape_uri 
</span></span><span style="display:flex;"><span>http://10.10.16.107/status/format/json &amp;  	<span style="color:#75715e"># 启动nginx Vhost Traffic</span>
</span></span><span style="display:flex;"><span>http://10.10.16.107/status  	<span style="color:#75715e"># 访问nginx主机各节点状态</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="配置alertmanager告警">配置<code>Alertmanager</code>告警</h3>
<ul>
<li><!-- raw HTML omitted -->告警规则<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><a href="https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/" rel="external" target="_self"><code>ALERTING RULES</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;rules/general.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">groups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name: general.rules  	# 报警规则组名称
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # 任何实例5分钟内无法访问发出告警
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - alert: InstanceDown
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    expr: up == 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for: 5m  	# 持续时间 ， 表示持续一分钟获取不到信息，则触发报警
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      severity: page  # 自定义标签 error
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      summary: &#34;Instance {{ $labels.instance }} 停止工作 down&#34;  	# 自定义摘要
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: &#34;{{ $labels.instance }} of job {{ $labels.job }} 已经停止5分钟以上 has been down for more than 5 minutes.&#34;  	# 自定义具体描述
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;rules/node.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">groups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name: node.rules
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - alert: NodeFilesystemUsage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    expr: 100 - (node_filesystem_free_bytes{fstype=~&#34;ext4|xfs&#34;} / node_filesystem_size_bytes{fstype=~&#34;ext4|xfs&#34;} * 100) &gt; 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for: 2m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      severity: warning
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      summary: &#34;{{$labels.instance}}: {{$labels.mountpoint }} 分区使用过高&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: &#34;{{$labels.instance}}: {{$labels.mountpoint }} 分区使用大于 80% (当前值: {{ $value }})&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - alert: NodeMemoryUsage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    expr: 100 - (node_memory_MemFree_bytes+node_memory_Cached_bytes+node_memory_Buffers_bytes) / node_memory_MemTotal_bytes * 100 &gt; 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for: 2m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      severity: warning
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      summary: &#34;{{$labels.instance}}: 内存使用过高&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: &#34;{{$labels.instance}}: 内存使用大于 80% (当前值: {{ $value }})&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - alert: NodeCPUUsage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    expr: 100 - (avg(irate(node_cpu_seconds_total{mode=&#34;idle&#34;}[5m])) by (instance) * 100) &gt; 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for: 2m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      severity: warning
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      summary: &#34;{{$labels.instance}}: CPU使用过高&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: &#34;{{$labels.instance}}: CPU使用大于 80% (当前值: {{ $value }})&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cat rules/reload.yml 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">groups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name: prometheus.rules
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - alert: AlertmanagerReloadFailed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    expr: alertmanager_config_last_reload_successful == 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for: 10m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      severity: warning
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      summary: &#34;{{$labels.instance}}: Alertmanager配置重新加载失败&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: &#34;{{$labels.instance}}: Alertmanager配置重新加载失败&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - alert: PrometheusReloadFailed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    expr: prometheus_config_last_reload_successful == 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for: 10m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      severity: warning
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      summary: &#34;{{$labels.instance}}: Prometheus配置重新加载失败&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: &#34;{{$labels.instance}}: Prometheus配置重新加载失败&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">route</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">receiver</span>: <span style="color:#e6db74">&#39;default-receiver&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">group_wait</span>: <span style="color:#ae81ff">30s</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">group_interval</span>: <span style="color:#ae81ff">5m</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">repeat_interval</span>: <span style="color:#ae81ff">4h</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">group_by</span>: [<span style="color:#ae81ff">cluster, alertname]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">routes</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">receiver</span>: <span style="color:#e6db74">&#39;database-pager&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">group_wait</span>: <span style="color:#ae81ff">10s</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">match_re</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">service</span>: <span style="color:#ae81ff">mysql|cassandra</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">receiver</span>: <span style="color:#e6db74">&#39;frontend-pager&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">group_by</span>: [<span style="color:#ae81ff">product, environment]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">match</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">team</span>: <span style="color:#ae81ff">frontend</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">receivers</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">‘database-pager</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">email_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- to: &#39;</span><span style="color:#ae81ff">zhenliang369@163.com&#39;</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">‘frontend-pager</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">email_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- to: &#39;</span><span style="color:#ae81ff">zhenliang369@163.com&#39; </span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_open_falcon">Configure_Open_Falcon</h1>

<h2 id="open-falcon配置"><code>Open-falcon</code>配置</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->查看监控数据<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><a href="https://www.cnblogs.com/kevingrace/p/5570488.html" rel="external" target="_self"><code>Linux</code>下<code>smokeping</code>网络监控环境部署记录</a></p>
</li>
<li>
<p><code>agent</code>只要部署到机器上，并且配置好了<code>heartbeat</code>和<code>transfer</code>就自动采集数据了，我们就可以去<code>dashboard</code>上面搜索监控数据查看了。<code>dashboard</code>是个<code>web&gt; </code>项目，浏览器访问之。左侧输入<code>endpoint</code>搜索，<code>endpoint</code>是什么？应该用什么搜索？对于<code>agent</code>采集的数据<code>endpoint</code>都是机器名，去目标机器上执行<code>hostname</code>&gt; ，看到的输出就是<code>endpoint</code>，拿着<code>hostname</code>去搜索。</p>
</li>
<li>
<p>选中前面的复选框，点击“查看<code>counter</code>列表”，可以列出隶属于这个<code>endpoint</code>的<code>counter</code>假如我们要查看<code>cpu.busy</code>，在<code>counter</code>搜索框中输入<code>cpu</code>&gt; 并回车。看到<code>cpu.busy</code>了吧，点击，会看到一个新页面，图表中就是这个机器的<code>cpu.busy</code>&gt; 的近一小时数据了，想看更长时间的？右上角有个小三角，展开菜单，可以选择更长的时间跨度</p>
</li>
</ul>
<p><a href="#R-image-a1353ff1e602ae6a867b21e45130c4e7" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a1353ff1e602ae6a867b21e45130c4e7"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard.png"></a></p>
<p><a href="#R-image-bbac4b71ad24cdc2de76168de2c8a4cf" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-cpu.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bbac4b71ad24cdc2de76168de2c8a4cf"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-cpu.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->配置报警策略<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->配置报警接收人<!-- raw HTML omitted --></p>
<p><code>falcon</code>的报警接收人不是一个具体的手机号，也不是一个具体的邮箱，因为手机号、邮箱都是容易发生变化的，如果变化了去修改所有相关配置那就太麻烦了。我们把用&gt; 户的联系信息维护在一个叫 <code>帐户/Profile</code> 里，以后如果要修改手机号、邮箱，只要修改自己的帐户信息即可。报警接收人也不是单个的人，而是一个组（<code>Teams</code>），比如<code>&gt; falcon</code>这个系统的任何组件出问题了，都应该发报警给<code>falcon</code>的运维和开发人员，发给<code>falcon</code>这个团队，这样一来，新员工入职只要加入<code>falcon</code>这个<code>Team</code>&gt; 即可；员工离职，只要从<code>falcon</code>这个<code>Team</code>删掉即可。</p>
</li>
</ul>
<p><a href="#R-image-fec5123916c98a8c976e25a21e94ccc6" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-profile.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fec5123916c98a8c976e25a21e94ccc6"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-profile.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->添加报警组，添加成员<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-3c9ba1dec625fd3138aab0a385d71f47" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-group.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3c9ba1dec625fd3138aab0a385d71f47"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-group.png"></a></p>
<p><a href="#R-image-221a6f38cea0b8db258aa94102c1da9e" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-group-1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-221a6f38cea0b8db258aa94102c1da9e"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-group-1.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->创建<!-- raw HTML omitted --><code>HostGroup</code></li>
</ul>
<blockquote>
<ul>
<li>比如我们要对<code>falcon-judge</code>这个组件做端口监控，那首先创建一个<code>HostGroup</code>，把所有部署了<code>falcon-judge</code>&gt; 这个模块的机器都塞进去，以后要扩容或下线机器的时候直接从这个<code>HostGroup</code>增删机器即可，报警策略会自动生效、失效。咱们为这个<code>HostGroup</code>取名为：<code>&gt; sa.dev.falcon.judge</code>，这个名称有讲究，<code>sa</code>是我们部门，<code>dev</code>是我们组，<code>falcon</code>是项目名，<code>judge</code>&gt; 是组件名，传达出了很多信息，这样命名比较容易管理，推荐大家这么做</li>
</ul>
<p><a href="#R-image-ad30d3291f214521bbbbcefbc994196d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/hostgroups.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ad30d3291f214521bbbbcefbc994196d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/hostgroups.png"></a></p>
<ul>
<li>在往组里加机器的时候如果报错，需要检查<code>portal</code>的数据库中<code>host</code>表，看里边是否有相关机器。那<code>host</code>表中的机器从哪里来呢？<code>agent</code>有个<code>heartbeat(hbs)</code>&gt; 的配置，<code>agent</code>每分钟会发心跳给<code>hbs</code>，把自己的<code>ip</code>、<code>hostname</code>、<code>agent version</code>等信息告诉<code>hbs</code>，<code>hbs</code>负责写入<code>host</code>表。如果<code>host</code>&gt; 表中没数据，需要检查这条链路是否通畅</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->创建策略模板<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>portal</code>最上面有个<code>Templates</code>链接，这就是策略模板管理的入口。我们进去之后创建一个模板，名称姑且也叫：<code>sa.dev.falcon.judge.tpl</code>，与<code>HostGroup</code>&gt; 名称相同，在里边配置一个端口监控，通常进程监控有两种手段，一个是进程本身是否存活，一个是端口是否在监听，此处我们使用端口监控</li>
</ul>
<p><a href="#R-image-e94c1f9196a705fadfbeec6ba8aae5e9" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e94c1f9196a705fadfbeec6ba8aae5e9"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template.png"></a></p>
<p><a href="#R-image-78f2b38b8d85d372882489322d67ccd8" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template-1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-78f2b38b8d85d372882489322d67ccd8"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template-1.png"></a></p>
<ul>
<li>右上角那个加号按钮是用于增加策略的，一个模板中可以有多个策略，此处我们只添加了一个。下面可以配置报警接收人，此处填写的是<code>falcon</code>，这是之前在<code>UIC</code>&gt; 中创建的<code>Team</code>。</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->将<!-- raw HTML omitted --><code>HostGroup</code><!-- raw HTML omitted -->与模板绑定<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>一个模板是可以绑定到多个<code>HostGroup</code>的，现在我们重新回到<code>HostGroups</code>页面，找到<code>sa.dev.falcon.judge</code>这个<code>HostGroup</code>&gt; ，右侧有几个超链接，点击【templates】进入一个新页面，输入模板名称，绑定一下就行了</li>
</ul>
<p><a href="#R-image-c22f6315870e2fb71ff8ba01880a0671" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/hostgroups-tempates.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c22f6315870e2fb71ff8ba01880a0671"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/hostgroups-tempates.png"></a></p>
<p><a href="#R-image-d061150b667f124fed91469f3a52b315" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/hostgroups-tempates-1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d061150b667f124fed91469f3a52b315"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/hostgroups-tempates-1.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->补充<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>上面步骤做完了，也就配置完了。如果<code>judge</code>组件宕机，端口不再监听了，就会报警。不过大家不要为了测试报警效果，直接把<code>judge</code>组件给干掉了，因为<code>judge</code>&gt; 本身就是负责判断报警的，把它干掉了，那就没法判断了……所以说<code>falcon</code>&gt; 现在并不完善，没法用来监控本身的组件。为了测试，大家可以修改一下端口监控的策略配置，改成一个没有在监听的端口，这样就触发报警了</li>
<li>上面的策略只是对<code>falcon-judge</code>做了端口监控，那如果我们要对<code>falcon</code>这个项目的所有机器加一些负载监控，应该如何做呢？</li>
<li>创建一个<code>HostGroup：sa.dev.falcon</code>，把所有<code>falcon</code>的机器都塞进去</li>
<li>创建一个模板：<code>sa.dev.falcon.common</code>，添加一些像<code>ping</code>, <code>df.bytes.free.percent</code>, <code>load.5min</code>等策略</li>
<li>将<code>sa.dev.falcon.common</code>绑定到<code>sa.dev.falcon</code>这个<code>HostGroup</code></li>
</ul>
<p><a href="#R-image-93361f071301dfedcc30b3350dd5ba2d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template-2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-93361f071301dfedcc30b3350dd5ba2d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template-2.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->配置策略表达式<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->策略表达式，即<!-- raw HTML omitted --><code>expression</code></li>
</ul>
<p><a href="#R-image-a387ffe9c22bfc51d27723d74f27d3ba" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/expressions.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a387ffe9c22bfc51d27723d74f27d3ba"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/expressions.png"></a></p>
<ul>
<li>
<p>上例中的配置传达出的意思是：<code>endpoint=aggregator</code>并且<code>metric=cpu.busy</code>的所有的监控指标，只要连续<code>3</code>次<code>&gt;= 0.5</code>则报警给<code>falcon-test1</code>&gt; 这个报警组。</p>
</li>
<li>
<p><code>expression</code>无需绑定到<code>HostGroup</code>，<code>enjoy it</code></p>
</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="nodata配置"><code>Nodata</code>配置</h3>
<blockquote>
<blockquote>
<ul>
<li>使用<code>Nodata</code>，需要进行两个配置: <code>Nodata</code>配置和策略配置。下面，我们以一个例子，讲述如何使用<code>Nodata</code>提供的服务</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->用户需求<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>当机器分组<code>cop.xiaomi_owt.inf_pdl.falcon</code>下的所有机器，其采集指标<code>agent.alive</code> 上报中断时，通知用户</li>
</ul>
</blockquote>
<ul>
<li><code>nodata</code><!-- raw HTML omitted -->配置<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->进入<!-- raw HTML omitted --><code>Nodata</code><!-- raw HTML omitted -->配置主页，可以看到<!-- raw HTML omitted --><code>Nodata</code><!-- raw HTML omitted -->配置列表<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-765e34d8339a73b74cb276c1ef8502dc" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/nodata.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-765e34d8339a73b74cb276c1ef8502dc"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/nodata.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->点击右上角的添加按钮，添加<!-- raw HTML omitted --><code>nodata</code><!-- raw HTML omitted -->配置<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-fce57d14af1fd8536dce4eef38e9acc1" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/nodata-1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fce57d14af1fd8536dce4eef38e9acc1"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/nodata-1.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->进行完上述配置后，分组<!-- raw HTML omitted --><code>cop.xiaomi_owt.inf_pdl.falcon</code><!-- raw HTML omitted -->下的所有机器，其采集项<!-- raw HTML omitted --> <code>agent.alive</code>&lt;&gt; font color=red&gt;上报中断后，<!-- raw HTML omitted --><code>nodata</code><!-- raw HTML omitted -->服务就会补发一个取值为<!-- raw HTML omitted --><code>-1.0</code>、<code>agent.alive</code><!-- raw HTML omitted -->&gt; 的监控数据给监控系统<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->策略配置<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>配置了<code>Nodata</code>后，如果有数据上报中断的情况，<code>Nodata</code>配置中的默认值就会被上报。我们可以针对这个默认值，设置报警；只要收到了默认值，就认为发生了数据上报&gt; 的中断（如果你设置的默认值，可能与正常上报的数据相等，那么请修改你的<code>Nodata</code>配置、使默认值有别于正常值）。将此策略，绑定到分组<code>&gt; cop.xiaomi_owt.inf_pdl.falcon</code>即可。</li>
</ul>
<p><a href="#R-image-f7a5c885dbc0987fefe70cfc41bee35c" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template-3.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f7a5c885dbc0987fefe70cfc41bee35c"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template-3.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->注意事项<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>配置名称<code>name</code>，要全局唯一。这是为了方便<code>Nodata</code>配置的管理。</li>
<li>监控实例<code>endpoint</code>, 可以是机器分组、机器名或者其他 这三种类型，只能选择其中的一种。同一类型，支持多个记录，但建议不超过5个，多条记录换行分割、每行一条&gt; 记录。选择机器分组时，系统会帮忙展开成具体机器名，支持动态生效。监控实体不是机器名时，只能选择“其他”类型。</li>
<li>监控指标<code>metric</code>。</li>
<li>数据标签<code>tags</code>，多个<code>tag</code>要用逗号隔开。必须填写完整的<code>tags</code>串，因为<code>nodata</code>会按照此<code>tags</code>串，去完全匹配、筛选监控数指标项。</li>
<li>数据类型<code>type</code>，只支持原始值类型<code>GAUGE</code>。因为，<code>nodata</code>只应该监控 &ldquo;特征指标&rdquo;(如<code>agent.alive</code>)，&ldquo;特征指标&quot;都是<code>GAUGE</code>类型的</li>
<li>采集周期<code>step</code>，单位是秒。必须填写 完整<code>&amp;</code>真实<code>step</code>。该字段不完整 或者 不真实，将会导致<code>nodata</code>监控的误报、漏报。</li>
<li>补发值<code>default</code>，必须有别于上报的真实数据。比如，<code>cpu.idle</code>的取值范围是[0,100]，那么它的<code>nodata</code>默认取值 只能取小于<code>0</code>或者大于<code>100</code>&gt; 的值。否则，会发生误报、漏报</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="报警函数说明">报警函数说明</h3>
<blockquote>
<ul>
<li>说明：<code>#</code>后面的数字的最大值，即在<code>judge</code>内存中保留最近几个点，是支持自定义的</li>
</ul>
<blockquote>
<ul>
<li><code>all(#3)</code>: 最新的<code>3</code>个点都满足阈值条件则报警</li>
<li><code>max(#3)</code>: 对于最新的<code>3</code>个点，其最大值满足阈值条件则报警</li>
<li><code>min(#3)</code>: 对于最新的<code>3</code>个点，其最小值满足阈值条件则报警</li>
<li><code>sum(#3)</code>: 对于最新的<code>3</code>个点，其和满足阈值条件则报警</li>
<li><code>avg(#3)</code>: 对于最新的<code>3</code>个点，其平均值满足阈值条件则报警</li>
<li><code>diff(#3)</code>: 拿最新<code>push</code>上来的点（被减数），与历史最新的<code>3</code>个点（<code>3</code>个减数）相减，得到<code>3</code>个差，只要有一个差满足阈值条件则报警</li>
<li><code>pdiff(#3)</code>: 拿最新<code>push</code>上来的点，与历史最新的<code>3</code>个点相减，得到<code>3</code>个差，再将<code>3</code>个差值分别除以减数，得到<code>3</code>个商值，只要有一个商值满足阈值则报警</li>
<li><code>lookup(#2,3)</code>: 最新的<code>3</code>个点中有<code>2</code>个满足条件则报警；</li>
<li><code>stddev(#7) = 3</code>：离群点检测函数，取最新<strong>7</strong>个点的数据分别计算得到他们的标准差和均值，分别计为<code>σ</code>和<code>μ</code>，其中当前值计为<code>X</code>，那么当<code>X</code>落在区间 [μ-3σ, μ+3σ] 之外时，则认为当前值波动过大，触发报警；更多请参考<code>3-sigma</code>算法：https://en.wikipedia.org/wiki/68%E2%80%9395%E2%80%9399.7_rule。</li>
</ul>
</blockquote>
<ul>
<li>最常用的就是<code>all</code>函数了，比如<code>cpu.idle</code> <code>all(#3) &lt; 5</code>，表示<code>cpu.idle</code>的值连续<code>3</code>次小于<code>5%</code>则报警。</li>
<li><code>lookup</code>为非连续性报警函数，适用于在一定范围内容忍监控指标抖动的场景，比如某个主机的<code>cpu.busy</code>忽高忽低，使用<code>all(#1)&gt;80</code>明显过于严格，会产生大量报警干扰视线，使用<code>all(#3)&gt;80</code>则连续三次偏高的概率很小，可能永远不会触发报警，不能帮助我们发现系统的不稳定，那么如果使用<code>lookup(#3,5)</code>，我们就可以知道<code>cpu.busy</code>最近抖动频繁，超过了我们容忍的界线。</li>
<li>新增 <code>stddev</code> 函数，基于高斯分布的离群点检测方式，比如<code>cpu.idle</code> <code>stddev(#5) = 3</code> ，表示获取<code>cpu.idle</code>的历史<code>5</code>个点数据，计算得到他们的标准差和均值，分别计为<code>σ</code>和<code>μ</code>，看其是否分布在<code>(μ-3σ,μ+3σ)</code>范围之内，如果不在范围之内则报警。</li>
</ul>
</blockquote>
<hr>
<h3 id="screen的使用"><code>screen</code>的使用</h3>
<blockquote>
<ul>
<li>我们可以使用<code>screen</code>提前将图像定制好，而不用每次都去搜索出图，这样就实现了类似的cacti图像展示功能。</li>
</ul>
<p><a href="#R-image-57d7346bf53888fbd5d09840d9d5c06e" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-57d7346bf53888fbd5d09840d9d5c06e"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen.jpg"></a></p>
<p><a href="#R-image-8731a11b80db845cd66472523dbd97ad" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-falcon.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8731a11b80db845cd66472523dbd97ad"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-falcon.jpg"></a></p>
<p><a href="#R-image-f836fc27663c061c0d85bcaa8aa30d2f" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-1.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f836fc27663c061c0d85bcaa8aa30d2f"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-1.jpg"></a></p>
<p><a href="#R-image-54554e364dd7d686b6cda028e434d098" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-2.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-54554e364dd7d686b6cda028e434d098"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-2.jpg"></a></p>
<p><a href="#R-image-20ce5a527fe1b1547b1a16ecb718e592" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-3.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-20ce5a527fe1b1547b1a16ecb718e592"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-3.jpg"></a></p>
<p><a href="#R-image-09c03eabae1fe6669992b95deb4f138b" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-4.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-09c03eabae1fe6669992b95deb4f138b"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-4.jpg"></a></p>
<p><a href="#R-image-4ce496542aa140df1f400b17d31c0ec7" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-5.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4ce496542aa140df1f400b17d31c0ec7"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-5.jpg"></a></p>
<p><a href="#R-image-712d0c9a5312b8ff069dbeab5a39b265" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-6.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-712d0c9a5312b8ff069dbeab5a39b265"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-6.jpg"></a></p>
<p><!-- raw HTML omitted -->注：<!-- raw HTML omitted --><code>graph</code><!-- raw HTML omitted -->可以加多个<!-- raw HTML omitted --></p>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="../../../js/clipboard.min.js?1719330259" defer></script>
    <script src="../../../js/perfect-scrollbar.min.js?1719330259" defer></script>
    <script src="../../../js/theme.js?1719330259" defer></script>
  </body>
</html>
