<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.125.4"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="Install Prometheus"><meta itemprop=description content="Install-Prometheus"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://erge.blog/imgs/s2-1.jpg"><meta itemprop=keywords content="Monitor,Prometheus"><meta property="og:type" content="article"><meta property="og:title" content="Install Prometheus"><meta property="og:description" content="Install-Prometheus"><meta property="og:image" content="/imgs/s2-1.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://erge.blog/systems/linux/monitor/install-prometheus/"><meta property="og:site_name" content="二哥"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="二哥"><meta property="article:published_time" content="2022-11-29 23:22:27 +0800 CST"><meta property="article:modified_time" content="2022-11-29 23:22:27 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.0d420b6f564e6674edd4354ea71c0458a83f95ad464a75114b23d72515b1456c.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"install-prometheus","permalink":"https://erge.blog/systems/linux/monitor/install-prometheus/","title":"Install Prometheus","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>Install Prometheus - 二哥</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>二哥</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Linux、Kubernetes、Docker、Python、CI/CD、Jenkins、Mysql、Nginx、Gitlab、Ansible、Zabbix</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-Home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-th hvr-icon"></i>分类</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>0</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-tools"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-tools hvr-icon"></i>工具</a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>站点示例</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-Commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#prometheus><code>Prometheus</code></a><ul><li><a href=#prometheus与其他监控系统对比><code>Prometheus</code>与其他监控系统对比</a></li><li><a href=#altermanager核心概念><code>altermanager</code>核心概念</a></li><li><a href=#安装部署>安装部署</a><ul><li><a href=#prometheus安装><code>prometheus</code>安装</a></li><li><a href=#alertmanager安装><code>alertmanager</code>安装</a></li><li><a href=#节点安装node_export>节点安装<code>node_export</code></a></li><li><a href=#部署cadvisor采集源>部署<code>cAdvisor</code>采集源</a></li><li><a href=#数据库服务器部署mysqld_exporter>数据库服务器部署<code>mysqld_exporter</code></a></li><li><a href=#部署pushgateway推送网关>部署<code>pushgateway</code>(推送网关)</a></li></ul></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=二哥 src=/imgs/img-lazy-loading.gif data-src=/imgs/s2-1.jpg><p class=site-author-name itemprop=name>二哥</p><div class=site-description itemprop=description>The man who has made up his mind to win will never say impossible – Napoleon Bonaparte</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>0</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>51</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>150</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=qq%e5%8f%b7 title="QQ → qq号" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-qq fa-fw hvr-icon"></i>
QQ
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/lisenhui title="知乎 → https://www.zhihu.com/people/lisenhui" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=qq@qq.com title="E-Mail → qq@qq.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://weibo.com/yourname title="Weibo → https://weibo.com/yourname" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-weibo fa-fw hvr-icon"></i>
Weibo
</a></span><span class=links-of-social-item><a href="https://www.youtube.com/watch?v=RgKAFK5djSk" title="Youtube → https://www.youtube.com/watch?v=RgKAFK5djSk" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
Youtube
</a></span><span class=links-of-social-item><a href=https://github.com/elkan1788 title="Github → https://github.com/elkan1788" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/hugo-next rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://erge.blog/systems/linux/monitor/install-prometheus/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/s2-1.jpg"><meta itemprop=name content="二哥"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="二哥"><meta itemprop=description content="The man who has made up his mind to win will never say impossible – Napoleon Bonaparte"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Install Prometheus"><meta itemprop=description content="Install-Prometheus"></span><header class=post-header><h1 class=post-title itemprop="name headline">Install Prometheus
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/Systems/Linux/Monitor/Install-Prometheus.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2022-11-29 23:22:27 +0800 CST" itemprop="dateCreated datePublished" datetime="2022-11-29 23:22:27 +0800 CST">2022-11-29
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/monitor itemprop=url rel=index><span itemprop=name>Monitor</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>4813</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>10分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/systems/linux/monitor/install-prometheus/><i class="fa fa-sync fa-spin"></i>
</span></span><span class=post-meta-item title><span class=post-meta-item-icon><i class="far fa-comments"></i>
</span><span class=post-meta-item-text title=评论>评论：
</span><span id=comments-count class=waline-comment-count data-path=/systems/linux/monitor/install-prometheus/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=prometheus><code>Prometheus</code>
<a class=header-anchor href=#prometheus></a></h2><div class="note info"><blockquote><table><thead><tr><th>名称地址</th><th>描述</th></tr></thead><tbody><tr><td><a href=https://prometheus.io/docs/introduction/first_steps/ title="<code>Prometheus</code>官网" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Prometheus</code>官网
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://yunlzheng.gitbook.io/prometheus-book title="<code>prometheus-book</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>prometheus-book</code>
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://github.com/prometheus title="<code>Github-Prometheus</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Github-Prometheus</code>
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://blog.gmem.cc/prometheus-study-note title="<code>Prometheus</code>学习笔记" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Prometheus</code>学习笔记
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://blog.51cto.com/qiangsh/3093700 title="<code>Prometheus</code>介绍和使用" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Prometheus</code>介绍和使用
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://juejin.im/post/5d79d804e51d453b7779d5ce title="<code>Prometheus</code>+<code>Grafana</code>详解" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Prometheus</code>+<code>Grafana</code>详解
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://www.cnblogs.com/qianjingchen/articles/9578341.html title="<code>Prometheus</code>自定义监控部署" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Prometheus</code>自定义监控部署
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://prometheus.io/docs/instrumenting/clientlibs/ title="<code>Prometheus  CLIENT LIBRARIES</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Prometheus CLIENT LIBRARIES</code>
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://juejin.im/post/5d397c2fe51d45775e33f64a title="使用<code>Prometheus</code>+<code>Grafana</code>快速打造高逼格监控平台" rel="noopener external nofollow noreferrer" target=_blank class=exturl>使用<code>Prometheus</code>+<code>Grafana</code>快速打造高逼格监控平台
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr></tbody></table></blockquote><ul><li><ol><li><font color=red>概述</font></li></ol></li></ul><blockquote><p><code>Prometheus</code>是一个开源监控系统，它前身是
<a href=https://soundcloud.com title="<code>SoundCloud</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>SoundCloud</code>
<i class="fa fa-external-link-alt"></i>
</a>的告警工具包。从<code>2012</code>年开始，许多公司和组织开始使用<code>Prometheus</code>。该项目的开发人员和用户社区非常活跃，越来越多的开发人员和用户参与到该项目中。目前它是一个独立的开源项目，且不依赖于任何公司。为了强调这点和明确该项目治理结构，<code>Prometheus</code>在<code>2016</code>年继
<a href=https://kubernetes.io title="<code>Kurberntes</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Kurberntes</code>
<i class="fa fa-external-link-alt"></i>
</a>之后，加入了
<a href=https://www.cncf.io title="<code>Cloud Native Computing Foundation</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Cloud Native Computing Foundation</code>
<i class="fa fa-external-link-alt"></i></a></p><ul><li>1.1 <code>prometheus</code><font color=red>特点</font></li></ul><blockquote><ul><li><font color=red>多维度数据模型，一个时间序列由一个度量指标和多个标签键值对确定</font></li><li><font color=red>灵活的查询语言，对收集的时许数据进行重组</font></li><li><font color=red>强大的数据可视化功能，除了内置的浏览器，也支持</font><code>grafana</code><font color=red>集成</font></li><li><font color=red>高效存储，内存加本地磁盘，可通过功能分片和联盟来拓展性能</font></li><li><font color=red>运维简单，只依赖于本地磁盘，</font><code>go</code><font color=red>二进制安装包没有任何其他依赖</font></li><li><font color=red>精简告警</font></li><li><font color=red>非常多的客户端库</font></li><li><font color=red>提供了许多导出器来收集常用系统指标</font></li></ul></blockquote></blockquote><ul><li><ol start=2><li><font color=red>数据模型</font></li></ol></li></ul><blockquote><p><code>Prometheus</code>从根本上存储的所有数据都是时间序列数据（<code>Time Serie Data</code>，简称时序数据）。时序数据是具有时间戳的数据流，该数据流属于某个度量指标（<code>Metric</code>）和该度量指标下的多个标签（<code>Label</code>）。除了提供存储功能，<code>Prometheus</code>还可以利用查询表达式来执行非常灵活和复杂的查询。</p><ul><li><p><font color=red>度量指标和标签</font></p><p>每个时间序列（<code>Time Serie</code>，简称时序）由度量指标和一组标签键值对唯一确定。</p></li><li><p>度量指标名称描述了被监控系统的某个测量特征（比如<code>http_requests_total</code>表示<code>http</code>请求总数）。度量指标名称由<code>ASCII</code>字母、数字、下划线和冒号组成，须匹配正则表达式<code>[a-zA-Z_:][a-zA-Z0-9_:]*</code>。</p></li><li><p>标签开启了<code>Prometheus</code>的多维数据模型。对于同一个度量指标，不同标签值组合会形成特定维度的时序。<code>Prometheus</code>的查询语言可以通过度量指标和标签对时序数据进行过滤和聚合。改变任何度量指标上的任何标签值，都会形成新的时序。标签名称可以包含<code>ASCII</code>字母、数字和下划线，须匹配正则表达式<code>[a-zA-Z_][a-zA-Z0-9_]*</code>，带有 _ 下划线的标签名称保留为内部使用。标签值可以包含任意<code>Unicode</code>字符，包括中文。</p></li><li><p><font color=red>采样值(<code>Sample</code>)</font></p></li></ul><blockquote><p>时序数据其实就是一系列采样值。每个采样值包括：</p><ul><li><font color=red>一个<code>64</code>位的浮点数值</font></li><li><font color=red>一个精确到毫秒的时间戳</font></li><li><font color=red>注解(<code>Notation</code>)</font></li></ul><p>一个注解由一个度量指标和一组标签键值对构成。形式如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>metric name<span style=color:#f92672>]{[</span>label name<span style=color:#f92672>]=[</span>label value<span style=color:#f92672>]</span>, ...<span style=color:#f92672>}</span>  
</span></span></code></pre></div><p>例如，度量指标为<code>api_http_requests_total</code>，标签为<code>method="POST"</code>、<code>handler="/messages"</code>的注解表示如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>api_http_requests_total<span style=color:#f92672>{</span>method<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;POST&#34;</span>, handler<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/messages&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div></blockquote></blockquote><ul><li><ol start=3><li><font color=red>度量指标类型</font></li></ol></li></ul><blockquote><ul><li><font color=red>计数器(<code>Counter</code>)</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>计数器是一种累计型的度量指标，它是一个只能递增的数值。计数器主要用于统计类似于服务请求数、任务完成数和错误出现次数这样的数据
</span></span></code></pre></div><ul><li><font color=red>计量器(<code>Gauge</code>)</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>计量器表示一个既可以增加, 又可以减少的度量指标值。计量器主要用于测量类似于温度、内存使用量这样的瞬时数据
</span></span></code></pre></div><ul><li><font color=red>直方图(<code>Histogram</code>)</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>直方图对观察结果（通常是请求持续时间或者响应大小这样的数据）进行采样，并在可配置的桶中对其进行统计。有以下几种方式来产生直方图（假设度量指标为 ）：  
</span></span></code></pre></div><ul><li><font color=red>按桶计数</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>相当于&lt;basename&gt;_bucket{le=&#34;&lt;upper inclusive bound&gt;&#34;}
</span></span></code></pre></div><ul><li><font color=red>采样值总和</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>相当于 &lt;basename&gt;_sum  
</span></span></code></pre></div><ul><li><font color=red>采样值总数</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>相当于 &lt;basename&gt;_count ，也等同于把所有采样值放到一个桶里来计数 &lt;basename&gt;_bucket{le=&#34;+Inf&#34;}
</span></span></code></pre></div><ul><li><font color=red>汇总(<code>Summary</code>)</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>类似于直方图，汇总也对观察结果进行采样。除了可以统计采样值总和和总数，它还能够按分位数统计。有以下几种方式来产生汇总（假设度量指标为 ）：
</span></span></code></pre></div><ul><li><font color=red>采样值总和</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>相当于 &lt;basename&gt;_sum
</span></span></code></pre></div><ul><li><font color=red>采样值总数</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>相当于 &lt;basename&gt;_count  
</span></span></code></pre></div></blockquote><ul><li><ol start=4><li><font color=red>任务(<code>Job</code>)和实例(<code>Instance</code>)</font></li></ol></li></ul><blockquote><p>在<code>Prometheus</code>里，可以从中抓取采样值的端点称为实例，为了性能扩展而复制出来的多个这样的实例形成了一个任务</p><ul><li><font color=red>例如下面的</font><code>api-server</code><font color=red>任务有四个相同的实例</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>job: api-server
</span></span><span style=display:flex><span>instance 1: 1.2.3.4:5670
</span></span><span style=display:flex><span>instance 2: 1.2.3.4:5671
</span></span><span style=display:flex><span>instance 3: 5.6.7.8:5670
</span></span><span style=display:flex><span>instance 4: 5.6.7.8:5671
</span></span></code></pre></div><p>​ <code>Prometheus</code>抓取完采样值后，会自动给采样值添加下面的标签和值：</p><ul><li><p><code>job:</code><font color=red> 抓取所属任务</font></p></li><li><p><code>instance</code><font color=red>： 抓取来源实例</font></p><p>另外每次抓取时，<code>Prometheus</code>还会自动在以下时序里插入采样值：</p></li><li><p><code>up{job="[job-name]", instance="instance-id"}</code><font color=red>：采样值为 1 表示实例健康，否则为不健康</font></p></li><li><p><code>scrape_duration_seconds{job="[job-name]", instance="[instance-id]"}</code><font color=red>：采样值为本次抓取消耗时间</font></p></li><li><p><code>scrape_samples_post_metric_relabeling{job="&lt;job-name>", instance="&lt;instance-id>"}</code><font color=red>：采样值为重新打标签后的采样值个数</font></p></li><li><p><code>scrape_samples_scraped{job="&lt;job-name>", instance="&lt;instance-id>"}</code><font color=red>：采样值为本次抓取到的采样值个数</font></p></li></ul></blockquote></div><h3 id=prometheus与其他监控系统对比><code>Prometheus</code>与其他监控系统对比
<a class=header-anchor href=#prometheus%e4%b8%8e%e5%85%b6%e4%bb%96%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%e5%af%b9%e6%af%94></a></h3><div class="note infot"><ul><li><ol><li><code>Prometheus vs Zabbix</code></li></ol></li></ul><blockquote><ul><li><a href=https://www.zabbix.com title="<code>Zabbix</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Zabbix</code>
<i class="fa fa-external-link-alt"></i>
</a><font color=red>使用的是</font><code>C</code><font color=red>和</font><code>PHP</code>, <code>Prometheus</code><font color=red>使用</font><code>Golang</code><font color=red>整体而言</font><code>Prometheus</code><font color=red>运行速度更快一点</font></li><li><code>Zabbix</code><font color=red>属于传统主机监控，主要用于物理主机、交换机、网络等监控，</font><code>Prometheus</code><font color=red>不仅适用主机监控，还适用于</font><code>Cloud</code>、<code>SaaS</code>、<code>Openstack</code>、<code>Container</code><font color=red>监控</font></li><li><code>Zabbix</code><font color=red>在传统主机监控方面，有更丰富的插件</font></li><li><code>Zabbix</code><font color=red>可以在</font><code>WebGui</code><font color=red>中配置很多事情，</font><code>Prometheus</code><font color=red>需要手动修改文件配置</font></li></ul></blockquote><ul><li><ol start=2><li><code>Prometheus vs Nagios</code></li></ol></li></ul><blockquote><ul><li><a href=https://www.nagios.org title="<code>Nagios</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Nagios</code>
<i class="fa fa-external-link-alt"></i>
</a><font color=red>数据不支持自定义</font><code>Labels</code><font color=red>, 不支持查询，告警也不支持去噪、分组, 没有数据存储，如果想查询历史状态，需要安装插件</font></li><li><code>Nagios</code><font color=red>是上世纪 90 年代的监控系统，比较适合小集群或静态系统的监控</font><code>Nagios</code><font color=red>太古老，很多特性都没有</font><code>Prometheus</code><font color=red>要优秀很多</font></li></ul></blockquote><ul><li><ol start=3><li><code>Prometheus vs Sensu</code></li></ol></li></ul><blockquote><ul><li><a href=https://sensu.io title="<code>Sensu</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Sensu</code>
<i class="fa fa-external-link-alt"></i>
</a><font color=red>广义上讲是</font><code>Nagios</code><font color=red>的升级版本，它解决了很多</font><code>Nagios</code><font color=red>的问题，如果你对</font><code>Nagios</code><font color=red>很熟悉，使用</font><code>Sensu</code><font color=red>是个不错的选择</font></li><li><code>Sensu</code><font color=red>依赖</font><code>RabbitMQ</code><font color=red>和</font><code>Redis</code><font color=red>，数据存储上扩展性更好</font></li></ul></blockquote><ul><li><ol start=4><li><code>Prometheus vs InfluxDB</code></li></ol></li></ul><blockquote><ul><li><a href=https://www.influxdata.com title="<code>InflusDB</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>InflusDB</code>
<i class="fa fa-external-link-alt"></i>
</a><font color=red>是一个开源的时序数据库，主要用于存储数据，如果想搭建监控告警系统，需要依赖其他系统</font></li><li><code>InfluxDB</code><font color=red>在存储水平扩展以及高可用方面做的更好, 毕竟核心是数据库</font></li></ul></blockquote></div><h3 id=altermanager核心概念><code>altermanager</code>核心概念
<a class=header-anchor href=#altermanager%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5></a></h3><div class="note info"><ul><li><ol><li><font color=red>分组</font></li></ol></li></ul><blockquote><ul><li>1.1 分组将类似性质的警报分类为单个通知。在许多系统一次性失败并且数百到数千个警报可能同时发生的较大中断期间，这尤其有用</li><li>1.2 示例：发生网络分区时，群集中正在运行数十或数百个服务实例。一半的服务实例无法再访问数据库。<code>Prometheus</code>中的警报规则配置为在每个服务实例无法与数据库通信时发送警报。结果，数百个警报被发送到<code>Alertmanager</code></li><li>1.3 作为用户，人们只想获得单个页面，同时仍能够确切地看到哪些服务实例受到影响。因此，可以将<code>Alertmanager</code>配置为按群集和<code>alertname</code>对警报进行分组，以便发送单个紧凑通知</li><li>1.4 通过配置文件中的路由树配置警报的分组，分组通知的定时以及这些通知的接收器</li></ul></blockquote><ul><li><ol start=2><li><font color=red>抑制</font></li></ol></li></ul><blockquote><ul><li>2.1 如果某些其他警报已经触发，则抑制是抑制某些警报的通知的概念。示例：正在触发警报，通知无法访问整个集群。<code>Alertmanager</code>可以配置为在该特定警报触发时将与该集群有关的所有其他警报静音。这可以防止数百或数千个与实际问题无关的触发警报的通知。通过<code>Alertmanager</code>的配置文件配置禁止</li></ul></blockquote><ul><li><ol start=3><li><font color=red>沉默</font></li></ol></li></ul><blockquote><ul><li>3.1 沉默是在给定时间内简单地静音警报的简单方法。基于匹配器配置静默，就像路由树一样。检查传入警报它们是否匹配活动静默的所有相等或正则表达式匹配器。如果他们这样做，则不会发送该警报的通知。在<code>Alertmanager</code>的<code>Web</code>界面中配置了静音</li></ul></blockquote><ul><li><ol start=4><li><font color=red>客户端行为</font></li></ol></li></ul><blockquote><ul><li>4.1 <code>Alertmanager</code>对其客户的行为有特殊要求。这些仅适用于不使用<code>Prometheus</code>发送警报的高级用例</li></ul></blockquote><ul><li><ol start=5><li><font color=red>高可用</font></li></ol></li></ul><blockquote><ul><li>5.1 <code>Alertmanager</code>支持配置以创建用于高可用性的集群。这可以使用<code>--cluster- *</code>标志进行配置。重要的是不要在<code>Prometheus</code>和它的<code>Alertmanagers</code>之间加载平衡流量，而是将<code>Prometheus</code>指向所有<code>Alertmanagers</code>的列表</li></ul></blockquote><ul><li><ol start=6><li><font color=red>监控要点</font></li></ol></li></ul><blockquote><table><thead><tr><th>监控方式</th><th>作用</th></tr></thead><tbody><tr><td>硬件监控</td><td>温度、硬件故障等</td></tr><tr><td>系统监控</td><td><code>CPU</code>、内存、硬盘、网卡流量、<code>TCP</code>状态、进程数</td></tr><tr><td>应用监控</td><td><code>Nginx</code>、<code>Tomcat</code>、<code>PHP</code>、<code>MySQL</code>、<code>Redis</code>等</td></tr><tr><td>日志监控</td><td>系统日志、服务日志、访问日志、错误日志</td></tr><tr><td>安全监控</td><td><code>WAF</code>、敏感文件监控</td></tr><tr><td><code>API</code>监控</td><td>可用性、接口请求、相应时间</td></tr><tr><td>业务监控</td><td>例如电商网站、每分钟生成多少订单、注册用户多少、推广活动效果</td></tr><tr><td>流量分析</td><td>根据流量获取用户相关信息，例如用户地理位置、某页面访问状态、页面停留时间等</td></tr></tbody></table><table><thead><tr><th>名称</th><th>作用</th></tr></thead><tbody><tr><td><code>Counter</code></td><td>递增计数器 <code>eg</code>： <code>API</code></td></tr><tr><td><code>Gauge</code></td><td>可以任意变化的数值 <code>eg. cpu</code>占用率</td></tr><tr><td><code>Histogram</code></td><td>对一段时间范围内数据进行采样，并对所有数值求和与统计数量<code>eg</code>柱状图</td></tr><tr><td><code>Summary</code></td><td>与<code>Histogram</code>类似</td></tr></tbody></table></blockquote></div><h3 id=安装部署>安装部署
<a class=header-anchor href=#%e5%ae%89%e8%a3%85%e9%83%a8%e7%bd%b2></a></h3><h4 id=prometheus安装><code>prometheus</code>安装
<a class=header-anchor href=#prometheus%e5%ae%89%e8%a3%85></a></h4><div class="note info"><ul><li><ol><li><font color=red><a href=https://prometheus.io/docs/prometheus/latest/installation/ title="<code>docker</code>安装" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>docker</code>安装
<i class="fa fa-external-link-alt"></i></a></font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ mkdir -p /opt/prometheus/<span style=color:#f92672>{</span>conf,logs,data<span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ docker run --detach --name prometheus <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--restart always --publish 19090:9090 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--volume /opt/prometheus/data:/data <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--volume /opt/prometheus/conf:/etc/prometheus <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--config.file<span style=color:#f92672>=</span>/opt/prometheus/conf/prometheus.yml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>prom/prometheus:v2.40.0  	<span style=color:#75715e># --config.file 使用额外卷</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cat &gt;/opt/docker-compost/prometheus/docker-compose.yml<span style=color:#e6db74>&lt;&lt;-EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>version: &#34;3&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>services:
</span></span></span><span style=display:flex><span><span style=color:#e6db74> prometheus:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   container_name: prometheus  # 启动后名称
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   image: &#39;prom/prometheus:v2.40.0&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   # image: &#39;prom/prometheus:v2.40.4&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   # image: &#39;prom/prometheus:v2.40.3&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   restart: always
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   hostname: &#39;prometheus&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   environment:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     TZ: Asia/Shanghai
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - &#39;19090:9090&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      volumes:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - &#39;/opt/prometheus/data:/data&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - &#39;/opt/prometheus/conf:/etc/prometheus&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ docker-compose up -d
</span></span></code></pre></div></blockquote><ul><li><ol start=2><li><font color=red><a href=https://prometheus.io/docs/prometheus/latest/getting_started/ title=二进制安装 rel="noopener external nofollow noreferrer" target=_blank class=exturl>二进制安装
<i class="fa fa-external-link-alt"></i></a></font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd /opt/src <span style=color:#f92672>&amp;&amp;</span> wget https://github.com/prometheus/prometheus/releases/download/v2.40.0/prometheus-2.40.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>$ tar -zxf prometheus-2.40.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>$ mv prometheus-2.40.0.linux-amd64 prometheus  
</span></span><span style=display:flex><span>$ chown root.root prometheus -R 
</span></span></code></pre></div><ul><li>2.1 <font color=red>编写启动文件</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat &gt;/usr/lib/systemd/system/prometheus.service <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Unit]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Description=Prometheus
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Documentation=https://prometheus.io/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>After=network.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Service]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Type=simple
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/opt/prometheus/prometheus --config.file=/opt/prometheus/prometheus.yml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecReload=/bin/kill -HUP $MAINPID
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Restart=on-failure  	# 或者使用 always
</span></span></span><span style=display:flex><span><span style=color:#e6db74>StandardOutput=syslog
</span></span></span><span style=display:flex><span><span style=color:#e6db74>StandardError=syslog
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SyslogIdentifier=prometheus
</span></span></span><span style=display:flex><span><span style=color:#e6db74>User=user_name
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Group=user_name
</span></span></span><span style=display:flex><span><span style=color:#e6db74>LimitNOFILE=65535
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Install]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>WantedBy=multi-user.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><ul><li>2.2 <font color=red>启动服务、以及设置开机自启</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ nohup ./prometheus --config.file<span style=color:#f92672>=</span>prometheus.yml 2&gt;&amp;<span style=color:#ae81ff>1</span> 1&gt;prometheus.log &amp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ systemctl enable prometheus
</span></span><span style=display:flex><span>$ systemctl start prometheus
</span></span></code></pre></div><ul><li>2.3 <font color=red>查看服务</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ netstat -lntup |grep prometheus
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::9090                 :::*                    LISTEN      16655/prometheus
</span></span></code></pre></div></blockquote><ul><li><ol start=3><li><font color=red>源码安装</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ go get github.com/prometheus/prometheus/cmd/...  
</span></span><span style=display:flex><span>$ prometheus --config.file<span style=color:#f92672>=</span>your_config.yml  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 或者make build  </span>
</span></span><span style=display:flex><span>$ mkdir -p $GOPATH/src/github.com/prometheus
</span></span><span style=display:flex><span>$ cd $GOPATH/src/github.com/prometheus
</span></span><span style=display:flex><span>$ git clone https://github.com/prometheus/prometheus.git
</span></span><span style=display:flex><span>$ cd prometheus
</span></span><span style=display:flex><span>$ make build
</span></span><span style=display:flex><span>$ ./prometheus --config.file<span style=color:#f92672>=</span>your_config.yml
</span></span></code></pre></div></blockquote></div><h4 id=alertmanager安装><code>alertmanager</code>安装
<a class=header-anchor href=#alertmanager%e5%ae%89%e8%a3%85></a></h4><div class="note info"><ul><li><ol><li><code>docker</code><font color=red>安装</font></li></ol></li></ul><blockquote><ul><li>1.1
<a href="https://quay.io/repository/prometheus/alertmanager?tab=tags&amp;tag=latest" title="<code>Alertmanager</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Alertmanager</code>
<i class="fa fa-external-link-alt"></i></a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ mkdir -p /opt/alertmanager/<span style=color:#f92672>{</span>conf,logs,data<span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ docker run --detach --name alertmanager <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --restart always --publish 19093:9093 --publish 19094:9094 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --volume /opt/alertmanager/data:/data <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --volume /opt/alertmanager/conf:/etc/alertmanager <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  quay.io/prometheus/alertmanager:latest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cat &gt;/opt/docker-compost/alertmanager/docker-compose.yml<span style=color:#e6db74>&lt;&lt;-EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>version: &#34;3&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  services:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    alertmanager:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      container_name: alertmanager  # 启动后名称
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      image: &#39;quay.io/prometheus/alertmanager:latest&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      # image: &#39;quay.io/prometheus/alertmanager:v0.24.0&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      # image: &#39;quay.io/prometheus/alertmanager:v0.23.0&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      restart: always
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      hostname: &#39;alertmanager&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      environment:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        TZ: Asia/Shanghai
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - &#39;19093:9093&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - &#39;19094:9094&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      volumes:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - &#39;/opt/alertmanager/data:/data&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - &#39;/opt/alertmanager/conf:/etc/alertmanager&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ docker-compose up -d
</span></span></code></pre></div></blockquote><ul><li><ol start=2><li><font color=red>二进制安装</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd /opt <span style=color:#f92672>&amp;&amp;</span> wget -c https://github.com/prometheus/alertmanager/releases/download/v0.24.0/alertmanager-0.24.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>$ tar zxf alertmanager-0.24.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>$ mv alertmanager-0.24.0.linux-amd64 alertmanager
</span></span><span style=display:flex><span>$ chown root.root alertmanager -R
</span></span></code></pre></div><ul><li>2.1 <font color=red>编写启动文件</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat &gt;/usr/lib/systemd/system/alertmanager.service <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Unit]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Description=Alertmanager
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Documentation=https://prometheus.io/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>After=network.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Service]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Type=simple
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/opt/alertmanager/alertmanager --config.file=/opt/alertmanager/alertmanager.yml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Restart=on-failure
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Install]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>WantedBy=multi-user.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><ul><li>2.2 <font color=red>启动服务、以及设置开机自启</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ nohup ./alertmanager --config.file<span style=color:#f92672>=</span>alertmanager.yml 2&gt;&amp;<span style=color:#ae81ff>1</span> 1&gt;alertmanager.log &amp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ systemctl enable alertmanager
</span></span><span style=display:flex><span>$ systemctl start alertmanager
</span></span></code></pre></div><ul><li>2.3 <font color=red>查看启动服务的端口</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ netstat -lntup |grep alertmanager
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::9094                 :::*                    LISTEN      17237/alertmanager
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::9093                 :::*                    LISTEN      17237/alertmanager
</span></span><span style=display:flex><span>udp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::9094                 :::*                                17237/alertmanager
</span></span></code></pre></div></blockquote><ul><li><ol start=3><li><font color=red>编译安装</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ GO15VENDOREXPERIMENT<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> go get github.com/prometheus/alertmanager/cmd/...
</span></span><span style=display:flex><span><span style=color:#75715e># cd $GOPATH/src/github.com/prometheus/alertmanager</span>
</span></span><span style=display:flex><span>$ alertmanager --config.file<span style=color:#f92672>=</span>&lt;your_file&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 手动源码构建</span>
</span></span><span style=display:flex><span>$ mkdir -p $GOPATH/src/github.com/prometheus
</span></span><span style=display:flex><span>$ cd $GOPATH/src/github.com/prometheus
</span></span><span style=display:flex><span>$ git clone https://github.com/prometheus/alertmanager.git
</span></span><span style=display:flex><span>$ cd alertmanager
</span></span><span style=display:flex><span>$ make build
</span></span><span style=display:flex><span>$ ./alertmanager --config.file<span style=color:#f92672>=</span>&lt;your_file&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># amtool构建</span>
</span></span><span style=display:flex><span>$ make build BINARIES<span style=color:#f92672>=</span>amtool
</span></span></code></pre></div></blockquote></div><h4 id=节点安装node_export>节点安装<code>node_export</code>
<a class=header-anchor href=#%e8%8a%82%e7%82%b9%e5%ae%89%e8%a3%85node_export></a></h4><div class="note info"><blockquote><ul><li><ol><li><font color=red>利用</font><code>node_export</code><font color=red>来监控主机，官方也提供了很多其他的</font><code>export</code><font color=red>可以用来直接使用</font></li></ol></li><li><ol start=2><li><a href=https://prometheus.io/docs/instrumenting/exporters/ title="<code>EXPORTERS AND INTEGRATIONS</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>EXPORTERS AND INTEGRATIONS</code>
<i class="fa fa-external-link-alt"></i></a></li></ol></li><li><ol start=3><li><a href=https://prometheus.io/docs/guides/node-exporter/ title="使用<code>NODE EXPORTER</code>监控<code>LINUX</code>主机指标" rel="noopener external nofollow noreferrer" target=_blank class=exturl>使用<code>NODE EXPORTER</code>监控<code>LINUX</code>主机指标
<i class="fa fa-external-link-alt"></i></a></li></ol></li><li><ol start=4><li><a href=https://grafana.com/grafana/dashboards/8919-1-node-exporter-for-prometheus-dashboard-cn-0413-consulmanager/ title="<code>1 Node Exporter Dashboard 22/04/13 ConsulManager</code>自动同步版" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>1 Node Exporter Dashboard 22/04/13 ConsulManager</code>自动同步版
<i class="fa fa-external-link-alt"></i></a></li></ol></li></ul></blockquote><ul><li><ol><li><font color=red>二进制安装</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd /opt <span style=color:#f92672>&amp;&amp;</span> wget -c https://github.com/prometheus/node_exporter/releases/download/v1.4.0/node_exporter-1.4.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>$ tar zxvf node_exporter-1.4.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>$ mv node_exporter-1.4.0.linux-amd64 node_exporter
</span></span><span style=display:flex><span>$ chown root.root node_exporter -R
</span></span></code></pre></div><ul><li>1.1 <font color=red>编写启动文件</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat &gt;/usr/lib/systemd/system/node_exporter.service <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Unit]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Description=node_exporter
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Documentation=https://prometheus.io/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>After=network.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Service]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Type=simple
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/opt/node_exporter/node_exporter
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Restart=on-failure
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Install]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>WantedBy=multi-user.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><ul><li>1.2 <font color=red>启动服务、以及设置开机自启</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ nohup ./node_exporter --config.file<span style=color:#f92672>=</span>node_exporter.yml 2&gt;&amp;<span style=color:#ae81ff>1</span> 1&gt;node_exporter.log &amp;  
</span></span><span style=display:flex><span>$ systemctl enable node_exporter
</span></span><span style=display:flex><span>$ systemctl start node_exporter
</span></span></code></pre></div><ul><li>1.3 <font color=red>查看启动的服务端口</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ netstat -lntup |grep node_export
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::9100                 :::*                    LISTEN      4551/node_exporter
</span></span></code></pre></div></blockquote></div><h4 id=部署cadvisor采集源>部署<code>cAdvisor</code>采集源
<a class=header-anchor href=#%e9%83%a8%e7%bd%b2cadvisor%e9%87%87%e9%9b%86%e6%ba%90></a></h4><div class="note info"><ul><li><ol><li><code>Docker</code><font color=red>部署</font><code>cAdvisor</code></li></ol></li></ul><blockquote><ul><li>1.1
<a href=https://grafana.com/grafana/dashboards/893-main/ title="<code>Docker and system monitoring Grafana dashboard</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Docker and system monitoring Grafana dashboard</code>
<i class="fa fa-external-link-alt"></i></a></li><li>1.2
<a href=https://grafana.com/grafana/dashboards/10585-docker-dashboard/ title="<code>Grafana Docker Dashboard</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Grafana Docker Dashboard</code>
<i class="fa fa-external-link-alt"></i></a></li><li>1.3
<a href="https://grafana.com/grafana/dashboards/16314-docker-container-os-node-node-exporter-cadvisor/?tab=revisions" title="<code>docker container &amp;amp; OS node(node_exporter, cadvisor)</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>docker container & OS node(node_exporter, cadvisor)</code>
<i class="fa fa-external-link-alt"></i></a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ docker run -d --name<span style=color:#f92672>=</span>cadvisor <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -p 8080:8080 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v /:/rootfs:ro <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v /var/run:/var/run:rw <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v /sys:/sys:ro <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v /var/lib/docker/:/var/lib/docker:ro <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  google/cadvisor:v0.33.0
</span></span></code></pre></div><ul><li>1.1 <font color=red>查看指标</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ http://&lt;目标节点IP&gt;:8080/metrics
</span></span></code></pre></div></blockquote></div><h4 id=数据库服务器部署mysqld_exporter>数据库服务器部署<code>mysqld_exporter</code>
<a class=header-anchor href=#%e6%95%b0%e6%8d%ae%e5%ba%93%e6%9c%8d%e5%8a%a1%e5%99%a8%e9%83%a8%e7%bd%b2mysqld_exporter></a></h4><div class="note info"><blockquote><ul><li><ol><li><a href=https://grafana.com/grafana/dashboards/17320-1-mysqld-exporter-dashboard-22-11-06/ title="<code>1 Mysqld Exporter Dashboard 22/11/06中文版</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>1 Mysqld Exporter Dashboard 22/11/06中文版</code>
<i class="fa fa-external-link-alt"></i></a></li></ol></li></ul></blockquote><ul><li><ol><li><font color=red>二进制安装</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd /opt <span style=color:#f92672>&amp;&amp;</span> wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.14.0/mysqld_exporter-0.14.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>$ tar zxvf mysqld_exporter-0.14.0.linux-amd64.tar.gz
</span></span><span style=display:flex><span>$ mv mysqld_exporter-0.14.0.linux-amd64 mysqld_exporter  
</span></span><span style=display:flex><span>$ chown -R root. mysqld_exporter  
</span></span></code></pre></div><ul><li>1.1 <code>mysqld_exporter</code><font color=red>需要连接</font><code>Mysql</code><font color=red>，首先为它创建用户并赋予所需的权限</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#66d9ef>GRANT</span> REPLICATION CLIENT, PROCESS <span style=color:#66d9ef>ON</span> <span style=color:#f92672>*</span>.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;exporter&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span> <span style=color:#66d9ef>identified</span> <span style=color:#66d9ef>by</span> <span style=color:#e6db74>&#39;123456&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>GRANT</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>ON</span> performance_schema.<span style=color:#f92672>*</span> <span style=color:#66d9ef>TO</span> <span style=color:#e6db74>&#39;exporter&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>flush</span> <span style=color:#66d9ef>privileges</span>;
</span></span></code></pre></div><ul><li>1.2 <font color=red>在数据库服务器</font><code>mysqld_exporter</code><font color=red>目录下创建</font><code>.my.cnf</code><font color=red>文件</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat &gt;/opt/mysqld_exporter/.my.cnf<span style=color:#e6db74>&lt;&lt;-EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[client]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>user=mysql_monitor
</span></span></span><span style=display:flex><span><span style=color:#e6db74>password=mysql_monitor
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><ul><li>1.3 <font color=red>编写启动文件</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat &gt;/usr/lib/systemd/system/mysqld_exporter.service <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Unit]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Description=mysql_exporter
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Documentation=https://prometheus.io/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>After=network.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Service]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Type=simple
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/opt/mysqld_exporter/mysqld_exporter --config.my-cnf=/opt/mysqld_exporter/.my.cnf 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Restart=on-failure
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Install]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>WantedBy=multi-user.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><ul><li>1.4 <font color=red>启动服务、以及设置开机自启</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ ./mysqld_exporter  --config.my-cnf<span style=color:#f92672>=</span>/opt/mysqld_exporter/.my.cnf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ systemctl enable mysqld_exporter
</span></span><span style=display:flex><span>$ systemctl start mysqld_exporter
</span></span></code></pre></div><ul><li>1.5 <font color=red>查看启动的服务端口</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ ss -unplt|grep mysqld_exporter
</span></span><span style=display:flex><span>tcp    LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>    <span style=color:#f92672>[</span>::<span style=color:#f92672>]</span>:9104               <span style=color:#f92672>[</span>::<span style=color:#f92672>]</span>:*                   users:<span style=color:#f92672>((</span><span style=color:#e6db74>&#34;mysqld_exporter&#34;</span>,pid<span style=color:#f92672>=</span>7339,fd<span style=color:#f92672>=</span>3<span style=color:#f92672>))</span>
</span></span></code></pre></div></blockquote></div><h4 id=部署pushgateway推送网关>部署<code>pushgateway</code>(推送网关)
<a class=header-anchor href=#%e9%83%a8%e7%bd%b2pushgateway%e6%8e%a8%e9%80%81%e7%bd%91%e5%85%b3></a></h4><div class="note info"><ul><li><ol><li><font color=red>二进制安装</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd /opt <span style=color:#f92672>&amp;&amp;</span> wget -c https://github.com/prometheus/pushgateway/releases/download/v1.4.3/pushgateway-1.4.3.linux-amd64.tar.gz
</span></span><span style=display:flex><span>$ tar zxf pushgateway-1.4.3.linux-amd64.tar.gz
</span></span><span style=display:flex><span>$ mv pushgateway-1.4.3.linux-amd64 pushgateway
</span></span><span style=display:flex><span>$ chown root.root pushgateway -R
</span></span></code></pre></div><ul><li>1.1 <font color=red>编写启动文件</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat &gt;/usr/lib/systemd/system/pushgateway.service <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Unit]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Description=pushgateway
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Documentation=https://prometheus.io/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>After=network.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Service]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Type=simple
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/opt/pushgateway/pushgateway
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Restart=on-failure
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Install]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>WantedBy=multi-user.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><ul><li>1.2 <font color=red>启动服务、以及设置开机自启</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ nohup ./pushgateway --config.file<span style=color:#f92672>=</span>node_exporter.yml 2&gt;&amp;<span style=color:#ae81ff>1</span> 1&gt;node_exporter.log &amp;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ systemctl enable pushgateway
</span></span><span style=display:flex><span>$ systemctl start pushgateway
</span></span></code></pre></div><ul><li>1.3 <font color=red>查看启动的服务端口</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ netstat -lntup |grep push
</span></span><span style=display:flex><span>tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::9091                 :::*                    LISTEN      5982/pushgateway
</span></span></code></pre></div></blockquote></div></div><footer class=post-footer><div class=post-tags><a href=/tags/monitor>Monitor
</a><a href=/tags/prometheus>Prometheus</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="二哥 - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="二哥 - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
Install Prometheus</li><li class=post-copyright-author><strong>本文作者： </strong>二哥</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://erge.blog/systems/linux/monitor/install-prometheus/ title="Install Prometheus">https://erge.blog/systems/linux/monitor/install-prometheus/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i>
</span><span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/atom.xml><span class=icon><i class="fa fa-rss"></i>
</span><span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/systems/linux/monitor/configure-prometheus/ rel=next title="Configure Prometheus"><i class="fa fa-chevron-left"></i> Configure Prometheus</a></div><div class="post-nav-prev post-nav-item"><a href=/systems/linux/monitor/configure-open-falcon/ rel=prev title="Configure Open Falcon">Configure Open Falcon
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div><div class=comment-switch><span class=first-comment>Giscus</span>
<span class=switch-btn></span>
<span class=second-comment>Waline</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=waline-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2024
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>二哥</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.125.4 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>粤ICP备 18047355-1 号</a>
<img src=/imgs/gongan.png alt=沪公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011402009770" target=_blank>沪公网安备 31011402009770 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel>
</a><a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云>
</a><a target=_blank href=https://webify.cloudbase.net title=Webify>Webify
</a><span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script><script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://erge.blog/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.b0c78e5a4df586ee46d02716ffa91a4a322e56763e04e91eb2ba052c9469ed02.js defer></script></body></html>