<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.125.4"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="Configure Open Falcon"><meta itemprop=description content="Configure-Open-Falcon"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://erge.blog/imgs/s2-1.jpg"><meta itemprop=keywords content="Monitor,Open Falcon"><meta property="og:type" content="article"><meta property="og:title" content="Configure Open Falcon"><meta property="og:description" content="Configure-Open-Falcon"><meta property="og:image" content="/imgs/s2-1.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://erge.blog/systems/linux/monitor/configure-open-falcon/"><meta property="og:site_name" content="二哥"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="二哥"><meta property="article:published_time" content="2022-11-29 21:27:23 +0800 CST"><meta property="article:modified_time" content="2022-11-29 21:27:23 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.0d420b6f564e6674edd4354ea71c0458a83f95ad464a75114b23d72515b1456c.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"configure-open-falcon","permalink":"https://erge.blog/systems/linux/monitor/configure-open-falcon/","title":"Configure Open Falcon","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>Configure Open Falcon - 二哥</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>二哥</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Linux、Kubernetes、Docker、Python、CI/CD、Jenkins、Mysql、Nginx、Gitlab、Ansible、Zabbix</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-Home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-th hvr-icon"></i>分类</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>0</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-tools"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-tools hvr-icon"></i>工具</a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>站点示例</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-Commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#配置open-falcon>配置<code>Open-falcon</code></a><ul><li><a href=#nodata配置><code>Nodata</code>配置</a></li><li><a href=#报警函数说明>报警函数说明</a></li><li><a href=#screen的使用>screen的使用</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=二哥 src=/imgs/img-lazy-loading.gif data-src=/imgs/s2-1.jpg><p class=site-author-name itemprop=name>二哥</p><div class=site-description itemprop=description>The man who has made up his mind to win will never say impossible – Napoleon Bonaparte</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>0</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>51</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>150</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=qq%e5%8f%b7 title="QQ → qq号" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-qq fa-fw hvr-icon"></i>
QQ
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/lisenhui title="知乎 → https://www.zhihu.com/people/lisenhui" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=qq@qq.com title="E-Mail → qq@qq.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://weibo.com/yourname title="Weibo → https://weibo.com/yourname" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-weibo fa-fw hvr-icon"></i>
Weibo
</a></span><span class=links-of-social-item><a href="https://www.youtube.com/watch?v=RgKAFK5djSk" title="Youtube → https://www.youtube.com/watch?v=RgKAFK5djSk" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
Youtube
</a></span><span class=links-of-social-item><a href=https://github.com/elkan1788 title="Github → https://github.com/elkan1788" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/hugo-next rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://erge.blog/systems/linux/monitor/configure-open-falcon/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/s2-1.jpg"><meta itemprop=name content="二哥"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="二哥"><meta itemprop=description content="The man who has made up his mind to win will never say impossible – Napoleon Bonaparte"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Configure Open Falcon"><meta itemprop=description content="Configure-Open-Falcon"></span><header class=post-header><h1 class=post-title itemprop="name headline">Configure Open Falcon
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/Systems/Linux/Monitor/Configure-Open-Falcon.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2022-11-29 21:27:23 +0800 CST" itemprop="dateCreated datePublished" datetime="2022-11-29 21:27:23 +0800 CST">2022-11-29
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/monitor itemprop=url rel=index><span itemprop=name>Monitor</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>3956</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>8分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/systems/linux/monitor/configure-open-falcon/><i class="fa fa-sync fa-spin"></i>
</span></span><span class=post-meta-item title><span class=post-meta-item-icon><i class="far fa-comments"></i>
</span><span class=post-meta-item-text title=评论>评论：
</span><span id=comments-count class=waline-comment-count data-path=/systems/linux/monitor/configure-open-falcon/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=配置open-falcon>配置<code>Open-falcon</code>
<a class=header-anchor href=#%e9%85%8d%e7%bd%aeopen-falcon></a></h2><div class="note info"><ul><li><ol><li><font color=red>查看监控数据</font></li></ol></li></ul><blockquote><ul><li><p>1.1
<a href=https://www.cnblogs.com/kevingrace/p/5570488.html title="<code>Linux</code>下<code>smokeping</code>网络监控环境部署记录" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Linux</code>下<code>smokeping</code>网络监控环境部署记录
<i class="fa fa-external-link-alt"></i></a></p></li><li><p>1.2 <code>agent</code>只要部署到机器上，并且配置好了<code>heartbeat</code>和<code>transfer</code>就自动采集数据了，我们就可以去<code>dashboard</code>上面搜索监控数据查看了。<code>dashboard</code>是个<code>web</code>项目，浏览器访问之。左侧输入<code>endpoint</code>搜索，<code>endpoint</code>是什么？应该用什么搜索？对于<code>agent</code>采集的数据<code>endpoint</code>都是机器名，去目标机器上执行<code>hostname</code>，看到的输出就是endpoint，拿着<code>hostname</code>去搜索。</p></li><li><p>1.3 选中前面的复选框，点击“查看<code>counter</code>列表”，可以列出隶属于这个<code>endpoint</code>的<code>counter</code>假如我们要查看<code>cpu.busy</code>，在<code>counter</code>搜索框中输入<code>cpu</code>并回车。看到<code>cpu.busy</code>了吧，点击，会看到一个新页面，图表中就是这个机器的<code>cpu.busy</code>的近一小时数据了，想看更长时间的？右上角有个小三角，展开菜单，可以选择更长的时间跨度</p></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/dashboard.png alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/dashboard-cpu.png alt></p></blockquote><ul><li><ol start=2><li><font color=red>配置报警策略</font></li></ol></li></ul><blockquote><ul><li><p>2.1 <font color=red>配置报警接收人</font></p><p><code>falcon</code>的报警接收人不是一个具体的手机号，也不是一个具体的邮箱，因为手机号、邮箱都是容易发生变化的，如果变化了去修改所有相关配置那就太麻烦了。我们把用户的联系信息维护在一个叫 <code>帐户/Profile</code> 里，以后如果要修改手机号、邮箱，只要修改自己的帐户信息即可。报警接收人也不是单个的人，而是一个组（<code>Teams</code>），比如<code>falcon</code>这个系统的任何组件出问题了，都应该发报警给<code>falcon</code>的运维和开发人员，发给<code>falcon</code>这个团队，这样一来，新员工入职只要加入<code>falcon</code>这个<code>Team</code>即可；员工离职，只要从<code>falcon</code>这个<code>Team</code>删掉即可。</p></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/dashboard-profile.png alt></p><ul><li>2.2 <font color=red>添加报警组，添加成员</font></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/dashboard-group.png alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/dashboard-group-1.png alt></p></blockquote><ul><li><ol start=3><li><font color=red>创建</font><code>HostGroup</code></li></ol></li></ul><blockquote><p>比如我们要对<code>falcon-judge</code>这个组件做端口监控，那首先创建一个<code>HostGroup</code>，把所有部署了<code>falcon-judge</code>这个模块的机器都塞进去，以后要扩容或下线机器的时候直接从这个<code>HostGroup</code>增删机器即可，报警策略会自动生效、失效。咱们为这个<code>HostGroup</code>取名为：<code>sa.dev.falcon.judge</code>，这个名称有讲究，<code>sa</code>是我们部门，<code>dev</code>是我们组，<code>falcon</code>是项目名，<code>judge</code>是组件名，传达出了很多信息，这样命名比较容易管理，推荐大家这么做</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/hostgroups.png alt></p><p>在往组里加机器的时候如果报错，需要检查<code>portal</code>的数据库中<code>host</code>表，看里边是否有相关机器。那<code>host</code>表中的机器从哪里来呢？<code>agent</code>有个<code>heartbeat(hbs)</code>的配置，<code>agent</code>每分钟会发心跳给<code>hbs</code>，把自己的<code>ip</code>、<code>hostname</code>、<code>agent version</code>等信息告诉<code>hbs</code>，<code>hbs</code>负责写入<code>host</code>表。如果<code>host</code>表中没数据，需要检查这条链路是否通畅</p></blockquote><ul><li><ol start=4><li><font color=red>创建策略模板</font></li></ol></li></ul><blockquote><p><code>portal</code>最上面有个<code>Templates</code>链接，这就是策略模板管理的入口。我们进去之后创建一个模板，名称姑且也叫：<code>sa.dev.falcon.judge.tpl</code>，与<code>HostGroup</code>名称相同，在里边配置一个端口监控，通常进程监控有两种手段，一个是进程本身是否存活，一个是端口是否在监听，此处我们使用端口监控</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/template.png alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/template-1.png alt></p><p>右上角那个加号按钮是用于增加策略的，一个模板中可以有多个策略，此处我们只添加了一个。下面可以配置报警接收人，此处填写的是<code>falcon</code>，这是之前在<code>UIC</code>中创建的<code>Team</code>。</p></blockquote><ul><li><ol start=5><li><font color=red>将</font><code>HostGroup</code><font color=red>与模板绑定</font></li></ol></li></ul><blockquote><p>一个模板是可以绑定到多个<code>HostGroup</code>的，现在我们重新回到<code>HostGroups</code>页面，找到<code>sa.dev.falcon.judge</code>这个<code>HostGroup</code>，右侧有几个超链接，点击【templates】进入一个新页面，输入模板名称，绑定一下就行了</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/hostgroups-tempates.png alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/hostgroups-tempates-1.png alt></p></blockquote><ul><li><ol start=6><li><font color=red>补充</font></li></ol></li></ul><blockquote><ul><li>6.1 上面步骤做完了，也就配置完了。如果<code>judge</code>组件宕机，端口不再监听了，就会报警。不过大家不要为了测试报警效果，直接把<code>judge</code>组件给干掉了，因为<code>judge</code>本身就是负责判断报警的，把它干掉了，那就没法判断了……所以说<code>falcon</code>现在并不完善，没法用来监控本身的组件。为了测试，大家可以修改一下端口监控的策略配置，改成一个没有在监听的端口，这样就触发报警了</li><li>6.2 上面的策略只是对<code>falcon-judge</code>做了端口监控，那如果我们要对<code>falcon</code>这个项目的所有机器加一些负载监控，应该如何做呢？</li><li>6.3 创建一个<code>HostGroup：sa.dev.falcon</code>，把所有<code>falcon</code>的机器都塞进去</li><li>6.4 创建一个模板：<code>sa.dev.falcon.common</code>，添加一些像<code>ping</code>, <code>df.bytes.free.percent</code>, <code>load.5min</code>等策略</li><li>6.5 将<code>sa.dev.falcon.common</code>绑定到<code>sa.dev.falcon</code>这个<code>HostGroup</code></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/template-2.png alt></p></blockquote><ul><li><ol start=7><li><font color=red>配置策略表达式</font></li></ol></li></ul><blockquote><ul><li>7.1 <font color=red>策略表达式，即</font><code>expression</code></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/expressions.png alt></p><p>上例中的配置传达出的意思是：<code>endpoint=aggregator</code>并且<code>metric=cpu.busy</code>的所有的监控指标，只要连续<code>3</code>次<code>>= 0.5</code>则报警给<code>falcon-test1</code>这个报警组。</p><p><code>expression</code>无需绑定到<code>HostGroup</code>，<code>enjoy it</code></p></blockquote></div><h3 id=nodata配置><code>Nodata</code>配置
<a class=header-anchor href=#nodata%e9%85%8d%e7%bd%ae></a></h3><div class="note info"><blockquote><p>使用<code>Nodata</code>，需要进行两个配置: <code>Nodata</code>配置和策略配置。下面，我们以一个例子，讲述如何使用<code>Nodata</code>提供的服务</p></blockquote><ul><li><ol><li><font color=red>用户需求</font></li></ol></li></ul><blockquote><p>当机器分组<code>cop.xiaomi_owt.inf_pdl.falcon</code>下的所有机器，其采集指标<code>agent.alive</code> 上报中断时，通知用户</p></blockquote><ul><li><ol start=2><li><code>nodata</code><font color=red>配置</font></li></ol></li></ul><blockquote><ul><li>2.1 <font color=red>进入</font><code>Nodata</code><font color=red>配置主页，可以看到</font><code>Nodata</code><font color=red>配置列表</font></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/nodata.png alt></p><p><font color=red>点击右上角的添加按钮，添加</font><code>nodata</code><font color=red>配置</font></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/nodata-1.png alt></p><p><font color=red>进行完上述配置后，分组</font><code>cop.xiaomi_owt.inf_pdl.falcon</code><font color=red>下的所有机器，其采集项</font> <code>agent.alive</code><font color=red>上报中断后，</font><code>nodata</code><font color=red>服务就会补发一个取值为</font><code>-1.0</code>、<code>agent.alive</code><font color=red>的监控数据给监控系统</font></p></blockquote><ul><li><ol start=3><li><font color=red>策略配置</font></li></ol></li></ul><blockquote><p>配置了<code>Nodata</code>后，如果有数据上报中断的情况，<code>Nodata</code>配置中的默认值就会被上报。我们可以针对这个默认值，设置报警；只要收到了默认值，就认为发生了数据上报的中断（如果你设置的默认值，可能与正常上报的数据相等，那么请修改你的<code>Nodata</code>配置、使默认值有别于正常值）。将此策略，绑定到分组<code>cop.xiaomi_owt.inf_pdl.falcon</code>即可。</p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/template-3.png alt></p></blockquote><ul><li><ol start=4><li><font color=red>注意事项</font></li></ol></li></ul><blockquote><ul><li>4.1 配置名称<code>name</code>，要全局唯一。这是为了方便<code>Nodata</code>配置的管理。</li><li>4.2 监控实例<code>endpoint</code>, 可以是机器分组、机器名或者其他 这三种类型，只能选择其中的一种。同一类型，支持多个记录，但建议不超过5个，多条记录换行分割、每行一条记录。选择机器分组时，系统会帮忙展开成具体机器名，支持动态生效。监控实体不是机器名时，只能选择“其他”类型。</li><li>4.3 监控指标<code>metric</code>。</li><li>4.4 数据标签<code>tags</code>，多个<code>tag</code>要用逗号隔开。必须填写完整的<code>tags</code>串，因为<code>nodata</code>会按照此<code>tags</code>串，去完全匹配、筛选监控数指标项。</li><li>4.5 数据类型<code>type</code>，只支持原始值类型<code>GAUGE</code>。因为，<code>nodata</code>只应该监控 &ldquo;特征指标&rdquo;(如<code>agent.alive</code>)，&ldquo;特征指标"都是<code>GAUGE</code>类型的</li><li>4.6 采集周期<code>step</code>，单位是秒。必须填写 完整<code>&</code>真实<code>step</code>。该字段不完整 或者 不真实，将会导致<code>nodata</code>监控的误报、漏报。</li><li>4.7 补发值<code>default</code>，必须有别于上报的真实数据。比如，<code>cpu.idle</code>的取值范围是[0,100]，那么它的<code>nodata</code>默认取值 只能取小于<code>0</code>或者大于<code>100</code>的值。否则，会发生误报、漏报</li></ul></blockquote></div><h3 id=报警函数说明>报警函数说明
<a class=header-anchor href=#%e6%8a%a5%e8%ad%a6%e5%87%bd%e6%95%b0%e8%af%b4%e6%98%8e></a></h3><div class="note infot"><blockquote><ul><li><ol><li>说明：<code>#</code>后面的数字的最大值，即在<code>judge</code>内存中保留最近几个点，是支持自定义的</li></ol></li></ul><blockquote><ul><li>1.1 <code>all(#3)</code>: 最新的3个点都满足阈值条件则报警</li><li>1.2 <code>max(#3)</code>: 对于最新的3个点，其最大值满足阈值条件则报警</li><li>1.3 <code>min(#3)</code>: 对于最新的3个点，其最小值满足阈值条件则报警</li><li>1.4 <code>sum(#3)</code>: 对于最新的3个点，其和满足阈值条件则报警</li><li>1.5 <code>avg(#3)</code>: 对于最新的3个点，其平均值满足阈值条件则报警</li><li>1.6 <code>diff(#3)</code>: 拿最新push上来的点（被减数），与历史最新的3个点（3个减数）相减，得到3个差，只要有一个差满足阈值条件则报警</li><li>1.7 <code>pdiff(#3)</code>: 拿最新push上来的点，与历史最新的3个点相减，得到3个差，再将3个差值分别除以减数，得到3个商值，只要有一个商值满足阈值则报警</li><li>1.8 <code>lookup(#2,3)</code>: 最新的3个点中有2个满足条件则报警；</li><li>1.9 <code>stddev(#7) = 3</code>：离群点检测函数，取最新 <strong>7</strong> 个点的数据分别计算得到他们的标准差和均值，分别计为 σ 和 μ，其中当前值计为 X，那么当 X 落在区间 [μ-3σ, μ+3σ] 之外时，则认为当前值波动过大，触发报警；更多请参考3-sigma算法：https://en.wikipedia.org/wiki/68%E2%80%9395%E2%80%9399.7_rule。</li></ul></blockquote><ul><li><ol start=2><li>最常用的就是<code>all</code>函数了，比如<code>cpu.idle</code> <code>all(#3) &lt; 5</code>，表示<code>cpu.idle</code>的值连续3次小于5%则报警。</li></ol></li><li><ol start=3><li><code>lookup</code>为非连续性报警函数，适用于在一定范围内容忍监控指标抖动的场景，比如某个主机的<code>cpu.busy</code>忽高忽低，使用<code>all(#1)>80</code>明显过于严格，会产生大量报警干扰视线，使用<code>all(#3)>80</code>则连续三次偏高的概率很小，可能永远不会触发报警，不能帮助我们发现系统的不稳定，那么如果使用<code>lookup(#3,5)</code>，我们就可以知道<code>cpu.busy</code>最近抖动频繁，超过了我们容忍的界线。</li></ol></li><li><ol start=4><li>新增 <code>stddev</code> 函数，基于高斯分布的离群点检测方式，比如<code>cpu.idle</code> <code>stddev(#5) = 3</code> ，表示获取<code>cpu.idle</code>的历史5个点数据，计算得到他们的标准差和均值，分别计为 σ 和 μ，看其是否分布在<code>(μ-3σ,μ+3σ)</code>范围之内，如果不在范围之内则报警。</li></ol></li></ul></blockquote></div><h3 id=screen的使用>screen的使用
<a class=header-anchor href=#screen%e7%9a%84%e4%bd%bf%e7%94%a8></a></h3><div class="note info"><blockquote><ul><li><ol><li>我们可以使用<code>screen</code>提前将图像定制好，而不用每次都去搜索出图，这样就实现了类似的cacti图像展示功能。</li></ol></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/screen.jpg alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/screen-falcon.jpg alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/screen-1.jpg alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/screen-2.jpg alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/screen-3.jpg alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/screen-4.jpg alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/screen-5.jpg alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/screen-6.jpg alt></p><p><font color=red>注：</font><code>graph</code><font color=red>可以加多个</font></p></blockquote></div></div><footer class=post-footer><div class=post-tags><a href=/tags/monitor>Monitor
</a><a href=/tags/open-falcon>Open Falcon</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="二哥 - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="二哥 - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
Configure Open Falcon</li><li class=post-copyright-author><strong>本文作者： </strong>二哥</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://erge.blog/systems/linux/monitor/configure-open-falcon/ title="Configure Open Falcon">https://erge.blog/systems/linux/monitor/configure-open-falcon/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i>
</span><span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/atom.xml><span class=icon><i class="fa fa-rss"></i>
</span><span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/systems/linux/monitor/install-prometheus/ rel=next title="Install Prometheus"><i class="fa fa-chevron-left"></i> Install Prometheus</a></div><div class="post-nav-prev post-nav-item"><a href=/systems/linux/monitor/install-open-falcon/ rel=prev title="Install Open Falcon">Install Open Falcon
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div><div class=comment-switch><span class=first-comment>Giscus</span>
<span class=switch-btn></span>
<span class=second-comment>Waline</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=waline-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2024
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>二哥</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.125.4 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>粤ICP备 18047355-1 号</a>
<img src=/imgs/gongan.png alt=沪公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011402009770" target=_blank>沪公网安备 31011402009770 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel>
</a><a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云>
</a><a target=_blank href=https://webify.cloudbase.net title=Webify>Webify
</a><span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script><script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://erge.blog/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.b0c78e5a4df586ee46d02716ffa91a4a322e56763e04e91eb2ba052c9469ed02.js defer></script></body></html>