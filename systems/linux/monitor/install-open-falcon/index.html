<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.125.4"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="Install Open Falcon"><meta itemprop=description content="Install-Open-Falcon"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://erge.blog/imgs/s2-1.jpg"><meta itemprop=keywords content="Monitor,Open Falcon"><meta property="og:type" content="article"><meta property="og:title" content="Install Open Falcon"><meta property="og:description" content="Install-Open-Falcon"><meta property="og:image" content="/imgs/s2-1.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://erge.blog/systems/linux/monitor/install-open-falcon/"><meta property="og:site_name" content="二哥"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="二哥"><meta property="article:published_time" content="2022-11-29 19:44:52 +0800 CST"><meta property="article:modified_time" content="2022-11-29 19:44:52 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.0d420b6f564e6674edd4354ea71c0458a83f95ad464a75114b23d72515b1456c.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"install-open-falcon","permalink":"https://erge.blog/systems/linux/monitor/install-open-falcon/","title":"Install Open Falcon","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>Install Open Falcon - 二哥</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>二哥</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Linux、Kubernetes、Docker、Python、CI/CD、Jenkins、Mysql、Nginx、Gitlab、Ansible、Zabbix</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-Home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-th hvr-icon"></i>分类</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>0</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-tools"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-tools hvr-icon"></i>工具</a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>站点示例</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-Commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#部署open-falcon服务>部署<code>Open Falcon</code>服务</a><ul><li><a href=#open-falcon架构><code>Open-falcon</code>架构</a></li><li><a href=#open-falcon部署><code>Open-falcon</code>部署</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=二哥 src=/imgs/img-lazy-loading.gif data-src=/imgs/s2-1.jpg><p class=site-author-name itemprop=name>二哥</p><div class=site-description itemprop=description>The man who has made up his mind to win will never say impossible – Napoleon Bonaparte</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>0</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>51</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>150</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=qq%e5%8f%b7 title="QQ → qq号" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-qq fa-fw hvr-icon"></i>
QQ
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/lisenhui title="知乎 → https://www.zhihu.com/people/lisenhui" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=qq@qq.com title="E-Mail → qq@qq.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://weibo.com/yourname title="Weibo → https://weibo.com/yourname" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-weibo fa-fw hvr-icon"></i>
Weibo
</a></span><span class=links-of-social-item><a href="https://www.youtube.com/watch?v=RgKAFK5djSk" title="Youtube → https://www.youtube.com/watch?v=RgKAFK5djSk" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
Youtube
</a></span><span class=links-of-social-item><a href=https://github.com/elkan1788 title="Github → https://github.com/elkan1788" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/hugo-next rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://erge.blog/systems/linux/monitor/install-open-falcon/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/s2-1.jpg"><meta itemprop=name content="二哥"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="二哥"><meta itemprop=description content="The man who has made up his mind to win will never say impossible – Napoleon Bonaparte"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Install Open Falcon"><meta itemprop=description content="Install-Open-Falcon"></span><header class=post-header><h1 class=post-title itemprop="name headline">Install Open Falcon
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/Systems/Linux/Monitor/Install-Open-Falcon.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2022-11-29 19:44:52 +0800 CST" itemprop="dateCreated datePublished" datetime="2022-11-29 19:44:52 +0800 CST">2022-11-29
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/monitor itemprop=url rel=index><span itemprop=name>Monitor</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>5829</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>12分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/systems/linux/monitor/install-open-falcon/><i class="fa fa-sync fa-spin"></i>
</span></span><span class=post-meta-item title><span class=post-meta-item-icon><i class="far fa-comments"></i>
</span><span class=post-meta-item-text title=评论>评论：
</span><span id=comments-count class=waline-comment-count data-path=/systems/linux/monitor/install-open-falcon/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=部署open-falcon服务>部署<code>Open Falcon</code>服务
<a class=header-anchor href=#%e9%83%a8%e7%bd%b2open-falcon%e6%9c%8d%e5%8a%a1></a></h2><h3 id=open-falcon架构><code>Open-falcon</code>架构
<a class=header-anchor href=#open-falcon%e6%9e%b6%e6%9e%84></a></h3><div class="note infot"><ul><li><ol><li><font color=red>介绍</font></li></ol></li></ul><blockquote><p><code>OpenFalcon</code>是一款企业级、高可用、可扩展的开源监控解决方案。此项目最初由小米公司发起，小米运维团队从互联网公司的需求出发，根据多年的运维经验，结合<code>SRE</code>、<code>SA</code>、<code>DEVS</code>的使用经验和反馈，开发的一套面向互联网的企业级开源监控产品，最新版本为<code>v2.0</code>。目前有几十家公司不同程度使用<code>OpenFalcon</code>作为分布式系统的监控解决方案。</p></blockquote><ul><li><ol start=2><li><font color=red>优点</font></li></ol></li></ul><blockquote><ul><li>2.1 采集器自动发现，支持<code>falcon-agent</code>、<code>snmp</code>、支持用户主动push数据、用户自定义插件</li><li>2.2 支持每个周期上亿次的数据采集、告警判定、历史数据存储和查询</li><li>2.3 高效的分区、支持监控策略模板、模板继承和覆盖、多种告警方式、支持告警回调</li><li>2.4 单节点能支持200万<code>metric</code>的上报、归档、存储</li><li>2.5 其存储采用<code>rrdtool</code>归档，秒级返回上百个<code>metric</code>一年的历史数据</li><li>2.6 多维度的数据展示，可由用户自定义<code>Screen</code></li><li>2.7 通过各种插件目前支持<code>Linux</code>、<code>Windows</code>、<code>Mysql</code>、<code>Redis</code>、<code>Memache</code>、<code>RabbitMQ</code>和交换机监控</li></ul></blockquote><ul><li><ol start=3><li><font color=red>监控范围</font></li></ol></li></ul><blockquote><ul><li>3.1 <code>OpenFalcon</code>支持系统基础监控，第三方服务监控，<code>JVM</code>监控，业务应用监控</li><li>3.2 基础监控指<code>Linux</code>平台的系统指标监控，包括<code>CPU</code>、<code>Load</code>、内存、磁盘、<code>IO</code>、网络等，这些指标由<code>OpenFalcon</code>的<code>agent</code>节点直接支持，无需插件</li><li>3.3 <code>JVM</code>监控主要通过插件完成，插件通过<code>JVM</code>开放的<code>JMX</code>通信端口，获取到<code>JVM</code>参数指标，并推送到<code>agent</code>节点，再由<code>agent</code>发送到<code>OpenFalcon</code></li><li>3.4 第三方服务监控指一些常见服务监控，包括<code>MySQL</code>、<code>Redis</code>、<code>Nginx</code>等，<code>OpenFalcon</code>官网提供了很多第三方服务的监控插件，也可以自己实现插件，定义采集指标。而采集到的指标，也是通过插件先发送给<code>agent</code>，再由agent发送到<code>OpenFalcon</code></li><li>3.5 业务应用监控主要是监控企业自主开发的应用服务。由企业根据业务需要定义采集指标，自实现插件。将获取到的采集指标发送到<code>agen</code>t，再由<code>agent</code>发送到<code>OpenFalcon</code></li></ul></blockquote><ul><li><ol start=4><li><code>openfalcon</code><font color=red>数据流向</font></li></ol></li></ul><blockquote><ul><li>4.1 常见的<code>OpenFalcon</code>包含<code>transfer</code>、<code>hbs</code>、<code>agent</code>、<code>judge</code>、<code>graph</code>、<code>API</code>几个进程。但没有提供用户界面。用户界面的解决方案是<code>OpenFalcon</code>官方提供的<code>Dashboard</code>，由<code>python</code>编写的一个Web服务。<code>Dashboard</code>调用<code>OpenFalcon</code>的<code>API</code>节点<code>REST</code>，完成用户认证，查询历史等操作。</li><li>4.2 以下是各个节点的数据流向图，主数据流向是<code>agent</code>-><code>transfer</code>-><code>judge/graph</code>：</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/transfer.jpg alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/transfer-1.png alt></p></blockquote><ul><li><ol start=5><li><font color=red>模块</font></li></ol></li></ul><blockquote><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/transfer-2.jpg alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/transfer-3.png alt></p><p><img src=/imgs/img-lazy-loading.gif data-src=https://raw.githubusercontent.com/usermice/images/master/monitor_server/Open-Falcon_Server/transfer-4.png alt></p></blockquote><ul><li><ol start=6><li><font color=red>组件</font></li></ol></li></ul><blockquote><ul><li><p>6.1 <code>Agent</code>: 是用于采集被部署机器上的监控数据，每隔<code>60</code>秒<code>push</code>给<code>Transfer</code>模块。<code>agent</code>与<code>Transfer</code>建立的是长连接（毕竟每分钟发送一次，短连接开销太大）。每台要被监控的机器都要部署该模块，它消耗的资源很小，不用太担心这一点。同时<code>agent</code>提供了一个<code>http</code>接口<code>/v1/push</code>用于接收用户手工<code>push</code>的一些数据，然后通过长连接迅速转发给<code>Transfer</code>，在实际使用中，我们对于某些自己项目接口的监控就是通过此方式来进行上传的</p></li><li><p>6.2 <code>transfer</code>： 是数据转发服务。它接收<code>agent</code>上报的数据，然后按照哈希规则进行数据分片、并将分片后的数据分别<code>push</code>给<code>graph</code>和<code>judge</code>等组件</p></li><li><p>6.3 <code>graph</code>是存储绘图数据的组件。<code>graph</code>组件接收<code>transfer</code>组件推送上来的监控数据，同时处理<code>query</code>组件的查询请求、返回绘图数据</p></li><li><p>6.4 <code>query</code>组件，提供统一的绘图数据查询入口。<code>query</code>组件接收查询请求，根据一致性哈希算法去相应的<code>graph</code>实例查询不同监控项的数据，然后汇总拿到的数据，最后统一返回给用户</p></li><li><p>6.5 <code>dashboard</code>是面向用户的查询界面。在这里，用户可以看到<code>push</code>到<code>graph</code>中的所有数据，并查看其趋势图</p></li><li><p>6.6 邮件短信发送模块，这个组件没有代码，需要各个公司自行提供。监控系统产生报警事件之后需要发送报警邮件或者报警短信，各个公司可能有自己的邮件服务器，有自己的邮件发送方法；有自己的短信通道，有自己的短信发送方法。<code>falcon</code>为了适配各个公司，在接入方案上做了一个规范，需要各公司提供<code>http</code>的短信和邮件发送接口</p></li><li><p>6.7 <code>Sender</code>： 6 中提到各个公司会提供邮件、短信发送接口，但是产生了报警之后就立马调用这些接口发送报警，是不合适的。因为这些接口可能无法处理巨大的并发量，而且接口本身的处理速度可能也比较慢，这会拖慢我们的处理逻辑。所以一个比较好的方式是把邮件、短信发送这个事情做成异步的。<code>Sender</code>提供一个短信<code>redis</code>队列，提供一个邮件<code>redis</code>队列。当有短信要发送的时候，直接将短信内容写入短信<code>redis</code>队列即可，当有邮件要发送的时候，直接将邮件内容写入邮件<code>redis</code>队列。针对每个队列，后面有一个预设大小的<code>worker</code>线程池来处理。有了队列的缓冲，即便某个时刻产生了大量报警，造成邮件、短信发送的突发流量，也不会对邮件、短信发送接口造成冲击</p></li><li><p>6.8 <code>Fe</code>这是<code>Go</code>版本的<code>UIC</code>，也是一个统一的<code>web</code>入口，因为监控组件众多，记忆<code>ip</code>、<code>port</code>去访问还是比较麻烦。<code>fe</code>像是一个监控的<code>hao123.</code>就是为了用户使用方便配置的一个web浏览器操作界面</p></li><li><p>6.9 <code>Portal</code>是用来配置报警策略的,和<code>HBS</code>一起描述</p></li><li><p>6.10 <code>HBS(Heartbeat Server)</code>：</p></li></ul><blockquote><ul><li>6.10.1 <code>Portal</code>的数据库中有一个<code>host</code>表，维护了公司所有机器的信息，比如<code>hostname</code>、<code>ip</code>等等。<code>HBS</code>第一个功能：<code>agent</code>发送心跳信息给<code>HBS</code>的时候，会把<code>hostname</code>、<code>ip</code>、<code>agent</code> <code>version</code>、<code>plugin version</code>等信息告诉<code>HBS</code>，<code>HBS</code>负责更新<code>host</code>表</li><li>6.10.2 <code>Agent</code>只采集用户配置的监控项。比如用户配置了对某个机器<code>80</code>端口的监控，我们才会去采集这个机器<code>80</code>端口的存活性。那<code>agent</code>如何知道自己应该采集哪些端口和进程呢？向<code>HBS</code>要，<code>HBS</code>去读取<code>Portal</code>的数据库，返回给<code>agent</code></li><li>6.10.3 <code>Judge</code>需要获取所有的报警策略，让<code>Judge</code>去读取<code>Portal</code>的<code>DB</code>么？不太好。因为<code>Judge</code>的实例数目比较多，如果公司有几十万机器，<code>Judge</code>实例数目可能会是几百个，几百个<code>Judge</code>实例去访问<code>Portal</code>数据库，也是一个比较大的压力。既然<code>HBS</code>无论如何都要访问<code>Portal</code>的数据库了，那就让<code>HBS</code>去获取所有的报警策略缓存在内存里，然后<code>Judge</code>去向<code>HBS</code>请求。这样一来，对<code>Portal DB</code>的压力就会大大减小</li></ul></blockquote><ul><li>6.11 <code>Judge Judge</code>用于告警判断，<code>agent</code>将数据<code>push</code>给<code>Transfer</code>，<code>Transfer</code>不但会转发给<code>Graph</code>组件来绘图，还会转发给<code>Judge</code>用于判断是否触发告警。因为监控系统数据量比较大，一台机器显然是搞不定的，所以必须要有个数据分片方案。<code>Transfer</code>通过一致性哈希来分片，每个<code>Judge</code>就只需要处理一小部分数据就可以了。所以判断告警的功能不能放在直接的数据接收端<code>Transfer</code>，而应该放到<code>Transfer</code>后面的组件里，就有了<code>Judge.</code></li><li>6.12 <code>Links</code>是为报警合并功能写的组件。如果你不想使用报警合并功能，这个组件是无需安装的。一般不会用到</li><li>6.13 <code>alarm</code>模块是处理报警<code>event</code>的，<code>judge</code>产生的报警<code>event</code>写入<code>redis</code>，<code>alarm</code>从<code>redis</code>读取处理，报警<code>event</code>的处理逻辑并非仅仅是发邮件、发短信这么简单。为了能够自动化对<code>event</code>做处理，<code>alarm</code>需要支持在产生<code>event</code>的时候回调用户提供的接口；有的时候报警短信、邮件太多，对于优先级比较低的报警，希望做报警合并，这些逻辑都是在<code>alarm</code>中做的</li></ul></blockquote><ul><li><ol start=7><li><font color=red>流程</font></li></ol></li></ul><blockquote><ul><li>7.1 目标服务器运行<code>agent</code></li><li>7.2 <code>agent</code>采集各类监控项数值，传给<code>transfer</code></li><li>7.3 <code>transfer</code>校验和整理监控项数值，做一致性<code>hash</code>分片，传给对应的<code>judge</code>模块以验证是否触发告警</li><li>7.4 <code>transfer</code>整理监控项数值，做一致性<code>hash</code>分片，传输给<code>graph</code>以进行数据的存储</li><li>7.5 <code>judge</code>根据具体报警策略或阈值进行告警判断，如触发告警则组装告警<code>event</code>事件，写入缓存队列</li><li>7.6 <code>alarm</code>和<code>sender</code>根据<code>event</code>事件中的判定结果，执行<code>event</code>，像用户组发送短信或邮件</li><li>7.7 <code>graph</code>收到监控项数据后，将数据存储成<code>RRD</code>文件格式，进行归档，并提供查询接口</li><li>7.8 <code>query</code>将调用<code>graph</code>的查询接口，将监控数据传送到<code>dashboard</code>以进行页面展示</li><li>7.9 <code>dashboard</code>则渲染页面，展示曲线报表图等</li><li>7.10 <code>portal</code>提供页面供用户配置机器分组、报警策略、表达式、<code>nodata</code>等配置</li></ul></blockquote></div><h3 id=open-falcon部署><code>Open-falcon</code>部署
<a class=header-anchor href=#open-falcon%e9%83%a8%e7%bd%b2></a></h3><div class="note info"><blockquote><ul><li><ol><li><code>Open-Falcon</code><font color=red>为前后端分离的架构，包含</font><code>backend</code><font color=red>和</font><code>frontend</code><font color=red>两部分</font></li></ol></li><li><ol start=2><li><font color=red>前端(客户端)和后端(服务端)</font></li></ol></li></ul></blockquote><ul><li><ol><li><font color=red>环境准备</font></li></ol></li></ul><blockquote><ul><li>1.1 <font color=red>安装</font><code>redis</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ yum install -y redis
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 启动</span>
</span></span><span style=display:flex><span>$ redis-server &amp;
</span></span></code></pre></div><ul><li>1.2 <font color=red>装</font><code>mysql</code></li></ul><blockquote><ul><li>1.2.1 <font color=red>解压到</font><code>/usr/local</code><font color=red>目录</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ wget http://ftp.iij.ad.jp/pub/db/mysql/Downloads/MySQL-5.7/mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz
</span></span></code></pre></div><ul><li>1.2.2 <font color=red>移动至该目录</font><code>cd /usr/local/mysql</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ mv mysql-5.7.22-linux-glibc2.12-x86_64 /usr/local/mysql
</span></span></code></pre></div><ul><li>1.2.3 <font color=red><code>rpm -qa | grep mariadb</code></font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ rpm -e mariadb-libs –nodeps
</span></span></code></pre></div><ul><li>1.2.4 <font color=red>创建数据库目录</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ mkdir data
</span></span></code></pre></div><ul><li>1.2.5 <font color=red>创建</font><code>mysql</code><font color=red>系统组和系统用户并不建立家目录</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ groupadd -r mysql <span style=color:#f92672>&amp;&amp;</span> useradd -r -g mysql -s /bin/false -M mysql
</span></span></code></pre></div><ul><li>1.2.6 <font color=red>授权给</font><code>mysql</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ chown -R mysql:mysql .
</span></span></code></pre></div><ul><li>1.2.7 <font color=red>做个软链接</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ ln -s /usr/local/mysql/bin/* /usr/local/bin
</span></span></code></pre></div><ul><li>1.2.8 <font color=red>编写主配置文件</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat &gt;/etc/my.cnf<span style=color:#e6db74>&lt;&lt;-EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[mysqld]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>basedir=/usr/local/mysql
</span></span></span><span style=display:flex><span><span style=color:#e6db74>datadir=/usr/local/mysql/data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>pid-file=/usr/local/mysql/data/mysqld.pid
</span></span></span><span style=display:flex><span><span style=color:#e6db74>socket=/usr/local/mysql/mysql.sock
</span></span></span><span style=display:flex><span><span style=color:#e6db74>log-error=/usr/local/mysql/data/mysql.err
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[client]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>socket=/usr/local/mysql/mysql.sock
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><ul><li>1.2.9 <font color=red>初始化数据库</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ mysqld --initialize --user<span style=color:#f92672>=</span>mysql --basedir<span style=color:#f92672>=</span>/usr/local/mysql --datadir<span style=color:#f92672>=</span>/usr/local/mysql/data
</span></span></code></pre></div><ul><li>1.2.10 <font color=red>移动至</font><code>support-files</code><font color=red>目录下</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd support-files
</span></span></code></pre></div><ul><li>1.2.11 <font color=red>复制启动服务至</font><code>/etc/init.d/mysqld</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cp mysql.server /etc/init.d/mysqld
</span></span></code></pre></div><ul><li>1.2.12 <font color=red>启动</font><code>mysql</code><font color=red>服务</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ /etc/init.d/mysqld start
</span></span></code></pre></div><ul><li>1.2.13 <font color=red>找密码</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat /usr/local/mysql/data/mysql.err
</span></span></code></pre></div><ul><li>1.2.14 <font color=red>登录</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ mysql -uroot -p<span style=color:#e6db74>&#39;密码&#39;</span>
</span></span></code></pre></div><ul><li>1.2.15 <font color=red>修改密码</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ alter user root@localhost identified by <span style=color:#e6db74>&#39;123&#39;</span>;
</span></span></code></pre></div></blockquote><ul><li>1.3 <font color=red>初始化</font><code>mysql</code><font color=red>表结构</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd /tmp/ <span style=color:#f92672>&amp;&amp;</span> git clone https://github.com/open-falcon/falcon-plus.git 
</span></span><span style=display:flex><span>$ cd /tmp/falcon-plus/scripts/mysql/db_schema/
</span></span><span style=display:flex><span>$ mysql -h 127.0.0.1 -u root -p &lt; 1_uic-db-schema.sql
</span></span><span style=display:flex><span>$ mysql -h 127.0.0.1 -u root -p &lt; 2_portal-db-schema.sql
</span></span><span style=display:flex><span>$ mysql -h 127.0.0.1 -u root -p &lt; 3_dashboard-db-schema.sql
</span></span><span style=display:flex><span>$ mysql -h 127.0.0.1 -u root -p &lt; 4_graph-db-schema.sql
</span></span><span style=display:flex><span>$ mysql -h 127.0.0.1 -u root -p &lt; 5_alarms-db-schema.sql
</span></span><span style=display:flex><span>$ rm -rf /tmp/falcon-plus/
</span></span></code></pre></div></blockquote><ul><li><ol start=2><li><font color=red>配置</font><code>Go</code><font color=red>语言开发环境(需要<code>epel</code>源)</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ yum install golang -y
</span></span></code></pre></div><ul><li>2.1 <font color=red>查看</font><code>go</code><font color=red>的安装路径</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ find / -name go
</span></span></code></pre></div><ul><li>2.2 <font color=red>设置环境变量</font><code>GOROOT</code>和<code>GOPATH</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ export GOROOT<span style=color:#f92672>=</span>/usr/lib/golang
</span></span><span style=display:flex><span>$ export GOPATH<span style=color:#f92672>=</span>/home
</span></span></code></pre></div><ul><li>2.3 <font color=red>下载编译好的二进制版本</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ wget https://github.com/open-falcon/falcon-plus/releases/download/v0.2.1/open-falcon-v0.2.1.tar.gz
</span></span></code></pre></div></blockquote><ul><li><ol start=3><li><font color=red>启动后端</font></li></ol></li></ul><blockquote><ul><li>3.1 <font color=red>创建工作目录</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ export FALCON_HOME<span style=color:#f92672>=</span>/home/work
</span></span><span style=display:flex><span>$ export WORKSPACE<span style=color:#f92672>=</span>$FALCON_HOME/open-falcon
</span></span><span style=display:flex><span>$ mkdir -p $WORKSPACE
</span></span></code></pre></div><ul><li>3.2 <font color=red>解压二进制包</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ tar -xzvf open-falcon-v0.2.1.tar.gz -C $WORKSPACE
</span></span></code></pre></div><ul><li>3.3 <font color=red>在一台机器上启动所有的后端组件</font></li></ul><blockquote><ul><li><p>3.3.1 <font color=red>修改配置文件</font><code>cfg.json</code></p><p>部分模块依赖连接数据库，因为如果不修改配置文件，<code>aggregator</code>模块会出现无法启动，<code>graph</code>、<code>hbs</code>、<code>nodata</code>、<code>api</code>、<code>alarm</code>模块会出现开启不报错但是状态为开启失败的情况。</p><p>如果需要每个模块都能正常启动，需要将上面模块的<code>cfg.json</code>的数据库信息进行修改，需要修改配置文件所在的目录</p></li></ul><table><thead><tr><th>模块</th><th>配置文件所在路径</th></tr></thead><tbody><tr><td><code>aggregator</code></td><td><code>/home/work/aggregator/config/cfg.json</code></td></tr><tr><td><code>graph</code></td><td><code>/home/work/graph/config/cfg.json</code></td></tr><tr><td><code>hbs</code></td><td><code>/home/work/hbs/config/cfg.json</code></td></tr><tr><td><code>nodata</code></td><td><code>/home/work/nodata/config/cfg.json</code></td></tr><tr><td><code>api</code></td><td><code>/home/work/api/config/cfg.json</code></td></tr><tr><td><code>alarm</code></td><td><code>/home/work/alarm/config/cfg.json</code></td></tr></tbody></table><ul><li>3.3.2 <font color=red>启动</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd $WORKSPACE
</span></span><span style=display:flex><span>$ ./open-falcon start
</span></span><span style=display:flex><span><span style=color:#75715e># 检查所有模块的启动状况</span>
</span></span><span style=display:flex><span>$ ./open-falcon check
</span></span></code></pre></div></blockquote></blockquote><ul><li><ol start=4><li><font color=red>安装前端</font></li></ol></li></ul><blockquote><ul><li>4.1 <font color=red>创建工作目录</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ export HOME<span style=color:#f92672>=</span>/home/work
</span></span><span style=display:flex><span>$ export WORKSPACE<span style=color:#f92672>=</span>$HOME/open-falcon
</span></span><span style=display:flex><span>$ mkdir -p $WORKSPACE
</span></span><span style=display:flex><span>$ cd $WORKSPACE
</span></span></code></pre></div><ul><li>4.2 <font color=red>克隆前端组件</font><code>diamante</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd $WORKSPACE
</span></span><span style=display:flex><span>$ git clone https://github.com/open-falcon/dashboard.git
</span></span></code></pre></div><ul><li>4.3 <font color=red>安装依赖包</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ yum install -y python-virtualenv
</span></span><span style=display:flex><span>$ yum install -y python-devel
</span></span><span style=display:flex><span>$ yum install -y openldap-devel
</span></span><span style=display:flex><span>$ yum install -y mysql-devel
</span></span><span style=display:flex><span>$ yum groupinstall <span style=color:#e6db74>&#34;Development tools&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cd $WORKSPACE/dashboard/
</span></span><span style=display:flex><span>$ virtualenv ./env
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ ./env/bin/pip install -r pip_requirements.txt -i https://pypi.douban.com/simple
</span></span></code></pre></div><ul><li>4.4 <font color=red>修改配置</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>dashboard的配置文件为： <span style=color:#e6db74>&#39;rrd/config.py&#39;</span>，请根据实际情况修改
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># API_ADDR 表示后端api组件的地址</span>
</span></span><span style=display:flex><span>API_ADDR <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://127.0.0.1:8080/api/v1&#34;</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 根据实际情况，修改PORTAL_DB_*, 默认用户名为root，默认密码为&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 根据实际情况，修改ALARM_DB_*, 默认用户名为root，默认密码为&#34;&#34;</span>
</span></span></code></pre></div><ul><li>4.5 <font color=red>在生产环境启动</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ bash control start
</span></span><span style=display:flex><span><span style=color:#75715e># 停止</span>
</span></span><span style=display:flex><span>$ bash control stop
</span></span><span style=display:flex><span><span style=color:#75715e># 查看日志</span>
</span></span><span style=display:flex><span>$ Bash control tail
</span></span></code></pre></div><ul><li>4.6 <code>dashboard</code><font color=red>用户管理</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>dashbord没有默认创建任何账号包括管理账号，需要你通过页面进行注册账号。
</span></span><span style=display:flex><span>想拥有管理全局的超级管理员账号，需要手动注册用户名为root的账号（第一个帐号名称为root的用户会被自动设置为超级管理员）。
</span></span><span style=display:flex><span>超级管理员可以给普通用户分配权限管理。
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>小提示：注册账号能够被任何打开dashboard页面的人注册，所以当给相关的人注册完账号后，需要去关闭注册账号功能。只需要去修改api组件的配置文件cfg.json，将signup_disable配置项修改为true，重启api即可。当需要给人开账号的时候，再将配置选项改回去，用完再关掉即可。
</span></span></code></pre></div></blockquote><ul><li><ol start=5><li><font color=red>被监控端配置</font><code>agent</code></li></ol></li></ul><blockquote><ul><li>5.1 <code>agent</code><font color=red>需要部署到所有要被监控的机器上，比如公司有10万台机器，那就要部署10万个</font><code>agent</code>。<code>agent</code><font color=red>本身资源消耗很少，不用担心</font></li><li>5.2 <font color=red>配置说明：配置文件必须叫</font><code>cfg.json</code><font color=red>，可以基于</font><code>cfg.example.json</code><font color=red>修改</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;debug&#34;</span>: true,  	<span style=color:#75715e># 控制一些debug信息的输出，生产环境通常设置为false</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;hostname&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,  	<span style=color:#75715e># agent采集了数据发给transfer，endpoint就设置为了hostname，默认通过`hostname`获取，如果配置中配置了hostname，就用配置中的</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ip&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#75715e># agent与hbs心跳的时候会把自己的ip地址发给hbs，agent会自动探测本机ip，如果不想让agent自动探测，可以手工修改该配置</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;plugin&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;enabled&#34;</span>: false,  	<span style=color:#75715e># 默认不开启插件机制</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;dir&#34;</span>: <span style=color:#e6db74>&#34;./plugin&#34;</span>,  	<span style=color:#75715e># 把放置插件脚本的git repo clone到这个目录</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;git&#34;</span>: <span style=color:#e6db74>&#34;https://github.com/open-falcon/plugin.git&#34;</span>, <span style=color:#75715e># 放置插件脚本的git repo地址</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;logs&#34;</span>: <span style=color:#e6db74>&#34;./logs&#34;</span>  	<span style=color:#75715e># 插件执行的log，如果插件执行有问题，可以去这个目录看log</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;heartbeat&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;enabled&#34;</span>: true,  	<span style=color:#75715e># 此处enabled要设置为true</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;addr&#34;</span>: <span style=color:#e6db74>&#34;127.0.0.1:6030&#34;</span>, <span style=color:#75715e># hbs的地址，端口是hbs的rpc端口</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;interval&#34;</span>: 60,  	<span style=color:#75715e># 心跳周期，单位是秒</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;timeout&#34;</span>: <span style=color:#ae81ff>1000</span>  	<span style=color:#75715e># 连接hbs的超时时间，单位是毫秒</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;transfer&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;enabled&#34;</span>: true, 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;addrs&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;127.0.0.1:18433&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>,  	<span style=color:#75715e># transfer的地址，端口是transfer的rpc端口, 可以支持写多个transfer的地址，agent会保证HA</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;interval&#34;</span>: 60,  	<span style=color:#75715e># 采集周期，单位是秒，即agent一分钟采集一次数据发给transfer</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;timeout&#34;</span>: <span style=color:#ae81ff>1000</span>  	<span style=color:#75715e># 连接transfer的超时时间，单位是毫秒</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;http&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;enabled&#34;</span>: true,  	<span style=color:#75715e># 是否要监听http端口</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;listen&#34;</span>: <span style=color:#e6db74>&#34;:1988&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;backdoor&#34;</span>: false
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;collector&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ifacePrefix&#34;</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;eth&#34;</span>, <span style=color:#e6db74>&#34;em&#34;</span><span style=color:#f92672>]</span>,  	<span style=color:#75715e># 默认配置只会采集网卡名称前缀是eth、em的网卡流量，配置为空就会采集所有的，lo的也会采集。可以从/proc/net/dev看到各个网卡的流量信息</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;mountPoint&#34;</span>: <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;default_tags&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ignore&#34;</span>: <span style=color:#f92672>{</span>  	<span style=color:#75715e># 默认采集了200多个metric，可以通过ignore设置为不采集</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;cpu.busy&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;df.bytes.free&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;df.bytes.total&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;df.bytes.used&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;df.bytes.used.percent&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;df.inodes.total&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;df.inodes.free&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;df.inodes.used&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;df.inodes.used.percent&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;mem.memtotal&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;mem.memused&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;mem.memused.percent&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;mem.memfree&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;mem.swaptotal&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;mem.swapused&#34;</span>: true,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;mem.swapfree&#34;</span>: true
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>5.3 <font color=red>进程管理</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ ./open-falcon start agent  	<span style=color:#75715e># 启动进程</span>
</span></span><span style=display:flex><span>$ ./open-falcon stop agent  	<span style=color:#75715e># 停止进程</span>
</span></span><span style=display:flex><span>$ ./open-falcon monitor agent  	<span style=color:#75715e># 查看日志</span>
</span></span></code></pre></div><ul><li><p>5.4 <font color=red>验证</font></p><p>看var目录下的<code>log</code>是否正常，或者浏览器访问其<code>1988</code>端口。另外<code>agent</code>提供了一个<code>--check</code>参数，可以检查<code>agent</code>是否可以正常跑在当前机器上</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ ./falcon-agent --check
</span></span></code></pre></div><ul><li><p>5.5 <code>/v1/push</code><font color=red>接口</font></p><p>设计初衷是不希望用户直接连到<code>Transfer</code>发送数据，而是通过<code>agent</code>的<code>/v1/push</code>接口转发，接口使用范例：</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>ts<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>date +%s<span style=color:#e6db74>`</span>; curl -X POST -d <span style=color:#e6db74>&#34;[{\&#34;metric\&#34;: \&#34;metric.demo\&#34;, \&#34;endpoint\&#34;: \&#34;qd-open-falcon-judge01.hd\&#34;, \&#34;timestamp\&#34;: </span>$ts<span style=color:#e6db74>,\&#34;step\&#34;: 60,\&#34;value\&#34;: 9,\&#34;counterType\&#34;: \&#34;GAUGE\&#34;,\&#34;tags\&#34;: \&#34;project=falcon,module=judge\&#34;}]&#34;</span> http://127.0.0.1:1988/v1/push
</span></span></code></pre></div></blockquote></div></div><footer class=post-footer><div class=post-tags><a href=/tags/monitor>Monitor
</a><a href=/tags/open-falcon>Open Falcon</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="二哥 - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="二哥 - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
Install Open Falcon</li><li class=post-copyright-author><strong>本文作者： </strong>二哥</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://erge.blog/systems/linux/monitor/install-open-falcon/ title="Install Open Falcon">https://erge.blog/systems/linux/monitor/install-open-falcon/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i>
</span><span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/atom.xml><span class=icon><i class="fa fa-rss"></i>
</span><span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/systems/linux/monitor/configure-open-falcon/ rel=next title="Configure Open Falcon"><i class="fa fa-chevron-left"></i> Configure Open Falcon</a></div><div class="post-nav-prev post-nav-item"><a href=/systems/linux/monitor/configure-zabbix/ rel=prev title="Configure Zabbix Job">Configure Zabbix Job
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div><div class=comment-switch><span class=first-comment>Giscus</span>
<span class=switch-btn></span>
<span class=second-comment>Waline</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=waline-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2024
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>二哥</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.125.4 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>粤ICP备 18047355-1 号</a>
<img src=/imgs/gongan.png alt=沪公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011402009770" target=_blank>沪公网安备 31011402009770 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel>
</a><a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云>
</a><a target=_blank href=https://webify.cloudbase.net title=Webify>Webify
</a><span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script><script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://erge.blog/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.b0c78e5a4df586ee46d02716ffa91a4a322e56763e04e91eb2ba052c9469ed02.js defer></script></body></html>