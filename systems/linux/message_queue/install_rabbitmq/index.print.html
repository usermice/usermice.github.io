<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="Rabbitmqéƒ¨ç½² å®‰è£…RabbitMQ Celeryåˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ— RabbitMQé›†ç¾¤å®‰è£… é›†ç¾¤æœåŠ¡å™¨é…ç½® IP ä¸»æœºå èŠ‚ç‚¹å±æ€§ 192.168.150.21 rabbit-mq-01 å†…å­˜èŠ‚ç‚¹&#43;HaproxyèŠ‚ç‚¹ 192.">
    <meta name="author" content="äºŒå“¥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/s2-1.png">
    <meta name="twitter:title" content="Install_RabbitMQ :: Hugo Relearn Theme">
    <meta name="twitter:description" content="Rabbitmqéƒ¨ç½² å®‰è£…RabbitMQ Celeryåˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ— RabbitMQé›†ç¾¤å®‰è£… é›†ç¾¤æœåŠ¡å™¨é…ç½® IP ä¸»æœºå èŠ‚ç‚¹å±æ€§ 192.168.150.21 rabbit-mq-01 å†…å­˜èŠ‚ç‚¹&#43;HaproxyèŠ‚ç‚¹ 192.">
    <meta property="og:url" content="https://erge.blog/systems/linux/message_queue/install_rabbitmq/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Install_RabbitMQ :: Hugo Relearn Theme">
    <meta property="og:description" content="Rabbitmqéƒ¨ç½² å®‰è£…RabbitMQ Celeryåˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ— RabbitMQé›†ç¾¤å®‰è£… é›†ç¾¤æœåŠ¡å™¨é…ç½® IP ä¸»æœºå èŠ‚ç‚¹å±æ€§ 192.168.150.21 rabbit-mq-01 å†…å­˜èŠ‚ç‚¹&#43;HaproxyèŠ‚ç‚¹ 192.">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Systems">
    <meta property="article:published_time" content="2024-06-20T21:23:47+08:00">
    <meta property="article:modified_time" content="2024-06-20T21:23:47+08:00">
    <meta property="og:image" content="https://erge.blog/images/s2-1.png">
    <meta itemprop="name" content="Install_RabbitMQ :: Hugo Relearn Theme">
    <meta itemprop="description" content="Rabbitmqéƒ¨ç½² å®‰è£…RabbitMQ Celeryåˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ— RabbitMQé›†ç¾¤å®‰è£… é›†ç¾¤æœåŠ¡å™¨é…ç½® IP ä¸»æœºå èŠ‚ç‚¹å±æ€§ 192.168.150.21 rabbit-mq-01 å†…å­˜èŠ‚ç‚¹&#43;HaproxyèŠ‚ç‚¹ 192.">
    <meta itemprop="datePublished" content="2024-06-20T21:23:47+08:00">
    <meta itemprop="dateModified" content="2024-06-20T21:23:47+08:00">
    <meta itemprop="wordCount" content="874">
    <meta itemprop="image" content="https://erge.blog/images/s2-1.png">
    <title>Install_RabbitMQ :: Hugo Relearn Theme</title>
    <link href="../../../../images/favicon.ico?1719333223" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../../css/fontawesome-all.min.css?1719333224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/fontawesome-all.min.css?1719333224" rel="stylesheet"></noscript>
    <link href="../../../../css/nucleus.css?1719333224" rel="stylesheet">
    <link href="../../../../css/auto-complete.css?1719333224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/auto-complete.css?1719333224" rel="stylesheet"></noscript>
    <link href="../../../../css/perfect-scrollbar.min.css?1719333224" rel="stylesheet">
    <link href="../../../../css/fonts.css?1719333224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/fonts.css?1719333224" rel="stylesheet"></noscript>
    <link href="../../../../css/theme.css?1719333224" rel="stylesheet">
    <link href="../../../../css/theme-relearn-auto.css?1719333224" rel="stylesheet" id="R-variant-style">
    <link href="../../../../css/chroma-relearn-auto.css?1719333224" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../../css/variant.css?1719333224" rel="stylesheet">
    <link href="../../../../css/print.css?1719333224" rel="stylesheet" media="print">
    <link href="../../../../css/format-print.css?1719333224" rel="stylesheet">
    <script src="../../../../js/variant.js?1719333224"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../../systems/linux/message_queue/install_rabbitmq/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/linux/message_queue/"><span itemprop="name">Message_Queue</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Install_RabbitMQ</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../../systems/linux/message_queue/install_redpanda/" title="Install_Redpanda (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../../systems/linux/message_queue/install_nsq/" title="Install_Nsq (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_rabbitmq">Install_RabbitMQ</h1>

<h2 id="rabbitmqéƒ¨ç½²"><code>Rabbitmq</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><a href="https://blog.csdn.net/u011186019/article/details/51911234" rel="external" target="_self">å®‰è£…<code>RabbitMQ</code></a></li>
<li><a href="https://docs.celeryq.dev/en/stable/" rel="external" target="_self"><code>Celery</code>åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—</a></li>
</ul>
</blockquote>
<hr>
<h3 id="rabbitmqé›†ç¾¤å®‰è£…"><code>RabbitMQ</code>é›†ç¾¤å®‰è£…</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é›†ç¾¤æœåŠ¡å™¨é…ç½®<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th><code>IP</code></th>
<th>ä¸»æœºå</th>
<th>èŠ‚ç‚¹å±æ€§</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.150.21</td>
<td><code>rabbit-mq-01</code></td>
<td>å†…å­˜èŠ‚ç‚¹+<code>Haproxy</code>èŠ‚ç‚¹</td>
</tr>
<tr>
<td>192.168.150.22</td>
<td><code>rabbit-mq-02</code></td>
<td>å†…å­˜èŠ‚ç‚¹+<code>Haproxy</code>èŠ‚ç‚¹</td>
</tr>
<tr>
<td>192.168.150.23</td>
<td><code>rabbit-mq-03</code></td>
<td>ç£ç›˜èŠ‚ç‚¹</td>
</tr>
<tr>
<td>192.168.150.24</td>
<td><code>keepalived vip</code></td>
<td>æä¾›å¯¹å¤–<code>VIP</code></td>
</tr>
</tbody>
</table>
<ul>
<li><code>Erlang</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code> RabbitMQ</code>æ˜¯ç”¨<code>Erlang</code>è¯­è¨€ç¼–å†™çš„ï¼Œæˆ‘ä»¬å°†å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„<code>Erlang</code>åˆ°æœåŠ¡å™¨ä¸­ã€‚ <code>Erlang</code>åœ¨é»˜è®¤çš„<code>YUM</code>å­˜å‚¨åº“ä¸­ä¸å¯ç”¨ï¼Œå› æ­¤æ‚¨å°†éœ€è¦å®‰è£…<code>EPEL</code>å­˜å‚¨åº“ã€‚ è¿è¡Œä»¥ä¸‹å‘½ä»¤ç›¸åŒã€‚ åšå¥½<code>hosts</code>è§£æï¼Œ<!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾ç«¯å£<!-- raw HTML omitted --><code>port 25672</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y update
</span></span><span style="display:flex;"><span>$ yum -y install epel-release
</span></span><span style="display:flex;"><span>$ yum -y install erlang socat</span></span></code></pre></div></blockquote>
<ul>
<li><code>RabbitMQ</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>RabbitMQ</code>ä¸ºé¢„ç¼–è¯‘å¹¶å¯ä»¥ç›´æ¥å®‰è£…çš„ä¼ä¸š<code>Linuxç³»</code>ç»Ÿæä¾›<code>RPM</code>è½¯ä»¶åŒ…ã€‚ å”¯ä¸€éœ€è¦çš„ä¾èµ–æ˜¯å°†<code>Erlang</code>å®‰è£…åˆ°ç³»ç»Ÿä¸­ã€‚ æˆ‘ä»¬å·²ç»å®‰è£…<code>äº†Erlang</code>ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ä¸‹è½½<code>RabbitMQ</code>ã€‚
é€šè¿‡è¿è¡Œä¸‹è½½<code>Erlang RPM</code>è½¯ä»¶åŒ…</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm --import https://www.rabbitmq.com/rabbitmq-release-signing-key.asc
</span></span><span style="display:flex;"><span>$ wget https://www.rabbitmq.com/releases/rabbitmq-server/v3.6.10/rabbitmq-server-3.6.10-1.el7.noarch.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ rpm -Uvh rabbitmq-server-3.6.10-1.el7.noarch.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.7.19/rabbitmq-server-3.7.19-1.el7.noarch.rpm</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.7.19/rabbitmq-server-3.7.19-1.el7.noarch.rpm.asc</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¼€å¯ç¬¬ä¸€å°<!-- raw HTML omitted --><code>MQ</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start rabbitmq-server</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¤åˆ¶<!-- raw HTML omitted --><code>.erlang.cookie</code><!-- raw HTML omitted -->æ–‡ä»¶åˆ°å…¶ä»–ä¸¤å°<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->æœåŠ¡å™¨é›†ç¾¤èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ scp /var/lib/rabbitmq/.erlang.cookie rabbit-mq-02:/var/lib/rabbitmq/
</span></span><span style="display:flex;"><span>$ scp /var/lib/rabbitmq/.erlang.cookie rabbit-mq-03:/var/lib/rabbitmq/</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨å…¶ä»–ä¸¤å°é›†ç¾¤èŠ‚ç‚¹æœåŠ¡å™¨ä¸Šçš„<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chown -R rabbitmq. /var/lib/rabbitmq
</span></span><span style="display:flex;"><span>$ systemctl start rabbitmq-server</span></span></code></pre></div></blockquote>
<ul>
<li><code>Rabbitmq</code><!-- raw HTML omitted -->é›†ç¾¤è¿æ¥ã€é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´é˜²ç«å¢™å¼€å¯ï¼š<!-- raw HTML omitted --><code>4369</code><!-- raw HTML omitted -->ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl stop_app
</span></span><span style="display:flex;"><span>$ rabbitmqctl join_cluster rabbit@rabbit-mq-01
</span></span><span style="display:flex;"><span>$ rabbitmqctl start_app</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®é•œåƒæ¨¡å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl cluster_status
</span></span><span style="display:flex;"><span>$ rabbitmqctl set_policy ha-all <span style="color:#e6db74">&#34;^&#34;</span> <span style="color:#e6db74">&#39;{&#34;ha-mode&#34;:&#34;all&#34;}&#39;</span>
</span></span><span style="display:flex;"><span>$ rabbitmqctl cluster_status</span></span></code></pre></div></blockquote>
<ul>
<li>è®¾ç½®èŠ‚ç‚¹ä¿¡æ¯<!-- raw HTML omitted -->å†…å­˜èŠ‚ç‚¹ã€ç£ç›˜èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl stop_app
</span></span><span style="display:flex;"><span>$ rabbitmqctl change_cluster_node_type ram  	<span style="color:#75715e"># ç±»å‹(ram å†…å­˜)ã€(disc ç¡¬ç›˜)å»¶è¿Ÿæ’ä»¶å¿…é¡»ç¡¬ç›˜</span>
</span></span><span style="display:flex;"><span>$ rabbitmqctl start_app</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨æ‰€æœ‰èŠ‚ç‚¹æœºå™¨ä¸Šå¼€å¯<!-- raw HTML omitted --><code>rabbit</code><!-- raw HTML omitted -->ç›‘æ§<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmq-plugins enable rabbitmq_management</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="rabbitmqç”¨æˆ·æˆæƒ"><code>Rabbitmq</code>ç”¨æˆ·æˆæƒ</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ ç”¨æˆ·ã€ç”¨æˆ·å¯†ç éƒ½æ˜¯ï¼š<!-- raw HTML omitted --><code>admin</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl add_user admin admin</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>permissions</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl set_permissions -p <span style="color:#e6db74">&#34;/&#34;</span> admin <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®ç”¨æˆ·è§’è‰²æƒé™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl set_user_tags admin administrator</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é˜²ç«å¢™å¼€å¯ï¼š<!-- raw HTML omitted --><code>15672</code><!-- raw HTML omitted -->ç«¯å£ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ http://IP:15672/</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="rabbitmqå®‰è£…å»¶æ—¶æ’ä»¶"><code>RabbitMQ</code>å®‰è£…å»¶æ—¶æ’ä»¶</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ‡æ¢å®‰è£…<!-- raw HTML omitted --><code>Rabbitmq</code><!-- raw HTML omitted -->æœåŠ¡ä¸»ç›®å½•<!-- raw HTML omitted --><code>plugins</code><!-- raw HTML omitted -->ä¸‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/lib/rabbitmq/lib/rabbitmq_server-3.6.10/plugins</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½å»¶æ—¶æ’ä»¶å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://dl.bintray.com/rabbitmq/community-plugins/3.6.x/rabbitmq_delayed_message_exchange/&gt; rabbitmq_delayed_message_exchange-20171215-3.6.x.zip</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è§£å‹å»¶æ—¶æ’ä»¶å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install unzip
</span></span><span style="display:flex;"><span>$ unzip  rabbitmq_delayed_message_exchange-20171215-3.6.x.zip
</span></span><span style="display:flex;"><span>$ cd ../sbin
</span></span><span style="display:flex;"><span>$ ./rabbitmq-plugins enable rabbitmq_delayed_message_exchange</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é‡å¯<!-- raw HTML omitted --><code>Rabitymq</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl restart rabbitmq-server</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="haproxyéƒ¨ç½²"><code>HAProxy</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li>ä½¿ç”¨<code>HAProxy</code>ä½¿<code>Rabbitmq</code>æœåŠ¡å®ç°é«˜å¯ç”¨</li>
<li><!-- raw HTML omitted -->ä¸¤å°æœåŠ¡å™¨éƒ½å®‰è£…<!-- raw HTML omitted --><code>HAProxy</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th><code>IP</code></th>
<th>ä¸»æœºå</th>
<th>èŠ‚ç‚¹å±æ€§</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.150.21</td>
<td><code>rabbit-mq-01</code></td>
<td>å†…å­˜èŠ‚ç‚¹+<code>Haproxy</code>èŠ‚ç‚¹ï¼Œ<!-- raw HTML omitted -->ç«¯å£ï¼š8888(<code>haproxy</code>ç›‘æ§ç«¯å£)ã€8889(<code>rabbitmq</code>&gt; æœåŠ¡ç«¯å£)<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>192.168.150.22</td>
<td><code>rabbit-mq-02</code></td>
<td>å†…å­˜èŠ‚ç‚¹+<code>Haproxy</code>èŠ‚ç‚¹ï¼Œ<!-- raw HTML omitted -->ç«¯å£ï¼š8888(<code>haproxy</code>ç›‘æ§ç«¯å£)ã€8889(<code>rabbitmq</code>&gt; æœåŠ¡ç«¯å£)<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y haproxy </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/haproxy/haproxy.cfg<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # log /yougo/haproxy/home/log    local0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # log /yougo/haproxy/home/log    local1 notice
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # chroot /yougo/haproxy         # æ”¹å˜å½“å‰å·¥ä½œç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # stats socket /yougo/haproxy/home/admin.sock mode 660 level admin   # åˆ›å»ºç›‘æ§æ‰€ç”¨çš„å¥—æ¥å­—ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> pidfile  /var/run/haproxy.pid   # haproxyçš„pidå­˜æ”¾è·¯å¾„,å¯åŠ¨è¿›ç¨‹çš„ç”¨æˆ·å¿…é¡»æœ‰æƒé™è®¿é—®æ­¤æ–‡ä»¶ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> maxconn  4000                   # æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤4000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  user   haproxy               # é»˜è®¤ç”¨æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  group   haproxy              # é»˜è®¤ç”¨æˆ·ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> daemon                          # åˆ›å»º1ä¸ªè¿›ç¨‹è¿›å…¥deamonæ¨¡å¼è¿è¡Œã€‚æ­¤å‚æ•°è¦æ±‚å°†è¿è¡Œæ¨¡å¼è®¾ç½®ä¸º&#34;daemon
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # Default SSL material locations
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ca-base /etc/ssl/certs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # crt-base /etc/ssl/private
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # Default ciphers to use on SSL-enabled listening sockets.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # For more information, see ciphers(1SSL). This list is from:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ssl-default-bind-ciphers &gt; ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ssl-default-bind-options no-sslv3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">###########é»˜è®¤é…ç½®#########
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaults
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> log global
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mode    http                # é»˜è®¤çš„æ¨¡å¼mode { tcp|http|health }ï¼Œtcpæ˜¯4å±‚ï¼Œhttpæ˜¯7å±‚ï¼Œhealthåªä¼šè¿”å›OK
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  httplog             # é‡‡ç”¨httpæ—¥å¿—æ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  dontlognull         # å¯ç”¨è¯¥é¡¹ï¼Œæ—¥å¿—ä¸­å°†ä¸ä¼šè®°å½•ç©ºè¿æ¥ã€‚æ‰€è°“ç©ºè¿æ¥å°±æ˜¯åœ¨ä¸Šæ¸¸çš„è´Ÿè½½å‡è¡¡å™¨æˆ–è€…ç›‘æ§ç³»ç»Ÿä¸ºäº†æ¢æµ‹è¯¥æœåŠ¡æ˜¯å¦å­˜æ´»å¯ç”¨æ—¶,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                             # éœ€è¦å®šæœŸçš„è¿æ¥æˆ–è€…è·å–æŸä¸€å›ºå®šçš„ç»„ä»¶æˆ–é¡µé¢,æˆ–è€…æ¢æµ‹æ‰«æç«¯å£æ˜¯å¦åœ¨ç›‘å¬æˆ–å¼€æ”¾ç­‰åŠ¨ä½œè¢«ç§°ä¸ºç©ºè¿æ¥;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                             # å®˜æ–¹æ–‡æ¡£ä¸­æ ‡æ³¨ï¼Œå¦‚æœè¯¥æœåŠ¡ä¸Šæ¸¸æ²¡æœ‰å…¶ä»–çš„è´Ÿè½½å‡è¡¡å™¨çš„è¯ï¼Œå»ºè®®ä¸è¦ä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                             # è¯¥å‚æ•°ï¼Œå› ä¸ºäº’è”ç½‘ä¸Šçš„æ¶æ„æ‰«ææˆ–å…¶ä»–åŠ¨ä½œå°±ä¸ä¼šè¢«è®°å½•ä¸‹æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout connect 5000        # è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout client  50000       # å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout server  50000       # æœåŠ¡å™¨ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  httpclose        # æ¯æ¬¡è¯·æ±‚å®Œæ¯•åä¸»åŠ¨å…³é—­httpé€šé“ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  httplog          # æ—¥å¿—ç±»åˆ«httpæ—¥å¿—æ ¼å¼ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #option  forwardfor      # å¦‚æœåç«¯æœåŠ¡å™¨éœ€è¦è·å¾—å®¢æˆ·ç«¯çœŸå®ipéœ€è¦é…ç½®çš„å‚æ•°ï¼Œå¯ä»¥ä»Http Headerä¸­è·å¾—å®¢æˆ·ç«¯ip  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  redispatch       # serverIdå¯¹åº”çš„æœåŠ¡å™¨æŒ‚æ‰å,å¼ºåˆ¶å®šå‘åˆ°å…¶ä»–å¥åº·çš„æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout connect 10000    # default 10 second timeout if a backend is not found
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> maxconn     60000        # æœ€å¤§è¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> retries     3            # 3æ¬¡è¿æ¥å¤±è´¥å°±è®¤ä¸ºæœåŠ¡ä¸å¯ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åé¢è®¾ç½® 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 400 /yougo/haproxy/home/errors/400.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 403 /yougo/haproxy/home/errors/403.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 408 /yougo/haproxy/home/errors/408.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 500 /yougo/haproxy/home/errors/500.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 502 /yougo/haproxy/home/errors/502.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 503 /yougo/haproxy/home/errors/503.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 504 /yougo/haproxy/home/errors/504.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">####################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listen http_front
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     bind 0.0.0.0:8888           # ç›‘å¬ç«¯å£  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats refresh 30s           # ç»Ÿè®¡é¡µé¢è‡ªåŠ¨åˆ·æ–°æ—¶é—´  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats uri /haproxy?stats    # ç»Ÿè®¡é¡µé¢url  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats realm Haproxy Manager # ç»Ÿè®¡é¡µé¢å¯†ç æ¡†ä¸Šæç¤ºæ–‡æœ¬  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats auth admin:admin      # ç»Ÿè®¡é¡µé¢ç”¨æˆ·åå’Œå¯†ç è®¾ç½®  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     #stats hide-version         # éšè—ç»Ÿè®¡é¡µé¢ä¸ŠHAProxyçš„ç‰ˆæœ¬ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#####################RabbitMQçš„ç®¡ç†ç•Œé¢ä¹Ÿæ”¾åœ¨HAProxyåé¢äº†###############################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#listen rabbitmq_admin 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#    bind 0.0.0.0:8004
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#   server node1 192.168.0.31:15672
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#    server node2 192.168.0.32:15672
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#    server node3 192.168.0.33:15672
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">####################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listen rabbitmq_cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> bind 0.0.0.0:8889  	# rabbitmqé›†ç¾¤è°ƒç”¨çš„ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option tcplog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mode tcp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout client  3h
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout server  3h
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option          clitcpka
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> balance roundrobin  	# è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ˆ#banlance roundrobin è½®è¯¢ï¼Œbalance source ä¿å­˜sessionå€¼ï¼Œæ”¯æŒstatic-rrï¼Œleastconnï¼Œfirstï¼Œuriç­‰å‚æ•°ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance url_param userid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance url_param session_id check_post 64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance hdr(User-Agent)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance hdr(host)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance hdr(Host) use_domain_only
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance rdp-cookie
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance leastconn
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance source //ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server   rabbitmq1  172.16.0.30:5672 check inter 5s rise 2 fall 3  	# check inter 2000 æ˜¯æ£€æµ‹å¿ƒè·³é¢‘ç‡ï¼Œrise &gt; 2æ˜¯2æ¬¡æ­£ç¡®è®¤ä¸ºæœåŠ¡å™¨å¯ç”¨ï¼Œfall 3æ˜¯3æ¬¡å¤±è´¥è®¤ä¸ºæœåŠ¡å™¨ä¸å¯ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server   rabbitmq2  172.16.0.31:5672 check inter 5s rise 2 fall 3  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server   rabbitmq3  172.16.0.32:5672 check inter 5s rise 2 fall 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸¤å°<!-- raw HTML omitted --><code>HAProxy</code><!-- raw HTML omitted -->æœåŠ¡å™¨å¯åŠ¨æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start haproxy</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="keepalivedéƒ¨ç½²"><code>Keepalived</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y keepalived</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->ä¸»èŠ‚ç‚¹<!-- raw HTML omitted --><code>Master</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global_defs {  	# å…¨å±€é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email {  	# æŒ‡å®škeepalivedåœ¨å‘ç”Ÿåˆ‡æ¢æ—¶éœ€è¦éœ€è¦å‘é€Emailçš„å¯¹è±¡ï¼Œä¸€è¡Œä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   user@example.com  	# æŒ‡å®šçš„æ”¶ä»¶äºº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email_from mail@example.org  	# æŒ‡å®šçš„å‘ä»¶äºº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_server 192.168.200.1  	# æŒ‡å®šçš„SMTPæœåŠ¡å™¨åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_connect_timeout 30  	# æŒ‡å®šSMTPè¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">router_id Rabbitmq_Dev  	# æ­¤å¤„æ³¨æ„router_idä¸ºè´Ÿè½½å‡è¡¡æ ‡è¯†ï¼Œåœ¨å±€åŸŸç½‘å†…åº”è¯¥æ˜¯å”¯ä¸€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vrrp_instance VI_1 {  	# ç›‘æ§å¤šä¸ªç½‘æ®µçš„å®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> state MASTER  	# æŒ‡å®šKeepalivedçš„è§’è‰²ï¼ŒMASTERè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯ä¸»æœåŠ¡å™¨,BACKUPè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯å¤‡ç”¨æœåŠ¡å™¨ï¼Œæ‰€ä»¥è®¾ç½®priorityæ—¶è¦æ³¨æ„MASTERæ¯”BACKUPé«˜ã€‚å¦‚&gt; æœè®¾ç½®äº†nopreempt,é‚£ä¹ˆstateçš„è¿™ä¸ªå€¼ä¸èµ·ä½œç”¨ï¼Œä¸»å¤‡é priorityå†³å®šï¼Œå¿…é¡»å¤§å†™
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nopreempt  	# è®¾ç½®ä¸ºä¸æŠ¢å 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> interface eth0  	# æŒ‡å®šç›‘æµ‹ç½‘ç»œçš„æ¥å£ï¼Œå½“LVSæ¥ç®¡æ—¶ï¼Œå°†ä¼šæŠŠIPåœ°å€æ·»åŠ åˆ°è¯¥ç½‘å¡ä¸Šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> virtual_router_id 58  	# è™šæ‹Ÿè·¯ç”±æ ‡è¯†ï¼ŒåŒä¸€ä¸ªvrrpå®ä¾‹ä½¿ç”¨å”¯ä¸€çš„æ ‡è¯†ï¼ŒåŒä¸€ä¸ªvrrp_instanceä¸‹ï¼ŒMASTERå’ŒBACKUPå¿…é¡»ä¸€è‡´ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> priority 101  	# MASTERæƒé‡è¦é«˜äº   BACKUP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> advert_int 1  	# å¿ƒè·³æŠ¥æ–‡å‘é€é—´éš”
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> unicast_src_ip 192.168.150.21  	# é…ç½®å•æ’­çš„æºåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> unicast_peer { 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     192.168.150.22  	# é…ç½®å•æ’­çš„ç›®æ ‡åœ°å€ã€å¯¹ç«¯IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }  	# keepalivedåœ¨ç»„æ’­æ¨¡å¼ä¸‹æ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šå‘224.0.0.18çš„ç»„æ’­åœ°å€å‘é€ï¼Œäº§ç”Ÿä¼—å¤šçš„æ— ç”¨ä¿¡æ¯ï¼Œå¹¶ä¸”ä¼šäº§ç”Ÿå¹²æ‰°å’Œå†²çªï¼Œå¯ä»¥å°†ç»„æ’­çš„æ¨¡å¼æ”¹ä¸ºå•æ‹¨ã€‚è¿™æ˜¯ä¸€ç§å®‰&gt; å…¨çš„æ–¹æ³•ï¼Œé¿å…å±€åŸŸç½‘å†…æœ‰å¤§é‡çš„keepalivedé€ æˆè™šæ‹Ÿè·¯ç”±idçš„å†²çªã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> authentication {  	# è®¤è¯é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth_type PASS  	# ä¸»ä»æœåŠ¡å™¨éªŒè¯æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth_pass 1111  	# è®¤è¯å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> virtual_ipaddress {  	# è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªè™šæ‹ŸIPåœ°å€ï¼Œæ¯è¡Œä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     192.168.150.24/24 dev eth1 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> track_interface {  	# è®¾ç½®é¢å¤–çš„ç›‘æ§ï¼Œé‡Œé¢é‚£ä¸ªç½‘å¡å‡ºç°é—®é¢˜éƒ½ä¼šåˆ‡æ¢
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     eth0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->å¤‡ç”¨èŠ‚ç‚¹<!-- raw HTML omitted --><code>Backup</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global_defs {  	# å…¨å±€é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email {  	# æŒ‡å®šåœ¨keepalivedåœ¨å‘ç”Ÿåˆ‡æ¢æ—¶éœ€è¦å‘é€Emailçš„å¯¹è±¡ï¼Œä¸€è¡Œä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    user@example.com  	# æŒ‡å®šæ”¶ä»¶äºº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email_from mail@example.org  	# æŒ‡å®šå‘ä»¶äºº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_server 192.168.200.1  	# æŒ‡å®šSMTPæœåŠ¡å™¨åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_connect_timeout 30  	# æŒ‡å®šSMTPè¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">router_id Rabbitmq_Dev  	# æ­¤å¤„æ³¨æ„router_idä¸ºè´Ÿè½½å‡è¡¡è¡¨ç¤ºï¼Œåœ¨å±€åŸŸç½‘åº”è¯¥æ˜¯å”¯ä¸€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vrrp_instance VI_1 {  	# ç›‘æ§å¤šä¸ªç½‘æ®µå®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> state BACKUP  	# æŒ‡å®šKeepalivedçš„è§’è‰²ï¼ŒMASTERè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯ä¸»æœåŠ¡å™¨,BACKUPè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯å¤‡ç”¨æœåŠ¡å™¨ï¼Œæ‰€ä»¥è®¾ç½®priorityæ—¶è¦æ³¨æ„MASTERæ¯”BACKUPé«˜ã€‚å¦‚&gt; æœè®¾ç½®äº†nopreempt,é‚£ä¹ˆstateçš„è¿™ä¸ªå€¼ä¸èµ·ä½œç”¨ï¼Œä¸»å¤‡é priorityå†³å®šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nopreempt  	# è®¾ç½®ä¸ºä¸æŠ¢å  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> interface eth0  	# è®¾ç½®å®ä¾‹ç»‘å®šçš„ç½‘å¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> virtual_router_id 58  	# è™šæ‹Ÿè·¯ç”±æ ‡è¯†ï¼ŒåŒä¸€ä¸ªvrrpå®ä¾‹ä½¿ç”¨å”¯ä¸€çš„æ ‡è¯†ï¼ŒåŒä¸€ä¸ªvrrp_instanceä¸‹ï¼ŒMASTERå’ŒBACKUPå¿…é¡»ä¸€è‡´ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> priority 100  	# æƒé‡è¦ä½äºMASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> advert_int 1  	# å¿ƒè·³æŠ¥æ–‡å‘é€é—´éš”ã€æ£€æŸ¥é—´éš”é»˜è®¤1ç§’
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> unicast_src_ip 192.168.150.22  	# é…ç½®å•æ’­çš„æºåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> unicast_peer { 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     192.168.150.21  	# é…ç½®å•æ’­çš„ç›®æ ‡åœ°å€ã€å¯¹ç«¯IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }  	# keepalivedåœ¨ç»„æ’­æ¨¡å¼ä¸‹æ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šå‘224.0.0.18çš„ç»„æ’­åœ°å€å‘é€ï¼Œäº§ç”Ÿä¼—å¤šçš„æ— ç”¨ä¿¡æ¯ï¼Œå¹¶ä¸”ä¼šäº§ç”Ÿå¹²æ‰°å’Œå†²çªï¼Œå¯ä»¥å°†ç»„æ’­çš„æ¨¡å¼æ”¹ä¸ºå•æ‹¨ã€‚è¿™æ˜¯ä¸€ç§å®‰&gt; å…¨çš„æ–¹æ³•ï¼Œé¿å…å±€åŸŸç½‘å†…æœ‰å¤§é‡çš„keepalivedé€ æˆè™šæ‹Ÿè·¯ç”±idçš„å†²çªã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> authentication {  	# è®¾ç½®è®¤è¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth_type PASS  	# è®¤è¯æ–¹å¼æœ‰ä¸¤ç§PASSã€AHä¸¤ç§
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth_pass 1111  	# è®¤è¯å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # VIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> virtual_ipaddress {  	# è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªè™šæ‹ŸIPåœ°å€ï¼Œæ¯è¡Œä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     192.168.150.24/24 dev eth1 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start keepalived</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="å…è®¸ç»„æ’­ç½‘æ®µå’Œvrrpåè®®é€šä¿¡">å…è®¸ç»„æ’­ç½‘æ®µå’Œ<code>vrrp</code>åè®®é€šä¿¡</h4>
<blockquote>
<ul>
<li><code>centos7 firewalld</code>å¼€å¯æƒ…å†µä¸‹ï¼Œä¼šé˜»æ–­ç»„æ’­å’Œ<code>vrrp</code>çš„åè®®é€šä¿¡ï¼Œå¯¼è‡´<code>Keepalived</code>è„‘è£‚æƒ…å†µï¼Œéœ€è¦åœ¨<code>keepalived</code>çš„ä¸¤å°æœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°±å¯ä»¥æ­£å¸¸é€šä¿¡</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT <span style="color:#ae81ff">0</span> --in-interface ç½‘å¡åç§°<span style="color:#f92672">(</span>eth0<span style="color:#f92672">)</span> --destination 224.0.0.18 --protocol &gt; vrrp -j ACCEPT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç›‘æ§ç½‘ç»œåè®®ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰è„‘è£‚æƒ…å†µ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tcpdump -i ç½‘å¡åç§°<span style="color:#f92672">(</span>eth0<span style="color:#f92672">)</span> vrrp -n</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>python</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>pika</code><!-- raw HTML omitted -->åŒ…è¿›è¡Œæµ‹è¯•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y python-pip
</span></span><span style="display:flex;"><span>$ pip install pika</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç”Ÿäº§ç«¯ç¨‹åºè„šæœ¬<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;Production.py<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># !/usr/bin/env python
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import pika
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">credentials = pika.PlainCredentials(&#39;admin&#39;,&#39;admin&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">connection = pika.BlockingConnection(pika.ConnectionParameters(
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#39;192.168.150.21&#39;,8889,&#39;/&#39;,credentials))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel = connection.channel()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel.queue_declare(queue=&#39;balance&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel.basic_publish(exchange=&#39;&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   routing_key=&#39;balance&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   body=&#39;Hello World!&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">print(&#34; [x] Sent &#39;Hello World!&#39;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">connection.close()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ¶ˆè´¹ç«¯ç¨‹åºè„šæœ¬<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;Consumption.py<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># !/usr/bin/env python
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import pika
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">credentials = pika.PlainCredentials(&#39;admin&#39;,&#39;admin&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">connection = pika.BlockingConnection(pika.ConnectionParameters(
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#39;192.168.150.21&#39;,8889,&#39;/&#39;,credentials))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel = connection.channel()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel.queue_declare(queue=&#39;balance&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel.basic_publish(exchange=&#39;&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   routing_key=&#39;balance&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   body=&#39;Hello World!&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">print(&#34; [x] Sent &#39;Hello World!&#39;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">connection.close()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

        </div>
      </main>
    </div>
    <script src="../../../../js/clipboard.min.js?1719333224" defer></script>
    <script src="../../../../js/perfect-scrollbar.min.js?1719333224" defer></script>
    <script src="../../../../js/theme.js?1719333224" defer></script>
  </body>
</html>
