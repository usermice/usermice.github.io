<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <meta name="author" content="äºŒå“¥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/s2-1.png">
    <meta name="twitter:title" content="Message_Queue :: Hugo Relearn Theme">
    <meta property="og:url" content="https://erge.blog/systems/linux/message_queue/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Message_Queue :: Hugo Relearn Theme">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://erge.blog/images/s2-1.png">
    <meta itemprop="name" content="Message_Queue :: Hugo Relearn Theme">
    <meta itemprop="datePublished" content="2024-06-13T00:32:47+08:00">
    <meta itemprop="dateModified" content="2024-06-13T00:32:47+08:00">
    <meta itemprop="image" content="https://erge.blog/images/s2-1.png">
    <title>Message_Queue :: Hugo Relearn Theme</title>
    <link href="../../../images/favicon.ico?1724860321" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../css/fontawesome-all.min.css?1724860322" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fontawesome-all.min.css?1724860322" rel="stylesheet"></noscript>
    <link href="../../../css/nucleus.css?1724860322" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1724860322" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/auto-complete.css?1724860322" rel="stylesheet"></noscript>
    <link href="../../../css/perfect-scrollbar.min.css?1724860322" rel="stylesheet">
    <link href="../../../css/fonts.css?1724860322" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fonts.css?1724860322" rel="stylesheet"></noscript>
    <link href="../../../css/theme.css?1724860322" rel="stylesheet">
    <link href="../../../css/theme-relearn-auto.css?1724860322" rel="stylesheet" id="R-variant-style">
    <link href="../../../css/chroma-relearn-auto.css?1724860322" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../css/variant.css?1724860322" rel="stylesheet">
    <link href="../../../css/print.css?1724860322" rel="stylesheet" media="print">
    <link href="../../../css/format-print.css?1724860322" rel="stylesheet">
    <script src="../../../js/variant.js?1724860322"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../systems/linux/message_queue/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Message_Queue</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/logs/configure_elk/" title="Configure_ELK (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/message_queue/install_activemq/" title="Install_ActiveMQ (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="message_queue">Message_Queue</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Message_Queue</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_activemq">Install_ActiveMQ</h1>

<h2 id="activemqéƒ¨ç½²"><code>ActiveMQ</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é€šè¿‡<!-- raw HTML omitted --><code>http://localhost:8161/admin/</code><!-- raw HTML omitted -->æ¥è®¿é—®<!-- raw HTML omitted --><code>ActiveMQ</code><!-- raw HTML omitted -->çš„æ§åˆ¶å°ç•Œé¢<!-- raw HTML omitted -->.</li>
<li>è´¦å·ï¼š<code>admin</code></li>
<li>å¯†ç ï¼š<code>admin</code></li>
<li>ç«¯å£ï¼š<code>8161</code>ï¼šåå°ç®¡ç†ç³»ç»Ÿï¼Œ<code>61616</code>ï¼šç»™<code>JAVA</code>ç¨‹åºè¿æ¥çš„<code>TCP</code>ç«¯å£</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo wget https://archive.apache.org/dist/activemq/5.15.16/apache-activemq-5.15.16-bin.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar zxvf apache-activemq-5.15.16-bin.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ bin<span style="color:#ae81ff">\a</span>ctivemq start
</span></span><span style="display:flex;"><span>$ bin<span style="color:#ae81ff">\a</span>ctivemq stop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘é€æ¶ˆæ¯çš„ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span>$ bin<span style="color:#ae81ff">\a</span>ctivemq producer --message <span style="color:#e6db74">&#34;My message&#34;</span> --messageCount <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ”¶æ¶ˆæ¯çš„ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span>$ bin<span style="color:#ae81ff">\a</span>ctivemq consumer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ§åˆ¶å°è¾“å‡º</span>
</span></span><span style="display:flex;"><span>$ bin<span style="color:#ae81ff">\a</span>ctivemq consumer</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_rocketmq">Install_RocketMQ</h1>

<h2 id="rocketmqéƒ¨ç½²"><code>Rocketmq</code>éƒ¨ç½²</h2>
<h3 id="å•æœºå•å®ä¾‹">å•æœºå•å®ä¾‹</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Rocketmq</code><!-- raw HTML omitted -->å¿…è¦æ¡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>64</code><!-- raw HTML omitted -->ä½<!-- raw HTML omitted --><code>JDK 1.8+</code></li>
<li><!-- raw HTML omitted --><code>Maven 3.2.x</code><!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted --><code>Git</code><!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä½¿ç”¨äº<!-- raw HTML omitted --><code>Broker</code><!-- raw HTML omitted -->æœåŠ¡å™¨<!-- raw HTML omitted --><code>4G+</code><!-- raw HTML omitted -->å¯ç”¨ç£ç›˜ç©ºé—´<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>JDK</code><!-- raw HTML omitted -->é…ç½®ç¯å¢ƒå˜é‡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.oracle.com/java/technologies/oracle-java-archive-downloads.html" rel="external" target="_self">æ‰“å¼€é“¾æ¥æ‰¾æ—©æœŸç‰ˆæœ¬</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/jdk-8u181-linux-x64.tar.gz -C /usr/local/src/  	<span style="color:#75715e"># åŠ å‹åˆ°æŒ‡å®šä½ç½®</span>
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/src/jdk1.8.0_181 /usr/local/jdk  	<span style="color:#75715e"># åšä¸ªè½¯é“¾æ¥ï¼Œå–æ¶ˆè½¯é“¾æ¥rm -rf /usr/local/jdk  æ–‡ä»¶åä¸è¦åŠ &#34;/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ ç¯å¢ƒå˜é‡</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">HISTSIZE=10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export TMOUT=600
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export HISTTIMEFORMAT=&#34;%F %T &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#######JDKç’°å¢ƒè®Šæ•¸########################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JAVA_HOME=/usr/local/jdk
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JRE_HOME=$JAVA_HOME/jre
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export CLASSPATH=$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=$PATH:$JAVA_HOME/bin:$JAVA_HOME/jre/bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>&gt;&gt; /etc/profile
</span></span><span style="display:flex;"><span>$ source /etc/profile</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted --><a href="https://maven.apache.org/download.cgi" rel="external" target="_self">éƒ¨ç½²<code>maven3.2.2</code>ç‰ˆæœ¬</a><!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://downloads.apache.org/maven/maven-3/3.8.1/binaries/apache-maven-3.8.1-bin.tar.gz
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/apache-maven-3.8.1-bin.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/src/apache-maven-3.8.1/ /usr/local/maven
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#39;#####  æ·»åŠ mavenç¯å¢ƒå˜é‡  ########
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export MAVEN_HOME=/usr/local/maven
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=${PATH}:${MAVEN_HOME}/bin&#39;</span> &gt;&gt;/etc/profile
</span></span><span style="display:flex;"><span>source /etc/profile
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cp /usr/local/src/apache-maven-3.8.1/conf/settings.xml ~/.m2/  	# æ‹·è´æ–‡ä»¶åˆ°æ­¤ç›®å½•ä¸‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># vim  ~/.m2/settings.xml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &lt;profiles&gt;  	# æ‹·è´ä¸‹é¢å‡ è¡Œåˆ°&lt;profiles&gt;ä¸‹</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &lt;repositories&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#        &lt;repository&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#          &lt;id&gt;org.codehaus&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#          &lt;url&gt;https://repo1.maven.org/maven2/org/codehaus/&lt;/url&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#        &lt;/repository&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &lt;/repositories&gt;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted --><a href="https://rocketmq.apache.org/docs/quick-start/" rel="external" target="_self">ä¸‹è½½å¹¶è§£å‹<code>rocketmq</code>å®‰è£…åŒ…ã€ä½¿ç”¨<code>mvn</code>æ‰“åŒ…</a><!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install unzip
</span></span><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://downloads.apache.org/rocketmq/4.8.0/rocketmq-all-4.8.0-source-release.zip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># äºŒè¿›åˆ¶æ–‡ä»¶åŒ…</span>
</span></span><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://downloads.apache.org/rocketmq/4.8.0/rocketmq-all-4.8.0-bin-release.zip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ unzip /usr/local/src/rocketmq-all-4.8.0-source-release.zip -d /usr/local/src/  	<span style="color:#75715e"># è§£å‹åˆ°æŒ‡å®šä½ç½®</span>
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/rocketmq-all-4.8.0-source-release
</span></span><span style="display:flex;"><span>$ mvn -Prelease-all -DskipTests clean install -U
</span></span><span style="display:flex;"><span>$ cd distribution/target/rocketmq-4.8.0/rocketmq-4.8.0</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨åç§°æœåŠ¡å™¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup sh bin/mqnamesrv &amp;
</span></span><span style="display:flex;"><span>$ tail -f ~/logs/rocketmqlogs/namesrv.log</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å…ˆä¿®æ”¹ç»çºªäººæœåŠ¡å™¨é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /usr/local/src/rocketmq-all-4.8.0-source-release/distribution/target/rocketmq-4.8.0/rocketmq-4.8.0/bin/runbroker.sh
</span></span><span style="display:flex;"><span>JAVA_OPT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>JAVA_OPT<span style="color:#e6db74">}</span><span style="color:#e6db74"> -server -Xms128m -Xmx256m -Xmn256m&#34;</span>  	<span style="color:#75715e"># æ­¤å¤„å‡ ä¸ªå‚æ•°éœ€è¦ä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vim /usr/local/src/rocketmq-all-4.8.0-source-release/distribution/target/rocketmq-4.8.0/rocketmq-4.8.0/bin/runserver.sh
</span></span><span style="display:flex;"><span>JAVA_OPT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>JAVA_OPT<span style="color:#e6db74">}</span><span style="color:#e6db74"> -server -Xms128m -Xmx256m -Xmn256m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&#34;</span>  	<span style="color:#75715e"># ä¿®æ”¹Xms128m -Xmx256m &gt; -Xmn256m</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨ç»çºªäººæœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tail -f ~/logs/rocketmqlogs/broker.log  	<span style="color:#75715e"># æŠ¥é”™å¼‚å¸¸å…³é—­selinux</span>
</span></span><span style="display:flex;"><span>The broker<span style="color:#f92672">[</span>%s, 172.30.30.233:10911<span style="color:#f92672">]</span> boot success...</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å‘é€æ¥æ”¶æ¶ˆæ¯<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export NAMESRV_ADDR<span style="color:#f92672">=</span>localhost:9876
</span></span><span style="display:flex;"><span>$ sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer
</span></span><span style="display:flex;"><span>$ sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å…³é—­æœåŠ¡å™¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sh bin/mqshutdown broker
</span></span><span style="display:flex;"><span>The mqbroker<span style="color:#f92672">(</span>36695<span style="color:#f92672">)</span> is running...
</span></span><span style="display:flex;"><span>Send shutdown request to mqbroker<span style="color:#f92672">(</span>36695<span style="color:#f92672">)</span> OK
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sh bin/mqshutdown namesrv
</span></span><span style="display:flex;"><span>The mqnamesrv<span style="color:#f92672">(</span>36664<span style="color:#f92672">)</span> is running...
</span></span><span style="display:flex;"><span>Send shutdown request to mqnamesrv<span style="color:#f92672">(</span>36664<span style="color:#f92672">)</span> OK</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="é›†ç¾¤æ¨¡å¼éƒ¨ç½²">é›†ç¾¤æ¨¡å¼éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><a href="https://github.com/apache/rocketmq/blob/master/docs/cn/operation.md" rel="external" target="_self">è¿ç»´ç®¡ç†éƒ¨ç½²<code>Rocketmq</code></a></li>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>NameServer</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup sh  /usr/local/src/rocketmq-all-4.8.0-source-release/distribution/target/rocketmq-4.8.0/rocketmq-4.8.0/bin/mqnamesrv &amp;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->éªŒè¯<!-- raw HTML omitted --><code>Name Server</code><!-- raw HTML omitted -->æ˜¯å¦å¯åŠ¨æˆåŠŸ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tail -f ~/logs/rocketmqlogs/namesrv.log
</span></span><span style="display:flex;"><span>2021-04-24 16:51:14 INFO main - The Name Server boot success. serializeType<span style="color:#f92672">=</span>JSON</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å¹¶ä¿®æ”¹<!-- raw HTML omitted --><code>Rocketmq</code><!-- raw HTML omitted -->é›†ç¾¤é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/rocketmq-all-4.8.0-source-release/distribution/target/rocketmq-4.8.0/rocketmq-4.8.0/conf/2m-2s-sync
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@localhost 2m-2s-sync<span style="color:#f92672">]</span><span style="color:#75715e"># ll</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">928</span> Dec  <span style="color:#ae81ff">8</span> 18:16 broker-a.properties
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">922</span> Dec  <span style="color:#ae81ff">8</span> 18:16 broker-a-s.properties
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">928</span> Dec  <span style="color:#ae81ff">8</span> 18:16 broker-b.properties
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">922</span> Dec  <span style="color:#ae81ff">8</span> 18:16 broker-b-s.properties
</span></span><span style="display:flex;"><span>-rw-------. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">290</span> Apr <span style="color:#ae81ff">23</span> 22:47 nohup.out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vim broker-a-s.properties  	<span style="color:#75715e"># ä¸»æœºåšä¸»ä»å¿…æ·»åŠ ä¸¤å¤„</span>
</span></span><span style="display:flex;"><span>storePathRootDir<span style="color:#f92672">=</span>/opt/slave/broker-a-s
</span></span><span style="display:flex;"><span>listenPort <span style="color:#f92672">=</span> <span style="color:#ae81ff">10915</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>broker-a.properties</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;broker-a.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰€å±é›†ç¾¤åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=rocketmq-cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ ·ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-a
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 0:è¡¨ç¤º Masterï¼Œ&gt;0:è¡¨ç¤º Slave
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=mq-nameserver1:9876;mq-nameserver2:9876
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaultTopicQueueNums=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateSubscriptionGroup=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=10911
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">haListenPort=10912
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=04
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=120
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeCommitLog=1073741824
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeConsumeQueue=300000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># destroyMapedFileIntervalForcibly=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># redeleteHangedFileInterval=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">diskMaxUsedSpaceRatio=88
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathRootDir=/rocketmq/store
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLog å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathCommitLog=/rocketmq/store/commitlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathConsumeQueue=/rocketmq/store/consumequeue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathIndex=/rocketmq/store/index
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storeCheckpoint=/rocketmq/store/checkpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># abort æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">abortFile=/rocketmq/store/abort
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é™åˆ¶çš„æ¶ˆæ¯å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">maxMessageSize=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogLeastPages=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueLeastPages=2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogThoroughInterval=10000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueThoroughInterval=60000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker çš„è§’è‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_MASTER åŒæ­¥åŒå†™Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SYNC_MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ·ç›˜æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_FLUSH åŒæ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=ASYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkTransactionMessageEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sendMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pullMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¼ºåˆ¶æŒ‡å®šæœ¬æœºIPï¼Œéœ€è¦æ ¹æ®æ¯å°æœºå™¨è¿›è¡Œä¿®æ”¹ã€‚å®˜æ–¹ä»‹ç»å¯ä¸ºç©ºï¼Œç³»ç»Ÿé»˜è®¤è‡ªåŠ¨è¯†åˆ«ï¼Œä½†å¤šç½‘å¡æ—¶IPåœ°å€å¯èƒ½è¯»å–é”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=10.125.15.124
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>broker-a-s.properties</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;broker-a-s.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰€å±é›†ç¾¤åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=rocketmq-cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ ·ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-a-s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 0 è¡¨ç¤º Masterï¼Œ&gt;0 è¡¨ç¤º Slave
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=mq-nameserver1:9876;mq-nameserver2:9876
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaultTopicQueueNums=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateSubscriptionGroup=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=10923
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">haListenPort=10924
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=04
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=120
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeCommitLog=1073741824
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeConsumeQueue=300000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># destroyMapedFileIntervalForcibly=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># redeleteHangedFileInterval=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">diskMaxUsedSpaceRatio=88
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathRootDir=/rocketmq/store-s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLog å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathCommitLog=/rocketmq/store-s/commitlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathConsumeQueue=/rocketmq/store-s/consumequeue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathIndex=/rocketmq/store-s/index
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storeCheckpoint=/rocketmq/store-s/checkpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># abort æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">abortFile=/rocketmq/store-s/abort
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é™åˆ¶çš„æ¶ˆæ¯å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">maxMessageSize=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogLeastPages=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueLeastPages=2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogThoroughInterval=10000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueThoroughInterval=60000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker çš„è§’è‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_MASTER åŒæ­¥åŒå†™Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ·ç›˜æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_FLUSH åŒæ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=ASYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkTransactionMessageEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sendMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pullMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¼ºåˆ¶æŒ‡å®šæœ¬æœºIPï¼Œéœ€è¦æ ¹æ®æ¯å°æœºå™¨è¿›è¡Œä¿®æ”¹ã€‚å®˜æ–¹ä»‹ç»å¯ä¸ºç©ºï¼Œç³»ç»Ÿé»˜è®¤è‡ªåŠ¨è¯†åˆ«ï¼Œä½†å¤šç½‘å¡æ—¶IPåœ°å€å¯èƒ½è¯»å–é”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=10.125.15.125
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>broker-b.properties</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;broker-b.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰€å±é›†ç¾¤åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=rocketmq-cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ ·ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-b
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 0 è¡¨ç¤º Masterï¼Œ&gt;0 è¡¨ç¤º Slave
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=mq-nameserver1:9876;mq-nameserver2:9876
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaultTopicQueueNums=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateSubscriptionGroup=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=10911
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">haListenPort=10912
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=04
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=120
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeCommitLog=1073741824
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeConsumeQueue=300000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># destroyMapedFileIntervalForcibly=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># redeleteHangedFileInterval=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">diskMaxUsedSpaceRatio=88
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathRootDir=/rocketmq/store
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLog å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathCommitLog=/rocketmq/store/commitlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathConsumeQueue=/rocketmq/store/consumequeue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathIndex=/rocketmq/store/index
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storeCheckpoint=/rocketmq/store/checkpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># abort æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">abortFile=/rocketmq/store/abort
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é™åˆ¶çš„æ¶ˆæ¯å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">maxMessageSize=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogLeastPages=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueLeastPages=2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogThoroughInterval=10000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueThoroughInterval=60000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker çš„è§’è‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_MASTER åŒæ­¥åŒå†™Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SYNC_MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ·ç›˜æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_FLUSH åŒæ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=ASYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkTransactionMessageEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sendMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pullMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¼ºåˆ¶æŒ‡å®šæœ¬æœºIPï¼Œéœ€è¦æ ¹æ®æ¯å°æœºå™¨è¿›è¡Œä¿®æ”¹ã€‚å®˜æ–¹ä»‹ç»å¯ä¸ºç©ºï¼Œç³»ç»Ÿé»˜è®¤è‡ªåŠ¨è¯†åˆ«ï¼Œä½†å¤šç½‘å¡æ—¶IPåœ°å€å¯èƒ½è¯»å–é”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=10.125.15.125
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>broker-b-s.properties</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;broker-b-s.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰€å±é›†ç¾¤åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=rocketmq-cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ ·ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-b-s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 0ï¼šè¡¨ç¤ºMasterï¼Œ&gt;0ï¼šè¡¨ç¤º Slave
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=mq-nameserver1:9876;mq-nameserver2:9876
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaultTopicQueueNums=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateSubscriptionGroup=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=10923
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">haListenPort=10924
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=04
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=120
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeCommitLog=1073741824
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeConsumeQueue=300000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># destroyMapedFileIntervalForcibly=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># redeleteHangedFileInterval=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">diskMaxUsedSpaceRatio=88
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathRootDir=/rocketmq/store-s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLog å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathCommitLog=/rocketmq/store-s/commitlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathConsumeQueue=/rocketmq/store-s/consumequeue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathIndex=/rocketmq/store-s/index
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storeCheckpoint=/rocketmq/store-s/checkpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># abort æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">abortFile=/rocketmq/store-s/abort
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é™åˆ¶çš„æ¶ˆæ¯å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">maxMessageSize=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogLeastPages=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueLeastPages=2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogThoroughInterval=10000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueThoroughInterval=60000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker çš„è§’è‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_MASTER åŒæ­¥åŒå†™Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ·ç›˜æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_FLUSH åŒæ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=ASYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkTransactionMessageEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sendMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pullMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¼ºåˆ¶æŒ‡å®šæœ¬æœºIPï¼Œéœ€è¦æ ¹æ®æ¯å°æœºå™¨è¿›è¡Œä¿®æ”¹ã€‚å®˜æ–¹ä»‹ç»å¯ä¸ºç©ºï¼Œç³»ç»Ÿé»˜è®¤è‡ªåŠ¨è¯†åˆ«ï¼Œä½†å¤šç½‘å¡æ—¶IPåœ°å€å¯èƒ½è¯»å–é”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=10.125.15.124
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨å…¶ä»–å‡ ä¸ªèŠ‚ç‚¹æœåŠ¡å™¨å¯åŠ¨<!-- raw HTML omitted --><code>Master</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup sh mqbroker -n 192.168.1.1:9876 -c $ROCKETMQ_HOME/conf/2m-2s-async/broker-a.properties &amp;  	<span style="color:#75715e"># åœ¨æœºå™¨Aæœºå™¨å¯åŠ¨Master</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ nohup sh mqbroker -n 192.168.1.1:9876 -c $ROCKETMQ_HOME/conf/2m-2s-async/broker-b.properties &amp;  	<span style="color:#75715e"># åœ¨æœºå™¨Bæœºå™¨å¯åŠ¨Master</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ nohup sh mqbroker -n 192.168.1.1:9876 -c $ROCKETMQ_HOME/conf/2m-2s-async/broker-a-s.properties &amp;  	<span style="color:#75715e"># åœ¨æœºå™¨Cæœºå™¨å¯åŠ¨Slave</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ nohup sh mqbroker -n 192.168.1.1:9876 -c $ROCKETMQ_HOME/conf/2m-2s-async/broker-b-s.properties &amp;  	<span style="color:#75715e"># åœ¨æœºå™¨Cæœºå™¨å¯åŠ¨Slave</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>rocketmq-console</code><!-- raw HTML omitted -->å›¾å½¢åŒ–ç®¡ç†æ§åˆ¶å°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½å›¾å½¢åŒ–ç®¡ç†æ§åˆ¶å°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/apache/rocketmq-externals.git</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/local/src/rocketmq-externals/rocketmq-console/src/main/resources/application.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç®¡ç†åå°è®¿é—®ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œé»˜è®¤ä¸ºç©ºï¼Œå¦‚æœå¡«å†™ï¼Œä¸€å®šè¦å‰é¢åŠ â€œ/â€ï¼Œåé¢ä¸è¦åŠ ï¼Œå¦åˆ™å¯åŠ¨æŠ¥é”™
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server.contextPath=/rocketmq
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¿é—®ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server.port=8080
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">### SSL setting  é»˜è®¤å°±è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.ssl.key-store=classpath:rmqcngkeystore.jks
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.ssl.key-store-password=rocketmq
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.ssl.keyStoreType=PKCS12
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.ssl.keyAlias=rmqcngkey
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># spring.application.index=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spring.application.name=rocketmq-console
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spring.http.encoding.charset=UTF-8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spring.http.encoding.enabled=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spring.http.encoding.force=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># logbacké…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå…ˆé»˜è®¤å³å¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">logging.config=classpath:logback.xml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># if this value is empty,use env value rocketmq.config.namesrvAddr  NAMESRV_ADDR | now, you can set it in ops page.default &gt; localhost:9876
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Name Serveråœ°å€ï¼Œä¿®æ”¹æˆä½ è‡ªå·±çš„æœåŠ¡åœ°å€ã€‚å¤šä¸ªåœ°å€ç”¨è‹±æ–‡åˆ†å·â€œ;â€éš”å¼€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.namesrvAddr=localhost:9876
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># if you use rocketmq version &lt; 3.5.8, rocketmq.config.isVIPChannel should be false.default true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.isVIPChannel=
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># rocketmq-console&#39;s data path:dashboard/monitor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.dataPath=/tmp/rocketmq-console/data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># set it false if you don&#39;t want use dashboard.default true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.enableDashBoardCollect=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># set the message track trace topic if you don&#39;t want use the default one
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.msgTrackTopicName=
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.ticketKey=ticket
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Must create userInfo file: ${rocketmq.config.dataPath}/users.properties if the login is required
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.loginRequired=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‰“åŒ…è¿è¡Œ<!-- raw HTML omitted --><code>rocketmq-console</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mvn clean package -Dmaven.test.skip<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/rocketmq-externals/rocketmq-console/target/
</span></span><span style="display:flex;"><span>$ java -jar rocketmq-console-ng-2.0.0.jar</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‰“å¼€æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ http://IP:8080/#/
</span></span><span style="display:flex;"><span>æ§åˆ¶å°â†’æ›´æ¢è¯­è¨€â†’Simplified Chinese<span style="color:#f92672">(</span>åˆ‡æ¢ä¸­æ–‡<span style="color:#f92672">)</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_redpanda">Install_Redpanda</h1>

<h2 id="redpandaéƒ¨ç½²"><code>Redpanda</code>éƒ¨ç½²</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://redpanda.com/" rel="external" target="_self"><code>Redpanda</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://docs.redpanda.com/current/deploy/deployment-option/self-hosted/" rel="external" target="_self"><code>Redpanda</code>éƒ¨ç½²æ–‡æ¡£</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_rabbitmq">Install_RabbitMQ</h1>

<h2 id="rabbitmqéƒ¨ç½²"><code>Rabbitmq</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><a href="https://blog.csdn.net/u011186019/article/details/51911234" rel="external" target="_self">å®‰è£…<code>RabbitMQ</code></a></li>
<li><a href="https://docs.celeryq.dev/en/stable/" rel="external" target="_self"><code>Celery</code>åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—</a></li>
</ul>
</blockquote>
<hr>
<h3 id="rabbitmqé›†ç¾¤å®‰è£…"><code>RabbitMQ</code>é›†ç¾¤å®‰è£…</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é›†ç¾¤æœåŠ¡å™¨é…ç½®<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th><code>IP</code></th>
<th>ä¸»æœºå</th>
<th>èŠ‚ç‚¹å±æ€§</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.150.21</td>
<td><code>rabbit-mq-01</code></td>
<td>å†…å­˜èŠ‚ç‚¹+<code>Haproxy</code>èŠ‚ç‚¹</td>
</tr>
<tr>
<td>192.168.150.22</td>
<td><code>rabbit-mq-02</code></td>
<td>å†…å­˜èŠ‚ç‚¹+<code>Haproxy</code>èŠ‚ç‚¹</td>
</tr>
<tr>
<td>192.168.150.23</td>
<td><code>rabbit-mq-03</code></td>
<td>ç£ç›˜èŠ‚ç‚¹</td>
</tr>
<tr>
<td>192.168.150.24</td>
<td><code>keepalived vip</code></td>
<td>æä¾›å¯¹å¤–<code>VIP</code></td>
</tr>
</tbody>
</table>
<ul>
<li><code>Erlang</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code> RabbitMQ</code>æ˜¯ç”¨<code>Erlang</code>è¯­è¨€ç¼–å†™çš„ï¼Œæˆ‘ä»¬å°†å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„<code>Erlang</code>åˆ°æœåŠ¡å™¨ä¸­ã€‚ <code>Erlang</code>åœ¨é»˜è®¤çš„<code>YUM</code>å­˜å‚¨åº“ä¸­ä¸å¯ç”¨ï¼Œå› æ­¤æ‚¨å°†éœ€è¦å®‰è£…<code>EPEL</code>å­˜å‚¨åº“ã€‚ è¿è¡Œä»¥ä¸‹å‘½ä»¤ç›¸åŒã€‚ åšå¥½<code>hosts</code>è§£æï¼Œ<!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾ç«¯å£<!-- raw HTML omitted --><code>port 25672</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y update
</span></span><span style="display:flex;"><span>$ yum -y install epel-release
</span></span><span style="display:flex;"><span>$ yum -y install erlang socat</span></span></code></pre></div></blockquote>
<ul>
<li><code>RabbitMQ</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>RabbitMQ</code>ä¸ºé¢„ç¼–è¯‘å¹¶å¯ä»¥ç›´æ¥å®‰è£…çš„ä¼ä¸š<code>Linuxç³»</code>ç»Ÿæä¾›<code>RPM</code>è½¯ä»¶åŒ…ã€‚ å”¯ä¸€éœ€è¦çš„ä¾èµ–æ˜¯å°†<code>Erlang</code>å®‰è£…åˆ°ç³»ç»Ÿä¸­ã€‚ æˆ‘ä»¬å·²ç»å®‰è£…<code>äº†Erlang</code>ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ä¸‹è½½<code>RabbitMQ</code>ã€‚
é€šè¿‡è¿è¡Œä¸‹è½½<code>Erlang RPM</code>è½¯ä»¶åŒ…</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm --import https://www.rabbitmq.com/rabbitmq-release-signing-key.asc
</span></span><span style="display:flex;"><span>$ wget https://www.rabbitmq.com/releases/rabbitmq-server/v3.6.10/rabbitmq-server-3.6.10-1.el7.noarch.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ rpm -Uvh rabbitmq-server-3.6.10-1.el7.noarch.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.7.19/rabbitmq-server-3.7.19-1.el7.noarch.rpm</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.7.19/rabbitmq-server-3.7.19-1.el7.noarch.rpm.asc</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¼€å¯ç¬¬ä¸€å°<!-- raw HTML omitted --><code>MQ</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start rabbitmq-server</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¤åˆ¶<!-- raw HTML omitted --><code>.erlang.cookie</code><!-- raw HTML omitted -->æ–‡ä»¶åˆ°å…¶ä»–ä¸¤å°<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->æœåŠ¡å™¨é›†ç¾¤èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ scp /var/lib/rabbitmq/.erlang.cookie rabbit-mq-02:/var/lib/rabbitmq/
</span></span><span style="display:flex;"><span>$ scp /var/lib/rabbitmq/.erlang.cookie rabbit-mq-03:/var/lib/rabbitmq/</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨å…¶ä»–ä¸¤å°é›†ç¾¤èŠ‚ç‚¹æœåŠ¡å™¨ä¸Šçš„<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chown -R rabbitmq. /var/lib/rabbitmq
</span></span><span style="display:flex;"><span>$ systemctl start rabbitmq-server</span></span></code></pre></div></blockquote>
<ul>
<li><code>Rabbitmq</code><!-- raw HTML omitted -->é›†ç¾¤è¿æ¥ã€é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´é˜²ç«å¢™å¼€å¯ï¼š<!-- raw HTML omitted --><code>4369</code><!-- raw HTML omitted -->ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl stop_app
</span></span><span style="display:flex;"><span>$ rabbitmqctl join_cluster rabbit@rabbit-mq-01
</span></span><span style="display:flex;"><span>$ rabbitmqctl start_app</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®é•œåƒæ¨¡å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl cluster_status
</span></span><span style="display:flex;"><span>$ rabbitmqctl set_policy ha-all <span style="color:#e6db74">&#34;^&#34;</span> <span style="color:#e6db74">&#39;{&#34;ha-mode&#34;:&#34;all&#34;}&#39;</span>
</span></span><span style="display:flex;"><span>$ rabbitmqctl cluster_status</span></span></code></pre></div></blockquote>
<ul>
<li>è®¾ç½®èŠ‚ç‚¹ä¿¡æ¯<!-- raw HTML omitted -->å†…å­˜èŠ‚ç‚¹ã€ç£ç›˜èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl stop_app
</span></span><span style="display:flex;"><span>$ rabbitmqctl change_cluster_node_type ram  	<span style="color:#75715e"># ç±»å‹(ram å†…å­˜)ã€(disc ç¡¬ç›˜)å»¶è¿Ÿæ’ä»¶å¿…é¡»ç¡¬ç›˜</span>
</span></span><span style="display:flex;"><span>$ rabbitmqctl start_app</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨æ‰€æœ‰èŠ‚ç‚¹æœºå™¨ä¸Šå¼€å¯<!-- raw HTML omitted --><code>rabbit</code><!-- raw HTML omitted -->ç›‘æ§<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmq-plugins enable rabbitmq_management</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="rabbitmqç”¨æˆ·æˆæƒ"><code>Rabbitmq</code>ç”¨æˆ·æˆæƒ</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ ç”¨æˆ·ã€ç”¨æˆ·å¯†ç éƒ½æ˜¯ï¼š<!-- raw HTML omitted --><code>admin</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl add_user admin admin</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>permissions</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl set_permissions -p <span style="color:#e6db74">&#34;/&#34;</span> admin <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®ç”¨æˆ·è§’è‰²æƒé™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl set_user_tags admin administrator</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é˜²ç«å¢™å¼€å¯ï¼š<!-- raw HTML omitted --><code>15672</code><!-- raw HTML omitted -->ç«¯å£ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ http://IP:15672/</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="rabbitmqå®‰è£…å»¶æ—¶æ’ä»¶"><code>RabbitMQ</code>å®‰è£…å»¶æ—¶æ’ä»¶</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ‡æ¢å®‰è£…<!-- raw HTML omitted --><code>Rabbitmq</code><!-- raw HTML omitted -->æœåŠ¡ä¸»ç›®å½•<!-- raw HTML omitted --><code>plugins</code><!-- raw HTML omitted -->ä¸‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/lib/rabbitmq/lib/rabbitmq_server-3.6.10/plugins</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½å»¶æ—¶æ’ä»¶å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://dl.bintray.com/rabbitmq/community-plugins/3.6.x/rabbitmq_delayed_message_exchange/&gt; rabbitmq_delayed_message_exchange-20171215-3.6.x.zip</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è§£å‹å»¶æ—¶æ’ä»¶å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install unzip
</span></span><span style="display:flex;"><span>$ unzip  rabbitmq_delayed_message_exchange-20171215-3.6.x.zip
</span></span><span style="display:flex;"><span>$ cd ../sbin
</span></span><span style="display:flex;"><span>$ ./rabbitmq-plugins enable rabbitmq_delayed_message_exchange</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é‡å¯<!-- raw HTML omitted --><code>Rabitymq</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl restart rabbitmq-server</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="haproxyéƒ¨ç½²"><code>HAProxy</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li>ä½¿ç”¨<code>HAProxy</code>ä½¿<code>Rabbitmq</code>æœåŠ¡å®ç°é«˜å¯ç”¨</li>
<li><!-- raw HTML omitted -->ä¸¤å°æœåŠ¡å™¨éƒ½å®‰è£…<!-- raw HTML omitted --><code>HAProxy</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th><code>IP</code></th>
<th>ä¸»æœºå</th>
<th>èŠ‚ç‚¹å±æ€§</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.150.21</td>
<td><code>rabbit-mq-01</code></td>
<td>å†…å­˜èŠ‚ç‚¹+<code>Haproxy</code>èŠ‚ç‚¹ï¼Œ<!-- raw HTML omitted -->ç«¯å£ï¼š8888(<code>haproxy</code>ç›‘æ§ç«¯å£)ã€8889(<code>rabbitmq</code>&gt; æœåŠ¡ç«¯å£)<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>192.168.150.22</td>
<td><code>rabbit-mq-02</code></td>
<td>å†…å­˜èŠ‚ç‚¹+<code>Haproxy</code>èŠ‚ç‚¹ï¼Œ<!-- raw HTML omitted -->ç«¯å£ï¼š8888(<code>haproxy</code>ç›‘æ§ç«¯å£)ã€8889(<code>rabbitmq</code>&gt; æœåŠ¡ç«¯å£)<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y haproxy </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/haproxy/haproxy.cfg<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # log /yougo/haproxy/home/log    local0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # log /yougo/haproxy/home/log    local1 notice
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # chroot /yougo/haproxy         # æ”¹å˜å½“å‰å·¥ä½œç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # stats socket /yougo/haproxy/home/admin.sock mode 660 level admin   # åˆ›å»ºç›‘æ§æ‰€ç”¨çš„å¥—æ¥å­—ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> pidfile  /var/run/haproxy.pid   # haproxyçš„pidå­˜æ”¾è·¯å¾„,å¯åŠ¨è¿›ç¨‹çš„ç”¨æˆ·å¿…é¡»æœ‰æƒé™è®¿é—®æ­¤æ–‡ä»¶ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> maxconn  4000                   # æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤4000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  user   haproxy               # é»˜è®¤ç”¨æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  group   haproxy              # é»˜è®¤ç”¨æˆ·ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> daemon                          # åˆ›å»º1ä¸ªè¿›ç¨‹è¿›å…¥deamonæ¨¡å¼è¿è¡Œã€‚æ­¤å‚æ•°è¦æ±‚å°†è¿è¡Œæ¨¡å¼è®¾ç½®ä¸º&#34;daemon
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # Default SSL material locations
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ca-base /etc/ssl/certs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # crt-base /etc/ssl/private
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # Default ciphers to use on SSL-enabled listening sockets.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # For more information, see ciphers(1SSL). This list is from:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ssl-default-bind-ciphers &gt; ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ssl-default-bind-options no-sslv3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">###########é»˜è®¤é…ç½®#########
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaults
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> log global
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mode    http                # é»˜è®¤çš„æ¨¡å¼mode { tcp|http|health }ï¼Œtcpæ˜¯4å±‚ï¼Œhttpæ˜¯7å±‚ï¼Œhealthåªä¼šè¿”å›OK
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  httplog             # é‡‡ç”¨httpæ—¥å¿—æ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  dontlognull         # å¯ç”¨è¯¥é¡¹ï¼Œæ—¥å¿—ä¸­å°†ä¸ä¼šè®°å½•ç©ºè¿æ¥ã€‚æ‰€è°“ç©ºè¿æ¥å°±æ˜¯åœ¨ä¸Šæ¸¸çš„è´Ÿè½½å‡è¡¡å™¨æˆ–è€…ç›‘æ§ç³»ç»Ÿä¸ºäº†æ¢æµ‹è¯¥æœåŠ¡æ˜¯å¦å­˜æ´»å¯ç”¨æ—¶,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                             # éœ€è¦å®šæœŸçš„è¿æ¥æˆ–è€…è·å–æŸä¸€å›ºå®šçš„ç»„ä»¶æˆ–é¡µé¢,æˆ–è€…æ¢æµ‹æ‰«æç«¯å£æ˜¯å¦åœ¨ç›‘å¬æˆ–å¼€æ”¾ç­‰åŠ¨ä½œè¢«ç§°ä¸ºç©ºè¿æ¥;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                             # å®˜æ–¹æ–‡æ¡£ä¸­æ ‡æ³¨ï¼Œå¦‚æœè¯¥æœåŠ¡ä¸Šæ¸¸æ²¡æœ‰å…¶ä»–çš„è´Ÿè½½å‡è¡¡å™¨çš„è¯ï¼Œå»ºè®®ä¸è¦ä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                             # è¯¥å‚æ•°ï¼Œå› ä¸ºäº’è”ç½‘ä¸Šçš„æ¶æ„æ‰«ææˆ–å…¶ä»–åŠ¨ä½œå°±ä¸ä¼šè¢«è®°å½•ä¸‹æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout connect 5000        # è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout client  50000       # å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout server  50000       # æœåŠ¡å™¨ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  httpclose        # æ¯æ¬¡è¯·æ±‚å®Œæ¯•åä¸»åŠ¨å…³é—­httpé€šé“ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  httplog          # æ—¥å¿—ç±»åˆ«httpæ—¥å¿—æ ¼å¼ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #option  forwardfor      # å¦‚æœåç«¯æœåŠ¡å™¨éœ€è¦è·å¾—å®¢æˆ·ç«¯çœŸå®ipéœ€è¦é…ç½®çš„å‚æ•°ï¼Œå¯ä»¥ä»Http Headerä¸­è·å¾—å®¢æˆ·ç«¯ip  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  redispatch       # serverIdå¯¹åº”çš„æœåŠ¡å™¨æŒ‚æ‰å,å¼ºåˆ¶å®šå‘åˆ°å…¶ä»–å¥åº·çš„æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout connect 10000    # default 10 second timeout if a backend is not found
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> maxconn     60000        # æœ€å¤§è¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> retries     3            # 3æ¬¡è¿æ¥å¤±è´¥å°±è®¤ä¸ºæœåŠ¡ä¸å¯ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åé¢è®¾ç½® 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 400 /yougo/haproxy/home/errors/400.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 403 /yougo/haproxy/home/errors/403.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 408 /yougo/haproxy/home/errors/408.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 500 /yougo/haproxy/home/errors/500.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 502 /yougo/haproxy/home/errors/502.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 503 /yougo/haproxy/home/errors/503.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 504 /yougo/haproxy/home/errors/504.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">####################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listen http_front
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     bind 0.0.0.0:8888           # ç›‘å¬ç«¯å£  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats refresh 30s           # ç»Ÿè®¡é¡µé¢è‡ªåŠ¨åˆ·æ–°æ—¶é—´  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats uri /haproxy?stats    # ç»Ÿè®¡é¡µé¢url  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats realm Haproxy Manager # ç»Ÿè®¡é¡µé¢å¯†ç æ¡†ä¸Šæç¤ºæ–‡æœ¬  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats auth admin:admin      # ç»Ÿè®¡é¡µé¢ç”¨æˆ·åå’Œå¯†ç è®¾ç½®  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     #stats hide-version         # éšè—ç»Ÿè®¡é¡µé¢ä¸ŠHAProxyçš„ç‰ˆæœ¬ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#####################RabbitMQçš„ç®¡ç†ç•Œé¢ä¹Ÿæ”¾åœ¨HAProxyåé¢äº†###############################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#listen rabbitmq_admin 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#    bind 0.0.0.0:8004
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#   server node1 192.168.0.31:15672
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#    server node2 192.168.0.32:15672
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#    server node3 192.168.0.33:15672
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">####################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listen rabbitmq_cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> bind 0.0.0.0:8889  	# rabbitmqé›†ç¾¤è°ƒç”¨çš„ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option tcplog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mode tcp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout client  3h
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout server  3h
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option          clitcpka
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> balance roundrobin  	# è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ˆ#banlance roundrobin è½®è¯¢ï¼Œbalance source ä¿å­˜sessionå€¼ï¼Œæ”¯æŒstatic-rrï¼Œleastconnï¼Œfirstï¼Œuriç­‰å‚æ•°ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance url_param userid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance url_param session_id check_post 64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance hdr(User-Agent)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance hdr(host)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance hdr(Host) use_domain_only
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance rdp-cookie
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance leastconn
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance source //ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server   rabbitmq1  172.16.0.30:5672 check inter 5s rise 2 fall 3  	# check inter 2000 æ˜¯æ£€æµ‹å¿ƒè·³é¢‘ç‡ï¼Œrise &gt; 2æ˜¯2æ¬¡æ­£ç¡®è®¤ä¸ºæœåŠ¡å™¨å¯ç”¨ï¼Œfall 3æ˜¯3æ¬¡å¤±è´¥è®¤ä¸ºæœåŠ¡å™¨ä¸å¯ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server   rabbitmq2  172.16.0.31:5672 check inter 5s rise 2 fall 3  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server   rabbitmq3  172.16.0.32:5672 check inter 5s rise 2 fall 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸¤å°<!-- raw HTML omitted --><code>HAProxy</code><!-- raw HTML omitted -->æœåŠ¡å™¨å¯åŠ¨æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start haproxy</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="keepalivedéƒ¨ç½²"><code>Keepalived</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y keepalived</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->ä¸»èŠ‚ç‚¹<!-- raw HTML omitted --><code>Master</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global_defs {  	# å…¨å±€é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email {  	# æŒ‡å®škeepalivedåœ¨å‘ç”Ÿåˆ‡æ¢æ—¶éœ€è¦éœ€è¦å‘é€Emailçš„å¯¹è±¡ï¼Œä¸€è¡Œä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   user@example.com  	# æŒ‡å®šçš„æ”¶ä»¶äºº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email_from mail@example.org  	# æŒ‡å®šçš„å‘ä»¶äºº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_server 192.168.200.1  	# æŒ‡å®šçš„SMTPæœåŠ¡å™¨åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_connect_timeout 30  	# æŒ‡å®šSMTPè¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">router_id Rabbitmq_Dev  	# æ­¤å¤„æ³¨æ„router_idä¸ºè´Ÿè½½å‡è¡¡æ ‡è¯†ï¼Œåœ¨å±€åŸŸç½‘å†…åº”è¯¥æ˜¯å”¯ä¸€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vrrp_instance VI_1 {  	# ç›‘æ§å¤šä¸ªç½‘æ®µçš„å®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> state MASTER  	# æŒ‡å®šKeepalivedçš„è§’è‰²ï¼ŒMASTERè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯ä¸»æœåŠ¡å™¨,BACKUPè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯å¤‡ç”¨æœåŠ¡å™¨ï¼Œæ‰€ä»¥è®¾ç½®priorityæ—¶è¦æ³¨æ„MASTERæ¯”BACKUPé«˜ã€‚å¦‚&gt; æœè®¾ç½®äº†nopreempt,é‚£ä¹ˆstateçš„è¿™ä¸ªå€¼ä¸èµ·ä½œç”¨ï¼Œä¸»å¤‡é priorityå†³å®šï¼Œå¿…é¡»å¤§å†™
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nopreempt  	# è®¾ç½®ä¸ºä¸æŠ¢å 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> interface eth0  	# æŒ‡å®šç›‘æµ‹ç½‘ç»œçš„æ¥å£ï¼Œå½“LVSæ¥ç®¡æ—¶ï¼Œå°†ä¼šæŠŠIPåœ°å€æ·»åŠ åˆ°è¯¥ç½‘å¡ä¸Šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> virtual_router_id 58  	# è™šæ‹Ÿè·¯ç”±æ ‡è¯†ï¼ŒåŒä¸€ä¸ªvrrpå®ä¾‹ä½¿ç”¨å”¯ä¸€çš„æ ‡è¯†ï¼ŒåŒä¸€ä¸ªvrrp_instanceä¸‹ï¼ŒMASTERå’ŒBACKUPå¿…é¡»ä¸€è‡´ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> priority 101  	# MASTERæƒé‡è¦é«˜äº   BACKUP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> advert_int 1  	# å¿ƒè·³æŠ¥æ–‡å‘é€é—´éš”
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> unicast_src_ip 192.168.150.21  	# é…ç½®å•æ’­çš„æºåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> unicast_peer { 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     192.168.150.22  	# é…ç½®å•æ’­çš„ç›®æ ‡åœ°å€ã€å¯¹ç«¯IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }  	# keepalivedåœ¨ç»„æ’­æ¨¡å¼ä¸‹æ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šå‘224.0.0.18çš„ç»„æ’­åœ°å€å‘é€ï¼Œäº§ç”Ÿä¼—å¤šçš„æ— ç”¨ä¿¡æ¯ï¼Œå¹¶ä¸”ä¼šäº§ç”Ÿå¹²æ‰°å’Œå†²çªï¼Œå¯ä»¥å°†ç»„æ’­çš„æ¨¡å¼æ”¹ä¸ºå•æ‹¨ã€‚è¿™æ˜¯ä¸€ç§å®‰&gt; å…¨çš„æ–¹æ³•ï¼Œé¿å…å±€åŸŸç½‘å†…æœ‰å¤§é‡çš„keepalivedé€ æˆè™šæ‹Ÿè·¯ç”±idçš„å†²çªã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> authentication {  	# è®¤è¯é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth_type PASS  	# ä¸»ä»æœåŠ¡å™¨éªŒè¯æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth_pass 1111  	# è®¤è¯å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> virtual_ipaddress {  	# è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªè™šæ‹ŸIPåœ°å€ï¼Œæ¯è¡Œä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     192.168.150.24/24 dev eth1 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> track_interface {  	# è®¾ç½®é¢å¤–çš„ç›‘æ§ï¼Œé‡Œé¢é‚£ä¸ªç½‘å¡å‡ºç°é—®é¢˜éƒ½ä¼šåˆ‡æ¢
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     eth0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->å¤‡ç”¨èŠ‚ç‚¹<!-- raw HTML omitted --><code>Backup</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global_defs {  	# å…¨å±€é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email {  	# æŒ‡å®šåœ¨keepalivedåœ¨å‘ç”Ÿåˆ‡æ¢æ—¶éœ€è¦å‘é€Emailçš„å¯¹è±¡ï¼Œä¸€è¡Œä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    user@example.com  	# æŒ‡å®šæ”¶ä»¶äºº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email_from mail@example.org  	# æŒ‡å®šå‘ä»¶äºº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_server 192.168.200.1  	# æŒ‡å®šSMTPæœåŠ¡å™¨åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_connect_timeout 30  	# æŒ‡å®šSMTPè¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">router_id Rabbitmq_Dev  	# æ­¤å¤„æ³¨æ„router_idä¸ºè´Ÿè½½å‡è¡¡è¡¨ç¤ºï¼Œåœ¨å±€åŸŸç½‘åº”è¯¥æ˜¯å”¯ä¸€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vrrp_instance VI_1 {  	# ç›‘æ§å¤šä¸ªç½‘æ®µå®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> state BACKUP  	# æŒ‡å®šKeepalivedçš„è§’è‰²ï¼ŒMASTERè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯ä¸»æœåŠ¡å™¨,BACKUPè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯å¤‡ç”¨æœåŠ¡å™¨ï¼Œæ‰€ä»¥è®¾ç½®priorityæ—¶è¦æ³¨æ„MASTERæ¯”BACKUPé«˜ã€‚å¦‚&gt; æœè®¾ç½®äº†nopreempt,é‚£ä¹ˆstateçš„è¿™ä¸ªå€¼ä¸èµ·ä½œç”¨ï¼Œä¸»å¤‡é priorityå†³å®šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nopreempt  	# è®¾ç½®ä¸ºä¸æŠ¢å  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> interface eth0  	# è®¾ç½®å®ä¾‹ç»‘å®šçš„ç½‘å¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> virtual_router_id 58  	# è™šæ‹Ÿè·¯ç”±æ ‡è¯†ï¼ŒåŒä¸€ä¸ªvrrpå®ä¾‹ä½¿ç”¨å”¯ä¸€çš„æ ‡è¯†ï¼ŒåŒä¸€ä¸ªvrrp_instanceä¸‹ï¼ŒMASTERå’ŒBACKUPå¿…é¡»ä¸€è‡´ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> priority 100  	# æƒé‡è¦ä½äºMASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> advert_int 1  	# å¿ƒè·³æŠ¥æ–‡å‘é€é—´éš”ã€æ£€æŸ¥é—´éš”é»˜è®¤1ç§’
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> unicast_src_ip 192.168.150.22  	# é…ç½®å•æ’­çš„æºåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> unicast_peer { 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     192.168.150.21  	# é…ç½®å•æ’­çš„ç›®æ ‡åœ°å€ã€å¯¹ç«¯IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }  	# keepalivedåœ¨ç»„æ’­æ¨¡å¼ä¸‹æ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šå‘224.0.0.18çš„ç»„æ’­åœ°å€å‘é€ï¼Œäº§ç”Ÿä¼—å¤šçš„æ— ç”¨ä¿¡æ¯ï¼Œå¹¶ä¸”ä¼šäº§ç”Ÿå¹²æ‰°å’Œå†²çªï¼Œå¯ä»¥å°†ç»„æ’­çš„æ¨¡å¼æ”¹ä¸ºå•æ‹¨ã€‚è¿™æ˜¯ä¸€ç§å®‰&gt; å…¨çš„æ–¹æ³•ï¼Œé¿å…å±€åŸŸç½‘å†…æœ‰å¤§é‡çš„keepalivedé€ æˆè™šæ‹Ÿè·¯ç”±idçš„å†²çªã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> authentication {  	# è®¾ç½®è®¤è¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth_type PASS  	# è®¤è¯æ–¹å¼æœ‰ä¸¤ç§PASSã€AHä¸¤ç§
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth_pass 1111  	# è®¤è¯å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # VIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> virtual_ipaddress {  	# è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªè™šæ‹ŸIPåœ°å€ï¼Œæ¯è¡Œä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     192.168.150.24/24 dev eth1 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start keepalived</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="å…è®¸ç»„æ’­ç½‘æ®µå’Œvrrpåè®®é€šä¿¡">å…è®¸ç»„æ’­ç½‘æ®µå’Œ<code>vrrp</code>åè®®é€šä¿¡</h4>
<blockquote>
<ul>
<li><code>centos7 firewalld</code>å¼€å¯æƒ…å†µä¸‹ï¼Œä¼šé˜»æ–­ç»„æ’­å’Œ<code>vrrp</code>çš„åè®®é€šä¿¡ï¼Œå¯¼è‡´<code>Keepalived</code>è„‘è£‚æƒ…å†µï¼Œéœ€è¦åœ¨<code>keepalived</code>çš„ä¸¤å°æœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°±å¯ä»¥æ­£å¸¸é€šä¿¡</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT <span style="color:#ae81ff">0</span> --in-interface ç½‘å¡åç§°<span style="color:#f92672">(</span>eth0<span style="color:#f92672">)</span> --destination 224.0.0.18 --protocol &gt; vrrp -j ACCEPT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç›‘æ§ç½‘ç»œåè®®ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰è„‘è£‚æƒ…å†µ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tcpdump -i ç½‘å¡åç§°<span style="color:#f92672">(</span>eth0<span style="color:#f92672">)</span> vrrp -n</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>python</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>pika</code><!-- raw HTML omitted -->åŒ…è¿›è¡Œæµ‹è¯•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y python-pip
</span></span><span style="display:flex;"><span>$ pip install pika</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç”Ÿäº§ç«¯ç¨‹åºè„šæœ¬<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;Production.py<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># !/usr/bin/env python
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import pika
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">credentials = pika.PlainCredentials(&#39;admin&#39;,&#39;admin&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">connection = pika.BlockingConnection(pika.ConnectionParameters(
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#39;192.168.150.21&#39;,8889,&#39;/&#39;,credentials))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel = connection.channel()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel.queue_declare(queue=&#39;balance&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel.basic_publish(exchange=&#39;&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   routing_key=&#39;balance&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   body=&#39;Hello World!&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">print(&#34; [x] Sent &#39;Hello World!&#39;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">connection.close()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ¶ˆè´¹ç«¯ç¨‹åºè„šæœ¬<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;Consumption.py<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># !/usr/bin/env python
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import pika
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">credentials = pika.PlainCredentials(&#39;admin&#39;,&#39;admin&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">connection = pika.BlockingConnection(pika.ConnectionParameters(
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#39;192.168.150.21&#39;,8889,&#39;/&#39;,credentials))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel = connection.channel()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel.queue_declare(queue=&#39;balance&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel.basic_publish(exchange=&#39;&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   routing_key=&#39;balance&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   body=&#39;Hello World!&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">print(&#34; [x] Sent &#39;Hello World!&#39;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">connection.close()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_nsq">Install_Nsq</h1>

<h2 id="nsqéƒ¨ç½²"><code>nsq</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><a href="https://nsq.io/deployment/installing.html" rel="external" target="_self"><code>Nsq</code>å®˜ç½‘</a></li>
<li><!-- raw HTML omitted -->ä¸‹è½½<!-- raw HTML omitted --><code>nsq</code><!-- raw HTML omitted -->é¢„ç¼–è¯‘äºŒè¿›åˆ¶å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://s3.amazonaws.com/bitly-downloads/nsq/nsq-1.2.1.linux-amd64.go1.16.6.tar.gz</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è§£å‹å¯åŠ¨å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tar -zxvf nsq-1.2.1.linux-amd64.go1.16.6.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>$ cd nsq-1.2.1.linux-amd64.go1.16.6/bin/
</span></span><span style="display:flex;"><span>$ nohup ./nsqlookupd &amp;  	<span style="color:#75715e"># å¯åŠ¨nsqlookup</span>
</span></span><span style="display:flex;"><span>$ nohup ./nsqd --lookupd-tcp-address<span style="color:#f92672">=</span>127.0.0.1:4160 &amp;  	<span style="color:#75715e"># nsqd</span>
</span></span><span style="display:flex;"><span>$ nohup ./nsqadmin --lookupd-http-address<span style="color:#f92672">=</span>0.0.0.0:4161 --http-address<span style="color:#f92672">=</span>IP:8761 &amp; <span style="color:#75715e"># nsqadminç®¡ç†ï¼Œipéœ€è¦æ›´æ¢ä¸ºæœåŠ¡æ‰€åœ¨çš„æœåŠ¡å™¨IP</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æµ‹è¯•ã€è®¿é—®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -d <span style="color:#e6db74">&#39;hello world 1&#39;</span> <span style="color:#e6db74">&#39;http://127.0.0.1:4151/pub?topic=test&#39;</span>  	<span style="color:#75715e"># å†™å…¥æ¶ˆæ¯</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./nsq_to_file --topic<span style="color:#f92672">=</span>test --output-dir<span style="color:#f92672">=</span>/tmp/log --lookupd-http-address<span style="color:#f92672">=</span>127.0.0.1:4161  	<span style="color:#75715e"># æŠŠé˜Ÿåˆ—æ¶ˆæ¯å†™å…¥åˆ°æ–‡ä»¶</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é€šè¿‡æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted -->nsqadmin</li>
</ul>
<blockquote>
<ul>
<li><code>http://IP:8761/</code></li>
</ul>
</blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_kafka">Install_Kafka</h1>

<h2 id="kafkaéƒ¨ç½²"><code>Kafka</code>éƒ¨ç½²</h2>
<h3 id="kafkaç®€ä»‹"><code>Kafka</code>ç®€ä»‹</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://kafka.apache.org/" rel="external" target="_self"><code>Kafka</code>å®˜ç½‘</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://segmentfault.com/a/1190000012730949" rel="external" target="_self">å®‰è£…åŠå¿«é€Ÿå…¥é—¨</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/gwyy/p/12206176.html" rel="external" target="_self"><code>php</code>å®‰è£…<code>kafka</code>æ‰©å±•</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://qii404.me/2018/02/02/kafka-cluster.html" rel="external" target="_self"><code>Kafka</code>é›†ç¾¤æ­å»ºè¿‡ç¨‹å’Œç®€å•ä½¿ç”¨</a></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>zookeeper</code><!-- raw HTML omitted -->ä¿å­˜æ‰€æœ‰é›†ç¾¤ä¸»æœºæ¶ˆæ¯å†…å®¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¼€å‘è¯­è¨€ï¼š<!-- raw HTML omitted --><code>Java/Scala</code><!-- raw HTML omitted -->ï¼Œæ”¯æŒåè®®ï¼šä»¿<!-- raw HTML omitted --><code>AMQP</code></li>
<li><code>Kafka</code>æ˜¯åˆ†å¸ƒå¼å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ,å®ƒæœ€åˆç”±<code>LinkedIn</code>å…¬å¸å¼€å‘ï¼Œä¹‹åæˆä¸º<code>Apache</code>é¡¹ç›®çš„ä¸€éƒ¨åˆ†</li>
<li><code>Kafka</code>æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œå¯åˆ’åˆ†çš„ï¼Œå†—ä½™å¤‡ä»½çš„æŒä¹…æ€§çš„æ—¥å¿—æœåŠ¡ï¼Œå®ƒä¸»è¦ç”¨äºå¤„ç†æ´»è·ƒçš„æµå¼æ•°æ®</li>
<li>äº‹åŠ¡å¤„ç†ä¸æ”¯æŒã€æ”¯æŒé›†ç¾¤ã€æ”¯æŒè´Ÿè½½å‡è¡¡ã€æ”¯æŒ<code>zookeeper</code>åŠ¨æ€æ‰©å®¹</li>
<li>æ‰€æœ‰æ¶ˆæ¯è‡ªåŠ¨ä¿å­˜ä¸¤å¤©æ—¶é—´</li>
<li><code>Kafka</code>ä¸ºäº†é¿å…éšæœºå†™å…¥å¸¦æ¥çš„æ—¶é—´æ¶ˆè€—ï¼Œé‡‡å–é¡ºåºå†™çš„æ–¹å¼å­˜å‚¨æ•°æ®</li>
<li><code>Kafka</code>é‡‡ç”¨é›¶æ‹·è´æŠ€æœ¯ï¼Œè®©æ•°æ®ä¼ è¾“æ›´åŠ è¿…é€Ÿ</li>
<li>æ‰¹é‡è¯»ä¹¦æ•°æ®ï¼Œå‡å°‘ç£ç›˜<code>IO</code>æ“ä½œï¼Œå¯ä»¥æå‡æ€§èƒ½</li>
<li>ä¸ºäº†ä¿è¯å†å²æ¶ˆæ¯ç»§ç»­å¯ä»¥è¢«æ¶ˆè´¹ï¼Œæä¾›ä¸€ä¸ª<code>offset</code>æŒ‡å‘ï¼Œé€šè¿‡æŒ‡å‘æ¥è´Ÿè´£æ¶ˆæ¯è¯»å–é¡ºåº</li>
<li>ç½‘ç»œä¼ è¾“é‡‡ç”¨æ•°æ®å‹ç¼©æ ¼å¼ï¼Œæ‰€ä»¥ä¼ è¾“æ›´å¿«ï¼Œå ç”¨å¸¦å®½è¶Šå°‘</li>
<li><code>Kafka</code>ä¸­æ•°æ®å¯ä»¥è®¾ç½®å‰¯æœ¬ï¼Œå¯ä»¥åœ¨å‡ºç°é—®é¢˜ä¹‹åä¾ç„¶ä¿è¯è¯¥æ•°æ®çš„æœ‰æ•ˆæ€§</li>
<li><code>Kafka</code><!-- raw HTML omitted -->æ•´ä½“é‡‡ç”¨æ˜¾ç¤ºåˆ†å¸ƒå¼æ¶æ„ï¼Œ<!-- raw HTML omitted --><code>producers</code>ã€<code>broker(Kafka)</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>consumers</code><!-- raw HTML omitted -->éƒ½å¯ä»¥æœ‰å¤šä¸ª<!-- raw HTML omitted --></li>
<li><code>producer</code>ã€<code>consumer</code><!-- raw HTML omitted -->å®ç°<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->æ³¨å†Œçš„æ¥å£ï¼Œæ•°æ®ä»<!-- raw HTML omitted --><code>producer</code><!-- raw HTML omitted -->å‘é€åˆ°<!-- raw HTML omitted --><code>broker</code>ï¼Œ<code>broker</code><!-- raw HTML omitted -->æ‰¿æ‹…ä¸€ä¸ªä¸­é—´ç¼“å­˜å’Œåˆ†å‘çš„ä½œç”¨ï¼Œ<!-- raw HTML omitted --><code>broker</code><!-- raw HTML omitted -->åˆ†å‘æ³¨å†Œåˆ°ç³»ç»Ÿä¸­çš„<!-- raw HTML omitted --><code>consumer</code></li>
<li><code>broker</code>çš„ä½œç”¨ç±»ä¼¼äºç¼“å­˜ï¼Œå³æ´»è·ƒçš„æ•°æ®å’Œç¦»çº¿å¤„ç†ç³»ç»Ÿä¹‹é—´çš„ç¼“å­˜ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šä¿¡ï¼Œæ˜¯åŸºäºç®€å•ï¼Œé«˜æ€§èƒ½ï¼Œä¸”ä¸ç¼–ç¨‹è¯­è¨€æ— å…³çš„<code>TCP</code>åè®®</li>
<li><code>Topic</code><!-- raw HTML omitted -->ï¼šç‰¹æŒ‡<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->å¤„ç†çš„æ¶ˆæ¯æº<!-- raw HTML omitted --><code>feeds of messages</code><!-- raw HTML omitted -->çš„ä¸åŒåˆ†ç±»<!-- raw HTML omitted --></li>
<li><code>Partition</code><!-- raw HTML omitted -->ï¼šä»£è¡¨åˆ†åŒºï¼Œå•æ ¸<!-- raw HTML omitted --><code>CPU</code><!-- raw HTML omitted -->ä¸€ä¸ªåˆ†åŒºï¼Œå¤šä¸ª<!-- raw HTML omitted --><code>CPU</code><!-- raw HTML omitted -->å¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºã€‚<!-- raw HTML omitted --><code>Topic</code><!-- raw HTML omitted -->ç‰©ç†ä¸Šçš„åˆ†ç»„ï¼Œä¸€ä¸ª<!-- raw HTML omitted --><code>topic</code><!-- raw HTML omitted -->å¯ä»¥åˆ†ä¸ºå¤šä¸ª<!-- raw HTML omitted --><code>partition</code><!-- raw HTML omitted -->ï¼Œæ¯ä¸ª<!-- raw HTML omitted --><code>partition</code><!-- raw HTML omitted -->æ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ï¼Œ<!-- raw HTML omitted --><code>partition</code><!-- raw HTML omitted -->ä¸­çš„æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªæœ‰åºçš„<!-- raw HTML omitted --><code>id(offset)</code></li>
<li><code>Message</code><!-- raw HTML omitted -->ï¼šæ¶ˆæ¯ï¼Œæ˜¯é€šä¿¡çš„åŸºæœ¬å•ä½ï¼Œæ¯ä¸ª<!-- raw HTML omitted --><code>producer</code><!-- raw HTML omitted -->å¯ä»¥å‘ä¸€ä¸ª<!-- raw HTML omitted --><code>topic</code><!-- raw HTML omitted -->(ä¸»é¢˜)å‘å¸ƒä¸€äº›æ¶ˆæ¯<!-- raw HTML omitted --></li>
<li><code>Producers</code><!-- raw HTML omitted -->ï¼šæ¶ˆæ¯å’Œæ•°æ®äº§ç”Ÿç€ï¼Œå‘<!-- raw HTML omitted --><code>Kafka</code>çš„ä¸€ä¸ª<code>topic</code><!-- raw HTML omitted -->å‘å¸ƒæ¶ˆæ¯çš„è¿‡ç¨‹å«åš<!-- raw HTML omitted --><code>producers</code></li>
<li><code>Consumers</code><!-- raw HTML omitted -->ï¼šæ¶ˆæ¯å’Œæ•°æ®æ¶ˆè´¹è€…ï¼Œè®¢é˜…<!-- raw HTML omitted --><code>topics</code><!-- raw HTML omitted -->å¹¶å¤„ç†å…¶å‘å¸ƒæ¶ˆæ¯çš„è¿‡ç¨‹å«åš<!-- raw HTML omitted --><code>consumers</code></li>
<li><code>Broker</code><!-- raw HTML omitted -->ï¼šç¼“å­˜ä»£ç†ï¼Œ<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->é›†ç¾¤ä¸­çš„ä¸€å°æˆ–è€…å¤šå°æœåŠ¡å™¨ç»Ÿç§°ä¸º<!-- raw HTML omitted --><code>broker</code></li>
<li><code>offset</code><!-- raw HTML omitted -->ä¸æ¶ˆæ¯è®¿é—®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>æ¶ˆè´¹è€…é€šè¿‡<code>offset</code>çš„æ–¹å¼æ¥å–å¾—æ¶ˆæ¯æ•°æ®ï¼Œåˆ©ç”¨<code>offset</code>åç§»æ”¹å˜æ¶ˆæ¯è¯»å–ä½ç½®ï¼Œå¯ä»¥å®ç°å†å²æ¶ˆæ¯è¯»å–</li>
<li>ä¸ºäº†é¿å…é¢‘ç¹çš„å¤§é‡å°æ•°æ®ç£ç›˜<code>IO</code>æ“ä½œï¼Œ<code>Kafka</code>é‡‡ç”¨æ‰¹é‡è¯»å–æ¨¡å¼å¤„ç†æ¶ˆæ¯</li>
<li>åœ¨é«˜è´Ÿè½½çŠ¶æ€ä¸‹ï¼Œä¸ºé˜²æ­¢æ— æ•ˆç‡çš„å­—èŠ‚å¤åˆ¶ï¼Œ<code>Kafka</code><!-- raw HTML omitted -->é‡‡ç”¨ç”±<!-- raw HTML omitted --><code>Producer</code>ï¼Œ<code>broker</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>consumer</code>å…±äº«çš„æ ‡å‡†åŒ–äºŒè¿›åˆ¶æ¶ˆæ¯æ ¼å¼ï¼Œè¿™æ ·æ•°æ®åº“å°±å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´è‡ªç”±ä¼ è¾“ï¼Œæ— éœ€è½¬æ¢ï¼Œé™ä½äº†å­—èŠ‚å¤åˆ¶æˆæœ¬å¼€é”€</li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<hr>
<h3 id="kafkaå›¾å½¢åŒ–é¡µé¢"><code>Kafka</code>å›¾å½¢åŒ–é¡µé¢</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://juejin.cn/post/6971224791793532941#heading-4" rel="external" target="_self"><code>Kafka</code>å›¾å½¢åŒ–å·¥å…·<code>Eagle</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/provectus/kafka-ui" rel="external" target="_self"><code>Apache Kafka</code>çš„ç”¨æˆ·ç•Œé¢</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/obsidiandynamics/kafdrop" rel="external" target="_self"><code>Kafdrop â€“ Kafka Web UI</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/smartloli/EFAK" rel="external" target="_self"><code>Eagle For Apache Kafka</code>ä»¥å‰ç§°ä¸º<code>Kafka Eagle</code></a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="kafkaå•èŠ‚ç‚¹éƒ¨ç½²"><code>Kafka</code>å•èŠ‚ç‚¹éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><a href="https://kafka.apache.org/quickstart" rel="external" target="_self"><code>Kafka</code>å®‰è£…</a></li>
<li><!-- raw HTML omitted -->å•æœºéƒ¨ç½²å•å®ä¾‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½ã€è§£å‹<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://archive.apache.org/dist/kafka/2.8.1/kafka_2.13-2.8.1.tgz
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/srckafka_2.13-2.8.1.tgz -C /opt/
</span></span><span style="display:flex;"><span>$ cd /opt/
</span></span><span style="display:flex;"><span>$ mv kafka_2.13-2.8.1/ kafka</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å•æœºå•å®ä¾‹ä¿®æ”¹<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^dataDir=/cdataDir=\/opt\/kafka\/zookeeper&#39;</span> /opt/kafka/config/zookeeper.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^broker.id=/cbroker.id=1&#39;</span> /opt/kafka/config/server.properties  	<span style="color:#75715e"># é›†ç¾¤è®¾ç½®ä¸åŒid</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^log.dirs=/clog.dirs=/opt/kafka/logs/logs-1&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Kafkaé»˜è®¤ç«¯å£å·ï¼š9092ï¼Œå¦‚æœè¦ä¿®æ”¹é»˜è®¤ç«¯å£æ‰§è¡Œä¸‹é¢ä¸¤æ¡å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/#advertised.listeners/a port=9095&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/#advertised.listeners/a advertised.listeners=PLAINTEXT://$IP:9095&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mkdir -p /opt/kafka/<span style="color:#f92672">{</span>zookeeper,logs<span style="color:#f92672">}</span>  	<span style="color:#75715e"># åˆ›å»ºæŒä¹…åŒ–ç›®å½•</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å•æœºå¯åŠ¨å•å®ä¾‹<!-- raw HTML omitted --><code>zookeeper</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>Kafka</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/kafka/bin/zookeeper-server-start.sh -daemon /opt/kafka/config/zookeeper.properties  	<span style="color:#75715e"># åå°å¯åŠ¨zookeeperè¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server.properties</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ‰§è¡Œæ£€æŸ¥å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ jps
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">14050</span> Kafka
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10042</span> QuorumPeerMain
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">15724</span> Jps</span></span></code></pre></div><p><a href="#R-image-cc305a4ca205fa71ba16cd72862a5ef7" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kafka_Server/jps.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cc305a4ca205fa71ba16cd72862a5ef7"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kafka_Server/jps.png"></a></p>
</blockquote>
</blockquote>
<hr>
<h3 id="kafkaå•èŠ‚ç‚¹å¤šå®ä¾‹"><code>Kafka</code>å•èŠ‚ç‚¹å¤šå®ä¾‹</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å•æœºéƒ¨ç½²å¤šå®ä¾‹é›†ç¾¤æ¨¡å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^dataDir=/cdataDir=\/opt\/kafka\/zookeeper&#39;</span> /opt/kafka/config/zookeeper.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‹·è´ä¿®æ”¹kafkaé…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cp /opt/kafka/config/server.properties /opt/kafka/config/server-2.properties
</span></span><span style="display:flex;"><span>$ cp /opt/kafka/config/server.properties /opt/kafka/config/server-3.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ç¬¬ä¸€ä¸ªå®ä¾‹é…ç½®</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^broker.id=/cbroker.id=1&#39;</span> /opt/kafka/config/server.properties  <span style="color:#75715e"># é›†ç¾¤è®¾ç½®ä¸åŒid</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^log.dirs=/clog.dirs=/opt/kafka/logs/logs-1&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/#advertised.listeners/a advertised.listeners=PLAINTEXT://$IP:9092&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ç¬¬äºŒä¸ªå®ä¾‹</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^broker.id=/cbroker.id=2&#39;</span> /opt/kafka/config/server.properties  <span style="color:#75715e"># é›†ç¾¤è®¾ç½®ä¸åŒid</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^log.dirs=/clog.dirs=/opt/kafka/logs/logs-2&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/#advertised.listeners/a advertised.listeners=PLAINTEXT://$IP:9093&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ç¬¬ä¸‰ä¸ªå®ä¾‹</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^broker.id=/cbroker.id=3&#39;</span> /opt/kafka/config/server.properties  <span style="color:#75715e"># é›†ç¾¤è®¾ç½®ä¸åŒid</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^log.dirs=/clog.dirs=/opt/kafka/logs/logs-3&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/#advertised.listeners/a advertised.listeners=PLAINTEXT://$IP:9094&#39;</span> /opt/kafka/config/server.properties</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å•æœºå¯åŠ¨å¤šå®ä¾‹<!-- raw HTML omitted --><code>zookeeper</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>Kafka</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/kafka/bin/zookeeper-server-start.sh -daemon /opt/kafka/config/zookeeper.properties  	<span style="color:#75715e"># åå°å¯åŠ¨zookeeperè¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨Kafkaå¤šä¸ªå®ä¾‹</span>
</span></span><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server-2.properties
</span></span><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server-3.properties</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="kafkaé›†ç¾¤æ¨¡å¼"><code>Kafka</code>é›†ç¾¤æ¨¡å¼</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¤š<!-- raw HTML omitted --><code>zookeeper</code><!-- raw HTML omitted -->å¤š<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->å®ä¾‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½ã€è§£å‹<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://archive.apache.org/dist/kafka/2.8.1/kafka_2.13-2.8.1.tgz
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/srckafka_2.13-2.8.1.tgz -C /opt/
</span></span><span style="display:flex;"><span>$ cd /opt/
</span></span><span style="display:flex;"><span>$ mv kafka_2.13-2.8.1/ kafka</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>zookeeper</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/kafka/<span style="color:#f92672">{</span>zookeeper,logs<span style="color:#f92672">}</span>  	<span style="color:#75715e"># åˆ›å»ºæŒä¹…åŒ–ç›®å½•</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^dataDir=/cdataDir=\/opt\/kafka\/zookeeper&#39;</span> /opt/kafka/config/zookeeper.properties
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^broker.id=/cbroker.id=1&#39;</span> /opt/kafka/config/server.properties  	<span style="color:#75715e"># é›†ç¾¤è®¾ç½®ä¸åŒid</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^log.dirs=/clog.dirs=/opt/kafka/logs/logs-1&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^zookeeper.connect=/czookeeper.connect=${IP-1}:2128,${IP-2}:2128,${IP-3}:2128&#39;</span> /opt/kafka/config/server.properties</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¤š<!-- raw HTML omitted --><code>zookeeper</code><!-- raw HTML omitted -->å’Œå¤š<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->å®ä¾‹å¯åŠ¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/kafka/bin/zookeeper-server-start.sh -daemon /opt/kafka/config/zookeeper.properties  	<span style="color:#75715e"># åå°å¯åŠ¨zookeeperè¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server.properties</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="åˆ›å»ºtopicæµ‹è¯•">åˆ›å»º<code>Topic</code>æµ‹è¯•</h3>
<blockquote>
<ul>
<li><code>--create</code><!-- raw HTML omitted -->ï¼šåˆ›å»º<!-- raw HTML omitted --></li>
<li><code>--zookeeper</code><!-- raw HTML omitted -->ï¼š ä½¿ç”¨<!-- raw HTML omitted --><code>zookeeper</code></li>
<li><code>--replication-factor 1</code><!-- raw HTML omitted -->ï¼š ä½¿ç”¨<code>1</code>ä¸ªå‰¯æœ¬<!-- raw HTML omitted --></li>
<li><code>--partitions 1</code><!-- raw HTML omitted -->ï¼šå¯ç”¨åˆ†åŒºæ•°é‡<!-- raw HTML omitted --></li>
<li><code>--topic test</code><!-- raw HTML omitted -->ï¼š ä¸»é¢˜åå­—ï¼š<!-- raw HTML omitted --><code>test</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test  	<span style="color:#75715e"># ä½¿ç”¨kafka-console-producer.sh äº§ç”Ÿæ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯</span>
</span></span><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-console-consumer.sh --topic test --from-beginning --bootstrap-server localhost:9092  	<span style="color:#75715e"># ä½¿ç”¨kafka-console-consumer.shæ¶ˆè´¹æ¶ˆæ¯</span></span></span></code></pre></div><ul>
<li><code>--from-beginning</code><!-- raw HTML omitted -->ï¼š æ¥å—å†å²æ¶ˆæ¯å‚æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-topics.sh --describe --topic test --bootstrap-server localhost:9092  	<span style="color:#75715e"># æŸ¥çœ‹topicsæè¿°ä¿¡æ¯</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¬¬ä¸€è¡Œç»™å‡ºäº†æ‰€æœ‰åˆ†åŒºçš„æ‘˜è¦ï¼Œæ¯ä¸ªé™„åŠ è¡Œç»™å‡ºäº†å…³äºä¸€ä¸ªåˆ†åŒºçš„ä¿¡æ¯ã€‚ ç”±äºæˆ‘ä»¬åªæœ‰ä¸€ä¸ªåˆ†åŒºï¼Œæ‰€ä»¥åªæœ‰ä¸€è¡Œ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Leader</code><!-- raw HTML omitted -->ï¼šæ˜¯è´Ÿè´£ç»™å®šåˆ†åŒºçš„æ‰€æœ‰è¯»å–å’Œå†™å…¥çš„èŠ‚ç‚¹ã€‚ æ¯ä¸ªèŠ‚ç‚¹å°†æˆä¸ºåˆ†åŒºéšæœºé€‰æ‹©éƒ¨åˆ†çš„é¢†å¯¼è€…<!-- raw HTML omitted --></li>
<li><code>Replicas</code><!-- raw HTML omitted -->ï¼šæ˜¯å¤åˆ¶æ­¤åˆ†åŒºæ—¥å¿—çš„èŠ‚ç‚¹åˆ—è¡¨ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦æ˜¯é¢†å¯¼è€…ï¼Œæˆ–è€…å³ä½¿ä»–ä»¬å½“å‰å¤„äºæ´»åŠ¨çŠ¶æ€<!-- raw HTML omitted --></li>
<li><code>Isr</code><!-- raw HTML omitted -->ï¼šæ˜¯ä¸€ç»„â€œåŒæ­¥â€å‰¯æœ¬ã€‚è¿™æ˜¯å¤åˆ¶å“åˆ—è¡¨çš„å­é›†ï¼Œå½“å‰æ´»ç€å¹¶è¢«å¼•å¯¼åˆ°é¢†å¯¼è€…<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-ab3dcb98addc6615a131ad362f82263d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kafka_Server/topics.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ab3dcb98addc6615a131ad362f82263d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kafka_Server/topics.png"></a></p>
</blockquote>
</blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_rabbitmq">Configure_Rabbitmq</h1>

<h2 id="ä½¿ç”¨rabbitmq">ä½¿ç”¨<code>Rabbitmq</code></h2>
<h3 id="rabbitmqæ·»åŠ ç™»å½•è´¦æˆ·"><code>Rabbitmq</code>æ·»åŠ ç™»å½•è´¦æˆ·</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>/etc/rabbitmq/rabbitmq.config</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶ä¸‹æ·»åŠ ï¼Œ<!-- raw HTML omitted -->å¦‚æœä¸å­˜åœ¨å°±è‡ªè¡Œåˆ›å»º<!-- raw HTML omitted -->æ·»åŠ <!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>admin</code><!-- raw HTML omitted -->å°±æ˜¯ç”¨æˆ·åç§°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /etc/rabbitmq/rabbitmq.config
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">{</span>rabbit,<span style="color:#f92672">[{</span>tcp_listeners,<span style="color:#f92672">[</span>5672<span style="color:#f92672">]}</span>,<span style="color:#f92672">{</span>loopback_users,<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;admin&#34;</span><span style="color:#f92672">]}]}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span></span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨å‘½ä»¤æ·»åŠ ç”¨æˆ·å¹¶æˆæƒ æ·»åŠ ç”¨æˆ·<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl add_user admin admin</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>permissions</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl set_permissions -p <span style="color:#e6db74">&#34;/&#34;</span> admin <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®ç”¨æˆ·è§’è‰²<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl set_user_tags admin administrator</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹æ–°æ·»åŠ çš„<!-- raw HTML omitted --><code>admin</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl list_users</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹ç”¨äºçš„æƒé™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./rabbitmqctl list_permissions -p /</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="rabbitmqé—®é¢˜"><code>RabbitMQ</code>é—®é¢˜</h3>
<h4 id="rabbitmqæ— æ³•æ–°å»ºè¿æ¥é—®é¢˜å¤„ç†è¿‡ç¨‹è®°å½•"><code>RabbitMQ</code>æ— æ³•æ–°å»ºè¿æ¥é—®é¢˜å¤„ç†è¿‡ç¨‹è®°å½•</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç—‡çŠ¶æè¿°<!-- raw HTML omitted -->å®¢æˆ·åé¦ˆæ— æ³•äº‘å¹³å°<code>VNC</code>æ§åˆ¶å°çª—å£ä¸€ç›´å¤„äº<code>loading</code>çŠ¶æ€ï¼Œæ— æ³•æ‰“å¼€.</li>
<li>å®šä½è¿‡ç¨‹</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é¦–å…ˆæŸ¥çœ‹<!-- raw HTML omitted --><code>nova-api</code><!-- raw HTML omitted -->æœåŠ¡æ˜¯å¦æ­£å¸¸<!-- raw HTML omitted --><code>nova list</code><!-- raw HTML omitted -->æ­£å¸¸<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>nova service-list</code><!-- raw HTML omitted -->è¾“å‡ºï¼Œæ‰€æœ‰æœåŠ¡åœ¨çº¿<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>nova get-vnc-console</code><!-- raw HTML omitted -->è·å–äº‘ä¸»æœº<!-- raw HTML omitted --><code>vnc</code><!-- raw HTML omitted -->é“¾æ¥ï¼Œè¶…æ—¶æ— æ³•è·å–<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>åˆæ­¥æ‰¾åˆ°æ§åˆ¶å°çª—å£æ— æ³•æ‰“å¼€çš„åŸå› ï¼Œç»§ç»­åˆ†æé—®é¢˜</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹äº‘ä¸»æœºæ‰€åœ¨èŠ‚ç‚¹çš„<!-- raw HTML omitted --><code>nova-compute</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œä¸€åˆ‡æ­£å¸¸<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>nova-compute</code><!-- raw HTML omitted -->æ—¥å¿—ï¼Œæ²¡æœ‰æ”¶åˆ°åˆ›å»º<!-- raw HTML omitted --><code>vnc</code><!-- raw HTML omitted -->é“¾æ¥è¯·æ±‚<!-- raw HTML omitted --><code>vnc</code><!-- raw HTML omitted -->æ§åˆ¶å°é“¾æ¥æ˜¯åœ¨äº‘ä¸»æœºæ‰€åœ¨è®¡ç®—èŠ‚ç‚¹ç”Ÿæˆçš„ï¼Œå› ä¸ºè¦æŸ¥è¯¢äº‘ä¸»æœº<!-- raw HTML omitted --><code>qemu</code><!-- raw HTML omitted -->è¿›ç¨‹åˆ›å»ºçš„<!-- raw HTML omitted --><code>vnc server</code><!-- raw HTML omitted -->ç«¯å£å·ï¼Œåˆ›å»ºå®Œæˆåè¦æŠŠ<!-- raw HTML omitted --><code>token</code><!-- raw HTML omitted -->å’Œç«¯å£å·å¯¹åº”å…³ç³»ä¿å­˜åˆ°<!-- raw HTML omitted --><code>nova-consoleauth</code><!-- raw HTML omitted -->è¿›ç¨‹ï¼Œ<!-- raw HTML omitted --><code>nova-consoleauth</code><!-- raw HTML omitted -->è¿›ç¨‹ä¼šæ ¹æ®é…ç½®é¡¹å†³å®šæŠŠå¯¹åº”å…³ç³»ä¿å­˜åˆ°è¿›ç¨‹å†…å­˜è¿˜æ˜¯<!-- raw HTML omitted --><code>memcache</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œä¹‹å‰å¤„ç†è¿‡ä¸€æ¬¡æ§åˆ¶èŠ‚ç‚¹å†…å­˜ä¸è¶³å¯¼è‡´<!-- raw HTML omitted --><code>token</code><!-- raw HTML omitted -->ä¿å­˜å¤±è´¥çš„é—®é¢˜ï¼Œè¿™æ¬¡ä¹Ÿå…ˆæŸ¥äº†ä¸‹<!-- raw HTML omitted --><code>nova-consoleauth</code><!-- raw HTML omitted -->æ—¥å¿—ï¼Œæ²¡æœ‰å‘ç°ç±»ä¼¼æƒ…å†µ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>nova-api</code><!-- raw HTML omitted -->èŠ‚ç‚¹æ—¥å¿—ï¼Œå‘ç°æ”¶åˆ°äº†è¯·æ±‚ä½†æ²¡æœ‰è¿”å›<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æ‰“å¼€<!-- raw HTML omitted --><code>nova-api</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>nova-compute</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>debug</code><!-- raw HTML omitted -->æ—¥å¿—ç»§ç»­åˆ†æ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å‘ç°<!-- raw HTML omitted --><code>nova-api</code><!-- raw HTML omitted -->ä¸€ç›´åœ¨å°è¯•è¿æ¥åˆ°<!-- raw HTML omitted --><code>RabbitMQ</code><!-- raw HTML omitted -->ï¼Œä¸€ç›´å¡åœ¨<!-- raw HTML omitted --><code>connecting</code><!-- raw HTML omitted -->ï¼Œæ²¡æœ‰<!-- raw HTML omitted --><code>connected</code><!-- raw HTML omitted -->æ—¥å¿—<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>æ‰¾åˆ°æ›´è¿›ä¸€æ­¥çš„é—®é¢˜åŸå› ï¼Œç»§ç»­åˆ†æé—®é¢˜</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é¦–å…ˆé‡å¯<!-- raw HTML omitted --><code>nova-api</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œè¯•éªŒä¸‹èƒ½å¦æ¢å¤ï¼Œå‘ç°å¯åŠ¨è¿›ç¨‹æ—¶å¯ä»¥è¿æ¥åˆ°<!-- raw HTML omitted --><code>MQ</code>ï¼Œ<!-- raw HTML omitted -->ä½†è·å–<!-- raw HTML omitted --><code>vnc</code><!-- raw HTML omitted -->é“¾æ¥æ—¶é—®é¢˜ä»ç„¶å­˜åœ¨<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é€šè¿‡<!-- raw HTML omitted --><code>rabbitmqctl</code><!-- raw HTML omitted -->å‘½ä»¤è¡ŒæŸ¥çœ‹<!-- raw HTML omitted --><code>queue</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>exchange</code><!-- raw HTML omitted -->æƒ…å†µï¼Œä¹Ÿæ²¡å‘ç°å¼‚å¸¸ï¼Œäº‘ä¸»æœºèŠ‚ç‚¹çš„<!-- raw HTML omitted --><code>compute</code><!-- raw HTML omitted -->é˜Ÿåˆ—ä¹Ÿæœ‰<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é‡å¯<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œè¯•éªŒèƒ½å¦æ¢å¤ï¼Œé‡å¯åå‘ç°<!-- raw HTML omitted --><code>vnc</code><!-- raw HTML omitted -->é“¾æ¥è·å–å‘½ä»¤æ¢å¤æ­£å¸¸ï¼Œé¡µé¢æ‰“å¼€æ§åˆ¶å°çª—å£æ­£å¸¸<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>é—®é¢˜è§£å†³ä½†æ²¡æ‰¾åˆ°åŸå› ï¼Œäºæ˜¯ç»§ç»­è§‚å¯Ÿï¼Œç­‰äº†å¤§æ¦‚2åˆ†é’Ÿï¼Œå†æ¬¡å°è¯•æ‰“å¼€<code>vnc</code>æ§åˆ¶å°çª—å£ï¼Œå‘ç°è€é—®é¢˜è¿˜åœ¨ï¼Œä¸€ç›´<code>loading</code>ï¼Œç»§ç»­åˆ†æé—®é¢˜ï¼Œ</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->æœåŠ¡å™¨æ—¥å¿—ï¼Œå‘ç°å¼‚å¸¸<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å‘ç°é—®é¢˜æ ¹æœ¬åŸå› ï¼Œæ–‡ä»¶å¥æŸ„æ•°é‡è¶…å‡ºé™åˆ¶ï¼Œ<!-- raw HTML omitted --><code>google</code><!-- raw HTML omitted -->æœç´¢è¿™ä¸ªé”™è¯¯ï¼Œå‘ç°äº†è§£å†³æ–¹æ³•<!-- raw HTML omitted --><a href="https://my.oschina.net/moooofly/blog/678513" rel="external" target="_self">åŸåˆ›<code>RabbitMQ</code>ä¹‹<code>file descriptor limit alarm</code>åˆ†æ</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>=WARNING REPORT==== 25-Oct-2017::10:35:48 ===
file descriptor limit alarm set.

********************************************************************
*** New connections will not be accepted until this alarm clears ***
********************************************************************</code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é¦–å…ˆä¿®æ”¹<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->èŠ‚ç‚¹ç‰©ç†æœºæ–‡ä»¶å¥æŸ„æ•°é‡é…ç½®ï¼ˆå¢åŠ å¦‚ä¸‹ä¸¤è¡Œï¼‰<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /etc/security/limits.conf  | grep nofile
</span></span><span style="display:flex;"><span>* soft nofile <span style="color:#ae81ff">262144</span>
</span></span><span style="display:flex;"><span>* hard nofile <span style="color:#ae81ff">262144</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ulimit -n <span style="color:#ae81ff">65536</span>  	<span style="color:#75715e"># ä¹Ÿä¿®æ”¹</span></span></span></code></pre></div></blockquote>
<ul>
<li>é‡å¯<code>RabbitMQ</code>ï¼Œ<code>rabbitmqctl status</code>å‘½ä»¤æŸ¥çœ‹é™åˆ¶ï¼Œå‘ç°ä¸ç”Ÿæ•ˆï¼š</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŒ‰ç…§æœç´¢ç»“æœä¸­çš„æç¤ºæ‰§è¡Œï¼š<!-- raw HTML omitted --><code>rabbitmqctl stopã€rabbitmq-server -detached</code><!-- raw HTML omitted -->å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°å¥æŸ„æ•°é™åˆ¶å·²ä¿®æ”¹<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å°è¯•<!-- raw HTML omitted --><code>web</code><!-- raw HTML omitted -->æ‰“å¼€<!-- raw HTML omitted --><code>vnc</code><!-- raw HTML omitted -->çª—å£ï¼Œå‘ç°æ¢å¤æ­£å¸¸ï¼Œ<!-- raw HTML omitted --><code>nova-api</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>nova-compute</code><!-- raw HTML omitted -->æ—¥å¿—æ­£å¸¸<!-- raw HTML omitted --><code>connected</code><!-- raw HTML omitted -->åˆ°<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->ç­‰å¾…å‡ åˆ†é’Ÿä»ç„¶æ­£å¸¸ï¼Œé—®é¢˜è§£å†³<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code> {file_descriptors,
     [{total_limit,924},
      {total_used,525},</code></pre></div></blockquote>
<ul>
<li>å°è¯•ä¿®æ”¹å®‰è£…éƒ¨ç½²è„šæœ¬ï¼Œå‘ç°å…ˆä¿®æ”¹ç³»ç»Ÿå¥æŸ„æ•°é…ç½®å†å®‰è£…<code>MQ</code>ï¼Œä»ç„¶æ— æ³•ä¿®æ”¹<code>MQ</code>å¥æŸ„é™åˆ¶
ç»§ç»­<code>google</code>ï¼Œ<a href="https://www.rabbitmq.com/install-rpm.html" rel="external" target="_self">æŸ¥çœ‹åˆ°<code>RabbitMQ</code>å®˜æ–¹æ–‡æ¡£</a> æœ‰å¦‚ä¸‹æè¿°ï¼š</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0"><code>æ§åˆ¶ Linux ä¸Šçš„ç³»ç»Ÿé™åˆ¶

è¿è¡Œç”Ÿäº§å·¥ä½œè´Ÿè½½çš„ RabbitMQ å®‰è£…å¯èƒ½éœ€è¦ç³»ç»Ÿé™åˆ¶å’Œå†…æ ¸å‚æ•°è°ƒæ•´ï¼Œä»¥ä¾¿å¤„ç†ç›¸å½“æ•°é‡çš„å¹¶å‘è¿æ¥å’Œé˜Ÿåˆ—ã€‚éœ€è¦è°ƒæ•´çš„ä¸»è¦è®¾ç½®æ˜¯æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°ï¼Œä¹Ÿç§°ä¸ºulimit -nã€‚è®¸å¤šæ“ä½œç³»ç»Ÿä¸Šçš„é»˜è®¤å€¼å¯¹äºæ¶ˆæ¯ä¼ é€’ä»£ç†æ¥è¯´å¤ªä½äº†ï¼ˆä¾‹å¦‚ï¼Œåœ¨å‡ ä¸ª Linux å‘è¡Œç‰ˆä¸Šä¸º 1024ï¼‰ã€‚æˆ‘ä»¬å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºç”¨æˆ· rabbitmq å…è®¸è‡³å°‘ 65536 ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚å¯¹äºå¤§å¤šæ•°å¼€å‘å·¥ä½œè´Ÿè½½ï¼Œ4096 åº”è¯¥è¶³å¤Ÿäº†ã€‚

æœ‰ä¸¤ä¸ªé™åˆ¶ï¼šæ“ä½œç³»ç»Ÿå†…æ ¸å…è®¸æ‰“å¼€æ–‡ä»¶çš„æœ€å¤§æ•°é‡ï¼ˆfs.file-maxï¼‰å’Œæ¯ä¸ªç”¨æˆ·çš„é™åˆ¶ï¼ˆulimit -nï¼‰ã€‚å‰è€…å¿…é¡»é«˜äºåè€…ã€‚

ä½¿ç”¨ systemdï¼ˆæœ€è¿‘çš„ Linux å‘è¡Œç‰ˆï¼‰

åœ¨ä½¿ç”¨ systemd çš„å‘è¡Œç‰ˆä¸Šï¼Œæ“ä½œç³»ç»Ÿé™åˆ¶æ˜¯é€šè¿‡ /etc/systemd/system/rabbitmq-server.service.d/limits.conf ä¸­çš„é…ç½®æ–‡ä»¶æ§åˆ¶çš„ï¼Œä¾‹å¦‚ï¼š

[Service]
LimitNOFILE=300000</code></pre></div></blockquote>
<ul>
<li>æ®æ­¤ä¿®æ”¹æ­£å¸¸</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir /etc/systemd/system/rabbitmq-server.service.d -p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat  &gt;/etc/systemd/system/rabbitmq-server.service.d/limits.conf<span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=300000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ setenforce <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s#enforcing#disabled#g&#34;</span>  /etc/selinux/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/security/limits.conf<span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft nofile 204800
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nofile 204800
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ulimit -n <span style="color:#ae81ff">204800</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl restart rabbitmq-server.service</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="zabbixç›‘æ§-rabbitmq"><code>Zabbix</code>ç›‘æ§<code> Rabbitmq</code></h3>
<blockquote>
<ul>
<li><a href="http://www.lstop.pub/2016/10/10/%E8%87%AA%E5%B7%B1%E5%86%99%E4%B8%80%E4%B8%AA%E7%9B%91%E6%8E%A7RabbitMQ%E7%9A%84%E8%84%9A%E6%9C%AC/" rel="external" target="_self"><code>Rabbitmq-python</code>ç›‘æ§è„šæœ¬</a></li>
<li><code>RabbitMQ</code>è‡ªå·±å·²ç»æœ‰ä¸€ä¸ªæŒºå¥½çš„ç®¡ç†ç›‘æ§ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ°éå¸¸è¯¦ç»†çš„æ¶ˆæ¯é˜Ÿåˆ—ä¿¡æ¯ï¼Œä½†æ˜¯å¯¹äºè¿ç»´äººå‘˜æ¥è¯´ï¼Œè¿˜ç¼ºå°‘äº†å¾ˆé‡è¦çš„å‘Šè­¦åŠŸèƒ½ã€‚ è‡ªå·±å†™ä¸€ä¸ªè„šæœ¬ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œåœ¨ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šå‚è€ƒï¼Œä¸»è¦æ€è·¯æ˜¯åˆ©ç”¨<code>RabbitMQ</code>è‡ªå¸¦ç®¡ç†æ¨¡å—çš„<code>RESTful API</code>å–å€¼ï¼Œå‘é€åˆ°<code>zabbix</code>ï¼Œç”±<code>zabbix</code>è´Ÿè´£å‘Šè­¦é˜€å€¼åˆ¤æ–­å’Œå‘é€å‘Šè­¦</li>
<li><!-- raw HTML omitted --><code>RabbitMQ RESTful API</code><!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>é¦–å…ˆè®¤è¯†<code>RabbitMQ</code>çš„<code>API</code>ï¼Œçœ‹çœ‹èƒ½å–åˆ°ä»€ä¹ˆï¼Œæ¨èçœ‹å®˜æ–¹<code>help</code></li>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->æ€»ä½“æƒ…å†µ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å®˜æ–¹è§£æï¼š<code>/api/overview Various random bits of information that describe the whole system</code></li>
<li>ä¾‹å­ï¼š<code>curl -u guest:guest http://192.168.55.241:15672/api/overview</code> ç„¶åè¿”å›dçš„<code>json</code>æ ¼å¼å“åº”æ˜¯ï¼š</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;management_version&#34;</span>: <span style="color:#e6db74">&#34;3.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;statistics_level&#34;</span>: <span style="color:#e6db74">&#34;fine&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;exchange_types&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;topic&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;AMQP topic exchange, as per the AMQP specification&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;fanout&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;AMQP fanout exchange, as per the AMQP specification&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;direct&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;AMQP direct exchange, as per the AMQP specification&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;headers&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;AMQP headers exchange, as per the AMQP specification&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;rabbitmq_version&#34;</span>: <span style="color:#e6db74">&#34;3.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;erlang_version&#34;</span>: <span style="color:#e6db74">&#34;R15B01&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;message_stats&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;publish&#34;</span>: <span style="color:#ae81ff">1104833</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;publish_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">12.262779782167032</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">298146914019</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068131606</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;ack&#34;</span>: <span style="color:#ae81ff">1177571</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;ack_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">11.230039450092189</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">57927468985</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068130882</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver&#34;</span>: <span style="color:#ae81ff">1177572</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">11.027518607238914</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">57927468985</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068130882</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_get&#34;</span>: <span style="color:#ae81ff">1207878</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_get_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">11.027518607238914</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">57927468985</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068130882</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_no_ack&#34;</span>: <span style="color:#ae81ff">30306</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_no_ack_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">1067361970</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068115093</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;redeliver&#34;</span>: <span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;redeliver_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">115179973</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068099504</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;queue_totals&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;messages&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;messages_ready&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;messages_unacknowledged&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;messages_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">255911999</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068131232</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;messages_ready_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">255911999</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068131232</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;messages_unacknowledged_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">255911999</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068131232</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;object_totals&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;consumers&#34;</span>: <span style="color:#ae81ff">70</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;queues&#34;</span>: <span style="color:#ae81ff">27</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;exchanges&#34;</span>: <span style="color:#ae81ff">13</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;connections&#34;</span>: <span style="color:#ae81ff">176</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;channels&#34;</span>: <span style="color:#ae81ff">236</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;rabbit@rabbit01&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;statistics_db_node&#34;</span>: <span style="color:#e6db74">&#34;rabbit@rabbit01&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;listeners&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;rabbit@rabbit01&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;protocol&#34;</span>: <span style="color:#e6db74">&#34;amqp&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;ip_address&#34;</span>: <span style="color:#e6db74">&#34;::&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#ae81ff">5672</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;contexts&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;rabbit@rabbit01&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;RabbitMQ Management&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#ae81ff">15672</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;rabbit@rabbit01&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Redirect to port 15672&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#ae81ff">55672</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;ignore_in_use&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å•ä¸ªé˜Ÿåˆ—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å®˜æ–¹è§£æï¼š<code>/api/queues/vhost/name An individual queue. To PUT a queue, you will need a body looking something like this: {â€œauto_deleteâ€:false,â€durableâ€:true,â€argumentsâ€:[],â€nodeâ€:â€rabbit@smacmullenâ€} All keys are optional</code></li>
<li>ä¾‹å­ï¼š<code>%2Fä»£è¡¨vhostä¸º/ curl -u guest:guest http://192.168.55.241:15672/api/queues/%2F/wxq.msgweb.push.wgw.0</code> ç„¶åè¿”å›dçš„<code>json</code>æ ¼å¼å“åº”æ˜¯ï¼š</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;policy&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;exclusive_consumer_tag&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;messages_ready&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;messages_unacknowledged&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;messages&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;consumers&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;active_consumers&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;memory&#34;</span>: <span style="color:#ae81ff">55680</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;backing_queue_status&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;q1&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;q2&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;delta&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;delta&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;undefined&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;undefined&#34;</span>
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;q3&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;q4&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;len&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pending_acks&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;target_ram_count&#34;</span>: <span style="color:#e6db74">&#34;infinity&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;ram_msg_count&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;ram_ack_count&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;next_seq_id&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;persistent_count&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;avg_ingress_rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;avg_egress_rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;avg_ack_ingress_rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;avg_ack_egress_rate&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;messages_details&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">10001981</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068574166</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;messages_ready_details&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">10001981</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068574166</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;messages_unacknowledged_details&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">10001981</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068574166</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;incoming&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;stats&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;publish&#34;</span>: <span style="color:#ae81ff">763</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;publish_details&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">75305976</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068545922</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;exchange&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;wxq_appmsg_exchange&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;vhost&#34;</span>: <span style="color:#e6db74">&#34;/&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;deliveries&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;stats&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;deliver_get&#34;</span>: <span style="color:#ae81ff">774</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;deliver_get_details&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">44411017</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068470753</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;deliver_no_ack&#34;</span>: <span style="color:#ae81ff">774</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;deliver_no_ack_details&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">44411017</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068470753</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;channel_details&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;192.168.65.158:64326 -&gt; 192.168.55.241:5672 (1)&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;number&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;connection_name&#34;</span>: <span style="color:#e6db74">&#34;192.168.65.158:64326 -&gt; 192.168.55.241:5672&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;peer_port&#34;</span>: <span style="color:#ae81ff">64326</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;peer_host&#34;</span>: <span style="color:#e6db74">&#34;192.168.65.158&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;message_stats&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_get&#34;</span>: <span style="color:#ae81ff">774</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_get_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">44411017</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068470753</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_no_ack&#34;</span>: <span style="color:#ae81ff">774</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_no_ack_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">44411017</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068470753</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;publish&#34;</span>: <span style="color:#ae81ff">763</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;publish_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">75305976</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068545922</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;consumer_details&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;channel_details&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;192.168.65.158:64326 -&gt; 192.168.55.241:5672 (1)&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;number&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;connection_name&#34;</span>: <span style="color:#e6db74">&#34;192.168.65.158:64326 -&gt; 192.168.55.241:5672&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;peer_port&#34;</span>: <span style="color:#ae81ff">64326</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;peer_host&#34;</span>: <span style="color:#e6db74">&#34;192.168.65.158&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;queue_details&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;wxq.msgweb.push.wgw.0&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;vhost&#34;</span>: <span style="color:#e6db74">&#34;/&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;consumer_tag&#34;</span>: <span style="color:#e6db74">&#34;amq.ctag-jKVWrQSs7dbX9VaFfOZiYA&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;exclusive&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;ack_required&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;wxq.msgweb.push.wgw.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;vhost&#34;</span>: <span style="color:#e6db74">&#34;/&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;durable&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;auto_delete&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;arguments&#34;</span>: {},
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;rabbit@rabbit01&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="zabbix-sender"><code>zabbix sender</code></h4>
<blockquote>
<ul>
<li><code>zabbix sender</code>åŒºåˆ«äºåœ¨<code>zabbix agent</code>æ·»åŠ <code>item</code>ï¼Œ<code>sender</code>å¯ä»¥ä¸»åŠ¨å‘é€<code>item</code>å€¼åˆ°<code>zabbix server</code>
å¯ä»¥å…ˆè§„åˆ’å¥½åœ¨<code>zabbix server</code>ä¸­ä½¿ç”¨çš„<code>host</code>å’Œ<code>item</code>åå­—</li>
<li><!-- raw HTML omitted -->ä¾‹å¦‚ï¼š<!-- raw HTML omitted -->è¿™æ ·å°±å¯ä»¥é€šè¿‡pythonå–å€¼ï¼Œä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå†<code>send</code>åˆ°<code>zabbix server</code></li>
</ul>
<blockquote>
<ul>
<li><code>rabbitmq.[rabbit@wx-pro-server01,messages_ready]</code>å¾…å¤„ç†æ¶ˆæ¯æ€»æ•°</li>
<li><code>rabbitmq.[rabbit@wx-pro-server01,messages_unacknowledged]</code>æœªæ”¶åˆ°<code>ack</code>å“åº”æ¶ˆæ¯æ€»æ•°</li>
<li><code>rabbitmq.queues[/,queue_messages_ready,wxq_msg_send] wxq_msg_send</code>é˜Ÿåˆ—çš„å¾…å¤„ç†æ¶ˆæ¯æ•°</li>
<li><code>rabbitmq.queues[/,queue_active_consumers,wxq_msg_send] wxq_msg_send</code>é˜Ÿåˆ—çš„æ´»åŠ¨è¿æ¥æ•°</li>
</ul>
</blockquote>
<ul>
<li><code>zabbix_sender</code><!-- raw HTML omitted -->ä½¿ç”¨æ–¹æ³•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>-c</code>ï¼š<code>agent</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>-i</code> ï¼š<!-- raw HTML omitted -->ä¸´æ—¶æ–‡ä»¶ï¼Œç”¨äºä¿å­˜å¤šä¸ª<!-- raw HTML omitted --><code>item</code><!-- raw HTML omitted -->å’Œå¯¹åº”å€¼ï¼Œæ¯è¡Œä¸€ä¸ª<!-- raw HTML omitted --><code>item</code></li>
<li><code>-s</code>ï¼š<!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>zabbix server</code><!-- raw HTML omitted -->ä¸Šé…ç½®çš„<!-- raw HTML omitted --><code>host</code><!-- raw HTML omitted -->åå­—<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/zabbix_sender -c /etc/zabbix/zabbix_agentd.conf -i /tmp/tmp5ai4uI -s ser01-rabbitmq</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="pythonä»£ç "><code>python</code>ä»£ç </h4>
<blockquote>
<ul>
<li><a href="https://blog.51cto.com/john88wang/1745824" rel="external" target="_self">ä½¿ç”¨<code>Zabbix</code>ç›‘æ§<code>RabbitMQ</code></a></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/python</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># coding=utf-8</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RabbitMqç›‘æ§è„šæœ¬ v1.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">v1.1 ç›‘æ§channelçš„unacknowledged
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">v1.0 ç›‘æ§overviewã€queue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib2
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> socket
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> tempfile
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> subprocess
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> optparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>basicConfig(filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/var/log/zabbix/rabbitmq_zabbix.log&#39;</span>, level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>WARNNING, format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%(asctime)s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%(levelname)s</span><span style="color:#e6db74">: </span><span style="color:#e6db74">%(message)s</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RabbitMqApi</span>(object):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39; è°ƒç”¨RabbitMQçš„APIç±» &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">######## json.loads()  transfer json data to python data</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">######## json.dump()   transfer python data to json data</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> __init__(self, user_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span>, password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span>, host_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;192.168.55.241&#39;</span>, 
</span></span><span style="display:flex;"><span>           protocol<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;http&#39;</span>, port<span style="color:#f92672">=</span><span style="color:#ae81ff">15672</span>, senderhostname<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ser01-rabbitmq&#39;</span>,
</span></span><span style="display:flex;"><span>                       zbconf<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/etc/zabbix/zabbix_agentd.conf&#39;</span>):
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>user_name <span style="color:#f92672">=</span> user_name
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>password <span style="color:#f92672">=</span> password
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>host_name <span style="color:#f92672">=</span> host_name <span style="color:#f92672">or</span> socket<span style="color:#f92672">.</span>gethostname()
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>protocol <span style="color:#f92672">=</span> protocol
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>port <span style="color:#f92672">=</span> port
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>senderhostname <span style="color:#f92672">=</span> senderhostname <span style="color:#66d9ef">if</span> senderhostname <span style="color:#66d9ef">else</span> host_name
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>conf <span style="color:#f92672">=</span> zbconf
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è°ƒç”¨RabbitMQçš„APIç±»å–åŸå§‹æ•°æ®ï¼Œjsonæ ¼å¼</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">call_api</span>(self, path):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  All URIs will server only resource of type application/json,and will require HTTP basic authentication. The default username and password is guest/guest.  /</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">f is encoded for the default virtual host &#39;/&#39; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">://</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">/api/</span><span style="color:#e6db74">{3}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>protocol, self<span style="color:#f92672">.</span>host_name, self<span style="color:#f92672">.</span>port, path)
</span></span><span style="display:flex;"><span>password_mgr <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>HTTPPasswordMgrWithDefaultRealm()
</span></span><span style="display:flex;"><span>password_mgr<span style="color:#f92672">.</span>add_password(<span style="color:#66d9ef">None</span>, url, self<span style="color:#f92672">.</span>user_name, self<span style="color:#f92672">.</span>password)
</span></span><span style="display:flex;"><span>handler <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>HTTPBasicAuthHandler(password_mgr)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#39;Issue a rabbit API call to get data on &#39;</span> <span style="color:#f92672">+</span> url)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>loads(urllib2<span style="color:#f92672">.</span>build_opener(handler)<span style="color:#f92672">.</span>open(url)<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è°ƒç”¨RabbitMQçš„APIç±»å–åŸå§‹æ•°æ®ï¼Œjsonæ ¼å¼</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">call_api_queue</span>(self, queue_name):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  get queue detail
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">://</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">/api/queues/</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{3}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>protocol, self<span style="color:#f92672">.</span>host_name, self<span style="color:#f92672">.</span>port, queue_name)
</span></span><span style="display:flex;"><span>password_mgr <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>HTTPPasswordMgrWithDefaultRealm()
</span></span><span style="display:flex;"><span>password_mgr<span style="color:#f92672">.</span>add_password(<span style="color:#66d9ef">None</span>, url, self<span style="color:#f92672">.</span>user_name, self<span style="color:#f92672">.</span>password)
</span></span><span style="display:flex;"><span>handler <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>HTTPBasicAuthHandler(password_mgr)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#39;Issue a rabbit API call to get data on &#39;</span> <span style="color:#f92672">+</span> url)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>loads(urllib2<span style="color:#f92672">.</span>build_opener(handler)<span style="color:#f92672">.</span>open(url)<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">call_api_channel</span>(self, channel_name):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  get channel detail
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">://</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">/api/channels/</span><span style="color:#e6db74">{3}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>protocol, self<span style="color:#f92672">.</span>host_name, self<span style="color:#f92672">.</span>port, urllib2<span style="color:#f92672">.</span>quote(channel_name))
</span></span><span style="display:flex;"><span>password_mgr <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>HTTPPasswordMgrWithDefaultRealm()
</span></span><span style="display:flex;"><span>password_mgr<span style="color:#f92672">.</span>add_password(<span style="color:#66d9ef">None</span>, url, self<span style="color:#f92672">.</span>user_name, self<span style="color:#f92672">.</span>password)
</span></span><span style="display:flex;"><span>handler <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>HTTPBasicAuthHandler(password_mgr)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#39;Issue a rabbit API call to get data on &#39;</span> <span style="color:#f92672">+</span> url)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>loads(urllib2<span style="color:#f92672">.</span>build_opener(handler)<span style="color:#f92672">.</span>open(url)<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠæ•°æ®ä¸itemå¯¹åº”å†™è¿›ä¸´æ—¶æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_queue_data</span>(self, queue, tmpfile):
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> [ <span style="color:#e6db74">&#39;memory&#39;</span>,<span style="color:#e6db74">&#39;messages&#39;</span>,<span style="color:#e6db74">&#39;messages_ready&#39;</span>,<span style="color:#e6db74">&#39;messages_unacknowledged&#39;</span>,<span style="color:#e6db74">&#39;consumers&#39;</span>,<span style="color:#e6db74">&#39;active_consumers&#39;</span> ]:
</span></span><span style="display:flex;"><span><span style="color:#75715e">#key = rabbitmq.queues[/,queue_memory,queue.helloWorld]</span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#34;rabbitmq.queues[</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">,queue_</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">]&#34;&#39;</span><span style="color:#f92672">.</span>format(queue[<span style="color:#e6db74">&#39;vhost&#39;</span>], item, queue[<span style="color:#e6db74">&#39;name&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#75715e">### if item is in queue,value=queue[item],else value=0</span>
</span></span><span style="display:flex;"><span>value <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>get(item, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;SENDER_DATA: - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key,value))
</span></span><span style="display:flex;"><span>tmpfile<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;- </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key, value))
</span></span><span style="display:flex;"><span><span style="color:#75715e">##  This is a non standard bit of information added after the standard items</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;deliver_get&#39;</span>, <span style="color:#e6db74">&#39;publish&#39;</span>]:
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#34;rabbitmq.queues[</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">,queue_message_stats_</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">]&#34;&#39;</span><span style="color:#f92672">.</span>format(queue[<span style="color:#e6db74">&#39;vhost&#39;</span>], item, queue[<span style="color:#e6db74">&#39;name&#39;</span>])
</span></span><span style="display:flex;"><span>value <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;message_stats&#39;</span>, {})<span style="color:#f92672">.</span>get(item, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;SENDER_DATA: - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key,value))
</span></span><span style="display:flex;"><span>tmpfile<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;- </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key, value))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨zabbix_senderæŠŠitemå‘é€åˆ°zabbix server</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_send_queue_data</span>(self, tmpfile):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;Send the queue data to Zabbix.&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;Get key value from temp file. &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>args <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/usr/bin/zabbix_sender -c </span><span style="color:#e6db74">{0}</span><span style="color:#e6db74"> -i </span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>senderhostname:
</span></span><span style="display:flex;"><span>args <span style="color:#f92672">=</span> args <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; -s &#34;</span> <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>senderhostname
</span></span><span style="display:flex;"><span>return_code <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>process <span style="color:#f92672">=</span> subprocess<span style="color:#f92672">.</span>Popen(args<span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>conf, tmpfile<span style="color:#f92672">.</span>name),
</span></span><span style="display:flex;"><span>                                  shell<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, stdout<span style="color:#f92672">=</span>subprocess<span style="color:#f92672">.</span>PIPE,
</span></span><span style="display:flex;"><span>                                  stderr<span style="color:#f92672">=</span>subprocess<span style="color:#f92672">.</span>PIPE)
</span></span><span style="display:flex;"><span>out, err <span style="color:#f92672">=</span> process<span style="color:#f92672">.</span>communicate()
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Finished sending data&#34;</span>)
</span></span><span style="display:flex;"><span>return_code <span style="color:#f92672">=</span> process<span style="color:#f92672">.</span>wait()
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;Found return code of &#34;</span> <span style="color:#f92672">+</span> str(return_code))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> return_code <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>warning(out)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>warning(err)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(err)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(out)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> return_code
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_queue</span>(self, queueName):
</span></span><span style="display:flex;"><span>rdatafile <span style="color:#f92672">=</span> tempfile<span style="color:#f92672">.</span>NamedTemporaryFile(delete<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>return_code <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>queue <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>call_api_queue(queueName)
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>_get_queue_data(queue, rdatafile)
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>_get_channel_data(queue, rdatafile)
</span></span><span style="display:flex;"><span>rdatafile<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>return_code <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_send_queue_data(rdatafile)
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">.</span>unlink(rdatafile<span style="color:#f92672">.</span>name)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> return_code
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_overview</span>(self):
</span></span><span style="display:flex;"><span>return_code <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>rdatafile <span style="color:#f92672">=</span> tempfile<span style="color:#f92672">.</span>NamedTemporaryFile(delete<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>queue <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>call_api(<span style="color:#e6db74">&#39;overview&#39;</span>)
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>_get_overview_data(queue, rdatafile)
</span></span><span style="display:flex;"><span>rdatafile<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>return_code <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_send_queue_data(rdatafile)
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">.</span>unlink(rdatafile<span style="color:#f92672">.</span>name)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> return_code
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_overview_data</span>(self, queue, tmpfile):
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;publish_details&#39;</span>, <span style="color:#e6db74">&#39;ack_details&#39;</span>, <span style="color:#e6db74">&#39;deliver_get_details&#39;</span>]:
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rabbitmq.[</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">_rate]&#34;</span><span style="color:#f92672">.</span>format(queue[<span style="color:#e6db74">&#39;node&#39;</span>], item)
</span></span><span style="display:flex;"><span>value <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;message_stats&#39;</span>)<span style="color:#f92672">.</span>get(item)<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;rate&#39;</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;SENDER_DATA: - </span><span style="color:#e6db74">{0}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">{1:.2f}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(key, value))
</span></span><span style="display:flex;"><span>tmpfile<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;- </span><span style="color:#e6db74">{0}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">{1:.2f}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(key, value))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;messages&#39;</span>,<span style="color:#e6db74">&#39;messages_ready&#39;</span>,<span style="color:#e6db74">&#39;messages_unacknowledged&#39;</span>]:
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rabbitmq.[</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">]&#34;</span><span style="color:#f92672">.</span>format(queue[<span style="color:#e6db74">&#39;node&#39;</span>], item)
</span></span><span style="display:flex;"><span>value <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;queue_totals&#39;</span>)<span style="color:#f92672">.</span>get(item,<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;SENDER_DATA: - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key,value))
</span></span><span style="display:flex;"><span>tmpfile<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;- </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key, value))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_channel_data</span>(self, queue, tmpfile): 
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ä»queueè·å–queue nameå’Œchannel nameï¼Œç»„è£…zabbixçš„k-vå¹¶å†™è¿›ä¸´æ—¶æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ch_detail <span style="color:#f92672">in</span> queue[<span style="color:#e6db74">&#39;consumer_details&#39;</span>]:
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rabbitmq.[</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">]&#34;</span><span style="color:#f92672">.</span>format(queue[<span style="color:#e6db74">&#39;name&#39;</span>], ch_detail<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;channel_details&#39;</span>)<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;name&#39;</span>,<span style="color:#e6db74">&#39;no_name&#39;</span>))
</span></span><span style="display:flex;"><span>value <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_channel_ack(ch_detail<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;channel_details&#39;</span>)<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;name&#39;</span>,<span style="color:#e6db74">&#39;no_name&#39;</span>))
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;SENDER_DATA: - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key,value))
</span></span><span style="display:flex;"><span>tmpfile<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;- </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key, value))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_channel_ack</span>(self, channel_name):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ä½¿ç”¨apiè·å–messages_unacknowledgedå€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>call_api_channel(channel_name)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> d[<span style="color:#e6db74">&#39;messages_unacknowledged&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;Command-line parameters and decoding for Zabbix use/consumption.&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#testapi = RabbitMqApi()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#testapi.check_queue(&#39;wxq_msg_send&#39;)</span>
</span></span><span style="display:flex;"><span>parser <span style="color:#f92672">=</span> optparse<span style="color:#f92672">.</span>OptionParser()
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;-u&#39;</span>, <span style="color:#e6db74">&#39;--username&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RabbitMQ API username,default=guest&#39;</span>,default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;-p&#39;</span>, <span style="color:#e6db74">&#39;--password&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RabbitMQ API password,default=guest&#39;</span>,default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;--mqhost&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RabbitMQ API hostname,default=hostname&#39;</span>,default<span style="color:#f92672">=</span>socket<span style="color:#f92672">.</span>gethostname())
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;--protocol&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RabbitMQ API protocol,default=http&#39;</span>,default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;http&#39;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;--port&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RabbitMQ API port,default=15672&#39;</span>,default<span style="color:#f92672">=</span><span style="color:#ae81ff">15672</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;--host&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Zabbix Host name which the item belongs to,no default&#39;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;--conf&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Zabbix agent configure file,default=/etc/zabbix/zabbix_agentd.conf&#39;</span>,default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/etc/zabbix/zabbix_agentd.conf&#39;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;--queue&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RabbitMQ queue which you want to check,no default&#39;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;-o&#39;</span>,<span style="color:#e6db74">&#39;--overview&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;check RabbitMQ overview&#39;</span>,action<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;store_true&#34;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;-c&#39;</span>,<span style="color:#e6db74">&#39;--count&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;How many times to execute command&#39;</span>, type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;int&#39;</span>, default<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;-i&#39;</span>,<span style="color:#e6db74">&#39;--interval&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Command execute interval&#39;</span>, type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;int&#39;</span>, default<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>(options, args) <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> options<span style="color:#f92672">.</span>host:
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>error(<span style="color:#e6db74">&#34;è¯·è¾“å…¥zabbixé‡Œå®šä¹‰çš„hostname&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> (<span style="color:#f92672">not</span> options<span style="color:#f92672">.</span>queue <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> options<span style="color:#f92672">.</span>overview):
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>error(<span style="color:#e6db74">&#34;è¯·æŒ‡å®š-oæˆ–è€…--queueï¼Œé€‰æ‹©æ£€æŸ¥mqæ€»ä½“æŒ‡æ ‡æˆ–è€…æŸä¸ªé˜Ÿåˆ—æŒ‡æ ‡&#34;</span>)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Started trying to process data&#34;</span>)
</span></span><span style="display:flex;"><span>api <span style="color:#f92672">=</span> RabbitMqApi(user_name<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>username, password<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>password, host_name<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>mqhost, 
</span></span><span style="display:flex;"><span>               protocol<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>protocol, port<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>port, senderhostname<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>host,
</span></span><span style="display:flex;"><span>               zbconf<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>conf)
</span></span><span style="display:flex;"><span>cnt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> cnt <span style="color:#f92672">&lt;</span> options<span style="color:#f92672">.</span>count:                                               
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> options<span style="color:#f92672">.</span>overview:
</span></span><span style="display:flex;"><span>api<span style="color:#f92672">.</span>check_overview()
</span></span><span style="display:flex;"><span>time<span style="color:#f92672">.</span>sleep(options<span style="color:#f92672">.</span>interval)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> options<span style="color:#f92672">.</span>queue:
</span></span><span style="display:flex;"><span>api<span style="color:#f92672">.</span>check_queue(options<span style="color:#f92672">.</span>queue)
</span></span><span style="display:flex;"><span>time<span style="color:#f92672">.</span>sleep(options<span style="color:#f92672">.</span>interval)
</span></span><span style="display:flex;"><span>cnt <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span> main()</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è„šæœ¬ä½¿ç”¨æ–¹å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>--mqhost</code>ï¼š<code>RabbitMQ</code><!-- raw HTML omitted -->æœåŠ¡å™¨<!-- raw HTML omitted --><code>ip</code></li>
<li><code>--host</code>ï¼š<code>zabbix server</code><!-- raw HTML omitted -->ä¸Šé…ç½®çš„<!-- raw HTML omitted --><code>host</code><!-- raw HTML omitted -->åå­—<!-- raw HTML omitted --></li>
<li><code>--queue</code>ï¼š<!-- raw HTML omitted -->é˜Ÿåˆ—åå­—<!-- raw HTML omitted --></li>
<li><code>-o</code>ï¼š<!-- raw HTML omitted -->è·å–<!-- raw HTML omitted --><code>overview</code><!-- raw HTML omitted -->æ•°æ®<!-- raw HTML omitted --></li>
<li><code>-c</code>ï¼š<!-- raw HTML omitted -->æ‰§è¡Œ<code>5</code>æ¬¡<!-- raw HTML omitted --></li>
<li><code>-i</code>ï¼š<!-- raw HTML omitted -->é—´éš”<code>12</code>ç§’<!-- raw HTML omitted --></li>
<li><code>--help</code>ï¼š<!-- raw HTML omitted -->æŸ¥çœ‹å¸®åŠ©ï¼Œæœ‰å…¶ä»–å‚æ•°å¯é€‰<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mqMon.py -o â€“mqhost 192.168.55.241 â€“host ser01-rabbitmq -c <span style="color:#ae81ff">5</span> -i <span style="color:#ae81ff">12</span>  	<span style="color:#75715e"># ç›‘æ§`mq`æ€»ä½“æƒ…å†µ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mqMon.py â€“queue wxq_msg_send â€“mqhost 192.168.55.241 â€“host ser01-rabbitmq -c <span style="color:#ae81ff">5</span> -i <span style="color:#ae81ff">12</span>  	<span style="color:#75715e"># ç›‘æ§é˜Ÿåˆ—æƒ…å†µ</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="../../../js/clipboard.min.js?1724860322" defer></script>
    <script src="../../../js/perfect-scrollbar.min.js?1724860322" defer></script>
    <script src="../../../js/theme.js?1724860322" defer></script>
  </body>
</html>
