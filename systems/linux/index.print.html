<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <meta name="author" content="äºŒå“¥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://usermice.github.io/images/hero.png">
    <meta name="twitter:title" content="Linux :: Hugo Relearn Theme">
    <meta property="og:url" content="https://usermice.github.io/systems/linux/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Linux :: Hugo Relearn Theme">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://usermice.github.io/images/hero.png">
    <meta itemprop="name" content="Linux :: Hugo Relearn Theme">
    <meta itemprop="datePublished" content="2024-06-13T00:17:01+08:00">
    <meta itemprop="dateModified" content="2024-06-13T00:17:01+08:00">
    <meta itemprop="image" content="https://usermice.github.io/images/hero.png">
    <title>Linux :: Hugo Relearn Theme</title>
    <link href="../../images/favicon.ico?1727790689" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../css/fontawesome-all.min.css?1727790691" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fontawesome-all.min.css?1727790691" rel="stylesheet"></noscript>
    <link href="../../css/nucleus.css?1727790691" rel="stylesheet">
    <link href="../../css/auto-complete.css?1727790691" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/auto-complete.css?1727790691" rel="stylesheet"></noscript>
    <link href="../../css/perfect-scrollbar.min.css?1727790691" rel="stylesheet">
    <link href="../../css/fonts.css?1727790691" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fonts.css?1727790691" rel="stylesheet"></noscript>
    <link href="../../css/theme.css?1727790691" rel="stylesheet">
    <link href="../../css/theme-relearn-auto.css?1727790691" rel="stylesheet" id="R-variant-style">
    <link href="../../css/chroma-relearn-auto.css?1727790691" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../css/variant.css?1727790691" rel="stylesheet">
    <link href="../../css/print.css?1727790691" rel="stylesheet" media="print">
    <link href="../../css/format-print.css?1727790691" rel="stylesheet">
    <script src="../../js/variant.js?1727790691"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/usermice.github.io';
      window.index_js_url="../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../systems/linux/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Linux</span><meta itemprop="position" content="2"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../systems/black-macos/" title="Black MacOs (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../systems/linux/ansible/" title="Ansible (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="linux">Linux</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Linux</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="ansible">Ansible</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Ansible</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_slatstack">Use_Slatstack</h1>


            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_ansible">Use_Ansible</h1>

<h2 id="ä½¿ç”¨ansible">ä½¿ç”¨<code>Ansible</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åœ°å€</th>
<th>åç§°</th>
<th>ç®€ä»‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.jianshu.com/p/7c4c47aa6b5a" rel="external" target="_self"><code>ansible</code>æ€»ç»“</a></td>
<td>&mdash;</td>
<td>&mdash;-</td>
</tr>
<tr>
<td><a href="https://www.kancloud.cn/louis1986/ansible/587918" rel="external" target="_self"><code>Ansible</code>æŒ‡å—</a></td>
<td>&mdash;-</td>
<td>&mdash;-</td>
</tr>
<tr>
<td><a href="http://docs.ansible.com/ansible/latest/become.html" rel="external" target="_self">å…³äº<code>become</code>å±æ€§</a></td>
<td>&mdash;-</td>
<td>&mdash;-</td>
</tr>
<tr>
<td><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html" rel="external" target="_self"><code>Ansible</code>å‰§æœ¬çš„è¯­æ³•</a></td>
<td>&mdash;-</td>
<td>&mdash;-</td>
</tr>
<tr>
<td><a href="http://docs.ansible.com/ansible/latest/list_of_all_modules.html" rel="external" target="_self"><code>Ansible</code>çš„å†…ç½®æ¨¡å—åˆ—è¡¨</a></td>
<td>&mdash;-</td>
<td>&mdash;-</td>
</tr>
<tr>
<td><a href="https://juejin.im/entry/5ba6e5e4e51d450e51628272" rel="external" target="_self"><code>Ansible</code>æ‰¹é‡è‡ªåŠ¨åŒ–ç®¡ç†å·¥å…·<code>roles</code>æ ‡å‡†åŒ–</a></td>
<td>&mdash;-</td>
<td>&mdash;</td>
</tr>
<tr>
<td><a href="https://blog.csdn.net/wh211212/article/details/82763493" rel="external" target="_self"><code>ansible-playbook</code>è°ƒç”¨<code>zabbix-api</code>è‡ªåŠ¨æ·»åŠ ä¸»æœº</a></td>
<td>&mdash;-</td>
<td>&mdash;-</td>
</tr>
<tr>
<td><a href="https://blog.csdn.net/wu2700222/article/details/80816988" rel="external" target="_self"><code>Ansible</code>æ‰¹é‡å®‰è£…<code>zabbix-agent</code>å¹¶ä½¿ç”¨<code>zabbix</code>è‡ªåŠ¨æ·»åŠ ä¸»æœº</a></td>
<td>&mdash;-</td>
<td>&mdash;-</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>é€‰é¡¹</strong></th>
<th><strong>æè¿°</strong></th>
<th>è¯¦è§£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-a MODULE_ARGS</code>, <!-- raw HTML omitted -->  <code>--args=MODULE_ARGS</code></td>
<td>æ¨¡å—å‚æ•°</td>
<td></td>
</tr>
<tr>
<td><code>-C</code>, <code>--check</code>ã€</td>
<td>è¿è¡Œæ£€æŸ¥ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ</td>
<td></td>
</tr>
<tr>
<td><code>-e EXTRA_VARS</code>, <!-- raw HTML omitted --> <code>--extra-vars=EXTRA_VARS</code></td>
<td>è®¾ç½®é™„åŠ å˜é‡<code>key=value</code></td>
<td></td>
</tr>
<tr>
<td><code>-f FORKS</code>, <code>--forks=FORKS</code></td>
<td>æŒ‡å®šå¹¶è¡Œè¿›ç¨‹æ•°é‡ï¼Œé»˜è®¤5</td>
<td></td>
</tr>
<tr>
<td><code>-i INVENTORY</code>,<!-- raw HTML omitted --> <code>--inventory=INVENTORY</code></td>
<td>æŒ‡å®šä¸»æœºæ¸…å•æ–‡ä»¶è·¯å¾„</td>
<td></td>
</tr>
<tr>
<td><code>--list-hosts</code></td>
<td>è¾“å‡ºåŒ¹é…çš„ä¸»æœºåˆ—è¡¨ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ</td>
<td></td>
</tr>
<tr>
<td><code>-m MODULE_NAME</code>,<!-- raw HTML omitted --> <code>--module-name=MODULE_NAME</code></td>
<td>æ‰§è¡Œçš„æ¨¡å—åï¼Œé»˜è®¤<code>command</code></td>
<td></td>
</tr>
<tr>
<td><code>-o</code></td>
<td>ç®€æ´è¾“å‡ºæ³•</td>
<td></td>
</tr>
<tr>
<td><code>--syntax-check</code></td>
<td>è¯­æ³•æ£€æŸ¥<code>playbook</code>æ–‡ä»¶ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ</td>
<td></td>
</tr>
<tr>
<td><code>-t TREE</code>, <code>--tree=TREE</code></td>
<td>å°†æ—¥å¿—è¾“å‡ºåˆ°æ­¤ç›®å½•</td>
<td></td>
</tr>
<tr>
<td><code>-v</code>, <code>--verbose</code></td>
<td>è¯¦ç»†ä¿¡æ¯ï¼š<code>-vvv</code>ï¼Œæ›´å¤šï¼š<code>-vvvv debug</code></td>
<td></td>
</tr>
<tr>
<td><code>--version</code></td>
<td>æŸ¥çœ‹ç¨‹åºç‰ˆæœ¬</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>è¿æ¥é€‰é¡¹</strong></th>
<th><strong>æ§åˆ¶è°è¿æ¥ä¸»æœºå’Œå¦‚ä½•è¿æ¥</strong></th>
<th>è¯¦è§£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-k, --ask-pass</code></td>
<td>è¯·æ±‚è¿æ¥å¯†ç </td>
<td></td>
</tr>
<tr>
<td><code>--private-key=PRIVATE_KEY_FILE</code>, <!-- raw HTML omitted --><code>--key-file=PRIVATE_KEY_FILE</code></td>
<td>ç§é’¥æ–‡ä»¶</td>
<td></td>
</tr>
<tr>
<td><code>-u REMOTE_USER</code>ï¼Œ<!-- raw HTML omitted --><code>--user=REMOTE_USER</code></td>
<td>è¿æ¥ç”¨æˆ·ï¼Œé»˜è®¤<code>None</code></td>
<td></td>
</tr>
<tr>
<td><code>-T TIMEOUT</code>ï¼Œ<!-- raw HTML omitted --><code>--timeout=TIMEOUT</code></td>
<td>è¦†ç›–è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤10ç§’</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>ææƒé€‰é¡¹</strong></th>
<th><strong>æ§åˆ¶åœ¨ç›®æ ‡ä¸»æœºä»¥ä»€ä¹ˆç”¨æˆ·èº«ä»½è¿è¡Œ</strong></th>
<th>è¯¦è§£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-b, --become</code></td>
<td>ä»¥å¦ä¸€ä¸ªç”¨æˆ·èº«ä»½æ“ä½œ</td>
<td></td>
</tr>
<tr>
<td><code>--become-method=BECOME_METHOD</code></td>
<td>ææƒæ–¹æ³•ï¼Œé»˜è®¤<code>sudo</code></td>
<td></td>
</tr>
<tr>
<td><code>--become-user=BECOME_USER</code></td>
<td>ææƒåçš„ç”¨æˆ·èº«ä»½ï¼Œé»˜è®¤<code>root</code></td>
<td></td>
</tr>
<tr>
<td><code>-K, --ask-become-pass</code></td>
<td>ææƒå¯†ç </td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>é…ç½®æ–‡ä»¶æŒ‡ä»¤</strong></th>
<th><strong>æè¿°</strong></th>
<th>è¯¦è§£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ansible_ssh_host</code></td>
<td>æŒ‡å®šä¸»æœºåˆ«åå¯¹åº”çš„çœŸå®<code>IP</code></td>
<td></td>
</tr>
<tr>
<td><code>ansible_ssh_port</code></td>
<td>æŒ‡å®šè¿æ¥åˆ°è¿™ä¸ªä¸»æœºçš„<code>ssh</code>ç«¯å£ï¼Œé»˜è®¤<code>22</code></td>
<td></td>
</tr>
<tr>
<td><code>ansible_ssh_user</code></td>
<td>è¿æ¥åˆ°è¯¥ä¸»æœºçš„<code>ssh</code>ç”¨æˆ·</td>
<td></td>
</tr>
<tr>
<td><code>ansible_ssh_pass</code></td>
<td>è¿æ¥åˆ°è¯¥ä¸»æœºçš„<code>ssh</code>å¯†ç (è¿<code>-k</code>é€‰é¡¹éƒ½çœäº†)ï¼Œå®‰å…¨è€ƒè™‘è¿˜æ˜¯å»ºè®®ä½¿ç”¨ç§é’¥æˆ–åœ¨å‘½ä»¤è¡ŒæŒ‡å®š<code>-k</code>é€‰é¡¹è¾“å…¥</td>
<td></td>
</tr>
<tr>
<td><code>ansible_sudo_pass</code></td>
<td><code>sudo</code>å¯†ç </td>
<td></td>
</tr>
<tr>
<td><code>ansible_sudo_exe</code>(<code>v1.8+</code>çš„æ–°ç‰¹æ€§)</td>
<td><code>sudo</code>å‘½ä»¤è·¯å¾„</td>
<td></td>
</tr>
<tr>
<td><code>ansible_ssh_private_key_file</code></td>
<td>ç§é’¥æ–‡ä»¶è·¯å¾„</td>
<td></td>
</tr>
<tr>
<td><code>ansible_nodename</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ansible_connection</code></td>
<td>è¿æ¥ç±»å‹ï¼Œå¯ä»¥æ˜¯<code>local</code>ã€<code>ssh</code>æˆ–<code>paramiko</code>ï¼Œ<code>ansible1.2</code>ä¹‹å‰é»˜è®¤ä¸º<code>paramiko</code></td>
<td></td>
</tr>
<tr>
<td><code>ansible_os_family</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ansible_pkg_mgr</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ansible_shell_type</code></td>
<td>ç›®æ ‡ç³»ç»Ÿçš„<code>shell</code>ç±»å‹ï¼Œé»˜è®¤ä¸º<code>sh</code>,å¦‚æœè®¾ç½®<code>csh/fish</code>ï¼Œé‚£ä¹ˆå‘½ä»¤éœ€è¦éµå¾ªå®ƒä»¬è¯­æ³•</td>
<td></td>
</tr>
<tr>
<td><code>ansible_processor</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ansible_processor_cores</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ansible_python_interpreter</code></td>
<td><code>python</code>è§£é‡Šå™¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯<code>/usr/bin/python</code>ï¼Œä½†æ˜¯å¦‚è¦è¦è¿<code>*BSD</code>ç³»ç»Ÿçš„è¯ï¼Œå°±éœ€è¦è¯¥æŒ‡ä»¤ä¿®æ”¹<code>python</code>è·¯å¾„</td>
<td></td>
</tr>
<tr>
<td><code>ansible_*_interpreter</code></td>
<td>è¿™é‡Œçš„<code>*</code>å¯ä»¥æ˜¯<code>ruby</code>æˆ–<code>perl</code>æˆ–å…¶ä»–è¯­è¨€çš„è§£é‡Šå™¨ï¼Œä½œç”¨å’Œ<code>ansible_python_interpreter</code>ç±»ä¼¼</td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="ä¸»é…ç½®æ–‡ä»¶">ä¸»é…ç½®æ–‡ä»¶</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted -->ä¸»æœºå<!-- raw HTML omitted -->ä¸èƒ½ä½¿ç”¨<!-- raw HTML omitted -->ä¸‹åˆ’çº¿<!-- raw HTML omitted --><!-- raw HTML omitted --><code>_</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/ansible/ansible.cfg<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[defaults] 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">inventory      = /etc/ansible/hosts
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># library        = /usr/share/my_modules/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># module_utils   = /usr/share/my_module_utils/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># remote_tmp     = ~/.ansible/tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># local_tmp      = ~/.ansible/tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># plugin_filters_cfg = /etc/ansible/plugin_filters.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">forks          = 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># poll_interval  = 15
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sudo_user      = root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ask_sudo_pass = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ask_pass      = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># transport      = smart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">remote_port    = 22
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># module_lang    = C
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># module_set_locale = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">become = root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host_key_checking = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">timeout = 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log_path = /var/log/ansible.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">private_key_file = /root/.ssh/id_rsa
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># gathering = implicit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># gather_subset = all
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># gather_timeout = 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># inject_facts_as_vars = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># remote_user = root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># roles_path    = /etc/ansible/roles
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># module_name = command
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># uncomment this to disable SSH key host checking
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host_key_checking = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># executable = /bin/sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># stdout_callback = skippy  	# ä¿®æ”¹ä¸º json
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># callback_whitelist = timer, mail  # timerï¼šè®¡ç®—æ•´ä¸ªplaybookè¿è¡Œæ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># task_includes_static = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># handler_includes_static = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># error_on_missing_handler = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sudo_exe = sudo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sudo_flags = -H -S -n
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># hash_behaviour = replace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># private_role_vars = yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># jinja2_extensions = jinja2.ext.do,jinja2.ext.i18n
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># private_key_file = /path/to/file
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># vault_password_file = /path/to/vault_password_file
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ansible_managed = Ansible managed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># display_skipped_hosts = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># display_args_to_stdout = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># error_on_undefined_vars = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># system_warnings = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># deprecation_warnings = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># command_warnings = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># set plugin path directories here, separate with colons
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># action_plugins     = /usr/share/ansible/plugins/action
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># become_plugins     = /usr/share/ansible/plugins/become
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cache_plugins      = /usr/share/ansible/plugins/cache
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># callback_plugins   = /usr/share/ansible/plugins/callback
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># connection_plugins = /usr/share/ansible/plugins/connection
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># lookup_plugins     = /usr/share/ansible/plugins/lookup
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># inventory_plugins  = /usr/share/ansible/plugins/inventory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># vars_plugins       = /usr/share/ansible/plugins/vars
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># filter_plugins     = /usr/share/ansible/plugins/filter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># test_plugins       = /usr/share/ansible/plugins/test
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># terminal_plugins   = /usr/share/ansible/plugins/terminal
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># strategy_plugins   = /usr/share/ansible/plugins/strategy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># strategy = free
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># bin_ansible_callbacks = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nocows = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cow_selection = default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cow_selection = random
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cow_whitelist=bud-frogs,bunny,cheese,daemon,default,dragon,elephant-in-snake,elephant,eyes,\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#              hellokitty,kitty,luke-koala,meow,milk,moofasa,moose,ren,sheep,small,stegosaurus,\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#              stimpy,supermilker,three-eyes,turkey,turtle,tux,udder,vader-koala,vader,www
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nocolor = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># fact_caching = memory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># For the redis plugin, the value is a host:port:database triplet: fact_caching_connection = localhost:6379:0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># fact_caching_connection=/tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># retry_files_enabled = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># retry_files_save_path = ~/.ansible-retry
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># squash_actions = apk,apt,dnf,homebrew,pacman,pkgng,yum,zypper
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># no_log = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># no_target_syslog = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># allow_world_readable_tmpfiles = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># var_compression_level = 9
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># module_compression = &#39;ZIP_DEFLATED&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># max_diff_size = 1048576
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># merge_multiple_cli_flags = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># show_custom_stats = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># inventory_ignore_extensions = ~, .orig, .bak, .ini, .cfg, .retry, .pyc, .pyo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># network_group_modules=eos, nxos, ios, iosxr, junos, vyos
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># allow_unsafe_lookups = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># any_errors_fatal = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[inventory]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># enable inventory plugins, default: &#39;host_list&#39;, &#39;script&#39;, &#39;auto&#39;, &#39;yaml&#39;, &#39;ini&#39;, &#39;toml&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># enable_plugins = host_list, virtualbox, yaml, constructed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ignore_extensions = .pyc, .pyo, .swp, .bak, ~, .rpm, .md, .txt, ~, .orig, .ini, .cfg, .retry
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ignore_patterns=
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># unparsed_is_failed=False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[privilege_escalation]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># become=True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># become_method=sudo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># become_user=root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># become_ask_pass=False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[paramiko_connection]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># record_host_keys=False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pty=False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># look_for_keys = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># host_key_auto_add = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ssh_connection]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ssh_args = -C -o ControlMaster=auto -o ControlPersist=60s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># control_path_dir = /tmp/.ansible/cp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># control_path_dir = ~/.ansible/cp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># control_path = %(directory)s/%%h-%%r
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># control_path =
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pipelining = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># scp_if_ssh = smart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># transfer_method = smart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sftp_batch_mode = False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># usetty = True
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># retries = 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[persistent_connection]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># connect_timeout = 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># command_timeout = 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[accelerate]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># accelerate_port = 5099
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># accelerate_timeout = 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># accelerate_connect_timeout = 5.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># accelerate_daemon_timeout = 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># accelerate_multi_key = yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[selinux]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># special_context_filesystems=nfs,vboxsf,fuse,ramfs,9p,vfat
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># libvirt_lxc_noseclabel = yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[colors]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># highlight = white
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># verbose = blue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># warn = bright purple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># error = red
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># debug = dark gray
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># deprecate = purple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># skip = cyan
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># unreachable = red
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ok = green
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># changed = yellow
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># diff_add = green
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># diff_remove = red
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># diff_lines = cyan
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[diff]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># context = 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç¤ºä¾‹1ï¼šæœªåˆ†ç»„çš„ä¸»æœº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">green.example.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">blue.example.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.100.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.100.10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç¤ºä¾‹2ï¼šå±äºwebserversç»„ä¸»æœºé›†åˆ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[webservers]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alpha.example.org
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">beta.example.org
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.1.100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.1.110
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">www[001:006].example.com 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç¤ºä¾‹3ï¼šå±äºdbserversç»„ä¸»æœºé›†åˆ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[dbservers]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">db01.intranet.mydomain.net
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">db02.intranet.mydomain.net
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">10.25.1.56
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">10.25.1.57
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">db-[99:101]-node.example.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¸»æœºå’Œä¸»æœºç»„å˜é‡ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[webservers:vars]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http_port=8080
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server_name=www.ctnrs.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ansible_ssh_user=&#34;username&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ansible_ssh_pass=&#34;password&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ansible_ssh_port=&#34;port&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å­ç»„ï¼Œchildrenï¼šä¸ºå›ºå®šå†™æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[father:children]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">webservers
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dbservers
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SSHå¯†ç è®¤è¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[webservers]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.1.10 ansible_ssh_user=root ansible_ssh_pass=&#39;123456â€™ http_port=80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.1.11 ansible_ssh_user=root ansible_ssh_pass=&#39;123456â€™ http_port=80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SSHå¯†é’¥å¯¹è®¤è¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[webservers]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.1.10:22 ansible_ssh_user=root ansible_ssh_key=/root/.ssh/id_rsa
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[master]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">k8s-master ansible_ssh_user=&#34;username&#34; ansible_ssh_pass=&#34;password&#34; ansible_ssh_port=&#34;port&#34; ansible_ssh_host=&#34;IP&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[node]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">k8s-node-1 ansible_ssh_user=&#34;username&#34; ansible_ssh_pass=&#34;password&#34; ansible_ssh_port=&#34;port&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åº”ç”¨ç¤ºä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">aws_host ansible_ssh_private_key_file=/home/example/.ssh/aws.pem
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">freebsd_host ansible_python_interpreter=/usr/local/bin/python
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ruby_module_host ansible_ruby_interpreter=/usr/bin/ruby.1.9.3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>sshd</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm -iUvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed  -i <span style="color:#e6db74">&#39;s/^#host_key_checking/host_key_checking/g&#39;</span> /etc/ansible/ansible.cfg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/PasswordAuthentication[ \t]*no/PasswordAuthentication yes/&#39;</span> /etc/ssh/sshd_config
</span></span><span style="display:flex;"><span>$ systemctl restart sshd</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å­é…ç½®æ–‡ä»¶">å­é…ç½®æ–‡ä»¶</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯¹ä¸»æœºæœ‰æ•ˆé…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/etc/ansible/host_vars/all  	<span style="color:#75715e"># host_vars ç›®å½•ç”¨äºå­˜æ”¾ host å˜é‡ï¼Œallæ–‡ä»¶å¯¹æ‰€æœ‰ä¸»æœºæœ‰æ•ˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/etc/ansible/host_vars/foosball  	<span style="color:#75715e"># æ–‡ä»¶foosballè¦å’Œhostsé‡Œé¢å®šä¹‰çš„ä¸»æœºåä¸€æ ·ï¼Œè¡¨ç¤ºåªå¯¹ foosballä¸»æœºæœ‰æ•ˆ</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯¹ç»„æœ‰æ•ˆé…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/etc/ansible/group_vars/all  	<span style="color:#75715e"># group_varsç›®å½•ç”¨äºå­˜æ”¾ group å˜é‡ï¼Œallæ–‡ä»¶å¯¹æ‰€æœ‰ç»„æœ‰æ•ˆ</span>
</span></span><span style="display:flex;"><span>/etc/ansible/group_vars/raleigh  	<span style="color:#75715e"># æ–‡ä»¶ raleigh è¦å’Œ hosts é‡Œé¢å®šä¹‰çš„ç»„åä¸€æ ·ï¼Œè¡¨ç¤ºå¯¹raleighç»„ä¸‹çš„æ‰€æœ‰ä¸»æœºæœ‰æ•ˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/ansible/group_vars/webservers.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http_port: 8080
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server_name: www.ctnrs.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="å‘½ä»¤ä½¿ç”¨">å‘½ä»¤ä½¿ç”¨</h3>
<blockquote>
<ul>
<li><code>ansible-doc --help</code><!-- raw HTML omitted -->ï¼šè·å–ä½¿ç”¨å¸®åŠ©<!-- raw HTML omitted --></li>
<li><code>ansible-playbook --help</code><!-- raw HTML omitted -->ï¼šè·å–å‰§æœ¬ä½¿ç”¨å¸®åŠ©<!-- raw HTML omitted --></li>
<li><a href="https://docs.ansible.com/ansible/latest/module_plugin_guide/index.html" rel="external" target="_self">ä½¿ç”¨<code>Ansible</code>æ¨¡å—å’Œæ’ä»¶</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ—å‡ºæ‰€æœ‰æ¨¡å—</span>
</span></span><span style="display:flex;"><span>$ ansible-doc -l 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å…¶ä¸­æŸä¸€ä¸ªæ¨¡å—ä½¿ç”¨æ–¹å¼ï¼Œæ‰¾åˆ°å…¶ä¸­çš„ï¼šEXAMPLES(ä¾‹å­)</span>
</span></span><span style="display:flex;"><span>$ ansible-doc copy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹æŸä¸ªæ¨¡å—ç®€å•å®ç”¨æ–¹å¼</span>
</span></span><span style="display:flex;"><span>$ ansible-doc -s copy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å›è°ƒæ’ä»¶åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>$ ansible-doc -t callback -l</span></span></code></pre></div><table>
<thead>
<tr>
<th><strong><a href="https://docs.ansible.com/ansible/latest/command_guide/intro_adhoc.html" rel="external" target="_self">å¸¸ç”¨æ¨¡å—</a></strong></th>
<th>**æè¿° **</th>
<th>è¯¦è§£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>command</code>ã€<code>shell</code></td>
<td>æ‰§è¡Œ<code>shell</code>å‘½ä»¤ï¼Œ<code>shell</code>æ”¯æŒç®¡é“ç¬¦ç­‰å­—ç¬¦</td>
<td></td>
</tr>
<tr>
<td><code>script</code></td>
<td>è„šæœ¬æ¨¡å—</td>
<td></td>
</tr>
<tr>
<td><code>copy</code>ã€<code>file</code>ã€<code>synchronize</code></td>
<td>æ–‡ä»¶ä¼ è¾“ï¼Œ<code>copy{src,dest,mode}</code>ï¼Œ<code>file</code>æ¨¡å—å¯ä»¥ç›´æ¥æ“ä½œè¿œç¨‹æœåŠ¡å™¨ï¼Œ<code>synchronize</code></td>
<td></td>
</tr>
<tr>
<td><code>yum</code></td>
<td>ç®¡ç†è½¯ä»¶åŒ…</td>
<td></td>
</tr>
<tr>
<td><code>user</code></td>
<td>ç”¨æˆ·å’Œç»„</td>
<td></td>
</tr>
<tr>
<td><code>git</code></td>
<td>ä»æºä»£ç ç®¡ç†ç³»ç»Ÿéƒ¨ç½²</td>
<td></td>
</tr>
<tr>
<td><code>service</code></td>
<td>ç®¡ç†æœåŠ¡</td>
<td></td>
</tr>
<tr>
<td><code>setup</code></td>
<td>æ”¶é›†ç›®æ ‡ä¸»æœºä¿¡æ¯</td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>å‚æ•°è§£é‡Š</li>
</ul>
<blockquote>
<ul>
<li><code>-i</code><!-- raw HTML omitted -->æŒ‡å®š<!-- raw HTML omitted --><code>Ansible</code><!-- raw HTML omitted -->ä¸»æœºæ¸…å•ï¼Œå¯ä»¥æŒ‡å®šå¤–éƒ¨<!-- raw HTML omitted --></li>
<li><code>-m</code><!-- raw HTML omitted -->æŒ‡å®šè¦æ‰§è¡Œçš„æ¨¡å—ï¼Œæ¯”å¦‚ï¼š<!-- raw HTML omitted --><code>ping</code>ã€<code>shell</code>ã€<code>copy</code></li>
<li><code>-a</code><!-- raw HTML omitted -->æŒ‡å®šæ¨¡å—çš„å‚æ•°ï¼Œ ä¾‹å¦‚ï¼š<!-- raw HTML omitted --><code>cppy</code>é‡Œçš„<code>src</code>ã€<code>dest</code></li>
<li><code>-o</code><!-- raw HTML omitted -->ç®€æ´è¾“å‡ºæ³•<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><code>ping</code><!-- raw HTML omitted -->æµ‹è¯•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ansible all -m ping
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»¥bruceèº«ä»½ ping æ‰€æœ‰ä¸»æœº</span>
</span></span><span style="display:flex;"><span>$ ansible all -m ping -u bruce
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”¨bruceç”¨æˆ· ä»¥rootèº«ä»½ ping</span>
</span></span><span style="display:flex;"><span>$ ansible all -m ping -u bruce --sudo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”¨bruceç”¨æˆ· sudoåˆ° batmanç”¨æˆ· ping</span>
</span></span><span style="display:flex;"><span>$ ansible all -m ping -u bruce --sudo --sudo-user batman
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ ansible all -a <span style="color:#e6db74">&#34;/bin/echo hello&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¹¶è¡Œæ€§å’Œ<!-- raw HTML omitted --><code>shell</code><!-- raw HTML omitted -->å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># é‡å¯ altanta ä¸»æœºç»„çš„æ‰€æœ‰æœºå™¨ï¼Œæ¯æ¬¡é‡å¯ 10 å°</span>
</span></span><span style="display:flex;"><span>$ ansible atlanta -a <span style="color:#e6db74">&#34;/sbin/reboot&#34;</span> -f <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»¥ geekwolf ç”¨æˆ·èº«ä»½åœ¨ atlanta ç»„çš„æ‰€æœ‰ä¸»æœºè¿è¡Œ foo å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ ansible atlanta -a <span style="color:#e6db74">&#34;/usr/bin/foo&#34;</span> -u geekwolf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»¥ geekwolf ç”¨æˆ·èº«ä»½ sudo æ‰§è¡Œå‘½ä»¤ fooï¼ˆ--ask-sudo-pass (-K) å¦‚æœæœ‰ sudo å¯†ç è¯·ä½¿ç”¨æ­¤å‚æ•°ï¼‰</span>
</span></span><span style="display:flex;"><span>$ ansible atlanta -a <span style="color:#e6db74">&#34;/usr/bin/foo&#34;</span> -u geekwolf --sudo <span style="color:#f92672">[</span>--ask-sudo-pass<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¹Ÿå¯ä»¥ sudo åˆ°å…¶ä»–ç”¨æˆ·æ‰§è¡Œå‘½ä»¤é root</span>
</span></span><span style="display:flex;"><span>$ ansible atlanta -a <span style="color:#e6db74">&#34;/usr/bin/foo&#34;</span> -u username -U otheruser <span style="color:#f92672">[</span>--ask-sudo-pass<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é»˜è®¤æƒ…å†µä¸‹ï¼Œansible ä½¿ç”¨çš„ module æ˜¯ commandï¼Œè¿™ä¸ªæ¨¡å—å¹¶ä¸æ”¯æŒ shell å˜é‡å’Œç®¡é“ç­‰ï¼Œè‹¥æƒ³ä½¿ç”¨shell æ¥æ‰§è¡Œæ¨¡å—ï¼Œè¯·ä½¿ç”¨-m å‚æ•°æŒ‡å®š shell æ¨¡å—</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨ shell æ¨¡å—åœ¨è¿œç¨‹ä¸»æœºæ‰§è¡Œå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ ansible raleigh -m shell -a <span style="color:#960050;background-color:#1e0010">&#39;</span>echo $TERM</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¼ è¾“æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>copy</code>æ¨¡å—</li>
</ul>
<blockquote>
<ul>
<li><code>src</code><!-- raw HTML omitted -->æº<!-- raw HTML omitted --></li>
<li><code>dest</code><!-- raw HTML omitted -->ç›®çš„åœ°<!-- raw HTML omitted --></li>
<li><code>mode</code><!-- raw HTML omitted -->æƒé™<!-- raw HTML omitted --></li>
<li><code>owner</code><!-- raw HTML omitted -->å±ä¸»<!-- raw HTML omitted --></li>
<li><code>group</code><!-- raw HTML omitted -->å±ç»„<!-- raw HTML omitted --></li>
<li><code>backup</code><!-- raw HTML omitted -->å¤‡ä»½<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŠŠæœ¬åœ°/etc/hostsæ–‡ä»¶æ‹·è´åˆ° atlantaä¸»æœºç»„æ‰€æœ‰ä¸»æœºçš„/tmp/hosts(ç©ºç›®å½•é™¤å¤–),å¦‚æœä½¿ç”¨playbooks åˆ™å¯ä»¥å……åˆ†åˆ©ç”¨ template æ¨¡å—</span>
</span></span><span style="display:flex;"><span>$ ansible atlanta -m copy -a <span style="color:#e6db74">&#34;src=../../etc/hosts dest=/tmp/hosts&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>file</code>æ¨¡å—</li>
</ul>
<blockquote>
<ul>
<li></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># file æ¨¡å—å…è®¸æ›´æ”¹æ–‡ä»¶çš„ç”¨æˆ·åŠæƒé™</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m file -a <span style="color:#e6db74">&#34;dest=/srv/foo/a.txt mode=600&#34;</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m file -a <span style="color:#e6db74">&#34;dest=/srv/foo/b.txt mode=600 owner=mdehaan group=mdehaan&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨ file æ¨¡å—åˆ›å»ºç›®å½•ï¼Œç±»ä¼¼ mkdir -p</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m file -a <span style="color:#e6db74">&#34;dest=/path/to/c mode=755 owner=mdehaan group=mdehaan state=directory&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨ file æ¨¡å—åˆ é™¤æ–‡ä»¶æˆ–è€…ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m file -a <span style="color:#e6db74">&#34;dest=/path/to/c state=absent&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>synchronize</code></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ç®¡ç†è½¯ä»¶åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>æ³¨é‡Šï¼š<code>Ansible</code>æ”¯æŒå¾ˆå¤šæ“ä½œç³»ç»Ÿçš„è½¯ä»¶åŒ…ç®¡ç†ï¼Œä½¿ç”¨æ—¶<code>-m</code>æŒ‡å®šç›¸åº”çš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·æ¨¡å—ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„æ¨¡å—ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰ç±»ä¼¼çš„æ¨¡å—æˆ–è€…ä½¿ç”¨<code>command</code>æ¨¡å—æ¥å®‰è£…è½¯ä»¶åŒ…</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># present ç¡®è®¤å®‰è£…ï¼Œ ä½†ä¸æ›´æ–°</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m apt -a <span style="color:#e6db74">&#34;name=nginx state=present&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¡®è®¤å®‰è£…ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m apt -a <span style="color:#e6db74">&#34;name=nginx-1.5 state=present&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># installed ç¡®è®¤å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m apt -a <span style="color:#e6db74">&#34;name=nginx state=installed&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># latest ç¡®è®¤å®‰è£…åŒ…ä¸ºæœ€æ–°</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m apt -a <span style="color:#e6db74">&#34;name=nginx state=latest&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># absent å’Œ removed ç¡®è®¤åˆ é™¤</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m apt -a <span style="color:#e6db74">&#34;name=nginx state=absent&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç”¨æˆ·å’Œç”¨æˆ·ç»„<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨ user æˆ–è€… group æ¨¡å—å¯¹äºåˆ›å»ºæ–°ç”¨æˆ·å’Œæ›´æ”¹ã€åˆ é™¤å·²å­˜åœ¨ç”¨æˆ·éå¸¸æ–¹ä¾¿</span>
</span></span><span style="display:flex;"><span>$ ansible all -m user -a <span style="color:#e6db74">&#34;name=foo password=&lt;crypted password here&gt;&#34;</span>
</span></span><span style="display:flex;"><span>$ ansible all -m group -a <span style="color:#e6db74">&#34;name=foo state=absent&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>systemd</code>ã€<code>service</code><!-- raw HTML omitted -->æœåŠ¡ç®¡ç†<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>daemon_reload</code><!-- raw HTML omitted -->é‡æ–°è½½å…¥<!-- raw HTML omitted --><code>systemd</code></li>
<li><code>enabled</code><!-- raw HTML omitted -->æ˜¯å¦å¼€æœºå¯åŠ¨<!-- raw HTML omitted --><code>yes|no</code></li>
<li><code>name</code><!-- raw HTML omitted -->æœåŠ¡åç§°<!-- raw HTML omitted --><code>httpd|sshd|nginx</code></li>
<li><code>state</code><!-- raw HTML omitted -->å¯¹å½“å‰æœåŠ¡æ“ä½œï¼Œ ä¾‹å¦‚ï¼š Â å¯åŠ¨ã€åœæ­¢<!-- raw HTML omitted --><code>started</code>ã€<code>stopped</code>ã€<code>restarted</code>ã€<code>reloaded</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç¡®ä¿ webservers ç»„æ‰€æœ‰ä¸»æœºçš„ httpd æ˜¯å¯åŠ¨çš„</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m service -a <span style="color:#e6db74">&#34;name=httpd state=started&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡å¯ webservers ç»„æ‰€æœ‰ä¸»æœºçš„ httpd æœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m service -a <span style="color:#e6db74">&#34;name=httpd state=restarted&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¡®ä¿ webservers ç»„æ‰€æœ‰ä¸»æœºçš„ httpd æ˜¯å…³é—­çš„</span>
</span></span><span style="display:flex;"><span>$ ansible webservers -m service -a <span style="color:#e6db74">&#34;name=httpd state=stopped&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åå°è¿è¡Œ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œå¯ä»¥æ”¾åˆ°åå°æ‰§è¡Œï¼Œ<code>ansible</code>ä¼šæ£€æŸ¥ä»»åŠ¡çš„çŠ¶æ€ï¼›åœ¨ä¸»æœºä¸Šæ‰§è¡Œçš„åŒä¸€ä¸ªä»»åŠ¡ä¼šåˆ†é…åŒä¸€ä¸ª<code>job ID</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åå°æ‰§è¡Œå‘½ä»¤ 3600sï¼Œ-B è¡¨ç¤ºåå°æ‰§è¡Œçš„æ—¶é—´</span>
</span></span><span style="display:flex;"><span>$ ansible all -B <span style="color:#ae81ff">3600</span> -a <span style="color:#e6db74">&#34;/usr/bin/long_running_operation --do-stuff&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥ä»»åŠ¡çš„çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>$ ansible all -m async_status -a <span style="color:#e6db74">&#34;jid=123456789&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åå°æ‰§è¡Œå‘½ä»¤æœ€å¤§æ—¶é—´æ˜¯ 1800s å³ 30 åˆ†é’Ÿï¼Œ-P æ¯ 60s æ£€æŸ¥ä¸‹çŠ¶æ€é»˜è®¤ 15s</span>
</span></span><span style="display:flex;"><span>$ ansible all -B <span style="color:#ae81ff">1800</span> -P <span style="color:#ae81ff">60</span> -a <span style="color:#e6db74">&#34;/usr/bin/long_running_operation --do-stuff&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æœé›†ç³»ç»Ÿä¿¡æ¯<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>gather_facts: no</code><!-- raw HTML omitted -->å…³é—­<!-- raw HTML omitted --><code>Facts</code><!-- raw HTML omitted -->å˜é‡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Facts åœ¨ playbooks ä¸€ç« ä¸­ä¼šæœ‰è¯¦ç»†çš„æè¿°ï¼Œè¿™é‡Œåªé€šè¿‡å‘½ä»¤è·å–æ‰€æœ‰çš„ç³»ç»Ÿä¿¡æ¯æœé›†ä¸»æœºçš„æ‰€æœ‰ç³»ç»Ÿä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>$ ansible all -m setup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æœé›†ç³»ç»Ÿä¿¡æ¯å¹¶ä»¥ä¸»æœºåä¸ºæ–‡ä»¶ååˆ†åˆ«ä¿å­˜åœ¨/tmp/facts ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ ansible all -i localhost, -m setup --tree /tmp/facts.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æœé›†å’Œå†…å­˜ç›¸å…³çš„ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>$ ansible all -i localhost, -m setup -a <span style="color:#e6db74">&#39;filter=ansible_*_mb&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æœé›†ç½‘å¡ä¿¡æ¯ ansible_default_ipv4</span>
</span></span><span style="display:flex;"><span>$ ansible all -i localhost, -m setup -a <span style="color:#e6db74">&#39;filter=ansible_all_ipv4_addresses&#39;</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="ä½¿ç”¨galaxy">ä½¿ç”¨<code>Galaxy</code></h3>
<blockquote>
<ul>
<li>ä»<a href="https://galaxy.ansible.com/ui/" rel="external" target="_self"><code>Galaxy</code></a>å’Œ<code>Github</code>è·å¾—ç¬¬ä¸‰æ–¹çš„è§’è‰²</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆå§‹åŒ–é¡¹ç›®ï¼Œç”Ÿæˆé»˜è®¤ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ ansible-galaxy init nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨galaxy å®‰è£…æœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ ansible-galaxy install -p roles darkraiden.ansible-pip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ansible-galaxy install -p roles git+https://github.com/avinetworks/ansible-role-docker,master</span></span></code></pre></div></blockquote>
<hr>
<h3 id="é…ç½®playbook">é…ç½®<code>Playbook</code></h3>
<ul>
<li>
<ol>
<li><code>Ansible-Playbook</code><!-- raw HTML omitted -->ç›®å½•ã€å­—æ®µå®šä¹‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.ansible.com/ansible/latest/tips_tricks/ansible_tips_tricks.html" rel="external" target="_self"><code>Ansible</code>å®˜ç½‘æ–‡æ¡£</a></td>
<td><code>Ansible Playbook</code>å®˜æ–¹æ–‡æ¡£</td>
</tr>
<tr>
<td><a href="https://github.com/ansible/ansible-examples" rel="external" target="_self"><code>Ansible</code>ç¤ºä¾‹å‚è€ƒ</a></td>
<td>ç¤ºä¾‹å‚è€ƒç½‘å€</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ansible-playbook -i /etc/ansible/hosts example.yml -C  	<span style="color:#75715e"># -C æ¨¡æ‹Ÿè¿è¡ŒæŸ¥çœ‹æµç¨‹æ˜¯å¦ä¼šå‡ºé”™</span>
</span></span><span style="display:flex;"><span>$ ansible-playbook -i /etc/ansible/hosts example.yml --syntax-check  	<span style="color:#75715e"># æ ¡éªŒPlayBookè„šæœ¬è¯­æ³•</span>
</span></span><span style="display:flex;"><span>$ ansible-playbook -i /etc/ansible/hosts example.yml --tags <span style="color:#e6db74">&#34;configuration,install&#34;</span>  	<span style="color:#75715e"># æŒ‡å®šå®‰è£…</span>
</span></span><span style="display:flex;"><span>$ ansible-playbook -i /etc/ansible/hosts example.yml --skip-tags <span style="color:#e6db74">&#34;install&#34;</span>  <span style="color:#75715e"># è·³è¿‡ Install æ­¥éª¤ </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ ¡éªŒyamlæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ pip3 install pyyaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨sysæ ‡å‡†è¾“å…¥éªŒè¯</span>
</span></span><span style="display:flex;"><span>$ python3 -c <span style="color:#e6db74">&#39;import yaml,sys; print(yaml.safe_load(sys.stdin))&#39;</span>  &lt; my_yaml.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å…¶ä¸­ï¼Œ-i inventory_file æŒ‡å®šäº†ä½ çš„ Ansible inventory æ–‡ä»¶æˆ–è€…ç›´æ¥æŒ‡å®šä¸»æœºå</span>
</span></span><span style="display:flex;"><span>$ ansible-playbook -i inventory_file execute_local_script.yaml</span></span></code></pre></div><ul>
<li>æ‰§è¡Œæ—¶åŠ¨æ€ä¼ å…¥ä¸»æœºå‚æ•°</li>
</ul>
<blockquote>
<ul>
<li><code>your_playbook.yaml</code> æ˜¯ä½ çš„<code>Ansible playbook</code>æ–‡ä»¶åã€‚</li>
<li><code>target_hosts</code> æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è®¾å®šä¸ºå…·ä½“çš„ä¸»æœºç»„åç§°ï¼Œæ¯”å¦‚ <code>web_servers</code>ã€‚</li>
<li><code>-l your_target_hosts</code> æ˜¯ç”¨æ¥æŒ‡å®šè¦æ‰§è¡Œçš„ä¸»æœºç»„çš„é€‰é¡¹ï¼ŒæŒ‡å®šæ‰§è¡Œç›®æ ‡ä¸ºå•ä¸ªä¸»æœº <code>hostname</code>ï¼ŒæŒ‡å®šæ‰§è¡Œç›®æ ‡ä¸ºå¤šä¸ªä¸»æœº <code>host1,host2</code>ï¼Œä½¿ç”¨æ¨¡å¼åŒ¹é…é€‰æ‹©æ‰€æœ‰ä¸»æœºåä»¥ <code>web*</code> å¼€å¤´çš„ä¸»æœº</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ansible-playbook your_playbook.yaml -e <span style="color:#e6db74">&#34;target_hosts=your_target_hosts&#34;</span> -l your_target_hosts</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="rolesè§’è‰²"><code>Roles</code>è§’è‰²</h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>playbook-roles/
</span></span><span style="display:flex;"><span>â””â”€â”€ roles  <span style="color:#75715e"># å‰§æœ¬</span>
</span></span><span style="display:flex;"><span>â”œâ”€â”€ mysql
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ defaults
</span></span><span style="display:flex;"><span>â”‚   â”‚   â””â”€â”€ main.yaml
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ files
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ handlers
</span></span><span style="display:flex;"><span>â”‚   â”‚   â””â”€â”€ main.yaml
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ meta
</span></span><span style="display:flex;"><span>â”‚   â”‚   â””â”€â”€ main.yaml
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ README.md
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ tasks
</span></span><span style="display:flex;"><span>â”‚   â”‚   â””â”€â”€ main.yaml
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ templates
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ tests
</span></span><span style="display:flex;"><span>â”‚   â”‚   â”œâ”€â”€ inventory
</span></span><span style="display:flex;"><span>â”‚   â”‚   â””â”€â”€ test.yaml
</span></span><span style="display:flex;"><span>â”‚   â””â”€â”€ vars
</span></span><span style="display:flex;"><span>â”‚       â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ nginx  	<span style="color:#75715e"># Nginxçš„è§’è‰²å‰§æœ¬</span>
</span></span><span style="display:flex;"><span>â”‚Â   â”œâ”€â”€ defaults/  	<span style="color:#75715e"># å­˜æ”¾é»˜è®¤å˜é‡æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ main.yaml
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ files/  	<span style="color:#75715e"># å­˜æ”¾éœ€è¦ä¼ è¾“çš„é™æ€æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ index.html
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ handlers/  	<span style="color:#75715e"># è§¦å‘å™¨ç›®å½•ï¼Œåœ¨å˜æ›´æ—¶æ‰§è¡Œæ“ä½œ</span>
</span></span><span style="display:flex;"><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ main.yaml
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ meta/  	<span style="color:#75715e"># å­˜æ”¾ role çš„å…ƒæ•°æ®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ main.yaml
</span></span><span style="display:flex;"><span>â”‚Â   â”œâ”€â”€ README.md  	<span style="color:#75715e"># ç”¨äºæè¿° role çš„ README æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ tasks/  	<span style="color:#75715e"># å­˜æ”¾ä¸»è¦ä»»åŠ¡æ–‡ä»¶ï¼Œç”¨æ¥å®‰è£…ç¨‹åºæœåŠ¡</span>
</span></span><span style="display:flex;"><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ main.yaml
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ templates/  	<span style="color:#75715e"># å­˜æ”¾æ¨¡æ¿æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ nginx.conf.j2
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ tests/  	<span style="color:#75715e"># å­˜æ”¾æµ‹è¯•ç›¸å…³æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”‚Â Â  â”‚Â   â”œâ”€â”€ inventory
</span></span><span style="display:flex;"><span>â”‚Â Â  â”‚Â   â””â”€â”€ test.yaml
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ vars/  	<span style="color:#75715e"># å­˜æ”¾å…¶ä»–å˜é‡æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”‚Â Â      â””â”€â”€ main.yaml
</span></span><span style="display:flex;"><span>â””â”€â”€ site.yaml  	<span style="color:#75715e"># å®šä¹‰é‚£ä¸ªèŠ‚ç‚¹æˆ–è€…é‚£ç»„æœåŠ¡å™¨æ‰§è¡Œï¼Œå¯ä»¥å®šä¹‰å¤šä¸ªè§’è‰²å‰§æœ¬</span></span></span></code></pre></div><ul>
<li><code>playbook-roles</code>â†’<code>site.yaml</code></li>
</ul>
<blockquote>
<ul>
<li><code>name</code><!-- raw HTML omitted -->ï¼šæ¯ä¸ª<!-- raw HTML omitted --><code>play</code><!-- raw HTML omitted -->åå­—<!-- raw HTML omitted --></li>
<li><code>hosts</code><!-- raw HTML omitted -->ï¼šæ¯ä¸ª<!-- raw HTML omitted --><code>play</code><!-- raw HTML omitted -->æ¶‰åŠè¢«ç®¡ç†çš„æœåŠ¡å™¨ï¼ŒåŒ<!-- raw HTML omitted --><code>ad-hoc</code><!-- raw HTML omitted -->ä¸­çš„èµ„äº§é€‰æ‹©å™¨<!-- raw HTML omitted --></li>
<li><code>tasks</code><!-- raw HTML omitted -->ï¼šæ¯ä¸ª<!-- raw HTML omitted --><code>play</code><!-- raw HTML omitted -->ä¸­å…·ä½“è¦å®Œæˆçš„ä»»åŠ¡ï¼Œä»¥åˆ—è¡¨çš„å½¢å¼è¡¨è¾¾<!-- raw HTML omitted -->ï¼Œ<code>register: </code><!-- raw HTML omitted -->æ³¨å†Œå˜é‡<!-- raw HTML omitted --></li>
<li><code>become</code><!-- raw HTML omitted -->ï¼šå¦‚æœéœ€è¦ææƒï¼Œåˆ™åŠ ä¸Š<!-- raw HTML omitted --><code>become</code><!-- raw HTML omitted -->ç›¸å…³å±æ€§<!-- raw HTML omitted --></li>
<li><code>become_user</code><!-- raw HTML omitted -->ï¼šè‹¥è¦ææƒçš„è¯ï¼Œææƒåˆ°é‚£ä¸ªç”¨æˆ·ä¸Š<!-- raw HTML omitted --></li>
<li><code>remote_user</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šè¿æ¥åˆ°è¿œç¨‹èŠ‚ç‚¹çš„ç”¨æˆ·ï¼Œå°±æ˜¯åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œå…·ä½“æ“ä½œçš„ç”¨æˆ·å—ï¼Œè‹¥ä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ä½¿ç”¨å½“å‰æ‰§è¡Œ<!-- raw HTML omitted --><code>ansible-playbook</code><!-- raw HTML omitted -->çš„ç”¨æˆ·<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->è¿›é˜¶å‰§æœ¬è¯­æ³•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>when</code><!-- raw HTML omitted -->é€»è¾‘åˆ¤æ–­ï¼š<!-- raw HTML omitted --><code>==</code>ã€<code>!=</code>ã€<code>&gt; &gt;=</code>ã€<code>&lt; &lt;=</code>ã€<code>is defined</code>ã€<code>is not defined</code>ã€<code>true/false</code>ã€<code>and or</code>ã€</li>
<li><code>include</code><!-- raw HTML omitted -->å‰§æœ¬å¼•ç”¨<!-- raw HTML omitted --></li>
<li><code>Handlers</code><!-- raw HTML omitted -->è§¦å‘å™¨<!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<hr>
<h5 id="rolesnginx"><code>Roles</code>â†’<code>Nginx</code></h5>
<ul>
<li>
<ol>
<li><code>Roles</code>â†’<code>Nginx</code><!-- raw HTML omitted -->ç›®å½•ä¸‹æ–‡ä»¶å¤¹é…ç½®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Files</code><!-- raw HTML omitted -->å­˜æ”¾éœ€è¦ä¼ è¾“çš„é™æ€æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/roles/nginx/files/index.html<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TEST
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>Handlers</code><!-- raw HTML omitted -->è§¦å‘å™¨ç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/roles/nginx/handlers/main.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name: restart nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  service: name=nginx state=restarted
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>Tasks</code><!-- raw HTML omitted -->å­˜æ”¾ä¸»è¦ä»»åŠ¡æ–‡ä»¶ï¼Œç”¨æ¥å®‰è£…ç¨‹åºæœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/roles/nginx/tasks/main.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--- # å£°æ˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- hosts: webservers
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  vars:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    hello: Ansible
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  tasks:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Add repo 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    yum_repository:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: nginx repo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      baseurl: http://nginx.org/packages/centos/7/$basearch/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      gpgcheck: no
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      enabled: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    register: reposyntsx  	# æ£€æµ‹å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# å®šä¹‰æ‰§è¡Œé¡¹ç›®åç§°ï¼Œå®‰è£…æœåŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Install Nginx packge
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	yum: name={{ item }} state=lates # item ä¸ºå†…ç½®å˜é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	with_items:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	- epel-release
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	- nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	debug: var=reposyntsx  	# åˆ¤æ–­æ˜¯å¦æˆåŠŸ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	when: reposyntsx.rc == 0  	# ç­‰äº0 ä»£è¡¨æˆåŠŸ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# æ‹·è´æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Copy index.html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	copy: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  src: index.html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  dest: /usr/local/nginx/html/index.html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# æ‹·è´æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Copy nginx.conf Teplate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	temlate: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  src: nginx.conf.j2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  dest: /usr/local/nginx/conf/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	notify: restart nginx  # nginx.conf.j2 æ–‡ä»¶æ‹·è´æˆåŠŸï¼Œé€šçŸ¥handlers(è§¦å‘å™¨) é‡å¯ä½¿ä¹‹ç”Ÿæ•ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# å¯åŠ¨æœåŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: make sure nginx service running
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	service: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  name: nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  state: started
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  enabled: yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# åˆ›å»ºé¡¹ç›®ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Create wwwroot directory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	file:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  dest: /var/www/html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	  state: directory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# åˆ›å»ºä¸€ä¸ªç´¢å¼•æ–‡ä»¶  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Create test page index.html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	shell: echo &#34;hello {{hello}}&#34; &gt; /var/www/html/index.html
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>Templates</code><!-- raw HTML omitted -->æ¨¡æ¿ç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/roles/nginx/templates/nginx.conf.j2<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">user  nobody;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">worker_processes {{ ansible_processor_cores }};  	# æœåŠ¡å†…ç½®å˜é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{# æˆ‘æ˜¯æ³¨é‡Š #}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">events {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    worker_connections {{ worker_connections }};  	# è‡ªå®šä¹‰å˜é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    include       mime.types;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    default_type  application/octet-stream;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sendfile        on;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    keepalive_timeout  65;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        listen       80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        server_name  localhost;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            root   html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            index  index.html index.htm;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        error_page   500 502 503 504  /50x.html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        location = /50x.html {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            root   html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>vars</code><!-- raw HTML omitted -->è‡ªå®šä¹‰å˜é‡ç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/roles/nginx/vars/main.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">worker_connections: 10240;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>site.conf</code>ç›®å½•</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;site.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	listen 80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	server_name www.ctnrs.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		root /var/www/html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		index index.html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Ansible-Playbook</code><!-- raw HTML omitted -->ä¸‹<!-- raw HTML omitted --><code>Roles</code><!-- raw HTML omitted -->ç›®å½•ä¸‹<!-- raw HTML omitted --><code>site.yaml</code>æ–‡ä»¶</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>site.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œå®šä¹‰é‚£ä¸ªèŠ‚ç‚¹æˆ–è€…é‚£ç»„æœåŠ¡å™¨æ‰§è¡Œä»€ä¹ˆç¨‹åº<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/roles/site.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- hosts: web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  roles:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- hosts: mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  roles:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="-playbookå®Œæ•´å‰§æœ¬ç¤ºä¾‹"><code> Playbook</code>å®Œæ•´å‰§æœ¬ç¤ºä¾‹</h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ansible-playbook/nginx.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- hosts: web_server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vars:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    app_path: &#34;{{ base_path }}/app&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    http_port: 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    max_clients: 256
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  become: true  	# éœ€è¦ç›®æ ‡ä¸»æœºçš„ç”¨æˆ·å…·æœ‰sudoæƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  tasks:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: ensure apache is at the latest version
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    yum: name=httpd state=latest
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: ensure apahech is running
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    service: name=httpd state=started
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name:  	# åˆ›å»ºæˆ–ä¿®æ”¹æ–‡ä»¶&amp;ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    file:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      path: /tmp/demo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      state: directory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      mode: 0755
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name:  	# æ‹·è´æ–‡ä»¶åˆ°ç›®æ ‡ä¸»æœº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    copy:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      src: /etc/hostname
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      dest: /tmp/demo/hostname
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: disable selinux
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    command: /sbin/setenforce 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: run this command and ignore the result
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    shell: /usr/bin/somecommand || /bin/true 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ignore_errors: True  	# å¿½ç•¥æŠ¥é”™ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name:  	# ç”¨æ¨¡æ¿ç”Ÿæˆé…ç½®æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    template:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      src: demo.j2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      dest: &#34;{{ ansible_user_dir }}/demo.cfg&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  handlers
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - name: restart apache
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      service: name=httpd state=restart
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF &gt;roles/demo-role/tasks/main.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- include: yum.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  when: (ansible_distribution|lower == &#39;redhat&#39;) or (ansible_distribution|lower == &#39;centos&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- include: apt.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  when: (ansible_distribution|lower == &#39;debian&#39;) or (ansible_distribution|lower == &#39;ubuntu&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF &gt;roles/demo-role/tasks/yum.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name:  	# ä½¿ç”¨Yumå®‰è£…ApacheæœåŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  yum:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: &#34;{{ redhat_app }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    state: &#34;{{ app_state }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  notify:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF &gt;roles/demo-role/tasks/apt.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name:  	# ä½¿ç”¨Aptå®‰è£…ApacheæœåŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  apt:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: &#34;{{ debian_app }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    state: &#34;{{ app_state }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  notify:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF &gt;roles/demo-role/vars/main.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">redhat_app: httpd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">debian_app: apache2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF &gt;roles/demo-role/handlers/main.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name: done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  debug:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    msg: &#34;ApacheæœåŠ¡å·²éƒ¨ç½²&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è‡ªåŠ¨éƒ¨ç½²<!-- raw HTML omitted --><code>Tomcat</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">webservers </span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">gather_facts</span>: <span style="color:#66d9ef">no</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">vars</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">tomcat_version</span>: <span style="color:#ae81ff">8.5.34</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">tomcat_install_dir</span>: <span style="color:#ae81ff">/usr/local</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tasks</span>:
</span></span><span style="display:flex;"><span>	- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install jdk1.8</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">yum</span>: <span style="color:#ae81ff">name=java-1.8.0-openjdk state=present</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Download tomcat</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">get_url</span>: <span style="color:#ae81ff">url=http://mirrors.hust.edu.cn/apache/tomcat/tomcat-</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8</span><span style="color:#ae81ff">/v{{ tomcat_version }}/bin/apache-tomcat-{{ tomcat_version }}.tar.gz dest=/tmp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Unarchive tomcat-{{ tomcat_version }}.tar.gz</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">unarchive</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">src</span>: <span style="color:#ae81ff">/tmp/apache-tomcat-{{ tomcat_version }}.tar.gz </span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">dest</span>: <span style="color:#e6db74">&#34;{{ tomcat_install_dir }}&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">copy</span>: <span style="color:#66d9ef">no</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Start tomcat </span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">shell</span>: <span style="color:#ae81ff">cd {{ tomcat_install_dir }} &amp;&amp;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">mv apache-tomcat-{{ tomcat_version }} tomcat8 &amp;&amp;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">cd tomcat8/bin &amp;&amp; nohup ./startup.sh &amp;</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_slatstack">Install_Slatstack</h1>

<h2 id="slatstack"><code>Slatstack</code></h2>
<blockquote>
<ul>
<li><a href="https://blog.51cto.com/u_14316149/2421229" rel="external" target="_self"><code>Saltstack</code>åŸºæœ¬å‘½ä»¤,æ¨¡å—,ç»„ä»¶è¯¦è§£</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ salt <span style="color:#e6db74">&#34;*&#34;</span> sys.doc &gt; /tmp/saltstack-status.txt</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_ansible">Install_Ansible</h1>

<h2 id="markæ§åˆ¶æœºmarkå’Œmarkç›®æ ‡æœºmark"><!-- raw HTML omitted -->æ§åˆ¶æœº<!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted -->ç›®æ ‡æœº<!-- raw HTML omitted --></h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ§åˆ¶æœºï¼š<!-- raw HTML omitted -->å®‰è£…<code>Python</code>ã€<code>Docker</code>ã€<code>Pip</code>å’Œ<code>Sshpass</code></li>
<li><!-- raw HTML omitted -->ç›®æ ‡æœºï¼š<!-- raw HTML omitted -->å®‰è£…<code>Python</code></li>
</ul>
<table>
<thead>
<tr>
<th>åœ°å€</th>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://blog.51cto.com/lizhenliang" rel="external" target="_self">é˜¿è‰¯è€å¸ˆåšå®¢</a></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="https://releases.ansible.com/ansible/" rel="external" target="_self"><code>Ansible</code>å®‰è£…åŒ…</a></td>
<td><code>Ansible</code>å®˜ç½‘</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/ansible/ansible" rel="external" target="_self"><code>Github-Ansible</code>åŸä»£ç </a></td>
<td><code>Github Ansible</code>åŸä»£ç </td>
<td></td>
</tr>
<tr>
<td><a href="https://docs.ansible.com/ansible/latest/installation_guide/index.html" rel="external" target="_self"><code>Install Ansible</code></a></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="å®‰è£…æ§åˆ¶ç«¯ç¨‹åº">å®‰è£…æ§åˆ¶ç«¯ç¨‹åº</h3>
<h4 id="font-colorredå®‰è£…fontansible"><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Ansible</code></h4>
<blockquote>
<ul>
<li><code>yum</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Ansible</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
</span></span><span style="display:flex;"><span>$ rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6
</span></span><span style="display:flex;"><span>$ yum -y install epel-release
</span></span><span style="display:flex;"><span>$ sudo yum -y install ansible</span></span></code></pre></div><ul>
<li><code>apt</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Ansible</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo apt-get install python-dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/apt/source.list<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deb http://ppa.launchpad.net/ansible/ansible/ubuntu trusty main
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deb-src http://ppa.launchpad.net/ansible/ansible/ubuntu trusty main
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo apt-get install software-properties-common
</span></span><span style="display:flex;"><span>$ sudo apt-add-repository ppa:ansible/ansible
</span></span><span style="display:flex;"><span>$ sudo apt-get update
</span></span><span style="display:flex;"><span>$ sudo apt-get install ansible</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Python</code>çš„<code>pip</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Ansible</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pip install ansible
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ curl https://raw.githubusercontent.com/mitsuhiko/pipsi/master/get-pipsi.py | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>python
</span></span><span style="display:flex;"><span>$ pipsi install ansible</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æºç å®‰è£…<!-- raw HTML omitted --><code>Ansible</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone git://github.com/ansible/ansible.git
</span></span><span style="display:flex;"><span>$ cd ./ansible
</span></span><span style="display:flex;"><span>$ make rpm
</span></span><span style="display:flex;"><span>$ sudo rpm -Uvh ~/rpmbuild/ansible-*.noarch.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ git clone git://github.com/ansible/ansible.git --recursive
</span></span><span style="display:flex;"><span>$ cd ./ansible
</span></span><span style="display:flex;"><span>$ source ./hacking/env-setup
</span></span><span style="display:flex;"><span>$ sudo easy_install pip
</span></span><span style="display:flex;"><span>$ sudo pip install paramiko PyYAML Jinja2 httplib2</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å‡çº§<!-- raw HTML omitted --><code>Ansible</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git pull --rebase
</span></span><span style="display:flex;"><span>$ git submodule update --init --recursive</span></span></code></pre></div></blockquote>
<hr>
<h4 id="font-colorredå®‰è£…fontpython"><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Python</code></h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install python-pip python3  	<span style="color:#75715e"># å®‰è£…python 3</span>
</span></span><span style="display:flex;"><span>$ python3.6 -m pip install --upgrade --force pip  	<span style="color:#75715e"># é€šè¿‡ python 3 å®‰è£…pip3</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="font-colorredå®‰è£…fontdocker"><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Docker</code></h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum makecache fast
</span></span><span style="display:flex;"><span>$ yum list docker-ce  --showduplicates|sort -r
</span></span><span style="display:flex;"><span>$ yum install -y docker-ce-20.10.4 docker-ce-cli-20.10.4 containerd.io docker-compose-plugin
</span></span><span style="display:flex;"><span>$ systemctl enable docker <span style="color:#f92672">&amp;&amp;</span> systemctl start docker</span></span></code></pre></div></blockquote>
<hr>
<h4 id="font-colorredå®‰è£…fontsshpass"><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Sshpass</code></h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install sshpass</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="backend">Backend</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Backend</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="tomcat">Tomcat</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Tomcat</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_tomcat">Configure_Tomcat</h1>

<h2 id="é…ç½®tomcat">é…ç½®<code>Tomcat</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æ¸…ç†<!-- raw HTML omitted --><code>Tomcat</code><!-- raw HTML omitted -->æ—¥å¿—<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ¸…ç†è¶…è¿‡ä¸ƒå¤©ä»¥ä¸Šçš„æ—¥<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;#!/bin/bash/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">tomdate=&#34;</span><span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#34;%Y%m%d%s&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">tomlog=&#39;/opt/logs/tomcat*&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo </span>$tomdate<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># echo </span>$tomlog<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">find </span>$tomlog<span style="color:#e6db74">/*.log  -type f -ctime +7 -exec  rm  -f  {}  \;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">find </span>$tomlog<span style="color:#e6db74">/*.txt  -type f -ctime +7 -exec  rm  -f  {}  \; &#34;</span>&gt;/opt/scripts/DEL_TOMLOG.sh</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ¸…ç†æ—¥å¿—è„šæœ¬æ·»åŠ åˆ°è®¡åˆ’ä»»åŠ¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;### tomcatè¶…éä¸ƒå¤©logåˆªé™¤
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1 0 * * * /bin/bash /opt/scripts/DEL_TOMLOG.sh &gt;&gt; ~/del_tom.log 2&gt;&amp;1&#34;</span> &gt;&gt; /var/spool/cron/myadmin</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ—¥å¿—åšæ¯æ—¥åˆ‡å‰²<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;/opt/data/logs/tomcat/catalina.out{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">copytruncate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">daily
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rotate 7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">missingok
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">compress
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">size 100k
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">su root root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">} &#34;</span>&gt;&gt; /etc/logrotate.d/tomcat  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å®‰å…¨è®¾ç½®è§„èŒƒ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>  telnet</code><!-- raw HTML omitted -->ç®¡ç†ç«¯å£ä¿æŠ¤ï¼ˆå¼ºåˆ¶ï¼‰<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>é…ç½®å†…å®¹åŠè¯´æ˜</th>
<th>æ ‡å‡†é…ç½®</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>telnet</code>ç®¡ç†ç«¯å£ä¿æŠ¤</td>
<td>1.ä¿®æ”¹é»˜è®¤çš„<code>8005</code>ç®¡ç†ç«¯å£ä¸ºä¸æ˜“çŒœæµ‹çš„ç«¯å£ï¼ˆå¤§äº1024ï¼‰ï¼›  <!-- raw HTML omitted -->2.ä¿®æ”¹<code>SHUTDOWN</code>æŒ‡ä»¤ä¸ºå…¶ä»–å­—ç¬¦ä¸²ï¼›</td>
<td><!-- raw HTML omitted --></td>
<td>1.ä»¥ä¸Šé…ç½®é¡¹çš„é…ç½®å†…å®¹åªæ˜¯å»ºè®®é…ç½®ï¼Œå¯ä»¥æŒ‰ç…§æœåŠ¡å®é™…æƒ…å†µè¿›è¡Œåˆç†é…ç½®ï¼Œä½†è¦æ±‚ç«¯å£é…ç½®åœ¨<strong>8000~8999</strong>ä¹‹é—´ï¼›</td>
</tr>
</tbody>
</table>
<ul>
<li><code>ajp</code><!-- raw HTML omitted -->è¿æ¥ç«¯å£ä¿æŠ¤ï¼ˆæ¨èï¼‰<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>é…ç½®å†…å®¹åŠè¯´æ˜</th>
<th>æ ‡å‡†é…ç½®</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ajp  è¿æ¥ç«¯å£ä¿æŠ¤</td>
<td>1.ä¿®æ”¹é»˜è®¤çš„<code>ajp 8009</code>ç«¯å£ä¸ºä¸æ˜“å†²çªçš„å¤§äº1024ç«¯å£ï¼›  2.é€šè¿‡<code>iptables</code>è§„åˆ™é™åˆ¶<code>ajp</code>ç«¯å£è®¿é—®çš„æƒé™ä»…ä¸ºçº¿ä¸Šæœºå™¨ï¼›</td>
<td><!-- raw HTML omitted --></td>
<td>ä»¥ä¸Šé…ç½®é¡¹çš„é…ç½®å†…å®¹ä»…ä¸ºå»ºè®®é…ç½®ï¼Œè¯·æŒ‰ç…§æœåŠ¡å®é™…æƒ…å†µè¿›è¡Œåˆç†é…ç½®ï¼Œä½†è¦æ±‚ç«¯å£é…ç½®åœ¨<strong>8000~8999</strong>ä¹‹é—´ï¼›ï¼›  ä¿æŠ¤æ­¤ç«¯å£çš„ç›®çš„åœ¨äºé˜²æ­¢çº¿ä¸‹çš„æµ‹è¯•æµé‡è¢«<code>mod_jk</code>è½¬å‘è‡³çº¿ä¸Š<code>tomcat</code>æœåŠ¡å™¨ï¼›</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->ç¦ç”¨ç®¡ç†ç«¯ï¼ˆå¼ºåˆ¶ï¼‰<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>é…ç½®å†…å®¹åŠè¯´æ˜</th>
<th>æ ‡å‡†é…ç½®</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¦ç”¨ç®¡ç†ç«¯</td>
<td>1. åˆ é™¤é»˜è®¤çš„{<code>Tomcat</code>å®‰è£…ç›®å½•}<code>/conf/tomcat-users.xml</code>æ–‡ä»¶ï¼Œé‡å¯<code>tomcat</code>åå°†ä¼šè‡ªåŠ¨ç”Ÿæˆæ–°çš„æ–‡ä»¶ï¼›  2. åˆ é™¤{<code>Tomcat</code>å®‰è£…ç›®å½•}<code>/webapps</code>ä¸‹é»˜è®¤çš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶ï¼›  3.å°†<code>tomcat</code>åº”ç”¨æ ¹ç›®å½•é…ç½®ä¸º<code>tomcat</code>å®‰è£…ç›®å½•ä»¥å¤–çš„ç›®å½•ï¼›</td>
<td><!-- raw HTML omitted --></td>
<td>å¯¹äºå‰æ®µ<code>web</code>æ¨¡å—ï¼Œ<code>Tomcat</code>ç®¡ç†ç«¯å±äº<code>tomcat</code>çš„é«˜å±å®‰å…¨éšæ‚£ï¼Œä¸€æ—¦è¢«æ”»ç ´ï¼Œé»‘å®¢é€šè¿‡ä¸Šä¼ <code>web shell</code>çš„æ–¹å¼å°†ä¼šç›´æ¥å–å¾—æœåŠ¡å™¨çš„æ§åˆ¶æƒï¼Œåæœæå…¶ä¸¥é‡ï¼›</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->é™æƒå¯åŠ¨ï¼ˆå¼ºåˆ¶ï¼‰<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>é…ç½®å†…å®¹åŠè¯´æ˜</th>
<th>æ ‡å‡†é…ç½®</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>é™æƒå¯åŠ¨</td>
<td>1.<code>tomcat</code>å¯åŠ¨ç”¨æˆ·æƒé™å¿…é¡»ä¸ºé<code>root</code>æƒé™ï¼Œå°½é‡é™ä½<code>tomcat</code>å¯åŠ¨ç”¨æˆ·çš„ç›®å½•è®¿é—®æƒé™ï¼› <!-- raw HTML omitted --> 2.å¦‚éœ€ç›´æ¥å¯¹å¤–ä½¿ç”¨<code>80</code>ç«¯å£ï¼Œå¯é€šè¿‡æ™®é€šè´¦å·å¯åŠ¨åï¼Œé…ç½®<code>iptables</code>è§„åˆ™è¿›è¡Œè½¬å‘ï¼›</td>
<td>-</td>
<td>é¿å…ä¸€æ—¦<code>tomcat</code>æœåŠ¡è¢«å…¥ä¾µï¼Œé»‘å®¢ç›´æ¥è·å–é«˜çº§ç”¨æˆ·æƒé™å±å®³æ•´ä¸ª<code>server</code>çš„å®‰å…¨ï¼›</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted --> æ–‡ä»¶åˆ—è¡¨è®¿é—®æ§åˆ¶ï¼ˆå¼ºåˆ¶ï¼‰<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>é…ç½®å†…å®¹åŠè¯´æ˜</th>
<th>æ ‡å‡†é…ç½®</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ–‡ä»¶åˆ—è¡¨è®¿é—®æ§åˆ¶</td>
<td>1.<code>conf/web.xml</code>æ–‡ä»¶ä¸­<code>default</code>éƒ¨åˆ†<code>listings</code>çš„é…ç½®å¿…é¡»ä¸º<code>false</code>ï¼›</td>
<td><!-- raw HTML omitted -->  <!-- raw HTML omitted --><strong>listings</strong><!-- raw HTML omitted -->  <!-- raw HTML omitted --><strong>false</strong><!-- raw HTML omitted -->  <!-- raw HTML omitted --></td>
<td><code>false</code>ä¸ºä¸åˆ—å‡ºç›®å½•æ–‡ä»¶ï¼Œ<code>true</code>ä¸ºå…è®¸åˆ—å‡ºï¼Œé»˜è®¤ä¸º<code>false</code>ï¼›</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->ç‰ˆæœ¬ä¿¡æ¯éšè—ï¼ˆå¼ºåˆ¶ï¼‰<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>é…ç½®å†…å®¹åŠè¯´æ˜</th>
<th>æ ‡å‡†é…ç½®</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç‰ˆæœ¬ä¿¡æ¯éšè—</td>
<td>1.ä¿®æ”¹<code>conf/web.xml</code>ï¼Œé‡å®šå‘<code>403</code>ã€<code>404</code>ä»¥åŠ<code>500</code>ç­‰é”™è¯¯åˆ°æŒ‡å®šçš„é”™è¯¯é¡µé¢ï¼›  2.ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹åº”ç”¨ç¨‹åºç›®å½•ä¸‹çš„<code>WEB-INF/web.xml</code>ä¸‹çš„é…ç½®è¿›è¡Œé”™è¯¯é¡µé¢çš„é‡å®šå‘ï¼›</td>
<td><!-- raw HTML omitted -->  <!-- raw HTML omitted --><strong>403</strong><!-- raw HTML omitted -->  <!-- raw HTML omitted --><strong>/forbidden.jsp</strong><!-- raw HTML omitted -->  <!-- raw HTML omitted -->  <!-- raw HTML omitted -->  <!-- raw HTML omitted --><strong>404</strong><!-- raw HTML omitted -->  <!-- raw HTML omitted --><strong>/notfound.jsp</strong><!-- raw HTML omitted -->  <!-- raw HTML omitted -->  <!-- raw HTML omitted -->  <!-- raw HTML omitted --><strong>500</strong><!-- raw HTML omitted -->  <!-- raw HTML omitted --><strong>/systembusy.jsp</strong><!-- raw HTML omitted -->  <!-- raw HTML omitted --></td>
<td>åœ¨é…ç½®ä¸­å¯¹ä¸€äº›å¸¸è§é”™è¯¯è¿›è¡Œé‡å®šå‘ï¼Œé¿å…å½“å‡ºç°é”™è¯¯æ—¶tomcaté»˜è®¤æ˜¾ç¤ºçš„é”™è¯¯é¡µé¢æš´éœ²æœåŠ¡å™¨å’Œç‰ˆæœ¬ä¿¡æ¯ï¼›  å¿…é¡»ç¡®ä¿ç¨‹åºæ ¹ç›®å½•ä¸‹çš„é”™è¯¯é¡µé¢å·²ç»å­˜åœ¨ï¼›</td>
</tr>
</tbody>
</table>
<ul>
<li>2.7 <!-- raw HTML omitted --><code>  Server header</code>é‡å†™ï¼ˆæ¨èï¼‰<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>é…ç½®å†…å®¹åŠè¯´æ˜</th>
<th>æ ‡å‡†é…ç½®</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Server header</code>é‡å†™</td>
<td>åœ¨<code>HTTP Connector</code>é…ç½®ä¸­åŠ å…¥<code>server</code>çš„é…ç½®ï¼›</td>
<td>server=&quot;<strong>webserver</strong>&quot;</td>
<td>å½“<code>tomcat HTTP</code>ç«¯å£ç›´æ¥æä¾›<code>web</code>æœåŠ¡æ—¶æ­¤é…ç½®ç”Ÿæ•ˆï¼ŒåŠ å…¥æ­¤é…ç½®ï¼Œå°†ä¼šæ›¿æ¢<code>http</code> å“åº”<code>Server header</code>éƒ¨åˆ†çš„é»˜è®¤é…ç½®ï¼Œé»˜è®¤æ˜¯<code>Apache-Coyote/1.1</code></td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted --> è®¿é—®é™åˆ¶ï¼ˆå¯é€‰ï¼‰<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>é…ç½®å†…å®¹åŠè¯´æ˜</th>
<th>æ ‡å‡†é…ç½®æˆ–æ“ä½œ</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>è®¿é—®é™åˆ¶</td>
<td>é€šè¿‡é…ç½®ï¼Œé™å®šè®¿é—®çš„<code>ip</code>æ¥æº</td>
<td><!-- raw HTML omitted -->  &lt;Valve  className=&ldquo;org.apache.catalina.valves.RemoteAddrValve&rdquo; <strong>allow=&ldquo;61.148.18.138,61.135.165.*&rdquo;  deny=&quot;*.*.*.*&quot;</strong>/&gt;  <!-- raw HTML omitted --></td>
<td>é€šè¿‡é…ç½®ä¿¡ä»»<code>ip</code>çš„ç™½åå•ï¼Œæ‹’ç»éç™½åå•<code>ip</code>çš„è®¿é—®ï¼Œæ­¤é…ç½®ä¸»è¦æ˜¯é’ˆå¯¹é«˜ä¿å¯†çº§åˆ«çš„ç³»ç»Ÿï¼Œä¸€èˆ¬äº§å“çº¿ä¸éœ€è¦ï¼›</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->èµ·åœè„šæœ¬æƒé™å›æ”¶ï¼ˆæ¨èï¼‰<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>é…ç½®å†…å®¹åŠè¯´æ˜</th>
<th>æ ‡å‡†é…ç½®æˆ–æ“ä½œ</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>èµ·åœè„šæœ¬æƒé™å›æ”¶</td>
<td>å»é™¤å…¶ä»–ç”¨æˆ·å¯¹<code>Tomcat</code>çš„<code>bin</code>ç›®å½•ä¸‹<code>shutdown.sh</code>ã€<code>startup.sh</code>ã€<code>catalina.sh</code>çš„å¯æ‰§è¡Œæƒé™ï¼›</td>
<td>chmod -R 744 tomcat/bin/*</td>
<td>é˜²æ­¢å…¶ä»–ç”¨æˆ·æœ‰èµ·åœçº¿ä¸Š<code>Tomcat</code>çš„æƒé™ï¼›</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->è®¿é—®æ—¥å¿—æ ¼å¼è§„èŒƒï¼ˆæ¨èï¼‰<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>é…ç½®å†…å®¹åŠè¯´æ˜</th>
<th>æ ‡å‡†é…ç½®æˆ–æ“ä½œ</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>è®¿é—®æ—¥å¿—æ ¼å¼è§„èŒƒ</td>
<td>å¼€å¯<code>Tomcat</code>é»˜è®¤è®¿é—®æ—¥å¿—ä¸­çš„<code>Referer</code>å’Œ<code>User-Agent</code>è®°å½•</td>
<td><!-- raw HTML omitted --></td>
<td>å¼€å¯<code>Referer</code>å’Œ<code>User-Agent</code>æ˜¯ä¸ºäº†ä¸€æ—¦å‡ºç°å®‰å…¨é—®é¢˜èƒ½å¤Ÿæ›´å¥½çš„æ ¹æ®æ—¥å¿—è¿›è¡Œé—®é¢˜æ’æŸ¥ï¼›</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å»ºè®®é…ç½®åŠæ ‡å‡†æ‰§è¡Œæ–¹æ¡ˆ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®éƒ¨åˆ†<!-- raw HTML omitted --><code>${CATALINA_HOME}conf/server.xml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;<span style="color:#e6db74">${</span>CATALINA_HOME<span style="color:#e6db74">}</span>conf/server.xml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;Server port=&#34;8527&#34; shutdown=&#34; dangerous&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;!-- Define a non-SSL HTTP/1.1 Connector on port 8080 --&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;Connector port=&#34;8080&#34; server=&#34;webserver&#34;/&gt; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;!-- Define an AJP 1.3 Connector on port 8528 --&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;!--Define an accesslog --&gt; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;Valve className=&#34;org.apache.catalina.valves.AccessLogValve&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                 directory=&#34;logs&#34;  prefix=&#34;localhost_access_log.&#34; suffix=&#34;.txt&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                 pattern=&#34;%h %l %u %t %r %s %b %{Referer}i %{User-Agent}i %D&#34; resolveHosts=&#34;false&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;Connector port=&#34;8528&#34; protocol=&#34;AJP/1.3&#34; /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;Context path=&#34;&#34; docBase=&#34;/home/work/local/tomcat_webapps&#34; debug=&#34;0&#34; reloadable=&#34;false&#34; crossContext=&#34;true&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®éƒ¨åˆ†<!-- raw HTML omitted --><code>${CATALINA_HOME}conf/web.xml</code><!-- raw HTML omitted -->æˆ–è€…<!-- raw HTML omitted --><code>WEB-INF/web.xml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;<span style="color:#e6db74">${</span>CATALINA_HOME<span style="color:#e6db74">}</span>conf/web.xmlæˆ–è€…WEB-INF/web.xml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;init-param&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&lt;param-name&gt;listings&lt;/param-name&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&lt;param-value&gt;false&lt;/param-value&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;/init-param&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;error-page&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&lt;error-code&gt;403&lt;/error-code&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&lt;location&gt;/forbidden.jsp&lt;/location&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;/error-page&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;error-page&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&lt;error-code&gt;404&lt;/error-code&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&lt;location&gt;/notfound.jsp&lt;/location&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;/error-page&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;error-page&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&lt;error-code&gt;500&lt;/error-code&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	&lt;location&gt;/systembusy.jsp&lt;/location&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;/error-page&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ é™¤å¦‚ä¸‹<code>tomcat</code>çš„é»˜è®¤ç›®å½•å’Œé»˜è®¤æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rm -rf tomcat/webapps/*
</span></span><span style="display:flex;"><span>$ rm -rf tomcat/conf/tomcat-user.xml</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å»é™¤å…¶ä»–ç”¨æˆ·å¯¹<code>tomcat</code>èµ·åœè„šæœ¬çš„æ‰§è¡Œæƒé™<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">744</span> â€“R tomcat/bin/*</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_tomcat">Install_Tomcat</h1>

<h2 id="éƒ¨ç½²tomcatæœåŠ¡">éƒ¨ç½²<code>Tomcat</code>æœåŠ¡</h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://tomcat.apache.org/" rel="external" target="_self"><code>Tomcat</code>å®˜ç½‘</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.35/bin/" rel="external" target="_self"><code>8.3.x</code>ç‰ˆæœ¬<code>Tomcat</code>å®‰è£…åŒ…</a></li>
</ol>
</li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Tomcat</code><!-- raw HTML omitted -->å‰å‡†å¤‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>Tomcat</code><!-- raw HTML omitted -->å¯åŠ¨ç”¨æˆ·<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ groupadd myadmin <span style="color:#f92672">&amp;&amp;</span> useradd -g myadmin myadmin  
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;20210627@123&#34;</span>|passwd --stdin myadmin &amp;&gt;/dev/null
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;#########Start/Stop Service###############
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Cmnd_Alias MYADMIN_START_SERVICES = /etc/init.d/nginx, /etc/init.d/tomcat, /opt/* /usr/bin/kill
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">myadmin ALL=(ALL)NOPASSWD:MYADMIN_START_SERVICES&#34;</span> &gt; /etc/sudoers.d/myadmin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">660</span> /etc/sudoers.d/myadmin  </span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>Tomcat</code><!-- raw HTML omitted -->éƒ¨ç½²ç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/<span style="color:#f92672">{</span>data,apps,src,deploy,scripts,logs/tomcat<span style="color:#f92672">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ£€æµ‹<!-- raw HTML omitted --><code>JDK</code><!-- raw HTML omitted -->ç¯å¢ƒ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum list |grep openjdk  	<span style="color:#75715e"># åŒ…æœ‰ @ ä»£è¡¨å®‰è£…</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;#######JDKç’°å¢ƒè®Šæ•¸########################  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JAVA_HOME=/opt/data/jdk  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JRE_HOME=</span>$JAVA_HOME<span style="color:#e6db74">/jre  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export CLASSPATH=</span>$JAVA_HOME<span style="color:#e6db74">/lib:</span>$JAVA_HOME<span style="color:#e6db74">/lib/tools.jar  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=</span>$PATH<span style="color:#e6db74">:</span>$JAVA_HOME<span style="color:#e6db74">/bin:</span>$JAVA_HOME<span style="color:#e6db74">/jre/bin    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CATALINA_HOME=/opt/data/tomcat  	# éƒ¨ç½²å¤šå®ä¾‹å¯åŠ¨è„šæœ¬åº”ç”¨    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export CATALINA_HOME &#34;</span>&gt;&gt;/home/myadmin/.bash_profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ source /home/myadmin/.bash_profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ln -s /opt/data/jdk/bin/java /sbin/java  	<span style="color:#75715e"># ä½¿jaråŒ…å¯ä»¥ç›´æ¥è¿è¡Œ,åé¢åšè½¯è¿æ¥,æˆæƒ  </span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¸‹è½½å®‰è£…<!-- raw HTML omitted --><code>Tomcat</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½<!-- raw HTML omitted --><code>Tomcat</code><!-- raw HTML omitted -->å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /opt/src/ https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.35/bin/apache-tomcat-8.5.35.tar.gz 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget -P /opt/src/ https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.35/bin/apache-tomcat-8.5.35.tar.gz.sha512</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ£€æµ‹å®‰è£…åŒ…å®Œæ•´æ€§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># md5sum -c apache-tomcat-6.0.35.tgz.md5</span>
</span></span><span style="display:flex;"><span>$ sha512sum -c apache-tomcat-8.5.35.tar.gz.sha512</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è§£å‹ä»¥åŠæ›´æ”¹æƒé™<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ln -s /opt/lucky/apache-tomcat-8.5.35 /opt/data/tomcat  	# å¯åšè½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>$ tar -zxvf /opt/src/apache-tomcat-8.5.35.tar.gz -C /opt/data/</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Tomcat</code><!-- raw HTML omitted -->ä¸»é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/8080/8000/g&#34;</span> /opt/data/tomcat/conf/server.xml 
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/logs/\/opt\/data\/logs\/tomcat/g&#39;</span> /opt/data/tomcat/conf/server.xml</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Tomcat</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>Cataline.sh</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/# OS specific support/iJAVA_OPTS=&#34;-Dfile.encoding=UTF-8 -server -Xms2048m -Xmx2048m -Xmn1024m -XX:SurvivorRatio=10 -XX:MaxTenuringThreshold=15 -XX:NewRatio=2 -XX:+DisableExplicitGC&#34;&#39;</span> /opt/data/tomcat/bin/catalina.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/&#34;$CATALINA_BASE&#34;\/logs\/catalina.out/\/opt\/data\/logs\/tomcat\/catalina.out/g&#39;</span> /opt/data/tomcat/bin/catalina.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sed -i &#39;/      &lt;\/Host&gt;/i\        &lt;Context path=&#34;/&#34; docBase=&#34;/opt/lucky/publish-luckybackend&#34; reloadable=&#34;true&#34;&gt;&lt;\/Context&gt;&#39; /opt/data/tomcat/conf/server.xml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/${catalina.base}\/logs/\/opt\/data\/logs\/tomcat/g&#39;</span> /opt/data/tomcat/conf/logging.properties</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>8005</code><!-- raw HTML omitted -->ï¼šç«¯å£æ˜¯<!-- raw HTML omitted --><code>tomcat</code><!-- raw HTML omitted -->æœ¬èº«ç®¡ç†ç«¯å£ï¼Œä¿®æ”¹ä¸€ä¸ªä¸æ˜“çŒœåˆ°<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>8080</code><!-- raw HTML omitted -->ï¼šç«¯å£æ˜¯<!-- raw HTML omitted --><code>tomcat</code><!-- raw HTML omitted -->è´Ÿè´£å»ºç«‹<!-- raw HTML omitted --><code>HTTP</code><!-- raw HTML omitted -->è¿æ¥ã€‚åœ¨é€šè¿‡æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted --><code>tomcat</code><!-- raw HTML omitted -->æœåŠ¡å™¨çš„<!-- raw HTML omitted --><code>web</code><!-- raw HTML omitted -->åº”ç”¨æ—¶ï¼Œä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªç«¯å£<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>8009</code>ï¼š<code>tomcat</code><!-- raw HTML omitted -->è´Ÿè´£å’Œå…¶ä»–çš„<!-- raw HTML omitted --><code>HTTP</code><!-- raw HTML omitted -->æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œå¦‚<!-- raw HTML omitted --><code>nginx</code>å’Œ<code>apache</code><!-- raw HTML omitted -->äº’é€šä½¿ç”¨<!-- raw HTML omitted --></p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ firewall-cmd --permanent --new-ipset<span style="color:#f92672">=</span>tomcat_whitelist --type<span style="color:#f92672">=</span>hash:ip  
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --add-rich-rule<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rule family=&#39;ipv4&#39; source ipset=&#39;tomcat_whitelist&#39; port prot=&#39;7000-7007&#39; protocol=&#39;tcp&#39; accept&#34;</span>  
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç½‘ç«™æ ¹ç›®å½•ä»¥åŠè¿æ¥æ•°æ®åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># é»˜è®¤ç½‘ç«™çš„ä¸»ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ ls /usr/local/tomcat/webapps/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/usr/local/tomcat/webapps/ROOT/WEB-INF/config/jdbc.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># jdbc.url=jdbc:mysql://192.168.213.50:16303/jspgou?characterEncoding=UTF-8  	# jspgouä»£è¡¨æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># jdbc.username=root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># jdbc.password=123
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Tomcat</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/data/tomcat/bin/startup.sh </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç¼–å†™<!-- raw HTML omitted --><code>Tomcat</code><!-- raw HTML omitted -->å¯åŠ¨æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;tomcat.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TOMCAT_PATH=/usr/local/tomcat
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">usage(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;Usage: $0 [start|stop|status|restart]&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">status_tomcat(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ps aux | grep java | grep tomcat | grep -v &#39;grep&#39; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_tomcat(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/usr/local/tomcat/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">stop_tomcat(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TPID=$(ps aux | grep java | grep tomcat | grep -v &#39;grep&#39; | awk &#39;{print $2}&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kill -9 $TPID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TSTAT=$(ps aux | grep java | grep tomcat | grep -v &#39;grep&#39; | awk &#39;{print $2}&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> if [ -z $TSTAT ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   echo &#34;tomcat stop&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   kill -9 $TSTAT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd $TOMCAT_PATH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rm temp/* -rf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rm work/* -rf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">main(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">case $1 in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   start_tomcat;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop_tomcat;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">status)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   status_tomcat;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop_tomcat &amp;&amp; start_tomcat;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> *)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   usage;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">esac
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">main $1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¤šç«¯å£å¯åŠ¨<!-- raw HTML omitted --><code>Tomcat</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;tomcat<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## æ­¤è„šæœ¬ç”¨æ¥å¯åŠ¨åœæ­¢ä»¥åŠæŸ¥çœ‹tomcatå¤šå®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## 2021/04/18	authorï¼šNeek
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JAVA_HOME=/opt/lucky/jdk
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JRE_HOME=$JAVA_HOME/jre
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export CLASSPATH=$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=$PATH:$JAVA_HOME/bin:$JAVA_HOME/jre/bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CATALINA_BASE=&#39;/opt/lucky/tomcat/&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WEBAPPS_PATH=&#39;/opt/lucky/tomcat/webapps&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CATALINA_HOME=&#39;/opt/lucky/tomcat/&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">. /etc/init.d/functions
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">read -p &#34;è¯·è¾“å…¥è¦å¯åŠ¨çš„çš„ç«¯å£å·ï¼Œ8080,6000ï¼Œ7000~7007ï¼Œ8818ï¼š&#34; port
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">case $port in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 8080)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  export CATALINA_BASE=&#34;/opt/lucky/tomcat&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  read -p &#34;å¯åŠ¨åœæ­¢tomcatä»¥åŠæŸ¥çœ‹çŠ¶æ€ï¼Œç¡®å®šè¯·è¾“å…¥æ“ä½œæŒ‡ä»¤(start/stop/restart/status)ï¼š&#34; port_st
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  case &#34;$port_st&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   status)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tomcat_status=$(ss -unplt |egrep 8080 |egrep -i listen)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [ -z &#34;$tomcat_status&#34; ] &amp;&amp; echo -e &#34;\ntomcat\033[31m start failed ...\033[0m\n&#34; || echo -e &#34;\ntomcat\033[32m is running ...\033[0m\n&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  esac;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 6000)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  export CATALINA_BASE=&#34;/opt/lucky/tomcat/6000/&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  read -p &#34;å¯åŠ¨åœæ­¢tomcatä»¥åŠæŸ¥çœ‹çŠ¶æ€ï¼Œç¡®å®šè¯·è¾“å…¥æ“ä½œæŒ‡ä»¤(start/stop/restart/status)ï¼š&#34; port_st
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  case &#34;$port_st&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   status)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tomcat_status=$(ss -unplt |egrep 6000 |egrep -i listen)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [ -z &#34;$tomcat_status&#34; ] &amp;&amp; echo -e &#34;\ntomcat\033[31m start failed ...\033[0m\n&#34; || echo -e &#34;\ntomcat\033[32m is running ...\033[0m\n&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  esac;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 7000)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  export CATALINA_BASE=&#34;/opt/lucky/tomcat/7000/&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  read -p &#34;å¯åŠ¨åœæ­¢tomcatç¡®å®šå—ï¼Ÿç¡®å®šè¯·è¾“å…¥æ“ä½œæŒ‡ä»¤(start/stop/restart)ï¼š&#34; port_st
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  case &#34;$port_st&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   status)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tomcat_status=$(ss -unplt |egrep 7000 |egrep -i listen)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [ -z &#34;$tomcat_status&#34; ] &amp;&amp; echo -e &#34;\ntomcat\033[31m start failed ...\033[0m\n&#34; || echo -e &#34;\ntomcat\033[32m is running ...\033[0m\n&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   esac;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 7001)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  export CATALINA_BASE=&#34;/opt/lucky/tomcat/7001/&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  read -p &#34;å¯åŠ¨åœæ­¢tomcatä»¥åŠæŸ¥çœ‹çŠ¶æ€ï¼Œç¡®å®šè¯·è¾“å…¥æ“ä½œæŒ‡ä»¤(start/stop/restart/status)ï¼š&#34; port_st
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  case &#34;$port_st&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   status)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tomcat_status=$(ss -unplt |egrep 7001 |egrep -i listen)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [ -z &#34;$tomcat_status&#34; ] &amp;&amp; echo -e &#34;\ntomcat\033[31m start failed ...\033[0m\n&#34; || echo -e &#34;\ntomcat\033[32m is running ...\033[0m\n&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   esac;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 7002)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  export CATALINA_BASE=&#34;/opt/lucky/tomcat/7002/&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  read -p &#34;å¯åŠ¨åœæ­¢tomcatä»¥åŠæŸ¥çœ‹çŠ¶æ€ï¼Œç¡®å®šè¯·è¾“å…¥æ“ä½œæŒ‡ä»¤(start/stop/restart/status)ï¼š&#34; port_st
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  case &#34;$port_st&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   status)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tomcat_status=$(ss -unplt |egrep 7002 |egrep -i listen)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [ -z &#34;$tomcat_status&#34; ] &amp;&amp; echo -e &#34;\ntomcat\033[31m start failed ...\033[0m\n&#34; || echo -e &#34;\ntomcat\033[32m is running ...\033[0m\n&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   esac;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 7003)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  export CATALINA_BASE=&#34;/opt/lucky/tomcat/7003/&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  read -p &#34;å¯åŠ¨åœæ­¢tomcatä»¥åŠæŸ¥çœ‹çŠ¶æ€ï¼Œç¡®å®šè¯·è¾“å…¥æ“ä½œæŒ‡ä»¤(start/stop/restart/status)ï¼š&#34; port_st
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  case &#34;$port_st&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   status)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tomcat_status=$(ss -unplt |egrep 7003 |egrep -i listen)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [ -z &#34;$tomcat_status&#34; ] &amp;&amp; echo -e &#34;\ntomcat\033[31m start failed ...\033[0m\n&#34; || echo -e &#34;\ntomcat\033[32m is running ...\033[0m\n&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   esac;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 7004)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  export CATALINA_BASE=&#34;/opt/lucky/tomcat/7004/&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  read -p &#34;å¯åŠ¨åœæ­¢tomcatä»¥åŠæŸ¥çœ‹çŠ¶æ€ï¼Œç¡®å®šè¯·è¾“å…¥æ“ä½œæŒ‡ä»¤(start/stop/restart/status)ï¼š&#34; port_st
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  case &#34;$port_st&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   status)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tomcat_status=$(ss -unplt |egrep 7004 |egrep -i listen)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [ -z &#34;$tomcat_status&#34; ] &amp;&amp; echo -e &#34;\ntomcat\033[31m start failed ...\033[0m\n&#34; || echo -e &#34;\ntomcat\033[32m is running ...\033[0m\n&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   esac;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 7005)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  export CATALINA_BASE=&#34;/opt/lucky/tomcat/7005/&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  read -p &#34;å¯åŠ¨åœæ­¢tomcatä»¥åŠæŸ¥çœ‹çŠ¶æ€ï¼Œç¡®å®šè¯·è¾“å…¥æ“ä½œæŒ‡ä»¤(start/stop/restart/status)ï¼š&#34; port_st
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  case &#34;$port_st&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   status)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tomcat_status=$(ss -unplt |egrep 7005 |egrep -i listen)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [ -z &#34;$tomcat_status&#34; ] &amp;&amp; echo -e &#34;\ntomcat\033[31m start failed ...\033[0m\n&#34; || echo -e &#34;\ntomcat\033[32m is running ...\033[0m\n&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   esac;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 7006)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  export CATALINA_BASE=&#34;/opt/lucky/tomcat/7006/&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  read -p &#34;å¯åŠ¨åœæ­¢tomcatä»¥åŠæŸ¥çœ‹çŠ¶æ€ï¼Œç¡®å®šè¯·è¾“å…¥æ“ä½œæŒ‡ä»¤(start/stop/restart/status)ï¼š&#34; port_st
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  case &#34;$port_st&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   status)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tomcat_status=$(ss -unplt |egrep 7006 |egrep -i listen)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [ -z &#34;$tomcat_status&#34; ] &amp;&amp; echo -e &#34;\ntomcat\033[31m start failed ...\033[0m\n&#34; || echo -e &#34;\ntomcat\033[32m is running ...\033[0m\n&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   esac;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 7007)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  export CATALINA_BASE=&#34;/opt/lucky/tomcat/7007/&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  read -p &#34;å¯åŠ¨åœæ­¢tomcatä»¥åŠæŸ¥çœ‹çŠ¶æ€ï¼Œç¡®å®šè¯·è¾“å…¥æ“ä½œæŒ‡ä»¤(start/stop/restart/status)ï¼š&#34; port_st
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  case &#34;$port_st&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   status)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tomcat_status=$(ss -unplt |egrep 7007 |egrep -i listen)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [ -z &#34;$tomcat_status&#34; ] &amp;&amp; echo -e &#34;\ntomcat\033[31m start failed ...\033[0m\n&#34; || echo -e &#34;\ntomcat\033[32m is running ...\033[0m\n&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   esac;; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> 8818)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  export CATALINA_BASE=&#34;/opt/lucky/tomcat/8818/&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  read -p &#34;å¯åŠ¨åœæ­¢tomcatä»¥åŠæŸ¥çœ‹çŠ¶æ€ï¼Œç¡®å®šè¯·è¾“å…¥æ“ä½œæŒ‡ä»¤(start/stop/restart/status)ï¼š&#34; port_st
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  case &#34;$port_st&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/shutdown.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    $CATALINA_HOME/bin/startup.sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   status)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tomcat_status=$(ss -unplt |egrep 8818 |egrep -i listen)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        [ -z &#34;$tomcat_status&#34; ] &amp;&amp; echo -e &#34;\ntomcat\033[31m start failed ...\033[0m\n&#34; || echo -e &#34;\ntomcat\033[32m is running ...\033[0m\n&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   esac;;   
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">esac
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JAVA_OPTS=&#39;-Xms64m -Xmx128m&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="php">PHP</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of PHP</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_php_expand">Configure_PHP_Expand</h1>

<h2 id="å®‰è£…é…ç½®phpæ‰©å±•">å®‰è£…é…ç½®<code>PHP</code>æ‰©å±•</h2>
<h3 id="font-colorredå®‰è£…fontphp-redisfont-colorredæ‰©å±•font"><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>PHP-redis</code><!-- raw HTML omitted -->æ‰©å±•<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸‹è½½ã€å®‰è£…<!-- raw HTML omitted --><code>PHP-redis</code><!-- raw HTML omitted -->æ‰©å±•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src
</span></span><span style="display:flex;"><span>$ curl -O https://pecl.php.net/get/redis-4.0.0.tgz
</span></span><span style="display:flex;"><span>$ tar zxvf /usr/local/src/redis-4.0.0.tgz -C /usr/local/src
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/redis-4.0.0
</span></span><span style="display:flex;"><span>$ /usr/local/php/bin/phpize
</span></span><span style="display:flex;"><span>$ ./configure --with-php-config<span style="color:#f92672">=</span>/usr/local/php/bin/php-config
</span></span><span style="display:flex;"><span>$ make <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>PHP</code><!-- raw HTML omitted -->å¯ç”¨<!-- raw HTML omitted --><code>PHP-Redis</code><!-- raw HTML omitted -->æ‰©å±•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;N;736iextension =/usr/local/php/lib/php/extensions/no-debug-non-zts20170718/redis.so&#39;</span> /usr/local/php/etc/php.ini  	<span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶å¯ç”¨redisæ¨¡å—</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡å¯phpä½¿ä¹‹ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>$ systemctl restart php-fpm
</span></span><span style="display:flex;"><span><span style="color:#75715e"># /etc/init.d/php-fpm restart</span>
</span></span><span style="display:flex;"><span>$ php -m|grep redis
</span></span><span style="display:flex;"><span>$ php --ri redis  	<span style="color:#75715e"># æŸ¥çœ‹redisæ‰©å±•ç‰ˆæœ¬</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="font-colorredå®‰è£…fontphp-swoolefont-colorredæ‰©å±•font"><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>php-swoole</code><!-- raw HTML omitted -->æ‰©å±•<!-- raw HTML omitted --></h3>
<blockquote>
<ul>
<li><a href="https://github.com/swoft-cloud/swoft/blob/master/Dockerfile" rel="external" target="_self"><code>docker install swoft</code></a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸‹è½½ã€å®‰è£…<!-- raw HTML omitted --><code>php-swoole</code><!-- raw HTML omitted -->æ‰©å±•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src
</span></span><span style="display:flex;"><span>$ git clone https://github.com/swoole/swoole-src.git
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/swoole-src/
</span></span><span style="display:flex;"><span>$ git checkout v4.4.7  	<span style="color:#75715e"># åˆ‡æ¢æŒ‡å®šç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ git branch  	<span style="color:#75715e"># æŸ¥çœ‹å½“å‰ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ phpize
</span></span><span style="display:flex;"><span>$ ./configure
</span></span><span style="display:flex;"><span>$ make -j4 <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>PHP</code><!-- raw HTML omitted -->å¯ç”¨<!-- raw HTML omitted --><code>PHP-Swoole</code><!-- raw HTML omitted -->æ‰©å±•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;N;736iextension =/usr/local/php/lib/php/extensions/no-debug-non-zts20170718/swoole.so&#39;</span> /usr/local/php/etc/php.ini  	<span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶å¯ç”¨swooleæ¨¡å—</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sed -i &#39;N;736iswoole.enable_coroutine = Off&#39; /usr/local/php/etc/php.ini</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl restart php-fpm
</span></span><span style="display:flex;"><span><span style="color:#75715e"># /etc/init.d/php-fpm restart</span>
</span></span><span style="display:flex;"><span>$ php -m|grep swoole
</span></span><span style="display:flex;"><span>$ php --ri swoole</span></span></code></pre></div></blockquote>
<hr>
<h3 id="font-colorredå®‰è£…fontphp-freetypefont-colorredæ‰©å±•font"><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>PHP-Freetype</code><!-- raw HTML omitted -->æ‰©å±•<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸‹è½½ã€å®‰è£…<!-- raw HTML omitted --><code>PHP-Freetype</code><!-- raw HTML omitted -->æ‰©å±•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src https://download.savannah.gnu.org/releases/freetype/freetype-2.9.tar.gz
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://mirror.hostiran.ir/gnu/releases/freetype/freetype-2.12.1.tar.gz</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar zxvf /usr/local/src/freetype-2.9.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/freetype-2.9/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/freetype
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ make -j4 <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div><ul>
<li><code>Debian</code><!-- raw HTML omitted -->ç³»ç»Ÿå®‰è£…<!-- raw HTML omitted --><code>FreeType</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥phpä¸­çš„gd ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ cd /opt/src/php-7.2.22/ext/gd/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ©ç”¨phpize</span>
</span></span><span style="display:flex;"><span>$ /opt/php/bin/phpize
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…ç†ä¹‹å‰çš„å®‰è£…é…ç½®</span>
</span></span><span style="display:flex;"><span>$ make clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥å‚æ•°</span>
</span></span><span style="display:flex;"><span>$ ./configure --with-php-config<span style="color:#f92672">=</span>/opt/php/bin/php-config --with-jpeg-dir --with-png-dir --with-freetype-dir<span style="color:#f92672">=</span>/opt/php/freetype --with-zlib-dir --with-gd
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¼–è¯‘å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ make -j4 &amp; make install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ php.iniæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/php/etc/php.ini<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">extension=/opt/php/lib/php/extensions/no-debug-non-zts-20170718/gd.so
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>PHP</code><!-- raw HTML omitted -->åŠ å…¥æ‰©å±•è·¯å¾„<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ php -i  	<span style="color:#75715e"># æŸ¥çœ‹configureä¸­ä½¿ç”¨å‚æ•°</span>
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/php --with-freetype-dir<span style="color:#f92672">=</span>/usr/local/freetype  	<span style="color:#75715e"># --with-freetype-dir=/usr/local/freetype å¯ç”¨æ­¤æ‰©å±•</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="font-colorredå®‰è£…fontphp-amqpfont-colorredæ‰©å±•font"><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>PHP-Amqp</code><!-- raw HTML omitted -->æ‰©å±•<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç¬¬ä¸€ç§æ–¹å¼å®‰è£…<!-- raw HTML omitted --><code>PHP-amqp</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/php/bin/pecl install amqp</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç¬¬äºŒç§æ–¹å¼å®‰è£…<!-- raw HTML omitted --><code>PHP-amqp</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½ã€å®‰è£…<!-- raw HTML omitted --><code>PHP-amqp</code><!-- raw HTML omitted -->æ‰©å±•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://pecl.php.net/get/amqp-1.9.4.tgz
</span></span><span style="display:flex;"><span>$ tar -xvf /usr/local/src/amqp-1.9.4.tgz -C /usr/local/src
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/amqp-1.9.4
</span></span><span style="display:flex;"><span>$ /usr/local/php/bin/phpize
</span></span><span style="display:flex;"><span>$ ./configure --with-php-config<span style="color:#f92672">=</span>/usr/local/php/bin/php-config</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¦‚æœå®‰è£…ä¸­æŠ¥é”™å¤„ç†æ–¹å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src https://github.com/alanxz/rabbitmq-c/releases/download/v0.7.1/rabbitmq-c0.7.1.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar zxvf /usr/local/src/rabbitmq-c-0.7.1.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/rabbitmq-c-0.7.1
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/rabbitmq-c-0.7.1
</span></span><span style="display:flex;"><span>$ make <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é‡æ–°é…ç½®ç¼–è¯‘å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/amqp-1.9.4
</span></span><span style="display:flex;"><span>$ ./configure --with-php-config<span style="color:#f92672">=</span>/usr/local/php/bin/php-config --with-amqp --withlibrabbitmq-dir<span style="color:#f92672">=</span>/usr/local/rabbitmq-c-0.7.1
</span></span><span style="display:flex;"><span>$ make <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>PHP</code><!-- raw HTML omitted -->å¯ç”¨<!-- raw HTML omitted --><code>PHP-amqp</code><!-- raw HTML omitted -->æ‰©å±•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;N;736iextension =/usr/local/php/lib/php/extensions/no-debug-non-zts20170718/amqp.so&#39;</span> /usr/local/php/etc/php.ini  	<span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶å¯ç”¨php-amqpæ¨¡å—</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡å¯phpä½¿ä¹‹ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>$ systemctl restart php-fpm
</span></span><span style="display:flex;"><span><span style="color:#75715e"># /etc/init.d/php-fpm restart</span>
</span></span><span style="display:flex;"><span>$ php -m|grep amqp
</span></span><span style="display:flex;"><span>$ php --ri amqp</span></span></code></pre></div></blockquote>
<hr>
<h2 id="php-fastcgi"><code>PHP-FastCGI</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä»€ä¹ˆæ˜¯<!-- raw HTML omitted --><code>CGI</code></li>
</ol>
</li>
</ul>
<blockquote>
<p><code>CGI</code>çš„å…¨ç§°ä¸º<!-- raw HTML omitted -->é€šç”¨ç½‘å…³æ¥å£(Common Gateway Interface)<!-- raw HTML omitted -->ï¼Œä¸º<code>HTTP</code>æœåŠ¡å™¨ä¸å…¶ä»–æœºå™¨ä¸Šçš„ç¨‹åº æœåŠ¡é€šä¿¡äº¤æµçš„ä¸€ç§å·¥å…·ï¼Œ<code>CGI</code>ç¨‹åºé¡»è¿è¡Œåœ¨ç½‘ç»œæœåŠ¡å™¨ä¸Šã€‚ ä¼ ç»Ÿ<code>CGI</code>æ¥å£æ–¹å¼çš„ä¸»è¦ç¼ºç‚¹æ˜¯æ€§èƒ½è¾ƒå·®ï¼Œå› ä¸ºæ¯æ¬¡<code>HTTP</code>æœåŠ¡å™¨é‡åˆ°åŠ¨æ€ç¨‹åºæ—¶éƒ½éœ€è¦é‡æ–°å¯åŠ¨è§£æå™¨ æ¥æ‰§è¡Œè§£æï¼Œä¹‹åç»“æœæ‰ä¼šè¢«è¿”å›ç»™<code>HTTP</code>æœåŠ¡å™¨ã€‚è¿™åœ¨å¤„ç†é«˜å¹¶å‘è®¿é—®æ—¶å‡ ä¹æ˜¯ä¸å¯ç”¨çš„ï¼Œå› æ­¤å°±è¯ç”Ÿ äº†<code>FastCGI</code>ã€‚å¦å¤–ï¼Œä¼ ç»Ÿçš„<code>CGI</code>æ¥å£æ–¹å¼å®‰å…¨æ€§ä¹Ÿå¾ˆå·®ï¼Œæ•…è€Œç°åœ¨å·²ç»å¾ˆå°‘è¢«ä½¿ç”¨äº†ã€‚</p>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä»€ä¹ˆæ˜¯<!-- raw HTML omitted --><code>FastCGI</code></li>
</ol>
</li>
</ul>
<blockquote>
<p><code>FastCGI</code>æ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©åœ°ã€é«˜é€Ÿåœ°åœ¨<code>HTTP</code>æœåŠ¡å™¨å’ŒåŠ¨æ€è„šæœ¬è¯­è¨€é—´é€šä¿¡çš„æ¥å£ï¼ˆåœ¨<code>Linux</code>ä¸‹ï¼Œ<code>FastCG</code>æ¥ å£å³ä¸º<code>socket</code>ï¼Œè¿™ä¸ª<code>socket</code>å¯ä»¥æ˜¯æ–‡ä»¶<code>socket</code>ï¼Œä¹Ÿå¯ä»¥æ˜¯<code>IP socket</code>ï¼‰ï¼Œä¸»è¦ä¼˜ç‚¹æ˜¯æŠŠåŠ¨æ€è¯­è¨€å’Œ<code>HTTP</code>æœåŠ¡å™¨åˆ†ç¦»å¼€æ¥ã€‚å¤šæ•°æµè¡Œçš„<code>HTTP</code>æœåŠ¡å™¨éƒ½æ”¯æŒ<code>FastCGI</code>ï¼ŒåŒ…æ‹¬<code>Apache</code>ã€<code>Nginx</code>å’Œ<code>Lighttpd</code>ç­‰ã€‚ åŒæ—¶ï¼Œ<code>FastCGI</code>ä¹Ÿè¢«è®¸å¤šè„šæœ¬è¯­è¨€æ‰€æ”¯æŒï¼Œä¾‹å¦‚å½“å‰æ¯”è¾ƒæµè¡Œçš„è„šæœ¬è¯­è¨€<code>PHP</code>ã€‚<code>FastCGI</code>æ¥å£é‡‡ç”¨çš„æ˜¯<code>C/S </code>æ¶æ„ï¼Œå®ƒå¯ä»¥å°†<code>HTTP</code>æœåŠ¡å™¨å’Œè„šæœ¬è§£ææœåŠ¡å™¨åˆ†å¼€ï¼ŒåŒæ—¶è¿˜èƒ½åœ¨è„šæœ¬è§£ææœåŠ¡å™¨ä¸Šå¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªè„šæœ¬ æ¥è§£æå®ˆæŠ¤è¿›ç¨‹ã€‚å½“<code>HTTP</code>æœåŠ¡å™¨é‡åˆ°åŠ¨æ€ç¨‹åºæ—¶ï¼Œå¯ä»¥å°†å…¶ç›´æ¥äº¤ä»˜ç»™<code>FastCGI</code>è¿›ç¨‹æ¥æ‰§è¡Œï¼Œç„¶åå°†å¾— åˆ°çš„ç»“æœè¿”å›ç»™æµè§ˆå™¨ã€‚è¿™ç§æ–¹å¼å¯ä»¥è®©<code>HTTP</code>æœåŠ¡å™¨ä¸“ä¸€åœ°å¤„ç†é™æ€è¯·æ±‚ï¼Œæˆ–è€…å°†åŠ¨æ€è„šæœ¬æœåŠ¡å™¨çš„ç»“ æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜äº†æ•´ä¸ªåº”ç”¨ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p>
</blockquote>
<ul>
<li>
<ol start="3">
<li><code>FastCGI</code><!-- raw HTML omitted -->çš„é‡è¦ç‰¹ç‚¹å¦‚ä¸‹ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><code>HTTP</code><!-- raw HTML omitted -->æœåŠ¡å™¨å’ŒåŠ¨æ€è„šæœ¬è¯­è¨€é—´é€šä¿¡çš„æ¥å£æˆ–å·¥å…·<!-- raw HTML omitted --></p>
</li>
<li>
<p><!-- raw HTML omitted -->å¯æŠŠåŠ¨æ€è¯­è¨€è§£æå’Œ<!-- raw HTML omitted --><code>HTTP</code><!-- raw HTML omitted -->æœåŠ¡å™¨åˆ†ç¦»å¼€<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Nginxã€Apacheã€Lighttpd</code><!-- raw HTML omitted -->ä»¥åŠå¤šæ•°åŠ¨æ€è¯­è¨€éƒ½æ”¯æŒ<!-- raw HTML omitted --><code>FastCGI</code></p>
</li>
<li>
<p><code>FastCGI</code><!-- raw HTML omitted -->æ¥å£æ–¹å¼é‡‡ç”¨<code>C/S</code>ç»“æ„ï¼Œåˆ†ä¸ºå®¢æˆ·ç«¯ï¼š<code>HTTP</code>æœåŠ¡å™¨ï¼Œå’ŒæœåŠ¡å™¨ç«¯ï¼š<!-- raw HTML omitted --><!-- raw HTML omitted -->åŠ¨æ€è¯­è¨€è§£ææœåŠ¡å™¨<!-- raw HTML omitted --></p>
</li>
<li>
<p><!-- raw HTML omitted -->åŠ¨æ€è¯­è¨€æœåŠ¡å™¨ç«¯å¯ä»¥å¯åŠ¨å¤šä¸ª<code>FastCGI</code>çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œä¾‹å¦‚ï¼š<!-- raw HTML omitted --><code>php-fpm(fcgi process mangement)</code></p>
</li>
<li>
<p><code>HTTP</code><!-- raw HTML omitted -->æœåŠ¡å™¨é€šè¿‡ï¼Œä¾‹å¦‚ï¼š<!-- raw HTML omitted --><code>Nginx fastcgi_passã€‚FastCGI</code><!-- raw HTML omitted -->å®¢æˆ·ç«¯å’ŒåŠ¨æ€è¯­è¨€<!-- raw HTML omitted --><code>FastCGI</code><!-- raw HTML omitted -->æœåŠ¡å™¨ç«¯é€šä¿¡ï¼Œä¾‹å¦‚ï¼š<!-- raw HTML omitted --><code>php-fpm</code></p>
</li>
</ul>
</blockquote>
<p><a href="#R-image-908714b71b2f00a6187107029789e704" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Php_Server/Snipaste_2022-08-14_14-44-29.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-908714b71b2f00a6187107029789e704"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Php_Server/Snipaste_2022-08-14_14-44-29.png"></a></p>
<hr>
<h3 id="é˜¿é‡Œäº‘epel">é˜¿é‡Œäº‘<code>epel</code></h3>
<ul>
<li>
<ol>
<li><a href="https://developer.aliyun.com/mirror/epel" rel="external" target="_self">é˜¿é‡Œäº‘<code>epel</code>ç®€ä»‹</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->è®¾å®šé˜¿é‡Œäº‘<code>epel</code>æº<!-- raw HTML omitted --><a href="https://mirrors.aliyun.com/epel/" rel="external" target="_self">é˜¿é‡Œäº‘<code>epel</code>ä¸‹è½½</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å¤‡ä»½å…¶ä»–epelæº</span>
</span></span><span style="display:flex;"><span>$ mv /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.backup
</span></span><span style="display:flex;"><span>$ mv /etc/yum.repos.d/epel-testing.repo /etc/yum.repos.d/epel-testing.repo.backup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget -O /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install mhash
</span></span><span style="display:flex;"><span>$ yum -y install mcrypt
</span></span><span style="display:flex;"><span>$ yum -y install libmcrypt-devel
</span></span><span style="display:flex;"><span>$ yum install zlib-devel libxml2-devel libjpeg-devel libjpeg-turbo-devel libiconv-devel -y
</span></span><span style="display:flex;"><span>$ yum install freetype-devel libpng-devel gd-devel libcurl-devel libxslt-devel libxslt-devel -y</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä¸‹è½½å®‰è£…<!-- raw HTML omitted --><code>libiconv</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src http://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.14.tar.gz
</span></span><span style="display:flex;"><span>$ tar -zxf /usr/local/src/libiconv-1.14.tar.gz -C /usr/local/src
</span></span><span style="display:flex;"><span>cd /usr/local/src/libiconv-1.14
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/libiconv
</span></span><span style="display:flex;"><span>$ make
</span></span><span style="display:flex;"><span>$ make install</span></span></code></pre></div><ul>
<li>3.1 <!-- raw HTML omitted -->é…ç½®<code>PHP</code>å¯ç”¨<!-- raw HTML omitted --><code>libiconv</code></li>
</ul>
<blockquote>
<ul>
<li><code>--prefix=/application/php5.5.32</code><!-- raw HTML omitted -->ï¼š è¡¨ç¤ºæŒ‡å®š<code>PHP</code>çš„å®‰è£…è·¯å¾„<!-- raw HTML omitted --></li>
<li><code>--with-mysql=/application/mysql</code><!-- raw HTML omitted -->ï¼šè¡¨ç¤ºéœ€è¦æŒ‡å®š<code>MySQL</code>çš„å®‰è£…è·¯å¾„ï¼Œå®‰è£…<code>PHPéœ€</code>è¦<code>MySQL</code>çš„ç›¸å…³å†…å®¹ï¼Œå½“ç„¶å¦‚æœæ²¡æœ‰<code>MySQL</code>å®‰è£…åŒ…ä¹Ÿå¯ä»¥ä¸å•ç‹¬å®‰è£…ï¼Œè¿™æ ·æƒ…å†µä¸‹ä½¿ç”¨<!-- raw HTML omitted --><code>--with-mysql=mysqlnd</code>æ›¿ä»£<code>--with-mysql=/application/mysql</code>ï¼Œå› ä¸º<code>PHP</code>è½¯ä»¶è‡ªå¸¦è¿æ¥<code>MySQL</code>å®¢æˆ·å·¥å…·</li>
<li><code>--with-fpm-user=nginx</code><!-- raw HTML omitted -->ï¼šè¡¨ç¤ºæŒ‡å®š<code>PHP-FPM</code>è¿›ç¨‹ç®¡ç†ç”¨æˆ·ä¸º<code>Nginx</code>ï¼Œæ­¤å¤„æœ€å¥½å’Œ<code>Nginx</code>æœåŠ¡ç”¨æˆ·ç»Ÿä¸€<!-- raw HTML omitted --></li>
<li><code>--with-fpm-group=nginx</code><!-- raw HTML omitted -->ï¼šè¡¨ç¤ºæŒ‡å®š<code>PHP-FPM</code>è¿›ç¨‹ç®¡ç†ç»„ä¸º<code>Nginx</code>ï¼Œæ­¤å¤„æœ€å¥½å’Œ<code>Nginx</code>æœåŠ¡ç”¨æˆ·ç»„ç»Ÿä¸€<!-- raw HTML omitted --></li>
<li><code>--enable-fpm</code><!-- raw HTML omitted -->:è¡¨ç¤ºæ¿€æ´»<code>PHP-FPM</code>æ–¹å¼æœåŠ¡ï¼Œå³<code>FastCGIF</code>æ–¹å¼è¿è¡Œ<code>PHP</code>æœåŠ¡<!-- raw HTML omitted --></li>
<li>å¯ä»¥é€šè¿‡æ‰§è¡Œ<code>./configure --help</code><!-- raw HTML omitted -->å‘½ä»¤æ¥è¯¦ç»†æŸ¥çœ‹ä»¥ä¸Šå„å‚æ•°ç”¨é€”<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/php5.5.32
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./configure <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--prefix<span style="color:#f92672">=</span>/application/php5.5.32 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-iconv-dir<span style="color:#f92672">=</span>/usr/local/libiconv <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-mysql<span style="color:#f92672">=</span>mysqlnd --with-libxml-dir<span style="color:#f92672">=</span>/usr <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-freetype-dir --with-jpeg-dir --with-png-dir <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-zlib --enable-xml --disable-rpath --enable-safe-mode <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-bcmath --enable-shmop --enable-sysvsem --with-curl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-inline-optimization --with-curlwrappers --enable-fpm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-mbregex --enable-mbstring --with-mcrypt --with-gd <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-gd-native-ttf --with-openssl --with-mhash --enable-pcntl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-sockets --with-xmlrpc --enable-zip --enable-soap <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-short-tags --enable-zend-multibyte --enable-ftp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-static --with-xsl --enable-opcache<span style="color:#f92672">=</span>no --with-fpm-user<span style="color:#f92672">=</span>www <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-fpm-group<span style="color:#f92672">=</span>www
</span></span><span style="display:flex;"><span>$ ln -s /application/mysql/lib/libmysqlclient.so.18 /usr/lib64/
</span></span><span style="display:flex;"><span>$ touch ext/phar/phar.phar
</span></span><span style="display:flex;"><span>$ make <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->åœ¨<code>Nginx</code>çš„<code>conf</code>é…ç½®ä¸­å­—æ®µ<code>server</code>ç¼–å†™<code>php</code>çš„<!-- raw HTML omitted --><code>location</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>location ~ .*<span style="color:#ae81ff">\.</span><span style="color:#f92672">(</span>php|php5<span style="color:#f92672">)</span>?$ <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>root html/blog;
</span></span><span style="display:flex;"><span>fastcgi_pass 127.0.0.1:9000;  	<span style="color:#75715e"># æˆ–è€…ä½¿ç”¨ï¼šunix:/tmp/php-cgi-56.sock;</span>
</span></span><span style="display:flex;"><span>fastcgi_index index.php;
</span></span><span style="display:flex;"><span>fastcgi_split_path_info ^<span style="color:#f92672">((</span>?U<span style="color:#f92672">)</span>.+<span style="color:#ae81ff">\.</span>php<span style="color:#f92672">)(</span>/?.+<span style="color:#f92672">)</span>$;
</span></span><span style="display:flex;"><span>fastcgi_param PATH_INFO $fastcgi_path_info;
</span></span><span style="display:flex;"><span>include fastcgi_params;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># include fastcgi.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®<code>fastcgi.conf</code>æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;fastcgi.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  SCRIPT_FILENAME    $document_root$fastcgi_script_name;# è„šæœ¬æ–‡ä»¶è¯·æ±‚çš„è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  QUERY_STRING       $query_string;  	 # è¯·æ±‚çš„å‚æ•°;å¦‚?app=123
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  REQUEST_METHOD     $request_method;  	# è¯·æ±‚çš„åŠ¨ä½œ(GET,POST)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  CONTENT_TYPE       $content_type;  	# è¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  CONTENT_LENGTH     $content_length;  	 # è¯·æ±‚å¤´ä¸­çš„Content-lengthå­—æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  SCRIPT_NAME        $fastcgi_script_name;  	# è„šæœ¬åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  REQUEST_URI        $request_uri;  	# è¯·æ±‚çš„åœ°å€ä¸å¸¦å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  DOCUMENT_URI       $document_uri;  	# ä¸document_uri; #ä¸uriç›¸åŒ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  DOCUMENT_ROOT      $document_root;  	# ç½‘ç«™çš„æ ¹ç›®å½•ã€‚åœ¨serveré…ç½®ä¸­rootæŒ‡ä»¤ä¸­æŒ‡å®šçš„å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  SERVER_PROTOCOL    $server_protocol;  	# è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼Œé€šå¸¸æ˜¯HTTP/1.0æˆ–HTTP/1.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  REQUEST_SCHEME     $scheme;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  HTTPS              $https if_not_empty;  	# https å¦‚æœvalueéç©ºæ‰è¿›è¡Œè®¾ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  GATEWAY_INTERFACE  CGI/1.1;  	# cgi ç‰ˆæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  SERVER_SOFTWARE    nginx/$nginx_version;  	# nginx ç‰ˆæœ¬å·ï¼Œå¯ä¿®æ”¹ã€éšè—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  REMOTE_ADDR        $remote_addr;  	 # å®¢æˆ·ç«¯IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  REMOTE_PORT        $remote_port;  	# å®¢æˆ·ç«¯ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  SERVER_ADDR        $server_addr;  	# æœåŠ¡å™¨IPåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  SERVER_PORT        $server_port;  	# æœåŠ¡å™¨ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  SERVER_NAME        $server_name;  	# æœåŠ¡å™¨åï¼ŒåŸŸååœ¨serveré…ç½®ä¸­æŒ‡å®šçš„server_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## GeoIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#fastcgi_param GEOIP_ADDR $remote_addr;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#fastcgi_param GEOIP_COUNTRY_CODE $geoip_country_code;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#fastcgi_param GEOIP_COUNTRY_NAME $geoip_country_name;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#fastcgi_param GEOIP_REGION $geoip_region;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#fastcgi_param GEOIP_REGION_NAME $geoip_region_name;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#fastcgi_param GEOIP_CITY $geoip_city;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#fastcgi_param GEOIP_AREA_CODE $geoip_area_code;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#fastcgi_param GEOIP_LATITUDE $geoip_latitude;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#fastcgi_param GEOIP_LONGITUDE $geoip_longitude;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#fastcgi_param GEOIP_POSTAL_CODE $geoip_postal_code;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#fastcgi_param GEOIP_ORGANIZATION $geoip_org;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># PHP only, required if PHP was built with --enable-force-cgi-redirect
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fastcgi_param  REDIRECT_STATUS    200;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>nginx -t</code><!-- raw HTML omitted -->æ£€æŸ¥è¯­æ³•æˆåŠŸï¼Œé‡å¯<!-- raw HTML omitted --><code>nginx</code>ï¼Œå†™ä¸€ä¸ª<code>PHP</code>é¡µé¢</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&lt;?php phpinfo<span style="color:#f92672">()</span>ï¼› ?&gt;</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æµ‹è¯•<code>PHP</code>è¿æ¥<!-- raw HTML omitted --><code>mysql</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&lt;?php
</span></span><span style="display:flex;"><span>$link_id<span style="color:#f92672">=</span>mysql_connect<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;localhost&#39;</span>,<span style="color:#e6db74">&#39;root&#39;</span>,<span style="color:#e6db74">&#39;oldboy123&#39;</span><span style="color:#f92672">)</span> or mysql_error<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>$link_id<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;mysql successful by oldboy !&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span><span style="color:#66d9ef">else</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>echo mysql_error<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>?&gt;</span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_php">Install_PHP</h1>

<h2 id="å®‰è£…php">å®‰è£…<code>PHP</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…ä¾èµ–<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ•´ä¼˜åŒ–</span>
</span></span><span style="display:flex;"><span>$ yum -y install epel-release
</span></span><span style="display:flex;"><span>$ yum -y install gcc gcc-c++ wget libxml2-devel sqlite-devel bzip2-devel <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>libpng-devel libwebp-devel libjpeg-devel libXpm-devel freetype-devel <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>oniguruma oniguruma-devel ncurses-devel readline-devel openssl-devel <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>libcurl-devel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># yumå®‰è£…ç‰ˆæœ¬ä¸å¤Ÿé«˜ï¼Œ æ‰‹åŠ¨å®‰è£…libzip</span>
</span></span><span style="display:flex;"><span>$ wget https://mirrors.oneinstack.com/oneinstack-repo/7/x86_64/libzip-0.11.2-6.el7.psychotic.x86_64.rpm
</span></span><span style="display:flex;"><span>$ wget https://mirrors.oneinstack.com/oneinstack-repo/7/x86_64/libzip-devel-0.11.2-6.el7.psychotic.x86_64.rpm
</span></span><span style="display:flex;"><span>$ yum localinstall libzip-0.11.2-6.el7.psychotic.x86_64.rpm
</span></span><span style="display:flex;"><span>$ yum localinstall libzip-devel-0.11.2-6.el7.psychotic.x86_64.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Debianç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>$ sudo apt-get install libxml2 libxml2-dev libbz2-dev libjpeg-dev libtool pkgconf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>libpng-dev libfreetype6-dev libreadline-dev build-essential autoconf automake <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>bison flex re2c gdb php-gd libcurl4-openssl-dev gcc make libssl-dev libsqlite3-dev <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>libwebp-dev oniguruma-dev libzip-dev libXpm-dev</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¸‹è½½å®‰è£…åŒ…é…ç½®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½è§£å‹å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ useradd -s /sbin/nologin php-fpm  	<span style="color:#75715e"># æ·»åŠ ç¨‹åºç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/
</span></span><span style="display:flex;"><span>$ curl -O https://www.php.net/distributions/php-7.4.30.tar.gz
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/php-7.4.30.tar.gz -C /usr/local/src/</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®ï¼Œ<!-- raw HTML omitted --><code>Debian</code><!-- raw HTML omitted -->ç³»ç»Ÿä¸è¦ä½¿ç”¨é»˜è®¤<!-- raw HTML omitted --><code>--wiht-gd</code>ï¼Œ<code>CentOS</code><!-- raw HTML omitted -->ä¸ä½¿ç”¨<!-- raw HTML omitted --><code> --with-curl</code></li>
<li><a href="https://www.php.net/manual/zh/funcref.php" rel="external" target="_self">å‡½æ•°å‚è€ƒ</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/php-7.4.30  	<span style="color:#75715e"># åˆ‡æ¢åˆ°è§£å‹ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/php --sysconfdir<span style="color:#f92672">=</span>/usr/local/php/etc <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-config-file-path<span style="color:#f92672">=</span>/usr/local/php/etc/ --with-fpm-user<span style="color:#f92672">=</span>php-fpm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-fpm-group<span style="color:#f92672">=</span>php-fpm --enable-fpm --with-libxml-dir --with-xmlrpc <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-pdo-mysql<span style="color:#f92672">=</span>mysqlnd --with-mysqli<span style="color:#f92672">=</span>mysqlnd --with-mhash <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-zlib --with-bz2 --with-gd --with-jpeg-dir --with-png-dir <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-iconv-dir --with-pcre-dir --with-pear --enable-mbstring <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-sockets --enable-zip --enable-session --enable-xml <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-gd-jis-conv --enable-shared --enable-soap --enable-bcmath <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-sysvmsg --enable-sysvsem --enable-sysvshm --enable-mbregex <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-pcntl --with-gettext --enable-exif --with-readline --enable-ftp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-freetype-dir<span style="color:#f92672">=</span>/usr/local/freetype
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># php 7.4.Xä»¥ä¸Šç‰ˆæœ¬  </span>
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/php --sysconfdir<span style="color:#f92672">=</span>/usr/local/php/etc <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-config-file-path<span style="color:#f92672">=</span>/usr/local/php/etc/ --enable-fpm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-fpm-user<span style="color:#f92672">=</span>php-fpm --with-fpm-group<span style="color:#f92672">=</span>php-fpm --with-xmlrpc <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-pdo-mysql<span style="color:#f92672">=</span>mysqlnd --with-mysqli<span style="color:#f92672">=</span>mysqlnd --with-mhash <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-zip --with-zlib --with-bz2 --enable-gd --with-jpeg <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-xpm --with-webp --with-freetype --with-pear --with-openssl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-mbstring --enable-sockets --enable-gd-jis-conv <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-shared --enable-soap --enable-bcmath --enable-sysvmsg <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--enable-sysvsem --enable-sysvshm --enable-mbregex --enable-pcntl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-gettext --enable-exif --with-readline --enable-ftp --with-openssl</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¼–è¯‘å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ make -j4 <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ‹·è´é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp /usr/local/src/php-7.4.30/php.ini-production /usr/local/php/etc/php.ini  	<span style="color:#75715e"># æ‹·è´PHPè§£æå™¨é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‹·è´å¯åŠ¨æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cp /usr/local/src/php-7.4.30/sapi/fpm/init.d.php-fpm   /etc/init.d/php-fpm 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf
</span></span><span style="display:flex;"><span>$ cp /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ‹·è´æ”¹å<!-- raw HTML omitted --><code>PHP-FPM</code><!-- raw HTML omitted -->è¿›ç¨‹ç®¡ç†å™¨é…ç½®æ–‡ä»¶ï¼Œä»¥åŠæ ¹æ®<!-- raw HTML omitted --><code>CPU</code><!-- raw HTML omitted -->ã€å†…å­˜æ€§èƒ½ä¼˜åŒ–<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mv /usr/local/php/etc/php-fpm.conf.default   /usr/local/php/etc/php-fpm.conf
</span></span><span style="display:flex;"><span>pm <span style="color:#f92672">=</span> static  	<span style="color:#75715e"># é™æ€_å­è¿›ç¨‹å›ºå®šæ•°é‡</span>
</span></span><span style="display:flex;"><span>pm <span style="color:#f92672">=</span> dynamic  	<span style="color:#75715e"># åŠ¨æ€_å­è¿›ç¨‹æ•°é‡</span>
</span></span><span style="display:flex;"><span>pm.max_children <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>  	<span style="color:#75715e"># æœ€å°ç­‰å¾…å¤„ç†çš„å­è¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>pm.start_servers <span style="color:#f92672">=</span> <span style="color:#ae81ff">200</span>  	<span style="color:#75715e"># å¯åŠ¨æ—¶åˆ›å»ºå­è¿›ç¨‹æ•°</span>
</span></span><span style="display:flex;"><span>pm.min_spare_servers <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>  	<span style="color:#75715e"># æœ€å°å¤„äºç­‰å¾…å¤„ç†å­è¿›ç¨‹æ•°</span>
</span></span><span style="display:flex;"><span>pm.max_spare_servers <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>  	<span style="color:#75715e"># æœ€å¤§å¤„äºç­‰å¾…å¤„ç†å­è¿›ç¨‹æ•°</span>
</span></span><span style="display:flex;"><span>pm.max_requests <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>request_terminate_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>PHP</code><!-- raw HTML omitted -->é€šä¿¡æ–¹å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Unix socketï¼ŒNginxå’Œphp-fpmåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œä½¿ç”¨è¿™ç§æ–¹å¼æ•ˆç‡è¦æ¯”tcp socketé«˜ï¼Œéœ€è¦å†nginxé…ç½®æ–‡ä»¶ä¸­å¡«å†™php-fpmçš„pidæ–‡ä»¶ä½ç½®ï¼Œ</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/usr/local/php/etc/php-fpm.d/www.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listen = /usr/local/php/logs/php7.sock  	# è‡ªå®šä¹‰æ·»åŠ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tcp socketçš„ä¼˜ç‚¹æ˜¯å¯ä»¥è·¨æœåŠ¡å™¨ï¼Œå½“Nginxå’Œphp-fpmä¸åœ¨åŒä¸€å°æœºå™¨ä¸Šæ—¶ï¼Œåªèƒ½ä½¿ç”¨è¿™ç§æ–¹å¼</span>
</span></span><span style="display:flex;"><span>$ listen <span style="color:#f92672">=</span> 127.0.0.1:9000</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä¿®æ”¹æƒé™å¯åŠ¨æœåŠ¡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹æƒé™</span>
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">755</span> /etc/init.d/php-fpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ åˆ°å¯åŠ¨é¡¹</span>
</span></span><span style="display:flex;"><span>$ chkconfig --add php-fpm 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¼€æœºè‡ªå¯</span>
</span></span><span style="display:flex;"><span>$ chkconfig php-fpm on
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨æœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ service php-fpm start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡å¯é…ç½®</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;N;56iexport PATH=/usr/local/php/bin:</span>$PATH<span style="color:#e6db74">&#34;</span> /etc/profile
</span></span><span style="display:flex;"><span>$ source /etc/profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†™å…¥æµ‹è¯•æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;&lt;?php
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">phpinfo();
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">?&gt;&#39;</span> &gt;/usr/local/nginx/html/index.php
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹é…ç½®nginxæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ nginxconf<span style="color:#f92672">=</span>/usr/local/nginx/conf/nginx.conf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;45s/index.html/index.php index.html/&#39;</span> $nginxconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;65,71s/#//&#39;</span> $nginxconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;70s/fastcgi_params/fastcgi.conf/&#39;</span> $nginxconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;69d&#39;</span> $nginxconf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡å¯nginx</span>
</span></span><span style="display:flex;"><span>$ /usr/local/nginx/sbin/nginx -s reload
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ php -v
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>$ netstat -nuplt | grep :9000</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>systemctl</code><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=php-fpm
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=syslog.target network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=forking
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/usr/local/php/sbin/php-fpm
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecReload=/bin/kill -USR2 $MAINPID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PrivateTmp=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target&#39;</span> &gt; /usr/lib/systemd/system/php-fpm.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹æƒé™</span>
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">755</span> /usr/lib/systemd/system/php-fpm.service
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">755</span> /etc/init.d/php-fpm
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload <span style="color:#f92672">&amp;&amp;</span> systemctl enable php-fpm
</span></span><span style="display:flex;"><span>$ systemctl start php-fpm
</span></span><span style="display:flex;"><span>$ systemctl status php-fpm</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="cdn">CDN</h1>


            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="codes">Codes</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Codes</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_sonarqube">Configure_SonarQube</h1>

<h2 id="é…ç½®sonarqube">é…ç½®<code>SonarQube</code></h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://openai.com/blog/openai-codex/" rel="external" target="_self"><code>OpenAI Codex</code></a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="https://github.com/features/copilot/" rel="external" target="_self"><code>Github copilot</code></a></li>
</ol>
</li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li>é…ç½®<code>SonarQube</code>ä¸­æ–‡</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>æœç´¢<code>Chinese Pack</code>ä¸­æ–‡æ’ä»¶</li>
</ul>
<p><a href="#R-image-abfeb69e4c4cd939891a14cb90318925" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/SonarQube_Server/Snipaste_2022-11-22_15-01-44.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-abfeb69e4c4cd939891a14cb90318925"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/SonarQube_Server/Snipaste_2022-11-22_15-01-44.png"></a></p>
<ul>
<li>
<p>1.2 å¦‚æœåŒ¹é…<code>Gitlab</code>ä¸æˆåŠŸå¯èƒ½æ˜¯ç‰ˆæœ¬ä¸å¯¹ï¼Œ éœ€è¦æ›´æ–°ç‰ˆæœ¬</p>
</li>
<li>
<p>1.3 é…ç½®<code>sonar-scanner</code>çš„<code>sonar-project.properties</code>æ–‡ä»¶</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/php/project/sonar-project.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¿…é¡»æŒ‡å®šprojectKey
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sonar.projectKey=php:admin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å®šä¹‰æ£€æµ‹åå±•ç¤ºåç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sonar.projectName=Project NAME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æŒ‡å®šç‰ˆæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sonar.projectVersion=4.7 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é¡¹ç›®ä»£ç å­˜æ”¾ç›®å½• 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sonar.sources=/opt/admin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é¡¹ç›®ä»£ç ä½¿ç”¨çš„å¼€å‘è¯­è¨€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sonar.language=php 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sonar.dynamicAnalysis=false 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Encoding of the source files 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sonar.sourceEncoding=UTF-8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ‡æ¢é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>$ /opt/sonar-scanner/bin/sonar-scanner -Dsonar.login<span style="color:#f92672">=</span>admin -Dsonar.password<span style="color:#f92672">=</span>password  -Dsonar.host.url<span style="color:#f92672">=</span>http://sonarqube.erge.com</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_sonarqube">Install_SonarQube</h1>

<h2 id="å®‰è£…sonarqubeä»£ç è´¨é‡ç®¡ç†ç³»ç»Ÿ">å®‰è£…<code>SonarQube</code>ä»£ç è´¨é‡ç®¡ç†ç³»ç»Ÿ</h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://github.com/anchore/grype" rel="external" target="_self"><code> grype Docker é•œåƒæ‰«æ</code></a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="https://archerydms.com/installation/manual/" rel="external" target="_self"><code>Archery</code>ä»£ç æ£€æŸ¥æœåŠ¡</a></li>
</ol>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>
<ol>
<li><code>SonarQube</code>æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†ä»£ç è´¨é‡çš„å¼€æ”¾å¹³å°ï¼Œå¯ä»¥å¿«é€Ÿçš„å®šä½ä»£ç ä¸­æ½œåœ¨çš„æˆ–è€…æ˜æ˜¾çš„é”™è¯¯ã€‚ç›®å‰æ”¯æŒ<code>java</code>ã€<code>C#</code>ã€<code>C/C++</code>ã€<code>Python</code>ã€<code>PL/SQL</code>ã€<code>Cobol</code>ã€<code>JavaScrip</code>ã€<code>Groovy</code>ç­‰äºŒåå‡ ç§ç¼–ç¨‹è¯­è¨€çš„ä»£ç è´¨é‡ç®¡ç†ä¸æ£€æµ‹</li>
</ol>
</li>
<li>
<ol start="2">
<li>ä»ä¸ƒä¸ªç»´åº¦æ£€æµ‹ä»£ç è´¨é‡</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>å¤æ‚åº¦åˆ†å¸ƒ(<code>complexity</code>):ä»£ç å¤æ‚åº¦è¿‡é«˜å°†éš¾ä»¥ç†è§£</li>
<li>é‡å¤ä»£ç (<code>duplications</code>):ç¨‹åºä¸­åŒ…å«å¤§é‡å¤åˆ¶ã€ç²˜è´´çš„ä»£ç è€Œå¯¼è‡´ä»£ç è‡ƒè‚¿ï¼Œ<code>sonar</code>å¯ä»¥å±•ç¤ºæºç ä¸­é‡å¤ä¸¥é‡çš„åœ°æ–¹</li>
<li>å•å…ƒæµ‹è¯•ç»Ÿè®¡(<code>unit tests</code>):ç»Ÿè®¡å¹¶å±•ç¤ºå•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼Œå¼€å‘æˆ–æµ‹è¯•å¯ä»¥æ¸…æ¥šæµ‹è¯•ä»£ç çš„è¦†ç›–æƒ…å†µ</li>
<li>ä»£ç è§„åˆ™æ£€æŸ¥(<code>coding rules</code>):é€šè¿‡<code>Findbugs</code>ã€<code>PMD</code>ã€<code>CheckStyle</code>ç­‰æ£€æŸ¥ä»£ç æ˜¯å¦ç¬¦åˆè§„èŒƒ</li>
<li>æ³¨é‡Šç‡(<code>comments</code>):è‹¥ä»£ç æ³¨é‡Šè¿‡å°‘ï¼Œç‰¹åˆ«æ˜¯äººå‘˜å˜åŠ¨åï¼Œå…¶ä»–äººæ¥æ‰‹æ¯”è¾ƒéš¾æ¥æ‰‹ï¼›è‹¥è¿‡å¤šï¼Œåˆä¸åˆ©äºé˜…è¯»</li>
<li>æ½œåœ¨çš„<code>Bug</code>(<code>potential bugs</code>):é€šè¿‡<code>Findbugs</code>ã€<code>PMD</code>ã€<code>CheckStyle</code>ç­‰æ£€æµ‹æ½œåœ¨çš„<code>bug</code></li>
<li>ç»“æ„ä¸è®¾è®¡(<code>architecture &amp; design</code>):æ‰¾å‡ºå¾ªç¯ï¼Œå±•ç¤ºåŒ…ä¸åŒ…ã€ç±»ä¸ç±»ä¹‹é—´çš„ä¾èµ–ã€æ£€æŸ¥ç¨‹åºä¹‹é—´è€¦åˆåº¦</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li>å®‰è£…è¦æ±‚</li>
</ol>
</li>
</ul>
<table>
<thead>
<tr>
<th>ç¯å¢ƒè¦æ±‚</th>
<th>ç‰ˆæœ¬</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>postgresql</code></td>
<td><code>9.7</code></td>
<td></td>
</tr>
<tr>
<td><code>JDK</code></td>
<td><code>11</code></td>
<td></td>
</tr>
<tr>
<td><code>SonarQube</code></td>
<td><code>9.7.1</code></td>
<td></td>
</tr>
<tr>
<td><code>Elasticsearch</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li>ä½¿ç”¨<code>PostgreSQL</code>åˆ›å»º<code>SonarQube</code>æ•°æ®åº“</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºsonarç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>$ ./bin/createuser sonar  	<span style="color:#75715e"># åˆ›å»ºæ–°ç”¨æˆ· sonarï¼Œcreate user sonar;</span>
</span></span><span style="display:flex;"><span>$ ./bin/psql -d template1  	<span style="color:#75715e"># è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼</span>
</span></span><span style="display:flex;"><span>$ ALTER USER sonar WITH ENCRYPTED password <span style="color:#e6db74">&#39;sonar@123!&#39;</span>;  	<span style="color:#75715e"># è®¾ç½®sonarç”¨æˆ·å¯†ç (å¦åˆ™ä¼šå¯¼è‡´è¿ä¸ä¸Šæ•°æ®åº“)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºsonaræ•°æ®åº“  </span>
</span></span><span style="display:flex;"><span>$ CREATE DATABASE sonar WITH ENCODING <span style="color:#e6db74">&#39;UTF8&#39;</span> OWNER sonar TEMPLATE<span style="color:#f92672">=</span>template0;  	<span style="color:#75715e"># create database sonar;  </span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><a href="https://binaries.sonarsource.com/" rel="external" target="_self">ä¸‹è½½<code>SonarQube</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://binaries.sonarsource.com/" rel="external" target="_self"><code>SonarQube</code></a>â†’<code>Distribution</code>â†’<code>SonarQube</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -O https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-9.6.1.59531.zip
</span></span><span style="display:flex;"><span>$ yum -y install unzip
</span></span><span style="display:flex;"><span>$ unzip sonarqube-9.6.1.59531.zip -d /opt/
</span></span><span style="display:flex;"><span>$ mv sonarqube-9.6.1.59531 /opt/sonarqube</span></span></code></pre></div><ul>
<li>é…ç½®<code>sonar.properties</code>æ–‡ä»¶</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /opt/sonarqube/conf/sonar.properties
</span></span><span style="display:flex;"><span>sonar.jdbc.username<span style="color:#f92672">=</span>sonar
</span></span><span style="display:flex;"><span>sonar.jdbc.password<span style="color:#f92672">=</span>sonar
</span></span><span style="display:flex;"><span>sonar.jdbc.url<span style="color:#f92672">=</span>jdbc:postgresql://localhost/sonar
</span></span><span style="display:flex;"><span><span style="color:#75715e"># WEB SERVER</span>
</span></span><span style="display:flex;"><span>sonar.web.host<span style="color:#f92672">=</span>0.0.0.0
</span></span><span style="display:flex;"><span>sonar.web.port<span style="color:#f92672">=</span><span style="color:#ae81ff">9000</span></span></span></code></pre></div><ul>
<li><code>SonarQube</code>ä¸èƒ½é€šè¿‡<code>root</code>ç”¨æˆ·æ‰§è¡Œï¼Œæ–°å»ºç”¨æˆ·</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ useradd sonar
</span></span><span style="display:flex;"><span>$ chown -R sonar. /opt/sonarqube
</span></span><span style="display:flex;"><span>$ su - sonar
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ulimit -n <span style="color:#ae81ff">65535</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;* soft nofile 65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nofile 65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft nproc 32000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nproc 32000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard memlock unlimited
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft memlock unlimited &#34;</span>&gt;&gt;/etc/security/limits.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;vm.max_map_count=655360&#34;</span> &gt;&gt;/etc/sysctl.conf</span></span></code></pre></div><ul>
<li>å¯åŠ¨<code>SonarQube</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/sonarqube/
</span></span><span style="display:flex;"><span>$ ./bin/linux-x86-64/sonar.sh start</span></span></code></pre></div><ul>
<li>ç™»å½•<code>SonarQube</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ http://IP:9000  	<span style="color:#75715e"># é»˜è®¤ç”¨æˆ·åå¯†ç ï¼šadmin/admin</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="å®‰è£…æ‰«æå®¢æˆ·ç«¯">å®‰è£…æ‰«æå®¢æˆ·ç«¯</h3>
<ul>
<li>
<ol>
<li><a href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/" rel="external" target="_self">ä¸‹è½½**<code>SonarScanner</code>**</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.7.0.2747-linux.zip
</span></span><span style="display:flex;"><span>$ unzip sonar-scanner-cli-4.7.0.2747-linux.zip 
</span></span><span style="display:flex;"><span>$ mv sonar-scanner-4.7.0.2747-linux /opt/sonar-scanner</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="crontab">Crontab</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Crontab</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install-xxl-job">Install Xxl Job</h1>

<h2 id="å®‰è£…xxl-job">å®‰è£…<code>xxl-job</code></h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://www.xuxueli.com/xxl-job/#1.5%20%E4%B8%8B%E8%BD%BD" rel="external" target="_self">å®˜æ–¹ä¸‹è½½éƒ¨ç½²æ–‡æ¡£</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><code>Maven3+</code></li>
</ol>
</li>
<li>
<ol start="3">
<li><code>Jdk1.8+</code></li>
</ol>
</li>
<li>
<ol start="4">
<li><code>Mysql5.7+</code></li>
</ol>
</li>
</ul>
</blockquote>
<hr>
<h3 id="å®‰è£…maven">å®‰è£…<code>Maven</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸‹è½½<!-- raw HTML omitted --><code>Maven</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://dlcdn.apache.org/maven/maven-3/3.8.5/binaries/apache-maven-3.8.5-bin.tar.gz</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é…ç½®ç¯å¢ƒå˜é‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;export PATH=/opt/apache-maven-3.8.5/bin:$PATH&#39;</span> &gt;&gt;/etc/profile</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å›½å†…é…ç½®é˜¿é‡Œäº‘<!-- raw HTML omitted --><code>Maven</code><!-- raw HTML omitted -->æº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="http://dblab.xmu.edu.cn/blog/2758/" rel="external" target="_self">å°†<code>Maven</code>æºæ”¹ä¸ºå›½å†…é˜¿é‡Œäº‘ä»“åº“</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/local/maven/conf/settings.xml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;settings xmlns=&#34;http://maven.apache.org/SETTINGS/1.0.0&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          xsi:schemaLocation=&#34;http://maven.apache.org/SETTINGS/1.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                      http://maven.apache.org/xsd/settings-1.0.0.xsd&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;mirrors&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;mirror&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;id&gt;aliyunmaven&lt;/id&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;name&gt;é˜¿é‡Œäº‘å…¬å…±ä»“åº“&lt;/name&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;/mirror&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;mirror&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;id&gt;aliyunmaven&lt;/id&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;name&gt;é˜¿é‡Œäº‘è°·æ­Œä»“åº“&lt;/name&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;url&gt;https://maven.aliyun.com/repository/google&lt;/url&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;/mirror&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;mirror&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;id&gt;aliyunmaven&lt;/id&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;name&gt;é˜¿é‡Œäº‘é˜¿å¸•å¥‡ä»“åº“&lt;/name&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;url&gt;https://maven.aliyun.com/repository/apache-snapshots&lt;/url&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;/mirror&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;mirror&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;id&gt;aliyunmaven&lt;/id&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;name&gt;é˜¿é‡Œäº‘springä»“åº“&lt;/name&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;url&gt;https://maven.aliyun.com/repository/spring&lt;/url&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;/mirror&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;mirror&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;id&gt;aliyunmaven&lt;/id&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;name&gt;é˜¿é‡Œäº‘springæ’ä»¶ä»“åº“&lt;/name&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;url&gt;https://maven.aliyun.com/repository/spring-plugin&lt;/url&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;/mirror&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;/mirrors&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;/settings&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="å®‰è£…xxl-job-1">å®‰è£…<code>xxl-job</code></h3>
<ul>
<li>
<ol>
<li><code>/xxl-job/doc/db/tables_xxl_job.sql</code><!-- raw HTML omitted -->ï¼šåˆå§‹åŒ–æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /xxl-job/xxl-job-admin/src/main/resources/application.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### è°ƒåº¦ä¸­å¿ƒJDBCé“¾æ¥ï¼šé“¾æ¥åœ°å€è¯·ä¿æŒå’Œ 2.1ç« èŠ‚ æ‰€åˆ›å»ºçš„è°ƒåº¦æ•°æ®åº“çš„åœ°å€ä¸€è‡´</span>
</span></span><span style="display:flex;"><span>spring.datasource.url<span style="color:#f92672">=</span>jdbc:mysql://127.0.0.1:3306/xxl_job?useUnicode<span style="color:#f92672">=</span>true&amp;characterEncoding<span style="color:#f92672">=</span>UTF-8&amp;autoReconnect<span style="color:#f92672">=</span>true&amp;serverTimezone<span style="color:#f92672">=</span>Asia/Shanghai
</span></span><span style="display:flex;"><span>spring.datasource.username<span style="color:#f92672">=</span>root
</span></span><span style="display:flex;"><span>spring.datasource.password<span style="color:#f92672">=</span>root_pwd
</span></span><span style="display:flex;"><span>spring.datasource.driver-class-name<span style="color:#f92672">=</span>com.mysql.jdbc.Driver
</span></span><span style="display:flex;"><span><span style="color:#75715e">### æŠ¥è­¦é‚®ç®±</span>
</span></span><span style="display:flex;"><span>spring.mail.host<span style="color:#f92672">=</span>smtp.qq.com
</span></span><span style="display:flex;"><span>spring.mail.port<span style="color:#f92672">=</span><span style="color:#ae81ff">25</span>
</span></span><span style="display:flex;"><span>spring.mail.username<span style="color:#f92672">=</span>xxx@qq.com
</span></span><span style="display:flex;"><span>spring.mail.password<span style="color:#f92672">=</span>xxx
</span></span><span style="display:flex;"><span>spring.mail.properties.mail.smtp.auth<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>spring.mail.properties.mail.smtp.starttls.enable<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>spring.mail.properties.mail.smtp.starttls.required<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>spring.mail.properties.mail.smtp.socketFactory.class<span style="color:#f92672">=</span>javax.net.ssl.SSLSocketFactory
</span></span><span style="display:flex;"><span><span style="color:#75715e">### è°ƒåº¦ä¸­å¿ƒé€šè®¯TOKEN [é€‰å¡«]ï¼šéç©ºæ—¶å¯ç”¨ï¼›</span>
</span></span><span style="display:flex;"><span>xxl.job.accessToken<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### è°ƒåº¦ä¸­å¿ƒå›½é™…åŒ–é…ç½® [å¿…å¡«]ï¼š é»˜è®¤ä¸º &#34;zh_CN&#34;/ä¸­æ–‡ç®€ä½“, å¯é€‰èŒƒå›´ä¸º &#34;zh_CN&#34;/ä¸­æ–‡ç®€ä½“, &#34;zh_TC&#34;/ä¸­æ–‡ç¹ä½“ and &#34;en&#34;/è‹±æ–‡ï¼›</span>
</span></span><span style="display:flex;"><span>xxl.job.i18n<span style="color:#f92672">=</span>zh_CN
</span></span><span style="display:flex;"><span><span style="color:#75715e">## è°ƒåº¦çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹é…ç½®ã€å¿…å¡«ã€‘</span>
</span></span><span style="display:flex;"><span>xxl.job.triggerpool.fast.max<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span>xxl.job.triggerpool.slow.max<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### è°ƒåº¦ä¸­å¿ƒæ—¥å¿—è¡¨æ•°æ®ä¿å­˜å¤©æ•° [å¿…å¡«]ï¼šè¿‡æœŸæ—¥å¿—è‡ªåŠ¨æ¸…ç†ï¼›é™åˆ¶å¤§äºç­‰äº7æ—¶ç”Ÿæ•ˆï¼Œå¦åˆ™, å¦‚-1ï¼Œå…³é—­è‡ªåŠ¨æ¸…ç†åŠŸèƒ½ï¼›</span>
</span></span><span style="display:flex;"><span>xxl.job.logretentiondays<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰§è¡Œæ‰“åŒ…ï¼ŒinstallåŒ…å«äº† packageçš„æ‰€æœ‰é˜¶æ®µ</span>
</span></span><span style="display:flex;"><span>$ mvn package
</span></span><span style="display:flex;"><span>$ mvn clean install</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>xxl-job-admin/target</code><!-- raw HTML omitted -->ï¼šç›®å½•ä¸‹ç”Ÿæˆï¼š<!-- raw HTML omitted --><code>xxl-job-admin-2.3.0.jar</code></li>
</ol>
</li>
<li>
<ol start="4">
<li><code>java -jar xxl-job-admin-2.3.0.jar</code><!-- raw HTML omitted -->ï¼šå¯åŠ¨<!-- raw HTML omitted --><code>xxl-job</code></li>
</ol>
</li>
</ul>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="daemon">Daemon</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Daemon</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_supervisord">Install_Supervisord</h1>

<h2 id="å®‰è£…supervisordè¿›ç¨‹å®ˆæŠ¤æœåŠ¡">å®‰è£…<code>Supervisord</code>è¿›ç¨‹å®ˆæŠ¤æœåŠ¡</h2>
<h3 id="å®‰è£…supervisord">å®‰è£…<code>supervisord</code></h3>
<blockquote>
<ul>
<li>
<ol>
<li><a href="http://supervisord.org/" rel="external" target="_self"><code>Supervisord</code>å®˜ç½‘</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="https://www.artacode.com/posts/supervisor/" rel="external" target="_self"><code>Supervisord</code>å®‰è£…ä¸ä½¿ç”¨</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><a href="https://www.jianshu.com/p/9abffc905645" rel="external" target="_self"><code>supervisord</code>åˆä½“éªŒ</a></li>
</ol>
</li>
<li>
<ol start="4">
<li><a href="https://blog.wangmao.me/supervisor-with-php-fpm.html" rel="external" target="_self">ä½¿ç”¨<code>Supervisord</code>å®ˆæŠ¤<code>php-fpm</code>è¿›ç¨‹</a></li>
</ol>
</li>
<li>
<ol start="5">
<li><a href="https://baiyongjie.com/?p=385" rel="external" target="_self"><code>Supervisord</code>ç®¡ç†<code>redis</code>è¿›ç¨‹</a></li>
</ol>
</li>
<li>
<ol start="6">
<li><a href="https://my.oschina.net/xinxingegeya/blog/659095" rel="external" target="_self">ä½¿ç”¨<code>Supervisord</code>ç®¡ç†<code>Redis</code>è¿›ç¨‹</a></li>
</ol>
</li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…æ‰©å±•ï¼Œä¸‹è½½å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install python-setuptools -y  	<span style="color:#75715e"># å®‰è£…pythonç¨‹åºå¼€å‘è¿‡ç¨‹åº“</span>
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/
</span></span><span style="display:flex;"><span>$ wget https://pypi.python.org/packages/7b/17/88adf8cb25f80e2bc0d18e094fcd7ab300632ea00b601cbbbb84c2419eae/supervisor-3.3.2.tar.gz  	<span style="color:#75715e"># ä¸‹è½½å®‰è£…åŒ…</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://files.pythonhosted.org/packages/0a/ba/52611dc8278828eb9ec339e6914a0f865f9e2af967214905927835dfac0a/setuptools-63.2.0.tar.gz  	# æ–°çš„ä¸‹è½½åœ°å€</span>
</span></span><span style="display:flex;"><span>$ tar -zxvf supervisor-3.3.2.tar.gz  	<span style="color:#75715e"># è§£å‹å®‰è£…åŒ…</span>
</span></span><span style="display:flex;"><span>$ cd supervisor-3.3.2  	<span style="color:#75715e"># è¿›å…¥ç¨‹åºç›®å½•</span>
</span></span><span style="display:flex;"><span>$ python setup.py install  	<span style="color:#75715e"># æ‰§è¡Œå®‰è£…è„šæœ¬</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo_supervisord_conf &gt;/etc/supervisord.conf  	<span style="color:#75715e"># æ‰§è¡Œå‘½ä»¤ç”Ÿæˆé…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ mkdir /etc/supervisor  	<span style="color:#75715e"># åˆ›å»ºéœ€è¦å®ˆæŠ¤çš„è¿›ç¨‹ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ vim /etc/supervisord.conf
</span></span><span style="display:flex;"><span>	;<span style="color:#f92672">[</span>include<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>	;files <span style="color:#f92672">=</span> relative/directory/*.ini
</span></span><span style="display:flex;"><span>	ä¿®æ”¹ä¸º:
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">[</span>include<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>	files<span style="color:#f92672">=</span>/etc/supervisor/*.conf <span style="color:#f92672">(</span>æ³¨æ„å»æ‰åˆ†å·,ç¬¬ä¸€æ¬¡å®‰è£…çš„æ—¶å€™å°±å› ä¸ºæ²¡å»æ‰åˆ†å·å‡ºç°äº†é—®é¢˜!<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>$ supervisord -c /etc/supervisord.conf  	<span style="color:#75715e"># å¯åŠ¨æœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ supervisorctl reload  	<span style="color:#75715e"># é‡æ–°è½½å…¥</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="ç¼–å†™æœåŠ¡è¿›ç¨‹å®ˆæŠ¤é…ç½®æ–‡ä»¶">ç¼–å†™æœåŠ¡è¿›ç¨‹å®ˆæŠ¤é…ç½®æ–‡ä»¶</h3>
<ul>
<li>
<ol>
<li><code>Redis</code><!-- raw HTML omitted -->è¿›ç¨‹å®ˆæŠ¤é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>program:redisd<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>command<span style="color:#f92672">=</span>bash -c <span style="color:#e6db74">&#34;sleep 1 &amp;&amp; /usr/local/redis/bin/redis-server  /usr/local/redis/redis.conf&#34;</span>    <span style="color:#75715e">#å¯åŠ¨supervisorä¼šè‡ªåŠ¨è¿è¡Œè¿™ä¸ªcommand  </span>
</span></span><span style="display:flex;"><span>directory <span style="color:#f92672">=</span> /Users/xinxingegeya/IDE/redis/redis_7000 <span style="color:#75715e">#ç¨‹åºçš„å¯åŠ¨ç›®å½•</span>
</span></span><span style="display:flex;"><span>process_name<span style="color:#f92672">=</span>%<span style="color:#f92672">(</span>program_name<span style="color:#f92672">)</span>s   <span style="color:#75715e">#è°ƒç”¨æµç¨‹åç§°</span>
</span></span><span style="display:flex;"><span>autostart<span style="color:#f92672">=</span>true      <span style="color:#75715e">#å½“ç¨‹åºè·‘å‡ºexitçš„æ—¶å€™ï¼Œè¿™ä¸ªprogramä¼šè‡ªåŠ¨é‡å¯</span>
</span></span><span style="display:flex;"><span>autorestart<span style="color:#f92672">=</span>true    <span style="color:#75715e">#ç¨‹åºé‡å¯æ—¶å€™åœç•™åœ¨runingçŠ¶æ€çš„ç§’æ•°</span>
</span></span><span style="display:flex;"><span>startretries<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>  <span style="color:#75715e">#å¯åŠ¨ 5 ç§’åæ²¡æœ‰å¼‚å¸¸é€€å‡ºï¼Œå°±å½“ä½œå·²ç»æ­£å¸¸å¯åŠ¨äº†</span>
</span></span><span style="display:flex;"><span>startretries <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>     <span style="color:#75715e">#å¯åŠ¨å¤±è´¥è‡ªåŠ¨é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯ 3</span>
</span></span><span style="display:flex;"><span>user <span style="color:#f92672">=</span> xinxingegeya          <span style="color:#75715e">#ç”¨å“ªä¸ªç”¨æˆ·å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>exitcodes<span style="color:#f92672">=</span>0,2,70    <span style="color:#75715e">#é€€å‡ºç </span>
</span></span><span style="display:flex;"><span>stopsignal<span style="color:#f92672">=</span>QUIT     <span style="color:#75715e">#åœæ­¢ä¿¡å·:QUIT(æ”¾å¼ƒ)</span>
</span></span><span style="display:flex;"><span>stopwaitsecs<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>      <span style="color:#75715e">#åœæ­¢ç­‰å¾…ç§’æ•°</span>
</span></span><span style="display:flex;"><span>stdout_logfile<span style="color:#f92672">=</span>/var/log/supervisor/redis.log
</span></span><span style="display:flex;"><span>stdout_logfile_maxbytes<span style="color:#f92672">=</span>1MB
</span></span><span style="display:flex;"><span>stdout_logfile_backups<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>php-fpm</code><!-- raw HTML omitted -->è¿›ç¨‹å®ˆæŠ¤é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>program:php-fpm<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>command<span style="color:#f92672">=</span>bash -c <span style="color:#e6db74">&#34;sleep 1 &amp;&amp; /usr/local/php/sbin/php-fpm --fpm-config /usr/local/php/etc/php-fpm.conf --pid /usr/local/php/var/run/php-fpm.pid&#34;</span>
</span></span><span style="display:flex;"><span>process_name<span style="color:#f92672">=</span>%<span style="color:#f92672">(</span>program_name<span style="color:#f92672">)</span>s
</span></span><span style="display:flex;"><span>autostart<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>autorestart<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>startretries<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>exitcodes<span style="color:#f92672">=</span>0,2,70
</span></span><span style="display:flex;"><span>stopsignal<span style="color:#f92672">=</span>QUIT 
</span></span><span style="display:flex;"><span>stopwaitsecs<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>stdout_logfile<span style="color:#f92672">=</span>/var/log/supervisord/php-fpm.log</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å…¶ä»–é…ç½®é¡¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>redirect_stderr<span style="color:#f92672">=</span>true ; <span style="color:#f92672">(</span>max main logfile bytes b4 rotation;default 50MB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>logfile<span style="color:#f92672">=</span>/web/crontab_agent/Logs/swcAgent.log ;
</span></span><span style="display:flex;"><span>logfile_maxbytes<span style="color:#f92672">=</span>500MB ; <span style="color:#f92672">(</span>num of main logfile rotation backups;default 10<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>logfile_backups<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span> ;
</span></span><span style="display:flex;"><span>loglevel<span style="color:#f92672">=</span>info ;
</span></span><span style="display:flex;"><span>stdout_logfile<span style="color:#f92672">=</span>/web/crontab_agent/Logs/swcAgent.log ; stdout log path, NONE <span style="color:#66d9ef">for</span> none; default AUTO
</span></span><span style="display:flex;"><span>stdout_logfile_maxbytes<span style="color:#f92672">=</span>500MB   ; max <span style="color:#75715e"># logfile bytes b4 rotation (default 50MB)</span>
</span></span><span style="display:flex;"><span>stdout_logfile_backups<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>     ; <span style="color:#75715e"># of stdout logfile backups (default 10)</span>
</span></span><span style="display:flex;"><span>stderr_logfile<span style="color:#f92672">=</span>/web/crontab_agent/Logs/swcAgent.log ; stderr log path, NONE <span style="color:#66d9ef">for</span> none; default AUTO
</span></span><span style="display:flex;"><span>stderr_logfile_maxbytes<span style="color:#f92672">=</span>500MB   ; max <span style="color:#75715e"># logfile bytes b4 rotation (default 50MB)</span>
</span></span><span style="display:flex;"><span>stderr_logfile_backups<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>     ; <span style="color:#75715e"># of stderr logfile backups (default 10)</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="databases">Databases</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Databases</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_clickhouse">Install_ClickHouse</h1>

<h2 id="clickhouseéƒ¨ç½²"><code>ClickHouse</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><a href="https://clickhouse.com/docs/en/getting-started/quick-start" rel="external" target="_self"><code>ClickHouse</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="update_mysql5-7_to_mysql8">Update_Mysql5 7_To_Mysql8</h1>

<h2 id="mysql-57-å‡çº§åˆ°mysql-8"><code>Mysql 5.7 </code>å‡çº§åˆ°<code>Mysql 8</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸‹è½½è§£å‹<code>Mysql 8</code>å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz -P /usr/local/src/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar -xvf /usr/local/src/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz -C  /usr/local/src/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mv /usr/local/src/mysql-8.0.21-linux-glibc2.12-x86_64  /usr/local/mysql8</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¿®æ”¹<code>Mysql</code>çš„<code>cnf</code>æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><!-- raw HTML omitted -->åªæ›´æ”¹å·¥ä½œç›®å½•ï¼Œä¸æ›´æ”¹ data æ•°æ®ç›®å½•<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed  -i <span style="color:#e6db74">&#34;s#/usr/local/mysql#/usr/local/mysql8#g&#34;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/sql_mode/#sql_mode/g&#39;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;20i sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION&#39;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;20i default_authentication_plugin=mysql_native_password&#39;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/query_cache_size/#query_cache_size/g&#39;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/query_cache_limit/#query_cache_limit/g&#39;</span> /etc/my.cnf</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¤‡ä»½<code>Mysql</code>æ•°æ®ã€ç›®å½•ï¼Œåœæ­¢ç°æœ‰<!-- raw HTML omitted --><code>Mysql</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p<span style="color:#e6db74">&#39;password&#39;</span> -S /opt/data/data_16303/mysql.sock -e <span style="color:#e6db74">&#34;set global innodb_fast_shutdown=0;&#34;</span>
</span></span><span style="display:flex;"><span>$ mysql -uroot -p<span style="color:#e6db74">&#39;password&#39;</span> -S /opt/data/data_16303/mysql.sock -e <span style="color:#e6db74">&#34;shutdown;&#34;</span>
</span></span><span style="display:flex;"><span>$ cp -r /usr/local/mysql/data<span style="color:#f92672">{</span>,.bak<span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Mysql 8</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/mysql8/bin/mysqld --defaults-file<span style="color:#f92672">=</span>/etc/my.cnf --user<span style="color:#f92672">=</span>mysql &amp;
</span></span><span style="display:flex;"><span>$ mv /usr/local/mysql  /usr/local/src/mysql-5.7-<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>.bak</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å‡çº§æˆåŠŸ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/mysql8/bin/mysql -uroo -p<span style="color:#e6db74">&#39;password&#39;</span> -S /tmp/mysql.sock -e <span style="color:#e6db74">&#34;select version();&#34;</span> | tail -1<span style="color:#e6db74">`</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_ydb">Install_Ydb</h1>

<h2 id="éƒ¨ç½²ydbå•èŠ‚ç‚¹æ•°æ®åº“">éƒ¨ç½²<code>Ydb</code>å•èŠ‚ç‚¹æ•°æ®åº“</h2>
<blockquote>
<ol>
<li><code>Ydb</code><!-- raw HTML omitted -->ä½¿ç”¨ç«¯å£<!-- raw HTML omitted --></li>
</ol>
<table>
<thead>
<tr>
<th>ç«¯å£</th>
<th>åè®®</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>2135~2136</td>
<td><code>TCP</code></td>
<td>ç”¨äºå®¢æˆ·ç«¯-é›†ç¾¤äº¤äº’çš„<code>GRPC</code></td>
</tr>
<tr>
<td>19001~19002</td>
<td><code>TCP</code></td>
<td>é›†ç¾¤å†…èŠ‚ç‚¹äº¤äº’äº’è¿</td>
</tr>
<tr>
<td>8765~8766</td>
<td><code>TCP</code></td>
<td>é›†ç¾¤ç›‘æ§çš„<code>HTTP</code>æ¥å£</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><a href="https://ydb.tech/" rel="external" target="_self"><code>Ydb</code></a>æ•°æ®åº“ã€<a href="https://github.com/ydb-platform/ydb" rel="external" target="_self"><code>Github-Ydb</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç³»ç»Ÿè¦æ±‚<!-- raw HTML omitted --><code>Ubuntu 20.04ã€Debian 11ã€Fedora34</code><!-- raw HTML omitted -->ç­‰ä»¥ä¸Šç‰ˆæœ¬ç³»ç»Ÿ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/<span style="color:#f92672">{</span>ydb,ydb-cli<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$ cd /opt/ydb/
</span></span><span style="display:flex;"><span>$ curl https://binaries.ydb.tech/local_scripts/install.sh | bash</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯åŠ¨ã€åœæ­¢<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç£ç›˜å¯åŠ¨ä½¿ç”¨ï¼Œç£ç›˜æœ€å°‘ä¸èƒ½ä½äº 80G</span>
</span></span><span style="display:flex;"><span>$ ./start.sh disk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†…å­˜å¯åŠ¨ï¼Œå†…å­˜å¯åŠ¨æœåŠ¡å™¨é‡å¯æ•°æ®ä¸¢å¤±</span>
</span></span><span style="display:flex;"><span>$ ./start.sh ram
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœæ­¢</span>
</span></span><span style="display:flex;"><span>$ ./stop.sh</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->éƒ¨ç½²<!-- raw HTML omitted --><code>Ydb-cli</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -sSL https://storage.yandexcloud.net/yandexcloud-ydb/install.sh | bash
</span></span><span style="display:flex;"><span>$ source /root/.bashrc</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Ydb-cli</code>æŸ¥è¯¢</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpc://localhost:2136 -d /Root/test scheme ls
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ydb -e grpc://nodeip:2136 -d /Root/testdb workload stock init
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨YDB Webé¡µé¢</span>
</span></span><span style="display:flex;"><span>$ ydb -e grpc://nodeip:2136 -d /Root/testdb workload stock run add-rand-order -s <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ydb -e grpc://192.168.88.112:2136 -d /Root/testdb topic read orders/updates -c ilnaz --wait --format<span style="color:#f92672">=</span>newline-delimited</span></span></code></pre></div></blockquote>
<hr>
<h2 id="éƒ¨ç½²é›†ç¾¤æ¨¡å¼">éƒ¨ç½²é›†ç¾¤æ¨¡å¼</h2>
<h3 id="å®‰è£…å‰å‡†å¤‡">å®‰è£…å‰å‡†å¤‡</h3>
<blockquote>
<ol>
<li><a href="https://ydb.tech/en/docs/deploy/manual/deploy-ydb-on-premises" rel="external" target="_self">åœ¨è™šæ‹Ÿæˆ–è£¸æœºæœåŠ¡å™¨ä¸Šéƒ¨ç½²<code>YDB</code>é›†ç¾¤</a></li>
</ol>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è™šæ‹Ÿæœºç³»ç»Ÿå®‰è£…å¥½åï¼Œé‡æ–°æ·»åŠ <!-- raw HTML omitted --><code>NVMe(v)</code>ç±»å‹ç£ç›˜</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å‡†å¤‡ç¯å¢ƒã€ç”¨æˆ·<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo groupadd ydb
</span></span><span style="display:flex;"><span>$ sudo useradd ydb -g ydb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo usermod -aG disk ydb  	<span style="color:#75715e"># ä¸ºäº†ç¡®ä¿YDBå¯ä»¥è®¿é—®å—ç£ç›˜æ¥è¿è¡Œï¼Œæ‚¨éœ€è¦å°†è¿›ç¨‹æ‰€æœ‰è€…æ·»åŠ åˆ°diskç»„ä¸­</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ apt install sudo  	<span style="color:#75715e"># ä½¿ç”¨rootç”¨æˆ·å®‰è£…sudo</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;name  ALL=(ALL:ALL) ALL&#34;</span> &gt;&gt;/etc/sudoers
</span></span><span style="display:flex;"><span>$ sudo apt install curl parted</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åœ¨æ‰€é€‰ç£ç›˜ä¸Šåˆ›å»ºåˆ†åŒº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo parted /dev/nvme0n1 mklabel gpt -s
</span></span><span style="display:flex;"><span>$ sudo parted -a optimal /dev/nvme0n1 mkpart primary 0% 100%
</span></span><span style="display:flex;"><span>$ sudo parted /dev/nvme0n1 name <span style="color:#ae81ff">1</span> ydb_disk_ssd_01
</span></span><span style="display:flex;"><span>$ sudo partx --u /dev/nvme0n1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo parted /dev/nvme0n2 mklabel gpt -s
</span></span><span style="display:flex;"><span>$ sudo parted -a optimal /dev/nvme0n2 mkpart primary 0% 100%
</span></span><span style="display:flex;"><span>$ sudo parted /dev/nvme0n2 name <span style="color:#ae81ff">1</span> ydb_disk_ssd_02
</span></span><span style="display:flex;"><span>$ sudo partx --u /dev/nvme0n2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo parted /dev/nvme0n3 mklabel gpt -s
</span></span><span style="display:flex;"><span>$ sudo parted -a optimal /dev/nvme0n3 mkpart primary 0% 100%
</span></span><span style="display:flex;"><span>$ sudo parted /dev/nvme0n3 name <span style="color:#ae81ff">1</span> ydb_disk_ssd_03
</span></span><span style="display:flex;"><span>$ sudo partx --u /dev/nvme0n3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç³»ç»Ÿä¸Šå°†å‡ºç°ä¸€ä¸ªæ ‡æœ‰ç£ç›˜çš„ç£ç›˜ </span>
</span></span><span style="display:flex;"><span>$ ll /dev/disk/by-partlabel/</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä¸‹è½½å¹¶è§£å‹åŒ…å«<code>ydbd</code>å¯æ‰§è¡Œæ–‡ä»¶å’Œ<code>YDB</code>è¿è¡Œæ‰€éœ€åº“çš„å­˜æ¡£<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo chown -R ydb:ydb /opt
</span></span><span style="display:flex;"><span>$ mkdir -p /opt/<span style="color:#f92672">{</span>ydb/<span style="color:#f92672">{</span>cfg,secure,certs,log<span style="color:#f92672">}</span>,ydbd-stable-linux-amd64<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ curl -L https://binaries.ydb.tech/ydbd-stable-linux-amd64.tar.gz | tar -xz --strip-component<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> -C /opt/ydbd-stable-linux-amd64</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å°†å¯æ‰§è¡Œæ–‡ä»¶å’Œåº“å¤åˆ¶åˆ°é€‚å½“çš„ç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cp -iR /opt/ydbd-stable-linux-amd64/bin /opt/ydb/
</span></span><span style="display:flex;"><span>$ sudo cp -iR /opt/ydbd-stable-linux-amd64/lib /opt/ydb/</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ä½¿ç”¨ä»¥ä¸‹å†…ç½®å‘½ä»¤æ ¼å¼åŒ–ç£ç›˜<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib /opt/ydb/bin/ydbd admin bs disk obliterate /dev/disk/by-partlabel/ydb_disk_ssd_01
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib /opt/ydb/bin/ydbd admin bs disk obliterate /dev/disk/by-partlabel/ydb_disk_ssd_02
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib /opt/ydb/bin/ydbd admin bs disk obliterate /dev/disk/by-partlabel/ydb_disk_ssd_03</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å‡†å¤‡è¯ä¹¦ä½¿ç”¨ä¿æŠ¤æ¨¡å¼">å‡†å¤‡è¯ä¹¦ä½¿ç”¨ä¿æŠ¤æ¨¡å¼</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å‡†å¤‡<code>CA</code>æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ydb/cfg/ca.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ ca ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_ca = CA_default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ CA_default ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_days = 365
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">database = /opt/ydb/secure/index.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">serial = /opt/ydb/secure/serial.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_md = sha256
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">copy_extensions = copy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">unique_subject = no
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ req ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">prompt=no
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">distinguished_name = distinguished_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">x509_extensions = extensions
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ distinguished_name ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">organizationName = YDB
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">commonName = YDB CA
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ extensions ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">keyUsage = critical,digitalSignature,nonRepudiation,keyEncipherment,keyCertSign
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basicConstraints = critical,CA:true,pathlen:1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ signing_policy ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">organizationName = supplied
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">commonName = optional
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ signing_node_req ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">keyUsage = critical,digitalSignature,keyEncipherment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">extendedKeyUsage = serverAuth,clientAuth
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Used to sign client certificates. ç”¨äºç­¾ç½²å®¢æˆ·ç«¯è¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ signing_client_req ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">keyUsage = critical,digitalSignature,keyEncipherment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">extendedKeyUsage = clientAuth
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ›å»º<code>CA</code>å¯†é’¥<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl genrsa -out /opt/ydb/certs/ca.key <span style="color:#ae81ff">2048</span></span></span></code></pre></div><ul>
<li>2.1 <!-- raw HTML omitted -->åˆ›å»ºç§æœ‰è¯ä¹¦é¢å‘æœºæ„<code>CA</code>è¯ä¹¦<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl req -new -x509 -config /opt/ydb/cfg/ca.cnf -key /opt/ydb/certs/ca.key -out /opt/ydb/certs/ca.crt -days <span style="color:#ae81ff">1830</span> -batch</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åˆ›å»ºæ–‡æœ¬æ•°æ®åº“å’Œ<code>OpenSSL</code>è¯ä¹¦ç´¢å¼•æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ touch /opt/ydb/secure/index.txt
</span></span><span style="display:flex;"><span>$ echo <span style="color:#ae81ff">01</span> &gt;/opt/ydb/secure/serial.txt</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->åˆ›å»º<code>node.cnf</code>å…·æœ‰ä»¥ä¸‹å†…å®¹çš„é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ydb/cfg/node.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># OpenSSL node configuration file
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ req ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">prompt = no
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">distinguished_name = distinguished_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">req_extensions = extensions
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ distinguished_name ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">organizationName = YDB
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ extensions ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjectAltName = DNS:&lt;node&gt;.&lt;domain&gt;  	# èŠ‚ç‚¹IPæˆ–è€…åŸŸå
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºè¯ä¹¦å¯†é’¥<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl genrsa -out /opt/ydb/certs/node.key <span style="color:#ae81ff">2048</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚<code>CSR</code><!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl req -new -sha256 -config /opt/ydb/cfg/node.cnf -key /opt/ydb/certs/node.key -out /opt/ydb/secure/node.csr -batch</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºèŠ‚ç‚¹è¯ä¹¦<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl ca -config /opt/ydb/cfg/ca.cnf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -keyfile /opt/ydb/certs/ca.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -cert /opt/ydb/certs/ca.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -policy signing_policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -extensions signing_node_req <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -out /opt/ydb/certs/node.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -outdir /opt/ydb/certs/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -in /opt/ydb/secure/node.csr -batch</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å°†è¯ä¹¦å’ŒèŠ‚ç‚¹å¯†é’¥å¤åˆ¶åˆ°å®‰è£…æ–‡ä»¶å¤¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo -u ydb cp certs/ca.crt certs/node.crt certs/node.key /opt/ydb/certs/</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ä¸ºydbå‡†å¤‡é›†ç¾¤é…ç½®æ–‡ä»¶">ä¸º<code>YDB</code>å‡†å¤‡é›†ç¾¤é…ç½®æ–‡ä»¶</h3>
<blockquote>
<ul>
<li><a href="https://ydb.tech/en/docs/deploy/configuration/config" rel="external" target="_self">é›†ç¾¤é…ç½®</a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->é›†ç¾¤ç±»å‹ã€åœ¨é›†ç¾¤æ¯ä¸ªèŠ‚ç‚¹ä¸­æ·»åŠ <!-- raw HTML omitted --><code>/opt/ydb/cfg/config.yaml</code>ä¿å­˜<code>YDB</code> é…ç½®æ–‡ä»¶</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://github.com/ydb-platform/ydb/blob/main/ydb/deploy/yaml_config_examples/block-4-2.yaml" rel="external" target="_self"><code>block-4-2</code></a><!-- raw HTML omitted -->ç”¨äºå•æ•°æ®ä¸­å¿ƒé›†ç¾¤<!-- raw HTML omitted --></li>
<li><a href="https://github.com/ydb-platform/ydb/blob/main/ydb/deploy/yaml_config_examples/mirror-3dc-9-nodes.yaml" rel="external" target="_self"><code>mirror-3dc</code></a><!-- raw HTML omitted -->ç”¨äºç”± 9 ä¸ªèŠ‚ç‚¹ç»„æˆçš„è·¨æ•°æ®ä¸­å¿ƒé›†ç¾¤<!-- raw HTML omitted --></li>
<li><a href="https://github.com/ydb-platform/ydb/blob/main/ydb/deploy/yaml_config_examples/mirror-3dc-3-nodes.yaml" rel="external" target="_self"><code>mirror-3dc-3nodes</code></a><!-- raw HTML omitted -->ç”¨äºç”± 3 ä¸ªèŠ‚ç‚¹ç»„æˆçš„è·¨æ•°æ®ä¸­å¿ƒé›†ç¾¤<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åœ¨<code>host_configs</code>éƒ¨åˆ†ä¸­ï¼ŒæŒ‡å®šæ¯ä¸ªç¾¤é›†èŠ‚ç‚¹ä¸Šæ‰€æœ‰ç£ç›˜ç±»å‹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯ç”¨ç£ç›˜ç§ç±»ï¼šå›ºæ€ç¡¬ç›˜ï¼š<code>SSD</code>ã€<code>NVME</code>ã€<code>HDD</code><!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">host_configs</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">drive</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/dev/disk/by-partlabel/ydb_disk_ssd_01</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">SSD  	# å¯ç”¨ç£ç›˜ç§ç±»ï¼šSSDã€NVMEã€HDD</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">host_config_id</span>: <span style="color:#ae81ff">1</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åœ¨è¯¥<code>hosts</code>éƒ¨åˆ†ä¸­ï¼ŒæŒ‡å®šæ¯ä¸ªèŠ‚ç‚¹çš„<code>FQDN</code>ã€å®ƒä»¬çš„é…ç½®å’Œåœ¨<code>data_center</code>æˆ–ä¸­çš„ä½ç½®<code>rack</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>/etc/hosts</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸‹åšæ˜ å°„ï¼š<!-- raw HTML omitted --><code>IP:hostname</code><!-- raw HTML omitted -->é¿å…ä¸å¿…è¦éº»çƒ¦æ‰€æœ‰ä¸»æœºåå¿…é¡»éƒ½æ˜¯å°å†™å­—æ¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">hosts</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">host</span>: <span style="color:#ae81ff">node1.ydb.tech</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">host_config_id</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">walle_location</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">body</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">data_center</span>: <span style="color:#e6db74">&#39;zone-a&#39;</span>  	<span style="color:#75715e"># å¡«å†™ hostname</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rack</span>: <span style="color:#e6db74">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">host</span>: <span style="color:#ae81ff">node2.ydb.tech</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">host_config_id</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">walle_location</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">body</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">data_center</span>: <span style="color:#e6db74">&#39;zone-b&#39;</span>  	<span style="color:#75715e"># å¡«å†™ hostname</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rack</span>: <span style="color:#e6db74">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">host</span>: <span style="color:#ae81ff">node3.ydb.tech</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">host_config_id</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">walle_location</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">body</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">data_center</span>: <span style="color:#e6db74">&#39;zone-c&#39;</span>  	<span style="color:#75715e"># å¡«å†™ hostname</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rack</span>: <span style="color:#e6db74">&#39;1&#39;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å¯ç”¨ç”¨æˆ·èº«ä»½éªŒè¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨<code>YDB</code>é›†ç¾¤ä¸­å¯ç”¨è®¤è¯å’Œç”¨æˆ·è®¿é—®å·®å¼‚åŒ–ç‰¹æ€§ï¼Œåœ¨<code>domains_config</code>éƒ¨åˆ†æ·»åŠ ä»¥ä¸‹å‚æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">domains_config</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">security_config</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enforce_user_token_requirement</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">monitoring_allowed_sids</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;root&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;ADMINS&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;DATABASE-ADMINS&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">administration_allowed_sids</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;root&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;ADMINS&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;DATABASE-ADMINS&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">viewer_allowed_sids</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;root&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;ADMINS&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;DATABASE-ADMINS&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->åœ¨<code>YDB</code>é…ç½®æ–‡ä»¶ä¸­å¯ç”¨æµé‡åŠ å¯†æ¨¡å¼<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨<code>interconnect_config</code>å’Œ<code>grpc_config</code>éƒ¨åˆ†ä¸­ï¼ŒæŒ‡å®šè¯ä¹¦ã€å¯†é’¥å’Œ<code>CA</code>è¯ä¹¦çš„è·¯å¾„<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">interconnect_config</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">start_tcp</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">encryption_mode</span>: <span style="color:#ae81ff">OPTIONAL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path_to_certificate_file</span>: <span style="color:#e6db74">&#34;/opt/ydb/certs/node.crt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path_to_private_key_file</span>: <span style="color:#e6db74">&#34;/opt/ydb/certs/node.key&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path_to_ca_file</span>: <span style="color:#e6db74">&#34;/opt/ydb/certs/ca.crt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">grpc_config</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">cert</span>: <span style="color:#e6db74">&#34;/opt/ydb/certs/node.crt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;/opt/ydb/certs/node.key&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ca</span>: <span style="color:#e6db74">&#34;/opt/ydb/certs/ca.crt&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->å®Œæ•´<!-- raw HTML omitted --><code>block-4-2</code>é…ç½®<!-- raw HTML omitted -->é¿å…ä¸å¿…è¦éº»çƒ¦æ‰€æœ‰ä¸»æœºåå¿…é¡»éƒ½æ˜¯å°å†™å­—æ¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ydb/cfg/config.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># YDB configuration options and their values
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># are described in documentaion https://ydb.tech/en/docs/deploy/configuration/config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># static erasure is the parameter that
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># describes the fault tolerance mode of the
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cluster. See docs for more details https://ydb.tech/en/docs/deploy/configuration/config#domains-blob
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">static_erasure: mirror-3-dc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host_configs: # the list of available host configurations in the cluster.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- drive:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - path: /dev/disk/by-partlabel/ydb_disk_ssd_01    # path of the first disk in the host configration.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: NVME                                       # kind of the disk: available kinds are SSD, NVME, HDD
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - path: /dev/disk/by-partlabel/ydb_disk_ssd_02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - path: /dev/disk/by-partlabel/ydb_disk_ssd_03
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  host_config_id: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hosts:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- host: debian-1-88-110       # storage node DNS name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  host_config_id: 1                 # numeric host configuration template identifier
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  walle_location:                   # this parameter describes where host is located.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    body: 1                         # string representing a host serial number.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    data_center: &#39;debian-1-88-110&#39;           # string representing the datacenter / availability zone where the host is located.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                    # if cluster is deployed using mirror-3-dc fault tolerance mode, all hosts must be distributed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                    # across 3 datacenters.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    rack: &#39;1&#39;                       # string representing a rack identifier where the host is located.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                    # if cluster is deployed using block-4-2 erasure, all hosts should be distrubited
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                    # accross at least 8 racks.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- host: ubuntu-1-88-111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  host_config_id: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  walle_location:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    body: 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    data_center: &#39;ubuntu-1-88-111&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    rack: &#39;2&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- host: ubuntu-2-88-112
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  host_config_id: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  walle_location:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    body: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    data_center: &#39;ubuntu-2-88-112&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    rack: &#39;3&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">domains_config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # There can be only one root domain in a cluster. Domain name prefixes all scheme objects names, e.g. full name of a table table1 in database db1.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # in a cluster with domains_config.domain.name parameter set to Root would be equal to /Root/db1/table1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  domain:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    storage_pool_types:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kind: nvme
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      pool_config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        box_id: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # fault tolerance mode name - none, block-4-2, or mirror-3-dc..
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # See docs for more details https://ydb.tech/en/docs/deploy/configuration/config#domains-blob
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        erasure_species: mirror-3-dc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        kind: nvme
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        geometry:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          realm_level_begin: 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          realm_level_end: 20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          domain_level_begin: 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          domain_level_end: 256
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        pdisk_filter:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - property:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - type: NVME  # device type to match host_configs.drive.type
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vdisk_kind: Default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  state_storage:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - ring:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      node: [1, 2, 3]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      nto_select: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ssid: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">table_service_config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  sql_version: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">actor_system_config:          # the configuration of the actor system which descibes how cores of the instance are distributed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  executor:                   # accross different types of workloads in the instance.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: System              # system executor of the actor system. in this executor YDB launches system type of workloads, like system tablets
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                              # and reads from storage.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    threads: 2                # the number of threads allocated to system executor.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: BASIC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: User                # user executor of the actor system. In this executor YDB launches user workloads, like datashard activities,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                              # queries and rpc calls.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    threads: 3                # the number of threads allocated to user executor.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: BASIC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Batch               # user executor of the actor system. In this executor YDB launches batch operations, like scan queries, table
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                              # compactions, background compactions.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    threads: 2                # the number of threads allocated to the batch executor.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: BASIC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: IO                  # the io executor. In this executor launches sync operations and writes logs.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    threads: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    time_per_mailbox_micro_secs: 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: IO
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: IC                  # the interconnect executor which YDB uses for network communications accross different nodes of the cluster.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    spin_threshold: 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    threads: 1                # the number of threads allocated to the interconnect executor.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    time_per_mailbox_micro_secs: 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: BASIC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  scheduler:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    progress_threshold: 10000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    resolution: 256
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    spin_threshold: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">blob_storage_config:         # configuration of static blobstorage group.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                             # YDB uses this group to store system tablets&#39; data, like SchemeShard
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  service_set:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    groups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - erasure_species: mirror-3-dc # fault tolerance mode name for the static group
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      rings:          # in mirror-3-dc must have exactly 3 rings or availability zones
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - fail_domains:  # first record: fail domains of the static group describe where each vdisk of the static group should be located.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: debian-1-88-110
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: debian-1-88-110
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: debian-1-88-110
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_03
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - fail_domains: # second ring: fail domains of the static group describe where each vdisk of the static group should be located.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: ubuntu-1-88-111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: ubuntu-1-88-111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: ubuntu-1-88-111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_03
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - fail_domains: # third ring: fail domains of the static group describe where each vdisk of the static group should be located.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: ubuntu-2-88-112
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: ubuntu-2-88-112
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: ubuntu-2-88-112
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_03
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel_profile_config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  profile:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - channel:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - erasure_species: mirror-3-dc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      pdisk_category: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      storage_pool_kind: nvme
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - erasure_species: mirror-3-dc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      pdisk_category: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      storage_pool_kind: nvme
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - erasure_species: mirror-3-dc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      pdisk_category: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      storage_pool_kind: nvme
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    profile_id: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">interconnect_config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    start_tcp: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    encryption_mode: OPTIONAL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    path_to_certificate_file: &#34;/opt/ydb/certs/node.crt&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    path_to_private_key_file: &#34;/opt/ydb/certs/node.key&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    path_to_ca_file: &#34;/opt/ydb/certs/ca.crt&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">grpc_config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    cert: &#34;/opt/ydb/certs/node.crt&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    key: &#34;/opt/ydb/certs/node.key&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ca: &#34;/opt/ydb/certs/ca.crt&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="å¯åŠ¨æ•°æ®åº“é™æ€èŠ‚ç‚¹">å¯åŠ¨æ•°æ®åº“é™æ€èŠ‚ç‚¹</h3>
<h4 id="æ‰‹åŠ¨æ–¹å¼å¯åŠ¨">æ‰‹åŠ¨æ–¹å¼å¯åŠ¨</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å¯åŠ¨<code>/Root/testdb</code>æ•°æ®åº“çš„<code>YDB</code>åŠ¨æ€èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>&lt;nodeN.ydb.tech&gt;</code><!-- raw HTML omitted -->è¿è¡Œé™æ€èŠ‚ç‚¹çš„æœåŠ¡å™¨çš„<code>FQDN</code>åœ¨å“ªé‡Œ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šè¿è¡Œé¢å¤–çš„åŠ¨æ€èŠ‚ç‚¹ä»¥ç¡®ä¿æ•°æ®åº“å¯ç”¨æ€§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo su - ydb
</span></span><span style="display:flex;"><span>$ cd /opt/ydb
</span></span><span style="display:flex;"><span>$ export LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib
</span></span><span style="display:flex;"><span>/opt/ydb/bin/ydbd server --log-level <span style="color:#ae81ff">3</span> --tcp --yaml-config /opt/ydb/cfg/config.yaml --grpc-port <span style="color:#ae81ff">2135</span> --ic-port <span style="color:#ae81ff">19001</span> --mon-port <span style="color:#ae81ff">8765</span> --node static &gt;/opt/ydb/log/static-node.out 2&gt;/opt/ydb/log/static-node.err &amp;&gt;</span></span></code></pre></div></blockquote>
<hr>
<h4 id="ä½¿ç”¨systemdæ–¹å¼å¯åŠ¨">ä½¿ç”¨<code>systemd</code>æ–¹å¼å¯åŠ¨</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>/etc/systemd/system/ydbd-storage.service</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/systemd/system/ydbd-storage.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=YDB storage node
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network-online.target rc-local.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Wants=network-online.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StartLimitInterval=10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StartLimitBurst=15
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RestartSec=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">User=ydb  	# æ ¹æ®ç”¨æˆ·ä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PermissionsStartOnly=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StandardOutput=/var/log/ydb.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StandardError=/var/log/ydb.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogIdentifier=ydbd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogFacility=daemon
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogLevel=err
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Environment=LD_LIBRARY_PATH=/opt/ydb/lib
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/ydb/bin/ydbd server --log-level 3 --syslog --tcp --yaml-config  /opt/ydb/cfg/config.yaml --grpc-port 2135 --ic-port 19001 --mon-port 8765 --node static
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitCORE=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitMEMLOCK=3221225472
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯åŠ¨æœåŠ¡å™¨ã€æŸ¥çœ‹çŠ¶æ€<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo systemctl start ydbd-storage
</span></span><span style="display:flex;"><span>$ sudo systemctl status ydbd-storage</span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆå§‹åŒ–é›†ç¾¤">åˆå§‹åŒ–é›†ç¾¤</h3>
<h4 id="ä¸ä½¿ç”¨èº«ä»½éªŒè¯æ–¹å¼åˆå§‹åŒ–é›†ç¾¤">ä¸ä½¿ç”¨èº«ä»½éªŒè¯æ–¹å¼åˆå§‹åŒ–é›†ç¾¤</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœ¨å…¶ä¸­ä¸€ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šï¼Œè¿è¡Œå‘½ä»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib
</span></span><span style="display:flex;"><span>/opt/ydb/bin/ydbd admin blobstorage config init --yaml-file  /opt/ydb/cfg/config.yaml
</span></span><span style="display:flex;"><span>$ echo $?</span></span></code></pre></div></blockquote>
<hr>
<h4 id="ä½¿ç”¨èº«ä»½éªŒè¯æ–¹å¼åˆå§‹åŒ–é›†ç¾¤">ä½¿ç”¨èº«ä»½éªŒè¯æ–¹å¼åˆå§‹åŒ–é›†ç¾¤</h4>
<blockquote>
<p>è¦åœ¨å¯ç”¨ç”¨æˆ·è®¤è¯æ¨¡å¼çš„é›†ç¾¤ä¸­æ‰§è¡Œç®¡ç†å‘½ä»¤ï¼ˆåŒ…æ‹¬é›†ç¾¤åˆå§‹åŒ–ã€æ•°æ®åº“åˆ›å»ºã€ç£ç›˜ç®¡ç†ç­‰ï¼‰ï¼Œæ‚¨å¿…é¡»é¦–å…ˆä½¿ç”¨<code>YDB CLI</code>å®¢æˆ·ç«¯<code>2.0.0</code>æˆ–æ›´é«˜ç‰ˆæœ¬è·å–è®¤è¯ä»¤ç‰Œã€‚<a href="https://ydb.tech/en/docs/reference/ydb-cli/install" rel="external" target="_self">æ‚¨å¿…é¡»æŒ‰ç…§å®‰è£…è¯´æ˜</a>å°†<code>YDB CLI</code>å®¢æˆ·ç«¯å®‰è£…åœ¨ä»»ä½•å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®é›†ç¾¤èŠ‚ç‚¹çš„è®¡ç®—æœºä¸Šï¼ˆä¾‹å¦‚ï¼Œåœ¨å…¶ä¸­ä¸€ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šï¼‰ã€‚</p>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç¬¬ä¸€æ¬¡å®‰è£…é›†ç¾¤æ—¶ï¼Œå®ƒåªæœ‰ä¸€ä¸ª<code>root</code>å¯†ç ä¸ºç©ºçš„å¸æˆ·ï¼Œå› æ­¤è·å–ä»¤ç‰Œçš„å‘½ä»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä»»ä½•é›†ç¾¤æœåŠ¡å™¨éƒ½å¯ä»¥æŒ‡å®šä¸ºè¿æ¥æœåŠ¡å™¨ï¼ˆ<code>-e</code>æˆ–<code>--endpoint</code>å‚æ•°ï¼‰<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpc://&lt;node1.ydb.tech&gt;:2135 -d /Root --user root --no-password auth get-token --force &gt;token-file</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¦‚æœå¯ç”¨äº†<!-- raw HTML omitted --><code>TLS</code>æµé‡ä¿æŠ¤ï¼Œè¯·ä½¿ç”¨å—ä¿æŠ¤çš„<code>grpcs</code>åè®®è€Œä¸æ˜¯<code>grpc</code>ä¸Šé¢å‘½ä»¤ä¸­çš„åè®®ï¼Œå¹¶åœ¨å‚æ•°ä¸­é¢å¤–æŒ‡å®š<code>CA</code>è¯ä¹¦çš„è·¯å¾„<code>--ca-file</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpcs://&lt;node1.ydb.tech&gt;:2135 -d /Root --ca-file /opt/ydb/certs/ca.crt --user root --no-password auth get-token --force &gt;token-file</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œèº«ä»½éªŒè¯ä»¤ç‰Œå°†è¢«å†™å…¥<code>token-file</code>. åªéœ€è¦å°†æ­¤æ–‡ä»¶å¤åˆ¶åˆ°ç¨åè¦è¿è¡Œé›†ç¾¤åˆå§‹åŒ–å’Œæ•°æ®åº“åˆ›å»ºå‘½ä»¤çš„é›†ç¾¤èŠ‚ç‚¹ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨æ­¤é›†ç¾¤èŠ‚ç‚¹ä¸Šè¿è¡Œå‘½ä»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib
</span></span><span style="display:flex;"><span>/opt/ydb/bin/ydbd -f token-file admin blobstorage config init --yaml-file  /opt/ydb/cfg/config.yaml
</span></span><span style="display:flex;"><span>$ echo $?</span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆ›å»ºæ•°æ®åº“">åˆ›å»ºæ•°æ®åº“</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è¦ä½¿ç”¨è¡¨ï¼Œæ‚¨éœ€è¦è‡³å°‘åˆ›å»ºä¸€ä¸ªæ•°æ®åº“å¹¶è¿è¡Œä¸€ä¸ªè¿›ç¨‹æ¥ä¸ºè¯¥æ•°æ®åº“æä¾›æœåŠ¡ï¼ˆåŠ¨æ€èŠ‚ç‚¹ï¼‰ä¸ä½¿ç”¨ä»¤ç‰Œ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>/Root</code><!-- raw HTML omitted -->: æ ¹åŸŸçš„åç§°ï¼Œå¿…é¡»ä¸<!-- raw HTML omitted --><code>domains_config</code>. <code>domain</code>. <code>name</code><!-- raw HTML omitted -->åœ¨é›†ç¾¤é…ç½®æ–‡ä»¶ä¸­è®¾ç½®<!-- raw HTML omitted --></li>
<li><code>testdb</code><!-- raw HTML omitted -->: åˆ›å»ºçš„æ•°æ®åº“åç§°<!-- raw HTML omitted --></li>
<li><code>ssd:1</code><!-- raw HTML omitted -->ï¼šå­˜å‚¨æ± çš„åç§°å’Œæ± ä¸­å—çš„ç¼–å·ã€‚æ± åç§°é€šå¸¸è¡¨ç¤ºæ•°æ®å­˜å‚¨è®¾å¤‡çš„ç±»å‹ï¼Œå¹¶ä¸”å¿…é¡»ä¸<!-- raw HTML omitted --><code>storage_pool_types</code>. <code>kind</code><!-- raw HTML omitted -->é‡Œé¢çš„è®¾ç½®<!-- raw HTML omitted --><code>domains_config</code>ã€‚<code>domain</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶çš„å…ƒç´ <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib /opt/ydb/bin/ydbd admin database /Root/testdb create ssd:1</span></span></code></pre></div><ul>
<li>
<p><!-- raw HTML omitted -->ä½¿ç”¨ä»¤ç‰Œæ–‡ä»¶çš„æ•°æ®åº“åˆ›å»ºå‘½ä»¤<!-- raw HTML omitted --></p>
<p>å¦‚æœåœ¨é›†ç¾¤ä¸­å¯ç”¨äº†ç”¨æˆ·è®¤è¯æ¨¡å¼ï¼Œåˆ™å¿…é¡»å°†è®¤è¯ä»¤ç‰Œä¼ é€’ç»™æ•°æ®åº“åˆ›å»ºå‘½ä»¤ã€‚<a href="https://ydb.tech/en/docs/deploy/manual/deploy-ydb-on-premises#initialize-cluster" rel="external" target="_self">é›†ç¾¤åˆå§‹åŒ–</a>éƒ¨åˆ†æè¿°äº†è·å–ä»¤ç‰Œçš„è¿‡ç¨‹</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib /opt/ydb/bin/ydbd -f token-file admin database /Root/testdb create ssd:1</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å¯åŠ¨æ•°æ®åº“åŠ¨æ€èŠ‚ç‚¹">å¯åŠ¨æ•°æ®åº“åŠ¨æ€èŠ‚ç‚¹</h3>
<h4 id="æ‰‹åŠ¨æ–¹å¼å¯åŠ¨-1">æ‰‹åŠ¨æ–¹å¼å¯åŠ¨</h4>
<ul>
<li>
<ol>
<li>å¯åŠ¨<code>/Root/testdb</code><!-- raw HTML omitted -->æ•°æ®åº“çš„<code>YDB</code>åŠ¨æ€èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>&lt;nodeN.ydb.tech&gt;</code><!-- raw HTML omitted -->è¿è¡Œé™æ€èŠ‚ç‚¹çš„æœåŠ¡å™¨çš„<code>FQDN</code>åœ¨å“ªé‡Œ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šè¿è¡Œé¢å¤–çš„åŠ¨æ€èŠ‚ç‚¹ä»¥ç¡®ä¿æ•°æ®åº“å¯ç”¨æ€§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo su - ydb
</span></span><span style="display:flex;"><span>$ cd /opt/ydb
</span></span><span style="display:flex;"><span>$ export LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib
</span></span><span style="display:flex;"><span>/opt/ydb/bin/ydbd server --grpc-port <span style="color:#ae81ff">2136</span> --ic-port <span style="color:#ae81ff">19002</span> --mon-port <span style="color:#ae81ff">8766</span> --yaml-config  /opt/ydb/cfg/config.yaml --tenant /Root/testdb --node-broker &lt;node1.ydb.tech&gt;:2135 --node-broker &lt;node2.ydb.tech&gt;:2135 --node-broker &lt;node3.ydb.tech&gt;:2135</span></span></code></pre></div></blockquote>
<hr>
<h4 id="ä½¿ç”¨systemdæ–¹å¼å¯åŠ¨-1">ä½¿ç”¨<code>Systemd</code>æ–¹å¼å¯åŠ¨</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»ºä¸€ä¸ªåä¸º<!-- raw HTML omitted --><code>/etc/systemd/system/ydbd-testdb.service</code><!-- raw HTML omitted -->ä»¥ä¸‹å†…å®¹çš„é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/systemd/system/ydbd-testdb.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=YDB testdb dynamic node
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network-online.target rc-local.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Wants=network-online.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StartLimitInterval=10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StartLimitBurst=15
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RestartSec=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">User=ydb
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PermissionsStartOnly=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StandardOutput=syslog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StandardError=syslog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogIdentifier=ydbd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogFacility=daemon
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogLevel=err
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Environment=LD_LIBRARY_PATH=/opt/ydb/lib
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/ydb/bin/ydbd server --grpc-port 2136 --ic-port 19002 --mon-port 8766 --yaml-config  /opt/ydb/cfg/config.yaml --tenant /Root/testdb --node-broker &lt;node1.ydb.tech&gt;:2135 --node-broker &lt;node2.ydb.tech&gt;:2135 --node-broker &lt;node3.ydb.tech&gt;:2135
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitCORE=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitMEMLOCK=32212254720
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>å¯åŠ¨<code>/Root/testdb</code><!-- raw HTML omitted -->æ•°æ®åº“çš„<code>YDB</code>åŠ¨æ€èŠ‚ç‚¹<!-- raw HTML omitted --><!-- raw HTML omitted -->åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šè¿è¡Œé¢å¤–çš„åŠ¨æ€èŠ‚ç‚¹ä»¥ç¡®ä¿æ•°æ®åº“å¯ç”¨æ€§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo systemctl start ydbd-testdb</span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆå§‹å¸æˆ·è®¾ç½®">åˆå§‹å¸æˆ·è®¾ç½®</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœ¨é›†ç¾¤é…ç½®æ–‡ä»¶ä¸­å¯ç”¨äº†èº«ä»½éªŒè¯æ¨¡å¼ï¼Œåˆ™å¿…é¡»åœ¨ä½¿ç”¨<code>YDB</code>é›†ç¾¤ä¹‹å‰å®Œæˆåˆå§‹å¸æˆ·è®¾ç½®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><code>YDB</code>é›†ç¾¤çš„åˆå§‹å®‰è£…ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>root</code>å¯†ç ä¸ºç©ºçš„å¸æˆ·ï¼Œä»¥åŠ<a href="https://ydb.tech/en/docs/cluster/access" rel="external" target="_self">è®¿é—®ç®¡ç†</a>éƒ¨åˆ†ä¸­æè¿°çš„ä¸€ç»„æ ‡å‡†ç”¨æˆ·ç»„</p>
</li>
<li>
<p>è¦åœ¨åˆ›å»ºçš„<code>YDB</code>é›†ç¾¤ä¸­æ‰§è¡Œåˆå§‹å¸æˆ·è®¾ç½®ï¼Œ<a href="https://ydb.tech/en/docs/reference/ydb-cli/install" rel="external" target="_self">æŒ‰ç…§æ–‡æ¡£</a>ä¸­çš„æè¿°å®‰è£…<code>YDB CLI</code></p>
</li>
<li>
<p><code>&lt;node.ydb.tech&gt;</code>æ˜¯è¿è¡Œæ”¯æŒ<code>/Root/testdb</code>æ•°æ®åº“çš„åŠ¨æ€èŠ‚ç‚¹çš„æœåŠ¡å™¨çš„<code>FQDN</code></p>
</li>
<li>
<p>åœ¨è¿è¡Œå¸æˆ·åˆ›å»ºå’Œç»„åˆ†é…å‘½ä»¤æ—¶ï¼Œ<code>YDB CLI</code>å®¢æˆ·ç«¯å°†è¯·æ±‚<code>root</code>ç”¨æˆ·å¯†ç ã€‚<a href="https://ydb.tech/en/docs/reference/ydb-cli/profile/" rel="external" target="_self">æ‚¨å¯ä»¥æŒ‰ç…§<code>YDB CLI</code>æ–‡æ¡£</a>ä¸­çš„è¯´æ˜åˆ›å»ºè¿æ¥é…ç½®æ–‡ä»¶ï¼Œä»è€Œé¿å…è¾“å…¥å¤šä¸ªå¯†ç </p>
</li>
<li>
<p>å¦‚æœé›†ç¾¤ä¸­å¯ç”¨äº†<code>TLS</code>æµé‡ä¿æŠ¤ï¼Œè¯·ä½¿ç”¨å—ä¿æŠ¤çš„<code>grpcs</code>åè®®è€Œä¸æ˜¯<code>grpc</code>ä¸Šé¢å‘½ä»¤ä¸­çš„åè®®ï¼Œå¹¶åœ¨å‚æ•°ä¸­æŒ‡å®š<code>CA</code>è¯ä¹¦çš„è·¯å¾„<code>--ca-file</code>ï¼ˆæˆ–å°†å…¶ä¿å­˜åœ¨è¿æ¥é…ç½®æ–‡ä»¶ä¸­ï¼‰</p>
</li>
<li>
<p><code>root</code><!-- raw HTML omitted -->ä¸ºè´¦æˆ·è®¾ç½®å¯†ç <!-- raw HTML omitted --></p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpc://&lt;node.ydb.tech&gt;:2136 -d /Root/testdb --user root --no-password yql -s <span style="color:#e6db74">&#39;ALTER USER root PASSWORD &#34;passw0rd&#34;&#39;</span>  	<span style="color:#75715e"># å°†passw0rdå€¼æ›¿æ¢ä¸ºè‡ªå·±å®šä¹‰å¯†ç   </span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºå…¶ä»–å¸æˆ·<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpc://&lt;node.ydb.tech&gt;:2136 -d /Root/testdb --user root yql -s <span style="color:#e6db74">&#39;CREATE USER user1 PASSWORD &#34;passw0rd&#34;&#39;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é€šè¿‡å°†å®ƒä»¬åŒ…å«åœ¨é›†æˆç»„ä¸­æ¥è®¾ç½®å¸æˆ·æƒé™<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpc://&lt;node.ydb.tech&gt;:2136 -d /Root/testdb --user root yql -s <span style="color:#e6db74">&#39;ALTER GROUP `ADMINS` ADD USER user1&#39;</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="æµ‹è¯•åˆ›å»ºçš„æ•°æ®åº“">æµ‹è¯•åˆ›å»ºçš„æ•°æ®åº“</h3>
<ul>
<li>
<ol>
<li><a href="https://ydb.tech/en/docs/reference/ydb-cli/install" rel="external" target="_self">æŒ‰ç…§æ–‡æ¡£</a>ä¸­çš„æè¿°å®‰è£…<code>YDB CLI</code>ï¼Œåˆ›å»ºä¸€ä¸ª<code>test_table</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>&lt;node.ydb.tech&gt;</code>è¿è¡Œæ”¯æŒ<code>/Root/testdb</code>æ•°æ®åº“çš„åŠ¨æ€èŠ‚ç‚¹çš„æœåŠ¡å™¨çš„<code>FQDN</code>åœ¨å“ªé‡Œ</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpc://&lt;node.ydb.tech&gt;:2136 -d /Root/testdb scripting yql --script <span style="color:#e6db74">&#39;CREATE TABLE `testdir/test_table` (id Uint64, title Utf8, PRIMARY KEY (id));&#39;</span></span></span></code></pre></div><ul>
<li>é›†ç¾¤å¼€å¯äº†<code>TLS</code>æµé‡ä¿æŠ¤æˆ–ç”¨æˆ·è®¤è¯æ–¹å¼</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpcs://&lt;node.ydb.tech&gt;:2136 -d /Root/testdb --ca-file ydb-ca.crt --user root scripting yql --script <span style="color:#e6db74">&#39;CREATE TABLE `testdir/test_table` (id Uint64, title Utf8, PRIMARY KEY (id));&#39;</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_postgresql">Install_PostgreSQL</h1>

<h2 id="å®‰è£…postgresqlæ•°æ®åº“">å®‰è£…<code>PostgreSQL</code>æ•°æ®åº“</h2>
<ul>
<li>
<ol>
<li><a href="https://www.postgresql.org/ftp/source/" rel="external" target="_self"><code>PostgreSQL</code></a>ã€<a href="https://download.postgresql.org/pub/" rel="external" target="_self"><code>Download-PostgreSQL</code></a>ã€<a href="https://ftp.postgresql.org/pub/" rel="external" target="_self"><code>FTP-PostgreSQL</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install c++ gcc-c++ readline-devel zlib-devel
</span></span><span style="display:flex;"><span>$ curl -o /usr/local/src/postgresql-15.0.tar.gz  https://ftp.postgresql.org/pub/source/v15.0/postgresql-15.0.tar.gz
</span></span><span style="display:flex;"><span>$ tar -zxvf postgresql-15.0.tar.gz 
</span></span><span style="display:flex;"><span>$ cd postgresql-15.0
</span></span><span style="display:flex;"><span>$ view INSTALL</span></span></code></pre></div><ul>
<li>å®‰è£…</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/postgresql
</span></span><span style="display:flex;"><span>$ make world
</span></span><span style="display:flex;"><span>$ make install-world
</span></span><span style="display:flex;"><span>$ adduser postgres  	<span style="color:#75715e"># åˆ›å»ºç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>$ mkdir -p /usr/local/postgresql/data
</span></span><span style="display:flex;"><span>$ chown -R postgres. /usr/local/postgresql/data
</span></span><span style="display:flex;"><span>$ su - postgres
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆå§‹åŒ–æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ /usr/local/postgresql/bin/initdb -D /usr/local/postgresql/data
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ /usr/local/postgresql/bin/pg_ctl -D /usr/local/postgresql/data -l logfile start</span></span></code></pre></div><ul>
<li>é…ç½®<code>Postgresql</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /usr/local/postgresql/data/postgresql.conf
</span></span><span style="display:flex;"><span>listen_addresses <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;192.168.88.0/24&#39;</span>  	<span style="color:#75715e"># å¼€å¯è¿œç¨‹è®¿é—®  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vim /usr/local/postgresql/data/pg_hba.conf
</span></span><span style="display:flex;"><span><span style="color:#75715e"># IPv4 local connections:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿¡ä»»è¿œç¨‹è¿æ¥,ä¿®æ”¹å¦‚ä¸‹å†…å®¹ï¼Œä¿¡ä»»æŒ‡å®šæœåŠ¡å™¨è¿æ¥,identä¿®æ”¹ä¸ºMD5</span>
</span></span><span style="display:flex;"><span>host    all            all      127.0.0.1/32      md5
</span></span><span style="display:flex;"><span>host    all            all      10.1.8.0/24        md5</span></span></code></pre></div><ul>
<li>ä½¿ç”¨<code>PostgreSQL</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ su - postgres  	<span style="color:#75715e"># åˆ‡æ¢è¿›å»</span>
</span></span><span style="display:flex;"><span>$ psql  	<span style="color:#75715e"># è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#ae81ff">\l</span>  	<span style="color:#75715e"># åˆ—å‡ºæ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#ae81ff">\d</span>u  	<span style="color:#75715e"># åˆ—å‡ºç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#ae81ff">\c</span> mydb  	<span style="color:#75715e"># è¿›å…¥æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‡å®šæ•°æ®åº“åä¸ºgerericdb</span>
</span></span><span style="display:flex;"><span>$ /opt/pgsql/bin/createdb genericdb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥æ•°æ®åº“å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>$ /opt/pgsql/bin/psql genericdb</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_otter">Install_Otter</h1>

<h2 id="otteræ•°æ®æ¬è¿"><code>Otter</code>æ•°æ®æ¬è¿</h2>
<blockquote>
<ul>
<li><a href="https://github.com/alibaba/otter" rel="external" target="_self"><code>Otter</code></a></li>
</ul>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_mysql_pxc">Install_Mysql_PXC</h1>

<h2 id="å®‰è£…mysql-pxc">å®‰è£…<code>Mysql-PXC</code></h2>
<blockquote>
<ul>
<li><a href="https://blog.51cto.com/sumongodb/1956086" rel="external" target="_self">ä¼ä¸šä¸»æµ<code>MySQL</code>é«˜å¯ç”¨é›†ç¾¤æ¶æ„ä¸‰éƒ¨æ›²ä¹‹<code>PXC</code></a></li>
<li><a href="https://www.percona.com/doc/percona-xtradb-cluster/LATEST/install/docker.html" rel="external" target="_self">åœ¨<code>Docker</code>å®¹å™¨ä¸­è¿è¡Œ<code>Percona XtraDB</code>é›†ç¾¤</a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><code>docker</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Mysql-PXC</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;install-mysql-pxc.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo yum -y remove docker \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-client \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-client-latest \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-common \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-latest 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-latest-logrotate 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-logrotate \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-engine  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo yum install -y yum-utils
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo yum-config-manager --add-repo \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">https://download.docker.com/linux/centos/docker-ce.repo  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo yum install -y docker-ce docker-ce-cli containerd.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo systemctl start docker
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo systemctl enable docker
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mkdir -p /opt/data/{data-3306.data-3307,data-3308}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker network create pxc-network  	# åˆ›å»ºç½‘ç»œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker run -i -d -p 3306:3306 -v /etc/localtime:/etc/localtime -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=cluster1 --name=node1 --privileged=true --net=pxc-network percona/percona-xtradb-cluster:5.7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 15
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker run -i -d -p 3307:3306 -v /etc/localtime:/etc/localtime -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=cluster1 -e CLUSTER_JOIN=node1 --name=node2 --privileged=true --net=pxc-network percona/percona-xtradb-cluster:5.7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker run -i -d -p 3308:3306 -v /etc/localtime:/etc/localtime -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=cluster1 -e CLUSTER_JOIN=node1 --name=node3 --privileged=true --net=pxc-network percona/percona-xtradb-cluster:5.7  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker exec -it node1 /usr/bin/mysql -uroot -proot -e &#34;show status like &#39;wsrep%&#39;;&#34;  	# ç™»å½•æ•°æ®åº“æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€, ä¿®æ”¹å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># show status like &#39;wsrep%&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>Yum</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>PXC</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->æœ€å°‘å‡†å¤‡ä¸‰å°æœåŠ¡å™¨ï¼Œåœ¨ä¸‰å°æœåŠ¡å™¨ä¸ŠåŒæ­¥æ‰§è¡Œå‘½ä»¤<!-- raw HTML omitted --></p>
</li>
<li>
<p><!-- raw HTML omitted -->å…ˆå¸è½½ç³»ç»Ÿè‡ªå¸¦æ•°æ®åº“ï¼Œé˜²ç«å¢™å¼€æ”¾åŒæ­¥ç«¯å£ï¼š<!-- raw HTML omitted -->4567<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;pxc-install.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum -y remove mariadb* 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum install -y https://repo.percona.com/yum/percona-release-latest.noarch.rpm  	# å®‰è£… PXC çš„ Yum æº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum install Percona-XtraDB-Cluster-57 -y  	# å®‰è£… PXC æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">systemctl enable mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">systemctl start mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pass=`grep &#34;temporary password&#34; /var/log/mysqld.log |awk &#39;{print $11}&#39;` 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=`openssl rand -base64 14`  	# ç”Ÿæˆéšå³å¯†ç   
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mysql -uroot -p$pass -e &#34;alter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;$password&#39;;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mysql -uroot -p$password -e &#34; flush privileges;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å…³é—­æ‰€æœ‰èŠ‚ç‚¹æ•°æ®åº“ã€å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl stop mysql</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>my.cnf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/my.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[mysqld]  	# å¿…é¡»å®šä¹‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">!includedir /etc/my.cnf.d/  	# åŸæœ‰ä¸åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">!includedir /etc/percona-xtradb-cluster.conf.d/  	# åŸæœ‰ä¸åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_provider=/usr/lib64/galera3/libgalera_smm.so  	# æä¾›ç¨‹åºçš„è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_cluster_name=pxc-cluster  	# å®šä¹‰çš„é›†ç¾¤åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_cluster_address=gcomm://192.168.2.11,192.168.2.12,192.168.2.13  # æ‰€æœ‰çš„é›†ç¾¤èŠ‚ç‚¹IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_node_name=pxc1  	# å®šä¹‰æœ¬æœºçš„åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_node_address=192.168.2.11  	# å®šä¹‰æœ¬æœºIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_sst_method=xtrabackup-v2  	# åŒæ­¥æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_sst_auth=sstuser:password  	# æä¾›åŒæ­¥å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pxc_strict_mode=ENFORCING  	# ä¸¥æ ¼æ¨¡å¼(å¼ºåˆ¶æ‰§è¡Œ)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">binlog_format=ROW  	# è¡Œæ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_storage_engine=InnoDB  	# é»˜è®¤å­˜å‚¨å¼•æ“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">innodb_autoinc_lock_mode=2  	# è‡ªå¢é”å®šæ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å…ˆå¯åŠ¨ä¸»èŠ‚ç‚¹ï¼Œç¡®ä¿ä¸»åº“æ•°æ®åŒæ­¥åˆ°å…¶ä»–ä»èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>wsrep_cluster_size=1</code>è¡¨ç¤ºé›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ å·²ç»è¿æ¥å¹¶ä¸”çŠ¶æ€æ—¶<code>primary</code>éšæ—¶å†™å…¥æ•°æ®åˆ°é›†ç¾¤ï¼Œå†åŠ å…¥å…¶ä»–ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹å‰ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªSSTï¼ˆState Snapshot Transferï¼‰è´¦å·ç”¨äºé›†ç¾¤é—´é€šä¿¡ï¼Œå¿…é¡»å’Œä¸»æœº<code>my.cnf</code>é…ç½®çš„å‚æ•°ä¸€è‡´</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl restart mysql@bootstrap.service
</span></span><span style="display:flex;"><span>$ mysql -uroot -p$password -e <span style="color:#e6db74">&#34;show status like &#39;wsrep%&#39;;&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ ç”¨æˆ·å¹¶ä¸”èµ‹äºˆæƒé™ <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysql -uroot -p$password -e <span style="color:#e6db74">&#34;CREATE USER &#39;sstuser&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;password&#39;;&#34;</span>  
</span></span><span style="display:flex;"><span>$ mysql -uroot -p$password -e <span style="color:#e6db74">&#34;GRANT RELOAD, LOCK TABLES, PROCESS, REPLICATION CLIENT ON *.* TO &#39;sstuser&#39;@&#39;localhost&#39;;&#34;</span>
</span></span><span style="display:flex;"><span>$ mysql -uroot -p$password -e <span style="color:#e6db74">&#34;FLUSH PRIVILEGES;&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åœ¨ä»èŠ‚ç‚¹ä¾æ¬¡å¯åŠ¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>PXC</code><!-- raw HTML omitted -->å¯¼å‡ºæ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqldump -uroot -p --skip_add_locks --skip-lock-tables  LY_report  &gt; /root/LY_report<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>.sql</span></span></code></pre></div><ul>
<li><a href="http://www.dboracle.com/archivers/%E5%BC%BA%E8%A1%8C%E5%85%B3%E6%9C%BA%E4%B9%8B%E5%90%8E%EF%BC%8Cpercona-xtradb-cluster%E9%9B%86%E7%BE%A4%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8.html" rel="external" target="_self">å¼ºè¡Œå…³æœºä¹‹åï¼Œ<code>PERCONA XTRADB CLUSTER</code>é›†ç¾¤æ— æ³•å¯åŠ¨</a></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>grastate.dat</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/var/lib/mysql/grastate.dat<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># GALERA saved state
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">version: 2.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">uuid:    8050b2ae-5de7-11ea-b72e-1b7d1643b17c
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">seqno:   975
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">safe_to_bootstrap: 0  	# æ­¤å€¼å¤§çš„å…ˆå¯åŠ¨ã€å¦‚æœéƒ½æ˜¯ 0ï¼Œæ‰¾ä¸ªä¿®æ”¹æˆ 1 å³å¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>4.1.2 <!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /etc/percona-xtradb-cluster.conf.d/my.cnf  
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>client<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>socket<span style="color:#f92672">=</span>/var/lib/mysql/mysql.sock
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysql<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>prompt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\u@db2 \R:\m:\s [\d]&gt; &#34;</span>
</span></span><span style="display:flex;"><span>no-auto-rehash
</span></span><span style="display:flex;"><span>server-id<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># server-idæ¯ä¸ªæœåŠ¡å™¨å”¯ä¸€</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿™é‡Œå®šä¹‰æ•°æ®ç›®å½•å’Œæ—¥å¿—ç›®å½•</span>
</span></span><span style="display:flex;"><span>datadir<span style="color:#f92672">=</span>/var/lib/mysql
</span></span><span style="display:flex;"><span>socket<span style="color:#f92672">=</span>/var/lib/mysql/mysql.sock
</span></span><span style="display:flex;"><span>log-error<span style="color:#f92672">=</span>/var/log/mysqld.log
</span></span><span style="display:flex;"><span>pid-file<span style="color:#f92672">=</span>/var/run/mysqld/mysqld.pid
</span></span><span style="display:flex;"><span>log-bin <span style="color:#f92672">=</span> /var/lib/mysql/mybinlog
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>log_slave_updates
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bind-address <span style="color:#f92672">=</span> 0.0.0.0  	<span style="color:#75715e"># ç›‘å¬åœ°å€</span>
</span></span><span style="display:flex;"><span>port <span style="color:#f92672">=</span> <span style="color:#ae81ff">3306</span>  	<span style="color:#75715e"># ç›‘å¬ç«¯å£</span>
</span></span><span style="display:flex;"><span>default_storage_engine<span style="color:#f92672">=</span>InnoDB  	<span style="color:#75715e"># é»˜è®¤æ•°æ®åº“å¼•æ“</span>
</span></span><span style="display:flex;"><span>character-set-server <span style="color:#f92672">=</span> utf8mb4  	<span style="color:#75715e"># å­—ç¬¦é›†</span>
</span></span><span style="display:flex;"><span>collation-server <span style="color:#f92672">=</span> utf8mb4_general_ci  	<span style="color:#75715e"># æ’åºè§„åˆ™</span>
</span></span><span style="display:flex;"><span>max_connections <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>  	<span style="color:#75715e"># æœ€å¤§è¿æ¥æ•°</span>
</span></span><span style="display:flex;"><span>open_files_limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">65535</span>  	<span style="color:#75715e"># é™åˆ¶æ‰“å¼€æ–‡ä»¶æ•°</span>
</span></span><span style="display:flex;"><span>default-time-zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;+8:00&#39;</span>  	<span style="color:#75715e"># é»˜è®¤æ—¶åŒº</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®æ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«</span>
</span></span><span style="display:flex;"><span>transaction_isolation <span style="color:#f92672">=</span> REPEATABLE-READ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®è¶…æ—¶æ—¶é—´</span>
</span></span><span style="display:flex;"><span>interactive_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>wait_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>connect_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>lock_wait_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">3600</span>
</span></span><span style="display:flex;"><span>max_allowed_packet <span style="color:#f92672">=</span> 64M  	<span style="color:#75715e"># é™åˆ¶æ•°æ®åº“æœåŠ¡å™¨æ¥æ”¶æ•°æ®åŒ…çš„å¤§å°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®æ’åºå’Œjoinçš„bufferå¤§å°</span>
</span></span><span style="display:flex;"><span>sort_buffer_size <span style="color:#f92672">=</span> 4M
</span></span><span style="display:flex;"><span>join_buffer_size <span style="color:#f92672">=</span> 4M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®binlog</span>
</span></span><span style="display:flex;"><span>binlog_format<span style="color:#f92672">=</span>ROW
</span></span><span style="display:flex;"><span>expire_logs_days<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¼€å¯binlogæ ¡éªŒåŠŸèƒ½</span>
</span></span><span style="display:flex;"><span>binlog_checksum <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>binlog_cache_size <span style="color:#f92672">=</span> 4M
</span></span><span style="display:flex;"><span>sync_binlog <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æ¯1æ¬¡æäº¤å˜æ›´åç«‹åˆ»å°†binlogè½ç›˜</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®performance_schema</span>
</span></span><span style="display:flex;"><span>performance_schema <span style="color:#f92672">=</span> on
</span></span><span style="display:flex;"><span>performance_schema_instrument <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%memory%=on&#39;</span>
</span></span><span style="display:flex;"><span>performance_schema_instrument <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%lock%=on&#39;</span>
</span></span><span style="display:flex;"><span>skip-external-locking <span style="color:#f92672">=</span> on
</span></span><span style="display:flex;"><span>skip-name-resolve <span style="color:#f92672">=</span> on  	<span style="color:#75715e"># ç¦ç”¨åŸŸåè§£æ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¦ç”¨è½¯é“¾æ¥</span>
</span></span><span style="display:flex;"><span>symbolic-links<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>back_log <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ…¢æ—¥å¿—æŸ¥è¯¢é…ç½®</span>
</span></span><span style="display:flex;"><span>slow_query_log <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>long_query_time <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>slow_query_log_file <span style="color:#f92672">=</span> /var/log/mysqld/slow.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®æ¯ä¸ªEVENTéƒ½è¦æ‰§è¡Œåˆ·ç›˜æ“ä½œ</span>
</span></span><span style="display:flex;"><span>sync_master_info <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>sync_relay_log_info <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>sync_relay_log <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>log_slave_updates <span style="color:#f92672">=</span> on
</span></span><span style="display:flex;"><span>relay_log_recovery <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>relay_log_purge <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>master_info_repository <span style="color:#f92672">=</span> TABLE
</span></span><span style="display:flex;"><span>relay_log_info_repository <span style="color:#f92672">=</span> TABLE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># InnoDBå¼•æ“é…ç½®</span>
</span></span><span style="display:flex;"><span>innodb_file_per_table <span style="color:#f92672">=</span> on
</span></span><span style="display:flex;"><span>innodb_checksums <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_checksum_algorithm <span style="color:#f92672">=</span> crc32
</span></span><span style="display:flex;"><span>innodb_status_file <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_status_output <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_status_output_locks <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_stats_on_metadata <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_open_files <span style="color:#f92672">=</span> <span style="color:#ae81ff">65535</span>
</span></span><span style="display:flex;"><span>innodb_flush_method <span style="color:#f92672">=</span> O_DIRECT
</span></span><span style="display:flex;"><span>innodb_flush_sync <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_flush_neighbors <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¯ä¸ªäº‹åŠ¡æäº¤åç«‹å³åˆ·æ–°binlogæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>innodb_flush_log_at_trx_commit <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_innodb&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_server&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_dml&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_ddl&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_trx&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_os&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_purge&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_log&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_lock&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_buffer&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_index&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_ibuf_system&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_buffer_page&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_adaptive_hash&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SQL modeé…ç½®ï¼Œè¿™é‡Œæ˜¯é»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>sql_mode <span style="color:#f92672">=</span> ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># GTIDé…ç½®</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#gtid_mode = on</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#enforce_gtid_consistency = 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># wsrepé…ç½®</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This changes how InnoDB autoincrement locks are managed and is a requirement for Galera</span>
</span></span><span style="display:flex;"><span>innodb_autoinc_lock_mode<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>wsrep_cluster_name<span style="color:#f92672">=</span>pxc-cluster  	<span style="color:#75715e"># Cluster nameé›†ç¾¤åç§°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>wsrep_cluster_address<span style="color:#f92672">=</span>gcomm://10.14.23.78:4567,10.14.23.180:4567,10.14.23.181:4567
</span></span><span style="display:flex;"><span>wsrep_provider<span style="color:#f92672">=</span>/usr/lib64/galera3/libgalera_smm.so
</span></span><span style="display:flex;"><span><span style="color:#75715e">#If wsrep_node_name is not specified,  then system hostname will be used</span>
</span></span><span style="display:flex;"><span>wsrep_node_name <span style="color:#f92672">=</span> db2
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Slave thread to use</span>
</span></span><span style="display:flex;"><span>wsrep_slave_threads<span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SST method</span>
</span></span><span style="display:flex;"><span>wsrep_sst_method<span style="color:#f92672">=</span>xtrabackup-v2
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Node IP address</span>
</span></span><span style="display:flex;"><span>wsrep_node_address <span style="color:#f92672">=</span> 10.14.23.180
</span></span><span style="display:flex;"><span>wsrep_sst_receive_address <span style="color:#f92672">=</span> 10.14.23.180
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Authentication for SST method</span>
</span></span><span style="display:flex;"><span>wsrep_sst_auth<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sstuser:sstuser_password&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pxc_strict_mode allowed values: DISABLED,PERMISSIVE,ENFORCING,MASTER</span>
</span></span><span style="display:flex;"><span>pxc_strict_mode<span style="color:#f92672">=</span>ENFORCING
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysqld_safe<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>pid-file <span style="color:#f92672">=</span> /var/run/mysqld/mysqld.pid
</span></span><span style="display:flex;"><span>socket   <span style="color:#f92672">=</span> /var/lib/mysql/mysql.sock
</span></span><span style="display:flex;"><span>nice     <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_mysql_router">Install_MySQL_Router</h1>

<h2 id="mysql-router"><code>MySQL Router</code></h2>
<blockquote>
<ul>
<li><code>MySQL Router</code>æ˜¯<code>MySQL</code>å®˜æ–¹æä¾›çš„è·¯ç”±å™¨å’Œè´Ÿè½½å‡è¡¡å™¨</li>
<li>æ”¯æŒåŸºäºè½®è¯¢æˆ–è‡ªåŠ¨æ£€æµ‹åˆ°çš„æœåŠ¡å™¨çŠ¶æ€çš„è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥å°†è¯»å†™è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„<code>MySQL</code>æœåŠ¡å™¨</li>
<li><code>MySQL Router</code>æä¾›äº†ç®€å•çš„é…ç½®å’Œç®¡ç†æ¥å£ï¼Œé€‚åˆ<code>MySQL</code>å®˜æ–¹äº§å“çš„ç¯å¢ƒ</li>
<li><a href="https://dev.mysql.com/doc/mysql-router/8.0/en/" rel="external" target="_self"><code>MySQL Router</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_maxscale">Install_MaxScale</h1>

<h2 id="maxscaleè½»é‡çº§æ•°æ®åº“ä»£ç†"><code>MaxScaleè½»é‡çº§</code>æ•°æ®åº“ä»£ç†</h2>
<blockquote>
<ul>
<li><code>MaxScale</code>æ˜¯<code>MariaDB</code>å¼€å‘çš„ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®åº“ä»£ç†å’Œè·¯ç”±å™¨</li>
<li>æ”¯æŒé«˜çº§çš„æŸ¥è¯¢è·¯ç”±å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼ŒåŒ…æ‹¬è¯»å†™åˆ†ç¦»ã€æ•…éšœåˆ‡æ¢å’Œé«˜å¯ç”¨æ€§</li>
<li><code>MaxScale</code>æä¾›äº†ä¸°å¯Œçš„æ’ä»¶å’Œæ¨¡å—åŒ–æ¶æ„ï¼Œå¯ä»¥è½»æ¾æ‰©å±•å…¶åŠŸèƒ½</li>
<li><a href="https://mariadb.com/kb/en/maxscale/" rel="external" target="_self"><code>MaxScale</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_proxysql">Install_ProxySQL</h1>

<h2 id="proxysqlä»£ç†"><code>ProxySQL</code>ä»£ç†</h2>
<blockquote>
<ul>
<li><code>ProxySQL</code>æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„<code>MySQL</code>ä»£ç†ï¼Œæ”¯æŒæ•°æ®åº“è¿æ¥æ± ã€æŸ¥è¯¢ç¼“å­˜ã€è´Ÿè½½å‡è¡¡å’Œè¯»å†™åˆ†ç¦»</li>
<li>å®ƒå¯ä»¥æ ¹æ®<code>SQL</code>æŸ¥è¯¢ç±»å‹ï¼ˆè¯»æˆ–å†™ï¼‰å°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„<code>MySQL</code>æœåŠ¡å™¨</li>
<li><code>ProxySQL</code>æä¾›äº†ä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è°ƒæ•´è´Ÿè½½å‡è¡¡ç­–ç•¥å’Œè¿æ¥æ± ç®¡ç†</li>
<li><a href="https://proxysql.com/" rel="external" target="_self"><code>ProxySQL</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_manticore_search">Install_Manticore_Search</h1>

<h2 id="manticoresearch"><code>manticoresearch</code></h2>
<blockquote>
<ul>
<li>æ˜“äºä½¿ç”¨çš„å¼€æºå¿«é€Ÿæœç´¢æ•°æ®åº“.</li>
<li><a href="https://manticoresearch.com/" rel="external" target="_self"><code>Manticore Search</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_canal">Install_Canal</h1>

<h2 id="canalæ•°æ®åº“å¢é‡æ—¥å¿—è§£æ"><code>Canal</code>æ•°æ®åº“å¢é‡æ—¥å¿—è§£æ</h2>
<blockquote>
<ul>
<li><a href="https://github.com/alibaba/canal" rel="external" target="_self"><code>Canal</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_mysql">Use_Mysql</h1>

<h1 id="æ•°æ®åº“ä½¿ç”¨">æ•°æ®åº“ä½¿ç”¨</h1>
<h2 id="æ•°æ®ç»“æ„å¯è§†åŒ–">æ•°æ®ç»“æ„å¯è§†åŒ–</h2>
<blockquote>
<ul>
<li><a href="https://www.cs.usfca.edu/~galles/visualization/" rel="external" target="_self">æ•°æ®ç»“æ„å¯è§†åŒ–</a></li>
</ul>
</blockquote>
<hr>
<h2 id="æ•°æ®åº“è¿æ¥å·¥å…·">æ•°æ®åº“è¿æ¥å·¥å…·</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://downloads.mysql.com/archives/workbench/" rel="external" target="_self"><code>WorkBenCh</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://downloads.mysql.com/archives/community/" rel="external" target="_self"><code>MySQL</code>äº§å“æ¡£æ¡ˆ</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://mirrors.cloud.tencent.com/mysql/downloads/MySQL-8.0/" rel="external" target="_self">ä¸‹è½½<code>MySQL-8.0</code>çš„ç´¢å¼•</a></td>
<td></td>
</tr>
<tr>
<td><a href="http://www.notedeep.com/page/282" rel="external" target="_self"><code>Mysql</code>æ·±å…¥å­¦ä¹ ç¬”è®°</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://sqlyog.softonic.cn/" rel="external" target="_self"><code>SQLyog</code>æ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…·</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://dbeaver.io/download/" rel="external" target="_self"><code>DBeaver</code>æ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…·</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/pifeifei/mysql-workbench-zh-cn" rel="external" target="_self"><code>Mysql WorkBenCh</code>èœå•ä¸­æ–‡æ±‰åŒ–</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.jianshu.com/p/4113cd5ef139" rel="external" target="_self"><code>Navicat Premium 15</code>å®‰è£…ä¸æ¿€æ´»</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://learnku.com/articles/67706" rel="external" target="_self"><code>Navicat Premium 16</code>ä¸‹è½½ä¸å®‰è£…ç ´è§£æ•™ç¨‹</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/8.0/en/binary-installation.html" rel="external" target="_self">ä½¿ç”¨é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶åœ¨<code>Unix/Linux </code>å®‰è£…<code>MySQL</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.jianshu.com/p/523c132006aa" rel="external" target="_self"><code>Navicat Premium 15</code>æ°¸ä¹…ç ´è§£æ¿€æ´»å·¥å…·åŠå®‰è£…æ•™ç¨‹</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://atlasgo.io/declarative/inspect" rel="external" target="_self"><code>Atlas</code>é˜¿ç‰¹æ‹‰æ–¯</a></td>
<td><code>Atlas</code>æ˜¯ä¸€æ¬¾ç‹¬ç«‹äºè¯­è¨€çš„å·¥å…·ï¼Œä½¿ç”¨ç°ä»£<code>DevOps</code>åŸåˆ™ç®¡ç†å’Œè¿ç§»æ•°æ®åº“æ¶æ„</td>
</tr>
<tr>
<td><a href="https://github.com/ariga/atlas" rel="external" target="_self"><code>Atlas_Github</code></a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="æ•°æ®åº“å¸¸ç”¨å‘½ä»¤">æ•°æ®åº“å¸¸ç”¨å‘½ä»¤</h2>
<blockquote>
<table>
<thead>
<tr>
<th>æ•°æ®åº“å‘½ä»¤</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>select</code></td>
<td>ä»æ•°æ®åº“ä¸­æå–æ•°æ®</td>
<td>æŸ¥çœ‹ç”¨æˆ·æ•°æ®ï¼š<code>select user,host from mysql.user \G;</code></td>
</tr>
<tr>
<td><code>update</code></td>
<td>æ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®</td>
<td></td>
</tr>
<tr>
<td><code>delete</code></td>
<td>ä»æ•°æ®åº“ä¸­åˆ é™¤æ•°æ®</td>
<td></td>
</tr>
<tr>
<td><code>insert into</code></td>
<td>å‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ®</td>
<td>æ’å…¥æ•°æ®ï¼š<code>insert into tiantian.tt1 values(1,'lisi');</code></td>
</tr>
<tr>
<td><code>create database</code></td>
<td>åˆ›å»ºæ–°æ•°æ®åº“</td>
<td>åˆ›å»ºæ•°æ®åº“ï¼š<code>create database tiantian;</code></td>
</tr>
<tr>
<td><code>alter database</code></td>
<td>æ›´æ”¹æ•°æ®åº“</td>
<td></td>
</tr>
<tr>
<td><code>create table</code></td>
<td>åˆ›å»ºè¡¨</td>
<td>åˆ›å»ºæ•°æ®è¡¨ï¼š<code>create table tiantian.tt1(id int, name varchar(50));</code></td>
</tr>
<tr>
<td><code>alter table</code></td>
<td>æ›´æ”¹è¡¨</td>
<td></td>
</tr>
<tr>
<td><code>drop table</code></td>
<td>åˆ é™¤è¡¨</td>
<td></td>
</tr>
<tr>
<td><code>create index</code></td>
<td>åˆ›å»ºç´¢å¼•(æœç´¢é”®)</td>
<td></td>
</tr>
<tr>
<td><code>drop index</code></td>
<td>åˆ é™¤ç´¢å¼•</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>Where</code>è¯­å¥ä¸­çš„è¿ç®—ç¬¦</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>=</code></td>
<td>ç­‰äº</td>
<td></td>
</tr>
<tr>
<td><code>&lt;&gt;</code></td>
<td>ä¸ç­‰äºï¼šåœ¨<code>SQL</code>çš„ä¸€äº›ç‰ˆæœ¬ä¸­ï¼Œæ”¹æ“ä½œç¬¦è¢«å†™æˆ<code>!=</code></td>
<td></td>
</tr>
<tr>
<td><code>&gt;</code></td>
<td>å¤§äº</td>
<td></td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td>å°äº</td>
<td></td>
</tr>
<tr>
<td><code>&gt;=</code></td>
<td>å¤§äºç­‰äº</td>
<td></td>
</tr>
<tr>
<td><code>&lt;=</code></td>
<td>å°äºç­‰äº</td>
<td></td>
</tr>
<tr>
<td><code>BETWEEN</code></td>
<td>åœ¨æŸä¸ªèŒƒå›´å†…</td>
<td></td>
</tr>
<tr>
<td><code>LIKE</code></td>
<td>æœç´¢æŸç§æ¨¡å¼</td>
<td></td>
</tr>
<tr>
<td><code>IN</code></td>
<td>æŒ‡å®šé’ˆå¯¹æŸä¸ªåˆ—çš„å¤šä¸ªå¯èƒ½å€¼</td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="æŸ¥è¯¢è¿æ¥æ•°">æŸ¥è¯¢è¿æ¥æ•°</h3>
<blockquote>
<ul>
<li>
<!-- raw HTML omitted -->
</li>
<li><strong>æŸ¥çœ‹å½“å‰æ´»åŠ¨çº¿ç¨‹çŠ¶æ€</strong></li>
</ul>
<blockquote>
<ul>
<li><code>Threads_cached</code><!-- raw HTML omitted -->ç¼“å­˜çš„çº¿ç¨‹æ•°é‡ï¼Œè¿™äº›çº¿ç¨‹å¤„äºç¡çœ çŠ¶æ€ä»¥å¤‡å¤ç”¨<!-- raw HTML omitted --></li>
<li><code>Threads_connected</code><!-- raw HTML omitted -->å½“å‰æ‰“å¼€çš„è¿æ¥æ•°<!-- raw HTML omitted --></li>
<li><code>Threads_created</code><!-- raw HTML omitted -->ä¸ºå¤„ç†è¿æ¥è€Œåˆ›å»ºçš„çº¿ç¨‹æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> status <span style="color:#66d9ef">like</span>  <span style="color:#e6db74">&#39;Threads%&#39;</span>; </span></span></code></pre></div><ul>
<li>å¦‚æœ<code>Threads_created</code>å¾ˆå¤§ï¼Œæ‚¨å¯èƒ½éœ€è¦å¢åŠ <code>thread_cache_size</code>çš„å€¼ã€‚ç¼“å­˜å¤±è¯¯ç‡å¯ä»¥é€šè¿‡<code>Threads_created/Connections</code>è®¡ç®—</li>
</ul>
</blockquote>
<ul>
<li><strong>æ˜¾ç¤ºç”¨æˆ·æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> full processlist;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æŸ¥çœ‹æœ€å¤§é“¾æ¥æ•°</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%max_connections%&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸´æ—¶å¢åŠ è¿æ¥æ•°ï¼Œé…ç½®æ–‡ä»¶å¢åŠ å‚æ•°ï¼šmax_connections=4000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> GLOBAL max_connections<span style="color:#f92672">=</span><span style="color:#ae81ff">4000</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æŸ¥çœ‹è¿æ¥çš„ç”¨æˆ·å’Œ</strong><code>IP</code><strong>ä»¥åŠè¶…æ—¶æ—¶é—´</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹è¿æ¥çš„ç”¨æˆ·å’ŒIPä»¥åŠè¶…æ—¶æ—¶é—´ï¼Œæˆ–è€…ä½¿ç”¨ï¼šcount(*) ç»Ÿè®¡æ€»ç»Ÿè¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> information_schema.processlist;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>çœ‹è¿æ¥çš„ç”¨æˆ·å’Œæ¯ä¸ª</strong><code>IP</code><strong>çš„è¿æ¥æ€»æ•°åœ°å€</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">substring_index</span>(host, <span style="color:#e6db74">&#39;:&#39;</span>,<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">AS</span> host_ip,<span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>,db,state,<span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">FROM</span> information_schema.processlist <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> state,host_ip,<span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>,db;</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="æŸ¥è¯¢æ…¢è¯­å¥">æŸ¥è¯¢æ…¢è¯­å¥</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢å ç”¨è¶…æ—¶æ…¢è¯­å¥
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> information_schema.processlist <span style="color:#66d9ef">where</span> Command <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;Sleep&#39;</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">Time</span> <span style="color:#66d9ef">desc</span> <span style="color:#960050;background-color:#1e0010">\</span>G;</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ä¸‰ç§ä¿®æ”¹å¯†ç æ–¹å¼">ä¸‰ç§ä¿®æ”¹å¯†ç æ–¹å¼</h3>
<blockquote>
<ul>
<li><strong>ç¬¬ä¸€ç§ä¿®æ”¹æ–¹å¼ï¼Œ</strong><code>8.0</code><strong>ç”¨æ­¤æ–¹æ³•</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123&#39;</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">with</span> mysql_native_password <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;newpassword&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>ç¬¬äºŒç§ä¿®æ”¹æ–¹å¼</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> password <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span><span style="color:#f92672">=</span><span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#39;newpassword&#39;</span>);</span></span></code></pre></div></blockquote>
<ul>
<li><strong>ç¬¬ä¸‰ç§ä¿®æ”¹æ–¹å¼</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> mysql.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">set</span> authentication_string<span style="color:#f92672">=</span><span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#39;123qwe&#39;</span>) <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;root&#39;</span> <span style="color:#66d9ef">and</span> Host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;localhost&#39;</span>; </span></span></code></pre></div></blockquote>
<ul>
<li><strong>æ›´æ”¹å¯†ç ä¸º</strong><code>123456</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> destoon_member <span style="color:#66d9ef">set</span> password<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">â€™</span><span style="color:#ae81ff">14</span>e1b600b1fd579f47433b88e8d85291<span style="color:#960050;background-color:#1e0010">â€²</span> <span style="color:#66d9ef">where</span>
</span></span><span style="display:flex;"><span>username<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">â€™</span>admin<span style="color:#960050;background-color:#1e0010">â€™</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>å¿˜è®°æ•°æ®åº“å¯†ç </strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> cat <span style="color:#f92672">&gt;/</span>etc<span style="color:#f92672">/</span>my.cnf<span style="color:#f92672">&lt;&lt;-</span>EOF
</span></span><span style="display:flex;"><span>[mysqld]  	<span style="color:#75715e"># åœ¨é…ç½®æ–‡ä»¶ä¸­æœ€ä¸Šé¢æ·»åŠ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>skip<span style="color:#f92672">-</span><span style="color:#66d9ef">grant</span><span style="color:#f92672">-</span><span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span>EOF
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡å¯mysqlæœåŠ¡  ç›´æ¥ä½¿ç”¨ mysql -uroot -p ä¸è¾“å…¥å¯†ç ç›´æ¥å›è½¦è¿›å…¥ ä¿®æ”¹å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">set</span> authentication_string<span style="color:#f92672">=</span><span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#39;root&#39;</span>);</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="æ•°æ®åº“å¤‡ä»½è¿˜åŸ">æ•°æ®åº“å¤‡ä»½ã€è¿˜åŸ</h3>
<h4 id="å¤‡ä»½">å¤‡ä»½</h4>
<ul>
<li>
<ol>
<li><strong>ä½¿ç”¨<code>mysqldump</code>å¤‡ä»½æ•°æ®åº“</strong></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><strong>æ‰‹åŠ¨å¤‡ä»½</strong></li>
</ul>
<blockquote>
<ul>
<li><code>--all-databases</code><!-- raw HTML omitted -->å¤‡ä»½æ‰€æœ‰æ•°æ®åº“<!-- raw HTML omitted --></li>
<li><code>-B, --databases</code><!-- raw HTML omitted -->å¤‡ä»½æ—¶æŒ‡å®šæ•°æ®åº“<!-- raw HTML omitted --></li>
<li><code>--tables</code><!-- raw HTML omitted -->å¤‡ä»½æ—¶æŒ‡å®šæ•°æ®è¡¨<!-- raw HTML omitted --></li>
<li><code> --triggers</code><!-- raw HTML omitted -->åœ¨å¤‡ä»½æ—¶åŒ…æ‹¬è§¦å‘å™¨<!-- raw HTML omitted --></li>
<li><code>--routines</code><!-- raw HTML omitted -->åœ¨å¤‡ä»½æ—¶åŒ…æ‹¬å­˜å‚¨è¿‡ç¨‹<!-- raw HTML omitted --></li>
<li><code>--events</code><!-- raw HTML omitted -->åœ¨å¤‡ä»½æ—¶åŒ…æ‹¬äº‹ä»¶<!-- raw HTML omitted --></li>
<li><code>-S, --socket</code><!-- raw HTML omitted -->æœåŠ¡å™¨é€šä¿¡æ—¶è¦ä½¿ç”¨çš„å¥—æ¥å­—æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>--flush-logs</code>å‚æ•°ç”¨äºåœ¨å¤‡ä»½ä¹‹å‰åˆ·æ–°<code>MySQL</code>çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œç¡®ä¿å¤‡ä»½åŒ…å«æœ€æ–°çš„æ•°æ®æ›´æ–°</li>
<li><code>--skip-lock-tables</code>å‚æ•°å…è®¸åœ¨å¯¼å‡º<code>MySQL</code>æ•°æ®åº“è¡¨æ—¶è·³è¿‡å¯¹è¡¨çš„é”å®šæ“ä½œï¼Œé€‚ç”¨äºéœ€è¦æœ€å°åŒ–æ•°æ®åº“åœæœºæ—¶é—´æˆ–å¯¹å¯¼å‡ºè¿‡ç¨‹å½±å“è¾ƒå°çš„æƒ…å†µ</li>
<li><code>--lock-tables=false</code><!-- raw HTML omitted -->ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œ<!-- raw HTML omitted --><code>mysqldump</code> <!-- raw HTML omitted -->ä¼šé”å®šè¡¨ï¼Œä»¥ç¡®ä¿å¤‡ä»½çš„ä¸€è‡´æ€§ã€‚å¦‚æœä½ ä¸éœ€è¦é”å®šè¡¨ï¼Œå¯ä»¥ä½¿ç”¨<!-- raw HTML omitted --><code>--lock-tables=false</code><!-- raw HTML omitted -->å‚æ•°<!-- raw HTML omitted --></li>
<li><code>--column-statistics=0</code><!-- raw HTML omitted -->ï¼šç¦ç”¨ç»Ÿè®¡ä¿¡æ¯ï¼Œåœ¨<!-- raw HTML omitted --><code>MySQL8</code><!-- raw HTML omitted -->é»˜è®¤æƒ…å†µä¸‹ï¼Œå°è¯•æ”¶é›†æ¯ä¸ªåˆ—çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè¿™äº›ç»Ÿè®¡ä¿¡æ¯åŒ…æ‹¬æ¯ä¸ªåˆ—çš„æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼å’Œæ ‡å‡†å·®ç­‰ï¼Œä»¥ä¾¿ä¼˜åŒ–æŸ¥è¯¢è®¡åˆ’å’Œæ‰§è¡Œ<!-- raw HTML omitted --></li>
<li><code>--no-autocommit</code> å‚æ•°ç¦ç”¨è‡ªåŠ¨æäº¤æ¨¡å¼ï¼Œåœ¨å¤‡ä»½è¿‡ç¨‹ä¸­ä½¿ç”¨äº‹åŠ¡æ¥ç¡®ä¿å¤‡ä»½çš„ä¸€è‡´æ€§ï¼Œå¹¶å‡å°‘å¯¹æ•°æ®åº“çš„é”å®šæ—¶é—´ã€‚</li>
<li><code>--master-data</code> å‚æ•°åœ¨å¤‡ä»½è¾“å‡ºä¸­åŒ…å«äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åå’Œä½ç½®ä¿¡æ¯ï¼Œå¯¹äºä¸»ä»å¤åˆ¶ç¯å¢ƒä¸­çš„æ•°æ®åº“æ¢å¤å°¤å…¶æœ‰ç”¨</li>
<li><code>--single-transaction</code> å‚æ•°ç”¨äºä½¿ç”¨å•ä¸ªäº‹åŠ¡è¿›è¡Œå¤‡ä»½ï¼Œé€‚ç”¨äº InnoDB å­˜å‚¨å¼•æ“ï¼Œé¿å…äº†å¤‡ä»½æœŸé—´çš„é”è¡¨æ“ä½œã€‚</li>
<li><code>--set-gtid-purged=OFF</code><!-- raw HTML omitted -->ï¼šå¦‚æœæºåº“å¼€å¯äº†<!-- raw HTML omitted --><code>GTID</code><!-- raw HTML omitted -->ç‰¹æ€§ï¼Œä½¿ç”¨<!-- raw HTML omitted --><code>mysqldump</code><!-- raw HTML omitted -->å¯¼å‡ºæ•°æ®æ—¶ï¼Œå­˜åœ¨éœ€è¦<!-- raw HTML omitted --><code>super</code><!-- raw HTML omitted -->æƒé™æ‰§è¡Œçš„è¯­å¥ï¼š<!-- raw HTML omitted --><code>SET @@SESSION.SQL_LOG_BIN= 0;</code>ï¼Œ<code>SET @@GLOBAL.GTID_PURGED=Â´18f9a804-343b-11e5-a21d-b083fed01601:1-2;</code></li>
<li><strong>å¤‡ä»½ç”¨æˆ·æƒé™</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">SELECT</span>,RELOAD,<span style="color:#66d9ef">LOCK</span> <span style="color:#66d9ef">TABLES</span>,REPLICATION CLIENT,<span style="color:#66d9ef">SHOW</span> VIEW,EVENT,<span style="color:#66d9ef">TRIGGER</span>,PROCESS <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;backup&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;passwoord&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>å¤‡ä»½å¤šä¸ªæ•°æ®åº“</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /bin/mysql -u root -p<span style="color:#e6db74">&#39;password&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /tmp/mysqld.sock  -e <span style="color:#e6db74">&#39;show databases;&#39;</span>| <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>grep -E -v <span style="color:#e6db74">&#34;sys|mysql|information_schema|performance_schema|Database&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>|grep -E <span style="color:#e6db74">&#34;.*datebases1</span>$<span style="color:#e6db74">|.*datebases2</span>$<span style="color:#e6db74">&#34;</span> | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>xargs /bin/mysqldump -u root -p<span style="color:#e6db74">&#39;password&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /tmp/mysqld.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--single-transaction --no-autocommit <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> --skip-lock-tables --databases &gt;<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>-datebases_name.sql</span></span></code></pre></div></blockquote>
<ul>
<li><strong>å¯¼å‡ºå…¨éƒ¨åº“</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqldump -uroot -p<span style="color:#e6db74">&#39;passowrd&#39;</span> --all-databases &gt; /tmp/all_databases.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysqldump -u root -p<span style="color:#e6db74">&#39;passowrd&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /tmp/mysqld.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--all-databases --lock-tables<span style="color:#f92672">=</span>false <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--routines --single_transaction --flush-logs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--skip-lock-tables --master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| gzip &gt;/tmp/mysql-all-<span style="color:#e6db74">`</span>date +%F_%H%M%S<span style="color:#e6db74">`</span>.sql.gz </span></span></code></pre></div></blockquote>
<ul>
<li><strong>å¯¼å‡ºå•ä¸ªåº“</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqldump -uroot -p --databases databases_name &gt; /tmp/databases_name.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /bin/mysqldump -uroot -p<span style="color:#e6db74">&#39;passowrd&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--set-gtid-purged<span style="color:#f92672">=</span>OFF --single-transaction <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> --flush-logs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /tmp/mysqld.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--databases database_name | gzip &gt;/tmp/database<span style="color:#e6db74">`</span>date +%F_%H%M%S<span style="color:#e6db74">`</span>.sql.gz</span></span></code></pre></div></blockquote>
<ul>
<li><strong>å¯¼å‡ºæŒ‡å®šè¡¨</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqldump -uroot -p --databases databases_name --tables tables_name &gt; /tmp/databases_name_tables_name.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ bin/mysql -u root -p<span style="color:#e6db74">&#39;password&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /tmp/mysqld.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e <span style="color:#e6db74">&#39;select table_name from information_schema.tables where table_schema like &#34;game\-center\_ali&#34;;&#39;</span>|egrep <span style="color:#e6db74">&#34;.*record&#34;</span> | xargs /bin/mysqldump -u root -p<span style="color:#e6db74">&#39;password&#39;</span> -S /tmp/mysqld.sock  --databases databases_name --tables tables_name &gt;/tmp/tables_name.sql</span></span></code></pre></div></blockquote>
<ul>
<li><strong>å¯¼å‡ºè¡¨ç»“æ„åŠ <code>-d</code>å‚æ•°</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /bin/mysqldump -d -uroot -p<span style="color:#e6db74">&#39;passowrd&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /opt/data/data_3306/mysql.sock --databases database_name &gt; database_name.sql</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><strong>ä½¿ç”¨<code>Mysql</code>è„šæœ¬å¤‡ä»½å¹¶é€šçŸ¥<code>Telegram</code></strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/script/Backup_Mysql.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATA=$(date +%F_%H%M%S)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## set ff=unix # ä¿®æ”¹æ¢è¡Œç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®šä¹‰å¤‡ä»½ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MYSQL_BACKUP_PATH=/opt/backup/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®šä¹‰Telegram æœºå™¨äººIDå’ŒæŠ¥è­¦ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_BOT_ID=&#39;Telegram BOT_ID:BOT_Key&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_GROUP_ID=&#39;GROUP_ID&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®šä¹‰è¿æ¥æ•°æ®åº“ è´¦æˆ·å¯†ç IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_NAME=&#39;backup&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_PASSWORD=&#39;pass&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATABASES=&#39;databases name&#39;  	# å¤‡ä»½è¡¨ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_HOST_1=&#39;IP_1&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_HOST_2=&#39;IP_2&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## è¿‡æ»¤æ•°æ®åº“, xargså’Œsed &#39;1d&#39;æ•ˆæœä¸€æ ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATABASES_1=`/bin/mysql -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h&#34;${USER_HOST_1}&#34; -e &#39;show databases;&#39; | grep -E -v &#34;sys|mysql|information_schema|performance_schema|Database&#34; | /bin/xargs`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## DATABASES_2=`/bin/mysql -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h&#34;${USER_HOST_2}&#34; -e &#39;show databases;&#39; | grep -E -v &#34;sys|mysql|information_schema|performance_schema|Database&#34; | sed &#39;1d&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## æ£€æµ‹å¤‡ä»½ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»º
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## /bin/test -d /opt/backup
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">function TEST_BACKUP_DIR() {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -d ${MYSQL_BACKUP_PATH} ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/bin/mkdir -p ${MYSQL_BACKUP_PATH}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å§‹å‡†å¤‡å¤‡ä»½æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd ${MYSQL_BACKUP_PATH}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=å¼€å§‹å¤‡ä»½ï¼š${DATABASES_1} ${DATABASES_2} æ•°æ®åº“&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for i in ${DATABASES_1};do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/usr/local/mysql/bin/mysqldump -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h${USER_HOST_1} --single-transaction --no-autocommit --master-data=1 --skip-lock-tables ${i} &gt; ${MYSQL_BACKUP_PATH}${i}-`date +%F`.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ $? -eq 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> /bin/tar -zcvf ${MYSQL_BACKUP_PATH}${i}-`date +%F`.tar.gz ${i}-`date +%F`.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${DATABASES_1} ${DATABASES_2} æ•°æ®åº“å¤‡ä»½å®Œæˆ&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${DATABASES_1} ${DATABASES_2} æ•°æ®åº“å¤‡ä»½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/bin/rm -rf ${MYSQL_BACKUP_PATH}*.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¤‡ä»½æ•°æ®è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">function BACKUP_MYSQL_TABLES() {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	cd ${MYSQL_BACKUP_PATH}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	for DATABASES in ${DATABASES_1};do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	TABLES_1=$(/bin/mysql -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h&#34;${USER_HOST_1}&#34; ${DATABASES} -e &#34;show tables;&#34;|sed &#39;1d&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		for I in ${TABLES_1};do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			/usr/local/mysql/bin/mysqldump -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h${USER_HOST_1} --single-transaction --no-autocommit --master-data=1 --skip-lock-tables ${I} &gt; ${MYSQL_BACKUP_PATH}${i}-`date +%F`.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		/bin/tar -zcvf ${MYSQL_BACKUP_PATH}${DATABASES}-`date +%F`.tar.gz *.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		/bin/rm -rf ${MYSQL_BACKUP_PATH}*.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	done	
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	if [ $? -eq 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${DATABASES_1} ${DATABASES_2} æ•°æ®åº“å¤‡ä»½å®Œæˆ&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${DATABASES_1} ${DATABASES_2} æ•°æ®åº“å¤‡ä»½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/bin/find ${MYSQL_BACKUP_PATH} -name &#34;databases-*&#34; -mtime +15 -exec  rm  {} \;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="è¿˜åŸ">è¿˜åŸ</h4>
<blockquote>
<ul>
<li><strong>æ•°æ®åº“è¿˜åŸã€å¯¼å…¥</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬ä¸€ç§æ–¹å¼</span>
</span></span><span style="display:flex;"><span>$ /bin/mysql -u root -p<span style="color:#e6db74">&#39;passowrd&#39;</span> -S /opt/data/data_16303/mysql.sock &lt; /root/all.sql  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬äºŒç§æ–¹å¼  </span>
</span></span><span style="display:flex;"><span>mysql&gt; use mysql;
</span></span><span style="display:flex;"><span>mysql&gt; source /root/databases.sql  	<span style="color:#75715e"># å½“å‰ç›®å½•ç»å¯¹è·¯å¾„</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>.qp</code><strong>æ–‡ä»¶æ•°æ®åº“æ¢å¤</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ xbstream -x -p <span style="color:#ae81ff">4</span> &lt; ./databases.qp -C /opt/mysql/backup</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="ä½¿ç”¨perconaå¤‡ä»½å·¥å…·">ä½¿ç”¨<code>percona</code>å¤‡ä»½å·¥å…·</h4>
<blockquote>
<ul>
<li><a href="https://segmentfault.com/a/1190000019305858" rel="external" target="_self"><code>Linux</code>è¿ç»´ <code>mysql</code>æ•°æ®åº“çš„å¤‡ä»½ä¸æ¢å¤</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1119183" rel="external" target="_self"><code>innobackupex</code>å¤‡ä»½æ¢å¤<code>+</code>å¢é‡å¤‡ä»½ä¸æ¢å¤</a></li>
<li><code>innobackupex</code>ï¼šæ›´å¤šé«˜çº§ç®¡ç†åŠŸèƒ½å’Œè‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬</li>
<li><code>xtrabackup</code>ï¼šéœ€è¦åŸºæœ¬çš„ç‰©ç†å¤‡ä»½å’Œæ¢å¤åŠŸèƒ½ï¼Œå¹¶ä¸”æ„¿æ„æ‰‹åŠ¨ç®¡ç†å¤‡ä»½æµç¨‹</li>
<li>å®‰è£…<a href="https://www.percona.com/software/mysql-database/percona-xtrabackup" rel="external" target="_self"><code>XtraBackup</code></a></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ yumæº</span>
</span></span><span style="display:flex;"><span>$ wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6.repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…ä¾èµ–åŒ…</span>
</span></span><span style="display:flex;"><span>$ yum -y install perl perl-devel libaio libaio-devel perl-Time-HiRes perl-DBD-MySQL
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸‹è½½rpmåŒ…</span>
</span></span><span style="display:flex;"><span>$ wget https://downloads.percona.com/downloads/Percona-XtraBackup-2.4/Percona-XtraBackup-2.4.27/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.27-1.el7.x86_64.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ yum -y install percona-xtrabackup-24-2.4.27-1.el7.x86_64.rpm</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æ‰‹åŠ¨å¤‡ä»½</strong></li>
</ul>
<blockquote>
<ul>
<li><strong>å®Œæ•´ä»¥åŠå¢é‡å¤‡ä»½</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å®Œæ•´å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>$ innobackupex --host<span style="color:#f92672">=</span>IP --user<span style="color:#f92672">=</span>name --password<span style="color:#f92672">=</span><span style="color:#ae81ff">123456</span> --prot<span style="color:#f92672">=</span><span style="color:#ae81ff">3306</span> --no-timestamp /opt/backup/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¢é‡å¤‡ä»½  åŸºäºå…¨é‡å¤‡ä»½å®ç°å¢é‡å¤‡ä»½ï¼Œå¢é‡å¤‡ä»½åªæ”¯æŒInnodb</span>
</span></span><span style="display:flex;"><span>$ innobackupex --host<span style="color:#f92672">=</span>IP --user<span style="color:#f92672">=</span>root --password<span style="color:#f92672">=</span><span style="color:#ae81ff">123456</span> --prot<span style="color:#f92672">=</span><span style="color:#ae81ff">3306</span> --no-timestamp --incremental /opt/backup/ --incremental-basedir<span style="color:#f92672">=</span>/opt/backup/<span style="color:#66d9ef">$(</span>date +%F_%T<span style="color:#66d9ef">)</span></span></span></code></pre></div></blockquote>
<ul>
<li><strong>æ•°æ®åº“æ¢å¤æµç¨‹</strong></li>
</ul>
<blockquote>
<ul>
<li><code>--decompress</code><!-- raw HTML omitted -->è¯¥é€‰é¡¹è¡¨ç¤ºè§£å‹<!-- raw HTML omitted --><code>--compress</code><!-- raw HTML omitted -->é€‰é¡¹å‹ç¼©æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>--parallel</code><!-- raw HTML omitted -->è¯¥é€‰é¡¹è¡¨ç¤ºå…è®¸å¤šä¸ªæ–‡ä»¶åŒæ—¶è§£å‹ã€‚ä¸ºäº†è§£å‹ï¼Œ<!-- raw HTML omitted --><code>qpress</code><!-- raw HTML omitted -->å·¥å…·å¿…é¡»æœ‰å®‰è£…å¹¶ä¸”è®¿é—®è¿™ä¸ªæ–‡ä»¶çš„æƒé™ã€‚è¿™ä¸ªè¿›ç¨‹å°†åœ¨åŒä¸€ä¸ªä½ç½®ç§»é™¤åŸæ¥çš„å‹ç¼©/åŠ å¯†æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>--apply-log</code><!-- raw HTML omitted -->è¯¥é€‰é¡¹è¡¨ç¤ºåŒ<!-- raw HTML omitted --><code>xtrabackup</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>--prepare</code><!-- raw HTML omitted -->å‚æ•°,ä¸€èˆ¬æƒ…å†µä¸‹,åœ¨å¤‡ä»½å®Œæˆåï¼Œæ•°æ®å°šä¸”ä¸èƒ½ç”¨äºæ¢å¤æ“ä½œï¼Œå› ä¸ºå¤‡ä»½çš„æ•°æ®ä¸­å¯èƒ½ä¼šåŒ…å«å°šæœªæäº¤çš„äº‹åŠ¡æˆ–å·²ç»æäº¤ä½†å°šæœªåŒæ­¥è‡³æ•°æ®æ–‡ä»¶ä¸­çš„äº‹åŠ¡ã€‚å› æ­¤ï¼Œæ­¤æ—¶æ•°æ® æ–‡ä»¶ä»å¤„ç†ä¸ä¸€è‡´çŠ¶æ€<!-- raw HTML omitted --></li>
<li><code>--apply-log</code><!-- raw HTML omitted -->çš„ä½œç”¨æ˜¯é€šè¿‡å›æ»šæœªæäº¤çš„äº‹åŠ¡åŠåŒæ­¥å·²ç»æäº¤çš„äº‹åŠ¡è‡³æ•°æ®æ–‡ä»¶ä½¿æ•°æ®æ–‡ä»¶å¤„äºä¸€è‡´æ€§çŠ¶æ€<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 1.æ‹·è´å¤‡ä»½åˆ°data3306(åªæ‹·è´æ—¥æœŸæ–‡ä»¶å¤¹ä¸‹é¢çš„æ–‡ä»¶)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2.cd /opt/data3306</span>
</span></span><span style="display:flex;"><span>$ innobackupex --defaults-file<span style="color:#f92672">=</span>/opt/conf/my_3306.cnf --decompress --parallel<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span> ./
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3.åˆ é™¤æ‰€æœ‰.qpæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4.æ¢å¤æ•°æ®åº“(å…¨é‡)</span>
</span></span><span style="display:flex;"><span>$ cd /opt/data3306
</span></span><span style="display:flex;"><span>$ innobackupex --defaults-file<span style="color:#f92672">=</span>/opt/conf/my_3306.cnf --apply-log  --use-memory<span style="color:#f92672">=</span>4G ./</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æ‰‹åŠ¨æ¢å¤</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ service mysql stop
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆå§‹åŒ–å…¨é‡å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ innobackupex --apply-log --redo-only /opt/backup/ --incremental-dir<span style="color:#f92672">=</span>/opt/backup/<span style="color:#66d9ef">$(</span>date +%F_%T<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆå§‹åŒ–æ•´åˆå¢é‡å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>$ innobackupex --apply-log --redo-only /data/backup/2017-08-24_22-57-43 --incremental-dir<span style="color:#f92672">=</span>/data/backup/2017-08-24_23-10-21
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠæ•´åˆå¥½çš„å¢é‡å†æ¬¡åˆå§‹åŒ–</span>
</span></span><span style="display:flex;"><span>$ innobackupex --apply-log  /data/backup/2017-08-24_22-57-43
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¤‡ä»½MySQLä¸‹dataæ•°æ®ç›®å½•è¦æ¢å¤çš„æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ mv  /usr/local/mysql/data/ceshi/  /opt/backup/<span style="color:#66d9ef">$(</span>date +%F_%T<span style="color:#66d9ef">)</span>/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠæ•´åˆåçš„å…¨é‡å¤‡ä»½ç›®å½•ä¸‹è¦æ¢å¤çš„æ•°æ®åº“å¤åˆ¶åˆ°MySQLä¸‹dataç›®å½•</span>
</span></span><span style="display:flex;"><span>$ cp -a  /opt/backup/quanliang/ceshi /usr/local/mysql/data/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°èµ‹äºˆå±ç»„mysqlæƒé™</span>
</span></span><span style="display:flex;"><span>$ chown -R mysql.mysql   /usr/local/mysql/data/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ service mysql start</span></span></code></pre></div></blockquote>
<ul>
<li><strong>ä½¿ç”¨<code>--copy</code>å‚æ•°å®ç°å¤‡ä»½æ¢å¤</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ service mysql stop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠdataæ•°æ®ç›®å½•ä¸‹æ•°æ®è¿›è¡Œå¤‡ä»½</span>
</span></span><span style="display:flex;"><span>$ cp -a  /usr/local/mysql/data/* /opt/backup/<span style="color:#66d9ef">$(</span>date +%F_%T<span style="color:#66d9ef">)</span>/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠè¦æ¢å¤çš„æ•°æ®å¤‡ä»½ç”Ÿæˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ innobackupex  --apply-log --redo-only /opt/backup/quanliang/ceshi_danku/  	<span style="color:#75715e"># è¿™ä¸ªæ˜¯å•åº“å¤‡ä»½ç›®å½•</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># dataç›®å½•å¿…é¡»ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>$ innobackupex  --copy-back /opt/backup/quanliang/ceshi_danku/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°èµ‹äºˆå±ç»„æƒé™</span>
</span></span><span style="display:flex;"><span>$ chown -R mysql.mysql /usr/local/mysql/data/
</span></span><span style="display:flex;"><span>$ service mysql start</span></span></code></pre></div></blockquote>
<ul>
<li><strong>ä½¿ç”¨<code>Mysql</code>è„šæœ¬å¤‡ä»½å¹¶é€šçŸ¥é’‰é’‰æ¥å£</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/script/Backup_Mysql_innobackupex.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ***************************************************************#
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##  Create: DBA
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ***************************************************************#
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## echo `hostname -I` |sed &#39;s/ /#/g&#39; -  &gt;/tmp/ipaddr.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å®šä¹‰Telegram æœºå™¨äººIDå’ŒæŠ¥è­¦ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_BOT_ID=&#39;Telegram bot_id:bot_key&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_GROUP_ID=&#39;GROUP_ID&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IP_ADDRE=$(hostname -I |awk &#39;{print $1}&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_NAME=&#39;backup&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_PASSWORD=&#39;IvV8BhpvHb/7EA==&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATABASES=&#39;databases name&#39; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backup_time=`date +&#39;%Y%m%d%m&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backup_base=&#34;/opt/backup/dbback&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backup_dir=&#34;$backup_base/full&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backup_log=&#34;$backup_base/log/xtra_${backup_time}.log&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">slave_days=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## é’‰é’‰æ¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">function SendToDingding_error(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #Dingding_Url=&#34;https://oapi.dingtalk.com/robot/send?access_token=d5201a579163dc6045b6da6d8dbc1cdc1d935698050971ceddb5a8956e9507ee&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Dingding_Url=&#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage?chat_id=${TELEGRAM_GROUP_ID}&amp;text=%22${IP_ADDRE}mysqlbak%20failure!Please check %22&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # å‘é€é’‰é’‰æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> curl &#34;${Dingding_Url}&#34; -H &#39;Content-Type: application/json&#39; -d &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     \&#34;actionCard\&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;title\&#34;: \&#34;$1\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;text\&#34;: \&#34;$2\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;hideAvatar\&#34;: \&#34;0\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;btnOrientation\&#34;: \&#34;0\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;btns\&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                 \&#34;title\&#34;: \&#34;$1\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                 \&#34;actionURL\&#34;: \&#34;\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     \&#34;msgtype\&#34;: \&#34;actionCard\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®‰è£…å¤‡ä»½å·¥å…· innobackupex æˆ– xtrabackup
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -x /usr/bin/innobackupex ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     yum -y install  http://www.percona.com/downloads/percona-release/redhat/0.1-4/percona-release-0.1-4.noarch.rpm
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     yum -y install percona-xtrabackup-24 qpress
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å§‹åˆ›å»ºç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -d ${backup_dir} ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mkdir -p ${backup_dir}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -d ${backup_base}/log ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mkdir -p ${backup_base}/log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_time=`date +&#39;%Y%m%d_%H:%M:%S&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_file=`date +&#39;%Y-%m-%d_%H-%M-%S&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å§‹å¤‡ä»½æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -e &#34;`date +&#39;%Y-%m-%d %H:%M:%S&#39;` å¼€å§‹ç‰©ç†å¤‡ä»½æ•°æ®åº“ ${ipaddr} ...&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/usr/bin/innobackupex --defaults-file=/opt/conf/my_16303.cnf --user=${backup_user} --password=${backup_password} --host=&#39;localhost&#39; --socket=/opt/data/data_16303/mysql.sock --use-memory=1G --compress --compress-threads=32 --parallel=3 --slave-info ${backup_dir} 2&gt;&gt;${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ $? -ne 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;`date +&#39;%Y%m%d_%H:%M:%S&#39;` å¤‡ä»½æ•°æ®åº“å‘ç”Ÿé”™è¯¯,å…·ä½“çœ‹æ—¥å¿—&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Subject=&#34;ç‰©ç†å¤‡ä»½xtraå¤‡ä»½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Body=&#34;&#39;${ipaddr}&#39;_ç‰©ç†å¤‡ä»½å¤±è´¥,è¯·å‚è€ƒæ—¥å¿—:${backup_log}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> SendToDingding_error $Subject $Body
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd ${backup_dir}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file_time=`date +&#39;%Y-%m-%d&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flie_name=`ls -l | grep &#34;$file_time&#34;|tail -n 1|awk &#39;{print $9}&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">tar -zcf ${file_time}.tar.gz ${flie_name}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rm -rf ${flie_name}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## rsync -avz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -z &#34;`tail -1 ${backup_log} | grep &#39;completed OK&#39;`&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> finish_time=`date +&#39;%Y%m%d_%H:%M:%S&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> file_size=`du -sm ${backup_dir} |awk &#39;{print $1}&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;${ipaddr}æ•°æ®åº“xtrabackupç‰©ç†å¤‡ä»½å·¥ä½œå®Œæˆ!\n å¼€å§‹æ—¶é—´ï¼š${start_time} ç»“æŸæ—¶é—´ï¼š${finish_time}\n å¤‡ä»½ç›®å½•${backup_dir}\n
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">å¤‡ä»½æ–‡ä»¶å¤§å°${file_size} MB&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # åˆ é™¤ä»¥å‰çš„å¤‡ä»½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;`date +&#39;%Y%m%d_%H:%M:%S&#39;` å¼€å§‹åˆ é™¤${slave_days}å¤©ä»¥å‰çš„å¤‡ä»½&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> cd ${backup_base}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> for tfile in $(/usr/bin/find ${backup_dir}  -mindepth 1 -maxdepth 1 -mtime +${slave_days})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      cd ${backup_dir} &amp;&amp; rm -rf ${tfile} 2&gt;&gt;${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      echo -e &#34;---- delete file :${file} -----&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;`date +&#39;%Y%m%d_%H%M%S&#39;` åˆ é™¤${slave_days}å¤©ä»¥å‰çš„å¤‡ä»½-å®Œæˆ&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> find $backup_base/log  -mindepth 1 -maxdepth 1  -mtime +${slave_days} -type f |xargs  rm -f
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;`date +&#39;%Y%m%d_%H:%M:%S&#39;` å¤‡ä»½æ•°æ®åº“å‘ç”Ÿé”™è¯¯,å…·ä½“çœ‹æ—¥å¿—&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Subject=&#34;ç‰©ç†å¤‡ä»½xtraå¤‡ä»½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Body=&#34;${ipaddr}_ç‰©ç†å¤‡ä»½å¤±è´¥,è¯·å‚è€ƒæ—¥å¿—:${backup_log}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> SendToDingding_error $Subject $Body
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="æŸ¥çœ‹å¯¼å‡ºæ¸…ç†binlogæ—¥å¿—">æŸ¥çœ‹ã€å¯¼å‡ºã€æ¸…ç†<code>binlog</code>æ—¥å¿—</h3>
<ul>
<li>
<ol>
<li><strong>æŸ¥çœ‹<code>binlog</code></strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šæŸ¥è¯¢ mysql-bin.000002è¿™ä¸ªæ–‡ä»¶ï¼Œä»posç‚¹:624å¼€å§‹æŸ¥èµ·ï¼Œåç§»2è¡Œï¼ˆå³ä¸­é—´è·³è¿‡2ä¸ªï¼‰ï¼ŒæŸ¥è¯¢10æ¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> binlog events <span style="color:#66d9ef">in</span> <span style="color:#e6db74">&#39;mysql-bin.000002&#39;</span> <span style="color:#66d9ef">from</span> <span style="color:#ae81ff">624</span> <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">\</span>G;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><strong>å¯¼å‡ºæ•°æ®åº“<code>binlog</code>æ—¥å¿—</strong></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>--base64-output=</code>ï¼š<code>decode-rows</code><!-- raw HTML omitted -->å°†è¡Œäº‹ä»¶è§£ç ä¸ºæ³¨é‡Šä¼ª<!-- raw HTML omitted --><code>SQL</code><!-- raw HTML omitted -->è¯­å¥<!-- raw HTML omitted --></li>
<li><code>--no-defaults</code></li>
<li><code>--database=&quot;æ•°æ®åº“å&quot;</code>ï¼š<!-- raw HTML omitted -->ä»…åˆ—å‡ºæ­¤æ•°æ®åº“çš„æ¡ç›®(ä»…é™æœ¬åœ°æ—¥å¿—)<!-- raw HTML omitted --></li>
<li><code>--start-datetime=''</code>ï¼š<!-- raw HTML omitted --><!-- raw HTML omitted -->å¼€å§‹æ—¶é—´<!-- raw HTML omitted -->å‚æ•°å¿…é¡»æ˜¯æœ¬åœ°æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œæ ¼å¼ä¸é™<code>MySQL</code>æœåŠ¡å™¨æ¥å—<code>DATETIME</code>å’Œ<code>TIMESTAMP</code>ç±»å‹ï¼Œä¾‹å¦‚ï¼š<!-- raw HTML omitted --><code>2004-12-25 11:25:56</code></li>
<li><code>--stop-datetime=''</code>ï¼š<!-- raw HTML omitted --><!-- raw HTML omitted -->ç»“æŸæ—¶é—´<!-- raw HTML omitted -->å‚æ•°å¿…é¡»æ˜¯æœ¬åœ°æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œæ ¼å¼ä¸é™<code>MySQL</code>æœåŠ¡å™¨æ¥å—<code>DATETIME</code>å’Œ<code>TIMESTAMP</code>ç±»å‹ï¼Œä¾‹å¦‚ï¼š<!-- raw HTML omitted --><code>2004-12-25 11:25:56</code></li>
<li><code>--start-position=875</code>ï¼š<!-- raw HTML omitted -->åç§»é‡å¼€å§‹è¯»å–ä½ç½®<!-- raw HTML omitted --></li>
<li><code>--stop-position=954</code>ï¼š<!-- raw HTML omitted -->åç§»é‡åœæ­¢è¯»å–ä½ç½®<!-- raw HTML omitted --></li>
<li><code>-v</code>ï¼š<!-- raw HTML omitted -->ä»è¡Œäº‹ä»¶ä¸­é‡å»ºä¼ª<!-- raw HTML omitted --><code>SQL</code><!-- raw HTML omitted -->è¯­å¥ï¼Œ<!-- raw HTML omitted --><code>-vv</code><!-- raw HTML omitted -->æ·»åŠ å¯¹åˆ—æ•°æ®ç±»å‹çš„æ³¨é‡Š<!-- raw HTML omitted --></li>
<li><code>-r</code>ï¼š<!-- raw HTML omitted -->ç›´æ¥è¾“å‡ºåˆ°ç»™å®šçš„æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /bin/mysqlbinlog <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--base64-output<span style="color:#f92672">=</span>decode-rows <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-defaults --database<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;æ•°æ®åº“å&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--start-datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2019-04-11 00:00:00&#39;</span> <span style="color:#ae81ff">\ </span> 	<span style="color:#75715e"># å¼€å§‹æ—¶é—´</span>
</span></span><span style="display:flex;"><span>--stop-datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2019-04-11 15:00:00&#39;</span> <span style="color:#ae81ff">\ </span> 	<span style="color:#75715e"># ç»“æŸæ—¶é—´</span>
</span></span><span style="display:flex;"><span>-v /opt/data/mysql/mysql-bin.000007 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-r /opt/binlog<span style="color:#e6db74">`</span>date <span style="color:#e6db74">&#39;+%F&#39;</span><span style="color:#e6db74">`</span>.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–¹æ³•äºŒ</span>
</span></span><span style="display:flex;"><span>$ /bin/mysqlbinlog <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-defaults --database<span style="color:#f92672">=</span>db <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--start-datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2019-04-11 00:00:00&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--stop-datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2019-04-11 15:00:00&#39;</span> mysql-bin.000007 | more
</span></span><span style="display:flex;"><span>mysqlbinlog <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--base64-output<span style="color:#f92672">=</span>decode-rows <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--start-position<span style="color:#f92672">=</span><span style="color:#ae81ff">2966</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--stop-position<span style="color:#f92672">=</span><span style="color:#ae81ff">2966</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v mysql-bin.000125</span></span></code></pre></div><ul>
<li><strong>ä»<code>binlog</code>æ—¥å¿—ä¸­å¾—<code>DELETE</code>åˆ é™¤æ¢æˆ<code>INSERT INTO</code>æ’å…¥è¯­å¥</strong></li>
</ul>
<blockquote>
<p><a href="https://www.cnblogs.com/yhq1314/p/13970044.html" rel="external" target="_self"><code>mysql binlg delete</code>è¯­å¥è§£æä¸º<code>insert</code>è¯­å¥</a></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ find /path/to/binlog/directory -name <span style="color:#e6db74">&#34;binlog.*&#34;</span> -printf <span style="color:#e6db74">&#34;%T@ %p\n&#34;</span> | sort -n | cut -d<span style="color:#e6db74">&#39; &#39;</span> -f2- | xargs mysqlbinlog &gt; combined_binlog.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ find ./ -name <span style="color:#e6db74">&#34;mysql-bin.266*&#34;</span> -printf <span style="color:#e6db74">&#34;%T@ %p\n&#34;</span> | sort -n | cut -d<span style="color:#e6db74">&#39; &#39;</span> -f2- | xargs /usr/local/mysql/bin/mysqlbinlog -vv  --base64-output<span style="color:#f92672">=</span>DECODE-ROWS --set-charset<span style="color:#f92672">=</span>UTF8 mysql-bin.266770 --database<span style="color:#f92672">=</span>databases_name -r new_binlog.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####  	è§£æbinlogå¹¶è¿˜åŸæˆæ’å…¥è¯­å¥  	#####</span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysqlbinlog -vv --base64-output<span style="color:#f92672">=</span>DECODE-ROWS --set-charset<span style="color:#f92672">=</span>UTF8 mysql-bin.merged.9 --database<span style="color:#f92672">=</span>databases_name &gt;&gt;/mnt/new_binlog.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åªè¿‡æ»¤æŸä¸ªæ•°æ®åº“ä¸­çš„æŸä¸ªè¡¨ä¸­çš„åˆ é™¤è¯­å¥</span>
</span></span><span style="display:flex;"><span>$ cat new_binlog.sql | awk <span style="color:#e6db74">&#39;/DELETE FROM/ &amp;&amp; (/databases_name.tables_name/ || /`databases_name`.`tables_name`/) { while(1) { print $0; getline; if($0 !~ /^###/) { break; }; }}&#39;</span> &gt; new_binlog-1.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å»æ‰ï¼š###</span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-1.sql new_binlog-2.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/^### //g&#39;</span> new_binlog-2.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤è¯­å¥æ›¿æ¢ä¸ºæ’å…¥è¯­å¥</span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-2.sql new_binlog-3.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/^DELETE FROM/INSERT INTO/g&#34;</span> new_binlog-3.sql 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¡ä»¶æ›¿æ¢ä¸ºå€¼</span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-3.sql new_binlog-4.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/^WHERE/VALUES(/g&#34;</span> new_binlog-4.sql 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># @21 è¿™é‡Œè¦çœ‹è§£æåçš„å…·ä½“è¡Œæ•°ï¼Œ </span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-4.sql new_binlog-5.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/@21=.*/a );&#39;</span> new_binlog-5.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat new_binlog-5.sql | awk -F<span style="color:#e6db74">&#34;=|/*&#34;</span> <span style="color:#e6db74">&#39;{ if($0 ~ /^INSERT|^VALUES|^);/) { print $0; } else { printf $2&#34;,&#34;; };}&#39;</span> &gt;new_binlog-6.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp  new_binlog-6.sql new_binlog-7.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/,);</span>$<span style="color:#e6db74">/);/g&#34;</span> new_binlog-7.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-7.sql new_binlog-8.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/,INSERT/);INSERT/g&#39;</span> new_binlog-8.sql</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="3">
<li><strong>æ¸…ç†<code>binlog</code></strong></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.cnblogs.com/xxoome/p/9802684.html" rel="external" target="_self"><code>mysql binlog</code>æ—¥å¿—è‡ªåŠ¨æ¸…ç†åŠæ‰‹åŠ¨åˆ é™¤</a>ã€<a href="https://developer.aliyun.com/article/712256" rel="external" target="_self"><code>Mysql</code>æ¸…ç†<code>binlog</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æ¸…é™¤MySQL-bin.010æ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">PURGE</span> MASTER LOGS <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;MySQL-bin.010&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…é™¤2008-06-22 13:00:00å‰binlogæ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">PURGE</span> MASTER LOGS <span style="color:#66d9ef">BEFORE</span> <span style="color:#e6db74">&#39;2008-06-22 13:00:00&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…é™¤3å¤©å‰binlogæ—¥å¿—BEFOREï¼Œå˜é‡çš„dateè‡ªå˜é‡å¯ä»¥ä¸º&#39;YYYY-MM-DD hh:mm:ss&#39;æ ¼å¼ã€‚ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">PURGE</span> MASTER LOGS <span style="color:#66d9ef">BEFORE</span> <span style="color:#a6e22e">DATE_SUB</span>( <span style="color:#a6e22e">NOW</span>( ), <span style="color:#66d9ef">INTERVAL</span> <span style="color:#ae81ff">3</span> DAY);</span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆ›å»ºæˆæƒåˆ é™¤ç”¨æˆ·">åˆ›å»ºã€æˆæƒã€åˆ é™¤ç”¨æˆ·</h3>
<ul>
<li>
<ol>
<li><strong>åˆ›å»ºã€æˆæƒ</strong></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><strong><code>5.7.*</code>ä¸€ä¸‹åˆ›å»ºä»¥åŠæˆæƒ</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">on</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> root<span style="color:#f92672">@</span><span style="color:#e6db74">&#39;10.14.23.%&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123456&#39;</span>;  	<span style="color:#75715e"># 192.168.%.% è¡¨ç¤ºç½‘æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> <span style="color:#66d9ef">database</span>.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#34;password&#34;</span>;</span></span></code></pre></div><ul>
<li><strong><code>Myslq 8.0</code>è¯­å¥æ‰§è¡Œï¼Œ<code>8.0</code>ç‰ˆæœ¬ä¹‹ååˆ›å»ºç”¨æˆ·å’Œæˆæƒåˆ†å¼€äº†</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºç”¨æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;127.0.0.1&#39;</span> <span style="color:#66d9ef">IDENTIFIED</span> <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;passowrd&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆäºˆæƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;127.0.0.1&#39;</span> <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">OPTION</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤æƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">REVOKE</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">ON</span> databasename.tablename <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;host&#39;</span>; </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><strong>åˆ›å»ºä»åº“ç”¨æˆ·å¹¶æˆå¤åˆ¶æƒé™</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>MySQL<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> replication slave, replication client <span style="color:#66d9ef">on</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;lisi&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;10.14.23.%&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123456&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><strong>æ’¤é”€ç”¨æˆ·æƒé™</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">REVOKE</span> privilege <span style="color:#66d9ef">ON</span> databasename.tablename <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;host&#39;</span>;  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><strong>åˆ é™¤ç”¨æˆ·ã€æ•°æ®</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;host&#39;</span>;  	<span style="color:#75715e"># å¦‚æœæ˜¯å½“å‰ç™»é™†ç”¨æˆ·ç”¨SET PASSWORD = PASSWORD(&#34;newpassword&#34;); 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">â€˜</span>xx<span style="color:#960050;background-color:#1e0010">â€™</span> <span style="color:#66d9ef">and</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;xx&#39;</span>;  	<span style="color:#75715e"># æˆæƒæŸ¥çœ‹æ•°æ®åº“ç”¨æˆ·ï¼ˆclintï¼‰ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> mysql.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;slave&#34;</span> <span style="color:#66d9ef">and</span> host<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;10.14.23.%&#34;</span>;  </span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆ›å»ºåº“è¡¨">åˆ›å»ºåº“ã€è¡¨</h3>
<ul>
<li>
<ol>
<li><strong>åˆ›å»ºåº“</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> db2 <span style="color:#66d9ef">character</span> <span style="color:#66d9ef">set</span> utf8 <span style="color:#66d9ef">collate</span> utf8_general_ci;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><strong>åˆ›å»ºè¡¨</strong></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>NOT NULL</code>ï¼š<!-- raw HTML omitted -->æ¯ä¸€è¡Œéƒ½å¿…é¡»å«æœ‰å€¼ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰ï¼Œ<code>null</code>å€¼æ˜¯ä¸å…è®¸çš„<!-- raw HTML omitted --></li>
<li><code>DEFAULT value</code>ï¼š<!-- raw HTML omitted -->è®¾ç½®é»˜è®¤å€¼<!-- raw HTML omitted --></li>
<li><code>UNSIGNED</code>ï¼š<!-- raw HTML omitted -->ä½¿ç”¨æ— ç¬¦å·æ•°å€¼ç±»å‹ï¼Œ<!-- raw HTML omitted --><code>0</code><!-- raw HTML omitted -->åŠæ­£æ•°<!-- raw HTML omitted --></li>
<li><code>AUTO INCREMENT</code>ï¼š<!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>MySQL</code><!-- raw HTML omitted -->å­—æ®µçš„å€¼åœ¨æ–°å¢è®°å½•æ—¶æ¯æ¬¡è‡ªåŠ¨å¢é•¿<!-- raw HTML omitted --><code>1</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> databases_name.<span style="color:#a6e22e">tables_name</span>(id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>, name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">50</span>)<span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)  	<span style="color:#75715e"># not null ä¸ä¸ºç©º
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®æ•°æ®è¡¨ä¸­æ¯æ¡è®°å½•çš„å”¯ä¸€æ ‡è¯†ã€‚ é€šå¸¸åˆ—çš„ PRIMARY KEY è®¾ç½®ä¸º ID æ•°å€¼ï¼Œä¸AUTO_INCREMENT ä¸€èµ·ä½¿ç”¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#f92672">`</span>databases_name<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>tables_name<span style="color:#f92672">`</span>(name) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#39;lisi&#39;</span>);
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)  	<span style="color:#75715e"># ä¸å†™id
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#f92672">`</span>databases_name<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>tables_name<span style="color:#f92672">`</span>(id,content,add_time) <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">4</span>,<span style="color:#e6db74">&#39;Text&#39;</span>,<span style="color:#e6db74">&#39;2023-01-11 02:52:54&#39;</span>);</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><strong>æŒ‰æ—¥æœŸåˆ é™¤è¡¨</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">USE</span> example_db;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> table_name <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">WHERE</span> table_schema <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;example_db&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">CONCAT</span>(<span style="color:#e6db74">&#39;DROP TABLE IF EXISTS &#39;</span>, table_name, <span style="color:#e6db74">&#39;;&#39;</span>) <span style="color:#66d9ef">AS</span> sql_statement <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">WHERE</span> table_schema <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;example_db&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> table_name <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">WHERE</span> table_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;prefix_%&#39;</span> <span style="color:#66d9ef">AND</span> table_name <span style="color:#66d9ef">BETWEEN</span> <span style="color:#e6db74">&#39;prefix_2022-02-01&#39;</span> <span style="color:#66d9ef">AND</span> <span style="color:#e6db74">&#39;prefix_2022-03-01&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">CONCAT</span>(<span style="color:#e6db74">&#39;DROP TABLE IF EXISTS &#39;</span>, table_name, <span style="color:#e6db74">&#39;;&#39;</span>) <span style="color:#66d9ef">AS</span> sql_statement <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">WHERE</span> table_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;prefix_%&#39;</span> <span style="color:#66d9ef">AND</span> table_name <span style="color:#66d9ef">BETWEEN</span> <span style="color:#e6db74">&#39;prefix_2022-02-01&#39;</span> <span style="color:#66d9ef">AND</span> <span style="color:#e6db74">&#39;prefix_2022-03-01&#39;</span>;</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æŸ¥è¯¢åº“è¡¨å®¹é‡å¤§å°">æŸ¥è¯¢åº“ã€è¡¨å®¹é‡å¤§å°</h3>
<blockquote>
<ul>
<li><strong>æŸ¥è¯¢æ‰€æœ‰åº“å®¹é‡å¤§å°</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>table_schema <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(table_rows) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è®°å½•æ•°&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(data_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(index_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç´¢å¼•å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(DATA_FREE<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç¢ç‰‡å ç”¨(MB)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.<span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> table_schema
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#a6e22e">sum</span>(data_length) <span style="color:#66d9ef">desc</span>, <span style="color:#a6e22e">sum</span>(index_length) <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æŸ¥çœ‹æŒ‡å®šåº“çš„å®¹é‡å¤§å°</strong></li>
</ul>
<blockquote>
<ul>
<li>æŸ¥çœ‹<code>MySQL</code>ã€ŒæŒ‡å®šåº“ã€çš„å®¹é‡å¤§å°ï¼š<code>database_name</code>æ›´æ”¹ä¸ºè¦æŸ¥è¯¢çš„åº“</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>table_schema <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(table_rows) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è®°å½•æ•°&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(data_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(index_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç´¢å¼•å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(DATA_FREE<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç¢ç‰‡å ç”¨(MB)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.<span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> table_schema<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;database_name&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> data_length <span style="color:#66d9ef">desc</span>, index_length <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æŸ¥çœ‹æŒ‡å®šåº“ä¸­æ‰€æœ‰è¡¨çš„å®¹é‡å¤§å°</strong></li>
</ul>
<blockquote>
<ul>
<li>æŸ¥çœ‹<code>MySQL</code>ã€ŒæŒ‡å®šåº“ã€ä¸­ã€Œæ‰€æœ‰è¡¨ã€çš„å®¹é‡å¤§å°</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>table_schema <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span>table_name <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è¡¨å&#39;</span>,
</span></span><span style="display:flex;"><span>table_rows <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è®°å½•æ•°&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(data_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(index_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç´¢å¼•å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(DATA_FREE<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç¢ç‰‡å ç”¨(MB)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.<span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> table_schema<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;database_name&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> data_length <span style="color:#66d9ef">desc</span>, index_length <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æŸ¥çœ‹æŒ‡å®šåº“ä¸­æŒ‡å®šè¡¨çš„å®¹é‡å¤§å°</strong></li>
</ul>
<blockquote>
<ul>
<li>æŸ¥çœ‹<code>MySQL</code>ã€ŒæŒ‡å®šåº“ã€ä¸­ã€ŒæŒ‡å®šè¡¨ã€çš„å®¹é‡å¤§å°ï¼šå°†ä»£ç ä¸­<code>database_name</code>æ•°æ®åº“åæ”¹ä¸ºä½ è¦æŸ¥è¯¢çš„æ•°æ®åº“åï¼Œ<code>tables_name</code>æ”¹ä¸ºä½ è¦æŸ¥è¯¢çš„è¡¨å</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>table_schema <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span>table_name <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è¡¨å&#39;</span>,
</span></span><span style="display:flex;"><span>table_rows <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è®°å½•æ•°&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(data_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(index_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç´¢å¼•å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(DATA_FREE<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç¢ç‰‡å ç”¨(MB)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.<span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> table_schema<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;database_name&#39;</span><span style="color:#66d9ef">and</span> table_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tables_name&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> data_length <span style="color:#66d9ef">desc</span>, index_length <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢å¹¶ä¸”è¿›è¡ŒAESè§£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#a6e22e">aes_decrypt</span>(<span style="color:#a6e22e">from_base64</span>(mobile),<span style="color:#e6db74">&#39;key&#39;</span>,<span style="color:#e6db74">&#39;åŠ å¯†æ©ç &#39;</span>) <span style="color:#66d9ef">from</span> yl_users <span style="color:#66d9ef">where</span> member <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><strong>æ’æŸ¥<code>Mysql</code>å ç”¨å†…å­˜åŸå› </strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹MySQLçš„Pid</span>
</span></span><span style="display:flex;"><span>$ ps -ef | grep -i mysqld
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹MySQLå®æ—¶æ“ä½œç³»ç»Ÿçº¿ç¨‹Pid</span>
</span></span><span style="display:flex;"><span>$ top -p <span style="color:#e6db74">&#34;Mysql Pid&#34;</span> -H
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ•°æ®åº“ä¸­æŸ¥çœ‹Pid å…·ä½“æ“ä½œå†…å®¹</span>
</span></span><span style="display:flex;"><span>Mysql&gt; SELECT THREAD_ID,name ,PROCESSLIST_ID FROM <span style="color:#e6db74">`</span>performance_schema<span style="color:#e6db74">`</span>.threads WHERE THREAD_OS_ID <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Mysql Pid&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ ¹æ®è·å–åˆ°MySQLä¸­çš„ Thread_id è·å–SQL</span>
</span></span><span style="display:flex;"><span>mysql&gt; SELECT SQL_TEXT FROM <span style="color:#e6db74">`</span>performance_schema<span style="color:#e6db74">`</span>.events_statements_current WHERE THREAD_ID <span style="color:#f92672">=</span> Thread_id;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">###########################</span>
</span></span><span style="display:flex;"><span>mysql&gt; SELECT VARIABLE_NAME,VARIABLE_VALUE, CONCAT<span style="color:#f92672">(</span>VARIABLE_VALUE/1024/1024,<span style="color:#e6db74">&#39; MB&#39;</span><span style="color:#f92672">)</span> AS VARIABLE_VALUE_MB FROM information_schema.SESSION_VARIABLES WHERE VARIABLE_NAME IN <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;innodb_buffer_pool_size&#39;</span>,<span style="color:#e6db74">&#39;innodb_log_buffer_size&#39;</span>,<span style="color:#e6db74">&#39;innodb_additional_mem_pool_size&#39;</span>,<span style="color:#e6db74">&#39;key_buffer_size&#39;</span>,<span style="color:#e6db74">&#39;query_cache_size&#39;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; SHOW VARIABLES LIKE <span style="color:#e6db74">&#39;%show_compatibility_56%&#39;</span>;
</span></span><span style="display:flex;"><span>mysql&gt; SET GLOBAL show_compatibility_56<span style="color:#f92672">=</span>on;</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å…¶ä»–å‘½ä»¤">å…¶ä»–å‘½ä»¤</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># MySQL-master,æŸ¥çœ‹æ•°æ®åº“åç§»é‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> master status;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> reset master;  <span style="color:#75715e"># æ¸…ç†resetæ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»åº“æ‰§è¡Œï¼Œæµ‹è¯•è¿æ¥ä¸»åº“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span><span style="color:#66d9ef">show</span> grants;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> mysql_secure_installation  	<span style="color:#75715e"># mysqlå®‰å…¨é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Enter current password <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">root</span> (enter <span style="color:#66d9ef">for</span> none):  	<span style="color:#75715e"># è¾“å…¥è¿›å…¥æ•°æ®åº“å¯†ç ï¼Œé»˜è®¤ä¸ºç©ºï¼ŒæŒ‰å›è½¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">Set</span> root password<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]  	<span style="color:#75715e"># è®¾ç½®mysqlæ•°æ®åº“rootç”¨æˆ·çš„å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Remove anonymous users<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]  	<span style="color:#75715e"># ç§»é™¤åŒ¿åç”¨æˆ·Y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Disallow root login remotely<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]  	<span style="color:#75715e"># ä¸å…è®¸rootç”¨æˆ·è¿œç¨‹ç™»é™†Y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Remove test <span style="color:#66d9ef">database</span> <span style="color:#66d9ef">and</span> access <span style="color:#66d9ef">to</span> it<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]  	<span style="color:#75715e"># ç§»é™¤testæ•°æ®åº“å’Œè®¿é—®Y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Reload privilege <span style="color:#66d9ef">tables</span> now<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç­›é€‰æ•°æ®ä¸åŒå€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">distinct</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">15</span> <span style="color:#66d9ef">and</span> (<span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;é€‰é¡¹&#39;</span> <span style="color:#66d9ef">or</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;é€‰é¡¹&#39;</span>);
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#960050;background-color:#1e0010">åˆ—åã€åˆ—å</span> <span style="color:#66d9ef">desc</span>(<span style="color:#960050;background-color:#1e0010">é™åº</span>)<span style="color:#960050;background-color:#1e0010">ã€</span><span style="color:#66d9ef">asc</span>(<span style="color:#960050;background-color:#1e0010">å‡åºã€é»˜è®¤å‡åº</span>);
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># æŸ¥çœ‹å‰ä¸¤æ¡æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;é¦–ä¸ªå…³é”®å­—%&#39;</span>;  	<span style="color:#75715e"># %åŒ¹é…æ‰€æœ‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%xx%&#39;</span>;  	<span style="color:#75715e"># åå‘æŸ¥æ‰¾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">in</span> (<span style="color:#e6db74">&#39;å…³é”®å­—&#39;</span>,<span style="color:#960050;background-color:#1e0010">â€˜å…³é”®å­—â€™</span>)<span style="color:#960050;background-color:#1e0010">ï¼›</span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">between</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">and</span> <span style="color:#ae81ff">20</span>;  	<span style="color:#75715e"># é€‰å–1åˆ°20ä¹‹é—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">between</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">and</span> <span style="color:#ae81ff">20</span>;  	<span style="color:#75715e"># å–å
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> (<span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">between</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">and</span> <span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">and</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">in</span> (<span style="color:#e6db74">&#39;å…³é”®å­—&#39;</span>)<span style="color:#960050;background-color:#1e0010">ï¼›</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ–°ã€æ›´æ”¹æ•°æ®æ•°æ®ä»¥åŠç”¨æˆ·æƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">set</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;333&#39;</span>, <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cn&#39;</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;xxx&#39;</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">set</span> host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;root&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹æ•°æ®åº“åŒæ­¥çº¿ç¨‹mysql
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> global sync_binlog<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> global innodb_flush_log_at_trx_commit<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹sqlçº¿ç¨‹æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> STOP SLAVE SQL_THREAD;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SET</span> GLOBAL slave_parallel_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;LOGICAL_CLOCK&#39;</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SET</span> GLOBAL slave_parallel_workers<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>;  	
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> START SLAVE SQL_THREAD;	</span></span></code></pre></div></blockquote>
<hr>
<h2 id="mysqlæŸ¥è¯¢é”è¡¨è¯­å¥"><code>MySQL</code>æŸ¥è¯¢é”è¡¨è¯­å¥</h2>
<ul>
<li>
<ol>
<li><a href="https://www.cnblogs.com/better-farther-world2099/articles/14721482.html" rel="external" target="_self"><code>MySQL</code>æŸ¥è¯¢é”è¡¨è¯­å¥</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><strong>æŸ¥è¯¢æ˜¯å¦é”è¡¨</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> OPEN <span style="color:#66d9ef">TABLES</span> <span style="color:#66d9ef">where</span> In_use <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>;</span></span></code></pre></div><ul>
<li><strong>æŸ¥çœ‹æ­£åœ¨é”çš„äº‹åŠ¡</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_LOCKS; </span></span></code></pre></div><ul>
<li><strong>æŸ¥çœ‹ç­‰å¾…é”çš„äº‹åŠ¡</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_LOCK_WAITS;</span></span></code></pre></div><ul>
<li><strong>æŸ¥çœ‹å½“å‰çš„äº‹åŠ¡</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_TRX;</span></span></code></pre></div><ul>
<li><strong>æŸ¥çœ‹å½“å‰é”å®šçš„äº‹åŠ¡</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_LOCKS;</span></span></code></pre></div><ul>
<li><strong>æŸ¥çœ‹å½“å‰ç­‰é”çš„äº‹åŠ¡</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_LOCK_WAITS;</span></span></code></pre></div><ul>
<li><strong>æŸ¥è¯¢æ­»é”è¯¦æƒ…</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> r.trx_id waiting_trx_id,r.trx_mysql_thread_id waiting_thread,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">TIMESTAMPADD</span>(SECOND,r.trx_wait_started,<span style="color:#66d9ef">CURRENT_TIMESTAMP</span>) wait_time,
</span></span><span style="display:flex;"><span>r.trx_query waiting_query,
</span></span><span style="display:flex;"><span>l.lock_table waiting_table_lock,
</span></span><span style="display:flex;"><span>b.trx_id blocking_trx_id,b.trx_mysql_thread_id blocking_thread,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SUBSTRING</span>(p.<span style="color:#f92672">`</span>HOST<span style="color:#f92672">`</span>,<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">INSTR</span>(p.<span style="color:#f92672">`</span>HOST<span style="color:#f92672">`</span>,<span style="color:#e6db74">&#39;:&#39;</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) blocking_host,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SUBSTRING</span>(p.<span style="color:#f92672">`</span>HOST<span style="color:#f92672">`</span>,<span style="color:#a6e22e">INSTR</span>(p.<span style="color:#f92672">`</span>HOST<span style="color:#f92672">`</span>,<span style="color:#e6db74">&#39;:&#39;</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>) blocking_port,
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">IF</span>(p.COMMAND <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sleep&#39;</span>,p.<span style="color:#66d9ef">TIME</span>,<span style="color:#ae81ff">0</span>) idle_in_trx,
</span></span><span style="display:flex;"><span>b.trx_query blocking_query
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.INNODB_LOCK_WAITS w
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.INNODB_TRX b <span style="color:#66d9ef">ON</span> b.trx_id <span style="color:#f92672">=</span> w.blocking_lock_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.INNODB_TRX r <span style="color:#66d9ef">ON</span> r.trx_id <span style="color:#f92672">=</span> w.requesting_trx_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.INNODB_LOCKS l <span style="color:#66d9ef">ON</span> l.lock_id <span style="color:#f92672">=</span> w.requested_lock_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> information_schema.<span style="color:#f92672">`</span>PROCESSLIST<span style="color:#f92672">`</span> p <span style="color:#66d9ef">ON</span> p.id <span style="color:#f92672">=</span> b.trx_mysql_thread_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> wait_time <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<hr>
<h2 id="é…ç½®æ•°æ®åº“ä¸»ä»å¤åˆ¶">é…ç½®æ•°æ®åº“ä¸»ä»å¤åˆ¶</h2>
<ul>
<li>
<ol>
<li><strong>ä¸»æ•°æ®åº“é…ç½®ä»¥åŠæˆæƒ</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ID</span>
</span></span><span style="display:flex;"><span>$ server_id<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>hostname -I |awk <span style="color:#e6db74">&#34;{print </span>$1<span style="color:#e6db74">}&#34;</span>|awk -F<span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#e6db74">&#34;{print </span>$4<span style="color:#e6db74">}&#34;</span><span style="color:#e6db74">`</span>  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/server-id = 16303110/server-id = 16303</span>$server_id<span style="color:#e6db74">/g&#34;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆæƒä»åº“è¿æ¥è´¦æˆ·å¯†ç </span>
</span></span><span style="display:flex;"><span>mysql&gt; grant replication slave on *.* to myuser@<span style="color:#e6db74">&#39;host IP&#39;</span> identified by <span style="color:#e6db74">&#39;password&#39;</span>;
</span></span><span style="display:flex;"><span>mysql&gt; flush privileges;
</span></span><span style="display:flex;"><span>mysql&gt; reset master; <span style="color:#e6db74">&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><strong>é…ç½®ä»åº“è¿æ¥ä¸»åº“</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ID</span>
</span></span><span style="display:flex;"><span>$ server_id<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>hostname -I |awk <span style="color:#e6db74">&#39;{print $1}&#39;</span>|awk -F<span style="color:#e6db74">&#39;.&#39;</span> <span style="color:#e6db74">&#39;{print $4}&#39;</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/server-id = 16303110/server-id = 16303</span>$server_id<span style="color:#e6db74">/g&#34;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®è¿æ¥ä¸»åº“</span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p -S /tmp/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e <span style="color:#e6db74">&#34;CHANGE MASTER TO MASTER_HOST=&#39;127.0.0.1&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_USER=&#39;myuser&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PASSWORD=&#39;password&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PORT=16303, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_LOG_FILE=&#39;mysql-bin.000001&#39;, \  	# ä¸»æœºshow master status;ä¸­çš„File
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_LOG_POS=154,MASTER_CONNECT_RETRY=15;&#34;</span>  	<span style="color:#75715e"># ä¸»æœºshow master status;ä¸­çš„Position.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p -S /tmp/mysql.sock -e <span style="color:#e6db74">&#34;start slave;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p -S /tmp/mysql.sock -e <span style="color:#e6db74">&#34;show slave status\G&#34;</span></span></span></code></pre></div><ul>
<li><strong>é…ç½®å¤šæºå¤åˆ¶</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p -S /tmp/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e <span style="color:#e6db74">&#34;CHANGE MASTER TO MASTER_HOST=&#39;127.0.0.1&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_USER=&#39;myuser&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PASSWORD=&#39;password&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PORT=16303, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">master_auto_position=1  for  channel &#39;rep_master_1&#39;;&#34;</span>  	<span style="color:#75715e"># åå•†ã€å®šä¹‰é¢‘é“å‡ ä¸ªä¸»æœºå®šä¹‰å‡ æ¬¡ã€‚</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h2 id="æ•°æ®åº“å¼€å¯gtidæµç¨‹">æ•°æ®åº“å¼€å¯<code>GTID</code>æµç¨‹</h2>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å¦‚æœå¯ä»¥å…ˆæš‚åœä¸šåŠ¡ï¼ŒæŸ¥è¯¢æ˜¯å¦è¿˜æœ‰ä¸šåŠ¡è¿æ¥</span>
</span></span><span style="display:flex;"><span>mysql&gt; show processlist;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»ä»ä¾æ¬¡æ‰§è¡Œï¼šä¸»åº“æ‰§è¡Œå¥½åï¼Œå»ä»åº“æ‰§è¡Œ ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY<span style="color:#f92672">=</span>WARN;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢ä¸»ä»é”™è¯¯æ—¥å¿—ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰æŠ¥é”™ï¼Œåœ¨åšä¸‹ä¸€æ­¥</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»åº“æ‰§è¡Œå¥½åï¼Œå»ä»åº“æ‰§è¡Œ ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY<span style="color:#f92672">=</span>ON;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»åº“æ‰§è¡Œå¥½åï¼Œå»ä»åº“æ‰§è¡Œ ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.GTID_MODE<span style="color:#f92672">=</span>OFF_PERMISSIVE;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»åº“æ‰§è¡Œå¥½åï¼Œå»ä»åº“æ‰§è¡Œ ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.GTID_MODE<span style="color:#f92672">=</span>ON_PERMISSIVE;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»åº“æŸ¥è¯¢ï¼šç­‰å¾…ä»åº“è¿™ä¸ªçŠ¶æ€å˜ä¸º0</span>
</span></span><span style="display:flex;"><span>mysql&gt; show status like <span style="color:#e6db74">&#39;ONGOING_ANONYMOUS_TRANSACTION_COUNT&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»ä»æ‰§è¡Œï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.gtid_mode<span style="color:#f92672">=</span>on;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»åº“æ‰§è¡Œï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; stop slave;
</span></span><span style="display:flex;"><span>mysql&gt; change master to master_auto_position<span style="color:#f92672">=</span>1;
</span></span><span style="display:flex;"><span>mysql&gt; start slave;</span></span></code></pre></div></blockquote>
<hr>
<h2 id="mysqlå¼€å¯æ—¥å¿—å®¡è®¡"><code>Mysql</code>å¼€å¯æ—¥å¿—å®¡è®¡</h2>
<blockquote>
<ul>
<li></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¿æ¥æ•°æ®åº“æ‰§è¡Œè¯­å¥ï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; CREATE TABLE <span style="color:#e6db74">`</span>mysql<span style="color:#e6db74">`</span>.<span style="color:#e6db74">`</span>audit_login<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>ID<span style="color:#e6db74">`</span> bigint NOT NULL AUTO_INCREMENT COMMENT <span style="color:#e6db74">&#39;è‡ªå¢ID&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>USER<span style="color:#e6db74">`</span> varchar<span style="color:#f92672">(</span>128<span style="color:#f92672">)</span>  NOT NULL COMMENT <span style="color:#e6db74">&#39;æ•°æ®åº“ä¸­çš„ç”¨æˆ·&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>HOST<span style="color:#e6db74">`</span> varchar<span style="color:#f92672">(</span>64<span style="color:#f92672">)</span>  DEFAULT NULL COMMENT <span style="color:#e6db74">&#39;ç™»å½•çš„IP&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>DB<span style="color:#e6db74">`</span> varchar<span style="color:#f92672">(</span>64<span style="color:#f92672">)</span>  DEFAULT NULL COMMENT <span style="color:#e6db74">&#39;è®¿é—®çš„æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>PROCESSLIST_ID<span style="color:#e6db74">`</span> bigint NOT NULL COMMENT <span style="color:#e6db74">&#39;ç”¨æˆ·è¿æ¥&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>LOGIN_TIME<span style="color:#e6db74">`</span> datetime<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> DEFAULT CURRENT_TIMESTAMP<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> COMMENT <span style="color:#e6db74">&#39;ç™»å½•æ—¶é—´&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>UPDATE_TIME<span style="color:#e6db74">`</span> datetime<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> DEFAULT CURRENT_TIMESTAMP<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> ON UPDATE CURRENT_TIMESTAMP<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> COMMENT <span style="color:#e6db74">&#39;è®°å½•è¿™è¡Œæ•°æ®ä¸Šæ¬¡è¢«ä¿®æ”¹çš„æ—¶é—´,é»˜è®¤ç­‰äºLOGIN_TIME&#39;</span>,
</span></span><span style="display:flex;"><span>PRIMARY KEY <span style="color:#f92672">(</span><span style="color:#e6db74">`</span>ID<span style="color:#e6db74">`</span><span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>KEY <span style="color:#e6db74">`</span>IDX_USER<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span><span style="color:#e6db74">`</span>USER<span style="color:#e6db74">`</span><span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>KEY <span style="color:#e6db74">`</span>IDX_HOST<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span><span style="color:#e6db74">`</span>HOST<span style="color:#e6db74">`</span><span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>KEY <span style="color:#e6db74">`</span>IDX_LOGIN_TIME<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span><span style="color:#e6db74">`</span>LOGIN_TIME<span style="color:#e6db74">`</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span> ENGINE<span style="color:#f92672">=</span>InnoDB COMMENT <span style="color:#e6db74">&#34;ç”¨æˆ·ç™»å½•å®¡è®¡æ—¥å¿—è¡¨&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢æˆæƒSQLï¼Œå¤åˆ¶æŸ¥è¯¢å‡ºæ¥çš„SQLè¯­å¥ï¼Œæ‰§è¡Œæˆæƒ</span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#66d9ef">select</span> concat<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;grant select,insert on mysql.audit_login to &#39;&#34;</span>,user,<span style="color:#e6db74">&#34;&#39;@&#39;&#34;</span>,host,<span style="color:#e6db74">&#34;&#39;;&#34;</span><span style="color:#f92672">)</span> grants_sql from mysql.user where user not in <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;mysql.session&#39;</span>,<span style="color:#e6db74">&#39;mysql.sys&#39;</span><span style="color:#f92672">)</span> and Super_priv<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;N&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰§è¡Œï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; set global init_connect<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;insert into mysql.audit_login(USER,HOST,DB,PROCESSLIST_ID) values(current_user(),substring_index(user(),&#39;@&#39;,-1),database(),connection_id());&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®å‚æ•°æ–‡ä»¶ï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysqld<span style="color:#f92672">]</span> 
</span></span><span style="display:flex;"><span>init_connect<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;insert into mysql.audit_login(USER,HOST,DB,PROCESSLIST_ID) values(current_user(),substring_index(user(),&#39;@&#39;,-1),database(),connection_id());&#34;</span>;  <span style="color:#75715e">#DBA add</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æœ€åæ‰§è¡Œçœ‹çœ‹æœ‰æ²¡æœ‰æ•°æ®ï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#66d9ef">select</span> * from mysql.audit_login;</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ä¸»ä»è·³è¿‡å¤åˆ¶é”™è¯¯">ä¸»ä»è·³è¿‡å¤åˆ¶é”™è¯¯</h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://blog.51cto.com/arthur376/1969935" rel="external" target="_self">ä¸»ä»è·³è¿‡å¤åˆ¶é”™è¯¯</a></li>
</ol>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># åœæ­¢å¤åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> slave stop;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾å®šè·³è¿‡ä¸€ä¸ªäº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SET</span> GLOBAL SQL_SLAVE_SKIP_COUNTER <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°å¼€å¯å¤åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span>slave start
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿™æ ·å°±æ­£å¸¸äº†ï¼Œä½†æ˜¯ï¼Œå½“ç„¶è¿˜æ˜¯è¦æŠŠæ•°æ®ä¿®æ”¹ä¸Šå»
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span><span style="color:#66d9ef">update</span> <span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">set</span> <span style="color:#960050;background-color:#1e0010">ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="sqlä¼˜åŒ–å®¡æ ¸å¹³å°å·¥å…·"><code>SQL</code>ä¼˜åŒ–ã€å®¡æ ¸å¹³å°å·¥å…·</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…<a href="https://guide.yearning.io/install.html" rel="external" target="_self"><code>Yearning</code></a><code>SQL</code>å®¡æ ¸å·¥å…·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é»˜è®¤è´¦å·/å¯†ç ï¼š<!-- raw HTML omitted --><code>admin/Yearning_admin</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install wget unzip
</span></span><span style="display:flex;"><span>$ wget -P /opt/src/ https://github.com/cookieY/Yearning/releases/download/v3.1.0/Yearning-v3.1.0-linux-amd64.zip  
</span></span><span style="display:flex;"><span>$ unzip -d /opt/yearning /opt/src/Yearning-v3.1.0-linux-amd64.zip  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/Port = &#34;</span>3306<span style="color:#e6db74">&#34;/Port = &#34;</span>16303<span style="color:#e6db74">&#34;/g&#34;</span> /opt/apps/yearning/conf.toml  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/Password = &#39;xxxx&#39;/Password = &#39;p@ssw0rd&#39;/g&#34;</span> /opt/apps/yearning/conf.toml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /bin/mysql -uroot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -S /opt/data/data_16303/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -p -e <span style="color:#e6db74">&#34;create database Yearning DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ bin/mysql -uroot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -S /opt/data/data_16303/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -p -e <span style="color:#e6db74">&#34;grant all on *.* to root@&#39;127.0.0.1&#39; identified by &#34;</span>p@ssw0rd<span style="color:#e6db74">&#34;;&#34;</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./Yearning install  	<span style="color:#75715e"># å…ˆåˆå§‹åŒ–</span>
</span></span><span style="display:flex;"><span>$ ./Yearning run
</span></span><span style="display:flex;"><span>$ ./Yearning run --push <span style="color:#e6db74">&#34;åŸŸåã€æˆ–è€…IPåœ°å€&#34;</span> --port <span style="color:#e6db74">&#34;8000&#34;</span>  	<span style="color:#75715e"># æŒ‡å®šåŸŸåç«¯å£æ–¹å¼å¯åŠ¨</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å®‰è£…ç¾å›¢<code>SQL</code>ä¼˜åŒ–å·¥å…·<a href="https://github.com/Meituan-Dianping/SQLAdvisor/blob/master/doc/QUICK_START.md" rel="external" target="_self"><code>SQL-Advisor</code></a><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://segmentfault.com/a/1190000022883633" rel="external" target="_self"><code>MySQL-SQLAdvisor</code>çš„ç®€å•å®‰è£…ä½¿ç”¨</a></li>
<li><a href="https://tech.meituan.com/2017/03/09/sqladvisor-pr.html" rel="external" target="_self">ç¾å›¢ç‚¹è¯„<code>SQL</code>ä¼˜åŒ–å·¥å…·<code>SQLAdvisor</code>å¼€æº</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install git wget cmake libaio-devel libffi-devel glib2 glib2-devel  
</span></span><span style="display:flex;"><span>$ yum -y install --enablerepo<span style="color:#f92672">=</span>Percona56 Percona-Server-shared-56  
</span></span><span style="display:flex;"><span>$ git clone https://github.com/Meituan-Dianping/SQLAdvisor.git /opt/src/sqladvisor  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd /opt/src/sqladvisor
</span></span><span style="display:flex;"><span>$ cmake -DBUILD_CONFIG<span style="color:#f92672">=</span>mysql_release <span style="color:#ae81ff">\ </span>
</span></span><span style="display:flex;"><span> -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span>debug <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span>/usr/local/sqlparser ./
</span></span><span style="display:flex;"><span>$ make <span style="color:#f92672">&amp;&amp;</span> make install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. DCMAKE_INSTALL_PREFIXä¸ºsqlparseråº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶çš„å®‰è£…ç›®å½•ï¼Œå…¶ä¸­libç›®å½•åŒ…å«åº“æ–‡ä»¶libsqlparser.soï¼Œincludeç›®å½•åŒ…å«æ‰€éœ€çš„æ‰€æœ‰å¤´æ–‡ä»¶ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. DCMAKE_INSTALL_PREFIXå€¼å°½é‡ä¸è¦ä¿®æ”¹ï¼Œåé¢å®‰è£…ä¾èµ–è¿™ä¸ªç›®å½•ã€‚  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd SQLAdvisor/sqladvisor/
</span></span><span style="display:flex;"><span>$ cmake -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span>debug ./
</span></span><span style="display:flex;"><span>$ make
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨æœ¬è·¯å¾„ä¸‹ç”Ÿæˆä¸€ä¸ªsqladvisorå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™å³æ˜¯æˆ‘ä»¬æƒ³è¦</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;sql.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[sqladvisor]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">username=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dbname=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sqls=sql1;sql2;sql3....
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cmd: ./sqladvisor -f sql.cnf  -v 1</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><a href="https://www.justdojava.com/2021/07/20/canal/" rel="external" target="_self">ç›‘å¬<code>MySQL binlog</code>å®ç°æ•°æ®å˜åŒ–åçš„å®æ—¶é€šçŸ¥</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://github.com/alibaba/canal" rel="external" target="_self"><code>Github Alibaba Canal</code></a></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>explain</code><!-- raw HTML omitted -->çš„ä½¿ç”¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://developer.aliyun.com/article/1104750#slide-12" rel="external" target="_self"><code>Mysql</code>ä¼˜åŒ–é«˜çº§ç¯‡</a></li>
<li><code>explain</code>+<code>sql</code>è¯­å¥</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> Tables_name;</span></span></code></pre></div><blockquote>
<ul>
<li><code>id</code>ï¼šè¡¨çš„è¯»å–é¡ºåº</li>
<li><code>select_type</code>ï¼šæ•°æ®è¯»å–æ“ä½œçš„æ“ä½œç±»å‹</li>
<li><code>possible_keys</code>ï¼šå“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨</li>
<li><code>key</code>ï¼šå“ªäº›ç´¢å¼•è¢«å®é™…ä½¿ç”¨</li>
<li><code>ref</code>ï¼šè¡¨ä¹‹é—´çš„å¼•ç”¨</li>
<li><code>rows</code>ï¼šæ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢</li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="5">
<li><code>SQL</code>å®¡è®¡</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.jianshu.com/p/513b7c95e1e8" rel="external" target="_self"><code>MySQL</code>å®¡è®¡æ’ä»¶ä»‹ç»</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥æ•°æ®åº“å®‰è£…å®¡è®¡æ’ä»¶</span>
</span></span><span style="display:flex;"><span>mysql&gt; INSTALL PLUGIN server_audit SONAME <span style="color:#e6db74">&#39;server_audit.so&#39;</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.07 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; show plugins;
</span></span><span style="display:flex;"><span>+----------------------------+--------+--------------------+-----------------+---------+
</span></span><span style="display:flex;"><span>| Name                       | Status | Type               | Library         | License |
</span></span><span style="display:flex;"><span>+----------------------------+--------+--------------------+-----------------+---------+
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>| SERVER_AUDIT               | ACTIVE | AUDIT              | server_audit.so | GPL     |
</span></span><span style="display:flex;"><span>+----------------------------+--------+--------------------+-----------------+---------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ audit åˆå§‹å‚æ•°é…ç½®</span>
</span></span><span style="display:flex;"><span>mysql&gt; show variables like <span style="color:#e6db74">&#39;%audit%&#39;</span>;
</span></span><span style="display:flex;"><span>+-------------------------------+-----------------------+
</span></span><span style="display:flex;"><span>| Variable_name                 | Value                 |
</span></span><span style="display:flex;"><span>+-------------------------------+-----------------------+
</span></span><span style="display:flex;"><span>| server_audit_events           |                       |
</span></span><span style="display:flex;"><span>| server_audit_excl_users       |                       |
</span></span><span style="display:flex;"><span>| server_audit_file_path        | server_audit.log      |
</span></span><span style="display:flex;"><span>| server_audit_file_rotate_now  | OFF                   |
</span></span><span style="display:flex;"><span>| server_audit_file_rotate_size | <span style="color:#ae81ff">1000000</span>               |
</span></span><span style="display:flex;"><span>| server_audit_file_rotations   | <span style="color:#ae81ff">9</span>                     |
</span></span><span style="display:flex;"><span>| server_audit_incl_users       |                       |
</span></span><span style="display:flex;"><span>| server_audit_loc_info         |                       |
</span></span><span style="display:flex;"><span>| server_audit_logging          | OFF                   |
</span></span><span style="display:flex;"><span>| server_audit_mode             | <span style="color:#ae81ff">1</span>                     |
</span></span><span style="display:flex;"><span>| server_audit_output_type      | file                  |
</span></span><span style="display:flex;"><span>| server_audit_query_log_limit  | <span style="color:#ae81ff">1024</span>                  |
</span></span><span style="display:flex;"><span>| server_audit_syslog_facility  | LOG_USER              |
</span></span><span style="display:flex;"><span>| server_audit_syslog_ident     | mysql-server_auditing |
</span></span><span style="display:flex;"><span>| server_audit_syslog_info      |                       |
</span></span><span style="display:flex;"><span>| server_audit_syslog_priority  | LOG_INFO              |
</span></span><span style="display:flex;"><span>+-------------------------------+-----------------------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨çº¿å¼€å¯å®¡è®¡</span>
</span></span><span style="display:flex;"><span>mysql&gt; set global server_audit_logging<span style="color:#f92672">=</span>on;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.00 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; set global server_audit_events<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;connect,table,query_ddl,query_dcl,query_dml_no_select&#39;</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.00 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; set global server_audit_file_path <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/data/mysql/logs/server_audit.log&#39;</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.00 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; set global server_audit_file_rotate_size<span style="color:#f92672">=</span>104857600;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.01 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [mysqld]ä¸‹æ·»åŠ ä»¥ä¸‹é…ç½® ä½¿å¾—æ°¸ä¹…ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>server_audit<span style="color:#f92672">=</span>FORCE_PLUS_PERMANENT
</span></span><span style="display:flex;"><span>server_audit_logging<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span>server_audit_file_path<span style="color:#f92672">=</span>/data/mysql/logs/server_audit.log         
</span></span><span style="display:flex;"><span>server_audit_events<span style="color:#f92672">=</span>connect,table,query_ddl,query_dcl,query_dml_no_select
</span></span><span style="display:flex;"><span>server_audit_file_rotate_size<span style="color:#f92672">=</span><span style="color:#ae81ff">104857600</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_mysql">Install_Mysql</h1>

<h2 id="éƒ¨ç½²mysql-57">éƒ¨ç½²<code>Mysql 5.7</code></h2>
<blockquote>
<ul>
<li><a href="https://www.cnblogs.com/lyhabc/p/6136227.html" rel="external" target="_self">ä»0å¼€å§‹æ­å»º<code>SQL Server AlwaysOn</code>ç¬¬å››ç¯‡-é…ç½®å¼‚åœ°æœºæˆ¿èŠ‚ç‚¹</a></li>
<li><a href="https://downloads.mysql.com/archives/" rel="external" target="_self"><code>Mysql</code>äº§å“æ¡£æ¡ˆ</a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…æ‰©å±•ä¸‹è½½<code>Mysql</code>å¹¶è§£å‹å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Debianç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>$ sudo apt-get install build-essential cmake bison libncurses5-dev libssl-dev pkg-config g++ libaio1 libnuma1 libncurses5
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CentOS </span>
</span></span><span style="display:flex;"><span>$ yum -y remove mariadb* mariadb
</span></span><span style="display:flex;"><span>$ yum -y install numactl libaio* wget git epel-release
</span></span><span style="display:flex;"><span>$ yum -y install  https://mirrors.cloud.tencent.com/percona/release/7/RPMS/noarch/percona-release-0.1-4.noarch.rpm
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/gpgcheck = 1/gpgcheck = 0/g&#34;</span> /etc/yum.repos.d/percona-release.repo
</span></span><span style="display:flex;"><span>$ yum -y install percona-xtrabackup-24 qpress
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>$ cp -r /usr/local/src/mysql-5.7.28-linux-glibc2.12-x86_64 /usr/local/mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->è®¾ç½®æƒé™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ groupadd mysql
</span></span><span style="display:flex;"><span>$ useradd -r -g mysql mysql
</span></span><span style="display:flex;"><span>$ cd /usr/local/
</span></span><span style="display:flex;"><span>$ chown -R mysql:mysql ./mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åˆå§‹åŒ–æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/mysql/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ bin/mysqld --initialize --user<span style="color:#f92672">=</span>mysql --basedir<span style="color:#f92672">=</span>/usr/local/mysql --datadir<span style="color:#f92672">=</span>/usr/local/mysql/data
</span></span><span style="display:flex;"><span>$ bin/mysql_ssl_rsa_setup --datadir<span style="color:#f92672">=</span>/usr/local/mysql/data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chown -R mysql:mysql /usr/local/mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqld --verbose --help  	<span style="color:#75715e"># æŸ¥çœ‹å®Œæ•´åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;[mysqld]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">character_set_server=utf8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">init_connect=&#39;</span>SET NAMES utf8<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basedir=/usr/local/mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">datadir=/usr/local/mysql/data  	# æ•°æ®ç›®å½•æœ€å¥½å¤–æŒ‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socket=/tmp/mysql.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å¯binlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-bin = mysql-bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">binlog_format = ROW
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">expire_logs_days = 7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server-id=3306110  	# ç«¯å£åŠ æœ¬æœºIPæœ€åå‡ ä½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ä¸åŒºåˆ†å¤§å°å†™ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lower_case_table_names = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ä¸å¼€å¯sqlä¸¥æ ¼æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sql_mode = &#34;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-error=/usr/local/mysql/data/mysqld.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pid-file=/usr/local/mysql/data/mysqld.pid&#39;</span> &gt; /etc/my.cnf</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ä¿®æ”¹å¯åŠ¨æ–‡ä»¶é…ç½®å‚æ•°å¹¶å¯åŠ¨æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqlconf<span style="color:#f92672">=</span>/etc/init.d/mysqld
</span></span><span style="display:flex;"><span>$ cp /usr/local/mysql/support-files/mysql.server  $mysqlconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;46s,basedir=,basedir=/usr/local/mysql,&#39;</span> $mysqlconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;47s,datadir=,datadir=/usr/local/mysql/data,&#39;</span> $mysqlconf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ service mysqld start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ è½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/mysql/bin/mysql /usr/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>$ netstat -nuplt | grep :3306
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é˜²ç«å¢™å¼€æ”¾ç«¯å£</span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --new-ipset<span style="color:#f92672">=</span>db_whitelist --type<span style="color:#f92672">=</span>hash:ip  
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --add-rich-rule<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rule family=&#39;ipv4&#39; source ipset=&#39;db_whitelist&#39; port port=&#39;16303&#39; protocol=&#39;tcp&#39; accept&#34;</span>  
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<hr>
<h2 id="å®‰è£…mysql-8">å®‰è£…<code>Mysql 8</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…æ‰©å±•ä¸‹è½½<code>Mysql</code>å¹¶è§£å‹å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y remove mariadb* mariadb
</span></span><span style="display:flex;"><span>$ yum -y install ncurses-compat-libs wget git epel-release
</span></span><span style="display:flex;"><span>$ yum -y install  https://mirrors.cloud.tencent.com/percona/release/7/RPMS/noarch/percona-release-0.1-4.noarch.rpm
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/gpgcheck = 1/gpgcheck = 0/g&#34;</span> /etc/yum.repos.d/percona-release.repo
</span></span><span style="display:flex;"><span>$ yum -y install percona-xtrabackup-24 qpress numactl libaio*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mkdir -p /usr/local/mysql <span style="color:#f92672">&amp;&amp;</span> tar -xvf /usr/local/src/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz -C /usr/local/mysql --strip-components <span style="color:#ae81ff">1</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->è®¾ç½®æƒé™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ groupadd mysql
</span></span><span style="display:flex;"><span>$ useradd -r -g mysql mysql
</span></span><span style="display:flex;"><span>$ cd /usr/local/
</span></span><span style="display:flex;"><span>$ chown -R mysql:mysql ./mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åˆå§‹åŒ–æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysqld --initialize --user<span style="color:#f92672">=</span>mysql --basedir<span style="color:#f92672">=</span>/usr/local/mysql --datadir<span style="color:#f92672">=</span>/usr/local/mysql/data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql_ssl_rsa_setup --datadir<span style="color:#f92672">=</span>/usr/local/mysql/data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysqld_safe --datadir<span style="color:#f92672">=</span>/usr/local/mysql/data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chown -R mysql:mysql /usr/local/mysql </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;[mysqld]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">character_set_server=utf8mb4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">init_connect=&#39;</span>SET NAMES utf8<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basedir=/usr/local/mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">datadir=/usr/local/mysql/data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socket=/tmp/mysql.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å¯binlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-bin = mysql-bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">binlog_format = ROW
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">expire_logs_days = 7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server-id=3306110  	# ç«¯å£åŠ æœ¬æœºIPæœ€åå‡ ä½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ä¸åŒºåˆ†å¤§å°å†™ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lower_case_table_names = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ä¸å¼€å¯sqlä¸¥æ ¼æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## sql_mode = &#34;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sql_mode=&#39;</span>STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_authentication_plugin= mysql_native_password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-error=/var/log/mysqld.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pid-file=/usr/local/mysql/data/mysqld.pid&#39;</span> &gt;/etc/my.cnf</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ä¿®æ”¹å¯åŠ¨æ–‡ä»¶é…ç½®å‚æ•°å¹¶å¯åŠ¨æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqlconf<span style="color:#f92672">=</span>/etc/init.d/mysqld
</span></span><span style="display:flex;"><span>$ cp /usr/local/mysql/support-files/mysql.server $mysqlconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;46s,basedir=,basedir=/usr/local/mysql,&#39;</span> $mysqlconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;47s,datadir=,datadir=/usr/local/mysql/data,&#39;</span> $mysqlconf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ service mysqld start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ è½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/mysql/bin/mysql /usr/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>$ netstat -nuplt | grep :3306
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é˜²ç«å¢™å¼€æ”¾ç«¯å£</span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --new-ipset<span style="color:#f92672">=</span>db_whitelist --type<span style="color:#f92672">=</span>hash:ip  
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --add-rich-rule<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rule family=&#39;ipv4&#39; source ipset=&#39;db_whitelist&#39; port port=&#39;16303&#39; protocol=&#39;tcp&#39; accept&#34;</span>  
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<hr>
<h2 id="æ™®é€šç”¨æˆ·éƒ¨ç½²mysql-8">æ™®é€šç”¨æˆ·éƒ¨ç½²<code>Mysql 8</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…æ‰©å±•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Linux8/Red Hat8(EL8)ï¼šè¿™äº›å¹³å°é»˜è®¤ä¸å®‰è£…æ–‡ä»¶/lib64/libtinfo.so.5ï¼ŒMySQLå®¢æˆ·ç«¯bin/mysqléœ€è¦è¯¥æ–‡ä»¶æ¥å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ yum -y install ncurses-compat-libs wget git epel-release
</span></span><span style="display:flex;"><span>$ yum -y install  http://www.percona.com/downloads/percona-release/redhat/0.1-4/percona-release-0.1-4.noarch.rpm  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/gpgcheck = 1/gpgcheck = 0/g&#34;</span> /etc/yum.repos.d/percona-release.repo
</span></span><span style="display:flex;"><span>$ yum -y install percona-xtrabackup-24 qpress numactl libaio*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ›å»ºç”¨æˆ·ä»¥åŠç¨‹åºä½¿ç”¨ç›®å½•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ groupadd myadmin <span style="color:#f92672">&amp;&amp;</span> useradd -g myadmin myadmin  	<span style="color:#75715e"># åˆ›å»ºç¨‹åºè¿è¡Œç”¨æˆ·  </span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;password&#34;</span>|passwd --stdin myadmin &amp;&gt;/dev/null
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mkdir -p /opt/<span style="color:#f92672">{</span>apps,conf,src,backup,scripts,dataï¼Œlogs<span style="color:#f92672">}</span> /opt/data/<span style="color:#f92672">{</span>data_16303,data_16304<span style="color:#f92672">}</span> /opt/logs/mysql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$echo <span style="color:#e6db74">&#34;#####  Start/Stop Service  #####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Cmnd_Alias MYADMIN_START_SERVICES = /etc/init.d/mysql, /etc/init.d/mysql.server, /opt/*  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">swadmin ALL=(ALL)NOPASSWD:MYADMIN_START_SERVICES &#34;</span>&gt;/etc/sudoers.d/myadmin  
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">660</span> /etc/sudoers.d/myadmin  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œæ–¹ä¾¿ä½¿ç”¨é…ç½®æ–‡ä»¶åˆå§‹åŒ–æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;[mysqld]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">character_set_server=utf8mb4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">init_connect=&#39;</span>SET NAMES utf8<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basedir=/opt/apps/mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">datadir=/opt/data/data_16303
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socket=/tmp/mysql.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¸åŒºåˆ†å¤§å°å†™ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lower_case_table_names = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¸å¼€å¯sqlä¸¥æ ¼æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sql_mode = &#34;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-error=/opt/logs/mysql/mysqld.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pid-file=/opt/data/data_16303/mysqld.pid&#39;</span> &gt; /opt/conf/mysql/mysql_master_16303.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chown -R myadmin:myadmin /opt/*</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ä½¿ç”¨æ™®é€šç”¨æˆ·ä¸‹è½½å®‰è£…<code>Mysql 8</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ su myadmin -c <span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wget -P /opt/src/ https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mkdir -p /opt/apps/mysql &amp;&amp; tar xvf /opt/src/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz -C /opt/apps/mysql --strip-components 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">chmod 750 /opt/apps/mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/mysql/bin/mysqld --defaults-file=/opt/conf/mysql/my.cnf --initialize-insecure --user=myadmin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/mysql/bin/mysql_ssl_rsa_setup --defaults-file=/opt/conf/mysql/my.cnf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/mysql/bin/mysqld_safe --defaults-file=/opt/conf/mysql/my.cnf --user=myadmin &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ä¿®æ”¹å¯åŠ¨æ–‡ä»¶é…ç½®å‚æ•°å¹¶å¯åŠ¨æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqlconf<span style="color:#f92672">=</span>/etc/init.d/mysqld
</span></span><span style="display:flex;"><span>$ cp /opt/apps/mysql/support-files/mysql.serverr $mysqlconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;46s,basedir=,basedir=/opt/apps/mysql,&#39;</span> $mysqlconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;47s,datadir=,datadir=/opt/data/data_16303,&#39;</span> $mysqlconf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;alias nginx=&#39;sudo /etc/init.d/nginx&#39;  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alias tomcat=&#39;sudo /etc/init.d/tomcat&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alias mysqld=&#39;sudo /etc/init.d/mysqld&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alias redis=&#39;sudo /etc/init.d/redis&#39; &#34;</span>&gt;&gt;/home/myadmin/.bashrc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ service mysqld start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ è½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/mysql/bin/mysql /usr/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>$ netstat -nuplt | grep :3306
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é˜²ç«å¢™å¼€æ”¾ç«¯å£</span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --new-ipset<span style="color:#f92672">=</span>db_whitelist --type<span style="color:#f92672">=</span>hash:ip  
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --add-rich-rule<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rule family=&#39;ipv4&#39; source ipset=&#39;db_whitelist&#39; port port=&#39;16303&#39; protocol=&#39;tcp&#39; accept&#34;</span>  
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="email">Email</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Email</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_iredmail">Install_iRedMail</h1>

<h2 id="ireadmail"><code>iReadMail</code></h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æœåŠ¡å™¨å¿…é¡»å¼€é€šç«¯å£<!-- raw HTML omitted --><code>25</code></li>
<li><!-- raw HTML omitted -->ç¡¬ä»¶è¦æ±‚å†…å­˜æœ€å°‘<!-- raw HTML omitted --><code>4G</code></li>
<li><!-- raw HTML omitted -->ç¡®ä¿æœåŠ¡å™¨ä¸­<!-- raw HTML omitted --><code>UID/GID</code><!-- raw HTML omitted -->æ²¡æœ‰ä½¿ç”¨<!-- raw HTML omitted --><code>2000ã€2001ã€2002</code></li>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>dig</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo apt-get install dnsutils
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum install bind-utils  </span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦æ”¯æŒ<!-- raw HTML omitted --><code>PTR Pointer Records</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dig -x ipåœ°å€
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo nslookup set type<span style="color:#f92672">=</span>PTR ipåœ°å€</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><a href="https://docs.iredmail.org/install.iredmail.on.debian.ubuntu.html#system-requirements" rel="external" target="_self">å®‰è£…å‰å‡†å¤‡ã€å®‰è£…æ–‡æ¡£</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>è®¾ç½®ä¸»æœºå</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo hostnamectl set-hostname email_name</span></span></code></pre></div><ul>
<li>æ·»åŠ åˆ°<code>hosts</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/hosts<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">127.0.1.1	email.domain.com email
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ hostname <span style="color:#f92672">&amp;&amp;</span> hostname -f  	<span style="color:#75715e">#  ç¡®è®¤æ˜¯å¦ä¿®æ”¹</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>ä¸‹è½½å®‰è£…åŒ…å®‰è£…<code>iRedMail</code>æœåŠ¡</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo apt-get install -y gzip dialog  	<span style="color:#75715e"># å®‰è£…æ‰€éœ€å®‰è£…åŒ…</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget https://github.com/iredmail/iRedMail/archive/refs/tags/1.6.8.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar zxvf 1.6.8.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd /opt/email/iRedMail-1.6.8/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo bash iRedMail.sh</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li>å›¾å½¢å®‰è£…æç¤º</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>æ¬¢è¿å¹¶æ„Ÿè°¢æ‚¨çš„ä½¿ç”¨</li>
</ul>
<p><a href="#R-image-d2267caf1d231098f5a1407f9d0dcd0c" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-40-52.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d2267caf1d231098f5a1407f9d0dcd0c"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-40-52.png"></a></p>
<ul>
<li>
<p>æŒ‡å®šå­˜å‚¨æ‰€æœ‰é‚®ç®±çš„ä½ç½®ã€‚é»˜è®¤ä¸º<code>/var/vmail/</code></p>
</li>
<li>
<p>æ˜¯å¦ä½¿ç”¨<code>Web</code>æœåŠ¡</p>
</li>
</ul>
<p><a href="#R-image-da6d2cb0bb274a19ba597f819cae64ba" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-44-47.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-da6d2cb0bb274a19ba597f819cae64ba"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-44-47.png"></a></p>
<ul>
<li>é€‰æ‹©å®‰è£…æ•°æ®åº“</li>
</ul>
<p><a href="#R-image-cb00dac67ca3898c9aaa0ed30e271293" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-46-17.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cb00dac67ca3898c9aaa0ed30e271293"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-46-17.png"></a></p>
<ul>
<li>è®¾ç½®æ•°æ®åº“å¯†ç </li>
</ul>
<p><a href="#R-image-a9c83e91aecd3201ff044469cdb2b5d9" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-48-13.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a9c83e91aecd3201ff044469cdb2b5d9"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-48-13.png"></a></p>
<ul>
<li>æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªé‚®ä»¶åŸŸå</li>
</ul>
<p><a href="#R-image-7f98dd26cc83533003a1f826bb3dcb2e" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-49-34.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7f98dd26cc83533003a1f826bb3dcb2e"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-49-34.png"></a></p>
<ul>
<li>åˆ›å»ºç®¡ç†å‘˜å¯†ç </li>
</ul>
<p><a href="#R-image-74294d247b806f77001717e6b0ea9fc7" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-51-25.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-74294d247b806f77001717e6b0ea9fc7"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-51-25.png"></a></p>
<ul>
<li>é€‰æ‹©ç»„ä»¶</li>
</ul>
<p><a href="#R-image-4c608c2fb79d68e08bc1fce8b014caa5" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-55-06.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4c608c2fb79d68e08bc1fce8b014caa5"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-55-06.png"></a></p>
<ul>
<li>ç¡®è®¤é€‰é¡¹æ˜¯å¦æ— è¯¯ï¼Œ</li>
</ul>
<p><a href="#R-image-2286d8ba2e8ed7c689c7e4e66ecb5a9f" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-56-22.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2286d8ba2e8ed7c689c7e4e66ecb5a9f"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Email_Server/iRedMail/Snipaste_2024-03-27_18-56-22.png"></a></p>
<ul>
<li><code>web</code>è®¿é—®åœ°å€ä»¥åŠç”¨æˆ·åå¯†ç </li>
</ul>
<blockquote>
<ul>
<li><a href="https://email.domain.com/mail/" rel="external" target="_self">**<code>Roundcube</code>**ç½‘ç»œé‚®ä»¶ç™»å½•åœ°å€</a></li>
<li><a href="https://your_server/SOGo" rel="external" target="_self">**<code>SOGo</code>**ç»„ä»¶</a></li>
<li><a href="https://your_server/iredadmin/" rel="external" target="_self">ç½‘ç»œåå°ç®¡ç†é¢æ¿**<code>iRedAdmin</code>**</a></li>
<li><a href="https://email.domain.com/netdata/" rel="external" target="_self">**<code>netdata</code>**æ•°æ®çŠ¶æ€ç›‘æ§</a></li>
<li>ç”¨æˆ·åï¼š<code>postmaster@domain.com</code></li>
<li>å¯†ç ï¼š<code>password</code></li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="4">
<li>ä¼˜åŒ–é…ç½®é¡¹</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å»ºè®®æ‚¨è·å–<!-- raw HTML omitted --><code>SSL</code><!-- raw HTML omitted -->è¯ä¹¦ï¼Œ<!-- raw HTML omitted -->ä»¥é¿å…åœ¨é€šè¿‡<code>HTTPS/IMAPS/POP3/SMTPS</code>è®¿é—®é‚®ç®±æ—¶åœ¨<code>Web</code>æµè§ˆå™¨æˆ–é‚®ä»¶å®¢æˆ·ç«¯ä¸­å‡ºç°çƒ¦äººçš„è­¦å‘Šæ¶ˆæ¯</li>
<li><!-- raw HTML omitted -->ç¦ç”¨<!-- raw HTML omitted --><code>iRedMail</code><!-- raw HTML omitted -->ç°åå•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/iredapd/settings.py<span style="color:#e6db74">&lt;&lt;-EOF  	# å¿…é¡»root ç”¨æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">plugins = [&#34;reject_null_sender&#34;, &#34;wblist_rdns&#34;, &#34;reject_sender_login_mismatch&#34;, &#34;greylisting&#34;, &#34;throttle&#34;, &#34;amavisd_wblist&#34;, &#34;sql_alias_access_policy&#34;, &#34;sql_ml_access_policy&#34;]  	# åˆ é™¤ï¼šgreylisting é€‰é¡¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo systemctl restart iredapd</span></span></code></pre></div><blockquote>
<ul>
<li><!-- raw HTML omitted -->è§£æ<!-- raw HTML omitted --><code>A</code><!-- raw HTML omitted -->è®°å½•ï¼Œ<!-- raw HTML omitted -->è§£æåä¸ºï¼š<code>email</code>ï¼Œ  è§£æå€¼ä¸ºï¼š<code>iRedMail</code>æœåŠ¡æ‰€åœ¨çš„æœåŠ¡å™¨<code>IP</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ£€æµ‹<!-- raw HTML omitted --><code>A</code><!-- raw HTML omitted -->è®°å½•ï¼š<!-- raw HTML omitted --><code>nslookup email.domain.com</code>  	# æ›´æ¢ï¼š<code>domain.com</code>ä¸ºå¯¹åº”åŸŸå</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ <!-- raw HTML omitted --><code>MX</code><!-- raw HTML omitted -->è®°å½•ï¼Œ<!-- raw HTML omitted -->è§£æåä¸ºï¼š<code>@</code>ï¼Œä¼˜å…ˆçº§å€¼ä¸ºï¼š<code>10</code>ï¼Œè§£æå€¼ä¸ºï¼š<code>email.domain.com</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ£€æµ‹<!-- raw HTML omitted --><code>MX</code><!-- raw HTML omitted -->è®°å½•ï¼š<!-- raw HTML omitted --><code>nslookup -type=mx domain.com</code></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>SPF</code><!-- raw HTML omitted -->è®°å½•ï¼Œ<!-- raw HTML omitted -->é€‰æ‹©ï¼š<code>TXT</code>ï¼Œè§£æåä¸ºï¼š<code>@</code>ï¼Œè§£æå€¼ä¸ºï¼š<code>v=spf1 mx ~all</code></li>
</ul>
<blockquote>
<p><!-- raw HTML omitted -->æ£€æµ‹<!-- raw HTML omitted --><code>SPF</code><!-- raw HTML omitted -->è®°å½•ï¼š<!-- raw HTML omitted --><code>nslookup -type=txt domain.com</code></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>DKIM</code><!-- raw HTML omitted -->è®°å½•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>æŸ¥çœ‹å®‰è£…åŒ…æ–‡ä»¶ï¼Œå¤åˆ¶è¿‡æ»¤å­—æ®µä¸‹æ–¹è®°å½•ï¼Œ<!-- raw HTML omitted -->å»æ‰æ‹¬å·ï¼š<!-- raw HTML omitted --><code>()</code>ï¼Œå’Œ<!-- raw HTML omitted -->åŒå¼•å·ï¼š<!-- raw HTML omitted --><code>&quot;&quot;</code>ï¼Œ<!-- raw HTML omitted -->ä½¿å…¶å˜ä¸ºä¸€è¡Œ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /opt/email/iRedMail-1.6.8/iRedMail.tips | grep -C <span style="color:#ae81ff">8</span> dkim._domainkey</span></span></code></pre></div><p>é€‰æ‹©ï¼š<code>TXT</code>ï¼Œè§£æå€¼ä¸ºï¼š<code>dkim._domainkey</code>ï¼Œè§£æå€¼ä¸ºï¼š<code>v=DKIM1; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5gFOvR/IiKwqxWeVQXSpWppiW/Gezd3Kgt3JlvhZTL2KI+Za4pSKcaQqkNH9aM5dyAZHYHLKkeVoD5tgaHvBZRaoKN8erL2X2xOfRbkLFpiqpHfgPZB0ADssuCHSK+pGgSz3tVUus9sGaXR7WZoWL50McJnfEKM74dYqhwJ+/EcLsabprKaV+C60TaQS8gqnDfOh4B5dE7B5sPEE/kG23qHGYQhYbIU2LDV1BFgjanJkMbZSNhah2OmQPnXPq4MshaQx1Xld8iLSyKna6KV9Tsi+MIiXSdCM2zoRx5wN4X4i//gNX4jHgaQ56RhSkEybGDCS+g+0oQvDE7XOj6vbHQIDAQAB</code></p>
<ul>
<li><!-- raw HTML omitted -->æ£€æµ‹<!-- raw HTML omitted --><code>DKIM</code><!-- raw HTML omitted -->è®°å½•ï¼š<!-- raw HTML omitted --><code>nslookup -type=txt dkim._domainkey.domain.com</code></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>DMARC</code><!-- raw HTML omitted -->è®°å½•ï¼Œ<!-- raw HTML omitted -->é€‰æ‹©ï¼š<code>TXT</code>ï¼Œè§£æåä¸ºï¼š<code>_dmarc</code>ï¼Œè§£æå€¼ä¸ºï¼š<code>v=DMARC1; p=none; pct=100; rua=mailto:dmarc@domain.com</code>ï¼Œ<code>domain.com</code>æ¢æˆå¯¹åº”åŸŸå</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ£€æµ‹<!-- raw HTML omitted --><code>DMARC</code><!-- raw HTML omitted -->è®°å½•ï¼š<!-- raw HTML omitted --><code>nslookup -type=txt _dmarc.domain.com</code></li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="5">
<li>æ·»åŠ <code>iRedMail</code>ç”¨æˆ·</li>
</ol>
</li>
</ul>
<blockquote>
</blockquote>
<ul>
<li>
<ol start="6">
<li>æµ‹è¯•<code>iRedMail</code>é‚®ä»¶æœåŠ¡</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.mail-tester.com/" rel="external" target="_self">æµ‹è¯•é‚®ä»¶åƒåœ¾åŒ¹é…åº¦</a></li>
</ul>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="firewalld">Firewalld</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Firewalld</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_firewalld">Use_Firewalld</h1>

<h2 id="é…ç½®é˜²ç«å¢™">é…ç½®é˜²ç«å¢™</h2>
<h3 id="é…ç½®firewalldé˜²ç«å¢™">é…ç½®<code>Firewalld</code>é˜²ç«å¢™</h3>
<ul>
<li>
<ol>
<li><code>Linux</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Firewalld</code><!-- raw HTML omitted -->é˜²ç«å¢™çš„è·¯ç”±è½¬å‘<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://blog.csdn.net/github_36904248/article/details/82012579" rel="external" target="_self"><code>CentOS7</code>ä¸‹<code>firewall</code>çš„<code>ipset</code>é…ç½®ä½¿ç”¨è¯¦è§£</a></li>
<li><a href="https://blog.csdn.net/qianye_111/article/details/78987161" rel="external" target="_self"><code>CentOS7</code>å¼€å¯è·¯ç”±è½¬å‘</a></li>
<li>å¸¸è§å¤±è´¥åŸå› ï¼š<!-- raw HTML omitted -->ç”µè„‘æœ¬èº«æ²¡æœ‰å¼€å¯è™šæ‹ŸåŒ–æ”¯æŒï¼Œéœ€è¦åœ¨é‡å¯æ—¶è¿›å…¥BIOSé‡Œè®¾ç½®</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¸´æ—¶å¼€å¯è·¯ç”±è½¬å‘</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;1&#34;</span> &gt; /proc/sys/net/ipv4/ip_forward
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ°¸ä¹…å¼€å¯è·¯ç”±è½¬å‘</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;net.ipv4.ip_forward = 1&#34;</span> &gt;&gt;/etc/sysctl.conf
</span></span><span style="display:flex;"><span>$ sysctl -p  	<span style="color:#75715e"># åŠ è½½ä¸€ä¸‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sysctl -a |grep <span style="color:#e6db74">&#34;ip_forward&#34;</span>  	<span style="color:#75715e"># æŸ¥çœ‹ä¸€ä¸‹</span>
</span></span><span style="display:flex;"><span>net.ipv4.ip_forward <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>net.ipv4.ip_forward_use_pmtu <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Linux</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>Firewalld</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>é…ç½®<!-- raw HTML omitted --><code>Firewalld</code><!-- raw HTML omitted -->è½¬å‘<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å¤–ç½‘å¡</span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --zone<span style="color:#f92672">=</span>external --change-interface<span style="color:#f92672">=</span>eth0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†…ç½‘ç½‘å¡</span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --zone<span style="color:#f92672">=</span>internal --change-interface<span style="color:#f92672">=</span>eth1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># IPåœ°å€ä¼ªè£…</span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --zone<span style="color:#f92672">=</span>external --add-masquerade --permanent
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --direct --passthrough ipv4 -t nat POSTROUTING -o eth0# å¤–ç½‘å¡ -j MASQUERADE -s 192.168.100.0/24# å†…ç½‘ç½‘æ®µ
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Firewalld</code><!-- raw HTML omitted -->è®¿é—®è§„åˆ™<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ firewall-cmd --add-service<span style="color:#f92672">={</span>http,https<span style="color:#f92672">}</span> --permanent
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --new-ipset<span style="color:#f92672">=</span>ssh_whitelist --type<span style="color:#f92672">=</span>hash:ip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --add-rich-rule<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rule family=&#39;ipv4&#39; source ipset=&#39;ssh_whitelist port port=&#39;22&#39; protocol=&#39;tcp&#39; accept&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --add-rich-rule<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rule family=&#39;ipv4&#39; source ipset=&#39;redis_whitelist&#39; port port=&#39;17693-17695&#39; protocol=&#39;tcp&#39; accept&#34;</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --add-rich-rule<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rule family=&#39;ipv4&#39; source ipset=&#39;redis_whitelist&#39; port port=&#39;27693-27695&#39; protocol=&#39;tcp&#39; accept&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°è½½å…¥é…ç½®</span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload &gt;/dev/null
</span></span><span style="display:flex;"><span>$ systemctl status firewalld &gt;/dev/null 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å·²ç»å¼€æ”¾ç«¯å£</span>
</span></span><span style="display:flex;"><span>$ firewallport<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>firewall-cmd --zone<span style="color:#f92672">=</span>public --list-ports<span style="color:#e6db74">`</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="é…ç½®iptablesé˜²ç«å¢™">é…ç½®<code>Iptables</code>é˜²ç«å¢™</h3>
<ul>
<li>
<ol>
<li><code>Linux</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>Iptables</code><!-- raw HTML omitted -->é…ç½®è§„åˆ™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Iptables</code><!-- raw HTML omitted -->è§„åˆ™4è¡¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>filter(è¿‡æ»¤è§„åˆ™è¡¨)</code><!-- raw HTML omitted -->ï¼šæ§åˆ¶æ•°æ®åŒ…æ˜¯å¦å…è®¸è¿›å‡ºåŠè½¬å‘ï¼Œå¯ä»¥æ§åˆ¶çš„é“¾è·¯æœ‰<!-- raw HTML omitted --><code>INPUT</code>ã€<code>OUTPUT</code>å’Œ<code>FORWARD</code></li>
<li><code>nat(åœ°å€è½¬æ¢è§„åˆ™è¡¨)</code><!-- raw HTML omitted -->ï¼šæ§åˆ¶æ•°æ®åŒ…ä¸­åœ°å€è½¬æ¢ï¼Œå¯ä»¥æ§åˆ¶çš„é“¾è·¯æœ‰<!-- raw HTML omitted --><code>INPUT</code>ã€<code>OUTPUT</code>ã€<code>PREROUTING</code>å’Œ<code>POSTROUTING</code></li>
<li><code>mangle(ä¿®æ”¹æ•°æ®æ ‡è®°ä½è§„åˆ™è¡¨)</code><!-- raw HTML omitted -->ï¼šä¿®æ”¹æ•°æ®åŒ…ä¸­çš„åŸæ•°æ®ï¼Œå¯ä»¥æ§åˆ¶çš„é“¾è·¯æœ‰<!-- raw HTML omitted --><code>INPUT</code>ã€<code>OUTPUT</code>ã€<code>FORWARD</code>ã€<code>PREROUTING</code>å’Œ<code>POSTROUTING</code></li>
<li><code>raw(è·Ÿè¸ªæ•°æ®è¡¨è§„åˆ™è¡¨)</code>ï¼šæ§åˆ¶<code>nat</code><!-- raw HTML omitted -->è¡¨ä¸­è¿æ¥è¿½è¸ªæœºåˆ¶çš„å¯ç”¨çŠ¶å†µï¼Œå¯ä»¥æ§åˆ¶çš„é“¾è·¯æœ‰<!-- raw HTML omitted --><code>OUTPUT</code>ã€<code>PREROUTING</code></li>
</ul>
</blockquote>
<ul>
<li><code>Iptables</code><!-- raw HTML omitted -->è§„åˆ™5é“¾<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>INPUT</code><!-- raw HTML omitted -->(å…¥ç«™æ•°æ®è¿‡æ»¤é“¾)<!-- raw HTML omitted --></li>
<li><code>OUTPUT</code><!-- raw HTML omitted -->(å‡ºç«™æ•°æ®è¿‡æ»¤é“¾)<!-- raw HTML omitted --></li>
<li><code>FORWARD</code><!-- raw HTML omitted -->(è½¬å‘æ•°æ®è¿‡æ»¤é“¾)<!-- raw HTML omitted --></li>
<li><code>PREROUTING</code><!-- raw HTML omitted -->(è·¯ç”±å‰è¿‡æ»¤é“¾)<!-- raw HTML omitted --></li>
<li><code>POSTROUTING</code><!-- raw HTML omitted -->(è·¯ç”±åè¿‡æ»¤é“¾)<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->é€‰é¡¹å‚æ•°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>é€‰é¡¹/å‚æ•°</th>
<th>å…·ä½“ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-A</code></td>
<td>åœ¨è§„åˆ™é“¾çš„æœ«å°¾åŠ å…¥æ–°è§„åˆ™</td>
</tr>
<tr>
<td><code>-D</code></td>
<td>åˆ é™¤æŸä¸€æ¡è§„åˆ™</td>
</tr>
<tr>
<td><code>-I</code></td>
<td>åœ¨è§„åˆ™é“¾çš„å¤´éƒ¨åŠ å…¥æ–°è§„åˆ™</td>
</tr>
<tr>
<td><code>-F</code></td>
<td>æ¸…ç©ºè§„åˆ™é“¾</td>
</tr>
<tr>
<td><code>-L</code></td>
<td>æŸ¥çœ‹è§„åˆ™é“¾</td>
</tr>
<tr>
<td><code>-R</code></td>
<td>æ›¿æ¢é˜²ç«å¢™è§„åˆ™</td>
</tr>
<tr>
<td><code>-Z</code></td>
<td>æ¸…ç©ºé˜²ç«å¢™æ•°æ®è¡¨ç»Ÿè®¡ä¿¡æ¯</td>
</tr>
<tr>
<td><code>-P</code></td>
<td>è®¾ç½®é»˜è®¤ç­–ç•¥:<code>iptables -P INPUT (DROP</code></td>
</tr>
<tr>
<td><code>-p</code></td>
<td>åŒ¹é…åè®®ï¼Œ! è¡¨ç¤ºå–å</td>
</tr>
<tr>
<td><code>-s</code></td>
<td>åŒ¹é…æºåœ°å€</td>
</tr>
<tr>
<td><code>--sport</code></td>
<td>åŒ¹é…æºç«¯å£</td>
</tr>
<tr>
<td><code>--sports</code></td>
<td>åŒ¹é…æºç«¯å£</td>
</tr>
<tr>
<td><code>--src-range</code></td>
<td>åŒ¹é…ç›®æ ‡åœ°å€èŒƒå›´</td>
</tr>
<tr>
<td><code>-d</code></td>
<td>åŒ¹é…ç›®æ ‡åœ°å€</td>
</tr>
<tr>
<td><code>--dport</code></td>
<td>åŒ¹é…ç›®æ ‡ç«¯å£</td>
</tr>
<tr>
<td><code>--dports</code></td>
<td>åŒ¹é…ç›®æ ‡ç«¯å£</td>
</tr>
<tr>
<td><code>--dst-range</code></td>
<td>åŒ¹é…ç›®æ ‡åœ°å€èŒƒå›´</td>
</tr>
<tr>
<td><code>-i</code></td>
<td>åŒ¹é…å…¥ç«™ç½‘å¡æ¥å£</td>
</tr>
<tr>
<td><code>-o</code></td>
<td>åŒ¹é…å‡ºç«™ç½‘å¡æ¥å£</td>
</tr>
<tr>
<td><code>--limit</code></td>
<td>å››é…æ•°æ®è¡¨é€Ÿç‡</td>
</tr>
<tr>
<td><code>--mac-cource</code></td>
<td>åŒ¹é…æº<code>MAC</code>åœ°å€</td>
</tr>
<tr>
<td><code>--stste</code></td>
<td>åŒ¹é…çŠ¶æ€ï¼ˆINVALIDã€ESTABLISHEDã€NEWã€RELATED)</td>
</tr>
<tr>
<td><code>--string</code></td>
<td>åŒ¹é…åº”ç”¨å±‚å­—ä¸²</td>
</tr>
<tr>
<td><code>-m comment --comment &quot;æˆ‘æ˜¯æ³¨é‡Š&quot;</code></td>
<td>æ·»åŠ æ³¨é‡Š</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->è§¦å‘è§„åˆ™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>è§¦å‘åŠ¨ä½œ</th>
<th>æ›´èƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ACCEPT</code></td>
<td>å…è®¸æ•°æ®åŒ…é€šè¿‡</td>
</tr>
<tr>
<td><code>DROP</code></td>
<td>ä¸¢å¼ƒæ•°æ®åŒ…</td>
</tr>
<tr>
<td><code>REJECT</code></td>
<td>æ‹’ç»æ•°æ®åŒ…é€šè¿‡</td>
</tr>
<tr>
<td><code>LOG</code></td>
<td>å°†æ•°æ®åŒ…ä¿¡æ¯è®°å½•<code>syslog</code>æ›°å¿—</td>
</tr>
<tr>
<td><code>DNAT</code></td>
<td>ç›®æ ‡åœ°å€è½¬æ¢</td>
</tr>
<tr>
<td><code>SNAT</code></td>
<td>æºåœ°å€è½¬æ¢</td>
</tr>
<tr>
<td><code>MASQUERADE</code></td>
<td>åœ°å€æ¬ºéª—</td>
</tr>
<tr>
<td><code>REDIRECT</code></td>
<td>é‡å®šå‘</td>
</tr>
</tbody>
</table>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å‘½ä»¤é€‰é¡¹è¾“å…¥é¡ºåº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>-t</code><!-- raw HTML omitted -->ï¼šåé¢è·Ÿ4è¡¨ä¸­çš„è¡¨å<!-- raw HTML omitted --></li>
<li><code>-A/I/D/R</code><!-- raw HTML omitted -->ï¼šåé¢è·Ÿ5é“¾ä¸­çš„é“¾å<!-- raw HTML omitted --></li>
<li><code>-i/o</code><!-- raw HTML omitted -->ï¼šè·Ÿç½‘å¡å<!-- raw HTML omitted --></li>
<li><code>-p</code><!-- raw HTML omitted -->ï¼šåè®®åï¼š<!-- raw HTML omitted --><code>tcp/udp</code></li>
<li><code>-s</code><!-- raw HTML omitted -->ï¼šæº<code>IP</code>/æºå­ç½‘<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -tï¼šè¡¨å<span style="color:#f92672">(</span>filter/nat/mangle/raw<span style="color:#f92672">)</span> -A/I/D/Rï¼šè§„åˆ™é“¾å<span style="color:#f92672">[</span>è§„åˆ™å·<span style="color:#f92672">]</span> -i/oï¼šç½‘å¡å -pï¼šåè®®å<span style="color:#f92672">(</span>tcp/udp<span style="color:#f92672">)</span> -sï¼šæºIP/æºå­ç½‘ --sportï¼šæºç«¯å£ -dï¼šç›®æ ‡IP/ç›®æ ‡å­ç½‘ --dportï¼šç›®æ ‡ç«¯å£ -j åŠ¨ä½œ<span style="color:#f92672">(</span>ACCEPT/DROP/DNAT/SNAT/...<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ service iptables save
</span></span><span style="display:flex;"><span>$ systemctl reload iptables</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Iptables</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>INPUT</code>è§„åˆ™</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>æ”¾è¡Œç«¯å£ï¼Œå¦‚æœéœ€è¦é’ˆå¯¹<code>IP</code>é™åˆ¶åŠ ï¼š<code>-s</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -A INPUT -p tcp -m tcp --dport <span style="color:#ae81ff">21</span> -j ACCEPT  	<span style="color:#75715e"># å¼€æ”¾21ç«¯å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/sysconfig/iptables<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">-A INPUT -p tcp -m tcp --dport 21 -j ACCEPT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>æ”¾è¡Œå¤šç«¯å£ï¼Œå¦‚æœéœ€è¦é’ˆå¯¹<code>IP</code>é™åˆ¶åŠ ï¼š<code>-s</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -A INPUT -p tcp -m multiport --dports 3306,6379 -j ACCEPT 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/sysconfig/iptables<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">-A INPUT -p tcp -m multiport --dports 3306,6379 -j ACCEPT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>æ”¾è¡Œ<code>IP</code>ç½‘æ®µ</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -A INPUT -s 192.168.0.0/32 -j ACCEPT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/sysconfig/iptables<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">-A INPUT -s 192.168.0.0/32 -j ACCEPT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Iptables</code><!-- raw HTML omitted -->è½¬å‘è§„åˆ™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -P FORWARDACCEPT  	<span style="color:#75715e"># ç¼ºçœå…è®¸IPè½¬å‘</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ©ç”¨iptables å®ç°nat MASQUERADE å…±äº«ä¸Šç½‘</span>
</span></span><span style="display:flex;"><span>$ iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ iptables -t nat -A PREROUTING -p tcp --dport <span style="color:#ae81ff">6379</span> -j DNAT --to-destination ç›®æ ‡IP:ç›®æ ‡ç«¯å£
</span></span><span style="display:flex;"><span>$ iptables -t nat -A POSTROUTING -p tcp -d ç›®æ ‡IP --dport ç›®æ ‡ç«¯å£ -j SNAT --to-source æºIP  	<span style="color:#75715e"># æºIPéœ€å’Œç›®æ ‡IPåŒä¸€ç½‘æ®µ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">-A PREROUTING -p tcp -m tcp --dport 6379 -j DNAT --to-destination ç›®æ ‡IP:ç›®æ ‡ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">-A POSTROUTING -p tcp -d ç›®æ ‡IP -m tcp --dport ç›®æ ‡ç«¯å£ -j SNAT --to-source æºIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ç°æœ‰è½¬å‘è§„åˆ™</span>
</span></span><span style="display:flex;"><span>$ iptables -t nat -L</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->æ¸…é™¤ã€ä¿®æ”¹è§„åˆ™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>ä¿®æ”¹è§„åˆ™</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹è§„åˆ™,1ä»£è¡¨ç¬¬ä¸€è¡Œ</span>
</span></span><span style="display:flex;"><span>$ iptables -R INPUT <span style="color:#ae81ff">1</span> -s IP -p tcp --dport ç«¯å£ -j DROP</span></span></code></pre></div></blockquote>
<ul>
<li>åˆ é™¤è§„åˆ™</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -L -n --line-number  	<span style="color:#75715e"># æŸ¥çœ‹è§„åˆ™è¡Œå·</span>
</span></span><span style="display:flex;"><span>$ iptables -D INPUT <span style="color:#ae81ff">9</span>  	<span style="color:#75715e"># æŒ‰è¡Œå·åˆ é™¤è§„åˆ™</span></span></span></code></pre></div></blockquote>
<ul>
<li>æ¸…é™¤è§„åˆ™</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -F  	<span style="color:#75715e"># æ¸…é™¤æ‰€æœ‰</span>
</span></span><span style="display:flex;"><span>$ iptables-t nat -F  	<span style="color:#75715e"># æ¸…é™¤natè¡¨æ‰€æœ‰ </span></span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="5">
<li><code>Iptables</code><!-- raw HTML omitted -->é˜²å¾¡è§„åˆ™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é˜»æ­¢<!-- raw HTML omitted --><code>Windows</code><!-- raw HTML omitted -->è •è™«çš„æ”»å‡»<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -I INPUT -j DROP -p tcp -s 0.0.0.0/0 -m string --algo kmp --string <span style="color:#e6db74">&#34;cmd.exe&#34;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é˜²æ­¢<!-- raw HTML omitted --><code>SYN</code><!-- raw HTML omitted -->æ´ªæ°´æ”»å‡»<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -A INPUT -p tcp --syn -m limit --limit 5/second -j ACCEPT</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ·»åŠ <!-- raw HTML omitted --><code>SECMARK</code><!-- raw HTML omitted -->è®°å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -t mangle -A INPUT -p tcp --src 192.168.1.2 --dport <span style="color:#ae81ff">443</span> -j SECMARK --selctx system_u:object_r:myauth_packet_t
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘ä» 192.168.1.2:443 ä»¥TCPæ–¹å¼å‘å‡ºåˆ°æœ¬æœºçš„åŒ…æ·»åŠ MACå®‰å…¨ä¸Šä¸‹æ–‡ system_u:object_r:myauth_packet_t</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é˜²<!-- raw HTML omitted --><code>CC</code><!-- raw HTML omitted -->æ”»å‡»<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -L -F -A -D <span style="color:#75715e"># list flush append delete</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœºæ™¯ä¸€</span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -p tcp --dport <span style="color:#ae81ff">80</span> -j ACCEPT <span style="color:#75715e"># å…è®¸ tcp 80 ç«¯å£</span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -p tcp --dport 10:22 -j ACCEPT <span style="color:#75715e"># å…è®¸ tcp 10-22 ç«¯å£</span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -p icmp -j ACCEPT <span style="color:#75715e"># å…è®¸ icmp</span>
</span></span><span style="display:flex;"><span>$ iptables -A INPUT -j REJECT <span style="color:#75715e"># æ·»åŠ ä¸€æ¡è§„åˆ™, ä¸å…è®¸æ‰€æœ‰</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¼˜åŒ–åœºæ™¯ä¸€</span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -i lo -j ACCEPT <span style="color:#75715e"># å…è®¸æœ¬æœºè®¿é—®</span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT <span style="color:#75715e"># å…è®¸è®¿é—®å¤–ç½‘</span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -p tcp --dport <span style="color:#ae81ff">80</span> -s 10.10.188.233 -j ACCEPT <span style="color:#75715e"># åªå…è®¸å›ºå®šipè®¿é—®80</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœºæ™¯äºŒ</span>
</span></span><span style="display:flex;"><span>$ vi /etc/vsftpd/vsftpd.conf <span style="color:#75715e"># ä½¿ç”¨ vsftpd å¼€å¯ ftp ä¸»åŠ¨æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>port_enable<span style="color:#f92672">=</span>yes
</span></span><span style="display:flex;"><span>connect_from_port_20<span style="color:#f92672">=</span>YES
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -p tcp --dport <span style="color:#ae81ff">21</span> -j ACCEPT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/vsftpd/vsftpd.conf <span style="color:#75715e"># å»ºè®®ä½¿ç”¨ ftp è¢«åŠ¨æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>pasv_min_port<span style="color:#f92672">=</span><span style="color:#ae81ff">50000</span>
</span></span><span style="display:flex;"><span>pasv_max_port<span style="color:#f92672">=</span><span style="color:#ae81ff">60000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -p tcp --dport <span style="color:#ae81ff">21</span> -j ACCEPT
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -p tcp --dport 50000:60000 -j ACCEPT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿˜å¯ä»¥ä½¿ç”¨ iptables æ¨¡å—è¿½è¸ªæ¥è‡ªåŠ¨å¼€å‘å¯¹åº”çš„ç«¯å£</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœºæ™¯ä¸‰</span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -i lo -j ACCEPT <span style="color:#75715e"># å…è®¸æœ¬æœºè®¿é—®</span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT <span style="color:#75715e"># å…è®¸è®¿é—®å¤–ç½‘</span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -s 10.10.155.0/24 -j ACCEPT <span style="color:#75715e"># å…è®¸å†…ç½‘è®¿é—®</span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -p tcp -m multiport --dports 80,1723 -j ACCEPT <span style="color:#75715e"># å…è®¸ç«¯å£, 80 -&gt; http, 1723 -&gt; vpn</span>
</span></span><span style="display:flex;"><span>$ iptables -A INPUT -j REJECT <span style="color:#75715e"># æ·»åŠ ä¸€æ¡è§„åˆ™, ä¸å…è®¸æ‰€æœ‰</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ iptables-save <span style="color:#75715e"># ä¿å­˜è®¾ç½®åˆ°é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœºæ™¯å››</span>
</span></span><span style="display:flex;"><span>$ iptables -t nat -L <span style="color:#75715e"># æŸ¥çœ‹ nat é…ç½®</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ iptables -t nat -A POST_ROUTING -s 10.10.177.0/24 -j SNAT --to 10.10.188.232 <span style="color:#75715e"># SNAT</span>
</span></span><span style="display:flex;"><span>$ vi /etc/sysconfig/network <span style="color:#75715e"># é…ç½®ç½‘å…³</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ iptables -t nat -A POST_ROUTING -d 10.10.188.232 -p tcp --dport <span style="color:#ae81ff">80</span> -j DNAT --to 10.10.177.232:80 <span style="color:#75715e"># DNAT</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åœºæ™¯äº”</span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -p tcp --syn --dport <span style="color:#ae81ff">80</span> -m connlimit --connlimit-above <span style="color:#ae81ff">100</span> -j REJECT <span style="color:#75715e"># é™åˆ¶å¹¶å‘è¿æ¥è®¿é—®æ•°</span>
</span></span><span style="display:flex;"><span>$ iptables -I INPUT -m limit --limit 3/hour --limit-burst <span style="color:#ae81ff">10</span> -j ACCEPT <span style="color:#75715e"># limitæ¨¡å—; --limit-burst é»˜è®¤ä¸º5</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="é…ç½®ipset">é…ç½®<code>Ipset</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>ipset</code><!-- raw HTML omitted -->æé«˜<!-- raw HTML omitted --><code>iptables</code><!-- raw HTML omitted -->çš„æ§åˆ¶æ•ˆç‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><a href="https://www.cnblogs.com/faberbeta/p/ipset.html" rel="external" target="_self">ä½¿ç”¨<code>ipset</code>æé«˜<code>iptables</code>çš„æ§åˆ¶æ•ˆç‡ </a></p>
</li>
<li>
<p><code>ipset</code><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>method</code><!-- raw HTML omitted -->(æ–¹æ³•)<!-- raw HTML omitted --></p>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><code>bitmap</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨å›ºå®šå¤§å°çš„å­˜å‚¨<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>hash</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨hashè¡¨æ¥å­˜å‚¨å…ƒç´ <!-- raw HTML omitted --></p>
</li>
<li>
<p><code>list</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨å›ºå®šå¤§å°çš„å­˜å‚¨<!-- raw HTML omitted --></p>
</li>
</ul>
</blockquote>
<ul>
<li><code>ipset</code><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>datatype</code><!-- raw HTML omitted -->(æ•°æ®ç±»å‹)<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>ip</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨å“ˆå¸Œå­˜å‚¨<code>ip</code>ä¸»æœºåœ°å€(é»˜è®¤)æˆ–ç½‘ç»œåœ°å€ã€‚é›¶å€¼<code>IP</code>åœ°å€ä¸èƒ½å­˜å‚¨åœ¨æ•£åˆ—ä¸­<!-- raw HTML omitted --></li>
<li><code>net</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨é›†åˆå­˜å‚¨ä¸åŒå¤§å°çš„<code>IP</code>ç½‘ç»œæ®µã€‚å‰ç¼€å¤§å°ä¸ºé›¶çš„ç½‘ç»œåœ°å€ä¸èƒ½å­˜å‚¨åœ¨è¿™ç§ç±»å‹çš„é›†åˆä¸­<!-- raw HTML omitted --></li>
<li><code>mac</code></li>
<li><code>port</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨<code>hash</code>å­˜å‚¨<code>IP</code>åœ°å€å’Œç«¯å£å·å¯¹ã€‚ç«¯å£å·ä¸åè®®(é»˜è®¤<code>TCP</code>)ä¸€èµ·ï¼Œä¸èƒ½ä½¿ç”¨é›¶åè®®å·<!-- raw HTML omitted --></li>
<li><code>iface</code></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted --><code>create</code>åˆ›å»º<code>ipset</code>é›†åˆã€<code>add</code>æ·»åŠ æ¡ç›®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>timeout</code><!-- raw HTML omitted -->ï¼šè¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºæ°¸ä¹…ç”Ÿæ•ˆï¼Œè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡<code>-exist</code>æ¥è¿›è¡Œä¿®æ”¹<!-- raw HTML omitted --></li>
<li><code>counters</code><!-- raw HTML omitted -->ï¼šæ”¯æŒ<code>packets</code>åŒ…å’Œ<code>bytes</code>å­—èŠ‚åˆ›å»ºé›†åˆ<!-- raw HTML omitted --></li>
<li><code>comment</code><!-- raw HTML omitted -->ï¼šå¤‡æ³¨ï¼Œæ³¨é‡Šä¸èƒ½åŒ…å«ä»»ä½•å¼•å·ï¼Œé€šå¸¸çš„è½¬ä¹‰å­—ç¬¦<code>()</code>æ²¡æœ‰ä»»ä½•æ„ä¹‰<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ipset create SetName TypeName  	<span style="color:#75715e"># SetNameï¼šä¸ºè‡ªå®šä¹‰åç§°ï¼ŒTypeNameï¼šä¸ºmethod:datatype</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸¾ä¾‹è¯´æ˜</span>
</span></span><span style="display:flex;"><span>$ ipset create mysql hash:ip timeout <span style="color:#ae81ff">3600</span>
</span></span><span style="display:flex;"><span>$ ipset create php hash:ip,port
</span></span><span style="display:flex;"><span>$ ipset create Nginx hash:net
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ æ¡ç›®</span>
</span></span><span style="display:flex;"><span>$ ipset -exist add mysql 127.0.0.1 timeout <span style="color:#ae81ff">7200</span>
</span></span><span style="display:flex;"><span>$ ipset add php 127.0.0.1,9000
</span></span><span style="display:flex;"><span>$ ipset add Nginx 127.0.0.0/8</span></span></code></pre></div></blockquote>
<ul>
<li><code>list</code><!-- raw HTML omitted -->åˆ—å‡ºé›†åˆã€<!-- raw HTML omitted --><code>test</code><!-- raw HTML omitted -->æ£€æŸ¥æ¡ç›®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ipset list  	<span style="color:#75715e"># åˆ—å‡ºæ‰€æœ‰é›†åˆ</span>
</span></span><span style="display:flex;"><span>$ ipset list mysql  	<span style="color:#75715e"># åˆ—å‡ºæŒ‡å®šé›†åˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ipset test mysql 127.0.0.1</span></span></code></pre></div><ul>
<li><code>del</code><!-- raw HTML omitted -->æŸæ¡ï¼Œ<!-- raw HTML omitted --><code>flush</code><!-- raw HTML omitted -->æ¸…ç©ºé›†åˆæ¡ç›®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ipset del mysql 127.0.0.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ipset flush Nginx</span></span></code></pre></div><ul>
<li><code>destroy</code><!-- raw HTML omitted -->åˆ é™¤é›†åˆ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ipset destroy  	<span style="color:#75715e"># åˆ é™¤æ‰€æœ‰é›†åˆ</span>
</span></span><span style="display:flex;"><span>$ ipset destroy mysql  	<span style="color:#75715e"># åˆ é™¤æŒ‡å®šé›†åˆ</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>iptables</code><!-- raw HTML omitted -->ä¸­ä½¿ç”¨<!-- raw HTML omitted --><code>ipse</code>ï¼Œ<!-- raw HTML omitted -->åªè¦åŠ ä¸Š<!-- raw HTML omitted --><code>-m set --match-set</code><!-- raw HTML omitted -->å³å¯<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç›®çš„<!-- raw HTML omitted --><code>ip</code><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>ipset</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -I INPUT -s 192.168.88.110 -m set --match-set Nginx dst -j DROP</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æº<!-- raw HTML omitted --><code>ip</code><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>ipset</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -I INPUT -m set --match-set Nginx src -d 192.168.88.110  -j DROP</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æºå’Œç›®çš„éƒ½ä½¿ç”¨<!-- raw HTML omitted --><code>ipset</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ iptables -I INPUT -m set --match-set Nginx src -m set --match-set mysql dst -j DROP</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="é…ç½®hostsallowå’Œhostsdeny">é…ç½®<code>hosts.allow</code>å’Œ<code>hosts.deny</code></h3>
<ul>
<li>
<ol>
<li><code>/etc/hosts.allow</code>ï¼šæ–‡ä»¶é…ç½®</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><a href="https://www.cnblogs.com/EasonJim/p/8338931.html" rel="external" target="_self">ä½¿ç”¨<code>hosts.allow</code>å’Œ<code>hosts.deny</code>å®ç°ç®€å•çš„é˜²ç«å¢™</a></p>
</li>
<li>
<p><a href="https://cloud.tencent.com/developer/article/1533595" rel="external" target="_self"><code>SSH</code>ä¹‹<code>hosts.allow</code>å’Œ<code>hosts.deny</code>æ–‡ä»¶</a></p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/hosts.allow<span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Jenkins
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sshd:IP:allow 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># jumpserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sshd:IP:allow 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># local ç½‘æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sshd:192.168.0.:allow
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å†…è¿æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sshd:IP:allow
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">nfsd:ALL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sshd:all:deny
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="gitlab">Gitlab</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Gitlab</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_gitrunner">Use_Gitrunner</h1>

<h2 id="ç™»å½•å®‰è£…å¥½çš„gitlabé…ç½®git-runner">ç™»å½•å®‰è£…å¥½çš„<code>gitlab</code>é…ç½®<code>git-runner</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è·å–æ³¨å†Œä½¿ç”¨çš„<!-- raw HTML omitted --><code>token</code></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-23a9e4af34e6eaa5efaf28d1d891dd37" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/Snipaste_2022-04-22_21-57-46.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-23a9e4af34e6eaa5efaf28d1d891dd37"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/Snipaste_2022-04-22_21-57-46.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->æ³¨å†Œ<!-- raw HTML omitted --><code>git-runner</code><!-- raw HTML omitted -->åˆ°å®‰è£…å¥½çš„<!-- raw HTML omitted --><code>gitlab</code><!-- raw HTML omitted -->ä»“åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>2.1 <!-- raw HTML omitted -->å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>url</code><!-- raw HTML omitted -->ï¼šç§æœ‰<!-- raw HTML omitted --><code>gitlab</code><!-- raw HTML omitted -->çš„è·¯å¾„<!-- raw HTML omitted --></li>
<li><code>token</code><!-- raw HTML omitted -->ï¼šé¡¹ç›®çš„<!-- raw HTML omitted --><code>token</code><!-- raw HTML omitted -->ï¼Œç”¨äºå…³è”<!-- raw HTML omitted --><code>runner</code><!-- raw HTML omitted -->å’Œé¡¹ç›®<!-- raw HTML omitted --></li>
<li><code>name</code>ï¼š<code>runner</code><!-- raw HTML omitted -->çš„åå­—ï¼Œç”¨äºåŒºåˆ†<!-- raw HTML omitted --><code>runner</code></li>
<li><code>tags</code><!-- raw HTML omitted -->ï¼šç”¨äºåŒ¹é…ä»»åŠ¡<!-- raw HTML omitted --><code>jobs</code><!-- raw HTML omitted -->å’Œæ‰§è¡Œä»»åŠ¡çš„è®¾å¤‡<!-- raw HTML omitted --><code>runners</code></li>
<li><code>executor</code><!-- raw HTML omitted -->ï¼šæ‰§è¡Œç¯å¢ƒ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ gitlab-ci-multi-runner register  	<span style="color:#75715e"># æ‰§è¡Œæ³¨å†Œå‘½ä»¤ï¼Œ ç„¶åè¾“å…¥gitlabæµè§ˆå™¨åœ°å€ã€token</span>
</span></span><span style="display:flex;"><span>Enter the GitLab instance URL <span style="color:#f92672">(</span><span style="color:#66d9ef">for</span> example, https://gitlab.com/<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>http://192.168.35.130  	<span style="color:#75715e"># gitlabåœ°å€</span>
</span></span><span style="display:flex;"><span>Enter the registration token:
</span></span><span style="display:flex;"><span>LBsW7DfZdJN87yUAMVVh  	<span style="color:#75715e"># gitlabæŸ¥çœ‹åˆ°çš„token</span>
</span></span><span style="display:flex;"><span>Enter a description <span style="color:#66d9ef">for</span> the runner:
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>node-2-35.130<span style="color:#f92672">]</span>: node-2-35.130  	<span style="color:#75715e"># æœ€å¥½æ˜¯æœ¬æœºçš„hostnameã€ä¹Ÿå¯ä»¥ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>Enter tags <span style="color:#66d9ef">for</span> the runner <span style="color:#f92672">(</span>comma-separated<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>  	<span style="color:#75715e"># åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘ï¼Œå¯ä»¥ç›´æ¥å›è½¦ï¼Œåé¢åœ¨æ³¨å†Œå¥½çš„git-runnerçš„Tagsä¸­æ·»åŠ ï¼Œ.gitlab-ci.ymlæ–‡ä»¶ä¸­å¼•ç”¨æ­¤tags</span>
</span></span><span style="display:flex;"><span>Enter optional maintenance note <span style="color:#66d9ef">for</span> the runner:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># æ²¡æ˜ç™½ä»€ä¹ˆæ„æ€ç›´æ¥å›è½¦</span>
</span></span><span style="display:flex;"><span>Registering runner... succeeded                     runner<span style="color:#f92672">=</span>LBsW7DfZ
</span></span><span style="display:flex;"><span>Enter an executor: docker+machine, docker, shell, parallels, ssh, virtualbox, docker-ssh+machine, kubernetes, custom, docker-ssh:
</span></span><span style="display:flex;"><span>shell  	<span style="color:#75715e"># é€‰æ‹©ä½¿ç”¨æ‰§è¡Œå™¨yumï¼Œrpmå®‰è£…ä¸€èˆ¬é€‰æ‹©shellç¯å¢ƒ</span>
</span></span><span style="display:flex;"><span>Runner registered successfully. Feel free to start it, but <span style="color:#66d9ef">if</span> it<span style="color:#960050;background-color:#1e0010">&#39;</span>s running already the config should be automatically reloaded!</span></span></code></pre></div><p><a href="#R-image-a4370dc5349325d26de7a1022a750758" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/Snipaste_2022-04-22_22-50-14.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a4370dc5349325d26de7a1022a750758"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/Snipaste_2022-04-22_22-50-14.png"></a></p>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>gitlab-runner</code><!-- raw HTML omitted -->ç”¨æˆ·ç¯å¢ƒå˜é‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‰§è¡Œå®Œæˆå<!-- raw HTML omitted --><code>gitlab-runner</code><!-- raw HTML omitted -->ä¼šè‡ªåŠ¨ä¿®æ”¹<!-- raw HTML omitted --><code>/etc/gitlab-runner/config.toml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œå¹¶é‡è½½<!-- raw HTML omitted --><code>daemon</code><!-- raw HTML omitted -->ç¨‹åº<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ su - gitlab-runner
</span></span><span style="display:flex;"><span>$ cp /etc/skel/.bashrc .  	<span style="color:#75715e"># æ‹·è´ç¯å¢ƒå˜é‡åˆ°å½“å‰ç”¨æˆ·å®¶ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ cp /etc/skel/.bash_profile .  	<span style="color:#75715e"># æ‹·è´ç¯å¢ƒå˜é‡åˆ°å½“å‰ç”¨æˆ·å®¶ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ cat /etc/gitlab-runner/config.toml  	<span style="color:#75715e"># å­˜æ”¾gitlab-runneré…ç½®çš„æ–‡ä»¶ï¼Œå¯ä»¥æœ‰å¤šä¸ªrunner</span>
</span></span><span style="display:flex;"><span>concurrent <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>check_interval <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>session_server<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  session_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">1800</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[[</span>runners<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span>  name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;node-2-runner-1&#34;</span>
</span></span><span style="display:flex;"><span>  url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://192.168.35.130&#34;</span>
</span></span><span style="display:flex;"><span>  token <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;7Ganz-WjwqVwbiwuyPMu&#34;</span>
</span></span><span style="display:flex;"><span>  executor <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;shell&#34;</span>
</span></span><span style="display:flex;"><span>  shell <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bash&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">[</span>runners.custom_build_dir<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">[</span>runners.cache<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>runners.cache.s3<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>runners.cache.gcs<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>runners.cache.azure<span style="color:#f92672">]</span></span></span></code></pre></div><ul>
<li><code>runner</code><!-- raw HTML omitted -->é…ç½®æ¨¡æ¿<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">listen_address = &#34;[::]:8090&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">concurrent = 16</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">check_interval = 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">session_server]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">listen_address = &#34;[::]:8093&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">advertise_address = &#34;&lt;ip_or_domain&gt;:8093&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">session_timeout = 1800</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[[<span style="color:#ae81ff">runners]]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">name = &#34;runner0&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">limit = 8</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">url = &#34;https://gitlab.example.com/&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">token = &#34;sKj-SjZAxxxxxxxxxxxx&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">executor = &#34;shell&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">shell = &#34;bash&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[[<span style="color:#ae81ff">runners]]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">name = &#34;runner1&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">url = &#34;https://gitlab.example.com/&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">token = &#34;z9y9YKkYxxxxxxxxxxxx&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">executor = &#34;shell&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">shell = &#34;bash&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[[<span style="color:#ae81ff">runners]]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">name = &#34;runner2&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">url = &#34;https://gitlab.example.com/&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">token = &#34;wPKY9ovsxxxxxxxxxxxx&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">executor = &#34;shell&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">shell = &#34;bash&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ–°å»ºä¸€ä¸ªæµ‹è¯•ä»£ç åº“<!-- raw HTML omitted --><code>New Project</code></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-3722f5a82c042918ab302522b4478a86" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/Snipaste_2022-04-22_21-38-43.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3722f5a82c042918ab302522b4478a86"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/Snipaste_2022-04-22_21-38-43.png"></a></p>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_gitlab">Use_Gitlab</h1>

<h2 id="ä¿®æ”¹gitlabé…ç½®æ–‡ä»¶">ä¿®æ”¹gitlabé…ç½®æ–‡ä»¶</h2>
<ul>
<li>
<ol>
<li><a href="https://blog.csdn.net/A___LEi/article/details/110476531" rel="external" target="_self"><code>GitLab â†’</code> æ­å»ºä¸­å¸¸é‡çš„é—®é¢˜ä¸æ—¥å¸¸ç»´æŠ¤</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/gitlab/gitlab.rb<span style="color:#e6db74">&lt;&lt;-EOF  	# ä¿®æ”¹gitlabé»˜è®¤ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">external_url &#39;http://185.167.13.45:12580&#39;  	# ä¿®æ”¹é“¾æ¥åœ°å€ï¼Œåœ¨32è¡Œå·¦å³
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">unicorn[&#39;port&#39;] = &#39;9092&#39;  	# ä¿®æ”¹é»˜è®¤ç«¯å£ï¼Œåœ¨ 995è¡Œå·¦å³ï¼Œæ–°ç‰ˆæœ¬æ”¹ä¸ºï¼špuma[&#39;port&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="å¤„ç†gitlabæŠ¥é”™">å¤„ç†gitlabæŠ¥é”™</h2>
<ul>
<li>
<ol>
<li><a href="https://blog.csdn.net/fishinhouse/article/details/105131917" rel="external" target="_self"><code>gitlab runner 500</code>é”™è¯¯è§£å†³</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker exec -it gitlab cat /var/log/gitlab/gitlab-rails/production.log
</span></span><span style="display:flex;"><span>$ gitlab-rails console
</span></span><span style="display:flex;"><span>--------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>Ruby:         ruby 2.7.5p203 <span style="color:#f92672">(</span>2021-11-24 revision f69aeb8314<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>x86_64-linux<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>GitLab:       14.4.4 <span style="color:#f92672">(</span>838dea1cf23<span style="color:#f92672">)</span> FOSS
</span></span><span style="display:flex;"><span>GitLab Shell: 13.21.1
</span></span><span style="display:flex;"><span>PostgreSQL:   12.7
</span></span><span style="display:flex;"><span>--------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>Loading production environment <span style="color:#f92672">(</span>Rails 6.1.4.1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:001:0&gt; ApplicationSetting.current.reset_runners_registration_token!
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; true
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:002:0&gt; exit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ gitlab-rails dbconsole 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-- Clear project tokens<span style="color:#f92672">(</span>æ¸…é™¤é¡¹ç›®ä»¤ç‰Œ<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>UPDATE projects SET runners_token <span style="color:#f92672">=</span> null, runners_token_encrypted <span style="color:#f92672">=</span> null;
</span></span><span style="display:flex;"><span>-- Clear group tokens<span style="color:#f92672">(</span>æ¸…é™¤ç»„ä»¤ç‰Œ<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>UPDATE namespaces SET runners_token <span style="color:#f92672">=</span> null, runners_token_encrypted <span style="color:#f92672">=</span> null;
</span></span><span style="display:flex;"><span>-- Clear instance tokens<span style="color:#f92672">(</span>æ¸…é™¤å®ä¾‹ä»¤ç‰Œ<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>UPDATE application_settings SET runners_registration_token_encrypted <span style="color:#f92672">=</span> null;
</span></span><span style="display:flex;"><span>-- Clear key used <span style="color:#66d9ef">for</span> JWT authentication<span style="color:#f92672">(</span>ç”¨äº JWT èº«ä»½éªŒè¯çš„æ¸…é™¤å¯†é’¥<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>-- This may break the $CI_JWT_TOKEN job variable:
</span></span><span style="display:flex;"><span>-- https://gitlab.com/gitlab-org/gitlab/-/issues/325965
</span></span><span style="display:flex;"><span>UPDATE application_settings SET encrypted_ci_jwt_signing_key <span style="color:#f92672">=</span> null;
</span></span><span style="display:flex;"><span>-- Clear runner tokens<span style="color:#f92672">(</span>æ¸…é™¤è·‘æ­¥è€…ä»¤ç‰Œ<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>UPDATE ci_runners SET token <span style="color:#f92672">=</span> null, token_encrypted <span style="color:#f92672">=</span> null;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å¤„ç†<!-- raw HTML omitted --><code>502</code><!-- raw HTML omitted -->æŠ¥é”™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /etc/gitlab/gitlab.rb  	<span style="color:#75715e"># ä¿®æ”¹gitlabé»˜è®¤ç«¯å£</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠ¥é”™502,ä¸‹åˆ—å–æ¶ˆæ³¨é‡Š</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># unicorn[&#39;port&#39;] = 8088</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># postgresql[&#39;shared_buffers&#39;] = &#34;256MB&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># postgresql[&#39;max_connections&#39;] = 200</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç„¶åé‡å¯<!-- raw HTML omitted --><code>gitlab</code><!-- raw HTML omitted -->ä»¥åŠåšåˆå§‹åŒ–<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ gitlab-ctl reconfigure  	<span style="color:#75715e"># åˆå§‹åŒ–gitlab</span>
</span></span><span style="display:flex;"><span>$ gitlab-ctl restart</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>gitlab 403 forbidden</code><!-- raw HTML omitted -->æŠ¥é”™è§£å†³<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>gitlab</code>ç¨³å®šè¿è¡Œæœ‰ä¸€å¹´å¤šäº†ï¼Œä»Šå¤©ç ”å‘éƒ¨å°ä¼™ä¼´è·‘æ¥è¯´ï¼Œä»–çš„<code>gitlab</code>è®¿é—®ä¸äº†ï¼Œä¸ä¸€ä¼šï¼Œè¿˜æœ‰å‡ ä½å°ä¼™ä¼´ä¹Ÿä¸€æ ·çš„åé¦ˆæŸ¥çœ‹ä»–ä»¬çš„æŠ¥é”™ï¼Œä¸º<code>403 forbidden</code>å¥‡æ€ªçš„æ˜¯ï¼Œæˆ‘è®¿é—®æ˜¯æ­£å¸¸çš„</li>
<li>æ’æŸ¥è¿‡ç¨‹</li>
<li>é¦–å…ˆä¸ŠæœåŠ¡å™¨ï¼ŒæŸ¥çœ‹å„æœåŠ¡å‡æ­£å¸¸<code>gitlab-ctl logs</code>æŸ¥çœ‹æ—¥å¿—ï¼Œå‘ç°æœ‰ä¸€ä¸ª<code>IP 172.17.2.254</code>è®¿é—®è¢«æ‹’ç»ï¼Œè€Œè¿™ä¸ª<code>IP</code>ï¼Œæ˜¯æ— çº¿ç½‘æ®µçš„ç½‘å…³ã€‚ç¬é—´æ˜ç™½äº†ï¼Œä¸èƒ½ç”¨çš„å…¨æ˜¯ç”¨æ— çº¿ä¸Šç½‘çš„åŒå­¦ï¼Œåªè¦æ˜¯ç»è¿‡<code>2.254</code>çš„éƒ½ä¸èƒ½ç”¨ç»§ç»­æŸ¥çœ‹æ—¥å¿—ï¼Œæœ‰ä¸ª<code>xiaoxiao</code>ç”¨æˆ·ï¼Œæœ‰è¿‡å‡ æ¬¡ç™»é™†å¤±è´¥ï¼Œä¹‹åå°±å…¨éƒ½æ˜¯<code>forbidden</code>çœ‹æ¥<code>gitlab</code>æ˜¯æœ‰é˜²çˆ†ç ´æœºåˆ¶ï¼ŒæŸ¥çœ‹é…ç½®æ–‡æ¡£<code>gitlab.yml</code>ï¼Œæœç„¶æœ‰<code>rack_attack</code>çš„é…ç½®ï¼Œå¦‚å›¾ï¼š</li>
</ul>
<p><a href="#R-image-46f5dd0928ebe546250e85d6abb9ede3" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/Snipaste_2022-10-11_20-13-40.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-46f5dd0928ebe546250e85d6abb9ede3"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/Snipaste_2022-10-11_20-13-40.png"></a></p>
<ul>
<li>è§£å†³æ–¹æ³•ï¼Œè¿›å…¥<code>redis</code>ï¼Œåˆ é™¤è¢«å¢™çš„<code>IP</code>åœ°å€å³å¯ä»¥ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/gitlab/embedded/bin/redis-cli -s /var/opt/gitlab/redis/redis.socket keys <span style="color:#e6db74">&#39;*&#39;</span> | grep <span style="color:#e6db74">&#39;rack::attack&#39;</span> | xargs /opt/gitlab/embedded/bin/redis-cli -s /var/opt/gitlab/redis/redis.socket DEL
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>integer<span style="color:#f92672">)</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰§è¡Œè¿™å‘½ä»¤ ä½¿ç”¨æ— çº¿è¿æ¥gitlabçš„ç”µè„‘æ¢å¤æ­£å¸¸ã€‚</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>postfix</code><!-- raw HTML omitted -->å¯åŠ¨æŠ¥é”™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>ä¿®æ”¹<code>/etc/postfix/main.cf</code>ä¸­ï¼š<code>#myhostname = host.domain.tld </code></li>
<li>å…¶ä¸­ï¼š<code>host.domain.tld</code>å¿…é¡»æ˜¯ï¼š<code>xxx.xxxx.xxx</code></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="5">
<li><code>gitlab8.0</code><!-- raw HTML omitted -->ç‰ˆæœ¬æ±‰åŒ–<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…æ‰©å±•æ’ä»¶ä»¥åŠä¸‹è½½æ±‰åŒ–ç‰ˆæœ¬åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install patch git
</span></span><span style="display:flex;"><span><span style="color:#75715e"># git clone https://gitlab.com/xhang/gitlab.git  	# æ±‰åŒ–ç‰ˆæœ¬åº“</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># git diff v10.0.2 v10.0.2-zh &gt; ../10.0.2-zh.diff  	# ç‰ˆæœ¬å¯¹æ¯”</span>
</span></span><span style="display:flex;"><span>$ git clone https://gitlab.com/larryli/gitlab.git</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®æ±‰åŒ–æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd gitlab
</span></span><span style="display:flex;"><span>$ git diff origin/8-0-stable..origin/8-0-zh &gt; patch.diff  	<span style="color:#75715e"># ç”Ÿæˆ:patch.diffæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 &lt; /tmp/patch.diff  	<span style="color:#75715e"># æŠŠ:patch.diffæ–‡ä»¶å®‰è£…åˆ°gitlabå®‰è£…ç›®å½•ä¸‹</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é‡å¯<!-- raw HTML omitted --><code>gitlab</code><!-- raw HTML omitted -->ä»¥åŠåšåˆå§‹åŒ–<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ gitlab-ctl reconfigure
</span></span><span style="display:flex;"><span>$ gitlab-ctl restart  	<span style="color:#75715e"># é‡å¯gitlab</span></span></span></code></pre></div><ul>
<li>
<p><!-- raw HTML omitted -->åœ¨æ‰“åŒ…è¡¥ä¸<!-- raw HTML omitted --><code>patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 &lt; â€¦/v10.8.4-zh.diff</code>
<!-- raw HTML omitted -->åå¯èƒ½ä¼šå‡ºæ¥è¯¥æƒ…å†µï¼Œä¸€è·¯å›è½¦è·³è¿‡å³å¯<!-- raw HTML omitted --></p>
<p><a href="#R-image-bc3ff4019847ae7b2db9d250ab84e2fc" class="lightbox-link"><img alt="æ±‰åŒ–" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/languge-zh.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bc3ff4019847ae7b2db9d250ab84e2fc"><img alt="æ±‰åŒ–" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/languge-zh.png"></a></p>
<p><a href="#R-image-4299e67a0fa5ae41ec930a80e5e6279d" class="lightbox-link"><img alt="æ±‰åŒ–2" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/languge-zh-1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4299e67a0fa5ae41ec930a80e5e6279d"><img alt="æ±‰åŒ–2" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/languge-zh-1.png"></a></p>
</li>
</ul>
</blockquote>
<hr>
<h2 id="ä¿®æ”¹gitlabç®¡ç†å‘˜å¯†ç çš„ä¸‰ç§æ–¹å¼">ä¿®æ”¹<code>gitlab</code>ç®¡ç†å‘˜å¯†ç çš„ä¸‰ç§æ–¹å¼</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æ–¹æ³•ä¸€ï¼Œä½¿ç”¨<!-- raw HTML omitted --><code>id</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:001:0&gt; user <span style="color:#f92672">=</span> User.where<span style="color:#f92672">(</span>id:<span style="color:#f92672">[</span>user<span style="color:#960050;background-color:#1e0010">&#39;</span>s register index<span style="color:#f92672">])</span>.first</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->æ–¹æ³•äºŒï¼Œä½¿ç”¨é‚®ç®±<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:001:0&gt; user <span style="color:#f92672">=</span> User.where<span style="color:#f92672">(</span>email:<span style="color:#f92672">[</span>user<span style="color:#960050;background-color:#1e0010">&#39;</span>s register email<span style="color:#f92672">])</span>.first</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æ–¹æ³•ä¸‰ï¼Œä½¿ç”¨ç”¨æˆ·å<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:001:0&gt; user <span style="color:#f92672">=</span> User.where<span style="color:#f92672">(</span>name:<span style="color:#f92672">[</span>user<span style="color:#960050;background-color:#1e0010">&#39;</span>s register name<span style="color:#f92672">])</span>.first</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ‰§è¡Œå‘½ä»¤è¿›å…¥æ§åˆ¶å°ï¼š<!-- raw HTML omitted --><code>gitlab-rails console production</code><!-- raw HTML omitted -->ï¼Œå¦‚æœæŠ¥é”™æ‰§è¡Œï¼š<!-- raw HTML omitted --><code>gitlab-rails console -e production</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ gitlab-rails console -e production
</span></span><span style="display:flex;"><span>--------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>GitLab:       12.8.6 <span style="color:#f92672">(</span>5fc76a64537<span style="color:#f92672">)</span> FOSS
</span></span><span style="display:flex;"><span>GitLab Shell: 11.0.0
</span></span><span style="display:flex;"><span>PostgreSQL:   10.12
</span></span><span style="display:flex;"><span>--------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>Loading production environment <span style="color:#f92672">(</span>Rails 6.0.2<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:001:0&gt; user <span style="color:#f92672">=</span> User.where<span style="color:#f92672">(</span>id: 1<span style="color:#f92672">)</span>.first
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; <span style="color:#75715e">#&lt;User id:1 @root&gt;</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:002:0&gt; user.password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;12345678&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;12345678&#34;</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:003:0&gt; user.password_confirmation <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;12345678&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;12345678&#34;</span>
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:004:0&gt; user.save!
</span></span><span style="display:flex;"><span>Enqueued ActionMailer::DeliveryJob <span style="color:#f92672">(</span>Job ID: b6aca58a-cfde-4890-aa22-a8f491290c96<span style="color:#f92672">)</span> to Sidekiq<span style="color:#f92672">(</span>mailers<span style="color:#f92672">)</span> with arguments: <span style="color:#e6db74">&#34;DeviseMailer&#34;</span>, <span style="color:#e6db74">&#34;password_change&#34;</span>, <span style="color:#e6db74">&#34;deliver_now&#34;</span>, <span style="color:#75715e">#&lt;GlobalID:0x00007f79cb5f5298 @uri=#&lt;URI::GID gid://gitlab/User/1&gt;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; true
</span></span><span style="display:flex;"><span>irb<span style="color:#f92672">(</span>main<span style="color:#f92672">)</span>:005:0&gt; exit</span></span></code></pre></div></blockquote>
<hr>
<h2 id="gitlabé…ç½®é‚®ç®±"><code>Gitlab</code>é…ç½®é‚®ç®±</h2>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /etc/gitlab/gitlab.ra
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gitlab_rails[&#39;smtp_enable&#39;] = true</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gitlab_rails[&#39;smtp_address&#39;] = &#34;smtp.server&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gitlab_rails[&#39;smtp_port&#39;] = 465</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gitlab_rails[&#39;smtp_user_name&#39;] = &#34;smtp user&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gitlab_rails[&#39;smtp_password&#39;] = &#34;smtp password&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gitlab_rails[&#39;smtp_domain&#39;] = &#34;example.com&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gitlab_rails[&#39;smtp_authentication&#39;] = &#34;login&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gitlab_rails[&#39;smtp_enable_starttls_auto&#39;] = true</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gitlab_rails[&#39;smtp_tls&#39;] = false</span></span></span></code></pre></div><p><a href="#R-image-c259bfc8ca98267ed7584a4d5a3dace5" class="lightbox-link"><img alt="configure-git-email" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/configure-git-email.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c259bfc8ca98267ed7584a4d5a3dace5"><img alt="configure-git-email" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Gitlab_Server/configure-git-email.png"></a></p>
</blockquote>
<hr>
<h2 id="gitlabç‰ˆæœ¬å‡çº§"><code>Gitlab</code>ç‰ˆæœ¬å‡çº§</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.gitlab.com/ee/update/index.html#upgrade-paths" rel="external" target="_self"><code>Gitlab</code>å‡çº§</a></td>
<td>å‡çº§åšå®¢</td>
</tr>
<tr>
<td><a href="https://zhuanlan.zhihu.com/p/352342116" rel="external" target="_self"><code>Gitlab</code>ç‰ˆæœ¬å‡çº§</a></td>
<td>å‡çº§åšå®¢</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-9.5.10
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-10.8.7
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-11.11.8
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-12.0.12
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-12.1.17
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-12.10.14
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-13.0.14
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-13.1.11
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-13.8.8
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-13.12.15
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-14.0.12
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-14.1.1  	<span style="color:#75715e"># 14.1.1ä¸ºè¿‡åº¦å¿…é¡»ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-14.2.1  	<span style="color:#75715e"># 14.2.1ä¸ºè¿‡åº¦å¿…é¡»ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-14.3.6
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-14.9.5
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-14.10.Z
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-15.0.Z
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-15.1.Z
</span></span><span style="display:flex;"><span>$ yum install -y gitlab-ce-15.4.0</span></span></code></pre></div></blockquote>
<hr>
<h2 id="gitlabå¤‡ä»½è¿˜åŸ"><code>Gitlab</code>å¤‡ä»½è¿˜åŸ</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.jianshu.com/p/a2600f8dffc2" rel="external" target="_self"><code>Gitlab</code>å¤‡ä»½è¿˜åŸ</a></td>
<td>å¤‡ä»½è¿˜åŸåšå®¢</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»ºå¤‡ä»½ï¼Œåˆ›å»ºåä¼šåœ¨ï¼š<!-- raw HTML omitted --><code>/var/opt/gitlab/backups/</code><!-- raw HTML omitted -->ç›®å½•ä¸‹ç”Ÿæˆå¤‡ä»½æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ gitlab-rake gitlab:backup:create</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¤‡ä»½è¿˜åŸå‰å…ˆåœæ­¢ç›¸å…³æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ gitlab-ctl stop unicorn  	<span style="color:#75715e"># docker exec -it gitlab gitlab-ctl stop unicorn</span>
</span></span><span style="display:flex;"><span>$ gitlab-ctl stop sidekiq  	<span style="color:#75715e"># docker exec -it gitlab gitlab-ctl stop sidekiq</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä»é»˜è®¤å¤‡ä»½æ¢å¤ï¼Œä»¥åŠ<!-- raw HTML omitted --><code>backups</code><!-- raw HTML omitted -->ç›®å½•ä¸‹æœ‰å¤šä¸ªå¤‡ä»½æ–‡ä»¶æ—¶ï¼ŒæŒ‡å®šæ—¶é—´æˆ³æ¢å¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ gitlab-rake gitlab:backup:restore BACKUP<span style="color:#f92672">=</span><span style="color:#ae81ff">1500809139</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»é»˜è®¤å¤‡ä»½æ¢å¤ï¼ˆbackupsç›®å½•ä¸‹åªæœ‰ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶æ—¶ï¼‰</span>
</span></span><span style="display:flex;"><span>$ gitlab-rake gitlab:backup:restore  	<span style="color:#75715e"># docker exec -it gitlab gitlab-rake gitlab:backup:restore</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¡®è®¤<!-- raw HTML omitted --><code>ï¼šgitlab-secrets.json</code><!-- raw HTML omitted -->æ–‡ä»¶æ˜¯å¦æœ‰åšå¤‡ä»½ï¼Œå¦‚æœå¿˜è®°åšå¤‡ä»½éœ€è¦åšæ¸…ç©ºå¤„ç†<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ gitlab-rails dbconsole
</span></span><span style="display:flex;"><span>$ gitlab-psql -d gitlabhq_production
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç­‰å¾…å‡ åˆ†é’Ÿï¼Œä¼šè¿›å…¥äº¤äº’ç•Œé¢ï¼Œè¿›å…¥åè¾“å…¥å¦‚ä¸‹å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ SELECT * FROM public.<span style="color:#e6db74">&#34;ci_group_variables&#34;</span>;
</span></span><span style="display:flex;"><span>$ SELECT * FROM public.<span style="color:#e6db74">&#34;ci_variables&#34;</span>;
</span></span><span style="display:flex;"><span>$ DELETE FROM ci_group_variables;
</span></span><span style="display:flex;"><span>$ DELETE FROM ci_variables;
</span></span><span style="display:flex;"><span>$ UPDATE projects SET runners_token <span style="color:#f92672">=</span> null, runners_token_encrypted <span style="color:#f92672">=</span> null;
</span></span><span style="display:flex;"><span>$ UPDATE namespaces SET runners_token <span style="color:#f92672">=</span> null, runners_token_encrypted <span style="color:#f92672">=</span> null;
</span></span><span style="display:flex;"><span>$ UPDATE application_settings SET runners_registration_token_encrypted <span style="color:#f92672">=</span> null;
</span></span><span style="display:flex;"><span>$ UPDATE application_settings SET encrypted_ci_jwt_signing_key <span style="color:#f92672">=</span> null;
</span></span><span style="display:flex;"><span>$ UPDATE ci_runners SET token <span style="color:#f92672">=</span> null, token_encrypted <span style="color:#f92672">=</span> null;
</span></span><span style="display:flex;"><span>$ UPDATE ci_builds SET token <span style="color:#f92672">=</span> null, token_encrypted <span style="color:#f92672">=</span> null;
</span></span><span style="display:flex;"><span>$ TRUNCATE web_hooks CASCADE;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è¿˜åŸåå¯åŠ¨<!-- raw HTML omitted --><code>Gitlab</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ gitlab-ctl start  	<span style="color:#75715e"># docker exec -it gitlab gitlab-ctl start</span>
</span></span><span style="display:flex;"><span>$ gitlab-ctl reconfigure  	<span style="color:#75715e"># docker exec -it gitlab gitlab-ctl reconfigure</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="gitlabæ¢å¤æ•°æ®æŠ¥é”™è§£å†³æ–¹æ³•"><code>Gitlab</code>æ¢å¤æ•°æ®æŠ¥é”™è§£å†³æ–¹æ³•</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.jianshu.com/p/09a2b0c25ecd" rel="external" target="_self"><code>Gitlab</code>æ¢å¤æ•°æ®æŠ¥é”™è§£å†³æ–¹æ³•</a></td>
<td>åšå®¢åœ°å€</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>postgresql</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /var/opt/gitlab/postgresql/data/postgresql.conf
</span></span><span style="display:flex;"><span>listen_addresses <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;*&#39;</span>  	<span style="color:#75715e"># ä¸­æ·»åŠ *ç¬¦å·</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æœ€ä¸‹é¢æ–°å¢ä¸¤è¡Œ</span>
</span></span><span style="display:flex;"><span>$ vim /var/opt/gitlab/postgresql/data/pg_hba.conf
</span></span><span style="display:flex;"><span>local   all         all                               trust
</span></span><span style="display:flex;"><span>host    all         all                               127.0.0.1/32 trust
</span></span><span style="display:flex;"><span>$ gitlab-ctl restart</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>gitlab</code><!-- raw HTML omitted -->è´¦å·ä¸ºè¶…çº§ç”¨æˆ·<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ su - gitlab-psql
</span></span><span style="display:flex;"><span>Last login: Fri Dec <span style="color:#ae81ff">24</span> 17:35:01 CST <span style="color:#ae81ff">2021</span> on pts/0
</span></span><span style="display:flex;"><span>-sh-4.2$ /opt/gitlab/embedded/bin/psql -h 127.0.0.1 gitlabhq_production
</span></span><span style="display:flex;"><span>psql <span style="color:#f92672">(</span>12.7<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SSL connection <span style="color:#f92672">(</span>protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Type <span style="color:#e6db74">&#34;help&#34;</span> <span style="color:#66d9ef">for</span> help.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gitlabhq_production<span style="color:#f92672">=</span><span style="color:#75715e"># ALTER USER gitlab WITH SUPERUSER;</span>
</span></span><span style="display:flex;"><span>ALTER ROLE
</span></span><span style="display:flex;"><span>gitlabhq_production<span style="color:#f92672">=</span><span style="color:#75715e"># \q</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="é…ç½®gitlabçš„nginxæ˜ å°„ä»¥åŠç™½åå•">é…ç½®<code>Gitlab</code>çš„<code>Nginx</code>æ˜ å°„ä»¥åŠç™½åå•</h2>
<blockquote>
<ul>
<li><code>Gitlab</code><!-- raw HTML omitted -->ç™½åå•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/gitlab/gitlab.rb<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gitlab_rails[&#39;rack_attack_git_basic_auth&#39;] = {  	# 670 è¡Œå·¦å³
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #&#39;enabled&#39; =&gt; true,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#39;enabled&#39; =&gt; false,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#39;ip_whitelist&#39; =&gt; [&#34;IP&#34;,&#34;127.0.0.1&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#39;maxretry&#39; =&gt; 10,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#39;findtime&#39; =&gt; 60,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#39;bantime&#39; =&gt; 86400
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹å±•ç¤º<!-- raw HTML omitted --><code>Gitlab UI</code><!-- raw HTML omitted -->ç«¯çš„<!-- raw HTML omitted --><code>SSH</code><!-- raw HTML omitted -->ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/gitlab/gitlab.rb<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gitlab_rails[&#39;gitlab_shell_ssh_port&#39;] = 18082  	# 651 è¡Œå·¦å³ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_git_command">Use_Git_Command</h1>

<h2 id="gitå‘½ä»¤"><code>git</code>å‘½ä»¤</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://git-scm.com/docs/git-submodule" rel="external" target="_self"><code>Git</code>å®˜ç½‘</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://mirrors.edge.kernel.org/pub/software/scm/git/" rel="external" target="_self"><code>Git</code>å‘½ä»¤å·¥å…·ä¸‹è½½åœ°å€</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://iphysresearch.github.io/blog/post/programing/git/git_submodule/" rel="external" target="_self"><code>Git: submodule</code>å­æ¨¡å—ç®€æ˜æ•™ç¨‹</a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åˆå§‹é…ç½®ã€è·å–ä»“åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->é…ç½®ç¯å¢ƒæäº¤æ‰€ç”¨è´¦æˆ·ä»¥åŠé‚®ç®±<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git config --global user.name <span style="color:#e6db74">&#34;name&#34;</span>
</span></span><span style="display:flex;"><span>$ git config --global user.emamil <span style="color:#e6db74">&#34;name@gmail.com&#34;</span>
</span></span><span style="display:flex;"><span>$ git config --global core.sshCommand <span style="color:#e6db74">&#34;ssh -i ~/.ssh/id_rsa&#34;</span>  	<span style="color:#75715e"># é…ç½®å¯†é’¥</span></span></span></code></pre></div></li>
<li>
<p><!-- raw HTML omitted -->å…‹éš†ç°æœ‰è¿œç¨‹ä»£ç åˆ°æœ¬åœ°å¼€å‘<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/zabbix/zabbix.git
</span></span><span style="display:flex;"><span>$ git clone --recursive git@github.com:username/service.git  	<span style="color:#75715e"># å…‹éš†å¸¦æœ‰å­æ¨¡å—ä»“åº“</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤å­æ¨¡å—</span>
</span></span><span style="display:flex;"><span>$ vim .gitmodules  	<span style="color:#75715e"># åˆ é™¤æ–‡ä»¶å†…å­æ¨¡å—é…ç½®</span>
</span></span><span style="display:flex;"><span>$ vim .git/config  	<span style="color:#75715e"># åˆ é™¤æ–‡ä»¶å†…å­æ¨¡å—é…ç½®</span>
</span></span><span style="display:flex;"><span>$ rm -rf .git/module/*  	<span style="color:#75715e"># åˆ é™¤å­æ¨¡å—ä¸‹ç›®å½•æ–‡ä»¶</span></span></span></code></pre></div></li>
<li>
<p><!-- raw HTML omitted -->æœ¬åœ°åˆ›å»ºä»“åº“<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git init  	<span style="color:#75715e"># åˆå§‹åŒ–gitæœ¬åœ°ä»“åº“ï¼Œåˆå§‹åŒ–ååœ¨æœ¬åœ°ç”Ÿæˆä¸€ä¸ª.gitç›®å½•</span>
</span></span><span style="display:flex;"><span>$ git add .  	<span style="color:#75715e"># æŠŠä¿®æ”¹æˆ–è€…æ·»åŠ æ–‡ä»¶åˆ°ç´¢å¼•ä¸­ï¼š-Aï¼šå‚æ•°ä»£è¡¨æ‰€æœ‰</span>
</span></span><span style="display:flex;"><span>$ git commit -m <span style="color:#e6db74">&#34;æ¸…é™¤ç¼“å­˜&#34;</span>  	<span style="color:#75715e"># å£°æ˜æœ¬æ¬¡ä¿®æ”¹æˆ–æ·»åŠ å†…å®¹å¹¶ä¸”äº¤åˆ°æœ¬åœ°ä»“åº“</span></span></span></code></pre></div></li>
<li>
<p><!-- raw HTML omitted -->æ‹‰å–æ¨é€ä»“åº“<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git pull -u origin master  	<span style="color:#75715e"># æ‹‰å–masteråˆ†æ”¯åˆ°æœ¬åœ°-f:å¼ºåˆ¶æ‹‰å–ï¼Œ</span>
</span></span><span style="display:flex;"><span>$ git push -u origin master  	<span style="color:#75715e"># æ¨é€masteråˆ†æ”¯åˆ°è¿œç¨‹</span></span></span></code></pre></div></li>
<li>
<p><!-- raw HTML omitted -->æäº¤æ—¶è½¬æ¢ä¸º<!-- raw HTML omitted --><code>LF</code><!-- raw HTML omitted -->æ£€å‡ºæ—¶ä¸è½¬æ¢<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git config --global core.autocrlf input</span></span></code></pre></div></li>
<li>
<p><!-- raw HTML omitted -->åˆ‡æ¢ã€æŸ¥çœ‹ã€åˆå¹¶åˆ†æ”¯<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git fetch  	<span style="color:#75715e"># æŸ¥çœ‹çº¿ä¸Šåˆ†æ”¯,--all:æŸ¥çœ‹çº¿ä¸Šæ‰€æœ‰åˆ†æ”¯</span>
</span></span><span style="display:flex;"><span>$ git branch -a  	<span style="color:#75715e"># -aï¼šæŸ¥çœ‹æœ¬åœ°å½“å‰åˆ†æ”¯ã€devï¼šåˆ›å»ºdevåˆ†æ”¯ã€-dï¼šåˆ é™¤åˆ†æ”¯ã€-Dï¼šå¼ºåˆ¶åˆ é™¤</span>
</span></span><span style="display:flex;"><span>$ git checkout dev  	<span style="color:#75715e"># åˆ‡æ¢åˆ†æ”¯ï¼Œdevï¼šåˆ‡æ¢åˆ°devåˆ†æ”¯</span>
</span></span><span style="display:flex;"><span>$ git checkout .  	<span style="color:#75715e"># æ”¾å¼ƒæœ¬åœ°æ‰€æœ‰ä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>$ git merge -m <span style="color:#e6db74">&#39;åˆå¹¶devåˆ†æ”¯åˆ°master&#39;</span> dev  	<span style="color:#75715e"># å…ˆåˆ‡æ¢åˆ°masteråˆ†æ”¯</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å½“å‰ç‰ˆåˆ†æ”¯</span>
</span></span><span style="display:flex;"><span>$ git rev-parse --abbrev-ref HEAD
</span></span><span style="display:flex;"><span>$ git name-rev --name-only HEAD
</span></span><span style="display:flex;"><span>$ git branch --show-current  	<span style="color:#75715e"># æ­¤æ–¹å¼éœ€è¦git 2.22ç‰ˆæœ¬æˆ–è€…ä»¥ä¸Š</span></span></span></code></pre></div></li>
<li>
<p><!-- raw HTML omitted -->å›é€€ç‰ˆæœ¬<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git reset --hard  	<span style="color:#75715e"># å›é€€ç‰ˆæœ¬ã€å¯é€‰æ‹©ç‰ˆæœ¬åˆ†æ”¯å·å›é€€</span>
</span></span><span style="display:flex;"><span>$ git reset --hard HEAD~3  	<span style="color:#75715e"># è§£å†³ä»£ç å†²çª</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ git rm -r --cached .  <span style="color:#75715e"># æ¸…æ¥šæœ¬åœ°ç¼“å­˜</span></span></span></code></pre></div></li>
<li>
<p>1.8 <!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>git</code><!-- raw HTML omitted -->ä»“åº“çŠ¶æ€ä»¥åŠæ—¥å¿—<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git status  	<span style="color:#75715e"># å‘½ä»¤æŸ¥çœ‹å½“å‰gitä»“åº“çš„çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>$ git log -5  	<span style="color:#75715e"># æŸ¥çœ‹æœ€è¿‘äº”æ¬¡æ—¥å¿—ï¼Œv2.5.. Makefile fs/:æ‰¾å‡ºæ‰€æœ‰ä»&#34;v2.5&#34;å¼€å§‹åœ¨fsç›®å½•ä¸‹çš„æ‰€æœ‰Makefileçš„ä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>$ git log --stat  	<span style="color:#75715e"># æ˜¾ç¤ºåœ¨æ¯ä¸ªæäº¤(commit)ä¸­å“ªäº›æ–‡ä»¶è¢«ä¿®æ”¹, è¿™äº›æ–‡ä»¶åˆ†åˆ«æ·»åŠ æˆ–åˆ é™¤å¤šå°‘è¡Œå†…å®¹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ git diff --cached  	<span style="color:#75715e"># diffæ¯”è¾ƒé€‰é¡¹å†åŠ ä¸Š --cachedå‚æ•°ï¼Œçœ‹çœ‹ç¼“å­˜åŒºä¸­å“ªäº›æ–‡ä»¶è¢«ä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>$ git diff --name-only --diff-filter<span style="color:#f92672">=</span>ACMRT old_commit new_commit
</span></span><span style="display:flex;"><span>$ git diff <span style="color:#e6db74">${</span>current_id<span style="color:#e6db74">}</span> <span style="color:#e6db74">${</span>commit_id<span style="color:#e6db74">}</span> --name-only | grep dist_prod
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ git rev-parse HEAD  	<span style="color:#75715e"># è·å–å½“å‰ç‰ˆæœ¬commit idï¼Œå‚æ•°ï¼š --short</span>
</span></span><span style="display:flex;"><span>$ git rev-list HEAD -2  	<span style="color:#75715e"># æŸ¥çœ‹å†å²commit idï¼Œ-2ï¼šä»£è¡¨æŸ¥çœ‹æœ€è¿‘å‡ æ¬¡</span>
</span></span><span style="display:flex;"><span>$ git log --pretty<span style="color:#f92672">=</span>oneline  	<span style="color:#75715e"># æ ¼å¼åŒ–æ—¥å¿—è¾“å‡ºã€‚--prettyå‚æ•°å¯ä»¥ä½¿ç”¨è‹¥å¹²è¡¨ç°æ ¼å¼ï¼Œ</span>
</span></span><span style="display:flex;"><span>								<span style="color:#75715e"># å¦‚onelineï¼Œ--pretty=shortï¼Œ</span>
</span></span><span style="display:flex;"><span>								<span style="color:#75715e"># ä¹Ÿå¯ç”¨medium,full,fuller,email æˆ– rawï¼Œ</span>
</span></span><span style="display:flex;"><span>								<span style="color:#75715e"># ä¹Ÿå¯ä»¥ç”¨--pretty=formatå‚æ•°å®šä¹‰æ ¼å¼ï¼Œ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ git log --graph --pretty<span style="color:#f92672">=</span>oneline  	<span style="color:#75715e"># --graph é€‰é¡¹ï¼Œ</span>
</span></span><span style="display:flex;"><span>							<span style="color:#75715e"># å¯ä»¥å¯è§†åŒ–ä½ çš„æäº¤å›¾(commit graph)ï¼Œ</span>
</span></span><span style="display:flex;"><span>							<span style="color:#75715e"># ä¼šç”¨ASCIIå­—ç¬¦æ¥ç”»å‡ºä¸€ä¸ªå¾ˆæ¼‚äº®çš„æäº¤å†å²(commit history)çº¿ï¼š</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ git log --pretty<span style="color:#f92672">=</span>%s 3ff4f298f7a13ab0150e369f4bbcf43a553c05a5 -1  	<span style="color:#75715e"># è·å–å˜æ›´æ–‡ä»¶æ³¨é‡Šä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æµ‹è¯•ç½‘ç»œ git ssh</span>
</span></span><span style="display:flex;"><span>$ ssh -T git.gitlab.com</span></span></code></pre></div></li>
<li>
<p><!-- raw HTML omitted -->ç¼“å­˜ä¿å­˜å‘½ä»¤<!-- raw HTML omitted --><a href="https://www.jianshu.com/p/1c7ecc8d3dfb" rel="external" target="_self"><code>git-stash</code>ç”¨æ³•å°ç»“</a></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git stash save <span style="color:#e6db74">&#34;test-cmd-stash&#34;</span>
</span></span><span style="display:flex;"><span>$ git stash pop</span></span></code></pre></div></li>
</ul>
</blockquote>
<hr>
<h3 id="å¤„ç†gitæ–‡ä»¶è¿‡å¤§">å¤„ç†<code>git</code>æ–‡ä»¶è¿‡å¤§</h3>
<ul>
<li>
<ol>
<li><a href="https://www.zhihu.com/question/29769130" rel="external" target="_self">è§£å†³<code>git</code>æäº¤æ¬¡æ•°è¿‡å¤šå¯¼è‡´æ–‡ä»¶è¿‡å¤§</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->è¿è¡Œ <code>gc</code> ï¼Œç”Ÿæˆ <code>pack</code> æ–‡ä»¶ï¼ˆåé¢çš„ <code>--prune=now</code> è¡¨ç¤ºå¯¹ä¹‹å‰çš„æ‰€æœ‰æäº¤åšä¿®å‰ªï¼Œæœ‰çš„æ—¶å€™ä»…ä»… <code>gc</code> ä¸€ä¸‹<code>.git</code> æ–‡ä»¶å°±ä¼šå°å¾ˆå¤šï¼‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git gc --prune<span style="color:#f92672">=</span>now</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æ‰¾å‡ºæœ€å¤§çš„ä¸‰ä¸ªæ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git verify-pack -v .git/objects/pack/*.idx | sort -k <span style="color:#ae81ff">3</span> -n | tail -3
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¤ºä¾‹è¾“å‡ºï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1debc758cf31a649c2fc5b0c59ea1b7f01416636 blob   4925660 3655422 14351</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># c43a8da9476f97e84b52e0b34034f8c2d93b4d90 blob   154188651 152549294 12546842</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2272096493d061489349e0a312df00dcd0ec19a2 blob   155414465 153754005 165096136</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æŸ¥çœ‹é‚£äº›å¤§æ–‡ä»¶ç©¶ç«Ÿæ˜¯è°ï¼ˆ<code>c43a8da</code> æ˜¯ä¸Šé¢å¤§æ–‡ä»¶çš„<code>hash</code>ç ï¼‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git rev-list --objects --all | grep c43a8da
</span></span><span style="display:flex;"><span><span style="color:#75715e"># c43a8da9476f97e84b52e0b34034f8c2d93b4d90 data/bigfile</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ç§»é™¤å¯¹è¯¥æ–‡ä»¶çš„å¼•ç”¨ï¼ˆä¹Ÿå°±æ˜¯ <code>data/bigfile</code>ï¼‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git filter-branch --force --index-filter <span style="color:#e6db74">&#34;git rm --cached --ignore-unmatch &#39;data/bigfile&#39;&#34;</span>  --prune-empty --tag-name-filter cat -- --all</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->è¿›è¡Œ <code>repack</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git <span style="color:#66d9ef">for</span>-each-ref --format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;delete %(refname)&#39;</span> refs/original | git update-ref --stdin
</span></span><span style="display:flex;"><span>$ git reflog expire --expire<span style="color:#f92672">=</span>now --all
</span></span><span style="display:flex;"><span>$ git gc --prune<span style="color:#f92672">=</span>now</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><!-- raw HTML omitted -->æŸ¥çœ‹ <code>pack</code> çš„ç©ºé—´ä½¿ç”¨æƒ…å†µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git count-objects -v</span></span></code></pre></div></blockquote>
<hr>
<h3 id="lfsåŠŸèƒ½å‹ç¼©å¤§æ–‡ä»¶"><code>LFS</code>åŠŸèƒ½å‹ç¼©å¤§æ–‡ä»¶</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å¼€å¯<!-- raw HTML omitted --><code>LFS</code><!-- raw HTML omitted -->åŠŸèƒ½<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git lfs install</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>LFS</code><!-- raw HTML omitted -->è¦ç®¡ç†çš„æ–‡ä»¶ç±»å‹<!-- raw HTML omitted --><code>pthã€mmdbã€packã€idx</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git lfs track <span style="color:#e6db74">&#34;*.pth&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æŠ¥<!-- raw HTML omitted --><code>LFS</code><!-- raw HTML omitted -->é”™ï¼Œåœ¨æ‰§è¡Œä¸Šé¢çš„æœ€åä¸€æ­¥ä¸Šä¼ å‘½ä»¤çš„æ—¶å€™å¯èƒ½ä¼šæŠ¥ä¸¤ä¸ªé”™è¯¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç¬¬ä¸€ä¸ªé”™è¯¯ï¼š<!-- raw HTML omitted --><code>WARNING: Authentication error: Authentication required: LFS only supported repository in paid enterprise.</code><!-- raw HTML omitted -->ã€‚å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤, å‘½ä»¤ä¸­çš„<!-- raw HTML omitted --><code>{your_gitee}/{your_repo}</code><!-- raw HTML omitted -->æ˜¯ä½ çš„è¿œç¨‹ä»“åº“åœ°å€,æ ¹æ®è‡ªå·±æƒ…å†µæ›¿æ¢<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git config lfs.https://gitee.com/<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>your_gitee<span style="color:#f92672">}</span>/<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>your_repo<span style="color:#f92672">}</span>.git/info/lfs.locksverify false</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¬¬äºŒä¸ªé”™è¯¯ï¼š<!-- raw HTML omitted --><code>batch response: LFS only supported repository in paid enterprise.</code><!-- raw HTML omitted -->Â ã€‚å¯ä»¥å°è¯•åˆ é™¤<!-- raw HTML omitted --><code>./git/hooks/pre-push</code><!-- raw HTML omitted -->æ–‡ä»¶,æœ€åé‡æ–°<!-- raw HTML omitted --><code>push</code><!-- raw HTML omitted -->ä¸€ä¸‹å³å¯<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h3 id="gitè·å–ä»“åº“æŒ‡å®šç›®å½•æˆ–æ–‡ä»¶"><code>git</code>è·å–ä»“åº“æŒ‡å®šç›®å½•æˆ–æ–‡ä»¶</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æ­¤åŠŸèƒ½åªåœ¨<!-- raw HTML omitted --><code>1.7.0</code><!-- raw HTML omitted -->ä»¥ä¸Šç‰ˆæœ¬æä¾›<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir test <span style="color:#f92672">&amp;&amp;</span> cd test
</span></span><span style="display:flex;"><span>$ git init
</span></span><span style="display:flex;"><span>$ git remote add origin https://xxxx.com/xxx.git
</span></span><span style="display:flex;"><span>$ git config core.sparsecheckout true  	<span style="color:#75715e"># ä½¿ç”¨Sparse checkoutæ¨¡å¼</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;redis-conf/*&#34;</span> &gt;&gt; .git/info/sparse-checkout  	<span style="color:#75715e"># å°†æ£€å‡ºçš„ç›®å½•æˆ–æ–‡ä»¶ä½¿ç”¨æ–‡ä»¶è¿½åŠ çš„å½¢å¼å†™å…¥åˆ°gitçš„é…ç½®.git/info/sparse-checkoutæ–‡ä»¶ä¸­ï¼Œå…è®¸æ·»åŠ å¤šè¡Œ</span>
</span></span><span style="display:flex;"><span>$ git pull origin master  	<span style="color:#75715e"># è·å–åˆ°éœ€è¦çš„æ–‡ä»¶æˆ–ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ git checkout  	<span style="color:#75715e"># åœ¨å¯¹é…ç½®æ–‡ä»¶.git/info/sparse-checkoutçš„å†…å®¹è¿›è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œä¹‹åï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤é‡æ–°ä¿®æ­£ç›®å½•å’Œæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ git push origin master</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_gogs">Install_Gogs</h1>

<h2 id="gogs"><code>Gogs</code></h2>
<blockquote>
<ul>
<li><a href="https://gogs.io/" rel="external" target="_self"><code>Gogs</code>å®˜ç½‘</a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_gitlab">Install_Gitlab</h1>

<h2 id="gitlabç®€ä»‹ä»¥åŠå®‰è£…"><code>gitlab</code>ç®€ä»‹ä»¥åŠå®‰è£…</h2>
<blockquote>
<ul>
<li><a href="https://packages.gitlab.com/gitlab/gitlab-ce" rel="external" target="_self"><code>gitlab</code>å®‰è£…åŒ…åº“</a></li>
<li><a href="https://github.com/go-gitea/gitea/" rel="external" target="_self"><code>Gitea</code></a></li>
<li><code>GitLab</code>æ˜¯ç®¡ç†<code>Git</code>å­˜å‚¨åº“çš„å¹³å°ã€‚ <code>GitLab</code>æä¾›å…è´¹çš„å…¬å…±å’Œç§äººå­˜å‚¨åº“ï¼Œé—®é¢˜è·Ÿè¸ªå’Œç»´åŸºã€‚ <code>GitLab</code>æ˜¯<code>Git</code>ä¹‹ä¸Šçš„ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„<code>Web</code>ç•Œé¢å±‚ï¼Œå®ƒæé«˜äº†ä½¿ç”¨<code>Git</code>çš„é€Ÿåº¦ã€‚ <code>GitLab</code>æä¾›äº†è‡ªå·±çš„æŒç»­é›†æˆ<code>CI</code>ç³»ç»Ÿæ¥ç®¡ç†é¡¹ç›®ï¼Œå¹¶æä¾›ç”¨æˆ·ç•Œé¢ä»¥åŠ<code>GitLab</code>çš„å…¶ä»–åŠŸèƒ½ã€‚</li>
<li><code>cat /etc/gitlab/initial_root_password | grep Password</code> è·å–åˆå§‹å¯†ç </li>
</ul>
</blockquote>
<hr>
<h3 id="å®‰è£…å‰å‡†å¤‡">å®‰è£…å‰å‡†å¤‡</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…æ‰©å±•æ’ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y  make telnet  inotify-tools tree rdate ntp gcc gcc-c++ psmisc net-tools screen expect sysstat hdparm traceroute zip unzip pcre pcre-devel zlib zlib-devel openssl openssl-devel tcping libaio dig epel-release wget git
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install lsof zeromq-devel policycoreutils openssh-server openssh-clients  policycoreutils-python postfix perl patch cronie</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>postfix</code><!-- raw HTML omitted -->å¹¶è®¾ç½®å¼€æœºè‡ªå¯ï¼Œ<!-- raw HTML omitted --><code>gitlab</code><!-- raw HTML omitted -->éœ€è¦<!-- raw HTML omitted --><code>postfix</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl enable postfix <span style="color:#f92672">&amp;&amp;</span> systemctl start postfix</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="yumæŒ‰ç…§gitlab"><code>yum</code>æŒ‰ç…§<code>Gitlab</code></h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Gitlab</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>gitlab yum</code><!-- raw HTML omitted -->ä»“åº“ï¼Œå®‰è£…<!-- raw HTML omitted --><code>Gitlab</code><a href="https://about.gitlab.com/install/#centos-7" rel="external" target="_self"><code>yum</code>å®‰è£…<code>Gitlab</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash
</span></span><span style="display:flex;"><span>$ yum list gitlab-ce*  	<span style="color:#75715e"># åˆ—å‡ºè¦å®‰è£…çš„ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ yum install gitlab-ce-14.9.3-ce.0.el7.x86_64  	<span style="color:#75715e"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="rpmåŒ…å®‰è£…gitlabhttpspackagesgitlabcomgitlabgitlab-ce"><a href="https://packages.gitlab.com/gitlab/gitlab-ce" rel="external" target="_self"><code>rpm</code>åŒ…å®‰è£…<code>gitlab</code></a></h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget --content-disposition https://packages.gitlab.com/gitlab/gitlab-ce/packages/el/7/gitlab-ce-14.9.3-ce.0.el7.x86_64.rpm/download.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ rpm gitlab-ce-14.9.3-ce.0.el7.x86_64.rpm</span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆå§‹åŒ–å¯åŠ¨gitlab">åˆå§‹åŒ–å¯åŠ¨<code>Gitlab</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ gitlab-ctl reconfigure  	<span style="color:#75715e"># åˆå§‹åŒ–gitlab</span>
</span></span><span style="display:flex;"><span>$ gitlab-ctl restart  	<span style="color:#75715e"># é‡å¯å®Œæˆ</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="é˜²ç«å¢™æ”¾è¡Œç«¯å£">é˜²ç«å¢™æ”¾è¡Œç«¯å£</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ firewall-cmd --permanent --add-service<span style="color:#f92672">={</span>http,https<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<hr>
<h3 id="dockerå®‰è£…gitlab"><code>docker</code>å®‰è£…<code>gitlab</code></h3>
<ul>
<li>
<ol>
<li><code>Docker</code><!-- raw HTML omitted -->å‘½ä»¤å¯åŠ¨<!-- raw HTML omitted --><code>Gitlab</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/gitlab/<span style="color:#f92672">{</span>config,logs,data<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$ docker run --detach <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--publish 18081:80 --publish 18083:443 --publish 18082:22 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--name gitlab <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--restart always <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume /opt/gitlab/config:/etc/gitlab <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume /opt/gitlab/logs:/var/log/gitlab <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume /opt/gitlab/data:/var/opt/gitlab <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--env GITLAB_OMNIBUS_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;external_url &#39;https://gitlab.example.com/&#39;;&#34;</span>  <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>gitlab/gitlab-ce:10.0.0-ce.0</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>docker-compose</code><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Gitlab</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/gitlab/<span style="color:#f92672">{</span>config,logs,data<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/docker-compose/gitlab/docker-compose.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">version: &#34;3&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">services:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  gitlab:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    container_name: gitlab  # å¯åŠ¨ååç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    image: &#39;gitlab/gitlab-ce:10.0.0-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:10.8.7-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:11.11.8-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:12.0.12-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:12.1.17-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:12.10.14-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:13.0.14-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:13.1.11-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:13.8.8-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:13.12.15-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:14.0.12-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:14.1.1-ce.0&#39;  	# 14.1.1ä¸ºè¿‡åº¦å¿…é¡»ç‰ˆæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:14.2.1-ce.0&#39;  	# 14.2.1ä¸ºè¿‡åº¦å¿…é¡»ç‰ˆæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:14.3.6-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:14.9.5-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:14.10.5-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:15.0.2-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # image: &#39;gitlab/gitlab-ce:15.1.0-ce.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    restart: always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    hostname: &#39;gitlab&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    environment:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      TZ: Asia/Shanghai
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      GITLAB_OMNIBUS_CONFIG: |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        external_url &#39;http://gitlab.erge.com&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        gitlab_rails[&#39;gitlab_shell_ssh_port&#39;] = 18082
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;18081:80&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;18082:22&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;18083:443&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    volumes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;/opt/gitlab/config:/etc/gitlab&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;/opt/gitlab/logs:/var/log/gitlab&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;/opt/gitlab/data:/var/opt/gitlab&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker-compose up -d</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_gitlab_runner">Install_Gitlab_Runner</h1>

<h2 id="git-runner"><code>Git Runner</code></h2>
<blockquote>
<ul>
<li>
<p><a href="https://packages.gitlab.com/runner/gitlab-runner" rel="external" target="_self"><code>git-runner</code>åº“</a></p>
</li>
<li>
<p><a href="https://gitlab.com/gitlab-org/gitlab-runner" rel="external" target="_self"><code>gitlab-runner</code></a></p>
</li>
<li>
<p><a href="https://docs.gitlab.com/runner/install/linux-manually.html" rel="external" target="_self"><code>Gitlab</code>é…ç½®<code>runner</code></a></p>
</li>
</ul>
</blockquote>
<hr>
<h3 id="yumå®‰è£…git-runner"><code>yum</code>å®‰è£…<code>git-runner</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -s https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.rpm.sh | sudo bash
</span></span><span style="display:flex;"><span>$ yum install gitlab-runner-14.9.1-1.x86_64</span></span></code></pre></div></blockquote>
<hr>
<h3 id="rpmå®‰è£…git-runner"><code>rpm</code>å®‰è£…<code>git-runner</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget --content-disposition https://packages.gitlab.com/runner/gitlab-runner/packages/el/7/gitlab-runner-14.9.1-1.x86_64.rpm/download.rpm
</span></span><span style="display:flex;"><span><span style="color:#75715e"># curl -O https://gitlab-runner-downloads.s3.amazonaws.com/latest/rpm/gitlab-runner_amd64.rpm</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># rpm -ivh gitlab-runner_amd64.rpm</span>
</span></span><span style="display:flex;"><span>$ rpm -ivh gitlab-runner-14.9.1-1.x86_64.rpm</span></span></code></pre></div></blockquote>
<hr>
<h3 id="dockerå®‰è£…git-runner"><code>docker</code>å®‰è£…<code>git-runner</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -d --name gitlab-runner --restart always <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /opt/gitlab-runner/config:/etc/gitlab-runner <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /var/run/docker.sock:/var/run/docker.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  gitlab/gitlab-runner:latest</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_gitea">Install_Gitea</h1>

<h2 id="heading"></h2>
<blockquote>
<ul>
<li><a href="https://about.gitea.com/" rel="external" target="_self"><code>Gitea</code>å®˜ç½‘</a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="haproxy">HAProxy</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of HAProxy</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_proxy">Install_Proxy</h1>

<h2 id="éƒ¨ç½²ä»£ç†æœåŠ¡">éƒ¨ç½²ä»£ç†æœåŠ¡</h2>
<h3 id="httpä»£ç†privoxy"><code>HTTP</code>ä»£ç†<code>privoxy</code></h3>
<blockquote>
<ul>
<li>éƒ¨ç½²ä¾èµ–</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install epel-release</span></span></code></pre></div></blockquote>
<ul>
<li>éƒ¨ç½²<code>privoxy</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install privoxy</span></span></code></pre></div></blockquote>
<ul>
<li>ä¿®æ”¹é…ç½®</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/privoxy/config<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listen-address 127.0.0.1:ç«¯å£  	# æœåŠ¡ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">keep-alive-timeout 5  	# è¿æ¥ä¿æŒæ´»åŠ¨çš„æ—¶é—´ä¸º 5 ç§’ï¼Œå‡å°‘é•¿æ—¶é—´ç©ºé—²è¿æ¥çš„å ç”¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">max-client-connections 256  	# é™åˆ¶æœ€å¤§é“¾æ¥æ•°ï¼Œé˜²æ­¢èµ„æºè€—å°½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">timeout 300  	# è¶…æ—¶æ—¶é—´å¯ä»¥é˜²æ­¢è¶…æ—¶è¯·æ±‚å ç”¨å¤ªå¤šæ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enable-edit-actions 0  	# ç¦ç”¨ä¸å¿…è¦çš„åŠŸèƒ½ä»¥å‡å°‘æ¶ˆè€—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-messages 2  	# å¯å‡å°åˆ°æ›´å°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># forward-socks5 / 127.0.0.1:8889 . # å°† DNSæŸ¥è¯¢è½¬å‘åˆ°æœ¬åœ° SOCKS5ä»£ç†ï¼Œå¯ä»¥å‡å°‘DNSæŸ¥è¯¢çš„æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">permit-access 0.0.0.0/0 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>å¯åŠ¨<code>privoxy</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start privoxy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl enable privoxy</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="socketä»£ç†dante"><code>socket</code>ä»£ç†<code>dante</code></h3>
<blockquote>
<ul>
<li>å®‰è£…<code>dante</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install dante-server</span></span></code></pre></div></blockquote>
<ul>
<li>è°ƒæ•´é…ç½®</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/sockd.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">internal: 0.0.0.0 port=ç«¯å£  # æœåŠ¡ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">external: eth0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socksmethod: none
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clientmethod: none
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">client pass {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    from: 0.0.0.0/0 to: 0.0.0.0/0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socks pass {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    from: 0.0.0.0/0 to: 0.0.0.0/0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>å¯åŠ¨<code>sockd</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ service sockd restart</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="æµ‹è¯•ä»£ç†æœåŠ¡">æµ‹è¯•ä»£ç†æœåŠ¡</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -v -x http://ip:ç«¯å£ https://www.baidu.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ curl -v -x socks://ip:ç«¯å£ https://www.baidu.com</span></span></code></pre></div></blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_haproxy">Install_HAProxy</h1>

<h2 id="å®‰è£…haproxy">å®‰è£…<code>HAProxy</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://www.haproxy.org/#desc" rel="external" target="_self"><code>HAProxy</code>å®˜ç½‘</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/hh2737/p/8951872.html" rel="external" target="_self"><code>haproxyã€nginxã€proxy protocol</code>è·å¾—å®¢æˆ·çœŸå®<code>IP</code>æ–¹æ³•</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><strong>è´Ÿè½½å‡è¡¡</strong></p>
<p><code>HAProxy</code>å¯ä»¥å°†å…¥ç«™è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªåç«¯æœåŠ¡å™¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚å®ƒæ”¯æŒå¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå¦‚è½®è¯¢<code>round-robin</code>ã€æœ€å°è¿æ¥æ•°<code>leastconn</code>ã€æºIPå“ˆå¸Œ<code>source</code>ã€æƒé‡ç­‰</p>
</li>
<li>
<p><strong>é«˜å¯ç”¨æ€§</strong></p>
<p><code>HAProxy</code>æ”¯æŒå¥åº·æ£€æŸ¥<code>health checks</code>ï¼Œå¯ä»¥å®šæœŸæ£€æŸ¥åç«¯æœåŠ¡å™¨çš„çŠ¶æ€ï¼Œå¹¶æ ¹æ®æ£€æŸ¥ç»“æœåŠ¨æ€è°ƒæ•´è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚å½“åç«¯æœåŠ¡å™¨å‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨æ—¶ï¼Œ<code>HAProxy</code>å¯ä»¥è‡ªåŠ¨å°†æµé‡è½¬ç§»åˆ°å¥åº·çš„æœåŠ¡å™¨ä¸Šï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§</p>
</li>
<li>
<p><strong>SSL/TLS ç»ˆç«¯</strong></p>
<p><code>HAProxy</code>å¯ä»¥ä½œä¸º<code>SSL/TLS</code>çš„ç»ˆç«¯<code>Termination</code>ï¼Œè´Ÿè´£å¤„ç†å’Œç®¡ç†ä¼ å…¥å’Œä¼ å‡ºçš„åŠ å¯†æµé‡ã€‚å®ƒæ”¯æŒ<code>SSL</code>æ¡æ‰‹å’Œè¯ä¹¦ç®¡ç†ï¼Œå¯ä»¥æä¾›å®‰å…¨çš„<code>HTTPS</code>æœåŠ¡</p>
</li>
<li>
<p><strong>åå‘ä»£ç†</strong></p>
<p><code>HAProxy</code>ä½œä¸ºåå‘ä»£ç†<code>reverse proxy</code>ï¼Œå¯ä»¥éšè—åç«¯æœåŠ¡å™¨çš„å®é™…<code>IP</code>åœ°å€å’Œç»†èŠ‚ï¼Œæä¾›æ›´å®‰å…¨çš„æœåŠ¡è®¿é—®æ¥å£ã€‚å®¢æˆ·ç«¯è¯·æ±‚é¦–å…ˆåˆ°è¾¾<code>HAProxy</code>ï¼Œå†ç”±<code>HAProxy</code>è½¬å‘åˆ°åç«¯æœåŠ¡å™¨</p>
</li>
<li>
<p><strong><code>TCP</code>å’Œ<code>HTTP</code>æ”¯æŒ</strong></p>
<p><code>HAProxy</code>ä¸ä»…æ”¯æŒ<code>HTTP</code>å’Œ<code>HTTPS</code>æµé‡çš„è´Ÿè½½å‡è¡¡ï¼Œè¿˜å¯ä»¥è´Ÿè´£<code>TCP</code>æµé‡çš„è´Ÿè½½å‡è¡¡ã€‚è¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆäºæ”¯æŒ<code>Web</code>åº”ç”¨ç¨‹åºã€<code>API</code>å’Œå…¶ä»–ç½‘ç»œæœåŠ¡çš„é«˜æ€§èƒ½å’Œé«˜å¯ç”¨æ€§éƒ¨ç½²</p>
</li>
<li>
<p><strong>çµæ´»é…ç½®å’ŒåŠ¨æ€æ›´æ–°</strong></p>
<p><code>HAProxy</code>çš„é…ç½®æ–‡ä»¶æ”¯æŒçµæ´»çš„é…ç½®é€‰é¡¹ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´è´Ÿè½½å‡è¡¡ç­–ç•¥å’Œå‚æ•°ã€‚æ­¤å¤–ï¼Œ<code>HAProxy</code>æ”¯æŒåŠ¨æ€æ›´æ–°é…ç½®ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œæ— éœ€é‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆ</p>
</li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…é…ç½®<!-- raw HTML omitted --><code>HAProxy</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y haproxy</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¸¾ä¾‹ï¼šç›‘æ§<!-- raw HTML omitted --><code>Rabbit</code><!-- raw HTML omitted -->æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡é…ç½®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/haproxy/haproxy.cfg<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # log /yougo/haproxy/home/log    local0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # log /yougo/haproxy/home/log    local1 notice
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # chroot /yougo/haproxy  	# æ”¹å˜å½“å‰å·¥ä½œç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # stats socket /yougo/haproxy/home/admin.sock mode 660 level admin  	# åˆ›å»ºç›‘æ§æ‰€ç”¨çš„å¥—æ¥å­—ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> pidfile  /var/run/haproxy.pid  	# haproxyçš„pidå­˜æ”¾è·¯å¾„,å¯åŠ¨è¿›ç¨‹çš„ç”¨æˆ·å¿…é¡»æœ‰æƒé™è®¿é—®æ­¤æ–‡ä»¶ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> maxconn  4000  	# æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤4000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  user   haproxy  	# é»˜è®¤ç”¨æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  group   haproxy  	# é»˜è®¤ç”¨æˆ·ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> daemon  	# åˆ›å»º1ä¸ªè¿›ç¨‹è¿›å…¥deamonæ¨¡å¼è¿è¡Œã€‚æ­¤å‚æ•°è¦æ±‚å°†è¿è¡Œæ¨¡å¼è®¾ç½®ä¸º&#34;daemon
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # Default SSL material locations
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ca-base /etc/ssl/certs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # crt-base /etc/ssl/private
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # Default ciphers to use on SSL-enabled listening sockets.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # For more information, see ciphers(1SSL). This list is from:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ssl-default-bind-ciphers ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ssl-default-bind-options no-sslv3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">###########é»˜è®¤é…ç½®#########
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaults
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> log global
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mode    http  	# é»˜è®¤çš„æ¨¡å¼mode { tcp|http|health }ï¼Œtcpæ˜¯4å±‚ï¼Œhttpæ˜¯7å±‚ï¼Œhealthåªä¼šè¿”å›OK
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  httplog  	# é‡‡ç”¨httpæ—¥å¿—æ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  dontlognull  	# å¯ç”¨è¯¥é¡¹ï¼Œæ—¥å¿—ä¸­å°†ä¸ä¼šè®°å½•ç©ºè¿æ¥ã€‚æ‰€è°“ç©ºè¿æ¥å°±æ˜¯åœ¨ä¸Šæ¸¸çš„è´Ÿè½½å‡è¡¡å™¨æˆ–è€…ç›‘æ§ç³»ç»Ÿä¸ºäº†æ¢æµ‹è¯¥æœåŠ¡æ˜¯å¦å­˜æ´»å¯ç”¨æ—¶,éœ€è¦å®šæœŸçš„è¿æ¥æˆ–è€…è·å–æŸä¸€å›ºå®šçš„ç»„ä»¶æˆ–é¡µé¢,æˆ–è€…æ¢æµ‹æ‰«æç«¯å£æ˜¯å¦åœ¨ç›‘å¬æˆ–å¼€æ”¾ç­‰åŠ¨ä½œè¢«ç§°ä¸ºç©ºè¿æ¥;å®˜æ–¹æ–‡æ¡£ä¸­æ ‡æ³¨ï¼Œå¦‚æœè¯¥æœåŠ¡ä¸Šæ¸¸æ²¡æœ‰å…¶ä»–çš„è´Ÿè½½å‡è¡¡å™¨çš„è¯ï¼Œå»ºè®®ä¸è¦ä½¿ç”¨è¯¥å‚æ•°ï¼Œå› ä¸ºäº’è”ç½‘ä¸Šçš„æ¶æ„æ‰«ææˆ–å…¶ä»–åŠ¨ä½œå°±ä¸ä¼šè¢«è®°å½•ä¸‹æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout connect 5000  	# è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout client  50000  	# å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout server  50000  	# æœåŠ¡å™¨ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  httpclose  	# æ¯æ¬¡è¯·æ±‚å®Œæ¯•åä¸»åŠ¨å…³é—­httpé€šé“ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  httplog  	# æ—¥å¿—ç±»åˆ«httpæ—¥å¿—æ ¼å¼ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #option  forwardfor  	# å¦‚æœåç«¯æœåŠ¡å™¨éœ€è¦è·å¾—å®¢æˆ·ç«¯çœŸå®ipéœ€è¦é…ç½®çš„å‚æ•°ï¼Œå¯ä»¥ä»Http Headerä¸­è·å¾—å®¢æˆ·ç«¯ip  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  redispatch  	# serverIdå¯¹åº”çš„æœåŠ¡å™¨æŒ‚æ‰å,å¼ºåˆ¶å®šå‘åˆ°å…¶ä»–å¥åº·çš„æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout connect 10000  	# default 10 second timeout if a backend is not found
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> maxconn     60000  	# æœ€å¤§è¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> retries     3  	# 3æ¬¡è¿æ¥å¤±è´¥å°±è®¤ä¸ºæœåŠ¡ä¸å¯ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åé¢è®¾ç½® 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 400 /yougo/haproxy/home/errors/400.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 403 /yougo/haproxy/home/errors/403.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 408 /yougo/haproxy/home/errors/408.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 500 /yougo/haproxy/home/errors/500.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 502 /yougo/haproxy/home/errors/502.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 503 /yougo/haproxy/home/errors/503.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 504 /yougo/haproxy/home/errors/504.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listen http_front
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     bind 0.0.0.0:8888  	# HAProxy æœåŠ¡ç«¯å£  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats refresh 30s  	# ç»Ÿè®¡é¡µé¢è‡ªåŠ¨åˆ·æ–°æ—¶é—´  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats uri /haproxy?stats  	# ç»Ÿè®¡é¡µé¢url  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats realm Haproxy Manager  	# ç»Ÿè®¡é¡µé¢å¯†ç æ¡†ä¸Šæç¤ºæ–‡æœ¬  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats auth admin:admin  	# ç»Ÿè®¡é¡µé¢ç”¨æˆ·åå’Œå¯†ç è®¾ç½®  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     #stats hide-version  	# éšè—ç»Ÿè®¡é¡µé¢ä¸ŠHAProxyçš„ç‰ˆæœ¬ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##########  RabbitMQçš„ç®¡ç†ç•Œé¢ä¹Ÿæ”¾åœ¨HAProxyåé¢äº† ################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#listen rabbitmq_admin 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#    bind 0.0.0.0:8004
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#   server node1 192.168.0.31:15672
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#    server node2 192.168.0.32:15672
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#    server node3 192.168.0.33:15672
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listen rabbitmq_cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> bind 0.0.0.0:8889  	# rabbitmqé›†ç¾¤è°ƒç”¨çš„ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option tcplog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mode tcp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout client  3h
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout server  3h
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option          clitcpka
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> balance roundrobin  	# è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ˆ#banlance roundrobin è½®è¯¢ï¼Œbalance source ä¿å­˜sessionå€¼ï¼Œæ”¯æŒstatic-rrï¼Œleastconnï¼Œfirstï¼Œuriç­‰å‚æ•°ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance url_param userid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance url_param session_id check_post 64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance hdr(User-Agent)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance hdr(host)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance hdr(Host) use_domain_only
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance rdp-cookie
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance leastconn
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance source //ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server   rabbitmq1  172.16.0.30:5672 check inter 5s rise 2 fall 3  	# check inter 2000 æ˜¯æ£€æµ‹å¿ƒè·³é¢‘ç‡ï¼Œrise 2æ˜¯2æ¬¡æ­£ç¡®è®¤ä¸ºæœåŠ¡å™¨å¯ç”¨ï¼Œfall 3æ˜¯3æ¬¡å¤±è´¥è®¤ä¸ºæœåŠ¡å™¨ä¸å¯ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server   rabbitmq2  172.16.0.31:5672 check inter 5s rise 2 fall 3  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server   rabbitmq3  172.16.0.32:5672 check inter 5s rise 2 fall 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span> </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>HAProxy</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl enable haproxy <span style="color:#f92672">&amp;&amp;</span> systemctl start haproxy</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_system">Install_System</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Install_System</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_cobbler">Install_Cobbler</h1>

<h2 id="cobblerç®€ä»‹"><code>Cobbler</code>ç®€ä»‹</h2>
<blockquote>
<ul>
<li><code>Cobbler</code>æ˜¯ä¸€ä¸ªå¿«é€Ÿç½‘ç»œå®‰è£…<code>linux</code>çš„æœåŠ¡ï¼Œè€Œä¸”åœ¨ç»è¿‡è°ƒæ•´ä¹Ÿå¯ä»¥æ”¯æŒç½‘ç»œå®‰è£…<code>windows</code>ã€‚è¯¥å·¥å…·ä½¿ç”¨<code>python</code>å¼€å‘ï¼Œå°å·§è½»ä¾¿ï¼ˆæ‰<code>15k</code>è¡Œ<code>python</code>ä»£ç ï¼‰ï¼Œä½¿ç”¨ç®€å•çš„å‘½ä»¤å³å¯å®Œæˆ<code>PXE</code>ç½‘ç»œå®‰è£…ç¯å¢ƒçš„é…ç½®ï¼ŒåŒæ—¶è¿˜å¯ä»¥ç®¡ç†<code>DHCP</code>ã€<code>DNS</code>ã€<code>TFTP</code>ã€<code>RSYNC</code>ä»¥åŠ<code>yum</code>ä»“åº“ã€æ„é€ ç³»ç»Ÿ<code>ISO</code>é•œåƒ</li>
<li><code>Cobbler</code>æ”¯æŒå‘½ä»¤è¡Œç®¡ç†ï¼Œ<code>web</code>ç•Œé¢ç®¡ç†ï¼Œè¿˜æä¾›äº†<code>API</code>æ¥å£ï¼Œå¯ä»¥æ–¹ä¾¿äºŒæ¬¡å¼€å‘ä½¿ç”¨</li>
<li><code>Cobbler</code>å®¢æˆ·ç«¯<code>Koan</code>æ”¯æŒè™šæ‹Ÿæœºå®‰è£…å’Œæ“ä½œç³»ç»Ÿé‡æ–°å®‰è£…ï¼Œä½¿é‡è£…ç³»ç»Ÿæ›´ä¾¿æ·</li>
<li>è¿ç»´è‡ªåŠ¨åŒ–åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å æ®ç€ä¸¾è¶³è½»é‡çš„åœ°ä½ï¼Œå°¤å…¶æ˜¯é¢å¯¹å‡ ç™¾å°ï¼Œå‡ åƒå°ç”šè‡³å‡ ä¸‡å°çš„æœåŠ¡å™¨æ—¶ï¼Œä»…ä»…æ˜¯å®‰è£…æ“ä½œç³»ç»Ÿï¼Œå¦‚æœä¸é€šè¿‡è‡ªåŠ¨åŒ–æ¥å®Œæˆï¼Œæ ¹æœ¬æ˜¯ä¸å¯æƒ³è±¡çš„ã€‚</li>
<li>é¢å¯¹ç”Ÿäº§ç¯å¢ƒä¸­ä¸åŒæœåŠ¡å™¨çš„éœ€æ±‚ï¼Œè¯¥å¦‚ä½•å®ç°æ‰¹é‡éƒ¨ç½²å¤šç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿå‘¢ï¼Ÿ<code>Cobbler</code>ä¾¿å¯ä»¥çš„æ»¡è¶³è¿™ä¸€å®é™…éœ€æ±‚ï¼Œå®ç°å¤šç‰ˆæœ¬æ“ä½œç³»ç»Ÿæ‰¹é‡éƒ¨ç½²</li>
<li><code>Cobbler</code>å„ä¸ªç»„ä»¶ä¹‹é—´å…³ç³»</li>
</ul>
<blockquote>
<ul>
<li><code>distro</code>-&gt;<code>profile-system</code>(å¯é€‰)</li>
</ul>
<p><a href="#R-image-060b31d9b6e1ee2fa2271f2ecb7ab86b" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Cobbler_Server/cobbler.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-060b31d9b6e1ee2fa2271f2ecb7ab86b"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Cobbler_Server/cobbler.png"></a></p>
</blockquote>
<ul>
<li><code>distro</code>å‘è¡Œç‰ˆ</li>
</ul>
<blockquote>
<ul>
<li>é¢å¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿ</li>
<li>é¢å¯¹åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸åŒçš„ç‰ˆæœ¬</li>
</ul>
</blockquote>
<ul>
<li><code>profile</code></li>
</ul>
<blockquote>
<ul>
<li>æ ¸å¿ƒç‰¹æ€§æ˜¯é€šè¿‡<code>kickstart</code>æ¥éƒ¨ç½²</li>
</ul>
</blockquote>
<ul>
<li><code>system</code></li>
</ul>
<blockquote>
<ul>
<li>ä¸»è¦ç›®çš„é…ç½®ç½‘ç»œæ¥å£</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="cobbleråŠŸèƒ½"><code>Cobbler</code>åŠŸèƒ½</h3>
<blockquote>
<ul>
<li>ä½¿ç”¨<code>Cobbler</code>ï¼Œæ‚¨æ— éœ€è¿›è¡Œäººå·¥å¹²é¢„å³å¯å®‰è£…æœºå™¨ã€‚<code>Cobbler</code>è®¾ç½®ä¸€ä¸ª<code>PXE</code>å¼•å¯¼ç¯å¢ƒï¼ˆå®ƒè¿˜å¯ä½¿ç”¨<code>yaboot</code>æ”¯æŒ<code>PowerPC</code>ï¼‰ï¼Œå¹¶æ§åˆ¶ä¸å®‰è£…ç›¸å…³çš„æ‰€æœ‰æ–¹é¢ï¼Œæ¯”å¦‚ç½‘ç»œå¼•å¯¼æœåŠ¡ï¼ˆ<code>DHCP</code>å’Œ<code>TFTP</code>ï¼‰ä¸å­˜å‚¨åº“é•œåƒã€‚å½“å¸Œæœ›å®‰è£…ä¸€å°æ–°æœºå™¨æ—¶ï¼Œ<code>Cobbler</code>å¯ä»¥ï¼šä½¿ç”¨ä¸€ä¸ªä»¥å‰å®šä¹‰çš„æ¨¡æ¿æ¥é…ç½®<code>DHCP</code>æœåŠ¡ï¼ˆå¦‚æœå¯ç”¨äº†ç®¡ç†<code>DHCP</code>ï¼‰å°†ä¸€ä¸ªå­˜å‚¨åº“ï¼ˆ<code>yum</code>æˆ–<code>rsync</code>ï¼‰å»ºç«‹é•œåƒæˆ–è§£å‹ç¼©ä¸€ä¸ªåª’ä»‹ï¼Œä»¥æ³¨å†Œä¸€ä¸ªæ–°æ“ä½œç³»ç»Ÿï¼Œåœ¨<code>DHCP</code>é…ç½®æ–‡ä»¶ä¸­ä¸ºéœ€è¦å®‰è£…çš„æœºå™¨åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼Œå¹¶ä½¿ç”¨æ‚¨æŒ‡å®šçš„å‚æ•°ï¼ˆ<code>IP</code>å’Œ<code>MAC</code>åœ°å€ï¼‰ï¼Œåœ¨<code>TFTFP</code>æœåŠ¡ç›®å½•ä¸‹åˆ›å»ºé€‚å½“çš„<code>PXE</code>æ–‡ä»¶ï¼Œé‡æ–°å¯åŠ¨<code>DHCP</code>æœåŠ¡ä»¥åæ˜ æ›´æ”¹ï¼Œé‡æ–°å¯åŠ¨æœºå™¨ä»¥å¼€å§‹å®‰è£…ï¼ˆå¦‚æœç”µæºç®¡ç†å·²å¯ç”¨ï¼‰</li>
<li><code>Cobbler</code>æ”¯æŒä¼—å¤šçš„å‘è¡Œç‰ˆï¼š<code>Red Hat</code>ã€<code>Fedora</code>ã€<code>CentOS</code>ã€<code>Debian</code>ã€<code>Ubuntu</code>å’Œ<code>SuSE</code>ã€‚å½“æ·»åŠ ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼ˆé€šå¸¸é€šè¿‡ä½¿ç”¨<code>ISO</code>æ–‡ä»¶ï¼‰æ—¶ï¼Œ<code>Cobbler</code>çŸ¥é“å¦‚ä½•è§£å‹ç¼©åˆé€‚çš„æ–‡ä»¶å¹¶è°ƒæ•´ç½‘ç»œæœåŠ¡ï¼Œä»¥æ­£ç¡®å¼•å¯¼æœºå™¨ã€‚</li>
<li><code>Cobbler</code>å¯ä½¿ç”¨<code>kickstart</code>æ¨¡æ¿ã€‚åŸºäº<code>Red Hat</code>æˆ–<code>Fedora</code>çš„ç³»ç»Ÿä½¿ç”¨<code>kickstart</code>æ–‡ä»¶æ¥è‡ªåŠ¨åŒ–å®‰è£…æµç¨‹ã€‚é€šè¿‡ä½¿ç”¨æ¨¡æ¿ï¼Œæ‚¨å°±ä¼šæ‹¥æœ‰åŸºæœ¬çš„<code>kickstart</code>æ¨¡æ¿ï¼Œç„¶åå®šä¹‰å¦‚ä½•é’ˆå¯¹ä¸€ç§é…ç½®æ–‡ä»¶æˆ–æœºå™¨é…ç½®è€Œæ›¿æ¢å…¶ä¸­çš„å˜é‡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ¨¡æ¿å¯èƒ½åŒ…å«ä¸¤ä¸ªå˜é‡<code>$domain</code>å’Œ<code>$machine_name</code>ã€‚åœ¨ <code>Cobbler</code>é…ç½®ä¸­ï¼Œä¸€ä¸ªé…ç½®æ–‡ä»¶æŒ‡å®š<code>domain=mydomain.com</code>ï¼Œå¹¶ä¸”æ¯å°ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶çš„æœºå™¨åœ¨<code>machine_name</code>å˜é‡ä¸­æŒ‡å®šå…¶åç§°ã€‚è¯¥é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰æœºå™¨éƒ½ä½¿ç”¨ç›¸åŒçš„<code>kickstart</code>å®‰è£…ä¸”é’ˆå¯¹ <code>domain=mydomain.com</code>è¿›è¡Œé…ç½®ï¼Œä½†æ¯å°æœºå™¨æ‹¥æœ‰å…¶è‡ªå·±çš„æœºå™¨åç§°ã€‚æ‚¨ä»ç„¶å¯ä»¥ä½¿ç”¨<code>kickstart</code>æ¨¡æ¿åœ¨ä¸åŒçš„åŸŸä¸­å®‰è£…å…¶ä»–æœºå™¨å¹¶ä½¿ç”¨ä¸åŒçš„æœºå™¨åç§°ã€‚</li>
<li>ä¸ºäº†ååŠ©ç®¡ç†ç³»ç»Ÿï¼ŒCobbler å¯é€šè¿‡ fence scripts è¿æ¥åˆ°å„ç§ç”µæºç®¡ç†ç¯å¢ƒã€‚</li>
<li><code>Cobbler</code>æ”¯æŒ<code>apc_snmp</code>ã€<code>bladecenter</code>ã€<code>bullpap</code>ã€<code>drac</code>ã€<code>ether_wake</code>ã€<code>ilo</code>ã€<code>integrity</code>ã€<code>ipmilan</code>ã€<code>ipmitool</code>ã€<code>lpar</code>ã€<code>rsa</code>ã€<code>virsh</code>å’Œ<code>wti</code>ã€‚è¦é‡æ–°å®‰è£…ä¸€å°æœºå™¨ï¼Œå¯è¿è¡Œ<code>reboot system foo</code>å‘½ä»¤ï¼Œè€Œä¸”<code>Cobbler</code>ä¼šä½¿ç”¨å¿…è¦çš„å‡­æ®å’Œä¿¡æ¯æ¥ä¸ºæ‚¨è¿è¡Œæ°å½“çš„<code>fence scripts</code>ï¼ˆæ¯”å¦‚æœºå™¨æ’æ§½æ•°ï¼‰</li>
<li>é™¤äº†è¿™äº›ç‰¹æ€§ï¼Œè¿˜å¯ä½¿ç”¨ä¸€ä¸ªé…ç½®ç®¡ç†ç³»ç»Ÿ (<code>CMS</code>)ã€‚æ‚¨æœ‰ä¸¤ç§é€‰æ‹©ï¼šè¯¥å·¥å…·å†…çš„ä¸€ä¸ªå†…éƒ¨ç³»ç»Ÿï¼Œæˆ–è€…é›†æˆä¸€ä¸ªç°æœ‰çš„å¤–éƒ¨<code>CMS</code>ï¼Œæ¯”å¦‚<code>Chef</code>æˆ–<code>Puppet</code>ã€‚å€ŸåŠ©å†…éƒ¨ç³»ç»Ÿï¼Œæ‚¨å¯ä»¥æŒ‡å®šæ–‡ä»¶æ¨¡æ¿ï¼Œè¿™äº›æ¨¡æ¿ä¼šä¾æ®é…ç½®å‚æ•°è¿›è¡Œå¤„ç†ï¼ˆä¸<code>kickstart</code>æ¨¡æ¿çš„å¤„ç†æ–¹å¼ä¸€æ ·ï¼‰ï¼Œç„¶åå¤åˆ¶åˆ°æ‚¨æŒ‡å®šçš„ä½ç½®ã€‚å¦‚æœå¿…é¡»è‡ªåŠ¨å°†é…ç½®æ–‡ä»¶éƒ¨ç½²åˆ°ç‰¹å®šæœºå™¨ï¼Œé‚£ä¹ˆæ­¤åŠŸèƒ½å¾ˆæœ‰ç”¨</li>
<li>ä½¿ç”¨<code>koan</code>å®¢æˆ·ç«¯ï¼Œ<code>Cobbler</code>å¯ä»å®¢æˆ·ç«¯é…ç½®è™šæ‹Ÿæœºå¹¶é‡æ–°å®‰è£…ç³»ç»Ÿã€‚æˆ‘ä¸ä¼šè®¨è®ºé…ç½®ç®¡ç†å’Œ<code>koan</code>ç‰¹æ€§ï¼Œå› ä¸ºå®ƒä»¬ä¸å±äºæœ¬æ–‡çš„ä»‹ç»èŒƒç•´ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬æ˜¯å€¼å¾—ç ”ç©¶çš„æœ‰ç”¨ç‰¹æ€§</li>
</ul>
</blockquote>
<hr>
<h3 id="cobblerè‡ªåŠ¨éƒ¨ç½²"><code>Cobbler</code>è‡ªåŠ¨éƒ¨ç½²</h3>
<h4 id="åŸºç¡€ç¯å¢ƒå‡†å¤‡">åŸºç¡€ç¯å¢ƒå‡†å¤‡</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æç¤ºï¼šè™šæ‹Ÿæœºç½‘å¡é‡‡ç”¨<!-- raw HTML omitted --><code>NAT</code><!-- raw HTML omitted -->æ¨¡å¼ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šæ­å»º<!-- raw HTML omitted --><code>DHCP</code><!-- raw HTML omitted -->æœåŠ¡å™¨ï¼Œåœ¨åŒä¸€å±€åŸŸç½‘å¤šä¸ª<!-- raw HTML omitted --><code>DHCP</code><!-- raw HTML omitted -->æœåŠ¡ä¼šæœ‰å†²çªï¼Œå¹¶ä¸”å¯¼è‡´å®è·µå¤±è´¥<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /etc/redhat-release  	<span style="color:#75715e"># ç³»ç»Ÿç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ uname â€“r  	<span style="color:#75715e"># å†…æ ¸ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ getenforce  	<span style="color:#75715e"># æ£€æµ‹selinuxæ˜¯å¦å…³é—­(å¿…é¡»å…³é—­)</span>
</span></span><span style="display:flex;"><span>$ systemctl stop firewalld  	<span style="color:#75715e"># å…³é—­é˜²ç«å¢™</span>
</span></span><span style="display:flex;"><span>$ ifconfig eth0|awk -F <span style="color:#e6db74">&#39;[ :]+&#39;</span> <span style="color:#e6db74">&#39;NR==2 {print $3}&#39;</span>  	<span style="color:#75715e"># æŸ¥çœ‹IPåœ°å€</span>
</span></span><span style="display:flex;"><span>$ hostname  	<span style="color:#75715e"># æŸ¥çœ‹ä¸»æœºå</span>
</span></span><span style="display:flex;"><span>$ wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo  	<span style="color:#75715e"># cobblerå®‰è£…å¿…é¡»ä½¿ç”¨åˆ°epelæº</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="å®‰è£…cobbler">å®‰è£…<code>Cobbler</code></h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install cobbler cobbler-web pykickstart httpd tftp dhcp xinetd
</span></span><span style="display:flex;"><span>cobbler  	<span style="color:#75715e"># cobblerç¨‹åºåŒ…</span>
</span></span><span style="display:flex;"><span>cobbler-web  	<span style="color:#75715e"># cobblerçš„webæœåŠ¡åŒ…</span>
</span></span><span style="display:flex;"><span>pykickstart  	<span style="color:#75715e"># cobbleræ£€æŸ¥kickstartè¯­æ³•é”™è¯¯</span>
</span></span><span style="display:flex;"><span>httpd  	<span style="color:#75715e"># Apache webæœåŠ¡</span>
</span></span><span style="display:flex;"><span>tftp  	<span style="color:#75715e"># tftpæœåŠ¡</span>
</span></span><span style="display:flex;"><span>dhcp  	<span style="color:#75715e"># dhcpæœåŠ¡</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/etc/cobbler  	<span style="color:#75715e"># é…ç½®æ–‡ä»¶ç›®å½•</span>
</span></span><span style="display:flex;"><span>/etc/cobbler/settings  	<span style="color:#75715e"># cobblerä¸»é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>/etc/cobbler/dhcp.template  	<span style="color:#75715e"># DHCPæœåŠ¡çš„é…ç½®æ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>/etc/cobbler/tftpd.template  	<span style="color:#75715e"># tftpæœåŠ¡çš„é…ç½®æ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>/etc/cobbler/rsync.template  	<span style="color:#75715e"># rsyncæœåŠ¡çš„é…ç½®æ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>/etc/cobbler/iso  	<span style="color:#75715e"># isoæ¨¡æ¿é…ç½®æ–‡ä»¶ç›®å½•</span>
</span></span><span style="display:flex;"><span>/etc/cobbler/pxe  	<span style="color:#75715e"># pxeæ¨¡æ¿æ–‡ä»¶ç›®å½•</span>
</span></span><span style="display:flex;"><span>/etc/cobbler/power  	<span style="color:#75715e"># ç”µæºçš„é…ç½®æ–‡ä»¶ç›®å½•</span>
</span></span><span style="display:flex;"><span>/etc/cobbler/users.conf  	<span style="color:#75715e"># WebæœåŠ¡æˆæƒé…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>/etc/cobbler/users.digest  	<span style="color:#75715e"># webè®¿é—®çš„ç”¨æˆ·åå¯†ç é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>/etc/cobbler/dnsmasq.template  	<span style="color:#75715e"># DNSæœåŠ¡çš„é…ç½®æ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>/etc/cobbler/modules.conf  	<span style="color:#75715e"># Cobbleræ¨¡å—é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>/var/lib/cobbler  	<span style="color:#75715e"># Cobbleræ•°æ®ç›®å½•</span>
</span></span><span style="display:flex;"><span>/var/lib/cobbler/config  	<span style="color:#75715e"># é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>/var/lib/cobbler/kickstarts  	<span style="color:#75715e"># é»˜è®¤å­˜æ”¾kickstartæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>/var/lib/cobbler/loaders  	<span style="color:#75715e"># å­˜æ”¾çš„å„ç§å¼•å¯¼ç¨‹åº</span>
</span></span><span style="display:flex;"><span>/var/www/cobbler  	<span style="color:#75715e"># ç³»ç»Ÿå®‰è£…é•œåƒç›®å½•</span>
</span></span><span style="display:flex;"><span>/var/www/cobbler/ks_mirror  	<span style="color:#75715e"># å¯¼å…¥çš„ç³»ç»Ÿé•œåƒåˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>/var/www/cobbler/images  	<span style="color:#75715e"># å¯¼å…¥çš„ç³»ç»Ÿé•œåƒå¯åŠ¨æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>/var/www/cobbler/repo_mirror  	<span style="color:#75715e"># yumæºå­˜å‚¨ç›®å½•</span>
</span></span><span style="display:flex;"><span>/var/log/cobbler  	<span style="color:#75715e"># æ—¥å¿—ç›®å½•</span>
</span></span><span style="display:flex;"><span>/var/log/cobbler/install.log  	<span style="color:#75715e"># å®¢æˆ·ç«¯ç³»ç»Ÿå®‰è£…æ—¥å¿—</span>
</span></span><span style="display:flex;"><span>/var/log/cobbler/cobbler.log  	<span style="color:#75715e"># cobbleræ—¥å¿—</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="æ£€æµ‹cobbler">æ£€æµ‹<code>Cobbler</code></h4>
<blockquote>
<ul>
<li>
<p><code>cobbler</code>çš„è¿è¡Œä¾èµ–äº<code>dhcp</code>ã€<code>tftp</code>ã€<code>rsync</code>åŠ<code>dns</code>æœåŠ¡ï¼Œå…¶ä¸­<code>dhcp</code>å¯ç”±<code>dhcpdï¼ˆiscï¼‰</code>æä¾›ï¼Œä¹Ÿå¯ç”±<code>dnsmasq</code>æä¾›ï¼›<code>tftp</code>å¯ç”±<code>tftp-server</code>ç¨‹åºåŒ…æä¾›ï¼Œä¹Ÿå¯ç”±<code>cobbler</code>åŠŸèƒ½æä¾›ï¼Œ<code>rsync</code>æœ‰<code>rsync</code>ç¨‹åºåŒ…æä¾›ï¼Œ<code>dns</code>å¯ç”±<code>bind</code>æä¾›ï¼Œä¹Ÿå¯ç”±<code>dnsmasq</code>æä¾›</p>
</li>
<li>
<p><code>cobbler</code>å¯è‡ªè¡Œç®¡ç†è¿™äº›æœåŠ¡ä¸­çš„éƒ¨åˆ†ç”šè‡³æ˜¯å…¨éƒ¨ï¼Œä½†éœ€è¦é…ç½®<code>/etc/cobbler/settings</code>æ–‡ä»¶ä¸­çš„<code>manange_dhcp</code>ã€<code>manager_tftpd</code>ã€<code>manager_rsync</code>ã€<code>manager_dns</code>åˆ†åˆ«æ¥è¿›è¡Œå®šä¹‰ï¼Œå¦å¤–ï¼Œç”±äºå„ç§æœåŠ¡éƒ½æœ‰ç€ä¸åŒçš„å®ç°æ–¹å¼ï¼Œå¦‚è‹¥éœ€è¦è¿›è¡Œè‡ªå®šä¹‰ï¼Œéœ€è¦é€šè¿‡ä¿®æ”¹<code>/etc/cobbler/modules.conf</code>é…ç½®æ–‡ä»¶ä¸­å„æœåŠ¡çš„æ¨¡å—å‚æ•°çš„å€¼æ¥å®ç°</p>
</li>
<li>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start httpd  	<span style="color:#75715e"># å¯åŠ¨apacheæœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ systemctl start cobblerd  	<span style="color:#75715e"># å¯åŠ¨cobblerç¨‹åº</span></span></span></code></pre></div></li>
</ul>
<blockquote>
<ul>
<li>æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼Œéœ€è¦åœ¨<code>cobblerd</code>å’Œ<code>httpd</code>å¯åŠ¨çš„æƒ…å†µä¸‹æ£€æŸ¥</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start httpd  	<span style="color:#75715e"># å¯åŠ¨apacheæœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ systemctl start cobblerd  	<span style="color:#75715e"># å¯åŠ¨cobblerç¨‹åº</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼Œéœ€è¦åœ¨cobblerdå’Œhttpdå¯åŠ¨çš„æƒ…å†µä¸‹æ£€æŸ¥</span>
</span></span><span style="display:flex;"><span>$ cobbler check  	<span style="color:#75715e"># æ£€æŸ¥å­˜åœ¨çš„é—®é¢˜,é€ä¸€è§£å†³</span>
</span></span><span style="display:flex;"><span>The following are potential configuration items that you may want to fix:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> : The <span style="color:#e6db74">&#39;server&#39;</span> field in /etc/cobbler/settings must be set to something other than localhost, or kickstarting features will not work.  This should be a resolvable hostname or IP <span style="color:#66d9ef">for</span> the boot server as reachable by all machines that will use it.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> : For PXE to be functional, the <span style="color:#e6db74">&#39;next_server&#39;</span> field in /etc/cobbler/settings must be set to something other than 127.0.0.1, and should match the IP of the boot server on the PXE network.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span> : change <span style="color:#e6db74">&#39;disable&#39;</span> to <span style="color:#e6db74">&#39;no&#39;</span> in /etc/xinetd.d/tftp
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span> : some network boot-loaders are missing from /var/lib/cobbler/loaders, you may run <span style="color:#e6db74">&#39;cobbler get-loaders&#39;</span> to download them, or, <span style="color:#66d9ef">if</span> you only want to handle x86/x86_64 netbooting, you may ensure that you have installed a *recent* version of the syslinux package installed and can ignore this message entirely.  Files in this directory, should you want to support all architectures, should include pxelinux.0, menu.c32, elilo.efi, and yaboot. The <span style="color:#e6db74">&#39;cobbler get-loaders&#39;</span> command is the easiest way to resolve these requirements.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span> : enable and start rsyncd.service with systemctl
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span> : debmirror package is not installed, it will be required to manage debian deployments and repositories
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7</span> : The default password used by the sample templates <span style="color:#66d9ef">for</span> newly installed machines <span style="color:#f92672">(</span>default_password_crypted in /etc/cobbler/settings<span style="color:#f92672">)</span> is still set to <span style="color:#e6db74">&#39;cobbler&#39;</span> and should be changed, try: <span style="color:#e6db74">&#34;openssl passwd -1 -salt &#39;random-phrase-here&#39; &#39;your-password-here&#39;&#34;</span> to generate new one
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8</span> : fencing tools were not found, and are required to use the <span style="color:#f92672">(</span>optional<span style="color:#f92672">)</span> power management features. install cman or fence-agents to use them
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Restart cobblerd and <span style="color:#66d9ef">then</span> run <span style="color:#e6db74">&#39;cobbler sync&#39;</span> to apply changes.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¦‚ä¸Šå„é—®é¢˜çš„è§£å†³æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. ä¿®æ”¹/etc/cobbler/settingsæ–‡ä»¶ä¸­çš„serverå‚æ•°çš„å€¼ä¸ºæä¾›cobbleræœåŠ¡çš„ä¸»æœºç›¸åº”çš„IPåœ°å€æˆ–ä¸»æœºåï¼Œå¦‚server: 10.0.0.101ï¼›</span>
</span></span><span style="display:flex;"><span>$  sed -i <span style="color:#e6db74">&#39;s/server: 127.0.0.1/server: 10.0.0.101/&#39;</span> /etc/cobbler/settings
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. ä¿®æ”¹/etc/cobbler/settingsæ–‡ä»¶ä¸­çš„next_serverå‚æ•°çš„å€¼ä¸ºæä¾›PXEæœåŠ¡çš„ä¸»æœºç›¸åº”çš„IPåœ°å€ï¼Œå¦‚next_server: 10.0.0.101ï¼›</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/next_server: 127.0.0.1/next_server: 10.0.0.101/&#39;</span> /etc/cobbler/settings
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. ä¿®æ”¹/etc/xinetd.d/tftpæ–‡ä»¶ä¸­çš„disableå‚æ•°ä¿®æ”¹ä¸º disable = no</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4. æ‰§è¡Œ cobbler get-loaders å‘½ä»¤å³å¯ï¼›å¦åˆ™ï¼Œéœ€è¦å®‰è£…syslinuxç¨‹åºåŒ…ï¼Œè€Œåå¤åˆ¶/usr/share/syslinux/{pxelinux.0,memu.c32}ç­‰æ–‡ä»¶è‡³/var/lib/cobbler/loaders/ç›®å½•ä¸­ï¼›</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 5. æ‰§è¡Œ systemctl enable rsyncdå‘½ä»¤å³å¯ï¼›</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 6. å¦‚æœæœ‰å¼ºè¿«ç—‡å¯ä»¥é€‰æ‹© yum â€“y install debmirror ç„¶åæ ¹æ®é”™è¯¯è¿›è¡Œè§£å†³,ä¸€èˆ¬é”™è¯¯å¦‚ä¸‹ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ³¨é‡Š/etc/dedmirror.confæ–‡ä»¶ä¸­çš„  @dists=â€sidâ€;  @arches=â€i386â€; </span>
</span></span><span style="display:flex;"><span>$ openssl passwd -1 -salt <span style="color:#e6db74">&#39;$(openssl rand -hex 4)&#39;</span> <span style="color:#e6db74">&#39;xuliangwei&#39;</span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># $1$$(openss$.wbDUBV/STL0YaNuAcusK/  	# è¿”å›å‚æ•°</span>
</span></span><span style="display:flex;"><span>$ grep <span style="color:#e6db74">&#34;default_password_crypted&#34;</span> /etc/cobbler/settings  	<span style="color:#75715e"># æ›¿æ¢/etc/cobbler/settingå†…çš„default_password_crypted default_password_crypted: &#34;$1$$(openss$.wbDUBV/STL0YaNuAcusK/&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 7. yum â€“y install cman fence-agents</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æœ€åé‡å¯Cobblerï¼šsystemctl restart cobblerd </span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="é…ç½®dhcp">é…ç½®<code>DHCP</code></h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s#manage_dhcp: 0#manage_dhcp: 1#g&#39;</span> /etc/cobbler/settings  	<span style="color:#75715e"># ä½¿ç”¨cobblerç®¡ç†dhcp</span>
</span></span><span style="display:flex;"><span>$ vim /etc/cobbler/dhcp.template  	<span style="color:#75715e"># ä¿®æ”¹cobblerçš„dhcpæ¨¡ç‰ˆï¼Œå› ä¸ºcobblerä¼šæ›¿æ¢ã€‚</span>
</span></span><span style="display:flex;"><span>subnet 10.0.0.0 netmask 255.255.255.0 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  option routers             10.0.0.2;
</span></span><span style="display:flex;"><span>  option domain-name-servers 10.0.0.2;
</span></span><span style="display:flex;"><span>  option subnet-mask         255.255.255.0;
</span></span><span style="display:flex;"><span>  range dynamic-bootp        10.0.0.200 10.0.0.250;
</span></span><span style="display:flex;"><span>  default-lease-time         21600;
</span></span><span style="display:flex;"><span>  max-lease-time             43200;
</span></span><span style="display:flex;"><span>  next-server                $next_server;</span></span></code></pre></div></blockquote>
<hr>
<h4 id="åŒæ­¥cobbler">åŒæ­¥<code>Cobbler</code></h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl restart xinetd  	<span style="color:#75715e"># é‡å¯xinetd</span>
</span></span><span style="display:flex;"><span>$ systemctl restart cobblerd  	<span style="color:#75715e"># é‡å¯cobbler</span>
</span></span><span style="display:flex;"><span>$ cobbler sync  	<span style="color:#75715e"># åŒæ­¥æœ€æ–°cobbleré…ç½®ï¼Œå¯ä»¥çœ‹å…·ä½“åšäº†å“ªäº›æ“ä½œ</span>
</span></span><span style="display:flex;"><span>task started: 2016-04-29_234117_sync
</span></span><span style="display:flex;"><span>task started <span style="color:#f92672">(</span>id<span style="color:#f92672">=</span>Sync, time<span style="color:#f92672">=</span>Fri Apr <span style="color:#ae81ff">29</span> 23:41:17 2016<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>running pre-sync triggers
</span></span><span style="display:flex;"><span>cleaning trees
</span></span><span style="display:flex;"><span>removing: /var/lib/tftpboot/pxelinux.cfg/default
</span></span><span style="display:flex;"><span>removing: /var/lib/tftpboot/grub/images
</span></span><span style="display:flex;"><span>removing: /var/lib/tftpboot/grub/grub-x86.efi
</span></span><span style="display:flex;"><span>removing: /var/lib/tftpboot/grub/grub-x86_64.efi
</span></span><span style="display:flex;"><span>removing: /var/lib/tftpboot/grub/efidefault
</span></span><span style="display:flex;"><span>removing: /var/lib/tftpboot/s390x/profile_list
</span></span><span style="display:flex;"><span>copying bootloaders
</span></span><span style="display:flex;"><span>trying hardlink /var/lib/cobbler/loaders/grub-x86.efi -&gt; /var/lib/tftpboot/grub/grub-x86.efi
</span></span><span style="display:flex;"><span>trying hardlink /var/lib/cobbler/loaders/grub-x86_64.efi -&gt; /var/lib/tftpboot/grub/grub-x86_64.efi
</span></span><span style="display:flex;"><span>copying distros to tftpboot
</span></span><span style="display:flex;"><span>copying images
</span></span><span style="display:flex;"><span>generating PXE configuration files
</span></span><span style="display:flex;"><span>generating PXE menu structure
</span></span><span style="display:flex;"><span>rendering DHCP files
</span></span><span style="display:flex;"><span>generating /etc/dhcp/dhcpd.conf
</span></span><span style="display:flex;"><span>rendering TFTPD files
</span></span><span style="display:flex;"><span>generating /etc/xinetd.d/tftp
</span></span><span style="display:flex;"><span>cleaning link caches
</span></span><span style="display:flex;"><span>running post-sync triggers
</span></span><span style="display:flex;"><span>running python triggers from /var/lib/cobbler/triggers/sync/post/*
</span></span><span style="display:flex;"><span>running python trigger cobbler.modules.sync_post_restart_services
</span></span><span style="display:flex;"><span>running: dhcpd -t -q
</span></span><span style="display:flex;"><span>received on stdout: 
</span></span><span style="display:flex;"><span>received on stderr: 
</span></span><span style="display:flex;"><span>running: service dhcpd restart
</span></span><span style="display:flex;"><span>received on stdout: 
</span></span><span style="display:flex;"><span>received on stderr: Redirecting to /bin/systemctl restart  dhcpd.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>running shell triggers from /var/lib/cobbler/triggers/sync/post/*
</span></span><span style="display:flex;"><span>running python triggers from /var/lib/cobbler/triggers/change/*
</span></span><span style="display:flex;"><span>running python trigger cobbler.modules.scm_track
</span></span><span style="display:flex;"><span>running shell triggers from /var/lib/cobbler/triggers/change/*
</span></span><span style="display:flex;"><span>*** TASK COMPLETE ***</span></span></code></pre></div></blockquote>
<hr>
<h4 id="ç®¡ç†cobbler">ç®¡ç†<code>Cobbler</code></h4>
<ul>
<li>
<ol>
<li>ç®¡ç†<code>distro</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>cobbler</code>å˜å¾—å¯ç”¨çš„ç¬¬ä¸€æ­¥ä¸ºå®šä¹‰<code>distro</code>ï¼Œå…¶å¯ä»¥é€šè¿‡ä¸ºå…¶æŒ‡å®šå¤–éƒ¨çš„å®‰è£…å¼•å¯¼å†…æ ¸åŠ<code>ramdiskæ–‡</code>ä»¶çš„æ–¹å¼å®ç°ã€‚å¦‚æœå·²ç»æœ‰å®Œæˆçš„å®‰è£…æ ‘ï¼ˆå¦‚<code>os</code>çš„å®‰è£…é•œåƒï¼‰åˆ™æ¨èä½¿ç”¨<code>improt</code>ä¹‹é—´å¯¼å…¥çš„æ–¹å¼è¿›è¡Œ</li>
<li>å¦‚æœæœ‰<code>kickstart</code>æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>--kickstart=/path/to/kickstart_file</code>è¿›è¡Œå¯¼å…¥ï¼Œå› æ­¤<code>import</code>ä¼šè‡ªåŠ¨ä¸ºå¯¼å…¥çš„<code>distro</code>ç”Ÿæˆä¸€ä¸ª<code>profile</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mount /dev/cdrom /mnt/  	<span style="color:#75715e"># æŒ‚åœ¨ISOå…‰ç›˜è‡³æœåŠ¡å™¨</span>
</span></span><span style="display:flex;"><span>mount: /dev/sr0 is write-protected, mounting read-only
</span></span><span style="display:flex;"><span>$ cobbler import --path<span style="color:#f92672">=</span>/mnt/ --name<span style="color:#f92672">=</span>CentOS-7.1-x86_64-distro --arch<span style="color:#f92672">=</span>x86_64
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --path é•œåƒè·¯å¾„</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --name ä¸ºå®‰è£…æºå®šä¹‰ä¸€ä¸ªåå­—</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --arch æŒ‡å®šå®‰è£…æºæ˜¯32ä½ã€64ä½ã€ia64, ç›®å‰æ”¯æŒçš„é€‰é¡¹æœ‰: x86â”‚x86_64â”‚ia64</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…æºçš„å”¯ä¸€æ ‡ç¤ºå°±æ˜¯æ ¹æ®nameå‚æ•°æ¥å®šä¹‰ï¼Œæœ¬ä¾‹å¯¼å…¥æˆåŠŸåï¼Œå®‰è£…æºçš„å”¯ä¸€æ ‡ç¤ºå°±æ˜¯ï¼šCentOS-7.1-distro-x86_64ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é•œåƒå­˜æ”¾ç›®å½•ï¼Œcobblerä¼šå°†é•œåƒä¸­çš„æ‰€æœ‰å®‰è£…æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°ä¸€ä»½ï¼Œæ”¾åœ¨/var/www/cobbler/ks_mirrorä¸‹çš„CentOS-7.1-x86_64-distro-x86_64ç›®å½•ä¸‹ã€‚å› æ­¤/var/www/cobblerç›®å½•å¿…é¡»å…·æœ‰è¶³å¤Ÿå®¹çº³å®‰è£…æ–‡ä»¶çš„ç©ºé—´ã€‚</span>
</span></span><span style="display:flex;"><span>task started: 2016-04-30_010122_import
</span></span><span style="display:flex;"><span>task started <span style="color:#f92672">(</span>id<span style="color:#f92672">=</span>Media import, time<span style="color:#f92672">=</span>Sat Apr <span style="color:#ae81ff">30</span> 01:01:22 2016<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Found a candidate signature: breed<span style="color:#f92672">=</span>redhat, version<span style="color:#f92672">=</span>rhel6
</span></span><span style="display:flex;"><span>Found a candidate signature: breed<span style="color:#f92672">=</span>redhat, version<span style="color:#f92672">=</span>rhel7
</span></span><span style="display:flex;"><span>Found a matching signature: breed<span style="color:#f92672">=</span>redhat, version<span style="color:#f92672">=</span>rhel7
</span></span><span style="display:flex;"><span>Adding distros from path /var/www/cobbler/ks_mirror/CentOS-7.1-x86_64-distro-x86_64:
</span></span><span style="display:flex;"><span>creating new distro: CentOS-7.1-distro-x86_64
</span></span><span style="display:flex;"><span>trying symlink: /var/www/cobbler/ks_mirror/CentOS-7.1-x86_64-distro-x86_64 -&gt; /var/www/cobbler/links/CentOS-7.1-distro-x86_64
</span></span><span style="display:flex;"><span>creating new profile: CentOS-7.1-distro-x86_64
</span></span><span style="display:flex;"><span>associating repos
</span></span><span style="display:flex;"><span>checking <span style="color:#66d9ef">for</span> rsync repo<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>checking <span style="color:#66d9ef">for</span> rhn repo<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>checking <span style="color:#66d9ef">for</span> yum repo<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>starting descent into /var/www/cobbler/ks_mirror/CentOS-7.1-x86_64-distro-x86_64 <span style="color:#66d9ef">for</span> CentOS-7.1-distro-x86_64
</span></span><span style="display:flex;"><span>processing repo at : /var/www/cobbler/ks_mirror/CentOS-7.1-x86_64-distro-x86_64
</span></span><span style="display:flex;"><span>need to process repo/comps: /var/www/cobbler/ks_mirror/CentOS-7.1-x86_64-distro-x86_64
</span></span><span style="display:flex;"><span>looking <span style="color:#66d9ef">for</span> /var/www/cobbler/ks_mirror/CentOS-7.1-x86_64-distro-x86_64/repodata/*comps*.xml
</span></span><span style="display:flex;"><span>Keeping repodata as-is :/var/www/cobbler/ks_mirror/CentOS-7.1-x86_64-distro-x86_64/repodata
</span></span><span style="display:flex;"><span>*** TASK COMPLETE ***
</span></span><span style="display:flex;"><span>$ cobbler distro list  	<span style="color:#75715e"># åˆ—å‡ºæ‰€æœ‰çš„distro</span>
</span></span><span style="display:flex;"><span>   CentOS-7.1-distro-x86_64
</span></span><span style="display:flex;"><span>$ cobbler profile list  	<span style="color:#75715e"># å¯¼å…¥distroä¼šè‡ªåŠ¨ç”Ÿæˆprofile</span>
</span></span><span style="display:flex;"><span>   CentOS-7.1-distro-x86_64</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>ç®¡ç†<code>profile</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>cobbler</code>ä½¿ç”¨<code>profile</code>æ¥ä¸ºç‰¹å®šçš„éœ€æ±‚ç±»åˆ«æä¾›é”éœ€è¦å®‰è£…çš„é…ç½®ï¼Œå³åœ¨<code>distro</code>çš„åŸºç¡€ä¸Šé€šè¿‡æä¾›<code>kiskstart</code>æ–‡ä»¶æ¥ç”Ÿæˆä¸€ä¸ªç‰¹å®šçš„ç³»ç»Ÿå®‰è£…é…ç½®ã€‚<code>distro</code>çš„<code>profile</code>å¯ä»¥å‡ºç°åœ¨<code>pxe</code>çš„å¼•å¯¼èœå•ä¸­ä½œä¸ºå®‰è£…çš„é€‰æ‹©ä¹‹ä¸€</li>
<li><code>Cobbler-CentOS-7.1-x86_64.cfg</code>é…ç½®æ–‡ä»¶æˆ‘ä¼šä¸Šä¼ è‡³è‡³é™„ä»¶ï¼Œé»˜è®¤æ˜¯æœ‰<code>kickstart</code>æ–‡ä»¶çš„ï¼Œæ‰€ä»¥<code>edit</code>ï¼Œå¦‚æœæ²¡æœ‰<code>kickstart</code>æ–‡ä»¶å¯ä»¥<code>add</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cobbler profile edit --name<span style="color:#f92672">=</span>Centos7.1-distro-x86_64 --kickstart<span style="color:#f92672">=</span>/var/lib/cobbler/kickstarts/Cobbler-CentOS-7.1-x86_64.cfg  	<span style="color:#75715e"># æŒ‡å®šksè·¯å¾„</span></span></span></code></pre></div><ul>
<li><code>CentOS7</code>ç³»ç»Ÿç½‘å¡åå˜æˆ<code>eno...</code>è¿™ç§ï¼Œä¸ºäº†è¿ç»´æ ‡å‡†åŒ–ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸ºæˆ‘ä»¬å¸¸ç”¨çš„<code>eth0</code>ï¼Œä½¿ç”¨ä¸‹é¢çš„å‚æ•°ã€‚ä½†è¦æ³¨æ„æ˜¯<code>CentOS7</code>æ‰éœ€è¦ä¸‹é¢çš„æ­¥éª¤ï¼Œ<code>CentOS6</code>ä¸éœ€è¦</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cobbler profile edit --name<span style="color:#f92672">=</span>Centos7.1-distro-x86_64 --kopts<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;net.ifnames=0 biosdevname=0&#39;</span>  	<span style="color:#75715e"># ä¿®æ”¹centos7å†…æ ¸</span></span></span></code></pre></div><ul>
<li>æ–°éƒ¨ç½²æœºå™¨å®‰è£…<code>yum</code>æºï¼Œå¹¶åŒæ­¥ã€‚å»ºè®®ä½¿ç”¨å†…ç½‘<code>yum</code>æºï¼Œåœ¨è¿™é‡Œä½¿ç”¨é˜¿é‡Œäº‘<code>yum</code>æº</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cobbler repo add --name<span style="color:#f92672">=</span>base --mirror<span style="color:#f92672">=</span>http://mirrors.aliyun.com/centos/7/os/x86_64/Packages/ --arch<span style="color:#f92672">=</span>x86_64 --breed<span style="color:#f92672">=</span>yum  	<span style="color:#75715e"># æ·»åŠ yumæº</span>
</span></span><span style="display:flex;"><span>$ cobbler reposync  	<span style="color:#75715e"># åŒæ­¥yumæº</span>
</span></span><span style="display:flex;"><span>$ cobbler sync  	<span style="color:#75715e"># æ¯æ¬¡ä¿®æ”¹profileéƒ½éœ€è¦åŒæ­¥</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="ç½²æ“ä½œç³»ç»Ÿ">ç½²æ“ä½œç³»ç»Ÿ</h4>
<ul>
<li>
<ol>
<li>æ–°å»ºä¸€å°è™šæ‹Ÿæœºï¼Œé€šè¿‡ç½‘ç»œå¯åŠ¨å³å¯ã€‚ï¼ˆæˆ‘è¿™é‡Œè™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯<code>NAT</code>æ¨¡å¼,å¹¶ä¸”å…³é—­<code>DHCP</code>åŠŸèƒ½ï¼‰</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>ç”¨æˆ·ï¼š<code>root</code></li>
<li>å¯†ç ï¼š<code>xuliangwei</code></li>
<li><code>openssl</code>ç”Ÿæˆæ—¶æŒ‡å®š</li>
</ul>
<p><a href="#R-image-02dc6a8b5f19461ce70e4f266aa33686" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-02dc6a8b5f19461ce70e4f266aa33686"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="2">
<li>å®šåˆ¶åŒ–å®‰è£…</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>ç”±äº<code>kickstart</code>æŒ‡å®šæŸå°æœåŠ¡å™¨ä½¿ç”¨æŸä¸ª<code>ks</code>æ–‡ä»¶æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥å¼•ç”¨<code>Cobbler</code>å°±å¾ˆç®€å•ã€‚é€šè¿‡ç‰©ç†<code>MAC</code>åœ°å€æ¥åŒºåˆ†</li>
<li>è‡ªå®šä¹‰å®‰è£…ï¼š<code>system</code>ä¸»è¦ç›®çš„é…ç½®ç½‘ç»œæ¥å£ï¼Œé€šè¿‡<code>system</code>æ¥å›ºå®šæœºå™¨çš„<code>IP</code>ã€æ©ç ã€ç½‘å…³ã€<code>DNS</code>ã€ä¸»æœºåã€ç­‰ç­‰å®ç°åŸºç¡€ç¯å¢ƒæ ‡å‡†åŒ–</li>
<li>æ ¹æ®æœºå™¨çš„<code>MAC</code>åœ°å€ï¼Œè‡ªåŠ¨ç»‘å®š<code>IP</code>ï¼Œç½‘å…³ï¼Œ<code>dns</code>ç­‰</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cobbler system add --name<span style="color:#f92672">=</span>xuliangwei-pc --mac<span style="color:#f92672">=</span>00:0C:29:6E:41:CB --profile<span style="color:#f92672">=</span>Centos7.1-profile-x86_64 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--ip-address<span style="color:#f92672">=</span>10.0.0.110 --subnet<span style="color:#f92672">=</span>255.255.255.0 --gateway<span style="color:#f92672">=</span>10.0.0.2 --interface<span style="color:#f92672">=</span>eth0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--static<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> --hostname<span style="color:#f92672">=</span>xuliangwei.com --name-servers<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;114.114.114.114 8.8.8.8&#34;</span>
</span></span><span style="display:flex;"><span>$ cobbler sync
</span></span><span style="display:flex;"><span>$ cobbler system list
</span></span><span style="display:flex;"><span>   xuliangwei-pc</span></span></code></pre></div><p><a href="#R-image-dfd947cfd0c4799a2184e7deb8dbeb06" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-dfd947cfd0c4799a2184e7deb8dbeb06"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="3">
<li>è‡ªå®šä¹‰ç™»é™†ç•Œé¢</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ grep <span style="color:#e6db74">&#34;xuliangwei&#34;</span> /etc/cobbler/pxe/pxedefault.template  	<span style="color:#75715e"># è‡ªå®šä¹‰è£…æœºé¡µé¢</span>
</span></span><span style="display:flex;"><span>MENU TITLE Xuliangwei | http://xuliangwei.com
</span></span><span style="display:flex;"><span>$ cobbler sync  	<span style="color:#75715e"># åŒæ­¥</span></span></span></code></pre></div><p><a href="#R-image-961525b00b0d780ef8b530cbeb1b1c56" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/xuliangwe.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-961525b00b0d780ef8b530cbeb1b1c56"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/xuliangwe.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>web</code>ç®¡ç†<code>Cobbler</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p>æ–°ç‰ˆ<code>cobbler</code>çš„<code>web</code>ç•Œé¢ä½¿ç”¨çš„æ˜¯<code>https</code>ï¼Œç™»å½•https://10.0.0.7/cobbler_web</p>
<p><code>cobbler_web</code>æ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼Œå¦‚<code>authn_configfil</code>ã€<code>authn_ldap</code>æˆ–<code>authn_pam</code>ç­‰ï¼Œé»˜è®¤ä¸º<code>authn_denyall</code>å³æ‹’ç»æ‰€æœ‰ç”¨æˆ·ç™»é™†ï¼Œä¸‹é¢è¯´æ˜ä¸‰ç§èƒ½è®¤è¯ç”¨æˆ·ç™»å½•<code>cobbler_web</code>çš„æ–¹å¼</p>
</li>
<li>
<p><strong>ä½¿ç”¨<code>authn_pam</code>æ¨¡å—è®¤è¯<code>cobbler_web</code>ç”¨æˆ·</strong></p>
</li>
</ul>
<blockquote>
<ul>
<li>é¦–å…ˆä¿®æ”¹<code>modules</code>ä¸­çš„<code>authentication</code>æ®µä¸­çš„<code>module</code>å‚æ•°çš„å€¼ä¸º<code>authn_pam</code>
æ¥ç€åˆ›å»ºç³»ç»Ÿç”¨æˆ·ï¼Œå¹¶ä¸ºç”¨æˆ·è®¾å®šå¯†ç è€Œåå°†è®¾å®šçš„ç³»ç»Ÿç”¨æˆ·æ·»åŠ è‡³<code>cobbler_web</code>çš„<code>admin</code>ç»„ä¸­ï¼Œä¿®æ”¹<code>/etc/cobbler/users.conf</code>æ–‡ä»¶ï¼Œå°†è®¾å®šçš„ç”¨æˆ·æ·»åŠ ä¸º<code>admin</code>å‚æ•°çš„å€¼å³å¯</li>
</ul>
</blockquote>
<ul>
<li><strong>ä½¿ç”¨<code>authn_configfile</code>æ¨¡å—è®¤è¯<code>cobbler_web</code>ç”¨æˆ·</strong></li>
</ul>
<blockquote>
<ul>
<li>é¦–å…ˆä¿®æ”¹<code>modules</code>ä¸­çš„<code>authentication</code>æ®µä¸­çš„<code>module</code>å‚æ•°çš„å€¼ä¸º<code>authn_configfile</code>
æ·»åŠ ç¬¬ä¸€ç”¨æˆ·æ—¶ï¼Œéœ€è¦ä¸º<code>htdigest</code>å‘½ä»¤ä½¿ç”¨<code>&quot;-c&quot; etc/cobbler/users.digest</code>ï¼Œåç»­æ·»åŠ å…¶ä»–ç”¨æˆ·åˆ™ä¸èƒ½å†ä½¿ç”¨ï¼ŒåŒæ­¥<code>cobbler</code>é‡å¯<code>httpd</code>ä»¥åŠ<code>cobbler</code></li>
</ul>
</blockquote>
<ul>
<li><strong>ä½¿ç”¨<code>cobbler</code>é»˜è®¤çš„<code>web</code>è´¦å·å¯†ç è®¤è¯</strong></li>
</ul>
<blockquote>
<ul>
<li><code>user</code>ï¼š<code>cobbler</code></li>
<li><code>pass</code>ï¼š<code>cobbler</code></li>
</ul>
<p><a href="#R-image-901f52ab3f27a5bc47355ce1772b2e5d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-901f52ab3f27a5bc47355ce1772b2e5d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web.png"></a></p>
<p><a href="#R-image-13a9c4f2fd0ad791249a4f12b0231fa7" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web_1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-13a9c4f2fd0ad791249a4f12b0231fa7"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web_1.png"></a></p>
<p><a href="#R-image-0cc1e6dddfda8ca5483c8401f4ee0aad" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web_2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0cc1e6dddfda8ca5483c8401f4ee0aad"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web_2.png"></a></p>
<p><a href="#R-image-69afece93fa91c3478614376d8996987" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web_3.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-69afece93fa91c3478614376d8996987"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web_3.png"></a></p>
<p><a href="#R-image-a4be60b739fad8d8920ad5507d11daba" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web_4.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a4be60b739fad8d8920ad5507d11daba"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web_4.png"></a></p>
<p><a href="#R-image-6526e48ff876f8a413361572948c30f7" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web_5.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6526e48ff876f8a413361572948c30f7"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web_5.png"></a></p>
<p><a href="#R-image-8d2552605639c4f30110871814aa66c8" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web_6.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8d2552605639c4f30110871814aa66c8"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Cobbler_web_6.png"></a></p>
</blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_kickstart">Install_Kickstart</h1>

<h2 id="kickstartæ— äººå€¼å®ˆ"><code>KICKSTART</code>æ— äººå€¼å®ˆ</h2>
<h3 id="æŒ‡ä»¤ä½œç”¨ä»‹ç»">æŒ‡ä»¤ä½œç”¨ä»‹ç»</h3>
<blockquote>
<ul>
<li>
<p><strong><code>pxe</code></strong></p>
<p><code>PXE</code>ä½¿ç”¨<code>DHCP</code>ï¼ˆåŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼‰å’Œ<code>TFTP</code>ï¼ˆæ™®é€šæ–‡ä»¶ä¼ é€åè®®ï¼‰ä»ç½‘ç»œä¸ŠæŸ¥æ‰¾å¹¶è£…è½½å¼•å¯¼ç¨‹åºã€‚<code>PXE</code>ç¯å¢ƒä»<code>NIC</code>ï¼ˆ<code>Network Interface Card</code>ï¼‰ä¸Šçš„<code>BIOS</code>è£…è½½ã€‚é¢„å¼•å¯¼æœåŠ¡ä½¿ç”¨<code>PXE</code>æ¥å‘ç°è®¾å¤‡æ˜¯å¦å­˜åœ¨ä¸ºå…¶æŒ‡å®šçš„é¢„å¼•å¯¼æœåŠ¡å·¥ä½œï¼Œå¹¶å‘è®¾å¤‡æä¾›æ‰§è¡ŒæŒ‡æ´¾å·¥ä½œæ‰€éœ€çš„æ–‡ä»¶ã€‚é€šè¿‡ä½¿ç”¨é¢„å¼•å¯¼æœåŠ¡ï¼Œå¯ä»¥è‡ªåŠ¨å°†æ˜ åƒæ”¾ç½®åˆ°è®¾å¤‡ä¸Šï¼Œå³ä½¿è®¾å¤‡çš„ç¡¬ç›˜ä¸ºç©º</p>
</li>
<li>
<p><strong><code>pxelinux.0</code></strong></p>
<p>ä¸»è¦ä½œç”¨æ˜¯è£…è½½æ‰§è¡ŒæŒ‡æ´¾çš„é¢„å¼•å¯¼å·¥ä½œæ‰€éœ€çš„æ“ä½œç³»ç»Ÿã€‚<code>pxelinux.0</code>æ–‡ä»¶æ˜¯<code>syslinux</code>è¿™ä¸€å¼€æ”¾æºä»£ç é¡¹ç›®çš„ä¸€éƒ¨åˆ†çš„æ”¹è¿›ç‰ˆæœ¬ã€‚è™½ç„¶<code>pxelinux.0</code>ä¸»è¦æ˜¯<code>Linux</code>åŠ è½½å™¨ï¼Œä½†å®ƒä¹Ÿå¯ä»¥è£…è½½å…¶ä»–æ“ä½œç³»ç»Ÿã€‚å®ƒçš„å·¥ä½œæ–¹å¼æ˜¯ä½¿ç”¨ä½äº<code>TFTP</code>æœåŠ¡å™¨ä¸Šçš„é…ç½®æ–‡ä»¶æ¥æä¾›å¼•å¯¼æŒ‡ä»¤</p>
</li>
<li>
<p><strong><code>vmlinuz</code></strong></p>
<p><code>vmlinuz</code>æ˜¯<code>Linux</code>å†…æ ¸çš„é•œåƒæ–‡ä»¶,å¯ä»¥è¢«å¼•å¯¼ç¨‹åºåŠ è½½,ä»è€Œå¯åŠ¨<code>Linux</code>ç³»ç»Ÿ</p>
</li>
<li>
<p><strong><code>initrd</code></strong></p>
<p><code>initrd</code>&mdash;-<code>boot loader initialized RAM disk</code>(å…¨ç§°)ï¼Œæ˜¯ä¸€ç§å¯åŠ¨<code>Linux</code>ç³»ç»Ÿçš„æ–¹å¼ï¼Œå½“å‰æµè¡Œçš„<code>Linux</code>ç‰ˆæœ¬ä¸€èˆ¬éƒ½é‡‡ç”¨æ¨¡å—åŒ–çš„å†…æ ¸,è¿™ç§æ–¹å¼å¯ä»¥åœ¨ä¸é‡æ–°ç¼–è¯‘æ„å»ºå†…æ ¸çš„æƒ…å½¢ä¸‹å¢åŠ åŠŸèƒ½æ¨¡å—ï¼Œä½†æ˜¯å¦‚æœä½ çš„<code>Linux</code>çš„<code>root</code>æ–‡ä»¶ç³»ç»Ÿæ‰€åœ¨è®¾å¤‡çš„é©±åŠ¨æ˜¯ä¸€ä¸ªæ¨¡å—(æ²¡æœ‰ç¼–è¯‘è¿›å†…æ ¸æ˜ è±¡),å°±ä¸èƒ½è¢«å¼•å¯¼ç¨‹åº(ä¾‹å¦‚<code>loadlin</code>)ç›´æ¥åŠ è½½ï¼Œè¿™æ—¶ä¼šç”¨åˆ°<code>initrd</code>æ–¹å¼æ¥å¯åŠ¨ä½ çš„<code>Linux</code>ç³»ç»Ÿ</p>
<ul>
<li>è¿™ç§æ–¹å¼åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µ:</li>
</ul>
<blockquote>
<ol>
<li>åœ¨ä¸€ä¸ª<code>RAM disk</code>ä¸Šå»ºç«‹ä¸€ä¸ªä¸´æ—¶çš„<code>root</code>æ–‡ä»¶ç³»ç»Ÿ,åœ¨è¿™ä¸ª<code>RAM disk</code>ä¸ŠåŒ…å«ç€ä½ éœ€è¦çš„é©±åŠ¨æ¨¡å—</li>
<li>è½½å…¥æ‰€éœ€é©±åŠ¨æ¨¡å—,æŒ‚è½½å®é™…çš„<code>root</code>æ–‡ä»¶ç³»ç»Ÿ ,å¯åŠ¨<code>Linux</code></li>
</ol>
</blockquote>
</li>
<li>
<p><strong><code>initrd.img</code></strong></p>
<p>å°±æ˜¯<code>RAM disk</code>çš„æ˜ è±¡</p>
</li>
</ul>
</blockquote>
<hr>
<h3 id="pxekickstartå·¥ä½œæµç¨‹"><code>PXE</code>+<code>Kickstart</code>å·¥ä½œæµç¨‹</h3>
<blockquote>
<ul>
<li><code>Kickstart</code>æ˜¯ä¸€ç§æ— äººå€¼å®ˆçš„å®‰è£…æ–¹å¼ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯åœ¨å®‰è£…è¿‡ç¨‹ä¸­è®°å½•å…¸å‹çš„éœ€è¦äººå·¥å¹²é¢„å¡«å†™çš„å„ç§å‚æ•°ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåä¸º<code>ks.cfg</code>çš„æ–‡ä»¶ã€‚å¦‚æœåœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼ˆä¸åªå±€é™äºç”Ÿæˆ<code>Kickstart</code>å®‰è£…æ–‡ä»¶çš„æœºå™¨ï¼‰å‡ºç°è¦å¡«å†™å‚æ•°çš„æƒ…å†µï¼Œå®‰è£…ç¨‹åºé¦–å…ˆä¼šå»æŸ¥æ‰¾<code>Kickstart</code>ç”Ÿæˆçš„æ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°åˆé€‚çš„å‚æ•°ï¼Œå°±é‡‡ç”¨æ‰€æ‰¾åˆ°çš„å‚æ•°ï¼›å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„å‚æ•°ï¼Œä¾¿éœ€è¦å®‰è£…è€…æ‰‹å·¥å¹²é¢„äº†ã€‚æ‰€ä»¥ï¼Œå¦‚æœ<code>Kickstart</code>æ–‡ä»¶æ¶µç›–äº†å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„æ‰€æœ‰éœ€è¦å¡«å†™çš„å‚æ•°ï¼Œé‚£ä¹ˆå®‰è£…è€…å®Œå…¨å¯ä»¥åªå‘Šè¯‰å®‰è£…ç¨‹åºä»ä½•å¤„å–<code>ks.cfg</code>æ–‡ä»¶ï¼Œç„¶åå°±å»å¿™è‡ªå·±çš„äº‹æƒ…ã€‚ç­‰å®‰è£…å®Œæ¯•ï¼Œå®‰è£…ç¨‹åºä¼šæ ¹æ®<code>ks.cfg</code>ä¸­çš„è®¾ç½®é‡å¯ç³»ç»Ÿï¼Œå¹¶ç»“æŸå®‰è£…</li>
<li><code>PXE</code>+<code>Kickstart</code>æ— äººå€¼å®ˆå®‰è£…æ“ä½œç³»ç»Ÿå®Œæ•´è¿‡ç¨‹å¦‚ä¸‹</li>
</ul>
<blockquote>
<p><a href="#R-image-68d4f207e6f2a7307fbe26c58199a726" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/PXE+Kickstart.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-68d4f207e6f2a7307fbe26c58199a726"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/PXE+Kickstart.png"></a></p>
</blockquote>
<ul>
<li>
<p>**<code>PXE Client</code>å‘<code>DHCP</code>å‘é€è¯·æ±‚ **</p>
<p><code>PXE Client</code>ä»è‡ªå·±çš„<code>PXE</code>ç½‘å¡å¯åŠ¨ï¼Œé€šè¿‡<code>PXE BootROM</code>(è‡ªå¯åŠ¨èŠ¯ç‰‡)ä¼šä»¥<code>UDP</code>(ç®€å•ç”¨æˆ·æ•°æ®æŠ¥åè®®)å‘é€ä¸€ä¸ªå¹¿æ’­è¯·æ±‚ï¼Œå‘æœ¬ç½‘ç»œä¸­çš„<code>DHCP</code>æœåŠ¡å™¨ç´¢å–<code>IP</code></p>
</li>
<li>
<p><strong><code>DHCP</code>æœåŠ¡å™¨æä¾›ä¿¡æ¯</strong></p>
<p><code>DHCP</code>æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼ŒéªŒè¯æ˜¯å¦æ¥è‡³åˆæ³•çš„<code>PXE Client</code>çš„è¯·æ±‚ï¼ŒéªŒè¯é€šè¿‡å®ƒå°†ç»™å®¢æˆ·ç«¯ä¸€ä¸ª<code>æä¾›</code>å“åº”ï¼Œè¿™ä¸ª<code>æä¾›</code>å“åº”ä¸­åŒ…å«äº†ä¸ºå®¢æˆ·ç«¯åˆ†é…çš„<code>IP</code>åœ°å€ã€<code>pxelinux</code>å¯åŠ¨ç¨‹åº(<code>TFTP</code>)ä½ç½®ï¼Œä»¥åŠé…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®</p>
</li>
<li>
<p><strong><code>PXE</code>å®¢æˆ·ç«¯è¯·æ±‚ä¸‹è½½å¯åŠ¨æ–‡ä»¶</strong></p>
<p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„<code>å›åº”</code>åï¼Œä¼šå›åº”ä¸€ä¸ªå¸§ï¼Œä»¥è¯·æ±‚ä¼ é€å¯åŠ¨æ‰€éœ€æ–‡ä»¶ã€‚è¿™äº›å¯åŠ¨æ–‡ä»¶åŒ…æ‹¬ï¼š<code>pxelinux.0</code>ã€<code>pxelinux.cfg/default</code>ã€<code>vmlinuz</code>ã€<code>initrd.img</code>ç­‰æ–‡ä»¶</p>
</li>
<li>
<p><strong><code>Boot Server</code>å“åº”å®¢æˆ·ç«¯è¯·æ±‚å¹¶ä¼ é€æ–‡ä»¶</strong></p>
<p>å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œä»–ä»¬ä¹‹é—´ä¹‹åå°†æœ‰æ›´å¤šçš„ä¿¡æ¯åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ä½œåº”ç­”, ç”¨ä»¥å†³å®šå¯åŠ¨å‚æ•°ã€‚<code>BootROM</code>ç”±<code>TFTP</code>é€šè®¯åè®®ä»<code>Boot Server</code>ä¸‹è½½å¯åŠ¨å®‰è£…ç¨‹åºæ‰€å¿…é¡»çš„æ–‡ä»¶(<code>pxelinux.0</code>ã€<code>pxelinux.cfg/default</code>)ã€‚<code>default</code>æ–‡ä»¶ä¸‹è½½å®Œæˆåï¼Œä¼šæ ¹æ®è¯¥æ–‡ä»¶ä¸­å®šä¹‰çš„å¼•å¯¼é¡ºåºï¼Œå¯åŠ¨<code>Linux</code>å®‰è£…ç¨‹åºçš„å¼•å¯¼å†…æ ¸</p>
</li>
<li>
<p><strong>è¯·æ±‚ä¸‹è½½è‡ªåŠ¨åº”ç­”æ–‡ä»¶</strong></p>
<p>å®¢æˆ·ç«¯é€šè¿‡<code>pxelinux.cfg/default</code>æ–‡ä»¶æˆåŠŸçš„å¼•å¯¼<code>Linux</code>å®‰è£…å†…æ ¸åï¼Œå®‰è£…ç¨‹åºé¦–å…ˆå¿…é¡»ç¡®å®šä½ é€šè¿‡ä»€ä¹ˆå®‰è£…ä»‹è´¨æ¥å®‰è£…<code>linux</code>ï¼Œå¦‚æœæ˜¯é€šè¿‡ç½‘ç»œå®‰è£…(<code>NFS</code>, <code>FTP</code>, <code>HTTP</code>)ï¼Œåˆ™ä¼šåœ¨è¿™ä¸ªæ—¶å€™åˆå§‹åŒ–ç½‘ç»œï¼Œå¹¶å®šä½å®‰è£…æºä½ç½®ã€‚æ¥ç€ä¼šè¯»å–<code>default</code>æ–‡ä»¶ä¸­æŒ‡å®šçš„è‡ªåŠ¨åº”ç­”æ–‡ä»¶<code>ks.cfg</code>æ‰€åœ¨ä½ç½®ï¼Œæ ¹æ®è¯¥ä½ç½®è¯·æ±‚ä¸‹è½½è¯¥æ–‡ä»¶</p>
</li>
<li>
<p><strong>å®¢æˆ·ç«¯å®‰è£…æ“ä½œç³»ç»Ÿ</strong></p>
<p>å°†<code>ks.cfg</code>æ–‡ä»¶ä¸‹è½½å›æ¥åï¼Œé€šè¿‡è¯¥æ–‡ä»¶æ‰¾åˆ°<code>OS Server</code>ï¼Œå¹¶æŒ‰ç…§è¯¥æ–‡ä»¶çš„é…ç½®è¯·æ±‚ä¸‹è½½å®‰è£…è¿‡ç¨‹éœ€è¦çš„è½¯ä»¶åŒ…ã€‚</p>
<p><code>OS Server</code>å’Œå®¢æˆ·ç«¯å»ºç«‹è¿æ¥åï¼Œå°†å¼€å§‹ä¼ è¾“è½¯ä»¶åŒ…ï¼Œå®¢æˆ·ç«¯å°†å¼€å§‹å®‰è£…æ“ä½œç³»ç»Ÿã€‚å®‰è£…å®Œæˆåï¼Œå°†æç¤ºé‡æ–°å¼•å¯¼è®¡ç®—æœº</p>
</li>
</ul>
</blockquote>
<hr>
<h3 id="å®‰è£…">å®‰è£…</h3>
<blockquote>
<ul>
<li><code>Kickstart</code>çš„å®‰è£…æ–¹å¼æœ‰å¤šç§ç»„åˆï¼Œ<code>Kickstart</code>+<code>DHCP</code>+<code>TFTP</code>+<code>HTTP/NFS/FTP</code>ç­‰ï¼Œä¸ç®¡æ˜¯<code>HTTPã€NFS</code>æˆ–è€…<code>FTP</code>ï¼Œéƒ½æ˜¯ä¸ºäº†å¯»æ‰¾åˆ°ç³»ç»Ÿå¼•å¯¼åéœ€è¦å®‰è£…çš„åŒ…ç»„ç­‰æ–‡ä»¶ã€‚ä¸‹é¢çš„å®‰è£…æ–¹å¼æ˜¯<code>Kickstart</code>+<code>DHCP</code>+<code>TFTP</code>+<code>HTTP</code></li>
</ul>
</blockquote>
<hr>
<h4 id="dhcpå®‰è£…é…ç½®"><code>DHCP</code>å®‰è£…é…ç½®</h4>
<blockquote>
<ul>
<li>
<p><code>/etc/dhcp/dhcpd.conf </code></p>
</li>
<li>
<p><code>range 10.0.0.100 10.0.0.200;</code>  	# å¯åˆ†é…çš„èµ·å§‹<code>IP</code>-ç»“æŸ<code>IP</code></p>
</li>
<li>
<p><code>option subnet-mask 255.255.255.0;</code>  	# è®¾å®š<code>netmask</code></p>
</li>
<li>
<p><code>default-lease-time 21600;</code>  	# è®¾ç½®é»˜è®¤çš„<code>IP</code>ç§Ÿç”¨æœŸé™</p>
</li>
<li>
<p><code>max-lease-time 43200;</code>  	# è®¾ç½®æœ€å¤§çš„<code>IP</code>ç§Ÿç”¨æœŸé™</p>
</li>
<li>
<p><code>next-server 10.0.0.7;</code>       # å‘ŠçŸ¥å®¢æˆ·ç«¯<code>TFTP</code>æœåŠ¡å™¨çš„<code>ip</code></p>
</li>
<li>
<p><code>filename &quot;/pxelinux.0&quot;;</code>      # å‘ŠçŸ¥å®¢æˆ·ç«¯ä»<code>TFTP</code>æ ¹ç›®å½•ä¸‹è½½<code>pxelinux.0</code>æ–‡ä»¶</p>
</li>
<li>
<p><strong>æ³¨æ„ï¼š</strong></p>
<p>å¦‚æœæœºå™¨æ•°é‡è¿‡å¤šçš„è¯ï¼Œæ³¨æ„<code>dhcp</code>æœåŠ¡å™¨çš„åœ°å€æ± ï¼Œä¸è¦å› ä¸ºè€—å°½<code>IP</code>è€Œå¯¼è‡´<code>dhcpd</code>æœåŠ¡å™¨æ²¡æœ‰<code>IP</code>åœ°å€<code>release</code>çš„æƒ…å†µ</p>
<p>æœ¬æ¥è½¯ä»¶è£…å®Œåéƒ½è¦åŠ å…¥å¼€æœºè‡ªå¯åŠ¨ï¼Œä½†è¿™ä¸ª<code>Kickstart</code>ç³»ç»Ÿå°±ä¸èƒ½å¼€æœºè‡ªå¯åŠ¨ï¼Œè€Œä¸”ç”¨å®ŒåæœåŠ¡éƒ½è¦å…³é—­ï¼Œé˜²æ­¢æœªæ¥é‡å¯æœåŠ¡å™¨è‡ªåŠ¨é‡è£…ç³»ç»Ÿäº†</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install dhcp
</span></span><span style="display:flex;"><span>$ vim /etc/dhcp/dhcpd.conf
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DHCP Server Configuration file.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  see /usr/share/doc/dhcp*/dhcpd.conf.sample</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  see &#39;man 5 dhcpd.conf&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>subnet 10.0.0.0 netmask 255.255.255.0 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>range 10.0.0.201 10.0.0.210;
</span></span><span style="display:flex;"><span>option subnet-mask 255.255.255.0;
</span></span><span style="display:flex;"><span>default-lease-time 21600;
</span></span><span style="display:flex;"><span>max-lease-time 43200;
</span></span><span style="display:flex;"><span>next-server 10.0.0.61;
</span></span><span style="display:flex;"><span>filename <span style="color:#e6db74">&#34;/pxelinux.0&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;/etc/dhcp/dhcpd.conf&#34;</span> 13L, 360C å·²å†™å…¥
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /etc/init.d/dhcpd start
</span></span><span style="display:flex;"><span>æ­£åœ¨å¯åŠ¨ dhcpdï¼š                      <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>$ netstat -lntup|grep dhcp
</span></span><span style="display:flex;"><span>udp    <span style="color:#ae81ff">0</span>   <span style="color:#ae81ff">0</span> 0.0.0.0:67         0.0.0.0:*                2040/dhcpd</span></span></code></pre></div></blockquote>
<hr>
<h4 id="tftpå®‰è£…é…ç½®"><code>TFTP</code>å®‰è£…é…ç½®</h4>
<blockquote>
<ul>
<li><code>TFTP</code>æœåŠ¡å™¨æä¾›æ–‡ä»¶ä½¿ç”¨ç®€å•æ–‡ä»¶ä¼ è¾“åè®®ã€‚<code>TFTP</code>åè®®é€šå¸¸ç”¨äºå¯åŠ¨æ— ç›˜å·¥ä½œç«™ï¼Œä¸‹è½½é…ç½®æ–‡ä»¶åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶å¼€å§‹å¯¹éƒ¨åˆ†æ“ä½œç³»ç»Ÿçš„å®‰è£…è¿‡ç¨‹</li>
<li><code>server_args</code> = <code>-s /var/lib/tftpboot</code>  	# æŒ‡å®š<code>boot</code>å¯åŠ¨ç›®å½•ï¼Œä¿æŒé»˜è®¤</li>
<li><code>disable</code> = <code>yes</code>  # <code>no</code>æ”¹ä¸º<code>yes</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install tftp.server
</span></span><span style="display:flex;"><span>$ vim /etc/xinetd.d/tftp 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># default: off</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># description: The tftp server serves files using the trivial file transfer \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    protocol. The tftp protocol is often used to boot diskless \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    workstations, download configuration files to network-aware printers, \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    and to start the installation process for some operating systems.</span>
</span></span><span style="display:flex;"><span>service tftp
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> socket_type       <span style="color:#f92672">=</span> dgram
</span></span><span style="display:flex;"><span> protocol        <span style="color:#f92672">=</span> udp
</span></span><span style="display:flex;"><span> wait          <span style="color:#f92672">=</span> yes
</span></span><span style="display:flex;"><span> user          <span style="color:#f92672">=</span> root
</span></span><span style="display:flex;"><span> server         <span style="color:#f92672">=</span> /usr/sbin/in.tftpd
</span></span><span style="display:flex;"><span> server_args       <span style="color:#f92672">=</span> -s /var/lib/tftpboot
</span></span><span style="display:flex;"><span> disable         <span style="color:#f92672">=</span> no
</span></span><span style="display:flex;"><span> per_source       <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span> cps           <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span> flags          <span style="color:#f92672">=</span> IPv4
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;/etc/xinetd.d/tftp&#34;</span> 18L, 517C å·²å†™å…¥
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /etc/init.d/xinetd restart
</span></span><span style="display:flex;"><span>åœæ­¢ xinetdï¼š                       <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>æ­£åœ¨å¯åŠ¨ xinetdï¼š                     <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ netstat -lntup|grep xinetd
</span></span><span style="display:flex;"><span>udp    <span style="color:#ae81ff">0</span>   <span style="color:#ae81ff">0</span> 0.0.0.0:69         0.0.0.0:*                2066/xinetd</span></span></code></pre></div></blockquote>
<hr>
<h4 id="httpå®‰è£…é…ç½®"><code>HTTP</code>å®‰è£…é…ç½®</h4>
<blockquote>
<ul>
<li><code>ServerName</code>æŒ‡å®š<code>Nginx</code>ç”¨äºè¯†åˆ«è‡ªèº«çš„åå­—å’Œç«¯å£å·ã€‚é€šå¸¸è¿™ä¸ªå€¼æ˜¯è‡ªåŠ¨æŒ‡å®šçš„ï¼Œä½†æ˜¯æˆ‘ä»¬æ¨èä½ æ˜¾å¼çš„æŒ‡å®šå®ƒä»¥é˜²æ­¢å¯åŠ¨æ—¶å‡ºé”™ã€‚å¦‚æœä½ ä¸ºä½ çš„ä¸»æœºæŒ‡å®šäº†ä¸€ä¸ªæ— æ•ˆçš„<code>DNS</code>åï¼Œ<code>server-generated</code>é‡å®šå‘å°†ä¸èƒ½å·¥ä½œ</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;277i ServerName 127.0.0.1:80&#34;</span> /etc/httpd/conf/httpd.conf</span></span></code></pre></div></blockquote>
<ul>
<li>å°†<code>CentOS-6.7</code>æŒ‚è½½åˆ°<code>http</code>æœåŠ¡ä¸‹</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mount /dev/cdrom /var/www/html/CentOS-6.7/</span></span></code></pre></div></blockquote>
<ul>
<li>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat extra/www.conf 
</span></span><span style="display:flex;"><span>server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>listen    80;
</span></span><span style="display:flex;"><span>server_name www.ky.com;  	<span style="color:#75715e"># åŸŸåè®¾ç½®</span>
</span></span><span style="display:flex;"><span>autoindex on;  	<span style="color:#75715e"># ä¸æ‰¾é¦–é¡µæ–‡ä»¶ï¼Œå±•ç¤ºç›®å½•ç»“æ„</span>
</span></span><span style="display:flex;"><span>location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   root  /var/www/html/;  	<span style="color:#75715e"># æ˜¾ç¤ºç½‘é¡µå†…å®¹çš„æ–‡ä»¶ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></li>
<li>
<p>è®¿é—®æµè§ˆå™¨<code>10.0.0.61/CentOS-6.7/</code>æŸ¥çœ‹é…ç½®æ˜¯å¦æ­£ç¡®</p>
</li>
</ul>
<blockquote>
<p><a href="#R-image-67b1568a3050a2462c18baac805483de" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Index.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-67b1568a3050a2462c18baac805483de"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Index.png"></a></p>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install httpd
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;277i ServerName 127.0.0.1:80&#34;</span> /etc/httpd/conf/httpd.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /etc/init.d/httpd start
</span></span><span style="display:flex;"><span>æ­£åœ¨å¯åŠ¨ httpdï¼š                      <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ netstat -lntup|grep <span style="color:#e6db74">&#34;httpd&#34;</span>
</span></span><span style="display:flex;"><span>tcp    <span style="color:#ae81ff">0</span>   <span style="color:#ae81ff">0</span> :::80            :::*            LISTEN   2085/httpd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mkdir /var/www/html/CentOS-6.7
</span></span><span style="display:flex;"><span>$ mount /dev/cdrom /var/www/html/CentOS-6.7/
</span></span><span style="display:flex;"><span>mount: block device /dev/sr0 is write-protected, mounting read-only
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ df -h
</span></span><span style="display:flex;"><span>Filesystem   Size Used Avail Use% Mounted on
</span></span><span style="display:flex;"><span>/dev/sda3    8.8G 1.5G 6.9G 18% /
</span></span><span style="display:flex;"><span>tmpfs      495M   <span style="color:#ae81ff">0</span> 495M  0% /dev/shm
</span></span><span style="display:flex;"><span>/dev/sda1    190M  36M 145M 20% /boot
</span></span><span style="display:flex;"><span>/dev/sr0    3.7G 3.7G   <span style="color:#ae81ff">0</span> 100% /var/www/html/CentOS-6.7
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat nginx.conf
</span></span><span style="display:flex;"><span>worker_processes 1;
</span></span><span style="display:flex;"><span>events <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>worker_connections 1024;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>http <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>include    mime.types;
</span></span><span style="display:flex;"><span>default_type application/octet-stream;
</span></span><span style="display:flex;"><span>sendfile    on;
</span></span><span style="display:flex;"><span>keepalive_timeout 65;
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\#</span>include set
</span></span><span style="display:flex;"><span>include extra/www.conf;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat extra/www.conf 
</span></span><span style="display:flex;"><span>server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> listen    80;
</span></span><span style="display:flex;"><span> server_name www.ky.com;
</span></span><span style="display:flex;"><span> autoindex on;
</span></span><span style="display:flex;"><span> location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   root  /var/www/html/;
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ fuser -k 80/tcp 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ€æ­»å› å‰é¢å¼€å¯httpdæœåŠ¡å ç”¨80çš„ç«¯å£è¿›ç¨‹ï¼Œç„¶åå°±å¯ä»¥å¼€å¯nginxæœåŠ¡</span></span></span></code></pre></div></blockquote>
<hr>
<h5 id="syslinuxé…ç½®"><code>syslinux</code>é…ç½®</h5>
<blockquote>
<ul>
<li><code>syslinux</code>æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å¼•å¯¼åŠ è½½ç¨‹åºï¼Œè€Œä¸”å…¼å®¹å„ç§ä»‹è´¨ã€‚<code>SYSLINUX</code>æ˜¯ä¸€ä¸ªå°å‹çš„<code>Linux</code>æ“ä½œç³»ç»Ÿï¼Œå®ƒçš„ç›®çš„æ˜¯ç®€åŒ–é¦–æ¬¡å®‰è£…<code>Linux</code>çš„æ—¶é—´ï¼Œå¹¶å»ºç«‹ä¿®æŠ¤æˆ–å…¶å®ƒç‰¹æ®Šç”¨é€”çš„å¯åŠ¨ç›˜ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°<code>pxelinux.0</code>è¿™ä¸ªæ–‡ä»¶,å¯ä»¥å®‰è£…ä¸€ä¸‹</li>
<li>å°†<code>sysliunx</code>çš„<code>pxelinux.0</code>æ–‡ä»¶æ‹·è´åˆ°<code>tftp</code>å¯åŠ¨ç›®å½•ä¸‹</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/ </span></span></code></pre></div></blockquote>
<ul>
<li>å°†<code>/var/www/html/CentOS-6.7/isolinux/*</code>ä¸‹çš„æ‰€æœ‰ç³»ç»Ÿå¼•å¯¼å®‰è£…çš„æ–‡ä»¶æ‹·è´åˆ°<code>tftp</code>å¯åŠ¨ç›®å½•ä¸‹</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp -a /var/www/html/CentOS-6.7/isolinux/* /var/lib/tftpboot/</span></span></code></pre></div></blockquote>
<ul>
<li>å°†<code>isolinux.cfg</code>æ–‡ä»¶æ‹·è´åˆ°<code>tftp</code>å¯åŠ¨ç›®å½•ä¸‹çš„<code>pxelinux.cfg</code>ç›®å½•ä¸‹å¹¶æ”¹åä¸º<code>default</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /var/lib/tftpboot/pxelinux.cfg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp /var/www/html/CentOS-6.7/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default</span></span></code></pre></div></blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install syslinux
</span></span><span style="display:flex;"><span>$ cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp -a /var/www/html/CentOS-6.7/isolinux/* /var/lib/tftpboot/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mkdir -p /var/lib/tftpboot/pxelinux.cfg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp /var/www/html/CentOS-6.7/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default</span></span></code></pre></div><blockquote>
<ul>
<li><code>/var/www/html/CentOS-6.7/isolinux/isolinux.cfg</code>æ–‡ä»¶è¯¦è§£</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /var/www/html/CentOS-6.7/isolinux/isolinux.cfg 
</span></span><span style="display:flex;"><span>default vesamenu.c32 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é»˜è®¤åŠ è½½ä¸€ä¸ªèœå•</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># prompt 1 </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¼€å¯ä¼šæ˜¾ç¤ºå‘½ä»¤è¡Œ&#39;boot: &#39;æç¤ºç¬¦ã€‚promptå€¼ä¸º0æ—¶åˆ™ä¸æç¤ºï¼Œå°†ä¼šç›´æ¥å¯åŠ¨&#39;default&#39;å‚æ•°ä¸­æŒ‡å®šçš„å†…å®¹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>timeout <span style="color:#ae81ff">600</span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># timeoutæ—¶é—´æ˜¯å¼•å¯¼æ—¶ç­‰å¾…ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©çš„æ—¶é—´ï¼Œè®¾ä¸º1å¯ç›´æ¥å¼•å¯¼ï¼Œå•ä½ä¸º1/10ç§’</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>display boot.msg 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># èœå•èƒŒæ™¯å›¾ç‰‡ã€æ ‡é¢˜ã€é¢œè‰²</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>menu background splash.jpg
</span></span><span style="display:flex;"><span>menu title Welcome to CentOS 6.7!
</span></span><span style="display:flex;"><span>menu color border <span style="color:#ae81ff">0</span> <span style="color:#75715e">#ffffffff #00000000</span>
</span></span><span style="display:flex;"><span>menu color sel <span style="color:#ae81ff">7</span> <span style="color:#75715e">#ffffffff #ff000000</span>
</span></span><span style="display:flex;"><span>menu color title <span style="color:#ae81ff">0</span> <span style="color:#75715e">#ffffffff #00000000</span>
</span></span><span style="display:flex;"><span>menu color tabmsg <span style="color:#ae81ff">0</span> <span style="color:#75715e">#ffffffff #00000000</span>
</span></span><span style="display:flex;"><span>menu color unsel <span style="color:#ae81ff">0</span> <span style="color:#75715e">#ffffffff #00000000</span>
</span></span><span style="display:flex;"><span>menu color hotsel <span style="color:#ae81ff">0</span> <span style="color:#75715e">#ff000000 #ffffffff</span>
</span></span><span style="display:flex;"><span>menu color hotkey <span style="color:#ae81ff">7</span> <span style="color:#75715e">#ffffffff #ff000000</span>
</span></span><span style="display:flex;"><span>menu color scrollbar <span style="color:#ae81ff">0</span> <span style="color:#75715e">#ffffffff #00000000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>label linux
</span></span><span style="display:flex;"><span><span style="color:#75715e"># labelæŒ‡å®šåœ¨boot:æç¤ºç¬¦ä¸‹è¾“å…¥çš„å…³é”®å­—ï¼Œæ¯”å¦‚boot:linux[ENTER]ï¼Œè¿™ä¸ªä¼šå¯åŠ¨label linuxä¸‹æ ‡è®°çš„kernelå’Œinitrd.imgæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>menu label ^Install or upgrade an existing system
</span></span><span style="display:flex;"><span>menu default
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸€ä¸ªæ ‡ç­¾å°±æ˜¯å‰é¢å›¾ç‰‡çš„ä¸€è¡Œé€‰é¡¹</span>
</span></span><span style="display:flex;"><span>kernel vmlinuz 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šè¦å¯åŠ¨çš„å†…æ ¸ã€‚åŒæ ·è¦æ³¨æ„è·¯å¾„ï¼Œé»˜è®¤æ˜¯/tftpbootç›®å½•</span>
</span></span><span style="display:flex;"><span>append initrd<span style="color:#f92672">=</span>initrd.img 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šè¿½åŠ ç»™å†…æ ¸çš„å‚æ•°ï¼Œinitrd.imgæ˜¯ä¸€ä¸ªæœ€å°çš„linuxç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>label vesa
</span></span><span style="display:flex;"><span>menu label Install system with ^basic video driver
</span></span><span style="display:flex;"><span>kernel vmlinuz
</span></span><span style="display:flex;"><span>append initrd<span style="color:#f92672">=</span>initrd.img nomodeset
</span></span><span style="display:flex;"><span>label rescue
</span></span><span style="display:flex;"><span>menu label ^Rescue installed system
</span></span><span style="display:flex;"><span>kernel vmlinuz
</span></span><span style="display:flex;"><span>append initrd<span style="color:#f92672">=</span>initrd.img rescue
</span></span><span style="display:flex;"><span>label local
</span></span><span style="display:flex;"><span>menu label Boot from ^local drive
</span></span><span style="display:flex;"><span>localboot 0xffff
</span></span><span style="display:flex;"><span>label memtest86
</span></span><span style="display:flex;"><span>menu label ^Memory test
</span></span><span style="display:flex;"><span>kernel memtest
</span></span><span style="display:flex;"><span>append -</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h5 id="ç¼–è¾‘default">ç¼–è¾‘<code>default</code></h5>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/var/lib/tftpboot/pxelinux.cfg/default<span style="color:#e6db74">&lt;&lt;-EOF  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default ks
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">prompt 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">label ks
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kernel vmlinuz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">append initrd=initrd.img ks=http://10.0.0.61/ks_config/CentOS-6.7-ks.cfg ksdevice=eth0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>è¿™ä¸ªæ–‡ä»¶å°±æ˜¯å®ç°ä¸‹å›¾è¿™ä¸ªç•Œé¢çš„åŠŸèƒ½</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/var/lib/tftpboot/pxelinux.cfg/default<span style="color:#e6db74">&lt;&lt;-EOF  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default ks
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">prompt 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">label linux
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kernel vmlinuz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">append initrd=initrd.img ks=http://10.0.0.61/ks_config/CentOS-6.7-ks.cfg ksdevice=eth0  	# å‘Šè¯‰å®‰è£…ç¨‹åºks.cfgæ–‡ä»¶åœ¨å“ªé‡Œï¼Œksdevice=eth0ä»£è¡¨å½“å®¢æˆ·ç«¯æœ‰å¤šå—ç½‘å¡çš„æ—¶å€™ï¼Œè®¾ç½®ä»eth0å®‰è£…
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><p><a href="#R-image-8f2d33cc0f5717bc1487f7d73261c8e7" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Install-Centos6.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8f2d33cc0f5717bc1487f7d73261c8e7"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Install-Centos6.png"></a></p>
</blockquote>
</blockquote>
<hr>
<h4 id="kscfgæ–‡ä»¶"><code>ks.cfg</code>æ–‡ä»¶</h4>
<blockquote>
<ul>
<li>é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨å®‰è£…æ“ä½œç³»ç»Ÿçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¤§é‡çš„å’ŒæœåŠ¡å™¨äº¤äº’æ“ä½œï¼Œä¸ºäº†å‡å°‘è¿™ä¸ªäº¤äº’è¿‡ç¨‹ï¼Œ<code>kickstart</code>å°±è¯ç”Ÿäº†ã€‚ä½¿ç”¨è¿™ç§<code>kickstart</code>ï¼Œåªéœ€äº‹å…ˆå®šä¹‰å¥½ä¸€ä¸ª<code>Kickstart</code>è‡ªåŠ¨åº”ç­”é…ç½®æ–‡ä»¶<code>ks.cfg</code>ï¼ˆé€šå¸¸å­˜æ”¾åœ¨å®‰è£…æœåŠ¡å™¨ä¸Šï¼‰ï¼Œå¹¶è®©å®‰è£…ç¨‹åºçŸ¥é“è¯¥é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­å®‰è£…ç¨‹åºå°±å¯ä»¥è‡ªå·±ä»è¯¥æ–‡ä»¶ä¸­è¯»å–å®‰è£…é…ç½®ï¼Œè¿™æ ·å°±é¿å…äº†åœ¨å®‰è£…è¿‡ç¨‹ä¸­å¤šæ¬¡çš„äººæœºäº¤äº’ï¼Œä»è€Œå®ç°æ— äººå€¼å®ˆçš„è‡ªåŠ¨åŒ–å®‰è£…</li>
<li>ç”Ÿæˆ<code>kickstart</code>é…ç½®æ–‡ä»¶çš„ä¸‰ç§æ–¹æ³•ï¼š</li>
</ul>
<blockquote>
<ul>
<li>æ–¹æ³•1ã€ æ¯å®‰è£…å¥½ä¸€å°<code>Centos</code>æœºå™¨ï¼Œ<code>Centos</code>å®‰è£…ç¨‹åºéƒ½ä¼šåˆ›å»ºä¸€ä¸ª<code>kickstart</code>é…ç½®æ–‡ä»¶ï¼Œè®°å½•ä½ çš„çœŸå®å®‰è£…é…ç½®ã€‚å¦‚æœä½ å¸Œæœ›å®ç°å’ŒæŸç³»ç»Ÿç±»ä¼¼çš„å®‰è£…ï¼Œå¯ä»¥åŸºäºè¯¥ç³»ç»Ÿçš„<code>kickstart</code>é…ç½®æ–‡ä»¶æ¥ç”Ÿæˆä½ è‡ªå·±çš„<code>kickstart</code>é…ç½®æ–‡ä»¶ã€‚ï¼ˆç”Ÿæˆçš„æ–‡ä»¶åå­—å«<code>anaconda-ks.cfgä½äº/root/anaconda-ks.cfg</code>ï¼‰</li>
<li>æ–¹æ³•2ã€<code>Centos</code>æä¾›äº†ä¸€ä¸ªå›¾å½¢åŒ–çš„<code>kickstart</code>é…ç½®å·¥å…·ã€‚åœ¨ä»»ä½•ä¸€ä¸ªå®‰è£…å¥½çš„<code>Linux</code>ç³»ç»Ÿä¸Šè¿è¡Œè¯¥å·¥å…·ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ›å»ºä½ è‡ªå·±çš„<code>kickstart</code>é…ç½®æ–‡ä»¶ã€‚<code>kickstart</code>é…ç½®å·¥å…·å‘½ä»¤ä¸º<code>redhat-config-kickstart</code>ï¼ˆ<code>RHEL3</code>ï¼‰æˆ–<code>system-config-kickstart</code>ï¼ˆ<code>RHEL4</code>ï¼Œ<code>RHEL5</code>ï¼‰.ç½‘ä¸Šæœ‰å¾ˆå¤šç”¨<code>CentOS</code>æ¡Œé¢ç‰ˆç”Ÿæˆ<code>ks</code>æ–‡ä»¶çš„æ–‡ç« ï¼Œå¦‚æœæœ‰ç°æˆçš„ç³»ç»Ÿå°±æ²¡ä»€ä¹ˆå¯è¯´ã€‚ä½†æ²¡æœ‰ç°æˆçš„ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦å»ç”¨æ¡Œé¢ç‰ˆï¼Œå‘½ä»¤è¡Œä¹Ÿå¾ˆç®€å•</li>
<li>æ–¹æ³•3ã€é˜…è¯»<code>kickstart</code>é…ç½®æ–‡ä»¶çš„æ‰‹å†Œã€‚ç”¨ä»»ä½•ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨éƒ½å¯ä»¥åˆ›å»ºä½ è‡ªå·±çš„<code>kickstart</code>é…ç½®æ–‡ä»¶</li>
</ul>
</blockquote>
<ul>
<li>ç¼–å†™<code>ks.cfg</code>æ–‡ä»¶</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ grub-crypt 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆä¸€ä¸ªå¯†ç </span>
</span></span><span style="display:flex;"><span>Password:
</span></span><span style="display:flex;"><span>Retype password: 
</span></span><span style="display:flex;"><span>$6$PqVOBDIH4wHJ.JyH$6/xoqOGnm3DnEJyyXgWxCdmscsWrGKbTmMYYE/lgVgzIep999j8z9s7Ci5V5TG16TALy/Grtk6Vh/jj2WLnEn1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat /var/www/html/ks_config/CentOS-6.7-ks.cfg
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Kickstart Configurator for CentOS 6.7 by ky</span>
</span></span><span style="display:flex;"><span>install
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘ŠçŸ¥å®‰è£…ç¨‹åºï¼Œè¿™æ˜¯ä¸€æ¬¡å…¨æ–°å®‰è£…ï¼Œè€Œä¸æ˜¯å‡çº§upgrade</span>
</span></span><span style="display:flex;"><span>url --url<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://10.0.0.61/CentOS-6.7/&#34;</span>       
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šç³»ç»Ÿå®‰è£…çš„åŒ…ç»„ç­‰çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>text 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–‡æœ¬æ¨¡å¼å®‰è£…</span>
</span></span><span style="display:flex;"><span>lang en_US.UTF-8 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…ä½¿ç”¨çš„è¯­è¨€</span>
</span></span><span style="display:flex;"><span>keyboard us 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®ç³»ç»Ÿé”®ç›˜ç±»å‹</span>
</span></span><span style="display:flex;"><span>zerombr
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…æ¥šmbrå¼•å¯¼ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bootloader --location<span style="color:#f92672">=</span>mbr --driveorder<span style="color:#f92672">=</span>sda --append<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;crashkernel=auto rhgb quiet&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --location=,æŒ‡å®šå¼•å¯¼è®°å½•è¢«å†™å…¥çš„ä½ç½®.æœ‰æ•ˆçš„å€¼å¦‚ä¸‹:mbr(ç¼ºçœ),partition(åœ¨åŒ…å«å†…æ ¸çš„åˆ†åŒºçš„ç¬¬ä¸€ä¸ªæ‰‡åŒºå®‰è£…å¼•å¯¼è£…è½½ç¨‹åº)æˆ–none(ä¸å®‰è£…å¼•å¯¼è£…è½½ç¨‹åºï¼›--driveorder,æŒ‡å®šåœ¨BIOSå¼•å¯¼é¡ºåºä¸­å±…é¦–çš„é©±åŠ¨å™¨ï¼›--append=,æŒ‡å®šå†…æ ¸å‚æ•°.è¦æŒ‡å®šå¤šä¸ªå‚æ•°,ä½¿ç”¨ç©ºæ ¼åˆ†éš”å®ƒä»¬</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>network --bootproto<span style="color:#f92672">=</span>dhcp --device<span style="color:#f92672">=</span>eth0 --onboot<span style="color:#f92672">=</span>yes --noipv6 --hostname<span style="color:#f92672">=</span>CentOS6
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šipåœ°å€ä¸ºdhcpåˆ†å‘ï¼Œç½‘å¡eth0å¯åŠ¨ï¼Œæ˜¯å¦åœ¨å¼•å¯¼æ—¶å¯ç”¨è¯¥è®¾å¤‡ï¼Œç¦ç”¨æ­¤è®¾å¤‡çš„IPv6å®‰è£…çš„ç³»ç»Ÿçš„ä¸»æœºå</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>timezone --utc Asia/Shanghai
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®ç³»ç»Ÿæ—¶åŒº</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>authconfig --enableshadow --passalgo<span style="color:#f92672">=</span>sha512
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç³»ç»Ÿè®¤è¯ä¿¡æ¯ï¼Œè®¾ç½®å¯†ç åŠ å¯†æ–¹å¼ä¸ºsha512 å¯ç”¨shadowæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rootpw --iscrypted $6$X20eRtuZhkHznTb4$dK0BJByOSAWSDD8jccLVFz0CscijS9ldMWwpoCw/ZE
</span></span><span style="display:flex;"><span>jYw2BTQYGWlgKsn945fFTjRC658UXjuocwJbAjVI5D6/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># rootå¯†ç </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clearpart --all â€“initlabel
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…ç©ºåˆ†åŒº</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>part /boot --fstype<span style="color:#f92672">=</span>ext4 --asprimary --size<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span>part swap --size<span style="color:#f92672">=</span><span style="color:#ae81ff">800</span>
</span></span><span style="display:flex;"><span>part / --fstype<span style="color:#f92672">=</span>ext4 --grow --asprimary --size<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --fstype=,ä¸ºåˆ†åŒºè®¾ç½®æ–‡ä»¶ç³»ç»Ÿç±»å‹.æœ‰æ•ˆçš„ç±»å‹ï¼Œ--asprimary,å¼ºè¿«æŠŠåˆ†åŒºåˆ†é…ä¸ºä¸»åˆ†åŒº,å¦åˆ™æç¤ºåˆ†åŒºå¤±è´¥ï¼Œ--size=,ä»¥MBä¸ºå•ä½çš„åˆ†åŒºæœ€å°å€¼.åœ¨æ­¤å¤„æŒ‡å®šä¸€ä¸ªæ•´æ•°å€¼,å¦‚500.ä¸è¦åœ¨æ•°å­—åé¢åŠ MB</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>firstboot â€“disable
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è´Ÿè´£ååŠ©é…ç½®redhatä¸€äº›é‡è¦çš„ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>selinux --disabled
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>firewall â€“disabled
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å…³é—­selinuxã€é˜²ç«å¢™</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logging --level<span style="color:#f92672">=</span>info
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®æ—¥å¿—çº§åˆ«</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>reboot
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾å®šå®‰è£…å®Œæˆåé‡å¯,æ­¤é€‰é¡¹å¿…é¡»å­˜åœ¨ï¼Œä¸ç„¶kickstartæ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·æŒ‰ä»»æ„é”®åæ‰é‡æ–°å¼•å¯¼ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©haltå…³æœº</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>%packages
</span></span><span style="display:flex;"><span>@base
</span></span><span style="display:flex;"><span>@compat-libraries
</span></span><span style="display:flex;"><span>@debugging
</span></span><span style="display:flex;"><span>@development
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¦å®‰è£…çš„åŒ…ç»„</span>
</span></span><span style="display:flex;"><span>tree
</span></span><span style="display:flex;"><span>nmap
</span></span><span style="display:flex;"><span>sysstat
</span></span><span style="display:flex;"><span>lrzsz
</span></span><span style="display:flex;"><span>telnet
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¦å®‰è£…çš„è½¯ä»¶</span>
</span></span><span style="display:flex;"><span>%end</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="æ— äººå€¼å®ˆå®‰è£…ç³»ç»Ÿ">æ— äººå€¼å®ˆå®‰è£…ç³»ç»Ÿ</h4>
<ul>
<li>
<ol>
<li>æ–°å»ºä¸€ä¸ªè™šæ‹ŸæœºåŠ ç”µï¼Œå³å¯å¼€å§‹æ— äººå€¼å®ˆå®‰è£…<code>linux</code>ç³»ç»Ÿ</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Rpm</code>æ‰“åŒ…</li>
<li><code>Yum</code>ä»“åº“</li>
</ul>
<p><a href="#R-image-1e130552ab5d481120c87590c3429e8f" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/configure.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1e130552ab5d481120c87590c3429e8f"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/configure.png"></a>
<a href="#R-image-5f79dfb04432f0e85178b1ea447969a9" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Retrieving.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5f79dfb04432f0e85178b1ea447969a9"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Retrieving.png"></a>
<a href="#R-image-0c69170101251be3cb48a33d3498ac33" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Packages.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0c69170101251be3cb48a33d3498ac33"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Deploy_Server/Packages.png"></a></p>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="jdk">JDK</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of JDK</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_jdk_and_jar_run">Install_Jdk_And_Jar_Run</h1>

<h2 id="å®‰è£…jdk">å®‰è£…<code>JDK</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>JDK</code></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.oracle.com/java/technologies/oracle-java-archive-downloads.html" rel="external" target="_self"><code>Oracle Java</code>å­˜æ¡£</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://repo.huaweicloud.com/java/jdk/" rel="external" target="_self">åä¸º<code>JDK</code>æº</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://arthas.aliyun.com/" rel="external" target="_self"><code>Java</code>åº”ç”¨è¯Šæ–­åˆ©å™¨</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://juejin.cn/post/6973808359614971918" rel="external" target="_self">è¿ç»´ï¼šä½ ä»¬<code>JAVA</code>æœåŠ¡æ€ä¹ˆåˆåˆåˆåˆå‡ºé—®é¢˜äº†ï¼å†…å­˜é™ä¸ä¸‹æ¥</a></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install wget
</span></span><span style="display:flex;"><span>$ wget -P /usr/local/src/ http://83.103.170.157/apps/java/jdk_1.8/jdk/jdk-8u202-linux-x64.tar.gz
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/jdk-8u202-linux-x64.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/src/jdk1.8.0_202 /usr/local/jdk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;#######  	JDKç’°å¢ƒè®Šæ•¸  	############
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JAVA_HOME=/usr/local/jdk
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JRE_HOME=</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/jre
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export CLASSPATH=</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/lib:</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/lib/tools.jar
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=</span><span style="color:#e6db74">${</span>PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/bin:</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/jre/bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>&gt;&gt; /etc/profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ source /etc/profile</span></span></code></pre></div></blockquote>
<hr>
<h2 id="jaråŒ…å¯åŠ¨"><code>jar</code>åŒ…å¯åŠ¨</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å‘½ä»¤å¯åŠ¨<!-- raw HTML omitted --><code>Jar</code><!-- raw HTML omitted -->åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å°†Spring bootå®‰è£…ä¸ºLinuxæœåŠ¡å¯åŠ¨ ä½¿jaråŒ…å¯ä»¥ç›´æ¥è¿è¡Œ,åé¢åšè½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>$ ln -s /opt/lucky/jdk/bin/java /sbin/java
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆæƒæŒ‡å®šç”¨æˆ·å¯ä»¥è¿è¡ŒjaråŒ…</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alias kg-business-anchor-backstage=&#39;sudo /etc/init.d/kg-business-anchor-backstage&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alias kg-business-anchor-player=&#39;sudo /etc/init.d/kg-business-anchor-player&#39; &#34;</span>&gt;&gt;/home/myadmin/.bashrc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ll /etc/init.d/  	<span style="color:#75715e"># è½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>lrwxrwxrwx  <span style="color:#ae81ff">1</span> root root    <span style="color:#ae81ff">64</span> Mar <span style="color:#ae81ff">12</span> 14:49 kg-business-anchor-backstage -&gt; /opt/webapps/hsperfdata_ksadmin/kg-business-anchor-backstage.jar
</span></span><span style="display:flex;"><span>lrwxrwxrwx  <span style="color:#ae81ff">1</span> root root    <span style="color:#ae81ff">61</span> Mar <span style="color:#ae81ff">12</span> 14:49 kg-business-anchor-player -&gt; /opt/webapps/hsperfdata_ksadmin/kg-business-anchor-player.jar</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è„šæœ¬å¯åŠ¨<!-- raw HTML omitted --><code>Jar</code><!-- raw HTML omitted -->åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;java.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd `dirname $0`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CUR_SHELL_DIR=`pwd`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CUR_SHELL_NAME=`basename ${BASH_SOURCE}`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹è¿™é‡ŒjaråŒ…åå³å¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">JAR_NAME=&#34;red_admin-1.0.0-SNAPSHOT.jar&#34;  	# ä¿®æ”¹ä¸ºå¯¹åº”è¿è¡ŒjaråŒ…
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">JAR_PATH=$CUR_SHELL_DIR/$JAR_NAME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># JAVA_MEM_OPTS=&#34; -server -Xms1024m -Xmx1024m -XX:PermSize=128m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">JAVA_MEM_OPTS=&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SPRING_PROFILES_ACTIV=&#34;-Dspring.profiles.active=eureka2&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SPRING_PROFILES_ACTIV=&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LOG_DIR=$CUR_SHELL_DIR/log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LOG_PATH=$LOG_DIR/${JAR_NAME}.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo_help()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    echo -e &#34;syntax: sh $CUR_SHELL_NAME start|stop&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ -z $1 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    echo_help
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -d &#34;$LOG_DIR&#34; ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    mkdir &#34;$LOG_DIR&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -f &#34;$LOG_PATH&#34; ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    touch &#34;$LOG_DIR&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ &#34;$1&#34; == &#34;start&#34; ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># check server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    PIDS=`ps --no-heading -C java -f --width 1000 | grep $JAR_NAME | awk &#39;{print $2}&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    if [ -n &#34;$PIDS&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo -e &#34;ERROR: The $JAR_NAME already started and the PID is ${PIDS}.&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;Starting the $JAR_NAME...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # start
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    nohup java $JAVA_MEM_OPTS -jar $SPRING_PROFILES_ACTIV $JAR_PATH &gt;&gt; $LOG_PATH 2&gt;&amp;1 &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    COUNT=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    while [ $COUNT -lt 1 ]; do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        sleep 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        COUNT=`ps  --no-heading -C java -f --width 1000 | grep &#34;$JAR_NAME&#34; | awk &#39;{print $2}&#39; | wc -l`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        if [ $COUNT -gt 0 ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            break
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    PIDS=`ps  --no-heading -C java -f --width 1000 | grep &#34;$JAR_NAME&#34; | awk &#39;{print $2}&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    echo &#34;${JAR_NAME} Started and the PID is ${PIDS}.&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    echo &#34;You can check the log file in ${LOG_PATH} for details.&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">elif [ &#34;$1&#34; == &#34;stop&#34; ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    PIDS=`ps --no-heading -C java -f --width 1000 | grep $JAR_NAME | awk &#39;{print $2}&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    if [ -z &#34;$PIDS&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#34;ERROR:The $JAR_NAME does not started!&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -e &#34;Stopping the $JAR_NAME...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for PID in $PIDS; do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        kill $PID &gt; /dev/null 2&gt;&amp;1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    COUNT=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    while [ $COUNT -lt 1 ]; do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        sleep 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        COUNT=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        for PID in $PIDS ; do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            PID_EXIST=`ps --no-heading -p $PID`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            if [ -n &#34;$PID_EXIST&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                COUNT=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                break
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    echo -e &#34;${JAR_NAME} Stopped and the PID is ${PIDS}.&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    echo_help
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="tomcaté…ç½®è°ƒæ•´"><code>Tomcat</code>é…ç½®è°ƒæ•´</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸º<!-- raw HTML omitted --><code>Tomcat</code><!-- raw HTML omitted -->æŒ‡å®š<!-- raw HTML omitted --><code>JDK</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim bin/setclasspath.sh  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨è„šæœ¬å¼€å¤´çš„åœ°æ–¹æŒ‡å®šJAVA_HOMEå’ŒJRE_HOME  </span>
</span></span><span style="display:flex;"><span>export JAVA_HOME<span style="color:#f92672">=</span>/usr/local/jdk1.8.0_40
</span></span><span style="display:flex;"><span>export JRE_HOME<span style="color:#f92672">=</span>/usr/local/jdk1.8.0_40/jre</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸º<!-- raw HTML omitted --><code>Tomcat</code><!-- raw HTML omitted -->è®¾ç½®å†…å­˜å¤§å°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim bin/catalina.sh  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tomcatè®¾ç½®å†…å­˜ä¸º8G</span>
</span></span><span style="display:flex;"><span>JAVA_OPTS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-server -Xms8192M -Xmx8192M -XX:PermSize=256M -XX:MaxPermSize=256M&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tomcatè®¾ç½®å†…å­˜ä¸º4G</span>
</span></span><span style="display:flex;"><span>JAVA_OPTS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-server -Xms4096M -Xmx4096M -XX:PermSize=256M -XX:MaxPermSize=256M&#34;</span></span></span></code></pre></div><p><a href="#R-image-4f43b9fa730bb895b6090932aa7d5354" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Tomcat_Server/Snipaste_2022-08-12_13-52-02.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4f43b9fa730bb895b6090932aa7d5354"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Tomcat_Server/Snipaste_2022-08-12_13-52-02.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>maven</code><!-- raw HTML omitted -->æ‰“æˆ<!-- raw HTML omitted --><code>war</code><!-- raw HTML omitted -->åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mvn clean install 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mvn clean package -Dmaven.test.skip<span style="color:#f92672">=</span>true</span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="jenkins">Jenkins</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Jenkins</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_jenkins">Use_Jenkins</h1>

<h2 id="é…ç½®jenkins">é…ç½®<code>Jenkins</code></h2>
<h3 id="å‡çº§jenkins">å‡çº§<code>Jenkins</code></h3>
<blockquote>
<ul>
<li>å®šä½<code>jenkins.war</code>åŒ…æ‰€åœ¨ç›®å½•</li>
</ul>
<blockquote>
<ul>
<li><a href="https://zeyangli.github.io/" rel="external" target="_self"><code>Jenkins</code>å®è·µæ–‡æ¡£</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ps -ef|grep jenkins  	<span style="color:#75715e"># å®šä½jenkins.waråŒ…æ‰€åœ¨ç›®å½•</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">1773</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">1</span> 09:06 ?        00:03:00 /usr/local/jdk1.8.0_221/bin/java -Djava.awt.headless<span style="color:#f92672">=</span>true -DJENKINS_HOME<span style="color:#f92672">=</span>/var/lib/jenkins -jar /usr/lib/jenkins/jenkins.war --logfile<span style="color:#f92672">=</span>/var/log/jenkins/jenkins.log --webroot<span style="color:#f92672">=</span>/var/cache/jenkins/war --httpPort<span style="color:#f92672">=</span><span style="color:#ae81ff">8080</span> --debug<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> --handlerCountMax<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span> --handlerCountMaxIdle<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd /usr/lib/jenkins/
</span></span><span style="display:flex;"><span>$ systemctl stop jenkins  	<span style="color:#75715e"># åœæ­¢Jenkins</span>
</span></span><span style="display:flex;"><span>$ mv jenkins.war jenkins.war.bak  	<span style="color:#75715e"># å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>$ wget -P /usr/lib/jenkins/ http://mirrors.jenkins.io/war-stable/latest/jenkins.war
</span></span><span style="display:flex;"><span>$ systemctl start jenkins</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="æ±‰åŒ–jenkins">æ±‰åŒ–<code>Jenkins</code></h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç™»å½•<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->é¡µé¢é€‰æ‹©ï¼š<!-- raw HTML omitted --><code>Manage Jenkins</code>â†’<code>Manage Plugins</code></li>
</ul>
<blockquote>
<p><a href="#R-image-e50e7f23ebdd77f4359ee2eec2b27750" class="lightbox-link"><img alt="é€‰æ‹©æ’ä»¶" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_18-55-47.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e50e7f23ebdd77f4359ee2eec2b27750"><img alt="é€‰æ‹©æ’ä»¶" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_18-55-47.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨æœç´¢æ¡†æœç´¢ï¼š<!-- raw HTML omitted --><code>Locale</code><!-- raw HTML omitted -->é€‰æ‹©å®‰è£…å¹¶é‡å¯<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->é¡µé¢<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>Local</code>ï¼š<code>Configure System</code><!-- raw HTML omitted -->(ç³»ç»Ÿè®¾ç½®)â†’<!-- raw HTML omitted --><code> Locale</code><!-- raw HTML omitted -->(è¯­è¨€è®¾ç½®)â†’<!-- raw HTML omitted --><code>en_US</code><!-- raw HTML omitted -->(è‹±æ–‡)ã€<!-- raw HTML omitted --><code>zh_CN</code><!-- raw HTML omitted -->(ä¸­æ–‡)<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-2162ea5ae2a5484ece57b241b7116d6a" class="lightbox-link"><img alt="å®‰è£…æ±‰åŒ–æ’ä»¶" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_18-57-40.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2162ea5ae2a5484ece57b241b7116d6a"><img alt="å®‰è£…æ±‰åŒ–æ’ä»¶" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_18-57-40.png"></a></p>
</blockquote>
</blockquote>
<hr>
<h3 id="é…ç½®åŸŸå">é…ç½®åŸŸå</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶æ–¹ä¾¿ä½¿ç”¨åŸŸåè®¿é—®<!-- raw HTML omitted --><code>Jenkins</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/local/nginx/conf/vhosts/jenkins.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> listen       80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server_name  jenkins.ken.io; #ç›‘å¬çš„åŸŸå
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> access_log  /var/log/nginx/jenkins.access.log main;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> error_log  /var/log/nginx/jenkins.error.log error;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> location / {  	# è½¬å‘æˆ–å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     proxy_pass http://127.0.0.1:8080; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> error_page   500 502 503 504  /50x.html;  	# é”™è¯¯é¡µ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> location = /50x.html {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     root   /usr/share/nginx/html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="æƒé™ç®¡ç†">æƒé™ç®¡ç†</h3>
<blockquote>
<ul>
<li><a href="https://blog.51cto.com/wzlinux/2160778" rel="external" target="_self">æŒç»­é›†æˆä¹‹<code>Jenkins</code>é…ç½®åŸºäºè§’è‰²çš„é¡¹ç›®æƒé™ç®¡ç†(äº”)</a></li>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->æƒé™ç®¡ç†<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Jenkins</code><!-- raw HTML omitted -->å…¨å±€å®‰è£…é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç³»ç»Ÿç®¡ç†â†’æ’ä»¶ç®¡ç†â†’å®‰è£…æ’ä»¶:<!-- raw HTML omitted --><code>Role-based Authorization Strategy</code></li>
</ul>
<blockquote>
<ul>
<li><code>Role-based Authorization Strategy</code></li>
<li><code>Matrix Authorization Strategy</code></li>
<li><code>Authorize Project</code></li>
</ul>
<p><a href="#R-image-6f5eec598c26ddc96d604da5e258a474" class="lightbox-link"><img alt="æœç´¢Role-based Authorization Strategy" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-18-26.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6f5eec598c26ddc96d604da5e258a474"><img alt="æœç´¢Role-based Authorization Strategy" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-18-26.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ç³»ç»Ÿç®¡ç†â†’å…¨å±€å®‰å…¨é…ç½®å‹¾é€‰:<!-- raw HTML omitted --><code>Role-Based Strategy</code></li>
</ul>
<blockquote>
<p><a href="#R-image-64d6f9974e1e81dd89682c586e590fe4" class="lightbox-link"><img alt="é€‰æ‹©å…¨å±€å®‰è£…é…ç½®" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-22-20.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-64d6f9974e1e81dd89682c586e590fe4"><img alt="é€‰æ‹©å…¨å±€å®‰è£…é…ç½®" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-22-20.png"></a></p>
<p><a href="#R-image-b0e51817f8f84b7a200b251da9f236ee" class="lightbox-link"><img alt="é€‰æ‹©ï¼šRole-Based Strategy" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-24-08.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b0e51817f8f84b7a200b251da9f236ee"><img alt="é€‰æ‹©ï¼šRole-Based Strategy" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-24-08.png"></a></p>
</blockquote>
</blockquote>
<ul>
<li><code>Jenkisn</code><!-- raw HTML omitted -->è§’è‰²åˆ†é…æƒé™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç³»ç»Ÿç®¡ç†â†’ç®¡ç†å’Œåˆ†é…è§’è‰²ï¼š<!-- raw HTML omitted --><code>Manage and Assign Roles</code></li>
</ul>
<blockquote>
<p><a href="#R-image-acfcda11168babe71d33da807dba2058" class="lightbox-link"><img alt="é…ç½®Manage and Assign Roles" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-29-36.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-acfcda11168babe71d33da807dba2058"><img alt="é…ç½®Manage and Assign Roles" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-29-36.png"></a></p>
<p><a href="#R-image-9566661f814994dc78e9af7bd31cc2a6" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-31-29.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9566661f814994dc78e9af7bd31cc2a6"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-31-29.png"></a></p>
</blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å…ˆé…ç½®ï¼š ç®¡ç†è§’è‰²<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-e0a00ba15bb94ec62fb13edee56347cb" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-34-09.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e0a00ba15bb94ec62fb13edee56347cb"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-34-09.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ <!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->å…¨å±€é¡¹ç›®è§’è‰²<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-f30b6f1bd7fa68fff1ab6903f2d0d249" class="lightbox-link"><img alt="å…¨å±€è§’è‰²" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-38-52.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f30b6f1bd7fa68fff1ab6903f2d0d249"><img alt="å…¨å±€è§’è‰²" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-38-52.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ <!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->é¡¹ç›®è§’è‰²<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>Role</code><!-- raw HTML omitted -->ä»£è¡¨è§†å›¾<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Pattern</code><!-- raw HTML omitted -->ä»£è¡¨è§†å›¾ä¸‹<!-- raw HTML omitted --><code>test*</code><!-- raw HTML omitted -->çš„ä»»åŠ¡åç§°<!-- raw HTML omitted --></p>
</li>
</ul>
<p><a href="#R-image-f45bdde26abdd07948c928b57959d337" class="lightbox-link"><img alt="é¡¹ç›®è§’è‰²" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-46-24.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f45bdde26abdd07948c928b57959d337"><img alt="é¡¹ç›®è§’è‰²" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-46-24.png"></a></p>
</blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ç»™<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->è§’è‰²åˆ†é…æ‰§è¡Œæƒé™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-e9642ba965ea2d20c2a2c417c76a95ad" class="lightbox-link"><img alt="è§’è‰²åˆ†é…" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-54-57.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e9642ba965ea2d20c2a2c417c76a95ad"><img alt="è§’è‰²åˆ†é…" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-54-57.png"></a></p>
<ul>
<li><code>Jenkins</code><!-- raw HTML omitted -->å…¨å±€è§’è‰²<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-884f846f08ca96846b016ded3372829d" class="lightbox-link"><img alt="åˆ†é…å…¨å±€è§’è‰²" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-58-06.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-884f846f08ca96846b016ded3372829d"><img alt="åˆ†é…å…¨å±€è§’è‰²" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-58-06.png"></a></p>
</blockquote>
<ul>
<li><code>Jenkins</code><!-- raw HTML omitted -->é¡¹ç›®è§’è‰²<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-c7b6720a2fd309ffd6d3c3d0583003ec" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_20-02-46.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c7b6720a2fd309ffd6d3c3d0583003ec"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_20-02-46.png"></a></p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<hr>
<h3 id="jenkinsé…ç½®é‚®ç®±"><code>Jenkins</code>é…ç½®é‚®ç®±</h3>
<blockquote>
<ul>
<li><a href="#R-image-ddf9dd9955dd8302f83375e5513753b5" class="lightbox-link"><img alt="é…ç½®Jenkinsé‚®ç®±" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_22-57-50.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ddf9dd9955dd8302f83375e5513753b5"><img alt="é…ç½®Jenkinsé‚®ç®±" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_22-57-50.png"></a></li>
</ul>
</blockquote>
<hr>
<h3 id="jenkinsæœåŠ¡å™¨é…ç½®"><code>Jenkins</code>æœåŠ¡å™¨é…ç½®</h3>
<h4 id="é…ç½®sshç®¡ç†æœåŠ¡å™¨">é…ç½®<code>ssh</code>ç®¡ç†æœåŠ¡å™¨</h4>
<blockquote>
<ul>
<li><code>Jenkins</code><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>ssh</code><!-- raw HTML omitted -->ç®¡ç†æœåŠ¡å™¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æœç´¢<!-- raw HTML omitted --><code>ssh</code><!-- raw HTML omitted -->æ’ä»¶ï¼šç³»ç»Ÿç®¡ç†â†’æ’ä»¶ç®¡ç†â†’æœç´¢ï¼š<!-- raw HTML omitted --><code>Publish Over SSH</code></li>
</ul>
<blockquote>
<p><a href="#R-image-62d57b2047c3f993d94753be4b0269bd" class="lightbox-link"><img alt="æœç´¢sshæ’ä»¶" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_21-03-45.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-62d57b2047c3f993d94753be4b0269bd"><img alt="æœç´¢sshæ’ä»¶" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_21-03-45.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>ssh</code><!-- raw HTML omitted -->æ’ä»¶ï¼šç³»ç»Ÿç®¡ç†â†’ç³»ç»Ÿé…ç½®â†’<!-- raw HTML omitted --><code>Publish over SSH</code>â†’<code>SSH Servers</code></li>
</ul>
<blockquote>
<p><a href="#R-image-28ec2ba6227e2cdd3c531e3a449f63e9" class="lightbox-link"><img alt="é…ç½®Publish over SSHæ’ä»¶" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_21-32-37.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-28ec2ba6227e2cdd3c531e3a449f63e9"><img alt="é…ç½®Publish over SSHæ’ä»¶" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_21-32-37.png"></a></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<h4 id="é…ç½®ansibleç®¡ç†æœåŠ¡å™¨">é…ç½®<code>ansible</code>ç®¡ç†æœåŠ¡å™¨</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>ansible</code><!-- raw HTML omitted -->å®ç°å…å¯†ç™»å½•ä»¥ä¾¿<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->æ‰¹é‡å¤„ç†<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç”Ÿæˆå¯†é’¥å¯¹ï¼Œæ‹·è´å…¬é’¥åˆ°ç›®éƒ¨ä¸»æœº<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/bin/sed -i <span style="color:#e6db74">&#34;/host_key_checking/a\\host_key_checking = false&#34;</span> /etc/ansible/ansible.cfg  	<span style="color:#75715e"># å…³é—­ä¸»æœºå¯†é’¥æ£€æŸ¥</span>
</span></span><span style="display:flex;"><span>$ sudo su -s /bin/bash jenkins  	<span style="color:#75715e"># å¦‚æœJenkinsç”¨æˆ·ä¸æ˜¯rootéœ€è¦åˆ‡æ¢ç”¨æˆ·  </span>
</span></span><span style="display:flex;"><span>$ ssh-keygen  	<span style="color:#75715e"># ç”Ÿæˆå¯†é’¥å¯¹  </span>
</span></span><span style="display:flex;"><span>$ ssh-copy-id root@<span style="color:#e6db74">&#34;ç›®æ ‡IP&#34;</span>  	<span style="color:#75715e"># æ‹·è´å…¬é’¥åˆ°ç›®æ ‡ä¸»æœº  </span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Ansible</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>hosts</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/ansible/hosts<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">console # è‡ªå®šä¹‰åç§°ï¼Œ  ansible_ssh_user=root # ç”¨æˆ·ï¼Œ ansible_ssh_pass=&#34;a&#34; # å¯†ç ï¼Œansible_ssh_port=22 # ç«¯å£ï¼Œ ansible_ssh_host=192.168.1.1 # ç›®éƒ¨ä¸»æœºIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç™»å½•<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->é¡µé¢ï¼Œåˆ°æ’ä»¶ç®¡ç†ç•Œé¢æœç´¢å®‰è£…<!-- raw HTML omitted --><code>Ansible</code><!-- raw HTML omitted -->æ’ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-5ee36a8ff859c3232c46a6505f2705e2" class="lightbox-link"><img alt="æœç´¢å®‰è£…<code>ansible</code>æ’ä»¶" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-06-12.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5ee36a8ff859c3232c46a6505f2705e2"><img alt="æœç´¢å®‰è£…<code>ansible</code>æ’ä»¶" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-06-12.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…å¥½<!-- raw HTML omitted --><code>Ansible</code><!-- raw HTML omitted -->æ’ä»¶åé‡å¯<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->é¡µé¢<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-3d4528436299031c2e8e66a89264c6b8" class="lightbox-link"><img alt="å®‰è£…å¥½åé‡å¯é¡µé¢" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-08-30.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3d4528436299031c2e8e66a89264c6b8"><img alt="å®‰è£…å¥½åé‡å¯é¡µé¢" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_19-08-30.png"></a></p>
</blockquote>
<ul>
<li>ä½¿ç”¨<code>Gitlab+Ansible</code>æ„å»ºé¡¹ç›®éªŒè¯<code>Ansible</code>æ˜¯å¦å¯ç”¨</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é€‰æ‹©ï¼šæ–°å»ºä»»åŠ¡â†’è¾“å…¥ä»»åŠ¡åç§°ï¼šâ†’é€‰æ‹©ï¼šæ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®â†’ç‚¹å‡»ï¼šç¡®è®¤<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-3893488d538885dd46bfab6a5f2dfd87" class="lightbox-link"><img alt="åˆ›å»ºä»»åŠ¡" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_21-54-08.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3893488d538885dd46bfab6a5f2dfd87"><img alt="åˆ›å»ºä»»åŠ¡" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_21-54-08.png"></a></p>
<ul>
<li>æ·»åŠ <code>Ansible</code>æ„å»º</li>
</ul>
<blockquote>
<p><a href="#R-image-a96ff6974ce1b77c084c2b730f78fa12" class="lightbox-link"><img alt="æ·»åŠ æ„å»ºAnsible" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_21-56-00.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a96ff6974ce1b77c084c2b730f78fa12"><img alt="æ·»åŠ æ„å»ºAnsible" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_21-56-00.png"></a></p>
</blockquote>
<ul>
<li>é…ç½®<code>Ansible</code>æ„å»º</li>
</ul>
<blockquote>
<p><a href="#R-image-29838cd7f1503b2800d597f88445f2a4" class="lightbox-link"><img alt="é…ç½®Jenkinsçš„ansible" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_22-09-30.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-29838cd7f1503b2800d597f88445f2a4"><img alt="é…ç½®Jenkinsçš„ansible" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_22-09-30.png"></a></p>
</blockquote>
<ul>
<li>æµ‹è¯•<code>Ansible</code>æ„å»º</li>
</ul>
<blockquote>
<p><a href="#R-image-728e729087deb8ee0346e11b49f2f3f5" class="lightbox-link"><img alt="æµ‹è¯•Ansibleæ„å»º" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_22-13-24.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-728e729087deb8ee0346e11b49f2f3f5"><img alt="æµ‹è¯•Ansibleæ„å»º" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_22-13-24.png"></a></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<h3 id="jenkinséƒ¨ç½²æ’ä»¶"><code>Jenkins</code>éƒ¨ç½²æ’ä»¶</h3>
<blockquote>
<ul>
<li><a href="https://plugins.jenkins.io/" rel="external" target="_self">éƒ¨ç½²æ’ä»¶</a></li>
<li><code>General</code><!-- raw HTML omitted -->â†’<!-- raw HTML omitted --><a href="https://plugins.jenkins.io/gogs-webhook/" rel="external" target="_self"><code>Gogs</code></a></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å…è®¸ç”¨æˆ·ä½¿ç”¨<!-- raw HTML omitted --><code>Gogs Webhook</code></li>
</ul>
<p><a href="#R-image-54b00bcd48cf9ecaddf67d66061b3f08" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-10-17_14-04-17.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-54b00bcd48cf9ecaddf67d66061b3f08"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-10-17_14-04-17.png"></a></p>
</blockquote>
<ul>
<li><code>General</code><!-- raw HTML omitted -->â†’<!-- raw HTML omitted --><code>This project is parameterized</code><!-- raw HTML omitted -->(å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹)â†’<!-- raw HTML omitted --><a href="https://plugins.jenkins.io/git-parameter/" rel="external" target="_self"><code>Git Parameter</code></a></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è¯¥æ’ä»¶å…è®¸æ‚¨åœ¨æ„å»ºä¸­åˆ†é…<!-- raw HTML omitted --><code>Git</code><!-- raw HTML omitted -->åˆ†æ”¯ã€æ ‡ç­¾ã€æ‹‰å–è¯·æ±‚æˆ–ä¿®è®¢å·ä½œä¸ºå‚æ•°<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-f11a4fe6019b28a4ce2e7489db785c5b" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-10-17_14-09-44.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f11a4fe6019b28a4ce2e7489db785c5b"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-10-17_14-09-44.png"></a></p>
</blockquote>
<ul>
<li><code>Build Triggers</code><!-- raw HTML omitted -->(æ„å»ºè§¦å‘å™¨)â†’å®‰è£…<!-- raw HTML omitted --><a href="https://plugins.jenkins.io/gitlab-plugin/" rel="external" target="_self"><code>GitLab Plugin</code></a><!-- raw HTML omitted -->æˆ–<!-- raw HTML omitted --><a href="https://plugins.jenkins.io/generic-webhook-trigger/" rel="external" target="_self"><code>Generic Webhook Trigger</code></a><!-- raw HTML omitted -->è‡ªåŠ¨éƒ¨ç½²æ’ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ­¤æ’ä»¶å…è®¸<!-- raw HTML omitted --><code>GitLab</code><!-- raw HTML omitted -->åœ¨æäº¤ä»£ç æˆ–æ‰“å¼€/æ›´æ–°åˆå¹¶è¯·æ±‚æ—¶è§¦å‘<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->ä¸­çš„æ„å»ºã€‚å®ƒè¿˜å¯ä»¥å°†æ„å»ºçŠ¶æ€å‘é€å›<!-- raw HTML omitted --><code>GitLab</code></li>
</ul>
<p><a href="#R-image-d906caf4046816c98948e129072ee275" class="lightbox-link"><img alt="GitLab webhook Plugin" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-25_15-36-23.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d906caf4046816c98948e129072ee275"><img alt="GitLab webhook Plugin" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-25_15-36-23.png"></a></p>
</blockquote>
<ul>
<li><code>Build Environment</code><!-- raw HTML omitted -->(æ„å»ºç¯å¢ƒ)â†’<!-- raw HTML omitted --><a href="https://plugins.jenkins.io/ansicolor/" rel="external" target="_self"><code>AnsiColor</code></a></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è¿™ä¸ªæ’ä»¶å¢åŠ äº†å¯¹æ ‡å‡†<!-- raw HTML omitted --><code>ANSI</code><!-- raw HTML omitted -->è½¬ä¹‰åºåˆ—çš„æ”¯æŒï¼ŒåŒ…æ‹¬é¢œè‰²ï¼Œåˆ°æ§åˆ¶å°è¾“å‡ºã€‚ è¯¥æ’ä»¶å¯<!-- raw HTML omitted --><a href="http://repo.jenkins-ci.org/releases/org/jenkins-ci/plugins/ansicolor/" rel="external" target="_self">åœ¨æ­¤å¤„</a><!-- raw HTML omitted -->è·å¾—ï¼Œå¹¶ä¸”åœ¨<!-- raw HTML omitted --><code>Jenkins Wiki</code><!-- raw HTML omitted -->ä¸Šæœ‰<!-- raw HTML omitted --><a href="https://wiki.jenkins-ci.org/display/JENKINS/AnsiColor+Plugin" rel="external" target="_self">ä¸€ä¸ªé¡µé¢</a></li>
</ul>
<p><a href="#R-image-d79ce131beb62c0ba0c8fcf3a3e080cf" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-10-17_14-16-21.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d79ce131beb62c0ba0c8fcf3a3e080cf"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-10-17_14-16-21.png"></a></p>
</blockquote>
<ul>
<li><code>Build Environment</code><!-- raw HTML omitted -->(æ„å»ºç¯å¢ƒ)â†’<!-- raw HTML omitted --><a href="https://plugins.jenkins.io/build-user-vars-plugin/" rel="external" target="_self"><code>Set jenkins user build variables</code></a></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æè¿°å¯åŠ¨æ„å»ºçš„ç”¨æˆ·çš„ä¸€ç»„<strong>ç¯å¢ƒå˜é‡</strong><!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-3a56f8034caf559dab374081754c7dbb" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-10-17_14-24-17.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3a56f8034caf559dab374081754c7dbb"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-10-17_14-24-17.png"></a></p>
</blockquote>
<ul>
<li><code>Post-build Actions</code><!-- raw HTML omitted -->(æ„å»ºåæ“ä½œ)â†’<!-- raw HTML omitted --><a href="https://plugins.jenkins.io/postbuild-task/" rel="external" target="_self"><code>Post build task</code></a></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ­¤åŠŸèƒ½å…è®¸ç”¨æˆ·å…³è”<!-- raw HTML omitted --><code>shell</code><!-- raw HTML omitted -->æˆ–æ‰¹å¤„ç†è„šæœ¬ï¼Œè¿™äº›è„šæœ¬æ ¹æ®æ„å»ºæ—¥å¿—è¾“å‡ºåœ¨<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->ä¸Šæ‰§è¡ŒæŸäº›ä»»åŠ¡ã€‚å¦‚æœæ—¥å¿—æ–‡æœ¬åœ¨æ„å»ºæ—¥å¿—æ–‡ä»¶ä¸­çš„æŸä¸ªä½ç½®åŒ¹é…ï¼Œåˆ™è„šæœ¬å°†æ‰§è¡Œå¹¶ä¸”æ„å»ºåæ—¥å¿—å°†é™„åŠ åˆ°é¡¹ç›®æ„å»ºæ—¥å¿—ä¸­ã€‚å…è®¸ä½¿ç”¨<!-- raw HTML omitted --><code>Java</code><!-- raw HTML omitted -->æ­£åˆ™è¡¨è¾¾å¼<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-584dc72815d615f1885086e40ae7076b" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-10-17_14-46-20.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-584dc72815d615f1885086e40ae7076b"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-10-17_14-46-20.png"></a></p>
</blockquote>
</blockquote>
<hr>
<h3 id="jenkinså›æ»šæ’ä»¶"><code>Jenkins</code>å›æ»šæ’ä»¶</h3>
<blockquote>
<ul>
<li><code>General</code><!-- raw HTML omitted -->â†’<!-- raw HTML omitted --><code>This project is parameterized</code><!-- raw HTML omitted -->(å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹)â†’<!-- raw HTML omitted --><a href="https://plugins.jenkins.io/uno-choice/" rel="external" target="_self"><code>Active Choices</code></a></li>
</ul>
<blockquote>
<ul>
<li><code>Active Choices</code><!-- raw HTML omitted -->æ’ä»¶ç”¨äºå‚æ•°åŒ–çš„è‡ªç”±å¼<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->ä½œä¸šï¼Œä»¥åˆ›å»º<strong>è„šæœ¬åŒ–ã€åŠ¨æ€å’Œäº¤äº’å¼ä½œä¸šå‚æ•°</strong>ã€‚<!-- raw HTML omitted --><code>Active Choices</code><!-- raw HTML omitted --><strong>å‚æ•°</strong>å¯ä»¥<strong>åŠ¨æ€æ›´æ–°</strong>ï¼Œå¹¶ä¸”å¯ä»¥<strong>å‘ˆç°ä¸ºç»„åˆæ¡†ã€å¤é€‰æ¡†ã€å•é€‰æŒ‰é’®æˆ–ä¸°å¯Œçš„<code>HTML UI</code>å°éƒ¨ä»¶</strong>ã€‚<!-- raw HTML omitted --><code>Active Choices</code>å‚æ•°ä½¿ç”¨<code>Groovy</code>æˆ–ï¼ˆå¯é€‰ï¼‰<code>Scriptler Groovy</code>è„šæœ¬ç¼–å†™è„šæœ¬ã€‚è¿™äº›è‡ªå®šä¹‰è„šæœ¬æ”¯æŒä½¿ç”¨<code>Jenkins Java API</code><!-- raw HTML omitted -->ã€ç³»ç»Ÿç¯å¢ƒå˜é‡ã€å…¨å±€èŠ‚ç‚¹å±æ€§ä»¥åŠæ½œåœ¨çš„å¤–éƒ¨<code>Java</code>å’Œ<code>Javascript</code>åº“<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-4a5003621e9952b267ca544d8049c48a" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-10-17_15-17-51.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4a5003621e9952b267ca544d8049c48a"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-10-17_15-17-51.png"></a></p>
</blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_jenkins">Install_Jenkins</h1>

<h2 id="jenkinså®‰è£…"><code>Jenkins</code>å®‰è£…</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.jenkins.io/doc/book/installing/" rel="external" target="_self"><code>Jenkins</code>å®‰è£…ä¸å‡çº§</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.jenkins.io/doc/book/installing/linux/#red-hat-centos" rel="external" target="_self">å®˜æ–¹æ–‡æ¡£</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->äº‹å…ˆæœ€å¥½å®‰è£…ï¼š<!-- raw HTML omitted --><code>jdk-8u221</code><!-- raw HTML omitted -->ä»¥ä¸Šç‰ˆæœ¬ï¼Œæœ€æ–°ç‰ˆæœ¬éœ€è¦<!-- raw HTML omitted --><code>Java 11</code><!-- raw HTML omitted -->å¹¶ä¸”é…ç½®å¥½ç¯å¢ƒå˜é‡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><a href="https://repo.huaweicloud.com/java/jdk/" rel="external" target="_self"><code>Huawei Java</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;######### JDKç¯å¢ƒå˜é‡  #######
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JAVA_HOME=/usr/local/jdk
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JRE_HOME=</span>$JAVA_HOME<span style="color:#e6db74">/jre
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export CLASSPATH=</span>$JAVA_HOME<span style="color:#e6db74">/lib:</span>$JAVA_HOME<span style="color:#e6db74">/lib/tools.jar
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=</span>$PATH<span style="color:#e6db74">:</span>$JAVA_HOME<span style="color:#e6db74">/bin:</span>$JAVA_HOME<span style="color:#e6db74">/jre/bin &#34;</span>&gt;&gt;/etc/profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ source /etc/profile
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/jdk/bin/java /usr/bin/java  	<span style="color:#75715e"># éœ€è¦æ·»åŠ è½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install avahi-libs copy-jdk-configs cups-libs fontconfig giflib <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>javapackages-tools libICE libSM libX11 libX11-common <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>libXau libXext libXi libXrender libXtst libfontenc <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>libjpeg-turbo libxcb libxslt lksctp-tools pcsc-lite-libs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>python-javapackages python-lxml ttmkfdir tzdata-java <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>xorg-x11-font-utils xorg-x11-fonts-Type1</span></span></code></pre></div></blockquote>
<ul>
<li><code>yum</code><!-- raw HTML omitted -->æ–¹å¼éƒ¨ç½²<!-- raw HTML omitted --><code>Jenkins</code></li>
</ul>
<blockquote>
<ul>
<li><a href="https://pkg.jenkins.io/" rel="external" target="_self"><code>Jenkins</code>å†å²ç‰ˆæœ¬</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install jenkins</span></span></code></pre></div></blockquote>
<ul>
<li><code>rpm</code><!-- raw HTML omitted -->æ–¹å¼éƒ¨ç½²<!-- raw HTML omitted --><code>Jenkins</code></li>
</ul>
<blockquote>
<ul>
<li><a href="https://pkg.jenkins.io/redhat-stable-rc/" rel="external" target="_self"><code>Jenkins</code>ç¨³å®šç‰ˆ<code>rpm</code>å®‰è£…åŒ…</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y ca-certificates
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget https://pkg.jenkins.io/redhat/jenkins-2.219-1.1.noarch.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ rpm -ivh jenkins-2.156-1.1.noarch.rpm</span></span></code></pre></div></blockquote>
<ul>
<li><code>war</code><!-- raw HTML omitted -->æ–¹å¼éƒ¨ç½²å¯åŠ¨<!-- raw HTML omitted --><code>Jenkins</code></li>
</ul>
<blockquote>
<ul>
<li><a href="https://get.jenkins.io/war-stable/" rel="external" target="_self"><code>Jenkins</code>å†å²<code>war</code>åŒ…</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://get.jenkins.io/war-stable/2.319.3/jenkins.war
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ java -jar jenkins.war --httpPort<span style="color:#f92672">=</span><span style="color:#ae81ff">8080</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é€šè¿‡<!-- raw HTML omitted --><code>Docker</code><!-- raw HTML omitted -->éƒ¨ç½²<!-- raw HTML omitted --><code>Jenkins</code></li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.jenkins.io/doc/book/installing/docker/" rel="external" target="_self"><code>docker</code>éƒ¨ç½²<code>Jenkins</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -d --name jenkins <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p 18090:8080 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-p 50000:50000 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v /opt/jenkins/data:/var/jenkins_home <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v /var/run/docker.sock:/var/run/docker.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--user root <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>jenkins/jenkins:jdk11</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>docker-compose</code><!-- raw HTML omitted -->æ„å»ºå¯åŠ¨<!-- raw HTML omitted --><code>Jenkins</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/docker-compose/jenkins/docker-compose.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">version: &#34;3&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">services:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  jenkins:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    hostname: &#39;jenkins&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    container_name: jenkins  # å¯åŠ¨ååç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    image: &#39;jenkins/jenkins:jdk11&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    restart: always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    environment:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      TZ: Asia/Shanghai
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;18090:8080&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;50000:50000&#39;  	# enkins-slave-agentæœåŠ¡ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    volumes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;/opt/apps/jenkins:/var/jenkins_home&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;/var/run/docker.sock:/var/run/docker.sock&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="ä¿®æ”¹jenkinsé…ç½®">ä¿®æ”¹<code>Jenkins</code>é…ç½®</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹å¯åŠ¨è„šæœ¬ï¼šåœ¨<!-- raw HTML omitted --><code>candidates=&quot; </code><!-- raw HTML omitted -->ä¸‹æ·»åŠ <!-- raw HTML omitted --><code>jdk</code><!-- raw HTML omitted -->æ–‡ä»¶å®‰è£…è·¯å¾„<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /etc/init.d/jenkins  
</span></span><span style="display:flex;"><span>candidates<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;  	# å¤§æ¦‚åœ¨ 99 è¡Œå·¦å³
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/usr/local/jdk1.8.0_221/bin/java</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->ä¸»é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /etc/sysconfig/jenkins  
</span></span><span style="display:flex;"><span>JENKINS_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;root&#34;</span>  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºrootç”¨æˆ·  </span>
</span></span><span style="display:flex;"><span>JENKINS_PORT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;8080&#34;</span>  	<span style="color:#75715e"># ä¿®æ”¹ç›‘å¬ç«¯å£</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>/usr/lib/systemd/system/jenkins.service</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸‹ç”¨æˆ·æƒé™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /usr/lib/systemd/system/jenkins.service
</span></span><span style="display:flex;"><span>User<span style="color:#f92672">=</span>jenkins  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºroot</span>
</span></span><span style="display:flex;"><span>Group<span style="color:#f92672">=</span>jenkins  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºroot</span>
</span></span><span style="display:flex;"><span>Environment<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;JENKINS_PORT=8080&#34;</span>  	<span style="color:#75715e"># ç«¯å£ä¿®æ”¹</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->ç›®å½•æƒé™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chown -R root:root /var/lib/jenkins
</span></span><span style="display:flex;"><span>$ chown -R root:root /var/cache/jenkins
</span></span><span style="display:flex;"><span>$ chown -R root:root /var/log/jenkins</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Jenkins</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl enable jenkins <span style="color:#f92672">&amp;&amp;</span> systemctl start jenkins</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é˜²ç«å¢™è§„åˆ™æ”¾è¡Œ<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->æœåŠ¡ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ firewall-cmd --add-port<span style="color:#f92672">=</span>8080/tcp --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="æµè§ˆå™¨ç™»å½•jenkins">æµè§ˆå™¨ç™»å½•<code>Jenkins</code></h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><code>http://IP:8080</code><!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-23c04d2022478eb8c30caf1859b25b73" class="lightbox-link"><img alt="æµè§ˆå™¨è®¿é—®" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_18-14-06.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-23c04d2022478eb8c30caf1859b25b73"><img alt="æµè§ˆå™¨è®¿é—®" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_18-14-06.png"></a></p>
</blockquote>
<ul>
<li><code>docker exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword</code><!-- raw HTML omitted -->è·å–ç™»å½•å¯†ç <!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ç™»å½•åé€‰æ‹©å®‰è£…æ’ä»¶ï¼Œé»˜è®¤å³å¯<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-af0d4d9908eca3e2ae34d88db9a47adb" class="lightbox-link"><img alt="å®‰è£…æ’ä»¶" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/doc_2022-07-19_18-16-07.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-af0d4d9908eca3e2ae34d88db9a47adb"><img alt="å®‰è£…æ’ä»¶" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/doc_2022-07-19_18-16-07.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->è·³è¿‡åˆ›å»ºç”¨æˆ·ç•Œé¢<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-06a3785b8d4fb16388199c0a32279c2d" class="lightbox-link"><img alt="è·³è¿‡åˆ›å»ºç”¨æˆ·ç•Œé¢" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_18-22-54.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-06a3785b8d4fb16388199c0a32279c2d"><img alt="è·³è¿‡åˆ›å»ºç”¨æˆ·ç•Œé¢" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_18-22-54.png"></a></p>
</blockquote>
<ul>
<li><code>URL</code><!-- raw HTML omitted -->é…ç½®ç•Œé¢é€‰æ‹©ï¼šä¿å­˜å¹¶å®Œæˆ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-0ce2f458eefa2f1ab8a48aad58d7847a" class="lightbox-link"><img alt="URLé…ç½®" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_18-23-18.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0ce2f458eefa2f1ab8a48aad58d7847a"><img alt="URLé…ç½®" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_18-23-18.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->é€‰æ‹©ï¼šå¼€å§‹ä½¿ç”¨<!-- raw HTML omitted --><code>Jenkins</code><!-- raw HTML omitted -->å®‰è£…å®Œæˆ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-fd0b2ac304a3b0039338fea6b45db7e6" class="lightbox-link"><img alt="å¼€å§‹ä½¿ç”¨Jenkins" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_18-23-32.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fd0b2ac304a3b0039338fea6b45db7e6"><img alt="å¼€å§‹ä½¿ç”¨Jenkins" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jenkins_Server/Snipaste_2022-07-19_18-23-32.png"></a></p>
</blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="jumpserver">JumpServer</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of JumpServer</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_jumpserver">Use_JumpServer</h1>

<h2 id="é…ç½®jumpserver">é…ç½®<code>Jumpserver</code></h2>
<h3 id="é…ç½®nginxä»£ç†jumpserver">é…ç½®<code>Nginx</code>ä»£ç†<code>Jumpserver</code></h3>
<blockquote>
<ul>
<li><code>Nginx</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶ä»£ç†<!-- raw HTML omitted --><code>Jumpserver</code><!-- raw HTML omitted --><strong>é»˜è®¤ç”¨æˆ·åå¯†ç éƒ½æ˜¯ï¼š</strong><!-- raw HTML omitted --><code>admin</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/local/nginx/conf/vhosts/jumpserver.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> listen 80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server_name jumpserver.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     client_max_body_size 50m;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     proxy_redirect off;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     proxy_http_version 1.1;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     proxy_set_header Host $host;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     proxy_set_header X-Real-IP $remote_addr;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     proxy_set_header Upgrade $http_upgrade;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     proxy_set_header Connection &#34;upgrade&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     proxy_pass http://127.0.0.1:8888;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     index index.html index.htm;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> error_page 404 http://jumpserver.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> access_log  /usr/local/nginx/logs/jumpserver-access.log  main;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> error_log   /usr/local/nginx/logs/jumpserver-error.log  info;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="é…ç½®jumpserveré…ç½®æ–‡ä»¶">é…ç½®<code>Jumpserver</code>é…ç½®æ–‡ä»¶</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹ä¸Šä¼ é»˜è®¤ç›®å½•ä¸ºï¼š<!-- raw HTML omitted --><code>/tmp</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/koko-2.24.2/config_example.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é¡¹ç›®åç§°, ä¼šç”¨æ¥å‘Jumpserveræ³¨å†Œ, è¯†åˆ«è€Œå·², ä¸èƒ½é‡å¤
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># NAME: {{ Hostname }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Jumpserveré¡¹ç›®çš„url, apiè¯·æ±‚æ³¨å†Œä¼šä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CORE_HOST: http://127.0.0.1:8080
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Bootstrap Token, é¢„å…±äº«ç§˜é’¥, ç”¨æ¥æ³¨å†Œcocoä½¿ç”¨çš„service accountå’Œterminal
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è¯·å’Œjumpserver é…ç½®æ–‡ä»¶ä¸­ä¿æŒä¸€è‡´ï¼Œæ³¨å†Œå®Œæˆåå¯ä»¥åˆ é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">BOOTSTRAP_TOKEN: &lt;PleasgeChangeSameWithJumpserver&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¯åŠ¨æ—¶ç»‘å®šçš„ip, é»˜è®¤ 0.0.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># BIND_HOST: 0.0.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç›‘å¬çš„SSHç«¯å£å·, é»˜è®¤2222
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SSHD_PORT: 2222
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç›‘å¬çš„HTTP/WSç«¯å£å·ï¼Œé»˜è®¤5000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># HTTPD_PORT: 5000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®æ—¥å¿—çº§åˆ« [DEBUG, INFO, WARN, ERROR, FATAL, CRITICAL]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># LOG_LEVEL: INFO
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SSHè¿æ¥è¶…æ—¶æ—¶é—´ (default 15 seconds)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SSH_TIMEOUT: 15
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è¯­è¨€ [en,zh]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># LANGUAGE_CODE: zh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SFTPçš„æ ¹ç›®å½•, å¯é€‰ /tmp, Homeå…¶ä»–è‡ªå®šä¹‰ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SFTP_ROOT: /tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SFTPæ˜¯å¦æ˜¾ç¤ºéšè—æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SFTP_SHOW_HIDDEN_FILE: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å¤ç”¨å’Œç”¨æˆ·åç«¯èµ„äº§å·²å»ºç«‹çš„è¿æ¥(ç”¨æˆ·ä¸ä¼šå¤ç”¨å…¶ä»–ç”¨æˆ·çš„è¿æ¥)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># REUSE_CONNECTION: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># èµ„äº§åŠ è½½ç­–ç•¥, å¯æ ¹æ®èµ„äº§è§„æ¨¡è‡ªè¡Œè°ƒæ•´. é»˜è®¤å¼‚æ­¥åŠ è½½èµ„äº§, å¼‚æ­¥æœç´¢åˆ†é¡µ; å¦‚æœä¸ºall, åˆ™èµ„äº§å…¨éƒ¨åŠ è½½, æœ¬åœ°æœç´¢åˆ†é¡µ.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ASSET_LOAD_POLICY:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># zipå‹ç¼©çš„æœ€å¤§é¢åº¦ (å•ä½: M)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ZIP_MAX_SIZE: 1024M
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># zipå‹ç¼©å­˜æ”¾çš„ä¸´æ—¶ç›®å½• /tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ZIP_TMP_PATH: /tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å‘ SSH Client è¿æ¥å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš” (å•ä½: ç§’)ï¼Œé»˜è®¤ä¸º30, 0åˆ™è¡¨ç¤ºä¸å‘é€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># CLIENT_ALIVE_INTERVAL: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å‘èµ„äº§å‘é€å¿ƒè·³åŒ…çš„é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ä¸º3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># RETRY_ALIVE_COUNT_MAX: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¼šè¯å…±äº«ä½¿ç”¨çš„ç±»å‹ [local, redis], é»˜è®¤local
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># SHARE_ROOM_TYPE: local
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Redisé…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># REDIS_HOST: 127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># REDIS_PORT: 6379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># REDIS_PASSWORD:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># REDIS_CLUSTERS:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># REDIS_DB_ROOM:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å¼€å¯æœ¬åœ°è½¬å‘ (ç›®å‰ä»…å¯¹ vscode remote ssh æœ‰æ•ˆæœ)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ENABLE_LOCAL_PORT_FORWARD: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å¼€å¯ é’ˆå¯¹ vscode çš„ remote-ssh è¿œç¨‹å¼€å‘æ”¯æŒ (å‰ç½®æ¡ä»¶: å¿…é¡»å¼€å¯ ENABLE_LOCAL_PORT_FORWARD )
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ENABLE_VSCODE_SUPPORT: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="jumpserverç•Œé¢é…ç½®"><code>Jumpserver</code>ç•Œé¢é…ç½®</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç³»ç»Ÿç”¨æˆ·é…ç½®<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-c1802a4a7b293341c5f7780efef28575" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jump_Server/Snipaste_2023-03-29_15-38-39.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c1802a4a7b293341c5f7780efef28575"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jump_Server/Snipaste_2023-03-29_15-38-39.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->æƒé™ç®¡ç†é…ç½®<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-57841c534389c4427db57eba9e47ff92" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jump_Server/Snipaste_2023-03-29_15-42-52.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-57841c534389c4427db57eba9e47ff92"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jump_Server/Snipaste_2023-03-29_15-42-52.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->å…¶å®ƒç³»ç»Ÿè®¾ç½®<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-6bbef13c34db93f2caebcc49710c8935" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jump_Server/Snipaste_2023-03-29_15-50-02.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6bbef13c34db93f2caebcc49710c8935"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Jump_Server/Snipaste_2023-03-29_15-50-02.png"></a></p>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_jumpserver">Install_JumpServer</h1>

<h2 id="centerå®‰è£…jumpserverå ¡å’æœºcenter"><!-- raw HTML omitted -->å®‰è£…<code>Jumpserver</code>å ¡å’æœº<!-- raw HTML omitted --></h2>
<!-- raw HTML omitted -->
<ul>
<li>
<ol>
<li><code>jump server</code><!-- raw HTML omitted --><strong>ç®€ä»‹</strong>ã€å®‰è£…<!-- raw HTML omitted --><a href="https://docs.jumpserver.org/zh/master/dev/build/" rel="external" target="_self"><code>JumpServer</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®Œå…¨å¼€æºï¼Œä½¿ç”¨<!-- raw HTML omitted --><code>GNU GPL v2.0</code><!-- raw HTML omitted -->å¼€æºåè®®ï¼Œç¬¦åˆ<!-- raw HTML omitted --><code>4A</code><!-- raw HTML omitted -->ä¸“ä¸šè¿ç»´å®¡è®¡<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Python/Django</code><!-- raw HTML omitted -->è¿›è¡Œå¼€å‘ï¼Œéµå¾ª<!-- raw HTML omitted --><code>Web2.0</code><!-- raw HTML omitted -->è§„èŒƒ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å®ç°äº†è·³æ¿æœºåŸºæœ¬åŠŸèƒ½ï¼Œè®¤è¯ã€æˆæƒã€å®¡è®¡<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é›†æˆäº†<!-- raw HTML omitted --><code>Ansible</code><!-- raw HTML omitted -->æ‰¹é‡å‘½ä»¤ï¼Œæ”¯æŒ<!-- raw HTML omitted --><code>web Terminal</code></li>
<li><!-- raw HTML omitted -->é‡‡çº³åˆ†å¸ƒå¼æ¶æ„ï¼Œæ”¯æŒå¤šæœºæˆ¿è·¨åŒºåŸŸéƒ¨ç½²<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ç°æ”¯æŒ<!-- raw HTML omitted --><code>SSHã€Telnetã€RDPã€VNC</code><!-- raw HTML omitted -->åè®®èµ„äº§<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->è‡ªåŠ¨æ”¶é›†ç¡¬ä»¶ä¿¡æ¯ã€å½•åƒå›æ”¾ã€å‘½ä»¤æœç´¢ã€å®æ—¶ç›‘æ§ã€æ‰¹é‡ä¸Šä¼ ä¸‹è½½<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¤šç§Ÿæˆ·ï¼šä¸€å¥—ç³»ç»Ÿï¼Œå¤šä¸ªå­å…¬å¸å’Œéƒ¨é—¨åŒæ—¶ä½¿ç”¨<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¤šåº”ç”¨æ”¯æŒï¼šæ•°æ®åº“ï¼Œ<!-- raw HTML omitted --><code>Windows</code><!-- raw HTML omitted -->è¿œç¨‹åº”ç”¨<!-- raw HTML omitted --><code>Kubernetes</code></li>
<li><a href="https://www.jumpserver.org/video.html" rel="external" target="_self">å®˜æ–¹è§†é¢‘</a></li>
</ul>
</blockquote>
<h3 id="åŸºç¡€é…ç½®ç¯å¢ƒè¦æ±‚">åŸºç¡€é…ç½®ç¯å¢ƒè¦æ±‚</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…ç¯å¢ƒè¦æ±‚ï¼Œ<strong>é»˜è®¤è´¦å·å¯†ç éƒ½æ˜¯ï¼š</strong><!-- raw HTML omitted --><code>admin</code></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>ç³»ç»Ÿ/æœåŠ¡</th>
<th>ç‰ˆæœ¬</th>
<th>å·¥å…·/æ•°æ®åº“å­—ç¬¦é›†</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>linux/amd64</code></td>
<td><code>&gt;= 4.0</code></td>
<td><code>wget curl tar gettext iptables python</code></td>
</tr>
<tr>
<td><code>MySQL</code></td>
<td><code>&gt;= 5.7</code></td>
<td><code>utf8ã€utf8_general_ci</code></td>
</tr>
<tr>
<td><code>MariaDB</code></td>
<td><code>&gt;= 10.2</code></td>
<td><code>utf8mb3ã€utf8mb3_general_ci</code></td>
</tr>
<tr>
<td><code>Redis</code></td>
<td><code>&gt;= 5.0</code></td>
<td><code>Sentinel</code>æ¨¡å¼ï¼Œä½¿ç”¨<code>Redis</code>åš<code>cache</code>å’Œ<code>celery broke</code></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç”ŸæˆéšæœºåŠ å¯†å¯†é’¥<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Linux</code><!-- raw HTML omitted -->ç³»ç»Ÿï¼Œç”ŸæˆéšæœºåŠ å¯†å¯†é’¥<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$SECRET_KEY<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span> SECRET_KEY<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>cat /dev/urandom | tr -dc A-Za-z0-9 | head -c 50<span style="color:#e6db74">`</span>; echo <span style="color:#e6db74">&#34;SECRET_KEY=</span>$SECRET_KEY<span style="color:#e6db74">&#34;</span> &gt;&gt; ~/.bashrc; echo $SECRET_KEY; <span style="color:#66d9ef">else</span> echo $SECRET_KEY; <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$BOOTSTRAP_TOKEN<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span> BOOTSTRAP_TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>cat /dev/urandom | tr -dc A-Za-z0-9 | head -c 16<span style="color:#e6db74">`</span>; echo <span style="color:#e6db74">&#34;BOOTSTRAP_TOKEN=</span>$BOOTSTRAP_TOKEN<span style="color:#e6db74">&#34;</span> &gt;&gt; ~/.bashrc; echo $BOOTSTRAP_TOKEN; <span style="color:#66d9ef">else</span> echo $BOOTSTRAP_TOKEN; <span style="color:#66d9ef">fi</span></span></span></code></pre></div><ul>
<li><code>macOS</code><!-- raw HTML omitted -->ç³»ç»Ÿï¼Œç”Ÿæˆéšæœº<!-- raw HTML omitted --><code>key</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$SECRET_KEY<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span> SECRET_KEY<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>LC_CTYPE<span style="color:#f92672">=</span>C tr -dc A-Za-z0-9 &lt; /dev/urandom | head -c 50<span style="color:#e6db74">`</span>; echo <span style="color:#e6db74">&#34;SECRET_KEY=</span>$SECRET_KEY<span style="color:#e6db74">&#34;</span> &gt;&gt; ~/.bash_profile; echo $SECRET_KEY; <span style="color:#66d9ef">else</span> echo $SECRET_KEY; <span style="color:#66d9ef">fi</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$BOOTSTRAP_TOKEN<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span> BOOTSTRAP_TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>LC_CTYPE<span style="color:#f92672">=</span>C tr -dc A-Za-z0-9 &lt; /dev/urandom | head -c 16<span style="color:#e6db74">`</span>; echo <span style="color:#e6db74">&#34;BOOTSTRAP_TOKEN=</span>$BOOTSTRAP_TOKEN<span style="color:#e6db74">&#34;</span> &gt;&gt; ~/.bash_profile; echo $BOOTSTRAP_TOKEN; <span style="color:#66d9ef">else</span> echo $BOOTSTRAP_TOKEN; <span style="color:#66d9ef">fi</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åˆ›å»ºæ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ DB_PASSWORD<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cat /dev/urandom | tr -dc A-Za-z0-9 | head -c 24<span style="color:#66d9ef">)</span>  	<span style="color:#75715e"># ç”Ÿæˆéšæœºæ•°æ®åº“å¯†ç </span>
</span></span><span style="display:flex;"><span>$ echo -e <span style="color:#e6db74">&#34;\033[31m ä½ çš„æ•°æ®åº“å¯†ç æ˜¯ </span>$DB_PASSWORD<span style="color:#e6db74"> \033[0m&#34;</span>
</span></span><span style="display:flex;"><span>$ mysql -uroot -e <span style="color:#e6db74">&#34;create database jumpserver default charset &#39;utf8&#39;; grant all on jumpserver.* to &#39;jumpserver&#39;@&#39;127.0.0.1&#39; identified by &#39;</span>$DB_PASSWORD<span style="color:#e6db74">&#39;; flush privileges;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºæ•°æ®åº“ä»¥åŠç¼–ç ç±»å‹</span>
</span></span><span style="display:flex;"><span>mysql &gt; create database jumpserver default charset <span style="color:#e6db74">&#39;utf8&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºç”¨æˆ·ä»¥åŠæˆæƒ</span>
</span></span><span style="display:flex;"><span>mysql &gt; grant all on jumpserver.* to <span style="color:#e6db74">&#39;jumpserver&#39;</span>@<span style="color:#e6db74">&#39;%&#39;</span> identified by <span style="color:#e6db74">&#39;password&#39;</span>;</span></span></code></pre></div></blockquote>
<hr>
<h3 id="dockerå®‰è£…jumpserver"><code>Docker</code>å®‰è£…<code>JumpServer</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æ‰§è¡Œ<!-- raw HTML omitted --><a href="https://github.com/jumpserver/Dockerfile/tree/master/allinone" rel="external" target="_self"><code>docker</code></a><!-- raw HTML omitted -->éƒ¨ç½²å‘½ä»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><a href="https://github.com/jumpserver/Dockerfile" rel="external" target="_self"><code>docker-compose</code></a><!-- raw HTML omitted -->æ ‡å‡†éƒ¨ç½²<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone --depth<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> https://github.com/jumpserver/Dockerfile.git /opt/docker-compose/jumpserver</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/docker-compose/jumpserver/
</span></span><span style="display:flex;"><span>$ cp config_example.conf .env
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/docker-compose/jumpserver/.env<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ç‰ˆæœ¬å·å¯ä»¥è‡ªå·±æ ¹æ®é¡¹ç›®çš„ç‰ˆæœ¬ä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Version=v2.28.7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## æ„å»ºå‚æ•°, æ”¯æŒ amd64/arm64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TARGETARCH=amd64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## Compose
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">COMPOSE_PROJECT_NAME=jms
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## COMPOSE_HTTP_TIMEOUT=3600
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## DOCKER_CLIENT_TIMEOUT=3600
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DOCKER_SUBNET=172.16.238.0/24
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## æŒä¹…åŒ–å­˜å‚¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">VOLUME_DIR=/opt/jumpserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## MySQL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DB_HOST=mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DB_PORT=3306
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DB_USER=root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DB_PASSWORD=nu4x599Wq7u0Bn8EABh3J91G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DB_NAME=jumpserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## Redis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">REDIS_HOST=redis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">REDIS_PORT=6379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">REDIS_PASSWORD=8URXPL2x3HZMi7xoGTdk3Upj
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## Core
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SECRET_KEY=B3f2w8P2PfxIAS7s4URrD9YmSbtqX4vXdPUL217kL9XPUOWrmy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">BOOTSTRAP_TOKEN=7Q11Vz6R2J6BLAdO
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DEBUG=FALSE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LOG_LEVEL=ERROR
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## Web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">HTTP_PORT=80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SSH_PORT=2222
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MAGNUS_PORT=30000-30020
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## SECRET_KEY ä¿æŠ¤ç­¾åæ•°æ®çš„å¯†åŒ™, é¦–æ¬¡å®‰è£…è¯·ä¸€å®šè¦ä¿®æ”¹å¹¶ç‰¢è®°, åç»­å‡çº§å’Œè¿ç§»ä¸å¯æ›´æ”¹, å¦åˆ™å°†å¯¼è‡´åŠ å¯†çš„æ•°æ®ä¸å¯è§£å¯†ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## BOOTSTRAP_TOKEN ä¸ºç»„ä»¶è®¤è¯ä½¿ç”¨çš„å¯†é’¥, ä»…ç»„ä»¶æ³¨å†Œæ—¶ä½¿ç”¨ã€‚ç»„ä»¶æŒ‡ kokoã€guacamole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆå§‹åŒ–æ•°æ®åº“ã€å¯åŠ¨<!-- raw HTML omitted --><code>jms_core</code><!-- raw HTML omitted -->å®¹å™¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker-compose -f docker-compose-network.yml -f docker-compose-init-db.yml up -d</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¤„ç†æ•°æ®åº“åˆå¹¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker exec -i jms_core bash -c <span style="color:#e6db74">&#39;./jms upgrade_db&#39;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ„å»ºå¯åŠ¨<!-- raw HTML omitted --><code>Jumpserver</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker-compose -f docker-compose-network.yml -f docker-compose.yml up -d</span></span></code></pre></div></blockquote>
<hr>
<h3 id="hleméƒ¨ç½²jump-server"><code>Hlem</code>éƒ¨ç½²<code>Jump Server</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Hlem</code><!-- raw HTML omitted -->éƒ¨ç½²<!-- raw HTML omitted --><code>Jumpserver</code><!-- raw HTML omitted -->åˆ°<!-- raw HTML omitted --><code>Kubernetes</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Hlem</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Jumpserver</code><!-- raw HTML omitted -->åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo add jumpserver https://jumpserver.github.io/helm-charts
</span></span><span style="display:flex;"><span>$ helm repo list</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Jumserver</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --><a href="https://github.com/jumpserver/helm-charts/blob/main/charts/jumpserver/values.yaml" rel="external" target="_self"><code>JumpServer</code>æ¨¡æ¿é“¾æ¥</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;values.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Default values for jumpserver.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># This is a YAML-formatted file.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Declare variables to be passed into your templates.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">nameOverride: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fullnameOverride: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## @param global.imageRegistry Global Docker image registry
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## @param global.imagePullSecrets Global Docker registry secret names as an array
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## @param global.storageClass Global StorageClass for Persistent Volume(s)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## @param global.redis.password Global Redis&amp;trade; password (overrides `auth.password`)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> imageRegistry: &#34;docker.io&#34;    # å›½å†…å¯ä»¥ä½¿ç”¨åä¸ºäº‘åŠ é€Ÿ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> imageTag: v2.26.0             # ç‰ˆæœ¬å·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> ## E.g.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  imagePullSecrets:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #    - name: harborsecret
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  storageClass: &#34;jumpserver-data&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> ##
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> imagePullSecrets: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # - name: yourSecretKey
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> storageClass: &#34;&#34;              # (*å¿…å¡«) NFS SC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## Please configure your MySQL server first
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## Jumpserver will not start the external MySQL server.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">externalDatabase:               #  (*å¿…å¡«) æ•°æ®åº“ç›¸å…³è®¾ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> engine: mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> host: localhost
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> port: 3306
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> user: root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> password: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> database: jumpserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## Please configure your Redis server first
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## Jumpserver will not start the external Redis server.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">externalRedis:                  #  (*å¿…å¡«) Redis è®¾ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> host: localhost
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> port: 6379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> password: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">serviceAccount:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # Specifies whether a service account should be created
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> create: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # The name of the service account to use.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # If not set and create is true, a name is generated using the fullname template
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> name:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ingress:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> enabled: true                             # ä¸ä½¿ç”¨ ingress å¯ä»¥å…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # kubernetes.io/tls-acme: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   compute-full-forwarded-for: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   use-forwarded-headers: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   kubernetes.io/ingress.class: nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   nginx.ingress.kubernetes.io/configuration-snippet: |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      proxy_set_header Upgrade &#34;websocket&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      proxy_set_header Connection &#34;Upgrade&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> hosts:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   - &#34;test.jumpserver.org&#34;                 # å¯¹å¤–åŸŸå
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> tls: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  - secretName: chart-example-tls
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #    hosts:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #      - chart-example.local
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">core:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   app.jumpserver.org/name: jms-core
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # Generate a new random secret key by execute `cat /dev/urandom | tr -dc A-Za-z0-9 | head -c 50`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # secretKey: &#34;B3f2w8P2PfxIAS7s4URrD9YmSbtqX4vXdPUL217kL9XPUOWrmy&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   secretKey: &#34;&#34;                            #  (*å¿…å¡«) åŠ å¯†æ•æ„Ÿä¿¡æ¯çš„ secret_key, é•¿åº¦æ¨èå¤§äº 50 ä½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # Generate a new random bootstrap token by execute `cat /dev/urandom | tr -dc A-Za-z0-9 | head -c 16`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # bootstrapToken: &#34;7Q11Vz6R2J6BLAdO&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   bootstrapToken: &#34;&#34;                       #  (*å¿…å¡«) ç»„ä»¶è®¤è¯ä½¿ç”¨çš„ token, é•¿åº¦æ¨èå¤§äº 24 ä½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # Enabled it for debug
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   debug: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   log:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     level: ERROR
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> replicaCount: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> image:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   registry: docker.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   repository: jumpserver/core
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tag: v2.26.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   pullPolicy: IfNotPresent
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> command: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> env:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # See: https://docs.jumpserver.org/zh/master/admin-guide/env/#core
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   SESSION_EXPIRE_AT_BROWSER_CLOSE: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # SESSION_COOKIE_AGE: 86400
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # SECURITY_VIEW_AUTH_NEED_MFA: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> livenessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   httpGet:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     path: /api/health/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> readinessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   httpGet:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     path: /api/health/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> podSecurityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # fsGroup: 2000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> securityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # capabilities:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   drop:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   - ALL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # readOnlyRootFilesystem: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsNonRoot: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsUser: 1000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> service:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   type: ClusterIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   web:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: 8080
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   ws:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: 8070
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> resources: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # We usually recommend not to specify default resources and to leave this as a conscious
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # choice for the user. This also increases chances charts run on environments with little
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # resources, such as Minikube. If you do want to specify resources, uncomment the following
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # lines, adjust them as necessary, and remove the curly braces after &#39;resources:&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # limits:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 1000m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 2048Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 500m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 1024Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> persistence:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   storageClassName: jumpserver-data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   accessModes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - ReadWriteMany
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   size: 100Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # annotations: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   finalizers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - kubernetes.io/pvc-protection
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # subPath: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # existingClaim:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumeMounts: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumes: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nodeSelector: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> tolerations: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> affinity: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">koko:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   app.jumpserver.org/name: jms-koko
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   log:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     level: ERROR
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> replicaCount: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> image:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   registry: docker.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   repository: jumpserver/koko
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tag: v2.26.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   pullPolicy: IfNotPresent
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> command: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> env: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # See: https://docs.jumpserver.org/zh/master/admin-guide/env/#koko
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # LANGUAGE_CODE: zh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # REUSE_CONNECTION: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # ENABLE_LOCAL_PORT_FORWARD: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # ENABLE_VSCODE_SUPPORT: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> livenessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   httpGet:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     path: /koko/health/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> readinessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   httpGet:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     path: /koko/health/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> podSecurityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # fsGroup: 2000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> securityContext:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   privileged: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # capabilities:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   drop:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   - ALL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # readOnlyRootFilesystem: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsNonRoot: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsUser: 1000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> service:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   type: ClusterIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   web:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: 5000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   ssh:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: 2222
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> resources: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # We usually recommend not to specify default resources and to leave this as a conscious
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # choice for the user. This also increases chances charts run on environments with little
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # resources, such as Minikube. If you do want to specify resources, uncomment the following
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # lines, adjust them as necessary, and remove the curly braces after &#39;resources:&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # limits:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 100m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 128Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 100m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 128Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> persistence:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   storageClassName: jumpserver-data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   accessModes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - ReadWriteMany
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   size: 10Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # annotations: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   finalizers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - kubernetes.io/pvc-protection
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumeMounts: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumes: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nodeSelector: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> tolerations: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> affinity: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lion:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   app.jumpserver.org/name: jms-lion
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   log:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     level: ERROR
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> replicaCount: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> image:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   registry: docker.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   repository: jumpserver/lion
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tag: v2.26.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   pullPolicy: IfNotPresent
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> command: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> env:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # See: https://docs.jumpserver.org/zh/master/admin-guide/env/#lion
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   JUMPSERVER_ENABLE_FONT_SMOOTHING: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # JUMPSERVER_COLOR_DEPTH: 32
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # JUMPSERVER_ENABLE_WALLPAPER: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # JUMPSERVER_ENABLE_THEMING: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # JUMPSERVER_ENABLE_FULL_WINDOW_DRAG: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # JUMPSERVER_ENABLE_DESKTOP_COMPOSITION: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # JUMPSERVER_ENABLE_MENU_ANIMATIONS: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> livenessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   httpGet:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     path: /lion/health/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> readinessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   httpGet:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     path: /lion/health/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> podSecurityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # fsGroup: 2000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> securityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # capabilities:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   drop:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   - ALL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # readOnlyRootFilesystem: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsNonRoot: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsUser: 1000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> service:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   type: ClusterIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   web:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: 8081
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> resources: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # We usually recommend not to specify default resources and to leave this as a conscious
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # choice for the user. This also increases chances charts run on environments with little
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # resources, such as Minikube. If you do want to specify resources, uncomment the following
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # lines, adjust them as necessary, and remove the curly braces after &#39;resources:&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # limits:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 100m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 512Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 100m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 512Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> persistence:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   storageClassName: jumpserver-data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   accessModes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - ReadWriteMany
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   size: 50Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # annotations: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   finalizers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - kubernetes.io/pvc-protection
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumeMounts: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumes: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nodeSelector: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> tolerations: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> affinity: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">magnus:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   app.jumpserver.org/name: jms-magnus
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   log:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     level: ERROR
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> replicaCount: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> image:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   registry: docker.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   repository: jumpserver/magnus
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tag: v2.21.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   pullPolicy: IfNotPresent
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> command: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> env: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> livenessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tcpSocket:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> readinessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tcpSocket:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> podSecurityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # fsGroup: 2000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> securityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # capabilities:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   drop:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   - ALL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # readOnlyRootFilesystem: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsNonRoot: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsUser: 1000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> service:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   type: ClusterIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   mysql:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: 33060
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   mariadb:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: 33061
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   postgre:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: 54320
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> resources: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # We usually recommend not to specify default resources and to leave this as a conscious
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # choice for the user. This also increases chances charts run on environments with little
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # resources, such as Minikube. If you do want to specify resources, uncomment the following
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # lines, adjust them as necessary, and remove the curly braces after &#39;resources:&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # limits:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 100m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 512Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 100m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 512Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> persistence:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   storageClassName: jumpserver-data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   accessModes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - ReadWriteMany
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   size: 10Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # annotations: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   finalizers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - kubernetes.io/pvc-protection
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumeMounts: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumes: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nodeSelector: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> tolerations: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> affinity: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">xpack:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> enabled: false      # ä¼ä¸šç‰ˆæœ¬æ‰“å¼€æ­¤é€‰é¡¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">omnidb:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   app.jumpserver.org/name: jms-omnidb
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   log:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     level: ERROR
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> replicaCount: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> image:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   registry: registry.fit2cloud.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   repository: jumpserver/omnidb
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tag: v2.26.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   pullPolicy: IfNotPresent
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> command: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> env: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> livenessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tcpSocket:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> readinessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tcpSocket:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> podSecurityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # fsGroup: 2000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> securityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # capabilities:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   drop:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   - ALL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # readOnlyRootFilesystem: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsNonRoot: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsUser: 1000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> service:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   type: ClusterIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   web:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: 8082
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> resources: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # We usually recommend not to specify default resources and to leave this as a conscious
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # choice for the user. This also increases chances charts run on environments with little
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # resources, such as Minikube. If you do want to specify resources, uncomment the following
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # lines, adjust them as necessary, and remove the curly braces after &#39;resources:&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # limits:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 100m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 128Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 100m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 128Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> persistence:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   storageClassName: jumpserver-data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   accessModes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - ReadWriteMany
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   size: 10Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # annotations: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   finalizers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - kubernetes.io/pvc-protection
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumeMounts: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumes: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nodeSelector: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> tolerations: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> affinity: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">razor:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   app.jumpserver.org/name: jms-razor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   log:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     level: ERROR
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> replicaCount: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> image:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   registry: registry.fit2cloud.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   repository: jumpserver/razor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tag: v2.26.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   pullPolicy: IfNotPresent
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> command: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> env: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> livenessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tcpSocket:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: rdp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> readinessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tcpSocket:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: rdp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> podSecurityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # fsGroup: 2000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> securityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # capabilities:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   drop:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   - ALL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # readOnlyRootFilesystem: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsNonRoot: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsUser: 1000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> service:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   type: ClusterIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   rdp:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: 3389
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> resources: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # We usually recommend not to specify default resources and to leave this as a conscious
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # choice for the user. This also increases chances charts run on environments with little
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # resources, such as Minikube. If you do want to specify resources, uncomment the following
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # lines, adjust them as necessary, and remove the curly braces after &#39;resources:&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # limits:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 100m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 128Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 100m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 128Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> persistence:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   storageClassName: jumpserver-data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   accessModes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - ReadWriteMany
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   size: 50Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # annotations: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   finalizers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - kubernetes.io/pvc-protection
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumeMounts: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumes: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nodeSelector: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> tolerations: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> affinity: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">web:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   app.jumpserver.org/name: jms-web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> replicaCount: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> image:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   registry: docker.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   repository: jumpserver/web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   tag: v2.26.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   pullPolicy: IfNotPresent
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> command: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> env: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # nginx client_max_body_size, default 4G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # CLIENT_MAX_BODY_SIZE: 4096m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> livenessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   httpGet:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     path: /api/health/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> readinessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   failureThreshold: 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   httpGet:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     path: /api/health/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: web
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> podSecurityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # fsGroup: 2000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> securityContext: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # capabilities:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   drop:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   - ALL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # readOnlyRootFilesystem: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsNonRoot: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # runAsUser: 1000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> service:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   type: ClusterIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   web:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port: 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> resources: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # We usually recommend not to specify default resources and to leave this as a conscious
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # choice for the user. This also increases chances charts run on environments with little
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # resources, such as Minikube. If you do want to specify resources, uncomment the following
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # lines, adjust them as necessary, and remove the curly braces after &#39;resources:&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # limits:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 100m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 128Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   cpu: 100m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   #   memory: 128Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> persistence:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   storageClassName: jumpserver-data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   accessModes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - ReadWriteMany
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   size: 1Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   # annotations: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   finalizers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     - kubernetes.io/pvc-protection
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumeMounts: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> volumes: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nodeSelector: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> tolerations: []
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> affinity: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å®‰è£…ã€å¸è½½å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ helm install jms-k8s jumpserver/jumpserver -n jumpserver -f values.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¸è½½</span>
</span></span><span style="display:flex;"><span>$ helm uninstall jms-k8s -n default</span></span></code></pre></div></blockquote>
<hr>
<h3 id="è„šæœ¬å®‰è£…jumpserver">è„šæœ¬å®‰è£…<code>Jumpserver</code></h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…å®Œæˆåé…ç½®æ–‡ä»¶<!-- raw HTML omitted --><code>/opt/jumpserver/config/config.txt</code></li>
<li><a href="https://docs.jumpserver.org/zh/master/install/setup_by_fast/" rel="external" target="_self"><code>Jumpserver</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -sSL https://github.com/jumpserver/jumpserver/releases/download/v2.24.2/quick_start.sh | bash
</span></span><span style="display:flex;"><span>$ cd /opt/jumpserver-installer-v2.24.2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>$ ./jmsctl.sh start -d  	<span style="color:#75715e"># åå°è¿è¡Œä½¿ç”¨ -d å‚æ•°./jms start -d</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœæ­¢</span>
</span></span><span style="display:flex;"><span>$ ./jmsctl.sh down
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¸è½½</span>
</span></span><span style="display:flex;"><span>$ ./jmsctl.sh uninstall
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¸®åŠ©</span>
</span></span><span style="display:flex;"><span>$ ./jmsctl.sh -h</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="keepalived">Keepalived</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Keepalived</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_keepalived">Install_Keepalived</h1>

<h2 id="keepalivedç®€ä»‹"><code>Keepalived</code>ç®€ä»‹</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ ‡ç­¾ï¼š é«˜å¯ç”¨<!-- raw HTML omitted --><code>vrrp</code></li>
<li><code>Keepalived</code>å•¥è½¯ä»¶èµ·åˆæ˜¯å‡†å°‰<code>LVS</code>è´Ÿè½½è½¯ä»¶è®¾è®¡çš„ï¼Œç”¨æ¥ç®¡ç†å¹¶ç›‘æ§<code>LVS</code>é›†ç¾¤ç³»ç»Ÿä¸­å„ä¸ªæœåŠ¡èŠ‚ç‚¹çš„è£…é˜¿æï¼Œåæ¥åŠ å…¥äº†é«˜å¯ç”¨çš„<code>VRRP</code>åŠŸèƒ½ã€‚ <code>VRRP</code>æ˜¯<code>Virtual Router Redundancy Protocol(è™šæ‹Ÿè·¯ç”±å™¨å†—ä½™åè®®)</code>çš„ç¼©å†™ï¼Œä¸ºè§£å†³é™æ€è·¯ç”±å™¨å•ç‚¹æ•…éšœé—®é¢˜ï¼Œç¡®ä¿ä¸ªåˆ«èŠ‚ç‚¹å®•æœºæ—¶ï¼ŒçœŸå“¥å“¥ç½‘ç»œå¯ä»¥ä¸é—´æ–­åœ°è¿è¡Œã€‚ <code>Keepalived</code>å¦ä¸€æ–¹é¢å…·æœ‰é…ç½®é…ç½®ç®¡ç†<code>LVS</code>çš„åŠŸèƒ½ï¼ŒåŒæ—¶è¿˜å…·æœ‰å¯¹<code>LVS</code>ä¸‹é¢èŠ‚è¿›è¡Œå¥åº·æ£€æŸ¥çš„åŠŸèƒ½ã€‚</li>
<li><code>VRRP</code>åŸç†ä»‹ç»</li>
</ul>
<blockquote>
<ul>
<li><code>VRRP</code>ï¼Œå…¨ç§°<code>Virtual Router Redundancy Protocol</code>ä¸­æ–‡åä¸ºè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ï¼Œ<code>VRRP</code>çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³é™æ€è·¯ç”±çš„å•</li>
<li><code>keepalived</code>é€šè¿‡<code>vrrp</code>é€šä¿¡ï¼Œé€šè¿‡ç«é€‰ç¡®å®šä¸»å¤‡åè®®æœºåˆ¶æ¥å°†è·¯ç”±ä»»åŠ¡äº¤ç»™æŸå°<code>VRRP</code>è·¯ç”±å™¨çš„ï¼Œä¸»ä¼˜å…ˆçº§é«˜äºå¤‡ã€‚å› æ­¤ï¼Œå·¥ä½œæ—¶ä¸»ä¼šè·å¾—æ‰€æœ‰èµ„æºï¼Œå¤‡èŠ‚ç‚¹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå½“ä¸»èŠ‚ç‚¹å®•æœºï¼Œé‚£ä¹ˆå¤‡èŠ‚ç‚¹å¯ç”¨æ¥ç®¡ç¨‹åºæ¥ç®¡ä¸»èŠ‚ç‚¹èµ„æºï¼Œé¡¶æ›¿ä¸»èŠ‚ç‚¹æä¾›æœåŠ¡ã€‚</li>
<li><code>VRRP</code>æŠ¥æ–‡å°è£…åœ¨<code>IP</code>æŠ¥æ–‡ä¸­ï¼Œåªæœ‰ä¸€ç§<code>VRRP</code>é€šå‘ŠæŠ¥æ–‡ï¼Œ åªæœ‰å¤„äº<code>master</code>çŠ¶æ€ä¸‹çš„è·¯ç”±å™¨ä¼šå‘é€ï¼Œ<code>VRRP</code>ç”¨<code>IP</code>å¤šæ’­çš„æ–¹å¼ï¼ˆé»˜è®¤å¤šæ’­åœ°å€ï¼ˆ224.0.0.18ï¼‰ï¼‰å®ç°é«˜å¯ç”¨å¯¹ä¹‹é—´é€šä¿¡ã€‚</li>
<li>åœ¨<code>Keepalived</code>æœåŠ¡å¯¹ä¹‹é—´ï¼Œåªæœ‰ä½œä¸ºä¸»çš„æœåŠ¡å™¨ä¼šä¸€ç›´å‘é€<code>VRRP</code>å¹¿æ’­åŒ…ï¼Œå‘Šè¯‰å¤‡å®ƒè¿˜æ´»ç€ï¼Œæ­¤æ—¶å¤‡ä¸ä¼šæŠ¢å ä¸»ï¼Œå½“ä¸»ä¸å¯ç”¨æ—¶ï¼Œå³ç›‘å¬ä¸åˆ°ä¸»å‘é€çš„å¹¿æ’­åŒ…æ—¶ï¼Œå°±ä¼šå¯åŠ¨ç›¸å…³æœåŠ¡æ¥ç®¡èµ„æºï¼Œä¿è¯ä¸šåŠ¡çš„è¿ç»­æ€§ã€‚æ¥ç®¡é€Ÿåº¦æœ€å¿«å¯ä»¥å°äº1ç§’ï¼Œå¤‡èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªï¼Œé€šè¿‡ä¼˜å…ˆçº§ç«é€‰ï¼Œä½†ä¸€èˆ¬<code>Keepalived</code>ç³»ç»Ÿè¿ç»´å·¥ä½œä¸­éƒ½æ˜¯ä¸€å¯¹ã€‚</li>
<li><code>VRRP</code>ä½¿ç”¨äº†åŠ å¯†åè®®åŠ å¯†æ•°æ®ï¼Œä½†<code>Keepalived</code>å®˜æ–¹ç›®å‰è¿˜æ˜¯æ¨èç”¨æ˜æ–‡çš„æ–¹å¼é…ç½®è®¤è¯ç±»å‹å’Œå¯†ç ã€‚</li>
</ul>
<blockquote>
<ul>
<li><code>VRID</code>è™šæ‹Ÿè·¯ç”±å™¨è¡¨ç¤ºï¼Œæ‹¥æœ‰ç›¸åŒ<code>VRID</code>çš„ä¸€ç»„è·¯ç”±å™¨æ„æˆä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨ï¼Œä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹Ÿ<code>IP</code>åœ°å€</li>
<li>è™šæ‹Ÿ<code>MAC</code>åœ°å€<code>00-00-5E-00-01ï¼ˆVRIDï¼‰</code></li>
<li>åˆ†ä¸ºæŠ¢å å’Œä¸æŠ¢å </li>
<li>ä¼˜å…ˆçº§é«˜çš„æˆä¸º<code>master</code>è·¯ç”±å™¨ï¼ŒèŒƒå›´æ˜¯0-255ï¼Œ0è¡¨ç¤ºè·¯ç”±å™¨æ”¾å¼ƒ<code>master</code>çŠ¶æ€ï¼Œ255è¡¨ç¤ºè™šæ‹Ÿ<code>IP</code>åœ°å€å®é™…æ‹¥æœ‰è€…ã€‚é»˜è®¤ä¸º100</li>
<li><code>backup</code>è·¯ç”±å™¨åˆ‡æ¢åˆ°<code>master</code>è·¯ç”±å™¨çš„æ—¶é—´ä¸º<code>skew time=256-backup</code>è·¯ç”±å™¨ä¼˜å…ˆçº§/256</li>
<li><code>master</code>å¤±æ•ˆï¼Œ<code>backup</code>è½¬æ¢æˆ<code>master</code>éœ€è¦çš„æ—¶é—´ä¸º<code>3*V</code>éš”<code>RRP</code>æŠ¥æ–‡é—´<code>Skew tim</code></li>
</ul>
</blockquote>
</blockquote>
<ul>
<li><code>Keepalived</code>æœåŠ¡çš„ä¸‰ä¸ªé‡è¦åŠŸèƒ½</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->ç®¡ç†<!-- raw HTML omitted --><code>LVS</code><!-- raw HTML omitted -->è´Ÿè½½å‡è¡¡è½¯ä»¶<!-- raw HTML omitted --></p>
<p><code>Keepalived</code>è½¯ä»¶èµ·åˆæ˜¯ä¸ºäº†è§£å†³<code>LVS</code>çš„é—®é¢˜è€Œè¯ç”Ÿçš„ã€‚å› æ­¤ï¼Œ<code>Keepalived</code>å’Œ<code>LVS</code>çš„æ„Ÿæƒ…å¾ˆæ·±ï¼Œå‘å¤«å¦»ä¸€æ ·å¯ä»¥ç´§å¯†ç»“åˆï¼Œæ„‰å¿«åœ°å·¥ä½œã€‚ <code>Keepalived</code>é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶ï¼Œå®ç°é€šè¿‡æ›´åº•å±‚çš„æ¥å£ç›´æ¥ç®¡ç†<code>LVS</code>åŠæ§åˆ¶æœåŠ¡å™¨çš„å¯åŠ¨ã€åœæ­¢ç­‰åŠŸèƒ½ï¼Œä½¿å¾—<code>LVS</code>åº”ç”¨æ›´åŠ ç®€å•æ–¹ä¾¿ã€‚</p>
</li>
<li>
<p><!-- raw HTML omitted -->å®ç°å¯¹<!-- raw HTML omitted --><code>LVS</code><!-- raw HTML omitted -->é›†ç¾¤å¥åº·æ£€æŸ¥çš„åŠŸèƒ½<!-- raw HTML omitted --></p>
<p><code>Keepalived</code>å¯ä»¥é€šè¿‡åœ¨è‡ªèº«çš„<code>keepalived.conf</code>æ–‡ä»¶é‡Œé…ç½®<code>LVS</code>çš„èŠ‚ç‚¹<code>IP</code>å’Œç›¸å…³å‚æ•°å®ç°å¯¹<code>LVS</code>çš„ç›´æ¥ç®¡ç†ï¼›å½“æ•…éšœçš„èŠ‚ç‚¹æœåŠ¡å™¨è¢«ä¿®å¤ä»¥åï¼Œ<code>Keepalived</code>æœåŠ¡åˆä¼šè‡ªåŠ¨åœ°æŠŠå®ƒä»¬åŠ å…¥åˆ°æ­£å¸¸è½¬å‘é˜Ÿåˆ—ä¸­ï¼Œå¯¹å®¢æˆ·æä¾›æœåŠ¡ã€‚</p>
</li>
<li>
<p><!-- raw HTML omitted -->ä½œä¸ºç³»ç»Ÿç½‘ç»œæœåŠ¡çš„é«˜å¯ç”¨<!-- raw HTML omitted --></p>
<p><code>Keepalived</code>å¯ä»¥å®ç°ä»»æ„ä¸¤å°ä¸»æœºä¹‹é—´ï¼Œä¾‹å¦‚<code>Master</code>å’Œ<code>Backup</code>ä¸»æœºä¹‹é—´çš„æ•…éšœè½¬ç§»å’Œè‡ªåŠ¨åˆ‡æ¢ï¼Œè¿™ä¸ªä¸»æœºå¯ä»¥æ˜¯æ™®é€šçš„ä¸èƒ½åœæœºçš„ä¸šåŠ¡æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯<code>LVS</code>è´Ÿè½½å‡è¡¡ã€<code>Nginx</code>åå‘ä»£ç†è¿™æ ·çš„æœåŠ¡å™¨ã€‚</p>
</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="vipæ¼‚ç§»å®æˆ˜"><code>VIP</code>æ¼‚ç§»å®æˆ˜</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æœåŠ¡å™¨è§„åˆ’<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">æœåŠ¡å™¨</th>
<th style="text-align:left"><code>ip</code></th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>keepalived-01</code></td>
<td style="text-align:left">10.0.0.7</td>
<td style="text-align:left"><code>keepalived</code>ä¸»æœåŠ¡å™¨</td>
</tr>
<tr>
<td style="text-align:left"><code>keepalived-02</code></td>
<td style="text-align:left">10.0.0.8</td>
<td style="text-align:left"><code>keepalived</code>å¤‡æœåŠ¡å™¨</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">10.0.0.3</td>
<td style="text-align:left">VIP</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…ã€é…ç½®<!-- raw HTML omitted --><code>Keepalived</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸¤å°<!-- raw HTML omitted -->æœåŠ¡å™¨éƒ½å®‰è£…<code>Keepalived</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install keepalived -y</span></span></code></pre></div></blockquote>
<ul>
<li>ä¿®æ”¹<!-- raw HTML omitted -->ä¸»<!-- raw HTML omitted -->æœåŠ¡å™¨<code>Keepalived</code>é…ç½®æ–‡ä»¶</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">! Configuration File for keepalived
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global_defs {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# è®¾ç½®çš„é‚®ä»¶æŠ¥è­¦ï¼Œè¿™éƒ¨åˆ†ä¸€èˆ¬ç”±nagiosã€zabbixç›‘æ§è½¯ä»¶æ¥è´Ÿè´£ï¼Œè¿™é‡Œçš„å†…å®¹å¾ˆé¸¡è‚‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	notification_email {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		31333741@qq.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	notification_email_from  31333741@qq.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	smtp_server 192.168.200.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	smtp_connect_timeout 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	router_id LVS_lb01  	# ä¸»èŠ‚ç‚¹id ä¸èƒ½å’Œå¤‡èŠ‚ç‚¹é‡å
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_skip_check_adv_addr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# ä½¿ç”¨ unicast_src_ip éœ€è¦æ³¨é‡Š vrrp_strictï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ ping è¿›è¡Œæµ‹è¯•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# vrrp_strict
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_garp_interval 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_gna_interval 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	script_user root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	enable_script_security
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å®šä¹‰vrrpæ£€æµ‹è„šæœ¬ï¼Œæª¢æŸ¥nginxç‹€æ³
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vrrp_script chk_nginx {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰§è¡Œè„šæœ¬ï¼Œå½“nginxæœåŠ¡æœ‰é—®é¢˜çš„æ™‚å€™å°±åœæ‰keepalivedæœåŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">script &#34;/opt/script/chk_nginx.sh&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é—´éš”1ç§’
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">interval 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">weight 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># VRRPå®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vrrp_instance VI_1 {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æŒ‡å®škeepalivedçš„è§’è‰²ï¼ŒMASTERè¡¨ç¤ºæ­¤ä¸»æ©Ÿæ˜¯ä¸»æœå‹™å™¨ï¼ŒBACKUPè¡¨ç¤ºä¸»æ©Ÿç‚ºå‚™ç”¨æœå‹™å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">state MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®çš„é€šä¿¡ç½‘å¡åç§° å¤‡èŠ‚ç‚¹è®¾ç½®ä¸€æ ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">interface eth0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è™šæ‹Ÿè·¯ç”±æ ‡å¿—ï¼Œæ”¯æŒä¸€ä¸ªæ•°å­—ï¼ŒåŒä¸€ä¸ªvrrpå®ä¾‹ä½¿ç”¨å”¯ä¸€çš„æ ‡å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åŒä¸€å€‹vrrp_instanceåº•ä¸‹ï¼ŒMASTERè·ŸBACKUPå¿…é¡»ä¸€è‡´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">virtual_router_id 51
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å®šä¹‰ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜(0-255)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">priority 150
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾å®šMASTERè·ŸBACKUPä¹‹é—´åŒæ­¥æ£€æŸ¥çš„æ—¶é—´é—´éš”ï¼Œå•ä½æ˜¯ç§’ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">advert_int 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¦‚æœèŠ‚ç‚¹ä¹‹é—´ç¦ç”¨äº†ç¾¤å‘çš„è©±ï¼Œåˆ™é‡‡ç”¨vrrpå•å‘é€šå‘Šçš„æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">unicast_src_ip 10.0.0.11
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">unicast_peer {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  10.0.0.12
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®éªŒè¯ç±»å‹ä¸å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">authentication {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # è®¾ç½®éªŒè¯ç±»å‹ï¼Œä¸»è¦æœ‰PASSè·ŸHAä¸¤ç§
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  auth_type PASS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # è®¾ç½®éªŒè¯å¯†ç ï¼Œåœ¨åŒä¸€å€‹vrrp_instanceåº•ä¸‹ï¼ŒMASTERè·ŸBACKUPå¿…é¡»ä½¿ç”¨ç›¸åŒå¾—å¯†ç æ‰èƒ½æ­£å¸¸æ²Ÿé€š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  auth_pass 1111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šå€‹è™šæ‹ŸIPåœ°å€ï¼Œæ¯è¡Œè®¾å®šä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">virtual_ipaddress {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # è™šæ‹ŸVIPçš„åœ°å€ ä¸ç½‘å¡æ ‡ç­¾
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  10.0.0.3/24 dev eth0 label eth0:1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">track_script {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # è§¦å‘æ£€æŸ¥
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  chk_nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>ä¿®æ”¹<!-- raw HTML omitted -->å¤‡ç”¨<!-- raw HTML omitted -->æœåŠ¡å™¨<code>Keepalived</code>é…ç½®æ–‡ä»¶</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">! Configuration File for keepalived
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global_defs {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®çš„é‚®ä»¶æŠ¥è­¦ï¼Œè¿™éƒ¨åˆ†ä¸€èˆ¬ç”±nagiosã€zabbixç›‘æ§è½¯ä»¶æ¥è´Ÿè´£ï¼Œè¿™é‡Œçš„å†…å®¹å¾ˆé¸¡è‚‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  31333741@qq.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email_from  31333741@qq.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_server 192.168.200.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_connect_timeout 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¤‡èŠ‚ç‚¹id ä¸èƒ½å’Œå¤‡èŠ‚ç‚¹é‡å
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">router_id LVS_lb02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># VRRPå®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vrrp_instance VI_1 {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®ä¸»æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">state MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®é€šä¿¡ç½‘å¡  å¤‡èŠ‚ç‚¹è®¾ç½®ä¸€æ ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">interface eth0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åŒç»„è·¯ç”±å™¨å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">virtual_router_id 51
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¼˜å…ˆçº§ è¿™é‡Œå¿…é¡»æ¯”å¤‡èŠ‚ç‚¹é«˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">priority 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¯éš”ä¸€ç§’å‘ä¸€æ¬¡å¿ƒè·³
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">advert_int 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æˆæƒå¯†ç   
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">authentication {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  auth_type PASS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  auth_pass 1111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">virtual_ipaddress {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # è™šæ‹ŸVIPçš„åœ°å€ ä¸ç½‘å¡æ ‡ç­¾
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  10.0.0.3/24 dev eth0 label eth0:1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨ä¸»èŠ‚ç‚¹<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡å¹¶æ£€æŸ¥<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /etc/init.d/keepalived start
</span></span><span style="display:flex;"><span>æ­£åœ¨å¯åŠ¨ keepalivedï¼š            <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@kepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ps -ef|grep keep|grep -v grep</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">7428</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 10:54 ?        00:00:00 /usr/sbin/keepalived -D
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">7430</span>   <span style="color:#ae81ff">7428</span>  <span style="color:#ae81ff">0</span> 10:54 ?        00:00:00 /usr/sbin/keepalived -D
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">7431</span>   <span style="color:#ae81ff">7428</span>  <span style="color:#ae81ff">0</span> 10:54 ?        00:00:00 /usr/sbin/keepalived -D</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ£€æŸ¥é…ç½®åçš„è™šæ‹Ÿ<!-- raw HTML omitted --><code>IP</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å‡ºç°å¸¦æœ‰<!-- raw HTML omitted --><code>vipï¼š10.0.0.3</code><!-- raw HTML omitted -->è¡Œçš„ç»“æœè¡¨ç¤º<!-- raw HTML omitted --><code>kepalived-01</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡å•å®ä¾‹é…ç½®æˆåŠŸ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ip add|grep 10.0.0.3
</span></span><span style="display:flex;"><span>    inet 10.0.0.3/24 scope global secondary eth0:1</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨å¤‡èŠ‚ç‚¹<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å¤‡ç”¨æœåŠ¡å™¨æ˜¯å¦æœ‰<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->æ²¡æœ‰è¿”å›ä»»ä½•ç»“æœå°±å¯¹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived start</span>
</span></span><span style="display:flex;"><span>æ­£åœ¨å¯åŠ¨ keepalivedï¼š  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># </span></span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å•å®ä¾‹ä¸»å¤‡æ¨¡å¼<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶å¯¹æ¯”<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ä¸»å¤‡å•å®ä¾‹<code>keepalived.conf</code>é…ç½®å·®åˆ«é¡¹</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left"><code>Keepalived</code>é…ç½®å‚æ•°</th>
<th style="text-align:left"><code>Master</code>èŠ‚ç‚¹ç‰¹æ®Šå‚æ•°</th>
<th style="text-align:left"><code>Backup</code>èŠ‚ç‚¹ç‰¹æ®Šå‚æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>Router_id</code> (å”¯ä¸€æ ‡è¯†)</td>
<td style="text-align:left"><code>router_id lb01</code></td>
<td style="text-align:left"><code>router_id lb02</code></td>
</tr>
<tr>
<td style="text-align:left"><code>State</code>ï¼ˆè§’è‰²çŠ¶æ€ï¼‰</td>
<td style="text-align:left"><code>Stat master</code></td>
<td style="text-align:left"><code>Stat backup</code></td>
</tr>
<tr>
<td style="text-align:left"><code>Priority</code> ï¼ˆç«é€‰ä¼˜å…ˆçº§ï¼‰</td>
<td style="text-align:left"><code>Priority 150</code></td>
<td style="text-align:left"><code>Priority 100</code></td>
</tr>
</tbody>
</table>
</blockquote>
</blockquote>
<hr>
<h3 id="keepalivedä¸»å¤‡åˆ‡æ¢"><code>Keepalived</code>ä¸»å¤‡åˆ‡æ¢</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœæ‰ä¸»æœåŠ¡ä¸Šçš„<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡æˆ–å…³é—­ä¸»æœåŠ¡å™¨ï¼Œæ“ä½œåŠæ£€æŸ¥æ­¥éª¤<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3</span>
</span></span><span style="display:flex;"><span>inet 10.0.0.3/24 scope global secondary eth0:1
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived stop</span>
</span></span><span style="display:flex;"><span>åœæ­¢ keepalivedï¼š                                          <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3  	# æŸ¥çœ‹vipæ¶ˆå¤±</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯ä»¥çœ‹åˆ°ä¸»æœåŠ¡å™¨<!-- raw HTML omitted --><code>vip10.00.3</code><!-- raw HTML omitted -->æ¶ˆå¤±äº†ï¼Œæ­¤æ—¶æŸ¥çœ‹<!-- raw HTML omitted --><code>backup</code><!-- raw HTML omitted -->å¤‡ä»½æœåŠ¡å™¨ï¼Œçœ‹æ˜¯å¦ä¼šæœ‰<!-- raw HTML omitted --><code>vip10.0.0.3</code><!-- raw HTML omitted -->å‡ºç°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å¯ä»¥çœ‹åˆ°å¤‡èŠ‚ç‚¹<code>keepalived-02</code>å·²ç»æ¥ç®¡ç»‘å®šäº†<code>10.0.0.3</code>è¿™ä¸ª<code>vip</code>ï¼Œè¿™æœŸé—´å¤‡èŠ‚ç‚¹è¿˜ä¼šå‘é€<code>ARP</code>å¹¿æ’­ï¼Œè®©æ‰€æœ‰çš„å®¢æˆ·ç«¯æ›´æ–°æœ¬åœ°çš„<code>ARP</code>è¡¨ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯è®¿é—®æ–°æ¥ç®¡<code>vip</code>æœåŠ¡èŠ‚ç‚¹ã€‚</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3        </span>
</span></span><span style="display:flex;"><span>    inet 10.0.0.3/24 scope global secondary eth0:1</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ­¤æ—¶å¦‚æœåœ¨å¯åŠ¨ä¸»æœåŠ¡å™¨çš„<!-- raw HTML omitted --><code>keepalived</code>æœåŠ¡ï¼Œä¸»æœåŠ¡å™¨å°±ä¼šæ¥ç®¡å›<code>vip 10.0.0.3</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3       </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived start</span>
</span></span><span style="display:flex;"><span>æ­£åœ¨å¯åŠ¨ keepalivedï¼š                                      <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3        </span>
</span></span><span style="display:flex;"><span>inet 10.0.0.3/24 scope global secondary eth0:1</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ­¤æ—¶å¤‡èŠ‚ç‚¹ä¸Šçš„<!-- raw HTML omitted --><code>vip 10.0.0.3</code><!-- raw HTML omitted -->åˆ™è¢«é‡Šæ”¾äº†ï¼Œå¦‚ä¸‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3    </span></span></span></code></pre></div></blockquote>
<ul>
<li>è¿™æ ·å°±å®ç°äº†å•å®ä¾‹<code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->è‡ªåŠ¨æ¼‚ç§»æ¥ç®¡äº†ï¼Œ<!-- raw HTML omitted --><code>vip</code>æ¼‚ç§»åˆ°äº†æ–°æœºå™¨æ–°æœåŠ¡ä¸Šï¼Œç”¨æˆ·çš„è®¿é—®è¯·æ±‚è‡ªç„¶å°±ä¼šæ‰¾åˆ°æ–°æœºå™¨æ–°æœåŠ¡äº†</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ³¨æ„ï¼šè¿™é‡Œä»…å®ç°äº†<!-- raw HTML omitted --><code>VIP</code>è‡ªåŠ¨æ¼‚ç§»åˆ‡æ¢ï¼Œå› æ­¤ä»…é€‚åˆä¸¤å°æœåŠ¡å™¨æä¾›çš„æœåŠ¡å‡ä¿æŒå¼€å¯çš„åº”ç”¨åœºæ™¯ï¼Œè¿™ä¹Ÿæ˜¯å·¥ä½œä¸­å¸¸ç”¨çš„é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="keepalivedåŒä¸»æ¨¡å¼"><code>keepalived</code>åŒä¸»æ¨¡å¼</h3>
<blockquote>
<ul>
<li><code>keepalived</code><!-- raw HTML omitted -->åŒå®ä¾‹åŒä¸»æ¨¡å¼é…ç½®å®æˆ˜<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Keepalived</code>è¿˜æ”¯æŒå¤šå®ä¾‹å¤šä¸šåŠ¡åŒå‘ä¸»å¤‡æ¨¡å¼ï¼Œå³<code>A</code>ä¸šåŠ¡åœ¨<code>keepalived-01</code>ä¸Šä¸»æ¨¡å¼æ˜¯ä¸»æ¨¡å¼ï¼Œåœ¨<code>keepalived-02</code>ä¸Šæ˜¯å¤‡æ¨¡å¼ï¼Œè€Œ<code>B</code>ä¸šåŠ¡åœ¨<code>keepalived-02</code>ä¸Šæ˜¯å¤‡æ¨¡å¼ï¼Œåœ¨<code>keepalived-02</code>ä¸Šæ˜¯ä¸»æ¨¡å¼.</li>
</ul>
</blockquote>
<ul>
<li><code>Keepalived</code><!-- raw HTML omitted -->åŒå®ä¾‹åŒä¸»æ¨¡å¼çš„<!-- raw HTML omitted --><code>ip</code><!-- raw HTML omitted -->åŠ<!-- raw HTML omitted --><code>VIP</code><!-- raw HTML omitted -->è§„åˆ’<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th style="text-align:left"><code>Hostname</code></th>
<th style="text-align:left"><code>IP</code></th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>keepalived-01</code></td>
<td style="text-align:left">10.0.0.5</td>
<td style="text-align:left"><code>VIPï¼š10.0.0.3</code>ï¼ˆç”¨äºç»‘å®š<code>A</code>æœåŠ¡www.etiantian.orgï¼‰</td>
</tr>
<tr>
<td style="text-align:left"><code>keepalived-02</code></td>
<td style="text-align:left">10.0.0.4</td>
<td style="text-align:left"><code>VIPï¼š10.0.0.4</code>ï¼ˆç”¨äºç»‘å®š<code>B</code>æœåŠ¡<code>blog.etiantian.org</code>ï¼‰</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->é¦–å…ˆé…ç½®<!-- raw HTML omitted --><code>keepalived-01</code> <code>10.0.0.5</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>keepalived.conf</code><!-- raw HTML omitted -->ï¼Œåœ¨å•å®ä¾‹çš„åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ª<!-- raw HTML omitted --><code>VIP_instance VI_2</code><!-- raw HTML omitted -->æ­¥éª¤åŠå†…å®¹å¦‚ä¸‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span>! Configuration File <span style="color:#66d9ef">for</span> keepalived
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>global_defs <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	notification_email <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		31333741@qq.com
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	notification_email_from  31333741@qq.com
</span></span><span style="display:flex;"><span>	smtp_server 127.0.0.1
</span></span><span style="display:flex;"><span>	smtp_connect_timeout <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>	router_id lb01
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># vrrp_script chk_nginx {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    script &#34;/root/chk_nginx.sh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    interval 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    weight 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># }</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_1 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state MASTER
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">51</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">150</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1111</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  10.0.0.3/24 dev eth0 label eth0:1  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_2 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state BACKUP
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1112</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  10.0.0.4/24 dev eth0 label eth0:2
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æç¤ºï¼šä»¥<!-- raw HTML omitted --><code>vrrp_instance VI_1</code><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>keepalived-01 10.0.0.5</code><!-- raw HTML omitted -->æœåŠ¡å™¨ä¸Šçš„è§’è‰²ä¸ºä¸»ï¼Œ<!-- raw HTML omitted --><code>vrrp_instance VI_2</code><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>keepalived-01 10.0.0.5</code><!-- raw HTML omitted -->æœåŠ¡å™¨ä¸Šçš„è§’è‰²ä¸ºå¤‡ ç„¶åå¸ƒç½®<!-- raw HTML omitted --><code>keepalived-02 10.0.0.6</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>keepalived.conf</code><!-- raw HTML omitted -->ï¼Œåœ¨å•å®ä¾‹çš„åŸºç¡€ä¸Šå¢åŠ <!-- raw HTML omitted --><code>vrrp_instance VI_2</code><!-- raw HTML omitted -->å®ä¾‹ï¼Œæ­¥éª¤å¦‚ä¸‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span>! Configuration File <span style="color:#66d9ef">for</span> keepalived
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>global_defs <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> notification_email <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     31333741@qq.com
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> notification_email_from  31333741@qq.com
</span></span><span style="display:flex;"><span> smtp_server 127.0.0.1
</span></span><span style="display:flex;"><span> smtp_connect_timeout <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span> router_id lb02
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_1 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state BACKUP
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">51</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1111</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>10.0.0.3/24 dev eth0 label eth0:1  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_2 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state MASTER
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">150</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1112</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>10.0.0.4/24 dev eth0 label eth0:2
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æç¤ºï¼šä»¥<!-- raw HTML omitted --><code>vrrp_instance VI_1</code>åœ¨<code>keepalived-02 10.0.0.6</code><!-- raw HTML omitted -->æœåŠ¡å™¨ä¸Šçš„è§’è‰²ä¸ºå¤‡ï¼Œ<!-- raw HTML omitted --><code>vrrp_instance VI_2</code>åœ¨<code>keepalived-02 10.0.0.6</code><!-- raw HTML omitted -->æœåŠ¡å™¨ä¸Šçš„è§’è‰²ä¸ºä¸» æ¥ç€åœ¨<!-- raw HTML omitted --><code>keepalived-01</code>ã€<code>keepalived-02</code><!-- raw HTML omitted -->ä¸Šåˆ†åˆ«é‡å¯<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œè§‚å¯Ÿåˆå§‹<!-- raw HTML omitted --><code>VIP</code><!-- raw HTML omitted -->è®¾ç½®æƒ…å†µ<!-- raw HTML omitted --><code> Lb01</code><!-- raw HTML omitted -->æ“ä½œæƒ…å†µå¦‚ä¸‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived restart</span>
</span></span><span style="display:flex;"><span>åœæ­¢ keepalivedï¼š                                        <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>æ­£åœ¨å¯åŠ¨ keepalivedï¼š                                    <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep -E &#34;10.0.0.3|0.4&#34;</span>
</span></span><span style="display:flex;"><span>inet 10.0.0.3/24 scope global secondary eth0:1
</span></span><span style="display:flex;"><span>inet 10.0.0.4/24 scope global secondary eth0:2</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æç¤ºï¼šå¯åŠ¨<!-- raw HTML omitted --><code>keepalived-02</code><!-- raw HTML omitted -->åï¼Œåˆå§‹çŠ¶æ€å·²ç»å¯åŠ¨äº†<!-- raw HTML omitted --><code>10.0.0.4VIP</code>ï¼Œå³<code>keepalived-02</code>ç”±<code>VI_2</code><!-- raw HTML omitted -->å®ä¾‹é…ç½®çš„<!-- raw HTML omitted --><code>VIP</code><!-- raw HTML omitted -->å¯¹å¤–æä¾›æœåŠ¡ï¼Œåˆ—å…¥å¯ä»¥æŠŠ<!-- raw HTML omitted --><code>blog.etiantian.org</code><!-- raw HTML omitted -->è§£æåˆ°<!-- raw HTML omitted --><code>10.0.0.4</code><!-- raw HTML omitted -->ä¸Š ä¸‹é¢åœæ‰ä»»æ„ä¸€ç«¯æœåŠ¡å™¨æˆ–è€…<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œç„¶åæŸ¥çœ‹<!-- raw HTML omitted --><code>vip</code><!-- raw HTML omitted -->æ˜¯ä¸æ˜¯ä¼šæ¼‚ç§»åˆ°å¦ä¸€ç«¯ã€‚åœæ‰<!-- raw HTML omitted --><code>keepalived-01</code>çš„<code>keepalived</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived stop</span>
</span></span><span style="display:flex;"><span>åœæ­¢ keepalivedï¼š                                        <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep -E &#34;10.0.0.3|0.4&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># # æ­¤å¤„æ— ä»»ä½•ä¿¡æ¯</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åœæ‰<!-- raw HTML omitted --><code>keepalived-01</code><!-- raw HTML omitted -->åï¼Œ<!-- raw HTML omitted --><code>vip 10.0.0.3</code><!-- raw HTML omitted -->å³è¢«é‡Šæ”¾,æ£€æŸ¥<!-- raw HTML omitted --><code>keepalived-02</code>æœåŠ¡å™¨ä¸Š<code>vip</code><!-- raw HTML omitted -->çš„æ¥ç®¡æƒ…å†µ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>keepalived-02</code>å·²å°†æ¥ç®¡äº†<code>keepalived-01</code>çš„<code>vip 10.0.0.3</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep -E &#34;10.0.0.3|0.4&#34;</span>
</span></span><span style="display:flex;"><span>    inet 10.0.0.4/24 scope global secondary eth0:2
</span></span><span style="display:flex;"><span>    inet 10.0.0.3/24 scope global secondary eth0:1</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="é—®é¢˜æ’æŸ¥">é—®é¢˜æ’æŸ¥</h3>
<h4 id="è£‚è„‘é—®é¢˜">è£‚è„‘é—®é¢˜</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä»€ä¹ˆæ˜¯è£‚è„‘<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ç”±äºæŸäº›åŸå› ï¼Œå¯¼è‡´ä¸¤å°é«˜å¯ç”¨æœåŠ¡å™¨å¯¹åœ¨æŒ‡å®šæ—¶é—´å†…æ— æ³•æ£€æµ‹åˆ°å¯¹æ–¹çš„å¿ƒè·³æ¶ˆæ¯ã€‚å„è‡ªå–å¾—èµ„æºåŠæœåŠ¡çš„æ‰€æœ‰æƒï¼Œè€Œæ­¤æ—¶çš„ä¸¤å°é«˜å¯ç”¨æœåŠ¡å™¨å¯¹éƒ½è¿˜æ´»ç€å¹¶åœ¨æ­£å¸¸è¿è¡Œç€ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´åŒä¸€ä¸ª<code>ip</code>æˆ–æœåŠ¡åœ¨ä¸¤ç«¯åŒæ—¶å­˜åœ¨è€Œå‘ç”Ÿå†²çªï¼Œæœ€ä¸¥é‡çš„æ˜¯ä¸¤å°ä¸»æœºå ç”¨ä¸€ä¸ªVIPåœ°å€ï¼Œå½“ç”¨æˆ·å†™å…¥æ•°æ®æ—¶å¯èƒ½ä¼šåˆ†åˆ«å†™å…¥åˆ°ä¸¤ç«¯ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨ä¸¤ç«¯æ•°æ®ä¸ä¸€è‡´æˆ–é€ æˆæ•°æ®ä¸¢å¤±ï¼Œè¿™ç§æƒ…å†µç§°ä¸ºè„‘è£‚</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯¼è‡´è„‘è£‚å‘ç”Ÿçš„åŸå› <!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ä¸€èˆ¬æ¥è¯´è„‘è£‚çš„å‘ç”Ÿï¼Œæœ‰ä»¥ä¸‹å‡ ç§åŸå› ï¼š é«˜å¯ç”¨æœåŠ¡å™¨ä¹‹é—´å¿ƒè·³çº¿è·¯å‘ç”Ÿæ•…éšœï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸é€šä¿¡</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¿ƒè·³çº¿åäº†(åŒ…æ‹¬æ–­äº†ï¼Œè€åŒ–)<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ç½‘å¡åŠç›¸å…³é©±åŠ¨åäº†ï¼Œ<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->é…ç½®åŠå†²çª<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¿ƒè·³çº¿è¿æ¥çš„è®¾å¤‡æ•…éšœï¼ˆç½‘å¡åŠäº¤æ¢æœºï¼‰<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä»²è£çš„æœºå™¨å‡ºé—®é¢˜<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>é«˜å¯ç”¨æœåŠ¡å™¨ä¸Šå¼€å¯äº†<code>iptableable</code>é˜²ç«å¢™é˜»æŒ¡äº†å¿ƒè·³æ¶ˆæ¯ä¼ è¾“</li>
<li>é«˜å¯ç”¨æœåŠ¡å™¨ä¸Šå¿ƒè·³ç½‘å¡åœ°å€ç­‰ä¿¡æ¯é…ç½®ä¸æ­£ç¡®ï¼Œå¯¼è‡´å‘é€å¿ƒè·³å¤±è´¥</li>
<li>å…¶ä»–æœåŠ¡å™¨é…ç½®ä¸å½“ç­‰åŸå› ï¼Œå¿ƒè·³å¹¿æ’­å†²çªã€‚è½¯ä»¶<code>BUG</code>ç­‰</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æç¤ºï¼š<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->é…ç½®é‡ŒåŒä¸€<!-- raw HTML omitted --><code>VRRP</code><!-- raw HTML omitted -->å®ä¾‹å¦‚æœ<!-- raw HTML omitted --><code>virtual_router_id</code><!-- raw HTML omitted -->ä¸¤ç«¯å‚æ•°é…ç½®ä¸ä¸€è‡´ï¼Œä¹Ÿä¼šå¯¼è‡´è„‘è£‚é—®é¢˜å‘ç”Ÿ<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h5 id="è„‘è£‚æ’æŸ¥">è„‘è£‚æ’æŸ¥</h5>
<blockquote>
<ul>
<li>å‡ºç°ä¸Šè¿°æ— ä»»ä½•ç»“æœçš„ç°è±¡ï¼Œè¡¨ç¤º<code>keepalived-02</code>çš„<code>keepalived</code>æœåŠ¡å•å®ä¾‹é…ç½®æˆåŠŸã€‚å¦‚æœ<code>keepalived-02</code>é…ç½®è¿‡æ»¤åå‡ºç°<code>10.0.0.3</code>çš„<code>ip</code>ã€‚åˆ™è¡¨ç¤º<code>keepalived</code>å·¥ä½œä¸æ­£å¸¸ï¼ŒåŒä¸€ä¸ª<code>IP</code>åœ°å€åŒä¸€æ—¶åˆ»åº”è¯¥åªèƒ½å‡ºç°ä¸€å°æœåŠ¡å™¨ã€‚</li>
<li>å¦‚æœæŸ¥çœ‹<code>backup</code>å¤‡èŠ‚ç‚¹<code>vip</code>æœ‰å¦‚ä¸‹ä¿¡æ¯ï¼Œè¯´æ˜<!-- raw HTML omitted -->é«˜å¯ç”¨<!-- raw HTML omitted -->è„‘è£‚äº†ï¼Œè£‚è„‘æ˜¯ä¸¤å°æœåŠ¡å™¨äº‰æŠ¢åŒä¸€èµ„æºå¯¼è‡´çš„ï¼Œä¾‹å¦‚:ä¸¤è¾¹éƒ½é…ç½®äº†åŒä¸€ä¸ª<code>ip</code>ï¼Œä¸€èˆ¬è¦å…ˆè€ƒè™‘æ’æŸ¥ä¸¤ä¸ªåœ°æ–¹</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸»å¤‡ä¸¤å°æœåŠ¡å™¨ä¹‹é—´æ˜¯å¦é€šä¿¡æ­£å¸¸ï¼Œå¦‚æœä¸æ­£å¸¸æ˜¯å¦æœ‰<!-- raw HTML omitted --><code>iptables</code><!-- raw HTML omitted -->é˜²ç«å¢™é˜»æŒ¡<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä¸»å¤‡ä¸¤å°æœåŠ¡å™¨å¯¹åº”çš„<!-- raw HTML omitted --><code>keepalived.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é”™è¯¯ï¼Ÿä¾‹å¦‚ï¼šæ˜¯å¦åŒä¸€å®ä¾‹çš„<!-- raw HTML omitted --><code>virtual_router_id</code><!-- raw HTML omitted -->é…ç½®ä¸ä¸€è‡´<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.3</span>
</span></span><span style="display:flex;"><span>  inet 10.0.0.3/24 scope global secondary eth0:1</span></span></code></pre></div></blockquote>
</blockquote>
</blockquote>
<hr>
<h5 id="è„‘è£‚è§£å†³å¸¸è§æ–¹æ¡ˆ">è„‘è£‚è§£å†³å¸¸è§æ–¹æ¡ˆ</h5>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åŒæ—¶ä½¿ç”¨ä¸²è¡Œç”µç¼†å’Œä»¥å¤ªç½‘ç”µç¼†è¿æ¥ï¼ŒåŒæ—¶ç”¨ä¸¤æ¡å¿ƒè·³çº¿è·¯ï¼Œè¿™æ ·ä¸€æ¡çº¿è·¯åäº†ï¼Œå¦ä¸€æ¡çº¿è·¯è¿˜æ˜¯å¥½çš„ï¼Œä¾ç„¶èƒ½å¤Ÿä¼ é€å¿ƒè·³ä¿¡æ¯<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å½“æ£€æµ‹åˆ°è„‘è£‚æ—¶å¼ºè¡Œå…³é—­ä¸€ä¸ªå¿ƒè·³èŠ‚ç‚¹ï¼ˆè¿™ä¸ªåŠŸèƒ½éœ€è¦ç‰¹æ®Šè®¾å¤‡æ”¯æŒï¼Œå¦‚<!-- raw HTML omitted --><code>Stonithã€fenceï¼‰</code><!-- raw HTML omitted -->ã€‚ç›¸å½“äºèŠ‚ç‚¹ä¿¡æ¯æ¥æ”¶ä¸åˆ°å¿ƒè·³ä¿¡æ¯ï¼Œé€šè¿‡å•ç‹¬çš„çº¿è·¯å‘é€æœºå…³å‘½ä»¤å…³é—­ä¸»èŠ‚ç‚¹ç”µæº<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->åšå¥½è£‚è„‘çš„ç›‘æ§è­¦æŠ¥<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h5 id="ç¼–å†™ç›‘æ§keepalivedè„‘è£‚è„šæœ¬">ç¼–å†™ç›‘æ§<code>Keepalived</code>è„‘è£‚è„šæœ¬</h5>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ£€æµ‹æ€è·¯ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>åœ¨å¤‡èŠ‚ç‚¹ä¸Šæ‰§è¡Œè„šæœ¬ï¼Œå¦‚æœå¯ä»¥<code>ping</code>é€šä¸»èŠ‚ç‚¹å¹¶ä¸”å¤‡èŠ‚ç‚¹æœ‰<code>VIP</code>å°±æŠ¥è­¦</li>
<li>è®©äººå‘˜ä»‹å…¥æ£€æŸ¥æ˜¯å¦è£‚è„‘ã€‚</li>
<li>åœ¨<code>keepalived-02</code>å¤‡èŠ‚ç‚¹å¼€å‘è„šæœ¬å¹¶æ‰§è¡Œ</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;check_split_brain.sh&lt;&lt;-EOF </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/sh</span>
</span></span><span style="display:flex;"><span>keepalived-01_vip<span style="color:#f92672">=</span>10.0.0.12
</span></span><span style="display:flex;"><span>keepalived-01_ip<span style="color:#f92672">=</span>10.0.0.7
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> true
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span> ping -c <span style="color:#ae81ff">2</span> -W <span style="color:#ae81ff">3</span> <span style="color:#e6db74">${</span><span style="color:#e6db74">&#34;keepalived-01_ip&#34;</span><span style="color:#e6db74">}</span> &amp;&gt;/dev/null 
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $ -eq <span style="color:#ae81ff">0</span> -a <span style="color:#e6db74">`</span>ip add|grep <span style="color:#e6db74">${</span><span style="color:#e6db74">&#34;keepalived-01_vip&#34;</span><span style="color:#e6db74">}</span>|wc -l<span style="color:#e6db74">`</span> -eq <span style="color:#ae81ff">1</span> <span style="color:#f92672">]</span>  
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">then</span>    
</span></span><span style="display:flex;"><span>     echo <span style="color:#e6db74">&#34;ha is split brain.warning.&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">else</span>    
</span></span><span style="display:flex;"><span>     echo <span style="color:#e6db74">&#34;ha is ok&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span> sleep <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>EOF
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sh check_split_brain.sh  </span>
</span></span><span style="display:flex;"><span>ha is okha is ok</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ­£å¸¸æƒ…å†µä¸‹ä¸»èŠ‚ç‚¹æ´»ç€ï¼Œ<!-- raw HTML omitted --><code>VIP 10.0.0.12</code><!-- raw HTML omitted -->åœ¨ä¸»èŠ‚ç‚¹ï¼Œå› æ­¤ä¸ä¼šæŠ¥è­¦æç¤º<!-- raw HTML omitted --><code>ha is ok</code>ã€‚ <code>keepalived-01</code> åœæ­¢<code>Keepalived</code><!-- raw HTML omitted -->æœåŠ¡çœ‹<!-- raw HTML omitted --><code>keepalived-02</code><!-- raw HTML omitted -->è„šæœ¬æ‰§è¡Œæƒ…å†µ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived stop</span>
</span></span><span style="display:flex;"><span>åœæ­¢ keepalivedï¼š                                          <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep 10.0.0.12 </span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>keepalived-02</code><!-- raw HTML omitted -->ä¸Šè§‚å¯Ÿå³å¯ï¼Œæ­¤å‰è„šæœ¬å·²ç»æ‰§è¡Œ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sh check_split_brain.sh</span>
</span></span><span style="display:flex;"><span>ha is okha is ok
</span></span><span style="display:flex;"><span>ha is split brain.warning.
</span></span><span style="display:flex;"><span>ha is split brain.warning.
</span></span><span style="display:flex;"><span>ha is split brain.warning.</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å…³æ‰<!-- raw HTML omitted --><code>keepalived-01</code><!-- raw HTML omitted -->æœåŠ¡å™¨ï¼Œç„¶åå†è§‚å¯Ÿ<!-- raw HTML omitted --><code>keepalived-02</code><!-- raw HTML omitted -->è„šæœ¬çš„è¾“å‡º<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sh check_split_brain.sh </span>
</span></span><span style="display:flex;"><span>ha is okha is ok
</span></span><span style="display:flex;"><span>ha is split brain.warning.
</span></span><span style="display:flex;"><span>ha is split brain.warning.
</span></span><span style="display:flex;"><span>ha is split brain.warning.
</span></span><span style="display:flex;"><span>ha is ok
</span></span><span style="display:flex;"><span>ha is ok
</span></span><span style="display:flex;"><span>ha is ok</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="nginxé…ç½®è´Ÿè½½"><code>nginx</code>é…ç½®è´Ÿè½½</h4>
<blockquote>
<ul>
<li>ç»“åˆ<code>nginx</code>è´Ÿè½½å‡è¡¡çš„ç¯å¢ƒï¼Œä¸¤è¾¹<code>keepalived-01</code>å’Œ<code>keepalived-02</code>çš„é…ç½®ç¯å¢ƒä¸€æ · <strong>è¿™é‡Œä½¿ç”¨<code>nginx</code>è´Ÿè½½å‡è¡¡çš„é…ç½®å¦‚ä¸‹ï¼š</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/usr/local/nginx/conf/nginx.conf&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span>worker_processes  1;
</span></span><span style="display:flex;"><span>events <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>worker_connections  1024;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>http <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>include       mime.types;
</span></span><span style="display:flex;"><span>default_type  application/octet-stream;
</span></span><span style="display:flex;"><span>sendfile        on;
</span></span><span style="display:flex;"><span>keepalive_timeout  65;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>upstream server_pools <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   server 10.0.0.7:80  weight<span style="color:#f92672">=</span>1;
</span></span><span style="display:flex;"><span>   server 10.0.0.8:80  weight<span style="color:#f92672">=</span>1;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  listen       10.0.0.3:80;
</span></span><span style="display:flex;"><span>  server_name  www.etiantian.org;
</span></span><span style="display:flex;"><span>  location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      proxy_pass http://server_pools;
</span></span><span style="display:flex;"><span>  include proxy.conf;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  listen       10.0.0.3:80;
</span></span><span style="display:flex;"><span>  server_name  bbs.etiantian.org;
</span></span><span style="display:flex;"><span>  location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      proxy_pass http://server_pools;
</span></span><span style="display:flex;"><span>   include proxy.conf;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  listen       10.0.0.4:80;
</span></span><span style="display:flex;"><span>  server_name  blog.etiantian.org;
</span></span><span style="display:flex;"><span>  location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      proxy_pass http://server_pools;
</span></span><span style="display:flex;"><span>     include proxy.conf;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
<ul>
<li><code>keepalived-01</code><!-- raw HTML omitted -->ä¸Šé…ç½®<!-- raw HTML omitted --><code>keepalived.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span>! Configuration File <span style="color:#66d9ef">for</span> keepalived
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>global_defs <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>notification_email <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>31333741@qq.com
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>notification_email_from  31333741@qq.com
</span></span><span style="display:flex;"><span>smtp_server 127.0.0.1
</span></span><span style="display:flex;"><span>smtp_connect_timeout <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>router_id lb01
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_1 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state MASTER
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">51</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">150</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1111</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>10.0.0.3/24 dev eth0 label eth0:1  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_2 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state BACKUP
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1112</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>10.0.0.4/24 dev eth0 label eth0:2
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
<ul>
<li><code>keepalived-02</code><!-- raw HTML omitted -->ä¸Šé…ç½®<!-- raw HTML omitted --><code>keepalived.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span>! Configuration File <span style="color:#66d9ef">for</span> keepalived
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>global_defs <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>notification_email <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>31333741@qq.com
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>notification_email_from  31333741@qq.com
</span></span><span style="display:flex;"><span>smtp_server 127.0.0.1
</span></span><span style="display:flex;"><span>smtp_connect_timeout <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>router_id lb02
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_1 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state BACKUP
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">51</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1111</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>10.0.0.3/24 dev eth0 label eth0:1  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_2 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>state MASTER
</span></span><span style="display:flex;"><span>interface eth0
</span></span><span style="display:flex;"><span>virtual_router_id <span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>priority <span style="color:#ae81ff">150</span>
</span></span><span style="display:flex;"><span>advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  auth_type PASS
</span></span><span style="display:flex;"><span>  auth_pass <span style="color:#ae81ff">1112</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>10.0.0.4/24 dev eth0 label eth0:2
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="è§£å†³ç›‘å¬çš„æœåŠ¡ç½‘å¡ä¸Šä¸å­˜åœ¨ipåœ°å€é—®é¢˜">è§£å†³ç›‘å¬çš„æœåŠ¡ç½‘å¡ä¸Šä¸å­˜åœ¨<code>IP</code>åœ°å€é—®é¢˜</h4>
<blockquote>
<ul>
<li>å¦‚æœé…ç½®ä½¿ç”¨<code>listen 10.0.0.3:80</code> çš„æ–¹å¼æŒ‡å®š<code>IP</code>ç›‘å¬æœåŠ¡ï¼Œè€Œæœ¬åœ°çš„ç½‘å¡ä¸Šæ²¡æœ‰<code>10.0.0.3</code>è¿™ä¸ª<code>IPï¼Œnginx</code>å°±ä¼šæŠ¥é”™ï¼Œå¦‚ï¼šå‡ºç°ä¸Šè¿°çš„åŸå› æ˜¯åœ¨ç‰©ç†ç½‘å¡ä¸Šæ²¡æœ‰é…ç½®ä¸æ–‡ä»¶é‡Œç›‘å¬çš„<code>IP</code>ç›¸å¯¹åº”çš„<code>IP</code>ï¼Œè§£å†³åŠæ³•æ˜¯åœ¨<code>/etc/sysctl.conf</code>ä¸­åŠ å…¥å¦‚ä¸‹å‚æ•°ï¼š</li>
<li>æ­¤é¡¹è¡¨ç¤ºå¯åŠ¨<code>nginx</code>è€Œå¿½è§†é…ç½®ä¸­ç›‘å¬çš„VIPæ˜¯å¦å­˜åœ¨ï¼Œå®ƒåŒæ ·é€‚åˆ<code>Haproxy</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># echo &#34;net.ipv4.ip_nonlocal_bind = 1&#34; &gt;&gt;/etc/sysctl.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sysctl -p</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="è§£å†³é«˜å¯ç”¨æœåŠ¡åªé’ˆå¯¹ç‰©ç†æœåŠ¡å™¨çš„é—®é¢˜">è§£å†³é«˜å¯ç”¨æœåŠ¡åªé’ˆå¯¹ç‰©ç†æœåŠ¡å™¨çš„é—®é¢˜</h4>
<blockquote>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹<code>keepalived</code>è½¯ä»¶ä»…ä»…åœ¨å¯¹æ–¹æœºå™¨å®•æœºæˆ–<code>keepalived</code>åœæ‰çš„æ—¶å€™æ‰ä¼šæ¥ç®¡ä¸šåŠ¡ï¼Œä½†åœ¨å®é™…è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸šåŠ¡æœåŠ¡åœæ­¢è€Œ<code>keepalived</code>æœåŠ¡è¿˜åœ¨å·¥ä½œçš„æƒ…å†µï¼Œè¿™å°±ä¼šå¯¼è‡´ç”¨æˆ·è®¿é—®<code>VIP</code>æ— æ³•æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡</li>
<li><!-- raw HTML omitted -->æ–¹æ³•ä¸€ï¼š<!-- raw HTML omitted -->å¯ä»¥å†™å®ˆæŠ¤è¿›ç¨‹è„šæœ¬æ¥å¤„ç†ã€‚å½“<code>nginx</code>ä¸šåŠ¡æœ‰é—®é¢˜æ—¶ï¼Œå°±åœæ‰æœ¬åœ°çš„<code>keepalived</code>æœåŠ¡ï¼Œå®ç°<code>IP</code>æ¼‚ç§»åˆ°å¯¹ç«¯ç»§ç»­æä¾›æœåŠ¡ã€‚å®é™…å·¥ä½œä¸­éƒ¨ç½²åŠå¼€å‘çš„ç¤ºä¾‹è„šæœ¬</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ­¤è„šæœ¬çš„æ€è·¯æ˜¯å¦‚æ²¡æœ‰<!-- raw HTML omitted --><code>80</code><!-- raw HTML omitted -->ç«¯å£å­˜åœ¨ï¼Œå°±åœæ‰<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡å®ç°é‡Šæ”¾æœ¬åœ°çš„<!-- raw HTML omitted --><code>VIP</code><!-- raw HTML omitted -->åœ¨åå°æ‰§è¡Œä¸Šè¿°è„šæœ¬<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/server/scripts/check_nginx.sh&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/sh</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> true
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">`</span>netstat -lntup|grep nginx|wc -l<span style="color:#e6db74">`</span> -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    /etc/init.d/keepalived stop
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>  sleep <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>EOF
</span></span><span style="display:flex;"><span>$ sh server/scripts/check_nginx.sh &amp;
</span></span><span style="display:flex;"><span>$ ps -ef|grep check|grep -v grep
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">8580</span>   <span style="color:#ae81ff">8394</span>  <span style="color:#ae81ff">0</span> 16:19 pts/0    00:00:00 sh check_nginx.s</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¡®å®š<!-- raw HTML omitted --><code>nginx</code><!-- raw HTML omitted -->ä»¥åŠ<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡æ˜¯å¦æ­£å¸¸<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># netstat -lntup|grep nginx</span>
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 10.0.0.4:80                 0.0.0.0:*                   LISTEN      8541/nginx          
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 10.0.0.3:80                 0.0.0.0:*                   LISTEN      8541/nginx          
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived status</span>
</span></span><span style="display:flex;"><span>keepalived <span style="color:#f92672">(</span>pid  8438<span style="color:#f92672">)</span> æ­£åœ¨è¿è¡Œ...</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç„¶åæ¨¡æ‹Ÿ<!-- raw HTML omitted --><code>nginx</code><!-- raw HTML omitted -->æœåŠ¡æŒ‚æ‰ï¼Œçœ‹<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->æ˜¯å¦ä¼šå‘ç”Ÿåˆ‡æ¢<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /usr/local/nginx/sbin/nginx -s stop</span>
</span></span><span style="display:flex;"><span> åœæ­¢ keepalivedï¼š       <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/keepalived status</span>
</span></span><span style="display:flex;"><span>keepalived       å·²åœ
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># netstat -lntup|grep nginx            </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ­¤æ—¶å¤‡èŠ‚ç‚¹æ¥ç®¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-02 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ip add|grep -E &#34;10.0.0.3|0.4&#34;</span>
</span></span><span style="display:flex;"><span>    inet 10.0.0.3/24 scope global secondary eth0:1
</span></span><span style="display:flex;"><span>    inet 10.0.0.4/24 scope global secondary eth0:2</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ–¹æ³•äºŒï¼š<!-- raw HTML omitted -->å¯ä»¥ä½¿ç”¨<code>keepalived</code>çš„é…ç½®è„šæœ¬å‚æ•°è§¦å‘å†™å¥½çš„ç›‘æµ‹æœåŠ¡è„šæœ¬ é¦–å…ˆè¦å¼€å‘ç›‘æµ‹æœåŠ¡è„šæœ¬ï¼Œæ³¨æ„:è¿™ä¸ªè„šæœ¬ä¸ä¸Šä¸€ä¸ªçš„ä¸åŒ</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/server/scripts/chk_nginx_proxy.sh&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/sh</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">`</span>netstat -lntup|grep nginx|wc -l<span style="color:#e6db74">`</span> -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>/etc/init.d/keepalived stop
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>EOF
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># chmod +x /server/scripts/chk_nginx_proxy.sh </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll /server/scripts/chk_nginx_proxy.sh </span>
</span></span><span style="display:flex;"><span>-rwxr-xr-x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">99</span> 6æœˆ  <span style="color:#ae81ff">10</span> 16:30 chk_nginx_proxy.sh
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ­¤æ—¶<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡çš„å®Œæ•´é…ç½®ä¸º<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span>! Configuration File <span style="color:#66d9ef">for</span> keepalived
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>global_defs <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   notification_email <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   31333741@qq.com
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   notification_email_from  31333741@qq.com
</span></span><span style="display:flex;"><span>   smtp_server 127.0.0.1
</span></span><span style="display:flex;"><span>   smtp_connect_timeout <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>   router_id lb01
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>vrrp_script chk_nginx_proxy <span style="color:#f92672">{</span>  	<span style="color:#75715e"># å®šä¹‰vrrpè„šæœ¬ï¼Œæ£€æµ‹HTTPç«¯å£ã€‚</span>
</span></span><span style="display:flex;"><span>script <span style="color:#e6db74">&#34;/server/scripts/chk_nginx_proxy.sh&#34;</span>  	<span style="color:#75715e"># æ‰§è¡Œè„šæœ¬ï¼Œå½“nginxæœåŠ¡æœ‰é—®é¢˜ï¼Œå°±åœæ‰keepalivedæœåŠ¡ã€‚</span>
</span></span><span style="display:flex;"><span>interval <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># é—´éš”2ç§’</span>
</span></span><span style="display:flex;"><span>weight <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_1 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    state MASTER
</span></span><span style="display:flex;"><span>    interface eth0
</span></span><span style="display:flex;"><span>    virtual_router_id <span style="color:#ae81ff">51</span>
</span></span><span style="display:flex;"><span>    priority <span style="color:#ae81ff">150</span>
</span></span><span style="display:flex;"><span>    advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        auth_type PASS
</span></span><span style="display:flex;"><span>        auth_pass <span style="color:#ae81ff">1111</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     10.0.0.3/24 dev eth0 label eth0:1  
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     track_script <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    chk_nginx_proxy        <span style="color:#75715e">#è§¦å‘æ£€æŸ¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vrrp_instance VI_2 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    state BACKUP
</span></span><span style="display:flex;"><span>    interface eth0
</span></span><span style="display:flex;"><span>    virtual_router_id <span style="color:#ae81ff">52</span>
</span></span><span style="display:flex;"><span>    priority <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>    advert_int <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    authentication <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        auth_type PASS
</span></span><span style="display:flex;"><span>        auth_pass <span style="color:#ae81ff">1112</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    virtual_ipaddress <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     10.0.0.4/24 dev eth0 label eth0:2
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ³¨æ„ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vrrp_script chk_nginx_proxy <span style="color:#f92672">{</span>  <span style="color:#75715e"># &lt;==å®šä¹‰vrrpè„šæœ¬ï¼Œæ£€æµ‹HTTPç«¯å£ã€‚</span>
</span></span><span style="display:flex;"><span>script <span style="color:#e6db74">&#34;/server/scripts/chk_nginx_proxy.sh&#34;</span>  <span style="color:#75715e"># &lt;==æ‰§è¡Œè„šæœ¬ï¼Œå½“nginxæœåŠ¡æœ‰é—®é¢˜ï¼Œå°±åœæ‰keepalivedæœåŠ¡ã€‚</span>
</span></span><span style="display:flex;"><span>interval <span style="color:#ae81ff">2</span> <span style="color:#75715e"># &lt;==é—´éš”2ç§’</span>
</span></span><span style="display:flex;"><span>weight <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="è§£å†³å¤šç»„keepalivedæœåŠ¡å™¨åœ¨ä¸€ä¸ªå±€åŸŸç½‘çš„å†²çªé—®é¢˜">è§£å†³å¤šç»„<code>keepalived</code>æœåŠ¡å™¨åœ¨ä¸€ä¸ªå±€åŸŸç½‘çš„å†²çªé—®é¢˜</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯ä»¥åœ¨åŒç»„çš„<!-- raw HTML omitted --><code>keepalived</code><!-- raw HTML omitted -->æœåŠ¡å™¨æ‰€æœ‰é…ç½®æ–‡ä»¶é‡ŒæŒ‡å®šç‹¬ä¸€æ— äºŒçš„å¤šæ’­åœ°å€<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä¸åŒå®ä¾‹çš„è®¤è¯å¯†ç æœ€å¥½ä¸åŒ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>global_defs <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>router_id LVS_19
</span></span><span style="display:flex;"><span>vrrp_mcast_group4 224.0.0.19 <span style="color:#75715e"># &lt;==è¿™ä¸ªå°±æ˜¯æŒ‡å®šå¤šæ’­åœ°å€çš„é…ç½®</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="é…ç½®æŒ‡å®šæ–‡ä»¶æ¥æ”¶keepalivedæœåŠ¡æ—¥è®°">é…ç½®æŒ‡å®šæ–‡ä»¶æ¥æ”¶<code>keepalived</code>æœåŠ¡æ—¥è®°</h3>
<blockquote>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹<code>keepalived</code>æœåŠ¡æ—¥è®°ä¼šè¾“å‡ºåˆ°ç³»ç»Ÿæ—¥è®°<code>/var/log/messages</code>å’Œå…¶ä»–æ—¥è®°ä¿¡æ¯ä¼šæ··åˆåœ¨ä¸€èµ·ï¼Œå¾ˆä¸æ–¹ä¾¿ï¼Œå¯ä»¥å°†å…¶è°ƒæ•´ä¸ºç”±ç‹¬ç«‹çš„æ–‡ä»¶è®°å½•<code>keepalived</code>æœåŠ¡æ—¥è®°;æ“ä½œæ­¥éª¤å¦‚ä¸‹</li>
<li>ç¼–è¾‘é…ç½®æ–‡ä»¶<code>/etc/sysconfig/keepalived</code>ï¼Œå°†ç¬¬14è¡Œçš„<code>KEEPALIVED_OPTIONS=&quot;-D&quot;</code>ä¿®æ”¹ä¸º<code>KEEPALIVED_OPTIONS=&quot;-D -d -S 0&quot;</code>å¿«é€Ÿä¿®æ”¹æ–¹æ³•ï¼š</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#39;14 s#KEEPALIVED_OPTIONS=&#34;-D&#34;#KEEPALIVED_OPTIONS=&#34;-D -d -S 0&#34;#g&#39; /etc/sysconfig/keepalived </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -n &#39;14p&#39;  /etc/sysconfig/keepalived</span>
</span></span><span style="display:flex;"><span>KEEPALIVED_OPTIONS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-D -d -S 0&#34;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è¯´æ˜ï¼šå¯ä»¥æŸ¥çœ‹<!-- raw HTML omitted --><code>/etc/sysconfig/keepalived</code><!-- raw HTML omitted -->é‡Œæ³¨é‡Šè·å¾—ä¸Šè¿°å‚æ•°çš„è¯´æ˜<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># --dump-conf       -d     å¯¼å‡ºå¤‡ä»½é…ç½®æ•°æ®</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --log-detail      -D     è¯¦ç»†æ—¥å¿—</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --log-facility    -S     è®¾ç½®æœ¬åœ°çš„syslogè®¾å¤‡ï¼Œç¼–å·0-7ï¼ˆdefault=LOG_DAEMONï¼‰</span>
</span></span><span style="display:flex;"><span>* -S <span style="color:#ae81ff">0</span> è¡¨ç¤ºæŒ‡å®šä¸ºlocal0è®¾å¤‡</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>rsyslog</code><!-- raw HTML omitted -->çš„é…ç½®æ–‡ä»¶<!-- raw HTML omitted --><code>vim /etc/rsyslog.conf</code><!-- raw HTML omitted -->ï¼Œåœ¨ç»“å°¾å¤„åŠ å…¥å¦‚ä¸‹2è¡Œå†…å®¹ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>é…ç½®è¡¨ç¤ºæ¥è‡ª<code>local0è®¾</code>å¤‡çš„æ‰€æœ‰æ—¥å¿—ä¿¡æ¯éƒ½è®°å½•åˆ°<code>/var/log/keepalived.log</code>æ–‡ä»¶ã€‚ ç„¶ååœ¨çº¦ç¬¬42è¡Œå¦‚ä¸‹ä¿¡æ¯çš„ç¬¬ä¸€åˆ—ç»“å°¾åŠ å…¥<code>â€œï¼›local0.noneâ€ï¼š</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># keepalived</span>
</span></span><span style="display:flex;"><span>local0.*  /var/log/keepalived.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®è¡¨ç¤ºæ¥è‡ªlocal0è®¾å¤‡çš„æ‰€æœ‰æ—¥å¿—ä¿¡æ¯ä¸å†è®°å½•äº/var/log/messagesé‡Œã€‚ 3 é…ç½®å®Œæˆåï¼Œé‡å¯rsyslogæœåŠ¡ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#39;42 s#*.info;mail.none;authpriv.none;cron.none#*.info;mail.none;authpriv.none;cron.none;local0.none#g&#39; /etc/rsyslog.conf </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -n &#39;42p&#39; /etc/rsyslog.conf </span>
</span></span><span style="display:flex;"><span>*.info;mail.none;authpriv.none;cron.none;local0.none                /var/log/messages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@keepalived-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># /etc/init.d/rsyslog restart</span>
</span></span><span style="display:flex;"><span>å…³é—­ç³»ç»Ÿæ—¥å¿—è®°å½•å™¨ï¼š     <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>å¯åŠ¨ç³»ç»Ÿæ—¥å¿—è®°å½•å™¨ï¼š            <span style="color:#f92672">[</span>ç¡®å®š<span style="color:#f92672">]</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æµ‹è¯•<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->æ—¥å¿—è®°å½•ç»“æœã€‚åœ¨é‡å¯<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->æœåŠ¡åï¼Œå°±ä¼šæŠŠæ—¥å¿—ä¿¡æ¯è¾“å‡ºåˆ°<!-- raw HTML omitted --><code>rsyslog</code><!-- raw HTML omitted -->å®šä¹‰çš„<!-- raw HTML omitted --><code>/var/log/ keepalived.log</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å¦‚æœè¦æ±‚æ›´é«˜ï¼Œè¿˜å¯ä»¥åœ¨<code>/var/log/messages</code>ä¸Šè®¾ç½®å¯¹<code>/var/log/keepalived.log</code>è¿›è¡Œè½®è¯¢ï¼Œä»¥é˜²å•ä¸ªæ—¥å¿—æ–‡ä»¶å˜å¾—å¤ªå¤§</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived<span style="color:#f92672">[</span>10852<span style="color:#f92672">]</span>: Stopping Keepalived v1.2.13 <span style="color:#f92672">(</span>03/19,2015<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived_vrrp<span style="color:#f92672">[</span>10855<span style="color:#f92672">]</span>: VRRP_Instance<span style="color:#f92672">(</span>VI_1<span style="color:#f92672">)</span> sending <span style="color:#ae81ff">0</span> priority
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived_vrrp<span style="color:#f92672">[</span>10855<span style="color:#f92672">]</span>: VRRP_Instance<span style="color:#f92672">(</span>VI_1<span style="color:#f92672">)</span> removing protocol VIPs.
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived_vrrp<span style="color:#f92672">[</span>10855<span style="color:#f92672">]</span>: VRRP_Instance<span style="color:#f92672">(</span>VI_2<span style="color:#f92672">)</span> sending <span style="color:#ae81ff">0</span> priority
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived_vrrp<span style="color:#f92672">[</span>10855<span style="color:#f92672">]</span>: VRRP_Instance<span style="color:#f92672">(</span>VI_2<span style="color:#f92672">)</span> removing protocol VIPs.
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived_healthcheckers<span style="color:#f92672">[</span>10854<span style="color:#f92672">]</span>: Netlink reflector reports IP 10.0.0.3 removed
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived_healthcheckers<span style="color:#f92672">[</span>10854<span style="color:#f92672">]</span>: Netlink reflector reports IP 10.0.0.4 removed
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">10</span> 22:38:03 lb01 Keepalived<span style="color:#f92672">[</span>10884<span style="color:#f92672">]</span>: Starting Keepalived v1.2.13 <span style="color:#f92672">(</span>03/19,2015<span style="color:#f92672">)</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="kubernetes">Kubernetes</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Kubernetes</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="kubernetes_template">Kubernetes_Template</h1>

<h1 id="èµ„æºæ§åˆ¶å™¨">èµ„æºæ§åˆ¶å™¨</h1>
<blockquote>

<pre class="mermaid align-center zoomable">graph LR
A[æ€ç»´å¯¼å›¾] --&gt;B[1.å‰è¨€]
A[æ€ç»´å¯¼å›¾] --&gt;C[2.Namespace]
A[æ€ç»´å¯¼å›¾] --&gt;D[3.Deployment]
A[æ€ç»´å¯¼å›¾] --&gt;E[4.StatefulSet]
A[æ€ç»´å¯¼å›¾] --&gt;F[5.DaemonSet]
A[æ€ç»´å¯¼å›¾] --&gt;G[6.HorizontalPodAutoscaler]
A[æ€ç»´å¯¼å›¾] --&gt;H[7.EndPoint]
A[æ€ç»´å¯¼å›¾] --&gt;I[8.Service]
A[æ€ç»´å¯¼å›¾] --&gt;J[9.Labelæ ‡ç­¾/Selectoré€‰æ‹©å™¨]
C[2.Namespace] --&gt;|a=1|C1[2.1æ¦‚è¿°]
C[2.Namespace] --&gt;|a=2|C2[2.2åº”ç”¨ç¤ºä¾‹]
D[3.Deployment] --&gt;|a=1|D1[3.1æ¦‚è¿°]
D[3.Deployment] --&gt;|a=2|D2[3.2è¯­æ³•ä»¥åŠåº”ç”¨ç¤ºä¾‹]
E[4.StatefulSet] --&gt;|a=1|E1[4.1æ¦‚è¿°]
E[4.StatefulSet] --&gt;|a=2|E2[4.2è¯­æ³•ä»¥åŠåº”ç”¨ç¤ºä¾‹]
F[5.DaemonSet] --&gt;|a=1|F1[5.1æ¦‚è¿°]
F[5.DaemonSet] --&gt;|a=2|F2[5.2è¯­æ³•ä»¥åŠåº”ç”¨ç¤ºä¾‹]
G[6.HorizontalPodAutoscaler] --&gt;|a=1|G1[6.1æ¦‚è¿°]
G[6.HorizontalPodAutoscaler] --&gt;|a=2|G2[6.2è¯­æ³•ä»¥åŠåº”ç”¨]
H[7.EndPoint] --&gt;|a=1|H1[7.1æ¦‚è¿°]
H[7.EndPoint] --&gt;|a=2|H2[7.2è¯­æ³•ä»¥åŠåº”ç”¨]
I[8.Service] --&gt;|a=1|I1[8.1æ¦‚è¿°]
I[8.Service] --&gt;|a=2|I2[8.2è¯­æ³•ä»¥åŠåº”ç”¨]
J[9.Labelæ ‡ç­¾/Selectoré€‰æ‹©å™¨] --&gt;|a=1|J1[9.1æ¦‚è¿°]
J[9.Labelæ ‡ç­¾/Selectoré€‰æ‹©å™¨] --&gt;|a=2|J2[9.2è¯­æ³•ä»¥åŠåº”ç”¨]

Z[æ¨ªå‘æµç¨‹å›¾]</pre>
<pre class="mermaid align-center zoomable">graph TD
A[Deployment] --&gt; D[ReplicaSet]
B[CronJob] --&gt; E[Job]
C[DaemonSet] --&gt; G{{å®¹å™¨}}
D[ReplicaSet] --&gt; G{{å®¹å™¨}}
E[Job] --&gt; G{{å®¹å™¨}}
F[StatefulSet] --&gt; G{{å®¹å™¨}}

G{{å®¹å™¨}} --&gt; J[/Volume\]
G{{å®¹å™¨}} --&gt; H(ServiceæœåŠ¡)

J[/Volume\] --&gt; K[/configMap\]
J[/Volume\] --&gt; L[/PVC\]
J[/Volume\] --&gt; M[/Secret\]

Z[Kubernetesæ§åˆ¶æµç¨‹]</pre><ul>
<li><!-- raw HTML omitted -->æ ‡ç­¾é€‰æ‹©å™¨<!-- raw HTML omitted --></li>
</ul>

<pre class="mermaid align-center zoomable">graph LR
A[Deployment&lt;br&gt;seletor:env=dev] -.- C[Label&lt;br&gt;]  
B{Service&lt;br&gt;seletor:env=dev} --- C[Label&lt;br&gt;]
C[Label&lt;br&gt;] --- C1((Pod&lt;br&gt;labe:env=dev))
C[Label&lt;br&gt;] --- C2((Pod&lt;br&gt;labe:env=dev))
C[Label&lt;br&gt;] --- C3((Pod&lt;br&gt;labe:env=dev))
    Z[Service]</pre>
<pre class="mermaid align-center zoomable">graph TD

A[user containerN&lt;br&gt;user ImageN&lt;br&gt;user container1&lt;br&gt;user Image1&lt;br&gt;Pause&lt;br&gt;gcr.io/google_containers/pause-amd64&lt;br&gt;] 
    Z[Pod]</pre></blockquote>
<hr>
<h2 id="èµ„æºåç§°">èµ„æºåç§°</h2>
<blockquote>
<ul>
<li>
<ol>
<li><code>kubectl api-resources -o wide</code><!-- raw HTML omitted -->ï¼šè·å–å‚æ•°å®šä¹‰å‘½ä»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<table>
<thead>
<tr>
<th><code>Name</code>(åç§°)</th>
<th><code>ShortNames</code>(ç®€å†™)</th>
<th><code>apiVersion</code>(<code>API</code>ç‰ˆæœ¬)</th>
<th><code>NameSpaced</code>(å‘½åç©ºé—´)</th>
<th>kind(ç±»å‹)</th>
<th>Verbs(å¯æ‰§è¡Œæ“ä½œå‘½ä»¤)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>configmaps</code></td>
<td>cm</td>
<td>v1</td>
<td>true</td>
<td>ConfigMap</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>events</td>
<td>ev</td>
<td>v1</td>
<td>true</td>
<td>Event</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td><code>limitranges</code></td>
<td>limits</td>
<td>v1</td>
<td>true</td>
<td>LimitRange</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>pods</td>
<td>po</td>
<td>v1</td>
<td>true</td>
<td>Pod</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>serviceaccounts</td>
<td>sa</td>
<td>v1</td>
<td>true</td>
<td>ServiceAccount</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>services</td>
<td>svc</td>
<td>v1</td>
<td>true</td>
<td>Service</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>daemonsets</td>
<td>ds</td>
<td>apps/v1</td>
<td>true</td>
<td>DaemonSet</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>deployments</td>
<td>deploy</td>
<td>apps/v1</td>
<td>true</td>
<td>Deployment</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>replicasets</td>
<td>rs</td>
<td>apps/v1</td>
<td>true</td>
<td>ReplicaSet</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>statefulsets</td>
<td>sts</td>
<td>apps/v1</td>
<td>true</td>
<td>StatefulSet</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>horizontalpodautoscalers</td>
<td>hpa</td>
<td>autoscaling/v2</td>
<td>true</td>
<td>HorizontalPodAutoscaler</td>
<td>create,delete,deletecollection,get,list,patch,update,watch   all</td>
</tr>
<tr>
<td>cronjobs</td>
<td>cj</td>
<td>batch/v1</td>
<td>true</td>
<td>CronJob</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>jobs</td>
<td></td>
<td>batch/v1</td>
<td>true</td>
<td>Job</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>events</td>
<td>ev</td>
<td>events.k8s.io/v1</td>
<td>true</td>
<td>Event</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>ingresses</td>
<td>ing</td>
<td>networking.k8s.io/v1</td>
<td>true</td>
<td>Ingress</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>networkpolicies</td>
<td>netpol</td>
<td>networking.k8s.io/v1</td>
<td>true</td>
<td>NetworkPolicy</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
<tr>
<td>poddisruptionbudgets</td>
<td>pdb</td>
<td>policy/v1</td>
<td>true</td>
<td>PodDisruptionBudget</td>
<td>createã€deleteã€deletecollectionã€getã€listã€patchã€updateã€watch</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->èµ„æºæ§åˆ¶å™¨ä½œç”¨<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>èµ„æºåˆ†ç±»</th>
<th>èµ„æºåç§°</th>
<th>ç¼©å†™</th>
<th>èµ„æºä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Pod</code>èµ„æºæ§åˆ¶å™¨</td>
<td><code>replicasets</code></td>
<td><code>rs</code></td>
<td>ä¿è¯æŒ‡å®šæ•°é‡çš„<code>Pod</code>è¿è¡Œï¼Œå¹¶æ”¯æŒ<code>Pod</code>æ•°é‡å˜æ›´ï¼Œé•œåƒç‰ˆæœ¬å˜æ›´</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>deployments</code></td>
<td><code>deploy</code></td>
<td>é€šè¿‡æ§åˆ¶<code>ReplicaSet</code>æ¥æ§åˆ¶<code>Pod</code>ï¼Œå¹¶æ”¯æŒæ»šåŠ¨å‡çº§ã€ç‰ˆæœ¬å›é€€</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>daemonsets</code></td>
<td><code>ds</code></td>
<td>åœ¨é›†ç¾¤ä¸­çš„æŒ‡å®š<code>Node</code>ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬ç”¨äºæ—¥å¿—é‡‡é›†ã€ç›‘æ§ã€å®ˆæŠ¤è¿›ç¨‹ç±»çš„ä»»åŠ¡ã€‚</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>jobs</code></td>
<td>&mdash;</td>
<td>å®ƒåˆ›å»ºå‡ºæ¥çš„<code>Pod</code>åªè¦å®Œæˆä»»åŠ¡å°±ç«‹å³é€€å‡ºï¼Œç”¨äºæ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>cronjobs</code></td>
<td><code>cj</code></td>
<td>å®ƒåˆ›å»ºçš„Podä¼šå‘¨æœŸæ€§çš„æ‰§è¡Œï¼Œç”¨äºæ‰§è¡Œå‘¨æœŸæ€§çš„ä»»åŠ¡</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>horizontalpodautoscalers</code></td>
<td><code>hpa</code></td>
<td>å¯ä»¥æ ¹æ®é›†ç¾¤è´Ÿè½½è‡ªåŠ¨è°ƒæ•´<code>Pod</code>çš„æ•°é‡ï¼Œå®ç°å‰Šå³°å¡«è°·</td>
</tr>
<tr>
<td><code>Pod</code>èµ„æºæ§åˆ¶å™¨</td>
<td><code>statefulsets</code></td>
<td><code>sts</code></td>
<td>ç®¡ç†æœ‰çŠ¶æ€çš„åº”ç”¨ã€‚</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="èµ„æºæ§åˆ¶å™¨å­—æ®µç±»å‹ä½œç”¨">èµ„æºæ§åˆ¶å™¨å­—æ®µç±»å‹ä½œç”¨</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>explain</code><!-- raw HTML omitted -->é€‰é¡¹è·å–å­—æ®µä½¿ç”¨æ–¹å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain deployment.metadata  	<span style="color:#75715e"># è·å– deploymentçš„metadataä½¿ç”¨æ–¹å¼ï¼Œ è¿˜å¯ä»¥è·å–ï¼šspecã€kind</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl explain deployment.spec.selector  <span style="color:#75715e"># è·å–yamlåŸºç¡€æ ¼å¼å‘½ä»¤ </span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->èµ„æºæ§åˆ¶å™¨<!-- raw HTML omitted --><!-- raw HTML omitted -->å¿…é€‰å­—æ®µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>version</code></td>
<td><code>String</code></td>
<td><code>Kubernetes API </code>çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨<code>kubectl api-versions</code>å‘½ä»¤æŸ¥è¯¢</td>
</tr>
<tr>
<td><code>kind</code></td>
<td><code>String</code></td>
<td>æ ‡æ˜<code>YAML</code>å®šä¹‰çš„èµ„æºç±»å‹å’Œè§’è‰²ï¼Œå¦‚<code>Pod</code>ã€<code>Deployment</code>ç­‰</td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><code>String</code></td>
<td>å…ƒæ•°æ®å¯¹è±¡</td>
</tr>
<tr>
<td><code>metadata.name</code></td>
<td><code>String</code></td>
<td>å…ƒæ•°æ®å¯¹è±¡çš„åå­—ï¼Œå¯è‡ªå®šä¹‰ï¼Œæ¯”å¦‚å‘½å<code>Pod</code>çš„åå­—</td>
</tr>
<tr>
<td><code>spec</code></td>
<td><code>Object</code></td>
<td>è¯¦ç»†å®šä¹‰å¯¹è±¡</td>
</tr>
<tr>
<td><code>spec.containers[]</code></td>
<td><code>List</code></td>
<td>å®¹å™¨åˆ—è¡¨å®šä¹‰</td>
</tr>
<tr>
<td><code>spec.containers[].name</code></td>
<td><code>String</code></td>
<td>å®šä¹‰å®¹å™¨çš„åå­—</td>
</tr>
<tr>
<td><code>spec.containers[].image</code></td>
<td><code>String</code></td>
<td>å®šä¹‰å®¹å™¨ä½¿ç”¨çš„é•œåƒ</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>metadata</code><!-- raw HTML omitted -->å­—æ®µé€‰æ‹©<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>metadata.name</code></td>
<td></td>
<td><code>Pod</code>åç§°</td>
</tr>
<tr>
<td><code>metadata.uid</code></td>
<td></td>
<td><code>Pod</code>çš„<code>UID</code></td>
</tr>
<tr>
<td><code>metadata.namespace</code></td>
<td></td>
<td><code>Pod</code>åå­—ç©ºé—´</td>
</tr>
<tr>
<td><code>metadata.labels['&lt;KEY&gt;']</code></td>
<td></td>
<td><code>Pod</code>æ ‡ç­¾ <code>&lt;KEY&gt;</code> çš„å€¼ (ä¾‹å¦‚<code>metadata.labels['mylabel']</code>ï¼‰</td>
</tr>
<tr>
<td><code>metadata.annotations['&lt;KEY&gt;']</code></td>
<td></td>
<td><code>Pod</code>çš„æ³¨è§£ <code>&lt;KEY&gt;</code> çš„å€¼ï¼ˆä¾‹å¦‚, <code>metadata.annotations['myannotation']</code>ï¼‰</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="3">
<li><code>spec.containers</code><!-- raw HTML omitted -->å­—æ®µå®šä¹‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.containers[].name</td>
<td>String</td>
<td>å®šä¹‰å®¹å™¨çš„åå­—ã€‚</td>
</tr>
<tr>
<td>spec.containers[].image</td>
<td>String</td>
<td>å®šä¹‰å®¹å™¨ä½¿ç”¨çš„é•œåƒã€‚</td>
</tr>
<tr>
<td>spec.containers[].imagePullSecrets</td>
<td></td>
<td>è¦ä»ç§æœ‰ä»“åº“æ‹‰å–é•œåƒï¼Œ<code>Kubernetes</code>éœ€è¦å‡­è¯ã€‚ é…ç½®æ–‡ä»¶ä¸­çš„ <code>imagePullSecrets</code>å­—æ®µè¡¨æ˜<code>Kubernetes</code>åº”è¯¥é€šè¿‡åä¸º <code>regcred</code> çš„ Secret è·å–å‡­è¯</td>
</tr>
<tr>
<td>spec.containers[].imagePullPolicy</td>
<td>S</td>
<td>å®šé•œåƒæ‹‰å–æœ‰3ä¸ªå€¼å¯é€‰:<!-- raw HTML omitted --> <!-- raw HTML omitted --><code>Always</code><!-- raw HTML omitted -->ï¼šæ€»æ˜¯ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒã€<!-- raw HTML omitted --><!-- raw HTML omitted --><code>IfNotPresent</code><!-- raw HTML omitted -->ï¼šæœ¬åœ°æœ‰åˆ™ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒã€‚å¦‚ä¸Šé¢ 3ä¸ªå€¼éƒ½æ²¡è®¾ç½®ï¼Œé»˜è®¤æ˜¯<code>Always</code><!-- raw HTML omitted --><!-- raw HTML omitted --><code>Never</code><!-- raw HTML omitted -->ï¼šä»…ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰å°±æŠ¥é”™</td>
</tr>
<tr>
<td>spec.containers[].command[]</td>
<td>List</td>
<td>æŒ‡å®šå®¹å™¨å¯åŠ¨å‘½ä»¤ï¼Œå› ä¸ºæ˜¯æ•°ç»„å½¢å¼ï¼Œæ‰€ä»¥å¯ä»¥æŒ‡å®šå¤šä¸ªå¯åŠ¨å‘½ä»¤ï¼Œä¸æŒ‡å®šåˆ™ä½¿ç”¨é•œåƒæ‰“åŒ…æ—¶çš„å¯åŠ¨å‘½ä»¤ã€‚</td>
</tr>
<tr>
<td>spec.containers[].args[]</td>
<td>List</td>
<td>æŒ‡å®šå®¹å™¨å¯åŠ¨å‘½ä»¤å‚æ•°ï¼Œå› ä¸ºæ˜¯æ•°ç»„å½¢å¼ï¼Œæ‰€ä»¥å¯ä»¥æŒ‡å®šå¤šä¸ªå‚æ•°ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">imagePullSecrets</span>:  	<span style="color:#75715e"># é…ç½®ç™»å½• docker registry çš„ secret ä»“åº“</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker-harbor  	# æŒ‡å®šä½¿ç”¨çš„secretåº“æˆ¿åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨ï¼Œä¸€ä¸ªPodä¸­å¯ä»¥å®šä¹‰å¤šä¸ªå®¹å™¨</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">tomcat-demo   	# æŒ‡å®šå®¹å™¨åç§°ï¼Œä¸å¯æ›´æ–°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">192.168.80.210</span>:<span style="color:#ae81ff">8080</span><span style="color:#ae81ff">/test/tomcat-demo:v1 </span> <span style="color:#75715e"># é•œåƒä»“åº“åœ°å€</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">Always   	# å®¹å™¨ä¸‹è½½ç­–ç•¥ï¼šAlways|Never|IfNotPresentï¼Œä¸ç®¡æœ¬åœ°å­˜ä¸å­˜åœ¨ï¼Œéƒ½ä»ä»“åº“æ‹‰å–é•œåƒ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#ae81ff">string]   	# å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œæ›¿ä»£dockerçš„ENTRYPOINTæŒ‡ä»¤ã€å¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">args</span>:   	<span style="color:#75715e"># å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨ã€æ›¿ä»£dockerçš„CMDæŒ‡ä»¤</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">/bin/sh</span>
</span></span><span style="display:flex;"><span>    - -<span style="color:#ae81ff">c</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">touch /tmp/healthy; sleep 30; rm -fr /tmp/healthy; sleep 600</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>spec.containers.volumeMounts</code><!-- raw HTML omitted -->å®¹å™¨å·¥ä½œç›®å½•å®šä¹‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.containers[].workingDir</td>
<td>String</td>
<td>æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•</td>
</tr>
<tr>
<td>spec.containers[].volumeMounts[]</td>
<td>List</td>
<td>æŒ‡å®šå®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</td>
</tr>
<tr>
<td>spec.containers[].volumeMounts[].name</td>
<td>String</td>
<td>æŒ‡å®šå¯ä»¥è¢«å®¹å™¨æŒ‚è½½çš„å­˜å‚¨å·çš„åç§°</td>
</tr>
<tr>
<td>spec.containers[].volumeMounts[].mountPath</td>
<td>String</td>
<td>æŒ‡å®šå¯ä»¥è¢«å®¹å™¨æŒ‚è½½çš„å­˜å‚¨å·çš„è·¯å¾„ã€‚</td>
</tr>
<tr>
<td>spec.containers[].volumeMountsf].readOnly</td>
<td>String</td>
<td>è®¾ç½®å­˜å‚¨å·è·¯å¾„çš„è¯»å†™æ¨¡å¼ï¼Œtrue æˆ–è€… falseï¼Œé»˜è®¤ä¸ºè¯»å†™æ¨¡å¼ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">containers</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">workingDir</span>: <span style="color:#ae81ff">string   	# å®¹å™¨çš„å·¥ä½œç›®å½•ã€ä¸æŒ‡å®šåˆ™ä½¿ç”¨é•œåƒé»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMounts</span>:   	<span style="color:#75715e"># æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">data   	# å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/opt/data   	# å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">readOnly</span>: <span style="color:#ae81ff">boolean   	# æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>spec.containers.ports</code><!-- raw HTML omitted -->å®¹å™¨ç«¯å£å®šä¹‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain deployment.spec.containers.ports  	<span style="color:#75715e"># è·å–ç«¯å£ä½¿ç”¨æ–¹å¼</span></span></span></code></pre></div><table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.containers[].ports[]</td>
<td>List</td>
<td>æŒ‡å®šå®¹å™¨éœ€è¦ç”¨åˆ°çš„ç«¯å£åˆ—è¡¨ã€‚</td>
</tr>
<tr>
<td>spec.containers[].ports[].name</td>
<td>String</td>
<td>æŒ‡å®šç«¯å£åç§°ã€‚</td>
</tr>
<tr>
<td>spec.containers[].ports[].containerPort</td>
<td>String</td>
<td>æŒ‡å®šå®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·ã€‚</td>
</tr>
<tr>
<td>spec.containers[].ports[].hostPort</td>
<td>String</td>
<td>æŒ‡å®šå®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤å’Œ spec.containers[].ports[].containerPort ç›¸åŒã€‚æ³¨æ„ï¼Œè®¾ç½®äº†åˆ™åŒä¸€å°ä¸»æœºæ— æ³•å¯åŠ¨è¯¥å®¹å™¨çš„ç›¸åŒå‰¯æœ¬ï¼ˆä¸»æœºçš„ç«¯å£å·ä¸èƒ½ç›¸åŒï¼Œè‹¥ç›¸åŒï¼Œä¼šå¼•å‘å†²çªï¼‰ã€‚</td>
</tr>
<tr>
<td>spec.containers[].ports[].protocol</td>
<td>String</td>
<td>æŒ‡å®šç«¯å£åè®®ï¼Œæ”¯æŒ TCP å’Œ UDPï¼Œé»˜è®¤å€¼ä¸º TCP ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:  	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">containers</span>:  	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:  	<span style="color:#75715e"># å®¹å™¨æš´éœ²çš„ç«¯å£</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">http  	# æœåŠ¡åç§°ã€è¯¥åç§°å¯ä»¥åœ¨serviceç§è¢«å¼•ç”¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>  	<span style="color:#75715e"># å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">hostPort</span>: <span style="color:#ae81ff">int  	# å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP  	# ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>  	<span style="color:#75715e"># é›†ç¾¤ç«¯å£</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>  	<span style="color:#75715e"># Podç«¯å£</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nodePort</span>: <span style="color:#ae81ff">30080</span>  	<span style="color:#75715e"># èŠ‚ç‚¹å¯¹å¤–ç«¯å£</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><code>spec.containers.env</code><!-- raw HTML omitted -->å®¹å™¨å˜é‡å®šä¹‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.containers[].env[]</td>
<td>List</td>
<td>æŒ‡å®šå®¹å™¨è¿è¡Œå‰éœ€è¦è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ã€‚</td>
</tr>
<tr>
<td>spec.containers[].env[].name</td>
<td>String</td>
<td>æŒ‡å®šç¯å¢ƒå˜é‡åç§°ã€‚</td>
</tr>
<tr>
<td>spec.containers[].env[].value</td>
<td>String</td>
<td>æŒ‡å®šç¯å¢ƒå˜é‡å€¼ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">containers</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">env</span>:   	<span style="color:#75715e"># å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">JAVA_OPTS   	# ç¯å¢ƒå˜é‡åç§°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;-Xmx1g&#34;</span>   	<span style="color:#75715e"># å®šä¹‰ä½¿ç”¨å†…å­˜ã€ç¯å¢ƒå˜é‡çš„å€¼</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><code>spec.containers.resources</code><!-- raw HTML omitted -->å®¹å™¨èµ„æºé™åˆ¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.containers[].resources</td>
<td>Object</td>
<td>æŒ‡å®šèµ„æºé™åˆ¶å’Œèµ„æºè¯·æ±‚çš„å€¼ï¼ˆè¿™é‡Œå¼€å§‹å°±æ˜¯è®¾ç½®å®¹å™¨çš„èµ„æºä¸Šé™ï¼‰ã€‚</td>
</tr>
<tr>
<td>spec.containers[].resources.limits</td>
<td>Object</td>
<td>æŒ‡å®šè®¾ç½®å®¹å™¨è¿è¡Œæ—¶èµ„æºçš„è¿è¡Œä¸Šé™ã€‚</td>
</tr>
<tr>
<td>spec.containers[].resources.limits.cpu</td>
<td>String</td>
<td>æŒ‡å®š<code>CPU</code>çš„é™åˆ¶ï¼Œå•ä½ä¸º<code>core</code>ï¼Œæ˜¯ç”¨äºè¿è¡Œ <code>docker run --cpu-shares</code>å‘½ä»¤çš„å‚æ•°ã€‚</td>
</tr>
<tr>
<td>spec.containers[].resources.limits.memory</td>
<td>String</td>
<td>æŒ‡å®šå†…å­˜çš„é™åˆ¶ï¼Œå•ä½ä¸º MiB æˆ– GiBã€‚</td>
</tr>
<tr>
<td>spec.containers[].resources.requests</td>
<td>Object</td>
<td>æŒ‡å®šå®¹å™¨å¯åŠ¨å’Œè°ƒåº¦æ—¶çš„é™åˆ¶ã€‚</td>
</tr>
<tr>
<td>spec.containers[].resources.requests.cpu</td>
<td>String</td>
<td>CPU è¯·æ±‚ï¼Œå•ä½ä¸º coreï¼Œå®¹å™¨å¯åŠ¨æ—¶åˆå§‹åŒ–å¯ç”¨æ•°é‡ã€‚</td>
</tr>
<tr>
<td>spec.containers[].resources.requests.memory</td>
<td>String</td>
<td>å†…å­˜è¯·æ±‚ï¼Œå•ä½ä¸º MiB æˆ– GiBï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹åŒ–å¯ç”¨æ•°é‡ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># è®¾å®šé»˜è®¤requestå’Œlimit</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Namespace</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">apps</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">LimitRange</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">limit-resource  	# åœ¨ä¸€ä¸ªåç§°ç©ºé—´ä¸èƒ½é‡å¤</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default  	# æŒ‡å®šåç§°ç©ºé—´ï¼Œé»˜è®¤defalut</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">labels</span>:      <span style="color:#ae81ff">&lt;map[string]string&gt;  	# æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">annotations</span>: <span style="color:#ae81ff">&lt;map[string]string&gt;  	# æ³¨é‡Š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾å®šé»˜è®¤requestå’Œlimit</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">default</span>:  	<span style="color:#75715e"># é»˜è®¤çš„èµ„æºä¸Šé™, limit</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">1024Mi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">500m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">defaultRequest</span>:  	<span style="color:#75715e"># é»˜è®¤çš„èµ„æºç”³è¯·å€¼, required</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">100m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">max</span>:  	<span style="color:#75715e"># å£°æ˜çš„limitä¸Šé™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">2048Mi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">1000m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">min</span>:  	<span style="color:#75715e"># å£°æ˜çš„requiredä¸‹çº¿</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">64Mi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">50m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Container  	# è¢«é™åˆ¶çš„å¯¹è±¡ï¼ŒContainer</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">###############################################</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   	<span style="color:#75715e"># Podä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:   	<span style="color:#75715e"># Podä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>:   	<span style="color:#75715e"># èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">limits</span>:   	<span style="color:#75715e"># é™å®šPodæœ€å¤§ä½¿ç”¨ç¡¬ä»¶èµ„æºã€é€šå¸¸è®¾ç½®cpuå’Œmemory</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span>   	<span style="color:#75715e"># Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;1Gi&#34;</span>   	<span style="color:#75715e"># å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gib</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">requests</span>:   	<span style="color:#75715e"># æœ€ä½èµ„æºè¦æ±‚ï¼Œåœ¨schedulerä¸­è¢«ç”¨åˆ°ï¼Œé€šå¸¸è®¾ç½®cpuå’Œmemory</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;0.5&#34;</span>   	<span style="color:#75715e"># é™å®šä½¿ç”¨å‡ ä¸ªæ ¸å¿ƒCPUã€å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;256Mi&#34;</span>   	<span style="color:#75715e"># è®¾å®šä½¿ç”¨å†…å­˜ã€å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="8">
<li><!-- raw HTML omitted -->å®¹å™¨å¥åº·æ£€æŸ¥è®¾ç½®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><code>startupProbe</code><!-- raw HTML omitted -->ï¼š å¯åŠ¨æ¢æµ‹ï¼š<!-- raw HTML omitted -->å®¹å™¨å¯åŠ¨å®Œæ¯•çš„é…ç½®ï¼Œè¯¥é…ç½®ä¸<code>readinessProbe</code>ä¸€è‡´ï¼Œåœ¨<code>lifecycle</code>å’Œ<code>Probe</code>ä¹‹å‰è¿è¡Œï¼Œå¤±è´¥åˆ™é‡å¯</p>
<p><code>k8s1.16</code>ç‰ˆæœ¬åæ–°åŠ <code>startupProbe</code>æ¢æµ‹æ–¹å¼ï¼Œç”¨äºåˆ¤æ–­å®¹å™¨å†…åº”ç”¨ç¨‹åºæ˜¯å¦å·²ç»å¯åŠ¨ï¼Œå¦‚æœé…ç½®äº†<code>startuprobe</code>ï¼Œå°±ä¼šå…ˆç¦ç”¨å…¶ä»–çš„æ¢æµ‹ï¼Œç›´åˆ°å®ƒæˆåŠŸä¸ºæ­¢</p>
</li>
<li>
<p><code>liveness probe</code><!-- raw HTML omitted -->(å­˜æ´»æ¢é’ˆ)<!-- raw HTML omitted --><code>Kubelet</code> ä½¿ç”¨<code>liveness probe</code>ï¼ˆå­˜æ´»æ¢é’ˆï¼‰æ¥ç¡®å®šä½•æ—¶é‡å¯å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œå½“åº”ç”¨ç¨‹åºå¤„äºè¿è¡ŒçŠ¶æ€ä½†æ— æ³•åšè¿›ä¸€æ­¥æ“ä½œï¼Œ<code>liveness</code>æ¢é’ˆå°†æ•è·åˆ°<code>deadlock</code>é‡å¯å¤„äºè¯¥çŠ¶æ€ä¸‹çš„å®¹å™¨ï¼Œä½¿åº”ç”¨ç¨‹åºåœ¨å­˜åœ¨<code>bug</code>çš„æƒ…å†µä¸‹ä¾ç„¶èƒ½å¤Ÿç»§ç»­è¿è¡Œä¸‹å»ï¼ˆè°çš„ç¨‹åºè¿˜æ²¡å‡ ä¸ª<code>bug</code>å‘¢ï¼‰</p>
</li>
<li>
<p><code>readiness probe</code><!-- raw HTML omitted -->(å°±ç»ªæ¢é’ˆ)<!-- raw HTML omitted --><code>Kubelet</code>ä½¿ç”¨<code>readiness probe(å°±ç»ªæ¢é’ˆ)</code>æ¥ç¡®å®šå®¹å™¨æ˜¯å¦å·²ç»å°±ç»ªå¯ä»¥æ¥å—æµé‡ã€‚åªæœ‰å½“<code>Pod</code>ä¸­çš„å®¹å™¨éƒ½å¤„äºå°±ç»ªçŠ¶æ€æ—¶<code>kubelet</code>æ‰ä¼šè®¤å®šè¯¥<code>Pod</code>å¤„äºå°±ç»ªçŠ¶æ€ã€‚è¯¥ä¿¡å·çš„ä½œç”¨æ˜¯æ§åˆ¶å“ªäº›<code>Pod</code>åº”è¯¥ä½œä¸º<code>service</code>çš„åç«¯ã€‚å¦‚æœ<code>Pod</code>å¤„äºéå°±ç»ªçŠ¶æ€ï¼Œé‚£ä¹ˆå®ƒä»¬å°†ä¼šè¢«ä»<code>service</code>çš„<code>load balancer</code>ä¸­ç§»é™¤</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>å‚æ•°åç§°</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.containers[].livenessProbe(å­˜æ´»æ¢é’ˆ)</td>
<td>Object</td>
<td>æŒ‡å®š<code>Pod</code>å†…å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹å‡ æ¬¡æ— å“åº”åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ã€‚å‚æ•°å¯ä»¥è®¾ç½®ä¸º<code>exec</code>ã€<code>httpGet</code>ã€<code>tcpSocket</code>ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.exec</td>
<td>Object</td>
<td>æŒ‡å®š<code>Pod</code>å†…å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œç¡®å®šæ˜¯<code>exec</code>æ–¹å¼ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.exec.command[]</td>
<td>String</td>
<td>æŒ‡å®š<code>exec</code>æ–¹å¼åç”¨è¿™ä¸ªå‚æ•°è®¾ç½®éœ€è¦æŒ‡å®šçš„å‘½ä»¤æˆ–è€…è„šæœ¬ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.httpGet</td>
<td>Object</td>
<td>æŒ‡å®š Pod å†…å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œç¡®å®šæ˜¯<code>httpGet</code>æ–¹å¼ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.tcpSocket</td>
<td>Object</td>
<td>æŒ‡å®š Pod å†…å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œç¡®å®šæ˜¯ <code>tcpSocket</code>æ–¹å¼ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.initialDelaySeconds</td>
<td>Number</td>
<td>æŒ‡å®šå®¹å™¨å¯åŠ¨å®Œæˆåå»¶è¿Ÿå¤šä¹…å¼€å§‹é¦–æ¬¡æ¢æµ‹çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.timeoutSeconds</td>
<td>Number</td>
<td>å®¹å™¨å¥åº·æ£€æŸ¥çš„æ¢æµ‹ç­‰å¾…æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œé»˜è®¤ä¸º 1 ç§’ã€‚è‹¥è¶…è¿‡è¯¥æ—¶é—´ï¼Œåˆ™è®¤ä¸ºè¯¥æ¬¡æ¢æµ‹å¤±è´¥ã€‚</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.periodSeconds</td>
<td>Number</td>
<td>å¯¹å®¹å™¨å¥åº·æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ä¸ºç§’ï¼Œé»˜è®¤æ¯ 10 ç§’æ¢æµ‹ä¸€æ¬¡ã€‚<code>Kubernetes</code>å¦‚æœè¿ç»­æ‰§è¡Œ3æ¬¡Livenessæ¢æµ‹å‡å¤±è´¥ï¼Œåˆ™ä¼šæ€æ‰å¹¶é‡å¯å®¹å™¨</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.failureThreshold</td>
<td>Number</td>
<td>è¿ç»­æ¢æµ‹å¤±è´¥å¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºå¤±è´¥ã€‚é»˜è®¤æ˜¯3ã€‚æœ€å°å€¼æ˜¯1</td>
</tr>
<tr>
<td>spec.containers[].livenessProbe.successThreshold</td>
<td>Number</td>
<td>è¿ç»­æ¢æµ‹æˆåŠŸå¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºæˆåŠŸã€‚é»˜è®¤æ˜¯1</td>
</tr>
</tbody>
</table>
<ul>
<li><code>infrastructure Container:</code><!-- raw HTML omitted -->åŸºç¡€å®¹å™¨ï¼Œç»´æŠ¤æ•´ä¸ª<code>Pod</code>ç½‘ç»œç©ºé—´<!-- raw HTML omitted --></li>
<li><code>initContainers:</code><!-- raw HTML omitted -->åˆå§‹åŒ–å®¹å™¨ï¼Œå…ˆäºä¸šåŠ¡å®¹å™¨å¼€å§‹è¿è¡Œ<!-- raw HTML omitted --></li>
<li><code>Containers:</code><!-- raw HTML omitted -->ä¸šåŠ¡å®¹å™¨ï¼Œå¹¶è¡Œå¯åŠ¨<!-- raw HTML omitted --></li>
<li><code>Pod</code><!-- raw HTML omitted -->å†…æ‰€æœ‰å®¹å™¨å…¬ç”¨ä¸€ä¸ª<!-- raw HTML omitted --><code>ip</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">initc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">initc-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">initContainers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">initc-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#39;sh&#39;</span>, <span style="color:#e6db74">&#39;-c&#39;</span>, <span style="color:#e6db74">&#39;sleep 10; echo &#34;Hello&#34; &gt;&gt;/tmp/hello.txt&#39;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-container</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#39;sh&#39;</span>, <span style="color:#e6db74">&#39;-c&#39;</span>, <span style="color:#e6db74">&#39;echo The app is running! &amp;&amp; sleep 3600&#39;</span>]</span></span></code></pre></div><ul>
<li><code>exec</code><!-- raw HTML omitted -->å‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡Œçš„é€€å‡ºç ä¸º<code>0</code>ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸<!-- raw HTML omitted --></li>
<li><code>Pod</code><!-- raw HTML omitted -->äº”ç§çŠ¶æ€<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Pending(æŒ‚èµ·)</code>ï¼š<code>API Server</code><!-- raw HTML omitted -->å·²ç»åˆ›å»ºäº†<code>Pod</code>èµ„æºå¯¹è±¡ï¼Œä½†å®ƒå°šæœªè¢«è°ƒåº¦å®Œæˆæˆ–è€…ä»å¤„äºä¸‹è½½é•œåƒçš„è¿‡ç¨‹ä¸­<!-- raw HTML omitted --></li>
<li><code>Running(è¿è¡Œä¸­)</code>ï¼š<code>Pod</code><!-- raw HTML omitted -->å·²ç»è¢«è°ƒåº¦åˆ°æŸèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ‰€æœ‰å®¹å™¨éƒ½å·²ç»è¢«<code>kubelet</code>åˆ›å»ºå®Œæˆ<!-- raw HTML omitted --></li>
<li><code>Succeeded(æˆåŠŸç»ˆæ­¢)</code>ï¼š<code>Pod</code><!-- raw HTML omitted -->ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»æˆåŠŸç»ˆæ­¢å¹¶ä¸”ä¸ä¼šè¢«é‡å¯<!-- raw HTML omitted --></li>
<li><code>Failed(å¤±è´¥)</code><!-- raw HTML omitted -->ï¼šæ‰€æœ‰å®¹å™¨éƒ½å·²ç»ç»ˆæ­¢ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ç»ˆæ­¢å¤±è´¥ï¼Œå³å®¹å™¨è¿”å›äº†é<code>0</code>å€¼çš„é€€å‡ºçŠ¶æ€<!-- raw HTML omitted --></li>
<li><code>Unknown(æœªçŸ¥)</code>ï¼š<code>API Server</code><!-- raw HTML omitted -->æ— æ³•æ­£å¸¸è·å–åˆ°<code>Pod</code>å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œé€šå¸¸ç”±äºç½‘ç»œé€šä¿¡å¤±è´¥æ‰€å¯¼è‡´<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">lifecycle</span>:   	<span style="color:#75715e"># ç”Ÿå‘½å‘¨æœŸé’©å­</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">postStart</span>:  	<span style="color:#75715e"># å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">exec</span>:  	<span style="color:#75715e"># é€šè¿‡æ‰§è¡Œç‰¹å®šå‘½ä»¤æ¥æ¢æµ‹å®¹å™¨å¥åº·çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;echo Hello from the postStart handler&gt; /usr/share/message&#34;</span>]
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">preStop</span>:  	<span style="color:#75715e"># å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">exec</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;nginx -s quit; while killall -0 nginx; do sleep 1; done&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e">#################  		å¯åŠ¨æ¢é’ˆ	  #####################</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">startupProbe</span>:  	<span style="color:#75715e"># å®¹å™¨å¯åŠ¨å®Œæ¯•çš„é…ç½®ï¼Œè¯¥é…ç½®ä¸readinessProbeä¸€è‡´ï¼Œåœ¨lifecycleå’ŒProbeä¹‹å‰è¿è¡Œï¼Œå¤±è´¥åˆ™é‡å¯</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">tcpSocket</span>:   		<span style="color:#75715e"># ä½¿ç”¨TcpSocketã€httpGetå¥åº·æ£€æŸ¥</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8010</span>   	<span style="color:#75715e"># æ¢æµ‹8010ç«¯å£</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>  	<span style="color:#75715e"># æ£€æµ‹å¤±è´¥5æ¬¡è¡¨ç¤ºæœªå°±ç»ª</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">60</span>   	<span style="color:#75715e"># æŒ‡å®šå®¹å™¨å¯åŠ¨60sä¹‹åå¼€å§‹æ‰§è¡ŒLivenessæ¢æµ‹ï¼Œ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>  	<span style="color:#75715e"># ä¸¤æ¬¡æ¢æµ‹çš„é—´éš”å¤šå°‘ç§’ï¼Œé»˜è®¤å€¼ä¸º10</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># è¿ç»­å¤šå°‘æ¬¡æ£€æµ‹æˆåŠŸè®¤ä¸ºå®¹å™¨æ­£å¸¸ï¼Œé»˜è®¤å€¼ä¸º1ã€‚ä¸æ”¯æŒä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">3</span>  	<span style="color:#75715e"># è¿ç»­å¤šå°‘æ¬¡æ£€æµ‹å¤±è´¥è®¤ä¸ºå®¹å™¨å¼‚å¸¸ï¼Œé»˜è®¤å€¼ä¸º3</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>  	<span style="color:#75715e"># æ¢æµ‹è¯·æ±‚è¶…æ—¶æ—¶é—´</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##################  	å­˜æ´»æ¢é’ˆç¼–å†™æ–¹å¼  	################</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">livenessprobe</span>:  	<span style="color:#75715e"># å­˜æ´»æ¢é’ˆæ£€æŸ¥,ä¸é€šè¿‡ä¸è½¬å‘æµé‡</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tcpSocket</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8010</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####################  		å°±ç»ªæ¢é’ˆç¼–å†™æ–¹å¼  		################</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">readinessProbe</span>:   	<span style="color:#75715e"># å°±ç»ªæ¢é’ˆæ£€æŸ¥ã€ä¸é€šè¿‡é‡å»ºpod</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">tcpSocket</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8010</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">####################  		httpGetç¼–å†™  		###########################</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">httpGet</span>:
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/  	# URIåœ°å€</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>  	<span style="color:#75715e"># ç«¯å£å·,æˆ–è€…åè®®ï¼šhttp/https</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">host</span>: <span style="color:#ae81ff">192.168.109.100</span>  	<span style="color:#75715e"># ä¸»æœºåœ°å€  </span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">HTTP  	# æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="9">
<li><code>spec.volumes</code><!-- raw HTML omitted -->æŒ‚è½½ç›®å½•å­—æ®µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>å­—æ®µç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.volumes[].name</td>
<td>String</td>
<td>å®šä¹‰<code>Pod</code>å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œå®¹å™¨å®šä¹‰éƒ¨åˆ† <code>spec.containers[].volumeMounts[].name</code>çš„å€¼å’Œè¿™é‡Œæ˜¯ä¸€æ ·çš„ã€‚</td>
</tr>
<tr>
<td>spec.volumes[].emptyDir</td>
<td>Object</td>
<td>æŒ‡å®š<code>Pod</code>çš„ä¸´æ—¶ç›®å½•ï¼Œå€¼ä¸ºä¸€ä¸ªç©ºå¯¹è±¡ï¼š<code>emptyDir:{}</code></td>
</tr>
<tr>
<td>spec.volumes[].hostPath</td>
<td>Object</td>
<td>æŒ‡å®šæŒ‚è½½<code>Pod</code>æ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ã€‚</td>
</tr>
<tr>
<td>spec.volumes[].hostPath.path</td>
<td>String</td>
<td>æŒ‡å®š<code>Pod</code>æ‰€åœ¨ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºå®¹å™¨ä¸­<code>mount</code>çš„ç›®å½•ã€‚</td>
</tr>
<tr>
<td>spec.volumes.nfs</td>
<td></td>
<td></td>
</tr>
<tr>
<td>spec.volumes[]</td>
<td>Object</td>
<td>æŒ‡å®šç±»å‹ä¸º<code>Secret</code>çš„å­˜å‚¨å·ï¼Œ<code>Secret</code>æ„ä¸ºç§å¯†ã€ç§˜å¯†ï¼Œè¿™å¾ˆå®¹æ˜“ç†è§£ï¼Œå®ƒå­˜å‚¨ä¸€äº›å¯†ç ã€å¯†é’¥ç­‰æ•æ„Ÿå®‰å…¨æ–‡ä»¶ã€‚æŒ‚è½½é›†ç¾¤é¢„å®šä¹‰çš„<code>Secret</code>å¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨ã€‚</td>
</tr>
<tr>
<td>spec.volumes[].configMap</td>
<td>Object</td>
<td>æŒ‡å®šç±»å‹ä¸º<code>ConfigMap</code>çš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½é›†ç¾¤é¢„å®šä¹‰çš„<code>ConfigMap</code>å¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain deployment.spec.volumes  	<span style="color:#75715e"># è·å– deploymentå­˜å‚¨ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl explain deployment.spec.volumes.hostPath.type  	<span style="color:#75715e"># ç±»å‹å£°æ˜  </span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç®€å•å­˜å‚¨æ¨¡å¼â†’<!-- raw HTML omitted --><code>volume-emptydir</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod  </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume-emptydir </span> <span style="color:#75715e"># å®šä¹‰åç§°</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">containers</span>:  	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>: <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­å¯¹åº”çš„ç›®å½•ï¼Œè¯¥ç›®å½•ä¸º/var/log/nginx</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log/nginx </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30  	# å¯ä»¥é€‰æ‹© 1.28.4ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /logs/access.log&#34;</span>] <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>: <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„å¯¹åº”ç›®å½•ï¼Œè¯¥ç›®å½•ä¸º/logs</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:   	<span style="color:#75715e"># å£°æ˜volumeï¼Œnameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºemptyDir</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume  	# å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">emptyDir</span>: {}   		<span style="color:#75715e"># ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç®€å•å­˜å‚¨æ¨¡å¼â†’<!-- raw HTML omitted --><code>volume-HostPath</code></li>
</ul>
<blockquote>
<ul>
<li><code>DirectoryOrCreate</code><!-- raw HTML omitted -->ï¼šç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨<!-- raw HTML omitted --></li>
<li><code>Directory</code><!-- raw HTML omitted -->ï¼šç›®å½•å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>FileOrCreate</code><!-- raw HTML omitted -->ï¼šæ–‡ä»¶å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨<!-- raw HTML omitted --></li>
<li><code>File</code><!-- raw HTML omitted -->ï¼šæ–‡ä»¶å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>Socket</code><!-- raw HTML omitted -->ï¼š<code>unix</code>å¥—æ¥å­—å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>CharDevice</code><!-- raw HTML omitted -->ï¼šå­—ç¬¦è®¾å¤‡å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>BlockDevice</code><!-- raw HTML omitted -->ï¼šå—è®¾å¤‡å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume-hostpath</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>: <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­å¯¹åº”çš„ç›®å½•ï¼Œè¯¥ç›®å½•ä¸º/var/log/nginx</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log/nginx</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /logs/access.log&#34;</span>] <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>: <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„å¯¹åº”ç›®å½•ï¼Œè¯¥ç›®å½•ä¸º/logs</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>: <span style="color:#75715e"># å£°æ˜volumeï¼Œnameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºhostPath</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">hostPath</span>:  <span style="color:#75715e"># ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/root/logs </span> <span style="color:#75715e"># Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate</span> <span style="color:#75715e"># ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºå†ä½¿ç”¨ </span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç®€å•å­˜å‚¨æ¨¡å¼â†’<!-- raw HTML omitted --><code>volume-nfs</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume-nfs</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>:  	<span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­å¯¹åº”çš„ç›®å½•ï¼Œè¯¥ç›®å½•ä¸º/var/log/nginx</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log/nginx</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /logs/access.log&#34;</span>]  	<span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>:  	<span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„å¯¹åº”ç›®å½•ï¼Œè¯¥ç›®å½•ä¸º/logs</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:  	<span style="color:#75715e"># å£°æ˜volume</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nfs</span>:  	<span style="color:#75715e"># å­˜å‚¨ç±»å‹ï¼Œå’Œåº•å±‚æ­£åˆ™çš„å­˜å‚¨å¯¹åº”</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.18.100</span>  	<span style="color:#75715e"># NFSæœåŠ¡å™¨åœ°å€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/root/data/nfs  	# å…±äº«æ–‡ä»¶è·¯å¾„</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é«˜çº§å­˜å‚¨æ¨¡å¼â†’<!-- raw HTML omitted --><code>volume-pv</code></li>
</ul>
<blockquote>
<ul>
<li><code>PVï¼škubernetes</code><!-- raw HTML omitted -->ç®¡ç†å‘˜ç»´æŠ¤<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pv2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">nfs</span>:  	<span style="color:#75715e"># å­˜å‚¨ç±»å‹ï¼Œå’Œåº•å±‚æ­£åˆ™çš„å­˜å‚¨å¯¹åº”</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/root/data/pv1</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.18.100</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">capacity</span>:  	<span style="color:#75715e"># å­˜å‚¨èƒ½åŠ›ï¼Œç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">2Gi</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">accessModes</span>:  	<span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>   - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">storageClassName</span>:  	<span style="color:#75715e"># å­˜å‚¨ç±»åˆ«</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">persistentVolumeReclaimPolicy</span>: <span style="color:#ae81ff">Retain  	# å›æ”¶ç­–ç•¥</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é«˜çº§å­˜å‚¨â†’<!-- raw HTML omitted --><code>volume-pvc</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pvc1</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">accessModes</span>:  	<span style="color:#75715e"># è®¿å®¢æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:  	<span style="color:#75715e"># é‡‡ç”¨æ ‡ç­¾å¯¹PVé€‰æ‹©</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>:  	<span style="color:#75715e"># å­˜å‚¨ç±»åˆ«</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:  	<span style="color:#75715e"># è¯·æ±‚ç©ºé—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">1Gi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#################################################### åˆ›å»º Pod è®¿é—® PVC ç±»å‹å­˜å‚¨</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;while true;do echo pod1 &gt;&gt; /root/out.txt; sleep 10; done;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/root/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">persistentVolumeClaim</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">claimName</span>: <span style="color:#ae81ff">pvc1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">false</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®å­˜å‚¨â†’<!-- raw HTML omitted --><code>volumes-secret</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Secret</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">type</span>: <span style="color:#ae81ff">Opaque</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:  	<span style="color:#75715e"># æå‰ç¼–ç å®åï¼šdataã€ä½¿ç”¨Kubernetesè¿›è¡Œç¼–ç ä½¿ç”¨ï¼šstringData</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">username</span>: <span style="color:#ae81ff">YWRtaW4=  	# ä½¿ç”¨kubernetesè¿›è¡Œç¼–ç å†™åŸæ•°æ®ï¼šadmin</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">password</span>: <span style="color:#ae81ff">MTIzNDU2  	# ä½¿ç”¨kubernetesè¿›è¡Œç¼–ç å†™åŸæ•°æ®ï¼š123456</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">############################################## é…ç½® pod-secret</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-secret</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/secret/config</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">secret</span>:  	<span style="color:#75715e"># ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="10">
<li><!-- raw HTML omitted -->é¢å¤–çš„å‚æ•°å¯¹è±¡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>å‚æ•°ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>spec.restartPolicy</td>
<td>String</td>
<td>å®šä¹‰<code>Pod</code>çš„é‡å¯ç­–ç•¥ï¼Œå¯é€‰å€¼ä¸º<code>Always</code>ã€<code>OnFailure</code>ï¼Œé»˜è®¤å€¼ä¸º<code>Always</code>ã€‚<!-- raw HTML omitted -->(1) <!-- raw HTML omitted --><code>Always</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>ä¸€æ—¦ç»ˆæ­¢è¿è¡Œï¼Œæ— è®ºå®¹å™¨æ˜¯å¦‚ä½•ç»ˆæ­¢çš„ï¼Œ<code>kubelet</code>æœåŠ¡éƒ½å°†é‡å¯å®ƒ<!-- raw HTML omitted -->(2) <!-- raw HTML omitted --><code>OnFailure</code><!-- raw HTML omitted -->ï¼šåªæœ‰<code>Pod</code>ä»¥éé›¶é€€å‡ºç ç»ˆæ­¢æ—¶ï¼Œ<code>kubelet</code>æ‰ä¼šé‡å¯è¯¥å®¹å™¨ï¼Œå¦‚æœå®¹å™¨æ­£å¸¸ç»“æŸï¼ˆé€€å‡ºç ä¸º 0ï¼‰ï¼Œåˆ™<code>kubelet</code>å°†ä¸ä¼šé‡å¯å®ƒ<!-- raw HTML omitted --> (3)<!-- raw HTML omitted --><code>Never</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>ç»ˆæ­¢åï¼Œ<code>kubelet</code>å°†é€€å‡ºç æŠ¥å‘Šç»™<code>master</code>ï¼Œä¸ä¼šé‡å¯è¯¥ <code>Pod</code></td>
</tr>
<tr>
<td>spec.nodeName</td>
<td></td>
<td>å®šå‘è°ƒåº¦</td>
</tr>
<tr>
<td>spec.nodeSelector</td>
<td>Object</td>
<td>å®šå‘è°ƒåº¦ï¼Œå®šä¹‰èŠ‚ç‚¹çš„è¿‡æ»¤æ ‡ç­¾ï¼ˆä»¥<code>key:value</code>æ ¼å¼æŒ‡å®šï¼‰ã€‚</td>
</tr>
<tr>
<td>pod.spec.affinity</td>
<td>äº²å’Œè°ƒåº¦</td>
<td></td>
</tr>
<tr>
<td>pod.spec.affinity.nodeAffinity</td>
<td></td>
<td>ï¼ˆnodeäº²å’Œæ€§ï¼‰ï¼šä»¥Nodeä¸ºç›®æ ‡ï¼Œè§£å†³Podå¯ä»¥è°ƒåº¦åˆ°é‚£äº›Nodeçš„é—®é¢˜ã€‚</td>
</tr>
<tr>
<td>pod.spec.affinity.podAffinity</td>
<td></td>
<td>ï¼ˆpodäº²å’Œæ€§ï¼‰ï¼šä»¥Podä¸ºç›®æ ‡ï¼Œè§£å†³Podå¯ä»¥å’Œé‚£äº›å·²å­˜åœ¨çš„Podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜ã€‚</td>
</tr>
<tr>
<td>pod.spec.affinity.podAntiAffinity</td>
<td></td>
<td>ï¼ˆpodåäº²å’Œæ€§ï¼‰ï¼šä»¥Podä¸ºç›®æ ‡ï¼Œè§£å†³Podä¸èƒ½å’Œé‚£äº›å·²ç»å­˜åœ¨çš„Podéƒ¨ç½²åœ¨åŒä¸€æ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜ã€‚</td>
</tr>
<tr>
<td>pod.spec.tolerations</td>
<td>å®¹å¿è°ƒåº¦</td>
<td>æ±¡ç‚¹å°±æ˜¯æ‹’ç»ï¼Œå®¹å¿å°±æ˜¯å¿½ç•¥ï¼ŒNodeé€šè¿‡æ±¡ç‚¹æ‹’ç»Podè°ƒåº¦ä¸Šå»ï¼ŒPodé€šè¿‡å®¹å¿å¿½ç•¥æ‹’ç»</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>spec.imagePullSecrets</td>
<td>List</td>
<td>å®šä¹‰æ‹‰å–é•œåƒæ—¶ä½¿ç”¨<code>Secret</code>åç§°ï¼ˆä»¥<code>name:secretkey</code>æ ¼å¼æŒ‡å®šï¼‰ã€‚</td>
</tr>
<tr>
<td>spec.hostNetwork</td>
<td>Boolean</td>
<td>å®šä¹‰æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º falseã€‚ è®¾ç½® true è¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œï¼Œä¸ä½¿ç”¨ Docker ç½‘æ¡¥ï¼ŒåŒæ—¶è®¾ç½®äº† true å°†æ— æ³•åœ¨åŒä¸€å°å®¿ä¸»æœºä¸Šå¯åŠ¨ç¬¬äºŒä¸ªå‰¯æœ¬ã€‚</td>
</tr>
<tr>
<td>service.spec.type</td>
<td></td>
<td><code>type</code>ç¡®å®šæœåŠ¡çš„å…¬å¼€æ–¹å¼ã€‚ é»˜è®¤ä¸º<code>ClusterIP</code>ã€‚æœ‰æ•ˆçš„é€‰é¡¹æ˜¯<code>ExternalName</code>ã€<code>ClusterIP</code>ã€<code>NodePort</code>å’Œ<code>LoadBalancer</code></td>
</tr>
<tr>
<td>service.spec.type.ClusterIP</td>
<td></td>
<td><code>ClusterIP</code>ä¸ºè´Ÿè½½å‡è¡¡åˆ†é…é›†ç¾¤å†…éƒ¨<code>IP</code>åœ°å€ç«¯ç‚¹ã€‚ ç«¯ç‚¹ç”±é€‰æ‹©å™¨ç¡®å®šï¼Œæˆ–è€…å¦‚æœä¸æ˜¯é€šè¿‡æ‰‹åŠ¨æ„é€ <code>Endpoints</code>å¯¹è±¡æˆ–<code>EndpointSlice</code>æŒ‡å®šå¯¹è±¡ã€‚ å¦‚æœ<code>clusterIP</code>ä¸º<code>None</code>ï¼Œåˆ™ä¸åˆ†é…è™šæ‹Ÿ<code>IP</code>ï¼Œå¹¶ä¸”ç«¯ç‚¹ä½œä¸ºä¸€ç»„ç«¯ç‚¹è€Œä¸æ˜¯è™šæ‹Ÿ<code>IP</code>å‘å¸ƒã€‚</td>
</tr>
<tr>
<td>service.spec.type.NodePort</td>
<td></td>
<td><code>NodePort</code>å»ºç«‹åœ¨<code>ClusterIP</code>ä¹‹ä¸Šï¼Œå¹¶åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šåˆ†é…ä¸€ä¸ªç«¯å£è·¯ç”±åˆ°ä¸<code>clusterIP</code>ç›¸åŒçš„ç«¯ç‚¹ã€‚</td>
</tr>
<tr>
<td>service.spec.type.LoadBalancer</td>
<td></td>
<td><code>LoadBalancer</code>å»ºç«‹åœ¨<code>NodePort</code>å¹¶åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚æœå½“å‰æ”¯æŒ<code>cloud</code>) è·¯ç”±åˆ°ä¸<code>clusterIP</code>ç›¸åŒçš„ç«¯ç‚¹ã€‚</td>
</tr>
<tr>
<td>service.spec.type.ExternalName</td>
<td></td>
<td><code>ExternalName</code>å°†æ­¤æœåŠ¡åˆ«åä¸ºæŒ‡å®šçš„<code>externalName</code>ã€‚ å…¶ä»–å‡ ä¸ªé¢†åŸŸä¸é€‚ç”¨äº<code>ExternalName</code>æœåŠ¡</td>
</tr>
</tbody>
</table>
<ul>
<li><code>tolerations</code><!-- raw HTML omitted -->(å®¹å¿)é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain deployment.spec.template.spec.tolerations</span></span></code></pre></div><ul>
<li><code>affinity</code><!-- raw HTML omitted -->(äº²å’Œæ€§)é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain deployment.spec.template.spec.affinity  	<span style="color:#75715e"># æŸ¥çœ‹ Deployment äº²å’Œæ€§ä½¿ç”¨</span></span></span></code></pre></div><blockquote>
<ul>
<li><code>nodeAffinity</code><!-- raw HTML omitted -->èŠ‚ç‚¹äº²å’Œæ€§<!-- raw HTML omitted --></li>
<li><code>requiredDuringSchedulingIgnoredDuringExecution:</code><!-- raw HTML omitted -->ç¡¬æ€§è¦æ±‚ï¼Œå¿…é¡»æ»¡è¶³æ¡ä»¶<!-- raw HTML omitted --></li>
<li><code>preferredDuringSchedulingIgnoredDuringExecution:</code><!-- raw HTML omitted -->è½¯æ€§è¦æ±‚ï¼Œä¸å¼ºåˆ¶æ»¡è¶³<!-- raw HTML omitted --></li>
<li><code>In</code><!-- raw HTML omitted -->ï¼šæ»¡è¶³æ¡ä»¶ä¹‹ä¸€<!-- raw HTML omitted --></li>
<li><code>NotIn</code><!-- raw HTML omitted -->ï¼šæ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œåäº²å’Œæ€§<!-- raw HTML omitted --></li>
<li><code>Exists</code><!-- raw HTML omitted -->ï¼šå­˜åœ¨å°±æ»¡è¶³<!-- raw HTML omitted --></li>
<li><code>DoesNotExist</code><!-- raw HTML omitted -->ä¸å­˜åœ¨å°±æ»¡è¶³<!-- raw HTML omitted --></li>
<li><code>Gt</code><!-- raw HTML omitted -->å¤§äºèŠ‚ç‚¹ä¸Šçš„æ•°å€¼å°±æ»¡è¶³<!-- raw HTML omitted --></li>
<li><code>Lt</code><!-- raw HTML omitted -->å°äºèŠ‚ç‚¹ä¸Šçš„æ•°å€¼å°±æ»¡è¶³<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain deployment.spec.template.spec.affinity.nodeAffinity  	<span style="color:#75715e"># æŸ¥çœ‹Deployment nodesäº²å’Œæ€§ä½¿ç”¨</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">with-affinity-anti-affinity</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodeAffinity</span>:  	<span style="color:#75715e"># èŠ‚ç‚¹äº²å’Œæ€§  </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">requiredDuringSchedulingIgnoredDuringExecution</span>:  	<span style="color:#75715e"># å¿…é¡»æ»¡è¶³æ¡ä»¶</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">nodeSelectorTerms</span>:  	<span style="color:#75715e"># é€‰æ‹©å™¨ï¼ŒnodeSelectorTermsï¼šèŠ‚ç‚¹é€‰æ‹©å™¨ï¼ŒlabelSelectorï¼šæ ‡ç­¾é€‰æ‹©å™¨</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">matchExpressions</span>:  	<span style="color:#75715e"># è¡¨è¾¾å¼åŒ¹é…</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">kubernetes.io/os  	# å¿…é¡»å­˜åœ¨çš„Key</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In  	# åœ¨Keyä¸­æ»¡è¶³ä¸€ä¸ªæ¡ä»¶ï¼ŒåŒ¹é…ç±»å‹ï¼šInã€NotInã€Existsã€DoesNotExistã€Gtã€Lt</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>:  	<span style="color:#75715e"># ä¸‹æ–¹ value åœ¨ Key ä¸­å¿…é¡»å­˜åœ¨å…¶ä¸­ä¹‹ä¸€(value)</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">linux  	# å¿…é¡»æ˜¯Linuxæ‰éƒ¨ç½²  </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">preferredDuringSchedulingIgnoredDuringExecution</span>:  	<span style="color:#75715e"># è½¯æ€§è¦æ±‚ï¼Œä¸å¼ºåˆ¶æ»¡è¶³ï¼Œä¼˜å…ˆé€‰æ‹©äº²å’Œæ€§ç›®æ ‡</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">weight</span>: <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æƒé‡ï¼Œæ•°å€¼è¶Šå¤§ï¼Œä¼˜å…ˆéƒ¨ç½²</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">preference</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">label-1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">key-1</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">weight</span>: <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">preference</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">label-2</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">key-2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">with-node-affinity</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">registry.k8s.io/pause:2.0</span></span></span></code></pre></div><ul>
<li><code>podAffinity</code><!-- raw HTML omitted -->äº²å’Œæ€§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain pod.spec.affinity.podAffinity</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">with-pod-affinity</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">podAffinity</span>:  	<span style="color:#75715e"># Pod äº²å’Œæ€§</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">labelSelector</span>:  	<span style="color:#75715e"># é€‰æ‹©å™¨ï¼š</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">security</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">S1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">topologyKey</span>: <span style="color:#ae81ff">topology.kubernetes.io/zone  	# åŒ¹é…èŠ‚ç‚¹æ ‡ç­¾äº²å’Œæ€§</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">podAntiAffinity</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">preferredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">weight</span>: <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">podAffinityTerm</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">labelSelector</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">security</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#ae81ff">S2</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">topologyKey</span>: <span style="color:#ae81ff">topology.kubernetes.io/zone</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">with-pod-affinity</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">registry.k8s.io/pause:2.0  </span></span></span></code></pre></div><ul>
<li><code>podAntiAffinity</code><!-- raw HTML omitted -->åäº²å’Œæ€§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain pod.spec.affinity.podAntiAffinity  </span></span></code></pre></div></blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:  	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># åˆ›å»ºPodä¸ªæ•°</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">selector</span>:  	<span style="color:#75715e"># æ ‡ç­¾é€‰æ‹©å™¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">matchLabels</span>:  	<span style="color:#75715e"># æ ‡ç­¾é€‰æ‹©æ–¹å¼:ç›´æ¥ç»™å®šæ ‡ç­¾é”®å€¼,è¿™é‡Œæ˜¯å–äº¤é›†çš„,ä¹Ÿå°±æ˜¯Podå¿…é¡»æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ ‡ç­¾æ‰èƒ½è¢«è°ƒåº¦</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">project</span>: <span style="color:#ae81ff">ms</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">product  	# æ­¤è¡Œä»¥ä¸Šå®šä¹‰æ§åˆ¶å™¨æœ¬èº«</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:  	<span style="color:#75715e"># å®šä¹‰Deploymentæ›´æ–°å›æ»š</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>         - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">annotations</span>:  	<span style="color:#75715e"># æ³¨é‡Šï¼Œä¸èƒ½ä½œä¸ºè¢«ç­›é€‰</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hostAliases</span>:  	<span style="color:#75715e"># /etc/hosts/æ‰‹åŠ¨æ·»åŠ è§£æ</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">ip</span>: <span style="color:#e6db74">&#34;192.168.4.110&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostnames</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;k8s.com&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:   	<span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">restartPolicy</span>: [<span style="color:#ae81ff">Alwaysã€Neverã€OnFailure] </span> <span style="color:#75715e">#é»˜è®¤K8S-Podçš„é‡å¯ç­–ç•¥,æ­¤å®¹å™¨é€€å‡ºåç«‹å³åˆ›å»ºä¸€ä¸ªç›¸åŒå®¹å™¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeName</span>: <span style="color:#ae81ff">k8s-node1</span> <span style="color:#75715e"># NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeSelector</span>: <span style="color:#ae81ff">obeject</span> <span style="color:#75715e"># nodeSelectorç”¨äºå°†Podè°ƒåº¦åˆ°æ·»åŠ äº†æŒ‡å®šæ ‡ç­¾çš„NodeèŠ‚ç‚¹ä¸Š</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">imagePullSecrets</span>:  	<span style="color:#75715e"># é…ç½®ç™»å½• docker registry çš„ secret ä»“åº“</span>
</span></span><span style="display:flex;"><span>     - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker-harbor  	# æŒ‡å®šä½¿ç”¨çš„secretåº“æˆ¿åç§°</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">hostNetwork</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e">#æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="replicasetrsç±»å‹æ§åˆ¶å™¨"><code>ReplicaSet(RS)</code>ç±»å‹æ§åˆ¶å™¨</h3>
<blockquote>
<ul>
<li><code>ReplicaSet</code><!-- raw HTML omitted -->ï¼šä¸»è¦ä½œç”¨æ˜¯ä¿è¯ä¸€å®šæ•°é‡çš„<code>Pod</code>èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œå®ƒä¼šæŒç»­ç›‘å¬è¿™äº›<code>Pod</code>çš„è¿è¡ŒçŠ¶æ€ï¼Œä¸€æ—¦<code>Pod</code>å‘ç”Ÿæ•…éšœï¼Œå°±ä¼šé‡å¯æˆ–é‡å»ºã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒå¯¹<code>Pod</code>æ•°é‡çš„æ‰©ç¼©å®¹å’Œç‰ˆæœ¬é•œåƒçš„å‡çº§<!-- raw HTML omitted --></li>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/ReplicaSet/kubernetes-replicaset-template.yaml" rel="external" target="_self"><code>Kubernetes replicaset Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1    </span> <span style="color:#75715e"># ç‰ˆæœ¬å· </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ReplicaSet       </span> <span style="color:#75715e"># ç±»å‹ </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       <span style="color:#75715e"># å…ƒæ•°æ® </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">replicaset-template    </span> <span style="color:#75715e"># åç§°ã€åœ¨ä¸€ä¸ªåç§°ç©ºé—´å†…ä¸èƒ½é‡å¤</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># æŒ‡å®šåç§°ç©ºé—´ã€é»˜è®¤defalut</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:       <span style="color:#75715e"># æ ‡ç­¾ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">replicaset-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># è¯¦æƒ…æè¿° </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>   <span style="color:#75715e"># æŒ‡å®šå‰¯æœ¬æ•°é‡ï¼Œæ˜¯rsåˆ›å»ºå‡ºæ¥çš„Podçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:     <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯å»ºç«‹Podæ§åˆ¶å™¨å’ŒPodä¹‹é—´çš„å…³è”å…³ç³»ï¼Œé‡‡ç”¨äº†Label Selectoræœºåˆ¶ï¼ˆåœ¨Podæ¨¡å—ä¸Šå®šä¹‰Labelï¼Œåœ¨æ§åˆ¶å™¨ä¸Šå®šä¹‰é€‰æ‹©å™¨ï¼Œå°±å¯ä»¥è¡¨æ˜å½“å‰æ§åˆ¶å™¨èƒ½ç®¡ç†å“ªäº›Podäº†ï¼‰</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:        <span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™ï¼ŒmatchExpressionsï¼šExpressionsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">replicaset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:     <span style="color:#75715e"># æ¨¡å— å½“å‰¯æœ¬æ•°æ®ä¸è¶³çš„æ—¶å€™ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºPodå‰¯æœ¬</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">replicaset-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx    </span> <span style="color:#75715e"># å®¹å™¨åç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1    </span> <span style="color:#75715e"># å®¹å™¨éœ€è¦çš„é•œåƒåœ°å€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>     <span style="color:#75715e"># å®¹å™¨æ‰€ç›‘å¬çš„ç«¯å£</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">100m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">50m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="horizontalpodautoscalerç±»å‹"><code>HorizontalPodAutoscaler</code>ç±»å‹</h3>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/HPA/kubernetes-hpa-template.yaml" rel="external" target="_self"><code>Kubernetes HorizontalPodAutoscaler Template</code>æ¨¡æ¿</a></li>
</ul>
<blockquote>
<ul>
<li><code>deployment</code><!-- raw HTML omitted -->ï¼šç±»å‹æ§åˆ¶å™¨<!-- raw HTML omitted --></li>
<li><code>deployment-name</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>çš„åç§°<!-- raw HTML omitted --></li>
<li><code>--cpu-percent</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨<code>CPU</code>ç™¾åˆ†æ¯”<!-- raw HTML omitted --></li>
<li><code>--min</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>æœ€å°‘æ•°é‡<!-- raw HTML omitted --></li>
<li><code>--max</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>æœ€å¤šæ•°é‡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl autoscale deployment deployment-name --cpu-percent<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span> --min<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> --max<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span></span></span></code></pre></div></blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">autoscaling/v2   </span> <span style="color:#75715e"># ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">HorizontalPodAutoscaler  </span> <span style="color:#75715e"># ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:   <span style="color:#75715e"># å…ƒæ•°æ® </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># æŒ‡å®šåç§°ç©ºé—´ã€é»˜è®¤default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hpa-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">minReplicas</span>: <span style="color:#ae81ff">2</span>   <span style="color:#75715e"># æœ€å°Podæ•°é‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">maxReplicas</span>: <span style="color:#ae81ff">10</span>    <span style="color:#75715e"># æœ€å¤§Podæ•°é‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">metrics</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">resource</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cpu  	# æ‰©ç¼©å®¹åç§°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">target</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">averageUtilization</span>: <span style="color:#ae81ff">30</span>  	<span style="color:#75715e"># è®¾ç½®CPUä½¿ç”¨ç™¾åˆ†æ¯”ï¼Œè¶…è¿‡å°±æ‰©å®¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Utilization  	# åˆ©ç”¨ç‡ï¼šUtilizationï¼Œå¹³å‡å€¼ï¼šAverageValueï¼š1kã€1Mã€1G</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Resource</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">scaleTargetRef</span>:    <span style="color:#75715e"># æŒ‡å®šè¦æ§åˆ¶Podã€Deploymentä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-template</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">service-template</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  clusterIP: None       # å°†clusterIPè®¾ç½®ä¸ºNoneï¼Œå³å¯åˆ›å»ºheadliness Service</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort       </span> <span style="color:#75715e"># Podä½¿ç”¨çš„IPç±»å‹ï¼šClusterIPã€NodePort</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>    <span style="color:#75715e"># Serviceçš„ç«¯å£</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>      <span style="color:#75715e"># StatefulSet çš„Podç«¯å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1    </span> <span style="color:#75715e"># ç‰ˆæœ¬å· </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment       </span> <span style="color:#75715e"># ç±»å‹ </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       <span style="color:#75715e"># å…ƒæ•°æ® </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-template    </span> <span style="color:#75715e"># deploymentçš„åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># æŒ‡å®šåç§°ç©ºé—´ã€é»˜è®¤default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:       <span style="color:#75715e"># æ ‡ç­¾ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># è¯¦æƒ…æè¿° </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>   <span style="color:#75715e"># å‰¯æœ¬æ•°é‡ </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">3</span>       <span style="color:#75715e"># ä¿ç•™å†å²ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º10 </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">paused</span>: <span style="color:#66d9ef">false</span>         <span style="color:#75715e"># æš‚åœéƒ¨ç½²ï¼Œé»˜è®¤æ˜¯false </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>          <span style="color:#75715e"># éƒ¨ç½²è¶…æ—¶æ—¶é—´ï¼ˆsï¼‰ï¼Œé»˜è®¤æ˜¯600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:     <span style="color:#75715e"># podæ›´æ–°ç­–ç•¥ï¼Œå³å¦‚ä½•æ›¿æ¢å·²æœ‰çš„pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate        </span> <span style="color:#75715e"># æ›´æ–°ç­–ç•¥ã€æ”¯æŒ Recreate, RollingUpdateã€‚é»˜è®¤RollingUpdate</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:      <span style="color:#75715e"># å½“typeä¸ºRollingUpdateçš„æ—¶å€™ç”Ÿæ•ˆï¼Œç”¨äºä¸ºrollingUpdateè®¾ç½®å‚æ•°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%      </span> <span style="color:#75715e"># ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%    </span> <span style="color:#75715e"># ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:     <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:        <span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™ï¼ŒmatchExpressionsï¼šExpressionsåŒ¹é…è§„åˆ™ </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:     <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:   <span style="color:#75715e"># Pod çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:   <span style="color:#75715e"># Pod çš„æœŸæœ›ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:   <span style="color:#75715e"># Pod å®¹å™¨æè¿°</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx  </span> <span style="color:#75715e"># é•œåƒåç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent  </span> <span style="color:#75715e"># IfNotPresentï¼šå¦‚æœé•œåƒä¸å­˜åœ¨å°±æ‹‰å–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">100m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">50m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Always  </span> <span style="color:#75715e"># é‡å¯ç­–ç•¥ï¼ŒAlwaysï¼šä»£è¡¨ä¸€ç›´é‡å¯</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>   <span style="color:#75715e"># åˆ é™¤æ“ä½œå®½é™æ—¶é—´</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="deploymentdeployæ— çŠ¶æ€ç±»å‹"><code>Deployment(deploy)</code>æ— çŠ¶æ€ç±»å‹</h3>

<pre class="mermaid align-center zoomable">graph TD
A[&lt;p&gt;Deployment&lt;br&gt;seletor:env=dev] --&gt; A1((&lt;p&gt;Pod&lt;br&gt;label:env=dev))
A[&lt;p&gt;Deployment&lt;br&gt;seletor:env=dev] --&gt; A2((&lt;p&gt;Pod&lt;br&gt;label:env=dev))
A[&lt;p&gt;Deployment&lt;br&gt;seletor:env=dev] --&gt; A3((&lt;p&gt;Pod&lt;br&gt;label:env=dev))
    Z[Deploymentæ§åˆ¶Pod]  </pre><blockquote>
<ul>
<li><code>Deployment</code><!-- raw HTML omitted -->ï¼šä¸ºäº†æ›´å¥½çš„è§£å†³æœåŠ¡ç¼–æ’çš„é—®é¢˜ï¼Œ<!-- raw HTML omitted --><code>kubernetes</code>åœ¨<code>v1.2</code>ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†<code>Deployment</code>æ§åˆ¶å™¨ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<code>Deployment</code>æ§åˆ¶å™¨å¹¶ä¸ç›´æ¥ç®¡ç†<code>Pod</code>ï¼Œè€Œæ˜¯é€šè¿‡ç®¡ç†<code>ReplicaSet</code>æ¥é—´æ¥ç®¡ç†<code>Pod</code>ï¼Œå³ï¼š<code>Deployment</code>ç®¡ç†<code>ReplicaSet</code>ï¼Œ<code>ReplicaSet</code>ç®¡ç†<code>Pod</code>ã€‚æ‰€ä»¥<code>Deployment</code>çš„åŠŸèƒ½æ¯”<code>ReplicaSet</code>å¼ºå¤§</li>
<li>æ”¯æŒ<code>ReplicaSet</code>çš„æ‰€æœ‰åŠŸèƒ½</li>
<li><!-- raw HTML omitted -->æ”¯æŒå‘å¸ƒçš„åœæ­¢ã€ç»§ç»­<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æ”¯æŒç‰ˆæœ¬æ»šåŠ¨æ›´æ–°å’Œç‰ˆæœ¬å›é€€<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>Recreate</code><!-- raw HTML omitted -->é‡å»ºæ›´æ–°ï¼šåœ¨åˆ›å»ºå‡ºæ–°çš„<code>Pod</code>ä¹‹å‰ä¼šå…ˆæ€æ‰æ‰€æœ‰å·²ç»å­˜åœ¨çš„<!-- raw HTML omitted --><code>Pod</code></p>
</li>
<li>
<p><code>RollingUpdate</code><!-- raw HTML omitted -->æ»šåŠ¨æ›´æ–°ï¼šæ€æ­»ä¸€éƒ¨åˆ†ï¼Œå°±å¯åŠ¨ä¸€éƒ¨åˆ†ï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­å­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬çš„<!-- raw HTML omitted --><code>Pod</code>ï¼Œå½“<code>type</code>ä¸º<code>RollingUpdate</code>çš„æ—¶å€™ç”Ÿæ•ˆï¼Œç”¨äºä¸º<code>rollingUpdate</code>è®¾ç½®å‚æ•°ï¼Œ  æ”¯æŒä¸¤ä¸ªå±æ€§ï¼š</p>
</li>
<li>
<p><code>maxSurge</code><!-- raw HTML omitted -->ï¼šç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„<code>Pod</code>çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>maxUnavailable</code><!-- raw HTML omitted -->ï¼šç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨çš„<code>Pod</code>çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%<!-- raw HTML omitted --></p>
</li>
</ul>
</blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/Deployment/kubernetes-deployment-template.yaml" rel="external" target="_self"><code>Kubernetes Deployment Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1  	# ç‰ˆæœ¬å· </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment  	# ç±»å‹ </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:  	<span style="color:#75715e"># å…ƒæ•°æ® </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-template  	# deploymentçš„åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default  	# æŒ‡å®šåç§°ç©ºé—´ã€é»˜è®¤defalut</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:  	<span style="color:#75715e"># æ ‡ç­¾ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:  	<span style="color:#75715e"># è¯¦æƒ…æè¿° </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>  	<span style="color:#75715e"># å‰¯æœ¬æ•°é‡ </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">3</span>  	<span style="color:#75715e"># ä¿ç•™å†å²ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º10 </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">paused</span>: <span style="color:#66d9ef">false</span>  	<span style="color:#75715e"># æš‚åœéƒ¨ç½²ï¼Œé»˜è®¤æ˜¯false </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>  	<span style="color:#75715e"># éƒ¨ç½²è¶…æ—¶æ—¶é—´ï¼ˆsï¼‰ï¼Œé»˜è®¤æ˜¯600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:  	<span style="color:#75715e"># podæ›´æ–°ç­–ç•¥ï¼Œå³å¦‚ä½•æ›¿æ¢å·²æœ‰çš„pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:  	<span style="color:#75715e"># å½“typeä¸ºRollingUpdateçš„æ—¶å€™ç”Ÿæ•ˆï¼Œç”¨äºä¸ºrollingUpdateè®¾ç½®å‚æ•°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%  	# ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%  	# ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate  	# æ›´æ–°ç­–ç•¥ã€æ”¯æŒ Recreate, RollingUpdateã€‚é»˜è®¤RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:  	<span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:  	<span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™ï¼ŒmatchExpressionsï¼šExpressionsåŒ¹é…è§„åˆ™ </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:  	<span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:   <span style="color:#75715e"># Pod çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deployment-nginx-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:   <span style="color:#75715e"># Pod çš„æœŸæœ›ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:   <span style="color:#75715e"># Pod å®¹å™¨æè¿°</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx  </span> <span style="color:#75715e"># é•œåƒåç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1    </span> <span style="color:#75715e"># fxgxxxxx/nginx:v1 åœ¨æ‰€æœ‰èŠ‚ç‚¹ç™»å½•è‡ªå·±çš„ hub.docker.com è´¦æˆ·</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent  </span> <span style="color:#75715e"># IfNotPresentï¼šå¦‚æœé•œåƒä¸å­˜åœ¨å°±æ‹‰å–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:   <span style="color:#75715e"># æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx_vhosts   </span> <span style="color:#75715e"># å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/usr/local/nginx/conf/vhosts  </span> <span style="color:#75715e"># å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx_logs</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/usr/local/nginx/logs</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx_html</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:      <span style="color:#75715e"># èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:   <span style="color:#75715e"># é™å®šPodæœ€å¤§ä½¿ç”¨ç¡¬ä»¶èµ„æºã€é€šå¸¸è®¾ç½®cpuå’Œmemory</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;6&#34;</span>    <span style="color:#75715e"># Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°ï¼Œ1000mç­‰äºä¸€ä¸ªæ ¸å¿ƒ</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;128Mi&#34;</span>     <span style="color:#75715e"># å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:     <span style="color:#75715e"># æœ€ä½èµ„æºè¦æ±‚ï¼Œåœ¨schedulerä¸­è¢«ç”¨åˆ°ï¼Œé€šå¸¸è®¾ç½®cpuå’Œmemory</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;3&#34;</span>    <span style="color:#75715e"># é™å®šä½¿ç”¨å‡ ä¸ªæ ¸å¿ƒCPUã€å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;64Mi&#34;</span>      <span style="color:#75715e"># è®¾å®šä½¿ç”¨å†…å­˜ã€å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Always  </span> <span style="color:#75715e"># é‡å¯ç­–ç•¥ï¼ŒAlwaysï¼šä»£è¡¨ä¸€ç›´é‡å¯</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>   <span style="color:#75715e"># åˆ é™¤æ“ä½œå®½é™æ—¶é—´</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:      <span style="color:#75715e"># åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx_vhosts    </span> <span style="color:#75715e"># å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰ </span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hostPath</span>:   <span style="color:#75715e"># ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/nginx/vhosts</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate  </span> <span style="color:#75715e"># ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºå†ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx_logs</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hostPath</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/nginx/logs</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx_html</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hostPath</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/nginx/html</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">status</span>: {}</span></span></code></pre></div><ul>
<li>ä½¿ç”¨å˜é‡è¿›è¡Œä¼ å‚</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -e <span style="color:#e6db74">&#39;s#{REPLICAS}#1#g&#39;</span> -e <span style="color:#e6db74">&#39;s#{IMAGE}#myharbor.com:9527/test/IMAGE[:TAG_ID]#g&#39;</span> -e <span style="color:#e6db74">&#39;s#{JOB_NAME}#k8s-jd-core#g&#39;</span> -e <span style="color:#e6db74">&#39;s#{ENV}#dev#g&#39;</span> /opt/jenkins/deployment_yaml/k8s-deployment.tpl &gt; /opt/jenkins/deployment_yaml/k8s-wim-core-dev.yaml</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: {<span style="color:#ae81ff">JOB_NAME}-{ENV}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">simple-chat-{ENV}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: {<span style="color:#ae81ff">REPLICAS}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">k8s-app</span>: {<span style="color:#ae81ff">JOB_NAME}-{ENV}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">10</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">90</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">k8s-app</span>: {<span style="color:#ae81ff">JOB_NAME}-{ENV}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nodeSelector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">deploy/env</span>: {<span style="color:#ae81ff">ENV}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: {<span style="color:#ae81ff">JOB_NAME}-{ENV}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: {<span style="color:#ae81ff">IMAGE}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/etc/localtime</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume-time</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/app/.env.local</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume-env-{JOB_NAME}-{ENV}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">subPath</span>: <span style="color:#ae81ff">.env.local</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">hostPath</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/usr/share/zoneinfo/Asia/Shanghai</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">type</span>: <span style="color:#ae81ff">File</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume-time</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">configMap</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">defaultMode</span>: <span style="color:#ae81ff">420</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">app_env_local</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">path</span>: <span style="color:#ae81ff">.env.local</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-env-{JOB_NAME}-{ENV}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volume-env-{JOB_NAME}-{ENV}</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: {<span style="color:#ae81ff">JOB_NAME}-{ENV}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">simple-chat-{ENV}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">k8s-app</span>: {<span style="color:#ae81ff">JOB_NAME}-{ENV}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">http-{JOB_NAME}-{ENV}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">networking.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Ingress</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">generation</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: {<span style="color:#ae81ff">JOB_NAME}-ingress-{ENV}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">simple-chat-{ENV}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nginx.ingress.kubernetes.io/rewrite-target</span>: <span style="color:#ae81ff">/$2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ingressClassName</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">host</span>: {<span style="color:#ae81ff">JOB_NAME}-ingress-{ENV}.com</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">http</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">backend</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">name</span>: {<span style="color:#ae81ff">JOB_NAME}-{ENV}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">port</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">number</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/{JOB_NAME}(/|$)(.*)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">pathType</span>: <span style="color:#ae81ff">Prefix</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="statefulsetæœ‰çŠ¶æ€ç±»å‹"><code>StatefulSet</code>æœ‰çŠ¶æ€ç±»å‹</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ— çŠ¶æ€åº”ç”¨å®šä¹‰<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>è®¤ä¸º<code>Pod</code>éƒ½æ˜¯ä¸€æ ·çš„</li>
<li>æ²¡æœ‰é¡ºåºè¦æ±‚</li>
<li>ä¸ç”¨è€ƒè™‘åœ¨å“ªä¸ª<code>Node</code>èŠ‚ç‚¹ä¸Šè¿è¡Œ</li>
<li>éšæ„è¿›è¡Œä¼¸ç¼©å’Œæ‰©å±•</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æœ‰çŠ¶æ€åº”ç”¨å®šä¹‰<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>æœ‰é¡ºåºè¦æ±‚</li>
<li>è®¤ä¸ºæ¯ä¸ª<code>Pod</code>éƒ½æ˜¯ä¸ä¸€æ ·çš„</li>
<li>éœ€è¦è€ƒè™‘åœ¨å“ªä¸ª<code>Node</code>èŠ‚ç‚¹ä¸Šè¿è¡Œ</li>
<li>éœ€è¦æŒ‰ç…§é¡ºåºè¿›è¡Œä¼¸ç¼©å’Œæ‰©å±•</li>
<li>è®©æ¯ä¸ª<code>Pod</code>éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¿æŒ<code>Pod</code>å¯åŠ¨é¡ºåºå’Œå”¯ä¸€æ€§</li>
</ul>
</blockquote>
<ul>
<li><code>StatefulSet</code> æ˜¯<code>Kubernetes</code><!-- raw HTML omitted -->æä¾›çš„ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨çš„è´Ÿè½½ç®¡ç†æ§åˆ¶å™¨<!-- raw HTML omitted --></li>
<li><code>StatefulSet</code><!-- raw HTML omitted -->å¸¸ç”¨æ¥éƒ¨ç½²<!-- raw HTML omitted --><code>RabbitMQ</code>é›†ç¾¤ã€<code>Zookeeper</code>é›†ç¾¤ã€<code>MySQL</code>é›†ç¾¤ã€<code>Eureka</code>é›†ç¾¤ç­‰</li>
<li><code>StatefulSet</code><!-- raw HTML omitted -->éƒ¨ç½²éœ€è¦<!-- raw HTML omitted --><code>HeadLinessService</code>ï¼ˆæ— å¤´æœåŠ¡ï¼‰</li>
</ul>
<blockquote>
<ul>
<li>åœ¨ç”¨<code>Deployment</code>æ—¶ï¼Œæ¯ä¸€ä¸ª<code>Pod</code>åç§°æ˜¯æ²¡æœ‰é¡ºåºçš„ï¼Œæ˜¯éšæœºå­—ç¬¦ä¸²ï¼Œå› æ­¤æ˜¯<code>Pod</code>åç§°æ˜¯æ— åºçš„ï¼Œä½†æ˜¯åœ¨<code>StatefulSet</code>ä¸­è¦æ±‚å¿…é¡»æ˜¯æœ‰åº ï¼Œæ¯ä¸€ä¸ª<code>Pod</code>ä¸èƒ½è¢«éšæ„å–ä»£ï¼Œ<code>Pod</code>é‡å»ºå<code>pod</code>åç§°è¿˜æ˜¯ä¸€æ ·çš„</li>
<li>è€Œ<code>Pod IP</code>æ˜¯å˜åŒ–çš„ï¼Œæ‰€ä»¥æ˜¯ä»¥<code>Pod</code>åç§°æ¥è¯†åˆ«ã€‚<code>Pod</code>åç§°æ˜¯<code>Pod</code>å”¯ä¸€æ€§çš„æ ‡è¯†ç¬¦ï¼Œå¿…é¡»æŒä¹…ç¨³å®šæœ‰æ•ˆã€‚è¿™æ—¶å€™è¦ç”¨åˆ°<!-- raw HTML omitted -->æ— å¤´æœåŠ¡<!-- raw HTML omitted -->ï¼Œå®ƒå¯ä»¥ç»™æ¯ä¸ª<code>Pod</code>ä¸€ä¸ªå”¯ä¸€çš„åç§°</li>
</ul>
</blockquote>
<ul>
<li><code>Deployment</code>å’Œ<code>StatefulSet</code>åŒºåˆ«ï¼š<code>Deployment</code><!-- raw HTML omitted -->æ²¡æœ‰å”¯ä¸€æ ‡è¯†è€Œ<!-- raw HTML omitted --><code>StatefulSet</code>æœ‰å”¯ä¸€æ ‡è¯†</li>
<li><code>StatefulSet</code><!-- raw HTML omitted -->å”¯ä¸€æ ‡è¯†ç”Ÿæˆè§„åˆ™<!-- raw HTML omitted -->ï¼š  æ ¹æ®ä¸»æœºå+ä¸€å®šè§„åˆ™ç”Ÿæˆçš„ï¼š<!-- raw HTML omitted -->ä¸»æœºå.æ— å¤´<!-- raw HTML omitted --><code>Service</code>åç§°.å‘½åç©ºé—´<code>.svc.cluster.local</code></li>
<li><code>StatefulSet</code><!-- raw HTML omitted -->æ§åˆ¶å™¨æ”¯æŒä¸¤ç§æ›´æ–°ç­–ç•¥<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>OnDelete</code>ï¼š <code>OnDelete</code><!-- raw HTML omitted -->è¡¨ç¤ºåˆ é™¤ä¹‹åæ‰æ›´æ–°<!-- raw HTML omitted --></li>
<li>(é»˜è®¤)<code>RollingUpdate</code>ï¼š<code>RollingUpdate</code><!-- raw HTML omitted -->è¡¨ç¤ºæ»šåŠ¨æ›´æ–°<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/StatefulSet/kubernetes-statefulset-template.yaml" rel="external" target="_self"><code>Kubernetes StatefulSet Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">service-template</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">clusterIP</span>: <span style="color:#ae81ff">None      </span> <span style="color:#75715e"># å°†clusterIPè®¾ç½®ä¸ºNoneï¼Œå³å¯åˆ›å»ºheadliness Service</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP  	# ç±»å‹ï¼šNodePort</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>    <span style="color:#75715e"># Serviceçš„ç«¯å£</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>      <span style="color:#75715e"># StatefulSet çš„Podç«¯å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StatefulSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceName</span>: <span style="color:#ae81ff">service-template  </span> <span style="color:#75715e"># ä½¿ç”¨é‚£ä¸ªServiceç®¡ç†DNS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">updateStrategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate        </span> <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°ï¼ŒOnDeleteï¼šåˆ é™¤æ›´æ–°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:      <span style="color:#75715e"># å¦‚æœæ›´æ–°çš„ç­–ç•¥æ˜¯OnDeleteï¼Œé‚£ä¹ˆrollingUpdateå°±å¤±æ•ˆ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">partition</span>: <span style="color:#ae81ff">2</span>      <span style="color:#75715e"># è¡¨ç¤ºä»ç¬¬2ä¸ªåˆ†åŒºå¼€å§‹æ›´æ–°ï¼Œé»˜è®¤æ˜¯0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="daemonsetdså®ˆæŠ¤è¿›ç¨‹ç±»å‹"><code>DaemonSet(ds)</code>å®ˆæŠ¤è¿›ç¨‹ç±»å‹</h3>
<blockquote>
<ul>
<li>
<p><code>DaemonSet</code><!-- raw HTML omitted -->ï¼šæ§åˆ¶å™¨å¯ä»¥ä¿è¯é›†ç¾¤ä¸­çš„æ¯ä¸€å°ï¼ˆæˆ–æŒ‡å®šï¼‰èŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬é€‚ç”¨äºæ—¥å¿—(<code>elk</code>)æ”¶é›†ã€èŠ‚ç‚¹ç›‘æ§(<code>zabbix</code>)ç­‰åœºæ™¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<!-- raw HTML omitted -->å¦‚æœä¸€ä¸ª<code>Pod</code>æä¾›çš„åŠŸèƒ½æ˜¯èŠ‚ç‚¹çº§åˆ«çš„ï¼ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ä¸”åªéœ€è¦ä¸€ä¸ªï¼‰ï¼Œé‚£ä¹ˆè¿™ç±»<code>Pod</code>å°±é€‚åˆä½¿ç”¨<code>DaemonSet</code>ç±»å‹çš„æ§åˆ¶å™¨åˆ›å»º</p>
</li>
<li>
<p><code>DaemonSet</code><!-- raw HTML omitted -->æ§åˆ¶å™¨çš„ç‰¹ç‚¹<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->  æ¯å‘é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œ<!-- raw HTML omitted -->æŒ‡å®šçš„<code>Pod</code>å‰¯æœ¬ä¹Ÿå°†æ·»åŠ åˆ°è¯¥èŠ‚ç‚¹ä¸Š</p>
<p><!-- raw HTML omitted -->å½“èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤çš„æ—¶å€™ï¼Œ<!-- raw HTML omitted --><code>Pod</code>ä¹Ÿä¼šè¢«åƒåœ¾å›æ”¶</p>
</li>
<li>
<p><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/DaemonSet/kubernetes-daemonset-template.yaml" rel="external" target="_self"><code>Kubernetes DaemonSet Template</code>æ¨¡æ¿</a></p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1  </span> <span style="color:#75715e"># ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">DaemonSet        </span> <span style="color:#75715e"># ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">fluentd-daemonset      </span> <span style="color:#75715e"># Pod åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># æŒ‡å®šåç§°ç©ºé—´ã€é»˜è®¤default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:       <span style="color:#75715e"># æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#39;fluentd-es&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># Pod è¯¦æƒ…æè¿°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">3</span>       <span style="color:#75715e"># ä¿ç•™å†å²ç‰ˆæœ¬ã€é»˜è®¤ä¸ºæœ€å¤§å€¼(2^32)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">updateStrategy</span>:       <span style="color:#75715e"># æ›´æ–°ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate        </span> <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:      <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">1</span>         <span style="color:#75715e"># æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„Podçš„æœ€å¤§å€¼ï¼Œå¯ç”¨ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:     <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†é‚£äº›Pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels:        # LabelsåŒ¹é…è§„åˆ™ï¼ŒmatchExpressions</span>: <span style="color:#ae81ff">åŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#39;fluentd-es&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:     <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºPodæ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#39;fluentd-es&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">fluentd-es</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">agilestacks/fluentd-elasticsearch:v1.3.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:    <span style="color:#75715e"># ç¯å¢ƒå˜é‡é…ç½®</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">FLUENTD_ARGS   </span> <span style="color:#75715e"># ç¯å¢ƒå˜é‡çš„ key</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: -<span style="color:#ae81ff">qq   </span> <span style="color:#75715e"># ç¯å¢ƒå˜é‡çš„ value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:   <span style="color:#75715e"># åŠ è½½æ•°æ®å· é¿å…æ•°æ®ä¸¢å¤±</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">containers     </span> <span style="color:#75715e"># æ•°æ®å·åç§°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/lib/docker/containers        </span> <span style="color:#75715e"># å°†æ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨å†…é‚£ä¸ªç›®å½•</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">varlog</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:          <span style="color:#75715e"># å®šä¹‰æ•°æ®å·</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">containers       </span> <span style="color:#75715e"># å®šä¹‰æ•°æ®å·çš„åç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hostPath</span>:       <span style="color:#75715e"># æ•°æ®å·ç±»å‹ï¼Œä¸»æœºè·¯å¾„æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/var/lib/docker/containers     </span> <span style="color:#75715e"># node ä¸­å…±äº«ç›®å½•</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">varlog</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hostPath</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/var/log</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="serviceç±»å‹æ§åˆ¶å™¨"><code>Service</code>ç±»å‹æ§åˆ¶å™¨</h3>
<blockquote>
<ul>
<li>åœ¨<code>kubernetes</code>ä¸­ï¼Œ<code>Pod</code>æ˜¯åº”ç”¨ç¨‹åºçš„è½½ä½“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Pod</code>çš„<code>IP</code>æ¥è®¿é—®åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯<code>Pod</code>çš„<code>IP</code>åœ°å€ä¸æ˜¯å›ºå®šçš„ï¼Œè¿™å°±æ„å‘³ç€ä¸æ–¹ä¾¿ç›´æ¥é‡‡ç”¨<code>Pod</code>çš„<code>IP</code>å¯¹æœåŠ¡è¿›è¡Œè®¿é—®</li>
<li>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<code>kubernetes</code>æä¾›äº†<code>Service</code>èµ„æºï¼Œ<code>Service</code>ä¼šå¯¹æä¾›åŒä¸€ä¸ªæœåŠ¡çš„å¤šä¸ª<code>Pod</code>è¿›è¡Œèšåˆï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£åœ°å€ï¼Œé€šè¿‡è®¿é—®<code>Service</code>çš„å…¥å£åœ°å€å°±èƒ½è®¿é—®åˆ°åé¢çš„<code>Pod</code>æœåŠ¡</li>
<li><code>Service</code>åœ¨å¾ˆå¤šæƒ…å†µä¸‹åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼šçœŸæ­£èµ·ä½œç”¨çš„å…¶å®æ˜¯<code>kube-proxy</code>æœåŠ¡è¿›ç¨‹ï¼Œæ¯ä¸ª<code>Node</code>èŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œäº†ä¸€ä¸ª<code>kube-proxy</code>çš„æœåŠ¡è¿›ç¨‹ã€‚å½“åˆ›å»º<code>Service</code>çš„æ—¶å€™ä¼šé€šè¿‡<code>API Server</code>å‘<code>etcd</code>å†™å…¥åˆ›å»ºçš„Serviceçš„ä¿¡æ¯ï¼Œè€Œ<code>kube-proxy</code>ä¼šåŸºäºç›‘å¬çš„æœºåˆ¶å‘ç°è¿™ç§<code>Service</code>çš„å˜åŒ–ï¼Œç„¶åå®ƒä¼šå°†æœ€æ–°çš„<code>Service</code>ä¿¡æ¯è½¬æ¢ä¸ºå¯¹åº”çš„è®¿é—®è§„åˆ™</li>
<li>å‡å¦‚ï¼š<code>10.97.97.97:80</code>æ˜¯<code>service</code>æä¾›çš„è®¿é—®å…¥å£ï¼šå½“è®¿é—®è¿™ä¸ªå…¥å£çš„æ—¶å€™ï¼Œå¯ä»¥å‘ç°åé¢æœ‰ä¸‰ä¸ª<code>pod</code>çš„æœåŠ¡åœ¨ç­‰å¾…è°ƒç”¨ï¼Œ<code>kube-proxy</code>ä¼šåŸºäº<code>rr</code>ï¼ˆè½®è¯¢ï¼‰çš„ç­–ç•¥ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°å…¶ä¸­ä¸€ä¸ª<code>pod</code>ä¸Šå»ï¼Œè¿™ä¸ªè§„åˆ™ä¼šåŒæ—¶åœ¨é›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½ç”Ÿæˆï¼Œæ‰€ä»¥åœ¨ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè®¿é—®éƒ½å¯ä»¥</li>
<li><code>ClusterIP</code><!-- raw HTML omitted -->é»˜è®¤å€¼ï¼šå®ƒæ˜¯<code>kubernetes</code>ç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„è™šæ‹Ÿ<code>IP</code>(<code>VIP</code>)ï¼Œåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨ï¼ˆæ‰€æœ‰<code>Node</code>èŠ‚ç‚¹ï¼‰è®¿é—®<!-- raw HTML omitted --></li>
<li><code>NodePort</code><!-- raw HTML omitted -->ï¼šå°†<code>Service</code>é€šè¿‡æŒ‡å®šçš„<code>Node</code>ä¸Šçš„ç«¯å£æš´éœ²ç»™å¤–éƒ¨ï¼Œé€šè¿‡æ­¤æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼ˆä½¿ç”¨æµè§ˆå™¨åŸŸåæˆ–<code>IP</code>ç«¯å£è®¿é—®ï¼‰æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>åˆ›å»ºçš„<code>Service</code>çš„<code>IP</code>åœ°å€åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨æ‰å¯ä»¥è®¿é—®ï¼Œå¦‚æœå¸Œæœ›<code>Service</code>æš´éœ²ç»™é›†ç¾¤å¤–éƒ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨åˆ°å¦å¤–ä¸€ç§ç±»å‹çš„<code>Service</code>ï¼Œç§°ä¸º<code>NodePort</code>ç±»å‹çš„<code>Service</code>ã€‚<code>NodePort</code>çš„å·¥ä½œåŸç†å°±æ˜¯å°†<code>Service</code>çš„ç«¯å£æ˜ å°„åˆ°<code>Node</code>çš„ä¸€ä¸ªç«¯å£ä¸Šï¼Œç„¶åå°±å¯ä»¥é€šè¿‡<code>NodeIP:NodePort</code>æ¥è®¿é—®<code>Service</code>äº†</li>
</ul>
</blockquote>
<ul>
<li><code>LoadBalancer</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨å¤–æ¥è´Ÿè½½å‡è¡¡å™¨å®Œæˆåˆ°æœåŠ¡çš„è´Ÿè½½åˆ†å‘ï¼Œæ³¨æ„æ­¤æ¨¡å¼éœ€è¦å¤–éƒ¨äº‘ç¯å¢ƒçš„æ”¯æŒ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code> LoadBalancer</code>å’Œ<code>NodePort</code>å¾ˆç›¸ä¼¼ï¼Œç›®çš„éƒ½æ˜¯å‘å¤–éƒ¨æš´éœ²ä¸€ä¸ªç«¯å£ï¼ŒåŒºåˆ«åœ¨äº<code>LoadBalancer</code>ä¼šåœ¨é›†ç¾¤çš„å¤–éƒ¨å†æ¥åšä¸€ä¸ªè´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œè€Œè¿™ä¸ªè®¾å¤‡éœ€è¦å¤–éƒ¨ç¯å¢ƒçš„æ”¯æŒï¼Œå¤–éƒ¨æœåŠ¡å‘é€åˆ°è¿™ä¸ªè®¾å¤‡ä¸Šçš„è¯·æ±‚ï¼Œä¼šè¢«è®¾å¤‡è´Ÿè½½ä¹‹åè½¬å‘åˆ°é›†ç¾¤ä¸­</li>
</ul>
</blockquote>
<ul>
<li><code>ExternalName</code><!-- raw HTML omitted -->ï¼šæŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥é›†ç¾¤å†…éƒ¨ï¼Œç›´æ¥ä½¿ç”¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>ExternalName</code>ç±»å‹çš„<code>Service</code>ç”¨äºå¼•å…¥é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡ï¼Œå®ƒé€šè¿‡<code>externalName</code>å±æ€§æŒ‡å®šä¸€ä¸ªæœåŠ¡çš„åœ°å€ï¼Œç„¶ååœ¨é›†ç¾¤å†…éƒ¨è®¿é—®æ­¤<code>Service</code>å°±å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨çš„æœåŠ¡äº†</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain service.spec.type  	<span style="color:#75715e"># </span></span></span></code></pre></div></blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/Service/kubernetes-service-template.yaml" rel="external" target="_self"><code>Kubernetes Service Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1         </span> <span style="color:#75715e"># ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service  </span> <span style="color:#75715e"># ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">service-template       </span> <span style="color:#75715e"># Service åå­—</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># å‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx        </span> <span style="color:#75715e"># Service è‡ªå·±æœ¬èº«çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:     <span style="color:#75715e"># æ ‡ç­¾é€‰æ‹©å™¨ï¼Œç”¨äºç¡®å®šå½“å‰Serviceä»£ç†é‚£äº›Pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-deploymen      </span> <span style="color:#75715e"># æ‰€æœ‰åŒ¹é…åˆ°è¿™äº›æ ‡ç­¾çš„Pod éƒ½å¯ä»¥è¿›è¡Œè®¿é—®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort       </span> <span style="color:#75715e"># æŒ‡å®šServiceçš„ç±»å‹è®¿é—®æ–¹å¼ã€ClusterIPã€NodePortã€ExternalNameï¼ŒNodePortæ”¯æŒé›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œå¯ç”¨ingressè®¾ç½®ï¼šClusterIP</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">externalName</span>: <span style="color:#ae81ff">www.baidu.com  </span> <span style="color:#75715e"># æ”¹æˆIPåœ°å€ä¹Ÿå¯ä»¥,åªæœ‰typeç±»å‹ä¸ºï¼šExternalNameï¼ŒåŸŸåé…ç½®æ‰ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">clusterIP</span>: <span style="color:#ae81ff">10.64.0.47</span>        <span style="color:#75715e"># å®šservice IPï¼Œä¸æŒ‡å®šå°±éšæœºç”Ÿæˆï¼Œå¯ç”¨ingressè®¾ç½®ä¸ºï¼šNone</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sessionAffinity</span>: <span style="color:#ae81ff">None     </span> <span style="color:#75715e"># åˆ†å‘ç­–ç•¥ã€sessionäº²å’Œæ€§ï¼Œæ”¯æŒClientIPã€Noneä¸¤ä¸ªé€‰é¡¹ï¼Œé»˜è®¤å€¼ä¸ºNone</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:        <span style="color:#75715e"># ç«¯å£æ˜ å°„ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>          <span style="color:#75715e"># Service ç«¯å£ï¼Œåœ¨ä½¿ç”¨å†…ç½‘IPè®¿é—®æ—¶ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP      </span> <span style="color:#75715e"># åè®®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort </span>: <span style="color:#ae81ff">80</span>     <span style="color:#75715e"># ç›®æ ‡Podç«¯å£ï¼Œä¾‹å¦‚ï¼šdeploymentã€statefulsetç­‰ï¼ŒNginxï¼š80ï¼ŒTomcatï¼š8080</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodePort</span>: <span style="color:#ae81ff">30002</span>     <span style="color:#75715e"># ç»‘å®šåˆ°nodeä¸»æœºä¸Šçš„ç«¯å£(ç«¯å£ä½¿ç”¨èŒƒå›´ï¼š30000~32767)ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œä¼šé»˜è®¤åˆ†é…ï¼Œå¯ç”¨ingressåˆ é™¤æ­¤è¡Œ</span></span></span></code></pre></div><ul>
<li><code>kube-proxy</code>ç›®å‰æ”¯æŒçš„ä¸‰ç§å·¥ä½œæ¨¡å¼</li>
<li><code>userspace</code><!-- raw HTML omitted -->æ¨¡å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>userspace</code>æ¨¡å¼ä¸‹ï¼Œ<code>kube-proxy</code>ä¼šä¸ºæ¯ä¸€ä¸ª<code>Service</code>åˆ›å»ºä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œå‘å‘<code>Cluster IP</code>çš„è¯·æ±‚è¢«<code>iptables</code>è§„åˆ™é‡å®šå‘åˆ°<code>kube-proxy</code>ç›‘å¬çš„ç«¯å£ä¸Šï¼Œ<code>kube-proxy</code>æ ¹æ®<code>LB</code>ç®—æ³•ï¼ˆè´Ÿè½½å‡è¡¡ç®—æ³•ï¼‰é€‰æ‹©ä¸€ä¸ªæä¾›æœåŠ¡çš„<code>Pod</code>å¹¶å’Œå…¶å»ºç«‹è¿æ¥ï¼Œä»¥ä¾¿å°†è¯·æ±‚è½¬å‘åˆ°<code>Pod</code>ä¸Š</li>
<li><code>userspace</code>æ¨¡å¼ä¸‹ï¼Œ<code>kube-proxy</code>å……å½“äº†ä¸€ä¸ªå››å±‚è´Ÿè½½å‡è¡¡å™¨çš„è§’è‰²ã€‚ç”±äº<code>kube-proxy</code>è¿è¡Œåœ¨<code>userspace</code>ä¸­ï¼Œåœ¨è¿›è¡Œè½¬å‘å¤„ç†çš„æ—¶å€™ä¼šå¢åŠ å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´çš„æ•°æ®æ‹·è´ï¼Œè™½ç„¶æ¯”è¾ƒç¨³å®šï¼Œä½†æ˜¯æ•ˆç‡éå¸¸ä½ä¸‹</li>
</ul>
</blockquote>
<ul>
<li><code>iptables</code><!-- raw HTML omitted -->æ¨¡å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>iptables</code>æ¨¡å¼ä¸‹ï¼Œ<code>kube-proxy</code>ä¸º<code>Service</code>åç«¯çš„æ¯ä¸ª<code>Pod</code>åˆ›å»ºå¯¹åº”çš„<code>iptables</code>è§„åˆ™ï¼Œç›´æ¥å°†å‘å‘<code>Cluster IP</code>çš„è¯·æ±‚é‡å®šå‘åˆ°ä¸€ä¸ª<code>Pod</code>çš„<code>IP</code>ä¸Š</li>
<li><code>iptables</code>æ¨¡å¼ä¸‹<code>kube-proxy</code>ä¸æ‰¿æ‹…å››å±‚è´Ÿè½½å‡è¡¡å™¨çš„è§’è‰²ï¼Œåªè´Ÿè´£åˆ›å»º<code>iptables</code>è§„åˆ™ã€‚è¯¥æ¨¡å¼çš„ä¼˜ç‚¹åœ¨äºè¾ƒ<code>userspace</code>æ¨¡å¼æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯ä¸èƒ½æä¾›çµæ´»çš„<code>LB</code>ç­–ç•¥ï¼Œå½“åç«¯<code>Pod</code>ä¸å¯ç”¨çš„æ—¶å€™æ— æ³•è¿›è¡Œé‡è¯•</li>
</ul>
</blockquote>
<ul>
<li><code>ipvs</code><!-- raw HTML omitted -->æ¨¡å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>ipvs</code>æ¨¡å¼å’Œ<code>iptables</code>ç±»ä¼¼ï¼Œ<code>kube-proxy</code>ç›‘æ§<code>Pod</code>çš„å˜åŒ–å¹¶åˆ›å»ºç›¸åº”çš„<code>ipvs</code>è§„åˆ™ã€‚<code>ipvs</code>ç›¸å¯¹<code>iptables</code>è½¬å‘æ•ˆç‡æ›´é«˜ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œ<code>ipvs</code>æ”¯æŒæ›´å¤šçš„<code>LB</code>ç®—æ³•</p>
</li>
<li>
<p><code>ipvs</code><!-- raw HTML omitted -->çš„æ˜ å°„è§„åˆ™ï¼Œ<code>rr</code>è¡¨ç¤ºè½®è¯¢<!-- raw HTML omitted --></p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ipvsadm -Ln  	<span style="color:#75715e"># æŸ¥çœ‹kube-proxyå·¥ä½œæ¨¡å¼</span></span></span></code></pre></div></blockquote>
<ul>
<li>å¯¹<code>Service</code>çš„è®¿é—®è¢«åˆ†å‘åˆ°äº†åç«¯çš„<code>Pod</code>ä¸Šå»ï¼Œç›®å‰<code>kubernetes</code>æä¾›äº†<!-- raw HTML omitted -->ä¸¤ç§è´Ÿè½½åˆ†å‘<!-- raw HTML omitted -->ç­–ç•¥</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é»˜è®¤ä½¿ç”¨<code>kube-proxy</code>çš„ç­–ç•¥ï¼Œæ¯”å¦‚éšæœºã€è½®è¯¢ç­‰<!-- raw HTML omitted --></li>
<li><code>sessionAffinity</code>ï¼šåŸºäºå®¢æˆ·ç«¯åœ°å€çš„ä¼šè¯ä¿æŒæ¨¡å¼ï¼Œå³æ¥è‡ªåŒä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè½¬å‘åˆ°å›ºå®šçš„ä¸€ä¸ª<code>Pod</code>ä¸Šï¼Œè¿™å¯¹äºä¼ ç»ŸåŸºäº<code>Session</code>çš„è®¤è¯é¡¹ç›®æ¥è¯´å¾ˆå‹å¥½ï¼Œæ­¤æ¨¡å¼å¯ä»¥åœ¨<code>spec</code>ä¸­æ·»åŠ <code>sessionAffinity: ClusterIP</code>é€‰é¡¹</li>
</ul>
</blockquote>
<ul>
<li><code>HeadLiness</code>ç±»å‹è´Ÿè½½å‡çš„<code>Service</code></li>
</ul>
<blockquote>
<ul>
<li>åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œå¼€å‘äººå‘˜å¯èƒ½ä¸æƒ³ä½¿ç”¨<code>Service</code>æä¾›çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè€Œå¸Œæœ›è‡ªå·±æ¥æ§åˆ¶è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œ<code>kubernetes</code>æä¾›äº†<code>HeadLinesss Service</code>ï¼Œè¿™ç±»<code>Serviceä¸</code>ä¼šåˆ†é…<code>Cluster IP</code>ï¼Œå¦‚æœæƒ³è¦è®¿é—®<code>Service</code>ï¼Œåªèƒ½é€šè¿‡<code>Service</code>çš„åŸŸåè¿›è¡ŒæŸ¥è¯¢</li>
<li><code>clusterIP: None</code>ï¼šå°†<code>clusterIP</code>è®¾ç½®ä¸º<code>None</code>ï¼Œå³å¯åˆ›å»º<code>headliness Service</code></li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="endpointç±»å‹æ§åˆ¶å™¨"><code>Endpoint</code>ç±»å‹æ§åˆ¶å™¨</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®é™…ä¸­ä½¿ç”¨çš„ä¸å¤š<!-- raw HTML omitted --></li>
<li><code>Endpoint</code>ï¼šæ˜¯<code>kubernete</code>ä¸­çš„ä¸€ä¸ªèµ„æºå¯¹è±¡ï¼Œå­˜å‚¨åœ¨<code>etcd</code>ä¸­ï¼Œç”¨æ¥è®°å½•ä¸€ä¸ª<code>service</code>å¯¹åº”çš„æ‰€æœ‰<code>Pod</code>çš„è®¿é—®åœ°å€ï¼Œå®ƒæ˜¯æ ¹æ®<code>service</code>é…ç½®æ–‡ä»¶ä¸­çš„<code>selector</code>æè¿°äº§ç”Ÿçš„</li>
<li>ä¸€ä¸ª<code>service</code>ç”±ä¸€ç»„<code>Pod</code>ç»„æˆï¼Œè¿™äº›<code>Pod</code>é€šè¿‡<code>Endpoints</code>æš´éœ²å‡ºæ¥ï¼Œ<code>Endpoints</code>æ˜¯å®ç°å®é™…æœåŠ¡çš„ç«¯ç‚¹é›†åˆã€‚æ¢è¨€ä¹‹<code>servic</code>å’Œ<code>Pod</code>ä¹‹é—´çš„è”ç³»æ˜¯é€šè¿‡<code>Endpoints</code>å®ç°çš„</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl describe svc nginx-service -n app  
</span></span><span style="display:flex;"><span>$ kubectl get endpoints -n dev -o wide  </span></span></code></pre></div><ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/EndPoint/kubernetes-endpoint-template.yaml" rel="external" target="_self"><code>Kubernetes Endpoint Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Endpoints</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">endpoints-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx        </span> <span style="color:#75715e"># æ ‡ç­¾å’ŒService é‡Œçš„labelsä¸€è‡´</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subsets</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">addresses</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">ip</span>: <span style="color:#ae81ff">23.41.187.94</span>    <span style="color:#75715e"># ç›®æ ‡IPåœ°å€</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:        <span style="color:#75715e"># ä¸ Serviceä¸€è‡´</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1         </span> <span style="color:#75715e"># ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service  </span> <span style="color:#75715e"># ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">service-template       </span> <span style="color:#75715e"># Service åå­—</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># å‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx        </span> <span style="color:#75715e"># Service è‡ªå·±æœ¬èº«çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP       </span> <span style="color:#75715e"># æŒ‡å®šServiceçš„ç±»å‹è®¿é—®æ–¹å¼ã€ClusterIPã€NodePortã€ExternalName</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sessionAffinity</span>: <span style="color:#ae81ff">None        </span> <span style="color:#75715e"># åˆ†å‘ç­–ç•¥ã€sessionäº²å’Œæ€§ï¼Œæ”¯æŒClientIPã€Noneä¸¤ä¸ªé€‰é¡¹ï¼Œé»˜è®¤å€¼ä¸ºNone</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:        <span style="color:#75715e"># ç«¯å£æ˜ å°„ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>          <span style="color:#75715e"># Service ç«¯å£ï¼Œåœ¨ä½¿ç”¨å†…ç½‘IPè®¿é—®æ—¶ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP      </span> <span style="color:#75715e"># åè®®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort </span>: <span style="color:#ae81ff">80</span>     <span style="color:#75715e"># ç›®æ ‡Podç«¯å£ï¼Œä¾‹å¦‚ï¼šdeploymentã€statefulsetç­‰</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="jobç±»å‹æ§åˆ¶å™¨"><code>Job</code>ç±»å‹æ§åˆ¶å™¨</h3>
<blockquote>
<ul>
<li><code>Job</code><!-- raw HTML omitted -->ä¸»è¦ç”¨äºè´Ÿè´£æ‰¹é‡å¤„ç†çŸ­æš‚çš„ä¸€æ¬¡æ€§ä»»åŠ¡<!-- raw HTML omitted --></li>
<li><code>Job</code><!-- raw HTML omitted -->ç‰¹ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å½“<code>Job</code>åˆ›å»ºçš„<code>Pod</code>æ‰§è¡ŒæˆåŠŸç»“æŸæ—¶ï¼Œ<code>Job</code>å°†è®°å½•æˆåŠŸç»“æŸçš„<code>Pod</code>æ•°é‡</li>
<li>å½“æˆåŠŸç»“æŸçš„<code>Pod</code>è¾¾åˆ°æŒ‡å®šçš„æ•°é‡æ—¶ï¼Œ<code>Job</code>å°†å®Œæˆæ‰§è¡Œ</li>
</ul>
</blockquote>
<ul>
<li><code>Job</code><!-- raw HTML omitted -->æ¨¡æ¿ä½¿ç”¨é‡å¯ç­–ç•¥å®šä¹‰<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®ä¸ºï¼š<!-- raw HTML omitted --><code>OnFailure</code>ï¼Œ<code> Job</code>ä¼šåœ¨<code>Pod</code>å‡ºç°æ•…éšœçš„æ—¶å€™é‡å¯å®¹å™¨ï¼Œè€Œä¸æ˜¯åˆ›å»º<code>Pod</code>ï¼Œ<code>failed</code>æ¬¡æ•°ä¸å˜</li>
<li><!-- raw HTML omitted -->è®¾ç½®ä¸ºï¼š<!-- raw HTML omitted --><code>Never</code>ï¼Œ<code>Job</code>ä¼šåœ¨<code>Pod</code>å‡ºç°æ•…éšœçš„æ—¶å€™åˆ›å»ºæ–°çš„<code>Pod</code>ï¼Œå¹¶ä¸”æ•…éšœ<code>Pod</code>ä¸ä¼šæ¶ˆå¤±ä¹Ÿä¸ä¼šé‡å¯ï¼Œ<code>failed</code>æ¬¡æ•°+1</li>
<li><!-- raw HTML omitted -->è®¾ç½®ä¸ºï¼š<!-- raw HTML omitted --><code>Always</code>ï¼Œæ„å‘³<code>Job</code>ä¸€ç›´é‡å¯ï¼Œæ„å‘³<code>Pod</code>ä»»åŠ¡ä¼šé‡å¤æ‰§è¡Œï¼Œè¿™å’Œ<code>Job</code>çš„å®šä¹‰å†²çªï¼Œæ‰€ä»¥ä¸èƒ½è®¾ç½®ä¸º<code>Always</code></li>
</ul>
</blockquote>
<ul>
<li><code>Job</code><!-- raw HTML omitted -->èµ„æºæ¸…å•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">batch/v1  	# ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Job  	# ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:  	<span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">job-template  	# åç§°</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">namespace</span>:  <span style="color:#ae81ff">default  	# å‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">labels</span>:  	<span style="color:#75715e"># æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">controller</span>: <span style="color:#ae81ff">job</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:  	<span style="color:#75715e"># è¯¦æƒ…æè¿°</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">completions</span>: <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æŒ‡å®šJobéœ€è¦æˆåŠŸè¿è¡ŒPodçš„æ€»æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">parallelism</span>: <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æŒ‡å®šJobåœ¨ä»»ä¸€æ—¶åˆ»åº”è¯¥å¹¶å‘è¿è¡ŒPodçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">activeDeadlineSeconds</span>: <span style="color:#ae81ff">30</span>  	<span style="color:#75715e"># æŒ‡å®šJobå¯ä»¥è¿è¡Œçš„æ—¶é—´æœŸé™ï¼Œè¶…è¿‡æ—¶é—´è¿˜æ²¡ç»“æŸï¼Œç³»ç»Ÿå°†ä¼šå°è¯•è¿›è¡Œç»ˆæ­¢</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">backoffLimit</span>: <span style="color:#ae81ff">6</span>  	<span style="color:#75715e"># æŒ‡å®šJobå¤±è´¥åè¿›è¡Œé‡è¯•çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º6</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">manualSelector</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># æ˜¯å¦å¯ä»¥ä½¿ç”¨selectoré€‰æ‹©å™¨é€‰æ‹©Podï¼Œé»˜è®¤ä¸ºfalse</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">selector</span>:  	<span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†é‚£äº›Pod</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:  	<span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: <span style="color:#ae81ff">counter-pod</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchExpressions</span>:  	<span style="color:#75715e"># ExpressionsåŒ¹é…è§„åˆ™</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">app</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#ae81ff">counter-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">template</span>:  	<span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºPodæ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: <span style="color:#ae81ff">counter-pod</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Never  	# é‡å¯ç­–ç•¥åªèƒ½è®¾ç½®ä¸ºNeveræˆ–OnFailure</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">counter</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;for i in 9 8 7 6 5 4 3 2 1;do echo $i;sleep 20;done&#34;</span>]</span></span></code></pre></div></blockquote>
<hr>
<h3 id="cronjobç±»å‹æ§åˆ¶å™¨"><code>CronJob</code>ç±»å‹æ§åˆ¶å™¨</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><code>CronJob</code>æ§åˆ¶å™¨<!-- raw HTML omitted -->ï¼šä»¥<code>Job</code>æ§åˆ¶å™¨ä¸ºå…¶ç®¡æ§å¯¹è±¡ï¼Œå¹¶å€ŸåŠ©å®ƒç®¡ç†<code>Pod</code>èµ„æºå¯¹è±¡ï¼Œ<code>Job</code>æ§åˆ¶å™¨å®šä¹‰çš„ä½œä¸šä»»åŠ¡åœ¨å…¶æ§åˆ¶å™¨èµ„æºåˆ›å»ºä¹‹åä¾¿ä¼šç«‹å³æ‰§è¡Œï¼Œä½†<code>CronJob</code>å¯ä»¥ä»¥ç±»ä¼¼<code>Linux</code>æ“ä½œç³»ç»Ÿçš„å‘¨æœŸæ€§ä»»åŠ¡ä½œä¸šè®¡åˆ’çš„æ–¹å¼æ§åˆ¶å™¨è¿è¡Œæ—¶é—´ç‚¹åŠé‡å¤è¿è¡Œçš„æ–¹å¼ï¼Œæ¢è¨€ä¹‹ï¼Œ<code>CronJob</code>å¯ä»¥åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹åå¤å»æ‰§è¡Œ<code>Job</code>ä»»åŠ¡</li>
<li><code>scheduleï¼šcron</code><!-- raw HTML omitted -->è¡¨è¾¾å¼ï¼Œç”¨äºæŒ‡å®šä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>/1  *</code><!-- raw HTML omitted -->ï¼šè¡¨ç¤ºåˆ†é’Ÿ  å°æ—¶  æ—¥  æœˆä»½  æ˜ŸæœŸ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->åˆ†é’Ÿå€¼ä»<code>0</code>åˆ°<!-- raw HTML omitted --><code>59</code></li>
<li><!-- raw HTML omitted -->å°æ—¶å€¼ä»<code>0</code>åˆ°<!-- raw HTML omitted --><code>23</code></li>
<li><!-- raw HTML omitted -->æ—¥(å¤©)çš„å€¼ä»<code>1</code>åˆ°<!-- raw HTML omitted --><code>31</code></li>
<li><!-- raw HTML omitted -->æœˆçš„å€¼ä»<code>1</code>åˆ°<!-- raw HTML omitted --><code>12</code></li>
<li><!-- raw HTML omitted -->æ˜ŸæœŸçš„å€¼ä»<code>0</code>åˆ°<code>6</code>ï¼Œ<!-- raw HTML omitted --><code>0</code><!-- raw HTML omitted -->è¡¨ç¤ºæ˜ŸæœŸæ—¥<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¤šä¸ªæ—¶é—´å¯ä»¥ç”¨é€—å·éš”å¼€ï¼ŒèŒƒå›´å¯ä»¥ç”¨è¿å­—ç¬¦ç»™å‡ºï¼š* å¯ä»¥ä½œä¸ºé€šé…ç¬¦ï¼Œ/è¡¨ç¤ºæ¯&hellip;<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><code>concurrencyPolicy</code><!-- raw HTML omitted -->å¹¶å‘æ‰§è¡Œç­–ç•¥<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Allow</code><!-- raw HTML omitted -->ï¼šè¿è¡Œ<code>Job</code>å¹¶å‘è°ƒåº¦ï¼ˆé»˜è®¤ï¼‰<!-- raw HTML omitted --></li>
<li><code>Forbid</code><!-- raw HTML omitted -->ï¼šç¦æ­¢å¹¶å‘è¿è¡Œï¼Œå¦‚æœä¹‹å‰çš„ä»»åŠ¡æ²¡å®Œæˆï¼Œåˆ™è·³è¿‡ï¼Œç›´æ¥æ‰§è¡Œæ–°çš„<!-- raw HTML omitted --></li>
<li><code>Replace</code><!-- raw HTML omitted -->ï¼šæ›¿æ¢ï¼Œå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„ä½œä¸šå¹¶ä½¿ç”¨æ–°ä½œä¸šæ›¿æ¢å®ƒ<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/kubernetes-cronjob-template.yaml" rel="external" target="_self"><code>Kubernetes CronJob Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">batch/v1   </span> <span style="color:#75715e"># ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">CronJob  </span> <span style="color:#75715e"># ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:       <span style="color:#75715e"># å…ƒæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cronjob-template       </span> <span style="color:#75715e"># åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default   </span> <span style="color:#75715e"># å‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">controller</span>: <span style="color:#ae81ff">cronjob</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># è¯¦æƒ…æè¿°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">concurrencyPolicy</span>: <span style="color:#ae81ff">Allow   </span> <span style="color:#75715e"># å¹¶å‘æ‰§è¡Œç­–ç•¥ï¼ŒAllowï¼šå¹¶å‘è°ƒåº¦ï¼Œ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">failedJobsHistoryLimit</span>: <span style="color:#ae81ff">1</span>   <span style="color:#75715e"># ä¿ç•™å¤šå°‘ä¸ªå¤±è´¥çš„ä»»åŠ¡ï¼Œé»˜è®¤ä¸º1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">successfulJobsHistoryLimit</span>: <span style="color:#ae81ff">3</span>   <span style="color:#75715e"># ä¿ç•™å¤šå°‘ä¸ªæˆåŠŸçš„ä»»åŠ¡ï¼Œé»˜è®¤ä¸º3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># startingDeadlineSeconds: 30   # é—´éš”å¤šé•¿æ—¶é—´æ£€æµ‹å¤±è´¥çš„ä»»åŠ¡å¹¶é‡æ–°æ‰§è¡Œï¼Œæ—¶é—´ä¸èƒ½å°äºï¼š10</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">suspend</span>: <span style="color:#66d9ef">false</span>    <span style="color:#75715e"># æ˜¯å¦æŒ‚èµ·ä»»åŠ¡ï¼Œè‹¥ä¸ºï¼štrue åˆ™è¯¥ä»»åŠ¡ä¸æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schedule</span>: <span style="color:#e6db74">&#34;*/1 * * * * &#34;</span>    <span style="color:#75715e"># cronæ ¼å¼çš„ä½œä¸šè°ƒåº¦è¿è¡Œæ—¶é—´ç‚¹ï¼Œç”¨äºæ§åˆ¶ä»»åŠ¡ä»»åŠ¡æ—¶é—´æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">jobTemplate</span>:          <span style="color:#75715e"># jobæ§åˆ¶å™¨æ¨¡æ¿ï¼Œç”¨äºä¸ºcronjobæ§åˆ¶å™¨ç”Ÿæˆjobå¯¹è±¡ï¼Œä¸‹é¢å…¶å®å°±æ˜¯jobçš„å®šä¹‰</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">completions</span>: <span style="color:#ae81ff">1</span>    <span style="color:#75715e"># æŒ‡å®šJobéœ€è¦æˆåŠŸè¿è¡ŒPodçš„æ€»æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">parallelism</span>: <span style="color:#ae81ff">1</span>    <span style="color:#75715e"># æŒ‡å®šJobåœ¨ä»»ä¸€æ—¶åˆ»åº”è¯¥å¹¶å‘è¿è¡ŒPodçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">activeDeadlineSeconds</span>: <span style="color:#ae81ff">30</span>         <span style="color:#75715e"># æŒ‡å®šJobå¯ä»¥è¿è¡Œçš„æ—¶é—´æœŸé™ï¼Œè¶…è¿‡æ—¶é—´è¿˜æ²¡ç»“æŸï¼Œç³»ç»Ÿå°†ä¼šå°è¯•è¿›è¡Œç»ˆæ­¢</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">backoffLimit</span>: <span style="color:#ae81ff">6</span>   <span style="color:#75715e"># æŒ‡å®šJobå¤±è´¥åè¿›è¡Œé‡è¯•çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º6</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">template</span>:         <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºPodæ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Never         </span> <span style="color:#75715e"># é‡å¯ç­–ç•¥åªèƒ½è®¾ç½®ä¸ºNeveræˆ–OnFailure</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">container-name</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">command</span>: [ <span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;for i in 9 8 7 6 5 4 3 2 1;do echo $i;sleep 20;done&#34;</span> ]</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ¨¡æ¿è¯¦ç»†æè¿°">æ¨¡æ¿è¯¦ç»†æè¿°</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/bitnami/" rel="external" target="_self"><code>Bitnami</code>æ¨¡æ¿åº“</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/bitnami/charts/tree/main/bitnami" rel="external" target="_self"><code>Kubernetes</code>çš„<code>Bitnami</code>åº“</a></td>
<td><code>Helm</code>å®‰è£…<code>Kubernetes</code>æœåŠ¡<code>Zabbix</code>ã€<code>Redis</code>ã€<code>Mysql</code>æ¨¡æ¿</td>
</tr>
<tr>
<td><a href="https://github.com/bitnami/charts-docs/tree/main/charts" rel="external" target="_self"><code>Kubernetes</code>çš„<code>Charts-docs</code>åº“</a></td>
<td><code>Helm</code>å®‰è£…<code>Kubernetes</code>æœåŠ¡<code>Zabbix</code>ã€<code>Redis</code>ã€<code>Mysql</code>æ¨¡æ¿</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/kubernetes-template.yaml" rel="external" target="_self"><code>Kubernetes Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1   </span> <span style="color:#75715e"># ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment   </span> <span style="color:#75715e"># èµ„æºç±»å‹ï¼Œä¾‹å¦‚ Podã€Deploymentã€Serviceã€ReplicaSetã€StatefulSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:   <span style="color:#75715e"># POdç›¸å…³çš„å…ƒæ•°æ®ï¼Œç”¨äºæè¿°Podæ•°æ®</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">java-demo  </span> <span style="color:#75715e"># Podåç§°ã€åœ¨åŒä¸€ä¸ªåç§°ç©ºé—´å†…ä¸èƒ½é‡å¤</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">string  </span> <span style="color:#75715e"># Podæ‰€å±çš„å‘½åç©ºé—´,é»˜è®¤ä¸º&#34;default&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:   <span style="color:#75715e"># å®šä¹‰Podçš„æ ‡ç­¾ï¼Œåªèƒ½ä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹ï¼šstring</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">java-demo  </span> <span style="color:#75715e"># è‡ªå®šä¹‰labelæ ‡ç­¾ï¼Œkey(é”®)ä¸ºï¼šnameï¼Œvalue(å€¼)ä¸ºï¼šjava-demo</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">version</span>: <span style="color:#ae81ff">v1.1.0  </span> <span style="color:#75715e"># è‡ªå®šä¹‰ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:    <span style="color:#75715e"># æ³¨é‡Šï¼Œä¸èƒ½ä½œä¸ºè¢«ç­›é€‰</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">java-demo</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># Podä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>   <span style="color:#75715e"># åˆ›å»ºçš„å‰¯æœ¬æ•°é‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">10</span>    <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°åä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:   <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œç”¨äºæ‰¾åˆ°åŒ¹é…çš„ ReplicaSet(å‰¯æœ¬)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:    <span style="color:#75715e"># æŒ‰ç…§Labelsæ ‡ç­¾åŒ¹é…å‰¯æœ¬</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">java-demo  </span> <span style="color:#75715e"># åŒ¹é…çš„keyï¼Œvalue</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">version</span>: <span style="color:#ae81ff">v1.1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:   <span style="color:#75715e"># æ›´æ–°ç­–ç•¥ï¼ŒStatefulSetæ›´æ–°ä½¿ç”¨ï¼šupdateStrategy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:    <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°é…ç½®</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">partition</span>: <span style="color:#ae81ff">3</span>    <span style="color:#75715e"># å®ç°ç°åº¦/é‡‘ä¸é›€å‘å¸ƒï¼ŒæŒ‰åºå·æ›´æ–°ï¼Œæ›´æ–°å¤§äºç­‰äº3çš„åºå·ï¼Œä¸å’Œç™¾åˆ†æ¯”å…±ç”¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%  </span> <span style="color:#75715e"># å¤šå°‘ä¸ª/ç™¾åˆ†ä¹‹å¤šå°‘Podså¤„äºæ›´æ–°ï¼Œæ•°å€¼è¶Šå¤§æ›´æ–°è¶Šå¿«ï¼Œä¸ç¨³å®š</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%  </span> <span style="color:#75715e"># å¤šå°‘ä¸ª/ç™¾åˆ†ä¹‹å¤šå°‘Podså¤„äºå…³é—­ï¼Œæ•°å€¼è¶Šå°æ›´æ–°æ…¢ï¼Œç¨³å®š</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate  </span> <span style="color:#75715e"># æ›´æ–°ç±»å‹é€‰æ‹©å™¨ï¼Œé‡‡ç”¨æ»šåŠ¨æ›´æ–°ï¼ŒOnDeleteï¼šæ–¹å¼æ›´æ–°ï¼Œåˆ é™¤podsæ—¶æ›´æ–°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:   <span style="color:#75715e"># Pod æ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:   <span style="color:#75715e"># Pod çš„å…ƒä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:   <span style="color:#75715e"># Pod çš„æ ‡ç­¾ </span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">java-demo</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">version</span>: <span style="color:#ae81ff">v1.1.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:   <span style="color:#75715e"># Podçš„æœŸæœ›ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nodeName</span>: <span style="color:#ae81ff">k8s-node1  </span> <span style="color:#75715e"># è®¾ç½®NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nodeSelector</span>: <span style="color:#ae81ff">obeject  </span> <span style="color:#75715e"># è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Š</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">hostNetwork</span>: <span style="color:#66d9ef">false</span>    <span style="color:#75715e"># æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">tolerations</span>:  	<span style="color:#75715e"># å®¹å¿é…ç½®</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">effect</span>: <span style="color:#e6db74">&#34;æ±¡ç‚¹çš„ç±»å‹&#34;</span>  <span style="color:#75715e"># Noschedule</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;æ±¡ç‚¹çš„Key&#34;</span>  	<span style="color:#75715e"># æ±¡ç‚¹çš„Key</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">operate</span>: <span style="color:#e6db74">&#34;Equal&#34;</span>  	<span style="color:#75715e"># Existsï¼šåŒ¹é…Keyï¼ŒEqualæ·»åŠ ï¼švalueé…ç½®ï¼Œ</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;æ±¡ç‚¹çš„value&#34;</span>  	<span style="color:#75715e"># æ±¡ç‚¹çš„value</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">imagePullSecrets</span>:   <span style="color:#75715e"># é…ç½®ç™»å½• docker registry çš„ secret ä»“åº“</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker-harbor  </span> <span style="color:#75715e"># æŒ‡å®šä½¿ç”¨çš„secretåº“æˆ¿åç§°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:   <span style="color:#75715e"># å¯¹äº Podä¸­å®¹å™¨æè¿°</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">tomcat-demo  </span> <span style="color:#75715e"># æŒ‡å®šå®¹å™¨åç§°ï¼Œä¸å¯æ›´æ–°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">192.168.80.210</span>:<span style="color:#ae81ff">8080</span><span style="color:#ae81ff">/test/tomcat-demo:v1   </span> <span style="color:#75715e"># é•œåƒä»“åº“åœ°å€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: [ <span style="color:#ae81ff">Always | Never | IfNotPresent ]   </span> <span style="color:#75715e"># é•œåƒæ‹‰å–æ–¹å¼</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">securityContext</span>: 
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">privileged</span>: <span style="color:#66d9ef">true</span>  <span style="color:#75715e"># å¯ç”¨ç‰¹æƒæ¨¡å¼ï¼Œå…è®¸å®¹å™¨è®¿é—®ä¸»æœºèµ„æº</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">runAsUser</span>: <span style="color:#ae81ff">0</span>       <span style="color:#75715e"># ä»¥ root ç”¨æˆ·è¿è¡Œå®¹å™¨ï¼ˆ0 æ˜¯ root ç”¨æˆ·çš„ UIDï¼‰</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">allowPrivilegeEscalation</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">readOnlyRootFilesystem</span>: <span style="color:#66d9ef">false</span> 	<span style="color:#75715e"># å…è®¸å®¹å™¨å…·æœ‰è¯»å†™æ–‡ä»¶ç³»ç»Ÿæƒé™</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">capabilities</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">add</span>: 
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">SYS_ADMIN </span> <span style="color:#75715e"># æ·»åŠ ç‰¹å®šçš„ Linux èƒ½åŠ›</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">securityContext</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">runAsNonRoot</span>: <span style="color:#66d9ef">false</span>  <span style="color:#75715e"># å…è®¸å®¹å™¨ä»¥ root ç”¨æˆ·è¿è¡Œ</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#ae81ff">string]  </span> <span style="color:#75715e"># ä»¥æ•°ç»„æ–¹å¼æŒ‡å®šå®¹å™¨å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">args</span>:   <span style="color:#75715e"># ä»¥æ•°ç»„æ–¹å¼æŒ‡å®šå®¹å™¨å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨ï¼Œæ›¿ä»£dockerçš„CMDæŒ‡ä»¤</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">/bin/sh</span>
</span></span><span style="display:flex;"><span>        - -<span style="color:#ae81ff">c</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">touch /tmp/healthy; sleep 30; rm -fr /tmp/healthy; sleep 600   </span> <span style="color:#75715e"># ä¸èƒ½è¶…è¿‡æ¢é’ˆæ‰§è¡Œæ—¶é—´</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">workingDir</span>: <span style="color:#ae81ff">string   </span> <span style="color:#75715e"># å®¹å™¨å¯åŠ¨åè¿›å…¥çš„å·¥ä½œç›®å½•ï¼Œä¸æŒ‡å®šåˆ™ä½¿ç”¨é•œåƒé»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:   <span style="color:#75715e"># æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">data   </span> <span style="color:#75715e"># å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/opt/data   </span> <span style="color:#75715e"># å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">readOnly</span>: <span style="color:#ae81ff">boolean  </span> <span style="color:#75715e"># æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:    <span style="color:#75715e"># éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">http   </span> <span style="color:#75715e"># ä¸ºç«¯å£å–åï¼Œè¯¥åç§°å¯ä»¥åœ¨serviceç§è¢«å¼•ç”¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">int   </span> <span style="color:#75715e"># å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">hostPort</span>: <span style="color:#ae81ff">int  </span> <span style="color:#75715e"># å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP  </span> <span style="color:#75715e"># ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>    <span style="color:#75715e"># Pod æœ¬èº«æœåŠ¡ç«¯å£ï¼Œæ¯”å¦‚Nginxï¼š80ï¼ŒTomcatï¼š8080</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">nodePort</span>: <span style="color:#ae81ff">30001</span>   <span style="color:#75715e"># èŠ‚ç‚¹å¯¹å¤–ç«¯å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:    <span style="color:#75715e"># å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">JAVA_OPTS  </span> <span style="color:#75715e"># ç¯å¢ƒå˜é‡åç§°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;-Xmx1g&#34;</span>   <span style="color:#75715e"># ç¯å¢ƒå˜é‡çš„å€¼</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:    <span style="color:#75715e"># èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:   <span style="color:#75715e"># é™å®šPodæœ€å¤§ä½¿ç”¨ç¡¬ä»¶èµ„æºã€é€šå¸¸è®¾ç½®cpuå’Œmemory</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;1&#34;</span>    <span style="color:#75715e"># Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°ï¼Œ1000mç­‰äºä¸€ä¸ªæ ¸å¿ƒ</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;1Gi&#34;</span>   <span style="color:#75715e"># å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:   <span style="color:#75715e"># æœ€ä½èµ„æºè¦æ±‚ï¼Œåœ¨schedulerä¸­è¢«ç”¨åˆ°ï¼Œé€šå¸¸è®¾ç½®cpuå’Œmemory</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#e6db74">&#34;0.5&#34;</span>    <span style="color:#75715e"># é™å®šä½¿ç”¨å‡ ä¸ªæ ¸å¿ƒCPUã€å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#e6db74">&#34;256Mi&#34;</span>   <span style="color:#75715e"># è®¾å®šä½¿ç”¨å†…å­˜ã€å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">lifecycle</span>:    <span style="color:#75715e"># ç”Ÿå‘½å‘¨æœŸé’©å­</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">postStart</span>:    <span style="color:#75715e"># å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">exec</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;echo Hello from the postStart handler &gt;/usr/share/message&#34;</span>]
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">preStop</span>:    <span style="color:#75715e"># å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">exec</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;nginx -s quit; while killall -0 nginx; do sleep 1; done&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">startupProbe</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">tcpSocket</span>:    <span style="color:#75715e"># ä½¿ç”¨TcpSocketã€httpGetå¥åº·æ£€æŸ¥</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8010</span>    <span style="color:#75715e"># æ¢æµ‹8010ç«¯å£</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>   <span style="color:#75715e"># æ£€æµ‹å¤±è´¥5æ¬¡è¡¨ç¤ºæœªå°±ç»ª</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">60</span>   <span style="color:#75715e"># æŒ‡å®šå®¹å™¨å¯åŠ¨60sä¹‹åå¼€å§‹æ‰§è¡ŒLivenessæ¢æµ‹ï¼Œ</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>   <span style="color:#75715e"># æŒ‡å®šæ¯10ç§’æ‰§è¡Œä¸€æ¬¡Livenessæ¢æµ‹ã€‚</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>   <span style="color:#75715e"># æ£€æŸ¥æˆåŠŸä¸º2æ¬¡è¡¨ç¤ºå°±ç»ª</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>   <span style="color:#75715e"># æ£€æµ‹å¤±è´¥1æ¬¡è¡¨ç¤ºæœªå°±ç»ª</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">livenessProbe</span>:    <span style="color:#75715e"># å¯¹Podå†…å„å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">exec</span>:   <span style="color:#75715e"># å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">command</span>:    <span style="color:#75715e"># execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">sh</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">c</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#e6db74">&#34;sleep 5; echo &#39;success&#39;;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">httpGet</span>:    <span style="color:#75715e"># å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/  </span> <span style="color:#75715e"># URIåœ°å€ï¼šhttp://:80/index.html</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8010</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">host</span>: <span style="color:#ae81ff">192.168.109.100</span>   <span style="color:#75715e"># ä¸»æœºåœ°å€</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">scheme</span>: <span style="color:#ae81ff">HTTP   </span> <span style="color:#75715e"># æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">HttpHeaders</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">value</span>: <span style="color:#ae81ff">string(å­—ç¬¦ä¸²)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">tcpSocket</span>:    <span style="color:#75715e"># å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8010</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">60</span>   <span style="color:#75715e"># å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>   <span style="color:#75715e"># å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>   <span style="color:#75715e"># å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>   <span style="color:#75715e"># é…ç½®ä¸ºï¼š1ï¼Œè¡¨ç¤ºæ£€æŸ¥ä¸€æ¬¡æˆåŠŸå°±æˆåŠŸï¼Œé…ç½®ä¸ºï¼š3ï¼Œè¡¨ç¤ºæ£€æŸ¥3æ¬¡</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>   <span style="color:#75715e"># å¤±è´¥æ¬¡æ•°ï¼Œæ£€æŸ¥5æ¬¡å¤±è´¥è¡¨ç¤ºå¤±è´¥</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">securityContext</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">privileged</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: [<span style="color:#ae81ff">Always | Never | OnFailure]  </span> <span style="color:#75715e"># Podçš„é‡å¯ç­–ç•¥</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>   <span style="color:#75715e"># åˆ é™¤podsã€deploymentåç­‰å¾…æ—¶é—´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:    <span style="color:#75715e"># åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume  </span> <span style="color:#75715e"># å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">emptyDir</span>: {}    <span style="color:#75715e"># ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hostPath</span>:   <span style="color:#75715e"># ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/root/logs   </span> <span style="color:#75715e"># Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate  </span> <span style="color:#75715e"># ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºå†ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">secret</span>:   <span style="color:#75715e"># ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">scretname</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMap</span>:    <span style="color:#75715e"># ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="ç¼–å†™é€‚ç”¨javaçš„yaml">ç¼–å†™é€‚ç”¨<code>Java</code>çš„<code>yaml</code></h4>
<ul>
<li>
<ol>
<li>ä¸‹è½½<code>java demo</code>ä»£ç </li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/frankinbj/tomcat-java-demo.git     </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¿®æ”¹è¿æ¥æ•°æ®åº“é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;tomcat-java-demo/src/main/resources/application.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">datasource:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    url: jdbc:mysql://192.168.80.215:3306/test?characterEncoding=utf-8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    username: admin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    password: admin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li>æ‰“åŒ…<code>java war</code>åŒ…</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/tomcat-java-demo/
</span></span><span style="display:flex;"><span>$ mvn clean package -Dmaven.test.skip<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”ŸæˆwaråŒ…</span>
</span></span><span style="display:flex;"><span>$ ll /opt/tomcat-java-demo/target/ly-simple-tomcat-0.0.1-SNAPSHOT.war</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æŠŠæ•°æ®å¯¼å…¥æ•°æ®åº“ï¼Œåˆ›å»ºæˆæƒè¿æ¥ç”¨æˆ·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysql -uroot -p &lt; tomcat-java-demo/doc/db/tables_ly_tomcat.sql
</span></span><span style="display:flex;"><span>$ grant all privileges on *.* to admin@<span style="color:#e6db74">&#39;%&#39;</span> identified by <span style="color:#e6db74">&#39;admin&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>JDK</code>ã€<code>Maven</code><!-- raw HTML omitted -->é…ç½®ç¯å¢ƒå˜é‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;#####  	JDK ç’°å¢ƒè®Šæ•¸  	#####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JAVA_HOME=/usr/local/jdk
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JRE_HOME=</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/jre
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export CLASSPATH=</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/lib:</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/lib/tools.jar
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=</span><span style="color:#e6db74">${</span>PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/bin:</span><span style="color:#e6db74">${</span>JAVA_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">/jre/bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=</span><span style="color:#e6db74">${</span>PATH<span style="color:#e6db74">}</span><span style="color:#e6db74">:/usr/local/maven/bin &#34;</span>&gt;&gt;/etc/profile</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li>ä¿®æ”¹<code>Dockerfile</code>é…ç½®æ–‡ä»¶ï¼Œ<code>docker build</code>æˆé•œåƒ</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>6.1 ä½¿ç”¨<code>Tomcat</code>æœåŠ¡æ‰“åŒ…å¯åŠ¨å®¹å™¨</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/tomcat-java-demo/Dockerfile<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">FROM lizhenliang/tomcat
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RUN rm -rf /usr/local/tomcat/webapps/*
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ADD target/*.war /usr/local/tomcat/webapps/ROOT.war
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å£°æ˜æ—¶åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo &#39;Asia/Shanghai&#39; &gt;/etc/timezone
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>6.2 ä½¿ç”¨<code>java -jar</code><!-- raw HTML omitted -->æ‰“åŒ…é•œåƒï¼Œå¯ä»¥ä½¿ç”¨<!-- raw HTML omitted --><code>xxl-job</code>çš„<code>jar</code>åŒ…</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> openjdk</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">VOLUME</span><span style="color:#e6db74"> /tmp</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> ./target/live-server-1.0.0-SNAPSHOT.jar live-server-1.0.0-SNAPSHOT.jar<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> bash -c <span style="color:#e6db74">&#34;touch /live-server-1.0.0-SNAPSHOT.jar&#34;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># å£°æ˜æ—¶åŒº</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#39;Asia/Shanghai&#39;</span> &gt;/etc/timezone<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># å£°æ˜è¿è¡Œæ—¶å®¹å™¨æä¾›æœåŠ¡ç«¯å£ï¼Œè¿è¡Œæ—¶ä¸ä¼šå¼€å¯è¿™ä¸ªç«¯å£çš„æœåŠ¡ï¼Œéœ€è¦æŠŠç«¯å£æ˜ å°„</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 8080</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;java&#34;</span>,<span style="color:#e6db74">&#34;-jar&#34;</span>,<span style="color:#e6db74">&#34;/live-server-1.0.0-SNAPSHOT.jar&#34;</span>]</span></span></code></pre></div><ul>
<li>6.3 ç”Ÿæˆ<code>docker imagesï¼š</code>é•œåƒå¹¶æ¨é€åˆ°ç§äººä»“åº“</li>
</ul>
<blockquote>
<ul>
<li>
<p><code>-t,--tag list</code>ï¼šé•œåƒåç§°</p>
</li>
<li>
<p><code>-fï¼Œ--file string</code>ï¼šå¦‚æœæ–‡ä»¶åä¸æ˜¯<code>Dockerfile</code>ï¼Œ<code>-f</code>å¯ä»¥æŒ‡å®šå…¶ä»–æ–‡ä»¶</p>
</li>
<li>
<p><code>192.168.80.210:8080</code>ï¼šç§äººä»“åº“åœ°å€</p>
</li>
<li>
<p><code>test</code>ï¼šç§äººä»“åº“å</p>
</li>
<li>
<p><code>tomcat-demo:v1</code>ï¼šå®šä¹‰é•œåƒåç§°ä»¥åŠç‰ˆæœ¬</p>
</li>
<li>
<p>å¦‚æœæ‰“åŒ…æŠ¥é”™ï¼š<code>epository does not exist,</code>æ›´æ¢<code>Dockerfile</code>çš„<code>FROM</code>æºåœ°å€</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/tomcat-java-demo/
</span></span><span style="display:flex;"><span>$ docker build -t 192.168.80.210:8080/test/tomcat-demo:v1 .  	<span style="color:#75715e"># æ‰“åŒ…é•œåƒ</span>
</span></span><span style="display:flex;"><span>$ docker push 192.168.80.210:8080/test/tomcat-demo:v1  	<span style="color:#75715e"># æ¨é€åˆ°ç§äººä»“åº“ </span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="éƒ¨ç½²elkæ—¥å¿—æœåŠ¡">éƒ¨ç½²<code>ELK</code>æ—¥å¿—æœåŠ¡</h4>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/devops/Logs/kubernetes-elasticsearch.yaml" rel="external" target="_self"><code>Kubernetes Elasticsearch Template</code>æ¨¡æ¿</a></li>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/devops/Logs/kubernetes-logstash.yaml" rel="external" target="_self"><code>Kubernetes Logstash Template</code>æ¨¡æ¿</a></li>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/devops/Logs/kubernetes-filebeat.yaml" rel="external" target="_self"><code>Kubernetes Filebeat Template</code>æ¨¡æ¿</a></li>
<li><a href="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Template/devops/Logs/kubernetes-kibana.yaml" rel="external" target="_self"><code>Kubernetes Kibana Template</code>æ¨¡æ¿</a></li>
</ul>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="kubernetes_command">Kubernetes_Command</h1>

<h1 id="kuberneteså‘½ä»¤ä½¿ç”¨"><code>Kubernetes</code>å‘½ä»¤ä½¿ç”¨</h1>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands" rel="external" target="_self"><code>Kubernetes</code>å®˜æ–¹å‘½ä»¤æ–‡æ¡£</a></td>
<td><code>Kubernetes</code>å®˜æ–¹æ–‡æ¡£è¯¦è§£</td>
</tr>
<tr>
<td><a href="https://github.com/cloudnativelabs/kube-shell" rel="external" target="_self"><code>Kube-shell</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://kubernetes.io/zh-cn/docs/tasks/debug/debug-cluster/crictl/" rel="external" target="_self"><code>crictl</code></a></td>
<td><a href="https://github.com/kubernetes-sigs/cri-tools/blob/master/docs/crictl.md" rel="external" target="_self"><code>Crictl</code></a>ä¸»è¦ç”¨äºç›´æ¥ä¸å®¹å™¨è¿è¡Œæ—¶æ¥å£<code>CRI</code>è¿›è¡Œäº¤äº’ã€‚å®ƒç”¨äºè°ƒè¯•å’Œç®¡ç†å®¹å™¨è¿è¡Œæ—¶ï¼Œå¦‚ <code>containerd</code>æˆ–<code>CRI-O</code>ä¸­çš„å®¹å™¨</td>
</tr>
</tbody>
</table>
<p><a href="#R-image-9d66b5fd11f5fe9b74de5f67af718d9a" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/14d359426542433e871819e0de267de1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9d66b5fd11f5fe9b74de5f67af718d9a"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/14d359426542433e871819e0de267de1.png"></a></p>
</blockquote>
<h2 id="kubectlè·å–èµ„æºåç§°ä½¿ç”¨å‘½ä»¤"><code>kubectl</code>è·å–èµ„æºåç§°ã€ä½¿ç”¨å‘½ä»¤</h2>
<blockquote>
<ul>
<li><code>kubectl</code><!-- raw HTML omitted -->æ˜¯<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->é›†ç¾¤çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡å®ƒèƒ½å¤Ÿå¯¹é›†ç¾¤æœ¬èº«è¿›è¡Œç®¡ç†ï¼Œå¹¶èƒ½å¤Ÿåœ¨é›†ç¾¤ä¸Šè¿›è¡Œå®¹å™¨åŒ–åº”ç”¨çš„å®‰è£…å’Œéƒ¨ç½²<!-- raw HTML omitted --></li>
<li><code>kubectl api-resources</code><!-- raw HTML omitted -->æ˜¯æŸ¥çœ‹<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->èµ„æºå‘½ä»¤<!-- raw HTML omitted --></li>
<li><code>Kubernetes</code><!-- raw HTML omitted -->ä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œæ‰€æœ‰å‘½ä»¤éƒ½æ˜¯å›´ç»•èµ„æºæ“ä½œã€æ‰§è¡Œ<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>èµ„æºåˆ†ç±»</th>
<th>èµ„æºåç§°</th>
<th>ç¼©å†™</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>é›†ç¾¤çº§åˆ«èµ„æº</td>
<td><code>nodes</code></td>
<td><code>no</code></td>
<td>é›†ç¾¤ç»„æˆéƒ¨åˆ†</td>
</tr>
<tr>
<td>é›†ç¾¤çº§åˆ«èµ„æº</td>
<td><code>namespaces</code></td>
<td><code>ns</code></td>
<td>éš”ç¦»<code>Pod</code></td>
</tr>
<tr>
<td><code>Pods</code></td>
<td><code>Pods</code></td>
<td><code>po</code></td>
<td>è£…è½½å®¹å™¨</td>
</tr>
<tr>
<td><code>Pod</code>èµ„æºæ§åˆ¶å™¨</td>
<td><code>replicationcontrollers</code></td>
<td><code>rc</code></td>
<td>æ¯”è¾ƒåŸå§‹çš„<code>Pod</code>æ§åˆ¶å™¨ï¼Œå·²ç»è¢«åºŸå¼ƒï¼Œç”±<code>ReplicaSet</code>æ›¿ä»£</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>replicasets</code></td>
<td><code>rs</code></td>
<td>ä¿è¯æŒ‡å®šæ•°é‡çš„<code>Pod</code>è¿è¡Œï¼Œå¹¶æ”¯æŒ<code>Pod</code>æ•°é‡å˜æ›´ï¼Œé•œåƒç‰ˆæœ¬å˜æ›´</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>deployments</code></td>
<td><code>deploy</code></td>
<td>é€šè¿‡æ§åˆ¶<code>ReplicaSet</code>æ¥æ§åˆ¶<code>Pod</code>ï¼Œå¹¶æ”¯æŒæ»šåŠ¨å‡çº§ã€ç‰ˆæœ¬å›é€€</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>daemonsets</code></td>
<td><code>ds</code></td>
<td>åœ¨é›†ç¾¤ä¸­çš„æŒ‡å®š<code>Node</code>ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬ç”¨äºå®ˆæŠ¤è¿›ç¨‹ç±»çš„ä»»åŠ¡</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>jobs</code></td>
<td>&mdash;</td>
<td>å®ƒåˆ›å»ºå‡ºæ¥çš„<code>Pod</code>åªè¦å®Œæˆä»»åŠ¡å°±ç«‹å³é€€å‡ºï¼Œç”¨äºæ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>cronjobs</code></td>
<td><code>cj</code></td>
<td>å®ƒåˆ›å»ºçš„<code>Pod</code>ä¼šå‘¨æœŸæ€§çš„æ‰§è¡Œï¼Œç”¨äºæ‰§è¡Œå‘¨æœŸæ€§çš„ä»»åŠ¡</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>horizontalpodautoscalers</code></td>
<td><code>hpa</code></td>
<td>å¯ä»¥æ ¹æ®é›†ç¾¤è´Ÿè½½è‡ªåŠ¨è°ƒæ•´<code>Pod</code>çš„æ•°é‡ï¼Œå®ç°å‰Šå³°å¡«è°·</td>
</tr>
<tr>
<td><code>Pod</code>èµ„æºæ§åˆ¶å™¨</td>
<td><code>statefulsets</code></td>
<td><code>sts</code></td>
<td>ç®¡ç†æœ‰çŠ¶æ€çš„åº”ç”¨</td>
</tr>
<tr>
<td>æœåŠ¡å‘ç°èµ„æº</td>
<td><code>services</code></td>
<td><code>svc</code></td>
<td>ç»Ÿä¸€<code>Pod</code>å¯¹å¤–æ¥å£</td>
</tr>
<tr>
<td>æœåŠ¡å‘ç°èµ„æº</td>
<td><code>ingress</code></td>
<td><code>ing</code></td>
<td>ç»Ÿä¸€<code>Pod</code>å¯¹å¤–æ¥å£</td>
</tr>
<tr>
<td>å­˜å‚¨èµ„æº</td>
<td><code>volumeattachments</code></td>
<td>&mdash;</td>
<td>å­˜å‚¨</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>persistentvolumes</code></td>
<td><code>pv</code></td>
<td>å­˜å‚¨</td>
</tr>
<tr>
<td>å­˜å‚¨èµ„æº</td>
<td><code>persistentvolumeclaims</code></td>
<td><code>pvc</code></td>
<td>å­˜å‚¨</td>
</tr>
<tr>
<td>é…ç½®èµ„æº</td>
<td><code>configmaps</code></td>
<td><code>cm</code></td>
<td>é…ç½®</td>
</tr>
<tr>
<td>é…ç½®èµ„æº</td>
<td><code>secrets</code></td>
<td>&mdash;</td>
<td>é…ç½®</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>å¸¸ç”¨å‘½ä»¤</strong></th>
<th>å‘½ä»¤</th>
<th>ç¿»è¯‘</th>
<th>å‘½ä»¤ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>&mdash;</td>
<td><code>run</code></td>
<td>è¿è¡Œ</td>
<td>åœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>get</code></td>
<td>è·å–</td>
<td>è·å–æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªèµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>set</code></td>
<td>è®¾ç½®</td>
<td>è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„ç‰¹å®šç‰¹å¾</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>create</code></td>
<td>åˆ›å»º</td>
<td>ä»æ–‡ä»¶æˆ–æ ‡å‡†è¾“å…¥åˆ›å»ºèµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>edit</code></td>
<td>ç¼–è¾‘</td>
<td>ç¼–è¾‘æœåŠ¡å™¨ä¸Šçš„èµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>patch</code></td>
<td>æ›´æ–°</td>
<td>æ›´æ–°ä¸€ä¸ªèµ„æºï¼Œæ›´æ–°èµ„æºçš„å­—æ®µ</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>apply</code></td>
<td>åº”ç”¨</td>
<td>é€šè¿‡æ–‡ä»¶åæˆ–æ ‡å‡†è¾“å…¥å°†é…ç½®åº”ç”¨äºèµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>replace</code></td>
<td>æ›¿æ¢</td>
<td>ç”¨æ–‡ä»¶åæˆ–æ ‡å‡†è¾“å…¥æ›¿æ¢èµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>delete</code></td>
<td>åˆ é™¤</td>
<td><code>delete</code>æŒ‰æ–‡ä»¶åã€æ ‡å‡†è¾“å…¥ã€èµ„æºå’Œåç§°ï¼Œæˆ–æŒ‰èµ„æºå’Œæ ‡ç­¾é€‰æ‹©å™¨åˆ é™¤èµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>api-resources</code></td>
<td>&mdash;</td>
<td>æ‰“å°æœåŠ¡å™¨ä¸Šæ”¯æŒçš„<code>API</code>èµ„æº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>api-versions</code></td>
<td>&mdash;</td>
<td>æ‰“å°æœåŠ¡å™¨ä¸Šæ”¯æŒçš„<code>API</code>ç‰ˆæœ¬ï¼Œæ ¼å¼ä¸º<code>group/version</code></td>
</tr>
<tr>
<td><strong>å¸¸ç”¨å‘½ä»¤</strong></td>
<td><code>version</code></td>
<td>ç‰ˆæœ¬</td>
<td>æ‰“å°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>ä¸­çº§å‘½ä»¤</strong></th>
<th>å‘½ä»¤</th>
<th>ç¿»è¯‘</th>
<th>å‘½ä»¤ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>&mdash;</td>
<td><code>cp</code></td>
<td>å¤åˆ¶</td>
<td>åœ¨<code>Pod</code>å†…å¤–å¤åˆ¶æ–‡ä»¶</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>exec</code></td>
<td>æ‰§è¡Œ</td>
<td>åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>label</code></td>
<td>æ ‡ç­¾</td>
<td>æ›´æ–°èµ„æºä¸Šçš„æ ‡ç­¾</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>logs</code></td>
<td>æ—¥å¿—</td>
<td>æ‰“å°<code>pod</code>ä¸­å®¹å™¨çš„æ—¥å¿—</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>attach</code></td>
<td>ç¼ ç»•</td>
<td>è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨ã€é™„åŠ åˆ°æ­£åœ¨è¿è¡Œçš„å®¹å™¨</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>describe</code></td>
<td>æè¿°</td>
<td><code>describe</code>æ˜¾ç¤ºç‰¹å®šèµ„æºæˆ–èµ„æºç»„çš„è¯¦ç»†ä¿¡æ¯</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>expose</code></td>
<td>æš´éœ²</td>
<td>å°†å¤åˆ¶æ§åˆ¶å™¨ã€æœåŠ¡ã€éƒ¨ç½²æˆ–<code>pod</code>æš´éœ²ä¸ºæ–°çš„<code>Kubernetes</code>æœåŠ¡<code>Service</code></td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>explain</code></td>
<td>è§£é‡Š</td>
<td>å±•ç¤ºèµ„æºç±»å‹ã€å±æ€§æ–‡æ¡£ï¼Œè·å–èµ„æºæ§åˆ¶å™¨å­—æ®µä½¿ç”¨</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>annotate</code></td>
<td>æ³¨é‡Š</td>
<td>æ›´æ–°èµ„æºä¸Šçš„æ³¨é‡Š</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>rollout</code></td>
<td>é¦–æ¬¡å±•ç¤º</td>
<td>ç®¡ç†èµ„æºçš„å‘å¸ƒï¼ŒæŸ¥çœ‹ã€æ›´æ–°<code>Pods</code>ç‰ˆæœ¬å‘å¸ƒ</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>scale</code></td>
<td>æ‰‹åŠ¨æ‰©å®¹ã€ç¼©å®¹</td>
<td>æ‰©(ç¼©)å®¹<code>Pod</code>çš„æ•°é‡,ä¸º<code>Deployment</code>ã€<!-- raw HTML omitted --><code>ReplicaSet</code>æˆ–<!-- raw HTML omitted --><code>Replication</code> <code>Controller</code>è®¾ç½®æ–°çš„å¤§å°</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>autoscale</code></td>
<td>ç›‘æ§<code>CPU</code>ã€å†…å­˜è‡ªåŠ¨æ‰©å®¹ã€ç¼©å®¹</td>
<td>è‡ªåŠ¨è°ƒæ•´<code>Pod</code>çš„æ•°é‡ï¼Œè‡ªåŠ¨ç¼©æ”¾<code>Deployment</code>ã€<!-- raw HTML omitted --><code>ReplicaSet</code>ã€<code>StatefulSet</code>æˆ–<code>ReplicationController</code></td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>plugin</code></td>
<td>&mdash;</td>
<td>æä¾›ä¸æ’ä»¶äº¤äº’çš„å®ç”¨ç¨‹åº</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>taint</code></td>
<td>æ±¡ç‚¹</td>
<td><code>taint</code>èŠ‚ç‚¹ä¸Šè®¾ç½®æ±¡ç‚¹</td>
</tr>
<tr>
<td><strong>ä¸­çº§å‘½ä»¤</strong></td>
<td><code>config</code></td>
<td>&mdash;</td>
<td>ä¿®æ”¹<code>kubeconfig</code>æ–‡ä»¶</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>é«˜çº§å‘½ä»¤</strong></th>
<th>å‘½ä»¤</th>
<th>ç¿»è¯‘</th>
<th>å‘½ä»¤ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>&mdash;</td>
<td><code>top</code></td>
<td></td>
<td>é¡¶éƒ¨æ˜¾ç¤ºèµ„æºï¼ˆ<code>CPU</code>/å†…å­˜ï¼‰ä½¿ç”¨æƒ…å†µ</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>auth</code></td>
<td></td>
<td>æ£€æŸ¥æˆæƒ</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>diff</code></td>
<td>å¯¹æ¯”</td>
<td>å¯¹æ¯”å®æ—¶ç‰ˆæœ¬ä¸å°†è¦åº”ç”¨çš„ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚</td>
</tr>
<tr>
<td>&mdash;</td>
<td><code>wait</code></td>
<td>ç­‰å¾…</td>
<td>ç­‰å¾…å®éªŒï¼šç­‰å¾…ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºçš„ç‰¹å®šæ¡ä»¶</td>
</tr>
<tr>
<td></td>
<td><code>proxy</code></td>
<td>ä»£ç†</td>
<td>è¿è¡Œåˆ°<code>Kubernetes API</code>æœåŠ¡å™¨çš„ä»£ç†</td>
</tr>
<tr>
<td></td>
<td><code>cordon</code></td>
<td>è­¦æˆ’çº¿</td>
<td>è­¦æˆ’çº¿ å°†èŠ‚ç‚¹æ ‡è®°ä¸ºä¸å¯è°ƒåº¦</td>
</tr>
<tr>
<td></td>
<td><code>uncordon</code></td>
<td></td>
<td><code>uncordon</code>å°†èŠ‚ç‚¹æ ‡è®°ä¸ºå¯è°ƒåº¦</td>
</tr>
<tr>
<td></td>
<td><code>drain</code></td>
<td>æ’æ°´</td>
<td>æ’æ°´èŠ‚ç‚¹å‡†å¤‡ç»´æŠ¤</td>
</tr>
<tr>
<td></td>
<td><code>completion</code></td>
<td></td>
<td>å®Œæˆè¾“å‡ºæŒ‡å®š<code>shell</code>çš„<code>shell</code>å®Œæˆä»£ç ï¼ˆ<code>bash</code>æˆ–<code>zsh</code>ï¼‰</td>
</tr>
<tr>
<td></td>
<td><code>certificate</code></td>
<td>è¯ä¹¦</td>
<td>ä¿®æ”¹è¯ä¹¦èµ„æº</td>
</tr>
<tr>
<td></td>
<td><code>cluster-info</code></td>
<td>é›†ç¾¤ä¿¡æ¯</td>
<td>æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯</td>
</tr>
<tr>
<td></td>
<td><code>port-forward</code></td>
<td>è½¬å‘</td>
<td>å°†ä¸€ä¸ªæˆ–å¤šä¸ªæœ¬åœ°ç«¯å£è½¬å‘åˆ°ä¸€ä¸ª<code>pod</code></td>
</tr>
<tr>
<td></td>
<td><code>debug</code></td>
<td>è°ƒè¯•</td>
<td>åˆ›å»ºè°ƒè¯•ä¼šè¯ä»¥å¯¹å·¥ä½œè´Ÿè½½å’ŒèŠ‚ç‚¹è¿›è¡Œæ•…éšœæ’é™¤</td>
</tr>
<tr>
<td><strong>é«˜çº§å‘½ä»¤</strong></td>
<td><code>kustomize</code></td>
<td></td>
<td>ä»ç›®å½•æˆ–<code>URL</code>æ„å»ºä¸€ä¸ª<code>kustomization</code>ç›®æ ‡</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>å“æ§çº§åˆ«(Track)</th>
<th>æ—¥æœŸã€æ—¶é—´</th>
<th>&mdash;</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¯å¤©</td>
<td><code>daily</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td>æ¯å‘¨</td>
<td><code>weekly</code></td>
<td>&mdash;</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="span-idå¸¸ç”¨å‘½ä»¤å¸¸ç”¨å‘½ä»¤åˆ›å»ºåˆ é™¤span"><!-- raw HTML omitted -->å¸¸ç”¨å‘½ä»¤ï¼šåˆ›å»ºã€åˆ é™¤<!-- raw HTML omitted --></h3>
<blockquote>
<ul>
<li><code>kubectl --help</code><!-- raw HTML omitted -->ï¼šå¯ä»¥é€šè¿‡<code>--help</code>æŸ¥çœ‹è¯¦ç»†çš„æ“ä½œå‘½ä»¤<!-- raw HTML omitted --></li>
<li><code>kubectl</code><!-- raw HTML omitted -->å‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹<!-- raw HTML omitted --><code>$ kubectl [command] [type] [name] [flags]</code></li>
</ul>
<blockquote>
<ul>
<li><code>command</code>:	<!-- raw HTML omitted -->æŒ‡å®šè¦å¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œï¼Œæ¯”å¦‚ï¼š<!-- raw HTML omitted --><code>create</code>ã€<code>get</code>ã€<code>delete</code></li>
<li><code>type</code>ï¼š<!-- raw HTML omitted -->æŒ‡å®šèµ„æºçš„ç±»å‹ï¼Œæ¯”å¦‚ï¼š<!-- raw HTML omitted --><code>deployment</code>ã€<code>pod</code>ã€<code>service</code></li>
<li><code>name</code>ï¼š <!-- raw HTML omitted -->æŒ‡å®šèµ„æºçš„åç§°ï¼Œåç§°å¤§å°å†™æ•æ„Ÿ <!-- raw HTML omitted --></li>
<li><code>flags</code>ï¼š <!-- raw HTML omitted -->æŒ‡å®šé¢å¤–çš„å¯é€‰å‚æ•°<!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>
<ol>
<li><code>kubectl run --help</code><!-- raw HTML omitted -->ï¼šå‘½ä»¤ä½¿ç”¨é•œåƒåˆ›å»ºå®¹å™¨ <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl run nginx --image<span style="color:#f92672">=</span>nginx:1.17.1 -n web</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>kubectl get --help</code><!-- raw HTML omitted -->ï¼šè·å–èµ„æºï¼Œé€‰æ‹©è¾“å‡ºçš„æ ¼å¼<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><strong><code>-o wide</code></strong></li>
<li><strong><code>-o json</code></strong></li>
<li><strong><code>-o yaml</code></strong></li>
<li><code>Service</code><!-- raw HTML omitted -->å¯ä»¥çœ‹åšæ˜¯ä¸€ç»„åŒç±»çš„<code>Pod</code>å¯¹å¤–çš„è®¿é—®æ¥å£ï¼Œå€ŸåŠ©<code>Service</code>ï¼Œåº”ç”¨å¯ä»¥æ–¹ä¾¿çš„å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get csr  	<span style="color:#75715e"># æŸ¥çœ‹ç”³è¯·åŠ å…¥kubernetesé›†ç¾¤çš„tokenä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl get endpoints  	<span style="color:#75715e"># è·å–serviceå¯¹åº”çš„æ‰€æœ‰podçš„è®¿é—®åœ°å€</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl get all --namespace<span style="color:#f92672">=</span>kube-system  	<span style="color:#75715e"># æŸ¥çœ‹æ‰€æœ‰namespaceä¸‹æ‰€æœ‰èµ„æº</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl get pods -n web -o wide -w  	<span style="color:#75715e"># æŸ¥çœ‹namespace webä¸‹çš„podï¼Œ-o wide:æŸ¥çœ‹æ›´å¤šä¿¡æ¯ï¼Œ-wï¼šåŠ¨æ€æŸ¥çœ‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨kubectl getå‘½ä»¤å¯¼å‡ºyamlæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ kubectl get pod coredns-558bd4d5db-9h55s -n kube-system -o yaml &gt;/tmp/coredns-558bd4d5db-9h55s.yaml</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>kubectl set --help</code><!-- raw HTML omitted -->æ›´æ–°é•œåƒã€è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„ç‰¹å®šç‰¹å¾<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl set image deployment/web nginx<span style="color:#f92672">=</span>nginx1.15</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>kubectl create --help</code><!-- raw HTML omitted -->ï¼šåˆ›å»ºå‘½ä»¤ç”¨äºåˆ›å»ºèµ„æº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶è¯¦è§£ã€ä½¿ç”¨<!-- raw HTML omitted --><code>kubectl create</code><!-- raw HTML omitted -->å‘½ä»¤ç”Ÿæˆ<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>deployment</code><!-- raw HTML omitted -->ï¼šæ— çŠ¶æ€åº”ç”¨éƒ¨ç½²<!-- raw HTML omitted --></li>
<li><code>java-demo</code><!-- raw HTML omitted -->ï¼šè‡ªå®šä¹‰åç§°<!-- raw HTML omitted --></li>
<li><code> --image</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨é•œåƒ<!-- raw HTML omitted --></li>
<li><code> --dry-run</code><!-- raw HTML omitted -->ï¼šæµ‹è¯•<!-- raw HTML omitted --></li>
<li><code>-o</code><!-- raw HTML omitted -->ï¼šè¾“å‡º<!-- raw HTML omitted --></li>
<li><code>&gt;/tmp/deploy.yaml</code><!-- raw HTML omitted -->ï¼šå®šå‘è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œä¸åŠ <!-- raw HTML omitted --><code>&gt;/tmp/deploy.yaml</code><!-- raw HTML omitted --> è¾“å‡ºåˆ°å±å¹•æŸ¥çœ‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºä¸€ä¸ªnamespaceå‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>$ kubectl create namespace dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create deployment java-demo --image<span style="color:#f92672">=</span>192.168.80.210:8080/test/tomcat-demo:v1 --dry-run<span style="color:#f92672">=</span>client -o yaml &gt;/tmp/deploy.yaml  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create service clusterip ngx-dep --tcp<span style="color:#f92672">=</span>80:80  <span style="color:#75715e"># å‘½ä»¤è¡Œåˆ›å»ºservice</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create -f ns-dev.yaml    <span style="color:#75715e"># æ ¹æ®yamlæ–‡ä»¶åˆ›å»ºèµ„æº</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>kubectl edit --help</code><!-- raw HTML omitted -->ï¼š<code>cm</code>ï¼šç¼–è¾‘<!-- raw HTML omitted --><code>configMap</code><!-- raw HTML omitted -->ä¸­çš„é…ç½®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹serviceä¸­çš„æœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ kubectl edit service/ingress-nginx-controller-admission -n ingress-nginx 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl edit cm kube-proxy -n kube-system <span style="color:#75715e"># ä¿®æ”¹ipvs(å¿…é¡»å®‰è£…ipvså†…æ ¸æ¨¡å—ï¼Œå¦åˆ™ä¼šé™çº§ä¸ºiptables) ä¿®æ”¹ï¼šmode: &#34;ipvs&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><code>kubectl patch --help</code><!-- raw HTML omitted -->ï¼šè¡¥ä¸ä¿®æ”¹ã€æ›´æ–°èµ„æºçš„å­—æ®µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl patch pod rc-nginx-2-kpiqt -p <span style="color:#e6db74">&#39;{&#34;metadata&#34;:{&#34;labels&#34;:{&#34;app&#34;:&#34;nginx-3&#34;}}}&#39;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><code>kubectl apply --help</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¦‚æœèµ„æºä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºï¼Œç›¸å½“äº<!-- raw HTML omitted --><code>kubectl create</code></li>
<li><!-- raw HTML omitted -->å¦‚æœèµ„æºå­˜åœ¨ï¼Œå°±æ›´æ–°ï¼Œç›¸å½“äº<!-- raw HTML omitted --><code>kubectl patch</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¿è¡Œæ„å»ºå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f ./  	<span style="color:#75715e"># åº”ç”¨å½“å‰ç›®å½•ä¸‹æ‰€æœ‰yamlæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f deploy.yaml  	<span style="color:#75715e"># K8Sé»˜è®¤æ‹‰å»GitHubä¸Šé•œåƒ</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f nginx-pod.yaml -n web --record</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="8">
<li><code>kubectl replace --help</code><!-- raw HTML omitted -->ï¼šæ ¹æ®<code>yaml</code>æ–‡ä»¶æ›´æ–°ä¿®æ”¹åé…ç½®èµ„æºï¼Œä¼šåœæ‰åŸæ¥çš„èµ„æºï¼Œé‡æ–°åˆ›å»º<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl replace -f rc-nginx.yaml  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="9">
<li><code>kubectl delete --help</code><!-- raw HTML omitted -->ï¼šåˆ é™¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://aws.amazon.com/cn/premiumsupport/knowledge-center/eks-terminated-namespaces/" rel="external" target="_self">åˆ é™¤<code>Terminating</code>(æ­£åœ¨ç»ˆæ­¢)çŠ¶æ€å‘½åç©ºé—´</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl delete svc/web
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl delete -f deployment-nginx.yaml  	<span style="color:#75715e"># åˆ é™¤è¯¥yamlä¸­åˆ›å»ºçš„èµ„æº</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl delete pod nginx-deployment-798444d598-87hlk -n web  	<span style="color:#75715e"># åˆ é™¤podèµ„æº  </span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="10">
<li><code>kubectl api-resources --help</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl api-resources  	<span style="color:#75715e"># æŸ¥çœ‹k8sæ‰€æœ‰çš„èµ„æºä»¥åŠå¯¹åº”çš„apiversion</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl api-versions  	<span style="color:#75715e"># æŸ¥çœ‹k8sæ‰€æœ‰ ç‰ˆæœ¬å· </span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="span-idä¸­çº§å‘½ä»¤ä¸­çº§å‘½ä»¤è¿è¡Œè°ƒè¯•span"><!-- raw HTML omitted -->ä¸­çº§å‘½ä»¤ï¼šè¿è¡Œã€è°ƒè¯•<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><code>kubectl exec --help</code><!-- raw HTML omitted -->è¿›å…¥å®¹å™¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl exec -it nginx-deployment-798444d598-87hlk  -n web -- /bin/sh
</span></span><span style="display:flex;"><span>$ kubectl exec my-pod -it -- ls /opt/  	<span style="color:#75715e"># åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼ˆåªæœ‰ä¸€ä¸ªå®¹å™¨çš„æƒ…å†µä¸‹ï¼‰</span>
</span></span><span style="display:flex;"><span>$ kubectl exec my-pod -c my-container -- ls /  	<span style="color:#75715e"># åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼ˆpodä¸­æœ‰å¤šä¸ªå®¹å™¨çš„æƒ…å†µä¸‹ï¼‰ </span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>kubectl label --help</code><!-- raw HTML omitted -->ï¼šæ›´æ–°èµ„æºä¸Šçš„æ ‡ç­¾<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>æ ‡ç­¾<code>Key</code></th>
<th><code>Values</code></th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>release</code>(å‘å¸ƒ)</td>
<td>ç‰ˆæœ¬ï¼š<code>stable</code>(ç¨³å®šç‰ˆ)ã€<code>canary</code>(é‡‘ä¸é›€ç‰ˆ)ã€<code>alpha</code>(å†…æµ‹)ã€<code>bate</code>(å…¬æµ‹)</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>environment</code>(ç¯å¢ƒ)</td>
<td>ç¯å¢ƒï¼š<code>dev</code>(å¼€å‘)ã€<code>qa/test</code>(æµ‹è¯•)ã€<code>gray</code>(ç°åº¦)ã€<code>production</code>(ç”Ÿäº§)ã€<code>op</code>(è¿ç»´)ã€<code>ui,as,pc,sc</code>(åº”ç”¨ç±»(<code>app</code>))</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>tier</code>(å±‚çº§)</td>
<td>å±‚çº§ï¼š<code>frontend</code>(å‰ç«¯)ã€<code>backend</code>(åç«¯)ã€<code>cache</code>(ç¼“å­˜)</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>partition</code>(åˆ†åŒº/æ¨¡å—)</td>
<td>åˆ†åŒº/æ¨¡å—ï¼š<code>customerA</code>(ä¸šåŠ¡A/å®¢æˆ·A)ã€<code>customerB</code>(ä¸šåŠ¡B/å®¢æˆ·B)</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>version</code>(ç‰ˆæœ¬å·)</td>
<td>ç‰ˆæœ¬å·ï¼š<code>v1.1ã€v1.2</code></td>
<td>&mdash;</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->ç»™èŠ‚ç‚¹<!-- raw HTML omitted --><code>Nodes</code><!-- raw HTML omitted -->æ‰“æ ‡ç­¾ã€åˆ é™¤æ ‡ç­¾<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ˜¾ç¤º Nodes æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>$ kubectl get node --show-labels
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç»™ Nodes èŠ‚ç‚¹æ‰“ä¸Šï¼Œåå­—ä¸ºï¼šdata çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>$ kubectl label nodes nodes_name data<span style="color:#f92672">=</span>labels_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤ Nodes ä¸Šï¼Œåå­—ä¸ºï¼šdata çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>$ kubectl label nodes nodes_name data-</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç»™èŠ‚ç‚¹<!-- raw HTML omitted --><code>Pods</code><!-- raw HTML omitted -->æ‰“æ ‡ç­¾ã€åˆ é™¤æ ‡ç­¾<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ˜¾ç¤ºå‘½åç©ºé—´ä¸ºï¼šweb ä¸‹ Pods çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>$ kubectl get pods --show-labels -n web -o wide
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸º Pods æ‰“ä¸Šï¼Œåå­—ä¸ºï¼šversion çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>$ kucectl label pods pods_name version<span style="color:#f92672">=</span>1.0 -n web
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¦†ç›–åŸæ¥çš„æ ‡ç­¾ï¼š--overwrite</span>
</span></span><span style="display:flex;"><span>$ kucectl label pods pods_name version<span style="color:#f92672">=</span>2.0 --overwrite -n web
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤ Pods ä¸Šï¼Œåå­—ä¸ºï¼šversion çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>$ kucectl label pods pods_name version- -n web</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>kubectl describe --help</code><!-- raw HTML omitted -->æ˜¾ç¤ºèµ„æºå†…éƒ¨ä¿¡æ¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl describe namespace kube-system
</span></span><span style="display:flex;"><span>Name:         kube-system
</span></span><span style="display:flex;"><span>Labels:       kubernetes.io/metadata.name<span style="color:#f92672">=</span>kube-system
</span></span><span style="display:flex;"><span>Annotations:  &lt;none&gt;
</span></span><span style="display:flex;"><span>Status:       Active  	<span style="color:#75715e"># è¡¨ç¤ºæ­£åœ¨ä½¿ç”¨ä¸­ï¼ŒTerminating:è¡¨ç¤ºæ­£åœ¨åˆ é™¤å‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>No resource quota.  	<span style="color:#75715e"># è¡¨ç¤ºï¼šé’ˆå¯¹å‘½åç©ºé—´åšçš„èµ„æºé™åˆ¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>No LimitRange resource.  	<span style="color:#75715e"># è¡¨ç¤ºï¼šé’ˆå¯¹å‘½åç©ºé—´ä¸­çš„æ¯ä¸ªç»„ä»¶åšçš„èµ„æºé™åˆ¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl describe pods -n web nginx-pod  	<span style="color:#75715e"># æŸ¥çœ‹pod çš„è¯¦ç»†ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>$ kubectl describe service -n web nginx-svc  	<span style="color:#75715e"># æŸ¥çœ‹serviceçš„ è¯¦ç»†ä¿¡æ¯ </span>
</span></span><span style="display:flex;"><span>$ kubectl describe node 192.168.3.125  	<span style="color:#75715e"># æŸ¥çœ‹nodeçš„è¯¦ç»†ä¿¡æ¯</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>kubectl logs --help</code><!-- raw HTML omitted -->æ—¥å¿—æŸ¥çœ‹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl logs -n web nginx-deployment-798444d598-87hlk  	<span style="color:#75715e"># æŸ¥çœ‹podæ—¥å¿—</span>
</span></span><span style="display:flex;"><span>$ kubectl logs -f nginx-deployment-798444d598-87hlk -n web  <span style="color:#75715e"># å®æ—¶æŸ¥çœ‹æ—¥å¿—</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl logs nginx-deployment-798444d598-87hlk -c &lt;container_name&gt; -n web  <span style="color:#75715e"># æŸ¥çœ‹podä¸­å•ä¸ªå®¹å™¨çš„æ—¥å¿—</span>
</span></span><span style="display:flex;"><span>$ kubectl logs -l app<span style="color:#f92672">=</span>frontend -n web    <span style="color:#75715e"># è¿”å›å…¨éƒ¨æ ‡è®°ä¸º app=frontend çš„ pod çš„åˆå¹¶æ—¥å¿—</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>kubectl expose --help</code><!-- raw HTML omitted -->ç«¯å£æš´éœ²<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>expose</code><!-- raw HTML omitted -->ç«¯å£è®¾ç½®å›ºå®šé€‰é¡¹<!-- raw HTML omitted --></li>
<li><code> java-demo</code><!-- raw HTML omitted -->ï¼š è‡ªå®šä¹‰åç§°<!-- raw HTML omitted --></li>
<li><code>--port</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>çš„<code>Service</code>æœåŠ¡ç«¯å£ï¼Œé›†ç¾¤å†…éƒ¨äº’é€šç«¯å£<!-- raw HTML omitted --></li>
<li><code>--target-port</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>å®¹å™¨å†…æœåŠ¡ç«¯å£ç«¯å£<!-- raw HTML omitted --></li>
<li><code>--type</code><!-- raw HTML omitted -->ï¼šéšæœºç”Ÿæˆå¤–éƒ¨è®¿é—®ç«¯å£<!-- raw HTML omitted --></li>
<li><code>&gt;java-demo-svc.yaml</code><!-- raw HTML omitted -->ï¼šå®šå‘è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œä¸åŠ <!-- raw HTML omitted --><code>&gt;java-demo-svc.yaml</code><!-- raw HTML omitted -->è¾“å‡ºåˆ°å±å¹•æŸ¥çœ‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl expose --help
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl expose deployment java-demo --port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span> --target-port<span style="color:#f92672">=</span><span style="color:#ae81ff">8080</span> --type<span style="color:#f92672">=</span>NodePort --dry-run<span style="color:#f92672">=</span>client -o yaml &gt;java-demo-svc.yaml  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f java-demo-svc.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯¹å¤–å‘å¸ƒå…è®¸å¤–ç½‘è®¿é—®</span>
</span></span><span style="display:flex;"><span>$ kubectl expose deployment web --port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span> --type<span style="color:#f92672">=</span>NodePort --target-port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span> --name<span style="color:#f92672">=</span>web
</span></span><span style="display:flex;"><span>$ kubectl get service
</span></span><span style="display:flex;"><span>$ kubectl get deploy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># PORT(S):80(é›†ç¾¤å†…éƒ¨äº’é€šç«¯å£)ã€30040/TCP(å¤–éƒ¨è®¿é—®ç«¯å£)</span>
</span></span><span style="display:flex;"><span>$ kubectl get pods,svc
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod/java-demo-56d54df448-2m8kr   1/1     Running   <span style="color:#ae81ff">0</span>          68m
</span></span><span style="display:flex;"><span>pod/java-demo-56d54df448-9k5dn   1/1     Running   <span style="color:#ae81ff">0</span>          68m
</span></span><span style="display:flex;"><span>pod/java-demo-56d54df448-wvqkf   1/1     Running   <span style="color:#ae81ff">0</span>          68m
</span></span><span style="display:flex;"><span>pod/nginx-6799fc88d8-5sxfn       1/1     Running   <span style="color:#ae81ff">0</span>          3h4m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>        AGE
</span></span><span style="display:flex;"><span>service/java-demo    NodePort    10.103.37.12   &lt;none&gt;        80:30040/TCP   105s
</span></span><span style="display:flex;"><span>service/kubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP        4h35m
</span></span><span style="display:flex;"><span>service/nginx        NodePort    10.106.61.55   &lt;none&gt;        80:31750/TCP   3h4m</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><code>kubectl explain --help</code><!-- raw HTML omitted -->ï¼šå±•ç¤ºèµ„æºä½¿ç”¨æ–‡æ¡£<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain pod.kind.replicasets <span style="color:#75715e"># æŸ¥çœ‹æŸç§èµ„æºå¯ä»¥é…ç½®çš„ä¸€çº§é…ç½®å¦‚ï¼špodã€deployment</span>
</span></span><span style="display:flex;"><span>$ kubectl explain pod.metadata       <span style="color:#75715e"># æŸ¥çœ‹èµ„æºçš„å­å±æ€§ï¼Œèµ„æºç±»å‹ï¼špodã€å±æ€§ï¼šmetadata</span>
</span></span><span style="display:flex;"><span>$ kubectl explain pod.spec 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nodes</span>
</span></span><span style="display:flex;"><span>$ kubectl explain pod.spec.nodeName.containers
</span></span><span style="display:flex;"><span>$ kubectl explain pod.spec.nodeSelector.containers</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><code>kubectl rollout --help</code><!-- raw HTML omitted -->ï¼šç®¡ç†èµ„æº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>status</code><!-- raw HTML omitted -->ï¼šæ˜¾ç¤ºå½“å‰å‡çº§çŠ¶æ€<!-- raw HTML omitted --></li>
<li><code>history</code><!-- raw HTML omitted -->ï¼šæ˜¾ç¤ºå‡çº§å†å²è®°å½•<!-- raw HTML omitted --></li>
<li><code>pause</code><!-- raw HTML omitted -->ï¼šæš‚åœç‰ˆæœ¬å‡çº§è¿‡ç¨‹<!-- raw HTML omitted --></li>
<li><code>resume</code><!-- raw HTML omitted -->ï¼šç»§ç»­å·²ç»æš‚åœçš„ç‰ˆæœ¬å‡çº§è¿‡ç¨‹<!-- raw HTML omitted --></li>
<li><code>restart</code><!-- raw HTML omitted -->ï¼šé‡å¯ç‰ˆæœ¬å‡çº§è¿‡ç¨‹<!-- raw HTML omitted --></li>
<li><code>undo</code><!-- raw HTML omitted -->ï¼šå›æ»šåˆ°ä¸Šä¸€çº§ç‰ˆæœ¬(å¯ä»¥ä½¿ç”¨<!-- raw HTML omitted --><code>--to-revision</code><!-- raw HTML omitted -->ï¼ŒæŒ‡å®šç‰ˆæœ¬)<!-- raw HTML omitted --></li>
<li><code>--record</code><!-- raw HTML omitted -->ï¼šè®°å½•<!-- raw HTML omitted --><code>CHANGE-CAUSE</code><!-- raw HTML omitted -->(æ”¹å˜åŸå› )æ“ä½œè®°å½•,ä¾¿äºå›æ»š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ–°å‘å¸ƒ</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f nginx-deployment.yml --record  	<span style="color:#75715e"># --recordï¼Œè®°å½•æ“ä½œè®°å½•,ä¾¿äºå›æ»š</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pause æš‚å®šæ›´æ–°å‘å¸ƒ</span>
</span></span><span style="display:flex;"><span>$ kubectl rollout pause deployment nginx-deployment -n app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># resume ç»§ç»­æ›´æ–°å‘å¸ƒ</span>
</span></span><span style="display:flex;"><span>$ kubectl rollout resume deployment nginx-deployment -n app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å‡çº§çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>$ kubectl rollout status deployment/nginx-deployment
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å‡çº§å†å²ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ kubectl rollout history deployment/web
</span></span><span style="display:flex;"><span>$ kubectl rollout history deployment -n app
</span></span><span style="display:flex;"><span>$ kubectl rollout history deployment/web --revision<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># æŸ¥çœ‹æŸä¸ªæ›´æ–°å…·ä½“å†…å®¹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å›æ»š</span>
</span></span><span style="display:flex;"><span>$ kubectl rollout undo deployment/web --revision<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>$ kubectl rollout undo deployment/nginx-deployment --to-revision<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> -n app  	<span style="color:#75715e"># ç‰ˆæœ¬å›æ»šåˆ°v1</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="8">
<li><code>kubectl scale --help</code><!-- raw HTML omitted -->ï¼šæ‰‹åŠ¨æ‰©ç¼©å®¹<code>Pod</code>æ•°é‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>--replicas</code><!-- raw HTML omitted -->ï¼šå‚æ•°å®šä¹‰<code>Pod</code>æ•°é‡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl scale rc redis --replicas<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> -n web  	<span style="color:#75715e"># æ“ä½œpod çš„æ‰©å®¹å’Œç¼©å®¹</span>
</span></span><span style="display:flex;"><span>$ kubectl scale --replicas<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> -f redis-slave-deployment.yaml</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="9">
<li><code>kubectl autoscale --help</code><!-- raw HTML omitted -->ï¼šç›‘æ§<code>CPU</code>ä½¿ç”¨ç™¾åˆ†æ¯”è‡ªåŠ¨æ‰©ç¼©<code>Pod</code>æ•°é‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>deployment</code><!-- raw HTML omitted -->ï¼šç±»å‹æ§åˆ¶å™¨<!-- raw HTML omitted --></li>
<li><code>deployment-name</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>çš„åç§°<!-- raw HTML omitted --></li>
<li><code>--cpu-percent</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨<code>CPU</code>ç™¾åˆ†æ¯”<!-- raw HTML omitted --></li>
<li><code>--min</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>æœ€å°‘æ•°é‡<!-- raw HTML omitted --></li>
<li><code>--max</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>æœ€å¤šæ•°é‡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl autoscale deployment deployment-name --cpu-percent<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span> --min<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> --max<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="10">
<li><code>kubectl taint --help</code><!-- raw HTML omitted -->ï¼šæ±¡ç‚¹é…ç½®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹èŠ‚ç‚¹ä¸Šçš„æ±¡ç‚¹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl describe nodes k8s-node1 | grep Taints</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è®¾ç½®æ±¡ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>tag=webapps</code>ã€<code>tag</code><!-- raw HTML omitted -->ï¼šæ±¡ç‚¹åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œä¾<!-- raw HTML omitted --><code>Key=value</code></li>
<li><code>NoSchedule</code><!-- raw HTML omitted -->ï¼šå½±å“ï¼Œä¸ä¼šè°ƒåº¦åˆ°æ­¤èŠ‚ç‚¹<!-- raw HTML omitted --></li>
<li><code>NoExecute</code><!-- raw HTML omitted -->ï¼šé©±é™¤ï¼ŒæŠŠæ­¤èŠ‚ç‚¹ä¸Šçš„<code>Pods</code>é©±é™¤åˆ°å…¶ä»–èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl taint node k8s-node1 tag<span style="color:#f92672">=</span>webapps:NoSchedule</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å»é™¤æ±¡ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>-</code><!-- raw HTML omitted -->ï¼šæ±¡ç‚¹åç§°åé¢è·Ÿ<!-- raw HTML omitted --><!-- raw HTML omitted -->å‡å·<!-- raw HTML omitted --><!-- raw HTML omitted -->å°±æ˜¯å»é™¤æ±¡ç‚¹æ„æ€<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl taint node k8s-master-01 node-role.kubernetes.io/control-plane:NoSchedule-
</span></span><span style="display:flex;"><span>node/k8s-master-01 untainted  	<span style="color:#75715e"># è¿”å›ç»“æœ æ±¡ç‚¹å·²å»é™¤</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å»é™¤ä»¥ tag ä¸ºåè®¾ç½®çš„æ‰€æœ‰æ±¡ç‚¹</span>
</span></span><span style="display:flex;"><span>$ kubectl taint node k8s-node1 tag-</span></span></code></pre></div></blockquote>
<hr>
<h3 id="span-idé«˜çº§å‘½ä»¤é«˜çº§å‘½ä»¤ç®¡ç†æ’æŸ¥span"><!-- raw HTML omitted -->é«˜çº§å‘½ä»¤ï¼šç®¡ç†ã€æ’æŸ¥<!-- raw HTML omitted --></h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/kubernetes-sigs/metrics-server" rel="external" target="_self"><code>Kubernetes</code>æŒ‡æ ‡æœåŠ¡å™¨</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/cai11745/hybrid-cloud/blob/master/prometheus/2019-10-22-prometheus-1-install-and-metricsIngress.md" rel="external" target="_self">å®‰è£…<code>Prometheus</code>ç›‘æ§æœåŠ¡å™¨èµ„æº</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/prometheus-operator/kube-prometheus" rel="external" target="_self"><code>kube-prometheus</code>æœåŠ¡èµ„æºç›‘æ§</a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><code>kubectl top --help</code><!-- raw HTML omitted -->ï¼šç›‘æ§é›†ç¾¤å†…å­˜<code>CPU</code>æŒ‡æ ‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>metrics-server</code><!-- raw HTML omitted -->å¯ä»¥ç”¨æ¥æ”¶é›†é›†ç¾¤ä¸­çš„èµ„æºä½¿ç”¨æƒ…å†µã€éœ€è¦å•ç‹¬å®‰è£…<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æ–°å¢å‚æ•°ï¼š<!-- raw HTML omitted --><code>hostNetwork: true</code><!-- raw HTML omitted -->ï¼Œç”¨äºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å›½å†…ä¿®æ”¹ä¸ºé˜¿é‡Œäº‘åœ°å€ï¼š<!-- raw HTML omitted --><code>image: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6</code></li>
<li><!-- raw HTML omitted -->æ–°å¢å‚æ•°ï¼š<!-- raw HTML omitted --><code>- --kubelet-insecure-tls</code>ï¼Œä¸éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä»…ç”¨äºæµ‹è¯•ç›®çš„ï¼Œ<code>kubelet</code>çš„<code>10250</code>ç«¯å£ä½¿ç”¨çš„æ˜¯<code>https</code>åè®®ï¼Œè¿æ¥éœ€è¦éªŒè¯<code>tls</code>è¯ä¹¦</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml -O metrics-server.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›¿æ¢ä¸ºé˜¿é‡Œäº‘é•œåƒåœ°å€</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/k8s.io\/metrics-server/cn-hangzhou.aliyuncs.com\/google_containers/g&#39;</span> metrics-server.yaml</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>metrics-server.yaml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">k8s-app</span>: <span style="color:#ae81ff">metrics-server</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">metrics-server</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kube-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">k8s-app</span>: <span style="color:#ae81ff">metrics-server</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">k8s-app</span>: <span style="color:#ae81ff">metrics-server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">hostNetwork</span>: <span style="color:#66d9ef">true</span>   <span style="color:#75715e"># æ–°å¢å‚æ•°ï¼Œä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">args</span>:
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">cert-dir=/tmp</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">secure-port=4443</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">kubelet-use-node-status-port</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">metric-resolution=15s</span>
</span></span><span style="display:flex;"><span>        - --<span style="color:#ae81ff">kubelet-insecure-tls   </span> <span style="color:#75715e"># æ–°å¢å‚æ•°ï¼Œä¸æ ¡éªŒhttpsåè®®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server:v0.6.4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl apply -f metrics-server.yaml
</span></span><span style="display:flex;"><span>$ kubectl top node  --use-protocol-buffers
</span></span><span style="display:flex;"><span>$ kubectl top  pod/node  -n dev </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>kubectl port-forward --help</code><!-- raw HTML omitted -->è½¬å‘<code>Pod</code>ä¸­ç«¯å£<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl port-forward my-pod 5000:6000  	<span style="color:#75715e"># è½¬å‘podä¸­çš„6000ç«¯å£åˆ°æœ¬åœ°çš„ 5000 ç«¯å£</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ•…éšœæ’æŸ¥è§£å†³">æ•…éšœæ’æŸ¥ã€è§£å†³</h3>
<h5 id="nodesfont-colorredèŠ‚ç‚¹æ˜¾ç¤ºfontnotreadyfont-colorredæ˜¯èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œä¸é€šå¯¼è‡´font"><code>nodes</code><!-- raw HTML omitted -->èŠ‚ç‚¹æ˜¾ç¤º<!-- raw HTML omitted --><code>NotReady</code><!-- raw HTML omitted -->æ˜¯èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œä¸é€šå¯¼è‡´<!-- raw HTML omitted --></h5>
<blockquote>
<p><a href="#R-image-ad78a26c38fa93cebb75ca11c7521e18" class="lightbox-link"><img alt="get-nodes" class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407170459496.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ad78a26c38fa93cebb75ca11c7521e18"><img alt="get-nodes" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407170459496.png"></a></p>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get cs
</span></span><span style="display:flex;"><span>$ kubectl cluster-info
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨é•œåƒæµ‹è¯•å®¹å™¨å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ kubectl run -it --image busybox:1.28.4 container-name --restart<span style="color:#f92672">=</span>Never --rm /bin/sh
</span></span><span style="display:flex;"><span>$ ping pod-name.server-name</span></span></code></pre></div><p><a href="#R-image-4ca5ef8be50e0d5fd54bad5fe7372ca0" class="lightbox-link"><img alt="get-sc" class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407170643950.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4ca5ef8be50e0d5fd54bad5fe7372ca0"><img alt="get-sc" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407170643950.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å…ˆå¤„ç†ç½‘ç»œã€åå¤„ç†é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim  /etc/kubernetes/manifests/kube-controller-manager.yaml ï¼ˆæ³¨é‡Šæ‰ - --port<span style="color:#f92672">=</span>0ï¼‰
</span></span><span style="display:flex;"><span>$ vim  /etc/kubernetes/manifests/kube-scheduler.yaml          ï¼ˆæ³¨é‡Šæ‰ - --port<span style="color:#f92672">=</span>0ï¼‰
</span></span><span style="display:flex;"><span>$ systemctl start kubelet </span></span></code></pre></div><ul>
<li>2.1 <!-- raw HTML omitted -->å†æ¬¡æŸ¥çœ‹ï¼ŒèŠ‚ç‚¹æ­£å¸¸æ˜¾ç¤ºï¼šÂ <!-- raw HTML omitted --><code>Ready</code></li>
</ul>
<p><a href="#R-image-68713f21323c067e4299f933ad944024" class="lightbox-link"><img alt="get-cs-2" class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407170817379.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-68713f21323c067e4299f933ad944024"><img alt="get-cs-2" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407170817379.png"></a></p>
<p><a href="#R-image-1ff1e5d5543d1e97df2ef88f433448c6" class="lightbox-link"><img alt="get-nodes-2" class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407171343144.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1ff1e5d5543d1e97df2ef88f433448c6"><img alt="get-nodes-2" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://oss.linuxtxc.com/images/image-20220407171343144.png"></a></p>
</blockquote>
<hr>
<h5 id="é‡ç½®kubernetesé›†ç¾¤">é‡ç½®<code>Kubernetes</code>é›†ç¾¤</h5>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åœ¨masterã€nodeèŠ‚ç‚¹éƒ½æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ kubeadm reset 
</span></span><span style="display:flex;"><span>$ rm -rf /etc/cni/net.d
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨masterä¸Šæ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>$ kubeadm init --kubernetes-version<span style="color:#f92672">=</span>1.19.0 --apiserver-advertise-address<span style="color:#f92672">=</span>192.168.3.124 --service-cidr<span style="color:#f92672">=</span>10.64.0.0/24 --pod-network-cidr<span style="color:#f92672">=</span>10.244.0.0/16
</span></span><span style="display:flex;"><span>$ mkdir -p $HOME/.kube
</span></span><span style="display:flex;"><span>$ cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style="display:flex;"><span>$ chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config
</span></span><span style="display:flex;"><span>$ vim /etc/kubernetes/manifests/kube-controller-manager.yaml ï¼ˆæ³¨é‡Šæ‰ - --port<span style="color:#f92672">=</span>0ï¼‰
</span></span><span style="display:flex;"><span>$ vim /etc/kubernetes/manifests/kube-scheduler.yaml          ï¼ˆæ³¨é‡Šæ‰ - --port<span style="color:#f92672">=</span>0ï¼‰
</span></span><span style="display:flex;"><span>$ systemctl start kubelet 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨nodeèŠ‚ç‚¹æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>$ kubeadm reset
</span></span><span style="display:flex;"><span>$ kubeadm join 192.168.3.124:6443 --token f62e1g.exfdrr8bg2fxpdmu <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--discovery-token-ca-cert-hash sha256:7e4762cccce2e8306b6635cbc2091eae34bbf33577276413521a343c49fc026a</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_kubernetes">Install_Kubernetes</h1>

<h1 id="éƒ¨ç½²kubernetes">éƒ¨ç½²<code>Kubernetes</code></h1>
<blockquote>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li>
<p><code>Etcd</code><!-- raw HTML omitted -->ï¼šè´Ÿè´£å­˜å‚¨é›†ç¾¤ä¸­å„ç§èµ„æºå¯¹è±¡çš„ä¿¡æ¯<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Kubelet</code><!-- raw HTML omitted -->ï¼šè´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³é€šè¿‡æ§åˆ¶<!-- raw HTML omitted --><code>Docker</code><!-- raw HTML omitted -->ï¼Œæ¥åˆ›å»ºã€æ›´æ–°ã€é”€æ¯å®¹å™¨<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>KubeProxy</code><!-- raw HTML omitted -->ï¼šè´Ÿè´£æä¾›é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Docker</code><!-- raw HTML omitted -->ï¼šè´Ÿè´£èŠ‚ç‚¹ä¸Šå®¹å™¨çš„å„ç§æ“ä½œ<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Scheduler</code><!-- raw HTML omitted -->ï¼šè´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†<code>Pod</code>è°ƒåº¦åˆ°ç›¸åº”çš„<code>node</code>èŠ‚ç‚¹ä¸Š<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>API Server</code><!-- raw HTML omitted -->ï¼šé›†ç¾¤æ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæä¾›è®¤è¯ã€æˆæƒã€<code>API</code>æ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>ControllerManager</code><!-- raw HTML omitted -->ï¼šè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚ç¨‹åºéƒ¨ç½²å®‰æ’ã€æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•å’Œæ»šåŠ¨æ›´æ–°ç­‰<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Core DNS</code><!-- raw HTML omitted -->ï¼šå¯ä»¥ä¸ºé›†ç¾¤ä¸­çš„<code>SVC</code>åˆ›å»ºä¸€ä¸ªåŸŸå<code>IP</code>çš„å¯¹åº”å…³ç³»è§£æ<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Dashboard</code><!-- raw HTML omitted -->ï¼šç»™<code>K8S</code>é›†ç¾¤æä¾›ä¸€ä¸ª<code>B/S</code>ç»“æ„çš„ä½“ç³»è®¿é—®<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Ingress Controller</code><!-- raw HTML omitted -->ï¼šå®˜æ–¹åªèƒ½å®ç°å››å±‚ä»£ç†ï¼Œ<code>Ingress</code>å¯ä»¥å®ç°ä¸ƒå±‚ä»£ç†<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Fedetation</code><!-- raw HTML omitted -->ï¼šæä¾›ä¸€ä¸ªå¯ä»¥è·¨é›†ç¾¤ä¸­å¿ƒçš„å¤š<code>K8S</code>ç»Ÿä¸€ç®¡ç†åŠŸèƒ½<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Prometheus</code><!-- raw HTML omitted -->ï¼šæä¾›ä¸€ä¸ª<code>K8S</code>é›†ç¾¤ç›‘æ§èƒ½åŠ›<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>ELK</code><!-- raw HTML omitted -->ï¼šæä¾›<code>K8S</code>é›†ç¾¤æ—¥å¿—ç»Ÿä¸€åˆ†æä»‹å…¥å¹³å°<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>K8S</code>éƒ¨ç½²æ–¹å¼åˆ†ä¸º<!-- raw HTML omitted -->äºŒè¿›åˆ¶<!-- raw HTML omitted -->ä»¥åŠ<!-- raw HTML omitted -->å¿«é€Ÿéƒ¨ç½²<!-- raw HTML omitted -->æ–¹å¼ï¼Œå®˜æ–¹ç»™äºˆ<!-- raw HTML omitted -->ä¸‰ç§å¿«é€Ÿéƒ¨ç½²<!-- raw HTML omitted -->æ–¹å¼ï¼š<a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/" rel="external" target="_self">ä½¿ç”¨<code>kubeadm</code>å¼•å¯¼é›†ç¾¤</a>ã€<a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kops/" rel="external" target="_self">ä½¿ç”¨<code>Kops</code>å®‰è£…<code>Kubernetes</code></a>ã€<a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubespray/" rel="external" target="_self">ä½¿ç”¨<code>Kubespray</code>å®‰è£…<code>Kubernetes</code></a></p>
</li>
</ul>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/kubewharf" rel="external" target="_self"><code>KubeWharf</code>è½»é‡çº§å¤šç§Ÿæˆ·</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/kubernetes/perf-tests" rel="external" target="_self"><code>Kubernetes</code>æ€§èƒ½æµ‹è¯•</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://learnk8s.io/a/a-visual-guide-on-troubleshooting-kubernetes-deployments/troubleshooting-kubernetes.en_en.v3.pdf" rel="external" target="_self"><code>kubernetes</code>æ’é”™æ€ç»´</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://kubespray.io/#/docs/getting-started" rel="external" target="_self"><code>Ansible-playbook</code>ä½¿ç”¨<code>kubespray</code>å®‰è£…<code>K8S</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/easzlab/kubeasz" rel="external" target="_self"><code>kubeasz</code></a><!-- raw HTML omitted --><a href="https://www.cnblogs.com/evescn/p/16915701.html" rel="external" target="_self"><code>kubeasz</code>å®‰è£…<code>Kubernetes</code>é›†ç¾¤</a></td>
<td>**<code>kubeasz</code>**è‡´åŠ›äºæä¾›å¿«é€Ÿéƒ¨ç½²é«˜å¯ç”¨<code>k8s</code>é›†ç¾¤çš„å·¥å…·, åŒæ—¶ä¹ŸåŠªåŠ›æˆä¸º<code>k8s</code>å®è·µã€ä½¿ç”¨çš„å‚è€ƒä¹¦ï¼›åŸºäºäºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²å’Œåˆ©ç”¨<code>ansible-playbook</code>å®ç°è‡ªåŠ¨åŒ–ï¼›æ—¢æä¾›ä¸€é”®å®‰è£…è„šæœ¬, ä¹Ÿå¯ä»¥æ ¹æ®<code>å®‰è£…æŒ‡å—</code>åˆ†æ­¥æ‰§è¡Œå®‰è£…å„ä¸ªç»„ä»¶</td>
</tr>
<tr>
<td><a href="https://kubespray.io/#/" rel="external" target="_self"><code>kubespray</code></a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<h2 id="æœåŠ¡å™¨ç«¯å£å‡†å¤‡">æœåŠ¡å™¨ã€ç«¯å£å‡†å¤‡</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->éƒ¨ç½²ä¸€ä¸»ä¸‰ä»<!-- raw HTML omitted --><code>kubernetes</code>æ¶æ„</li>
</ol>
</li>
</ul>
<blockquote>

<pre class="mermaid align-center zoomable">graph TD
F[ä¸€ä¸»å¤šä»] 
A{{K8S-Master}} ==&gt; B{{K8S-Nodes}}
A{{K8S-Master}} ==&gt; C{{K8S-Nodes}}
A{{K8S-Master}} ==&gt; D{{K8S-Nodes}}
Z[å¤šä¸»å¤šä»]
G{{K8S-Master}} ==&gt; J{{K8S-Nodes}}
G{{K8S-Master}} ==&gt; K{{K8S-Nodes}}
G{{K8S-Master}} ==&gt; L{{K8S-Nodes}}
H{{K8S-Master}} ==&gt; J{{K8S-Nodes}}
H{{K8S-Master}} ==&gt; K{{K8S-Nodes}}
H{{K8S-Master}} ==&gt; L{{K8S-Nodes}} </pre><table>
<thead>
<tr>
<th>è§’è‰²</th>
<th><code>IP</code>åœ°å€</th>
<th>é…ç½®</th>
<th>æ“ä½œç³»ç»Ÿ</th>
</tr>
</thead>
<tbody>
<tr>
<td>Master</td>
<td>192.168.35.128</td>
<td><code>2coreã€4Gã€80Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
<tr>
<td>node-1</td>
<td>192.168.35.129</td>
<td><code>2coreã€1Gã€60Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
<tr>
<td>node-2</td>
<td>192.168.35.130</td>
<td><code>2coreã€1Gã€60Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->é›†ç¾¤æ¶æ„<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>è§’è‰²</th>
<th><code>IP</code>åœ°å€</th>
<th>é…ç½®</th>
<th>æ“ä½œç³»ç»Ÿ</th>
</tr>
</thead>
<tbody>
<tr>
<td>Master-1</td>
<td>192.168.80.210</td>
<td><code>2coreã€4Gã€80Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
<tr>
<td>Master-2</td>
<td>192.168.80.211</td>
<td><code>2coreã€4Gã€80Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
<tr>
<td>node-1</td>
<td>192.168.80.212</td>
<td><code>2coreã€2Gã€60Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
<tr>
<td>node-2</td>
<td>192.168.80.213</td>
<td><code>2coreã€2Gã€60Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
<tr>
<td>node-3</td>
<td>192.168.80.215</td>
<td><code>2coreã€2Gã€60Gdisk</code></td>
<td><code>CentOS Linux release 7.9.2</code></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->æ§åˆ¶èŠ‚ç‚¹<!-- raw HTML omitted --><code>master</code>ï¼šé›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­–ï¼Œä»¥åŠéœ€è¦å¼€æ”¾çš„ç«¯å£</li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åè®®</th>
<th>æ–¹å‘</th>
<th>ç«¯å£èŒƒå›´</th>
<th>ä½œç”¨</th>
<th>ä½¿ç”¨è€…</th>
</tr>
</thead>
<tbody>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>6443</td>
<td><code>Kubernetes API</code> æœåŠ¡å™¨</td>
<td>æ‰€æœ‰ç»„ä»¶,ç®¡ç†å‘˜æ“ä½œ<code>Kubernetes</code>çš„æ¥å£ã€‚å› æ­¤ï¼Œ<code>API</code>æœåŠ¡å™¨é€šå¸¸æš´éœ²åœ¨æ§åˆ¶å¹³é¢ä¹‹å¤–ã€‚<code>API</code>æœåŠ¡å™¨è¢«è®¾è®¡æˆå¯æ‰©å±•çš„ï¼Œå¯èƒ½å­˜åœ¨äºå¤šä¸ªæ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸Š</td>
</tr>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>2379-2380</td>
<td><code>etcd</code>æœåŠ¡å™¨å®¢æˆ·ç«¯ <code>API</code></td>
<td><code>kube-apiserver, etcd</code>ï¼ŒæŒä¹…åŒ–çš„å¤‡ä»½å­˜å‚¨ï¼Œå…³äºé›†ç¾¤çŠ¶æ€çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¿å­˜åœ¨è¿™é‡Œã€‚<code>Etcd</code>ä¸åº”è¯¥è¢«ç›´æ¥æ“ä½œï¼Œè€Œåº”è¯¥é€šè¿‡ <code>API</code> æœåŠ¡å™¨æ¥ç®¡ç†ã€‚</td>
</tr>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>10250</td>
<td><code>Kubelet API</code></td>
<td><code>kubelet</code>è‡ªèº«ã€åœ¨æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œä»¥åè°ƒå’ŒéªŒè¯<code>Pod</code>çš„æ‰§è¡Œ</td>
</tr>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>10259</td>
<td><code>kube-scheduler</code></td>
<td><code>kube-scheduler</code>è‡ªèº«ï¼Œè·Ÿè¸ªå·¥ä½œèŠ‚ç‚¹çš„çŠ¶æ€å¹¶å†³å®šåœ¨å“ªé‡Œè¿è¡Œ Podã€‚<code>Kube-scheduler</code> åªå¯ä»¥ç”±æ§åˆ¶å¹³é¢å†…çš„èŠ‚ç‚¹è®¿é—®ã€‚</td>
</tr>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>10257</td>
<td><code>kube-controller-manager</code></td>
<td><code>kube-controller-manager</code>è‡ªèº«ï¼Œç›‘è§†<code>Kubernetes</code>é›†ç¾¤ï¼Œä»¥æ£€æµ‹å’Œç»´æŠ¤<code>Kubernetes</code>ç¯å¢ƒçš„å‡ ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬å°†<code>Pod</code>åŠ å…¥åˆ°æœåŠ¡ä¸­ï¼Œä¿æŒä¸€ç»„<code>Pod</code>çš„æ­£ç¡®æ•°é‡ï¼Œå¹¶å¯¹èŠ‚ç‚¹çš„ä¸¢å¤±åšå‡ºååº”</td>
</tr>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>10258</td>
<td><code>Cloud controller manager</code></td>
<td>ä¸€ä¸ªç”¨äºåŸºäºäº‘çš„éƒ¨ç½²çš„å¯é€‰ç»„ä»¶ã€‚äº‘æ§åˆ¶å™¨ä¸äº‘æœåŠ¡æä¾›å•†æ¥å£ï¼Œä»¥ç®¡ç†é›†ç¾¤çš„è´Ÿè½½å‡è¡¡å™¨å’Œè™šæ‹Ÿç½‘ç»œ</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å·¥ä½œèŠ‚ç‚¹<!-- raw HTML omitted --><code>node</code>ï¼šé›†ç¾¤çš„æ•°æ®å¹³é¢ï¼Œè´Ÿè´£ä¸ºå®¹å™¨æä¾›è¿è¡Œç¯å¢ƒ ï¼Œéœ€è¦å¼€æ”¾çš„ç«¯å£</li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åè®®</th>
<th>æ–¹å‘</th>
<th>ç«¯å£èŒƒå›´</th>
<th>ä½œç”¨</th>
<th>ä½¿ç”¨è€…</th>
</tr>
</thead>
<tbody>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>10250</td>
<td><code>Kubelet API</code></td>
<td><code>kubelet</code>è‡ªèº«ã€æ§åˆ¶å¹³é¢ç»„ä»¶</td>
</tr>
<tr>
<td>TCP</td>
<td>å…¥ç«™</td>
<td>30000-32767</td>
<td><code>NodePort</code>æœåŠ¡â€ </td>
<td>æ‰€æœ‰ç»„ä»¶</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="åˆå§‹åŒ–ç¯å¢ƒ">åˆå§‹åŒ–ç¯å¢ƒ</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è®¾ç½®ä¸‰å°ä¸»æœºå<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-master-128
</span></span><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-node-01-129
</span></span><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-node-02-130</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è®¾ç½®é›†ç¾¤çš„ä¸»æœºå<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-master-1-80-210
</span></span><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-master-2-80-211
</span></span><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-node-1-80-212
</span></span><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-node-2-80-213
</span></span><span style="display:flex;"><span>$ hostnamectl set-hostname k8s-node-3-80-215</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ†åˆ«åœ¨ä¸‰å°æœåŠ¡å™¨åšæœ¬åœ°<!-- raw HTML omitted --><code>hosts</code><!-- raw HTML omitted -->è§£æ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;&gt;/etc/hosts<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.35.128 k8s-master-01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.35.129 k8s-node-01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.35.130 k8s-node-02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->äº”å°æœåŠ¡å™¨çš„é›†ç¾¤<!-- raw HTML omitted --><code>hosts</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;&gt;/etc/hosts<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.80.210 k8s-master-01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.80.211 k8s-master-02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.80.212 k8s-node-01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.80.213 k8s-node-02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.80.215 k8s-node-03
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.80.220 k8s-master-lb # VIP(è™šæ‹ŸIP)ç”¨äºLoadBalanceï¼Œå¦‚æœä¸æ˜¯é«˜å¯ç”¨é›†ç¾¤ï¼Œè¯¥IPå¯ä»¥æ˜¯k8s-master01çš„IP 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->è®¾ç½®æ—¶é—´åŒæ­¥ï¼Œä¿®æ”¹æ—¶åŒºä¸¤ç§æ–¹å¼<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>tzdata</code><!-- raw HTML omitted -->æ—¶åŒºè½¯ä»¶åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install tzdata 
</span></span><span style="display:flex;"><span>$ timedatectl set-timezone Asia/Shanghai</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¬¬ä¸€ç§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¬¬äºŒç§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl enable chronyd.service <span style="color:#f92672">&amp;&amp;</span> systemctl start chronyd.service</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å…³é—­é˜²ç«å¢™å¹¶ç¦æ­¢å¼€æœºè‡ªå¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl disable firewalld <span style="color:#f92672">&amp;&amp;</span> systemctl stop firewalld</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å…³é—­<!-- raw HTML omitted --><code>SElinux</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ setenforce <span style="color:#ae81ff">0</span>  	<span style="color:#75715e"># ä¸´æ—¶å…³é—­Selinux</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/^SELINUX=.*/SELINUX=disabled/&#39;</span> /etc/selinux/config  	<span style="color:#75715e"># æ°¸ä¹…å…³é—­Selinux</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->å…³é—­<!-- raw HTML omitted --><code>swap</code><!-- raw HTML omitted -->äº¤æ¢åˆ†åŒº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -ri <span style="color:#e6db74">&#39;s/.*swap.*/#&amp;/&#39;</span> /etc/fstab <span style="color:#f92672">&amp;&amp;</span> swapoff -a</span></span></code></pre></div><ul>
<li><code>Ubunt</code><!-- raw HTML omitted -->å…³é—­äº¤æ¢åˆ†åŒº<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;etc/fstab<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/dev/disk/by-uuid/95e38332-76fc-4d2f-81a4-04bc581f2ed3 none swap sw,noauto 0 0  	# æ·»åŠ ï¼šnoauto
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># /swap.img     none    swap    sw      0       0  	# æ·»åŠ æ³¨é‡Š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢éªŒè¯ï¼Œè¾“å‡ºä¸ºç©ºåˆ™ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>$ sudo swapon --show</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li>å…è®¸<code>iptables</code><!-- raw HTML omitted -->æ£€æŸ¥æ¡¥æ¥æµé‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç¡®ä¿<!-- raw HTML omitted --><code>br_netfilter</code><!-- raw HTML omitted -->æ¨¡å—è¢«åŠ è½½ã€‚è¿™ä¸€æ“ä½œå¯ä»¥é€šè¿‡è¿è¡Œ<!-- raw HTML omitted --><code>lsmod | grep br_netfilter</code><!-- raw HTML omitted -->æ¥å®Œæˆã€‚è‹¥è¦æ˜¾å¼åŠ è½½è¯¥æ¨¡å—ï¼Œå¯æ‰§è¡Œ<!-- raw HTML omitted --><code>modprobe br_netfilter</code></li>
<li><!-- raw HTML omitted -->ä¸ºäº†è®©ä½ çš„<!-- raw HTML omitted --><code>Linux</code><!-- raw HTML omitted -->èŠ‚ç‚¹ä¸Šçš„<!-- raw HTML omitted --><code>iptables</code><!-- raw HTML omitted -->èƒ½å¤Ÿæ­£ç¡®åœ°æŸ¥çœ‹æ¡¥æ¥æµé‡ï¼Œä½ éœ€è¦ç¡®ä¿åœ¨ä½ çš„<!-- raw HTML omitted --><code>sysctl</code><!-- raw HTML omitted -->é…ç½®ä¸­å°†<!-- raw HTML omitted --><code>net.bridge.bridge-nf-call-iptables</code><!-- raw HTML omitted -->è®¾ç½®ä¸º 1<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">br_netfilter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.ip_forward = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sysctl --system
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########################################################  ä½¿ç”¨è„šæœ¬å‡½æ•°</span>
</span></span><span style="display:flex;"><span>__k8s_kernel_iptables<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># åŠ è½½br_netfilteræ¨¡å—</span>
</span></span><span style="display:flex;"><span>    modprobe br_netfilter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æŸ¥çœ‹æ˜¯å¦åŠ è½½</span>
</span></span><span style="display:flex;"><span>    lsmod | grep br_netfilter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å†™å†…æ ¸é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    cat &gt;/etc/sysctl.d/k8s.conf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.ip_forward = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vm.swappiness = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å†…æ ¸å‚æ•°ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>    sysctl --system
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>__k8s_kernel_iptables</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="8">
<li><!-- raw HTML omitted -->å¼€å¯<!-- raw HTML omitted --><code>ipvs</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>åœ¨<code>kubernetes</code>ä¸­<code>service</code>æœ‰ä¸¤ç§ä»£ç†æ¨¡å‹ï¼Œä¸€ç§æ˜¯åŸºäº<code>iptables</code>ï¼Œå¦ä¸€ç§æ˜¯åŸºäº<code>ipvs</code>çš„ã€‚<code>ipvs</code>çš„æ€§èƒ½è¦é«˜äº<code>iptables</code>çš„ï¼Œä½†æ˜¯å¦‚æœè¦ä½¿ç”¨å®ƒï¼Œéœ€è¦æ‰‹åŠ¨è½½å…¥<code>ipvs</code>æ¨¡å—ã€‚</li>
<li><code>Centos</code><!-- raw HTML omitted -->ç³»ç»Ÿåœ¨æ¯ä¸ªèŠ‚ç‚¹å®‰è£…é…ç½®<!-- raw HTML omitted --><code>ipset</code>å’Œ<code>ipvsadm</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install ipset ipvsadm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œå¦‚ä¸‹è„šæœ¬</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/sysconfig/modules/ipvs.modules<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_rr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_wrr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- nf_conntrack_ipv4  	# é«˜ç‰ˆæœ¬æ›¿æ¢ä¸ºnf_conntrack
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆæƒã€è¿è¡Œã€æ£€æŸ¥æ˜¯å¦åŠ è½½</span>
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">755</span> /etc/sysconfig/modules/ipvs.modules <span style="color:#f92672">&amp;&amp;</span> bash /etc/sysconfig/modules/ipvs.modules
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥æ˜¯å¦åŠ è½½</span>
</span></span><span style="display:flex;"><span>$ lsmod | grep -e ipvs -e nf_conntrack_ipv4</span></span></code></pre></div><ul>
<li><code>Debian</code><!-- raw HTML omitted -->ç³»ç»Ÿåœ¨æ¯ä¸ªèŠ‚ç‚¹å®‰è£…é…ç½®<!-- raw HTML omitted --><code>ipset</code>å’Œ<code>ipvsadm</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -vp /etc/modules.d/
</span></span><span style="display:flex;"><span>$ tee /etc/modules.d/k8s.modules <span style="color:#e6db74">&lt;&lt;&#39;EOF&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># netfilter æ¨¡å— å…è®¸ iptables æ£€æŸ¥æ¡¥æ¥æµé‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- br_netfilter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># containerd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- overlay
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nf_conntrack
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- nf_conntrack
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ipvs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_lc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_lblc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_lblcr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_rr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_wrr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_dh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_fo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_nq
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_sed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_vs_ftp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_tables
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ip_set
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ipt_set
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ipt_rpfilter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ipt_REJECT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- ipip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">modprobe -- xt_set
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">755</span> /etc/modules.d/k8s.modules <span style="color:#f92672">&amp;&amp;</span> bash /etc/modules.d/k8s.modules <span style="color:#f92672">&amp;&amp;</span> lsmod | grep -e ip_vs -e nf_conntrack  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ip_vs_sh               16384  0  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ip_vs_wrr              16384  0  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ip_vs_rr               16384  0  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ip_vs                 155648  6 ip_vs_rr,ip_vs_sh,ip_vs_wrr  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nf_conntrack          139264  1 ip_vs  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nf_defrag_ipv6         24576  2 nf_conntrack,ip_vs  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nf_defrag_ipv4         16384  1 nf_conntrack  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># libcrc32c              16384  5 nf_conntrack,btrfs,xfs,raid456,ip_vs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sysctl --system</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="9">
<li><!-- raw HTML omitted -->æ‰€æœ‰èŠ‚ç‚¹é…ç½®<!-- raw HTML omitted --><code>Limit</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ulimit -SHn <span style="color:#ae81ff">65536</span>  	<span style="color:#75715e"># ä¸´æ—¶ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft nproc 65535  	# soft è½¯é™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nproc 65535  	# hard ç¡¬é™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft nofile 25535
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nofile 25535
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft memlock unlimited
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft memlock unlimited &#34;</span> &gt;&gt;/etc/security/limits.conf  	<span style="color:#75715e"># æ°¸ä¹…ç”Ÿæ•ˆ</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="10">
<li><code>k8s-master01</code><!-- raw HTML omitted -->èŠ‚ç‚¹è®¾ç½®å…å¯†ç™»å½•å…¶ä»–èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>ssh-keygen</code><!-- raw HTML omitted -->ï¼šç”¨äºåˆ›å»ºå¯†é’¥çš„ç¨‹åº<!-- raw HTML omitted --></li>
<li><code>-m PEM</code><!-- raw HTML omitted -->ï¼šå°†å¯†é’¥çš„æ ¼å¼è®¾ä¸º<!-- raw HTML omitted --><code>PEM</code></li>
<li><code>-t rsa</code><!-- raw HTML omitted -->ï¼šåˆ›å»ºå¯†é’¥ç±»å‹ä¸ºï¼š<code>RSA</code>æ ¼å¼ï¼Œç³»ç»Ÿé»˜è®¤æä¾›åä¸º <code>id_rsa</code> çš„å¯†é’¥å¯¹ï¼Œæœ‰äº›å·¥å…·å¯èƒ½è¦æ±‚ç§é’¥æ–‡ä»¶åä¸º<!-- raw HTML omitted --><code>id_rsa</code></li>
<li><code>-b 4096</code><!-- raw HTML omitted -->ï¼šå¯†é’¥çš„ä½æ•°ï¼Œæœ¬ä¾‹ä¸­ä¸º<!-- raw HTML omitted --><code>4096</code></li>
<li><code>-C &quot;xxx@myserver&quot;</code><!-- raw HTML omitted -->ï¼šè¿½åŠ åˆ°å…¬é’¥æ–‡ä»¶æœ«å°¾ä»¥ä¾¿äºè¯†åˆ«çš„æ³¨é‡Šã€‚ é€šå¸¸ä»¥ç”µå­é‚®ä»¶åœ°å€ç”¨ä½œæ³¨é‡Šï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•æœ€é€‚åˆä½ åŸºç¡€ç»“æ„çš„äº‹ç‰©<!-- raw HTML omitted --></li>
<li><code>-f ~/.ssh/</code><!-- raw HTML omitted -->ï¼šç§é’¥æ–‡ä»¶çš„æ–‡ä»¶åï¼ˆå¦‚æœé€‰æ‹©ä¸ä½¿ç”¨é»˜è®¤åç§°ï¼‰ã€‚ è¿½åŠ äº†<code>.pub</code>çš„ç›¸åº”å…¬é’¥æ–‡ä»¶åœ¨ç›¸åŒç›®å½•ä¸­ç”Ÿæˆã€‚ è¯¥ç›®å½•å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>-N mypassphrase</code><!-- raw HTML omitted -->ï¼šç”¨äºè®¿é—®ç§é’¥æ–‡ä»¶çš„å…¶ä»–å¯†ç <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ssh-keygen <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-m PEM <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-t rsa <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-b <span style="color:#ae81ff">4096</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-C <span style="color:#e6db74">&#34;xxx@163.com&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-f ~/.ssh/name_rsa <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-N mypassphrase
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#66d9ef">for</span> i in master-01 master-02 noder-01 noder-02 noder-03;<span style="color:#66d9ef">do</span> ssh-copy-id -i .ssh/id_rsa.pub $i;<span style="color:#66d9ef">done</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="11">
<li><!-- raw HTML omitted -->æ‰€æœ‰èŠ‚ç‚¹æ›´æ–°ç³»ç»Ÿå¹¶ä¸”é‡å¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y --exclude<span style="color:#f92672">=</span>kernel* update <span style="color:#f92672">&amp;&amp;</span> reboot</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="12">
<li><!-- raw HTML omitted -->å‡çº§ç³»ç»Ÿ<!-- raw HTML omitted --><code>Kernel</code>å†…æ ¸åˆ°<code>4.18+</code>ä»¥ä¸Š</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
</span></span><span style="display:flex;"><span>$ rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»¤åˆ—å‡ºå¯ç”¨çš„å†…æ ¸ç›¸å…³åŒ…</span>
</span></span><span style="display:flex;"><span>$ yum --disablerepo<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;*&#34;</span> --enablerepo<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;elrepo-kernel&#34;</span> list available
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…æœ€æ–°ä¸»çº¿ç¨³å®šå†…æ ¸</span>
</span></span><span style="display:flex;"><span>$ yum -y --enablerepo<span style="color:#f92672">=</span>elrepo-kernel install kernel-ml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½® GRUB é»˜è®¤çš„å†…æ ¸ç‰ˆæœ¬ï¼š</span>
</span></span><span style="display:flex;"><span>$ vim /etc/default/grub
</span></span><span style="display:flex;"><span>GRUB_DEFAULT<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>  	<span style="color:#75715e"># ä¿®æ”¹éƒ¨åˆ†ï¼Œ GRUB åˆå§‹åŒ–é¡µé¢çš„ç¬¬ä¸€ä¸ªå†…æ ¸å°†ä½œä¸ºé»˜è®¤å†…æ ¸</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°åˆ›å»ºå†…æ ¸é…ç½®</span>
</span></span><span style="display:flex;"><span>$ grub2-mkconfig -o /boot/grub2/grub.cfg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ reboot</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ‰€æœ‰èŠ‚ç‚¹éƒ½å®‰è£…docker">æ‰€æœ‰èŠ‚ç‚¹éƒ½å®‰è£…<code>docker</code></h3>
<ul>
<li>
<ol>
<li><code>yum</code><!-- raw HTML omitted -->æºçš„ä½¿ç”¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨å®˜æ–¹æº <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y yum-utils
</span></span><span style="display:flex;"><span>$ yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨é˜¿é‡Œäº‘å®˜æ–¹<code>repo</code>æº<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å¤‡ä»½æœåŠ¡å™¨ä¸ŠåŸæœ‰çš„CentOS-Baseå’Œepel</span>
</span></span><span style="display:flex;"><span>$ mv /etc/yum.repos.d/CentOS-Base.repo<span style="color:#f92672">{</span>,.bak<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$ mv /etc/yum.repos.d/epel.repo<span style="color:#f92672">{</span>,.bak<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…CentOS0-Baseå’Œepelæº </span>
</span></span><span style="display:flex;"><span>$ curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
</span></span><span style="display:flex;"><span>$ curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬ä¸€ç§æ–¹å¼å®‰è£…docker æº  </span>
</span></span><span style="display:flex;"><span>$ wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬äºŒç§æ–¹å¼dockeræº</span>
</span></span><span style="display:flex;"><span>$ yum install -y yum-utils device-mapper-persistent-data lvm2
</span></span><span style="display:flex;"><span>$ yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åšæ›¿æ¢</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s+download.docker.com+mirrors.aliyun.com/docker-ce+&#39;</span> /etc/yum.repos.d/docker-ce.repo</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¸è½½æœåŠ¡å™¨è‡ªå¸¦<!-- raw HTML omitted --><code>docker</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å®‰è£…å¯¹åº”<code>docker</code>ç‰ˆæœ¬æœåŠ¡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum makecache fast
</span></span><span style="display:flex;"><span>$ yum list docker-ce  --showduplicates|sort -r
</span></span><span style="display:flex;"><span>$ yum install -y docker-ce-20.10.4 docker-ce-cli-20.10.4 containerd.io docker-compose-plugin
</span></span><span style="display:flex;"><span>$ systemctl enable docker <span style="color:#f92672">&amp;&amp;</span> systemctl start docker</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>docker-compose</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo curl -L <span style="color:#e6db74">&#34;https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-</span><span style="color:#66d9ef">$(</span>uname -s<span style="color:#66d9ef">)</span><span style="color:#e6db74">-</span><span style="color:#66d9ef">$(</span>uname -m<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> -o /usr/local/bin/docker-compose
</span></span><span style="display:flex;"><span>$ chmod +x /usr/local/bin/docker-compose
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
</span></span><span style="display:flex;"><span>$ docker compose COMMAND --help  	<span style="color:#75715e"># æŸ¥çœ‹é•œåƒç¼–å†™æ–¹å¼</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><code>Kubernetes</code><!-- raw HTML omitted -->æ–‡ä»¶é©±åŠ¨é»˜è®¤ç”±<!-- raw HTML omitted --><code>systemd</code><!-- raw HTML omitted -->æ”¹æˆ<!-- raw HTML omitted --><code>cgroupfs</code><!-- raw HTML omitted -->, è€Œæˆ‘ä»¬å®‰è£…çš„<!-- raw HTML omitted --><code>docker</code><!-- raw HTML omitted -->ä½¿ç”¨çš„æ–‡ä»¶é©±åŠ¨æ˜¯<!-- raw HTML omitted --><code>systemd</code><!-- raw HTML omitted -->, é€ æˆä¸ä¸€è‡´, å¯¼è‡´é•œåƒæ— æ³•å¯åŠ¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>&quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;/etc/docker/daemon.json<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;registry-mirrors&#34;: [&#34;https://bn4ll166.mirror.aliyuncs.com&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;data-root&#34;: &#34;/data/docker-root&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;dns&#34;: [&#34;223.5.5.5&#34;,&#34;119.29.29.29&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;bip&#34;: &#34;172.31.255.254/16&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;storage-driver&#34;: &#34;overlay2&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;storage-opts&#34;: [&#34;overlay2.override_kernel_check=true&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;userland-proxy&#34;: false,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;log-driver&#34;: &#34;json-file&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;log-opts&#34;: {&#34;max-size&#34;: &#34;500m&#34;,&#34;max-file&#34;: &#34;1&#34;},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &#34;live-restore&#34;: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><a href="https://www.qikqiak.com/k8s-book/docs/1.%E8%AF%BE%E7%A8%8B%E4%BB%8B%E7%BB%8D.html" rel="external" target="_self"><code>Docker</code>+<code>Kubernetes</code></a></li>
</ol>
</li>
</ul>
<hr>
<h3 id="æ‰€æœ‰èŠ‚ç‚¹é…ç½®kubernetes-yumæº">æ‰€æœ‰èŠ‚ç‚¹é…ç½®<code>kubernetes yum</code>æº</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å›½å†…ä¿®æ”¹ä¸ºé˜¿é‡Œäº‘<code>yum</code>æº <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/yum.repos.d/kubernetes.repo<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[kubernetes]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name=Kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">repo_gpgcheck=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç›´æ¥ä½¿ç”¨<code>kubernetes</code>å®˜æ–¹<code>yum</code>æº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;-EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[kubernetes]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name=Kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">exclude=kubelet kubeadm kubectl
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->é‡å¯æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ reboot</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ‰€æœ‰èŠ‚ç‚¹éƒ½å®‰è£…kubeadmkubeletkubectl">æ‰€æœ‰èŠ‚ç‚¹éƒ½å®‰è£…<code>kubeadmã€kubeletã€kubectl</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum list kubelet kubeadm kubectl  --showduplicates | sort -r
</span></span><span style="display:flex;"><span>$ yum -y install kubelet-1.24.5 kubeadm-1.24.5 kubectl-1.24.5</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><code>--cgroup-driver=systemd</code><!-- raw HTML omitted -->ï¼šä¸ºäº†å®ç°<!-- raw HTML omitted --><code>Docker</code><!-- raw HTML omitted -->ä½¿ç”¨çš„<!-- raw HTML omitted --><code>cgroup drvier</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>kubelet</code><!-- raw HTML omitted -->ä½¿ç”¨çš„<!-- raw HTML omitted --><code>cgroup</code><!-- raw HTML omitted -->é»˜è®¤å€¼ä¸ºä¸€è‡´ï¼Œ<!-- raw HTML omitted --><code>/etc/sysconfig/kubelet</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸­æ·»åŠ <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>--fail-swap-on=false</code><!-- raw HTML omitted -->å¿½ç•¥<code>swap</code>æŠ¥é”™<!-- raw HTML omitted --></li>
<li><code>--feature-gates EphemeralContainers=true</code><!-- raw HTML omitted -->å¼€å¯ä¸´æ—¶å®¹å™¨å‚æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubelet -h | grep EphemeralContainers</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/sysconfig/kubelet<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBELET_EXTRA_ARGS=&#34;--cgroup-driver=systemd --fail-swap-on=false&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBE_PROXY_MODE=&#34;ipvs&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨å³å¯ï¼Œç”±äºæ²¡æœ‰ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œé›†ç¾¤åˆå§‹åŒ–åè‡ªåŠ¨å¯åŠ¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl enable kubelet <span style="color:#f92672">&amp;&amp;</span> systemctl start kubelet</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ä½¿ç”¨kubeadméƒ¨ç½²kubernetes">ä½¿ç”¨<code>Kubeadm</code>éƒ¨ç½²<code>Kubernetes</code></h2>
<h3 id="æŸ¥çœ‹ä¸‹è½½æ‰€éœ€é•œåƒ">æŸ¥çœ‹ä¸‹è½½æ‰€éœ€é•œåƒ</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>k8s</code><!-- raw HTML omitted -->æ‰€éœ€é•œåƒ<!-- raw HTML omitted --><code>kubeadm config images list</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm config images list   <span style="color:#75715e"># listæ›¿æ¢ï¼špullã€æ‹‰å–é•œåƒ</span>
</span></span><span style="display:flex;"><span>k8s.gcr.io/kube-apiserver:v1.24.6
</span></span><span style="display:flex;"><span>k8s.gcr.io/kube-controller-manager:v1.24.6
</span></span><span style="display:flex;"><span>k8s.gcr.io/kube-scheduler:v1.24.6
</span></span><span style="display:flex;"><span>k8s.gcr.io/kube-proxy:v1.24.6
</span></span><span style="display:flex;"><span>k8s.gcr.io/pause:3.7
</span></span><span style="display:flex;"><span>k8s.gcr.io/etcd:3.5.3-0
</span></span><span style="display:flex;"><span>k8s.gcr.io/coredns/coredns:v1.8.6
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker images --digests  	<span style="color:#75715e"># éªŒè¯é•œåƒå®Œæ•´æ€§</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¸‹è½½<code>K8S</code>æ‰€éœ€é•œåƒ (å¦‚æœè¿‡ç¨‹ä¸­æœ‰æç¤ºå¤±è´¥è¿¹è±¡, é‚£ä¹ˆå¯èƒ½æ˜¯ç½‘ç»œåŸå› , å¤šæ‰§è¡Œå‡ æ¬¡)<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm config images list | xargs -n1 docker pull  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šæ‹‰å–é˜¿é‡Œäº‘æºçš„é•œåƒ  </span>
</span></span><span style="display:flex;"><span>$ kubeadm config images pull --kubernetes-version<span style="color:#f92672">=</span>v1.20.2 --image-repository<span style="color:#f92672">=</span>registry.aliyuncs.com/google_containers  </span></span></code></pre></div></blockquote>
<hr>
<h3 id="éƒ¨ç½²masterèŠ‚ç‚¹">éƒ¨ç½²<code>master</code>èŠ‚ç‚¹</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸¤ç§æ–¹å¼éƒ¨ç½²<!-- raw HTML omitted --><code>Master</code>èŠ‚ç‚¹ï¼š<strong>å‘½ä»¤è¡Œ</strong>å’Œ**<code>yaml</code>**</li>
<li><!-- raw HTML omitted -->**æ³¨æ„ï¼š**ä¸»æœºåä¸­ä¸èƒ½å¸¦æœ‰_ï¼ˆä¸‹åˆ’çº¿ï¼‰ï¼Œä¸ç„¶åˆå§‹åŒ–ä¼šæŠ¥é”™<!-- raw HTML omitted --><a href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/" rel="external" target="_self"><code>kubeadm init</code></a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼åˆå§‹åŒ–<!-- raw HTML omitted --><code>Kubernetes</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>--kubernetes-version</code>ï¼šæŒ‡å®šç‰ˆæœ¬</li>
<li><code>--apiserver-advertise-address</code>ï¼š<code>master</code>æœ¬æœº<code>IP</code></li>
<li><code>--service-cidr</code>ï¼š<!-- raw HTML omitted -->ç”¨äºæŒ‡å®šä¸º<code>Service</code>åˆ†é…ä½¿ç”¨ç½‘ç»œåœ°å€ï¼Œå®ƒç”±<code>kubernetes</code>ç®¡ç†ï¼Œé»˜è®¤ç½‘æ®µï¼š<code>10.96.0.0/12</code><!-- raw HTML omitted --></li>
<li><code>--pod-network-cidr</code>ï¼š<!-- raw HTML omitted -->å¯åŠ¨å®¹å™¨ç»™å®¹å™¨æ‰€åˆ†é…<code>IP</code>ï¼Œ<code>ip a</code>å¯ä»¥æŸ¥çœ‹æœåŠ¡å™¨æœ¬æœºç”Ÿæˆ<code>IP</code>æ®µï¼Œå½“æœ‰ä»é›†ç¾¤å¤–èŠ‚ç‚¹é€šè¿‡é™æ€è·¯ç”±æ–¹å¼è®¿é—®é›†ç¾¤å†…<code>Service</code>çš„éœ€æ±‚æ—¶ï¼Œéœ€è¦åœ¨åˆ›å»ºé›†ç¾¤æ—¶æŒ‡å®š<code>pod-network-cidr</code>ï¼Œ ä»¥å¯¹æ¥è‡ªé<code>Pod</code>ç½‘ç»œçš„æµé‡(å¤–éƒ¨æµé‡)æ‰§è¡Œ<code>MASQ</code>ï¼Œå¤–éƒ¨è®¿é—®podæœåŠ¡åš<code>nat</code>è½¬å‘,å®ƒé€šå¸¸åº”è¯¥ä¸éƒ¨ç½²ä½¿ç”¨çš„ç½‘ç»œæ’ä»¶(ä¾‹å¦‚ï¼š<code>flannel</code>ã€<code>calico</code>)é»˜è®¤è®¾å®šä¿æŒä¸€è‡´ï¼Œ<code>10.244.0.0/16</code>æ˜¯<code>flannel</code>é»˜è®¤ä½¿ç”¨ç½‘ç»œ<!-- raw HTML omitted --></li>
<li><code>--ignore-preflight-errors=Swap</code>ï¼š<!-- raw HTML omitted -->é€šè¿‡æ­¤å‚æ•°å¿½ç•¥swapæŠ¥é”™<!-- raw HTML omitted --></li>
<li><code>--image-repository registry.aliyuncs.com/google_containers</code>ï¼š<!-- raw HTML omitted -->æŒ‡å®šä»é˜¿é‡Œäº‘ä¸‹è½½<!-- raw HTML omitted --></li>
<li><code>--cri-socket</code>ï¼š<!-- raw HTML omitted -->é…ç½®<code>CRI</code>ç«¯ç‚¹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm init --kubernetes-version<span style="color:#f92672">=</span>v1.24.6 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--apiserver-advertise-address<span style="color:#f92672">=</span>192.168.35.128 --node-name<span style="color:#f92672">=</span>k8s-master <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--service-cidr<span style="color:#f92672">=</span>10.64.0.0/12 --pod-network-cidr<span style="color:#f92672">=</span>10.244.0.0/16 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--cri-socket unix:///var/run/containerd/containerd.sock  	<span style="color:#75715e"># é…ç½® CRI ç«¯ç‚¹</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é€šè¿‡é…ç½®æ–‡ä»¶åˆå§‹åŒ–<!-- raw HTML omitted --><code>Kubernetes</code>çš„<code>master</code>èŠ‚ç‚¹</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¾“å‡ºåˆå§‹åŒ–é…ç½®åˆ°æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ kubeadm config print init-defaults &gt;/opt/k8s/yaml/kubeadm-config.yaml
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>apiVersion: kubeadm.k8s.io/v1beta3
</span></span><span style="display:flex;"><span>bootstrapTokens:
</span></span><span style="display:flex;"><span>- groups:
</span></span><span style="display:flex;"><span>    - system:bootstrappers:kubeadm:default-node-token
</span></span><span style="display:flex;"><span>    token: abcdef.0123456789abcdef
</span></span><span style="display:flex;"><span>    ttl: 24h0m0s
</span></span><span style="display:flex;"><span>    usages:
</span></span><span style="display:flex;"><span>    - signing
</span></span><span style="display:flex;"><span>    - authentication
</span></span><span style="display:flex;"><span>kind: InitConfiguration
</span></span><span style="display:flex;"><span>localAPIEndpoint:
</span></span><span style="display:flex;"><span>    advertiseAddress: 1.2.3.4  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºmasteræœ¬æœºIP</span>
</span></span><span style="display:flex;"><span>    bindPort: <span style="color:#ae81ff">6443</span>  	<span style="color:#75715e"># ä½¿ç”¨ç«¯å£</span>
</span></span><span style="display:flex;"><span>nodeRegistration:
</span></span><span style="display:flex;"><span>    criSocket: unix:///var/run/containerd/containerd.sock  	<span style="color:#75715e"># é…ç½® CRI ç«¯ç‚¹</span>
</span></span><span style="display:flex;"><span>    imagePullPolicy: IfNotPresent
</span></span><span style="display:flex;"><span>    name: node  	<span style="color:#75715e"># é…ç½®ä¸»æœºåï¼Œ ä¸»æœºåä¸å…è®¸ä½¿ç”¨ä¸‹åˆ’çº¿</span>
</span></span><span style="display:flex;"><span>    taints: null
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>apiServer:
</span></span><span style="display:flex;"><span>    timeoutForControlPlane: 4m0s
</span></span><span style="display:flex;"><span>apiVersion: kubeadm.k8s.io/v1beta3
</span></span><span style="display:flex;"><span>certificatesDir: /etc/kubernetes/pki
</span></span><span style="display:flex;"><span>clusterName: kubernetes
</span></span><span style="display:flex;"><span>controllerManager: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>dns: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>etcd:
</span></span><span style="display:flex;"><span>    local:
</span></span><span style="display:flex;"><span>        dataDir: /var/lib/etcd
</span></span><span style="display:flex;"><span>imageRepository: k8s.gcr.io  	<span style="color:#75715e"># å®šä¹‰ä½¿ç”¨é•œåƒæº</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## imageRepository: registry.aliyuncs.com/google_containers  	# é˜¿é‡Œäº‘é•œåƒæº</span>
</span></span><span style="display:flex;"><span>kind: ClusterConfiguration
</span></span><span style="display:flex;"><span>kubernetesVersion: 1.24.6  	<span style="color:#75715e"># å®šä¹‰kubernetesç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>networking:
</span></span><span style="display:flex;"><span>    dnsDomain: cluster.local
</span></span><span style="display:flex;"><span>    serviceSubnet: 10.96.0.0/12  	<span style="color:#75715e"># 10.244.0.0/16 æ˜¯`flannel`é»˜è®¤ä½¿ç”¨ç½‘ç»œ</span>
</span></span><span style="display:flex;"><span>scheduler: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span><span style="display:flex;"><span>kind: KubeProxyConfiguration
</span></span><span style="display:flex;"><span>featureGates:
</span></span><span style="display:flex;"><span>    SupportIPVSProxyMode: true
</span></span><span style="display:flex;"><span>mode: ipvs  	<span style="color:#75715e"># å¯ç”¨ipvs  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubeadm init --config<span style="color:#f92672">=</span>/opt/k8s/yaml/kubeadm-config.yaml  	<span style="color:#75715e"># åˆå§‹åŒ–é…ç½®æ–‡ä»¶</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¦‚æœåˆå§‹åŒ–æŠ¥é”™æ‰§è¡Œä¸‹é¢å‘½ä»¤ã€ç„¶åé‡æ–°åˆå§‹åŒ–<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">############################################################# 	 é…ç½®containerdæœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ rm -rf /etc/containerd/config.toml
</span></span><span style="display:flex;"><span>$ containerd config default &gt;/etc/containerd/config.toml  	<span style="color:#75715e"># ç”Ÿæˆæ–°é…ç½®æ¥è¦†ç›–é»˜è®¤é…ç½®</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;&gt;/etc/containerd/config.toml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[plugins.&#34;io.containerd.grpc.v1.cri&#34;.containerd.runtimes.runc.options]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> SystemdCgroup = false  	# ä¿®æ”¹ä¸ºï¼štrue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>$ systemctl restart containerd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#############################################################  	kubelet é…ç½®æ–‡ä»¶ä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;&gt;/var/lib/kubelet/kubeadm-flags.env<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBELET_KUBEADM_ARGS=&#34;--container-runtime-endpoint=unix:///var/run/containerd/containerd.sock --pod-infra-container-image=registry.k8s.io/pause:3.9&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨é…ç½®å¢åŠ --container-runtime=remote --container-runtime-endpoint=unix:///var/run/containerd/containerd.sock</span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;&gt;/usr/lib/systemd/system/kubelet.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/usr/bin/kubelet --container-runtime=remote --container-runtime-endpoint=unix:///var/run/containerd/containerd.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">############################################################## 	 åˆ é™¤é…ç½®é‡è½½</span>
</span></span><span style="display:flex;"><span>$ swapoff -a <span style="color:#f92672">&amp;&amp;</span> kubeadm reset <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	<span style="color:#f92672">&amp;&amp;</span> systemctl daemon-reload <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	<span style="color:#f92672">&amp;&amp;</span> systemctl restart kubelet <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	<span style="color:#f92672">&amp;&amp;</span> iptables -F <span style="color:#f92672">&amp;&amp;</span> iptables -t nat -F <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	<span style="color:#f92672">&amp;&amp;</span> iptables -t mangle -F <span style="color:#f92672">&amp;&amp;</span> iptables -X</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æŸ¥çœ‹<code>node</code>ä¿¡æ¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get nodes
</span></span><span style="display:flex;"><span>NAME         STATUS   ROLES                  AGE   VERSION
</span></span><span style="display:flex;"><span>k8s-master   Ready    control-plane,master   23h   v1.21.12
</span></span><span style="display:flex;"><span>k8s-node1    Ready    &lt;none&gt;                 23h   v1.21.12
</span></span><span style="display:flex;"><span>k8s-node2    Ready    &lt;none&gt;                 23h   v1.21.12</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->æ ¹æ®æç¤ºæ¶ˆæ¯ï¼Œåœ¨<code>Master</code>èŠ‚ç‚¹ä¸Šä½¿ç”¨<code>kubectl</code>å·¥å…·ï¼Œå¯ä»¥æŠŠä¸‹åˆ—<code>.kube</code>ç›®å½•åŒæ­¥åˆ°<code>node</code>èŠ‚ç‚¹ï¼Œä»¥ä¾¿<code>node</code>èŠ‚ç‚¹ä½¿ç”¨<code>kubectl</code>å·¥å…·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><strong>æ³¨æ„ï¼š</strong><!-- raw HTML omitted -->å¦‚æœä¸æ‰§è¡Œ<!-- raw HTML omitted -->ä»¥ä¸‹å‘½ä»¤<!-- raw HTML omitted -->ï¼Œæ‰§è¡Œ<code>kubectl get nodes</code>å‘½ä»¤æŠ¥é”™ï¼š<code>couldn't get current server API group list: Get &quot;http://localhost:8080/api?timeout=32s&quot;: dial tcp [::1]:8080: connect: connection refused</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p $HOME/.kube
</span></span><span style="display:flex;"><span>$ cp -i /etc/kubernetes/admin.conf <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/config
</span></span><span style="display:flex;"><span>$ chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/config
</span></span><span style="display:flex;"><span>$ scp -r /root/.kube root@k8s-node-01:/root/</span></span></code></pre></div></blockquote>
<hr>
<h3 id="nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤"><code>node</code>èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å½“ä¸»èŠ‚ç‚¹å¯åŠ¨å®Œ<code>k8s</code>ä¹‹åä¼šç”ŸæˆåŠ å…¥èŠ‚ç‚¹çš„å‘½ä»¤ï¼Œè§†è‡ªå·±æœåŠ¡å™¨è€Œå®š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm join 192.168.35.128:6443 --token l37r7y.75gjs1ltufdp8kp2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	--discovery-token-ca-cert-hash sha256:9ebc670ec3f97b5f42d77908f378786ed806ef22e9ae2cf21fe5fb239483833c</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é»˜è®¤<code>token</code>æœ‰æ•ˆæœŸä¸º24å°æ—¶ï¼Œå½“è¿‡æœŸä¹‹åï¼Œè¯¥<code>token</code>å°±ä¸å¯ç”¨äº†ã€‚è¿™æ—¶å°±éœ€è¦é‡æ–°åˆ›å»º<code>token</code>ï¼Œæ“ä½œå¦‚ä¸‹ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm token list  	<span style="color:#75715e"># æŸ¥çœ‹Token</span>
</span></span><span style="display:flex;"><span>$ kubeadm token create --print-join-command
</span></span><span style="display:flex;"><span>$ kubeadm token create --ttl <span style="color:#ae81ff">0</span> --print-join-command  <span style="color:#75715e"># ç”Ÿæˆä¸€ä¸ªæ°¸ä¸è¿‡æœŸçš„token</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°è·å–sha56key</span>
</span></span><span style="display:flex;"><span>$ openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outfrom der 2&gt;dev/null | openssl dgst -sha256 -hex | sed <span style="color:#e6db74">&#39;s/^.* //&#39;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>master</code><!-- raw HTML omitted -->æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹æ˜¯å¦å·²åŠ å…¥<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get componentstatuses  	<span style="color:#75715e"># æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µï¼Œç¼©å†™ä¸ºï¼šcs</span>
</span></span><span style="display:flex;"><span>NAME                 STATUS    MESSAGE             ERROR
</span></span><span style="display:flex;"><span>scheduler            Healthy   ok                  
</span></span><span style="display:flex;"><span>controller-manager   Healthy   ok                  
</span></span><span style="display:flex;"><span>etcd-0               Healthy   <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;health&#34;</span>:<span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æŸ¥çœ‹éƒ¨ç½²å¥½çš„å‘½åç©ºé—´<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>default</code><!-- raw HTML omitted -->ï¼šæ‰€æœ‰æœªæŒ‡å®šçš„<code>Namespace</code>çš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åœ¨defaultå‘½åç©ºé—´<!-- raw HTML omitted --></li>
<li><code>kube-node-lease</code><!-- raw HTML omitted -->ï¼šé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„å¿ƒè·³ç»´æŠ¤ï¼Œ<code>v1.13</code>å¼€å§‹å¼•å…¥<!-- raw HTML omitted --></li>
<li><code>kube-public</code><!-- raw HTML omitted -->ï¼šæ­¤å‘½åç©ºé—´çš„èµ„æºå¯ä»¥è¢«æ‰€æœ‰äººè®¿é—®ï¼ˆåŒ…æ‹¬æœªè®¤è¯ç”¨æˆ·ï¼‰<!-- raw HTML omitted --></li>
<li><code>kube-system</code><!-- raw HTML omitted -->ï¼šæ‰€æœ‰ç”±<code>kubernetes</code>ç³»ç»Ÿåˆ›å»ºçš„èµ„æºéƒ½å¤„äºè¿™ä¸ªå‘½åç©ºé—´<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get namespace  <span style="color:#75715e"># ç¼©å†™ä¸ºï¼š ns</span>
</span></span><span style="display:flex;"><span>NAME              STATUS   AGE 
</span></span><span style="display:flex;"><span>default           Active   19h
</span></span><span style="display:flex;"><span>kube-node-lease   Active   19h
</span></span><span style="display:flex;"><span>kube-public       Active   19h
</span></span><span style="display:flex;"><span>kube-system       Active   19h</span></span></code></pre></div></blockquote>
<hr>
<h4 id="å¤„ç†é›†ç¾¤çŠ¶æ€statusnotreadyfont-colorredæ˜¯ç½‘ç»œä¸é€šéƒ¨ç½²fontcnifont-colorredç½‘ç»œæ’ä»¶font">å¤„ç†é›†ç¾¤çŠ¶æ€ï¼š<code>STATUSï¼šNotReady</code><!-- raw HTML omitted -->æ˜¯ç½‘ç»œä¸é€šéƒ¨ç½²ï¼š<!-- raw HTML omitted --><code>CNI</code><!-- raw HTML omitted -->ç½‘ç»œæ’ä»¶<!-- raw HTML omitted --></h4>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://segmentfault.com/a/1190000018698263" rel="external" target="_self">ç½‘ç»œï¼š<code>Flannel</code>ã€<code>Calico</code>ã€<code>Canal</code>å’Œ<code>Weave</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://dockone.io/article/10501" rel="external" target="_self">ç®€å•èŠèŠ<code>Calico</code>ä¸<code>Flannel</code></a></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>kubernetes</code><!-- raw HTML omitted -->æ”¯æŒå¤šç§ç½‘ç»œæ’ä»¶ï¼Œæ¯”å¦‚<!-- raw HTML omitted --><code>flannel</code>ã€<code>calico</code>ã€<code>canal</code><!-- raw HTML omitted -->ç­‰ï¼Œä»»é€‰ä¸€ç§å³å¯ï¼Œæœ¬æ¬¡é€‰æ‹©<!-- raw HTML omitted --><code>flannel</code><!-- raw HTML omitted -->ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å®‰è£…<!-- raw HTML omitted --><code>calico</code><!-- raw HTML omitted -->ï¼Œæ¨èå®‰è£…<!-- raw HTML omitted --><code>calico</code></li>
<li><!-- raw HTML omitted -->åœ¨<code>Master</code>èŠ‚ç‚¹ä¸Šè·å–<code>flannel</code>é…ç½®æ–‡ä»¶(å¯èƒ½ä¼šå¤±è´¥ï¼Œå¦‚æœå¤±è´¥ï¼Œè¯·ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åå®‰è£…)ï¼š<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><code>flannelã€calico</code><!-- raw HTML omitted -->ï¼šåŸºäºéš§é“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>éš§é“æ–¹æ¡ˆæœ€å…·æ™®é€‚æ€§ï¼Œåœ¨ä»»ä½•ç½‘ç»œç¯å¢ƒä¸‹éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œè¿™ä¸å®ƒçš„åŸç†å¯†ä¸å¯åˆ†ã€‚</li>
<li>æœ€å¸¸è§çš„éš§é“æ–¹æ¡ˆæ˜¯<code>flannel &quot;Type&quot;: &quot;vxlan&quot;</code>æ¨¡å¼ï¼Œä»¥åŠ<code>calico</code>çš„<code>ipip</code>æ¨¡å¼ï¼Œ</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>flannelã€calico</code><!-- raw HTML omitted -->ï¼šåŸºäºè·¯ç”±<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>è·¯ç”±æ–¹æ¡ˆæ€§èƒ½æœ€å¥½ï¼ŒåŸå› æ˜¯è¯¥æ–¹æ¡ˆä¸éœ€è¦å°åŒ…å’Œè§£åŒ…ï¼Œæ‰€ä»¥æ²¡æœ‰éš§é“æ–¹æ¡ˆçš„åŠ£åŠ¿ï¼Œç½‘ç»œæ€§èƒ½å¾ˆå¥½ã€‚</li>
<li>å¸¸è§çš„è·¯ç”±æ–¹æ¡ˆåŒ…æ‹¬äº†<code>flannel</code>çš„<code>&quot;Type&quot;: &quot;host-gw&quot;</code>æ¨¡å¼ï¼Œä»¥åŠ<code>calico</code>çš„<code>bgp</code>æ¨¡å¼ã€‚</li>
<li><code>master</code><!-- raw HTML omitted -->èŠ‚ç‚¹æ‰§è¡Œä¸€ä¸‹è¯­å¥å®‰è£…<!-- raw HTML omitted --><code>calico</code><!-- raw HTML omitted -->ç½‘ç»œæ’ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/calico.yaml -O
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># çœ‹æƒ…å†µä¿®æ”¹ calicoé…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;calico.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name: CALICO_IPV4POOL_CIDR  	# ä¿®æ”¹ CALICO_IPV4POOL_CIDRå¯¹åº”çš„å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  value: &#34;192.168.1.0/24&#34;  	# ä¿®æ”¹ä¸º --pod-network-cidr å¯¹åº”çš„ç½‘æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹calico é•œåƒåœ°å€</span>
</span></span><span style="display:flex;"><span>$ grep image calico.yaml
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s#docker.io/##g&#39;</span> calico.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f calico.yaml</span></span></code></pre></div><ul>
<li><code>master</code><!-- raw HTML omitted -->èŠ‚ç‚¹æ‰§è¡Œä¸€ä¸‹è¯­å¥å®‰è£…<code>flannel</code>ç½‘ç»œæ’ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /opt/k8s/yaml/ https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</span></span><span style="display:flex;"><span>$ kubectl get pods -n kube-system</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>kubernetes</code><!-- raw HTML omitted -->ä¸­<code>kubectl</code>å‘½ä»¤è‡ªåŠ¨è¡¥å…¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y bash-completion
</span></span><span style="display:flex;"><span>$ source /etc/profile.d/bash_completion.sh</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->é›†ç¾¤ä¸å¥åº·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->éœ€è¦æ³¨é‡Šæ‰<!-- raw HTML omitted --><code>etc/kubernetes/manifests</code>ç›®å½•ä¸‹çš„<code>kube-controller-manager.yaml</code>å’Œ<code>kube-scheduler.yaml</code>çš„<code>--port=0</code>ï¼š</p>
</li>
<li>
<p><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>kube-controller-manager.yaml</code>æ–‡ä»¶</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;&gt;/etc/kubernetes/manifests/kube-controller-manager.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - command:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kube-controller-manager
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --allocate-node-cidrs=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --authentication-kubeconfig=/etc/kubernetes/controller-manager.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --authorization-kubeconfig=/etc/kubernetes/controller-manager.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --bind-address=127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --client-ca-file=/etc/kubernetes/pki/ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --cluster-cidr=10.244.0.0/16
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --cluster-name=kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --cluster-signing-cert-file=/etc/kubernetes/pki/ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --cluster-signing-key-file=/etc/kubernetes/pki/ca.key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --controllers=*,bootstrapsigner,tokencleaner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --kubeconfig=/etc/kubernetes/controller-manager.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --leader-elect=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # ä¿®æ”¹éƒ¨åˆ†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # - --port=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --root-ca-file=/etc/kubernetes/pki/ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --service-account-private-key-file=/etc/kubernetes/pki/sa.key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --service-cluster-ip-range=10.96.0.0/12
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --use-service-account-credentials=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>kube-scheduler.yaml</code>æ–‡ä»¶</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;&gt;/etc/kubernetes/manifests/kube-scheduler.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - command:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kube-scheduler
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --authentication-kubeconfig=/etc/kubernetes/scheduler.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --authorization-kubeconfig=/etc/kubernetes/scheduler.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --bind-address=127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --kubeconfig=/etc/kubernetes/scheduler.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --leader-elect=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # ä¿®æ”¹éƒ¨åˆ†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # - --port=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨æ‰€æœ‰MasterèŠ‚ç‚¹å†æ¬¡æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µï¼š</span>
</span></span><span style="display:flex;"><span>$ kubectl get cs</span></span></code></pre></div></blockquote>
<hr>
<h2 id="éƒ¨ç½²kubernetesé›†ç¾¤">éƒ¨ç½²<code>Kubernetes</code>é›†ç¾¤</h2>
<h3 id="å®‰è£…é«˜å¯ç”¨ç»„ä»¶">å®‰è£…é«˜å¯ç”¨ç»„ä»¶</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ³¨æ„ï¼šå¦‚æœä¸æ˜¯é«˜å¯ç”¨é›†ç¾¤ï¼Œ<!-- raw HTML omitted --><code>haproxy</code>å’Œ<code>keepalived</code>æ— éœ€å®‰è£…</li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li>æ‰€æœ‰<code>Master</code>èŠ‚ç‚¹å®‰è£…<code>HAPROXY</code>å’Œ<code>Keepalived</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install keepalived haproxy</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ‰€æœ‰<!-- raw HTML omitted --><code>Master</code><!-- raw HTML omitted -->èŠ‚ç‚¹é…ç½®<!-- raw HTML omitted --><code>HAProxy</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/haproxy/haproxy.cfg<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	maxconn  2000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	ulimit-n  16384
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	log  127.0.0.1 local0 err
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats timeout 30s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaults
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	log global
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	mode  http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	option  httplog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	timeout connect 5000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	timeout client  50000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	timeout server  50000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	timeout http-request 15s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	timeout http-keep-alive 15s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">frontend monitor-in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	bind *:33305
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	mode http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	option httplog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	monitor-uri /monitor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listen stats
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	bind    *:8006
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	mode    http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats   enable
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats   hide-version
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats   uri       /stats
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats   refresh   30s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats   realm     Haproxy\ Statistics
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	stats   auth      admin:admin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">frontend k8s-master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	bind 0.0.0.0:16443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	bind 127.0.0.1:16443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	mode tcp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	option tcplog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	tcp-request inspect-delay 5s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	default_backend k8s-master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backend k8s-master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	mode tcp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	option tcplog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	option tcp-check
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	balance roundrobin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# ä¸‹é¢çš„é…ç½®æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	server k8s-master-01 192.168.80.210:6443  check
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	server k8s-master-02 192.168.80.211:6443  check
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>Msster-01</code>çš„<code>Keepalived</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">! Configuration File for keepalived
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	global_defs {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# æ ‡è¯†æœ¬èŠ‚ç‚¹çš„å­—æ¡ä¸²ï¼Œé€šå¸¸ä¸º hostname
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		router_id k8s-master-01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		script_user root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		enable_script_security    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# æ£€æµ‹è„šæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# keepalivedä¼šå®šæ—¶æ‰§è¡Œè„šæœ¬å¹¶å¯¹è„šæœ¬æ‰§è¡Œçš„ç»“æœè¿›è¡Œåˆ†æï¼ŒåŠ¨æ€è°ƒæ•´vrrp_instanceçš„ä¼˜å…ˆçº§ã€‚å¦‚æœè„šæœ¬æ‰§è¡Œç»“æœä¸º0ï¼Œå¹¶ä¸”weighté…ç½®çš„å€¼å¤§äº0ï¼Œåˆ™ä¼˜å…ˆçº§ç›¸åº”çš„å¢åŠ ã€‚å¦‚æœè„šæœ¬æ‰§è¡Œç»“æœé0ï¼Œå¹¶ä¸”weighté…ç½®çš„å€¼å°äº0ï¼Œåˆ™ä¼˜å…ˆçº§ç›¸åº”çš„å‡å°‘ã€‚å…¶ä»–æƒ…å†µï¼Œç»´æŒåŸæœ¬é…ç½®çš„ä¼˜å…ˆçº§ï¼Œå³é…ç½®æ–‡ä»¶ä¸­priorityå¯¹åº”çš„å€¼ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_script chk_apiserver {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		script &#34;/etc/keepalived/check_apiserver.sh&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        interval 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # ä¸€æ—¦è„šæœ¬æ‰§è¡ŒæˆåŠŸï¼Œæƒé‡å‡å°‘5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        weight -5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        fall 3  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        rise 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# å®šä¹‰è™šæ‹Ÿè·¯ç”±ï¼ŒVI_1 ä¸ºè™šæ‹Ÿè·¯ç”±çš„æ ‡ç¤ºç¬¦ï¼Œè‡ªå·±å®šä¹‰åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_instance VI_1 {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# ä¸»èŠ‚ç‚¹ä¸º MASTERï¼Œå¯¹åº”çš„å¤‡ä»½èŠ‚ç‚¹ä¸º BACKUP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		state MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# ç»‘å®šè™šæ‹Ÿ IP çš„ç½‘ç»œæ¥å£ï¼Œä¸æœ¬æœº IP åœ°å€æ‰€åœ¨çš„ç½‘å¡åç§°ç›¸åŒ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		interface ens32
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# ä¸»æœºçš„IPåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		mcast_src_ip 192.168.80.210
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# è™šæ‹Ÿè·¯ç”±id
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		virtual_router_id 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# èŠ‚ç‚¹ä¼˜å…ˆçº§ï¼Œå€¼èŒƒå›´ 0-254ï¼ŒMASTER è¦æ¯” BACKUP é«˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		priority 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# ä¼˜å…ˆçº§é«˜çš„è®¾ç½® nopreempt è§£å†³å¼‚å¸¸æ¢å¤åå†æ¬¡æŠ¢å çš„é—®é¢˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		nopreempt 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# ç»„æ’­ä¿¡æ¯å‘é€é—´éš”ï¼Œæ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¿…é¡»ä¸€æ ·ï¼Œé»˜è®¤ 1s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		advert_int 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # è®¾ç½®éªŒè¯ä¿¡æ¯ï¼Œæ‰€æœ‰èŠ‚ç‚¹å¿…é¡»ä¸€è‡´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		authentication {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			auth_type PASS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			auth_pass K8SHA_KA_AUTH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		# è™šæ‹Ÿ IP æ± , æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¿…é¡»ä¸€æ ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		virtual_ipaddress {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			# è™šæ‹Ÿ ipï¼Œå¯ä»¥å®šä¹‰å¤šä¸ª	
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			192.168.80.220/24
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		track_script {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			chk_apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>Master-02</code>çš„<code>Keepalived</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">! Configuration File for keepalived
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	global_defs {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		router_id k8s-master-02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		script_user root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		enable_script_security    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_script chk_apiserver {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		script &#34;/etc/keepalived/check_apiserver.sh&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		interval 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		weight -5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		fall 3  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		rise 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	vrrp_instance VI_1 {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		state BACKUP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		interface ens32
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		mcast_src_ip 192.168.80.211
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		virtual_router_id 101
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		priority 99
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		advert_int 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		authentication {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			auth_type PASS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			auth_pass K8SHA_KA_AUTH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		virtual_ipaddress {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			192.168.80.220/24
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		track_script {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			chk_apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>æ‰€æœ‰<code>Master</code><!-- raw HTML omitted -->èŠ‚ç‚¹è®¾ç½®ç›‘æ§è„šæœ¬ï¼Œå¹¶ä¸”ç»™äºˆæ‰§è¡Œæƒé™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/check_apiserver.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">err=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for k in $(seq 1 5)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	check_code=$(pgrep kube-apiserver)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	if [[ $check_code == &#34;&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		err=$(expr $err + 1)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		continue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		err=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		break
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [[ $err != &#34;0&#34; ]]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	echo &#34;systemctl stop keepalived&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/usr/bin/systemctl stop keepalived
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	exit 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>$ chmod +x /etc/keepalived/check_apiserver.sh</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li>æ‰€æœ‰<code>Master</code><!-- raw HTML omitted -->èŠ‚ç‚¹å¯åŠ¨<!-- raw HTML omitted --><code>HAProxy</code>å’Œ<code>Keepalived</code>å¹¶ä¸”æµ‹è¯•<code>VIP(è™šæ‹ŸIP)</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable --now haproxy
</span></span><span style="display:flex;"><span>$ systemctl enable --now keepalived
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ping 192.168.80.220 -c <span style="color:#ae81ff">4</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆå§‹åŒ–kubernetes">åˆå§‹åŒ–<code>Kubernetes</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å‘½ä»¤è¡Œ<!-- raw HTML omitted --><!-- raw HTML omitted -->æ–¹å¼åˆå§‹åŒ–æ‰€æœ‰<!-- raw HTML omitted --><code>Master</code>èŠ‚ç‚¹</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>åœ¨<code>k8s-master01</code><!-- raw HTML omitted -->èŠ‚ç‚¹æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm init <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --apiserver-advertise-address<span style="color:#f92672">=</span>192.168.80.210 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --image-repository registry.aliyuncs.com/google_containers <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --control-plane-endpoint<span style="color:#f92672">=</span>192.168.80.225:16443 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --kubernetes-version v1.20.2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --service-cidr<span style="color:#f92672">=</span>10.96.0.0/12 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --pod-network-cidr<span style="color:#f92672">=</span>10.244.0.0/16 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --cri-socket unix:///var/run/containerd/containerd.sock  	<span style="color:#75715e"># é…ç½® CRI ç«¯ç‚¹</span>
</span></span><span style="display:flex;"><span>  --upload-certs</span></span></code></pre></div><ul>
<li>å°†<code>k8s-master02</code><!-- raw HTML omitted -->èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œå…¶ä»–<code>master</code>èŠ‚ç‚¹åŠ å…¥åŒæ ·å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm join 192.168.80.225:16443 --token povqsg.arg07e5ia1pywr71 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --discovery-token-ca-cert-hash sha256:9efd30b7f35747289b9de0c8d0768b9c2d5eb7d675cb86fa05b9a6d9526c3441 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --control-plane --certificate-key 363cc6296537b41607851c10f1f41ef23cf5cdc6965cb9c26e4b252315086855</span></span></code></pre></div><ul>
<li>é˜²æ­¢åœ¨<code>Master-02</code><!-- raw HTML omitted -->èŠ‚ç‚¹ä¸­ä¸èƒ½ä½¿ç”¨<!-- raw HTML omitted --><code>kubectl</code>å‘½ä»¤</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p $HOME/.kube
</span></span><span style="display:flex;"><span>$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style="display:flex;"><span>$ sudo chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config</span></span></code></pre></div><ul>
<li>å¦‚æœ<code>Token</code>è¿‡æœŸï¼Œéœ€è¦åœ¨<code>Master-01</code><!-- raw HTML omitted -->ç”Ÿæˆæ–°çš„<!-- raw HTML omitted --><code>Token</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm token create --print-join-command</span></span></code></pre></div><ul>
<li>å¦‚æœ<code>Master</code><!-- raw HTML omitted -->è¦åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œéœ€è¦åœ¨<!-- raw HTML omitted --><code>Master-01</code>ç”Ÿæˆ<code>--certificate-key</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm init phase upload-certs --upload-certs</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code> yaml</code><!-- raw HTML omitted -->æ–¹å¼åˆå§‹åŒ–æ‰€æœ‰<!-- raw HTML omitted --><code>Master</code>èŠ‚ç‚¹</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>åœ¨<code>k8s-master01</code><!-- raw HTML omitted -->åˆ›å»ºç›®å½•ç”Ÿæˆé…ç½®æ–‡ä»¶<!-- raw HTML omitted --><code>kubeadm-config.yaml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/k8s/yaml
</span></span><span style="display:flex;"><span>$ kubeadm config print init-defaults &gt;/opt/k8s/yaml/kubeadm-config.yaml
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>apiVersion: kubeadm.k8s.io/v1beta3
</span></span><span style="display:flex;"><span>bootstrapTokens:
</span></span><span style="display:flex;"><span>- groups:
</span></span><span style="display:flex;"><span>    - system:bootstrappers:kubeadm:default-node-token
</span></span><span style="display:flex;"><span>    token: abcdef.0123456789abcdef
</span></span><span style="display:flex;"><span>    ttl: 24h0m0s
</span></span><span style="display:flex;"><span>    usages:
</span></span><span style="display:flex;"><span>    - signing
</span></span><span style="display:flex;"><span>    - authentication
</span></span><span style="display:flex;"><span>kind: InitConfiguration
</span></span><span style="display:flex;"><span>localAPIEndpoint:
</span></span><span style="display:flex;"><span>    advertiseAddress: 1.2.3.4  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºmasteræœ¬æœºIP</span>
</span></span><span style="display:flex;"><span>    bindPort: <span style="color:#ae81ff">6443</span>  	<span style="color:#75715e"># ä½¿ç”¨ç«¯å£</span>
</span></span><span style="display:flex;"><span>nodeRegistration:
</span></span><span style="display:flex;"><span>    criSocket: unix:///var/run/containerd/containerd.sock  	<span style="color:#75715e"># é…ç½® CRI ç«¯ç‚¹</span>
</span></span><span style="display:flex;"><span>    imagePullPolicy: IfNotPresent
</span></span><span style="display:flex;"><span>    name: node  	<span style="color:#75715e"># é…ç½®ä¸»æœºåï¼Œ ä¸»æœºåä¸å…è®¸ä½¿ç”¨ä¸‹åˆ’çº¿</span>
</span></span><span style="display:flex;"><span>    taints: null
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>apiServer:
</span></span><span style="display:flex;"><span>    timeoutForControlPlane: 4m0s
</span></span><span style="display:flex;"><span>apiVersion: kubeadm.k8s.io/v1beta3
</span></span><span style="display:flex;"><span>certificatesDir: /etc/kubernetes/pki
</span></span><span style="display:flex;"><span>clusterName: kubernetes
</span></span><span style="display:flex;"><span>controllerManager: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>dns: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>etcd:
</span></span><span style="display:flex;"><span>    local:
</span></span><span style="display:flex;"><span>        dataDir: /var/lib/etcd
</span></span><span style="display:flex;"><span>imageRepository: k8s.gcr.io  	<span style="color:#75715e"># å®šä¹‰ä½¿ç”¨é•œåƒæº</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># imageRepository: registry.aliyuncs.com/google_containers  	# é˜¿é‡Œäº‘é•œåƒæº</span>
</span></span><span style="display:flex;"><span>kind: ClusterConfiguration
</span></span><span style="display:flex;"><span>kubernetesVersion: 1.24.0  	<span style="color:#75715e"># å®šä¹‰kubernetesç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>networking:
</span></span><span style="display:flex;"><span>    dnsDomain: cluster.local
</span></span><span style="display:flex;"><span>    serviceSubnet: 10.96.0.0/12
</span></span><span style="display:flex;"><span>scheduler: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span><span style="display:flex;"><span>kind: KubeProxyConfiguration
</span></span><span style="display:flex;"><span>featureGates:
</span></span><span style="display:flex;"><span>    SupportIPVSProxyMode: true
</span></span><span style="display:flex;"><span>mode: ipvs  	<span style="color:#75715e"># å¯ç”¨ipvs</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤æ›´æ–°<!-- raw HTML omitted --><code>kubeadm-config.yaml</code>æ–‡ä»¶ï¼Œéœ€è¦å°†<code>k8s</code>è®¾ç½®åˆ°å¯¹åº”çš„ç‰ˆæœ¬</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm config migrate --old-config /opt/k8s/yaml/kubeadm-config.yaml --new-config <span style="color:#e6db74">&#34;new.yaml&#34;</span></span></span></code></pre></div><ul>
<li>å°†<code>new.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶å¤åˆ¶åˆ°æ‰€æœ‰çš„<!-- raw HTML omitted --><code>master</code>èŠ‚ç‚¹</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ scp new.yaml k8s-master-02:/opt/k8s/yaml/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ä»¥åŠä¸‹è½½æ‰€æœ‰masterèŠ‚ç‚¹æå‰ä¸‹è½½é•œåƒ</span>
</span></span><span style="display:flex;"><span>$ kubeadm config images pull --config /opt/k8s/yaml/new.yaml  	<span style="color:#75715e"># pullæ›¿æ¢listå¯æŸ¥çœ‹æ‰€éœ€é•œåƒ</span></span></span></code></pre></div><ul>
<li><code>k8s-master01</code>èŠ‚ç‚¹åˆå§‹åŒ–åï¼Œä¼šåœ¨<code>/etc/kubernetes</code><!-- raw HTML omitted -->ç›®å½•ä¸‹ç”Ÿæˆå¯¹åº”çš„è¯ä¹¦å’Œé…ç½®æ–‡ä»¶ï¼Œä¹‹åå…¶ä»–çš„<!-- raw HTML omitted --><code>Master</code>èŠ‚ç‚¹åŠ å…¥åˆ°<code>k8s-master01</code>èŠ‚ç‚¹å³å¯</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm init --config /opt/k8s/yaml/new.yaml --upload-certs</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œé‡ç½®åå†æ¬¡åˆå§‹åŒ–ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm reset -f;ipvsadm --clear;rm -rf ~/.kube</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆå§‹åŒ–æˆåŠŸåï¼Œä¼šäº§ç”Ÿ<!-- raw HTML omitted --><code>token</code>å€¼ï¼Œç”¨äºå…¶ä»–èŠ‚ç‚¹åŠ å…¥æ—¶ä½¿ç”¨ï¼Œ</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Your Kubernetes control-plane has initialized successfully!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>To start using your cluster, you need to run the following as a regular user:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mkdir -p $HOME/.kube
</span></span><span style="display:flex;"><span>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style="display:flex;"><span>  sudo chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Alternatively, <span style="color:#66d9ef">if</span> you are the root user, you can run:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  export KUBECONFIG<span style="color:#f92672">=</span>/etc/kubernetes/admin.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>You should now deploy a pod network to the cluster.
</span></span><span style="display:flex;"><span>Run <span style="color:#e6db74">&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
</span></span><span style="display:flex;"><span>  https://kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>You can now join any number of the control-plane node running the following command on each as root:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># å…¶ä»– Master èŠ‚ç‚¹æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>  kubeadm join 192.168.80.210:16443 --token abcdef.0123456789abcdef <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --discovery-token-ca-cert-hash sha256:505e373bae6123fc3e27e778c5fedbccbf0f91a51efdcc11b32c4573605b8e71 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --control-plane --certificate-key 70aef5f76111a5824085c644b3f34cf830efad00c1b16b878701166bf069664e
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Please note that the certificate-key gives access to cluster sensitive data, keep it secret!
</span></span><span style="display:flex;"><span>As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;kubeadm init phase upload-certs --upload-certs&#34;</span> to reload certs afterward.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Then you can join any number of worker nodes by running the following on each as root:
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰€æœ‰ Node èŠ‚ç‚¹æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>kubeadm join 192.168.80.210:16443 --token abcdef.0123456789abcdef <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --discovery-token-ca-cert-hash sha256:505e373bae6123fc3e27e778c5fedbccbf0f91a51efdcc11b32c4573605b8e71</span></span></code></pre></div><ul>
<li><code>k8s-master01</code><!-- raw HTML omitted -->èŠ‚ç‚¹é…ç½®ç¯å¢ƒå˜é‡ï¼Œç”¨äºè®¿é—®<!-- raw HTML omitted --><code>kubernetes</code>é›†ç¾¤</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># rootç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/root/.bashrc<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export KUBECONFIG=/etc/kubernetes/admin.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ source ~/.bash_profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ™®é€šç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>$ mkdir -p $HOME/.kube
</span></span><span style="display:flex;"><span>$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span></span><span style="display:flex;"><span>$ sudo chown <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#66d9ef">$(</span>id -g<span style="color:#66d9ef">)</span> $HOME/.kube/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># k8s-master-01ä¸­æŸ¥çœ‹èŠ‚ç‚¹çš„çŠ¶æ€ï¼š</span>
</span></span><span style="display:flex;"><span>$ kubectl get nodes</span></span></code></pre></div></blockquote>
<hr>
<h3 id="nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤-1"><code>Node</code>èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æ‰€æœ‰<!-- raw HTML omitted --><code>Node</code><!-- raw HTML omitted -->èŠ‚ç‚¹æ‰§è¡Œ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubeadm join 192.168.80.225:16443 --token povqsg.arg07e5ia1pywr71 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --discovery-token-ca-cert-hash sha256:9efd30b7f35747289b9de0c8d0768b9c2d5eb7d675cb86fa05b9a6d9526c3441</span></span></code></pre></div></blockquote>
<hr>
<h2 id="font-colorredäºŒè¿›åˆ¶å®‰è£…fontkubernetes"><!-- raw HTML omitted -->äºŒè¿›åˆ¶å®‰è£…<!-- raw HTML omitted --><code>kubernetes</code></h2>
<h3 id="éƒ¨ç½²etcdå­˜å‚¨é›†ç¾¤ä¸‰å°ä¸»æœºä½œä¸ºèŠ‚ç‚¹">éƒ¨ç½²<code>Etcd</code>å­˜å‚¨é›†ç¾¤ã€ä¸‰å°ä¸»æœºä½œä¸ºèŠ‚ç‚¹</h3>
<ul>
<li>
<ol>
<li>é”®å€¼å¯¹æ•°æ®åº“ï¼Œå­˜å‚¨<code>K8S</code>é›†ç¾¤æ‰€æœ‰é‡è¦ä¿¡æ¯(æŒä¹…åŒ–)  <a href="https://blog.csdn.net/qq_27276045/article/details/115650151" rel="external" target="_self"><code>Kubernetes</code>å­˜å‚¨å¤§è„‘ä¹‹<code>etcd</code></a>ã€<a href="https://www.infoq.cn/article/rhzug069xvr5z5bhhtiv" rel="external" target="_self">çªç ´<code>etcd</code>é™åˆ¶ï¼å­—èŠ‚å¼€æºè‡ªç ”<code>K8s</code>å­˜å‚¨<code>KubeBrain</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>Etcd æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼ŒKubernetesä½¿ç”¨Etcdè¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œæ‰€ä»¥å…ˆå‡†å¤‡ä¸€ä¸ªEtcdæ•°æ®åº“ï¼Œä¸ºè§£å†³Etcdå•ç‚¹æ•…éšœï¼Œåº”é‡‡ç”¨é›†ç¾¤æ–¹å¼éƒ¨ç½²ï¼Œè¿™é‡Œä½¿ç”¨3å°ç»„å»ºé›†ç¾¤ï¼Œå¯å®¹å¿1å°æœºå™¨æ•…éšœï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨5å°ç»„å»ºé›†ç¾¤ï¼Œå¯å®¹å¿2å°æœºå™¨æ•…éšœ</span></span></code></pre></div><ul>
<li>1.1 æ³¨æ„è¿™é‡Œ<code>profiles</code>å­—æ®µä¸‹åç§°ï¼Œå…¶ä¸­<code>CjServer</code>ä¸‹æ³¨æ˜<code>server auth</code>ç”¨äºæœåŠ¡å™¨ç«¯è®¤è¯ï¼Œåç»­åœ¨ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨è¿™ä¸ªåç§°ä½œä¸º<code>cfssl</code>å‘½ä»¤çš„é…ç½®æ–‡ä»¶åç§°ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</li>
<li>1.2 æ³¨æ„è¿™é‡Œ<code>profiles</code>å­—æ®µä¸‹åç§°ï¼Œå…¶ä¸­<code>CjServer</code>ä¸‹æ³¨æ˜<code>server auth</code>ç”¨äºæœåŠ¡å™¨ç«¯è®¤è¯ï¼Œåç»­åœ¨ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨è¿™ä¸ªåç§°ä½œä¸º<code>cfssl</code>å‘½ä»¤çš„é…ç½®æ–‡ä»¶åç§°ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#34;code&#34;</span>:5100,<span style="color:#e6db74">&#34;message&#34;</span>:<span style="color:#e6db74">&#34;Invalid policy: no key usage available&#34;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>Failed to parse input: unexpected end of JSON input</span></span></code></pre></div><ul>
<li>1.3 å¾€å¾€æ˜¯æä¾›çš„<code>-profile</code>å‚æ•°ä¸­çš„é…ç½®æ–‡ä»¶ååœ¨<code>ca-config.json</code>ä¸­æ— æ³•åŒ¹é…</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 1.å‡†å¤‡cfsslè¯ä¹¦ç”Ÿæˆå·¥å…·ã€cfsslæ˜¯ä¸€ä¸ªå¼€æºçš„è¯ä¹¦ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨jsonæ–‡ä»¶ç”Ÿæˆè¯ä¹¦ï¼Œæ‰¾ä»»æ„ä¸€å°æœåŠ¡å™¨æ“ä½œï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /usr/local/src/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64  	# æ˜¯v1.2.0 æœ€å¥½å‡çº§åˆ°v1.3.4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ chmod +x cfssl_linux-amd64 cfssljson_linux-amd64 cfssl-certinfo_linux-amd64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ·»åŠ ç¯å¢ƒå˜é‡ç¬¬ä¸€ç§æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ vim /etc/profile
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=$PATH:/opt/kubernetes/bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ source /etc/profile
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æŠŠå¯æ‰§è¡Œæ–‡ä»¶æŒªç§»å¹¶æ”¹å
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ mv cfssl_linux-amd64 /usr/local/bin/cfssl
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ mv cfssljson_linux-amd64 /usr/local/bin/cfssljson
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ mv cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 2.ç”ŸæˆEtcdè¯ä¹¦ã€è‡ªç­¾è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰åˆ›å»ºå·¥ä½œç›®å½•ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt;/opt/kubernetes/ssl/ca-config.json&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;signing&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;default&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;expiry&#34;: &#34;87600h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;profiles&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;kubernetes&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         &#34;expiry&#34;: &#34;87600h&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         &#34;usages&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;signing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;key encipherment&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;server auth&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;client auth&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">###################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt;/opt/kubernetes/ssl/ca-csr.json&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;CN&#34;: &#34;etcd CA&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;key&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;algo&#34;: &#34;rsa&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;size&#34;: 2048
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;names&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;C&#34;: &#34;CN&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;L&#34;: &#34;Beijing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;ST&#34;: &#34;Beijing&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 3.ç”Ÿæˆè¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /opt/kubernetes/ssl/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cfssl gencert -initca ca-csr.json | cfssljson -bare ca -
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 4. ä½¿ç”¨è‡ªç­¾CAç­¾å‘Etcd HTTPSè¯ä¹¦:åˆ›å»ºè¯ä¹¦ç”³è¯·æ–‡ä»¶  #####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt;/opt/kubernetes/ssl/etcd-csr.json&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;CN&#34;: &#34;etcd&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;hosts&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;192.168.4.110&#34;, # ä¿®æ”¹IPã€ä¸ºäº†æ‰©å®¹æ–¹ä¾¿å¯ä»¥å¤šå†™å‡ ä¸ªIPã€å»æ‰æ³¨é‡Š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;192.168.4.111&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;192.168.4.112&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;xxx.xxx.xxx.xxx&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;xxx.xxx.xxx.xxx&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;xxx.xxx.xxx.xxx&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;key&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;algo&#34;: &#34;rsa&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;size&#34;: 2048
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;names&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;C&#34;: &#34;CN&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;L&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;ST&#34;: &#34;BeiJing&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 5. ç”Ÿæˆè¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /opt/kubernetes/ssl/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes etcd-csr.json | cfssljson -bare etcd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 6.åœ¨GitHubä¸Šä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /usr/local/src/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ wget https://github.com/etcd-io/etcd/releases/download/v3.4.14/etcd-v3.4.14-linux-amd64.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ tar zxvf etcd-v3.4.14-linux-amd64.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ mv etcd-v3.4.14-linux-amd64/{etcd,etcdctl} /opt/etcd/bin/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 6.åˆ›å»ºetcdé…ç½®æ–‡ä»¶ï¼šé’ˆå¯¹IPä¿®æ”¹ä¸ºæœ¬æœºIPï¼Œæ‹·è´è¿‡å»åæŠŠæ‰€æœ‰ç»“å°¾çš„â€œæ³¨é‡Šå–æ¶ˆæ‰â€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt;/opt/etcd/cfg/etcd.conf&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># [Member]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_NAME=&#34;etcd-node1&#34;  	# ä¿®æ”¹æ­¤å¤„ï¼ŒèŠ‚ç‚¹2æ”¹ä¸ºetcd-2ï¼ŒèŠ‚ç‚¹3æ”¹ä¸ºetcd-3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_DATA_DIR=&#34;/var/lib/etcd/default.etcd&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_LISTEN_PEER_URLS=&#34;https://192.168.4.110:2380&#34;  	# ä¿®æ”¹æ­¤å¤„ä¸ºå½“å‰æœåŠ¡å™¨IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_LISTEN_CLIENT_URLS=&#34;https://192.168.4.110:2379,https://127.0.0.1:2379&#34;  	# ä¿®æ”¹æ­¤å¤„ä¸ºå½“å‰æœåŠ¡å™¨IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># [Clustering]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_INITIAL_ADVERTISE_PEER_URLS=&#34;https://192.168.4.110:2380&#34;  	# ä¿®æ”¹æ­¤å¤„ä¸ºå½“å‰æœåŠ¡å™¨IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_ADVERTISE_CLIENT_URLS=&#34;https://192.168.4.110:2379&#34;  # ä¿®æ”¹æ­¤å¤„ä¸ºå½“å‰æœåŠ¡å™¨IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹ä¸ºæ‰€æœ‰èŠ‚ç‚¹IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_INITIAL_CLUSTER=&#34;etcd-node1=https://192.168.4.110:2380,etcd-node2=https://192.168.4.111:2380,etcd-node3=https://192.168.4.112:2380&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_INITIAL_CLUSTER_TOKEN=&#34;etcd-cluster&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ETCD_INITIAL_CLUSTER_STATE=&#34;new&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># [security]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># CLIENT_CERT_AUTH=&#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_CA_FILE=&#34;/opt/etcd/ssl/ca.pem&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_CERT_FILE=&#34;/opt/etcd/ssl/server.pem&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_KEY_FILE=&#34;/opt/etcd/ssl/server-key.pem&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># PEER_CLIENT_CERT_AUTH=&#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_PEER_CA_FILE=&#34;/opt/etcd/ssl/ca.pem&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_PEER_CERT_FILE=&#34;/opt/etcd/ssl/server.pem&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_PEER_KEY_FILE=&#34;/opt/etcd/ssl/server-key.pem&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#####################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_NAMEï¼šèŠ‚ç‚¹åç§°ï¼Œé›†ç¾¤ä¸­å”¯ä¸€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_DATA_DIRï¼šæ•°æ®ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_LISTEN_PEER_URLSï¼šé›†ç¾¤é€šä¿¡ç›‘å¬åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_LISTEN_CLIENT_URLSï¼šå®¢æˆ·ç«¯è®¿é—®ç›‘å¬åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_INITIAL_ADVERTISE_PEER_URLSï¼šé›†ç¾¤é€šå‘Šåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_ADVERTISE_CLIENT_URLSï¼šå®¢æˆ·ç«¯é€šå‘Šåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_INITIAL_CLUSTERï¼šé›†ç¾¤èŠ‚ç‚¹åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_INITIAL_CLUSTER_TOKENï¼šé›†ç¾¤Token
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ETCD_INITIAL_CLUSTER_STATEï¼šåŠ å…¥é›†ç¾¤çš„å½“å‰çŠ¶æ€ï¼Œnewæ˜¯æ–°é›†ç¾¤ï¼Œexistingè¡¨ç¤ºåŠ å…¥å·²æœ‰é›†ç¾¤
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 7.systemctlç®¡ç†etcd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt;/usr/lib/systemd/system/etcd.service&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Etcd Server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network-online.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Wants=network-online.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=notify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EnvironmentFile=/opt/etcd/cfg/etcd.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/etcd/bin/etcd \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cert-file=/opt/etcd/ssl/etcd.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--key-file=/opt/etcd/ssl/etcd-key.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--peer-cert-file=/opt/etcd/ssl/etcd.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--peer-key-file=/opt/etcd/ssl/etcd-key.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--trusted-ca-file=/opt/etcd/ssl/ca.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--peer-trusted-ca-file=/opt/etcd/ssl/ca.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--logger=zap
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">###################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 8.æ‹·è´åˆšåˆšç”Ÿæˆè¯ä¹¦åˆ°etcdç›®å½•ä¸‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /opt/kubernetes/ssl/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cp ca*.pem etcd*.pem /opt/etcd/ssl/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 9.èŠ‚ç‚¹1ç”Ÿæˆçš„æ‰€æœ‰æ–‡ä»¶æ‹·è´åˆ°å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹ã€ç„¶ååœ¨å…¶ä»–èŠ‚ç‚¹åˆ†åˆ«ä¿®æ”¹etcd.confé…ç½®æ–‡ä»¶ä¸­çš„èŠ‚ç‚¹åç§°å’Œå½“å‰æœåŠ¡å™¨IPï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ ansible node -i /etc/ansible/hosts -m copy -a &#34;src=../../opt/etcd dest=/opt&#34; -f 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ ansible node -i /etc/ansible/hosts -m copy -a &#34;src=../../usr/lib/systemd/system/etcd.service dest=/usr/lib/systemd/system&#34; -f 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ mkdir -p /var/lib/etcd  	# ä¸‰ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ chmod +x /opt/etcd/bin/*  	# å…¶ä»–ä¸¤ä¸ªèŠ‚ç‚¹æ‰§è¡Œè¯­å¥ç»™äºˆæ‰§è¡Œæƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 10.æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¼€æœºè‡ªå¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ systemctl daemon-reload
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ systemctl enable etcd &amp;&amp; systemctl start etcd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æµ‹è¯•etcdæ•°æ®åº“å¯ç”¨æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ etcdctl set testdir/testkey0 0  	# è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ etcdctl get testdir/testkey0  	# æŸ¥çœ‹æ˜¯å¦è·å–åˆ°æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ etcdctl -C http://localhost:2379 cluster-health
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 11.æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ ETCDCTL_API=3 /opt/etcd/bin/etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/etcd.pem --key=/opt/etcd/ssl/etcd-key.pem --endpoints=&#34;https://192.168.4.110:2379,https://192.168.4.111:2379,https://192.168.4.112:2379&#34; endpoint health &#39;</span> &gt;&gt;install_etcd.sh</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ç½²master-nodeç”Ÿæˆkube-apiserverè¯ä¹¦è‡ªç­¾è¯ä¹¦é¢å‘æœºæ„ca">ç½²<code>Master Node</code>ï¼Œç”Ÿæˆ<code>kube-apiserver</code>è¯ä¹¦ï¼šè‡ªç­¾è¯ä¹¦é¢å‘æœºæ„<code>CA</code></h3>
<ul>
<li>
<ol>
<li><code>api-serverï¼š</code>æ‰€æœ‰æœåŠ¡è®¿é—®ç»Ÿä¸€å…¥å£</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 1.åˆ›å»ºè¯ä¹¦ç”³è¯·æ–‡ä»¶ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># hostså­—æ®µä¸­IPä¸ºæ‰€æœ‰Master/LB/VIP IP,ä¸€ä¸ªéƒ½ä¸èƒ½å°‘ï¼ä¸ºäº†æ–¹ä¾¿åæœŸæ‰©å®¹å¯ä»¥å¤šå†™å‡ ä¸ªé¢„ç•™çš„IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt; /opt/kubernetes/ssl/kube-apiserver-csr.json &lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;CN&#34;: &#34;kubernetes&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;hosts&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;10.0.0.1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;127.0.0.1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;192.168.4.110&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;192.168.4.111&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;192.168.4.112&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;xxx.xxx.xxx.xxx&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;xxx.xxx.xxx.xxx&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;kubernetes&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;kubernetes.default&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;kubernetes.default.svc&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;kubernetes.default.svc.cluster&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;kubernetes.default.svc.cluster.local&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;key&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;algo&#34;: &#34;rsa&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;size&#34;: 2048
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;names&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;C&#34;: &#34;CN&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;L&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;ST&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;O&#34;: &#34;k8s&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;OU&#34;: &#34;System&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">######################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 2.ç”Ÿæˆè¯ä¹¦:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /opt/kubernetes/ssl
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-apiserver-csr.json | cfssljson -bare api-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰“å¼€é“¾æ¥ä¸‹è½½äºŒè¿›åˆ¶åŒ…
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.20.md#v1202
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd /usr/local/src
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ wget https://dl.k8s.io/v1.18.6/kubernetes-server-linux-amd64.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ tar zxvf kubernetes-server-linux-amd64.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cd kubernetes/server/bin/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cp kube-apiserver kube-scheduler kube-controller-manager /opt/kubernetes/bin/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cp kubectl /usr/bin/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 3.éƒ¨ç½²kube-apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¸¤ä¸ª&#34;\\&#34;ç¬¬ä¸€ä¸ªæ˜¯è½¬ä¹‰ç¬¦ï¼Œç¬¬äºŒä¸ªæ˜¯æ¢è¡Œç¬¦ï¼Œä½¿ç”¨è½¬ä¹‰ç¬¦æ˜¯ä¸ºäº†ä½¿ç”¨EOFä¿ç•™æ¢è¡Œç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat &gt;/opt/kubernetes/cfg/kube-apiserver.conf&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBE_APISERVER_OPTS=&#34;--logtostderr=false \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--v=2 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--log-dir=/opt/kubernetes/logs \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--etcd-servers=https://192.168.4.110:2379,https://192.168.4.111:2379,https://192.168.4.112:2379 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--bind-address=192.168.4.110 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--secure-port=6443 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--advertise-address=192.168.4.110 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--allow-privileged=true \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-cluster-ip-range=10.0.0.0/24 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--authorization-mode=RBAC,Node \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--enable-bootstrap-token-auth=true \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--token-auth-file=/opt/kubernetes/cfg/token.csv \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-node-port-range=30000-32767 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--kubelet-client-certificate=/opt/kubernetes/ssl/api-server.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--kubelet-client-key=/opt/kubernetes/ssl/api-server-key.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--tls-cert-file=/opt/kubernetes/ssl/api-server.pem  \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--tls-private-key-file=/opt/kubernetes/ssl/api-server-key.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--client-ca-file=/opt/kubernetes/ssl/ca.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-account-key-file=/opt/kubernetes/ssl/ca-key.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--etcd-cafile=/opt/etcd/ssl/ca.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--etcd-certfile=/opt/etcd/ssl/server.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--etcd-keyfile=/opt/etcd/ssl/server-key.pem \\  	# è¯ä¹¦éœ€è¦ä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--audit-log-maxbackup=3 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--audit-log-maxsize=100 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--audit-log-path=/opt/kubernetes/logs/k8s-audit.log&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#######################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“logtostderrï¼šå¯ç”¨æ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€”vï¼šæ—¥å¿—ç­‰çº§
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“log-dirï¼šæ—¥å¿—ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“etcd-serversï¼šetcdé›†ç¾¤åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“bind-addressï¼šç›‘å¬åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“secure-portï¼šhttpså®‰å…¨ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“advertise-addressï¼šé›†ç¾¤é€šå‘Šåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“allow-privilegedï¼šå¯ç”¨æˆæƒ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“service-cluster-ip-rangeï¼šServiceè™šæ‹ŸIPåœ°å€æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“enable-admission-pluginsï¼šå‡†å…¥æ§åˆ¶æ¨¡å—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“authorization-modeï¼šè®¤è¯æˆæƒï¼Œå¯ç”¨RBACæˆæƒå’ŒèŠ‚ç‚¹è‡ªç®¡ç†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“enable-bootstrap-token-authï¼šå¯ç”¨TLS bootstrapæœºåˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“token-auth-fileï¼šbootstrap tokenæ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“service-node-port-rangeï¼šService nodeportç±»å‹é»˜è®¤åˆ†é…ç«¯å£èŒƒå›´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“kubelet-client-xxxï¼šapiserverè®¿é—®kubeletå®¢æˆ·ç«¯è¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“tls-xxx-fileï¼šapiserver httpsè¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“etcd-xxxfileï¼šè¿æ¥Etcdé›†ç¾¤è¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">â€“audit-log-xxxï¼šå®¡è®¡æ—¥å¿— &#39;</span>&gt;&gt; kube-apiserver.sh</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å¯ç”¨tls-bootstrappingæœºåˆ¶">å¯ç”¨<code>TLS Bootstrapping</code>æœºåˆ¶</h3>
<ul>
<li>
<ol>
<li><code>TLS Bootstrapingï¼šMaster apiserver</code>å¯ç”¨<code>TLS</code>è®¤è¯åï¼Œ<code>Node</code>èŠ‚ç‚¹<code>kubelet</code>å’Œ<code>kube-proxy</code>è¦ä¸<code>kube-apiserver</code>è¿›è¡Œé€šä¿¡ï¼Œå¿…é¡»ä½¿ç”¨<code>CA</code>ç­¾å‘çš„æœ‰æ•ˆè¯ä¹¦æ‰å¯ä»¥ï¼Œå½“<code>Node</code>èŠ‚ç‚¹å¾ˆå¤šæ—¶ï¼Œè¿™ç§å®¢æˆ·ç«¯è¯ä¹¦é¢å‘éœ€è¦å¤§é‡å·¥ä½œï¼ŒåŒæ ·ä¹Ÿä¼šå¢åŠ é›†ç¾¤æ‰©å±•å¤æ‚åº¦ã€‚ä¸ºäº†ç®€åŒ–æµç¨‹ï¼Œ<code>Kubernetes</code>å¼•å…¥äº†<code>TLS bootstraping</code>æœºåˆ¶æ¥è‡ªåŠ¨é¢å‘å®¢æˆ·ç«¯è¯ä¹¦ï¼Œ<code>kubelet</code>ä¼šä»¥ä¸€ä¸ªä½æƒé™ç”¨æˆ·è‡ªåŠ¨å‘<code>apiserver</code>ç”³è¯·è¯ä¹¦ï¼Œ<code>kubelet</code>çš„è¯ä¹¦ç”±<code>apiserver</code>åŠ¨æ€ç­¾ç½²ã€‚æ‰€ä»¥å¼ºçƒˆå»ºè®®åœ¨<code>Node</code>ä¸Šä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç›®å‰ä¸»è¦ç”¨äº<code>kubelet</code>ï¼Œ<code>kube-proxy</code>è¿˜æ˜¯ç”±æˆ‘ä»¬ç»Ÿä¸€é¢å‘ä¸€ä¸ªè¯ä¹¦</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cat &gt;/opt/kubernetes/cfg/token.csv&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$(head -c 16 /dev/urandom | od -An -t x | tr -d &#39;</span> <span style="color:#e6db74">&#39;),kubelet-bootstrap,10001,&#34;system:node-bootstrapper&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">###########################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è‡ªè¡Œç”Ÿæˆtoken
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># token=$(head -c 16 /dev/urandom | od -An -t x | tr -d &#39;</span> <span style="color:#e6db74">&#39;)  	# Cè¯­è¨€æ‰§è¡Œç”Ÿæˆæ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># token=`head -c 16 /dev/urandom | od -An -t x | tr -d &#39;</span> <span style="color:#e6db74">&#39;`  	# shellæ‰§è¡Œç”Ÿæˆæ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sed -i &#34;s/c47ffb939f5ca36231d9e3121a252940/${token}/g&#34;  /opt/kubernetes/cfg/token.csv
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># systemctç®¡ç†apiserverã€å¹¶è®¾ç½®å¼€æœºè‡ªå¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cat &gt;/usr/lib/systemd/system/kube-apiserver.service&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes API Server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://github.com/kubernetes/kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EnvironmentFile=/opt/kubernetes/cfg/kube-apiserver.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/kubernetes/bin/kube-apiserver \$KUBE_APISERVER_OPTS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#######################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ systemctl daemon-reload
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ systemctl enable kube-apiserver &amp;&amp; systemctl start kube-apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># kube-apiserveræŠ¥é”™æ’æŸ¥
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ cat /var/log/messages|grep kube-apiserver|grep -i error  	# -iä¸åŒºåˆ†å¤§å°å†™
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">journalctl -xe -u kube-apiserver | more  	# å‘½ä»¤æ’é”™ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 3.è®¾ç½®æˆæƒkubelet-bootstrapç”¨æˆ·å…è®¸è¯·æ±‚è¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$ kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap &#39;</span> &gt;&gt;token-apiserver.sh</span></span></code></pre></div></blockquote>
<hr>
<h3 id="éƒ¨ç½²kube-controller-manageræ§åˆ¶å™¨">éƒ¨ç½²<code>kube-controller-manager</code>(æ§åˆ¶å™¨)</h3>
<ul>
<li>
<ol>
<li><code>Pod</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>1.1 <!-- raw HTML omitted -->æœ€å°éƒ¨ç½²å•å…ƒ<!-- raw HTML omitted --></li>
<li>1.2 <!-- raw HTML omitted -->ä¸€ç»„å®¹å™¨çš„é›†åˆ<!-- raw HTML omitted --></li>
<li>1.3 <!-- raw HTML omitted -->ä¸€ä¸ª<code>Pod</code>ä¸­çš„å®¹å™¨å…±äº«ç½‘ç»œå‘½åç©ºé—´<!-- raw HTML omitted --></li>
<li>1.4 <!-- raw HTML omitted --><code>Pod</code>æ˜¯çŸ­æš‚çš„<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>Controllers</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>2.1 <!-- raw HTML omitted --><code>Deploymentï¼š</code>æ— çŠ¶æ€åº”ç”¨éƒ¨ç½²<!-- raw HTML omitted --></li>
<li>2.2 <!-- raw HTML omitted --><code>StatefulSetï¼š</code>æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²<!-- raw HTML omitted --></li>
<li>2.3 <!-- raw HTML omitted --><code>DaemonSetï¼š</code>ç¡®ä¿æ‰€æœ‰çš„<code>Node</code>è¿è¡Œä¸€ä¸ª<code>Pod</code><!-- raw HTML omitted --></li>
<li>2.4 <!-- raw HTML omitted --><code>Jobï¼š</code>ä¸€æ¬¡æ€§ä»»åŠ¡<!-- raw HTML omitted --></li>
<li>2.5 <!-- raw HTML omitted --><code>Cronjobï¼š</code>å®šæ—¶ä»»åŠ¡<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æ›´é«˜çº§å±‚çº§å¯¹è±¡ï¼Œéƒ¨ç½²å’Œç®¡ç†<code>Pod</code><!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="4">
<li><code>Service</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>4.1 <!-- raw HTML omitted -->é˜²æ­¢<code>Pod</code>å¤±è”<!-- raw HTML omitted --></li>
<li>4.2 <!-- raw HTML omitted -->å®šä¹‰ä¸€ç»„<code>Pod</code>çš„è®¿é—®ç­–ç•¥<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted --><code>Labelï¼š</code>æ ‡ç­¾ï¼Œé™„åŠ åˆ°æŸä¸ªèµ„æºä¸Šï¼Œç”¨äºå…³è”å¯¹è±¡ï¼ŒæŸ¥è¯¢å’Œç­›é€‰<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="6">
<li><!-- raw HTML omitted --><code>Namespacesï¼š</code>å‘½åç©ºé—´ï¼Œå°†å¯¹è±¡é€»è¾‘ä¸Šéš”ç¦»<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="7">
<li><!-- raw HTML omitted --><code>Controllerï¼š</code>ç»´æŒå‰¯æœ¬æœŸæœ›æ•°ç›®,<code>ReplicaSet</code>æ›¿ä»£<code>ReplicationControlled</code><!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="8">
<li><!-- raw HTML omitted --><code>deployentï¼š</code>ç®¡ç†<code>RS</code>ï¼Œå®ç°æ»šåŠ¨æ›´æ–°<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>8.1 <!-- raw HTML omitted --><code>--kubeconfigï¼š</code>è¿æ¥<code>apiserver</code>é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
<li>8.2 <!-- raw HTML omitted --><code>--masterï¼š</code>é€šè¿‡æœ¬åœ°éå®‰å…¨æœ¬åœ°ç«¯å£<code>8080</code>è¿æ¥<code>apiserver</code><!-- raw HTML omitted --></li>
<li>8.3 <!-- raw HTML omitted --><code>--leader-electï¼š</code>å½“è¯¥ç»„ä»¶å¯åŠ¨å¤šä¸ªæ—¶ï¼Œè‡ªåŠ¨é€‰ä¸¾<code>HA</code><!-- raw HTML omitted --></li>
<li>8.4 <!-- raw HTML omitted --><code>--cluster-signing-cert-file/--cluster-signing-key-fileï¼š</code>è‡ªåŠ¨ä¸º<code>kubelet</code>é¢å‘è¯ä¹¦çš„<code>CA</code>ï¼Œä¸<code>apiserver</code>ä¿æŒä¸€è‡´<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºé…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/kube-controller-manager.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBE_CONTROLLER_MANAGER_OPTS=&#34;--logtostderr=false \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--v=2 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--log-dir=/opt/kubernetes/logs \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--leader-elect=true \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--kubeconfig=/opt/kubernetes/cfg/kube-controller-manager.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--master=127.0.0.1:8080 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--bind-address=127.0.0.1 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--allocate-node-cidrs=true \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cluster-cidr=10.244.0.0/16 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-cluster-ip-range=10.0.0.0/24 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cluster-signing-cert-file=/opt/kubernetes/ssl/ca.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cluster-signing-key-file=/opt/kubernetes/ssl/ca-key.pem  \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--root-ca-file=/opt/kubernetes/ssl/ca.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--service-account-private-key-file=/opt/kubernetes/ssl/ca-key.pem \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--experimental-cluster-signing-duration=87600h0m0s&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºkube-controller-manager-csr.json è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œå¯ä»¥è¶Šè¿‡</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cat &gt;/opt/kubernetes/ssl/kube-controller-manager-csr.json&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;CN&#34;: &#34;system:kube-controller-manager&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;hosts&#34;: [],</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;key&#34;: {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    &#34;algo&#34;: &#34;rsa&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    &#34;size&#34;: 2048</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  },</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;names&#34;: [</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;C&#34;: &#34;CN&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;L&#34;: &#34;BeiJing&#34;, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;ST&#34;: &#34;BeiJing&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;O&#34;: &#34;system:masters&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;OU&#34;: &#34;System&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    }</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  ]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># }</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆè¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ cd /opt/kubernetes/ssl
</span></span><span style="display:flex;"><span>$ cfssl gencert -ca<span style="color:#f92672">=</span>ca.pem -ca-key<span style="color:#f92672">=</span>ca-key.pem -config<span style="color:#f92672">=</span>ca-config.json -profile<span style="color:#f92672">=</span>kubernetes kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="9">
<li><!-- raw HTML omitted -->ç”Ÿæˆ<code>kubeconfig</code>æ–‡ä»¶ï¼ˆä»¥ä¸‹æ˜¯<code>shell</code>å‘½ä»¤ï¼Œç›´æ¥åœ¨ç»ˆç«¯æ‰§è¡Œï¼‰ï¼šå¯ä»¥è¶Šè¿‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># KUBE_CONFIG=&#34;/opt/kubernetes/cfg/kube-controller-manager.kubeconfig&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># KUBE_APISERVER=&#34;https://192.168.4.110:6443&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>$ kubectl config set-cluster kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#75715e">#  --certificate-authority=/opt/kubernetes/ssl/ca.pem \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --embed-certs=true \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --server=${KUBE_APISERVER} \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-credentials kube-controller-manager <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#75715e">#  --client-certificate=./kube-controller-manager.pem \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --client-key=./kube-controller-manager-key.pem \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --embed-certs=true \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#75715e">#  --cluster=kubernetes \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --user=kube-controller-manager \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="systemdç®¡ç†controller-manager"><code>systemd</code>ç®¡ç†<code>controller-manager</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><code>Controller manager</code>ï¼ˆé»˜è®¤ç«¯å£ï¼š<code>10252</code>ï¼‰ç›‘è§†<code>Kubernetes</code>é›†ç¾¤ï¼Œä»¥æ£€æµ‹å’Œç»´æŠ¤<code>Kubernetes</code>ç¯å¢ƒçš„å‡ ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬å°†<code>Pod</code>åŠ å…¥åˆ°æœåŠ¡ä¸­ï¼Œä¿æŒä¸€ç»„<code>Pod</code>çš„æ­£ç¡®æ•°é‡ï¼Œå¹¶å¯¹èŠ‚ç‚¹çš„ä¸¢å¤±åšå‡ºååº”<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><code>Cloud controller manager</code>ï¼ˆé»˜è®¤ç«¯å£ï¼š10258ï¼‰ä¸€ä¸ªç”¨äºåŸºäºäº‘çš„éƒ¨ç½²çš„å¯é€‰ç»„ä»¶ã€‚äº‘æ§åˆ¶å™¨ä¸äº‘æœåŠ¡æä¾›å•†æ¥å£ï¼Œä»¥ç®¡ç†é›†ç¾¤çš„è´Ÿè½½å‡è¡¡å™¨å’Œè™šæ‹Ÿç½‘ç»œ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/kube-controller-manager.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes Controller Manager
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://github.com/kubernetes/kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EnvironmentFile=/opt/kubernetes/cfg/kube-controller-manager.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/kubernetes/bin/kube-controller-manager \$KUBE_CONTROLLER_MANAGER_OPTS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecReload=/bin/kill -HUP $MAINPID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨">å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable kube-controller-manager <span style="color:#f92672">&amp;&amp;</span> systemctl start kube-controller-manager</span></span></code></pre></div></blockquote>
<hr>
<h3 id="éƒ¨ç½²kube-scheduleråˆ›å»ºé…ç½®æ–‡ä»¶è°ƒåº¦å™¨è´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦ç»„ä»¶æŠ½ç¦»">éƒ¨ç½²<code>kube-scheduler</code>:åˆ›å»ºé…ç½®æ–‡ä»¶(è°ƒåº¦å™¨è´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦,ç»„ä»¶æŠ½ç¦»)</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><code>Schedulerï¼š</code>è´Ÿè´£ä»‹ç»ä»»åŠ¡ï¼Œé€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹è¿›è¡Œåˆ†é…ä»»åŠ¡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>1.1 <!-- raw HTML omitted --><code>--kubeconfig</code>ï¼šè¿æ¥<code>apiserver</code>é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
<li>1.2 <!-- raw HTML omitted --><code>--master</code>ï¼šé€šè¿‡æœ¬åœ°éå®‰å…¨æœ¬åœ°ç«¯å£8080è¿æ¥<code>apiserver</code><!-- raw HTML omitted --></li>
<li>1.3 <!-- raw HTML omitted --><code>--leader-elect</code>ï¼šå½“è¯¥ç»„ä»¶å¯åŠ¨å¤šä¸ªæ—¶ï¼Œè‡ªåŠ¨é€‰ä¸¾(HA) <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/kube-scheduler.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBE_SCHEDULER_OPTS=&#34;--logtostderr=false \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--v=2 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--log-dir=/opt/kubernetes/logs \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--leader-elect \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#--kubeconfig=/opt/kubernetes/cfg/kube-scheduler.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--master=127.0.0.1:8080 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--bind-address=127.0.0.1&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ›å»º<code>kube-scheduler-csr.json</code>è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼šå¯ä»¥è¶Šè¿‡æ­¤æ­¥éª¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># cat &gt;/opt/kubernetes/ssl/kube-scheduler-csr.json&lt;&lt;-EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;CN&#34;: &#34;system:kube-scheduler&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;hosts&#34;: [],</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;key&#34;: {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    &#34;algo&#34;: &#34;rsa&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    &#34;size&#34;: 2048</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  },</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &#34;names&#34;: [</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;C&#34;: &#34;CN&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;L&#34;: &#34;BeiJing&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;ST&#34;: &#34;BeiJing&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;O&#34;: &#34;system:masters&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &#34;OU&#34;: &#34;System&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    }</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  ]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># }</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆè¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ cd /opt/kubernetes/ssl
</span></span><span style="display:flex;"><span>$ cfssl gencert -ca<span style="color:#f92672">=</span>ca.pem -ca-key<span style="color:#f92672">=</span>ca-key.pem -config<span style="color:#f92672">=</span>ca-config.json -profile<span style="color:#f92672">=</span>kubernetes kube-scheduler-csr.json | cfssljson -bare kube-scheduler</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç”Ÿæˆ<code>kubeconfig</code>æ–‡ä»¶(ä»¥ä¸‹æ˜¯<code>shell</code>å‘½ä»¤ï¼Œç›´æ¥åœ¨ç»ˆç«¯æ‰§è¡Œ)ï¼šæ­¤æ­¥éª¤å¯ä»¥è¶Šè¿‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># KUBE_CONFIG=&#34;/opt/kubernetes/cfg/kube-scheduler.kubeconfig&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># KUBE_APISERVER=&#34;https://192.168.100.11:6443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-cluster kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#75715e">#  --certificate-authority=/opt/kubernetes/ssl/ca.pem \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --embed-certs=true \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --server=${KUBE_APISERVER} \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-credentials kube-scheduler <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#75715e">#  --client-certificate=./kube-scheduler.pem \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --client-key=./kube-scheduler-key.pem \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --embed-certs=true \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span><span style="color:#75715e">#  --cluster=kubernetes \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --user=kube-scheduler \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="systemdç®¡ç†scheduler"><code>systemd</code>ç®¡ç†<code>scheduler</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/kube-scheduler.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes Scheduler
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://github.com/kubernetes/kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EnvironmentFile=/opt/kubernetes/cfg/kube-scheduler.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/kubernetes/bin/kube-scheduler \$KUBE_SCHEDULER_OPTS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è®¾ç½®å¼€æœºè‡ªå·±å¹¶ä¸”å¯åŠ¨æœåŠ¡å™¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable kube-scheduler <span style="color:#f92672">&amp;&amp;</span> systemctl start kube-scheduler</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç”Ÿæˆ<code>kubectl</code>è¿æ¥é›†ç¾¤çš„è¯ä¹¦ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/ssl/admin-csr.json<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;CN&#34;: &#34;admin&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;hosts&#34;: [],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;key&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;algo&#34;: &#34;rsa&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;size&#34;: 2048
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;names&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;C&#34;: &#34;CN&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;L&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;ST&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;O&#34;: &#34;system:masters&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;OU&#34;: &#34;System&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç”Ÿæˆè¯ä¹¦<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/kubernetes/ssl/
</span></span><span style="display:flex;"><span>$ cfssl gencert -ca<span style="color:#f92672">=</span>ca.pem -ca-key<span style="color:#f92672">=</span>ca-key.pem -config<span style="color:#f92672">=</span>ca-config.json -profile<span style="color:#f92672">=</span>kubernetes admin-csr.json | cfssljson -bare admin</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ç”Ÿæˆ<code>kubeconfig</code>æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir /root/.kube
</span></span><span style="display:flex;"><span>$ KUBE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/root/.kube/config&#34;</span>
</span></span><span style="display:flex;"><span>$ KUBE_APISERVER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://192.168.4.110:6443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-cluster kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--certificate-authority<span style="color:#f92672">=</span>/opt/kubernetes/ssl/ca.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--server<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_APISERVER<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>$ kubectl config set-credentials cluster-admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--client-certificate<span style="color:#f92672">=</span>./admin.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--client-key<span style="color:#f92672">=</span>./admin-key.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>$ kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--cluster<span style="color:#f92672">=</span>kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--user<span style="color:#f92672">=</span>cluster-admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>$ kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->é€šè¿‡<code>kubectl</code>å·¥å…·æŸ¥çœ‹å½“å‰é›†ç¾¤ç»„ä»¶çŠ¶æ€<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get cs
</span></span><span style="display:flex;"><span>NAME                 STATUS    MESSAGE             ERROR
</span></span><span style="display:flex;"><span>controller-manager   Healthy   ok                  
</span></span><span style="display:flex;"><span>scheduler            Healthy   ok                  
</span></span><span style="display:flex;"><span>etcd-0               Healthy   <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;health&#34;</span>:<span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>etcd-1               Healthy   <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;health&#34;</span>:<span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>etcd-2               Healthy   <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;health&#34;</span>:<span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">}</span> </span></span></code></pre></div></blockquote>
<hr>
<h3 id="åœ¨masteræ“ä½œéƒ¨ç½²worker-node">åœ¨<code>Master</code>æ“ä½œéƒ¨ç½²<code>Worker Node</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><code>Kubeletï¼š</code>ç›´æ¥è·Ÿå®¹å™¨å¼•æ“äº¤äº’å®ç°å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><code>Kube proxyï¼š</code>è´Ÿè´£å†™å…¥è§„åˆ™è‡³<code>iptables</code>ã€<code>ipvs</code>å®ç°æœåŠ¡æ˜ å°„è®¿é—®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>2.1 <!-- raw HTML omitted --><code>--hostname-override</code>ï¼šæ˜¾ç¤ºåç§°ï¼Œé›†ç¾¤ä¸­å”¯ä¸€<!-- raw HTML omitted --></li>
<li>2.2 <!-- raw HTML omitted --><code>--network-plugin</code>ï¼šå¯ç”¨<code>CNI</code><!-- raw HTML omitted --></li>
<li>2.3 <!-- raw HTML omitted --><code>--kubeconfig</code>ï¼šç©ºè·¯å¾„ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œåé¢ç”¨äºè¿æ¥<code>apiserver</code><!-- raw HTML omitted --></li>
<li>2.4 <!-- raw HTML omitted --><code>--bootstrap-kubeconfig</code>ï¼šé¦–æ¬¡å¯åŠ¨å‘<code>apiserver</code>ç”³è¯·è¯ä¹¦<!-- raw HTML omitted --></li>
<li>2.5 <!-- raw HTML omitted --><code>--config</code>ï¼šé…ç½®å‚æ•°æ–‡ä»¶<!-- raw HTML omitted --></li>
<li>2.6 <!-- raw HTML omitted --><code>--cert-dir</code>ï¼š<code>kubelet</code>è¯ä¹¦ç”Ÿæˆç›®å½•<!-- raw HTML omitted --></li>
<li>2.7 <!-- raw HTML omitted --><code>--pod-infra-container-image</code>ï¼šç®¡ç†<code>Pod</code>ç½‘ç»œå®¹å™¨çš„é•œåƒ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/kubernetes/server/bin/
</span></span><span style="display:flex;"><span>$ cp kubelet kube-proxy /opt/kubernetes/bin   <span style="color:#75715e"># æœ¬åœ°æ‹·è´</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># éƒ¨ç½²bubelet</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/kubelet.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBELET_OPTS=&#34;--logtostderr=false \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--v=2 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--log-dir=/opt/kubernetes/logs \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--hostname-override=k8s-master \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--network-plugin=cni \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--config=/opt/kubernetes/cfg/kubelet-config.yml \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cert-dir=/opt/kubernetes/ssl \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--pod-infra-container-image=lizhenliang/pause-amd64:3.0&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="é…ç½®å‚æ•°æ–‡ä»¶">é…ç½®å‚æ•°æ–‡ä»¶</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/kubelet-config.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: KubeletConfiguration
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: kubelet.config.k8s.io/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">address: 0.0.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port: 10250
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">readOnlyPort: 10255
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cgroupDriver: cgroupfs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clusterDNS:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - 10.0.0.2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clusterDomain: cluster.local 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">failSwapOn: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">authentication:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  anonymous:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    enabled: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  webhook:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    cacheTTL: 2m0s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  x509:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    clientCAFile: /opt/kubernetes/ssl/ca.pem 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">authorization:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  mode: Webhook
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  webhook:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    cacheAuthorizedTTL: 5m0s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    cacheUnauthorizedTTL: 30s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">evictionHard:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  imagefs.available: 15%
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  memory.available: 100Mi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  nodefs.available: 10%
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  nodefs.inodesFree: 5%
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">maxOpenFiles: 1000000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">maxPods: 110
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="åœ¨masterèŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆkubeletåˆæ¬¡åŠ å…¥é›†ç¾¤å¼•å¯¼bootstrapkubeconfigæ–‡ä»¶">åœ¨<code>master</code>èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆ<code>kubelet</code>åˆæ¬¡åŠ å…¥é›†ç¾¤å¼•å¯¼<code>bootstrap.kubeconfig</code>æ–‡ä»¶</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ KUBE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/opt/kubernetes/cfg/bootstrap.kubeconfig&#34;</span>
</span></span><span style="display:flex;"><span>$ KUBE_APISERVER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://192.168.4.110:6443&#34;</span> <span style="color:#75715e"># apiserver IP:PORT</span>
</span></span><span style="display:flex;"><span>$ TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bed185231bd89516f68ed5031946b9f9&#34;</span>  	<span style="color:#75715e"># ä¸token.csvé‡Œä¿æŒä¸€è‡´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆ kubelet bootstrap kubeconfig é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ kubectl config set-cluster kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--certificate-authority<span style="color:#f92672">=</span>/opt/kubernetes/ssl/ca.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--server<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_APISERVER<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>Cluster <span style="color:#e6db74">&#34;kubernetes&#34;</span> set.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-credentials <span style="color:#e6db74">&#34;kubelet-bootstrap&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--token<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>TOKEN<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>User <span style="color:#e6db74">&#34;kubelet-bootstrap&#34;</span> set.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-context default <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--cluster<span style="color:#f92672">=</span>kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--user<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;kubelet-bootstrap&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>Context <span style="color:#e6db74">&#34;default&#34;</span> created.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config use-context default --kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>Switched to context <span style="color:#e6db74">&#34;default&#34;</span>.</span></span></code></pre></div></blockquote>
<hr>
<h3 id="systemç®¡ç†kubelet"><code>system</code>ç®¡ç†<code>kubelet</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt; /usr/lib/systemd/system/kubelet.service <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes Kubelet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=docker.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EnvironmentFile=/opt/kubernetes/cfg/kubelet.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/kubernetes/bin/kubelet \$KUBELET_OPTS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">####################################################################</span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable kubelet systemctl start kubelet</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ‰¹å‡†kubeletè¯ä¹¦ç”³è¯·å¹¶åŠ å…¥é›†ç¾¤">æ‰¹å‡†<code>kubelet</code>è¯ä¹¦ç”³è¯·å¹¶åŠ å…¥é›†ç¾¤</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹kubeletè¯ä¹¦è¯·æ±‚</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get csr</span>
</span></span><span style="display:flex;"><span>NAME                                                   AGE     SIGNERNAME                                    REQUESTOR           CONDITION
</span></span><span style="display:flex;"><span>node-csr-Pbamt5FDLAwv0HlJpcgUP9B5c4ynIRe0Xa17zXq9I6E   4m16s   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰¹å‡†ç”³è¯·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl certificate approve node-csr-Pbamt5FDLAwv0HlJpcgUP9B5c4ynIRe0Xa17zXq9I6E</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>certificatesigningrequest.certificates.k8s.io/node-csr-Pbamt5FDLAwv0HlJpcgUP9B5c4ynIRe0Xa17zXq9I6E approved
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹èŠ‚ç‚¹,ç”±äºç½‘ç»œæ’ä»¶æ²¡æœ‰éƒ¨ç½²ï¼ŒèŠ‚ç‚¹çŠ¶æ€ NotReady</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get node</span>
</span></span><span style="display:flex;"><span>NAME         STATUS     ROLES    AGE   VERSION
</span></span><span style="display:flex;"><span>k8s-master   NotReady   &lt;none&gt;   71s   v1.18.3</span></span></code></pre></div></blockquote>
<hr>
<h3 id="éƒ¨ç½²kube-proxy">éƒ¨ç½²<code>kube-proxy</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 1. åˆ›å»ºé…ç½®kube-proxyæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/kube-proxy.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">KUBE_PROXY_OPTS=&#34;--logtostderr=false \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--v=2 \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--log-dir=/opt/kubernetes/logs \\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--config=/opt/kubernetes/cfg/kube-proxy-config.yml&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. é…ç½®å‚æ•°æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/kube-proxy-config.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: KubeProxyConfiguration
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">bindAddress: 0.0.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metricsBindAddress: 0.0.0.0:10249
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clientConnection:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kubeconfig: /opt/kubernetes/cfg/kube-proxy.kubeconfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hostnameOverride: k8s-master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">clusterCIDR: 10.0.0.0/24
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. ç”Ÿæˆkube-proxy.kubeconfigæ–‡ä»¶ï¼šç”Ÿæˆkube-proxyè¯ä¹¦ï¼š</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/ssl/kube-proxy-csr.json<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;CN&#34;: &#34;system:kube-proxy&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;hosts&#34;: [],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;key&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;algo&#34;: &#34;rsa&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;size&#34;: 2048
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;names&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;C&#34;: &#34;CN&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;L&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;ST&#34;: &#34;BeiJing&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;O&#34;: &#34;k8s&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;OU&#34;: &#34;System&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4.ç”Ÿæˆè¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ cd /opt/kubernetes/ssl/
</span></span><span style="display:flex;"><span>$ cfssl gencert -ca<span style="color:#f92672">=</span>ca.pem -ca-key<span style="color:#f92672">=</span>ca-key.pem -config<span style="color:#f92672">=</span>ca-config.json -profile<span style="color:#f92672">=</span>kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 5. ç”Ÿæˆkubeconfigæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ KUBE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/opt/kubernetes/cfg/kube-proxy.kubeconfig&#34;</span>
</span></span><span style="display:flex;"><span>$ KUBE_APISERVER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://192.168.4.110:6443&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ssl<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl config set-cluster kubernetes \</span>
</span></span><span style="display:flex;"><span>--certificate-authority<span style="color:#f92672">=</span>/opt/kubernetes/ssl/ca.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--server<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_APISERVER<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>Cluster <span style="color:#e6db74">&#34;kubernetes&#34;</span> set.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ssl<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl config set-credentials kube-proxy \</span>
</span></span><span style="display:flex;"><span>--client-certificate<span style="color:#f92672">=</span>./kube-proxy.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--client-key<span style="color:#f92672">=</span>./kube-proxy-key.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--embed-certs<span style="color:#f92672">=</span>true <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>User <span style="color:#e6db74">&#34;kube-proxy&#34;</span> set.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ssl<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl config set-context default \</span>
</span></span><span style="display:flex;"><span>--cluster<span style="color:#f92672">=</span>kubernetes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--user<span style="color:#f92672">=</span>kube-proxy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--kubeconfig<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>KUBE_CONFIG<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>Context <span style="color:#e6db74">&#34;default&#34;</span> created.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ssl<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl config use-context default --kubeconfig=${KUBE_CONFIG}</span>
</span></span><span style="display:flex;"><span>Switched to context <span style="color:#e6db74">&#34;default&#34;</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 6.systemç®¡ç†kube-proxy</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/kube-proxy.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Kubernetes Proxy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EnvironmentFile=/opt/kubernetes/cfg/kube-proxy.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/kubernetes/bin/kube-proxy \$KUBE_PROXY_OPTS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">########################################################################</span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable kube-proxy <span style="color:#f92672">&amp;&amp;</span> systemctl start kube-proxy</span></span></code></pre></div></blockquote>
<hr>
<h3 id="éƒ¨ç½²ç½‘ç»œç»„ä»¶">éƒ¨ç½²ç½‘ç»œç»„ä»¶</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><code>Calico</code>æ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„æ•°æ®ä¸­å¿ƒç½‘ç»œæ–¹æ¡ˆï¼Œæ˜¯ç›®å‰<code>Kubernetes</code>ä¸»æµçš„ç½‘ç»œæ–¹æ¡ˆã€‚éƒ¨ç½²<code>Calico</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/
</span></span><span style="display:flex;"><span>$ wget https://docs.projectcalico.org/v3.14/manifests/calico.yaml
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master src<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl apply -f calico.yaml  # ç­‰Calico Podéƒ½Runningï¼ŒèŠ‚ç‚¹ä¹Ÿä¼šå‡†å¤‡å°±ç»ª</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master src<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get node</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master src<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n kube-system</span>
</span></span><span style="display:flex;"><span>NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>calico-kube-controllers-65f8bc95db-27zj8   1/1     Running   <span style="color:#ae81ff">0</span>          37m
</span></span><span style="display:flex;"><span>calico-node-skvcj                          1/1     Running   <span style="color:#ae81ff">0</span>          37m</span></span></code></pre></div></blockquote>
<hr>
<h4 id="éƒ¨ç½²cniç½‘ç»œ">éƒ¨ç½²<code>CNI</code>ç½‘ç»œ</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å…ˆå‡†å¤‡å¥½<code>CNI</code>äºŒè¿›åˆ¶æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/cni/bin
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/
</span></span><span style="display:flex;"><span>$ wget https://github.com/containernetworking/plugins/releases/download/v0.8.6/cni-plugins-linux-amd64-v0.8.6.tgz  	<span style="color:#75715e"># ä¸‹è½½äºŒè¿›åˆ¶å®‰è£…åŒ…</span>
</span></span><span style="display:flex;"><span>$ tar zxvf cni-plugins-linux-amd64-v0.8.6.tgz -C /opt/cni/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># éƒ¨ç½²CNIç½‘ç»œ</span>
</span></span><span style="display:flex;"><span>$ cd /opt/kubernetes/cfg/
</span></span><span style="display:flex;"><span>$ wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</span></span><span style="display:flex;"><span>$ sed -i -r <span style="color:#e6db74">&#34;s#quay.io/coreos/flannel:.*-amd64#lizhenliang/flannel:v0.12.0-amd64#g&#34;</span> kube-flannel.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master cfg<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl apply -f kube-flannel.yml</span>
</span></span><span style="display:flex;"><span>podsecuritypolicy.policy/psp.flannel.unprivileged created
</span></span><span style="display:flex;"><span>clusterrole.rbac.authorization.k8s.io/flannel created
</span></span><span style="display:flex;"><span>clusterrolebinding.rbac.authorization.k8s.io/flannel created
</span></span><span style="display:flex;"><span>serviceaccount/flannel created
</span></span><span style="display:flex;"><span>configmap/kube-flannel-cfg created
</span></span><span style="display:flex;"><span>daemonset.apps/kube-flannel-ds created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master cfg<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pods -n kube-system</span>
</span></span><span style="display:flex;"><span>NAME                    READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>kube-flannel-ds-xv7db   1/1     Running   <span style="color:#ae81ff">0</span>          58s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master cfg<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get node</span>
</span></span><span style="display:flex;"><span>NAME         STATUS   ROLES    AGE   VERSION
</span></span><span style="display:flex;"><span>k8s-master   Ready    &lt;none&gt;   23m   v1.18.3</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->æˆæƒ<code>apiserver</code>è®¿é—®<code>kubelet</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/apiserver-to-kubelet-rbac.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rbac.authorization.kubernetes.io/autoupdate: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kubernetes.io/bootstrapping: rbac-defaults
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name: system:kube-apiserver-to-kubelet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - apiGroups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes/proxy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes/stats
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes/log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes/spec
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes/metrics
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - pods/log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    verbs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#34;*&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRoleBinding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: system:kube-apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  namespace: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">roleRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: system:kube-apiserver-to-kubelet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjects:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: User
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: kubernetes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##############################################################</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master cfg<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl apply -f apiserver-to-kubelet-rbac.yaml</span>
</span></span><span style="display:flex;"><span>clusterrole.rbac.authorization.k8s.io/system:kube-apiserver-to-kubelet created
</span></span><span style="display:flex;"><span>clusterrolebinding.rbac.authorization.k8s.io/system:kube-apiserver created</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ–°å¢åŠ worker-nodeæ‹·è´å·²éƒ¨ç½²å¥½çš„nodeç›¸å…³æ–‡ä»¶åˆ°æ–°èŠ‚ç‚¹">æ–°å¢åŠ <code>Worker Node:</code>æ‹·è´å·²éƒ¨ç½²å¥½çš„<code>Node</code>ç›¸å…³æ–‡ä»¶åˆ°æ–°èŠ‚ç‚¹</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœ¨<code>master</code>èŠ‚ç‚¹å°†<code>Worker Node</code>æ¶‰åŠæ–‡ä»¶æ‹·è´åˆ°å…¶ä»–å‡ ä¸ªæ–°èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># ansible node -i /etc/ansible/hosts -m copy -a &#34;src=../../opt/kubernetes dest=/opt/&#34; -f 5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># ansible node -i /etc/ansible/hosts -m copy -a &#34;src=../../opt/cni  dest=/opt/&#34; -f 5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># scp -r /usr/lib/systemd/system/{kubelet,kube-proxy}.service k8s-node-1:/usr/lib/systemd/system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span><span style="color:#75715e"># scp -r /usr/lib/systemd/system/{kubelet,kube-proxy}.service k8s-node-2:/usr/lib/systemd/system</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿™å‡ ä¸ªæ–‡ä»¶æ˜¯è¯ä¹¦ç”³è¯·å®¡æ‰¹åè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ¯ä¸ªNodeä¸åŒï¼Œå¿…é¡»åˆ é™¤å…¶ä»–å‡ ä¸ªèŠ‚ç‚¹åˆ é™¤kubeletè¯ä¹¦å’Œkubeconfigæ–‡ä»¶ï¼Œé‡æ–°ç”Ÿæˆ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># rm -rf /opt/kubernetes/cfg/kubelet.kubeconfig</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-2 ~<span style="color:#f92672">]</span><span style="color:#75715e"># rm -rf /opt/kubernetes/cfg/kubelet.kubeconfig </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># rm -f /opt/kubernetes/ssl/kubelet*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ä¸»æœºå</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#34;s/k8s-master/k8s-node-1/g&#34; /opt/kubernetes/cfg/kubelet.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#34;s/k8s-master/k8s-node-1/g&#34;  /opt/kubernetes/cfg/kube-proxy-config.yml </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-2 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#34;s/k8s-master/k8s-node-2/g&#34; /opt/kubernetes/cfg/kubelet.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-node-2 ~<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#34;s/k8s-master/k8s-node-2/g&#34;  /opt/kubernetes/cfg/kube-proxy-config.yml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨å…¶ä»–å‡ ä¸ªå‡ ç‚¹ç»™äºˆå¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œæƒé™ï¼Œ</span>
</span></span><span style="display:flex;"><span>$ chmod +x /opt/cni/bin/*
</span></span><span style="display:flex;"><span>$ chmod +x /opt/etcd/bin/*
</span></span><span style="display:flex;"><span>$ chmod +x /opt/kubernetes/bin/*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable kubelet <span style="color:#f92672">&amp;&amp;</span> systemctl start kubelet
</span></span><span style="display:flex;"><span>$ systemctl enable kube-proxy <span style="color:#f92672">&amp;&amp;</span> systemctl start kube-proxy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨Masteræ“ä½œæ‰¹å‡†Node kubeletè¯ä¹¦ç”³è¯·</span>
</span></span><span style="display:flex;"><span>$ kubectl get csr
</span></span><span style="display:flex;"><span>NAME                                                   AGE     SIGNERNAME                                    REQUESTOR           CONDITION
</span></span><span style="display:flex;"><span>node-csr-4vSZMnrv8OUR-zfD7dQYcDdi1L84Tv_nkNHlS8Iltfk   2m46s   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending
</span></span><span style="display:flex;"><span>node-csr-KRMLTPJj4yvk5Cb6s0n5T4HtFPYJ152PpDjYHLM3Ass   10s     kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending
</span></span><span style="display:flex;"><span>node-csr-Pbamt5FDLAwv0HlJpcgUP9B5c4ynIRe0Xa17zXq9I6E   71m     kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Approved,Issued
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl certificate approve node-csr-KRMLTPJj4yvk5Cb6s0n5T4HtFPYJ152PpDjYHLM3Ass
</span></span><span style="display:flex;"><span>$ kubectl certificate approve node-csr-4vSZMnrv8OUR-zfD7dQYcDdi1L84Tv_nkNHlS8Iltfk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># STATUS éƒ½æ˜¯Ready</span>
</span></span><span style="display:flex;"><span>$ kubectl get node
</span></span><span style="display:flex;"><span>NAME         STATUS   ROLES    AGE     VERSION
</span></span><span style="display:flex;"><span>k8s-master   Ready    &lt;none&gt;   70m     v1.18.3
</span></span><span style="display:flex;"><span>k8s-node-1   Ready    &lt;none&gt;   3m21s   v1.18.3
</span></span><span style="display:flex;"><span>k8s-node-2   Ready    &lt;none&gt;   3m2s    v1.18.3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># STATUS éƒ½æ˜¯Runing</span>
</span></span><span style="display:flex;"><span>$ kubectl get pod -n kube-system
</span></span><span style="display:flex;"><span>NAME                                       READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>calico-kube-controllers-65f8bc95db-27zj8   1/1     Running   <span style="color:#ae81ff">0</span>          65m
</span></span><span style="display:flex;"><span>calico-node-skvcj                          1/1     Running   <span style="color:#ae81ff">0</span>          65m
</span></span><span style="display:flex;"><span>calico-node-wc72m                          1/1     Running   <span style="color:#ae81ff">0</span>          2m22s
</span></span><span style="display:flex;"><span>calico-node-z5kmp                          1/1     Running   <span style="color:#ae81ff">0</span>          2m2s</span></span></code></pre></div></blockquote>
<hr>
<h4 id="åˆ›å»ºlocalçš„storage-class">åˆ›å»º<code>local</code>çš„<code>Storage Class</code></h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/data
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/storage-class.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: StorageClass
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: storage.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name: local-storage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">provisioner: kubernetes.io/no-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">volumeBindingMode: WaitForFirstConsumer
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰§è¡Œå‘½ä»¤åˆ›å»º</span>
</span></span><span style="display:flex;"><span>$ kubectl create -f storage-class.yml
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ä¸€ä¸‹åˆ›å»ºçš„storage class</span>
</span></span><span style="display:flex;"><span>$ kubectl get sc</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åˆ›å»º<code>PV</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/pv-sdc.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: PersistentVolume
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name: local-pv-sdc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">capacity:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storage: 30Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">accessModes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - ReadWriteOnce
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  persistentVolumeReclaimPolicy: Retain
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  storageClassName: local-storage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  local:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    path: /opt/data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  nodeAffinity:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    required:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      nodeSelectorTerms:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - matchExpressions:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - key: kubernetes.io/hostname
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          operator: In
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          values:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - cka
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰§è¡Œåˆ›å»ºå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ kubectl create -f pv-sdc.yml
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master cfg<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pv</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ›å»º<code>PVC</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/kubernetes/cfg/pvc1.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: PersistentVolumeClaim
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name: pvc1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">accessModes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - ReadWriteOnce
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  storageClassName: local-storage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      storage: 10Gi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>$ kubectl create -f pvc1.yml</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted --><code>PVC</code>å°†ä¼šä¸€ç›´å¤„äº<code>Pending</code>çŠ¶æ€ç›´åˆ°æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>Pod</code>ä½¿ç”¨å®ƒ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master cfg<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pvc</span>
</span></span><span style="display:flex;"><span>NAME      STATUS    VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS    AGE
</span></span><span style="display:flex;"><span>pvc1      Pending                                       local-storage   5s</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_k8s_rancher">Install_K8s_Rancher</h1>

<h2 id="å®‰è£…rancherå›¾å½¢åŒ–ç®¡ç†">å®‰è£…<code>Rancher</code>å›¾å½¢åŒ–ç®¡ç†</h2>
<ul>
<li>
<ol>
<li><code>Rancher</code>æ˜¯ä¾›é‡‡ç”¨å®¹å™¨çš„å›¢é˜Ÿä½¿ç”¨çš„å®Œæ•´è½¯ä»¶å †æ ˆã€‚å®ƒè§£å†³äº†ç®¡ç†å¤šä¸ª</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>Kubernetes</code>é›†ç¾¤çš„è¿è¥å’Œå®‰å…¨æŒ‘æˆ˜ï¼Œå¹¶ä¸º<code>DevOps</code>å›¢é˜Ÿæä¾›ç”¨äºè¿è¡Œå®¹å™¨åŒ–å·¥ä½œè´Ÿè½½çš„é›†æˆå·¥å…·</li>
</ol>
</li>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¿…é¡»å­˜åœ¨<!-- raw HTML omitted --><code>Docker</code><!-- raw HTML omitted -->ç¯å¢ƒ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>æœåŠ¡å™¨</th>
<th><code>IP</code></th>
<th>å†…å­˜</th>
<th>CPU</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>master</code></td>
<td>192.168.35.128</td>
<td>8G</td>
<td>8<code>core</code></td>
</tr>
<tr>
<td><code>node-1</code></td>
<td>192.168.35.129</td>
<td>4G</td>
<td>4<code>core</code></td>
</tr>
<tr>
<td><code>node-2</code></td>
<td>192.168.35.130</td>
<td>4G</td>
<td>4<code>core</code></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="å®‰è£…åŸºç¡€ç¯å¢ƒ">å®‰è£…åŸºç¡€ç¯å¢ƒ</h3>
<ul>
<li>
<ol>
<li><code>Nano</code><!-- raw HTML omitted -->ï¼šè¶…è½»é‡çº§å¼€æºäº‘å¹³å°<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Naco</code>ï¼šåŸºäº<code>KVM</code>æŠ€æœ¯ï¼Œä½¿ç”¨<code>Go</code>è¯­è¨€å¼€å‘ï¼Œç®€å•æ˜“å­¦çš„è™šæ‹Ÿæœºç®¡ç†è½¯ä»¶ï¼Œä»<code>Web</code>ç®¡ç†é—¨æˆ·ã€ä¸»æœºç›‘æ§ã€é•œåƒå…‹éš†åˆ°æ•…éšœåˆ‡æ¢ï¼ŒåŠŸèƒ½å®Œå¤‡ï¼Œå¼€ç®±å³ç”¨ï¼Œæ•°åˆ†é’Ÿä¹‹å†…å³å¯å°†æ‚¨çš„æœåŠ¡å™¨é›†ç¾¤å‡çº§ä¸ºäº‘ä¸»æœºå¹³å°</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y nano</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åœ¨æ‰€æœ‰èŠ‚ç‚¹éƒ½å®‰è£…<!-- raw HTML omitted --><code>Docker</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ENV configuration  </span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/swap / s/^\(.*\)$/#\1/g&#39;</span> /etc/fstab  
</span></span><span style="display:flex;"><span>$ swapoff -a 
</span></span><span style="display:flex;"><span>$ modprobe br_netfilter  
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;br_netfilter&#34;</span> &gt; /etc/modules-load.d/br_netfilter.conf  
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;net.bridge.bridge-nf-call-iptables = 1&#34;</span> &gt;&gt; /etc/sysctl.conf  
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;net.ipv4.ip_forward = 1&#34;</span> &gt;&gt; /etc/sysctl.conf  
</span></span><span style="display:flex;"><span>$ sysctl -p  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/#AllowTcpForwarding/AllowTcpForwarding/g&#39;</span> /etc/ssh/sshd_config  
</span></span><span style="display:flex;"><span>$ systemctl reload sshd  
</span></span><span style="display:flex;"><span>$ systemctl stop firewalld <span style="color:#f92672">&amp;&amp;</span> systemctl disable firewalld  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;</span> /etc/selinux/config  
</span></span><span style="display:flex;"><span>$ setenforce <span style="color:#ae81ff">0</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># timedate configration  </span>
</span></span><span style="display:flex;"><span>$ timedatectl set-timezone Asia/Shanghai  
</span></span><span style="display:flex;"><span>$ yum install -y chrony  
</span></span><span style="display:flex;"><span>$ systemctl start chronyd <span style="color:#f92672">&amp;&amp;</span> sudo systemctl enable chronyd 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum install -y yum-utils  
</span></span><span style="display:flex;"><span>$ yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo  
</span></span><span style="display:flex;"><span>$ yum install -y docker-ce-19.03.9 docker-ce-cli-19.03.9 --nogpgcheck  
</span></span><span style="display:flex;"><span>$ systemctl enable docker <span style="color:#f92672">&amp;&amp;</span> systemctl start docker  </span></span></code></pre></div></blockquote>
<hr>
<h3 id="å®‰è£…rancher-v265">å®‰è£…<code>Rancher v2.6.5</code></h3>
<ul>
<li>
<ol>
<li><a href="https://rancher.com/docs/rancher/v2.6/en/installation/other-installation-methods/single-node-docker/" rel="external" target="_self">ä½¿ç”¨<code>Docker</code>åœ¨å•èŠ‚ç‚¹ä¸Šå®‰è£…<code>Rancher</code></a></li>
</ol>
</li>
<li>
<ol start="2">
<li><code>Rancher v2.6.5</code><!-- raw HTML omitted -->æ”¯æŒçš„<!-- raw HTML omitted --><code>Kubernetes Versions</code><!-- raw HTML omitted -->ç‰ˆæœ¬<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>v1.23.6 Default</code></li>
<li><code>v1.22.9</code></li>
<li><code>v1.21.12</code></li>
<li><code>v1.20.15</code></li>
<li><code>v1.19.16</code></li>
<li><code>v1.18.20</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker pull rancher/rancher:v2.6.5
</span></span><span style="display:flex;"><span>$ docker run -d --restart<span style="color:#f92672">=</span>unless-stopped -p 888:80 -p 4443:443 --privileged rancher/rancher:v2.6.5 </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><a href="https://rancher.com/docs/rancher/v2.6/en/installation/install-rancher-on-k8s/" rel="external" target="_self">åœ¨<code>Kubernetes</code>é›†ç¾¤ä¸Šå®‰è£…/å‡çº§<code>Rancher</code></a></li>
</ol>
</li>
</ul>
<hr>
<h3 id="font-colorredåœ¨fontkubernetesfont-colorredé›†ç¾¤ä¸Šå®‰è£…å‡çº§fontrancher"><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>Kubernetes</code><!-- raw HTML omitted -->é›†ç¾¤ä¸Šå®‰è£…/å‡çº§<!-- raw HTML omitted --><code>Rancher</code></h3>
<ul>
<li>
<ol>
<li><a href="https://helm.sh/docs/intro/install/" rel="external" target="_self">å®‰è£…<code>Helm</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://blog.csdn.net/qq_37481017/article/details/119002325" rel="external" target="_self">åŸºäº<code>K8S 1.21.2</code>é›†ç¾¤å®‰è£…<code>Rancher 2.5.9 HA</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨äºŒè¿›åˆ¶å®‰è£…Helm</span>
</span></span><span style="display:flex;"><span>$ wget https://get.helm.sh/helm-v3.9.0-linux-amd64.tar.gz  
</span></span><span style="display:flex;"><span>$ tar -zxvf helm-v3.9.0-linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv linux-amd64/helm /usr/local/bin/helm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è„šæœ¬å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">700</span> get_helm.sh
</span></span><span style="display:flex;"><span>$ ./get_helm.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æºä»£ç å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ git clone https://github.com/helm/helm.git
</span></span><span style="display:flex;"><span>$ cd helm
</span></span><span style="display:flex;"><span>$ make</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>cert-manager</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create namespace cert-manager
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ Jetstack Helmå­˜å‚¨åº“</span>
</span></span><span style="display:flex;"><span>$ helm repo add jetstack https://charts.jetstack.io
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ–°æœ¬åœ° Helm å›¾è¡¨å­˜å‚¨åº“ç¼“å­˜</span>
</span></span><span style="display:flex;"><span>$ helm repo update
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…cert-managerè‡ªå®šä¹‰æ‰€éœ€çš„è‡ªå®šä¹‰èµ„æº</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.7.1/cert-manager.crds.yaml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ helm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --version v1.7.1 --set installCRDs<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># éªŒè¯cert-managerè¯ä¹¦ç®¡ç†å™¨æ˜¯å¦å®‰è£…æˆåŠŸ</span>
</span></span><span style="display:flex;"><span>$ kubectl get pods --namespace cert-manager</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Helm</code><!-- raw HTML omitted -->å®‰è£…ç¨³å®šç‰ˆ<!-- raw HTML omitted --><code>Rancher</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¸ºRancheråˆ›å»ºå‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>$ kubectl create namespace cattle-system
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ  Helm æ·»åŠ  Rancher åº“</span>
</span></span><span style="display:flex;"><span>$ helm repo add rancher-stable https://releases.rancher.com/server-charts/stable</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>helm</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Rancher</code><!-- raw HTML omitted -->æ³¨æ„é€‰å¥½ç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¸å¯¹ä¼šæŠ¥é”™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install rancher rancher-stable/rancher --namespace cattle-system --set hostname<span style="color:#f92672">=</span>my.rancher.org --set bootstrapPassword<span style="color:#f92672">=</span>admin --set replicas<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> --version 2.6.3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --set ingress.tls.source=letsEncrypt \</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  --set letsEncrypt.email=&lt;caviardÃ©&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME: rancher
</span></span><span style="display:flex;"><span>LAST DEPLOYED: Wed May <span style="color:#ae81ff">25</span> 18:01:51 <span style="color:#ae81ff">2022</span>
</span></span><span style="display:flex;"><span>NAMESPACE: cattle-system
</span></span><span style="display:flex;"><span>STATUS: deployed
</span></span><span style="display:flex;"><span>REVISION: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>TEST SUITE: None
</span></span><span style="display:flex;"><span>NOTES:
</span></span><span style="display:flex;"><span>Rancher Server has been installed.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NOTE: Rancher may take several minutes to fully initialize. Please standby <span style="color:#66d9ef">while</span> Certificates are being issued, Containers are started and the Ingress rule comes up.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Check out our docs at https://rancher.com/docs/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>If you provided your own bootstrap password during installation, browse to https://my.rancher.org to get started.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>If this is the first time you installed Rancher, get started by running this command and clicking the URL it generates:</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo https://my.rancher.org/dashboard/?setup<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get secret --namespace cattle-system bootstrap-secret -o go-template<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{{.data.bootstrapPassword|base64decode}}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># To get just the bootstrap password on its own, run:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl get secret --namespace cattle-system bootstrap-secret -o go-template<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{{.data.bootstrapPassword|base64decode}}{{ &#34;\n&#34; }}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Happy Containering!</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ç­‰å¾…<!-- raw HTML omitted --><code>Rancher</code><!-- raw HTML omitted -->å®‰è£…æˆåŠŸ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl -n cattle-system rollout status deploy/rancher
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl get pods -o wide -n cattle-system
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl get pods --show-labels -n cattle-system</span></span></code></pre></div></blockquote>
<hr>
<h2 id="æµè§ˆå™¨ç™»å½•rancheré¡µé¢è®¾ç½®">æµè§ˆå™¨ç™»å½•<code>Rancher</code>é¡µé¢è®¾ç½®</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><strong>é»˜è®¤ç”¨æˆ·åï¼š</strong><!-- raw HTML omitted --><code>admin</code></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å¯†ç æ–°è®¾ç½®æˆ–è€…éšæœºç”Ÿæˆ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-a81ca3cb889f11d5fda895f77bb3588d" class="lightbox-link"><img alt="è®¾ç½®Rancherå¯†ç " class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_18-29-03.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a81ca3cb889f11d5fda895f77bb3588d"><img alt="è®¾ç½®Rancherå¯†ç " class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_18-29-03.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>Rancher Server</code><!-- raw HTML omitted -->åœ°å€<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->æˆ–è€…åŸŸå<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-4a31d2d9bc3cdfd051049645546701b7" class="lightbox-link"><img alt="è®¾å®šRancheråœ°å€" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_18-31-17.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4a31d2d9bc3cdfd051049645546701b7"><img alt="è®¾å®šRancheråœ°å€" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_18-31-17.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>Rancher</code><!-- raw HTML omitted -->ä¸­æ–‡é¡µé¢<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-e775e187dd0bdee27c6d7ea20739f6f3" class="lightbox-link"><img alt="set-chinses" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/set-Chinses.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e775e187dd0bdee27c6d7ea20739f6f3"><img alt="set-chinses" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/set-Chinses.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ç™»å½•åå¯ä»¥çœ‹åˆ°ç›®å‰<!-- raw HTML omitted --><code>Rancher</code><!-- raw HTML omitted -->æ‰€ç®¡ç†åªæœ‰<!-- raw HTML omitted --><code>Rancher</code><!-- raw HTML omitted -->æœ¬èº«å­˜åœ¨<!-- raw HTML omitted --><code>K3S</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>5.1 <code>Rancher Labs</code>æ¨å‡º<code>Kubernetes</code>å¼€æº<code>K3S</code>æ˜¯ä¸€ä¸ªè½»é‡çº§ï¼Œåªæœ‰<code>40MB</code>å¤§å°ï¼Œæ˜“äºå®‰è£…<code>Kubernetes</code>å‘å¸ƒç‰ˆæœ¬ï¼Œè½¬ä¸ºèµ„æºæœ‰é™å’Œä½äº’åŠ¨ç³»ç»Ÿè®¾è®¡ï¼Œé€‚ç”¨äºè¾¹ç¼˜åº”ç”¨ã€ç‰©è”ç½‘ã€æŒç»­æ•´åˆä»¥åŠ<code>ARM</code>ç­‰</li>
</ul>
<p><a href="#R-image-bd7096de2f5b29a4c609d82f3c0eac6f" class="lightbox-link"><img alt="åˆæ¬¡ç™»å½•é¡µé¢" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_18-34-35.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bd7096de2f5b29a4c609d82f3c0eac6f"><img alt="åˆæ¬¡ç™»å½•é¡µé¢" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_18-34-35.png"></a></p>
</blockquote>
<hr>
<h2 id="ä½¿ç”¨rancheråˆ›å»ºrke-kubernetesé›†ç¾¤">ä½¿ç”¨<code>Rancher</code>åˆ›å»º<code>RKE Kubernetes</code>é›†ç¾¤</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç­‰å¾…è¢«åˆ›å»ºçš„é›†ç¾¤éƒ½æ˜¯åŸºäºæ•°ä¸ªå®ä½“æœåŠ¡å™¨æˆ–è™šæ‹Ÿæœºç»„æˆï¼Œå…¶ä¸­è¿™äº›æœºå™¨ç¡¬ä»¶æœ€ä½è¦æ±‚<!-- raw HTML omitted --><code>1Cores</code>ã€<code>1GB</code><!-- raw HTML omitted -->å¹¶ä¸”éœ€è¦æå‰å®‰è£…å¥½<!-- raw HTML omitted --><code>Docker</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»ç¬¦åˆ<!-- raw HTML omitted --><code>RKE</code><a href="https://docs.rancher.cn/docs/rke/os/_index/" rel="external" target="_self">å®‰è£…è¦æ±‚</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç”Ÿäº§ç¯å¢ƒä¸‹ä¸å…è®¸æŠŠ<!-- raw HTML omitted --><code>worker</code><!-- raw HTML omitted -->è§’è‰²æ·»åŠ å…·æœ‰<!-- raw HTML omitted --><code>etcd</code><!-- raw HTML omitted -->æˆ–<!-- raw HTML omitted --><code>control plane</code><!-- raw HTML omitted -->è§’è‰²èŠ‚ç‚¹ä¸­<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<hr>
<h3 id="webé¡µé¢é…ç½®kubernetes-clusteré›†ç¾¤"><code>Web</code>é¡µé¢é…ç½®<code>Kubernetes Cluster</code>é›†ç¾¤</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>Rancher</code><!-- raw HTML omitted -->æµè§ˆå™¨é¡µé¢ä¸­æ·»åŠ <!-- raw HTML omitted --><code>Kubernetes Cluster</code></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-e64d68d5b8a354369fd9716c69248fd1" class="lightbox-link"><img alt="Add-K8s-Cluster" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Add-Cluster.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e64d68d5b8a354369fd9716c69248fd1"><img alt="Add-K8s-Cluster" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Add-Cluster.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é€‰æ‹©<!-- raw HTML omitted --><code>Existing nodes(è‡ªå®šä¹‰é›†ç¾¤)</code></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-fcf27d5bcda04ec405518a28f04ee2e1" class="lightbox-link"><img alt="è‡ªå®šä¹‰é›†ç¾¤" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Add-Nodes.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fcf27d5bcda04ec405518a28f04ee2e1"><img alt="è‡ªå®šä¹‰é›†ç¾¤" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Add-Nodes.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å®šä¹‰é›†ç¾¤åç§°ã€ç„¶åä¸‹ä¸€æ­¥<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-de0d2bfe698a34f499e06e60e3c9e793" class="lightbox-link"><img alt="å¡«å†™é›†ç¾¤åç§°" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_20-41-58.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-de0d2bfe698a34f499e06e60e3c9e793"><img alt="å¡«å†™é›†ç¾¤åç§°" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_20-41-58.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å…ˆé€‰æ‹©<!-- raw HTML omitted --><code>etcd</code>ã€<code>Control Plane</code><!-- raw HTML omitted -->è§’è‰²ï¼ŒæŠŠç”Ÿæˆçš„å‘½ä»¤å¤åˆ¶åˆ°èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œç„¶åä¸‹ä¸€æ­¥<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-6e538c1d918c81758b123dce3f9a16b6" class="lightbox-link"><img alt="éƒ¨ç½²etcd Control Plane" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_21-14-45.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6e538c1d918c81758b123dce3f9a16b6"><img alt="éƒ¨ç½²etcd Control Plane" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_21-14-45.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->é€‰æ‹©<!-- raw HTML omitted --><code>Worker</code><!-- raw HTML omitted -->å·¥ä½œèŠ‚ç‚¹,æŠŠç”Ÿæˆçš„å‘½ä»¤å¤åˆ¶åˆ°èŠ‚ç‚¹æ‰§è¡Œ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-479af13bd51c34e9d12b77b5f5c5fda8" class="lightbox-link"><img alt="é€‰æ‹©<code>Worker</code>å·¥ä½œèŠ‚ç‚¹" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_21-15-51.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-479af13bd51c34e9d12b77b5f5c5fda8"><img alt="é€‰æ‹©<code>Worker</code>å·¥ä½œèŠ‚ç‚¹" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_21-15-51.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œç­‰å¾…èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼ŒæˆåŠŸåä¸‹æ–¹æ˜¾ç¤ºæ·»åŠ æˆåŠŸ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-7720dadc6ed7104632cc1c61e8192325" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_21-20-56.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7720dadc6ed7104632cc1c61e8192325"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-19_21-20-56.png"></a></p>
</blockquote>
<hr>
<h3 id="å¦‚æœé”™è¿‡å¤åˆ¶æ·»åŠ å‘½ä»¤é€‰æ‹©å‘½åç©ºé—´ç‚¹å‡»edit">å¦‚æœé”™è¿‡å¤åˆ¶æ·»åŠ å‘½ä»¤é€‰æ‹©å‘½åç©ºé—´ç‚¹å‡»<code>Edit</code></h3>
<blockquote>
<p><a href="#R-image-1e4118c7826515ba873258554e4c84ee" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-42-56.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1e4118c7826515ba873258554e4c84ee"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-42-56.png"></a></p>
<p><a href="#R-image-5c37d3122d6abf6deb081c576eb84d6d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-44-52.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5c37d3122d6abf6deb081c576eb84d6d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-44-52.png"></a></p>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_k8s_kubesphere">Install_K8s_KubeSphere</h1>

<h2 id="åœ¨ç°æœ‰kubernetesä¸Šå®‰è£…kubesphere-webç®¡ç†ç³»ç»Ÿ">åœ¨ç°æœ‰<code>Kubernetes</code>ä¸Šå®‰è£…<code>KubeSphere Web</code>ç®¡ç†ç³»ç»Ÿ</h2>
<!-- raw HTML omitted -->
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://kuboard.cn/" rel="external" target="_self"><code>Kuboard</code>ä¸€æ¬¾å…è´¹çš„<code>Kubernetes</code>ç®¡ç†ç•Œé¢</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="https://kubeoperator.io/" rel="external" target="_self"><code>KubeOperator</code>å¯è§†åŒ–çš„<code>Web UI</code></a></li>
</ol>
</li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li>å¦‚éœ€åœ¨<code>Kubernetes</code>ä¸Šå®‰è£…<code>KubeSphere 3.3.0</code>ï¼Œæ‚¨çš„<code>Kubernetes</code>ç‰ˆæœ¬å¿…é¡»ä¸ºï¼š<code>v1.19.xï¼Œv1.20.xï¼Œv1.21.xï¼Œv1.22.x æˆ– v1.23.x</code>ï¼ˆå®éªŒæ€§æ”¯æŒï¼‰</li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç¡®ä¿æ‚¨çš„æœºå™¨æ»¡è¶³æœ€ä½ç¡¬ä»¶è¦æ±‚ï¼š<!-- raw HTML omitted --><code>CPU &gt; 1æ ¸</code>ã€<code>å†…å­˜ &gt; 2GB</code></li>
</ol>
</li>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åœ¨å®‰è£…ä¹‹å‰ï¼Œéœ€è¦é…ç½®<!-- raw HTML omitted --><code>Kubernetes</code><!-- raw HTML omitted -->é›†ç¾¤ä¸­çš„<!-- raw HTML omitted --><code>é»˜è®¤</code><!-- raw HTML omitted -->å­˜å‚¨ç±»å‹ï¼Œä»¥ä¾¿å®ç°åŠ¨æ€ä¾›åº”<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>NFS</code><!-- raw HTML omitted -->çš„åŠ¨æ€ä¾›åº”çš„é»˜è®¤å­˜å‚¨ç±»<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/k8s/yaml/data-storage.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ›å»ºä¸€ä¸ªå­˜å‚¨ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: storage.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: StorageClass
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	name: nfs-storage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		storageclass.kubernetes.io/is-default-class: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">provisioner: k8s-sigs.io/nfs-subdir-external-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">parameters:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	archiveOnDelete: &#34;true&#34;  	# åˆ é™¤pvçš„æ—¶å€™ï¼Œpvçš„å†…å®¹æ˜¯å¦è¦å¤‡ä»½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: apps/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Deployment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	name: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		app: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# replace with namespace where provisioner is deployed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	replicas: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	strategy:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		type: Recreate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		matchLabels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			app: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	template:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				app: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			serviceAccountName: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				- name: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				  image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/nfs-subdir-external-provisioner:v4.0.2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				  # resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  # limits:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						  # cpu: 10m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  # requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						  # cpu: 10m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				  volumeMounts:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  - name: nfs-client-root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						mountPath: /persistentvolumes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				  env:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  - name: PROVISIONER_NAME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						value: k8s-sigs.io/nfs-subdir-external-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  - name: NFS_SERVER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						value: 192.168.94.110  	# æŒ‡å®šè‡ªå·±nfsæœåŠ¡å™¨åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  - name: NFS_PATH  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">						value: /opt/data/kubesphere  	# nfsæœåŠ¡å™¨å…±äº«çš„ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			volumes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				- name: nfs-client-root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				  nfs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  server: 192.168.94.110
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					  path: /opt/data/kubesphere
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # replace with namespace where provisioner is deployed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: nfs-client-provisioner-runner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups: [&#34;&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources: [&#34;nodes&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups: [&#34;&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources: [&#34;persistentvolumes&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;, &#34;create&#34;, &#34;delete&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups: [&#34;&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources: [&#34;persistentvolumeclaims&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;, &#34;update&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups: [&#34;storage.k8s.io&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources: [&#34;storageclasses&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups: [&#34;&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources: [&#34;events&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs: [&#34;create&#34;, &#34;update&#34;, &#34;patch&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRoleBinding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: run-nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjects:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      # replace with namespace where provisioner is deployed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">roleRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: nfs-client-provisioner-runner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Role
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: leader-locking-nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # replace with namespace where provisioner is deployed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups: [&#34;&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources: [&#34;endpoints&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;, &#34;create&#34;, &#34;update&#34;, &#34;patch&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: RoleBinding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: leader-locking-nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # replace with namespace where provisioner is deployed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjects:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      # replace with namespace where provisioner is deployed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">roleRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: Role
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: leader-locking-nfs-client-provisioner
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->é…ç½®é›†ç¾¤æŒ‡æ ‡ç›‘æ§ç»„ä»¶<!-- raw HTML omitted --><a href="https://github.com/kubernetes-sigs/metrics-server" rel="external" target="_self"><code>Kubernetes</code>æŒ‡æ ‡æœåŠ¡å™¨</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>5.1 <code>- --kubelet-insecure-tls</code>ï¼š<code>kubelet</code>çš„<code>10250</code>ç«¯å£ä½¿ç”¨çš„æ˜¯<code>https</code>åè®®ï¼Œè¿æ¥éœ€è¦éªŒè¯<code>tls</code>è¯ä¹¦ï¼Œ<code>--kubelet-insecure-tls</code><!-- raw HTML omitted -->ä¸éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä»…ç”¨äºæµ‹è¯•ç›®çš„<!-- raw HTML omitted --></li>
<li>5.2 <a href="https://github.com/kubernetes/kube-state-metrics" rel="external" target="_self"><code>kube-state-metrics</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/k8s/yaml/metrics_server.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        rbac.authorization.k8s.io/aggregate-to-admin: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        rbac.authorization.k8s.io/aggregate-to-edit: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        rbac.authorization.k8s.io/aggregate-to-view: &#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: system:aggregated-metrics-reader
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - metrics.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - pods
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - get
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - list
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - watch
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: system:metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - apiGroups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      resources:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - pods
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - nodes/stats
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - namespaces
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - configmaps
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      verbs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - get
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - list
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - watch
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: RoleBinding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: metrics-server-auth-reader
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">roleRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: Role
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: extension-apiserver-authentication-reader
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjects:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRoleBinding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: metrics-server:system:auth-delegator
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">roleRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: system:auth-delegator
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjects:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterRoleBinding
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: system:metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">roleRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    kind: ClusterRole
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: system:metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjects:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kind: ServiceAccount
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - name: https
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          port: 443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          protocol: TCP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          targetPort: https
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: apps/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Deployment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        matchLabels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    strategy:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        rollingUpdate:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            maxUnavailable: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    template:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                - args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    - --cert-dir=/tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    - --kubelet-insecure-tls
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    - --secure-port=4443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    - --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    - --kubelet-use-node-status-port
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    image: k8s.gcr.io/metrics-server/metrics-server:v0.6.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    # image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/metrics-server:v0.4.3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    imagePullPolicy: IfNotPresent
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    livenessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        failureThreshold: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        httpGet:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            path: /livez
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            port: https
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            scheme: HTTPS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        periodSeconds: 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        - containerPort: 4443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          name: https
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          protocol: TCP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    readinessProbe:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        failureThreshold: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        httpGet:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            path: /readyz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            port: https
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                            scheme: HTTPS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        periodSeconds: 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    securityContext:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        readOnlyRootFilesystem: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        runAsNonRoot: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        runAsUser: 1000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    volumeMounts:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        - mountPath: /tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                          name: tmp-dir
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            nodeSelector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                kubernetes.io/os: linux
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            priorityClassName: system-cluster-critical
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            serviceAccountName: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            volumes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                - emptyDir: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  name: tmp-dir
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: apiregistration.k8s.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: APIService
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        k8s-app: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: v1beta1.metrics.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    group: metrics.k8s.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    groupPriorityMinimum: 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    insecureSkipTLSVerify: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    service:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        name: metrics-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        namespace: kube-system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    version: v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    versionPriority: 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>5.1 <!-- raw HTML omitted -->æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹<!-- raw HTML omitted --><code>Node</code>èŠ‚ç‚¹ç»“æœ</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl top nodes
</span></span><span style="display:flex;"><span>NAME            CPU<span style="color:#f92672">(</span>cores<span style="color:#f92672">)</span>   CPU%   MEMORY<span style="color:#f92672">(</span>bytes<span style="color:#f92672">)</span>   MEMORY%   
</span></span><span style="display:flex;"><span>k8s-master-01   148m         7%     3690Mi          46%       
</span></span><span style="display:flex;"><span>k8s-node-01     35m          1%     492Mi           8%        
</span></span><span style="display:flex;"><span>k8s-node-02     32m          1%     358Mi           6%</span></span></code></pre></div><ul>
<li>5.2 <!-- raw HTML omitted -->æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹<!-- raw HTML omitted --><code>Pod</code>çŠ¶æ€</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$  kubectl top pods -A
</span></span><span style="display:flex;"><span>NAMESPACE       NAME                                        CPU<span style="color:#f92672">(</span>cores<span style="color:#f92672">)</span>  MEMORY<span style="color:#f92672">(</span>bytes<span style="color:#f92672">)</span>   
</span></span><span style="display:flex;"><span>default         nfs-client-provisioner-6f9769d4c4-h6jw9     3m           12Mi 
</span></span><span style="display:flex;"><span>ingress-nginx   ingress-nginx-controller-5fd8bfcbdc-bzppj   2m           96Mi
</span></span><span style="display:flex;"><span>kube-flannel    kube-flannel-ds-6tl2b                       5m           33Mi
</span></span><span style="display:flex;"><span>kube-flannel    kube-flannel-ds-n4k68                       3m           33Mi 
</span></span><span style="display:flex;"><span>kube-flannel    kube-flannel-ds-zkqhz                       3m           33Mi 
</span></span><span style="display:flex;"><span>kube-system     coredns-64897985d-6r9ds                     2m           17Mi
</span></span><span style="display:flex;"><span>kube-system     coredns-64897985d-fwmz5                     2m           14Mi
</span></span><span style="display:flex;"><span>kube-system     etcd-k8s-master-01                          20m          112Mi
</span></span><span style="display:flex;"><span>kube-system     kube-apiserver-k8s-master-01                63m          237Mi
</span></span><span style="display:flex;"><span>kube-system     kube-controller-manager-k8s-master-01       20m          50Mi 
</span></span><span style="display:flex;"><span>kube-system     kube-proxy-blnt7                            1m           18Mi 
</span></span><span style="display:flex;"><span>kube-system     kube-proxy-k5gkm                            1m           17Mi
</span></span><span style="display:flex;"><span>kube-system     kube-proxy-xpvqr                            1m           17Mi
</span></span><span style="display:flex;"><span>kube-system     kube-scheduler-k8s-master-01                5m           21Mi
</span></span><span style="display:flex;"><span>kube-system     metrics-server-658c4cf555-bpfcf             5m           19Mi</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->ä¸‹è½½ã€å®‰è£…<!-- raw HTML omitted --><code>KubeSphere</code>çš„<code>yaml</code>æ–‡ä»¶</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /opt/k8s/yaml/kubesphere/ https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/kubesphere-installer.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget -P /opt/k8s/yaml/kubesphere/ https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/cluster-configuration.yaml</span></span></code></pre></div><ul>
<li>6.1 ä¿®æ”¹<code>cluster-configuration</code>æ–‡ä»¶<code>å¯ç”¨å¯æ’æ‹”ç»„ä»¶</code></li>
</ul>
<blockquote>
<ul>
<li>6.1.1 <a href="https://kubesphere.com.cn/docs/v3.3/pluggable-components/overview/" rel="external" target="_self">å®˜ç½‘<!-- raw HTML omitted -->å¯ç”¨å¯æ’æ‹”ç»„ä»¶<!-- raw HTML omitted --></a></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterConfiguration</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ks-installer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kubesphere-system</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">version</span>: <span style="color:#ae81ff">v3.3.0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistence</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageClass</span>: <span style="color:#e6db74">&#34;&#34;</span>  	<span style="color:#75715e"># If there is no default StorageClass in your cluster, you need to specify an existing StorageClass here.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">authentication</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jwtSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>  	<span style="color:#75715e"># Keep the jwtSecret consistent with the Host Cluster. Retrieve the jwtSecret by executing &#34;kubectl -n kubesphere-system get cm kubesphere-config -o yaml | grep -v &#34;apiVersion&#34; | grep jwtSecret&#34; on the Host Cluster.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">local_registry</span>: <span style="color:#e6db74">&#34;&#34;</span>  	<span style="color:#75715e"># Add your private registry address if it is needed.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># dev_tag: &#34;&#34;  	# Add your kubesphere image tag you want to install, by default it&#39;s same as ks-installer release version.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">etcd</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">monitoring</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ etcd ç›‘æ§ä»ªè¡¨æ¿å®‰è£…ã€‚ åœ¨å¯ç”¨ä¹‹å‰ï¼Œæ‚¨å¿…é¡»ä¸º etcd åˆ›å»ºä¸€ä¸ª Secretï¼Œ å¯ç”¨ä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">endpointIps</span>: <span style="color:#ae81ff">192.168.94.110</span>  	<span style="color:#75715e"># etcd é›†ç¾¤ EndpointIpsã€‚ è¿™é‡Œå¯ä»¥æ˜¯ä¸€å †IPã€‚</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">2379</span>  	<span style="color:#75715e"># etcd port.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tlsEnable</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">common</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">core</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">console</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">enableMultiLogin</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># Enable or disable simultaneous logins. It allows different users to log in with the same account at the same time.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">port</span>: <span style="color:#ae81ff">30880</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># apiserver:  	# Enlarge the apiserver and controller manager&#39;s resource requests and limits for the large cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#  resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># controllerManager:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#  resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">redis</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨ Redis åŠŸèƒ½ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enableHA</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeSize</span>: <span style="color:#ae81ff">2Gi  	# Redis PVC size.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">openldap</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨è½»é‡çº§ç›®å½•åè®®ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeSize</span>: <span style="color:#ae81ff">2Gi  	# openldap PVC size.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">minio</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeSize</span>: <span style="color:#ae81ff">20Gi  	# Minio PVC size.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">monitoring</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># type: external  	# Whether to specify the external prometheus stack, and need to modify the endpoint at the next line.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">endpoint</span>: <span style="color:#ae81ff">http://prometheus-operated.kubesphere-monitoring-system.svc:9090</span> <span style="color:#75715e"># Prometheus endpoint to get metrics data.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">GPUMonitoring</span>:  	<span style="color:#75715e"># Enable or disable the GPU-related metrics. If you enable this switch but have no GPU resources, Kubesphere will set it to zero.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gpu</span>:  	<span style="color:#75715e"># Install GPUKinds. The default GPU kind is nvidia.com/gpu. Other GPU kinds can be added here according to your needs.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">kinds</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">resourceName</span>: <span style="color:#e6db74">&#34;nvidia.com/gpu&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resourceType</span>: <span style="color:#e6db74">&#34;GPU&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">default</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">es</span>:   <span style="color:#75715e"># Storage backend for logging, events and auditing.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># master:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   volumeSize: 4Gi  # The volume size of Elasticsearch master nodes.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   replicas: 1      # The total number of master nodes. Even numbers are not allowed.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># data:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   volumeSize: 20Gi  # The volume size of Elasticsearch data nodes.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   replicas: 1  	# The total number of data nodes.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">logMaxAge</span>: <span style="color:#ae81ff">7</span>  	<span style="color:#75715e"># Log retention time in built-in Elasticsearch. It is 7 days by default.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">elkPrefix</span>: <span style="color:#ae81ff">logstash  	# The string making up index names. The index name will be formatted as ks-&lt;elk_prefix&gt;-log.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">basicAuth</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">username</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">password</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">externalElasticsearchHost</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">externalElasticsearchPort</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">alerting:  	# (CPU: 0.1 Core, Memory</span>: <span style="color:#ae81ff">100</span> <span style="color:#ae81ff">MiB) It enables users to customize alerting policies to send messages to receivers in time with different time intervals and alerting levels to choose from.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ KubeSphere è­¦æŠ¥ç³»ç»Ÿï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># thanosruler:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   replicas: 1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">auditing</span>:  	<span style="color:#75715e"># Provide a security-relevant chronological set of recordsï¼Œrecording the sequence of activities happening on the platform, initiated by different tenants.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ KubeSphere å®¡è®¡æ—¥å¿—ç³»ç»Ÿï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># operator:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># webhook:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">devops:  	# (CPU: 0.47 Core, Memory</span>: <span style="color:#ae81ff">8.6</span> <span style="color:#ae81ff">G) Provide an out-of-the-box CI/CD system based on Jenkins, and automated workflow tools including Source-to-Image &amp; Binary-to-Image.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ KubeSphere DevOps ç³»ç»Ÿï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jenkinsMemoryLim</span>: <span style="color:#ae81ff">2Gi  	# Jenkins memory limit.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jenkinsMemoryReq</span>: <span style="color:#ae81ff">1500Mi  	# Jenkins memory request.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jenkinsVolumeSize</span>: <span style="color:#ae81ff">8Gi  	# Jenkins volume size.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jenkinsJavaOpts_Xms</span>: <span style="color:#ae81ff">1200m  	# The following three fields are JVM parameters.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jenkinsJavaOpts_Xmx</span>: <span style="color:#ae81ff">1600m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jenkinsJavaOpts_MaxRAM</span>: <span style="color:#ae81ff">2g</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">events</span>:  	<span style="color:#75715e"># Provide a graphical web console for Kubernetes Events exporting, filtering and alerting in multi-tenant Kubernetes clusters.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ KubeSphere äº‹ä»¶ç³»ç»Ÿï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># operator:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># exporter:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ruler:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   enabled: true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   replicas: 2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">logging:  	# (CPU: 57 m, Memory</span>: <span style="color:#ae81ff">2.76</span> <span style="color:#ae81ff">G) Flexible logging functions are provided for log query, collection and management in a unified console. Additional log collectors can be added, such as Elasticsearch, Kafka and Fluentd.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ KubeSphere æ—¥å¿—ç³»ç»Ÿï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">logsidecar</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">metrics_server:  	# (CPU: 56 m, Memory</span>: <span style="color:#ae81ff">44.35</span> <span style="color:#ae81ff">MiB) It enables HPA (Horizontal Pod Autoscaler).</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ç›‘æ§æŒ‡æ ‡æœåŠ¡å™¨ï¼Œä»hub.dockerå®˜æ–¹æ‹‰å–é•œåƒï¼Œç½‘ç»œä¸å¥½ä¼šæŠ¥ç½‘ç»œé”™è¯¯ï¼Œå¦‚æœå·²æå‰å®‰è£…è¯·å¿½ç•¥ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">monitoring</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageClass</span>: <span style="color:#e6db74">&#34;&#34;</span>  	<span style="color:#75715e"># If there is an independent StorageClass you need for Prometheus, you can specify it here. The default StorageClass is used by default.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">node_exporter</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">port</span>: <span style="color:#ae81ff">9100</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># kube_rbac_proxy:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># kube_state_metrics:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># prometheus:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   replicas: 1  # Prometheus replicas are responsible for monitoring different segments of data source and providing high availability.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   volumeSize: 20Gi  # Prometheus PVC size.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   operator:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># alertmanager:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   replicas: 1  	# AlertManager Replicas.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># notification_manager:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   operator:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   proxy:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#     resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gpu</span>:  	<span style="color:#75715e"># GPU monitoring-related plug-in installation.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nvidia_dcgm_exporter</span>:  	<span style="color:#75715e"># Ensure that gpu resources on your hosts can be used normally, otherwise this plug-in will not work properly.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>  	<span style="color:#75715e"># Check whether the labels on the GPU hosts contain &#34;nvidia.com/gpu.present=true&#34; to ensure that the DCGM pod is scheduled to these nodes.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">multicluster</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">clusterRole</span>: <span style="color:#ae81ff">none  # host | member | none </span> <span style="color:#75715e"># You can install a solo cluster, or specify it as the Host or Member Cluster.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">network</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networkpolicy</span>: <span style="color:#75715e"># Network policies allow network isolation within the same cluster, which means firewalls can be set up between certain instances (Pods).</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Make sure that the CNI network plugin used by the cluster supports NetworkPolicy. There are a number of CNI network plugins that support NetworkPolicy, including Calico, Cilium, Kube-router, Romana and Weave Net.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ç½‘ç»œç­–ç•¥ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ippool</span>: <span style="color:#75715e"># Use Pod IP Pools to manage the Pod network address space. Pods to be created can be assigned IP addresses from a Pod IP Pool.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">none</span> <span style="color:#75715e"># å¦‚æœ Calico ç”¨ä½œæ‚¨çš„ CNI æ’ä»¶ï¼Œè¯·ä¸ºæ­¤å­—æ®µæŒ‡å®šâ€œcalicoâ€ã€‚ â€œnoneâ€è¡¨ç¤º Pod IP æ± å·²ç¦ç”¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">topology</span>: <span style="color:#75715e"># Use Service Topology to view Service-to-Service communication based on Weave Scope.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">none</span> <span style="color:#75715e"># Specify &#34;weave-scope&#34; for this field to enable Service Topology. &#34;none&#34; means that Service Topology is disabled.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">openpitrix</span>: <span style="color:#75715e"># An App Store that is accessible to all platform tenants. You can use it to manage apps across their entire lifecycle.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">store</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å¯ç”¨æˆ–ç¦ç”¨ KubeSphere åº”ç”¨å•†åº—ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">servicemesh</span>:  	<span style="color:#75715e"># (0.3 Core, 300 MiB) Provide fine-grained traffic management, observability and tracing, and visualized traffic topology.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># åŸºç¡€ç»„ä»¶ï¼ˆè¯•ç‚¹ï¼‰ã€‚ å¯ç”¨æˆ–ç¦ç”¨ KubeSphere æœåŠ¡ç½‘æ ¼ï¼ˆåŸºäº Istioï¼‰å¾®æœåŠ¡æ²»ç†åŠŸèƒ½ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">istio</span>:  <span style="color:#75715e"># Customizing the istio installation configuration, refer to https://istio.io/latest/docs/setup/additional-setup/customize-installation/</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">components</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ingressGateways</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">istio-ingressgateway</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">cni</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">edgeruntime</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># å°†è¾¹ç¼˜èŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤å¹¶åœ¨è¾¹ç¼˜èŠ‚ç‚¹ä¸Šéƒ¨ç½²å·¥ä½œè´Ÿè½½ï¼Œå¯åŠ¨è¾¹ç¼˜è®¡ç®—æœåŠ¡ï¼Œä¿®æ”¹ä¸ºï¼štrue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kubeedge</span>:  	<span style="color:#75715e"># kubeedge configurations</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">cloudCore</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">cloudHub</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">advertiseAddress</span>: <span style="color:#75715e"># At least a public IP address or an IP address which can be accessed by edge nodes must be provided.</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#e6db74">&#34;&#34;</span>            <span style="color:#75715e"># Note that once KubeEdge is enabled, CloudCore will malfunction if the address is not provided.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cloudhubNodePort</span>: <span style="color:#e6db74">&#34;30000&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cloudhubQuicNodePort</span>: <span style="color:#e6db74">&#34;30001&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cloudhubHttpsNodePort</span>: <span style="color:#e6db74">&#34;30002&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cloudstreamNodePort</span>: <span style="color:#e6db74">&#34;30003&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">tunnelNodePort</span>: <span style="color:#e6db74">&#34;30004&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># resources: {}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># hostNetWork: false</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">iptables-manager</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">mode</span>: <span style="color:#e6db74">&#34;external&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># resources: {}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># edgeService:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">gatekeeper</span>:        <span style="color:#75715e"># Provide admission policy and rule management, A validating (mutating TBA) webhook that enforces CRD-based policies executed by Open Policy Agent.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e"># Enable or disable Gatekeeper.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># controller_manager:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># audit:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   resources: {}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">terminal</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># image: &#39;alpine:3.15&#39; # There must be an nsenter program in the image</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeout</span>: <span style="color:#ae81ff">600</span>  	<span style="color:#75715e"># Container timeout, if set to 0, no timeout will be used. The unit is seconds</span></span></span></code></pre></div><ul>
<li>6.2 <!-- raw HTML omitted -->ä¿®æ”¹å¥½é…ç½®åå®‰è£…<!-- raw HTML omitted --><code>KubeSphere</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl apply -f kubesphere-installer.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f cluster-configuration.yaml</span></span></code></pre></div><ul>
<li>6.3 <!-- raw HTML omitted -->è·Ÿè¸ªå®‰è£…è¿›åº¦<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl logs -n kubesphere-system <span style="color:#66d9ef">$(</span>kubectl get pod -n kubesphere-system -l <span style="color:#e6db74">&#39;app in (ks-install, ks-installer)&#39;</span> -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.items[0].metadata.name}&#39;</span><span style="color:#66d9ef">)</span> -f</span></span></code></pre></div><ul>
<li>6.4 æŸ¥çœ‹æ‰€æœ‰<code>Pod</code>æ˜¯å¦åœ¨<code>KubeSphere</code><!-- raw HTML omitted -->çš„ç›¸å…³å‘½åç©ºé—´ä¸­æ­£å¸¸è¿è¡Œ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get svc/ks-console -n kubesphere-system</span></span></code></pre></div><ul>
<li>6.5 è§£å†³<code>prometheus-k8s</code>çš„<code>pods</code><!-- raw HTML omitted -->å› ä¸ºè¯ä¹¦ä¸èƒ½å¯åŠ¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl -n kubesphere-monitoring-system create secret generic kube-etcd-client-certs  --from-file<span style="color:#f92672">=</span>etcd-client-ca.crt<span style="color:#f92672">=</span>/etc/kubernetes/pki/etcd/ca.crt  --from-file<span style="color:#f92672">=</span>etcd-client.crt<span style="color:#f92672">=</span>/etc/kubernetes/pki/apiserver-etcd-client.crt  --from-file<span style="color:#f92672">=</span>etcd-client.key<span style="color:#f92672">=</span>/etc/kubernetes/pki/apiserver-etcd-client.key</span></span></code></pre></div><ul>
<li>6.6 <!-- raw HTML omitted -->ä½¿ç”¨æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted --><code>KubeSphere</code>æ”¾è¡Œï¼š<code>30880</code>ç«¯å£</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><strong>é»˜è®¤ç”¨æˆ·åï¼š</strong><!-- raw HTML omitted --><code>admin</code></li>
<li><!-- raw HTML omitted --><strong>é»˜è®¤å¯†ç ï¼š</strong><!-- raw HTML omitted --><code>P@88w0rd</code></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ http://IP:30880</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_k8s_harbor">Install_K8s_Harbor</h1>

<h2 id="å®‰è£…harborç§æœ‰é•œåƒåº“">å®‰è£…<code>Harbor</code>ç§æœ‰é•œåƒåº“</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><strong>é»˜è®¤ç”¨æˆ·åï¼š</strong><!-- raw HTML omitted --><code>admin </code></li>
<li><!-- raw HTML omitted --><strong>é»˜è®¤å¯†ç ï¼š</strong><!-- raw HTML omitted --><code>Harbor12345</code></li>
<li><!-- raw HTML omitted --><strong>å¿…é¡»å…ˆå®‰è£…</strong><!-- raw HTML omitted --><code>docker</code></li>
<li><code>Harbor</code><!-- raw HTML omitted --><strong>ä¾èµ–</strong><!-- raw HTML omitted --><code>docker-compose</code></li>
</ul>
</blockquote>
<hr>
<h3 id="å®‰è£…docker-compose">å®‰è£…<code>docker-compose</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -L https://get.daocloud.io/docker/compose/releases/download/1.21.2/docker-compose-<span style="color:#e6db74">`</span>uname -s<span style="color:#e6db74">`</span>-<span style="color:#e6db74">`</span>uname -m<span style="color:#e6db74">`</span> &gt; /usr/local/bin/docker-compose
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç»™äºˆæ‰§è¡Œæƒé™</span>
</span></span><span style="display:flex;"><span>$ chmod +x /usr/local/bin/docker-compose
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…Composeå‘½ä»¤è¡¥å…¨å·¥å…·</span>
</span></span><span style="display:flex;"><span>$ curl -L https://raw.githubusercontent.com/docker/compose/<span style="color:#66d9ef">$(</span>docker-compose version --short<span style="color:#66d9ef">)</span>/contrib/completion/bash/docker-compose -o /etc/bash_completion.d/docker-compose
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload <span style="color:#f92672">&amp;&amp;</span> systemctl restart docker</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å®‰è£…harbor">å®‰è£…<code>Harbor</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://github.com/goharbor/harbor/releases/download/v2.10.0/harbor-offline-installer-v2.10.0.tgz
</span></span><span style="display:flex;"><span>$ tar -zxvf harbor-offline-installer-v2.10.0.tgz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vim harbor/harbor.yml
</span></span><span style="display:flex;"><span>hostname: reg.mydomain.com  	<span style="color:#75715e"># ä¿®æ”¹ä¸»æœºåï¼š my.harbor.com</span>
</span></span><span style="display:flex;"><span>port: <span style="color:#ae81ff">80</span>  	<span style="color:#75715e"># ä¿®æ”¹httpé»˜è®¤ç«¯å£ï¼š8080</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># port: 443  	# æ³¨é‡Šhttpsåè®®ç«¯å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./install.sh</span></span></code></pre></div><ul>
<li><a href="https://goharbor.io/docs/2.0.0/install-config/configure-https/" rel="external" target="_self">é…ç½®å¯¹<code>Harbor</code>çš„<code>HTTPS</code>è®¿é—®</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆ CA è¯ä¹¦ç§é’¥</span>
</span></span><span style="display:flex;"><span>$ openssl genrsa -out ca.key <span style="color:#ae81ff">4096</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆ CA è¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ openssl req -x509 -new -nodes -sha512 -days <span style="color:#ae81ff">3650</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -subj <span style="color:#e6db74">&#34;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=yourdomain.com&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -key ca.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -out ca.crt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆç§é’¥</span>
</span></span><span style="display:flex;"><span>$ openssl genrsa -out yourdomain.com.key <span style="color:#ae81ff">4096</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ (CSR)</span>
</span></span><span style="display:flex;"><span>$ openssl req -sha512 -new <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -subj <span style="color:#e6db74">&#34;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=yourdomain.com&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -key yourdomain.com.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -out yourdomain.com.csr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆ x509 v3 æ‰©å±•æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt; v3.ext <span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">authorityKeyIdentifier=keyid,issuer
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basicConstraints=CA:FALSE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">extendedKeyUsage = serverAuth
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjectAltName = @alt_names
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[alt_names]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DNS.1=yourdomain.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DNS.2=yourdomain
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DNS.3=hostname
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨è¯¥v3.extæ–‡ä»¶ä¸ºæ‚¨çš„ Harbor ä¸»æœºç”Ÿæˆè¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ openssl x509 -req -sha512 -days <span style="color:#ae81ff">3650</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -extfile v3.ext <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -CA ca.crt -CAkey ca.key -CAcreateserial <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -in yourdomain.com.csr <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    -out yourdomain.com.crt</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><code>docker</code><!-- raw HTML omitted -->ç™»å½•<!-- raw HTML omitted --><code>Harbor</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker login http://192.168.80.225:8080</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å¦‚æœæŠ¥é”™ï¼š<!-- raw HTML omitted --><code>Error response from daemon: Get  http: server gave HTTP response to HTTPS client</code></li>
</ol>
</li>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶(æŒ‡å®šç§æœ‰ä»“åº“ï¼Œå¯å¿½ç•¥è·³è¿‡)<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tee /etc/docker/daemon.json <span style="color:#e6db74">&lt;&lt;-&#39;EOF&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;storage-driver&#34;: &#34;overlay2&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;registry-mirrors&#34;:[&#34;https://r2hd8p9u.mirror.aliyuncs.com&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;insecure-registries&#34;:[&#34;*.*.*.*:5000&#34;,&#34;192.168.4.126&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /etc/docker/daemon.json
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;insecure-registries&#34;</span>: <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;harboræœåŠ¡å™¨IP:ç«¯å£&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload <span style="color:#f92672">&amp;&amp;</span> systemctl restart docker</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æŠ¥é”™ï¼š<!-- raw HTML omitted --><code>request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers) (Client.Timeout exceeded while awaiting headers)</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /etc/hosts  	<span style="color:#75715e"># ä¿®æ”¹hostsè§£æ</span>
</span></span><span style="display:flex;"><span>æœ¬æœºæœåŠ¡IP my.harbodomain.com</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æ¨é€é•œåƒåˆ°harborä»“åº“">æ¨é€é•œåƒåˆ°<code>Harbor</code>ä»“åº“</h3>
<blockquote>
<ul>
<li><code>SOURCE_IMAGE[:TAG]</code><!-- raw HTML omitted -->ï¼šåŸé•œåƒåå­—å’Œ<!-- raw HTML omitted --><code>tag</code></li>
<li><code>test</code><!-- raw HTML omitted -->ï¼š<code>Harbor</code>é¡¹ç›®åç§°<!-- raw HTML omitted --></li>
<li><code>IMAGE[:TAG]</code><!-- raw HTML omitted -->ï¼šè‡ªå®šä¹‰å‘½åï¼Œä»¥åŠç‰ˆæœ¬æ ‡ç­¾<!-- raw HTML omitted --></li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<div class="highlight wrap-code"><pre tabindex="0"><code class="language-she" data-lang="she"># åœ¨é¡¹ç›®ä¸­æ ‡è®°é•œåƒ
$ docker tag SOURCE_IMAGE[:TAG] 192.168.35.128:9527/test/IMAGE[:TAG]

# æ¨é€é•œåƒåˆ°å½“å‰é¡¹ç›®
$ docker push 192.168.35.128:9527/test/IMAGE[:TAG]</code></pre></div></blockquote>
<hr>
<h3 id="font-colorredå…¶ä»–æœåŠ¡å™¨æ‹‰å–fontharborfont-colorredä»“åº“é•œåƒfont"><!-- raw HTML omitted -->å…¶ä»–æœåŠ¡å™¨æ‹‰å–<!-- raw HTML omitted --><code>Harbor</code><!-- raw HTML omitted -->ä»“åº“é•œåƒ<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><code>/etc/hosts</code><!-- raw HTML omitted -->åšå¥½è§£æ<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><code>daemon.json</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸­æ·»åŠ ç§äººä»“åº“å‚æ•°<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /etc/docker/daemon.json
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;insecure-registries&#34;</span>:<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;192.168.80.210:8080&#34;</span><span style="color:#f92672">]</span>,</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æ‹‰å–ç§äººä»“åº“é•œåƒï¼Œå‰æä»“åº“æ˜¯å…¬å¼€ç±»å‹ï¼Œç„¶åè·å–æ‹‰å–å‘½ä»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-e69f4d0968e530cc04afaac90cad4e58" class="lightbox-link"><img alt="æ‹‰å–ç§äººä»“åº“å‘½ä»¤" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Harbor/Snipaste_2022-06-07_21-19-25.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e69f4d0968e530cc04afaac90cad4e58"><img alt="æ‹‰å–ç§äººä»“åº“å‘½ä»¤" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Harbor/Snipaste_2022-06-07_21-19-25.png"></a></p>
</blockquote>
<hr>
<h3 id="é…ç½®k8sä½¿ç”¨harboré•œåƒä»“åº“">é…ç½®<code>K8S</code>ä½¿ç”¨<code>Harbor</code>é•œåƒä»“åº“</h3>
<blockquote>
<ul>
<li><code>docker-harbor</code>ï¼š<code>secret</code><!-- raw HTML omitted -->åç§°è‡ªå®šä¹‰<!-- raw HTML omitted --></li>
<li><code>--docker-server</code>ï¼š<code>Harbor</code><!-- raw HTML omitted -->ä»“åº“åœ°å€<!-- raw HTML omitted --></li>
<li><code>--docker-username</code>ï¼š<code>Harbor</code><!-- raw HTML omitted -->ç™»å½•ç”¨æˆ·å<!-- raw HTML omitted --></li>
<li><code>--docker-password</code>ï¼š<code>Harbor</code><!-- raw HTML omitted -->ä»“åº“ç™»å½•å¯†ç <!-- raw HTML omitted --></li>
<li><code>--docker-email</code><!-- raw HTML omitted -->ï¼šé‚®ç®±åœ°å€<!-- raw HTML omitted --></li>
<li><code>--namespace</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šå‘½åç©ºé—´ï¼Œä¸æŒ‡å®šé»˜è®¤ä¸ºï¼š<!-- raw HTML omitted --><code>default</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create secret docker-registry docker-harbor --docker-server<span style="color:#f92672">=</span>192.168.80.210:8080 --docker-username<span style="color:#f92672">=</span>admin --docker-password<span style="color:#f92672">=</span>Harbor12345 --docker-email<span style="color:#f92672">=</span>xxx@xxx.com --namespace<span style="color:#f92672">=</span>harbor</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å°†æœºå¯†æ•°æ®è½¬æ¢ä¸ºå¯è¯»æ ¼å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get secret docker-harbor --output<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;jsonpath={.data.\.dockerconfigjson}&#34;</span> | base64 --decode
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¾“å…¥ä»¥ä¸‹å†…å®¹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#34;auths&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;192.168.80.210:8080&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;username&#34;</span>:<span style="color:#e6db74">&#34;admin&#34;</span>,<span style="color:#e6db74">&#34;password&#34;</span>:<span style="color:#e6db74">&#34;Harbor12345&#34;</span>,<span style="color:#e6db74">&#34;email&#34;</span>:<span style="color:#e6db74">&#34;xxx@xxx.com&#34;</span>,<span style="color:#e6db74">&#34;auth&#34;</span>:<span style="color:#e6db74">&#34;YWRtaW46SGFyYm9yMTIzNDU=&#34;</span><span style="color:#f92672">}}}</span></span></span></code></pre></div><ul>
<li>å°†<code>base64</code><!-- raw HTML omitted -->ç¼–ç çš„æ•°æ®è½¬æ¢ä¸ºå¯è¯»æ ¼å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;YWRtaW46SGFyYm9yMTIzNDU=&#34;</span> | base64 --decode
</span></span><span style="display:flex;"><span>admin:Harbor12345  	<span style="color:#75715e"># è¾“å‡ºç»“æœ</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç”Ÿæˆ<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œå¹¶åœ¨<!-- raw HTML omitted --><code>spec.containers</code><!-- raw HTML omitted -->å­—æ®µä¸­ä¿®æ”¹ç§äººé•œåƒå‚æ•°<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>ç”Ÿæˆ<code>Deployment</code>çš„<code>yaml</code>æ–‡ä»¶å¹¶åº”ç”¨</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create deployment java-demo --image<span style="color:#f92672">=</span>192.168.80.210:8080/test/tomcat-demo:v1 --dry-run<span style="color:#f92672">=</span>client -o yaml &gt;/tmp/deploy.yaml</span></span></code></pre></div><ul>
<li><code>192.168.80.210:8080</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šä½¿ç”¨ç§äººä»“åº“åœ°å€ï¼ŒåŸŸåæˆ–è€…IPåœ°å€åŠ ç«¯å£å·<!-- raw HTML omitted --></li>
<li><code>test</code><!-- raw HTML omitted -->ï¼šç§äººä»“åº“åº“æˆ¿åç§°<!-- raw HTML omitted --></li>
<li><code>tomcat-demo</code><!-- raw HTML omitted -->ï¼šä½¿ç”¨ç§äººä»“åº“çš„é•œåƒ<!-- raw HTML omitted --></li>
<li><code>v1</code><!-- raw HTML omitted -->ï¼šå¿…é¡»æŒ‡å®šè¦ä½¿ç”¨ç§äººä»“åº“é•œåƒçš„ç‰ˆæœ¬å·<!-- raw HTML omitted --></li>
<li><code>name: tomcat-demo</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šä½¿ç”¨çš„é•œåƒåå­—<!-- raw HTML omitted --></li>
<li><code>imagePullSecrets:</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šä½¿ç”¨å…¶ä»–é•œåƒåœ°å€<!-- raw HTML omitted --></li>
<li><code>- name: docker-harbor</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šå®šä¹‰çš„ç§äººä»“åº“åå­—<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">java-demo</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">java-demo</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: <span style="color:#ae81ff">java-demo</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: <span style="color:#ae81ff">java-demo</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">192.168.80.210</span>:<span style="color:#ae81ff">8080</span><span style="color:#ae81ff">/test/tomcat-demo:v1 </span> <span style="color:#75715e"># éœ€ä¿®æ”¹å¤„</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">tomcat-demo  	# é»˜è®¤ç”Ÿæˆ</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">imagePullSecrets</span>:  	<span style="color:#75715e"># æ‰‹åŠ¨æ·»åŠ å­—æ®µ</span>
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker-harbor  	# æŒ‡å®šä½¿ç”¨çš„secretåº“æˆ¿åç§°</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>Service</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œåº”ç”¨å¹¶è®¿é—®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl expose deployment java-demo --port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span> --target-port<span style="color:#f92672">=</span><span style="color:#ae81ff">8080</span> --type<span style="color:#f92672">=</span>NodePort --dry-run<span style="color:#f92672">=</span>client -o yaml &gt;/opt/yaml/java-demo-svc.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;/opt/yaml/java-demo-svc.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  app: java-demo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name: java-demo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - port: 8080  	# Service é›†ç¾¤ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          protocol: TCP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          targetPort: 8080  	# Pod æœ¬èº«æœåŠ¡ç«¯å£ï¼Œæ¯”å¦‚Nginxï¼š80ï¼ŒTomcatï¼š8080
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          nodePort: 30001  	# å¤–ç½‘è®¿é—®ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            app: java-demo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        type: NodePort
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create -f java-demo-svc.yaml
</span></span><span style="display:flex;"><span>$ kubectl get service
</span></span><span style="display:flex;"><span>$ http://192.168.80.210:30001/  	<span style="color:#75715e"># æµè§ˆå™¨è®¿é—®åœ°å€</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_k8s_dashboard">Install_K8s_Dashboard</h1>

<h2 id="éƒ¨ç½²dashboardç«¯å£æ˜ å°„å¯ä»¥ç”¨äºwebè®¿é—®">éƒ¨ç½²<code>Dashboard</code>(ç«¯å£æ˜ å°„ï¼Œå¯ä»¥ç”¨äº<code>web</code>è®¿é—®)</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/kubernetes/dashboard" rel="external" target="_self"><code>Kubernetes Dashboard</code></a></td>
<td>å®˜æ–¹å¯è§†åŒ–ç•Œé¢</td>
</tr>
<tr>
<td><a href="https://kubesphere.io/zh/" rel="external" target="_self"><code>KubeSphere</code></a></td>
<td>é’äº‘</td>
</tr>
<tr>
<td><a href="https://www.rancher.com/" rel="external" target="_self"><code>Rancher</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://kuboard.cn/" rel="external" target="_self"><code>Kuboard</code></a></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>kubernetes</code>å®˜æ–¹å¼€å‘äº†ä¸€ä¸ªåŸºäº<code>web</code>çš„ç”¨æˆ·ç•Œé¢<code>DashBoard</code>ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨<code>DashBoard</code>éƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ï¼Œè€Œä¸”è¿˜å¯ä»¥ç›‘æ§åº”ç”¨çš„çŠ¶æ€ï¼Œæ‰§è¡Œæ•…éšœæ’æŸ¥ä»¥åŠç®¡ç†<code>kubernetes</code>ä¸­çš„å„ç§èµ„æºã€‚</li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸‹è½½ç”¨äºéƒ¨ç½²<!-- raw HTML omitted --><code>DashBoard</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ä¿®æ”¹å¹¶è¿è¡Œ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>ä¸‹è½½éƒ¨ç½²æ–‡ä»¶</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/kubernetes/cfg/
</span></span><span style="display:flex;"><span>$ wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>recommended.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶çš„<!-- raw HTML omitted --><code>Service</code><!-- raw HTML omitted -->ç±»å‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">k8s-app</span>: <span style="color:#ae81ff">kubernetes-dashboard</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">kubernetes-dashboard</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kubernetes-dashboard</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span> - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">8443</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">nodePort</span>: <span style="color:#ae81ff">30001</span>       <span style="color:#75715e"># æ­¤å¤„æ–°å¢</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort      		# æ­¤å¤„æ–°å¢</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">k8s-app</span>: <span style="color:#ae81ff">kubernetes-dashboard</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->éƒ¨ç½²<!-- raw HTML omitted --><code>DashBoard</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create -f recommended.yaml</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>namespace</code><!-- raw HTML omitted -->ä¸‹åä¸º<!-- raw HTML omitted --><code>kubernetes-dashboard</code><!-- raw HTML omitted -->ä¸‹çš„èµ„æº<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get pods,svc -n kubernetes-dashboard
</span></span><span style="display:flex;"><span>NAME                                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod/dashboard-metrics-scraper-694557449d-mvnc8   1/1     Running   <span style="color:#ae81ff">0</span>          21s
</span></span><span style="display:flex;"><span>pod/kubernetes-dashboard-9774cc786-fm748         1/1     Running   <span style="color:#ae81ff">0</span>          21s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                                TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>         AGE
</span></span><span style="display:flex;"><span>service/dashboard-metrics-scraper   ClusterIP   10.0.0.248   &lt;none&gt;        8000/TCP        21s
</span></span><span style="display:flex;"><span>service/kubernetes-dashboard        NodePort    10.0.0.15    &lt;none&gt;        443:30001/TCP   22s</span></span></code></pre></div><ul>
<li><code>dashboard-admin.yaml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">dashboard-admin</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kubernetes-dashboard</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">kubernetes-dashboard</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">dashboard-admin</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">cluster-admin</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">dashboard-admin</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kubernetes-dashboard</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>service account</code><!-- raw HTML omitted -->å¹¶ç»‘å®šé»˜è®¤<!-- raw HTML omitted --><code>cluster-admin</code><!-- raw HTML omitted -->ç®¡ç†å‘˜é›†ç¾¤è§’è‰²ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æˆæƒï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create clusterrolebinding dashboard-admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--clusterrole<span style="color:#f92672">=</span>cluster-admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--serviceaccount<span style="color:#f92672">=</span>kubernetes-dashboard:dashboard-admin</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–è´¦å·<!-- raw HTML omitted --><code>token</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬ä¸€ç§æ–¹å¼</span>
</span></span><span style="display:flex;"><span>$ kubectl describe secrets -n kubernetes-dashboard <span style="color:#66d9ef">$(</span>kubectl -n kubernetes-dashboard get secret | awk <span style="color:#e6db74">&#39;/dashboard-admin/{print $1}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬äºŒç§æ–¹å¼</span>
</span></span><span style="display:flex;"><span>$ kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin
</span></span><span style="display:flex;"><span>$ kubectl describe secrets dashboard-admin-token-b992l -n kubernetes-dashboard</span></span></code></pre></div></blockquote>
<hr>
<h2 id="é€šè¿‡æµè§ˆå™¨è®¿é—®dashboardçš„ui">é€šè¿‡æµè§ˆå™¨è®¿é—®<code>DashBoard</code>çš„<code>UI</code></h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š<!-- raw HTML omitted --><code>https://NodeIP:30001</code></li>
<li><!-- raw HTML omitted -->æ‰“å¼€è°·æ­Œæµè§ˆå™¨æç¤ºï¼š<!-- raw HTML omitted --><code>NET::ERR_CERT_INVALID</code></li>
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>chrome</code><!-- raw HTML omitted -->è¯¥é¡µé¢ä¸Šï¼Œç›´æ¥é”®ç›˜æ•²å…¥è¿™12ä¸ªå­—ç¬¦ï¼š<!-- raw HTML omitted --><code>thisisunsafe</code></li>
<li><!-- raw HTML omitted --><strong>æ³¨æ„ï¼š</strong><!-- raw HTML omitted -->é¼ æ ‡ç‚¹å‡»å½“å‰é¡µé¢ä»»æ„ä½ç½®ï¼Œè®©é¡µé¢å¤„äºæœ€ä¸Šå±‚å³å¯è¾“å…¥</li>
<li><!-- raw HTML omitted -->å¤åˆ¶åˆ›å»º<!-- raw HTML omitted --><code>cluster-admin</code><!-- raw HTML omitted -->ç”Ÿæˆçš„<!-- raw HTML omitted --><code>token</code><!-- raw HTML omitted -->åˆ°æµè§ˆå™¨ç™»å½•<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_k8s_coredns">Install_K8s_CoreDNS</h1>

<h2 id="å®‰è£…coredns">å®‰è£…<code>CoreDNS</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å»å®˜ç½‘ä¸‹è½½<!-- raw HTML omitted --><a href="https://github.com/coredns/deployment/tree/master/kubernetes" rel="external" target="_self"><code>CoreDNS</code></a><code>deploy.sh</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>coredns.yam.sed</code><!-- raw HTML omitted -->ä¸¤ä¸ªæ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="https://kaerser.github.io/2019/03/11/coredns%E9%85%8D%E7%BD%AE/" rel="external" target="_self"><code>CoreDNS</code>é…ç½®</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://github.com/coredns/deployment/blob/08c2b11241ef67b5d22d2020c00001ce0baec566/kubernetes/deploy.sh
</span></span><span style="display:flex;"><span>$ wget https://github.com/coredns/deployment/blob/08c2b11241ef67b5d22d2020c00001ce0baec566/kubernetes/coredns.yaml.sed
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å¸®åŠ©</span>
</span></span><span style="display:flex;"><span>$ ./deploy.sh -h</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>REVERSE_CIDRS=&quot;10.254.0.0/16&quot;</code><!-- raw HTML omitted -->ï¼šé…ç½®<!-- raw HTML omitted --><code>kubernetes svc</code><!-- raw HTML omitted -->ç½‘æ®µ<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="4">
<li><code>CLUSTER_DNS_IP=&quot;10.254.0.2&quot;</code><!-- raw HTML omitted -->ï¼šé…ç½®<!-- raw HTML omitted --><code>kubernetes DNS IP</code></li>
</ol>
</li>
<li>
<ol start="5">
<li><code>CLUSTER_DOMAIN=&quot;cluster.local&quot;</code><!-- raw HTML omitted -->ï¼šé…ç½®<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->çš„åŸŸå<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->-r<!-- raw HTML omitted -->ï¼š<code>kubernetes svc</code>ç½‘æ®µã€<!-- raw HTML omitted -->-i<!-- raw HTML omitted -->ï¼š<code>kubernetes DNS IP</code>ã€<!-- raw HTML omitted -->-d<!-- raw HTML omitted -->ï¼š<code>kubernetes</code>çš„åŸŸå</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$  ./deploy.sh -s -r 10.254.0.0/16 -i 10.254.0.10 -d cluster.local &gt; coredns.yaml
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹å‰åå¯¹æ¯”</span>
</span></span><span style="display:flex;"><span>$ diff coredns.yaml coredns.yaml.sed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨Coredns</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f coredns.yaml</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_k8s_argo_cd">Install_K8s_Argo_CD</h1>

<h2 id="argo-cdä»‹ç»"><code>Argo CD</code>ä»‹ç»</h2>
<blockquote>
<ul>
<li><code>Argo CD</code>æ˜¯ä¸€ä¸ªä¸º<code>Kubernetes</code>è€Œç”Ÿçš„ï¼Œéµå¾ªå£°æ˜å¼<code>GitOps</code>ç†å¿µçš„æŒç»­éƒ¨ç½²<code>CD</code>å·¥å…·ã€‚<code>Argo CD</code>å¯åœ¨<code>Git</code>å­˜å‚¨åº“æ›´æ”¹æ—¶è‡ªåŠ¨åŒæ­¥å’Œéƒ¨ç½²åº”ç”¨ç¨‹åº</li>
<li>åº”ç”¨å®šä¹‰ã€é…ç½®å’Œç¯å¢ƒä¿¡æ¯æ˜¯å£°æ˜å¼çš„ï¼Œå¹¶å¯ä»¥è¿›è¡Œç‰ˆæœ¬æ§åˆ¶</li>
<li>åº”ç”¨éƒ¨ç½²å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†æ˜¯å…¨è‡ªåŠ¨åŒ–çš„ã€æ˜¯å¯å®¡è®¡çš„ï¼Œæ¸…æ™°æ˜“æ‡‚</li>
</ul>
</blockquote>
<hr>
<h2 id="å®‰è£…argo-cd">å®‰è£…<code>Argo CD</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>ArgoCD</code><!-- raw HTML omitted -->å‘½åç©ºé—´<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create namespace argocd</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¸‹è½½å¹¶å¯åŠ¨<!-- raw HTML omitted --><code>ArgoCD</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>NodePort</code><!-- raw HTML omitted -->æ–¹å¼æš´éœ²<!-- raw HTML omitted --><code>argocd ui</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl patch service -n argocd argocd-server -p <span style="color:#e6db74">&#39;{&#34;spec&#34;: {&#34;type&#34;: &#34;NodePort&#34;}}&#39;</span>  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->è·å–<!-- raw HTML omitted --><code>ArgoCD</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>admin</code><!-- raw HTML omitted -->ç™»é™†å¯†ç <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.data.password}&#34;</span> | base64 -d</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>cliï¼šCLI</code><!-- raw HTML omitted -->æ˜¯ç”¨äºç®¡ç†<!-- raw HTML omitted --><code>Argo CD</code><!-- raw HTML omitted -->çš„å‘½ä»¤è¡Œå·¥å…·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -sSL -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/download/v2.3.3/argocd-linux-amd64 <span style="color:#f92672">&amp;&amp;</span> chmod +x /usr/local/bin/argocd</span></span></code></pre></div></blockquote>
<ol start="6">
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>argocd-server</code><!-- raw HTML omitted -->æš´éœ²ç«¯å£<!-- raw HTML omitted --></li>
</ol>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get svc -n argocd</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_k8s_storage">Configure_K8s_Storage</h1>

<h1 id="kubernetesæ•°æ®å­˜å‚¨"><code>Kubernetes</code>æ•°æ®å­˜å‚¨</h1>
<ul>
<li>
<ol>
<li>éƒ½çŸ¥é“å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½å¾ˆçŸ­ï¼Œä¼šè¢«é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ã€‚é‚£ä¹ˆå®¹å™¨åœ¨é”€æ¯çš„æ—¶å€™ï¼Œä¿å­˜åœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚è¿™ç§ç»“æœå¯¹ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸ä¹æ„çœ‹åˆ°çš„ã€‚ä¸ºäº†æŒä¹…åŒ–ä¿å­˜å®¹å™¨ä¸­çš„æ•°æ®ï¼Œ<code>kubernetes</code>å¼•å…¥äº†<code>Volume</code>çš„æ¦‚å¿µ</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>Volume</code>æ˜¯<code>Pod</code>ä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨<code>Pod</code>ä¸Šï¼Œç„¶åè¢«ä¸€ä¸ª<code>Pod</code>é‡Œé¢çš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œ<code>kubernetes</code>é€šè¿‡<code>Volume</code>å®ç°åŒä¸€ä¸ª<code>Pod</code>ä¸­ä¸åŒå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ä»¥åŠæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚<code>Volume</code>çš„ç”Ÿå‘½å‘¨æœŸä¸å’Œ<code>Pod</code>ä¸­çš„å•ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæœ‰å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯çš„æ—¶å€™ï¼Œ<code>Volume</code>ä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>kubernetes</code>çš„<code>Volume</code>æ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‹é¢çš„å‡ ä¸ªï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç®€å•å­˜å‚¨<!-- raw HTML omitted -->ï¼š<code>EmptyDir</code>ã€<code>HostPath</code>ã€<code>NFS</code></li>
<li><!-- raw HTML omitted -->é«˜çº§å­˜å‚¨<!-- raw HTML omitted -->ï¼š<code>PV</code>ã€<code>PVC</code></li>
<li><!-- raw HTML omitted -->é…ç½®å­˜å‚¨<!-- raw HTML omitted -->ï¼š<code>ConfigMap</code>ã€<code>Secret</code></li>
</ul>
</blockquote>
<hr>
<h2 id="ç®€å•å­˜å‚¨">ç®€å•å­˜å‚¨</h2>
<h3 id="emptydir"><code>EmptyDir</code></h3>
<ul>
<li>
<ol>
<li><code>EmptyDir</code>æ˜¯æœ€åŸºç¡€çš„<code>Volume</code>ç±»å‹ï¼Œä¸€ä¸ª<code>EmptyDir</code>å°±æ˜¯<code>Host</code>ä¸Šçš„ä¸€ä¸ªç©ºç›®å½•</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>EmptyDir</code>æ˜¯åœ¨<code>Pod</code>è¢«åˆ†é…åˆ°<code>Node</code>æ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸º<code>kubernetes</code>ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç›®å½•ï¼Œå½“<code>Pod</code>é”€æ¯æ—¶ï¼Œ<code>EmptyDir</code>ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>EmptyDir</code>çš„ç”¨é€”å¦‚ä¸‹</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸´æ—¶ç©ºé—´<!-- raw HTML omitted -->ä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™</li>
<li><!-- raw HTML omitted -->å¤šå®¹å™¨å…±äº«ç›®å½•<!-- raw HTML omitted -->ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½•</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªå®¹å™¨ä¹‹é—´çš„å…±äº«æ¡ˆä¾‹æ¥ä½¿ç”¨æè¿°ä¸€ä¸ª<!-- raw HTML omitted --><code>EmptyDir</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨ä¸€ä¸ª<code>Pod</code>ä¸­å‡†å¤‡ä¸¤ä¸ªå®¹å™¨<!-- raw HTML omitted --><code>nginx</code>å’Œ<code>busybox</code>ç„¶åå£°æ˜ä¸€ä¸ª<code>volume</code>åˆ†åˆ«æŒ‚è½½åˆ°ä¸¤ä¸ªå®¹å™¨çš„ç›®å½•ä¸­ï¼Œç„¶å<code>nginx</code>å®¹å™¨è´Ÿè´£å‘<code>volume</code>ä¸­å†™æ—¥å¿—ï¼Œ<code>busybox</code>ä¸­é€šè¿‡å‘½ä»¤å°†æ—¥å¿—å†…å®¹è¯»åˆ°æ§åˆ¶å°</li>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-emptydir-template.yaml" rel="external" target="_self"><code>Kubernetes Emptydir Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod  </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">emptydir-volume-template       </span> <span style="color:#75715e"># å®šä¹‰åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:   <span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:   <span style="color:#75715e"># å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;bash&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;for i in {1..100};do echo $i &gt;&gt;/tmp/hello.txt;sleep 1;done&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­çš„ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/tmp</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e"># æ˜¯å¦åªè¯»ï¼Œé»˜è®¤false</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;bash&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /tmp/hello.txt&#34;</span>]     <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/tmp</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:      <span style="color:#75715e"># å£°æ˜volumeï¼Œnameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºemptyDir</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume  </span> <span style="color:#75715e"># å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">emptyDir</span>: {<span style="color:#f92672">}        # ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼ï¼Œä½¿ç”¨ emptyDir</span>: {} <span style="color:#ae81ff">è¡¨ä½¿ç”¨é»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># medium: string   # å­˜å‚¨ä»‹è´¨ï¼Œæ”¯æŒMemoryå’Œç©ºå­—ç¬¦ä¸²(é»˜è®¤)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># sizeLimit: string        # å¤§å°é™åˆ¶ï¼Œé»˜è®¤ä¸é™åˆ¶ã€‚ä¸€èˆ¬åœ¨ä½¿ç”¨Memoryæ—¶ä¼šé™åˆ¶</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="hostpath"><code>HostPath</code></h3>
<ul>
<li>
<ol>
<li>å·²ç»çŸ¥é“<code>EmptyDir</code>ä¸­çš„æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œå®ƒä¼šéšç€<code>Pod</code>çš„ç»“æŸè€Œé”€æ¯ï¼Œå¦‚æœæƒ³è¦ç®€å•çš„å°†æ•°æ®æŒä¹…åŒ–åˆ°ä¸»æœºä¸­ï¼Œå¯ä»¥é€‰æ‹©<!-- raw HTML omitted --><code>HostPath</code><!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><code>HostPath</code>å°±æ˜¯å°†<code>Node</code>ä¸»æœºä¸­çš„ä¸€ä¸ªå®é™…ç›®å½•æŒ‚è½½åˆ°<code>Pod</code>ä¸­ï¼Œä»¥ä¾›å®¹å™¨ä½¿ç”¨ï¼Œè¿™æ ·çš„è®¾è®¡å°±å¯ä»¥ä¿è¯<code>Pod</code>é”€æ¯äº†ï¼Œä½†æ˜¯æ•°æ®ä¾æ—§å¯ä»¥ä¿å­˜åœ¨<code>Node</code>ä¸»æœºä¸Š</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain Pod.spec.volumes.hostPath.type  	<span style="color:#75715e"># ç±»å‹å£°æ˜</span></span></span></code></pre></div><ul>
<li><code>Directory</code><!-- raw HTML omitted -->ï¼šç›®å½•ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>DirectoryOrCreate</code><!-- raw HTML omitted -->ï¼šç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨<!-- raw HTML omitted --></li>
<li><code>File</code><!-- raw HTML omitted -->ï¼šæ–‡ä»¶ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>FileOrCreate</code><!-- raw HTML omitted -->ï¼šæ–‡ä»¶å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨<!-- raw HTML omitted --></li>
<li><code>Socket</code><!-- raw HTML omitted -->ï¼š<code>unix</code>å¥—æ¥å­—ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>CharDevice</code><!-- raw HTML omitted -->ï¼šå­—ç¬¦è®¾å¤‡ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><code>BlockDevice</code><!-- raw HTML omitted -->ï¼šå—è®¾å¤‡ï¼Œå¿…é¡»å­˜åœ¨<!-- raw HTML omitted --></li>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-hostpath-template.yaml" rel="external" target="_self"><code>Kubernetes HostPath Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hostpath-volume-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­çš„ç›®å½•ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log/nginx</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /logs/access.log&#34;</span>]        <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„ç›®å½•ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:      <span style="color:#75715e"># å£°æ˜volumeï¼Œnameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºhostPath</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostPath</span>:   <span style="color:#75715e"># ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/logs  </span> <span style="color:#75715e"># Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">DirectoryOrCreate  </span> <span style="color:#75715e"># ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºå†ä½¿ç”¨</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="nfs"><code>NFS</code></h3>
<blockquote>
<ul>
<li><code>HostPath</code>è™½ç„¶å¯ä»¥è§£å†³æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦<code>Node</code>èŠ‚ç‚¹æ•…éšœäº†ï¼Œ<code>Pod</code>å¦‚æœè½¬ç§»åˆ°åˆ«çš„<code>Node</code>èŠ‚ç‚¹ä¸Šï¼Œåˆä¼šå‡ºç°é—®é¢˜ï¼Œæ­¤æ—¶éœ€è¦å‡†å¤‡å•ç‹¬çš„ç½‘ç»œå­˜å‚¨ç³»ç»Ÿï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯<code>NFS</code>å’Œ<code>CIFS</code></li>
<li><code>NFS</code>æ˜¯ä¸€ä¸ªç½‘ç»œæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥æ­å»ºä¸€å°<code>NFS</code>æœåŠ¡å™¨ï¼Œç„¶åå°†<code>Pod</code>ä¸­çš„å­˜å‚¨ç›´æ¥è¿æ¥åˆ°<code>NFS</code>ç³»ç»Ÿä¸Šï¼Œè¿™æ ·ï¼Œæ— è®º<code>Pod</code>åœ¨èŠ‚ç‚¹ä¸Šæ€ä¹ˆè½¬ç§»ï¼Œåªè¦<code>Node</code>å’Œ<code>NFS</code>çš„å¯¹æ¥æ²¡æœ‰é—®é¢˜ï¼Œæ•°æ®å°±å¯ä»¥æˆåŠŸè®¿é—®</li>
</ul>
</blockquote>
<hr>
<h4 id="font-colorredç¼–è¾‘fontnfs-volumeyamlfont-colorredæ–‡ä»¶æŒ‚è½½fontnfs"><!-- raw HTML omitted -->ç¼–è¾‘<!-- raw HTML omitted --><code>nfs-volume.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶æŒ‚è½½<!-- raw HTML omitted --><code>NFS</code></h4>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-nfs-template.yaml" rel="external" target="_self"><code>Kubernetes NFS Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-volume-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°nginxå®¹å™¨ä¸­çš„ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log/nginx</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.30</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;tail -f /logs/access.log&#34;</span>]        <span style="color:#75715e"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:       <span style="color:#75715e"># å°†logs-volumeæŒ‚è½½åˆ°busyboxå®¹å™¨ä¸­çš„ç›®å½•è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:      <span style="color:#75715e"># å£°æ˜volume</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">logs-volume</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nfs</span>:        <span style="color:#75715e"># å­˜å‚¨ç±»å‹ï¼Œå’Œåº•å±‚æ­£åˆ™çš„å­˜å‚¨å¯¹åº”</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.18.100</span>    <span style="color:#75715e"># NFSæœåŠ¡å™¨åœ°å€</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/nfs     </span> <span style="color:#75715e"># å…±äº«æ–‡ä»¶è·¯å¾„</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e"># æ˜¯å¦åªè¯»ï¼Œé»˜è®¤false</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="é«˜çº§å­˜å‚¨">é«˜çº§å­˜å‚¨</h2>
<h3 id="pvæŒä¹…å·"><code>PV</code>æŒä¹…å·</h3>
<ul>
<li>
<ol>
<li><code>PV(Persistent Volume)</code><!-- raw HTML omitted -->æ˜¯æŒä¹…åŒ–å·çš„æ„æ€ï¼Œæ˜¯å¯¹åº•å±‚çš„å…±äº«å­˜å‚¨çš„ä¸€ç§æŠ½è±¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹<code>PV</code>ç”±<code>kubernetes</code>ç®¡ç†å‘˜è¿›è¡Œåˆ›å»ºå’Œé…ç½®ï¼Œå®ƒå’Œåº•å±‚å…·ä½“çš„å…±äº«å­˜å‚¨æŠ€æœ¯æœ‰å…³ï¼Œå¹¶é€šè¿‡æ’ä»¶å®Œæˆå’Œå…±äº«å­˜å‚¨çš„å¯¹æ¥<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><code>pv</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><!-- raw HTML omitted -->å…³é”®é…ç½®<!-- raw HTML omitted --><!-- raw HTML omitted -->å‚æ•°è¯´æ˜<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å­˜å‚¨ç±»å‹ï¼š<!-- raw HTML omitted -->åº•å±‚å®é™…å­˜å‚¨çš„ç±»å‹ï¼Œ<code>kubernetes</code>æ”¯æŒå¤šç§å­˜å‚¨ç±»å‹ï¼Œæ¯ç§å­˜å‚¨ç±»å‹çš„é…ç½®æœ‰æ‰€ä¸åŒ</li>
<li>
<ol start="2">
<li><code>capacity</code><!-- raw HTML omitted -->(å­˜å‚¨èƒ½åŠ›)ï¼š<!-- raw HTML omitted -->ç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®<code>storage=1Gi</code>ï¼Œä¸è¿‡æœªæ¥å¯èƒ½ä¼šåŠ å…¥<code>IOPS</code>ã€ååé‡ç­‰æŒ‡æ ‡çš„é…ç½®</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>accessModes</code><!-- raw HTML omitted -->(è®¿é—®æ¨¡å¼)ï¼š<!-- raw HTML omitted -->ç”¨æ¥æè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™ï¼Œè®¿é—®æƒé™åŒ…æ‹¬ä¸‹é¢å‡ ç§æ–¹å¼</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„è®¿é—®æ¨¡å¼ä¸åŒ<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>ReadWriteOnce(RWO)</code><!-- raw HTML omitted -->ï¼šè¯»å†™æƒé™ï¼Œ<!-- raw HTML omitted -->ä½†æ˜¯åªèƒ½è¢«å•ä¸ªèŠ‚ç‚¹æŒ‚è½½</p>
</li>
<li>
<p><code>ReadOnlyMany(ROX)</code><!-- raw HTML omitted -->ï¼šåªè¯»æƒé™ï¼Œ<!-- raw HTML omitted -->å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</p>
</li>
<li>
<p><code>ReadWriteMany(RWX)</code><!-- raw HTML omitted -->ï¼šè¯»å†™æƒé™ï¼Œ<!-- raw HTML omitted -->å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</p>
</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>persistentVolumeReclaimPolicy</code><!-- raw HTML omitted -->(å›æ”¶ç­–ç•¥)ï¼š<!-- raw HTML omitted -->å½“<code>PV</code>ä¸å†è¢«ä½¿ç”¨ä¹‹åï¼Œå¯¹å…¶çš„å¤„ç†æ–¹å¼ï¼Œç›®å‰æ”¯æŒä¸‰ç§ç­–ç•¥</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„å›æ”¶ç­–ç•¥ä¸åŒ<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>Retain</code><!-- raw HTML omitted -->(ä¿ç•™)ï¼š<!-- raw HTML omitted -->ä¿ç•™æ•°æ®ï¼Œéœ€è¦ç®¡ç†å‘˜æ‰‹åŠ¨æ¸…ç†æ•°æ®</p>
</li>
<li>
<p><code>Recycle</code><!-- raw HTML omitted -->(å›æ”¶)ï¼š<!-- raw HTML omitted -->æ¸…é™¤<code>PV</code>ä¸­çš„æ•°æ®ï¼Œæ•ˆæœç›¸å½“äº<code>rm -rf /volume/*</code></p>
</li>
<li>
<p><code>Delete</code><!-- raw HTML omitted -->(åˆ é™¤)ï¼š<!-- raw HTML omitted -->å’Œ<code>PV</code>ç›¸è¿çš„åç«¯å­˜å‚¨å®Œæˆ<code>volume</code>çš„åˆ é™¤æ“ä½œï¼Œå¸¸è§äºäº‘æœåŠ¡å™¨å‚å•†çš„å­˜å‚¨æœåŠ¡</p>
</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="5">
<li><code>storageClassName</code><!-- raw HTML omitted -->(å­˜å‚¨ç±»åˆ«)ï¼š<!-- raw HTML omitted --><code>PV</code>å¯ä»¥é€šè¿‡<code>storageClassName</code>å‚æ•°æŒ‡å®šä¸€ä¸ªå­˜å‚¨ç±»åˆ«</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>å…·æœ‰ç‰¹å®šç±»å‹çš„<code>PV</code>åªèƒ½å’Œè¯·æ±‚äº†è¯¥ç±»åˆ«çš„<code>PVC</code>è¿›è¡Œç»‘å®š</li>
<li>æœªè®¾å®šç±»åˆ«çš„<code>PV</code>åªèƒ½å’Œä¸è¯·æ±‚ä»»ä½•ç±»åˆ«çš„<code>PVC</code>è¿›è¡Œç»‘å®š</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="6">
<li><code>status</code><!-- raw HTML omitted -->(çŠ¶æ€)ï¼š<!-- raw HTML omitted -->ä¸€ä¸ª<code>PV</code>çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯èƒ½ä¼šå¤„äº4ç§ä¸åŒçš„é˜¶æ®µ</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Available</code><!-- raw HTML omitted -->(å¯ç”¨)ï¼š<!-- raw HTML omitted -->è¡¨ç¤ºå¯ç”¨çŠ¶æ€ï¼Œè¿˜æœªè¢«ä»»ä½•<code>PVC</code>ç»‘å®š</li>
<li><code>Bound</code><!-- raw HTML omitted -->(å·²ç»‘å®š)ï¼š<!-- raw HTML omitted -->è¡¨ç¤º<code>PV</code>å·²ç»è¢«<code>PVC</code>ç»‘å®š</li>
<li><code>Released</code><!-- raw HTML omitted -->(å·²é‡Šæ”¾)ï¼š<!-- raw HTML omitted -->è¡¨ç¤º<code>PVC</code>è¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æ²¡æœ‰è¢«é›†ç¾¤é‡æ–°é‡Šæ”¾</li>
<li><code>Failed</code><!-- raw HTML omitted -->(å¤±è´¥)ï¼š<!-- raw HTML omitted -->è¡¨ç¤ºè¯¥<code>PV</code>çš„è‡ªåŠ¨å›æ”¶å¤±è´¥</li>
</ul>
</blockquote>
<ul>
<li><code>PV</code>ï¼š<code>kubernetes</code><!-- raw HTML omitted -->ç®¡ç†å‘˜ç»´æŠ¤<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<h4 id="æ„å»ºfont-colorredé™æ€fontpvå­˜å‚¨å·">æ„å»º<!-- raw HTML omitted -->é™æ€<!-- raw HTML omitted --><code>PV</code>å­˜å‚¨å·</h4>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-pv-template.yaml" rel="external" target="_self"><code>Kubernetes PV Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">##########   å®šä¹‰Redisçš„é™æ€ PVæŒä¹…å·   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pv-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pv-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">capacity</span>:     <span style="color:#75715e"># å­˜å‚¨èƒ½åŠ›ï¼Œç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Gi      </span> <span style="color:#75715e"># é™åˆ¶å®¹é‡ä¸º 10G</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMode</span>: <span style="color:#ae81ff">Filesystem   </span> <span style="color:#75715e"># å­˜å‚¨ç±»å‹ä¸ºæ–‡ä»¶ç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:          <span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany      </span> <span style="color:#75715e"># Readï¼šè¯»ã€Writeï¼šå†™ã€Onceï¼šå•èŠ‚ç‚¹ã€Manyï¼šä»£è¡¨å¤šèŠ‚ç‚¹ï¼ŒOnlyï¼šåªè¯»åªå†™</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeReclaimPolicy</span>: <span style="color:#ae81ff">Retain  </span> <span style="color:#75715e"># å›æ”¶ç­–ç•¥ï¼šRetainï¼šä¿ç•™ã€Recycleï¼šå›æ”¶ã€Deleteï¼šåˆ é™¤</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs        </span> <span style="color:#75715e"># åˆ›å»º PV çš„å­˜å‚¨ç±»çš„è‡ªå®šä¹‰åå­—ï¼ŒPVCéœ€è¦äºæ­¤ç›¸åŒï¼Œå­˜å‚¨ç±»å‹ï¼Œåˆ†åˆ«ä¸ºï¼š NFSã€CephFSã€iSCSI</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mountOptions</span>:         <span style="color:#75715e"># åŠ è½½é…ç½®</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">hard</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">nfsvers=4.1        </span> <span style="color:#75715e"># NFS ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nfs</span>:          <span style="color:#75715e"># å­˜å‚¨ç±»å‹ï¼Œå’ŒstorageClassNameçš„å­˜å‚¨ç±»åˆ«å¯¹åº”</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/redis      </span> <span style="color:#75715e"># nfs æˆæƒç›®å½•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.186.110</span>     <span style="color:#75715e"># nfs æ‰€åœ¨æœåŠ¡å™¨PVæŒä¹…å·</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--- <span style="color:#75715e"># åˆ†éš”ç¬¦å¯ä»¥å®šä¹‰å¤šä¸ª</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   å®šä¹‰Nginxçš„é™æ€ PVæŒä¹…å·   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pv-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pv-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">capacity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Gi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMode</span>: <span style="color:#ae81ff">Filesystem</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeReclaimPolicy</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mountOptions</span>:         <span style="color:#75715e"># åŠ è½½é…ç½®</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">hard</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">nfsvers=4.1        </span> <span style="color:#75715e"># NFS ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nfs</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/data/nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.186.110</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="æ„å»ºfont-colorredåŠ¨æ€fontpvå­˜å‚¨å·">æ„å»º<!-- raw HTML omitted -->åŠ¨æ€<!-- raw HTML omitted --><code>PV</code>å­˜å‚¨å·</h4>
<ul>
<li>
<ol>
<li><a href="https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/" rel="external" target="_self"><code>StorageClass</code>åŠ¨æ€èµ„æºå­˜å‚¨</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-storageclass-template.yaml" rel="external" target="_self"><code>Kubernetes StorageClass Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">storage.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StorageClass   </span> <span style="color:#75715e"># åˆ›å»ºåŠ¨æ€å­˜å‚¨ç±»</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-storage-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageclass.kubernetes.io/is-default-class</span>: <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">provisioner</span>: <span style="color:#ae81ff">fuseim.pri/ifs    </span> <span style="color:#75715e"># å¤–éƒ¨åˆ¶å¤‡å™¨æä¾›è€…ï¼Œç¼–å†™ä¸ºæä¾›è€…çš„åç§°ï¼Œk8s-sigs.io/nfs-subdir-external-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">allowVolumeExpansion</span>: <span style="color:#66d9ef">true</span>      <span style="color:#75715e"># åŠ¨æ€è°ƒæ•´æŒä¹…å·å¤§å°</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">parameters</span>:     <span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">archiveOnDelete</span>: <span style="color:#e6db74">&#34;true&#34;</span>       <span style="color:#75715e"># æ˜¯å¦å­˜æ¡£ï¼Œfalseï¼šè¡¨ç¤ºä¸å­˜æ¡£ï¼Œä¼šåˆ é™¤oldPathä¸‹é¢çš„æ•°æ®ï¼Œtrueï¼šè¡¨ç¤ºå­˜æ¡£ï¼Œä¼šé‡å‘½åè·¯å¾„</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">reclaimPolicy</span>: <span style="color:#ae81ff">Retain  </span> <span style="color:#75715e"># å›æ”¶ç­–ç•¥ï¼Œé»˜è®¤ä¸ºï¼šDeleteï¼Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">volumeBindingMode</span>: <span style="color:#ae81ff">Immediate   </span> <span style="color:#75715e"># é»˜è®¤ä¸ºï¼šImmediateï¼Œè¡¨ç¤ºåˆ›å»º PVCç«‹å³è¿›è¡Œç»‘å®šï¼Œåªæœ‰ï¼šazurediskå’Œï¼šAWSelasticblockstore æ”¯æŒå…¶ä»–å€¼</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºæƒé™ï¼Œ<!-- raw HTML omitted --><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Permissions/kubernetes-permissions-template.yaml" rel="external" target="_self"><code>Kubernetes Permissions Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount   </span> <span style="color:#75715e"># æƒé™ç®¡ç†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole  </span> <span style="color:#75715e"># åˆ›å»ºé›†ç¾¤è§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner-runner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;nodes&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;persistentvolumes&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;delete&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;persistentvolumeclaims&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;storage.k8s.io&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;storageclasses&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;events&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;patch&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRoleBinding   </span> <span style="color:#75715e"># ç»‘å®šé›†ç¾¤è§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">run-nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner-runner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role   </span> <span style="color:#75715e"># åˆ›å»ºæ™®é€šè§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">leader-locking-nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;endpoints&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;patch&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">RoleBinding  </span> <span style="color:#75715e"># ç»‘å®šæ™®é€šè§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">leader-locking-nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">leader-locking-nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºé€‚ç”¨ä¸<!-- raw HTML omitted --><code>provisioner</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>Deployment</code><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-deployment-provisioner-nfs-template.yaml" rel="external" target="_self"><code>Kubernetes Deployment Provisioner NFS Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: apps/v1
</span></span><span style="display:flex;"><span>kind: Deployment
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: nfs-client-provisioner
</span></span><span style="display:flex;"><span>  namespace: default
</span></span><span style="display:flex;"><span>  labels:
</span></span><span style="display:flex;"><span>    app: nfs-client-provisioner
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  replicas: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  strategy:
</span></span><span style="display:flex;"><span>    type: Recreate      <span style="color:#75715e"># Recreate:ä¸æ»šåŠ¨æ›´æ–°ï¼Œ</span>
</span></span><span style="display:flex;"><span>  selector:
</span></span><span style="display:flex;"><span>    matchLabels:
</span></span><span style="display:flex;"><span>      app: nfs-client-provisioner
</span></span><span style="display:flex;"><span>  template:
</span></span><span style="display:flex;"><span>    metadata:
</span></span><span style="display:flex;"><span>      labels:
</span></span><span style="display:flex;"><span>        app: nfs-client-provisioner
</span></span><span style="display:flex;"><span>    spec:
</span></span><span style="display:flex;"><span>      hostNetwork: true
</span></span><span style="display:flex;"><span>      serviceAccountName: nfs-client-provisioner        <span style="color:#75715e"># å…³è”ï¼šnfs-client-provisioner è´¦å·æˆä¸è´¦æˆ·æƒé™</span>
</span></span><span style="display:flex;"><span>      containers:
</span></span><span style="display:flex;"><span>      - name: nfs-client-provisioner
</span></span><span style="display:flex;"><span>        image: registry.cn-beijing.aliyuncs.com/pylixm/nfs-subdir-external-provisioner:v4.0.0
</span></span><span style="display:flex;"><span>        resources:
</span></span><span style="display:flex;"><span>          limits:
</span></span><span style="display:flex;"><span>            cpu: 200m
</span></span><span style="display:flex;"><span>            memory: 128Mi
</span></span><span style="display:flex;"><span>          requests:
</span></span><span style="display:flex;"><span>            cpu: 50m
</span></span><span style="display:flex;"><span>            memory: 64Mi
</span></span><span style="display:flex;"><span>        volumeMounts:
</span></span><span style="display:flex;"><span>        - name: nfs-client-root
</span></span><span style="display:flex;"><span>          mountPath: /persistentvolumes
</span></span><span style="display:flex;"><span>        env:
</span></span><span style="display:flex;"><span>        - name: PROVISIONER_NAME
</span></span><span style="display:flex;"><span>          value: fuseim.pri/ifs   <span style="color:#75715e"># å¿…é¡»å’ŒStorageClassçš„å¤–éƒ¨åˆ¶å¤‡å™¨æä¾›è€…åå­—ç›¸åŒ</span>
</span></span><span style="display:flex;"><span>        - name: NFS_SERVER
</span></span><span style="display:flex;"><span>          value: 192.168.186.110        <span style="color:#75715e"># æŒ‡å®šè‡ªå·±nfsæœåŠ¡å™¨åœ°å€</span>
</span></span><span style="display:flex;"><span>        - name: NFS_PATH  
</span></span><span style="display:flex;"><span>          value: /opt/data/redis        <span style="color:#75715e"># nfsæœåŠ¡å™¨å…±äº«çš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>      volumes:
</span></span><span style="display:flex;"><span>      - name: nfs-client-root
</span></span><span style="display:flex;"><span>        nfs:
</span></span><span style="display:flex;"><span>          server: 192.168.186.110
</span></span><span style="display:flex;"><span>          path: /opt/data/redis</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>Service</code>ã€<code>StatefulSet</code>ã€<code>PVC</code><!-- raw HTML omitted -->ç”³è¯·åŠ¨æ€å­˜å‚¨å·<!-- raw HTML omitted --><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-svc-statefulset-storage-nfs-template.yaml" rel="external" target="_self"><code>Kubernetes Service StatefulSet NFS Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">service-template</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>    <span style="color:#75715e"># Serviceçš„ç«¯å£</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>      <span style="color:#75715e"># StatefulSet çš„Podç«¯å£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StatefulSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceName</span>: <span style="color:#ae81ff">service-template  </span> <span style="color:#75715e"># ä½¿ç”¨é‚£ä¸ªServiceç®¡ç†DNS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">updateStrategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate        </span> <span style="color:#75715e"># æ»šåŠ¨æ›´æ–°ï¼ŒOnDeleteï¼šåˆ é™¤æ›´æ–°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:      <span style="color:#75715e"># å¦‚æœæ›´æ–°çš„ç­–ç•¥æ˜¯OnDeleteï¼Œé‚£ä¹ˆrollingUpdateå°±å¤±æ•ˆ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">partition</span>: <span style="color:#ae81ff">2</span>      <span style="color:#75715e"># è¡¨ç¤ºä»ç¬¬2ä¸ªåˆ†åŒºå¼€å§‹æ›´æ–°ï¼Œé»˜è®¤æ˜¯0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">statefulset-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pvc-test  	# å…³è” PVC åå­—ï¼Œä»¥ä¾¿ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/usr/share/nginx/html</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeClaimTemplates</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pvc-test   </span> <span style="color:#75715e"># å®šä¹‰ï¼šPVC åå­—</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs-storage-template   </span> <span style="color:#75715e"># å­˜å‚¨ç±»åå­—ï¼Œå¿…é¡»å’ŒStorageClassçš„podsåå­—ç›¸åŒ</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">accessModes</span>:      <span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">ReadWriteMany  </span> <span style="color:#75715e"># å¤šèŠ‚ç‚¹è¯»å†™</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resources</span>:        <span style="color:#75715e"># æœŸæœ›èµ„æº</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">2Gi         </span> <span style="color:#75715e"># æœŸæœ›çš„ç©ºé—´å®¹é‡</span></span></span></code></pre></div><ul>
<li><code>StatefulSet</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>Pods</code><!-- raw HTML omitted -->å¤„äº<!-- raw HTML omitted --><code>Pending</code><!-- raw HTML omitted -->çŠ¶æ€ï¼Œ<!-- raw HTML omitted --><code>describe</code><!-- raw HTML omitted -->å‘½ä»¤æŸ¥çœ‹æœ‰ä»¥ä¸‹æŠ¥é”™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>0/3 nodes are available: pod has unbound immediate PersistentVolumeClaims. preemption: 0/3 nodes are available: 3 No preemption victims found for incoming pod..</code></li>
<li><code>quay.io/external_storage/nfs-client-provisioner:latest</code><!-- raw HTML omitted -->å®˜æ–¹é•œåƒéœ€è¦ç”¨åˆ°<!-- raw HTML omitted --><code>K8S</code><!-- raw HTML omitted -->é‡Œçš„<!-- raw HTML omitted --><code>SelfLink</code><!-- raw HTML omitted -->å‚æ•°<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->è§£å†³æ–¹æ³•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ–¹æ³•ä¸€ï¼šæ›´æ¢é•œåƒï¼Œå»ºè®®ä½¿ç”¨æ­¤æ–¹æ³•</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é•œåƒä¸€</span>
</span></span><span style="display:flex;"><span>gcr.io/k8s/staging-sig-storage/nfs-subdir-external-provisioner:v4.0.0
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é•œåƒäºŒ</span>
</span></span><span style="display:flex;"><span>registry.cn-beijing.aliyuncs.com/pylixm/nfs-subdir-external-provisioner:v4.0.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ¢é•œåƒåé‡æ–°åº”ç”¨</span>
</span></span><span style="display:flex;"><span>$ kubectl replace -f kubernetes-deployment-provisioner-nfs-template.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–¹æ³•äºŒï¼šè§£å†³å®˜æ–¹ä¸æ”¯æŒæ–¹å¼</span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;&gt;/etc/kubernetes/manifests/kube-apiserver.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - command:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kube-apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - --feafure-gates=RemoveSelfLink=false  	# æ–°å¢å‚æ•°ï¼Œé»˜è®¤æ˜¯ï¼štrue 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°åº”ç”¨</span>
</span></span><span style="display:flex;"><span>$ kubectl apply -f /etc/kubernetes/manifests/kube-apiserver.yaml</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>PVC</code> <!-- raw HTML omitted -->æ–¹å¼ç”³è¯·åŠ¨æ€<!-- raw HTML omitted --><code>StorageClass</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">200Mi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs-storage-template   </span> <span style="color:#75715e"># å­˜å‚¨ç±»åå­—ï¼Œå¿…é¡»å’ŒStorageClassçš„podsåå­—ç›¸	</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="pvcæŒä¹…å·ç”³è¯·ä¹¦"><code>PVC</code>æŒä¹…å·ç”³è¯·ä¹¦</h3>
<ul>
<li>
<ol>
<li><code>PVC(Persistent Volume Claim)</code>æ˜¯æŒä¹…åŒ–å·å£°æ˜çš„æ„æ€ï¼Œæ˜¯ç”¨æˆ·å¯¹äºå­˜å‚¨éœ€æ±‚çš„ä¸€ç§å£°æ˜ã€‚æ¢è¨€ä¹‹ï¼ŒPVCå…¶å®å°±æ˜¯ç”¨æˆ·å‘<code>kubernetes</code>ç³»ç»Ÿå‘å‡ºçš„ä¸€ç§èµ„æºéœ€æ±‚ç”³è¯·</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>PVC</code>ï¼š<code>kubernetes</code>ç”¨æˆ·ç»´æŠ¤</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>PVC</code>æ˜¯èµ„æºçš„ç”³è¯·ï¼Œç”¨æ¥å£°æ˜å¯¹å­˜å‚¨ç©ºé—´ã€è®¿é—®æ¨¡å¼ã€å­˜å‚¨ç±»åˆ«éœ€æ±‚ä¿¡æ¯</li>
</ol>
</li>
<li>
<ol start="4">
<li><code>PVC</code><!-- raw HTML omitted -->çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>accessModes</code>(è®¿å®¢æ¨¡å¼)ï¼šç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™</li>
</ul>
<blockquote>
<ul>
<li><code>selector</code>(é€‰æ‹©æ¡ä»¶)ï¼šé€šè¿‡<code>Label Selector</code>çš„è®¾ç½®ï¼Œå¯ä½¿<code>PVC</code>å¯¹äºç³»ç»Ÿä¸­å·²å­˜åœ¨çš„<code>PV</code>è¿›è¡Œç­›é€‰</li>
<li><code>storageClassName</code>(å­˜å‚¨ç±»åˆ«)ï¼š<code>PVC</code>åœ¨å®šä¹‰æ—¶å¯ä»¥è®¾å®šéœ€è¦çš„åç«¯å­˜å‚¨çš„ç±»åˆ«ï¼Œåªæœ‰è®¾ç½®äº†è¯¥<code>class</code>çš„<code>pv</code>æ‰èƒ½è¢«ç³»ç»Ÿé€‰å‡º</li>
<li><code>resources</code>(èµ„æºè¯·æ±‚)ï¼šæè¿°å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚</li>
</ul>
</blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-pvc-template.yaml" rel="external" target="_self"><code>Kubernetes PVC Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">##########   å®šä¹‰Redisçš„PVCç”³è¯·ä¹¦ï¼Œç”¨äºç”³è¯· Redisçš„PV   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pvc-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMode</span>: <span style="color:#ae81ff">Filesystem       </span> <span style="color:#75715e"># æ–‡ä»¶ç³»ç»Ÿä¹Ÿéœ€è¦ä¸ PVç›¸åŒæ‰èƒ½ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:          <span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany      </span> <span style="color:#75715e"># æƒé™éœ€è¦ä¸å¯¹åº”çš„PV ç›¸åŒï¼Œæ‰å¯ä»¥ä½¿ç”¨ï¼ŒReadï¼šè¯»ã€Writeï¼šå†™ã€Onceï¼šå•èŠ‚ç‚¹ã€Manyï¼šä»£è¡¨å¤šèŠ‚ç‚¹ï¼ŒOnlyï¼šåªè¯»åªå†™</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs        </span> <span style="color:#75715e"># éœ€è¦ä¸PVåå­—ç›¸åŒï¼ŒBlock:ä»£è¡¨å—å­˜å‚¨ã€Filesystem:ä»£è¡¨æ–‡ä»¶ç³»ç»Ÿã€nfs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:    <span style="color:#75715e"># è¯·æ±‚ç©ºé—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">5Gi     </span> <span style="color:#75715e"># å¯¹PVç”³è¯· 5G çš„å­˜å‚¨ç©ºé—´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   å®šä¹‰Nginxçš„PVCç”³è¯·ä¹¦ï¼Œç”¨äºç”³è¯· Redisçš„PV   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pvc-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeMode</span>: <span style="color:#ae81ff">Filesystem</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:          <span style="color:#75715e"># è®¿é—®æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany      </span> <span style="color:#75715e"># Read:ä»£è¡¨å¯è¯»ã€Write:ä»£è¡¨å†™ã€Many:ä»£è¡¨å¤šèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">nfs        </span> <span style="color:#75715e"># å­˜å‚¨ç±»å‹ ï¼ŒBlock:ä»£è¡¨å—å­˜å‚¨ã€Filesystem:ä»£è¡¨æ–‡ä»¶ç³»ç»Ÿã€nfs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:    <span style="color:#75715e"># è¯·æ±‚ç©ºé—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">5Gi     </span> <span style="color:#75715e"># å¯¹PVç”³è¯· 5G çš„å­˜å‚¨ç©ºé—´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########      åˆ›å»º Deployment è®¿é—® PVC ç±»å‹å­˜å‚¨   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pod-pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pod-pvc-template</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:      <span style="color:#75715e"># å½“typeä¸ºRollingUpdateçš„æ—¶å€™ç”Ÿæ•ˆï¼Œç”¨äºä¸ºrollingUpdateè®¾ç½®å‚æ•°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%      </span> <span style="color:#75715e"># ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">30</span><span style="color:#ae81ff">%    </span> <span style="color:#75715e"># ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate        </span> <span style="color:#75715e"># æ›´æ–°ç­–ç•¥ã€æ”¯æŒ Recreate, RollingUpdateã€‚é»˜è®¤RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:     <span style="color:#75715e"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:        <span style="color:#75715e"># LabelsåŒ¹é…è§„åˆ™ï¼ŒmatchExpressionsï¼šExpressionsåŒ¹é…è§„åˆ™ </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pvc-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:     <span style="color:#75715e"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:   <span style="color:#75715e"># Pod çš„æ ‡ç­¾</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-pvc-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#  nodeSelector:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#    kubernetes.io/hostname: kube-01     # æŒ‡å®šèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">reids</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">redis:6.2.7</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>,<span style="color:#e6db74">&#34;-c&#34;</span>,<span style="color:#e6db74">&#34;while true;do echo pod1 &gt;&gt; /root/out.txt; sleep 10; done;&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-data       </span> <span style="color:#75715e"># å¿…é¡»ä¸volumeå®šä¹‰çš„åç§°ç›¸åŒ</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/opt/redis/conf       </span> <span style="color:#75715e"># å®¹å™¨å†…è·¯å¾„</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis-data   </span> <span style="color:#75715e"># è‡ªå®šä¹‰åç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">persistentVolumeClaim</span>:      <span style="color:#75715e"># å…³è” PVC</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">claimName</span>: <span style="color:#ae81ff">redis-pvc-template    </span> <span style="color:#75715e"># å…³è” PVCï¼Œå¿…é¡»å’Œå®šä¹‰PVCåç§°ç›¸åŒä¸”ï¼Œå¿…é¡»å’Œå½“å‰podåœ¨åŒä¸€ä¸ªå‘½åç©ºé—´</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">false</span>   <span style="color:#75715e"># æ˜¯å¦åªè¯»ï¼Œé»˜è®¤false</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="pvfont-colorredå’Œfontpvc"><code>PV</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PVC</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>PVC</code><!-- raw HTML omitted -->åä¸€ç›´ç»‘å®šä¸äº†<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->çš„åŸå› <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p>â‘  <code>PVC</code><!-- raw HTML omitted -->çš„ç©ºé—´ç”³è¯·å¤§å°æ¯”<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->çš„ç©ºé—´è¦å¤§<!-- raw HTML omitted --></p>
<p>â‘¡ <code>PVC</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>storageClassName</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>storageClassName</code><!-- raw HTML omitted -->ä¸ä¸€è‡´<!-- raw HTML omitted --></p>
<p>â‘¢ <code>PVC</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>accessModes</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>accessModes</code><!-- raw HTML omitted -->ä¸ä¸€è‡´<!-- raw HTML omitted --></p>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>PVC</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->æ˜¯ä¸€ä¸€å¯¹åº”ï¼Œ<!-- raw HTML omitted --><code>PV</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PVC</code><!-- raw HTML omitted -->ä¹‹é—´çš„ç›¸äº’ä½œç”¨éµå¾ªå¦‚ä¸‹ç”Ÿå‘½å‘¨æœŸ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->èµ„æºä¾›åº”ï¼š<!-- raw HTML omitted -->ç®¡ç†å‘˜æ‰‹åŠ¨åˆ›å»ºåº•å±‚å­˜å‚¨å’Œ<code>PV</code></li>
<li><!-- raw HTML omitted -->èµ„æºç»‘å®š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ç”¨æˆ·åˆ›å»º<code>PVC</code>ï¼Œ<code>kubernetes</code>è´Ÿè´£æ ¹æ®<code>PVC</code>å£°æ˜å»å¯»æ‰¾<code>PV</code>ï¼Œå¹¶ç»‘å®šåœ¨ç”¨æˆ·å®šä¹‰å¥½<code>PVC</code>ä¹‹åï¼Œç³»ç»Ÿå°†æ ¹æ®<code>PVC</code>å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚åœ¨ä»¥å­˜åœ¨çš„<code>PV</code>ä¸­é€‰æ‹©ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„</li>
</ul>
<blockquote>
<ul>
<li>ä¸€æ—¦æ‰¾åˆ°å°±å°†è¯¥<code>PV</code>å’Œç”¨æˆ·å®šä¹‰çš„<code>PVC</code>è¿›è¡Œç»‘å®šï¼Œç”¨æˆ·çš„åº”ç”¨å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ª<code>PVC</code>äº†</li>
<li>å¦‚æœæ‰¾ä¸åˆ°<code>PVC</code>å°±ä¼šæ— é™æœŸçš„å¤„äº<code>Pending</code>çŠ¶æ€ï¼Œç›´åˆ°ç³»ç»Ÿç®¡ç†å‘˜åˆ›å»ºä¸€ä¸ªç¬¦åˆå…¶è¦æ±‚çš„<code>PV</code></li>
</ul>
</blockquote>
<ul>
<li><code>PV</code>ä¸€æ—¦ç»‘å®šåˆ°æŸä¸ª<code>PVC</code>ä¸Šå°±ä¼šè¢«è¿™ä¸ª<code>PVC</code>ç‹¬å ï¼Œä¸èƒ½å†å’Œå…¶ä»–çš„<code>PVC</code>è¿›è¡Œç»‘å®šäº†</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->èµ„æºä½¿ç”¨ï¼š<!-- raw HTML omitted -->ç”¨æˆ·å¯ä»¥åœ¨<code>Pod</code>ä¸­åƒ<code>volume</code>ä¸€æ ·ä½¿ç”¨<code>PVC</code>ï¼Œ<code>Pod</code>ä½¿ç”¨<code>Volume</code>çš„å®šä¹‰ï¼Œå°†<code>PVC</code>æŒ‚è½½åˆ°å®¹å™¨å†…çš„æŸä¸ªè·¯å¾„è¿›è¡Œä½¿ç”¨</li>
<li><!-- raw HTML omitted -->èµ„æºé‡Šæ”¾<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ç”¨æˆ·åˆ é™¤<code>PVC</code>æ¥é‡Šæ”¾<code>PV</code></li>
<li>å½“å­˜å‚¨èµ„æºä½¿ç”¨å®Œæ¯•åï¼Œç”¨æˆ·å¯ä»¥åˆ é™¤<code>PVC</code>ï¼Œå’Œè¯¥<code>PVC</code>ç»‘å®šçš„<code>PV</code>å°†ä¼šæ ‡è®°ä¸º<!-- raw HTML omitted -->å·²é‡Šæ”¾<!-- raw HTML omitted -->ä½†æ˜¯è¿˜ä¸èƒ½ç«‹åˆ»å’Œå…¶ä»–çš„<code>PVC</code>è¿›è¡Œç»‘å®šã€‚é€šè¿‡ä¹‹å‰<code>PVC</code>å†™å…¥çš„æ•°æ®å¯èƒ½è¿˜ç•™åœ¨å­˜å‚¨è®¾å¤‡ä¸Šï¼Œåªæœ‰åœ¨æ¸…é™¤ä¹‹åè¯¥<code>PV</code>æ‰èƒ½å†æ¬¡ä½¿ç”¨</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->èµ„æºå›æ”¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>kubernetes</code>æ ¹æ®<code>PV</code>è®¾ç½®çš„å›æ”¶ç­–ç•¥è¿›è¡Œèµ„æºçš„å›æ”¶</li>
<li>å¯¹äº<code>PV</code>ï¼Œç®¡ç†å‘˜å¯ä»¥è®¾å®šå›æ”¶ç­–ç•¥ï¼Œç”¨äºè®¾ç½®ä¸ä¹‹ç»‘å®šçš„<code>PVC</code>é‡Šæ”¾èµ„æºä¹‹åå¦‚ä½•å¤„ç†é—ç•™æ•°æ®çš„é—®é¢˜ã€‚åªæœ‰<code>PV</code>çš„å­˜å‚¨ç©ºé—´å®Œæˆå›æ”¶ï¼Œæ‰èƒ½ä¾›æ–°çš„<code>PVC</code>ç»‘å®šå’Œä½¿ç”¨</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h2 id="é…ç½®æ–‡ä»¶å­˜å‚¨ç®¡ç†">é…ç½®æ–‡ä»¶å­˜å‚¨ç®¡ç†</h2>
<h3 id="configmapfont-colorredfontsecretfont-colorredè¦†ç›–fontmarkçƒ­æ›´æ–°mark"><code>ConfigMap</code><!-- raw HTML omitted -->&amp;<!-- raw HTML omitted --><code>Secret</code><!-- raw HTML omitted -->è¦†ç›–<!-- raw HTML omitted --><!-- raw HTML omitted -->çƒ­æ›´æ–°<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æ³¨æ„äº‹é¡¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>SubPath</code><!-- raw HTML omitted -->è§£å†³<!-- raw HTML omitted --><code>ConfigMap</code><!-- raw HTML omitted -->&amp;&amp;<!-- raw HTML omitted --><code>Secret</code><!-- raw HTML omitted -->ç›®å½•è¦†ç›–é—®é¢˜ï¼Œ<!-- raw HTML omitted --><code>SubPath</code><!-- raw HTML omitted -->ä¸æ”¯æŒçƒ­æ›´æ–°<!-- raw HTML omitted --></li>
<li>å¦‚æœ<code>ConfigMap</code>å’Œ<code>Secret</code>æ˜¯ä»¥<code>subPath</code>çš„å½¢å¼æŒ‚è½½çš„ï¼Œé‚£ä¹ˆ<code>Pod</code>æ˜¯ä¸ä¼šæ„ŸçŸ¥åˆ°<code>ConfigMap</code>å’Œ<code>Secret</code>çš„æ›´æ–°çš„</li>
<li>å¦‚æœ<code>Pod</code>çš„å˜é‡æ¥è‡ª<code>ConfigMap</code>å’Œ<code>Secret</code>ä¸­å®šä¹‰çš„å†…å®¹ï¼Œé‚£ä¹ˆ<code>ConfigMap</code>å’Œ<code>Secret</code>æ›´æ–°åï¼Œä¹Ÿä¸ä¼šæ›´æ–°<code>Pod</code>ä¸­çš„å˜é‡</li>
<li><code>immutable: true</code><!-- raw HTML omitted -->ï¼šç¦æ­¢ä¿®æ”¹<!-- raw HTML omitted --><code>ConfigMap</code>ã€<code>Secret</code></li>
</ul>
</blockquote>
<hr>
<h3 id="configmapé…ç½®ç±»å‹"><code>ConfigMap</code>é…ç½®ç±»å‹</h3>
<h4 id="configmapç®€ä»‹ä»¥åŠæ³¨æ„äº‹é¡¹"><code>ConfigMap</code>ç®€ä»‹ä»¥åŠæ³¨æ„äº‹é¡¹</h4>
<blockquote>
<ul>
<li><code>ConfigMap</code><!-- raw HTML omitted -->ï¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„å­˜å‚¨å·ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å­˜å‚¨é…ç½®ä¿¡æ¯çš„<!-- raw HTML omitted --></li>
<li><code>ConfigMap</code>ä¸­çš„<code>key</code>æ˜ å°„ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œ<code>value</code>æ˜ å°„ä¸ºæ–‡ä»¶ä¸­çš„å†…å®¹ã€‚å¦‚æœæ›´æ–°äº†<code>ConfigMap</code>ä¸­çš„å†…å®¹ï¼Œå®¹å™¨ä¸­çš„å€¼ä¹Ÿä¼šåŠ¨æ€æ›´æ–°</li>
<li><code>ConfigMap</code>æ˜¯ä¸€ç§<code>API</code>å¯¹è±¡ï¼Œ<!-- raw HTML omitted -->ç”¨æ¥å°†éåŠ å¯†æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­ã€‚å¯ä»¥ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>ConfigMap</code><!-- raw HTML omitted -->å¯ä»¥å°†ç¯å¢ƒå˜é‡é…ç½®ä¿¡æ¯å’Œå®¹å™¨é•œåƒè§£è€¦ï¼Œä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹ã€‚å¦‚æœéœ€è¦å­˜å‚¨åŠ å¯†ä¿¡æ¯æ—¶å¯ä»¥ä½¿ç”¨<!-- raw HTML omitted --><code>Secret</code>å¯¹è±¡</li>
<li>ä½¿ç”¨<code>ConfigMap</code><!-- raw HTML omitted -->æœ‰ä»¥ä¸‹å‡ ä¸ªé™åˆ¶æ¡ä»¶ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>ConfigMap</code><!-- raw HTML omitted -->å¿…é¡»<!-- raw HTML omitted -->åœ¨<code>pod</code>ä¹‹å‰åˆ›å»º</li>
<li><code>ConfigMap</code>å—<code>namespace</code>çš„é™åˆ¶ï¼Œ<!-- raw HTML omitted -->åªèƒ½<!-- raw HTML omitted -->ç›¸åŒ<code>namespace</code>çš„<code>pod</code>æ‰å¯ä»¥å¼•ç”¨</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æ³¨æ„äº‹é¡¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>ConfigMap</code><!-- raw HTML omitted -->åœ¨è®¾è®¡ä¸Šä¸æ˜¯ç”¨æ¥ä¿å­˜å¤§é‡æ•°æ®çš„<!-- raw HTML omitted -->åœ¨<code>ConfigMap</code>ä¸­ä¿å­˜çš„æ•°æ®ä¸å¯è¶…è¿‡<code>1 MiB</code></li>
<li>å¦‚æœéœ€è¦ä¿å­˜è¶…å‡ºæ­¤å°ºå¯¸é™åˆ¶çš„æ•°æ®ï¼Œéœ€è¦è€ƒè™‘æŒ‚è½½å­˜å‚¨å·æˆ–è€…ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“æˆ–è€…æ–‡ä»¶æœåŠ¡</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h4 id="configmapä½¿ç”¨ä»¥åŠé…ç½®"><code>ConfigMap</code>ä½¿ç”¨ä»¥åŠé…ç½®</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è·å–ä½¿ç”¨å¸®åŠ©<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create configmap -h  	<span style="color:#75715e"># æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap &lt;map-name&gt; &lt;data-source&gt;  	<span style="color:#75715e"># å‘½ä»¤ä½¿ç”¨æ–¹å¼  </span></span></span></code></pre></div><ul>
<li>ä»<!-- raw HTML omitted -->ç›®å½•<!-- raw HTML omitted -->ä¸­åˆ›å»º<code>ConfigMap</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -pv /opt/yaml/configmap/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;/opt/yaml/configmap/config/db.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port=3306
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">username=root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host=127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;/opt/yaml/configmap/config/redis.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port=6379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host=127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --from-fileï¼šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«ç”¨åœ¨ConfigMapé‡Œé¢åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®çš„åå­—å°±æ˜¯æ–‡ä»¶åï¼Œå€¼å°±æ˜¯æ–‡ä»¶çš„å†…å®¹ï¼Œ  </span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap configmap-template --from-file<span style="color:#f92672">=</span>/opt/yaml/configmap/config/</span></span></code></pre></div><ul>
<li>ä»<!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted -->ä¸­åˆ›å»º<code>ConfigMap</code><!-- raw HTML omitted -->ï¼Œå¹¶è‡ªå®šä¹‰<!-- raw HTML omitted --><code>ConfigMap</code><!-- raw HTML omitted -->ä¸­<!-- raw HTML omitted --><code>key</code><!-- raw HTML omitted -->çš„åç§°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># --from-fileï¼Œå¯ä»¥ä½¿ç”¨å¤šæ¬¡ï¼ŒåŒæ ·é”®ä¸ºæ–‡ä»¶åï¼Œå€¼ä¸ºæ–‡ä»¶ä¸­çš„å†…å®¹</span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap configmap-template-2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-file<span style="color:#f92672">=</span>rename1<span style="color:#f92672">=</span>/opt/yaml/configmap/config/db.properties <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-file<span style="color:#f92672">=</span>rename2<span style="color:#f92672">=</span>/opt/yaml/configmap/config/redis.properties  </span></span></code></pre></div><ul>
<li><code>--from-literal=key=value</code><!-- raw HTML omitted -->é”®å€¼å¯¹æ–¹å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨ï¼šliteral(key:value)ï¼Œæ–¹å¼ï¼Œ--from-literal=key1=123 --from-literal=key2=234</span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap configmap-template-3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-literal<span style="color:#f92672">=</span>key-1<span style="color:#f92672">=</span>value-1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-literal<span style="color:#f92672">=</span>key-2<span style="color:#f92672">=</span>value-2</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä»ç¯å¢ƒå˜é‡æ–‡ä»¶åˆ›å»º<!-- raw HTML omitted --><code>ConfigMap</code></li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->æ³¨æ„ï¼š<!-- raw HTML omitted -->å½“<code>--from-env-file</code>ä»å¤šä¸ªæ•°æ®æºåˆ›å»º<code>ConfigMap</code>çš„æ—¶å€™ï¼Œä»…ä»…æœ€åä¸€ä¸ª<code>env</code>æ–‡ä»¶æœ‰æ•ˆ</p>
</li>
<li>
<p><!-- raw HTML omitted -->è¯­æ³•è§„åˆ™ï¼š<!-- raw HTML omitted --></p>
<p><code>env</code>æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå¿…é¡»ä¸º<code>VAR = VAL</code>æ ¼å¼</p>
<p>ä»¥<code>ï¼ƒ</code>å¼€å¤´çš„è¡Œ(å³æ³¨é‡Š)å°†è¢«å¿½ç•¥</p>
<p>ç©ºè¡Œå°†è¢«å¿½ç•¥</p>
<p>å¼•å·æ²¡æœ‰ç‰¹æ®Šå¤„ç†(å³å®ƒä»¬å°†æˆä¸º<code>ConfigMap</code>å€¼çš„ä¸€éƒ¨åˆ†)</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create configmap configmap-template-3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --from-literal<span style="color:#f92672">=</span>password<span style="color:#f92672">=</span>passwd123 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --from-literal<span style="color:#f92672">=</span>APP_NAME<span style="color:#f92672">=</span>springboot-test <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --from-literal<span style="color:#f92672">=</span>JAVA_OPTS_TEST<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Xms512m -Xmx512&#39;</span>  </span></span></code></pre></div><ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-configmap-env-template.yaml" rel="external" target="_self"><code>Kubernetes ConfigMap ENV Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-env-test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: 
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-env-test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-env-test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">env-test</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">command</span>: [ <span style="color:#e6db74">&#34;/bin/sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;env;sleep 3600&#34;</span> ]
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">env</span>:          <span style="color:#75715e"># å®šä¹‰ç¯å¢ƒå˜é‡</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">APP_ENV_TEST_CM      </span> <span style="color:#75715e"># å®šä¹‰ç¯å¢ƒå˜é‡å</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">configMapKeyRef</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template-3     </span> <span style="color:#75715e"># ConfigMap çš„åå­—</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">key</span>: <span style="color:#ae81ff">APP_NAME  </span> <span style="color:#75715e"># è¡¨ç¤ºä» nameçš„ConfigMapä¸­è·å–åå­—ä¸ºKey çš„valueï¼Œå°†å…¶èµ‹å€¼ç»™å®¹å™¨å†…æœ¬åœ°çš„ç¯å¢ƒå˜é‡ APP_ENV_TEST_CM</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">JAVA_ENV_TEST_CM</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">configMapKeyRef</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template-3     </span> <span style="color:#75715e"># ConfigMap çš„åå­—</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">key</span>: <span style="color:#ae81ff">JAVA_OPTS_TEST    </span> <span style="color:#75715e"># ConfigMap çš„ key</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">volumeMounts</span>:   <span style="color:#75715e"># åŠ è½½æ•°æ®å·</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">passwd-config  </span> <span style="color:#75715e"># è¡¨ç¤ºåŠ è½½ volumes å±æ€§ä¸­é‚£ä¸ªæ•°æ®å·</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">mountPath</span>: <span style="color:#e6db74">&#34;/opt/&#34;</span>    <span style="color:#75715e"># æƒ³è¦å°†æ•°æ®å·ä¸­çš„æ–‡ä»¶åŠ è½½åˆ°é‚£ä¸ªç›®å½•ä¸‹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">true</span>    <span style="color:#75715e"># æ˜¯å¦åªè¯»</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>: <span style="color:#75715e"># ä¾æ•°æ®å·æ–¹å¼æŒ‚è½½ ConfigMap Secret</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">passwd-config  </span> <span style="color:#75715e"># è‡ªå®šä¹‰åå­—</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMap</span>:    <span style="color:#75715e"># æ•°æ®å·ç±»å‹ä¸ºï¼šConfigMap</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template-3   </span> <span style="color:#75715e"># ComfigMap çš„åå­—ï¼Œå¿…é¡»å’ŒåŠ è½½çš„ConfigMapç›¸åŒ</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">items</span>:    <span style="color:#75715e"># å¯¹ ConfigMapä¸­çš„Keyè¿›è¡Œæ˜ å°„ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šå°†ConfigMapä¸­æ‰€æœ‰Keyå…¨éƒ¨è½¬æ¢ä¸ºä¸€ä¸ªä¸ªåŒåæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;password&#34;</span>   <span style="color:#75715e"># ConfigMapä¸­çš„Key</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;password&#34;</span>    <span style="color:#75715e"># å°†è¯¥Keyçš„å€¼è½¬æ¢ä¸ºæ–‡ä»¶  </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Always</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;&gt;/opt/yaml/configmap/config/env-file.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enemies=aliens
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lives=3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">allowed=&#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create cm configmap-template-3 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --from-env-file<span style="color:#f92672">=</span>/opt/yaml/configmap/config/env-file.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;env.txt<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å…¶ä¸­ï¼Œenv.txtçš„æ–‡ä»¶æ ¼å¼ä¸º:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">key1=***
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">key2=***
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create configmap configmapå --from-env-file<span style="color:#f92672">=</span>env.txt </span></span></code></pre></div></blockquote>
<ul>
<li><code>ConfigMap</code><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>nginx.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶è¿›è¡Œæ›¿æ¢<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;&gt;nginx.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#user  nobody;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">worker_processes  1;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">events {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> worker_connections  1024;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#########   æˆ‘æ˜¯æµ‹è¯•é…ç½®æ–‡ä»¶   ##########
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> include       mime.types;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> default_type  application/octet-stream;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> sendfile        on;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> keepalive_timeout  65;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     listen       80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     server_name  localhost;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         root   html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         index  index.html index.htm;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     error_page   500 502 503 504  /50x.html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     location = /50x.html {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         root   html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>nginx.conf</code><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>ConfigMap</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create configmap nginxconf-cm-template --from-file<span style="color:#f92672">=</span>nginx.conf</span></span></code></pre></div><ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-configmap-template.yaml" rel="external" target="_self"><code>Kubernetes configmap Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e">##########   é…ç½® Deployment å¼•ç”¨ ConfigMap åˆ›å»ºçš„æ–‡ä»¶   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-configmap-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: 
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-cm-template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-cm-template</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">limits</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">200m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">50m</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">128Mi</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config   </span> <span style="color:#75715e"># å¼•ç”¨å®šä¹‰çš„ vulumes åç§°</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#e6db74">&#39;/etc/nginx/nginx.conf&#39;</span>    <span style="color:#75715e"># æ–‡ä»¶å…¨è·¯å¾„</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">subPath</span>: <span style="color:#ae81ff">etc/nginx/nginx.conf  </span> <span style="color:#75715e"># subPathï¼šè¦è¦†ç›–æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œåªè¦†ç›–å¿…è¦æ–‡ä»¶ï¼Œå¦‚æœç¼ºå°‘æ­¤é…ç½®ï¼Œå°†æ¸…ç©ºåŸæœ‰çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œä¸éœ€è¦æœ€å‰é¢çš„ï¼š/</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Always</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config   </span> <span style="color:#75715e"># å®šä¹‰ volumes çš„åç§°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMap</span>: <span style="color:#75715e"># ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginxconf-cm-template     </span> <span style="color:#75715e"># ConfigMapåç§°ï¼Œä½¿ç”¨åç§°è¿›è¡Œå…³è” ConfigMap</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">items</span>:   <span style="color:#75715e"># å°†configMapä¸­çš„Keyè¿›è¡Œæ˜ å°„ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šå°†configMapä¸­æ‰€æœ‰Keyå…¨éƒ¨è½¬ä¸ºä¸€ä¸ªä¸ªåŒåæ–‡æ¡£</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">nginx.conf   </span> <span style="color:#75715e"># configMapä¸­çš„Key</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">etc/nginx/nginx.conf  </span> <span style="color:#75715e"># å°†è¯¥Keyçš„å€¼è½¬ä¸ºæ–‡ä»¶ï¼Œæœ€å‰é¢ä¸éœ€è¦ï¼š/</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted --> è¿›å…¥<code>Pod</code>ä¸­æŸ¥çœ‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl exec -it nginx-configmap-pod --  /bin/sh
</span></span><span style="display:flex;"><span>$ more /etc/nginx/nginx.conf</span></span></code></pre></div></blockquote>
<ul>
<li><a href="https://raw.githubusercontent.com/usermice/imgs/master/Kubernetes_Server/Template/Storage/kubernetes-configmap-simple-template.yaml" rel="external" target="_self"><code>Kubernetes ConfigMap Simple Template</code>æ¨¡æ¿</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template   </span> <span style="color:#75715e"># ConfigMap</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:   <span style="color:#75715e"># &lt;map[string]string&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">info</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">username:admin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">password:123456</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   æŒ‚è½½æ•°æ®æ–¹å¼   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">stream.conf</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    stream.conf {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        listen 1550;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        proxy_pass  192.168.3.125:16303;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }</span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   æŒ‚è½½æ•°æ®æ–¹å¼   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">listen-port</span>: <span style="color:#e6db74">&#34;8080&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">server-name</span>: <span style="color:#ae81ff">www.erge.com</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">default-vhost: |      # æ­¤å†…å®¹ä¼ ç»™ Pod ä¸­ items: ä¸‹ path</span>: <span style="color:#ae81ff">è·¯å¾„ä¸­</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">server {</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">listen 8080 default;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">location / {</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">return 200 &#34;default-vhost!\r\n&#34;;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">blog-vhosts</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      listen 8080;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      server_name blog.erge.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        return 200 &#34;blog-vhosts!\r\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }</span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   é…ç½®envå¼•ç”¨æ–¹å¼ pod-configmap   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-pod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tier</span>: <span style="color:#ae81ff">configmap</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">role</span>: <span style="color:#ae81ff">slb</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">mountPath</span>: <span style="color:#e6db74">&#39;/etc/nginx&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">LISTEN_PORT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMapKeyRef</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">slb-vhosts-config</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">listen-port</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">SERVER_NAME</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">configMapKeyRef</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">slb-vhosts-config</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">server-name</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config  	# å®šä¹‰ volumes çš„åç§°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">configMap</span>: <span style="color:#75715e"># ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap-template </span> <span style="color:#75715e"># ConfigMapç”Ÿæˆçš„Pod åç§°ï¼Œä½¿ç”¨åç§°å…³è”</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># items:   # å°†configMapä¸­çš„Keyè¿›è¡Œæ˜ å°„ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šå°†configMapä¸­æ‰€æœ‰Keyå…¨éƒ¨è½¬ä¸ºä¸€ä¸ªä¸ªåŒåæ–‡æ¡£</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e"># - key: nginx.conf    # configMapä¸­çš„Key</span>
</span></span><span style="display:flex;"><span>     <span style="color:#75715e">#   path: etc/nginx/nginx.conf   # å°†è¯¥Keyçš„å€¼è½¬ä¸ºæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   é…ç½®volumeå¼•ç”¨æ–¹å¼ pod-configmap   ########## </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-configmap</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/configmap/config     </span> <span style="color:#75715e"># æ²¡æœ‰åˆ™ä¼šè‡ªåŠ¨åˆ›å»º,ç›®å½•ä¸‹æœ‰æ–‡ä»¶åˆ™ä¼šè¦†ç›–æ‰</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-config         </span> <span style="color:#75715e"># æ­¤åç§°å’Œ volumeMountså®šä¹‰nameåç§°ä¸€æ ·</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">configMap</span>:          <span style="color:#75715e"># ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">configmap  </span> <span style="color:#75715e"># é…ç½®ä¸º configMap å®¹å™¨çš„åç§°</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">defaultMode</span>: <span style="color:#ae81ff">integer      </span> <span style="color:#75715e"># æŒ‚è½½åˆ°Podä¸­åï¼Œæ–‡ä»¶æƒé™ï¼Œå¦‚0444</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">default-vhost       </span> <span style="color:#75715e"># configMapä¸­dataä¸‹çš„key</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">default.conf       </span> <span style="color:#75715e"># æŒ‚è½½è·¯å¾„ï¼Œè·å–Configmapä¸­dataå…³é”®å­—ä¸‹ å®šä¹‰é…ç½®æ–‡ä»¶åä¼ ç»™ volumeMounts ä¸‹çš„mountPathä¸­</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mode</span>: <span style="color:#ae81ff">integer    </span> <span style="color:#75715e"># æ–‡ä»¶æƒé™</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">blog-vhosts</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">blog.conf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">optional</span>: <span style="color:#66d9ef">true</span>      <span style="color:#75715e"># å½“keyä¸å­˜åœ¨æ—¶æ˜¯å¦æŠ¥é”™ï¼Œé»˜è®¤true</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="secretå¯†ç ä»¤ç‰Œç±»å‹"><code>Secret</code>å¯†ç ä»¤ç‰Œç±»å‹</h3>
<h4 id="secretç®€ä»‹ä»¥åŠæ³¨æ„äº‹é¡¹"><code>Secret</code>ç®€ä»‹ä»¥åŠæ³¨æ„äº‹é¡¹</h4>
<blockquote>
<ul>
<li><code>Secret</code><!-- raw HTML omitted -->ï¼šåœ¨<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->ä¸­ï¼Œè¿˜å­˜åœ¨ä¸€ç§å’Œ<!-- raw HTML omitted --><code>ConfigMap</code><!-- raw HTML omitted -->éå¸¸ç±»ä¼¼çš„å¯¹è±¡ï¼Œç§°ä¸º<!-- raw HTML omitted --><code>Secret</code><!-- raw HTML omitted -->å¯¹è±¡ï¼Œå®ƒä¸»è¦ç”¨æ¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€å¯†é’¥ã€è¯ä¹¦ç­‰ç­‰<!-- raw HTML omitted --></li>
<li><code>imagePullSecret</code><!-- raw HTML omitted -->ï¼š<code>Pod</code>æ‹‰å–ç§æœ‰é•œåƒä»“åº“çš„æ—¶ä½¿ç”¨çš„è´¦æˆ·å¯†ç ï¼Œä¼šä¼ é€’ç»™<!-- raw HTML omitted --><code>kubelet</code><!-- raw HTML omitted -->ï¼Œç„¶å<!-- raw HTML omitted --><code>kubelet</code><!-- raw HTML omitted -->å°±å¯ä»¥æ‹‰å–æœ‰å¯†ç çš„ä»“åº“é‡Œé¢çš„é•œåƒ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¦‚æœåŒæ—¶ä½¿ç”¨<!-- raw HTML omitted --><code>data</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>stringData</code><!-- raw HTML omitted -->ï¼Œé‚£ä¹ˆ<!-- raw HTML omitted --><code>data</code><!-- raw HTML omitted -->ä¼šè¢«å¿½ç•¥<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h4 id="secretä½¿ç”¨ä»¥åŠé…ç½®"><code>Secret</code>ä½¿ç”¨ä»¥åŠé…ç½®</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è·å–ä½¿ç”¨å¸®åŠ©<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create secret -h  	<span style="color:#75715e"># æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl create secret <span style="color:#f92672">[</span>flags<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span>  	<span style="color:#75715e"># å‘½ä»¤ä½¿ç”¨æ–¹å¼  	</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>base64</code><!-- raw HTML omitted -->å¯¹å‡†å¤‡çš„æ•°æ®è¿›è¡Œç¼–ç ï¼šå¯¹ç”¨æˆ·åã€å¯†ç è¿›è¡Œç¼–ç <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo -n <span style="color:#e6db74">&#39;user_name&#39;</span> | base64  		<span style="color:#75715e"># ç‰¹æ®Šå­—ç¬¦ä½¿ç”¨ï¼š&#39;&#39;(å•å¼•å·)</span>
</span></span><span style="display:flex;"><span>$ echo -n <span style="color:#e6db74">&#39;password&#39;</span> | base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è§£ç ä½¿ç”¨ï¼š--decode</span>
</span></span><span style="display:flex;"><span>$ echo -n <span style="color:#e6db74">&#39;dXNlcl9uYW1l&#39;</span> | base64 --decode</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä»å‘½ä»¤è¡Œåˆ›å»º<!-- raw HTML omitted --><code>Secret</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create secret generic secret-name <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-literal<span style="color:#f92672">=</span>username<span style="color:#f92672">=</span>admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> --from-literal<span style="color:#f92672">=</span>password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;passwd@!3-&#39;</span>  	<span style="color:#75715e"># ç‰¹æ®Šå­—ç¬¦ä½¿ç”¨ï¼š&#39;&#39;(å•å¼•å·)</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>Secret</code><!-- raw HTML omitted -->è¿æ¥<!-- raw HTML omitted --><code>Harbor</code><!-- raw HTML omitted -->ç§äººä»“åº“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>docker-harbor-registrykey</code>ï¼š<code>Secret</code>çš„<code>Pods</code><!-- raw HTML omitted -->åç§°ï¼Œè‡ªå®šä¹‰<!-- raw HTML omitted --></li>
<li><code>--docker-server</code><!-- raw HTML omitted -->ï¼šé•œåƒä»“åº“åœ°å€<!-- raw HTML omitted --></li>
<li><code>--docker-username</code><!-- raw HTML omitted -->ï¼šé•œåƒä»“åº“ç”¨æˆ·å<!-- raw HTML omitted --></li>
<li><code>--docker-password</code><!-- raw HTML omitted -->ï¼šé•œåƒä»“åº“å¯†ç <!-- raw HTML omitted --></li>
<li><code>--docker-email</code><!-- raw HTML omitted -->ï¼šé‚®ç®±åœ°å€<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è·å– docker-registry ä½¿ç”¨å¸®åŠ©</span>
</span></span><span style="display:flex;"><span>$ kubectl create secret docker-registry -h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºä¸€ä¸ªImagePullSecret</span>
</span></span><span style="display:flex;"><span>$ kubectl create secret docker-registry docker-harbor-registrykey <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --docker-server<span style="color:#f92672">=</span>192.168.18.119:85:8080 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --docker-username<span style="color:#f92672">=</span>admin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --docker-password<span style="color:#f92672">=</span>Harbor12345 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --docker-email<span style="color:#f92672">=</span>xxxxx@qq.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹æ˜¯å¦åˆ›å»ºæˆåŠŸ</span>
</span></span><span style="display:flex;"><span>$ kubectl get secret docker-harbor-registrykey</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>redis.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œè·å–<!-- raw HTML omitted --><code>Harbor</code><!-- raw HTML omitted -->ä»“åº“é•œåƒ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">imagePullSecrets</span>:  	<span style="color:#75715e"># é…ç½®ç™»å½• docker registry çš„ secret ä»“åº“</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker-harbor-registrykey  	# å¼•ç”¨Secretçš„Podsï¼Œå®¹å™¨åç§°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">redis</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">192.168.18.119</span>:<span style="color:#ae81ff">85</span><span style="color:#ae81ff">/yuncloud/redis</span> <span style="color:#75715e"># è¿™æ˜¯Harborçš„é•œåƒç§æœ‰ä»“åº“åœ°å€</span></span></span></code></pre></div></blockquote>
<ul>
<li>å‡†å¤‡<code>volumes-secret</code><!-- raw HTML omitted -->èµ„æºæ¸…å•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Secret</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Opaque</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:  	<span style="color:#75715e"># æå‰ç¼–ç ä½¿ç”¨ï¼šdataã€ä½¿ç”¨Kubernetesè¿›è¡Œç¼–ç ä½¿ç”¨ï¼šstringData</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">username</span>: <span style="color:#ae81ff">YWRtaW4=  	# ä½¿ç”¨kubernetesè¿›è¡Œç¼–ç å†™ï¼ŒåŸæ•°æ®ï¼šadmin</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#ae81ff">MTIzNDU2  	# ä½¿ç”¨kubernetesè¿›è¡Œç¼–ç å†™ï¼ŒåŸæ•°æ®ï¼š123456</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">##########   é…ç½® secret-pod   ##########</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">secret-pod</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/secret/config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">config</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">secret</span>:  	<span style="color:#75715e"># ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">secret</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">items</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">string</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">string</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted --> æŸ¥çœ‹ç¼–ç åçš„ç›®å½•ä»¥åŠä¿¡æ¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å°†nginx.confå¯¼å‡ºåˆ°æœ¬åœ°</span>
</span></span><span style="display:flex;"><span>$ kubectl exec -it nginx -- cat /etc/nginx/nginx.conf &gt; nginx.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl exec -it secret-pod-name -n default -- /bin/sh
</span></span><span style="display:flex;"><span>$ ls /secret/config
</span></span><span style="display:flex;"><span>$ more /secret/config/username
</span></span><span style="display:flex;"><span>$ more /secret/config/password</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_k8s_rancher">Configure_K8s_Rancher</h1>

<h2 id="rancheræœåŠ¡å®•æœºæƒ…å†µä¸‹ä½¿ç”¨kubernetes-cluster"><code>Rancher</code>æœåŠ¡å®•æœºæƒ…å†µä¸‹ä½¿ç”¨<code>Kubernetes Cluster</code></h2>
<ul>
<li>
<ol>
<li><a href="https://docs.rancher.cn/docs/rancher2/cluster-admin/cleaning-cluster-nodes/_index/" rel="external" target="_self"><code>Rancher</code>æ¸…ç†èŠ‚ç‚¹</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>KUBE_SVC<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kubelet
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kube-scheduler
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kube-proxy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kube-controller-manager
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kube-apiserver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> kube_svc in <span style="color:#e6db74">${</span>KUBE_SVC<span style="color:#e6db74">}</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e"># åœæ­¢æœåŠ¡</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">`</span>systemctl is-active <span style="color:#e6db74">${</span>kube_svc<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;active&#39;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        systemctl stop <span style="color:#e6db74">${</span>kube_svc<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e"># ç¦æ­¢æœåŠ¡å¼€æœºå¯åŠ¨</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">`</span>systemctl is-enabled <span style="color:#e6db74">${</span>kube_svc<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;enabled&#39;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        systemctl disable <span style="color:#e6db74">${</span>kube_svc<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœæ­¢æ‰€æœ‰å®¹å™¨</span>
</span></span><span style="display:flex;"><span>docker stop <span style="color:#66d9ef">$(</span>docker ps -aq<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤æ‰€æœ‰å®¹å™¨</span>
</span></span><span style="display:flex;"><span>docker rm -f <span style="color:#66d9ef">$(</span>docker ps -qa<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤æ‰€æœ‰å®¹å™¨å·</span>
</span></span><span style="display:flex;"><span>docker volume rm <span style="color:#66d9ef">$(</span>docker volume ls -q<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¸è½½mountç›®å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> mount in <span style="color:#66d9ef">$(</span>mount | grep tmpfs | grep <span style="color:#e6db74">&#39;/var/lib/kubelet&#39;</span> | awk <span style="color:#e6db74">&#39;{ print $3 }&#39;</span><span style="color:#66d9ef">)</span> /var/lib/kubelet /var/lib/rancher;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>   umount $mount;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¤‡ä»½ç›®å½•</span>
</span></span><span style="display:flex;"><span>mv /etc/kubernetes /etc/kubernetes-bak-<span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#34;%Y%m%d%H%M&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>mv /var/lib/etcd /var/lib/etcd-bak-<span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#34;%Y%m%d%H%M&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>mv /var/lib/rancher /var/lib/rancher-bak-<span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#34;%Y%m%d%H%M&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>mv /opt/rke /opt/rke-bak-<span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#34;%Y%m%d%H%M&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤æ®‹ç•™è·¯å¾„</span>
</span></span><span style="display:flex;"><span>rm -rf /etc/ceph <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /etc/cni <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /opt/cni <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /run/secrets/kubernetes.io <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /run/calico <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /run/flannel <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/lib/calico <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/lib/cni <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/lib/kubelet <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/log/containers <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/log/kube-audit <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/log/pods <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /var/run/calico <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> /usr/libexec/kubernetes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…ç†ç½‘ç»œæ¥å£</span>
</span></span><span style="display:flex;"><span>no_del_net_inter<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">eth
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ens
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">bond
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>network_interface<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>ls /sys/class/net<span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> net_inter in $network_interface;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> ! echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>no_del_net_inter<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> | grep -qE <span style="color:#e6db74">${</span>net_inter:0:3<span style="color:#e6db74">}</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        ip link delete $net_inter
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…ç†æ®‹ç•™è¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>port_list<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">6443
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2376
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2380
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">8472
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9099
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">10250
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">10254
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> port in $port_list;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>   pid<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>netstat -atlnup | grep $port | awk <span style="color:#e6db74">&#39;{print $7}&#39;</span> | awk -F <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#e6db74">&#39;{print $1}&#39;</span> | grep -v - | sort -rnk2 | uniq<span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> -n $pid <span style="color:#f92672">]]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        kill -9 $pid
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kube_pid<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>ps -ef | grep -v grep | grep kube | awk <span style="color:#e6db74">&#39;{print $2}&#39;</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> -n $kube_pid <span style="color:#f92672">]]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>   kill -9 $kube_pid
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…ç†Iptablesè¡¨</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## æ³¨æ„ï¼šå¦‚æœèŠ‚ç‚¹Iptablesæœ‰ç‰¹æ®Šé…ç½®ï¼Œä»¥ä¸‹å‘½ä»¤è¯·è°¨æ…æ“ä½œ</span>
</span></span><span style="display:flex;"><span>sudo iptables --flush
</span></span><span style="display:flex;"><span>sudo iptables --flush --table nat
</span></span><span style="display:flex;"><span>sudo iptables --flush --table filter
</span></span><span style="display:flex;"><span>sudo iptables --table nat --delete-chain
</span></span><span style="display:flex;"><span>sudo iptables --table filter --delete-chain
</span></span><span style="display:flex;"><span>systemctl restart docker</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><code>Rancher Server</code>æ˜¯ä¸Šæ¸¸ä¸­å¿ƒç®¡ç†è§’è‰²ï¼Œæ§åˆ¶æˆ–åˆ›å»ºæ——ä¸‹<code>N</code>ä¸ª<code>Kubernetes Cluster</code>é›†ç¾¤ï¼Œä¸ç®¡æ˜¯æµ‹è¯•ä¸­çš„å•ä¸ªèŠ‚ç‚¹æˆ–è€…æ˜¯<code>Kubernetes Cluster</code>é›†ç¾¤å¤±æ•ˆéƒ½æ— æ³•è¯»å–ï¼Œè¿ç»´ä»éœ€è¦å¯¹ä¸‹æ¸¸æ‰€æœ‰<code>Kubernetes Cluster</code>é›†ç¾¤ç®¡æ§<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>æœåŠ¡å™¨</th>
<th>IP</th>
<th>CPU</th>
<th>å†…å­˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>master</td>
<td>192.168.35.128</td>
<td>8<code>core</code></td>
<td>8G</td>
</tr>
<tr>
<td>node-1</td>
<td>192.168.35.129</td>
<td>4<code>core</code></td>
<td>4G</td>
</tr>
<tr>
<td>node-2</td>
<td>192.168.35.130</td>
<td>4<code>core</code></td>
<td>4G</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="3">
<li>å‰ææ¡ä»¶</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>3.1 <!-- raw HTML omitted -->æ‰€æœ‰æœºå™¨éƒ½æ˜¯<code>CentOS 7</code><!-- raw HTML omitted --></li>
<li>3.2 <!-- raw HTML omitted --><code>Rancher Server</code>æ˜¯ä»¥<code>Docker</code>æ–¹å¼å•ç‹¬å»ºç«‹<!-- raw HTML omitted --></li>
<li>3.3 <!-- raw HTML omitted --><code>test-cluster Kubernetes Cluster</code>é›†ç¾¤æ˜¯ä»¥<code>Rancher Server</code>è‡ªå®šä¹‰æ–¹å¼åˆ›å»º<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ¨¡æ‹Ÿ<code>Racnher Server</code>æœåŠ¡å¤±æ•ˆå¯¹<code>Kubernetes Cluster</code>é›†ç¾¤è¿›è¡Œç®¡æ§<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>4.1 <!-- raw HTML omitted -->ç‚¹å‡»åˆ›å»ºé›†ç¾¤åç§°<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-d1035e9993abe4fe4c70b7dddab7c247" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-47-45.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d1035e9993abe4fe4c70b7dddab7c247"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-47-45.png"></a></p>
<ul>
<li>4.2 <!-- raw HTML omitted -->æå‰ä¸‹è½½<code>Kubernetesfig</code>æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-250f39511349cf615dcfd2e66221911b" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-49-19.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-250f39511349cf615dcfd2e66221911b"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_15-49-19.png"></a></p>
<p><a href="#R-image-198cae57dd002fece2ab44011a7d3212" class="lightbox-link"><img alt="ä¸‹k8s file" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_16-16-23.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-198cae57dd002fece2ab44011a7d3212"><img alt="ä¸‹k8s file" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-20_16-16-23.png"></a></p>
</blockquote>
<hr>
<h2 id="æ¨¡æ‹ŸrancheræœåŠ¡å®•æœº">æ¨¡æ‹Ÿ<code>Rancher</code>æœåŠ¡å®•æœº</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœæ­¢<code>Rancher Server</code>æœåŠ¡<code>docker stop rancher</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>1.1 <!-- raw HTML omitted --><code>æŸ¥çœ‹Kubernetes</code>é›†ç¾¤ç‰ˆæœ¬å·<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-aa59b54579d2a9dcd7c16d77412050e3" class="lightbox-link"><img alt="æŸ¥çœ‹<code>Rancher</code>å®‰è£…<code>Kubernetes</code>é›†ç¾¤ç‰ˆæœ¬" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-25_20-04-18.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-aa59b54579d2a9dcd7c16d77412050e3"><img alt="æŸ¥çœ‹<code>Rancher</code>å®‰è£…<code>Kubernetes</code>é›†ç¾¤ç‰ˆæœ¬" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Rancher/Snipaste_2022-05-25_20-04-18.png"></a></p>
</blockquote>
<h3 id="å®‰è£…kubectl">å®‰è£…<code>Kubectl</code></h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœ¨èƒ½è¿æ¥<code>test-kubernetes-cluster</code>é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹éƒ¨ç½²<code>Kubectl</code><!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><code>Kubectl</code>ç‰ˆæœ¬éœ€å’Œ<code>test-cluster-cluster</code>ç‰ˆæœ¬ç›¸åŒæˆ–è€…é«˜äº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/yum.repos.d/kubernetes.repo<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[kubernetes] 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name=Kubernetes 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">repo_gpgcheck=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install kubectl-1.23.6-0</span></span></code></pre></div></blockquote>
<h3 id="åˆ›å»ºkubeç›®å½•ä¿®æ”¹æ–‡ä»¶">åˆ›å»º<code>.kube</code>ç›®å½•ä¿®æ”¹æ–‡ä»¶</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å¹¶ä¸”å°†ä¸‹è½½çš„<code>Kubernetesfig</code>æ–‡ä»¶æ”¹åä¸º<code>config</code>ï¼Œç„¶åæ”¾åˆ°<code>${HOME}/.kube/</code>ç›®å½•ä¸­<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mv <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/test-kubernetes-cluster.yaml <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/config</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><code>${HOME}/.kube/config</code>æ–‡ä»¶æ²¡ä¿®æ”¹å‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/config
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Config
</span></span><span style="display:flex;"><span>clusters:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style="display:flex;"><span>  cluster:
</span></span><span style="display:flex;"><span>    server: <span style="color:#e6db74">&#34;https://192.168.80.210:4443/k8s/clusters/c-gwknl&#34;</span>
</span></span><span style="display:flex;"><span>    certificate-authority-data: <span style="color:#e6db74">&#34;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJwekNDQ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      VUyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQTdNUnd3R2dZRFZRUUtFeE5rZVc1aGJXbGoKY\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      kdsemRHVnVaWEl0YjNKbk1Sc3dHUVlEVlFRREV4SmtlVzVoYldsamJHbHpkR1Z1WlhJdFkyRXdIa\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      GNOTWpJdwpOVEkxTVRFeE9UUXhXaGNOTXpJd05USXlNVEV4T1RReFdqQTdNUnd3R2dZRFZRUUtFe\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      E5rZVc1aGJXbGpiR2x6CmRHVnVaWEl0YjNKbk1Sc3dHUVlEVlFRREV4SmtlVzVoYldsamJHbHpkR\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      1Z1WlhJdFkyRXdXVEFUQmdjcWhrak8KUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVJTb3NwRzE4OHJBQ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      mZabTAwQnRqcjAyL29udnZGVnppU09wZUdVd09SUApoSHpUbk1acTRmazVpRFhPV2lIUy9iQ0hvT\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      WQra1VtYkx6QVRPNkd2azdtSm8wSXdRREFPQmdOVkhROEJBZjhFCkJBTUNBcVF3RHdZRFZSMFRBU\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      UgvQkFVd0F3RUIvekFkQmdOVkhRNEVGZ1FVZ1YzR1g0Z2tXN3hPZVZWQURWem0KVEpxSW95b3dDZ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      1lJS29aSXpqMEVBd0lEU0FBd1JRSWdlTHh3WTVGcGkweDBGNXhBQUNZMnNPbVQ4aHBqNjVCWApUc\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      1lsQk1sOGx0RUNJUURkNmlONTJmbG9hVzZybXpvWXRLQy9nOEJRRW00b2UrcGN0YldCaGY0UENRP\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      T0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ==&#34;</span>
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster-node-1-80-211&#34;</span>
</span></span><span style="display:flex;"><span>  cluster:
</span></span><span style="display:flex;"><span>    server: <span style="color:#e6db74">&#34;https://192.168.80.211:6443&#34;</span>
</span></span><span style="display:flex;"><span>    certificate-authority-data: <span style="color:#e6db74">&#34;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM0VENDQ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      WNtZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKT\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      FdOaE1CNFhEVEl5TURVeU5URXhNek0xTUZvWERUTXlNRFV5TWpFeE16TTFNRm93RWpFUU1BNEdBM\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      VVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      0VCQUtJSzVRVy84eHB3CkRHUzMrN0M2Q0lobS8zcWFUUENvVmdFeU91YkVtR1EzbnAvYk9qTUJKY\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3Ayck05cW5CV2M4ZmtUUWhCNHZsL24Kay8zSkUrMkdta1RBbVAwaGpLa3d6d1JiT2lrYzdYVEtnd\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ElTQ3I2cjRkOWhZTElERElzTTJtUzZYYnhNdGd1SApoamk3MTJYQmNoZ3lEamxjREl3S1k5WXRYc\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3lDY3hPejdFNXN4YmpLTk1nb2sxK3VZSTlHaHhYYUlGcGp0VWFUClJXUW00dE9JOFplWWlUWG9aT\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      nJldTU1SVkyZ3pQVjZ1dURTWGQybFRHMEtmVng0Y1FYSDJIekdSODJ4NWZkK3kKS01HY0M1N21DN\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      HpiM3pET1Z2NVNEdmxOZEhyQ0g3QmpVYzh0MlFpU2JyQUwrQ216NnhMVFF4dlp1YkVLejU2TApKe\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ElKUGFhNkdSY0NBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93U\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      UZNQU1CCkFmOHdIUVlEVlIwT0JCWUVGSkN3bmVCVXZUMUtoeWtCUjF6bmxWQ2I1T2RnTUEwR0NTc\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      UdTSWIzRFFFQkN3VUEKQTRJQkFRQnRwa0doRDJ1RFdYTmZaSUhaa0NNclNpSkZXaGxIUGNPa2VPZ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      TJwcmp1UEZ0bzFWMVpyNlloWWVpcQp1cGxRdWlpenBwbEthZncxR1lpSnY4SCsrcHpjUFZoS3JTM\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      2F5Ykp1T2hxdnFyYUVZbzJDbjVVbkFpVWxBb2g1CnRqY1lNcVFKdkVzODd5UlFtUVhMSVNEMkdYb\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3UwN24ySy9wTVZXQWpHYjRsUTk0VmpHcjI3dHppSlhIYkh2L04KbHNNZklJV2czbTFKSW9SMlBNa\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3gvY1FpcGl6a3JRVHRpalhMbW0xbUFGOEtMR2JZcnNaTk1sMFdITWZWWjdXcgplemRBVjhVNDdsb\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      GowKzUzQ0FkZk0rYWpiSk5uMUtYMWF1Sm8rb1JXVTJjVno0SkYydUllMnBjcFcxUUplY1NPCmZ2U\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ysyOU9FK09GZW5tenRINTdZTStTWk1jRE8KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>users:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style="display:flex;"><span>  user:
</span></span><span style="display:flex;"><span>    token: <span style="color:#e6db74">&#34;kubeconfig-user-j85xz8pbjt:ls679hfqpvf9c25nswd5gdfm2hf4qtxj2kvqmj6kzzrjkj48lwwlpd&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>contexts:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style="display:flex;"><span>  context:
</span></span><span style="display:flex;"><span>    user: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style="display:flex;"><span>    cluster: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster-node-1-80-211&#34;</span>
</span></span><span style="display:flex;"><span>  context:
</span></span><span style="display:flex;"><span>    user: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span>
</span></span><span style="display:flex;"><span>    cluster: <span style="color:#e6db74">&#34;test-kubernetes-cluster-node-1-80-211&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>current-context: <span style="color:#e6db74">&#34;test-kubernetes-cluster&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted --><code>${HOME}/.kube/config</code>æ–‡ä»¶ä¿®æ”¹å<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/config
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Config
</span></span><span style="display:flex;"><span>clusters:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style="display:flex;"><span>  cluster:
</span></span><span style="display:flex;"><span>    server: <span style="color:#e6db74">&#34;https://192.168.80.211:6443&#34;</span>
</span></span><span style="display:flex;"><span>    certificate-authority-data: <span style="color:#e6db74">&#34;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM0VENDQ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      WNtZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkcmRXSmwKT\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      FdOaE1CNFhEVEl5TURVeU5URXhNek0xTUZvWERUTXlNRFV5TWpFeE16TTFNRm93RWpFUU1BNEdBM\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      VVFQXhNSAphM1ZpWlMxallUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      0VCQUtJSzVRVy84eHB3CkRHUzMrN0M2Q0lobS8zcWFUUENvVmdFeU91YkVtR1EzbnAvYk9qTUJKY\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3Ayck05cW5CV2M4ZmtUUWhCNHZsL24Kay8zSkUrMkdta1RBbVAwaGpLa3d6d1JiT2lrYzdYVEtnd\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ElTQ3I2cjRkOWhZTElERElzTTJtUzZYYnhNdGd1SApoamk3MTJYQmNoZ3lEamxjREl3S1k5WXRYc\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3lDY3hPejdFNXN4YmpLTk1nb2sxK3VZSTlHaHhYYUlGcGp0VWFUClJXUW00dE9JOFplWWlUWG9aT\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      nJldTU1SVkyZ3pQVjZ1dURTWGQybFRHMEtmVng0Y1FYSDJIekdSODJ4NWZkK3kKS01HY0M1N21DN\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      HpiM3pET1Z2NVNEdmxOZEhyQ0g3QmpVYzh0MlFpU2JyQUwrQ216NnhMVFF4dlp1YkVLejU2TApKe\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ElKUGFhNkdSY0NBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93U\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      UZNQU1CCkFmOHdIUVlEVlIwT0JCWUVGSkN3bmVCVXZUMUtoeWtCUjF6bmxWQ2I1T2RnTUEwR0NTc\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      UdTSWIzRFFFQkN3VUEKQTRJQkFRQnRwa0doRDJ1RFdYTmZaSUhaa0NNclNpSkZXaGxIUGNPa2VPZ\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      TJwcmp1UEZ0bzFWMVpyNlloWWVpcQp1cGxRdWlpenBwbEthZncxR1lpSnY4SCsrcHpjUFZoS3JTM\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      2F5Ykp1T2hxdnFyYUVZbzJDbjVVbkFpVWxBb2g1CnRqY1lNcVFKdkVzODd5UlFtUVhMSVNEMkdYb\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3UwN24ySy9wTVZXQWpHYjRsUTk0VmpHcjI3dHppSlhIYkh2L04KbHNNZklJV2czbTFKSW9SMlBNa\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      3gvY1FpcGl6a3JRVHRpalhMbW0xbUFGOEtMR2JZcnNaTk1sMFdITWZWWjdXcgplemRBVjhVNDdsb\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      GowKzUzQ0FkZk0rYWpiSk5uMUtYMWF1Sm8rb1JXVTJjVno0SkYydUllMnBjcFcxUUplY1NPCmZ2U\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ysyOU9FK09GZW5tenRINTdZTStTWk1jRE8KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>users:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style="display:flex;"><span>  user:
</span></span><span style="display:flex;"><span>    token: <span style="color:#e6db74">&#34;kubeconfig-user-j85xz8pbjt:ls679hfqpvf9c25nswd5gdfm2hf4qtxj2kvqmj6kzzrjkj48lwwlpd&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>contexts:
</span></span><span style="display:flex;"><span>- name: <span style="color:#e6db74">&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style="display:flex;"><span>  context:
</span></span><span style="display:flex;"><span>    user: <span style="color:#e6db74">&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style="display:flex;"><span>    cluster: <span style="color:#e6db74">&#34;test-kubernetes-cluster-rke-master&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>current-context: <span style="color:#e6db74">&#34;test-kubernetes-cluster-rke-master&#34;</span></span></span></code></pre></div></blockquote>
<h3 id="ä½¿ç”¨kubectlæ§åˆ¶kubernetes-clusteré›†ç¾¤">ä½¿ç”¨<code>Kubectl</code>æ§åˆ¶<code>Kubernetes Cluster</code>é›†ç¾¤</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl --kubeconfig <span style="color:#e6db74">${</span>HOME<span style="color:#e6db74">}</span>/.kube/config get pods -n kube-system
</span></span><span style="display:flex;"><span>$ kubectl create ns dev</span></span></code></pre></div></blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_k8s_jcr">Configure_K8s_Jcr</h1>

<h2 id="å®‰è£…é…ç½®jfrog-artifactory">å®‰è£…é…ç½®<code>JFrog Artifactory</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸‹è½½æœ€æ–°<!-- raw HTML omitted --><code>JFrog Artifactory</code>ç¤¾åŒºç‰ˆé•œåƒ</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker pull docker.bintray.io/jfrog/artifactory-jcr:latest</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¸ºç§æœ‰é•œåƒä»“åº“åšæŒä¹…åŒ–å­˜å‚¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/docker/volume/artifactory
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">777</span> -R /opt/docker
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ‡æ¢åˆ°ä¸Šè¿°ç›®å½•åæ‰§è¡Œæ•°æ®å·åˆ›å»ºå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ cd /opt/docker/volume/artifactory
</span></span><span style="display:flex;"><span>$ docker volume create data</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¯åŠ¨é•œåƒ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>3.1 <!-- raw HTML omitted -->é»˜è®¤ç”¨æˆ·åï¼š<!-- raw HTML omitted --><code>admin</code></li>
<li>3.2 <!-- raw HTML omitted -->é»˜è®¤å¯†ç ï¼š<!-- raw HTML omitted --><code>password</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run --name jfrog-artifactory -d -v /opt/docker/volume/artifactory:/var/opt/jfrog/artifactory -p 8081:8081 -p 8082:8082 docker.bintray.io/jfrog/artifactory-jcr:latest</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ‰“å¼€æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http://ip:8082  	<span style="color:#75715e"># æˆ–è€…é…ç½®NginxåŸŸå</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_k8s_helm">Configure_K8s_Helm</h1>

<h1 id="ä½¿ç”¨helmé…ç½®ç®¡ç†k8s">ä½¿ç”¨<code>Helm</code>é…ç½®ç®¡ç†<code>K8s</code></h1>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/bitnami/" rel="external" target="_self"><code>Bitnami</code>æ¨¡æ¿åº“</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/bitnami/charts/tree/main/bitnami" rel="external" target="_self"><code>Kubernetes</code>çš„<code>Bitnami</code>åº“</a></td>
<td><code>Helm</code>å®‰è£…<code>Kubernetes</code>æœåŠ¡<code>Zabbix</code>ã€<code>Redis</code>ã€<code>Mysql</code>æ¨¡æ¿</td>
</tr>
<tr>
<td><a href="https://github.com/bitnami/charts-docs/tree/main/charts" rel="external" target="_self"><code>Kubernetes</code>çš„<code>Charts-docs</code>åº“</a></td>
<td><code>Helm</code>å®‰è£…<code>Kubernetes</code>æœåŠ¡<code>Zabbix</code>ã€<code>Redis</code>ã€<code>Mysql</code>æ¨¡æ¿</td>
</tr>
<tr>
<td><a href="https://artifacthub.io/" rel="external" target="_self">æŸ¥æ‰¾ã€å®‰è£…å’Œå‘å¸ƒ<code>Kubernetes</code>åŒ…</a></td>
<td><code>Helm</code>å®‰è£…<code>Kubernetes</code>æœåŠ¡<code>Zabbix</code>ã€<code>Redis</code>ã€<code>Mysql</code>æ¨¡æ¿</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><code>kubernetes</code>ä¸Šçš„åº”ç”¨å¯¹è±¡ï¼Œéƒ½æ˜¯ç”±ç‰¹å®šçš„èµ„æºæè¿°ç»„æˆï¼ŒåŒ…æ‹¬<code>Deployment</code>ã€<code>Service</code>ç­‰ï¼Œéƒ½ä¿å­˜åœ¨å„è‡ªæ–‡ä»¶ä¸­æˆ–è€…é›†ä¸­å†™åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åé€šè¿‡<code>kubectl apply -f </code>éƒ¨ç½²ã€‚å¦‚æœåº”ç”¨åªç”±ä¸€ä¸ªæˆ–å‡ ä¸ªè¿™æ ·çš„æœåŠ¡ç»„æˆï¼Œä¸Šé¢çš„éƒ¨ç½²æ–¹å¼å°±è¶³å¤Ÿäº†ã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ªå¤æ‚çš„åº”ç”¨ï¼Œä¼šæœ‰å¾ˆå¤šç±»ä¼¼ä¸Šé¢çš„èµ„æºæè¿°æ–‡ä»¶ï¼Œä¾‹å¦‚å¾®æœåŠ¡æ¶æ„åº”ç”¨ï¼Œç»„æˆåº”ç”¨çš„æœåŠ¡å¯èƒ½å¤šè¾¾å‡ åã€ä¸Šç™¾ä¸ªï¼Œå¦‚æœæœ‰æ›´æ–°æˆ–å›æ»šåº”ç”¨çš„éœ€æ±‚ï¼Œå¯èƒ½è¦ä¿®æ”¹å’Œç»´æŠ¤æ‰€æ¶‰åŠåˆ°å¤§é‡çš„èµ„æºæ–‡ä»¶ï¼Œè€Œè¿™ç§ç»„ç»‡å’Œç®¡ç†åº”ç”¨çš„æ–¹å¼å°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒäº†ã€‚å¹¶ä¸”ç”±äºç¼ºå°‘å¯¹å‘å¸ƒè¿‡çš„åº”ç”¨è¿›è¡Œç‰ˆæœ¬ç®¡ç†å’Œæ§åˆ¶ï¼Œä½¿å¾—<code>kubernetes</code>ä¸Šçš„åº”ç”¨ç»´æŠ¤å’Œæ›´æ–°é¢ä¸´è¯¸å¤šçš„æŒ‘æˆ˜ï¼Œä¸»è¦é¢ä¸´ä»¥ä¸‹çš„é—®é¢˜ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>å¦‚ä½•å°†è¿™äº›æœåŠ¡ä½œä¸ºä¸€ä¸ªæ•´ä½“ç®¡ç†ï¼Ÿ</li>
<li>è¿™äº›èµ„æºæ–‡ä»¶å¦‚ä½•é«˜æ•ˆå¤ç”¨ï¼Ÿ</li>
<li>åº”ç”¨çº§åˆ«çš„ç‰ˆæœ¬å¦‚ä½•ç®¡ç†ï¼Ÿ</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>Helm</code><!-- raw HTML omitted -->æ˜¯ä¸€ä¸ª<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå°±åƒ<!-- raw HTML omitted --><code>Linux</code><!-- raw HTML omitted -->ä¸‹çš„åŒ…ç®¡ç†å™¨ï¼Œå¦‚<!-- raw HTML omitted --><code>yum</code>ã€<code>apt</code><!-- raw HTML omitted -->ç­‰ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†ä¹‹å‰æ‰“åŒ…å¥½çš„<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶éƒ¨ç½²åˆ°<!-- raw HTML omitted --><code>kubernetes</code>ä¸Š</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>Helm</code><!-- raw HTML omitted -->æœ‰3ä¸ªé‡è¦æ¦‚å¿µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>helm</code><!-- raw HTML omitted -->ï¼šä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯å·¥å…·ï¼Œä¸»è¦ç”¨äº<!-- raw HTML omitted --><code>kubernetes</code>åº”ç”¨<code>chart</code>çš„åˆ›å»ºã€æ‰“åŒ…ã€å‘å¸ƒå’Œç®¡ç†</li>
<li><code>chart</code><!-- raw HTML omitted -->ï¼šåº”ç”¨æè¿°ï¼Œä¸€ç³»åˆ—ç”¨äºæè¿°<!-- raw HTML omitted --><code>kubernetes</code>èµ„æºç›¸å…³æ–‡ä»¶çš„é›†åˆï¼Œç±»ä¼¼<code>Ansible</code>çš„<code>Playbook</code>å‰§æœ¬</li>
<li><code>release</code><!-- raw HTML omitted -->ï¼šåŸºäº<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->çš„éƒ¨ç½²å®ä½“ï¼Œä¸€ä¸ª<!-- raw HTML omitted --><code>chart</code>è¢«<code>Helm</code>è¿è¡Œåå°†ä¼šç”Ÿæˆå¯¹åº”çš„ä¸€ä¸ª<code>release</code>ï¼Œå°†åœ¨<code>kubernetes</code>ä¸­åˆ›å»ºå‡ºçœŸå®è¿è¡Œçš„èµ„æºå¯¹è±¡</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>Helm v3</code><!-- raw HTML omitted -->å˜åŒ–<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>æœ€æ˜æ˜¾å˜åŒ–åˆ é™¤<code>Tiller</code>ç»„ä»¶</li>
<li><code>release</code>åç§°å¯ä»¥åœ¨ä¸åŒçš„å‘½åç©ºé—´é‡ç”¨ã€‚</li>
<li>æ”¯æŒå°†<code>chart</code>æ¨åŠ¨åˆ°<code>Docker</code>é•œåƒä»“åº“ä¸­</li>
<li>ä½¿ç”¨<code>JSONSchema</code>éªŒè¯<code>chart values</code></li>
</ul>
</blockquote>
<hr>
<h2 id="helmå¸¸ç”¨å‘½ä»¤"><code>Helm</code>å¸¸ç”¨å‘½ä»¤</h2>
<blockquote>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>get</code></td>
<td>ä¸‹è½½ä¸€ä¸ª<code>release</code>ã€‚å¯ç”¨çš„å­å‘½ä»¤ï¼š<code>all</code>ã€<code>hooks</code>ã€<code>manifest</code>ã€<code>note</code>ã€<code>values</code></td>
</tr>
<tr>
<td><code>repo</code></td>
<td>æ·»åŠ ã€åˆ—å‡ºã€ç§»é™¤ã€æ›´æ–°å’Œç´¢å¼•<code>chart</code>ä»“åº“ã€‚å¯ç”¨çš„å­å‘½ä»¤ï¼š<code>add</code>ã€<code>index</code>ã€<code>list</code>ã€<code>remove</code>ã€<code>update</code></td>
</tr>
<tr>
<td><code>list</code></td>
<td>åˆ—å‡º<code>release</code></td>
</tr>
<tr>
<td><code>pull</code></td>
<td>ä»è¿œç¨‹ä»“åº“ä¸­ä¸‹è½½<code>chart</code>å¹¶è§£å‹åˆ°æœ¬åœ°ã€‚æ¯”å¦‚ï¼š<code>helm install stable/mysql --untar</code></td>
</tr>
<tr>
<td><code>show</code></td>
<td>æŸ¥çœ‹<code>chart</code>çš„è¯¦ç»†ä¿¡æ¯ã€‚å¯ç”¨çš„å­å‘½ä»¤ï¼š<code>all</code>ã€<code>chart</code>ã€<code>readme</code>ã€<code>values</code></td>
</tr>
<tr>
<td><code>search</code></td>
<td>æ ¹æ®å…³é”®å­—æœç´¢<code>chart</code>ã€‚å¯ç”¨çš„å­å‘½ä»¤ï¼š<code>all</code>ã€<code>chart</code>ã€<code>readme</code>ã€<code>values</code></td>
</tr>
<tr>
<td><code>create</code></td>
<td>åˆ›å»ºä¸€ä¸ª<code>chart</code>å¹¶æŒ‡å®šåå­—</td>
</tr>
<tr>
<td><code>install</code></td>
<td>å®‰è£…ä¸€ä¸ª<code>chart</code></td>
</tr>
<tr>
<td><code>status</code></td>
<td>æ˜¾ç¤ºå·²å‘½åç‰ˆæœ¬çš„çŠ¶æ€</td>
</tr>
<tr>
<td><code>upgrade</code></td>
<td>æ›´æ–°å‡çº§ä¸€ä¸ª<code>release</code></td>
</tr>
<tr>
<td><code>history</code></td>
<td>è·å–<code>release</code>å†å²</td>
</tr>
<tr>
<td><code>package</code></td>
<td>å°†<code>chart</code>ç›®å½•æ‰“åŒ…åˆ°<code>chart</code>å­˜æ¡£æ–‡ä»¶ä¸­</td>
</tr>
<tr>
<td><code>template</code></td>
<td>æœ¬åœ°å‘ˆç°æ¨¡æ¿</td>
</tr>
<tr>
<td><code>rollback</code></td>
<td>ä»ä¹‹å‰çš„ç‰ˆæœ¬å›é€€</td>
</tr>
<tr>
<td><code>uninstall</code></td>
<td>å¸è½½ä¸€ä¸ª<code>release</code></td>
</tr>
<tr>
<td><code>dependency</code></td>
<td>ç®¡ç†<code>chart</code>ä¾èµ–</td>
</tr>
<tr>
<td><code>version</code></td>
<td>æŸ¥çœ‹<code>Helm</code>å®¢æˆ·ç«¯ç‰ˆæœ¬</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="font-colorredå®‰è£…fonthelm"><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Helm</code></h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨äºŒè¿›åˆ¶å®‰è£…<!-- raw HTML omitted --><code>Helm</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://get.helm.sh/helm-v3.9.0-linux-amd64.tar.gz  
</span></span><span style="display:flex;"><span>$ tar -zxvf helm-v3.9.0-linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv linux-amd64/helm /usr/local/bin/helm</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è„šæœ¬å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">700</span> get_helm.sh
</span></span><span style="display:flex;"><span>$ ./get_helm.sh</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æºä»£ç å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/helm/helm.git
</span></span><span style="display:flex;"><span>$ cd helm
</span></span><span style="display:flex;"><span>$ make</span></span></code></pre></div></blockquote>
<hr>
<h2 id="é…ç½®chartä»“åº“">é…ç½®<code>chart</code>ä»“åº“</h2>
<blockquote>
<ul>
<li><code>Helm</code><!-- raw HTML omitted -->æ·»åŠ ä»“åº“æ–¹å¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo add ä»“åº“å ä»“åº“åœ°å€</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨å®˜æ–¹ä»“åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo add helm https://hub.kubeapps.com/charts/incubator</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ·»åŠ å…¶å®ƒä»“åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Bitnami</span>
</span></span><span style="display:flex;"><span>$ helm repo add bitnami https://charts.bitnami.com/bitnami
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨å¾®è½¯ä»“åº“</span>
</span></span><span style="display:flex;"><span>$ helm repo add microsoft http://mirror.azure.cn/kubernetes/charts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å›½å†…æ·»åŠ é˜¿é‡Œäº‘ã€å¾®è½¯ä»“åº“</span>
</span></span><span style="display:flex;"><span>$ helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ›´æ–°ä»“åº“å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo update</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ é™¤å­˜å‚¨åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo remove ä»“åº“å</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–é…ç½®çš„å­˜å‚¨åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo list</span></span></code></pre></div></blockquote>
<hr>
<h2 id="helmåŸºæœ¬ä½¿ç”¨"><code>Helm</code>åŸºæœ¬ä½¿ç”¨</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ ¹æ®å…³é”®å­—æœç´¢<!-- raw HTML omitted --><code>chart</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm search repo | hub chartåç§°
</span></span><span style="display:flex;"><span>$ helm search repo redis    <span style="color:#75715e"># ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span>  DEPRECATED  	<span style="color:#75715e"># è¡¨ç¤ºå·²è¿‡æœŸ</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ä¿¡æ¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm show chart ä»“åº“å/chartåç§°
</span></span><span style="display:flex;"><span>$ helm show chart bitnami/redis</span></span></code></pre></div><ul>
<li><code>readme</code><!-- raw HTML omitted -->æŸ¥çœ‹å®‰è£…æ–‡æ¡£è¯´æ˜<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm show readme bitnami/redis</span></span></code></pre></div></blockquote>
<hr>
<h3 id="font-colorredå®‰è£…fontchartfont-colorredå½¢æˆfontrelease"><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ï¼Œå½¢æˆ<!-- raw HTML omitted --><code>release</code></h3>
<ul>
<li>
<ol>
<li>è‡ªå®šä¹‰é€‰é¡¹æ˜¯å› ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰çš„<code>chart</code>éƒ½èƒ½æŒ‰ç…§é»˜è®¤é…ç½®è¿è¡ŒæˆåŠŸï¼Œå¯èƒ½ä¼šéœ€è¦ä¸€äº›ç¯å¢ƒä¾èµ–ï¼Œä¾‹å¦‚<code>PV</code>ã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li>æ‰€ä»¥éœ€è¦è‡ªå®šä¹‰<code>chart</code>é…ç½®é€‰é¡¹ï¼Œå®‰è£…è¿‡ç¨‹ä¸­æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä¼ é€’é…ç½®æ•°æ®ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>--values</code><!-- raw HTML omitted -->ï¼šçš„ä½¿ç”¨(éº»çƒ¦ã€ä¸æ¨è)<!-- raw HTML omitted --></li>
<li><code>--set</code><!-- raw HTML omitted -->ï¼šåœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šæ›¿ä»£ã€‚å¦‚æœä¸¤ç§éƒ½ç”¨ï¼Œé‚£ä¹ˆ<!-- raw HTML omitted --><code>--set</code>çš„ä¼˜å…ˆçº§é«˜</li>
<li><code>--values æˆ– -f</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šå¸¦æœ‰è¦†ç›–çš„<!-- raw HTML omitted --><code>YAML</code>æ–‡ä»¶ã€‚è¿™é‡Œå¯ä»¥å¤šæ¬¡æŒ‡å®šï¼Œæœ€å³è¾¹çš„æ–‡ä»¶ä¼˜å…ˆ</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å®‰è£…å¯èƒ½æŠ¥é”™ï¼Œéœ€è¦è‡ªå·±æ‰‹åŠ¨å®‰è£…<!-- raw HTML omitted --><code>PV</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å…ˆå°†ä¿®æ”¹çš„å˜é‡å†™åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä¿®æ”¹æ­¤æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm show values stable/mysql &gt; config.yaml</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>config.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>-- <span style="color:#ae81ff">ä¿®æ”¹éƒ¨åˆ†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">persistence</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">accessMode</span>: <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">size</span>: <span style="color:#ae81ff">8Gi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">mysqlUser</span>: <span style="color:#e6db74">&#34;k8s&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">mysqlPassword</span>: <span style="color:#e6db74">&#34;123456&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">mysqlDatabase</span>: <span style="color:#e6db74">&#34;k8s&#34;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>-f</code><!-- raw HTML omitted -->æ¥æ›¿æ¢é»˜è®¤çš„é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install -f config.yaml self-mysql stable/mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ¨èä½¿ç”¨å‘½ä»¤è¡Œæ›¿ä»£å˜é‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install db --set persistence.storageClass<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;managed-nfs-storage&#34;</span> stable/mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>chart</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install å®‰è£…ä¹‹åçš„åç§° ä»“åº“å/chartçš„åç§°<span style="color:#f92672">(</span>å³æœç´¢ä¹‹åçš„åº”ç”¨åç§°<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>$ helm install k8s_ui stable/weave-scope  	<span style="color:#75715e"># å®‰è£… stable/weave-scopeï¼Œå¹¶å°†å…¶å‘½åä¸º k8s_ui</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å½“å‰çš„ release åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>$ helm list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹å·²å‘½å release çš„çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>$ helm status k8s_ui å®‰è£…ä¹‹åçš„åç§°</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Helm</code><!-- raw HTML omitted -->æ„å»ºä¸€ä¸ª<!-- raw HTML omitted --><code>Chart</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>helm create</code><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>chart</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm create mychart  <span style="color:#75715e"># chartåç§°</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è¿›å…¥è‡ªå®šä¹‰<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ç›®å½•çš„<!-- raw HTML omitted --><code>templates</code><!-- raw HTML omitted -->ç›®å½•ä¸­ï¼Œä¿®æ”¹å…¶ä¸­çš„<!-- raw HTML omitted --><code>deployment.yaml</code>å’Œ<code>service.yaml</code><!-- raw HTML omitted -->ç­‰æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>charts</code><!-- raw HTML omitted -->ï¼šè¯¥ç›®å½•ä¿å­˜å…¶ä»–ä¾èµ–çš„<!-- raw HTML omitted --><code>chart(å­chart)</code></li>
<li><code>Chart.yaml</code><!-- raw HTML omitted -->ï¼šå®šä¹‰å½“å‰<!-- raw HTML omitted --><code>Chart</code><!-- raw HTML omitted -->å±æ€§ä¿¡æ¯<!-- raw HTML omitted --></li>
<li><code>templates</code><!-- raw HTML omitted -->ï¼š<code>chart</code>é…ç½®æ¨¡æ¿ï¼Œç›®å½•å­˜æ”¾æ‰€æœ‰<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Deployment.yaml</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
<li><code>_helpers.tpl</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
<li><code>hpa.yaml</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
<li><code>ingress.yaml</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
<li><code>NOTES.txt</code><!-- raw HTML omitted -->ï¼šç”¨äºä»‹ç»<code>Chart</code>çš„å¸®åŠ©ä¿¡æ¯ï¼Œ<code>HelmÂ install</code>éƒ¨ç½²åå±•ç¤ºç»™ç”¨æˆ·<!-- raw HTML omitted --></li>
<li><code>serviceaccount.yaml</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
<li><code>service.yaml</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
<li><code>tests</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>tests-connection.yaml</code><!-- raw HTML omitted -->ï¼š<!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<ul>
<li><code>values.yaml</code><!-- raw HTML omitted -->ï¼šå®šä¹‰æ‰€æœ‰<!-- raw HTML omitted --><code>yaml</code><!-- raw HTML omitted -->å…¨å±€å˜é‡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd chartåç§°/templates</span></span></code></pre></div><p><a href="#R-image-fc0230e63a95a55ddccda65541f69303" class="lightbox-link"><img alt="Chartä¸­çš„ä¿¡æ¯" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Helm/Chart%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fc0230e63a95a55ddccda65541f69303"><img alt="Chartä¸­çš„ä¿¡æ¯" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kubernetes_Server/Helm/Chart%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->é€šè¿‡åˆšæ‰åˆ›å»ºçš„<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ç›®å½•ï¼Œå°†å…¶éƒ¨ç½²<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install web mychart  <span style="color:#75715e"># web:è‡ªå®šä¹‰åç§°ï¼Œchartåç§°</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ‰“åŒ…<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ï¼Œè®©åˆ«äººå…±äº«<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm package mychart  <span style="color:#75715e"># chartåç§°</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="font-colorredæŸ¥çœ‹fontservicefont-colorredå¹¶å°†å…¶æ”¹ä¸ºfontnodeport"><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>Service</code><!-- raw HTML omitted -->ï¼Œå¹¶å°†å…¶æ”¹ä¸º<!-- raw HTML omitted --><code>NodePort</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl edit svc xxx
</span></span><span style="display:flex;"><span>$ kubectl edit svc ui-weave-scope</span></span></code></pre></div></blockquote>
<hr>
<h3 id="font-colorredåº”ç”¨ç¤ºä¾‹font"><!-- raw HTML omitted -->åº”ç”¨ç¤ºä¾‹<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><code>root</code><!-- raw HTML omitted -->ç›®å½•ä¸‹æ“ä½œçš„<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li>åˆ›å»º<code>chart</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm create nginx</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->è¿›å…¥<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ç›®å½•ï¼Œä¿®æ”¹<!-- raw HTML omitted --><code>values.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;&gt;nginx/values.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">replicas: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">image: nginx 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">tag: 1.17 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">serviceport: 80 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">targetport: 80 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">label: nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->åˆ é™¤<!-- raw HTML omitted --><code>templates</code><!-- raw HTML omitted -->ç›®å½•ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rm -rf emplates/*</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>deployment.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;&gt;deployment.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: apps/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Deployment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     app: {{ .Values.label }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> name: {{ .Release.Name }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> replicas: {{ .Values.replicas }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     matchLabels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         app: {{ .Values.label }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> strategy: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> template:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             app: {{ .Values.label }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - image: {{ .Values.image }}:{{ .Values.tag }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          name: {{ .Values.image }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>service.yaml</code><!-- raw HTML omitted -->æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;&gt;service.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion:   v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     app: {{ .Values.label }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> name:  {{ .Release.Name }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        -  port: {{ .Values.serviceport }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">           protocol: TCP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">           targetPort: {{ .Values.targetport }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        app: {{ .Values.label }} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: NodePort
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><!-- raw HTML omitted -->åˆ‡æ¢åˆ°<!-- raw HTML omitted --><code>chart</code><!-- raw HTML omitted -->ç›®å½•çš„ä¸Šä¸€å±‚ç›®å½•ã€å¹¶ä¸”å®‰è£…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd ~
</span></span><span style="display:flex;"><span>$ helm install nginx nginx/</span></span></code></pre></div></blockquote>
<hr>
<h3 id="font-colorredè°ƒè¯•font"><!-- raw HTML omitted -->è°ƒè¯•<!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><code>Helm</code>ä¹Ÿæä¾›äº†<code>--dry-run</code>å’Œ<code>--debug</code>è°ƒè¯•å‚æ•°ï¼Œå¸®åŠ©ä½ éªŒè¯æ¨¡æ¿çš„æ­£ç¡®æ€§ã€‚åœ¨æ‰§è¡Œ<code>helm install</code>çš„æ—¶å€™å¸¦ä¸Šè¿™ä¸¤ä¸ªå‚æ•°å°±å¯ä»¥æŠŠå¯¹åº”çš„<code>values</code>å€¼å’Œæ¸²æŸ“çš„èµ„æºæ¸…å•æ‰“å°å‡ºæ¥ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„åšéƒ¨ç½²ä¸€ä¸ª<code>release</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install nginx nginx/ --dry-run --debug</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¸€äº›å¸¸ç”¨çš„å†…ç½®å¯¹è±¡ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>å†…ç½®å¯¹è±¡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Release.Name</code></td>
<td><code>release</code>çš„åç§°</td>
</tr>
<tr>
<td><code>Release.Namespace</code></td>
<td><code>release</code>çš„å‘½åç©ºé—´</td>
</tr>
<tr>
<td><code>Release.Service</code></td>
<td><code>release</code>çš„æœåŠ¡çš„åç§°</td>
</tr>
<tr>
<td><code>Release.Revision</code></td>
<td><code>release</code>çš„ä¿®è®¢ç‰ˆæœ¬å·ï¼Œä»1å¼€å§‹ç´¯åŠ </td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="font-colorredvaluesfont"><!-- raw HTML omitted --><code>Values</code><!-- raw HTML omitted --></h3>
<ul>
<li>
<ol>
<li><code>Values</code>å¯¹è±¡æ˜¯ä¸º<code>Chart</code>æ¨¡æ¿æä¾›å€¼ï¼Œè¿™ä¸ªå¯¹è±¡çš„å€¼æœ‰<code>4</code>ä¸ªæ¥æºï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>chart</code>åŒ…ä¸­çš„<code>values.yaml</code>æ–‡ä»¶</li>
<li>çˆ¶<code>chart</code>åŒ…çš„<code>values.yaml</code>æ–‡ä»¶</li>
<li>é€šè¿‡<code>helm install</code>æˆ–è€…<code>helm upgrade</code>çš„<code>-f</code>æˆ–è€…<code>--values</code>å‚æ•°ä¼ å…¥çš„è‡ªå®šä¹‰çš„<code>yaml</code>æ–‡ä»¶</li>
<li>é€šè¿‡<code>--set</code>å‚æ•°ä¼ å…¥çš„å€¼</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>Chart</code>çš„<code>values.yaml</code>æä¾›çš„å€¼å¯ä»¥è¢«ç”¨æˆ·æä¾›çš„<code>values</code>æ–‡ä»¶è¦†ç›–ï¼Œè€Œè¯¥æ–‡ä»¶åŒæ ·å¯ä»¥è¢«<code>--set</code>å‚æ•°æ‰€è¦†ç›–ï¼Œæ¢è¨€ä¹‹ï¼Œ<code>--set</code>å‚æ•°çš„ä¼˜å…ˆçº§é«˜</li>
</ol>
</li>
</ul>
<hr>
<h2 id="å‡çº§å›æ»šå’Œå¸è½½å‘è¡Œç‰ˆæœ¬">å‡çº§ã€å›æ»šå’Œå¸è½½å‘è¡Œç‰ˆæœ¬</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å‡çº§<!-- raw HTML omitted -->å‘å¸ƒæ–°ç‰ˆæœ¬çš„<code>chart</code>æ—¶ï¼Œæˆ–è€…å½“æˆ‘ä»¬éœ€è¦æ›´æ”¹å‘å¸ƒçš„é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨<code>helm upgrade</code>å‘½ä»¤</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm upgrade --set imageTag<span style="color:#f92672">=</span>1.18 nginx nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ helm upgrade web mychart  <span style="color:#75715e"># web:è‡ªå®šä¹‰åç§°ï¼Œchartåç§°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ helm upgrade -f values.yaml nginx nginx</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å›æ»š<!-- raw HTML omitted -->å¦‚æœåœ¨å‘å¸ƒåæ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„æ•ˆæœï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>helm rollback</code>å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm history redis -n default  	<span style="color:#75715e"># æŸ¥çœ‹å†å²ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ helm rollback nginx <span style="color:#ae81ff">1</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¸è½½<!-- raw HTML omitted -->å¯ä»¥ä½¿ç”¨<code>helm uninstall</code>å‘½ä»¤</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm uninstall nginx</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted --> æŸ¥çœ‹å†å²ç‰ˆæœ¬é…ç½®ä¿¡æ¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm get all --revision <span style="color:#ae81ff">1</span> nginx</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ç®¡é“å‡½æ•°">ç®¡é“ã€å‡½æ•°</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç®¡é“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>quote</code>  <code>.Values.label.app</code><!-- raw HTML omitted -->å°†åé¢çš„å€¼ä½œä¸ºå‚æ•°ä¼ é€’è¿‡<!-- raw HTML omitted --><code>quote</code><!-- raw HTML omitted -->å‡½æ•°<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æ¨¡æ¿å‡½æ•°è°ƒç”¨è¯­æ³•ä¸ºï¼š<!-- raw HTML omitted --><code>functionName arg1 arg2...</code></li>
<li>åœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œå…¶å®æ˜¯å°†å€¼ä¼ é€’ç»™æ¨¡æ¿å¼•æ“è¿›è¡Œæ¸²æŸ“ï¼Œæ¨¡æ¿å¼•æ“è¿˜æ”¯æŒå¯¹æ‹¿åˆ°çš„æ•°æ®è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼Œç¤ºä¾‹ï¼šä»<code>.Values</code>ä¸­è¯»å–çš„å€¼å˜æˆå­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨<code>quote</code>å‡½æ•°å®ç°</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat templates/deployment.yaml
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç•¥...</span>
</span></span><span style="display:flex;"><span>app: <span style="color:#f92672">{{</span> quote  .Values.label.app    <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç•¥...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ helm install --dry-run nginx ../nginx/ app:<span style="color:#e6db74">&#34;nginx&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å‡½æ•°<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>default</code><!-- raw HTML omitted -->å‡½æ•°è¿è¡Œåœ¨æ¨¡æ¿ä¸­æŒ‡å®šé»˜è®¤å€¼ï¼Œä»¥é˜²æ­¢è¯¥å€¼ä¼šå¿½ç•¥æ‰ã€‚å¦‚æœå¿˜è®°å®šä¹‰ï¼Œæ‰§è¡Œ<!-- raw HTML omitted --><code>helm install</code><!-- raw HTML omitted -->çš„æ—¶å€™ä¼šå› ä¸ºç¼ºå°‘å­—æ®µè€Œæ— æ³•åˆ›å»ºèµ„æºï¼Œè¿™æ—¶å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªé»˜è®¤å€¼äº†ï¼Œç¤ºä¾‹ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;&gt;templates/deployment.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: apps/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Deployment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        app: {{ .Values.label }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: {{ .Release.Name }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    replicas: {{ .Values.replicas }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    selector:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        matchLabels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            app: {{ .Values.label }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    strategy: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    template:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                app: {{ .Values.label }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            containers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            - image: {{ .Values.image| default &#34;nginx&#34; }}:{{ .Values.tag }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              name: {{ .Values.image }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¼©è¿›å‡½æ•°ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{ <span style="color:#ae81ff">.Values.resources | indent 12 }}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¤§å†™å‡½æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{ <span style="color:#ae81ff">upper .Values.resources }}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é¦–å­—æ¯å¤§å†™å‡½æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{ <span style="color:#ae81ff">title .Values.resources }}</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="æµç¨‹æ§åˆ¶">æµç¨‹æ§åˆ¶</h2>
<ul>
<li>
<ol>
<li>æµç¨‹æ§åˆ¶æ˜¯ä¸ºæ¨¡æ¿æä¾›äº†ä¸€ç§èƒ½åŠ›ï¼Œæ»¡è¶³æ›´å¤æ‚çš„æ•°æ®é€»è¾‘å¤„ç†</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>Helm</code>æ¨¡æ¿è¯­è¨€æä¾›ä»¥ä¸‹æµç¨‹æ§åˆ¶è¯­å¥ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>if/else</code><!-- raw HTML omitted -->æ¡ä»¶å—<!-- raw HTML omitted --></li>
<li><code>with</code><!-- raw HTML omitted -->æŒ‡å®šèŒƒå›´<!-- raw HTML omitted --></li>
<li><code>range</code><!-- raw HTML omitted -->å¾ªç¯å—<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><code>if/else</code><!-- raw HTML omitted -->ï¼šå—æ˜¯ç”¨äºåœ¨æ¨¡æ¿æœ‰æ¡ä»¶çš„åŒ…å«æ–‡æœ¬å—çš„æ–¹æ³•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ¡ä»¶åˆ¤æ–­ï¼š<!-- raw HTML omitted -->å°±æ˜¯åˆ¤æ–­æ¡ä»¶æ˜¯å¦ä¸ºçœŸï¼Œå¦‚æœå€¼ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µåˆ™ä¸º<code>false</code>ï¼Œå¦åˆ™ä¸º<code>true</code>ï¼š</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„<!-- raw HTML omitted --><code>false</code></li>
<li><!-- raw HTML omitted -->ä¸€ä¸ªæ•°å­—<!-- raw HTML omitted --><code>0</code></li>
<li><!-- raw HTML omitted -->ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²<!-- raw HTML omitted --></li>
<li>ä¸€ä¸ªç©ºçš„é›†åˆ(<code>map</code>ã€<code>slice</code>ã€<code>tuple</code>ã€<code>dict</code>ã€<code>array</code>)</li>
</ul>
</blockquote>
<ul>
<li>è¿˜å¯ä»¥ä½¿ç”¨<code>ne</code>ã€<code>lt</code>ã€<code>gt</code>ã€<code>and</code>ã€<code>or</code>ç­‰è¿ç®—ç¬¦</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{ <span style="color:#ae81ff">if æ¡ä»¶è¡¨è¾¾å¼ }}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># xxx</span>
</span></span><span style="display:flex;"><span>{{ <span style="color:#ae81ff">else if æ¡ä»¶è¡¨è¾¾å¼ }}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># xxx</span>
</span></span><span style="display:flex;"><span>{{ <span style="color:#ae81ff">else }}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># xxx</span>
</span></span><span style="display:flex;"><span>{{ <span style="color:#ae81ff">end }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Release.Name }}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">replicas</span>: {{ <span style="color:#ae81ff">.Values.replicas }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">strategy</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">image</span>: {{ <span style="color:#ae81ff">.Values.image| default &#34;nginx&#34; }}:{{ .Values.tag }}</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Values.image }}</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>                  {{ <span style="color:#ae81ff">if eq .Values.devops &#34;k8s&#34; }}</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;123&#34;</span>
</span></span><span style="display:flex;"><span>                {{ <span style="color:#ae81ff">else }}</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;456&#34;</span>
</span></span><span style="display:flex;"><span>                {{ <span style="color:#ae81ff">end }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¨¡æ¿å¼•æ“æ¸²æŸ“ä¸€ä¸‹ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹çš„ç»“æœï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">$ helm install --dry-run nginx nginx</span></span></span></code></pre></div><ul>
<li>å¯ä»¥çœ‹åˆ°æ¸²æŸ“å‡ºæ¥ä¼šæœ‰å¤šä½™çš„ç©ºè¡Œï¼Œè¿™æ˜¯å› ä¸ºå½“æ¨¡æ¿å¼•æ“è¿è¡Œçš„æ—¶å€™ï¼Œä¼šå°†æ§åˆ¶æŒ‡ä»¤åˆ é™¤ï¼Œæ‰€ä»¥ä¹‹å‰å çš„ä½ç½®ä¹Ÿå°±ç©ºç™½äº†ï¼Œéœ€è¦ä½¿ç”¨<code>{{- if ...}}</code>çš„æ–¹å¼æ¶ˆé™¤æ­¤ç©ºè¡Œ</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Release.Name }}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">replicas</span>: {{ <span style="color:#ae81ff">.Values.replicas }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">strategy</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">image</span>: {{ <span style="color:#ae81ff">.Values.image| default &#34;nginx&#34; }}:{{ .Values.tag }}</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Values.image }}</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>                      {{- <span style="color:#ae81ff">if eq .Values.devops &#34;k8s&#34; }}</span>
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;123&#34;</span>
</span></span><span style="display:flex;"><span>                  {{- <span style="color:#ae81ff">else }}</span>
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;456&#34;</span>
</span></span><span style="display:flex;"><span>                  {{- <span style="color:#ae81ff">end }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é€šè¿‡æ¨¡æ¿å¼•æ“æ¸²æŸ“ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹çš„ç»“æœ</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">$ helm install --dry-run nginx nginx</span></span></span></code></pre></div><ul>
<li>å¦‚æœä½¿ç”¨<code>{{- if ... -}}</code>é‚£ä¹ˆå°±éœ€è¦è°¨æ…ï¼Œæ¯”å¦‚ï¼š</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Release.Name }}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">replicas</span>: {{ <span style="color:#ae81ff">.Values.replicas }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">strategy</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: {{ <span style="color:#ae81ff">.Values.label }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">image</span>: {{ <span style="color:#ae81ff">.Values.image| default &#34;nginx&#34; }}:{{ .Values.tag }}</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Values.image }}</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>                      {{- <span style="color:#ae81ff">if eq .Values.devops &#34;k8s&#34; -}}</span>
</span></span><span style="display:flex;"><span>                  - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;123&#34;</span>
</span></span><span style="display:flex;"><span>                    {{- <span style="color:#ae81ff">else }}</span>
</span></span><span style="display:flex;"><span>                  - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;456&#34;</span>
</span></span><span style="display:flex;"><span>                    {{- <span style="color:#ae81ff">end }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é€šè¿‡æ¨¡æ¿å¼•æ“æ¸²æŸ“ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹çš„ç»“æœï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">$ helm install --dry-run nginx nginx</span></span></span></code></pre></div><ul>
<li>ç›¸å½“äºä¸‹é¢è¿™ç§æ ¼å¼</li>
</ul>
<blockquote>
<ul>
<li>å½“ç„¶ä¸å¯¹ï¼Œå› ä¸º<code>{{- if ... -}}</code>åˆ é™¤äº†åŒæ–¹çš„æ¢è¡Œç¬¦</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">NAME</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">LAST DEPLOYED</span>: <span style="color:#ae81ff">Mon Jan 11 20:46:10 2021</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">NAMESPACE</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">STATUS</span>: <span style="color:#ae81ff">pending-install</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">REVISION</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">TEST SUITE</span>: <span style="color:#ae81ff">None</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">HOOKS</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">MANIFEST</span>:
</span></span><span style="display:flex;"><span>---  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Source: nginx/templates/service.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>:   <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>:  <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        -  <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span> 
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">NodePort</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Source: nginx/templates/deployment.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">strategy</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">env: - name: hello value</span>: <span style="color:#ae81ff">123</span></span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>range</code><!-- raw HTML omitted -->å¾ªç¯å—<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>åœ¨<code>Helm</code>æ¨¡æ¿è¯­è¨€ä¸­ï¼Œä½¿ç”¨<code>range</code>å…³é”®å­—æ¥è¿›è¡Œå¾ªç¯æ“ä½œ</li>
<li>åœ¨<code>values.yaml</code>ä¸­æ·»åŠ ä¸€ä¸ªå˜é‡åˆ—è¡¨ï¼š</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">test</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">1</span> 
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">2</span> 
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">3</span></span></span></code></pre></div><ul>
<li>4.3 å¾ªç¯æ‰“å°è¯¥åˆ—è¡¨ï¼š</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1 </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>:    {{   <span style="color:#ae81ff">.Release.Name    }} </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">data</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">test</span>:    
</span></span><span style="display:flex;"><span>        {{- <span style="color:#ae81ff">range . Values.test }}</span>
</span></span><span style="display:flex;"><span>            {{   <span style="color:#ae81ff">.    }}</span>
</span></span><span style="display:flex;"><span>        {{-   <span style="color:#ae81ff">end   }}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>with</code><!-- raw HTML omitted -->æŒ‡å®šèŒƒå›´<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>with</code><!-- raw HTML omitted -->å¯ä»¥ç”¨æ¥æ§åˆ¶å˜é‡ä½œç”¨åŸŸ<!-- raw HTML omitted --></li>
<li>å‰é¢æˆ‘ä»¬ä½¿ç”¨<code>{{ .Release.xxx }}</code>æˆ–è€…<code>{{ .Values.xxx }}</code>ï¼Œå…¶ä¸­.å°±æ˜¯è¡¨ç¤ºå¯¹å½“å‰èŒƒå›´çš„å¼•ç”¨ï¼Œ<code>.values</code>å°±æ˜¯å‘Šè¯‰æ¨¡æ¿åœ¨å½“å‰èŒƒå›´ä¸­æŸ¥æ‰¾Valueså¯¹è±¡çš„å€¼</li>
<li><code>with</code><!-- raw HTML omitted -->è¯­å¥å°±å¯ä»¥ç”¨æ¥æ§åˆ¶å˜é‡çš„ä½œç”¨åŸŸèŒƒå›´ï¼Œå…¶è¯­æ³•å’Œä¸€ä¸ªç®€å•çš„ifè¯­å¥ç±»ä¼¼ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{ <span style="color:#ae81ff">with æ¡ä»¶è¡¨è¾¾å¼ }}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># xxx</span>
</span></span><span style="display:flex;"><span>{{ <span style="color:#ae81ff">end }}</span></span></span></code></pre></div><ul>
<li><code>with</code><!-- raw HTML omitted -->è¯­å¥å¯ä»¥å…è®¸å°†å½“å‰èŒƒå›´çš„.è®¾ç½®ä¸ºç‰¹å®šçš„å¯¹è±¡ï¼Œæ¯”å¦‚æˆ‘ä»¬å‰é¢ä¸€ç›´ä½¿ç”¨çš„<code>.Values.label</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨withæ¥å°†.èŒƒå›´æŒ‡å‘<!-- raw HTML omitted --><code>.Values.label</code>ç¤ºä¾‹ï¼š<code>values.yaml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">nodeSelector</span>: 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">team</span>: <span style="color:#ae81ff">a </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gpu</span>:   <span style="color:#66d9ef">yes</span></span></span></code></pre></div><ul>
<li><code>deployment.yaml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>:   <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>:   <span style="color:#ae81ff">Deployment </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: {{ <span style="color:#ae81ff">.Release.Name }}-deployment </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">matchLabels</span>: 
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">template</span>: 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">labels</span>: 
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>            {{- <span style="color:#ae81ff">with .Values.nodeSelector }}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">nodeSelector</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">team</span>: {{  <span style="color:#ae81ff">.team }}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">gpu</span>: {{  <span style="color:#ae81ff">.gpu  }}</span>
</span></span><span style="display:flex;"><span>            {{- <span style="color:#ae81ff">end }}</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="å‘½åæ¨¡æ¿">å‘½åæ¨¡æ¿</h2>
<ul>
<li>
<ol>
<li>éœ€è¦å¤ç”¨ä»£ç çš„åœ°æ–¹å¯ä»¥ä½¿ç”¨å‘½åæ¨¡æ¿</li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å‘½åæ¨¡æ¿ï¼š<!-- raw HTML omitted -->ä½¿ç”¨<code>define</code>å®šä¹‰ï¼Œ<code>template</code>å¼•å…¥ï¼Œåœ¨<code>templates</code>ç›®å½•ä¸­é»˜è®¤ä¸‹åˆ’çº¿å¼€å¤´çš„æ–‡ä»¶ä¸ºå…¬å…±æ¨¡æ¿,æ¯”å¦‚ï¼š<code>_helpers.tpl</code>ã€‚</li>
</ol>
</li>
<li>
<ol start="3">
<li>ç¤ºä¾‹ï¼š<code> _helpers.tpl</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{-   <span style="color:#ae81ff">define   &#34;demo.fullname&#34;   -}}</span>
</span></span><span style="display:flex;"><span>{{- <span style="color:#ae81ff">.Chart.Name -}}-{{ .Release.Name }}</span>
</span></span><span style="display:flex;"><span>{{-   <span style="color:#ae81ff">end   -}}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>deployment.yaml</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>:   <span style="color:#ae81ff">apps/v1 </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>:   <span style="color:#ae81ff">Deployment </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>:  {{   <span style="color:#ae81ff">template&#34;demo.fullname&#34;   .    }}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å…¶ä»–ç•¥</span></span></span></code></pre></div><ul>
<li><code>template</code><!-- raw HTML omitted -->æŒ‡ä»¤æ˜¯å°†ä¸€ä¸ªæ¨¡æ¿åŒ…å«åœ¨å¦ä¸€ä¸ªæ¨¡æ¿ä¸­çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œ<code>template</code>å‡½æ•°ä¸èƒ½ç”¨äº<code>Go</code>æ¨¡æ¿ç®¡é“ï¼Œä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œå¢åŠ äº†<code>include</code>åŠŸèƒ½<!-- raw HTML omitted --></li>
<li><code>_helpers.tplï¼š</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{{-   <span style="color:#ae81ff">define   &#34;demo.labels&#34;    -}}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">app</span>:   {{   <span style="color:#ae81ff">template&#34;demo.fullname&#34;   .   }}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">chart</span>:   <span style="color:#e6db74">&#34;{{   .Chart.Name   }}-{{    .Chart.Version   }}&#34;</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">release</span>:   <span style="color:#e6db74">&#34;{{   .Release.Name   }}&#34;</span>
</span></span><span style="display:flex;"><span>{{-   <span style="color:#ae81ff">end   -}}</span></span></span></code></pre></div><ul>
<li>4.3 <code>deployment.yaml</code></li>
</ul>
<blockquote>
<p>ä¸‹é¢åŒ…å«ä¸€ä¸ªåä¸º<code>demo.labels</code>çš„æ¨¡æ¿ï¼Œç„¶åå°†å€¼  . ä¼ é€’ç»™æ¨¡æ¿ï¼Œæœ€åå°†è¯¥æ¨¡æ¿çš„ è¾“å‡ºä¼ é€’ç»™<code>nindent</code>å‡½æ•°ã€‚</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>:   <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>:   <span style="color:#ae81ff">Deployment </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>:    {{   <span style="color:#ae81ff">include&#34;demo.fullname&#34;   .    }} </span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        {{-   <span style="color:#ae81ff">include   &#34;demo.labels&#34;   .    |   nindent   4    }}</span>
</span></span><span style="display:flex;"><span>...</span></span></code></pre></div></blockquote>
</blockquote>

<pre class="mermaid align-center zoomable">graph LR
A(åˆ›å»ºæ¨¡æ¿) --&gt;B(ä¿®æ”¹Chart.yaml Values.yamlæ–‡ä»¶&lt;br&gt;æ·»åŠ å¸¸ç”¨å˜é‡&lt;br&gt;)
    B --&gt; C(åœ¨Templatesç›®å½•ä¸‹åˆ›å»ºéƒ¨ç½²é•œåƒæ‰€éœ€çš„yamlæ–‡ä»¶&lt;br&gt;å¹¶ä¸”ä½¿ç”¨å˜é‡&lt;br&gt;å¼•ç”¨yamlæ–‡ä»¶é‡Œé¢çš„å¸¸å˜åŠ¨å­—æ®µ&lt;br&gt;)
    
    C --&gt;|a=1| D{æš‚æœªå¯ç”¨}
    C --&gt;|a=2| E[æš‚æœªå¯ç”¨]
    F[å¼€å‘è‡ªå·±çš„chart]</pre><hr>
<h2 id="ä½¿ç”¨helmå®‰è£…jenkins">ä½¿ç”¨<code>Helm</code>å®‰è£…<code>Jenkins</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è·å–æ›´æ–°ä»“åº“ä¿¡æ¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo add jenkins https://charts.jenkins.io
</span></span><span style="display:flex;"><span>$ helm repo update</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->æŸ¥çœ‹å·²ç»æ·»åŠ çš„<!-- raw HTML omitted --><code>helm</code><!-- raw HTML omitted -->ä»“åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo list</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æœç´¢ä»“åº“ä¸­çš„<!-- raw HTML omitted --><code>Jenkins</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm search repo jenkins
</span></span><span style="display:flex;"><span>NAME           	CHART VERSION	APP VERSION	DESCRIPTION                                       
</span></span><span style="display:flex;"><span>jenkins/jenkins	4.2.5        	2.361.1    	Jenkins - Build great things at any scale! The ...</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted --> æŸ¥çœ‹ã€ä¸‹è½½<!-- raw HTML omitted --><code>Jenkins</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm show values jenkins/jenkins
</span></span><span style="display:flex;"><span>$ helm pull jenkins/jenkins  	<span style="color:#75715e"># ä¸‹è½½ Jenkins å®‰è£…åŒ…</span>
</span></span><span style="display:flex;"><span>$ tar -zxvf jenkins-3.5.9.tgz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i -e <span style="color:#e6db74">&#39;/#/d;/^$/d&#39;</span> values.yaml  	<span style="color:#75715e"># å»æ‰æ³¨é‡Šå’Œç©ºè¡Œåä¿®æ”¹</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å®‰è£…ä»¥åŠæŸ¥çœ‹ç™»å½•åå’Œå¯†ç <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install jenkins ./jenkins
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ç™»å½•çš„ç”¨æˆ·å</span>
</span></span><span style="display:flex;"><span>$  kubectl exec jenkins-0 -- cat /run/secrets/chart-admin-username
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ç™»å½•çš„å¯†ç </span>
</span></span><span style="display:flex;"><span>$  kubectl exec jenkins-0 -- cat /run/secrets/chart-admin-password</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ä½¿ç”¨helmå®‰è£…redis">ä½¿ç”¨<code>Helm</code>å®‰è£…<code>Redis</code></h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ <!-- raw HTML omitted --><code>Bitnami</code><!-- raw HTML omitted -->ä»“åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm repo add bitnami https://charts.bitnami.com/bitnami
</span></span><span style="display:flex;"><span>$ helm repo list
</span></span><span style="display:flex;"><span>$ helm search repo redis</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¸‹è½½ã€é…ç½®å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm pull bitnami/redis
</span></span><span style="display:flex;"><span>$ tar xvf redis-18.8.0.tgz</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>values.yaml</code></li>
</ul>
<blockquote>
<ul>
<li><code>StorageClass</code><!-- raw HTML omitted -->çš„åå­—ï¼Œå¦‚æœ<!-- raw HTML omitted --><code>storageClass</code><!-- raw HTML omitted -->ä¸æ­£å¸¸ï¼Œ<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->å¯åŠ¨ä¸äº†<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">global</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">imageRegistry</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">imagePullSecrets</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClass</span>: <span style="color:#e6db74">&#34;nfs-storage-template&#34;</span>    <span style="color:#75715e"># StorageClass çš„åå­—ï¼Œå¦‚æœstorageClassä¸æ­£å¸¸ï¼Œrediså¯åŠ¨ä¸äº†</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">redis</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">password</span>: <span style="color:#e6db74">&#34;Password&#34;</span>    <span style="color:#75715e"># redis è¿æ¥å¯†ç </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kubeVersion</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">nameOverride</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">fullnameOverride</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">namespaceOverride</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">commonLabels</span>: {}
</span></span><span style="display:flex;"><span><span style="color:#f92672">commonAnnotations</span>: {}
</span></span><span style="display:flex;"><span><span style="color:#f92672">secretAnnotations</span>: {}
</span></span><span style="display:flex;"><span><span style="color:#f92672">clusterDomain</span>: <span style="color:#ae81ff">cluster.local</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">extraDeploy</span>: []
</span></span><span style="display:flex;"><span><span style="color:#f92672">useHostnames</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">nameResolutionThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">nameResolutionTimeout</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">diagnosticMode</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">sleep</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">args</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">infinity</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">registry</span>: <span style="color:#ae81ff">docker.io</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">repository</span>: <span style="color:#ae81ff">bitnami/redis</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">7.2.4</span>-<span style="color:#ae81ff">debian-11-r2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">digest</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pullSecrets</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">debug</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">architecture</span>: <span style="color:#ae81ff">replication  </span> <span style="color:#75715e"># standalone:å•èŠ‚ç‚¹éƒ¨ç½²ï¼Œreplicationï¼šä¸€ä¸»ä¸‰ä»é…ç½®</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">auth</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sentinel</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">existingSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">existingSecretPasswordKey</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">usePasswordFiles</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">commonConfiguration</span>: |-<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  appendonly yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  save &#34;&#34;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">existingConfigmap</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">master</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">count</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">configuration</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">disableCommands</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">FLUSHDB</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">FLUSHALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">args</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enableServiceLinks</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">preExecCmds</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraFlags</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVars</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVarsCM</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVarsSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerPorts</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">redis</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">startupProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">readinessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customStartupProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customLivenessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customReadinessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">limits</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">fsGroupChangePolicy</span>: <span style="color:#ae81ff">Always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sysctls</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">supplementalGroups</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">fsGroup</span>: <span style="color:#ae81ff">1001</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seLinuxOptions</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsUser</span>: <span style="color:#ae81ff">1001</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsGroup</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsNonRoot</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">allowPrivilegeEscalation</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seccompProfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RuntimeDefault</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">capabilities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">drop</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">ALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StatefulSet</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schedulerName</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">updateStrategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">minReadySeconds</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">priorityClassName</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">automountServiceAccountToken</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hostAliases</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podLabels</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAnnotations</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">shareProcessNamespace</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAffinityPreset</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAntiAffinityPreset</span>: <span style="color:#ae81ff">soft</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeAffinityPreset</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">values</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeSelector</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tolerations</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">topologySpreadConstraints</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dnsPolicy</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dnsConfig</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">lifecycleHooks</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumes</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumeMounts</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sidecars</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">initContainers</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistence</span>:    <span style="color:#75715e"># æŒä¹…åŒ–é…ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>   <span style="color:#75715e"># é»˜è®¤å¯ç”¨</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">medium</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sizeLimit</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/data  </span> <span style="color:#75715e"># å­˜å‚¨ç›®å½•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subPath</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subPathExpr</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">size</span>: <span style="color:#ae81ff">2Gi  </span> <span style="color:#75715e"># Master ä¸»èŠ‚ç‚¹é»˜è®¤ä½¿ç”¨ç©ºé—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">dataSource</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">existingClaim</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeClaimRetentionPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">whenScaled</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">whenDeleted</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">service</span>:    <span style="color:#75715e"># æœåŠ¡ç«¯å£é…ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodePorts</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">externalTrafficPolicy</span>: <span style="color:#ae81ff">Cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">extraPorts</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">internalTrafficPolicy</span>: <span style="color:#ae81ff">Cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">clusterIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerSourceRanges</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">externalIPs</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sessionAffinity</span>: <span style="color:#ae81ff">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sessionAffinityConfig</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceAccount</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">create</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">automountServiceAccountToken</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">replica</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StatefulSet</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicaCount</span>: <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># ä»èŠ‚ç‚¹å‰¯æœ¬æ•°é‡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">configuration</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">disableCommands</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">FLUSHDB</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">FLUSHALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">args</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enableServiceLinks</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">preExecCmds</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraFlags</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVars</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVarsCM</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVarsSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">externalMaster</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">host</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerPorts</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">redis</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">startupProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">readinessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customStartupProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customLivenessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customReadinessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">limits</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   cpu: 250m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   memory: 256Mi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   cpu: 250m</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   memory: 256Mi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">fsGroupChangePolicy</span>: <span style="color:#ae81ff">Always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sysctls</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">supplementalGroups</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">fsGroup</span>: <span style="color:#ae81ff">1001</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seLinuxOptions</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsUser</span>: <span style="color:#ae81ff">1001</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsGroup</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsNonRoot</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">allowPrivilegeEscalation</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seccompProfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RuntimeDefault</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">capabilities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">drop</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">ALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schedulerName</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">updateStrategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">minReadySeconds</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">priorityClassName</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podManagementPolicy</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">automountServiceAccountToken</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hostAliases</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podLabels</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAnnotations</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">shareProcessNamespace</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAffinityPreset</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAntiAffinityPreset</span>: <span style="color:#ae81ff">soft</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeAffinityPreset</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">values</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeSelector</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tolerations</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">topologySpreadConstraints</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dnsPolicy</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dnsConfig</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">lifecycleHooks</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumes</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumeMounts</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sidecars</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">initContainers</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistence</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">medium</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sizeLimit</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subPath</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">subPathExpr</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">size</span>: <span style="color:#ae81ff">2Gi  	# ä»èŠ‚ç‚¹ä½¿ç”¨ç£ç›˜ç©ºé—´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">dataSource</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">existingClaim</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeClaimRetentionPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">whenScaled</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">whenDeleted</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodePorts</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">externalTrafficPolicy</span>: <span style="color:#ae81ff">Cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">internalTrafficPolicy</span>: <span style="color:#ae81ff">Cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">extraPorts</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">clusterIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerSourceRanges</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sessionAffinity</span>: <span style="color:#ae81ff">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sessionAffinityConfig</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">autoscaling</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">minReplicas</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">maxReplicas</span>: <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetCPU</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetMemory</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceAccount</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">create</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">automountServiceAccountToken</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">sentinel</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">registry</span>: <span style="color:#ae81ff">docker.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">repository</span>: <span style="color:#ae81ff">bitnami/redis-sentinel</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">7.2.4</span>-<span style="color:#ae81ff">debian-11-r3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">digest</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullSecrets</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">debug</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">masterSet</span>: <span style="color:#ae81ff">mymaster</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">quorum</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">getMasterTimeout</span>: <span style="color:#ae81ff">90</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">automateClusterRecovery</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">redisShutdownWaitFailover</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">downAfterMilliseconds</span>: <span style="color:#ae81ff">60000</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">failoverTimeout</span>: <span style="color:#ae81ff">180000</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">parallelSyncs</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">configuration</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">args</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enableServiceLinks</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">preExecCmds</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVars</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVarsCM</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVarsSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">externalMaster</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">host</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerPorts</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sentinel</span>: <span style="color:#ae81ff">26379</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">startupProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">readinessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customStartupProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customLivenessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customReadinessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistence</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storageClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">size</span>: <span style="color:#ae81ff">100Mi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">selector</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">dataSource</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">medium</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sizeLimit</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeClaimRetentionPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">whenScaled</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">whenDeleted</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">limits</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seLinuxOptions</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsUser</span>: <span style="color:#ae81ff">1001</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsGroup</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsNonRoot</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">allowPrivilegeEscalation</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seccompProfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RuntimeDefault</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">capabilities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">drop</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">ALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">lifecycleHooks</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumes</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumeMounts</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>: <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">sentinel</span>: <span style="color:#ae81ff">26379</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodePorts</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">redis</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">sentinel</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">externalTrafficPolicy</span>: <span style="color:#ae81ff">Cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">extraPorts</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">clusterIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerSourceRanges</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sessionAffinity</span>: <span style="color:#ae81ff">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sessionAffinityConfig</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">headless</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">terminationGracePeriodSeconds</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">serviceBindings</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">networkPolicy</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">allowExternal</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraIngress</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEgress</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ingressNSMatchLabels</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ingressNSPodMatchLabels</span>: {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">metrics</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">allowExternal</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ingressNSMatchLabels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ingressNSPodMatchLabels</span>: {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">podSecurityPolicy</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">create</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rbac</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">create</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rules</span>: []
</span></span><span style="display:flex;"><span><span style="color:#f92672">serviceAccount</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">create</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">automountServiceAccountToken</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span><span style="color:#f92672">pdb</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">create</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">minAvailable</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">maxUnavailable</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">tls</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">authClients</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">autoGenerated</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">existingSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">certificatesSecret</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">certFilename</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">certKeyFilename</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">certCAFilename</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">dhParamsFilename</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metrics</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">registry</span>: <span style="color:#ae81ff">docker.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">repository</span>: <span style="color:#ae81ff">bitnami/redis-exporter</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">1.56.0</span>-<span style="color:#ae81ff">debian-11-r1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">digest</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullSecrets</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">startupProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">readinessProbe</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeoutSeconds</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">successThreshold</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">failureThreshold</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customStartupProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customLivenessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">customReadinessProbe</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">redisTargetHost</span>: <span style="color:#e6db74">&#34;localhost&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraArgs</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraEnvVars</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seLinuxOptions</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsUser</span>: <span style="color:#ae81ff">1001</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsGroup</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsNonRoot</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">allowPrivilegeEscalation</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seccompProfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RuntimeDefault</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">capabilities</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">drop</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">ALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumes</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraVolumeMounts</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">limits</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podLabels</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podAnnotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">prometheus.io/scrape</span>: <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">prometheus.io/port</span>: <span style="color:#e6db74">&#34;9121&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">9121</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">externalTrafficPolicy</span>: <span style="color:#ae81ff">Cluster</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">extraPorts</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerClass</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">loadBalancerSourceRanges</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">annotations</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">clusterIP</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceMonitor</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">30s</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">scrapeTimeout</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">relabellings</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metricRelabelings</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">honorLabels</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">additionalLabels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">podTargetLabels</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sampleLimit</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetLimit</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">podMonitor</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">interval</span>: <span style="color:#ae81ff">30s</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">scrapeTimeout</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">relabellings</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metricRelabelings</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">honorLabels</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">additionalLabels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">podTargetLabels</span>: []
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sampleLimit</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetLimit</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">prometheusRule</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">additionalLabels</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rules</span>: []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">volumePermissions</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">registry</span>: <span style="color:#ae81ff">docker.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">repository</span>: <span style="color:#ae81ff">bitnami/os-shell</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">11</span>-<span style="color:#ae81ff">debian-11-r94</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">digest</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullSecrets</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">limits</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>: {}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containerSecurityContext</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">seLinuxOptions</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runAsUser</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">sysctl</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">registry</span>: <span style="color:#ae81ff">docker.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">repository</span>: <span style="color:#ae81ff">bitnami/os-shell</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">11</span>-<span style="color:#ae81ff">debian-11-r94</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">digest</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pullSecrets</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">command</span>: []
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mountHostSys</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">limits</span>: {}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>: {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">useExternalDNS</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">suffix</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotationKey</span>: <span style="color:#ae81ff">external-dns.alpha.kubernetes.io/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">additionalAnnotations</span>: {}</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Redis</code><!-- raw HTML omitted -->å½¢æˆ<!-- raw HTML omitted --><code>Release</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm install release-name project-dir -n namespace
</span></span><span style="display:flex;"><span>$ helm install redis ./redis/ -n default</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç™»å½•<!-- raw HTML omitted --><code>Redis</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl exec --tty -i redis-master-0 --namespace default -- bash
</span></span><span style="display:flex;"><span>$ kubectl exec --tty -i redis-replicas-1 --namespace default -- bash</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å‡çº§<!-- raw HTML omitted --><code>Redis</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ helm upgrade redis ./redis/ -n default</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ä½¿ç”¨helmå®‰è£…prometheus">ä½¿ç”¨<code>Helm</code>å®‰è£…<code>Prometheus</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/prometheus-operator/kube-prometheus" rel="external" target="_self"><code>kube-prometheus</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="ä½¿ç”¨helmå®‰è£…elk">ä½¿ç”¨<code>Helm</code>å®‰è£…<code>ELK</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_k8s_auth">Configure_K8s_Auth</h1>

<h2 id="å®‰å…¨æ§åˆ¶">å®‰å…¨æ§åˆ¶</h2>
<h3 id="è®¿é—®æ§åˆ¶">è®¿é—®æ§åˆ¶</h3>
<ul>
<li>
<ol>
<li><code>kubernetes</code>ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤çš„ç®¡ç†å·¥å…·ï¼Œä¿è¯é›†ç¾¤çš„å®‰å…¨æ€§æ˜¯å…¶ä¸€ä¸ªé‡è¦çš„ä»»åŠ¡ã€‚æ‰€è°“çš„å®‰å…¨æ€§å…¶å®å°±æ˜¯ä¿è¯å¯¹<code>kubernetes</code>çš„å„ç§å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯å’Œæˆæƒæ“ä½œ</li>
</ol>
</li>
<li>
<ol start="2">
<li>åœ¨<code>kubernetes</code>é›†ç¾¤ä¸­ï¼Œå®¢æˆ·ç«¯é€šå¸¸ç”±ä¸¤ç±»ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>User Account</code><!-- raw HTML omitted -->ï¼šä¸€èˆ¬æ˜¯ç‹¬ç«‹äº<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->ä¹‹å¤–çš„å…¶ä»–æœåŠ¡ç®¡ç†çš„ç”¨æˆ·è´¦å·<!-- raw HTML omitted --></li>
<li><code>Service Account</code>ï¼š<code>kubernetes</code><!-- raw HTML omitted -->ç®¡ç†çš„è´¦å·ï¼Œç”¨äºä¸º<!-- raw HTML omitted --><code>Pod</code><!-- raw HTML omitted -->çš„æœåŠ¡è¿›ç¨‹åœ¨è®¿é—®<!-- raw HTML omitted --><code>kubernetes</code><!-- raw HTML omitted -->æ—¶æä¾›èº«ä»½æ ‡è¯†<!-- raw HTML omitted --></li>
</ul>

<pre class="mermaid align-center zoomable">graph LR
C1((ç”¨æˆ·)) --&gt; B1(User&lt;br&gt;Account) --&gt; A((Kubernetes))
C2((Pod)) --&gt; B2(Service&lt;br&gt;Account) --&gt; A((Kubernetes))</pre></blockquote>
<hr>
<h3 id="è®¤è¯æˆæƒå’Œå‡†å…¥æ§åˆ¶">è®¤è¯ã€æˆæƒå’Œå‡†å…¥æ§åˆ¶</h3>
<ul>
<li>
<ol>
<li><code>API Server</code><!-- raw HTML omitted -->æ˜¯è®¿é—®å’Œç®¡ç†èµ„æºå¯¹è±¡çš„å”¯ä¸€å…¥å£ã€‚ä»»ä½•ä¸€ä¸ªè¯·æ±‚è®¿é—®<!-- raw HTML omitted --><code>API Server</code>ï¼Œ<!-- raw HTML omitted -->éƒ½è¦ç»è¿‡ä¸‹é¢çš„ä¸‰ä¸ªæµç¨‹ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Authentication</code>(è®¤è¯)<!-- raw HTML omitted -->ï¼šèº«ä»½é‰´åˆ«ï¼Œåªæœ‰æ­£ç¡®çš„è´¦å·æ‰èƒ½é€šè¿‡è®¤è¯<!-- raw HTML omitted --></li>
<li><code>Authorization</code>(æˆæƒ)<!-- raw HTML omitted -->ï¼šæƒé™é‰´åˆ«ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å¯¹è®¿é—®çš„èµ„æºæ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œ<!-- raw HTML omitted --></li>
<li><code>Admission Control</code>(å‡†å…¥æ§åˆ¶)<!-- raw HTML omitted -->ï¼šç²¾ç»†è®¿é—®æ§åˆ¶ï¼Œç”¨äºè¡¥å……æˆæƒæœºåˆ¶ä»¥å®ç°æ›´åŠ ç²¾ç»†çš„è®¿é—®æ§åˆ¶åŠŸèƒ½<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->éœ€è¦æ³¨æ„ï¼š<!-- raw HTML omitted -->åœ¨<code>Kubernetes</code>ä¸­ä¸èƒ½é€šè¿‡<code>API</code>è°ƒç”¨å°†æ™®é€šç”¨æˆ·æ·»åŠ åˆ°é›†ç¾¤ä¸­</li>
</ul>
<blockquote>
<ul>
<li>æ™®é€šè´¦æˆ·æ˜¯é’ˆå¯¹ï¼ˆäººï¼‰ç”¨æˆ·çš„ï¼ŒæœåŠ¡è´¦æˆ·é’ˆå¯¹<code>Pods</code>è¿›ç¨‹</li>
<li>æ™®é€šè´¦æˆ·æ˜¯å…¨å±€æ€§ï¼Œåœ¨é›†ç¾¤æ‰€æœ‰<code>namespaces</code>ä¸­ï¼Œåç§°å…·æœ‰å”¯ä¸€æ€§</li>
<li>é€šå¸¸ï¼Œé›†ç¾¤çš„æ™®é€šè´¦æˆ·å¯ä»¥ä¸ä¼ä¸šæ•°æ®åº“åŒæ­¥ï¼Œæ–°çš„æ™®é€šè´¦æˆ·åˆ›å»ºéœ€è¦ç‰¹æ®Šæƒé™ï¼ŒæœåŠ¡è´¦æˆ·åˆ›å»ºç›®çš„æ˜¯æ›´è½»é‡åŒ–ï¼Œå…è®¸é›†ç¾¤ç”¨æˆ·ä¸ºç‰¹å®šä»»åŠ¡åˆ›å»ºæœåŠ¡è´¦æˆ·</li>
<li>æ™®é€šè´¦æˆ·å’ŒæœåŠ¡è´¦æˆ·çš„å®¡æ ¸æ³¨æ„äº‹é¡¹ä¸åŒ</li>
<li>å¯¹äºå¤æ‚ç³»ç»Ÿçš„é…ç½®åŒ…ï¼Œå¯ä»¥åŒ…æ‹¬å¯¹è¯¥ç³»ç»Ÿçš„å„ç§ç»„ä»¶çš„æœåŠ¡è´¦æˆ·çš„å®šä¹‰</li>
</ul>
</blockquote>

<pre class="mermaid align-center zoomable">graph LR
A((è¯·æ±‚)) --&gt; B[Authentication&lt;br&gt;è®¤è¯&lt;br&gt;èº«ä»½é‰´åˆ«&lt;br&gt;] --&gt; C[Authorization&lt;br&gt;æˆæƒ&lt;br&gt;æƒé™é‰´åˆ«&lt;br&gt;] --&gt; D[Admission Control&lt;br&gt;æ³¨å…¥æ§åˆ¶&lt;br&gt;ç²¾ç»†è®¿é—®æ§åˆ¶&lt;br&gt;] --&gt; E((Kubernetes&lt;br&gt;èµ„æº))</pre></blockquote>
<hr>
<h4 id="è®¤è¯ç®¡ç†">è®¤è¯ç®¡ç†</h4>
<h5 id="user-accountsæ™®é€šè´¦æˆ·"><code>User Accounts</code>(æ™®é€šè´¦æˆ·)</h5>
<hr>
<h5 id="service-accountsæœåŠ¡è´¦æˆ·"><code>Service Accounts</code>(æœåŠ¡è´¦æˆ·)</h5>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount   </span> <span style="color:#75715e"># æƒé™ç®¡ç†</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">nfs-client-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span></span></span></code></pre></div></blockquote>
<hr>
<h5 id="kubernetesfont-colorredçš„å®¢æˆ·ç«¯fonthttpfont-colorredå’Œfonthttpsfont-colorredèº«ä»½è®¤è¯æ–¹å¼font"><code>kubernetes</code><!-- raw HTML omitted -->çš„å®¢æˆ·ç«¯<!-- raw HTML omitted --><code>http</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>https</code><!-- raw HTML omitted -->èº«ä»½è®¤è¯æ–¹å¼<!-- raw HTML omitted --></h5>
<ul>
<li>
<ol>
<li><code>kubernetes</code><!-- raw HTML omitted -->å…è®¸åŒæ—¶é…ç½®å¤šç§è®¤è¯æ–¹å¼ï¼Œ<!-- raw HTML omitted -->åªè¦å…¶ä¸­ä»»æ„ä¸€ç§æ–¹å¼è®¤è¯é€šè¿‡å³å¯</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>kubernetes</code>é›†ç¾¤å®‰å…¨çš„å…³é”®ç‚¹åœ¨äºå¦‚ä½•è¯†åˆ«å¹¶è®¤è¯å®¢æˆ·ç«¯èº«ä»½ï¼Œå®ƒæä¾›äº†<code>3</code>ç§å®¢æˆ·ç«¯èº«ä»½è®¤è¯æ–¹å¼</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>2.1 <code>HTTP Base</code><!-- raw HTML omitted -->è®¤è¯ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é€šè¿‡ç”¨æˆ·å+å¯†ç çš„æ–¹å¼è¿›è¡Œè®¤è¯ï¼Œ<!-- raw HTML omitted -->è¿™ç§æ–¹å¼æ˜¯æŠŠ<code>ç”¨æˆ·å:å¯†ç </code>ç”¨<code>BASE64</code>ç®—æ³•è¿›è¡Œç¼–ç åçš„å­—ç¬¦ä¸²æ”¾åœ¨<code>HTTP</code>è¯·æ±‚ä¸­çš„<code>Header</code>çš„<code>Authorization</code>åŸŸé‡Œé¢å‘é€ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯æ”¶åˆ°åè¿›è¡Œè§£ç ï¼Œè·å–ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹</li>
</ul>
</blockquote>
<ul>
<li>2.2 <code>HTTP Token</code><!-- raw HTML omitted -->è®¤è¯ï¼š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é€šè¿‡ä¸€ä¸ª<code>Token</code>æ¥è¯†åˆ«åˆæ³•ç”¨æˆ·ï¼Œ<!-- raw HTML omitted -->è¿™ç§è®¤è¯æ–¹å¼æ˜¯ç”¨ä¸€ä¸ªå¾ˆé•¿çš„éš¾ä»¥è¢«æ¨¡ä»¿çš„å­—ç¬¦ä¸²<code>--Token</code>æ¥è¡¨æ˜å®¢æˆ·ç«¯èº«ä»½çš„ä¸€ç§æ–¹å¼ã€‚æ¯ä¸ª<code>Token</code>å¯¹åº”ä¸€ä¸ªç”¨æˆ·åï¼Œå½“å®¢æˆ·ç«¯å‘èµ·<code>API</code>è°ƒç”¨è¯·æ±‚çš„æ—¶å€™ï¼Œéœ€è¦åœ¨<code>HTTP</code>çš„<code>Header</code>ä¸­æ”¾å…¥<code>Token</code>ï¼Œ<code>API Server</code>æ¥å—åˆ°<code>Token</code>åä¼šå’ŒæœåŠ¡å™¨ä¸­ä¿å­˜çš„<code>Token</code>è¿›è¡Œæ¯”å¯¹ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚</li>
</ul>
</blockquote>
<ul>
<li>2.3 <code>HTTPS</code><!-- raw HTML omitted -->è¯ä¹¦è®¤è¯ï¼š <!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åŸºäº<code>CA</code>æ ¹è¯ä¹¦ç­¾åçš„åŒå‘æ•°å­—è¯ä¹¦è®¤è¯æ–¹å¼ï¼Œ<!-- raw HTML omitted -->è¿™ç§è®¤è¯æ–¹å¼æ˜¯å®‰å…¨æ€§æœ€é«˜çš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿæ˜¯æ“ä½œèµ·æ¥æœ€éº»çƒ¦çš„ä¸€ç§æ–¹å¼</li>
<li><!-- raw HTML omitted -->è¯ä¹¦ç”³è¯·å’Œä¸‹å‘ï¼š<!-- raw HTML omitted --><code>HTTPS</code>é€šä¿¡åŒæ–¹çš„æœåŠ¡å™¨å‘<code>CA</code>æœºæ„ç”³è¯·è¯ä¹¦ï¼Œ<code>CA</code>æœºæ„å‘æ ¹è¯ä¹¦ã€æœåŠ¡ç«¯è¯ä¹¦åŠç§é’¥ç»™ç”³è¯·è€…</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„åŒå‘è®¤è¯<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚ï¼Œ<!-- raw HTML omitted -->æœåŠ¡ç«¯ä¸‹å‘è‡ªå·±çš„è¯ä¹¦ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ï¼Œåœ¨è¯ä¹¦ä¸­è·å–æœåŠ¡ç«¯çš„ç§é’¥ã€‚å®¢æˆ·ç«¯åˆ©ç”¨æœåŠ¡å™¨ç«¯çš„å…¬é’¥è®¤è¯è¯ä¹¦ä¸­çš„ä¿¡æ¯ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™è®¤å¯è¿™ä¸ªæœåŠ¡å™¨ã€‚</li>
<li><!-- raw HTML omitted -->å®¢æˆ·ç«¯å‘é€è‡ªå·±çš„è¯ä¹¦ç»™æœåŠ¡å™¨ç«¯ï¼Œ<!-- raw HTML omitted -->æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ã€‚åœ¨è¯ä¹¦ä¸­è·å–å®¢æˆ·ç«¯çš„å…¬é’¥ï¼Œå¹¶ç”¨è¯¥å…¬é’¥è®¤è¯è¯ä¹¦ä¿¡æ¯ï¼Œç¡®è®¤å®¢æˆ·ç«¯æ˜¯å¦åˆæ³•ã€‚</li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯åå•†å¥½åŠ å¯†æ–¹æ¡ˆåï¼Œå®¢æˆ·ç«¯ä¼šäº§ç”Ÿä¸€ä¸ªéšæœºçš„ç§é’¥å¹¶åŠ å¯†ï¼Œç„¶åå‘é€åˆ°æœåŠ¡å™¨ç«¯</li>
<li>æœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°è¿™ä¸ªç§é’¥åï¼ŒåŒæ–¹æ¥ä¸‹æ¥é€šä¿¡çš„æ‰€æœ‰å†…å®¹éƒ½é€šè¿‡è¯¥éšæœºç§é’¥åŠ å¯†</li>
</ul>
</blockquote>
</blockquote>

<pre class="mermaid align-center zoomable">graph TB
A((CAæœºæ„)) -- ç”³è¯·è¯ä¹¦ --&gt;B((æœåŠ¡ç«¯))
A((CAæœºæ„)) -- ç”³è¯·è¯ä¹¦ --&gt; C((å®¢æˆ·ç«¯))
B((æœåŠ¡ç«¯)) -- ä¸‹å‘è¯ä¹¦ --&gt; A((CAæœºæ„))
C((å®¢æˆ·ç«¯)) -- ä¸‹å‘è¯ä¹¦ --&gt; A((CAæœºæ„))

B((æœåŠ¡ç«¯)) &lt;-- åŒå‘èº«ä»½è®¤è¯ --&gt; C((å®¢æˆ·ç«¯))
B((æœåŠ¡ç«¯)) &lt;-- åŒå‘é€šä¿¡ --&gt; C((å®¢æˆ·ç«¯))</pre></blockquote>
<hr>
<h4 id="æˆæƒç®¡ç†">æˆæƒç®¡ç†</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æˆæƒå‘ç”Ÿåœ¨è®¤è¯æˆåŠŸä¹‹åï¼Œ<!-- raw HTML omitted -->é€šè¿‡è®¤è¯å°±å¯ä»¥çŸ¥é“è¯·æ±‚ç”¨æˆ·æ˜¯è°ï¼Œç„¶å<code>kubernetes</code>ä¼šæ ¹æ®äº‹å…ˆå®šä¹‰çš„æˆæƒç­–ç•¥æ¥å†³å®šç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºæˆæƒ</li>
</ol>
</li>
<li>
<ol start="2">
<li>æ¯ä¸ªå‘é€åˆ°<code>API Server</code>çš„è¯·æ±‚éƒ½å¸¦ä¸Šäº†ç”¨æˆ·å’Œèµ„æºçš„ä¿¡æ¯ï¼šæ¯”å¦‚å‘é€è¯·æ±‚çš„ç”¨æˆ·ã€è¯·æ±‚çš„è·¯å¾„ã€è¯·æ±‚çš„åŠ¨ä½œç­‰ï¼Œæˆæƒå°±æ˜¯æ ¹æ®è¿™äº›ä¿¡æ¯å’Œæˆæƒç­–ç•¥è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç¬¦åˆç­–ç•¥ï¼Œåˆ™è®¤ä¸ºæˆæƒé€šè¿‡ï¼Œå¦åˆ™ä¼šè¿”å›é”™è¯¯ã€‚</li>
</ol>
</li>
<li>
<ol start="3">
<li><code>API Server</code>ç›®å‰æ”¯æŒçš„å‡ ç§æˆæƒç­–ç•¥</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>AlwaysDeny</code><!-- raw HTML omitted -->ï¼šè¡¨ç¤ºæ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•<!-- raw HTML omitted --></li>
<li><code>AlwaysAllow</code><!-- raw HTML omitted -->ï¼šå…è®¸æ¥æ”¶æ‰€æœ‰çš„è¯·æ±‚ï¼Œç›¸å½“äºé›†ç¾¤ä¸éœ€è¦æˆæƒæµç¨‹ï¼ˆ<code>kubernetes</code>é»˜è®¤çš„ç­–ç•¥ï¼‰<!-- raw HTML omitted --></li>
<li><code>ABAC</code><!-- raw HTML omitted -->ï¼šåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼Œè¡¨ç¤ºä½¿ç”¨ç”¨æˆ·é…ç½®çš„æˆæƒè§„åˆ™å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡ŒåŒ¹é…å’Œæ§åˆ¶<!-- raw HTML omitted --></li>
<li><code>Webhook</code><!-- raw HTML omitted -->ï¼šé€šè¿‡è°ƒç”¨å¤–éƒ¨<code>REST</code>æœåŠ¡å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒ<!-- raw HTML omitted --></li>
<li><code>Node</code><!-- raw HTML omitted -->ï¼šæ˜¯ä¸€ç§ä¸“ç”¨æ¨¡å¼ï¼Œç”¨äºå¯¹<code>kubelet</code>å‘å‡ºçš„è¯·æ±‚è¿›è¡Œè®¿é—®æ§åˆ¶<!-- raw HTML omitted --></li>
<li><code>RBAC</code><!-- raw HTML omitted -->ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆ<code>kubeadm</code>å®‰è£…æ–¹å¼ä¸‹çš„é»˜è®¤é€‰é¡¹ï¼‰<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h5 id="rbacåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶"><code>RBAC</code>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶</h5>
<blockquote>
<ul>
<li><code>RBAC</code><!-- raw HTML omitted -->åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶<!-- raw HTML omitted -->(<code>Role Based Access Control</code>)<!-- raw HTML omitted -->ä¸»è¦æ˜¯åœ¨æè¿°ä¸€ä»¶äº‹æƒ…ï¼šç»™å“ªäº›å¯¹è±¡æˆæƒäº†å“ªäº›æƒé™<!-- raw HTML omitted --></li>
<li><code>RBAC</code>æ¶‰åŠåˆ°äº†ä¸‹é¢å‡ ä¸ªæ¦‚å¿µï¼š</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯¹è±¡ï¼š<!-- raw HTML omitted --><code>User</code>ã€<code>Groups</code>ã€<code>ServiceAccount</code>ã€‚</li>
<li><!-- raw HTML omitted -->è§’è‰²ï¼š<!-- raw HTML omitted -->ä»£è¡¨ç€ä¸€ç»„å®šä¹‰åœ¨èµ„æºä¸Šçš„å¯æ“ä½œçš„åŠ¨ä½œï¼ˆæƒé™ï¼‰çš„é›†åˆ</li>
<li><!-- raw HTML omitted -->ç»‘å®šï¼š<!-- raw HTML omitted -->å°†å®šä¹‰å¥½çš„è§’è‰²å’Œç”¨æˆ·ç»‘å®šåœ¨ä¸€èµ·</li>
</ul>
</blockquote>
<ul>
<li><code>RBAC</code>å¼•å…¥çš„<code>4</code>ä¸ªé¡¶çº§èµ„æºå¯¹è±¡ï¼š</li>
</ul>
<blockquote>
<ul>
<li><code>Role</code>(è§’è‰²)<!-- raw HTML omitted -->ï¼Œç”¨äºæŒ‡å®šä¸€ç»„æƒé™<!-- raw HTML omitted --></li>
<li><code>ClusterRole</code>(é›†ç¾¤è§’è‰²)<!-- raw HTML omitted -->ï¼Œç”¨äºæŒ‡å®šä¸€ç»„æƒé™<!-- raw HTML omitted --></li>
<li><code>RoleBinding</code>(è§’è‰²ç»‘å®š)<!-- raw HTML omitted -->ï¼Œç”¨äºå°†è§’è‰²ï¼ˆæƒé™çš„é›†åˆï¼‰èµ‹äºˆç»™å¯¹è±¡<!-- raw HTML omitted --></li>
<li><code>ClusterRoleBinding</code>(é›†ç¾¤è§’è‰²ç»‘å®š)<!-- raw HTML omitted -->ï¼Œç”¨äºå°†è§’è‰²ï¼ˆæƒé™çš„é›†åˆï¼‰èµ‹äºˆç»™å¯¹è±¡<!-- raw HTML omitted --></li>
</ul>
</blockquote>

<pre class="mermaid align-center zoomable">graph TB
A1(Group) --- A[RoleBinding]
A2(User) --- A[RoleBinding]
A3(Service&lt;br&gt;Account) --- A[RoleBinding]

A[RoleBinding] --- B[Role]

B[Role] --- Pod --- |a=1|B1[List]
B[Role] --- Pod --- |a=2|B2[Get]
B[Role] --- Pod --- |a=3|B3[Watch]

B[Role] --- Deployment --- |b=1|B4[List]
B[Role] --- Deployment --- |b=2|B5[Get]
B[Role] --- Deployment --- |b=3|B6[Watch]</pre></blockquote>
<hr>
<h5 id="roleæ™®é€šè§’è‰²"><code>Role</code>(æ™®é€šè§’è‰²)</h5>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸€ä¸ªè§’è‰²å°±æ˜¯ä¸€ç»„æƒé™çš„é›†åˆï¼Œè¿™é‡Œçš„æƒé™éƒ½æ˜¯è®¸å¯å½¢å¼çš„ï¼ˆç™½åå•ï¼‰<!-- raw HTML omitted --></li>
<li><code>Role</code><!-- raw HTML omitted -->åªèƒ½å¯¹å‘½åç©ºé—´çš„èµ„æºè¿›è¡Œæˆæƒï¼Œéœ€è¦æŒ‡å®š<!-- raw HTML omitted --><code>namespace</code></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><code>rules:</code><!-- raw HTML omitted -->ä¸­çš„å‚æ•°è¯´æ˜ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl explain role.rules.resources  	<span style="color:#75715e"># æ˜¾ç¤º resources ä½¿ç”¨æ–¹å¼</span></span></span></code></pre></div><ul>
<li>1.1 <code>apiGroups:</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ”¯æŒçš„<!-- raw HTML omitted --><code>API</code><!-- raw HTML omitted -->ç»„åˆ—è¡¨ï¼Œ<!-- raw HTML omitted --><code>&quot;&quot;</code>,<code>&quot;apps&quot;</code>,<code>&quot;autoscaling</code>&quot;&quot;,<code>&quot;batch&quot;</code>ã€‚</li>
</ul>
</blockquote>
<ul>
<li>1.2 <code>resources:</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨ï¼Œ<!-- raw HTML omitted --><code>&quot;namespaces&quot;</code>,<code>&quot;services&quot;</code>,<code>&quot;endpoints&quot;</code>,<code>&quot;pods&quot;</code>,<code>&quot;secrets&quot;</code>,<code>&quot;configmaps&quot;</code>,<code>&quot;crontabs&quot;</code>,<code>&quot;deployments&quot;</code>,<code>&quot;jobs&quot;</code>,<code>&quot;nodes&quot;</code>,<code>&quot;rolebindings&quot;</code>,<code>&quot;clusterroles&quot;</code>,<code>&quot;daemonsets&quot;</code>,<code>&quot;replicasets&quot;</code>,<code>&quot;statefulsets&quot;</code>,<code>&quot;horizontalpodautoscalers&quot;</code>,<code>&quot;replicationcontrollers&quot;</code>,<code>&quot;cronjobs&quot;</code></li>
</ul>
</blockquote>
<ul>
<li>1.3 <code>verbs:</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯¹èµ„æºå¯¹è±¡çš„æ“ä½œæ–¹æ³•åˆ—è¡¨ï¼Œ<!-- raw HTML omitted --><code>&quot;get&quot;</code>,<code> &quot;list&quot;</code>,<code> &quot;watch&quot;</code>,<code> &quot;create&quot;</code>,<code> &quot;update&quot;</code>,<code> &quot;patch&quot;</code>, <code>&quot;delete&quot;</code>,<code>&quot;exec&quot;</code></li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-role</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]  	<span style="color:#75715e"># æ”¯æŒçš„APIç»„åˆ—è¡¨ï¼Œ&#34;&#34;ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ ¸å¿ƒAPIç¾¤</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;pods&#34;</span>]  	<span style="color:#75715e"># æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>,<span style="color:#e6db74">&#34;watch&#34;</span>,<span style="color:#e6db74">&#34;list&#34;</span>]</span></span></code></pre></div></blockquote>
<hr>
<h5 id="rolebindingæ™®é€šè§’è‰²ç»‘å®š"><code>RoleBinding</code>(æ™®é€šè§’è‰²ç»‘å®š)</h5>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è§’è‰²ç»‘å®šç”¨æ¥æŠŠä¸€ä¸ªè§’è‰²ç»‘å®šåˆ°ä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¸Šï¼Œç»‘å®šç›®æ ‡å¯ä»¥æ˜¯<!-- raw HTML omitted --><code>User</code>ã€<code>Group</code>æˆ–è€…<code>ServiceAccount</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>RoleBinding</code>å¯ä»¥å°†åŒä¸€<code>namespace</code>ä¸­çš„<code>subject</code>å¯¹è±¡ç»‘å®šåˆ°æŸä¸ª<code>Role</code>ä¸‹ï¼Œåˆ™æ­¤<code>Subject</code>å…·æœ‰è¯¥<code>Role</code>å®šä¹‰çš„æƒé™</li>
<li><code>subjects:</code><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
<li><code>roleRef:</code><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">RoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-role-binding</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">User  	# Userï¼ŒGroupï¼ŒServiceAccoun  </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">user-name</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io  </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-role</span></span></span></code></pre></div></blockquote>
<hr>
<h5 id="clusterroleé›†ç¾¤è§’è‰²"><code>ClusterRole</code>(é›†ç¾¤è§’è‰²)</h5>
<ul>
<li>
<ol>
<li><code>ClusterRole</code><!-- raw HTML omitted -->å¯ä»¥å¯¹é›†ç¾¤èŒƒå›´å†…çš„èµ„æºã€è·¨<code>namespace</code>çš„èŒƒå›´èµ„æºã€éèµ„æºç±»å‹è¿›è¡Œæˆæƒ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span> <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-clusterrole</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]  	<span style="color:#75715e"># æ”¯æŒçš„APIç»„åˆ—è¡¨ï¼Œ&#34;&#34;ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ ¸å¿ƒAPIç¾¤</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;pods&#34;</span>]  	<span style="color:#75715e"># æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>,<span style="color:#e6db74">&#34;watch&#34;</span>,<span style="color:#e6db74">&#34;list&#34;</span>]</span></span></code></pre></div></blockquote>
<hr>
<h5 id="clusterrolebindingé›†ç¾¤è§’è‰²ç»‘å®š"><code>ClusterRoleBinding</code>(é›†ç¾¤è§’è‰²ç»‘å®š)</h5>
<blockquote>
<ul>
<li><code>ClusterRoleBinding</code>åœ¨æ•´ä¸ªé›†ç¾¤çº§åˆ«å’Œæ‰€æœ‰<code>namespaces</code>å°†ç‰¹å®šçš„<code>subject</code>ä¸<code>ClusterRole</code>ç»‘å®šï¼Œæˆäºˆæƒé™</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-clusterrole-binding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:  <span style="color:#75715e"># åº”ç”¨ä»€ä¹ˆç±»å‹çš„ä¸»ä½“  </span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">User  	# Userï¼ŒGroupï¼ŒServiceAccoun </span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">user-name  	# å¯¹åº”çš„åå­—</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:  	<span style="color:#75715e"># è§’è‰²ç»‘å®š </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io  	# å¯¹åº”çš„Apiåˆ†ç»„  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole  	# è§’è‰²ç±»å‹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-clusterrole</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="å‡†å…¥æ§åˆ¶">å‡†å…¥æ§åˆ¶</h4>
<ul>
<li>
<ol>
<li>é€šè¿‡äº†å‰é¢çš„è®¤è¯å’Œæˆæƒä¹‹åï¼Œè¿˜éœ€è¦ç»è¿‡å‡†å…¥æ§åˆ¶é€šè¿‡ä¹‹åï¼Œ<code>API Server</code>æ‰ä¼šå¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li>å‡†å…¥æ§åˆ¶æ˜¯ä¸€ä¸ªå¯é…ç½®çš„æ§åˆ¶å™¨åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡åœ¨<code>API Server</code>ä¸Šé€šè¿‡å‘½ä»¤è¡Œè®¾ç½®é€‰æ‹©æ‰§è¡Œå“ªäº›æ³¨å…¥æ§åˆ¶å™¨ã€‚</li>
</ol>
</li>
<li>
<ol start="3">
<li>åªæœ‰å½“æ‰€æœ‰çš„æ³¨å…¥æ§åˆ¶å™¨éƒ½æ£€æŸ¥é€šè¿‡ä¹‹åï¼Œ<code>API Server</code>æ‰ä¼šæ‰§è¡Œè¯¥è¯·æ±‚ï¼Œå¦åˆ™è¿”å›æ‹’ç»ã€‚</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds</span></span></code></pre></div></blockquote>
<hr>
<h5 id="admission-controlfont-colorredå‡†å…¥æ§åˆ¶font"><code>Admission Control</code><!-- raw HTML omitted -->(å‡†å…¥æ§åˆ¶)<!-- raw HTML omitted --></h5>
<blockquote>
<ul>
<li><code>AlwaysAdmit</code><!-- raw HTML omitted -->ï¼šå…è®¸æ‰€æœ‰è¯·æ±‚<!-- raw HTML omitted --></li>
<li><code>AlwaysDeny</code><!-- raw HTML omitted -->ï¼šç¦æ­¢æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•<!-- raw HTML omitted --></li>
<li><code>AlwaysPullImages</code><!-- raw HTML omitted -->ï¼šåœ¨å¯åŠ¨å®¹å™¨ä¹‹å‰æ€»å»ä¸‹è½½é•œåƒ<!-- raw HTML omitted --></li>
<li><code>DenyExecOnPrivileged</code>ï¼šå®ƒä¼šæ‹¦æˆªæ‰€æœ‰æƒ³åœ¨<code>Privileged Container</code>ä¸Šæ‰§è¡Œå‘½ä»¤çš„è¯·æ±‚</li>
<li><code>ImagePolicyWebhook</code>ï¼šè¿™ä¸ªæ’ä»¶å°†å…è®¸åç«¯çš„ä¸€ä¸ª<code>Webhook</code>ç¨‹åºæ¥å®Œæˆ<code>admission controller</code>çš„åŠŸèƒ½</li>
<li><code>Service Account</code>ï¼šå®ç°<code>ServiceAccount</code>å®ç°äº†è‡ªåŠ¨åŒ–</li>
<li><code>SecurityContextDeny</code>ï¼šè¿™ä¸ªæ’ä»¶å°†ä½¿ç”¨<code>SecurityContext</code>çš„<code>Pod</code>ä¸­çš„å®šä¹‰å…¨éƒ¨å¤±æ•ˆ</li>
<li><code>ResourceQuota</code>ï¼šç”¨äºèµ„æºé…é¢ç®¡ç†ç›®çš„ï¼Œè§‚å¯Ÿæ‰€æœ‰è¯·æ±‚ï¼Œç¡®ä¿åœ¨<code>namespace</code>ä¸Šçš„é…é¢ä¸ä¼šè¶…æ ‡</li>
<li><code>LimitRanger</code>ï¼šç”¨äºèµ„æºé™åˆ¶ç®¡ç†ï¼Œä½œç”¨äº<code>namespace</code>ä¸Šï¼Œç¡®ä¿å¯¹<code>Pod</code>è¿›è¡Œèµ„æºé™åˆ¶</li>
<li><code>InitialResources</code>ï¼šä¸ºæœªè®¾ç½®èµ„æºè¯·æ±‚ä¸é™åˆ¶çš„<code>Pod</code>ï¼Œæ ¹æ®å…¶é•œåƒçš„å†å²èµ„æºçš„ä½¿ç”¨æƒ…å†µè¿›è¡Œè®¾ç½®</li>
<li><code>NamespaceLifecycle</code>ï¼šå¦‚æœå°è¯•åœ¨ä¸€ä¸ªä¸å­˜åœ¨çš„<code>namespace</code>ä¸­åˆ›å»ºèµ„æºå¯¹è±¡ï¼Œåˆ™è¯¥åˆ›å»ºè¯·æ±‚å°†è¢«æ‹’ ç»ã€‚å½“åˆ é™¤ä¸€ä¸ª<code>namespace</code>æ—¶ï¼Œç³»ç»Ÿå°†ä¼šåˆ é™¤è¯¥<code>namespace</code>ä¸­æ‰€æœ‰å¯¹è±¡</li>
<li><code>DefaultStorageClass</code>ï¼šä¸ºäº†å®ç°å…±äº«å­˜å‚¨çš„åŠ¨æ€ä¾›åº”ï¼Œä¸ºæœªæŒ‡å®š<code>StorageClass</code>æˆ–<code>PV</code>çš„<code>PVC</code>å°è¯•åŒ¹é…é»˜è®¤<code>StorageClass</code>ï¼Œå°½å¯èƒ½å‡å°‘ç”¨æˆ·åœ¨ç”³è¯·<code>PVC</code>æ—¶æ‰€éœ€äº†è§£çš„åç«¯å­˜å‚¨ç»†èŠ‚</li>
<li><code>DefaultTolerationSeconds</code>ï¼šè¿™ä¸ªæ’ä»¶ä¸ºé‚£äº›æ²¡æœ‰è®¾ç½®<code>forgiveness tolerations</code>å¹¶å…·æœ‰<code>notready:NoExecute</code>å’Œ<code>unreachable:NoExecute</code>ä¸¤ç§<code>taints</code>çš„<code>Pod</code>è®¾ç½®é»˜è®¤çš„<code>â€œå®¹å¿â€</code>æ—¶é—´ï¼Œä¸º<code>5min</code></li>
<li><code>PodSecurityPolicy</code>ï¼šè¿™ä¸ªæ’ä»¶ç”¨äºåœ¨åˆ›å»ºæˆ–ä¿®æ”¹Podæ—¶å†³å®šæ˜¯å¦æ ¹æ®<code>Pod</code>çš„<code>security context</code>å’Œå¯ç”¨çš„<code>PodSecurityPolicy</code>å¯¹<code>Pod</code>çš„å®‰å…¨ç­–ç•¥è¿›è¡Œæ§åˆ¶</li>
</ul>
</blockquote>
<hr>
<h3 id="rbacå®æˆ˜"><code>RBAC</code>å®æˆ˜</h3>
<ul>
<li>
<ol>
<li>åˆ›å»ºä¸€ä¸ªåªèƒ½ç®¡ç†<code>dev</code>å‘½åç©ºé—´ä¸‹<code>Pods</code>èµ„æºçš„è´¦å·ã€‚</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»ºå¯†é’¥<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /etc/kubernetes/pki/
</span></span><span style="display:flex;"><span>$ <span style="color:#f92672">(</span>umask 077;openssl genrsa -out user-name.key 2048<span style="color:#f92672">)</span></span></span></code></pre></div><ul>
<li>ç”¨<code>API Server</code>çš„å¯†é’¥å»ç­¾ç½²è¯ä¹¦</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è¯ä¹¦ç”³è¯·ï¼š<!-- raw HTML omitted -->ç”³è¯·çš„ç”¨æˆ·æ˜¯<code>user-name</code>ï¼Œç»„æ˜¯<code>group-name</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl req -new -key user-name.key -out user-name.csr -subj <span style="color:#e6db74">&#34;/CN=user-name/O=group-name&#34;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç­¾ç½²è¯ä¹¦<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl x509 -req -in user-name.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out user-name.crt -days <span style="color:#ae81ff">3650</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl config set-cluster kubernetes --embed-certs<span style="color:#f92672">=</span>true --certificate-authority<span style="color:#f92672">=</span>/etc/kubernetes/pki/ca.crt --server<span style="color:#f92672">=</span>https://192.168.18.100:6443
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-credentials user-name --embed-certs<span style="color:#f92672">=</span>true --client-certificate<span style="color:#f92672">=</span>/etc/kubernetes/pki/user-name.crt --client-key<span style="color:#f92672">=</span>/etc/kubernetes/pki/user-name.key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kubectl config set-context user-name@kubernetes --cluster<span style="color:#f92672">=</span>kubernetes --user<span style="color:#f92672">=</span>user-name</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æµ‹è¯•è´¦æˆ·ã€åˆ‡æ¢<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ‡æ¢è´¦å·åˆ°<!-- raw HTML omitted --><code>user-name</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl config use-context user-name@kubernetes</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<code>default</code>ä¸‹çš„<code>Pod</code>ï¼Œå‘ç°æ²¡æœ‰æƒé™ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get pods -n default</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ‡æ¢åˆ°<code>admin</code>è´¦æˆ·ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl config use-context kubernetes-admin@kubernetes</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="rolebindingfont-colorredå¼•ç”¨fontclusterrolefont-colorredè¿›è¡Œæˆæƒfont"><code>RoleBinding</code><!-- raw HTML omitted -->å¼•ç”¨<!-- raw HTML omitted --><code>ClusterRole</code><!-- raw HTML omitted -->è¿›è¡Œæˆæƒ<!-- raw HTML omitted --></h4>
<ul>
<li>
<ol>
<li><code>RoleBinding</code>(è§’è‰²ç»‘å®š)å¯ä»¥å¼•ç”¨<code>ClusterRole</code>(é›†ç¾¤è§’è‰²)ï¼Œå¯¹å±äºåŒä¸€å‘½åç©ºé—´å†…<code>ClusterRole</code>å®šä¹‰çš„èµ„æºä¸»ä½“è¿›è¡Œæˆæƒã€‚</li>
</ol>
</li>
<li>
<ol start="2">
<li>ä¸€ç§å¾ˆå¸¸ç”¨çš„åšæ³•æ˜¯ï¼Œé›†ç¾¤ç®¡ç†å‘˜ä¸ºé›†ç¾¤èŒƒå›´é¢„å®šä¹‰å¥½ä¸€ç»„è§’è‰²<code>ClusterRole</code>ï¼Œç„¶ååœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­é‡å¤ä½¿ç”¨è¿™äº›<code>ClusterRole</code>ã€‚è¿™æ ·å¯ä»¥å¤§å¹…åº¦æé«˜æˆæƒç®¡ç†å·¥ä½œæ•ˆç‡ï¼Œä¹Ÿä½¿å¾—å„ä¸ªå‘½åç©ºé—´ä¸‹çš„åŸºç¡€æ€§æˆæƒè§„åˆ™å’Œä½¿ç”¨ä½“éªŒä¿æŒä¸€è‡´ã€‚</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>è™½ç„¶<code>authorization-clusterrole</code>æ˜¯ä¸€ä¸ªé›†ç¾¤è§’è‰²ï¼Œä½†æ˜¯å› ä¸ºä½¿ç”¨äº†<code>RoleBinding</code>ï¼Œæ‰€ä»¥<code>xudaxian</code>åªèƒ½è¯»å–<code>default</code>å‘½åç©ºé—´ä¸­çš„èµ„æº</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">RoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-clusterrole-binding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">xudaxian</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">User</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-clusterrole</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="font-colorredåˆ›å»ºfontrolefont-colorredå’Œfontrolebindingfont-colorredä¸ºfontuser-namefont-colorredæˆæƒfont"><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>Role</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>RoleBinding</code><!-- raw HTML omitted -->ï¼Œä¸º<!-- raw HTML omitted --><code>user-name</code><!-- raw HTML omitted -->æˆæƒ<!-- raw HTML omitted --></h4>
<ul>
<li>
<ol>
<li>åˆ›å»º<code>dev-role.yaml</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dev-role</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]  	<span style="color:#75715e"># æ”¯æŒçš„APIç»„åˆ—è¡¨ï¼Œ&#34;&#34;ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ ¸å¿ƒAPIç¾¤</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;pods&#34;</span>]  	<span style="color:#75715e"># æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>,<span style="color:#e6db74">&#34;watch&#34;</span>,<span style="color:#e6db74">&#34;list&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">RoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authorization-role-binding </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">User</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">user-name</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role </span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dev-role</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>åˆ›å»º<code>Role</code>å’Œ<code>RoleBinding</code>ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl create -f dev-role.yaml</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li>åˆ‡æ¢è´¦æˆ·åˆ°<code>user-name</code>ç”¨æˆ·ï¼Œå†æ¬¡éªŒè¯ï¼š</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl config use-context user-name@kubernetes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†æ¬¡æŸ¥çœ‹ï¼š</span>
</span></span><span style="display:flex;"><span>$ kubectl get pod -n default
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ‡å›adminè´¦æˆ·ï¼š</span>
</span></span><span style="display:flex;"><span>$ kubectl config use-context kubernetes-admin@kubernetes</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="ldap">LDAP</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of LDAP</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="config_openldap">Config_OpenLDAP</h1>


            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_kerberos">Install_Kerberos</h1>

<h2 id="kerberos"><code>Kerberos</code></h2>
<blockquote>
<ul>
<li><a href="https://www.thegeekdiary.com/how-to-install-and-configure-kerberos-in-centos-rhel-7/" rel="external" target="_self">å¦‚ä½•åœ¨<code>CentOS/RHEL 7</code>ä¸­å®‰è£…å’Œé…ç½®<code>Kerberos</code></a></li>
</ul>
</blockquote>
<hr>
<h3 id="å®‰è£…kerberos">å®‰è£…<code>Kerberos</code></h3>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_openldap">Install_OpenLDAP</h1>

<h2 id="openldap"><code>OpenLDAP</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://hebye.com/docs/ldap/ldap-1d97mtl9ifh1c" rel="external" target="_self"><code>OpenLDAP</code>çš„å®‰è£…ä¸é…ç½®</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/ibv/LDAP-Admin" rel="external" target="_self"><code>LDAP Admin for Linux</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://directory.apache.org/studio/" rel="external" target="_self"><code>Apache Directory Studio</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/uroesch/LdapAdminPortable/tags" rel="external" target="_self"><code>LDAP Admin for PortableApps.com</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.ldap-account-manager.org/lamcms/" rel="external" target="_self"><code>LDAP Account Manager</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/woshimrf/p/ldap.html" rel="external" target="_self"><code>openldap</code>ä»‹ç»å’Œä½¿ç”¨</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://zhuanlan.zhihu.com/p/32732045" rel="external" target="_self"><code>LDAP</code>åŸºç¡€å­¦ä¹ ç¬”è®°</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.jianshu.com/p/243ff61b0552" rel="external" target="_self"><code>OpenLDAP</code>å®‰è£…ä½¿ç”¨åŠä¸å„ç³»ç»Ÿçš„é›†æˆ</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.ibm.com/docs/zh/samfess/8.2.2?topic=reports-creating-users-in-ldap" rel="external" target="_self">åœ¨<code>LDAP</code>ä¸­åˆ›å»ºç”¨æˆ·</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="openldapå®‰è£…"><code>OpenLDAP</code>å®‰è£…</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Openldap</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install openldap-servers openldap-clients -y</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŠŠ<!-- raw HTML omitted --><code>/etc/openldap/</code><!-- raw HTML omitted -->ç›®å½•ä¸‹<!-- raw HTML omitted --><code>slapd.d</code><!-- raw HTML omitted -->é»˜è®¤æ–‡ä»¶å¤¹å¤‡ä»½<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /etc/openldap/
</span></span><span style="display:flex;"><span>$ cp -r slapd.d<span style="color:#f92672">{</span>,.bak<span style="color:#f92672">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç”ŸæˆåŠ å¯†å¯†é’¥<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ slappasswd
</span></span><span style="display:flex;"><span>New password: 
</span></span><span style="display:flex;"><span>Re-enter new password: 
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>SSHA<span style="color:#f92672">}</span>2OhbHFHD0Lx1JUS7IsQZnHlS65tKlAvf</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ‹·è´ã€ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp /usr/share/openldap-servers/slapd.ldif /etc/openldap/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ŒæŠŠä¸­æ–‡æ³¨é‡Šè¡Œéƒ½åˆ é™¤</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/openldap/slapd.ldif<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcGlobal
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cn: config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcArgsFile: /var/run/openldap/slapd.args
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcPidFile: /var/run/openldap/slapd.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcTLSCACertificatePath: /etc/openldap/certs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcTLSCertificateFile: &#34;OpenLDAP Server&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcTLSCertificateKeyFile: /etc/openldap/certs/password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: cn=schema,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcSchemaConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cn: schema
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ·»åŠ /etc/openldap/schema/ ç›®å½•ä¸‹å±æ€§ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/core.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/collective.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/corba.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/cosine.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/duaconf.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/dyngroup.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/inetorgperson.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/java.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/misc.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/nis.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/openldap.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/pmi.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include: file:///etc/openldap/schema/ppolicy.ldif
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase=frontend,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcDatabaseConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcFrontendConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDatabase: frontend
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase=config,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcDatabaseConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDatabase: config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcAccess: to * by dn.base=&#34;gidNumber=0+uidNumber=0,cn=peercred,cn=external,c
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> n=auth&#34; manage by * none
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase=monitor,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcDatabaseConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDatabase: monitor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># dc=my-domain ä¿®æ”¹ä¸ºå®šä¹‰åŸŸå
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcAccess: to * by dn.base=&#34;gidNumber=0+uidNumber=0,cn=peercred,cn=external,c
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> n=auth&#34; read by dn.base=&#34;cn=Manager,dc=ladp.erge,dc=com&#34; read by * none
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase=hdb,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcDatabaseConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectClass: olcHdbConfig
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDatabase: hdb
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># my-domain ä¿®æ”¹ä¸ºå®šä¹‰åŸŸå
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcSuffix: dc=ladp.erge,dc=com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcRootDN: cn=Manager,dc=ladp.erge,dc=com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># olcRootPW ä¸ºæ–°å¢å­—æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcRootPW: {SSHA}2OhbHFHD0Lx1JUS7IsQZnHlS65tKlAvf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDbDirectory:	/var/lib/ldap
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDbIndex: objectClass eq,pres
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDbIndex: ou,cn,mail,surname,givenname eq,pres,sub
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç”Ÿæˆä¸»é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>-n 0</code><!-- raw HTML omitted -->æŒ‡å®š<code>0</code>å·æ•°æ®åº“<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>-F slapd.d</code><!-- raw HTML omitted -->æŒ‡å®šç”Ÿæˆçš„ç›®å½•<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>-l slapd.ldif</code><!-- raw HTML omitted -->æŒ‡å®šä½¿ç”¨é‚£ä¸ªæ–‡ä»¶ç”Ÿæˆ<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ slapadd -n <span style="color:#ae81ff">0</span> -F slapd.d -l slapd.ldif  	<span style="color:#75715e"># è¿”å›ä»¥ä¸‹ï¼š100.00% ä»£è¡¨æˆåŠŸï¼Œå¦‚æœæŠ¥é”™æ˜¯ï¼šslapd.ldif é…ç½®æ–‡ä»¶é—®é¢˜</span>
</span></span><span style="display:flex;"><span>_#################### 100.00% eta   none elapsed            none fast!
</span></span><span style="display:flex;"><span>Closing DB...</span></span></code></pre></div></li>
<li>
<p><!-- raw HTML omitted -->ä¿®æ”¹æƒé™<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chown -R ldap:ldap /etc/openldap/slapd.d
</span></span><span style="display:flex;"><span>$ chown -R ldap:ldap /var/lib/ldap/ </span></span></code></pre></div></li>
<li>
<p><!-- raw HTML omitted -->æ‹·è´æ•°æ®åº“é»˜è®¤é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span></span></code></pre></div></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start slapd <span style="color:#f92672">&amp;&amp;</span> systemctl enable slapd</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®åŸºæœ¬åŸŸ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/openldap/config_init.ldif<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># dn æ¡ç›®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: dc=ladp.erge,dc=com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¯¹è±¡ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectclass: dcObject
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">objectclass: organization
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç»„ç»‡åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">o: aishangwei
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># dc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dc: ladp.erge
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ·»åŠ åŸºæœ¬åŸŸ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ç³»ç»Ÿä¼šæç¤ºæ‚¨è¾“å…¥<code>LDAP</code>å¯†ç ã€‚ è¾“å…¥æ‚¨ä¸º<code>LDAP root</code>ç”¨æˆ·å®šä¹‰çš„çº¯æ–‡æœ¬å¯†ç </li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ldapadd -x -D <span style="color:#e6db74">&#34;cn=Manager,dc=ldap.erge,dc=com&#34;</span> -W -f /etc/openldap/config_init.ldif</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥è¯¢åŸŸ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ldapsearch -x -b <span style="color:#e6db74">&#39;dc=ldap.erge,dc=com&#39;</span>   <span style="color:#e6db74">&#39;(objectClass=*)&#39;</span>
</span></span><span style="display:flex;"><span>$ ldapsearch -H ldapi:/// -Y EXTERNAL -b <span style="color:#e6db74">&#34;cn=config&#34;</span> -LLL â€“Q
</span></span><span style="display:flex;"><span>$ ldapsearch -h 192.168.88.110 -b <span style="color:#e6db74">&#34;dc=ladp.erge,dc=com&#34;</span> -D <span style="color:#e6db74">&#34;cn=Manager,dc=erge,dc=com&#34;</span> -W |grep dn</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å–æ¶ˆåŒ¿åç™»å½•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>openldap</code>åœ¨åŒ¿åæƒ…å†µä¸‹æ˜¯å¯ä»¥è¢«è®¿é—®çš„ã€‚è€Œä¸”<code>openldap</code>çš„ç›¸å…³ä¿¡æ¯ï¼Œé™¤äº†ç”¨æˆ·çš„å¯†ç ä¿¡æ¯ä¹‹å¤–ï¼Œå…¶ä»–<code>openldap</code>çš„ä¿¡æ¯å®Œå…¨è¢«å‘ˆç°å‡ºæ¥ã€‚</p>
</li>
<li>
<p>ä»å®‰å…¨çš„è§’åº¦è€ƒè™‘ï¼Œè¿™ç§æƒ…å†µæ˜¯ä¸è¢«å…è®¸çš„ï¼Œæ‰€ä»¥è¦å–æ¶ˆ<code>openldap</code>çš„åŒ¿åè®¿é—®åŠŸèƒ½ã€‚</p>
</li>
<li>
<p>è¦å–æ¶ˆ<code>openldap</code>çš„åŒ¿åè®¿é—®åŠŸèƒ½ï¼Œæ“ä½œæ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€å•ã€‚æˆ‘ä»¬åªéœ€è¦æŠŠä»¥ä¸‹<code>openldap</code>ä¿¡æ¯å¯¼å…¥<code>openldap</code>ä¸­å³å¯ï¼Œè€Œä¸”æ˜¯æ— éœ€é‡å¯<code>openldap</code>æœåŠ¡å³æ—¶ç”Ÿæ•ˆçš„ã€‚</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/openldap/disable_anon.ldif<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">changetype: modify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">add: olcDisallows
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcDisallows: bind_anon
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">changetype: modify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">add: olcRequires
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcRequires: authc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase={-1}frontend,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">changetype: modify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">add: olcRequires
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcRequires: authc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/disable_anon.ldif
</span></span><span style="display:flex;"><span>SASL/EXTERNAL authentication started
</span></span><span style="display:flex;"><span>SASL username: gidNumber<span style="color:#f92672">=</span>0+uidNumber<span style="color:#f92672">=</span>0,cn<span style="color:#f92672">=</span>peercred,cn<span style="color:#f92672">=</span>external,cn<span style="color:#f92672">=</span>auth
</span></span><span style="display:flex;"><span>SASL SSF: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>modifying entry <span style="color:#e6db74">&#34;cn=config&#34;</span>
</span></span><span style="display:flex;"><span>modifying entry <span style="color:#e6db74">&#34;cn=config&#34;</span>
</span></span><span style="display:flex;"><span>modifying entry <span style="color:#e6db74">&#34;olcDatabase={-1}frontend,cn=config&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat /etc/openldap/slapd.d/cn<span style="color:#ae81ff">\=</span>config.ldif
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AUTO-GENERATED FILE - DO NOT EDIT!! Use ldapmodify.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CRC32 af9dbdcd</span>
</span></span><span style="display:flex;"><span>dn: cn<span style="color:#f92672">=</span>config
</span></span><span style="display:flex;"><span>objectClass: olcGlobal
</span></span><span style="display:flex;"><span>cn: config
</span></span><span style="display:flex;"><span>olcArgsFile: /var/run/openldap/slapd.args
</span></span><span style="display:flex;"><span>olcPidFile: /var/run/openldap/slapd.pid
</span></span><span style="display:flex;"><span>olcTLSCACertificatePath: /etc/openldap/certs
</span></span><span style="display:flex;"><span>olcTLSCertificateFile: <span style="color:#e6db74">&#34;OpenLDAP Server&#34;</span>
</span></span><span style="display:flex;"><span>olcTLSCertificateKeyFile: /etc/openldap/certs/password
</span></span><span style="display:flex;"><span>structuralObjectClass: olcGlobal
</span></span><span style="display:flex;"><span>entryUUID: 7b515fd2-ab06-103b-8cdb-d13498ff4586
</span></span><span style="display:flex;"><span>creatorsName: cn<span style="color:#f92672">=</span>config
</span></span><span style="display:flex;"><span>createTimestamp: 20210916065302Z
</span></span><span style="display:flex;"><span>olcDisallows: bind_anon
</span></span><span style="display:flex;"><span>olcRequires: authc   //å–æ¶ˆåŒ¿åç”¨æˆ·ç™»å½•
</span></span><span style="display:flex;"><span>entryCSN: 20210916072755.667534Z#000000#000#000000
</span></span><span style="display:flex;"><span>modifiersName: gidNumber<span style="color:#f92672">=</span>0+uidNumber<span style="color:#f92672">=</span>0,cn<span style="color:#f92672">=</span>peercred,cn<span style="color:#f92672">=</span>external,cn<span style="color:#f92672">=</span>auth
</span></span><span style="display:flex;"><span>modifyTimestamp: 20210916072755Z</span></span></code></pre></div></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å¼€å¯<!-- raw HTML omitted --><code>Openldap</code><!-- raw HTML omitted -->æ—¥å¿—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/openldap/loglevel.ldif<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">changetype: modify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">replace: olcLogLevel
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcLogLevel: stats
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ldapmodify -Y EXTERNAL -H ldapi:/// -f /etc/openldap/loglevel.ldif
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;/etc/rsyslog.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">local4.* /var/log/slapd.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl restart rsyslog
</span></span><span style="display:flex;"><span>$ systemctl restart slapd</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å…è®¸æ™®é€šç”¨æˆ·ä¿®æ”¹è‡ªå·±çš„å¯†ç <!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/openldap/updatepass.ldif<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase={2}hdb,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">changetype: modify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">add: olcAccess
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcAccess: to attrs=userPassword
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     by self =xw
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     by anonymous auth
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     by * none
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcAccess: to *
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     by self write
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     by users read
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     by * none
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ldapmodify -Y EXTERNAL -H ldapi:/// -f /etc/openldap/updatepass.ldif</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Openldap</code><!-- raw HTML omitted -->ç®¡ç†å‘˜å¯†ç <!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 1. æŸ¥çœ‹openldapç®¡ç†å‘˜å¯†ç å­—æ®µæ”¾åœ¨å“ªä¸ªé…ç½®æ–‡ä»¶ä¸­</span>
</span></span><span style="display:flex;"><span>$ ldapsearch -H ldapi:// -LLL -Q -Y EXTERNAL -b <span style="color:#e6db74">&#34;cn=config&#34;</span> <span style="color:#e6db74">&#34;(olcRootDN=*)&#34;</span> dn olcRootDN olcRootPW
</span></span><span style="display:flex;"><span>dn: olcDatabase<span style="color:#f92672">={</span>2<span style="color:#f92672">}</span>hdb,cn<span style="color:#f92672">=</span>config
</span></span><span style="display:flex;"><span>olcRootDN: cn<span style="color:#f92672">=</span>admin,dc<span style="color:#f92672">=</span>hebye,dc<span style="color:#f92672">=</span>com
</span></span><span style="display:flex;"><span>olcRootPW: <span style="color:#f92672">{</span>SSHA<span style="color:#f92672">}</span>Z9XXRjQYHbjYXuOvXPgR/g+HRBoNmj/u
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. è®¾ç½®openldapç®¡ç†å‘˜æœ€æ–°çš„å¯†ç </span>
</span></span><span style="display:flex;"><span>$ slappasswd -s password
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. ç”Ÿæˆä¿®æ”¹openldapç®¡ç†å‘˜å¯†ç çš„ldifæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/root/newpasswd.ldif<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dn: olcDatabase={2}hdb,cn=config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">changetype: modify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">replace: olcRootPW
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">olcRootPW: {SSHA}YB8N9nZg9qKisiW/Xp6NVPeqhE66mQOB
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4. å¯¼å…¥æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ ldapmodify -H ldapi:// -Y EXTERNAL -f /root/newpasswd.ldif
</span></span><span style="display:flex;"><span>SASL/EXTERNAL authentication started
</span></span><span style="display:flex;"><span>SASL username: gidNumber<span style="color:#f92672">=</span>0+uidNumber<span style="color:#f92672">=</span>0,cn<span style="color:#f92672">=</span>peercred,cn<span style="color:#f92672">=</span>external,cn<span style="color:#f92672">=</span>auth
</span></span><span style="display:flex;"><span>SASL SSF: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>modifying entry <span style="color:#e6db74">&#34;olcDatabase={2}hdb,cn=config&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 5. ä¸Šè¿°å‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œopenldapçš„ç®¡ç†å‘˜å¯†ç å°±å·²ç»è¢«ä¿®æ”¹æ‰äº†</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="logs">Logs</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Logs</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_logrotate">Use_Logrotate</h1>

<h2 id="logrotateæ—¥å¿—åˆ‡å‰²"><code>logrotate</code>æ—¥å¿—åˆ‡å‰²</h2>
<blockquote>
<ul>
<li><code>man logrotate</code><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>logrodate</code><!-- raw HTML omitted -->ä½¿ç”¨è¯¦æƒ…<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¦‚æœæ—¥å¿—åˆ‡å‰²åœ¨ï¼š<!-- raw HTML omitted --><code>/usr</code>, <code>boot</code>, <code>/etc</code>, <code>efi</code><!-- raw HTML omitted -->ç­‰ç›®å½•ä¸‹æ—¶ï¼Œä¼šæç¤ºï¼š<!-- raw HTML omitted --><code>error: error opening /usr/local/nginx/logs/nginx.log: Read-only file system</code><!-- raw HTML omitted -->è¿™æ˜¯å› ä¸ºå¯åŠ¨æ–‡ä»¶é…ç½®ï¼š<!-- raw HTML omitted --><code>ProtectSystem=full</code></li>
</ul>
<blockquote>
<ul>
<li>ä¿®æ”¹<code>/lib/systemd/system/logrotate.service</code>é…ç½®æ–‡ä»¶</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl status logrotate.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/lib/systemd/system/logrotate.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ReadWritePaths=/usr/local/nginx/logs  	# æ–‡ä»¶æœ«å°¾æ·»åŠ æ­¤è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload 
</span></span><span style="display:flex;"><span>$ systemctl restart logrotate.service</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="é…ç½®nginxæ—¥å¿—åˆ‡å‰²">é…ç½®<code>Nginx</code>æ—¥å¿—åˆ‡å‰²</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://blog.csdn.net/weixin_45203131/article/details/113186186" rel="external" target="_self"><code>centos7 logrotate</code>æ—¥å¿—åˆ‡å‰²</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/diantong/p/10717926.html" rel="external" target="_self"><code>CentOS</code>ä¸‹ä½¿ç”¨<code>Logrotate</code>æ—¥å¿—åˆ‡å‰²</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://bypass007.github.io/Emergency-Response-Notes/" rel="external" target="_self"><code>Logs</code>æ—¥å¿—åˆ†ææ’æŸ¥<code>GitBook</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/Bypass007/Emergency-Response-Notes" rel="external" target="_self"><code>Logs</code>æ—¥å¿—åˆ†ææ’æŸ¥<code>Github</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/kevingrace/p/6307298.html" rel="external" target="_self">æ—¥å¿—åˆ‡å‰²æ–¹æ³•å°ç»“<code>Logrotateã€pythonã€shell</code>è„šæœ¬å®ç° </a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ man logrotate
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–°å¢nginx log æ¯æ—¥åˆ‡å‰²</span>
</span></span><span style="display:flex;"><span>$ grep <span style="color:#e6db74">&#34;nginx&#34;</span> /etc/logrotate.d/nginx  &amp;&gt;/dev/null  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/logrotate.d/nginx<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;/opt/apps/nginx/logs/*.jsonl&#34; /opt/apps/nginx/logs/*.log{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">daily  	# å®‰æ—¥æœŸè½®è½¬æ—¥å¿—ï¼šhourly(å°æ—¶)ã€daily(å¤©)ã€weekly(æœˆ)ã€monthly(æœˆ)ã€yearly(å¹´)ï¼Œå¦‚æœè®¾ç½®(size)åˆ™ä¸ç”¨è¯¥å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dateext  	# æ–‡ä»¶åç¼€æ˜¯æ—¥æœŸæ ¼å¼,ä¹Ÿå°±æ˜¯åˆ‡å‰²åæ–‡ä»¶æ˜¯:xxx.log-20150828ï¼Œè¯¥è®¾ç½®å¯èƒ½å’Œå¤§å°åˆ‡å‰²å†²çªï¼Œè¯¥è®¾ç½®æŒ‰æ—¥æœŸç”Ÿæˆ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">size 100k	# åœ¨æ—¥å¿—å¤§å°å¤§äº logsizeï¼ˆä¾‹å¦‚ 100Kï¼Œ100Mï¼Œ100Gï¼‰æ—¶è½®æ¢ã€minsizeã€maxsizeï¼Œè¯¥é€‰é¡¹ä¸æ—¥æœŸè®¾ç½®æ˜¯äº’æ–¥çš„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rotate 15  	# æŒ‡å®šæ—¥å¿—æ–‡ä»¶åˆ é™¤ä¹‹å‰è½¬å‚¨çš„æ¬¡æ•°ï¼Œ0æŒ‡æ²¡æœ‰å¤‡ä»½ï¼Œ15æŒ‡ä¿ç•™15ä¸ªå¤‡ä»½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">compress  	# é€šè¿‡gzipå‹ç¼©è½¬å‚¨ä»¥åçš„æ—¥å¿—ï¼ˆgzip -d xxx.gzè§£å‹ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">missingok  	# å¦‚æœæ—¥å¿—ä¸å­˜åœ¨åˆ™å¿½ç•¥è¯¥è­¦å‘Šä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notifempty  	# å¦‚æœæ˜¯ç©ºæ–‡ä»¶çš„è¯ï¼Œä¸è½¬å‚¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">copytruncate  	# ç”¨äºè¿˜åœ¨æ‰“å¼€ä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼ŒæŠŠå½“å‰æ—¥å¿—å¤‡ä»½å¹¶æˆªæ–­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">delaycompress  	# å’Œcompressä¸€èµ·ä½¿ç”¨æ—¶ï¼Œdelaycompressé€‰é¡¹æŒ‡ç¤ºlogrotateä¸è¦å°†æœ€è¿‘çš„å½’æ¡£å‹ç¼©ï¼Œå‹ç¼©å°†åœ¨ä¸‹ä¸€æ¬¡è½®å¾ªå‘¨æœŸè¿›è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sharedscripts  	# è¿è¡Œpostrotateè„šæœ¬ï¼Œåœ¨æ‰€æœ‰æ—¥å¿—éƒ½è½®è½¬åç»Ÿä¸€æ‰§è¡Œä¸€æ¬¡è„šæœ¬ã€‚å¦‚æœæ²¡é…è¯¥é€‰é¡¹ï¼Œæ¯ä¸ªæ—¥å¿—è½®è½¬åéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡è„šæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">postrotate  	# è¿è¡Œpostrotateè„šæœ¬ï¼Œä½œç”¨æ˜¯åœ¨æ‰€æœ‰æ—¥å¿—éƒ½è½®è½¬åç»Ÿä¸€æ‰§è¡Œä¸€æ¬¡è„šæœ¬ï¼Œå¦‚é‡å¯ï¼ˆkill -HUPï¼‰æœåŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    [ -f /var/run/nginx.pid ] &amp;&amp; kill -USR1 `cat /var/run/nginx.pid`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">endscript  	# æœ€é€šå¸¸çš„ä½œç”¨æ˜¯è®©åº”ç”¨é‡å¯ï¼Œä»¥ä¾¿åˆ‡æ¢åˆ°æ–°çš„æ—¥å¿—æ–‡ä»¶, åœ¨æ‰€æœ‰å…¶å®ƒæŒ‡ä»¤å®Œæˆåï¼Œpostrotateå’Œendscripté‡Œé¢æŒ‡å®šçš„å‘½ä»¤å°†è¢«æ‰§è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œnginx è¿›ç¨‹å°†ç«‹å³å†æ¬¡è¯»å–å…¶é…ç½®å¹¶ç»§ç»­è¿è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">create 640 www root 	# ä»¥æŒ‡å®šçš„æƒé™ç”¨æˆ·å’Œç»„åˆ›å»ºå…¨æ–°çš„æ—¥å¿—æ–‡ä»¶ï¼ŒåŒæ—¶logrotateä¹Ÿä¼šé‡å‘½ååŸå§‹æ—¥å¿—æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">su root root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰‹åŠ¨è°ƒè¯•éªŒè¯ä¸æ‰§è¡Œï¼š-d</span>
</span></span><span style="display:flex;"><span>$ /usr/sbin/logrotate -d /etc/logrotate.d/nginx
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰‹åŠ¨å¼ºåˆ¶æ‰§è¡Œï¼š-f</span>
</span></span><span style="display:flex;"><span>$ /usr/sbin/logrotate -f /etc/logrotate.d/nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–°å¢åˆªé™¤7å¤©ä»¥å‰logå®šæ™‚è…³æœ¬  </span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;###nginxè¶…éä¸ƒå¤©logåˆªé™¤
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1 0 * * * /bin/bash /opt/scripts/DEL_NGINX.sh &gt;&gt; ~/del_tom.log 2&gt;&amp;1&#34;</span> &gt;&gt; /var/spool/cron/admin</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_quickwit">Install_Quickwit</h1>

<h2 id="quickwit"><code>Quickwit</code></h2>
<blockquote>
<ul>
<li><a href="https://quickwit.io/docs/" rel="external" target="_self"><code>Quickwit</code>æ—¥å¿—ç®¡ç†ã€åˆ†æ</a></li>
<li><a href="https://opentelemetry.io/docs/" rel="external" target="_self"><code>OpenTelemetry</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_logkit">Install_Logkit</h1>

<h2 id="logkit"><code>LogKit</code></h2>
<blockquote>
<ul>
<li><a href="https://github.com/qiniu/logkit" rel="external" target="_self"><code>LogKit</code></a></li>
</ul>
<blockquote>
<ul>
<li>éå¸¸å¼ºå¤§çš„æœåŠ¡å™¨ä»£ç†ï¼Œç”¨äºé€šè¿‡æ˜“äºä½¿ç”¨çš„<code>Web</code>æ§åˆ¶å°æ”¶é›†å’Œå‘é€æ—¥å¿—å’ŒæŒ‡æ ‡</li>
</ul>
</blockquote>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_graylog">Install_Graylog</h1>

<h2 id="graylogæ—¥å¿—æœåŠ¡"><code>GrayLog</code>æ—¥å¿—æœåŠ¡</h2>
<blockquote>
<ul>
<li><a href="https://docs.graylog.org/docs/operating-system-packages" rel="external" target="_self"><code>GrayLog</code></a>æ—¥å¿—æœåŠ¡</li>
<li><a href="https://testerhome.com/topics/3026" rel="external" target="_self"><code>Graylog</code>â€”æ—¥å¿—èšåˆå·¥å…·ä¸­çš„åèµ·ä¹‹ç§€</a></li>
<li><a href="https://my.oschina.net/HeAlvin/blog/378262" rel="external" target="_self">æ¨èï¼å›½å¤–ç¨‹åºå‘˜æ•´ç†çš„ç³»ç»Ÿç®¡ç†å‘˜èµ„æºå¤§å…¨</a></li>
</ul>
<blockquote>
<ul>
<li><code>Java ( &gt;= 8 )</code></li>
<li><code>MongoDB (4.0, 4.2 or 4.4)</code></li>
<li><code>Elasticsearch (6.x or 7.x)</code></li>
<li><code>GrayLog-Server</code></li>
<li><code>GrayLog-Web</code></li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="å®‰è£…graylogæ‰€éœ€æœåŠ¡">å®‰è£…<code>GrayLog</code>æ‰€éœ€æœåŠ¡</h3>
<ul>
<li>
<ol>
<li><a href="https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-red-hat/" rel="external" target="_self"><code>Mongodb</code></a>æ•°æ®åº“</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Mongodb</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>yum</code><!-- raw HTML omitted -->å­˜å‚¨åº“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/yum.repos.d/mongodb-org.repo<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[mongodb-org-4.2]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name=MongoDB Repository
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.2/x86_64/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey=https://www.mongodb.org/static/pgp/server-4.2.asc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…å¹¶å¯åŠ¨<!-- raw HTML omitted --><code>MongoDB</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install mongodb-org
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable mongod.service <span style="color:#f92672">&amp;&amp;</span> systemctl start mongod.service
</span></span><span style="display:flex;"><span>$ systemctl --type<span style="color:#f92672">=</span>service --state<span style="color:#f92672">=</span>active | grep mongod</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>Elasticsearch</code>æ•°æ®å­˜å‚¨æœåŠ¡</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>GrayLog</code>æ‰€éœ€æœåŠ¡<code>Elasticsearch</code>å¼¹æ€§æœç´¢ã€æ•°æ®å­˜å‚¨æœåŠ¡</li>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Elasticsearch</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>yum</code><!-- raw HTML omitted -->å­˜å‚¨åº“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>GrayLog</code><!-- raw HTML omitted -->ä¸æ”¯æŒ<!-- raw HTML omitted --><code>Elasticsearch 7.11</code><!-- raw HTML omitted -->åŠæ›´é«˜ç‰ˆæœ¬ã€‚å®ƒä¼šç ´åä½ çš„<!-- raw HTML omitted --><code>Graylog</code><!-- raw HTML omitted -->å®ä¾‹ï¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch  	<span style="color:#75715e"># æ·»åŠ å¯†é’¥</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/yum.repos.d/elasticsearch.repo<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[elasticsearch-7.x]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">name=Elasticsearch repository for 7.x packages
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">baseurl=https://artifacts.elastic.co/packages/oss-7.x/yum
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgcheck=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autorefresh=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">type=rpm-md
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>elasticsearch-oss</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install elasticsearch-oss</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Elasticsearch</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†é›†ç¾¤åç§°è®¾ç½®ä¸º<!-- raw HTML omitted --><code>Graylog</code><!-- raw HTML omitted -->å¹¶å–æ¶ˆæ³¨é‡Š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tee -a /etc/elasticsearch/elasticsearch.yml &gt;/dev/null <span style="color:#e6db74">&lt;&lt;-EOT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cluster.name: graylog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">action.auto_create_index: false  	# å¹¶å–æ¶ˆæ³¨é‡Šï¼Œå¯ç”¨è¯¥æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOT</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Elasticsearch</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable elasticsearch.service <span style="color:#f92672">&amp;&amp;</span> systemctl restart elasticsearch.service
</span></span><span style="display:flex;"><span>$ systemctl --type<span style="color:#f92672">=</span>service --state<span style="color:#f92672">=</span>active | grep elasticsearch</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="å®‰è£…graylogæœåŠ¡">å®‰è£…<code>GrayLog</code>æœåŠ¡</h3>
<blockquote>
<ul>
<li><code>GrayLog</code><!-- raw HTML omitted -->å„æ’ä»¶åŠŸèƒ½<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>graylog-enterprise-integrations-plugins</code><!-- raw HTML omitted -->ä¼ä¸šé›†æˆæ’ä»¶<!-- raw HTML omitted --></li>
<li><code>graylog-enterprise-plugins</code><!-- raw HTML omitted -->ä¼ä¸šæ’ä»¶<!-- raw HTML omitted --></li>
<li><code>graylog-integrations-plugins</code><!-- raw HTML omitted -->é›†æˆæ’ä»¶<!-- raw HTML omitted --></li>
<li><code>graylog-server</code><!-- raw HTML omitted -->æœåŠ¡ç«¯<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm -Uvh https://packages.graylog2.org/repo/packages/graylog-4.2-repository_latest.rpm
</span></span><span style="display:flex;"><span>$ yum install graylog-server graylog-enterprise-plugins graylog-integrations-plugins graylog-enterprise-integrations-plugins</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>GrayLog</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é˜…è¯»é…ç½®æ–‡ä»¶ä¸­çš„è¯´æ˜å¹¶æ ¹æ®éœ€è¦è¿›è¡Œç¼–è¾‘ï¼Œä½äº<!-- raw HTML omitted --><code>/etc/graylog/server/server.conf</code><!-- raw HTML omitted -->å¦å¤–æ·»åŠ <!-- raw HTML omitted --><code>password_secret</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>root_password_sha2</code><!-- raw HTML omitted -->å› ä¸ºè¿™äº›æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œæ²¡æœ‰å®ƒä»¬<!-- raw HTML omitted --><code>Graylog</code><!-- raw HTML omitted -->å°†æ— æ³•å¯åŠ¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ln -s /usr/local/src/jdk1.8.0_221/bin/java /usr/bin/java  	<span style="color:#75715e"># ç»™Javaåšä¸ªè½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo -n <span style="color:#e6db74">&#34;Enter Password: &#34;</span> <span style="color:#f92672">&amp;&amp;</span> head -1 &lt;/dev/stdin | tr -d <span style="color:#e6db74">&#39;\n&#39;</span> | sha256sum | cut -d<span style="color:#e6db74">&#34; &#34;</span> -f1  	<span style="color:#75715e"># ä¸ºï¼špassword_secretï¼Œç”Ÿæˆ64ä½å¯†ç å­—ç¬¦</span>
</span></span><span style="display:flex;"><span>$ echo -n yourpassword | sha256sum  	<span style="color:#75715e"># ä¸ºï¼šroot_password_sha2ï¼Œç”Ÿæˆå“ˆå¸Œå€¼</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat //etc/graylog/server/server.conf 
</span></span><span style="display:flex;"><span>password_secret <span style="color:#f92672">=</span>   	<span style="color:#75715e"># 57è¡Œå·¦å³ï¼Œ æ·»åŠ ç”¨æˆ·é›†ç¾¤æ•°æ®åº“ä¸­æ‰€ç”¨</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root_password_sha2 <span style="color:#f92672">=</span>   	<span style="color:#75715e"># 68è¡Œå·¦å³ï¼Œæ·»åŠ ç”Ÿæˆçš„å“ˆå¸Œå€¼ï¼Œ ç”¨äºç™»å½•webç•Œé¢</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>http_bind_address <span style="color:#f92672">=</span> 127.0.0.1:9000  	<span style="color:#75715e"># 105è¡Œå·¦å³ä¿®æ”¹ä¸ºï¼šhttp_bind_address = 0.0.0.0:9000</span></span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>GrayLog</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable graylog-server.service <span style="color:#f92672">&amp;&amp;</span> systemctl start graylog-server.service
</span></span><span style="display:flex;"><span>$ systemctl --type<span style="color:#f92672">=</span>service --state<span style="color:#f92672">=</span>active | grep graylog</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Selinux</code><!-- raw HTML omitted -->å¼€æ”¾ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å…è®¸<!-- raw HTML omitted --><code>Web</code><!-- raw HTML omitted -->æœåŠ¡å™¨è®¿é—®ç½‘ç»œ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ setsebool -P httpd_can_network_connect <span style="color:#ae81ff">1</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é’ˆå¯¹ç«¯å£é…ç½®<!-- raw HTML omitted --><code>Selinux</code><!-- raw HTML omitted -->å¼€æ”¾<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ semanage port -a -t http_port_t -p tcp <span style="color:#ae81ff">9000</span>  	<span style="color:#75715e"># Graylog REST API å’Œ Web ç•Œé¢</span>
</span></span><span style="display:flex;"><span>$ semanage port -a -t http_port_t -p tcp <span style="color:#ae81ff">9200</span>  	<span style="color:#75715e"># Elasticsearchï¼ˆä»…å½“ä½¿ç”¨ HTTP API æ—¶ï¼‰</span>
</span></span><span style="display:flex;"><span>$ semanage port -a -t mongod_port_t -p tcp <span style="color:#ae81ff">27017</span>  	<span style="color:#75715e"># å…è®¸ä½¿ç”¨ MongoDB çš„é»˜è®¤ç«¯å£ (27017/tcp)</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ firewall-cmd --add-port<span style="color:#f92672">=</span>9000/tcp --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‰“å¼€æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted --><code>GrayLog</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ http://IP:9000  	<span style="color:#75715e"># é»˜è®¤ç”¨æˆ·åï¼šadminï¼Œæ‰€å®šä¹‰çš„root_password_sha2å¯†ç </span></span></span></code></pre></div><ul>
<li><code>Google</code><!-- raw HTML omitted -->æµè§ˆå™¨è®¿é—®æŠ¥é”™æ›´æ¢æµè§ˆå™¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>While rendering this widget, the following error occurred:
</span></span><span style="display:flex;"><span>NotFoundError: Failed to execute <span style="color:#e6db74">&#39;removeChild&#39;</span> on <span style="color:#e6db74">&#39;Node&#39;</span>: The node to be removed is not a child of this node.</span></span></code></pre></div></blockquote>
</blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_fluentd">Install_Fluentd</h1>

<h2 id="fluentd"><code>Fluentd</code></h2>
<blockquote>
<ul>
<li>
<p><a href="https://www.fluentd.org/" rel="external" target="_self"><code>Fluentd</code></a></p>
<p><code>Fluentd</code>æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®æ”¶é›†å™¨ï¼Œç”¨ä½œç»Ÿä¸€åŒ–æ•°æ®æ”¶é›†å’Œä½¿ç”¨</p>
</li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_finder">Install_Finder</h1>

<h2 id="finderæ—¥å¿—ç³»ç»Ÿ"><code>Finder</code>æ—¥å¿—ç³»ç»Ÿ</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><code>JDK1.8</code><!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted --><code>Tomcat8</code><!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨rootç™»å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. åˆ›å»ºç”¨æˆ·: tomcat</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¦‚æœå·²æœ‰å¯å¿½ç•¥</span>
</span></span><span style="display:flex;"><span>$ useradd tomcat
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. è®¾ç½®ä¸´æ—¶å˜é‡: TOMCAT_HOME</span>
</span></span><span style="display:flex;"><span>TOMCAT_HOME<span style="color:#f92672">=</span>Tomcatæ ¹ç›®å½•
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. åˆ é™¤å¹¶é‡å»ºROOTç›®å½•, å¦‚æœ‰é‡è¦èµ„æ–™è¯·æ³¨æ„å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>$ rm -rf $TOMCAT_HOME/webapps/ROOT
</span></span><span style="display:flex;"><span>$ mkdir -p $TOMCAT_HOME/webapps/ROOT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4. ä¸‹è½½å¹¶è§£å‹åˆ°ROOTç›®å½•</span>
</span></span><span style="display:flex;"><span>$ wget -O /tmp/finder-web-2.5.8.zip http://www.finderweb.net/download/finder-web-2.5.8.war
</span></span><span style="display:flex;"><span>$ unzip -o -d $TOMCAT_HOME/webapps/ROOT /tmp/finder-web-2.5.8.zip
</span></span><span style="display:flex;"><span><span style="color:#75715e"># rm -f /tmp/finder-web-2.5.8.zip</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 5. ä¸ºåº”ç”¨ç›®å½•èµ‹æƒé™</span>
</span></span><span style="display:flex;"><span>$ chown -R tomcat:tomcat $TOMCAT_HOME
</span></span><span style="display:flex;"><span>$ chmod -R <span style="color:#ae81ff">755</span> $TOMCAT_HOME
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 6. å¯åŠ¨Tomcat</span>
</span></span><span style="display:flex;"><span>$ sudo -u tomcat $TOMCAT_HOME/bin/startup.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 7. è®¿é—®åœ°å€ï¼šhttp://ip:8080/finder</span>
</span></span><span style="display:flex;"><span>tomcaté»˜è®¤çš„ç«¯å£å·ä¸º8080ï¼Œå¦‚éœ€ä¿®æ”¹ï¼Œè¯·æ‰‹åŠ¨ç¼–è¾‘TOMCAT_HOME/conf/server.xmlï¼Œéœ€é‡å¯Tomcatã€‚
</span></span><span style="display:flex;"><span>é»˜è®¤çš„ç”¨æˆ·åå¯†ç ï¼š
</span></span><span style="display:flex;"><span>admin <span style="color:#ae81ff">1234</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 8. ä¿®æ”¹æŒ‚è½½æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;finder/webapps/ROOT/WEB-INF/finderweb/workspaces.xml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;finderweb&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &lt;workspace name=&#34;nginx&#34; displayName=&#34;nginx&#34; work=&#34;/opt/logs/nginx&#34; charset=&#34;utf8&#34; readonly=&#34;true&#34; orderNum=&#34;1&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &lt;workspace name=&#34;mysql&#34; displayName=&#34;mysql&#34; work=&#34;/opt/logs/mysql&#34; charset=&#34;utf8&#34; readonly=&#34;true&#34; orderNum=&#34;2&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;/finderweb&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>Docker</code>æ–¹å¼å®‰è£…<code>Finder</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;1.0&#39;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:   
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tomcat</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">tomcat:8.5.15-jre8</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">tomcat_finder</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">8090</span>:<span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asiz/Shanghai </span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">/opt/finder/webapps:/usr/local/tomcat/webapps</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">/opt/finder/conf:/usr/local/tomcat/conf</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">/opt/finder/logs:/usr/local/tomcat/logs</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ae81ff">/opt/finder/project/logs/nginx:/opt/hwc-logs/nginx</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_es_head">Install_Es_Head</h1>

<h2 id="elasticsearch-head"><code>elasticsearch-head</code></h2>
<blockquote>
<ul>
<li><a href="https://github.com/mobz/elasticsearch-head" rel="external" target="_self"><code>elasticsearch-head Github</code>åœ°å€</a></li>
</ul>
</blockquote>
<h3 id="å®‰è£…nodejsnpm">å®‰è£…<code>nodejsã€npm</code></h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>nodejs</code><!-- raw HTML omitted -->å‰å…ˆå®‰è£…<!-- raw HTML omitted --><code>epel-release</code><!-- raw HTML omitted -->æº<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install epel-release</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>nodejsã€npm</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install nodejs npm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ–°npm</span>
</span></span><span style="display:flex;"><span>$ npm install -g npm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£… n æ¨¡å—</span>
</span></span><span style="display:flex;"><span>$ npm install -g n</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="å›½å†…å®‰è£…cnpm">å›½å†…å®‰è£…<code>cnpm</code></h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ›´æ¢å›½å†…é˜¿é‡Œäº‘æº<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹npm ä½¿ç”¨åœ°å€</span>
</span></span><span style="display:flex;"><span>$ npm config get registry
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ¢æº</span>
</span></span><span style="display:flex;"><span>$ npm config set registry https://registry.npm.taobao.org
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨cnpm</span>
</span></span><span style="display:flex;"><span>$ npm install -g cnpm --registry<span style="color:#f92672">=</span>https://registry.npm.taobao.org</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="å®‰è£…elasticsearch-head">å®‰è£…<code>elasticsearch-head</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://github.com/mobz/elasticsearch-head/archive/refs/tags/v5.0.0.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxvf v5.0.0.tar.gz
</span></span><span style="display:flex;"><span>$ cd elasticsearch-head
</span></span><span style="display:flex;"><span>$ npm install
</span></span><span style="display:flex;"><span>$ npm run start</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_elk">Install_ELK</h1>

<h2 id="elasticsearchéƒ¨ç½²"><code>Elasticsearch</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html" rel="external" target="_self">å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch" rel="external" target="_self">å†å²ç‰ˆæœ¬</a></li>
<li><a href="https://blog.csdn.net/u012332735/article/details/54946355" rel="external" target="_self"><code>Elasticsearch</code>å¸¸ç”¨æ’ä»¶é›†åˆ</a></li>
<li><a href="https://www.cnblogs.com/hahaha111122222/p/13139809.html" rel="external" target="_self"><code>ELK</code>åŸºäº<code>ElastAlert</code>å®ç°æ—¥å¿—çš„å¾®ä¿¡æŠ¥è­¦</a></li>
<li><code>Elasticsearch</code><!-- raw HTML omitted -->ç®€ä»‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Elasticsearch</code>æ˜¯ä¸€ä¸ªåŸºäº<code>Lucene</code>çš„å¼¹æ€§æ•°æ®å­˜å‚¨ã€æœç´¢ã€å¼€æºåˆ†å¸ƒå¼æœç´¢æœåŠ¡ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäº<code>RESTful web</code>æ¥å£ï¼Œåœ¨<code>elasticsearch</code>ä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®æ˜¯å‡ç­‰çš„ã€‚</li>
<li>ç‰¹ç‚¹ï¼šåˆ†å¸ƒå¼ï¼Œé›¶é…ç½®ï¼Œè‡ªåŠ¨å‘ç°ï¼Œç´¢å¼•è‡ªåŠ¨åˆ†ç‰‡ï¼Œç´¢å¼•å‰¯æœ¬æœºåˆ¶ï¼Œ<code>restful</code>é£æ ¼æ¥å£ï¼Œå¤šæ•°æ®æºï¼Œ è‡ªåŠ¨æœç´¢è´Ÿè½½ç­‰ã€‚</li>
<li><code>Elasticsearch</code>æ˜¯ç”¨<code>Java</code>å¼€å‘çš„ï¼Œå¹¶ä½œä¸º<code>Apache</code>è®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯ç¬¬äºŒæµè¡Œçš„ä¼ä¸šæœç´¢å¼•æ“ã€‚è®¾è®¡ç”¨äºäº‘è®¡ç®—ä¸­ï¼Œèƒ½å¤Ÿè¾¾åˆ°å®æ—¶æœç´¢ï¼Œç¨³å®šï¼Œå¯é ï¼Œå¿«é€Ÿï¼Œå®‰è£…ä½¿ç”¨æ–¹ä¾¿ã€‚</li>
</ul>
</blockquote>
<ul>
<li><a href="https://www.elastic.co/cn/downloads/elasticsearch" rel="external" target="_self">ä¸‹è½½<code>elasticsearch-8.1</code></a></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.14.1-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span>$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.14.1-linux-x86_64.tar.gz.sha512
</span></span><span style="display:flex;"><span>$ sha512sum -c elasticsearch-8.1.3-linux-x86_64.tar.gz.sha512
</span></span><span style="display:flex;"><span>$ tar -xzf elasticsearch-8.1.3-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span>$ cd elasticsearch-8.1.3/ </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Elasticsearch</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Elasticsearch</code><!-- raw HTML omitted -->ä¸»é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/elasticsearch/config
</span></span><span style="display:flex;"><span>$ cp elasticsearch.yml<span style="color:#f92672">{</span>,.bak<span style="color:#f92672">}</span>  	<span style="color:#75715e"># æå‰ç»™é…ç½®æ–‡ä»¶åšä¸ªå¤‡ä»½</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;# cluster.name: my-application  	# 17è¡Œã€ç»„å(åŒä¸€ä¸ªç»„ï¼Œç»„åå¿…é¡»ä¸€è‡´)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># èŠ‚ç‚¹åç§°ï¼Œå»ºè®®å’Œä¸»æœºåä¸€è‡´ï¼Œåœ¨23è¡Œä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># node.name: node-1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ•°æ®å­˜æ”¾çš„è·¯å¾„ï¼Œåœ¨33è¡Œä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># path.data: /opt/elasticsearch/data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ—¥å¿—å­˜æ”¾çš„è·¯å¾„ï¼Œåœ¨37è¡Œä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># path.logs: /opt/elasticsearch/logs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é”ä½å†…å­˜ï¼Œä¸è¢«ä½¿ç”¨åˆ°äº¤æ¢åˆ†åŒºå»(é€šå¸¸åœ¨å†…éƒ¨ä¸è¶³æ—¶ï¼Œä¼‘çœ çš„ç¨‹åºå†…å­˜ä¿¡æ¯ä¼šäº¤æ¢åˆ°äº¤æ¢åˆ†åŒº)ï¼Œåœ¨43è¡Œä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># bootstrap.memory_lock: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç½‘ç»œè®¾ç½®ï¼Œå»ºè®®å¡«å†™æœ¬æœºIPæˆ–è€…0.0.0.0ï¼Œåœ¨56è¡Œä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># network.host: 192.168.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç«¯å£è®¾ç½®ï¼Œåœ¨61è¡Œä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># http.port: 9200
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®èŠ‚ç‚¹å¯åŠ¨æ—¶è¿›è¡Œé›†ç¾¤å‘ç°çš„åˆå§‹ä¸»æœºåˆ—è¡¨ã€‚è¿™äº›ä¸»æœºç”¨äºå¸®åŠ©èŠ‚ç‚¹å‘ç°å¹¶åŠ å…¥é›†ç¾¤ï¼Œåœ¨70è¡Œä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># discovery.seed_hosts: [&#34;</span>host1ip:9300<span style="color:#e6db74">&#34;, &#34;</span>host2ip:9300<span style="color:#e6db74">&#34;,&#34;</span>host3ip:9300<span style="color:#e6db74">&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å’ŒèŠ‚ç‚¹åç§°ä¸€è‡´ï¼Œåœ¨74è¡Œä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cluster.initial_master_nodes: [&#34;</span>node-1<span style="color:#e6db74">&#34;, &#34;</span>node-2<span style="color:#e6db74">&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®ä¸ºfalseå…è®¸ä½¿ç”¨é€šé…ç¬¦åˆ é™¤ç´¢å¼•ï¼Œä»¥é˜²æ­¢è¯¯åˆ æ•°æ®è®¾ç½®ä¸ºtrueï¼Œåˆ é™¤æ“ä½œå¿…é¡»æŒ‡å®šç´¢å¼•åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># action.destructive_requires_name: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è·¨åŸŸé…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http.cors.enabled: true  	# æ”¯æŒè·¨åŸŸ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http.cors.allow-origin: &#34;</span>*<span style="color:#e6db74">&#34;  	# è·¨åŸŸèŒƒå›´  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é…ç½®å¯†é’¥è¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># xpack.security.enabled: true  	# å¯ç”¨å®‰å…¨æ€§æ£€æŸ¥
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># xpack.security.transport.ssl.enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># xpack.security.transport.ssl.verification_mode: certificate
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># xpack.security.transport.ssl.keystore.path: /usr/share/elasticsearch/config/elastic-certificates.p12
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># xpack.security.transport.ssl.truststore.path: /usr/share/elasticsearch/config/elastic-certificates.p12
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é›†ç¾¤æ¨¡å¼ï¼Œä»èŠ‚ç‚¹å…³é—­å¤šæ’­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># discovery.zen.ping.multicast.enabled: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é›†ç¾¤æ¨¡å¼ï¼Œä»èŠ‚ç‚¹é…ç½®ä¸»æœåŠ¡å™¨å’Œè‡ªå·±çš„åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># discovery.zen.ping.unicast.hosts: [&#34;</span>10.18.41.31<span style="color:#e6db74">&#34;,&#34;</span>10.18.41.137<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰‹åŠ¨åˆ›å»ºç³»ç»Ÿç´¢å¼•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">action.auto_create_index: .monitoring*,.watches,.triggered_watches,.watcher-history*,.ml* &#34;</span> &gt;&gt;elasticsearch.yml</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Elasticsearch</code><!-- raw HTML omitted -->èµ„æºé™åˆ¶é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è°ƒæ•´jvm.optionsæ–‡ä»¶çš„32ã€å’Œ33è¡Œ</span>
</span></span><span style="display:flex;"><span>$ cd /opt/elasticsearch/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/## -Xms4g/a\\-Xms512m&#34;</span> jvm.options
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;/## -Xmx4g/a\\-Xmx512m&#34;</span> jvm.options</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨æœåŠ¡å¹¶å¼€å¯<!-- raw HTML omitted -->é˜²ç«å¢™ï¼š9200<!-- raw HTML omitted -->ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Ulimit</code><!-- raw HTML omitted -->è°ƒæ•´è¿›ç¨‹çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ulimit -n <span style="color:#ae81ff">65535</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;* soft nofile 65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nofile 65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft nproc 32000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nproc 32000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard memlock unlimited
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft memlock unlimited &#34;</span>&gt;&gt;/etc/security/limits.conf</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>vm.max_map_count</code><!-- raw HTML omitted -->æœ€å¤§è™šæ‹Ÿå†…å­˜åŒºåŸŸ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;vm.max_map_count=655360&#34;</span> &gt;&gt;/etc/sysctl.conf</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹æƒé™å¯åŠ¨æœåŠ¡å¼€æ”¾é˜²ç«å¢™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted --><strong>9200ç«¯å£</strong>ï¼š<!-- raw HTML omitted -->ç”¨äºæ‰€æœ‰é€šè¿‡<code>HTTP</code>åè®®è¿›è¡Œçš„<code>API</code>è°ƒç”¨ã€‚åŒ…æ‹¬æœç´¢ã€èšåˆã€ç›‘æ§ã€ä»¥åŠå…¶ä»–ä»»ä½•ä½¿ç”¨<code>HTTP</code>åè®®çš„è¯·æ±‚ã€‚æ‰€æœ‰çš„å®¢æˆ·ç«¯åº“éƒ½ä¼šä½¿ç”¨è¯¥ç«¯å£ä¸<code>ElasticSearch</code>è¿›è¡Œäº¤äº’ã€‚</p>
</li>
<li>
<p><!-- raw HTML omitted --><strong>9300ç«¯å£</strong>ï¼š<!-- raw HTML omitted -->æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„äºŒè¿›åˆ¶åè®®ï¼Œç”¨äºé›†ç¾¤ä¸­å„èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ã€‚ç”¨äºè¯¸å¦‚é›†ç¾¤å˜æ›´ã€ä¸»èŠ‚ç‚¹é€‰ä¸¾ã€èŠ‚ç‚¹åŠ å…¥/ç¦»å¼€ã€åˆ†ç‰‡åˆ†é…ç­‰äº‹é¡¹ã€‚</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chown -R user:user /opt/elasticsearch  	<span style="color:#75715e"># æ™®é€šç”¨æˆ·å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd /opt/elasticsearch/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¯ä¹¦è®¾ç½®</span>
</span></span><span style="display:flex;"><span>$ ./bin/elasticsearch-certutil ca
</span></span><span style="display:flex;"><span>$ ./bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯†ç è®¾ç½®</span>
</span></span><span style="display:flex;"><span>$ ./bin/elasticsearch-reset-passwords -u elastic  	<span style="color:#75715e"># ä¸ºelasticç”¨æˆ·ç”Ÿæˆéšæœºå¯†ç </span>
</span></span><span style="display:flex;"><span>$ ./bin/elasticsearch-reset-passwords --username elastic -i  	<span style="color:#75715e"># ä¸ºelasticæŒ‡å®šå¯†ç </span>
</span></span><span style="display:flex;"><span>$ ./bin/elasticsearch-setup-passwords interactive  	<span style="color:#75715e"># è®¾ç½®ç”¨æˆ·å¯†ç ï¼Œä¿®æ”¹å¯†ç ä¹Ÿæ˜¯ä¸€æ ·ã€‚</span>
</span></span><span style="display:flex;"><span>$ ./bin/elasticsearch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ­¤å‘½ä»¤æ¥åˆ¤æ–­æ˜¯initå¯åŠ¨è¿˜æ˜¯systemctlå¯åŠ¨</span>
</span></span><span style="display:flex;"><span>$ ps -p <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å½“systemdå¯ç”¨äº†æ—¥å¿—è®°å½•ï¼Œæ—¥å¿—ä¿¡æ¯ä½¿ç”¨å¯ç”¨journalctlçš„å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ journalctl - f
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ—å‡ºelasticsearchæœåŠ¡çš„æ—¥è®°å¸åˆ†å½•</span>
</span></span><span style="display:flex;"><span>$ journalctl - unit elasticsearch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¦ä»ç»™å®šæ—¶é—´å¼€å§‹åˆ—å‡ºelasticsearchæœåŠ¡çš„æ—¥è®°å¸åˆ†å½•ï¼š</span>
</span></span><span style="display:flex;"><span>$ journalctl --unit elasticsearch --since  <span style="color:#e6db74">&#34;2016-10-30 18:17:16&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥Elasticsearch</span>
</span></span><span style="display:flex;"><span>$  curl -i -XGET http://127.0.0.1:9200</span></span></code></pre></div></li>
<li>
<p><code>Nginx Error</code>æ—¥å¿—è§£æçš„<code>Ingest Pipeline</code></p>
<p>ä½ éœ€è¦åœ¨<code>Elasticsearch</code>ä¸­åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„<code>pipeline</code>æ¥è§£æ<code>Nginx</code>çš„<code>error.log</code>ï¼Œæ¯”å¦‚è§£ææ—¥æœŸã€æ—¶é—´ã€é”™è¯¯ä¿¡æ¯ã€å®¢æˆ·ç«¯<code>IP</code>ã€è¯·æ±‚<code>URI</code>ç­‰ã€‚å¯ä»¥å‚è€ƒä¸‹é¢çš„<code>Ingest Pipeline</code>é…ç½®ï¼š</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">PUT _ingest/pipeline/nginx_error_pipeline</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;description&#34;: </span><span style="color:#e6db74">&#34;Pipeline for parsing Nginx error logs&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;processors&#34;: </span>[
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;grok&#34;: </span>{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;field&#34;: </span><span style="color:#e6db74">&#34;message&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;patterns&#34;: </span>[
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;%{TIMESTAMP_ISO8601:timestamp} \\[%{LOGLEVEL:log_level}] %{NUMBER:pid}#%{NUMBER}: \\*%{NUMBER} %{GREEDYDATA:error_message}, client: %{IP:client_ip}, server: %{DATA:server_name}, request: \&#34;%{WORD:method} %{DATA:request_uri} HTTP/%{NUMBER:http_version}\&#34;, upstream: \&#34;%{DATA:upstream}\&#34;, host: \&#34;%{DATA:host}\&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;date&#34;: </span>{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;field&#34;: </span><span style="color:#e6db74">&#34;timestamp&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;formats&#34;: </span>[<span style="color:#e6db74">&#34;yyyy/MM/dd HH:mm:ss&#34;</span>]
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<hr>
<h3 id="elasticsearch-headæ’ä»¶å®‰è£…"><code>elasticsearch-head</code>æ’ä»¶å®‰è£…</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½å¯åŠ¨<!-- raw HTML omitted --><code>elasticsearch-head</code><!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾ï¼š9100<!-- raw HTML omitted --><!-- raw HTML omitted -->ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/
</span></span><span style="display:flex;"><span>$ git clone git://github.com/mobz/elasticsearch-head.git
</span></span><span style="display:flex;"><span>$ cd elasticsearch-head
</span></span><span style="display:flex;"><span>$ npm install
</span></span><span style="display:flex;"><span>$ npm run start
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  grunt server  	# æˆ–è€…ä½¿ç”¨  grunt å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>$ curl http://localhost:9100/  	<span style="color:#75715e"># ç™»å½•æµè§ˆå™¨è¾“å…¥åœ°å€è®¿é—®</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="logstashéƒ¨ç½²"><code>Logstash</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><code>Logstash</code><!-- raw HTML omitted -->ç®€ä»‹<!-- raw HTML omitted -->ã€<a href="https://www.elastic.co/guide/en/logstash/master/index.html" rel="external" target="_self">å®˜æ–¹æ–‡æ¡£</a></li>
</ul>
<blockquote>
<ul>
<li><code>Logstash</code>æ˜¯ä¸€ä¸ªå®Œå…¨å¼€æºå·¥å…·ï¼Œå¯ä»¥å¯¹ä½ çš„æ—¥å¿—è¿›è¡Œæ”¶é›†ã€è¿‡æ»¤ã€åˆ†æï¼Œå¹¶å°†å…¶å­˜å‚¨ä¾›ä»¥åä½¿ç”¨ï¼ˆå¦‚ï¼Œæœç´¢ï¼‰ï¼Œ<code>logstash</code>å¸¦æœ‰ä¸€ä¸ª<code>web</code>ç•Œé¢ï¼Œæœç´¢å’Œå±•ç¤ºæ‰€æœ‰æ—¥å¿—ã€‚</li>
</ul>
</blockquote>
<ul>
<li><a href="https://www.elastic.co/cn/downloads/logstash" rel="external" target="_self">ä¸‹è½½ã€è§£å‹<code>Logstash</code></a></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://artifacts.elastic.co/downloads/logstash/logstash-8.3.3-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxvf logstash-8.3.3-linux-x86_64.tar.gz</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Logstash</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>conf</code><!-- raw HTML omitted -->æ–‡ä»¶æ”¶é›†<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->æ—¥å¿—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.elastic.co/guide/en/logstash/current/configuration.html" rel="external" target="_self">å‚è€ƒå®˜ç½‘æ ‡å‡†è¾“å…¥è¾“å‡º</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.elastic.co/guide/en/logstash/current/configuration-file-structure.html" rel="external" target="_self">å‚è€ƒå®˜ç½‘å‡½æ•°è¾“å…¥è¾“å‡º</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html" rel="external" target="_self">å‚è€ƒå®˜ç½‘æ”¶é›†ç³»ç»Ÿæ—¥å¿—</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.elastic.co/guide/en/logstash/current/event-dependent-configuration.html" rel="external" target="_self">å‚è€ƒå®˜ç½‘æ”¶é›†<code>Java</code>æ—¥å¿—</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.elastic.co/guide/en/logstash/current/plugins-codecs-multiline.html" rel="external" target="_self">å‚è€ƒå®˜ç½‘ä½¿ç”¨<code>multiline</code>å¤šè¡Œæ¨¡å¼</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>input{}</code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»æ—¥å¿—æ–‡ä»¶ä¸­è°ƒç”¨å‡½æ•°è¾“å…¥<!-- raw HTML omitted --></li>
<li><code>output{}</code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»æ—¥å¿—æ–‡ä»¶ä¸­è°ƒç”¨å‡½æ•°è¾“å‡º<!-- raw HTML omitted --></li>
<li><code>stdin{}</code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»æ ‡å‡†è¾“å…¥ä¸­æ”¶é›†æ—¥å¿—<!-- raw HTML omitted --></li>
<li><code>stdout{} </code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»æ ‡å‡†è¾“å‡ºæ—¥å¿—<!-- raw HTML omitted --></li>
<li><code>syslog</code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»ç³»ç»Ÿæ—¥å¿—ç¨‹åºä¸­æ”¶é›†æ—¥å¿—<!-- raw HTML omitted --></li>
<li><code>tcp</code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»<!-- raw HTML omitted --><code>TCP</code><!-- raw HTML omitted -->ç¨‹åºç«¯å£ä¸­æ”¶é›†æ—¥å¿—<!-- raw HTML omitted --></li>
<li><code>udp</code>ï¼š<code>logstash</code><!-- raw HTML omitted -->ä»<!-- raw HTML omitted --><code>UDP</code><!-- raw HTML omitted -->ç¨‹åºç«¯å£ä¸­æ”¶é›†æ—¥å¿—<!-- raw HTML omitted --></li>
<li><code>rubuydebug</code>ï¼š<!-- raw HTML omitted -->é€šè¿‡<!-- raw HTML omitted --><code>rubuy</code><!-- raw HTML omitted -->åº“è¿›è¡Œæ”¶é›†<!-- raw HTML omitted --></li>
<li><code>multiline</code>ï¼š<!-- raw HTML omitted -->å¤šè¡Œæ¨¡å—<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;Settings: Default filter workers: 4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Logstash startup completed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">input {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">type =&gt; &#34;</span>nginx-error-log<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">path =&gt; &#34;</span>/usr/local/nginx/logs/*error*.log<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_position =&gt; &#34;</span>beginning<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}file {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">type =&gt; &#34;</span>nginx-access-log<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">path =&gt; &#34;</span>/usr/local/nginx/logs/*access*.log<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_position =&gt; &#34;</span>beginning<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">codec =&gt; json
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">output {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [type] =~ &#34;</span>nginx-error-log<span style="color:#e6db74">&#34; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">elasticsearch {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hosts =&gt; [&#34;</span>elasticsearchæœåŠ¡æ‰€åœ¨IP:9200<span style="color:#e6db74">&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">index =&gt; &#34;</span>mayi-nginx-error--%<span style="color:#f92672">{</span>+YYYY.MM.dd<span style="color:#f92672">}</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}else if [type] =~ &#34;</span>nginx-access-log<span style="color:#e6db74">&#34; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">elasticsearch {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hosts =&gt; [&#34;</span>elasticsearchæœåŠ¡æ‰€åœ¨IP:9200<span style="color:#e6db74">&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">index =&gt; &#34;</span>mayi-nginx-access-%<span style="color:#f92672">{</span>+YYYY.MM.dd<span style="color:#f92672">}</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">} &#34;</span> &gt;&gt;/opt/elk/logstash/data/nginx-log.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####  	  </span>
</span></span><span style="display:flex;"><span>$ cat &gt;logstash.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">input {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> redis {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     host =&gt; &#34;Redis æœåŠ¡æ‰€åœ¨IP&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     port =&gt; &#34;6379&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     password =&gt; &#34;password&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     data_type =&gt; &#34;list&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     key =&gt; &#34;filebeat&#34; #ä»redisä¸­å¯¼å…¥çš„keyï¼Œä¸filebeatè¾“å‡ºå¯¹åº”
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     type =&gt; &#34;redis-input&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     db =&gt; 0 #å¯¼å…¥keyçš„æ•°æ®åº“ï¼Œé»˜è®¤ä¸º0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">filter {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # åˆ¤æ–­rediså­—ç¬¦ä¸²åœ¨ä¸åœ¨è‡ªå·±å®šä¹‰çš„æ–°å­—æ®µä¸­ï¼Œç”¨äºåŒºåˆ†æ—¥å¿—ç±»å‹ï¼Œåšå¯¹åº”çš„å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> if &#39;redis&#39; in [app] {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     # èšåˆredisæ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     grok {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		   # è‡ªå®šä¹‰åŒ¹é…æ—¥å¿—å†…å®¹ï¼Œé»˜è®¤ä¸€æ¡æ—¥å¿—ä»ä¸Šåˆ°ä¸‹åªä¼šåŒ¹é…ä¸€æ¬¡å¯¹çš„ã€‚ä¸”åªä¼šåŒ¹é…ä¸€ä¸ªå­—æ®µï¼Œå¦‚éœ€è¦åŒ¹é…å¤šä¸ªå­—æ®µï¼Œéœ€è¿›è¡Œä¸¥æ ¼åŒ¹é…
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		   patterns_dir =&gt; [&#34;/opt/elk/patterns_time&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		   # grokæä¾›å¾ˆå¤šè‡ªå¸¦çš„æ­£åˆ™ï¼Œå¯ä¾›ä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        match =&gt; { &#34;message&#34; =&gt; &#34;%{LOGTIME</span>:log_time<span style="color:#f92672">}</span><span style="color:#e6db74">&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		   # ï¼ˆ?&lt;è‡ªå®šä¹‰çš„&gt;è¦åŒ¹é…çš„å†…å®¹ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        match =&gt; { &#34;</span>message<span style="color:#e6db74">&#34; =&gt; &#34;</span><span style="color:#f92672">(</span>?&lt;log_time&gt;%<span style="color:#f92672">{</span>TIMESTAMP_ISO8601<span style="color:#f92672">})</span>.*session <span style="color:#f92672">(</span>?&lt;session&gt;.*<span style="color:#ae81ff">\S</span>$<span style="color:#f92672">)</span><span style="color:#e6db74">&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     date {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		    # ä¿®æ”¹é‡‡é›†æ—¶é—´ä¸ºæ—¥å¿—é‡Œçš„æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         match =&gt; [&#34;</span>log_time<span style="color:#e6db74">&#34;, &#34;</span>yyyy-MM-dd HH:mm<span style="color:#e6db74">&#34;,&#34;</span>dd MMM yyyy HH:mm:ss.SSS<span style="color:#e6db74">&#34; ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         locale =&gt; &#34;</span>en<span style="color:#e6db74">&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     ruby {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         code =&gt; &#34;</span>event.set<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;timestamp&#39;</span>, event.get<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;@timestamp&#39;</span><span style="color:#f92672">)</span>.time.localtime - 8*60*60<span style="color:#f92672">)</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     ruby {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         code =&gt; &#34;</span>event.set<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;@timestamp&#39;</span>,event.get<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;timestamp&#39;</span><span style="color:#f92672">))</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     mutate {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		      # è½¬æ¢å­—æ®µç±»å‹ï¼Œç”¨äºèšåˆæ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">           convert =&gt; { &#34;</span>session<span style="color:#e6db74">&#34; =&gt; &#34;</span>string<span style="color:#e6db74">&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			  # åˆ é™¤æ— ç”¨å­—æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">           remove_field =&gt; [&#34;</span>log_time<span style="color:#e6db74">&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	 # å°†logstashæ—¶é—´è½¬åŒ–ä¸­å›½æ—¶é—´,logstashé»˜è®¤ä¸ºutcæ—¶é—´ï¼Œæ¯”ä¸­å›½æ—¶é—´æ…¢8ä¸ªå°æ—¶ï¼ˆä¿®æ”¹çš„æ˜¯é‡‡é›†æ—¶é—´ï¼Œå¯¹æ—¥å¿—æ—¶é—´æ²¡æœ‰å½±å“ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ruby {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     code =&gt; &#34;</span>event.set<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;timestamp&#39;</span>, event.get<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;@timestamp&#39;</span><span style="color:#f92672">)</span>.time.localtime + 8*60*60<span style="color:#f92672">)</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ruby {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     code =&gt; &#34;</span>event.set<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;@timestamp&#39;</span>,event.get<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;timestamp&#39;</span><span style="color:#f92672">))</span><span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  mutate {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     remove_field =&gt; [&#34;</span>timestamp<span style="color:#e6db74">&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">output {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ç”¨äºè°ƒè¯•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # stdout{ codec =&gt; rubydebug }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #####  åˆ›å»ºçº¿ä¸Šç¯å¢ƒç´¢å¼•  ######
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if &#39;online_82&#39; in [app] {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     elasticsearch {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       action =&gt; &#34;</span>index<span style="color:#e6db74">&#34; #The operation on ES
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       hosts =&gt; &#34;</span>127.0.0.1:9200<span style="color:#e6db74">&#34; # ElasticSearch host, can be array.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		  # è¾“å‡ºåˆ°esä¸­çš„ç´¢å¼•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       index =&gt; &#34;</span>online_82_%<span style="color:#f92672">{</span>+YYYY.MM.dd<span style="color:#f92672">}</span><span style="color:#e6db74">&#34; #The index to write data to.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       user =&gt; &#34;</span>elastic<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       password =&gt; &#34;</span>dtyn!@<span style="color:#e6db74">$&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 # å¯¹åº”filebeatä¸­[tags],ç”¨å¯¹åº”ç´¢å¼•è¿›è¡Œåˆ¤æ–­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   if [tags][0] == &#39;count&#39; {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     elasticsearch {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       action =&gt; &#34;</span>index<span style="color:#e6db74">&#34; #The operation on ES
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       hosts =&gt; &#34;</span>127.0.0.1:9200<span style="color:#e6db74">&#34; #ElasticSearch host, can be array.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       index =&gt; &#34;</span>online_82_redis_count<span style="color:#e6db74">&#34; #The index to write data to.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       user =&gt; &#34;</span>elastic<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       password =&gt; &#34;</span>dtyn!@$<span style="color:#e6db74">&#34; }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ£€æŸ¥é…ç½®ã€å¯åŠ¨æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ &#34;--configtest&#34;æˆ–è€…&#34;-t&#34;å‚æ•°æ£€æŸ¥é…ç½®è¯­æ³•æ˜¯å¦æœ‰è¯¯</span>
</span></span><span style="display:flex;"><span>$ /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/nginx.conf --config.test_and_exit
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨ç¨‹åºåå°è¿è¡Œ&#34;&amp;&#34;</span>
</span></span><span style="display:flex;"><span>$ nohup /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/nginx.conf &amp;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &#34;screen&#34; å¯åŠ¨å¦ä¸€ä¸ªç»ˆç«¯ </span>
</span></span><span style="display:flex;"><span>$ /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/nginx.conf
</span></span><span style="display:flex;"><span>$ screen -ls
</span></span><span style="display:flex;"><span>$ screen -r <span style="color:#ae81ff">16582</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h2 id="beatséƒ¨ç½²"><code>Beats</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><code>Beats</code>æ˜¯ç”±<code>Elastic</code>å…¬å¸å¼€å‘å’Œç»´æŠ¤çš„ä¸€ç»„å¼€æºæ•°æ®é‡‡é›†å™¨ã€‚å®ƒä»¬è®¾è®¡ç”¨äºä»å„ç§æ•°æ®æºæ”¶é›†æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€åˆ°<code>Elasticsearch</code>æˆ–è€…<code>Logstash</code>ç­‰åç«¯å­˜å‚¨å’Œåˆ†æç³»ç»Ÿä¸­</li>
</ul>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.elastic.co/guide/en/beats/libbeat/current/index.html" rel="external" target="_self">å®˜æ–¹æ–‡æ¡£</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.elastic.co/cn/downloads/beats/" rel="external" target="_self">é€‰æ‹©ä¸€ä¸ª<code>Beat</code>ä»»ä½•<code>Beat</code>çš†å¯</a></td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="filebeatéƒ¨ç½²"><code>Filebeat</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><code>Filebeat</code>ç”¨äºè½»é‡çº§æ—¥å¿—å’Œæ–‡ä»¶æ•°æ®æ”¶é›†ã€‚<code>Filebeat</code>å¯ä»¥ç›‘æ§æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶æˆ–ä½ç½®ï¼Œæ”¶é›†æ—¥å¿—æ•°æ®ï¼Œå¹¶å°†å…¶å‘é€åˆ°<code>Elasticsearch</code>æˆ–<code>Logstash</code>è¿›è¡Œå­˜å‚¨å’Œåˆ†æ</li>
<li><a href="https://www.elastic.co/cn/downloads/beats/filebeat" rel="external" target="_self">ä¸‹è½½å®‰è£…<code>Filebeat</code></a></li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation-configuration.html" rel="external" target="_self"><code>Filebeat</code>å®‰è£…é…ç½®ç¼–è¾‘</a></li>
<li><a href="https://www.cnblogs.com/cjsblog/p/9495024.html" rel="external" target="_self"><code>Filebeat</code>æ¨¡å—ä¸é…ç½®</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.3.3-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span>$ tar xzvf filebeat-8.3.3-linux-x86_64.tar.gz</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Filebeat</code></li>
</ul>
<blockquote>
<ul>
<li><code>filebeat.yml</code>æ–‡ä»¶</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># åŠ¨æ€é…ç½®ï¼Œå…è®¸ä»å¤–éƒ¨æ–‡ä»¶åŠ è½½è¾“å…¥</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">filebeat.config.inputs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/etc/filebeat/input.d/*.yml</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">reload.enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">reload.period</span>: <span style="color:#ae81ff">10s</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åŠ¨æ€æ¨¡å—é…ç½® </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">filebeat.config.modules</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">path</span>: <span style="color:#ae81ff">${path.config}/modules.d/*.yml</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">reload.enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">setup.template.settings</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">index.number_of_shards</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">index.codec</span>: <span style="color:#ae81ff">best_compression</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">index.mapping</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">dynamic</span>: <span style="color:#66d9ef">false</span>  <span style="color:#75715e"># å…³é—­è‡ªåŠ¨å­—æ®µè¯†åˆ«</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">processors</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">add_host_metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">when.not.contains.tags</span>: <span style="color:#ae81ff">forwarded</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">add_docker_metadata</span>: {}  	<span style="color:#75715e"># ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼š~</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">drop_fields</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">fields</span>: [<span style="color:#e6db74">&#34;agent.ephemeral_id&#34;</span>, <span style="color:#e6db74">&#34;agent.hostname&#34;</span>, <span style="color:#e6db74">&#34;agent.id&#34;</span>, <span style="color:#e6db74">&#34;agent.name&#34;</span>, <span style="color:#e6db74">&#34;agent.type&#34;</span>, <span style="color:#e6db74">&#34;agent.version&#34;</span>, <span style="color:#e6db74">&#34;headers&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">rename</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">fields</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">from</span>: <span style="color:#e6db74">&#34;url&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">to</span>: <span style="color:#e6db74">&#34;url_host&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ignore_missing</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">fail_on_error</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####  	Outputs  	#####</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  reids output</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">output.redis</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hosts</span>: [<span style="color:#e6db74">&#34;RedisæœåŠ¡æ‰€åœ¨IP:6379&#34;</span>] <span style="color:#75715e"># è¾“å‡ºåˆ°redisçš„ipç«¯å£å·</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#e6db74">&#34;password&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;filebeat&#34;</span> <span style="color:#75715e"># è¾“å‡ºåˆ°redisä¸­çš„keyï¼Œè¿™ä¸ªkeyæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œllen keyæŸ¥çœ‹é•¿åº¦  lrange key 0 -1 æŸ¥çœ‹åˆ—è¡¨æ‰€æœ‰çš„å€¼</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">timeout</span>: <span style="color:#ae81ff">30</span> <span style="color:#75715e"># è¿æ¥redisè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º5s</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">output.elasticsearch</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hosts</span>: [<span style="color:#e6db74">&#34;&lt;èŠ‚ç‚¹01çš„IP&gt;:9200&#34;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># æŒ‡å®šæ¯æ¬¡å‘ Elasticsearch æ‰¹é‡å‘é€çš„æœ€å¤§äº‹ä»¶ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">bulk_max_size</span>: <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># é—´éš” 5ç§’ï¼Œå¼ºåˆ¶å°†ç§¯ç´¯çš„äº‹ä»¶å‘é€åˆ° Elasticsearchï¼Œç¡®ä¿æ•°æ®èƒ½å¤ŸåŠæ—¶è¢«å¤„ç†</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">flush_interval</span>: <span style="color:#ae81ff">5s</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template.name</span>: <span style="color:#e6db74">&#34;filebeat&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template.path</span>: <span style="color:#e6db74">&#34;filebeat.template.json&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template.overwrite</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">username</span>: <span style="color:#e6db74">&#34;elastic&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#e6db74">&#34;changeme&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># å¯ç”¨å‹ç¼©ï¼Œå‡å°‘ç½‘ç»œå¸¦å®½ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">compression_level</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">index</span>: <span style="color:#e6db74">&#34;nginx-%{[fields.application]}-%{+yyyy.MM.dd}&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">indices</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">when.equals</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">fields.application</span>: [<span style="color:#e6db74">&#39;app-docker-nginx_access&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">output.elasticsearch</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hosts</span>: [<span style="color:#e6db74">&#34;&lt;èŠ‚ç‚¹01çš„IP&gt;:9200&#34;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">api_key</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">index</span>: <span style="color:#e6db74">&#34;nginx-%{[fields.application]}-%{+yyyy.MM.dd}&#34;</span>  <span style="color:#75715e"># fields.applicationå‚æ•°ä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">indices</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">when.equals</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">fields.application</span>: [<span style="color:#e6db74">&#39;app-docker-nginx_access&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">output.elasticsearch</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hosts</span>: [<span style="color:#e6db74">&#34;https://myEShost:9200&#34;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">username</span>: <span style="color:#e6db74">&#34;filebeat_internal&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#e6db74">&#34;YOUR_PASSWORD&#34;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ssl</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ca_trusted_fingerprint</span>: <span style="color:#e6db74">&#34;b9a10bbe64ee9826abeda6546fc988c8bf798b41957c33d05db736716513dc9c&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Kibana Setup</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">setup.kibana</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">host</span>: <span style="color:#e6db74">&#34;mykibanahost:5601&#34;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">username</span>: <span style="color:#e6db74">&#34;my_kibana_user&#34;</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#e6db74">&#34;{pwd}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è‡ªå®šä¹‰æ¨¡æ¿æ ¼å¼</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">setup.ilm.enabled</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">setup.template.name</span>: <span style="color:#e6db74">&#34;nginx&#34;</span>  	<span style="color:#75715e"># æ¨¡æ¿åç§°</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">setup.template.pattern</span>: <span style="color:#e6db74">&#34;nginx-*&#34;</span>  	<span style="color:#75715e"># åŒ¹é…æ¨¡æ¿ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">setup.template.enabled</span>: <span style="color:#66d9ef">false</span>  	<span style="color:#75715e"># falseï¼šä¸ä½¿ç”¨é»˜è®¤æ¨¡æ¿ï¼Œtrueï¼šä½¿ç”¨é»˜è®¤æ¨¡æ¿</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">setup.template.overwrite</span>: <span style="color:#66d9ef">true</span>  	<span style="color:#75715e"># æ˜¯å¦è¦†ç›–åŸæ¥æ¨¡æ¿</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">setup.template</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;filebeat-logs&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pattern</span>: <span style="color:#e6db74">&#34;filebeat-logs-*&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mappings</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">properties</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">level</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">keyword</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ts</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">date</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">format</span>: <span style="color:#e6db74">&#34;yyyy-MM-dd HH:mm:ss&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">file_name</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">keyword</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">msg</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">keyword</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ti</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">keyword</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">route</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">type</span>: <span style="color:#ae81ff">keyword</span></span></span></code></pre></div><ul>
<li><code>/opt/filebeat/input.d/*.yaml</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">filebeat.inputs</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">type</span>: <span style="color:#ae81ff">log</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span> <span style="color:#75715e"># Trueè¡¨ç¤ºæ”¶é›†</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># pasthsé…ç½®æ”¶é›†æ—¥å¿—çš„è·¯å¾„ï¼Œæ”¯æŒé…ç½®å¤šæ¡è·¯å¾„ï¼ŒåŠå¤šç›®å½•</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">/opt/app/nacos-1.3.2/nacos/bin/logs/*.log</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># tags æ ‡è®°;å¯ä»¥ç”¨æ¥åŒºåˆ†æ—¥å¿—,è¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨å¯ä»¥å†™å¤šä¸ªæ ‡è®°</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tags</span>: [<span style="color:#e6db74">&#34;nacos&#34;</span>] 
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># filedsåˆ›å»ºæ–°çš„å­—æ®µï¼Œé»˜è®¤æ˜¯äºŒçº§å­—æ®µï¼Œå¯ä»¥è‡ªå®šä¹‰å¤šä¸ªkey: value</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">fields</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">test_71_nacos-1.3.2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># è®©æ–°å»ºçš„å­—æ®µå˜æˆé¡¶çº§å­—æ®µï¼Œå‡å°‘ä¸å¿…è¦çš„èµ„æºå¼€é”€</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">fields_under_root</span>: <span style="color:#66d9ef">true</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># è®©filebeaté‡‡é›†æœ€æ–°çš„æ—¥å¿—å˜åŒ–ï¼Œå¿½ç•¥æ‰ä¹‹å‰æ—§æ—¥å¿—</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tail_files</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># ä¸‹è¾¹è¿™å‡ é¡¹å¯ä»¥ä¸ç”¨</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># filebeatä¾é æ–‡ä»¶æè¿°ç¬¦è¯†åˆ«æ–‡ä»¶ï¼Œå½“å‘ç”Ÿé‡å‘½åæˆ–ç§»åŠ¨ï¼Œfilebeatä¾ç„¶é‡‡é›†çš„åŸæ–‡ä»¶ã€‚</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">close_renamed</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Filebeat åœ¨å¤šé•¿æ—¶é—´åå…³é—­æ–‡ä»¶çš„å¤„ç†ï¼Œ5åˆ†é’Ÿ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">close_inactive</span>: <span style="color:#ae81ff">5m</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># ç­‰å¾…å†æ¬¡æ£€æŸ¥æ–‡ä»¶çš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯10s</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">max_backoff</span>: <span style="color:#ae81ff">1s</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># æ­¤é€‰é¡¹æŒ‡å®šç­‰å¾…æ—¶é—´çš„å¢åŠ é€Ÿåº¦,1è¡¨ç¤ºç¦ç”¨å›ç®—ç®—æ³•</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">backoff_factor</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># æ§åˆ¶æ—¥å¿—æ–‡ä»¶çš„æ£€æŸ¥é¢‘ç‡ï¼Œæ¯10ç§’æ£€æŸ¥ä¸€æ¬¡</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">scan_frequency</span>: <span style="color:#ae81ff">10s</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># å¼€å¯ jsonæ—¥å¿—æ ¼å¼</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">json.keys_under_root</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">json.overwrite_keys</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">json.message_key</span>: <span style="color:#ae81ff">message</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">json.add_error_key</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##### 	 filbeatä¹Ÿå¯ä»¥é‡‡é›†jarå †æ ˆæ—¥å¿—ï¼šå¤šè¡Œæ—¥å¿—å†…å®¹ä¸ºä¸€æ¡æ—¥å¿—</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">type</span>: <span style="color:#ae81ff">log</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">/opt/app/nacos-1.3.2/nacos/bin/logs/*.log</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">multiline</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è‡ªå®šä¹‰æ¯æ¡æ—¥å¿—çš„å¼€å¤´</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">pattern: &#39;\# Time</span>: <span style="color:#ae81ff">\d{4}-\d{2}-\d{2}&#39;</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#75715e"># å®šä¹‰æ¨¡å¼æ˜¯å¦è¢«å¦å®š,é»˜è®¤å€¼ä¸ºfalse</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">negate</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#75715e"># ä¸æ¨¡å¼ä¸åŒ¹é…çš„è¿ç»­è¡Œå°†è¿½åŠ åˆ°åŒ¹é…çš„ä¸Šä¸€è¡Œ</span>
</span></span><span style="display:flex;"><span>	  <span style="color:#f92672">match</span>: <span style="color:#ae81ff">after</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####  	</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">type</span>: <span style="color:#ae81ff">log</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">/usr/local/nginx/logs/gitlab.log</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">fields</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">application</span>: <span style="color:#ae81ff">app-docker-nginx_access</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ—å‡ºä»¥åŠä½¿ç”¨æ¨¡å—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./filebeat modules list
</span></span><span style="display:flex;"><span>$ ./filebeat modules enable nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- module: nginx
</span></span><span style="display:flex;"><span>  access:
</span></span><span style="display:flex;"><span>    enabled: true
</span></span><span style="display:flex;"><span>    var.paths: <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/var/log/nginx/access.log*&#34;</span><span style="color:#f92672">]</span> </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ£€æµ‹å¯åŠ¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./filebeat setup -e
</span></span><span style="display:flex;"><span>$ chown root filebeat.yml 
</span></span><span style="display:flex;"><span>$ chown root modules.d/nginx.yml 
</span></span><span style="display:flex;"><span>$ ./filebeat -e</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="metricbeatéƒ¨ç½²"><code>Metricbeat</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-installation-configuration.html" rel="external" target="_self"><code>Metricbeat</code></a></li>
<li><code>Metricbeat</code>ç”¨äºå®šæ—¶æ”¶é›†ç³»ç»Ÿå’ŒæœåŠ¡çš„æŒ‡æ ‡æ•°æ®ã€‚<code>Metricbeat</code>æ”¯æŒæ”¶é›†å„ç§æœåŠ¡ï¼ˆå¦‚<code>Redis</code>ã€<code>Apache</code>ã€<code>MySQL</code>ç­‰ï¼‰çš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶å°†è¿™äº›æ•°æ®å‘é€åˆ°<code>Elasticsearch</code>æˆ–è€…å…¶ä»–æ•°æ®å­˜å‚¨å’Œå¯è§†åŒ–å·¥å…·ä¸­</li>
</ul>
</blockquote>
<hr>
<h3 id="packetbeatéƒ¨ç½²"><code>Packetbeat</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-installation-configuration.html" rel="external" target="_self"><code>Packetbeat</code></a></li>
<li><code>Packetbeat</code>ç”¨äºå®æ—¶ç½‘ç»œæ•°æ®åˆ†æã€‚<code>Packetbeat</code>å¯ä»¥ç›‘æ§ç½‘ç»œæµé‡ï¼Œæ•è·å’Œåˆ†æåº”ç”¨å±‚åè®®ï¼ˆå¦‚<code>HTTP</code>ã€<code>MySQL</code>ã€<code>DNS</code>ç­‰ï¼‰çš„æ•°æ®ï¼Œå¸®åŠ©è¯†åˆ«é—®é¢˜å’Œä¼˜åŒ–ç½‘ç»œæ€§èƒ½</li>
</ul>
</blockquote>
<hr>
<h3 id="heartbeatéƒ¨ç½²"><code>Heartbeat</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><code>Heartbeat</code>ç”¨äºç›‘æ§æœåŠ¡çš„å¯ç”¨æ€§ã€‚<code>Heartbeat</code>å¯ä»¥å®šæœŸæ£€æŸ¥æœåŠ¡ã€ç½‘ç«™æˆ–è€…ä¸»æœºçš„å¯è®¿é—®æ€§ï¼Œå¹¶è®°å½•å“åº”æ—¶é—´å’ŒçŠ¶æ€ï¼Œä»¥å¸®åŠ©è¿ç»´äººå‘˜å¿«é€Ÿå‘ç°å’Œè§£å†³æ•…éšœã€‚</li>
</ul>
</blockquote>
<hr>
<h3 id="auditbeatéƒ¨ç½²"><code>Auditbeat</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><code>Auditbeat</code>ç”¨äºæ”¶é›†ç³»ç»Ÿå®¡è®¡æ—¥å¿—ã€‚<code>Auditbeat</code>ç›‘æ§æ“ä½œç³»ç»Ÿå’Œæ–‡ä»¶ç³»ç»Ÿçš„æ´»åŠ¨ï¼ŒåŒ…æ‹¬æ–‡ä»¶è®¿é—®ã€ç”¨æˆ·ç™»å½•ç­‰å®‰å…¨ç›¸å…³äº‹ä»¶ï¼Œå¹¶å°†è¿™äº›äº‹ä»¶å‘é€åˆ°ä¸­å¿ƒåŒ–çš„æ—¥å¿—ç®¡ç†ç³»ç»Ÿ</li>
</ul>
</blockquote>
<hr>
<h2 id="kibanaéƒ¨ç½²"><code>Kibana</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li>
<p><a href="https://www.elastic.co/guide/en/kibana/current/index.html" rel="external" target="_self">éƒ¨ç½²<code>Kibana</code>å›¾å½¢åŒ–å±•ç¤ºå®˜æ–¹æ–‡æ¡£</a></p>
</li>
<li>
<p><code>Kibana</code>æ˜¯ç”±<code>Elastic</code>å…¬å¸å¼€å‘çš„å¼€æºæ•°æ®å¯è§†åŒ–å·¥å…·ï¼Œç”¨äºå¯¹<code>Elasticsearch</code>ç´¢å¼•ä¸­çš„æ•°æ®è¿›è¡Œæœç´¢ã€åˆ†æå’Œå¯è§†åŒ–ã€‚å®ƒæ˜¯<code>Elastic Stack</code>ï¼ˆä¹Ÿç§°ä¸º<code>ELK Stack</code>ï¼‰ä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œä¸<code>Elasticsearch</code>ã€<code>Logstash</code>å’Œ<code>Beats</code>ä¸€èµ·æ„æˆäº†ä¸€ä¸ªå¼ºå¤§çš„æ•°æ®åˆ†æå¹³å°</p>
</li>
<li>
<p>æ˜¯ä¸€ä¸ªåŸºäºæµè§ˆå™¨é¡µé¢çš„<code>Elasticsearch</code>å‰ç«¯å±•ç¤ºå·¥å…·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¼€æºå’Œå…è´¹çš„å·¥å…·ï¼Œ<code>Kibana</code>å¯ä»¥ä¸º<code>Logstash</code>å’Œ<code>ElasticSearch</code>æä¾›çš„æ—¥å¿—åˆ†æå‹å¥½çš„<code>Web</code>ç•Œé¢ï¼Œå¯ä»¥å¸®ä½ æ±‡æ€»ã€åˆ†æå’Œæœç´¢é‡è¦æ•°æ®æ—¥å¿—</p>
</li>
<li>
<p><strong>ä¸»è¦åŠŸèƒ½å’Œç‰¹ç‚¹ï¼š</strong></p>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>æ•°æ®æŸ¥è¯¢å’Œæœç´¢</strong>ï¼š</p>
<p><code>Kibana</code>æä¾›äº†ä¸€ä¸ªç›´è§‚çš„æœç´¢å’ŒæŸ¥è¯¢ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·åœ¨<code>Elasticsearch</code>ç´¢å¼•ä¸­æ‰§è¡Œå¤æ‚çš„æœç´¢æ“ä½œã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨<code>Lucene</code>&gt; æŸ¥è¯¢è¯­æ³•æˆ–è€…ç»“æ„åŒ–çš„æŸ¥è¯¢æ„å»ºå™¨æ¥ç­›é€‰å’ŒæŸ¥æ‰¾æ•°æ®ã€‚</p>
</li>
<li>
<p><strong>æ•°æ®å¯è§†åŒ–</strong>ï¼š</p>
<p><code>Kibana</code>å…è®¸ç”¨æˆ·å°†<code>Elasticsearch</code>&gt; ä¸­çš„æ•°æ®é€šè¿‡å„ç§å›¾è¡¨ï¼ˆå¦‚æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ã€é¥¼å›¾ç­‰ï¼‰å’Œå›¾å½¢åŒ–å±•ç¤ºæ–¹å¼è¿›è¡Œå¯è§†åŒ–ã€‚è¿™äº›å›¾è¡¨å¯ä»¥å¸®åŠ©ç”¨æˆ·ç›´è§‚åœ°ç†è§£æ•°æ®çš„è¶‹åŠ¿ã€å…³ç³»å’Œæ¨¡å¼</p>
</li>
<li>
<p><strong>ä»ªè¡¨ç›˜å’Œè§†å›¾</strong>ï¼š</p>
<p>ç”¨æˆ·å¯ä»¥é€šè¿‡åˆ›å»ºä»ªè¡¨ç›˜<code>Dashboard</code>&gt; æ¥é›†æˆå¤šä¸ªæ•°æ®å¯è§†åŒ–ç»„ä»¶ï¼Œå½¢æˆä¸€ä¸ªå…¨é¢çš„æ•°æ®å±•ç¤ºå’Œç›‘æ§é¢æ¿ã€‚ä»ªè¡¨ç›˜å¯ä»¥åŒ…å«å¤šä¸ªå›¾è¡¨ã€æŒ‡æ ‡å’Œæ•°æ®è¡¨æ ¼ï¼Œä¸ºç”¨æˆ·æä¾›å…¨é¢çš„æ•°æ®æ´å¯ŸåŠ›</p>
</li>
<li>
<p><strong>å®æ—¶æ•°æ®åˆ†æ</strong>ï¼š</p>
<p><code>Kibana</code>æ”¯æŒå®æ—¶æ•°æ®åˆ†æå’Œå®æ—¶æŸ¥è¯¢ï¼Œç”¨æˆ·å¯ä»¥å³æ—¶æŸ¥çœ‹å’Œåˆ†ææ•°æ®çš„å˜åŒ–å’Œè¶‹åŠ¿ã€‚è¿™å¯¹äºç›‘æ§å’Œæ“ä½œå®æ—¶ç³»ç»Ÿç‰¹åˆ«æœ‰ç”¨</p>
</li>
<li>
<p><strong>ç”¨æˆ·æƒé™å’Œå®‰å…¨æ€§</strong>ï¼š</p>
<p><code>Kibana</code>æä¾›äº†çµæ´»çš„ç”¨æˆ·æƒé™ç®¡ç†å’Œå®‰å…¨åŠŸèƒ½ï¼Œå…è®¸ç®¡ç†å‘˜å®šä¹‰å’Œæ§åˆ¶ç”¨æˆ·å¯¹ä¸åŒæ•°æ®å’ŒåŠŸèƒ½çš„è®¿é—®æƒé™ã€‚è¿™å¯¹äºå¤šç”¨æˆ·å’Œå¤šå›¢é˜Ÿåä½œä½¿ç”¨çš„ç¯å¢ƒéå¸¸é‡è¦ã€‚</p>
</li>
<li>
<p><strong>æ’ä»¶å’Œæ‰©å±•æ€§</strong>ï¼š</p>
<p><code>Kibana</code>æä¾›äº†ä¸°å¯Œçš„æ’ä»¶å’Œå¯æ‰©å±•çš„<code>API</code>ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œåœºæ™¯å®šåˆ¶å’Œæ‰©å±•<code>Kibana</code>çš„åŠŸèƒ½ã€‚ç¤¾åŒºå’Œç¬¬ä¸‰æ–¹å¼€å‘è€…å¯ä»¥é€šè¿‡æ’ä»¶æ‰©å±•<code>Kibana</code>çš„åŠŸèƒ½ï¼Œå¢åŠ æ–°çš„æ•°æ®å¤„ç†å’Œå¯è§†åŒ–èƒ½åŠ›ã€‚</p>
</li>
</ul>
</blockquote>
<ul>
<li><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>æ—¥å¿—åˆ†æå’Œç›‘æ§</strong>ï¼š</p>
<p>é€šè¿‡ç»“åˆ<code>Elasticsearch</code>å’Œ<code>Beats</code>ï¼Œ<code>Kibana</code>å¯ä»¥å®æ—¶åˆ†æå’Œç›‘æ§æ—¥å¿—æ•°æ®ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå‘ç°å’Œè§£å†³ç³»ç»Ÿé—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>åº”ç”¨æ€§èƒ½ç›‘æ§</strong>ï¼š</p>
<p>é€šè¿‡é›†æˆ<code>Metricbeat</code>å’Œ<code>Elasticsearch</code>ï¼Œ<code>Kibana</code>å¯ä»¥å®æ—¶å±•ç¤ºå’Œåˆ†æåº”ç”¨ç¨‹åºçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¸®åŠ©å¼€å‘å›¢é˜Ÿä¼˜åŒ–åº”ç”¨æ€§èƒ½ã€‚</p>
</li>
<li>
<p><strong>å®‰å…¨äº‹ä»¶åˆ†æ</strong>ï¼š</p>
<p>ç»“åˆ<code>Auditbeat</code>å’Œ<code>Elasticsearch</code>ï¼Œ<code>Kibana</code>å¯ä»¥ç›‘æ§å’Œåˆ†æç³»ç»Ÿå’Œåº”ç”¨çš„å®‰å…¨äº‹ä»¶ï¼Œå¸®åŠ©å®‰å…¨å›¢é˜ŸåŠæ—¶å“åº”å’Œè°ƒæŸ¥å®‰å…¨äº‹ä»¶ã€‚</p>
</li>
</ul>
</blockquote>
<ul>
<li><a href="https://elastic.co/cn/downloads/kibana" rel="external" target="_self">ä¸‹è½½ã€è§£å‹<code>Kibana</code>å›¾å½¢åŒ–å±•ç¤ºå·¥å…·</a></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -O https://artifacts.elastic.co/downloads/kibana/kibana-8.3.3-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span>$ curl https://artifacts.elastic.co/downloads/kibana/kibana-8.3.3-linux-x86_64.tar.gz.sha512 | sha512sum -c - 
</span></span><span style="display:flex;"><span>$ tar -zxvf kibana-8.3.3-linux-x86_64.tar.gz
</span></span><span style="display:flex;"><span>$ cd kibana-8.3.3/ </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/kibana-8.3.3/config
</span></span><span style="display:flex;"><span>$ cp kibana.yml<span style="color:#f92672">{</span>,.bak<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;# é…ç½®ç«¯å£ï¼Œåœ¨6è¡Œä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.port: 5601
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å»æ‰æ³¨é‡Šï¼Œä¿®æ”¹ä¸ºæœ¬æœºIPï¼Œåœ¨11è¡Œä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.host: &#34;</span>KibanaæœåŠ¡æ‰€åœ¨IP<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å®šä¹‰ç”¨æˆ·åç§°ï¼Œç”¨äºæ ‡è¯† Kibana å®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.name: &#34;</span>your-hostname<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¯ç”¨æˆ–ç¦ç”¨ SSL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.ssl.enabled: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.ssl.certificate: /path/to/your/server.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.ssl.key: /path/to/your/server.key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å»æ‰æ³¨é‡Šï¼Œä¿®æ”¹ä¸ºelssticsearchçš„IPåœ°å€å’Œç«¯å£ï¼Œåœ¨43è¡Œä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.hosts: [&#34;</span>http://elssticsearchæœåŠ¡IP:9200<span style="color:#e6db74">&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#####  	è®¾ç½®Elasticsearchå‚æ•°é…ç½®   #####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.username: &#34;</span>kibana_system<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.password: &#34;</span>password<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.serviceAccountToken: &#34;</span>my_token<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.pingTimeout: 1500
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.requestTimeout: 30000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.maxSockets: 1024
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.compression: false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.requestHeadersWhitelist: [ authorization ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.customHeaders: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.shardTimeout: 30000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.ssl.certificate: /path/to/your/client.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.ssl.key: /path/to/your/client.key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.ssl.certificateAuthorities: [ &#34;</span>/path/to/your/CA.pem<span style="color:#e6db74">&#34; ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># elasticsearch.ssl.verificationMode: full
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##### è¯­è¨€é…ç½®English:&#34;</span>en<span style="color:#e6db74">&#34;, Chinese:&#34;</span>zh-CN<span style="color:#e6db74">&#34;, Japanese:&#34;</span>ja-JP<span style="color:#e6db74">&#34;, French:&#34;</span>fr-FR<span style="color:#e6db74">&#34; #####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># i18n.locale: &#34;</span>en<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>&gt;config/kibana.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sed -i &#39;/kibana.index:/a\\kibana.index: &#34;.kibana&#34;&#39; kibana.yml  	# æ–°ç‰ˆä¸å­˜åœ¨æ­¤å‚æ•°</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨æœåŠ¡ã€å¤„ç†ä¸èƒ½åˆ é™¤ç´¢å¼•é—®é¢˜<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾ï¼š5601<!-- raw HTML omitted --><!-- raw HTML omitted -->ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ£€æµ‹å¯åŠ¨æ–¹å¼  </span>
</span></span><span style="display:flex;"><span>$ ps -p <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./bin/kibana
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘½ä»¤è¡Œæ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>$ curl -XPUT -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> http://localhost:9200/_all/_settings -d <span style="color:#e6db74">&#39;{&#34;index.blocks.read_only_allow_delete&#34;:null}&#39;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æµè§ˆå™¨</span>
</span></span><span style="display:flex;"><span>PUT _settings
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;index&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;blocks&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;read_only_allow_delete&#34;</span>: <span style="color:#e6db74">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;delete-es-index.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">date=`date -d &#34;7 days ago&#34; +%Y.%m.%d`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">curl -XDELETE -u &#39;elastic:dtyn!@$&#39; http://localhost:9200/*{$date}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_elk">Configure_ELK</h1>

<h2 id="é…ç½®elasticsearchredis">é…ç½®<code>elasticsearch+redis</code></h2>
<ul>
<li>
<ol>
<li><code>elasticsearch</code><!-- raw HTML omitted -->å‡ºç°é—®é¢˜æ€ä¹ˆå¤„ç†<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>æ¥ä¸‹æ¥æè¿°ä¼šé‡è§åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼šä¸€æ—¦æˆ‘ä»¬çš„<code>elasticsearch</code>å‡ºç°é—®é¢˜ï¼Œå°±ä¸èƒ½è¿›è¡Œæ—¥å¿—é‡‡é›†å¤„ç†äº†ï¼è¿™ç§æƒ…å†µä¸‹è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</li>
<li><!-- raw HTML omitted -->è§£å†³æ–¹æ¡ˆï¼š<!-- raw HTML omitted -->å¯ä»¥åœ¨<code>client</code>å’Œ<code>elasticsearch</code>ä¹‹é—´æ·»åŠ ä¸€ä¸ªä¸­é—´ä»¶ä½œä¸ºç¼“å­˜ï¼Œå…ˆå°†é‡‡é›†åˆ°çš„æ—¥å¿—å†…å®¹å†™åˆ°ä¸­é—´ä»¶ä¸Šï¼Œç„¶åå†ä»ä¸­é—´ä»¶è¾“å…¥åˆ°<code>elasticsearch</code>ä¸­ã€‚
è¿™å°±å®Œç¾çš„è§£å†³äº†ä¸Šè¿°çš„é—®é¢˜äº†ã€‚<code>ELK</code>ä¸­ä½¿ç”¨<code>redis</code>ä½œä¸ºä¸­é—´ä»¶ï¼Œç¼“å­˜æ—¥å¿—é‡‡é›†å†…å®¹</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl <span style="color:#e6db74">&#39;localhost:9200/_cat/health?v&#39;</span>  	<span style="color:#75715e"># æ£€æµ‹é›†ç¾¤æ˜¯å¦å¥åº·</span>
</span></span><span style="display:flex;"><span>$ curl <span style="color:#e6db74">&#39;localhost:9200/_cat/nodes?v&#39;</span>  	<span style="color:#75715e"># è·å–é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>$ curl <span style="color:#e6db74">&#39;localhost:9200/_cat/indices?v&#39;</span>  	<span style="color:#75715e"># åˆ—å‡ºæ‰€æœ‰ç´¢å¼•</span>
</span></span><span style="display:flex;"><span>$ curl -u user_name:password -X GET <span style="color:#e6db74">&#34;http://localhost:9200/_cluster/health?pretty&#34;</span>
</span></span><span style="display:flex;"><span>$ curl -XPUT <span style="color:#e6db74">&#39;localhost:9200/customer?pretty&#39;</span>  	<span style="color:#75715e"># åˆ›å»ºä¸€ä¸ªåä¸º&#34;customer&#34;çš„ç´¢å¼•</span>
</span></span><span style="display:flex;"><span>$ curl -XDELETE <span style="color:#e6db74">&#39;localhost:9200/customer?pretty&#39;</span>  	<span style="color:#75715e"># åˆ é™¤ä¸€ä¸ªåä¸º&#34;customer&#34;çš„ç´¢å¼•</span>
</span></span><span style="display:flex;"><span>$ curl localhost:9200/_cat/segments/<span style="color:#f92672">{</span>indexName<span style="color:#f92672">}</span>|wc -l  	<span style="color:#75715e"># æŸ¥çœ‹æŸä¸ªç´¢å¼•çš„æ®µæ•°é‡ï¼šGET /nginx-2022-*/_segments</span>
</span></span><span style="display:flex;"><span>$ curl -XPOST 192.168.60.7:9200/indexName/_forcemerge?max_num_segments<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># åˆå¹¶æŸä¸ªç´¢å¼•çš„æ®µ</span>
</span></span><span style="display:flex;"><span>POST /nginx-2022-*/_forcemerge?max_num_segments<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æ”¯æŒé€šé…ç¬¦</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;delete_es_index.sh<span style="color:#e6db74">&lt;&lt;-EOF 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®šæœŸåˆ é™¤ä¸¤ä¸ªæœˆä¹‹å‰elasticsearchç´¢å¼•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">date=`date -d &#34;-2 months&#34; &#34;+%Y.%m&#34;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/usr/bin/curl -v --user elastic:elasticç”¨æˆ·å¯†ç  -XDELETE &#34;http://esæœºå™¨IP:9200/*-$date&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Redis</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /etc/redis.conf  	<span style="color:#75715e"># ä¿®æ”¹ä¸‹é¢ä¸¤è¡Œå†…å®¹</span>
</span></span><span style="display:flex;"><span>daemonize yes
</span></span><span style="display:flex;"><span>bind 192.168.1.160
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl start redis
</span></span><span style="display:flex;"><span>$ lsof -i:6379
</span></span><span style="display:flex;"><span>COMMAND     PID  USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME
</span></span><span style="display:flex;"><span>redis-ser <span style="color:#ae81ff">19474</span> redis    4u  IPv4 <span style="color:#ae81ff">1344465</span>      0t0  TCP elk-node1:6379 <span style="color:#f92672">(</span>LISTEN<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ redis-cli -h 192.168.1.160
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; info
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Server</span>
</span></span><span style="display:flex;"><span>redis_version:2.8.19
</span></span><span style="display:flex;"><span>.......</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç¼–å†™ä»<!-- raw HTML omitted --><code>Client</code><!-- raw HTML omitted -->ç«¯æ”¶é›†æ•°æ®çš„æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /opt/logstash/data/redis-out.conf
</span></span><span style="display:flex;"><span>input <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>stdin <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ‰§è¡Œæ”¶é›†æ•°æ®çš„æ–‡ä»¶ï¼Œå¹¶è¾“å…¥æ•°æ®<!-- raw HTML omitted --><code>hello redis</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f redis-out.conf 
</span></span><span style="display:flex;"><span>Settings: Default filter workers: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Logstash startup completed  	<span style="color:#75715e"># ä¸‹é¢è¾“å…¥æ•°æ®hello redis</span>
</span></span><span style="display:flex;"><span>hello redis</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->ä¸­æŸ¥çœ‹æ•°æ®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ redis-cli -h 192.168.1.160
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; info
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Server</span>
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Keyspace</span>
</span></span><span style="display:flex;"><span>db6:keys<span style="color:#f92672">=</span>1,expires<span style="color:#f92672">=</span>0,avg_ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>  	<span style="color:#75715e"># åœ¨æœ€ä¸‹é¢ä¸€è¡Œï¼Œæ˜¾ç¤ºæ˜¯db6</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; keys *
</span></span><span style="display:flex;"><span>1<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; LINDEX demo -1
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;{\&#34;message\&#34;:\&#34;hello redis\&#34;,\&#34;@version\&#34;:\&#34;1\&#34;,\&#34;@timestamp\&#34;:\&#34;2016-11-14T08:04:25.981Z\&#34;,\&#34;host\&#34;:\&#34;elk-node1\&#34;}&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->ç»§ç»­éšä¾¿å†™ç‚¹æ•°æ®æµ‹è¯•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f redis-out.conf
</span></span><span style="display:flex;"><span>Settings: Default filter workers: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Logstash startup completed
</span></span><span style="display:flex;"><span>hello redis
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">123456</span>
</span></span><span style="display:flex;"><span>asdf
</span></span><span style="display:flex;"><span>ert
</span></span><span style="display:flex;"><span>wang
</span></span><span style="display:flex;"><span>shi
</span></span><span style="display:flex;"><span>bo
</span></span><span style="display:flex;"><span>guohuihui
</span></span><span style="display:flex;"><span>as
</span></span><span style="display:flex;"><span>we
</span></span><span style="display:flex;"><span>r
</span></span><span style="display:flex;"><span>g
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>asdfjkdfsak
</span></span><span style="display:flex;"><span>5423wer
</span></span><span style="display:flex;"><span>34rt3
</span></span><span style="display:flex;"><span>6y
</span></span><span style="display:flex;"><span>7uj
</span></span><span style="display:flex;"><span>u
</span></span><span style="display:flex;"><span>io9
</span></span><span style="display:flex;"><span>sdjfhsdk890
</span></span><span style="display:flex;"><span>huanqiu
</span></span><span style="display:flex;"><span>huanqiuchain
</span></span><span style="display:flex;"><span>hqsb
</span></span><span style="display:flex;"><span>asda    </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="7">
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->ä¸­æŸ¥çœ‹é•¿åº¦<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ redis-cli -h 192.168.1.160
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; info
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Server</span>
</span></span><span style="display:flex;"><span>redis_version:2.8.19
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Keyspace</span>
</span></span><span style="display:flex;"><span>db6:keys<span style="color:#f92672">=</span>1,expires<span style="color:#f92672">=</span>0,avg_ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>  	<span style="color:#75715e"># æ˜¾ç¤ºæ˜¯db6</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; keys *
</span></span><span style="display:flex;"><span>1<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; LLEN demo
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>integer<span style="color:#f92672">)</span> <span style="color:#ae81ff">24</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="8">
<li><!-- raw HTML omitted -->å°†<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->ä¸­çš„å†…å®¹å†™åˆ°<!-- raw HTML omitted --><code>elasticsearch</code><!-- raw HTML omitted -->ä¸­<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim redis-in.conf
</span></span><span style="display:flex;"><span>input <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span> port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span> db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span> data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span> key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>elasticsearch <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> hosts <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;192.168.1.160:9200&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span> index <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;redis-in-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="9">
<li><!-- raw HTML omitted -->æ‰§è¡Œ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f  redis-in.conf --configtest
</span></span><span style="display:flex;"><span>Configuration OK
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f  redis-in.conf &amp;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨redisä¸­æŸ¥çœ‹ï¼Œå‘ç°æ•°æ®å·²è¢«è¯»å‡ºï¼š</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; LLEN demo
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>integer<span style="color:#f92672">)</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç™»é™†elasticsearchç•Œé¢æŸ¥çœ‹</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="10">
<li><!-- raw HTML omitted -->å°†æ”¶é›†åˆ°çš„æ‰€æœ‰æ—¥å¿—å†™å…¥åˆ°<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->ä¸­ã€‚è¿™äº†é‡æ–°å®šä¹‰ä¸€ä¸ªæ·»åŠ <!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->ç¼“å­˜åçš„æ€»æ–‡ä»¶<!-- raw HTML omitted --><code>shipper.conf</code><!-- raw HTML omitted -->ã€‚ï¼ˆå¯ä»¥å°†ä¹‹å‰æ‰§è¡Œçš„æ€»æ–‡ä»¶<!-- raw HTML omitted --><code>file.conf</code><!-- raw HTML omitted -->åœæ‰ï¼‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim shipper.conf
</span></span><span style="display:flex;"><span>input <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>file <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> path <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;/var/log/messages&#34;</span>
</span></span><span style="display:flex;"><span> type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system&#34;</span>
</span></span><span style="display:flex;"><span> start_position <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;beginning&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>file <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  path <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;/var/log/elasticsearch/huanqiu.log&#34;</span>
</span></span><span style="display:flex;"><span>  type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;es-error&#34;</span>
</span></span><span style="display:flex;"><span>  start_position <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;beginning&#34;</span>
</span></span><span style="display:flex;"><span>  codec <span style="color:#f92672">=</span>&gt; multiline <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      pattern <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;^\[&#34;</span>
</span></span><span style="display:flex;"><span>      negate <span style="color:#f92672">=</span>&gt; true
</span></span><span style="display:flex;"><span>      what <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;previous&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>file <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   path <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;/var/log/nginx/access_json.log&#34;</span>
</span></span><span style="display:flex;"><span>   codec <span style="color:#f92672">=</span>&gt; json
</span></span><span style="display:flex;"><span>   start_position <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;beginning&#34;</span>
</span></span><span style="display:flex;"><span>   type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;nginx-log&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>syslog <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system-syslog&#34;</span>
</span></span><span style="display:flex;"><span>    host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>    port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;514&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;system&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>    port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>    db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>    data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;es-error&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>   port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>   db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>   data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>   key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;nginx-log&#34;</span><span style="color:#f92672">{</span>   
</span></span><span style="display:flex;"><span>   redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>      port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>      db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>      data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>      key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;nginx-log&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;system-syslog&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>      port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>      db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>      data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>      key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system-syslog&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="11">
<li><!-- raw HTML omitted -->æ‰§è¡Œä¸Šé¢çš„æ–‡ä»¶ï¼ˆæå‰å°†ä¸Šé¢ä¹‹å‰å¯åŠ¨çš„<!-- raw HTML omitted --><code>file.conf</code><!-- raw HTML omitted -->æ–‡ä»¶çš„æ‰§è¡Œç»™ç»“æŸæ‰ï¼ï¼‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$  /opt/logstash/bin/logstash -f shipper.conf --configtest
</span></span><span style="display:flex;"><span>Configuration OK
</span></span><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f shipper.conf
</span></span><span style="display:flex;"><span>Settings: Default filter workers: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Logstash startup completed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨redisä¸­æŸ¥çœ‹ï¼š</span>
</span></span><span style="display:flex;"><span>$ redis-cli -h 192.168.1.160
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; info
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Server</span>
</span></span><span style="display:flex;"><span>redis_version:2.8.19
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span>.......
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Keyspace</span>
</span></span><span style="display:flex;"><span>db6:keys<span style="color:#f92672">=</span>1,expires<span style="color:#f92672">=</span>0,avg_ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>  	<span style="color:#75715e"># æ˜¾ç¤ºæ˜¯db6</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379&gt; <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; keys *
</span></span><span style="display:flex;"><span>1<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span>2<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;system&#34;</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; keys *
</span></span><span style="display:flex;"><span>1<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;nginx-log&#34;</span>
</span></span><span style="display:flex;"><span>2<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span>3<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;system&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¦å¼€ä¸€ä¸ªçª—å£ï¼Œæ·»åŠ ç‚¹æ—¥å¿—:</span>
</span></span><span style="display:flex;"><span>$ logger <span style="color:#e6db74">&#34;12325423&#34;</span>
</span></span><span style="display:flex;"><span>$ logger <span style="color:#e6db74">&#34;12325423&#34;</span>
</span></span><span style="display:flex;"><span>$ logger <span style="color:#e6db74">&#34;12325423&#34;</span>
</span></span><span style="display:flex;"><span>$ logger <span style="color:#e6db74">&#34;12325423&#34;</span>
</span></span><span style="display:flex;"><span>$ logger <span style="color:#e6db74">&#34;12325423&#34;</span>
</span></span><span style="display:flex;"><span>$ logger <span style="color:#e6db74">&#34;12325423&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆä¼šå¢åŠ æ—¥å¿—ï¼š</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; keys *
</span></span><span style="display:flex;"><span>1<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;system-syslog&#34;</span>
</span></span><span style="display:flex;"><span>2<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;nginx-log&#34;</span>
</span></span><span style="display:flex;"><span>3<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;demo&#34;</span>
</span></span><span style="display:flex;"><span>4<span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;system&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="12">
<li><!-- raw HTML omitted -->å¯ä»¥åœ¨ä»»æ„çš„ä¸€å°<!-- raw HTML omitted --><code>ES</code><!-- raw HTML omitted -->ä¸­å°†æ•°æ®ä»<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->è¯»å–åˆ°<!-- raw HTML omitted --><code>ES</code><!-- raw HTML omitted -->ä¸­ã€‚
ä¸‹é¢å’±ä»¬åœ¨<!-- raw HTML omitted --><code>elk-node2</code><!-- raw HTML omitted -->èŠ‚ç‚¹ï¼Œå°†æ•°æ®ä»<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->è¯»å–åˆ°<!-- raw HTML omitted --><code>ES</code><!-- raw HTML omitted -->ä¸­ï¼š
ç¼–å†™æ–‡ä»¶ï¼š<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat file.conf
</span></span><span style="display:flex;"><span>input <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system&#34;</span>
</span></span><span style="display:flex;"><span>   host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>   port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>   db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>   data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>   key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;es-error&#34;</span>
</span></span><span style="display:flex;"><span>   host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>   port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>   db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>   data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>   key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;es-error&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;nginx-log&#34;</span>
</span></span><span style="display:flex;"><span>      host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>      port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>      db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>      data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>      key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;nginx-log&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  redis <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system-syslog&#34;</span>
</span></span><span style="display:flex;"><span>      host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;192.168.1.160&#34;</span>
</span></span><span style="display:flex;"><span>      port <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>      db <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;6&#34;</span>
</span></span><span style="display:flex;"><span>      data_type <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;list&#34;</span>
</span></span><span style="display:flex;"><span>      key <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system-syslog&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;system&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    elasticsearch <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       hosts <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;192.168.1.160:9200&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>       index <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;es-error&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    elasticsearch <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       hosts <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;192.168.1.160:9200&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>       index <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;es-error-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;nginx-log&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   elasticsearch <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      hosts <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;192.168.1.160:9200&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>      index <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;nignx-log-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span>type<span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;system-syslog&#34;</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    elasticsearch <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       hosts <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;192.168.1.160:9200&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>       index <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;system-syslog-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f file.conf --configtest
</span></span><span style="display:flex;"><span>Configuration OK
</span></span><span style="display:flex;"><span>$ /opt/logstash/bin/logstash -f file.conf &amp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å»redisä¸­æ£€æŸ¥ï¼Œå‘ç°æ•°æ®å·²ç»è¢«è¯»å‡ºåˆ°elasticsearchä¸­äº†ã€åŒæ—¶ç™»é™†logstashå’Œkibanaçœ‹ï¼Œå‘ç°å¯ä»¥æ­£å¸¸æ”¶é›†åˆ°æ—¥å¿—äº†ã€‚</span>
</span></span><span style="display:flex;"><span>192.168.1.160:6379<span style="color:#f92672">[</span>6<span style="color:#f92672">]</span>&gt; keys *
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>empty list or set<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯ä»¥æ‰§è¡Œè¿™ä¸ª å»æŸ¥çœ‹nginxæ—¥å¿—ã€ä¹Ÿå¯ä»¥å¯åŠ¨å¤šä¸ªrediså†™åˆ°ESä¸­ï¼Œå…·ä½“æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè€Œå®šã€‚</span>
</span></span><span style="display:flex;"><span>$ ab -n10000 -c1 http://192.168.1.160/ </span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="message_queue">Message_Queue</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Message_Queue</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_activemq">Install_ActiveMQ</h1>

<h2 id="activemqéƒ¨ç½²"><code>ActiveMQ</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é€šè¿‡<!-- raw HTML omitted --><code>http://localhost:8161/admin/</code><!-- raw HTML omitted -->æ¥è®¿é—®<!-- raw HTML omitted --><code>ActiveMQ</code><!-- raw HTML omitted -->çš„æ§åˆ¶å°ç•Œé¢<!-- raw HTML omitted -->.</li>
<li>è´¦å·ï¼š<code>admin</code></li>
<li>å¯†ç ï¼š<code>admin</code></li>
<li>ç«¯å£ï¼š<code>8161</code>ï¼šåå°ç®¡ç†ç³»ç»Ÿï¼Œ<code>61616</code>ï¼šç»™<code>JAVA</code>ç¨‹åºè¿æ¥çš„<code>TCP</code>ç«¯å£</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo wget https://archive.apache.org/dist/activemq/5.15.16/apache-activemq-5.15.16-bin.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar zxvf apache-activemq-5.15.16-bin.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ bin<span style="color:#ae81ff">\a</span>ctivemq start
</span></span><span style="display:flex;"><span>$ bin<span style="color:#ae81ff">\a</span>ctivemq stop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘é€æ¶ˆæ¯çš„ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span>$ bin<span style="color:#ae81ff">\a</span>ctivemq producer --message <span style="color:#e6db74">&#34;My message&#34;</span> --messageCount <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ”¶æ¶ˆæ¯çš„ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span>$ bin<span style="color:#ae81ff">\a</span>ctivemq consumer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ§åˆ¶å°è¾“å‡º</span>
</span></span><span style="display:flex;"><span>$ bin<span style="color:#ae81ff">\a</span>ctivemq consumer</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_rocketmq">Install_RocketMQ</h1>

<h2 id="rocketmqéƒ¨ç½²"><code>Rocketmq</code>éƒ¨ç½²</h2>
<h3 id="å•æœºå•å®ä¾‹">å•æœºå•å®ä¾‹</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Rocketmq</code><!-- raw HTML omitted -->å¿…è¦æ¡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>64</code><!-- raw HTML omitted -->ä½<!-- raw HTML omitted --><code>JDK 1.8+</code></li>
<li><!-- raw HTML omitted --><code>Maven 3.2.x</code><!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted --><code>Git</code><!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä½¿ç”¨äº<!-- raw HTML omitted --><code>Broker</code><!-- raw HTML omitted -->æœåŠ¡å™¨<!-- raw HTML omitted --><code>4G+</code><!-- raw HTML omitted -->å¯ç”¨ç£ç›˜ç©ºé—´<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>JDK</code><!-- raw HTML omitted -->é…ç½®ç¯å¢ƒå˜é‡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.oracle.com/java/technologies/oracle-java-archive-downloads.html" rel="external" target="_self">æ‰“å¼€é“¾æ¥æ‰¾æ—©æœŸç‰ˆæœ¬</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/jdk-8u181-linux-x64.tar.gz -C /usr/local/src/  	<span style="color:#75715e"># åŠ å‹åˆ°æŒ‡å®šä½ç½®</span>
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/src/jdk1.8.0_181 /usr/local/jdk  	<span style="color:#75715e"># åšä¸ªè½¯é“¾æ¥ï¼Œå–æ¶ˆè½¯é“¾æ¥rm -rf /usr/local/jdk  æ–‡ä»¶åä¸è¦åŠ &#34;/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ ç¯å¢ƒå˜é‡</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">HISTSIZE=10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export TMOUT=600
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export HISTTIMEFORMAT=&#34;%F %T &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#######JDKç’°å¢ƒè®Šæ•¸########################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JAVA_HOME=/usr/local/jdk
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export JRE_HOME=$JAVA_HOME/jre
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export CLASSPATH=$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=$PATH:$JAVA_HOME/bin:$JAVA_HOME/jre/bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>&gt;&gt; /etc/profile
</span></span><span style="display:flex;"><span>$ source /etc/profile</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted --><a href="https://maven.apache.org/download.cgi" rel="external" target="_self">éƒ¨ç½²<code>maven3.2.2</code>ç‰ˆæœ¬</a><!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://downloads.apache.org/maven/maven-3/3.8.1/binaries/apache-maven-3.8.1-bin.tar.gz
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/apache-maven-3.8.1-bin.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/src/apache-maven-3.8.1/ /usr/local/maven
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#39;#####  æ·»åŠ mavenç¯å¢ƒå˜é‡  ########
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export MAVEN_HOME=/usr/local/maven
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">export PATH=${PATH}:${MAVEN_HOME}/bin&#39;</span> &gt;&gt;/etc/profile
</span></span><span style="display:flex;"><span>source /etc/profile
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cp /usr/local/src/apache-maven-3.8.1/conf/settings.xml ~/.m2/  	# æ‹·è´æ–‡ä»¶åˆ°æ­¤ç›®å½•ä¸‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># vim  ~/.m2/settings.xml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  &lt;profiles&gt;  	# æ‹·è´ä¸‹é¢å‡ è¡Œåˆ°&lt;profiles&gt;ä¸‹</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &lt;repositories&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#        &lt;repository&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#          &lt;id&gt;org.codehaus&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#          &lt;url&gt;https://repo1.maven.org/maven2/org/codehaus/&lt;/url&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#        &lt;/repository&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      &lt;/repositories&gt;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted --><a href="https://rocketmq.apache.org/docs/quick-start/" rel="external" target="_self">ä¸‹è½½å¹¶è§£å‹<code>rocketmq</code>å®‰è£…åŒ…ã€ä½¿ç”¨<code>mvn</code>æ‰“åŒ…</a><!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install unzip
</span></span><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://downloads.apache.org/rocketmq/4.8.0/rocketmq-all-4.8.0-source-release.zip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># äºŒè¿›åˆ¶æ–‡ä»¶åŒ…</span>
</span></span><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://downloads.apache.org/rocketmq/4.8.0/rocketmq-all-4.8.0-bin-release.zip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ unzip /usr/local/src/rocketmq-all-4.8.0-source-release.zip -d /usr/local/src/  	<span style="color:#75715e"># è§£å‹åˆ°æŒ‡å®šä½ç½®</span>
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/rocketmq-all-4.8.0-source-release
</span></span><span style="display:flex;"><span>$ mvn -Prelease-all -DskipTests clean install -U
</span></span><span style="display:flex;"><span>$ cd distribution/target/rocketmq-4.8.0/rocketmq-4.8.0</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨åç§°æœåŠ¡å™¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup sh bin/mqnamesrv &amp;
</span></span><span style="display:flex;"><span>$ tail -f ~/logs/rocketmqlogs/namesrv.log</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å…ˆä¿®æ”¹ç»çºªäººæœåŠ¡å™¨é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /usr/local/src/rocketmq-all-4.8.0-source-release/distribution/target/rocketmq-4.8.0/rocketmq-4.8.0/bin/runbroker.sh
</span></span><span style="display:flex;"><span>JAVA_OPT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>JAVA_OPT<span style="color:#e6db74">}</span><span style="color:#e6db74"> -server -Xms128m -Xmx256m -Xmn256m&#34;</span>  	<span style="color:#75715e"># æ­¤å¤„å‡ ä¸ªå‚æ•°éœ€è¦ä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vim /usr/local/src/rocketmq-all-4.8.0-source-release/distribution/target/rocketmq-4.8.0/rocketmq-4.8.0/bin/runserver.sh
</span></span><span style="display:flex;"><span>JAVA_OPT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>JAVA_OPT<span style="color:#e6db74">}</span><span style="color:#e6db74"> -server -Xms128m -Xmx256m -Xmn256m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&#34;</span>  	<span style="color:#75715e"># ä¿®æ”¹Xms128m -Xmx256m &gt; -Xmn256m</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨ç»çºªäººæœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tail -f ~/logs/rocketmqlogs/broker.log  	<span style="color:#75715e"># æŠ¥é”™å¼‚å¸¸å…³é—­selinux</span>
</span></span><span style="display:flex;"><span>The broker<span style="color:#f92672">[</span>%s, 172.30.30.233:10911<span style="color:#f92672">]</span> boot success...</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å‘é€æ¥æ”¶æ¶ˆæ¯<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export NAMESRV_ADDR<span style="color:#f92672">=</span>localhost:9876
</span></span><span style="display:flex;"><span>$ sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer
</span></span><span style="display:flex;"><span>$ sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å…³é—­æœåŠ¡å™¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sh bin/mqshutdown broker
</span></span><span style="display:flex;"><span>The mqbroker<span style="color:#f92672">(</span>36695<span style="color:#f92672">)</span> is running...
</span></span><span style="display:flex;"><span>Send shutdown request to mqbroker<span style="color:#f92672">(</span>36695<span style="color:#f92672">)</span> OK
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sh bin/mqshutdown namesrv
</span></span><span style="display:flex;"><span>The mqnamesrv<span style="color:#f92672">(</span>36664<span style="color:#f92672">)</span> is running...
</span></span><span style="display:flex;"><span>Send shutdown request to mqnamesrv<span style="color:#f92672">(</span>36664<span style="color:#f92672">)</span> OK</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="é›†ç¾¤æ¨¡å¼éƒ¨ç½²">é›†ç¾¤æ¨¡å¼éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><a href="https://github.com/apache/rocketmq/blob/master/docs/cn/operation.md" rel="external" target="_self">è¿ç»´ç®¡ç†éƒ¨ç½²<code>Rocketmq</code></a></li>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>NameServer</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup sh  /usr/local/src/rocketmq-all-4.8.0-source-release/distribution/target/rocketmq-4.8.0/rocketmq-4.8.0/bin/mqnamesrv &amp;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->éªŒè¯<!-- raw HTML omitted --><code>Name Server</code><!-- raw HTML omitted -->æ˜¯å¦å¯åŠ¨æˆåŠŸ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tail -f ~/logs/rocketmqlogs/namesrv.log
</span></span><span style="display:flex;"><span>2021-04-24 16:51:14 INFO main - The Name Server boot success. serializeType<span style="color:#f92672">=</span>JSON</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å¹¶ä¿®æ”¹<!-- raw HTML omitted --><code>Rocketmq</code><!-- raw HTML omitted -->é›†ç¾¤é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/rocketmq-all-4.8.0-source-release/distribution/target/rocketmq-4.8.0/rocketmq-4.8.0/conf/2m-2s-sync
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@localhost 2m-2s-sync<span style="color:#f92672">]</span><span style="color:#75715e"># ll</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">928</span> Dec  <span style="color:#ae81ff">8</span> 18:16 broker-a.properties
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">922</span> Dec  <span style="color:#ae81ff">8</span> 18:16 broker-a-s.properties
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">928</span> Dec  <span style="color:#ae81ff">8</span> 18:16 broker-b.properties
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">922</span> Dec  <span style="color:#ae81ff">8</span> 18:16 broker-b-s.properties
</span></span><span style="display:flex;"><span>-rw-------. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">290</span> Apr <span style="color:#ae81ff">23</span> 22:47 nohup.out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vim broker-a-s.properties  	<span style="color:#75715e"># ä¸»æœºåšä¸»ä»å¿…æ·»åŠ ä¸¤å¤„</span>
</span></span><span style="display:flex;"><span>storePathRootDir<span style="color:#f92672">=</span>/opt/slave/broker-a-s
</span></span><span style="display:flex;"><span>listenPort <span style="color:#f92672">=</span> <span style="color:#ae81ff">10915</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>broker-a.properties</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;broker-a.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰€å±é›†ç¾¤åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=rocketmq-cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ ·ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-a
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 0:è¡¨ç¤º Masterï¼Œ&gt;0:è¡¨ç¤º Slave
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=mq-nameserver1:9876;mq-nameserver2:9876
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaultTopicQueueNums=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateSubscriptionGroup=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=10911
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">haListenPort=10912
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=04
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=120
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeCommitLog=1073741824
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeConsumeQueue=300000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># destroyMapedFileIntervalForcibly=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># redeleteHangedFileInterval=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">diskMaxUsedSpaceRatio=88
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathRootDir=/rocketmq/store
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLog å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathCommitLog=/rocketmq/store/commitlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathConsumeQueue=/rocketmq/store/consumequeue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathIndex=/rocketmq/store/index
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storeCheckpoint=/rocketmq/store/checkpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># abort æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">abortFile=/rocketmq/store/abort
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é™åˆ¶çš„æ¶ˆæ¯å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">maxMessageSize=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogLeastPages=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueLeastPages=2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogThoroughInterval=10000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueThoroughInterval=60000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker çš„è§’è‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_MASTER åŒæ­¥åŒå†™Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SYNC_MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ·ç›˜æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_FLUSH åŒæ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=ASYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkTransactionMessageEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sendMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pullMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¼ºåˆ¶æŒ‡å®šæœ¬æœºIPï¼Œéœ€è¦æ ¹æ®æ¯å°æœºå™¨è¿›è¡Œä¿®æ”¹ã€‚å®˜æ–¹ä»‹ç»å¯ä¸ºç©ºï¼Œç³»ç»Ÿé»˜è®¤è‡ªåŠ¨è¯†åˆ«ï¼Œä½†å¤šç½‘å¡æ—¶IPåœ°å€å¯èƒ½è¯»å–é”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=10.125.15.124
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>broker-a-s.properties</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;broker-a-s.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰€å±é›†ç¾¤åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=rocketmq-cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ ·ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-a-s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 0 è¡¨ç¤º Masterï¼Œ&gt;0 è¡¨ç¤º Slave
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=mq-nameserver1:9876;mq-nameserver2:9876
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaultTopicQueueNums=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateSubscriptionGroup=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=10923
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">haListenPort=10924
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=04
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=120
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeCommitLog=1073741824
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeConsumeQueue=300000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># destroyMapedFileIntervalForcibly=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># redeleteHangedFileInterval=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">diskMaxUsedSpaceRatio=88
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathRootDir=/rocketmq/store-s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLog å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathCommitLog=/rocketmq/store-s/commitlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathConsumeQueue=/rocketmq/store-s/consumequeue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathIndex=/rocketmq/store-s/index
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storeCheckpoint=/rocketmq/store-s/checkpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># abort æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">abortFile=/rocketmq/store-s/abort
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é™åˆ¶çš„æ¶ˆæ¯å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">maxMessageSize=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogLeastPages=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueLeastPages=2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogThoroughInterval=10000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueThoroughInterval=60000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker çš„è§’è‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_MASTER åŒæ­¥åŒå†™Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ·ç›˜æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_FLUSH åŒæ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=ASYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkTransactionMessageEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sendMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pullMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¼ºåˆ¶æŒ‡å®šæœ¬æœºIPï¼Œéœ€è¦æ ¹æ®æ¯å°æœºå™¨è¿›è¡Œä¿®æ”¹ã€‚å®˜æ–¹ä»‹ç»å¯ä¸ºç©ºï¼Œç³»ç»Ÿé»˜è®¤è‡ªåŠ¨è¯†åˆ«ï¼Œä½†å¤šç½‘å¡æ—¶IPåœ°å€å¯èƒ½è¯»å–é”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=10.125.15.125
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>broker-b.properties</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;broker-b.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰€å±é›†ç¾¤åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=rocketmq-cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ ·ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-b
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 0 è¡¨ç¤º Masterï¼Œ&gt;0 è¡¨ç¤º Slave
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=mq-nameserver1:9876;mq-nameserver2:9876
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaultTopicQueueNums=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateSubscriptionGroup=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=10911
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">haListenPort=10912
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=04
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=120
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeCommitLog=1073741824
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeConsumeQueue=300000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># destroyMapedFileIntervalForcibly=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># redeleteHangedFileInterval=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">diskMaxUsedSpaceRatio=88
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathRootDir=/rocketmq/store
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLog å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathCommitLog=/rocketmq/store/commitlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathConsumeQueue=/rocketmq/store/consumequeue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathIndex=/rocketmq/store/index
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storeCheckpoint=/rocketmq/store/checkpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># abort æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">abortFile=/rocketmq/store/abort
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é™åˆ¶çš„æ¶ˆæ¯å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">maxMessageSize=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogLeastPages=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueLeastPages=2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogThoroughInterval=10000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueThoroughInterval=60000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker çš„è§’è‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_MASTER åŒæ­¥åŒå†™Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SYNC_MASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ·ç›˜æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_FLUSH åŒæ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=ASYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkTransactionMessageEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sendMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pullMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¼ºåˆ¶æŒ‡å®šæœ¬æœºIPï¼Œéœ€è¦æ ¹æ®æ¯å°æœºå™¨è¿›è¡Œä¿®æ”¹ã€‚å®˜æ–¹ä»‹ç»å¯ä¸ºç©ºï¼Œç³»ç»Ÿé»˜è®¤è‡ªåŠ¨è¯†åˆ«ï¼Œä½†å¤šç½‘å¡æ—¶IPåœ°å€å¯èƒ½è¯»å–é”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=10.125.15.125
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>broker-b-s.properties</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;broker-b-s.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰€å±é›†ç¾¤åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerClusterName=rocketmq-cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ ·ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerName=broker-b-s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 0ï¼šè¡¨ç¤ºMasterï¼Œ&gt;0ï¼šè¡¨ç¤º Slave
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerId=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">namesrvAddr=mq-nameserver1:9876;mq-nameserver2:9876
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaultTopicQueueNums=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateTopicEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">autoCreateSubscriptionGroup=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listenPort=10923
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">haListenPort=10924
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deleteWhen=04
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileReservedTime=120
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeCommitLog=1073741824
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mapedFileSizeConsumeQueue=300000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># destroyMapedFileIntervalForcibly=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># redeleteHangedFileInterval=120000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">diskMaxUsedSpaceRatio=88
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathRootDir=/rocketmq/store-s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># commitLog å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathCommitLog=/rocketmq/store-s/commitlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathConsumeQueue=/rocketmq/store-s/consumequeue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storePathIndex=/rocketmq/store-s/index
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">storeCheckpoint=/rocketmq/store-s/checkpoint
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># abort æ–‡ä»¶å­˜å‚¨è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">abortFile=/rocketmq/store-s/abort
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é™åˆ¶çš„æ¶ˆæ¯å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">maxMessageSize=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogLeastPages=4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueLeastPages=2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushCommitLogThoroughInterval=10000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># flushConsumeQueueThoroughInterval=60000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Broker çš„è§’è‰²
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_MASTER åŒæ­¥åŒå†™Master
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerRole=SLAVE
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ·ç›˜æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># - SYNC_FLUSH åŒæ­¥åˆ·ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flushDiskType=ASYNC_FLUSH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># checkTransactionMessageEnable=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sendMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pullMessageThreadPoolNums=128
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¼ºåˆ¶æŒ‡å®šæœ¬æœºIPï¼Œéœ€è¦æ ¹æ®æ¯å°æœºå™¨è¿›è¡Œä¿®æ”¹ã€‚å®˜æ–¹ä»‹ç»å¯ä¸ºç©ºï¼Œç³»ç»Ÿé»˜è®¤è‡ªåŠ¨è¯†åˆ«ï¼Œä½†å¤šç½‘å¡æ—¶IPåœ°å€å¯èƒ½è¯»å–é”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">brokerIP1=10.125.15.124
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨å…¶ä»–å‡ ä¸ªèŠ‚ç‚¹æœåŠ¡å™¨å¯åŠ¨<!-- raw HTML omitted --><code>Master</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup sh mqbroker -n 192.168.1.1:9876 -c $ROCKETMQ_HOME/conf/2m-2s-async/broker-a.properties &amp;  	<span style="color:#75715e"># åœ¨æœºå™¨Aæœºå™¨å¯åŠ¨Master</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ nohup sh mqbroker -n 192.168.1.1:9876 -c $ROCKETMQ_HOME/conf/2m-2s-async/broker-b.properties &amp;  	<span style="color:#75715e"># åœ¨æœºå™¨Bæœºå™¨å¯åŠ¨Master</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ nohup sh mqbroker -n 192.168.1.1:9876 -c $ROCKETMQ_HOME/conf/2m-2s-async/broker-a-s.properties &amp;  	<span style="color:#75715e"># åœ¨æœºå™¨Cæœºå™¨å¯åŠ¨Slave</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ nohup sh mqbroker -n 192.168.1.1:9876 -c $ROCKETMQ_HOME/conf/2m-2s-async/broker-b-s.properties &amp;  	<span style="color:#75715e"># åœ¨æœºå™¨Cæœºå™¨å¯åŠ¨Slave</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>rocketmq-console</code><!-- raw HTML omitted -->å›¾å½¢åŒ–ç®¡ç†æ§åˆ¶å°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½å›¾å½¢åŒ–ç®¡ç†æ§åˆ¶å°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/apache/rocketmq-externals.git</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/local/src/rocketmq-externals/rocketmq-console/src/main/resources/application.properties<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç®¡ç†åå°è®¿é—®ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œé»˜è®¤ä¸ºç©ºï¼Œå¦‚æœå¡«å†™ï¼Œä¸€å®šè¦å‰é¢åŠ â€œ/â€ï¼Œåé¢ä¸è¦åŠ ï¼Œå¦åˆ™å¯åŠ¨æŠ¥é”™
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server.contextPath=/rocketmq
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¿é—®ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server.port=8080
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">### SSL setting  é»˜è®¤å°±è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.ssl.key-store=classpath:rmqcngkeystore.jks
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.ssl.key-store-password=rocketmq
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.ssl.keyStoreType=PKCS12
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># server.ssl.keyAlias=rmqcngkey
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># spring.application.index=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spring.application.name=rocketmq-console
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spring.http.encoding.charset=UTF-8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spring.http.encoding.enabled=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spring.http.encoding.force=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># logbacké…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå…ˆé»˜è®¤å³å¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">logging.config=classpath:logback.xml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># if this value is empty,use env value rocketmq.config.namesrvAddr  NAMESRV_ADDR | now, you can set it in ops page.default &gt; localhost:9876
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Name Serveråœ°å€ï¼Œä¿®æ”¹æˆä½ è‡ªå·±çš„æœåŠ¡åœ°å€ã€‚å¤šä¸ªåœ°å€ç”¨è‹±æ–‡åˆ†å·â€œ;â€éš”å¼€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.namesrvAddr=localhost:9876
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># if you use rocketmq version &lt; 3.5.8, rocketmq.config.isVIPChannel should be false.default true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.isVIPChannel=
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># rocketmq-console&#39;s data path:dashboard/monitor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.dataPath=/tmp/rocketmq-console/data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># set it false if you don&#39;t want use dashboard.default true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.enableDashBoardCollect=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># set the message track trace topic if you don&#39;t want use the default one
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.msgTrackTopicName=
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.ticketKey=ticket
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Must create userInfo file: ${rocketmq.config.dataPath}/users.properties if the login is required
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rocketmq.config.loginRequired=false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‰“åŒ…è¿è¡Œ<!-- raw HTML omitted --><code>rocketmq-console</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mvn clean package -Dmaven.test.skip<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/rocketmq-externals/rocketmq-console/target/
</span></span><span style="display:flex;"><span>$ java -jar rocketmq-console-ng-2.0.0.jar</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‰“å¼€æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ http://IP:8080/#/
</span></span><span style="display:flex;"><span>æ§åˆ¶å°â†’æ›´æ¢è¯­è¨€â†’Simplified Chinese<span style="color:#f92672">(</span>åˆ‡æ¢ä¸­æ–‡<span style="color:#f92672">)</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_redpanda">Install_Redpanda</h1>

<h2 id="redpandaéƒ¨ç½²"><code>Redpanda</code>éƒ¨ç½²</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://redpanda.com/" rel="external" target="_self"><code>Redpanda</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://docs.redpanda.com/current/deploy/deployment-option/self-hosted/" rel="external" target="_self"><code>Redpanda</code>éƒ¨ç½²æ–‡æ¡£</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_rabbitmq">Install_RabbitMQ</h1>

<h2 id="rabbitmqéƒ¨ç½²"><code>Rabbitmq</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><a href="https://blog.csdn.net/u011186019/article/details/51911234" rel="external" target="_self">å®‰è£…<code>RabbitMQ</code></a></li>
<li><a href="https://docs.celeryq.dev/en/stable/" rel="external" target="_self"><code>Celery</code>åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—</a></li>
</ul>
</blockquote>
<hr>
<h3 id="rabbitmqé›†ç¾¤å®‰è£…"><code>RabbitMQ</code>é›†ç¾¤å®‰è£…</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é›†ç¾¤æœåŠ¡å™¨é…ç½®<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th><code>IP</code></th>
<th>ä¸»æœºå</th>
<th>èŠ‚ç‚¹å±æ€§</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.150.21</td>
<td><code>rabbit-mq-01</code></td>
<td>å†…å­˜èŠ‚ç‚¹+<code>Haproxy</code>èŠ‚ç‚¹</td>
</tr>
<tr>
<td>192.168.150.22</td>
<td><code>rabbit-mq-02</code></td>
<td>å†…å­˜èŠ‚ç‚¹+<code>Haproxy</code>èŠ‚ç‚¹</td>
</tr>
<tr>
<td>192.168.150.23</td>
<td><code>rabbit-mq-03</code></td>
<td>ç£ç›˜èŠ‚ç‚¹</td>
</tr>
<tr>
<td>192.168.150.24</td>
<td><code>keepalived vip</code></td>
<td>æä¾›å¯¹å¤–<code>VIP</code></td>
</tr>
</tbody>
</table>
<ul>
<li><code>Erlang</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code> RabbitMQ</code>æ˜¯ç”¨<code>Erlang</code>è¯­è¨€ç¼–å†™çš„ï¼Œæˆ‘ä»¬å°†å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„<code>Erlang</code>åˆ°æœåŠ¡å™¨ä¸­ã€‚ <code>Erlang</code>åœ¨é»˜è®¤çš„<code>YUM</code>å­˜å‚¨åº“ä¸­ä¸å¯ç”¨ï¼Œå› æ­¤æ‚¨å°†éœ€è¦å®‰è£…<code>EPEL</code>å­˜å‚¨åº“ã€‚ è¿è¡Œä»¥ä¸‹å‘½ä»¤ç›¸åŒã€‚ åšå¥½<code>hosts</code>è§£æï¼Œ<!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾ç«¯å£<!-- raw HTML omitted --><code>port 25672</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y update
</span></span><span style="display:flex;"><span>$ yum -y install epel-release
</span></span><span style="display:flex;"><span>$ yum -y install erlang socat</span></span></code></pre></div></blockquote>
<ul>
<li><code>RabbitMQ</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>RabbitMQ</code>ä¸ºé¢„ç¼–è¯‘å¹¶å¯ä»¥ç›´æ¥å®‰è£…çš„ä¼ä¸š<code>Linuxç³»</code>ç»Ÿæä¾›<code>RPM</code>è½¯ä»¶åŒ…ã€‚ å”¯ä¸€éœ€è¦çš„ä¾èµ–æ˜¯å°†<code>Erlang</code>å®‰è£…åˆ°ç³»ç»Ÿä¸­ã€‚ æˆ‘ä»¬å·²ç»å®‰è£…<code>äº†Erlang</code>ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ä¸‹è½½<code>RabbitMQ</code>ã€‚
é€šè¿‡è¿è¡Œä¸‹è½½<code>Erlang RPM</code>è½¯ä»¶åŒ…</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm --import https://www.rabbitmq.com/rabbitmq-release-signing-key.asc
</span></span><span style="display:flex;"><span>$ wget https://www.rabbitmq.com/releases/rabbitmq-server/v3.6.10/rabbitmq-server-3.6.10-1.el7.noarch.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ rpm -Uvh rabbitmq-server-3.6.10-1.el7.noarch.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.7.19/rabbitmq-server-3.7.19-1.el7.noarch.rpm</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.7.19/rabbitmq-server-3.7.19-1.el7.noarch.rpm.asc</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¼€å¯ç¬¬ä¸€å°<!-- raw HTML omitted --><code>MQ</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start rabbitmq-server</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¤åˆ¶<!-- raw HTML omitted --><code>.erlang.cookie</code><!-- raw HTML omitted -->æ–‡ä»¶åˆ°å…¶ä»–ä¸¤å°<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->æœåŠ¡å™¨é›†ç¾¤èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ scp /var/lib/rabbitmq/.erlang.cookie rabbit-mq-02:/var/lib/rabbitmq/
</span></span><span style="display:flex;"><span>$ scp /var/lib/rabbitmq/.erlang.cookie rabbit-mq-03:/var/lib/rabbitmq/</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨å…¶ä»–ä¸¤å°é›†ç¾¤èŠ‚ç‚¹æœåŠ¡å™¨ä¸Šçš„<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chown -R rabbitmq. /var/lib/rabbitmq
</span></span><span style="display:flex;"><span>$ systemctl start rabbitmq-server</span></span></code></pre></div></blockquote>
<ul>
<li><code>Rabbitmq</code><!-- raw HTML omitted -->é›†ç¾¤è¿æ¥ã€é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´é˜²ç«å¢™å¼€å¯ï¼š<!-- raw HTML omitted --><code>4369</code><!-- raw HTML omitted -->ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl stop_app
</span></span><span style="display:flex;"><span>$ rabbitmqctl join_cluster rabbit@rabbit-mq-01
</span></span><span style="display:flex;"><span>$ rabbitmqctl start_app</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®é•œåƒæ¨¡å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl cluster_status
</span></span><span style="display:flex;"><span>$ rabbitmqctl set_policy ha-all <span style="color:#e6db74">&#34;^&#34;</span> <span style="color:#e6db74">&#39;{&#34;ha-mode&#34;:&#34;all&#34;}&#39;</span>
</span></span><span style="display:flex;"><span>$ rabbitmqctl cluster_status</span></span></code></pre></div></blockquote>
<ul>
<li>è®¾ç½®èŠ‚ç‚¹ä¿¡æ¯<!-- raw HTML omitted -->å†…å­˜èŠ‚ç‚¹ã€ç£ç›˜èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl stop_app
</span></span><span style="display:flex;"><span>$ rabbitmqctl change_cluster_node_type ram  	<span style="color:#75715e"># ç±»å‹(ram å†…å­˜)ã€(disc ç¡¬ç›˜)å»¶è¿Ÿæ’ä»¶å¿…é¡»ç¡¬ç›˜</span>
</span></span><span style="display:flex;"><span>$ rabbitmqctl start_app</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨æ‰€æœ‰èŠ‚ç‚¹æœºå™¨ä¸Šå¼€å¯<!-- raw HTML omitted --><code>rabbit</code><!-- raw HTML omitted -->ç›‘æ§<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmq-plugins enable rabbitmq_management</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="rabbitmqç”¨æˆ·æˆæƒ"><code>Rabbitmq</code>ç”¨æˆ·æˆæƒ</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ ç”¨æˆ·ã€ç”¨æˆ·å¯†ç éƒ½æ˜¯ï¼š<!-- raw HTML omitted --><code>admin</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl add_user admin admin</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>permissions</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl set_permissions -p <span style="color:#e6db74">&#34;/&#34;</span> admin <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®ç”¨æˆ·è§’è‰²æƒé™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl set_user_tags admin administrator</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é˜²ç«å¢™å¼€å¯ï¼š<!-- raw HTML omitted --><code>15672</code><!-- raw HTML omitted -->ç«¯å£ï¼Œä½¿ç”¨æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ http://IP:15672/</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="rabbitmqå®‰è£…å»¶æ—¶æ’ä»¶"><code>RabbitMQ</code>å®‰è£…å»¶æ—¶æ’ä»¶</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ‡æ¢å®‰è£…<!-- raw HTML omitted --><code>Rabbitmq</code><!-- raw HTML omitted -->æœåŠ¡ä¸»ç›®å½•<!-- raw HTML omitted --><code>plugins</code><!-- raw HTML omitted -->ä¸‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/lib/rabbitmq/lib/rabbitmq_server-3.6.10/plugins</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½å»¶æ—¶æ’ä»¶å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://dl.bintray.com/rabbitmq/community-plugins/3.6.x/rabbitmq_delayed_message_exchange/&gt; rabbitmq_delayed_message_exchange-20171215-3.6.x.zip</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è§£å‹å»¶æ—¶æ’ä»¶å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install unzip
</span></span><span style="display:flex;"><span>$ unzip  rabbitmq_delayed_message_exchange-20171215-3.6.x.zip
</span></span><span style="display:flex;"><span>$ cd ../sbin
</span></span><span style="display:flex;"><span>$ ./rabbitmq-plugins enable rabbitmq_delayed_message_exchange</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é‡å¯<!-- raw HTML omitted --><code>Rabitymq</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl restart rabbitmq-server</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="haproxyéƒ¨ç½²"><code>HAProxy</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li>ä½¿ç”¨<code>HAProxy</code>ä½¿<code>Rabbitmq</code>æœåŠ¡å®ç°é«˜å¯ç”¨</li>
<li><!-- raw HTML omitted -->ä¸¤å°æœåŠ¡å™¨éƒ½å®‰è£…<!-- raw HTML omitted --><code>HAProxy</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th><code>IP</code></th>
<th>ä¸»æœºå</th>
<th>èŠ‚ç‚¹å±æ€§</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.150.21</td>
<td><code>rabbit-mq-01</code></td>
<td>å†…å­˜èŠ‚ç‚¹+<code>Haproxy</code>èŠ‚ç‚¹ï¼Œ<!-- raw HTML omitted -->ç«¯å£ï¼š8888(<code>haproxy</code>ç›‘æ§ç«¯å£)ã€8889(<code>rabbitmq</code>&gt; æœåŠ¡ç«¯å£)<!-- raw HTML omitted --></td>
</tr>
<tr>
<td>192.168.150.22</td>
<td><code>rabbit-mq-02</code></td>
<td>å†…å­˜èŠ‚ç‚¹+<code>Haproxy</code>èŠ‚ç‚¹ï¼Œ<!-- raw HTML omitted -->ç«¯å£ï¼š8888(<code>haproxy</code>ç›‘æ§ç«¯å£)ã€8889(<code>rabbitmq</code>&gt; æœåŠ¡ç«¯å£)<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y haproxy </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/haproxy/haproxy.cfg<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # log /yougo/haproxy/home/log    local0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # log /yougo/haproxy/home/log    local1 notice
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # chroot /yougo/haproxy         # æ”¹å˜å½“å‰å·¥ä½œç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # stats socket /yougo/haproxy/home/admin.sock mode 660 level admin   # åˆ›å»ºç›‘æ§æ‰€ç”¨çš„å¥—æ¥å­—ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> pidfile  /var/run/haproxy.pid   # haproxyçš„pidå­˜æ”¾è·¯å¾„,å¯åŠ¨è¿›ç¨‹çš„ç”¨æˆ·å¿…é¡»æœ‰æƒé™è®¿é—®æ­¤æ–‡ä»¶ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> maxconn  4000                   # æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤4000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  user   haproxy               # é»˜è®¤ç”¨æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  group   haproxy              # é»˜è®¤ç”¨æˆ·ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> daemon                          # åˆ›å»º1ä¸ªè¿›ç¨‹è¿›å…¥deamonæ¨¡å¼è¿è¡Œã€‚æ­¤å‚æ•°è¦æ±‚å°†è¿è¡Œæ¨¡å¼è®¾ç½®ä¸º&#34;daemon
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # Default SSL material locations
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ca-base /etc/ssl/certs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # crt-base /etc/ssl/private
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # Default ciphers to use on SSL-enabled listening sockets.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # For more information, see ciphers(1SSL). This list is from:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #  https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ssl-default-bind-ciphers &gt; ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # ssl-default-bind-options no-sslv3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">###########é»˜è®¤é…ç½®#########
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">defaults
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> log global
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mode    http                # é»˜è®¤çš„æ¨¡å¼mode { tcp|http|health }ï¼Œtcpæ˜¯4å±‚ï¼Œhttpæ˜¯7å±‚ï¼Œhealthåªä¼šè¿”å›OK
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  httplog             # é‡‡ç”¨httpæ—¥å¿—æ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  dontlognull         # å¯ç”¨è¯¥é¡¹ï¼Œæ—¥å¿—ä¸­å°†ä¸ä¼šè®°å½•ç©ºè¿æ¥ã€‚æ‰€è°“ç©ºè¿æ¥å°±æ˜¯åœ¨ä¸Šæ¸¸çš„è´Ÿè½½å‡è¡¡å™¨æˆ–è€…ç›‘æ§ç³»ç»Ÿä¸ºäº†æ¢æµ‹è¯¥æœåŠ¡æ˜¯å¦å­˜æ´»å¯ç”¨æ—¶,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                             # éœ€è¦å®šæœŸçš„è¿æ¥æˆ–è€…è·å–æŸä¸€å›ºå®šçš„ç»„ä»¶æˆ–é¡µé¢,æˆ–è€…æ¢æµ‹æ‰«æç«¯å£æ˜¯å¦åœ¨ç›‘å¬æˆ–å¼€æ”¾ç­‰åŠ¨ä½œè¢«ç§°ä¸ºç©ºè¿æ¥;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                             # å®˜æ–¹æ–‡æ¡£ä¸­æ ‡æ³¨ï¼Œå¦‚æœè¯¥æœåŠ¡ä¸Šæ¸¸æ²¡æœ‰å…¶ä»–çš„è´Ÿè½½å‡è¡¡å™¨çš„è¯ï¼Œå»ºè®®ä¸è¦ä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                             # è¯¥å‚æ•°ï¼Œå› ä¸ºäº’è”ç½‘ä¸Šçš„æ¶æ„æ‰«ææˆ–å…¶ä»–åŠ¨ä½œå°±ä¸ä¼šè¢«è®°å½•ä¸‹æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout connect 5000        # è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout client  50000       # å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout server  50000       # æœåŠ¡å™¨ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  httpclose        # æ¯æ¬¡è¯·æ±‚å®Œæ¯•åä¸»åŠ¨å…³é—­httpé€šé“ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  httplog          # æ—¥å¿—ç±»åˆ«httpæ—¥å¿—æ ¼å¼ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #option  forwardfor      # å¦‚æœåç«¯æœåŠ¡å™¨éœ€è¦è·å¾—å®¢æˆ·ç«¯çœŸå®ipéœ€è¦é…ç½®çš„å‚æ•°ï¼Œå¯ä»¥ä»Http Headerä¸­è·å¾—å®¢æˆ·ç«¯ip  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option  redispatch       # serverIdå¯¹åº”çš„æœåŠ¡å™¨æŒ‚æ‰å,å¼ºåˆ¶å®šå‘åˆ°å…¶ä»–å¥åº·çš„æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout connect 10000    # default 10 second timeout if a backend is not found
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> maxconn     60000        # æœ€å¤§è¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> retries     3            # 3æ¬¡è¿æ¥å¤±è´¥å°±è®¤ä¸ºæœåŠ¡ä¸å¯ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åé¢è®¾ç½® 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 400 /yougo/haproxy/home/errors/400.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 403 /yougo/haproxy/home/errors/403.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 408 /yougo/haproxy/home/errors/408.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 500 /yougo/haproxy/home/errors/500.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 502 /yougo/haproxy/home/errors/502.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 503 /yougo/haproxy/home/errors/503.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # errorfile 504 /yougo/haproxy/home/errors/504.http
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">####################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listen http_front
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     bind 0.0.0.0:8888           # ç›‘å¬ç«¯å£  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats refresh 30s           # ç»Ÿè®¡é¡µé¢è‡ªåŠ¨åˆ·æ–°æ—¶é—´  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats uri /haproxy?stats    # ç»Ÿè®¡é¡µé¢url  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats realm Haproxy Manager # ç»Ÿè®¡é¡µé¢å¯†ç æ¡†ä¸Šæç¤ºæ–‡æœ¬  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     stats auth admin:admin      # ç»Ÿè®¡é¡µé¢ç”¨æˆ·åå’Œå¯†ç è®¾ç½®  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     #stats hide-version         # éšè—ç»Ÿè®¡é¡µé¢ä¸ŠHAProxyçš„ç‰ˆæœ¬ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#####################RabbitMQçš„ç®¡ç†ç•Œé¢ä¹Ÿæ”¾åœ¨HAProxyåé¢äº†###############################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#listen rabbitmq_admin 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#    bind 0.0.0.0:8004
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#   server node1 192.168.0.31:15672
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#    server node2 192.168.0.32:15672
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#    server node3 192.168.0.33:15672
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">####################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">listen rabbitmq_cluster
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> bind 0.0.0.0:8889  	# rabbitmqé›†ç¾¤è°ƒç”¨çš„ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option tcplog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mode tcp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout client  3h
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> timeout server  3h
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> option          clitcpka
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> balance roundrobin  	# è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ˆ#banlance roundrobin è½®è¯¢ï¼Œbalance source ä¿å­˜sessionå€¼ï¼Œæ”¯æŒstatic-rrï¼Œleastconnï¼Œfirstï¼Œuriç­‰å‚æ•°ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance url_param userid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance url_param session_id check_post 64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance hdr(User-Agent)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance hdr(host)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance hdr(Host) use_domain_only
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance rdp-cookie
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance leastconn
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # balance source //ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server   rabbitmq1  172.16.0.30:5672 check inter 5s rise 2 fall 3  	# check inter 2000 æ˜¯æ£€æµ‹å¿ƒè·³é¢‘ç‡ï¼Œrise &gt; 2æ˜¯2æ¬¡æ­£ç¡®è®¤ä¸ºæœåŠ¡å™¨å¯ç”¨ï¼Œfall 3æ˜¯3æ¬¡å¤±è´¥è®¤ä¸ºæœåŠ¡å™¨ä¸å¯ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server   rabbitmq2  172.16.0.31:5672 check inter 5s rise 2 fall 3  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server   rabbitmq3  172.16.0.32:5672 check inter 5s rise 2 fall 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸¤å°<!-- raw HTML omitted --><code>HAProxy</code><!-- raw HTML omitted -->æœåŠ¡å™¨å¯åŠ¨æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start haproxy</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="keepalivedéƒ¨ç½²"><code>Keepalived</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y keepalived</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->ä¸»èŠ‚ç‚¹<!-- raw HTML omitted --><code>Master</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global_defs {  	# å…¨å±€é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email {  	# æŒ‡å®škeepalivedåœ¨å‘ç”Ÿåˆ‡æ¢æ—¶éœ€è¦éœ€è¦å‘é€Emailçš„å¯¹è±¡ï¼Œä¸€è¡Œä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   user@example.com  	# æŒ‡å®šçš„æ”¶ä»¶äºº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email_from mail@example.org  	# æŒ‡å®šçš„å‘ä»¶äºº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_server 192.168.200.1  	# æŒ‡å®šçš„SMTPæœåŠ¡å™¨åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_connect_timeout 30  	# æŒ‡å®šSMTPè¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">router_id Rabbitmq_Dev  	# æ­¤å¤„æ³¨æ„router_idä¸ºè´Ÿè½½å‡è¡¡æ ‡è¯†ï¼Œåœ¨å±€åŸŸç½‘å†…åº”è¯¥æ˜¯å”¯ä¸€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vrrp_instance VI_1 {  	# ç›‘æ§å¤šä¸ªç½‘æ®µçš„å®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> state MASTER  	# æŒ‡å®šKeepalivedçš„è§’è‰²ï¼ŒMASTERè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯ä¸»æœåŠ¡å™¨,BACKUPè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯å¤‡ç”¨æœåŠ¡å™¨ï¼Œæ‰€ä»¥è®¾ç½®priorityæ—¶è¦æ³¨æ„MASTERæ¯”BACKUPé«˜ã€‚å¦‚&gt; æœè®¾ç½®äº†nopreempt,é‚£ä¹ˆstateçš„è¿™ä¸ªå€¼ä¸èµ·ä½œç”¨ï¼Œä¸»å¤‡é priorityå†³å®šï¼Œå¿…é¡»å¤§å†™
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nopreempt  	# è®¾ç½®ä¸ºä¸æŠ¢å 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> interface eth0  	# æŒ‡å®šç›‘æµ‹ç½‘ç»œçš„æ¥å£ï¼Œå½“LVSæ¥ç®¡æ—¶ï¼Œå°†ä¼šæŠŠIPåœ°å€æ·»åŠ åˆ°è¯¥ç½‘å¡ä¸Šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> virtual_router_id 58  	# è™šæ‹Ÿè·¯ç”±æ ‡è¯†ï¼ŒåŒä¸€ä¸ªvrrpå®ä¾‹ä½¿ç”¨å”¯ä¸€çš„æ ‡è¯†ï¼ŒåŒä¸€ä¸ªvrrp_instanceä¸‹ï¼ŒMASTERå’ŒBACKUPå¿…é¡»ä¸€è‡´ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> priority 101  	# MASTERæƒé‡è¦é«˜äº   BACKUP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> advert_int 1  	# å¿ƒè·³æŠ¥æ–‡å‘é€é—´éš”
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> unicast_src_ip 192.168.150.21  	# é…ç½®å•æ’­çš„æºåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> unicast_peer { 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     192.168.150.22  	# é…ç½®å•æ’­çš„ç›®æ ‡åœ°å€ã€å¯¹ç«¯IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }  	# keepalivedåœ¨ç»„æ’­æ¨¡å¼ä¸‹æ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šå‘224.0.0.18çš„ç»„æ’­åœ°å€å‘é€ï¼Œäº§ç”Ÿä¼—å¤šçš„æ— ç”¨ä¿¡æ¯ï¼Œå¹¶ä¸”ä¼šäº§ç”Ÿå¹²æ‰°å’Œå†²çªï¼Œå¯ä»¥å°†ç»„æ’­çš„æ¨¡å¼æ”¹ä¸ºå•æ‹¨ã€‚è¿™æ˜¯ä¸€ç§å®‰&gt; å…¨çš„æ–¹æ³•ï¼Œé¿å…å±€åŸŸç½‘å†…æœ‰å¤§é‡çš„keepalivedé€ æˆè™šæ‹Ÿè·¯ç”±idçš„å†²çªã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> authentication {  	# è®¤è¯é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth_type PASS  	# ä¸»ä»æœåŠ¡å™¨éªŒè¯æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth_pass 1111  	# è®¤è¯å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> virtual_ipaddress {  	# è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªè™šæ‹ŸIPåœ°å€ï¼Œæ¯è¡Œä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     192.168.150.24/24 dev eth1 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> track_interface {  	# è®¾ç½®é¢å¤–çš„ç›‘æ§ï¼Œé‡Œé¢é‚£ä¸ªç½‘å¡å‡ºç°é—®é¢˜éƒ½ä¼šåˆ‡æ¢
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     eth0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->å¤‡ç”¨èŠ‚ç‚¹<!-- raw HTML omitted --><code>Backup</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/keepalived/keepalived.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global_defs {  	# å…¨å±€é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email {  	# æŒ‡å®šåœ¨keepalivedåœ¨å‘ç”Ÿåˆ‡æ¢æ—¶éœ€è¦å‘é€Emailçš„å¯¹è±¡ï¼Œä¸€è¡Œä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    user@example.com  	# æŒ‡å®šæ”¶ä»¶äºº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notification_email_from mail@example.org  	# æŒ‡å®šå‘ä»¶äºº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_server 192.168.200.1  	# æŒ‡å®šSMTPæœåŠ¡å™¨åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">smtp_connect_timeout 30  	# æŒ‡å®šSMTPè¿æ¥è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">router_id Rabbitmq_Dev  	# æ­¤å¤„æ³¨æ„router_idä¸ºè´Ÿè½½å‡è¡¡è¡¨ç¤ºï¼Œåœ¨å±€åŸŸç½‘åº”è¯¥æ˜¯å”¯ä¸€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vrrp_instance VI_1 {  	# ç›‘æ§å¤šä¸ªç½‘æ®µå®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> state BACKUP  	# æŒ‡å®šKeepalivedçš„è§’è‰²ï¼ŒMASTERè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯ä¸»æœåŠ¡å™¨,BACKUPè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯å¤‡ç”¨æœåŠ¡å™¨ï¼Œæ‰€ä»¥è®¾ç½®priorityæ—¶è¦æ³¨æ„MASTERæ¯”BACKUPé«˜ã€‚å¦‚&gt; æœè®¾ç½®äº†nopreempt,é‚£ä¹ˆstateçš„è¿™ä¸ªå€¼ä¸èµ·ä½œç”¨ï¼Œä¸»å¤‡é priorityå†³å®šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> nopreempt  	# è®¾ç½®ä¸ºä¸æŠ¢å  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> interface eth0  	# è®¾ç½®å®ä¾‹ç»‘å®šçš„ç½‘å¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> virtual_router_id 58  	# è™šæ‹Ÿè·¯ç”±æ ‡è¯†ï¼ŒåŒä¸€ä¸ªvrrpå®ä¾‹ä½¿ç”¨å”¯ä¸€çš„æ ‡è¯†ï¼ŒåŒä¸€ä¸ªvrrp_instanceä¸‹ï¼ŒMASTERå’ŒBACKUPå¿…é¡»ä¸€è‡´ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> priority 100  	# æƒé‡è¦ä½äºMASTER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> advert_int 1  	# å¿ƒè·³æŠ¥æ–‡å‘é€é—´éš”ã€æ£€æŸ¥é—´éš”é»˜è®¤1ç§’
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> unicast_src_ip 192.168.150.22  	# é…ç½®å•æ’­çš„æºåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> unicast_peer { 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     192.168.150.21  	# é…ç½®å•æ’­çš„ç›®æ ‡åœ°å€ã€å¯¹ç«¯IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }  	# keepalivedåœ¨ç»„æ’­æ¨¡å¼ä¸‹æ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šå‘224.0.0.18çš„ç»„æ’­åœ°å€å‘é€ï¼Œäº§ç”Ÿä¼—å¤šçš„æ— ç”¨ä¿¡æ¯ï¼Œå¹¶ä¸”ä¼šäº§ç”Ÿå¹²æ‰°å’Œå†²çªï¼Œå¯ä»¥å°†ç»„æ’­çš„æ¨¡å¼æ”¹ä¸ºå•æ‹¨ã€‚è¿™æ˜¯ä¸€ç§å®‰&gt; å…¨çš„æ–¹æ³•ï¼Œé¿å…å±€åŸŸç½‘å†…æœ‰å¤§é‡çš„keepalivedé€ æˆè™šæ‹Ÿè·¯ç”±idçš„å†²çªã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> authentication {  	# è®¾ç½®è®¤è¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth_type PASS  	# è®¤è¯æ–¹å¼æœ‰ä¸¤ç§PASSã€AHä¸¤ç§
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth_pass 1111  	# è®¤è¯å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # VIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> virtual_ipaddress {  	# è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªè™šæ‹ŸIPåœ°å€ï¼Œæ¯è¡Œä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     192.168.150.24/24 dev eth1 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Keepalived</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start keepalived</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="å…è®¸ç»„æ’­ç½‘æ®µå’Œvrrpåè®®é€šä¿¡">å…è®¸ç»„æ’­ç½‘æ®µå’Œ<code>vrrp</code>åè®®é€šä¿¡</h4>
<blockquote>
<ul>
<li><code>centos7 firewalld</code>å¼€å¯æƒ…å†µä¸‹ï¼Œä¼šé˜»æ–­ç»„æ’­å’Œ<code>vrrp</code>çš„åè®®é€šä¿¡ï¼Œå¯¼è‡´<code>Keepalived</code>è„‘è£‚æƒ…å†µï¼Œéœ€è¦åœ¨<code>keepalived</code>çš„ä¸¤å°æœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°±å¯ä»¥æ­£å¸¸é€šä¿¡</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT <span style="color:#ae81ff">0</span> --in-interface ç½‘å¡åç§°<span style="color:#f92672">(</span>eth0<span style="color:#f92672">)</span> --destination 224.0.0.18 --protocol &gt; vrrp -j ACCEPT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç›‘æ§ç½‘ç»œåè®®ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰è„‘è£‚æƒ…å†µ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tcpdump -i ç½‘å¡åç§°<span style="color:#f92672">(</span>eth0<span style="color:#f92672">)</span> vrrp -n</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>python</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>pika</code><!-- raw HTML omitted -->åŒ…è¿›è¡Œæµ‹è¯•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y python-pip
</span></span><span style="display:flex;"><span>$ pip install pika</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç”Ÿäº§ç«¯ç¨‹åºè„šæœ¬<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;Production.py<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># !/usr/bin/env python
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import pika
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">credentials = pika.PlainCredentials(&#39;admin&#39;,&#39;admin&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">connection = pika.BlockingConnection(pika.ConnectionParameters(
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#39;192.168.150.21&#39;,8889,&#39;/&#39;,credentials))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel = connection.channel()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel.queue_declare(queue=&#39;balance&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel.basic_publish(exchange=&#39;&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   routing_key=&#39;balance&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   body=&#39;Hello World!&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">print(&#34; [x] Sent &#39;Hello World!&#39;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">connection.close()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ¶ˆè´¹ç«¯ç¨‹åºè„šæœ¬<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;Consumption.py<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># !/usr/bin/env python
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import pika
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">credentials = pika.PlainCredentials(&#39;admin&#39;,&#39;admin&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">connection = pika.BlockingConnection(pika.ConnectionParameters(
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#39;192.168.150.21&#39;,8889,&#39;/&#39;,credentials))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel = connection.channel()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel.queue_declare(queue=&#39;balance&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel.basic_publish(exchange=&#39;&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   routing_key=&#39;balance&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   body=&#39;Hello World!&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">print(&#34; [x] Sent &#39;Hello World!&#39;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">connection.close()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_nsq">Install_Nsq</h1>

<h2 id="nsqéƒ¨ç½²"><code>nsq</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><a href="https://nsq.io/deployment/installing.html" rel="external" target="_self"><code>Nsq</code>å®˜ç½‘</a></li>
<li><!-- raw HTML omitted -->ä¸‹è½½<!-- raw HTML omitted --><code>nsq</code><!-- raw HTML omitted -->é¢„ç¼–è¯‘äºŒè¿›åˆ¶å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://s3.amazonaws.com/bitly-downloads/nsq/nsq-1.2.1.linux-amd64.go1.16.6.tar.gz</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è§£å‹å¯åŠ¨å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tar -zxvf nsq-1.2.1.linux-amd64.go1.16.6.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>$ cd nsq-1.2.1.linux-amd64.go1.16.6/bin/
</span></span><span style="display:flex;"><span>$ nohup ./nsqlookupd &amp;  	<span style="color:#75715e"># å¯åŠ¨nsqlookup</span>
</span></span><span style="display:flex;"><span>$ nohup ./nsqd --lookupd-tcp-address<span style="color:#f92672">=</span>127.0.0.1:4160 &amp;  	<span style="color:#75715e"># nsqd</span>
</span></span><span style="display:flex;"><span>$ nohup ./nsqadmin --lookupd-http-address<span style="color:#f92672">=</span>0.0.0.0:4161 --http-address<span style="color:#f92672">=</span>IP:8761 &amp; <span style="color:#75715e"># nsqadminç®¡ç†ï¼Œipéœ€è¦æ›´æ¢ä¸ºæœåŠ¡æ‰€åœ¨çš„æœåŠ¡å™¨IP</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æµ‹è¯•ã€è®¿é—®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -d <span style="color:#e6db74">&#39;hello world 1&#39;</span> <span style="color:#e6db74">&#39;http://127.0.0.1:4151/pub?topic=test&#39;</span>  	<span style="color:#75715e"># å†™å…¥æ¶ˆæ¯</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./nsq_to_file --topic<span style="color:#f92672">=</span>test --output-dir<span style="color:#f92672">=</span>/tmp/log --lookupd-http-address<span style="color:#f92672">=</span>127.0.0.1:4161  	<span style="color:#75715e"># æŠŠé˜Ÿåˆ—æ¶ˆæ¯å†™å…¥åˆ°æ–‡ä»¶</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é€šè¿‡æµè§ˆå™¨è®¿é—®<!-- raw HTML omitted -->nsqadmin</li>
</ul>
<blockquote>
<ul>
<li><code>http://IP:8761/</code></li>
</ul>
</blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_kafka">Install_Kafka</h1>

<h2 id="kafkaéƒ¨ç½²"><code>Kafka</code>éƒ¨ç½²</h2>
<h3 id="kafkaç®€ä»‹"><code>Kafka</code>ç®€ä»‹</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://kafka.apache.org/" rel="external" target="_self"><code>Kafka</code>å®˜ç½‘</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://segmentfault.com/a/1190000012730949" rel="external" target="_self">å®‰è£…åŠå¿«é€Ÿå…¥é—¨</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/gwyy/p/12206176.html" rel="external" target="_self"><code>php</code>å®‰è£…<code>kafka</code>æ‰©å±•</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://qii404.me/2018/02/02/kafka-cluster.html" rel="external" target="_self"><code>Kafka</code>é›†ç¾¤æ­å»ºè¿‡ç¨‹å’Œç®€å•ä½¿ç”¨</a></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>zookeeper</code><!-- raw HTML omitted -->ä¿å­˜æ‰€æœ‰é›†ç¾¤ä¸»æœºæ¶ˆæ¯å†…å®¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¼€å‘è¯­è¨€ï¼š<!-- raw HTML omitted --><code>Java/Scala</code><!-- raw HTML omitted -->ï¼Œæ”¯æŒåè®®ï¼šä»¿<!-- raw HTML omitted --><code>AMQP</code></li>
<li><code>Kafka</code>æ˜¯åˆ†å¸ƒå¼å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ,å®ƒæœ€åˆç”±<code>LinkedIn</code>å…¬å¸å¼€å‘ï¼Œä¹‹åæˆä¸º<code>Apache</code>é¡¹ç›®çš„ä¸€éƒ¨åˆ†</li>
<li><code>Kafka</code>æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œå¯åˆ’åˆ†çš„ï¼Œå†—ä½™å¤‡ä»½çš„æŒä¹…æ€§çš„æ—¥å¿—æœåŠ¡ï¼Œå®ƒä¸»è¦ç”¨äºå¤„ç†æ´»è·ƒçš„æµå¼æ•°æ®</li>
<li>äº‹åŠ¡å¤„ç†ä¸æ”¯æŒã€æ”¯æŒé›†ç¾¤ã€æ”¯æŒè´Ÿè½½å‡è¡¡ã€æ”¯æŒ<code>zookeeper</code>åŠ¨æ€æ‰©å®¹</li>
<li>æ‰€æœ‰æ¶ˆæ¯è‡ªåŠ¨ä¿å­˜ä¸¤å¤©æ—¶é—´</li>
<li><code>Kafka</code>ä¸ºäº†é¿å…éšæœºå†™å…¥å¸¦æ¥çš„æ—¶é—´æ¶ˆè€—ï¼Œé‡‡å–é¡ºåºå†™çš„æ–¹å¼å­˜å‚¨æ•°æ®</li>
<li><code>Kafka</code>é‡‡ç”¨é›¶æ‹·è´æŠ€æœ¯ï¼Œè®©æ•°æ®ä¼ è¾“æ›´åŠ è¿…é€Ÿ</li>
<li>æ‰¹é‡è¯»ä¹¦æ•°æ®ï¼Œå‡å°‘ç£ç›˜<code>IO</code>æ“ä½œï¼Œå¯ä»¥æå‡æ€§èƒ½</li>
<li>ä¸ºäº†ä¿è¯å†å²æ¶ˆæ¯ç»§ç»­å¯ä»¥è¢«æ¶ˆè´¹ï¼Œæä¾›ä¸€ä¸ª<code>offset</code>æŒ‡å‘ï¼Œé€šè¿‡æŒ‡å‘æ¥è´Ÿè´£æ¶ˆæ¯è¯»å–é¡ºåº</li>
<li>ç½‘ç»œä¼ è¾“é‡‡ç”¨æ•°æ®å‹ç¼©æ ¼å¼ï¼Œæ‰€ä»¥ä¼ è¾“æ›´å¿«ï¼Œå ç”¨å¸¦å®½è¶Šå°‘</li>
<li><code>Kafka</code>ä¸­æ•°æ®å¯ä»¥è®¾ç½®å‰¯æœ¬ï¼Œå¯ä»¥åœ¨å‡ºç°é—®é¢˜ä¹‹åä¾ç„¶ä¿è¯è¯¥æ•°æ®çš„æœ‰æ•ˆæ€§</li>
<li><code>Kafka</code><!-- raw HTML omitted -->æ•´ä½“é‡‡ç”¨æ˜¾ç¤ºåˆ†å¸ƒå¼æ¶æ„ï¼Œ<!-- raw HTML omitted --><code>producers</code>ã€<code>broker(Kafka)</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>consumers</code><!-- raw HTML omitted -->éƒ½å¯ä»¥æœ‰å¤šä¸ª<!-- raw HTML omitted --></li>
<li><code>producer</code>ã€<code>consumer</code><!-- raw HTML omitted -->å®ç°<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->æ³¨å†Œçš„æ¥å£ï¼Œæ•°æ®ä»<!-- raw HTML omitted --><code>producer</code><!-- raw HTML omitted -->å‘é€åˆ°<!-- raw HTML omitted --><code>broker</code>ï¼Œ<code>broker</code><!-- raw HTML omitted -->æ‰¿æ‹…ä¸€ä¸ªä¸­é—´ç¼“å­˜å’Œåˆ†å‘çš„ä½œç”¨ï¼Œ<!-- raw HTML omitted --><code>broker</code><!-- raw HTML omitted -->åˆ†å‘æ³¨å†Œåˆ°ç³»ç»Ÿä¸­çš„<!-- raw HTML omitted --><code>consumer</code></li>
<li><code>broker</code>çš„ä½œç”¨ç±»ä¼¼äºç¼“å­˜ï¼Œå³æ´»è·ƒçš„æ•°æ®å’Œç¦»çº¿å¤„ç†ç³»ç»Ÿä¹‹é—´çš„ç¼“å­˜ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šä¿¡ï¼Œæ˜¯åŸºäºç®€å•ï¼Œé«˜æ€§èƒ½ï¼Œä¸”ä¸ç¼–ç¨‹è¯­è¨€æ— å…³çš„<code>TCP</code>åè®®</li>
<li><code>Topic</code><!-- raw HTML omitted -->ï¼šç‰¹æŒ‡<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->å¤„ç†çš„æ¶ˆæ¯æº<!-- raw HTML omitted --><code>feeds of messages</code><!-- raw HTML omitted -->çš„ä¸åŒåˆ†ç±»<!-- raw HTML omitted --></li>
<li><code>Partition</code><!-- raw HTML omitted -->ï¼šä»£è¡¨åˆ†åŒºï¼Œå•æ ¸<!-- raw HTML omitted --><code>CPU</code><!-- raw HTML omitted -->ä¸€ä¸ªåˆ†åŒºï¼Œå¤šä¸ª<!-- raw HTML omitted --><code>CPU</code><!-- raw HTML omitted -->å¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºã€‚<!-- raw HTML omitted --><code>Topic</code><!-- raw HTML omitted -->ç‰©ç†ä¸Šçš„åˆ†ç»„ï¼Œä¸€ä¸ª<!-- raw HTML omitted --><code>topic</code><!-- raw HTML omitted -->å¯ä»¥åˆ†ä¸ºå¤šä¸ª<!-- raw HTML omitted --><code>partition</code><!-- raw HTML omitted -->ï¼Œæ¯ä¸ª<!-- raw HTML omitted --><code>partition</code><!-- raw HTML omitted -->æ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ï¼Œ<!-- raw HTML omitted --><code>partition</code><!-- raw HTML omitted -->ä¸­çš„æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªæœ‰åºçš„<!-- raw HTML omitted --><code>id(offset)</code></li>
<li><code>Message</code><!-- raw HTML omitted -->ï¼šæ¶ˆæ¯ï¼Œæ˜¯é€šä¿¡çš„åŸºæœ¬å•ä½ï¼Œæ¯ä¸ª<!-- raw HTML omitted --><code>producer</code><!-- raw HTML omitted -->å¯ä»¥å‘ä¸€ä¸ª<!-- raw HTML omitted --><code>topic</code><!-- raw HTML omitted -->(ä¸»é¢˜)å‘å¸ƒä¸€äº›æ¶ˆæ¯<!-- raw HTML omitted --></li>
<li><code>Producers</code><!-- raw HTML omitted -->ï¼šæ¶ˆæ¯å’Œæ•°æ®äº§ç”Ÿç€ï¼Œå‘<!-- raw HTML omitted --><code>Kafka</code>çš„ä¸€ä¸ª<code>topic</code><!-- raw HTML omitted -->å‘å¸ƒæ¶ˆæ¯çš„è¿‡ç¨‹å«åš<!-- raw HTML omitted --><code>producers</code></li>
<li><code>Consumers</code><!-- raw HTML omitted -->ï¼šæ¶ˆæ¯å’Œæ•°æ®æ¶ˆè´¹è€…ï¼Œè®¢é˜…<!-- raw HTML omitted --><code>topics</code><!-- raw HTML omitted -->å¹¶å¤„ç†å…¶å‘å¸ƒæ¶ˆæ¯çš„è¿‡ç¨‹å«åš<!-- raw HTML omitted --><code>consumers</code></li>
<li><code>Broker</code><!-- raw HTML omitted -->ï¼šç¼“å­˜ä»£ç†ï¼Œ<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->é›†ç¾¤ä¸­çš„ä¸€å°æˆ–è€…å¤šå°æœåŠ¡å™¨ç»Ÿç§°ä¸º<!-- raw HTML omitted --><code>broker</code></li>
<li><code>offset</code><!-- raw HTML omitted -->ä¸æ¶ˆæ¯è®¿é—®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>æ¶ˆè´¹è€…é€šè¿‡<code>offset</code>çš„æ–¹å¼æ¥å–å¾—æ¶ˆæ¯æ•°æ®ï¼Œåˆ©ç”¨<code>offset</code>åç§»æ”¹å˜æ¶ˆæ¯è¯»å–ä½ç½®ï¼Œå¯ä»¥å®ç°å†å²æ¶ˆæ¯è¯»å–</li>
<li>ä¸ºäº†é¿å…é¢‘ç¹çš„å¤§é‡å°æ•°æ®ç£ç›˜<code>IO</code>æ“ä½œï¼Œ<code>Kafka</code>é‡‡ç”¨æ‰¹é‡è¯»å–æ¨¡å¼å¤„ç†æ¶ˆæ¯</li>
<li>åœ¨é«˜è´Ÿè½½çŠ¶æ€ä¸‹ï¼Œä¸ºé˜²æ­¢æ— æ•ˆç‡çš„å­—èŠ‚å¤åˆ¶ï¼Œ<code>Kafka</code><!-- raw HTML omitted -->é‡‡ç”¨ç”±<!-- raw HTML omitted --><code>Producer</code>ï¼Œ<code>broker</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>consumer</code>å…±äº«çš„æ ‡å‡†åŒ–äºŒè¿›åˆ¶æ¶ˆæ¯æ ¼å¼ï¼Œè¿™æ ·æ•°æ®åº“å°±å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´è‡ªç”±ä¼ è¾“ï¼Œæ— éœ€è½¬æ¢ï¼Œé™ä½äº†å­—èŠ‚å¤åˆ¶æˆæœ¬å¼€é”€</li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<hr>
<h3 id="kafkaå›¾å½¢åŒ–é¡µé¢"><code>Kafka</code>å›¾å½¢åŒ–é¡µé¢</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://juejin.cn/post/6971224791793532941#heading-4" rel="external" target="_self"><code>Kafka</code>å›¾å½¢åŒ–å·¥å…·<code>Eagle</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/provectus/kafka-ui" rel="external" target="_self"><code>Apache Kafka</code>çš„ç”¨æˆ·ç•Œé¢</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/obsidiandynamics/kafdrop" rel="external" target="_self"><code>Kafdrop â€“ Kafka Web UI</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/smartloli/EFAK" rel="external" target="_self"><code>Eagle For Apache Kafka</code>ä»¥å‰ç§°ä¸º<code>Kafka Eagle</code></a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="kafkaå•èŠ‚ç‚¹éƒ¨ç½²"><code>Kafka</code>å•èŠ‚ç‚¹éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><a href="https://kafka.apache.org/quickstart" rel="external" target="_self"><code>Kafka</code>å®‰è£…</a></li>
<li><!-- raw HTML omitted -->å•æœºéƒ¨ç½²å•å®ä¾‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½ã€è§£å‹<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://archive.apache.org/dist/kafka/2.8.1/kafka_2.13-2.8.1.tgz
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/srckafka_2.13-2.8.1.tgz -C /opt/
</span></span><span style="display:flex;"><span>$ cd /opt/
</span></span><span style="display:flex;"><span>$ mv kafka_2.13-2.8.1/ kafka</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å•æœºå•å®ä¾‹ä¿®æ”¹<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^dataDir=/cdataDir=\/opt\/kafka\/zookeeper&#39;</span> /opt/kafka/config/zookeeper.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^broker.id=/cbroker.id=1&#39;</span> /opt/kafka/config/server.properties  	<span style="color:#75715e"># é›†ç¾¤è®¾ç½®ä¸åŒid</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^log.dirs=/clog.dirs=/opt/kafka/logs/logs-1&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Kafkaé»˜è®¤ç«¯å£å·ï¼š9092ï¼Œå¦‚æœè¦ä¿®æ”¹é»˜è®¤ç«¯å£æ‰§è¡Œä¸‹é¢ä¸¤æ¡å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/#advertised.listeners/a port=9095&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/#advertised.listeners/a advertised.listeners=PLAINTEXT://$IP:9095&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mkdir -p /opt/kafka/<span style="color:#f92672">{</span>zookeeper,logs<span style="color:#f92672">}</span>  	<span style="color:#75715e"># åˆ›å»ºæŒä¹…åŒ–ç›®å½•</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å•æœºå¯åŠ¨å•å®ä¾‹<!-- raw HTML omitted --><code>zookeeper</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>Kafka</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/kafka/bin/zookeeper-server-start.sh -daemon /opt/kafka/config/zookeeper.properties  	<span style="color:#75715e"># åå°å¯åŠ¨zookeeperè¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server.properties</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ‰§è¡Œæ£€æŸ¥å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ jps
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">14050</span> Kafka
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10042</span> QuorumPeerMain
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">15724</span> Jps</span></span></code></pre></div><p><a href="#R-image-feb5188e82ce56c213c75d2e4c43bc1d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kafka_Server/jps.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-feb5188e82ce56c213c75d2e4c43bc1d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kafka_Server/jps.png"></a></p>
</blockquote>
</blockquote>
<hr>
<h3 id="kafkaå•èŠ‚ç‚¹å¤šå®ä¾‹"><code>Kafka</code>å•èŠ‚ç‚¹å¤šå®ä¾‹</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å•æœºéƒ¨ç½²å¤šå®ä¾‹é›†ç¾¤æ¨¡å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^dataDir=/cdataDir=\/opt\/kafka\/zookeeper&#39;</span> /opt/kafka/config/zookeeper.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‹·è´ä¿®æ”¹kafkaé…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cp /opt/kafka/config/server.properties /opt/kafka/config/server-2.properties
</span></span><span style="display:flex;"><span>$ cp /opt/kafka/config/server.properties /opt/kafka/config/server-3.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ç¬¬ä¸€ä¸ªå®ä¾‹é…ç½®</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^broker.id=/cbroker.id=1&#39;</span> /opt/kafka/config/server.properties  <span style="color:#75715e"># é›†ç¾¤è®¾ç½®ä¸åŒid</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^log.dirs=/clog.dirs=/opt/kafka/logs/logs-1&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/#advertised.listeners/a advertised.listeners=PLAINTEXT://$IP:9092&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ç¬¬äºŒä¸ªå®ä¾‹</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^broker.id=/cbroker.id=2&#39;</span> /opt/kafka/config/server.properties  <span style="color:#75715e"># é›†ç¾¤è®¾ç½®ä¸åŒid</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^log.dirs=/clog.dirs=/opt/kafka/logs/logs-2&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/#advertised.listeners/a advertised.listeners=PLAINTEXT://$IP:9093&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ç¬¬ä¸‰ä¸ªå®ä¾‹</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^broker.id=/cbroker.id=3&#39;</span> /opt/kafka/config/server.properties  <span style="color:#75715e"># é›†ç¾¤è®¾ç½®ä¸åŒid</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^log.dirs=/clog.dirs=/opt/kafka/logs/logs-3&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/#advertised.listeners/a advertised.listeners=PLAINTEXT://$IP:9094&#39;</span> /opt/kafka/config/server.properties</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å•æœºå¯åŠ¨å¤šå®ä¾‹<!-- raw HTML omitted --><code>zookeeper</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>Kafka</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/kafka/bin/zookeeper-server-start.sh -daemon /opt/kafka/config/zookeeper.properties  	<span style="color:#75715e"># åå°å¯åŠ¨zookeeperè¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨Kafkaå¤šä¸ªå®ä¾‹</span>
</span></span><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server-2.properties
</span></span><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server-3.properties</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="kafkaé›†ç¾¤æ¨¡å¼"><code>Kafka</code>é›†ç¾¤æ¨¡å¼</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¤š<!-- raw HTML omitted --><code>zookeeper</code><!-- raw HTML omitted -->å¤š<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->å®ä¾‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½ã€è§£å‹<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://archive.apache.org/dist/kafka/2.8.1/kafka_2.13-2.8.1.tgz
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/srckafka_2.13-2.8.1.tgz -C /opt/
</span></span><span style="display:flex;"><span>$ cd /opt/
</span></span><span style="display:flex;"><span>$ mv kafka_2.13-2.8.1/ kafka</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>zookeeper</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/kafka/<span style="color:#f92672">{</span>zookeeper,logs<span style="color:#f92672">}</span>  	<span style="color:#75715e"># åˆ›å»ºæŒä¹…åŒ–ç›®å½•</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^dataDir=/cdataDir=\/opt\/kafka\/zookeeper&#39;</span> /opt/kafka/config/zookeeper.properties
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^broker.id=/cbroker.id=1&#39;</span> /opt/kafka/config/server.properties  	<span style="color:#75715e"># é›†ç¾¤è®¾ç½®ä¸åŒid</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^log.dirs=/clog.dirs=/opt/kafka/logs/logs-1&#39;</span> /opt/kafka/config/server.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/^zookeeper.connect=/czookeeper.connect=${IP-1}:2128,${IP-2}:2128,${IP-3}:2128&#39;</span> /opt/kafka/config/server.properties</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¤š<!-- raw HTML omitted --><code>zookeeper</code><!-- raw HTML omitted -->å’Œå¤š<!-- raw HTML omitted --><code>Kafka</code><!-- raw HTML omitted -->å®ä¾‹å¯åŠ¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/kafka/bin/zookeeper-server-start.sh -daemon /opt/kafka/config/zookeeper.properties  	<span style="color:#75715e"># åå°å¯åŠ¨zookeeperè¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server.properties</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="åˆ›å»ºtopicæµ‹è¯•">åˆ›å»º<code>Topic</code>æµ‹è¯•</h3>
<blockquote>
<ul>
<li><code>--create</code><!-- raw HTML omitted -->ï¼šåˆ›å»º<!-- raw HTML omitted --></li>
<li><code>--zookeeper</code><!-- raw HTML omitted -->ï¼š ä½¿ç”¨<!-- raw HTML omitted --><code>zookeeper</code></li>
<li><code>--replication-factor 1</code><!-- raw HTML omitted -->ï¼š ä½¿ç”¨<code>1</code>ä¸ªå‰¯æœ¬<!-- raw HTML omitted --></li>
<li><code>--partitions 1</code><!-- raw HTML omitted -->ï¼šå¯ç”¨åˆ†åŒºæ•°é‡<!-- raw HTML omitted --></li>
<li><code>--topic test</code><!-- raw HTML omitted -->ï¼š ä¸»é¢˜åå­—ï¼š<!-- raw HTML omitted --><code>test</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test  	<span style="color:#75715e"># ä½¿ç”¨kafka-console-producer.sh äº§ç”Ÿæ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯</span>
</span></span><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-console-consumer.sh --topic test --from-beginning --bootstrap-server localhost:9092  	<span style="color:#75715e"># ä½¿ç”¨kafka-console-consumer.shæ¶ˆè´¹æ¶ˆæ¯</span></span></span></code></pre></div><ul>
<li><code>--from-beginning</code><!-- raw HTML omitted -->ï¼š æ¥å—å†å²æ¶ˆæ¯å‚æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/kafka/bin/kafka-topics.sh --describe --topic test --bootstrap-server localhost:9092  	<span style="color:#75715e"># æŸ¥çœ‹topicsæè¿°ä¿¡æ¯</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¬¬ä¸€è¡Œç»™å‡ºäº†æ‰€æœ‰åˆ†åŒºçš„æ‘˜è¦ï¼Œæ¯ä¸ªé™„åŠ è¡Œç»™å‡ºäº†å…³äºä¸€ä¸ªåˆ†åŒºçš„ä¿¡æ¯ã€‚ ç”±äºæˆ‘ä»¬åªæœ‰ä¸€ä¸ªåˆ†åŒºï¼Œæ‰€ä»¥åªæœ‰ä¸€è¡Œ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Leader</code><!-- raw HTML omitted -->ï¼šæ˜¯è´Ÿè´£ç»™å®šåˆ†åŒºçš„æ‰€æœ‰è¯»å–å’Œå†™å…¥çš„èŠ‚ç‚¹ã€‚ æ¯ä¸ªèŠ‚ç‚¹å°†æˆä¸ºåˆ†åŒºéšæœºé€‰æ‹©éƒ¨åˆ†çš„é¢†å¯¼è€…<!-- raw HTML omitted --></li>
<li><code>Replicas</code><!-- raw HTML omitted -->ï¼šæ˜¯å¤åˆ¶æ­¤åˆ†åŒºæ—¥å¿—çš„èŠ‚ç‚¹åˆ—è¡¨ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦æ˜¯é¢†å¯¼è€…ï¼Œæˆ–è€…å³ä½¿ä»–ä»¬å½“å‰å¤„äºæ´»åŠ¨çŠ¶æ€<!-- raw HTML omitted --></li>
<li><code>Isr</code><!-- raw HTML omitted -->ï¼šæ˜¯ä¸€ç»„â€œåŒæ­¥â€å‰¯æœ¬ã€‚è¿™æ˜¯å¤åˆ¶å“åˆ—è¡¨çš„å­é›†ï¼Œå½“å‰æ´»ç€å¹¶è¢«å¼•å¯¼åˆ°é¢†å¯¼è€…<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-71b2999a823898c925206e4299b68ca6" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kafka_Server/topics.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-71b2999a823898c925206e4299b68ca6"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Kafka_Server/topics.png"></a></p>
</blockquote>
</blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_rabbitmq">Configure_Rabbitmq</h1>

<h2 id="ä½¿ç”¨rabbitmq">ä½¿ç”¨<code>Rabbitmq</code></h2>
<h3 id="rabbitmqæ·»åŠ ç™»å½•è´¦æˆ·"><code>Rabbitmq</code>æ·»åŠ ç™»å½•è´¦æˆ·</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>/etc/rabbitmq/rabbitmq.config</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶ä¸‹æ·»åŠ ï¼Œ<!-- raw HTML omitted -->å¦‚æœä¸å­˜åœ¨å°±è‡ªè¡Œåˆ›å»º<!-- raw HTML omitted -->æ·»åŠ <!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>admin</code><!-- raw HTML omitted -->å°±æ˜¯ç”¨æˆ·åç§°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /etc/rabbitmq/rabbitmq.config
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">{</span>rabbit,<span style="color:#f92672">[{</span>tcp_listeners,<span style="color:#f92672">[</span>5672<span style="color:#f92672">]}</span>,<span style="color:#f92672">{</span>loopback_users,<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;admin&#34;</span><span style="color:#f92672">]}]}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span></span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨å‘½ä»¤æ·»åŠ ç”¨æˆ·å¹¶æˆæƒ æ·»åŠ ç”¨æˆ·<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl add_user admin admin</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>permissions</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl set_permissions -p <span style="color:#e6db74">&#34;/&#34;</span> admin <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span> <span style="color:#e6db74">&#34;.*&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¾ç½®ç”¨æˆ·è§’è‰²<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl set_user_tags admin administrator</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹æ–°æ·»åŠ çš„<!-- raw HTML omitted --><code>admin</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rabbitmqctl list_users</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹ç”¨äºçš„æƒé™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./rabbitmqctl list_permissions -p /</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="rabbitmqé—®é¢˜"><code>RabbitMQ</code>é—®é¢˜</h3>
<h4 id="rabbitmqæ— æ³•æ–°å»ºè¿æ¥é—®é¢˜å¤„ç†è¿‡ç¨‹è®°å½•"><code>RabbitMQ</code>æ— æ³•æ–°å»ºè¿æ¥é—®é¢˜å¤„ç†è¿‡ç¨‹è®°å½•</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç—‡çŠ¶æè¿°<!-- raw HTML omitted -->å®¢æˆ·åé¦ˆæ— æ³•äº‘å¹³å°<code>VNC</code>æ§åˆ¶å°çª—å£ä¸€ç›´å¤„äº<code>loading</code>çŠ¶æ€ï¼Œæ— æ³•æ‰“å¼€.</li>
<li>å®šä½è¿‡ç¨‹</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é¦–å…ˆæŸ¥çœ‹<!-- raw HTML omitted --><code>nova-api</code><!-- raw HTML omitted -->æœåŠ¡æ˜¯å¦æ­£å¸¸<!-- raw HTML omitted --><code>nova list</code><!-- raw HTML omitted -->æ­£å¸¸<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>nova service-list</code><!-- raw HTML omitted -->è¾“å‡ºï¼Œæ‰€æœ‰æœåŠ¡åœ¨çº¿<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>nova get-vnc-console</code><!-- raw HTML omitted -->è·å–äº‘ä¸»æœº<!-- raw HTML omitted --><code>vnc</code><!-- raw HTML omitted -->é“¾æ¥ï¼Œè¶…æ—¶æ— æ³•è·å–<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>åˆæ­¥æ‰¾åˆ°æ§åˆ¶å°çª—å£æ— æ³•æ‰“å¼€çš„åŸå› ï¼Œç»§ç»­åˆ†æé—®é¢˜</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹äº‘ä¸»æœºæ‰€åœ¨èŠ‚ç‚¹çš„<!-- raw HTML omitted --><code>nova-compute</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œä¸€åˆ‡æ­£å¸¸<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>nova-compute</code><!-- raw HTML omitted -->æ—¥å¿—ï¼Œæ²¡æœ‰æ”¶åˆ°åˆ›å»º<!-- raw HTML omitted --><code>vnc</code><!-- raw HTML omitted -->é“¾æ¥è¯·æ±‚<!-- raw HTML omitted --><code>vnc</code><!-- raw HTML omitted -->æ§åˆ¶å°é“¾æ¥æ˜¯åœ¨äº‘ä¸»æœºæ‰€åœ¨è®¡ç®—èŠ‚ç‚¹ç”Ÿæˆçš„ï¼Œå› ä¸ºè¦æŸ¥è¯¢äº‘ä¸»æœº<!-- raw HTML omitted --><code>qemu</code><!-- raw HTML omitted -->è¿›ç¨‹åˆ›å»ºçš„<!-- raw HTML omitted --><code>vnc server</code><!-- raw HTML omitted -->ç«¯å£å·ï¼Œåˆ›å»ºå®Œæˆåè¦æŠŠ<!-- raw HTML omitted --><code>token</code><!-- raw HTML omitted -->å’Œç«¯å£å·å¯¹åº”å…³ç³»ä¿å­˜åˆ°<!-- raw HTML omitted --><code>nova-consoleauth</code><!-- raw HTML omitted -->è¿›ç¨‹ï¼Œ<!-- raw HTML omitted --><code>nova-consoleauth</code><!-- raw HTML omitted -->è¿›ç¨‹ä¼šæ ¹æ®é…ç½®é¡¹å†³å®šæŠŠå¯¹åº”å…³ç³»ä¿å­˜åˆ°è¿›ç¨‹å†…å­˜è¿˜æ˜¯<!-- raw HTML omitted --><code>memcache</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œä¹‹å‰å¤„ç†è¿‡ä¸€æ¬¡æ§åˆ¶èŠ‚ç‚¹å†…å­˜ä¸è¶³å¯¼è‡´<!-- raw HTML omitted --><code>token</code><!-- raw HTML omitted -->ä¿å­˜å¤±è´¥çš„é—®é¢˜ï¼Œè¿™æ¬¡ä¹Ÿå…ˆæŸ¥äº†ä¸‹<!-- raw HTML omitted --><code>nova-consoleauth</code><!-- raw HTML omitted -->æ—¥å¿—ï¼Œæ²¡æœ‰å‘ç°ç±»ä¼¼æƒ…å†µ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>nova-api</code><!-- raw HTML omitted -->èŠ‚ç‚¹æ—¥å¿—ï¼Œå‘ç°æ”¶åˆ°äº†è¯·æ±‚ä½†æ²¡æœ‰è¿”å›<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æ‰“å¼€<!-- raw HTML omitted --><code>nova-api</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>nova-compute</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>debug</code><!-- raw HTML omitted -->æ—¥å¿—ç»§ç»­åˆ†æ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å‘ç°<!-- raw HTML omitted --><code>nova-api</code><!-- raw HTML omitted -->ä¸€ç›´åœ¨å°è¯•è¿æ¥åˆ°<!-- raw HTML omitted --><code>RabbitMQ</code><!-- raw HTML omitted -->ï¼Œä¸€ç›´å¡åœ¨<!-- raw HTML omitted --><code>connecting</code><!-- raw HTML omitted -->ï¼Œæ²¡æœ‰<!-- raw HTML omitted --><code>connected</code><!-- raw HTML omitted -->æ—¥å¿—<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>æ‰¾åˆ°æ›´è¿›ä¸€æ­¥çš„é—®é¢˜åŸå› ï¼Œç»§ç»­åˆ†æé—®é¢˜</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é¦–å…ˆé‡å¯<!-- raw HTML omitted --><code>nova-api</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œè¯•éªŒä¸‹èƒ½å¦æ¢å¤ï¼Œå‘ç°å¯åŠ¨è¿›ç¨‹æ—¶å¯ä»¥è¿æ¥åˆ°<!-- raw HTML omitted --><code>MQ</code>ï¼Œ<!-- raw HTML omitted -->ä½†è·å–<!-- raw HTML omitted --><code>vnc</code><!-- raw HTML omitted -->é“¾æ¥æ—¶é—®é¢˜ä»ç„¶å­˜åœ¨<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é€šè¿‡<!-- raw HTML omitted --><code>rabbitmqctl</code><!-- raw HTML omitted -->å‘½ä»¤è¡ŒæŸ¥çœ‹<!-- raw HTML omitted --><code>queue</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>exchange</code><!-- raw HTML omitted -->æƒ…å†µï¼Œä¹Ÿæ²¡å‘ç°å¼‚å¸¸ï¼Œäº‘ä¸»æœºèŠ‚ç‚¹çš„<!-- raw HTML omitted --><code>compute</code><!-- raw HTML omitted -->é˜Ÿåˆ—ä¹Ÿæœ‰<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é‡å¯<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œè¯•éªŒèƒ½å¦æ¢å¤ï¼Œé‡å¯åå‘ç°<!-- raw HTML omitted --><code>vnc</code><!-- raw HTML omitted -->é“¾æ¥è·å–å‘½ä»¤æ¢å¤æ­£å¸¸ï¼Œé¡µé¢æ‰“å¼€æ§åˆ¶å°çª—å£æ­£å¸¸<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>é—®é¢˜è§£å†³ä½†æ²¡æ‰¾åˆ°åŸå› ï¼Œäºæ˜¯ç»§ç»­è§‚å¯Ÿï¼Œç­‰äº†å¤§æ¦‚2åˆ†é’Ÿï¼Œå†æ¬¡å°è¯•æ‰“å¼€<code>vnc</code>æ§åˆ¶å°çª—å£ï¼Œå‘ç°è€é—®é¢˜è¿˜åœ¨ï¼Œä¸€ç›´<code>loading</code>ï¼Œç»§ç»­åˆ†æé—®é¢˜ï¼Œ</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->æœåŠ¡å™¨æ—¥å¿—ï¼Œå‘ç°å¼‚å¸¸<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å‘ç°é—®é¢˜æ ¹æœ¬åŸå› ï¼Œæ–‡ä»¶å¥æŸ„æ•°é‡è¶…å‡ºé™åˆ¶ï¼Œ<!-- raw HTML omitted --><code>google</code><!-- raw HTML omitted -->æœç´¢è¿™ä¸ªé”™è¯¯ï¼Œå‘ç°äº†è§£å†³æ–¹æ³•<!-- raw HTML omitted --><a href="https://my.oschina.net/moooofly/blog/678513" rel="external" target="_self">åŸåˆ›<code>RabbitMQ</code>ä¹‹<code>file descriptor limit alarm</code>åˆ†æ</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>=WARNING REPORT==== 25-Oct-2017::10:35:48 ===
file descriptor limit alarm set.

********************************************************************
*** New connections will not be accepted until this alarm clears ***
********************************************************************</code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é¦–å…ˆä¿®æ”¹<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->èŠ‚ç‚¹ç‰©ç†æœºæ–‡ä»¶å¥æŸ„æ•°é‡é…ç½®ï¼ˆå¢åŠ å¦‚ä¸‹ä¸¤è¡Œï¼‰<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /etc/security/limits.conf  | grep nofile
</span></span><span style="display:flex;"><span>* soft nofile <span style="color:#ae81ff">262144</span>
</span></span><span style="display:flex;"><span>* hard nofile <span style="color:#ae81ff">262144</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ulimit -n <span style="color:#ae81ff">65536</span>  	<span style="color:#75715e"># ä¹Ÿä¿®æ”¹</span></span></span></code></pre></div></blockquote>
<ul>
<li>é‡å¯<code>RabbitMQ</code>ï¼Œ<code>rabbitmqctl status</code>å‘½ä»¤æŸ¥çœ‹é™åˆ¶ï¼Œå‘ç°ä¸ç”Ÿæ•ˆï¼š</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŒ‰ç…§æœç´¢ç»“æœä¸­çš„æç¤ºæ‰§è¡Œï¼š<!-- raw HTML omitted --><code>rabbitmqctl stopã€rabbitmq-server -detached</code><!-- raw HTML omitted -->å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°å¥æŸ„æ•°é™åˆ¶å·²ä¿®æ”¹<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å°è¯•<!-- raw HTML omitted --><code>web</code><!-- raw HTML omitted -->æ‰“å¼€<!-- raw HTML omitted --><code>vnc</code><!-- raw HTML omitted -->çª—å£ï¼Œå‘ç°æ¢å¤æ­£å¸¸ï¼Œ<!-- raw HTML omitted --><code>nova-api</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>nova-compute</code><!-- raw HTML omitted -->æ—¥å¿—æ­£å¸¸<!-- raw HTML omitted --><code>connected</code><!-- raw HTML omitted -->åˆ°<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->ç­‰å¾…å‡ åˆ†é’Ÿä»ç„¶æ­£å¸¸ï¼Œé—®é¢˜è§£å†³<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code> {file_descriptors,
     [{total_limit,924},
      {total_used,525},</code></pre></div></blockquote>
<ul>
<li>å°è¯•ä¿®æ”¹å®‰è£…éƒ¨ç½²è„šæœ¬ï¼Œå‘ç°å…ˆä¿®æ”¹ç³»ç»Ÿå¥æŸ„æ•°é…ç½®å†å®‰è£…<code>MQ</code>ï¼Œä»ç„¶æ— æ³•ä¿®æ”¹<code>MQ</code>å¥æŸ„é™åˆ¶
ç»§ç»­<code>google</code>ï¼Œ<a href="https://www.rabbitmq.com/install-rpm.html" rel="external" target="_self">æŸ¥çœ‹åˆ°<code>RabbitMQ</code>å®˜æ–¹æ–‡æ¡£</a> æœ‰å¦‚ä¸‹æè¿°ï¼š</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0"><code>æ§åˆ¶ Linux ä¸Šçš„ç³»ç»Ÿé™åˆ¶

è¿è¡Œç”Ÿäº§å·¥ä½œè´Ÿè½½çš„ RabbitMQ å®‰è£…å¯èƒ½éœ€è¦ç³»ç»Ÿé™åˆ¶å’Œå†…æ ¸å‚æ•°è°ƒæ•´ï¼Œä»¥ä¾¿å¤„ç†ç›¸å½“æ•°é‡çš„å¹¶å‘è¿æ¥å’Œé˜Ÿåˆ—ã€‚éœ€è¦è°ƒæ•´çš„ä¸»è¦è®¾ç½®æ˜¯æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°ï¼Œä¹Ÿç§°ä¸ºulimit -nã€‚è®¸å¤šæ“ä½œç³»ç»Ÿä¸Šçš„é»˜è®¤å€¼å¯¹äºæ¶ˆæ¯ä¼ é€’ä»£ç†æ¥è¯´å¤ªä½äº†ï¼ˆä¾‹å¦‚ï¼Œåœ¨å‡ ä¸ª Linux å‘è¡Œç‰ˆä¸Šä¸º 1024ï¼‰ã€‚æˆ‘ä»¬å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºç”¨æˆ· rabbitmq å…è®¸è‡³å°‘ 65536 ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚å¯¹äºå¤§å¤šæ•°å¼€å‘å·¥ä½œè´Ÿè½½ï¼Œ4096 åº”è¯¥è¶³å¤Ÿäº†ã€‚

æœ‰ä¸¤ä¸ªé™åˆ¶ï¼šæ“ä½œç³»ç»Ÿå†…æ ¸å…è®¸æ‰“å¼€æ–‡ä»¶çš„æœ€å¤§æ•°é‡ï¼ˆfs.file-maxï¼‰å’Œæ¯ä¸ªç”¨æˆ·çš„é™åˆ¶ï¼ˆulimit -nï¼‰ã€‚å‰è€…å¿…é¡»é«˜äºåè€…ã€‚

ä½¿ç”¨ systemdï¼ˆæœ€è¿‘çš„ Linux å‘è¡Œç‰ˆï¼‰

åœ¨ä½¿ç”¨ systemd çš„å‘è¡Œç‰ˆä¸Šï¼Œæ“ä½œç³»ç»Ÿé™åˆ¶æ˜¯é€šè¿‡ /etc/systemd/system/rabbitmq-server.service.d/limits.conf ä¸­çš„é…ç½®æ–‡ä»¶æ§åˆ¶çš„ï¼Œä¾‹å¦‚ï¼š

[Service]
LimitNOFILE=300000</code></pre></div></blockquote>
<ul>
<li>æ®æ­¤ä¿®æ”¹æ­£å¸¸</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir /etc/systemd/system/rabbitmq-server.service.d -p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat  &gt;/etc/systemd/system/rabbitmq-server.service.d/limits.conf<span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=300000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ setenforce <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s#enforcing#disabled#g&#34;</span>  /etc/selinux/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/security/limits.conf<span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft nofile 204800
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nofile 204800
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ulimit -n <span style="color:#ae81ff">204800</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl restart rabbitmq-server.service</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="zabbixç›‘æ§-rabbitmq"><code>Zabbix</code>ç›‘æ§<code> Rabbitmq</code></h3>
<blockquote>
<ul>
<li><a href="http://www.lstop.pub/2016/10/10/%E8%87%AA%E5%B7%B1%E5%86%99%E4%B8%80%E4%B8%AA%E7%9B%91%E6%8E%A7RabbitMQ%E7%9A%84%E8%84%9A%E6%9C%AC/" rel="external" target="_self"><code>Rabbitmq-python</code>ç›‘æ§è„šæœ¬</a></li>
<li><code>RabbitMQ</code>è‡ªå·±å·²ç»æœ‰ä¸€ä¸ªæŒºå¥½çš„ç®¡ç†ç›‘æ§ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ°éå¸¸è¯¦ç»†çš„æ¶ˆæ¯é˜Ÿåˆ—ä¿¡æ¯ï¼Œä½†æ˜¯å¯¹äºè¿ç»´äººå‘˜æ¥è¯´ï¼Œè¿˜ç¼ºå°‘äº†å¾ˆé‡è¦çš„å‘Šè­¦åŠŸèƒ½ã€‚ è‡ªå·±å†™ä¸€ä¸ªè„šæœ¬ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œåœ¨ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šå‚è€ƒï¼Œä¸»è¦æ€è·¯æ˜¯åˆ©ç”¨<code>RabbitMQ</code>è‡ªå¸¦ç®¡ç†æ¨¡å—çš„<code>RESTful API</code>å–å€¼ï¼Œå‘é€åˆ°<code>zabbix</code>ï¼Œç”±<code>zabbix</code>è´Ÿè´£å‘Šè­¦é˜€å€¼åˆ¤æ–­å’Œå‘é€å‘Šè­¦</li>
<li><!-- raw HTML omitted --><code>RabbitMQ RESTful API</code><!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>é¦–å…ˆè®¤è¯†<code>RabbitMQ</code>çš„<code>API</code>ï¼Œçœ‹çœ‹èƒ½å–åˆ°ä»€ä¹ˆï¼Œæ¨èçœ‹å®˜æ–¹<code>help</code></li>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>MQ</code><!-- raw HTML omitted -->æ€»ä½“æƒ…å†µ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å®˜æ–¹è§£æï¼š<code>/api/overview Various random bits of information that describe the whole system</code></li>
<li>ä¾‹å­ï¼š<code>curl -u guest:guest http://192.168.55.241:15672/api/overview</code> ç„¶åè¿”å›dçš„<code>json</code>æ ¼å¼å“åº”æ˜¯ï¼š</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;management_version&#34;</span>: <span style="color:#e6db74">&#34;3.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;statistics_level&#34;</span>: <span style="color:#e6db74">&#34;fine&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;exchange_types&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;topic&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;AMQP topic exchange, as per the AMQP specification&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;fanout&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;AMQP fanout exchange, as per the AMQP specification&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;direct&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;AMQP direct exchange, as per the AMQP specification&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;headers&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;AMQP headers exchange, as per the AMQP specification&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;rabbitmq_version&#34;</span>: <span style="color:#e6db74">&#34;3.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;erlang_version&#34;</span>: <span style="color:#e6db74">&#34;R15B01&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;message_stats&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;publish&#34;</span>: <span style="color:#ae81ff">1104833</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;publish_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">12.262779782167032</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">298146914019</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068131606</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;ack&#34;</span>: <span style="color:#ae81ff">1177571</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;ack_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">11.230039450092189</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">57927468985</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068130882</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver&#34;</span>: <span style="color:#ae81ff">1177572</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">11.027518607238914</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">57927468985</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068130882</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_get&#34;</span>: <span style="color:#ae81ff">1207878</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_get_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">11.027518607238914</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">57927468985</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068130882</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_no_ack&#34;</span>: <span style="color:#ae81ff">30306</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_no_ack_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">1067361970</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068115093</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;redeliver&#34;</span>: <span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;redeliver_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">115179973</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068099504</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;queue_totals&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;messages&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;messages_ready&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;messages_unacknowledged&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;messages_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">255911999</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068131232</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;messages_ready_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">255911999</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068131232</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;messages_unacknowledged_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">255911999</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068131232</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;object_totals&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;consumers&#34;</span>: <span style="color:#ae81ff">70</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;queues&#34;</span>: <span style="color:#ae81ff">27</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;exchanges&#34;</span>: <span style="color:#ae81ff">13</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;connections&#34;</span>: <span style="color:#ae81ff">176</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;channels&#34;</span>: <span style="color:#ae81ff">236</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;rabbit@rabbit01&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;statistics_db_node&#34;</span>: <span style="color:#e6db74">&#34;rabbit@rabbit01&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;listeners&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;rabbit@rabbit01&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;protocol&#34;</span>: <span style="color:#e6db74">&#34;amqp&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;ip_address&#34;</span>: <span style="color:#e6db74">&#34;::&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#ae81ff">5672</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;contexts&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;rabbit@rabbit01&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;RabbitMQ Management&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#ae81ff">15672</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;rabbit@rabbit01&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Redirect to port 15672&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#ae81ff">55672</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;ignore_in_use&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å•ä¸ªé˜Ÿåˆ—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å®˜æ–¹è§£æï¼š<code>/api/queues/vhost/name An individual queue. To PUT a queue, you will need a body looking something like this: {â€œauto_deleteâ€:false,â€durableâ€:true,â€argumentsâ€:[],â€nodeâ€:â€rabbit@smacmullenâ€} All keys are optional</code></li>
<li>ä¾‹å­ï¼š<code>%2Fä»£è¡¨vhostä¸º/ curl -u guest:guest http://192.168.55.241:15672/api/queues/%2F/wxq.msgweb.push.wgw.0</code> ç„¶åè¿”å›dçš„<code>json</code>æ ¼å¼å“åº”æ˜¯ï¼š</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;policy&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;exclusive_consumer_tag&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;messages_ready&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;messages_unacknowledged&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;messages&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;consumers&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;active_consumers&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;memory&#34;</span>: <span style="color:#ae81ff">55680</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;backing_queue_status&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;q1&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;q2&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;delta&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;delta&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;undefined&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;undefined&#34;</span>
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;q3&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;q4&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;len&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pending_acks&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;target_ram_count&#34;</span>: <span style="color:#e6db74">&#34;infinity&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;ram_msg_count&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;ram_ack_count&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;next_seq_id&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;persistent_count&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;avg_ingress_rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;avg_egress_rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;avg_ack_ingress_rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;avg_ack_egress_rate&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;messages_details&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">10001981</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068574166</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;messages_ready_details&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">10001981</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068574166</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;messages_unacknowledged_details&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">10001981</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068574166</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;incoming&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;stats&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;publish&#34;</span>: <span style="color:#ae81ff">763</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;publish_details&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">75305976</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068545922</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;exchange&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;wxq_appmsg_exchange&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;vhost&#34;</span>: <span style="color:#e6db74">&#34;/&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;deliveries&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;stats&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;deliver_get&#34;</span>: <span style="color:#ae81ff">774</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;deliver_get_details&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">44411017</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068470753</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;deliver_no_ack&#34;</span>: <span style="color:#ae81ff">774</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;deliver_no_ack_details&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">44411017</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068470753</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;channel_details&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;192.168.65.158:64326 -&gt; 192.168.55.241:5672 (1)&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;number&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;connection_name&#34;</span>: <span style="color:#e6db74">&#34;192.168.65.158:64326 -&gt; 192.168.55.241:5672&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;peer_port&#34;</span>: <span style="color:#ae81ff">64326</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;peer_host&#34;</span>: <span style="color:#e6db74">&#34;192.168.65.158&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;message_stats&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_get&#34;</span>: <span style="color:#ae81ff">774</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_get_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">44411017</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068470753</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_no_ack&#34;</span>: <span style="color:#ae81ff">774</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;deliver_no_ack_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">44411017</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068470753</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;publish&#34;</span>: <span style="color:#ae81ff">763</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;publish_details&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;rate&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;interval&#34;</span>: <span style="color:#ae81ff">75305976</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;last_event&#34;</span>: <span style="color:#ae81ff">1476068545922</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;consumer_details&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;channel_details&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;192.168.65.158:64326 -&gt; 192.168.55.241:5672 (1)&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;number&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;connection_name&#34;</span>: <span style="color:#e6db74">&#34;192.168.65.158:64326 -&gt; 192.168.55.241:5672&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;peer_port&#34;</span>: <span style="color:#ae81ff">64326</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;peer_host&#34;</span>: <span style="color:#e6db74">&#34;192.168.65.158&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;queue_details&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;wxq.msgweb.push.wgw.0&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;vhost&#34;</span>: <span style="color:#e6db74">&#34;/&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;consumer_tag&#34;</span>: <span style="color:#e6db74">&#34;amq.ctag-jKVWrQSs7dbX9VaFfOZiYA&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;exclusive&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;ack_required&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;wxq.msgweb.push.wgw.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;vhost&#34;</span>: <span style="color:#e6db74">&#34;/&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;durable&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;auto_delete&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;arguments&#34;</span>: {},
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;node&#34;</span>: <span style="color:#e6db74">&#34;rabbit@rabbit01&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="zabbix-sender"><code>zabbix sender</code></h4>
<blockquote>
<ul>
<li><code>zabbix sender</code>åŒºåˆ«äºåœ¨<code>zabbix agent</code>æ·»åŠ <code>item</code>ï¼Œ<code>sender</code>å¯ä»¥ä¸»åŠ¨å‘é€<code>item</code>å€¼åˆ°<code>zabbix server</code>
å¯ä»¥å…ˆè§„åˆ’å¥½åœ¨<code>zabbix server</code>ä¸­ä½¿ç”¨çš„<code>host</code>å’Œ<code>item</code>åå­—</li>
<li><!-- raw HTML omitted -->ä¾‹å¦‚ï¼š<!-- raw HTML omitted -->è¿™æ ·å°±å¯ä»¥é€šè¿‡pythonå–å€¼ï¼Œä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå†<code>send</code>åˆ°<code>zabbix server</code></li>
</ul>
<blockquote>
<ul>
<li><code>rabbitmq.[rabbit@wx-pro-server01,messages_ready]</code>å¾…å¤„ç†æ¶ˆæ¯æ€»æ•°</li>
<li><code>rabbitmq.[rabbit@wx-pro-server01,messages_unacknowledged]</code>æœªæ”¶åˆ°<code>ack</code>å“åº”æ¶ˆæ¯æ€»æ•°</li>
<li><code>rabbitmq.queues[/,queue_messages_ready,wxq_msg_send] wxq_msg_send</code>é˜Ÿåˆ—çš„å¾…å¤„ç†æ¶ˆæ¯æ•°</li>
<li><code>rabbitmq.queues[/,queue_active_consumers,wxq_msg_send] wxq_msg_send</code>é˜Ÿåˆ—çš„æ´»åŠ¨è¿æ¥æ•°</li>
</ul>
</blockquote>
<ul>
<li><code>zabbix_sender</code><!-- raw HTML omitted -->ä½¿ç”¨æ–¹æ³•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>-c</code>ï¼š<code>agent</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>-i</code> ï¼š<!-- raw HTML omitted -->ä¸´æ—¶æ–‡ä»¶ï¼Œç”¨äºä¿å­˜å¤šä¸ª<!-- raw HTML omitted --><code>item</code><!-- raw HTML omitted -->å’Œå¯¹åº”å€¼ï¼Œæ¯è¡Œä¸€ä¸ª<!-- raw HTML omitted --><code>item</code></li>
<li><code>-s</code>ï¼š<!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>zabbix server</code><!-- raw HTML omitted -->ä¸Šé…ç½®çš„<!-- raw HTML omitted --><code>host</code><!-- raw HTML omitted -->åå­—<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/usr/bin/zabbix_sender -c /etc/zabbix/zabbix_agentd.conf -i /tmp/tmp5ai4uI -s ser01-rabbitmq</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="pythonä»£ç "><code>python</code>ä»£ç </h4>
<blockquote>
<ul>
<li><a href="https://blog.51cto.com/john88wang/1745824" rel="external" target="_self">ä½¿ç”¨<code>Zabbix</code>ç›‘æ§<code>RabbitMQ</code></a></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/python</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># coding=utf-8</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RabbitMqç›‘æ§è„šæœ¬ v1.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">v1.1 ç›‘æ§channelçš„unacknowledged
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">v1.0 ç›‘æ§overviewã€queue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib2
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> socket
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> tempfile
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> subprocess
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> optparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>basicConfig(filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/var/log/zabbix/rabbitmq_zabbix.log&#39;</span>, level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>WARNNING, format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%(asctime)s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%(levelname)s</span><span style="color:#e6db74">: </span><span style="color:#e6db74">%(message)s</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RabbitMqApi</span>(object):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39; è°ƒç”¨RabbitMQçš„APIç±» &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">######## json.loads()  transfer json data to python data</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">######## json.dump()   transfer python data to json data</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> __init__(self, user_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span>, password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span>, host_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;192.168.55.241&#39;</span>, 
</span></span><span style="display:flex;"><span>           protocol<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;http&#39;</span>, port<span style="color:#f92672">=</span><span style="color:#ae81ff">15672</span>, senderhostname<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ser01-rabbitmq&#39;</span>,
</span></span><span style="display:flex;"><span>                       zbconf<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/etc/zabbix/zabbix_agentd.conf&#39;</span>):
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>user_name <span style="color:#f92672">=</span> user_name
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>password <span style="color:#f92672">=</span> password
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>host_name <span style="color:#f92672">=</span> host_name <span style="color:#f92672">or</span> socket<span style="color:#f92672">.</span>gethostname()
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>protocol <span style="color:#f92672">=</span> protocol
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>port <span style="color:#f92672">=</span> port
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>senderhostname <span style="color:#f92672">=</span> senderhostname <span style="color:#66d9ef">if</span> senderhostname <span style="color:#66d9ef">else</span> host_name
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>conf <span style="color:#f92672">=</span> zbconf
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è°ƒç”¨RabbitMQçš„APIç±»å–åŸå§‹æ•°æ®ï¼Œjsonæ ¼å¼</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">call_api</span>(self, path):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  All URIs will server only resource of type application/json,and will require HTTP basic authentication. The default username and password is guest/guest.  /</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">f is encoded for the default virtual host &#39;/&#39; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">://</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">/api/</span><span style="color:#e6db74">{3}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>protocol, self<span style="color:#f92672">.</span>host_name, self<span style="color:#f92672">.</span>port, path)
</span></span><span style="display:flex;"><span>password_mgr <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>HTTPPasswordMgrWithDefaultRealm()
</span></span><span style="display:flex;"><span>password_mgr<span style="color:#f92672">.</span>add_password(<span style="color:#66d9ef">None</span>, url, self<span style="color:#f92672">.</span>user_name, self<span style="color:#f92672">.</span>password)
</span></span><span style="display:flex;"><span>handler <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>HTTPBasicAuthHandler(password_mgr)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#39;Issue a rabbit API call to get data on &#39;</span> <span style="color:#f92672">+</span> url)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>loads(urllib2<span style="color:#f92672">.</span>build_opener(handler)<span style="color:#f92672">.</span>open(url)<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è°ƒç”¨RabbitMQçš„APIç±»å–åŸå§‹æ•°æ®ï¼Œjsonæ ¼å¼</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">call_api_queue</span>(self, queue_name):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  get queue detail
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">://</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">/api/queues/</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{3}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>protocol, self<span style="color:#f92672">.</span>host_name, self<span style="color:#f92672">.</span>port, queue_name)
</span></span><span style="display:flex;"><span>password_mgr <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>HTTPPasswordMgrWithDefaultRealm()
</span></span><span style="display:flex;"><span>password_mgr<span style="color:#f92672">.</span>add_password(<span style="color:#66d9ef">None</span>, url, self<span style="color:#f92672">.</span>user_name, self<span style="color:#f92672">.</span>password)
</span></span><span style="display:flex;"><span>handler <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>HTTPBasicAuthHandler(password_mgr)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#39;Issue a rabbit API call to get data on &#39;</span> <span style="color:#f92672">+</span> url)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>loads(urllib2<span style="color:#f92672">.</span>build_opener(handler)<span style="color:#f92672">.</span>open(url)<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">call_api_channel</span>(self, channel_name):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  get channel detail
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">://</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">/api/channels/</span><span style="color:#e6db74">{3}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>protocol, self<span style="color:#f92672">.</span>host_name, self<span style="color:#f92672">.</span>port, urllib2<span style="color:#f92672">.</span>quote(channel_name))
</span></span><span style="display:flex;"><span>password_mgr <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>HTTPPasswordMgrWithDefaultRealm()
</span></span><span style="display:flex;"><span>password_mgr<span style="color:#f92672">.</span>add_password(<span style="color:#66d9ef">None</span>, url, self<span style="color:#f92672">.</span>user_name, self<span style="color:#f92672">.</span>password)
</span></span><span style="display:flex;"><span>handler <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>HTTPBasicAuthHandler(password_mgr)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#39;Issue a rabbit API call to get data on &#39;</span> <span style="color:#f92672">+</span> url)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>loads(urllib2<span style="color:#f92672">.</span>build_opener(handler)<span style="color:#f92672">.</span>open(url)<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠæ•°æ®ä¸itemå¯¹åº”å†™è¿›ä¸´æ—¶æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_queue_data</span>(self, queue, tmpfile):
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> [ <span style="color:#e6db74">&#39;memory&#39;</span>,<span style="color:#e6db74">&#39;messages&#39;</span>,<span style="color:#e6db74">&#39;messages_ready&#39;</span>,<span style="color:#e6db74">&#39;messages_unacknowledged&#39;</span>,<span style="color:#e6db74">&#39;consumers&#39;</span>,<span style="color:#e6db74">&#39;active_consumers&#39;</span> ]:
</span></span><span style="display:flex;"><span><span style="color:#75715e">#key = rabbitmq.queues[/,queue_memory,queue.helloWorld]</span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#34;rabbitmq.queues[</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">,queue_</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">]&#34;&#39;</span><span style="color:#f92672">.</span>format(queue[<span style="color:#e6db74">&#39;vhost&#39;</span>], item, queue[<span style="color:#e6db74">&#39;name&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#75715e">### if item is in queue,value=queue[item],else value=0</span>
</span></span><span style="display:flex;"><span>value <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>get(item, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;SENDER_DATA: - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key,value))
</span></span><span style="display:flex;"><span>tmpfile<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;- </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key, value))
</span></span><span style="display:flex;"><span><span style="color:#75715e">##  This is a non standard bit of information added after the standard items</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;deliver_get&#39;</span>, <span style="color:#e6db74">&#39;publish&#39;</span>]:
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#34;rabbitmq.queues[</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">,queue_message_stats_</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">]&#34;&#39;</span><span style="color:#f92672">.</span>format(queue[<span style="color:#e6db74">&#39;vhost&#39;</span>], item, queue[<span style="color:#e6db74">&#39;name&#39;</span>])
</span></span><span style="display:flex;"><span>value <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;message_stats&#39;</span>, {})<span style="color:#f92672">.</span>get(item, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;SENDER_DATA: - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key,value))
</span></span><span style="display:flex;"><span>tmpfile<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;- </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key, value))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨zabbix_senderæŠŠitemå‘é€åˆ°zabbix server</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_send_queue_data</span>(self, tmpfile):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;Send the queue data to Zabbix.&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;Get key value from temp file. &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>args <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/usr/bin/zabbix_sender -c </span><span style="color:#e6db74">{0}</span><span style="color:#e6db74"> -i </span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>senderhostname:
</span></span><span style="display:flex;"><span>args <span style="color:#f92672">=</span> args <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; -s &#34;</span> <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>senderhostname
</span></span><span style="display:flex;"><span>return_code <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>process <span style="color:#f92672">=</span> subprocess<span style="color:#f92672">.</span>Popen(args<span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>conf, tmpfile<span style="color:#f92672">.</span>name),
</span></span><span style="display:flex;"><span>                                  shell<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, stdout<span style="color:#f92672">=</span>subprocess<span style="color:#f92672">.</span>PIPE,
</span></span><span style="display:flex;"><span>                                  stderr<span style="color:#f92672">=</span>subprocess<span style="color:#f92672">.</span>PIPE)
</span></span><span style="display:flex;"><span>out, err <span style="color:#f92672">=</span> process<span style="color:#f92672">.</span>communicate()
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Finished sending data&#34;</span>)
</span></span><span style="display:flex;"><span>return_code <span style="color:#f92672">=</span> process<span style="color:#f92672">.</span>wait()
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;Found return code of &#34;</span> <span style="color:#f92672">+</span> str(return_code))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> return_code <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>warning(out)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>warning(err)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(err)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(out)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> return_code
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_queue</span>(self, queueName):
</span></span><span style="display:flex;"><span>rdatafile <span style="color:#f92672">=</span> tempfile<span style="color:#f92672">.</span>NamedTemporaryFile(delete<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>return_code <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>queue <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>call_api_queue(queueName)
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>_get_queue_data(queue, rdatafile)
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>_get_channel_data(queue, rdatafile)
</span></span><span style="display:flex;"><span>rdatafile<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>return_code <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_send_queue_data(rdatafile)
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">.</span>unlink(rdatafile<span style="color:#f92672">.</span>name)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> return_code
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_overview</span>(self):
</span></span><span style="display:flex;"><span>return_code <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>rdatafile <span style="color:#f92672">=</span> tempfile<span style="color:#f92672">.</span>NamedTemporaryFile(delete<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>queue <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>call_api(<span style="color:#e6db74">&#39;overview&#39;</span>)
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>_get_overview_data(queue, rdatafile)
</span></span><span style="display:flex;"><span>rdatafile<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>return_code <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_send_queue_data(rdatafile)
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">.</span>unlink(rdatafile<span style="color:#f92672">.</span>name)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> return_code
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_overview_data</span>(self, queue, tmpfile):
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;publish_details&#39;</span>, <span style="color:#e6db74">&#39;ack_details&#39;</span>, <span style="color:#e6db74">&#39;deliver_get_details&#39;</span>]:
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rabbitmq.[</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">_rate]&#34;</span><span style="color:#f92672">.</span>format(queue[<span style="color:#e6db74">&#39;node&#39;</span>], item)
</span></span><span style="display:flex;"><span>value <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;message_stats&#39;</span>)<span style="color:#f92672">.</span>get(item)<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;rate&#39;</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;SENDER_DATA: - </span><span style="color:#e6db74">{0}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">{1:.2f}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(key, value))
</span></span><span style="display:flex;"><span>tmpfile<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;- </span><span style="color:#e6db74">{0}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">{1:.2f}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(key, value))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;messages&#39;</span>,<span style="color:#e6db74">&#39;messages_ready&#39;</span>,<span style="color:#e6db74">&#39;messages_unacknowledged&#39;</span>]:
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rabbitmq.[</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">]&#34;</span><span style="color:#f92672">.</span>format(queue[<span style="color:#e6db74">&#39;node&#39;</span>], item)
</span></span><span style="display:flex;"><span>value <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;queue_totals&#39;</span>)<span style="color:#f92672">.</span>get(item,<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;SENDER_DATA: - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key,value))
</span></span><span style="display:flex;"><span>tmpfile<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;- </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key, value))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_channel_data</span>(self, queue, tmpfile): 
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ä»queueè·å–queue nameå’Œchannel nameï¼Œç»„è£…zabbixçš„k-vå¹¶å†™è¿›ä¸´æ—¶æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ch_detail <span style="color:#f92672">in</span> queue[<span style="color:#e6db74">&#39;consumer_details&#39;</span>]:
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rabbitmq.[</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">,</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">]&#34;</span><span style="color:#f92672">.</span>format(queue[<span style="color:#e6db74">&#39;name&#39;</span>], ch_detail<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;channel_details&#39;</span>)<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;name&#39;</span>,<span style="color:#e6db74">&#39;no_name&#39;</span>))
</span></span><span style="display:flex;"><span>value <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_channel_ack(ch_detail<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;channel_details&#39;</span>)<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;name&#39;</span>,<span style="color:#e6db74">&#39;no_name&#39;</span>))
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;SENDER_DATA: - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key,value))
</span></span><span style="display:flex;"><span>tmpfile<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#34;- </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (key, value))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_channel_ack</span>(self, channel_name):
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ä½¿ç”¨apiè·å–messages_unacknowledgedå€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>call_api_channel(channel_name)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> d[<span style="color:#e6db74">&#39;messages_unacknowledged&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;Command-line parameters and decoding for Zabbix use/consumption.&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#testapi = RabbitMqApi()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#testapi.check_queue(&#39;wxq_msg_send&#39;)</span>
</span></span><span style="display:flex;"><span>parser <span style="color:#f92672">=</span> optparse<span style="color:#f92672">.</span>OptionParser()
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;-u&#39;</span>, <span style="color:#e6db74">&#39;--username&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RabbitMQ API username,default=guest&#39;</span>,default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;-p&#39;</span>, <span style="color:#e6db74">&#39;--password&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RabbitMQ API password,default=guest&#39;</span>,default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;--mqhost&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RabbitMQ API hostname,default=hostname&#39;</span>,default<span style="color:#f92672">=</span>socket<span style="color:#f92672">.</span>gethostname())
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;--protocol&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RabbitMQ API protocol,default=http&#39;</span>,default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;http&#39;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;--port&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RabbitMQ API port,default=15672&#39;</span>,default<span style="color:#f92672">=</span><span style="color:#ae81ff">15672</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;--host&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Zabbix Host name which the item belongs to,no default&#39;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;--conf&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Zabbix agent configure file,default=/etc/zabbix/zabbix_agentd.conf&#39;</span>,default<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/etc/zabbix/zabbix_agentd.conf&#39;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;--queue&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RabbitMQ queue which you want to check,no default&#39;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;-o&#39;</span>,<span style="color:#e6db74">&#39;--overview&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;check RabbitMQ overview&#39;</span>,action<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;store_true&#34;</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;-c&#39;</span>,<span style="color:#e6db74">&#39;--count&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;How many times to execute command&#39;</span>, type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;int&#39;</span>, default<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>add_option(<span style="color:#e6db74">&#39;-i&#39;</span>,<span style="color:#e6db74">&#39;--interval&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Command execute interval&#39;</span>, type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;int&#39;</span>, default<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>(options, args) <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> options<span style="color:#f92672">.</span>host:
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>error(<span style="color:#e6db74">&#34;è¯·è¾“å…¥zabbixé‡Œå®šä¹‰çš„hostname&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> (<span style="color:#f92672">not</span> options<span style="color:#f92672">.</span>queue <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> options<span style="color:#f92672">.</span>overview):
</span></span><span style="display:flex;"><span>parser<span style="color:#f92672">.</span>error(<span style="color:#e6db74">&#34;è¯·æŒ‡å®š-oæˆ–è€…--queueï¼Œé€‰æ‹©æ£€æŸ¥mqæ€»ä½“æŒ‡æ ‡æˆ–è€…æŸä¸ªé˜Ÿåˆ—æŒ‡æ ‡&#34;</span>)
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>debug(<span style="color:#e6db74">&#34;Started trying to process data&#34;</span>)
</span></span><span style="display:flex;"><span>api <span style="color:#f92672">=</span> RabbitMqApi(user_name<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>username, password<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>password, host_name<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>mqhost, 
</span></span><span style="display:flex;"><span>               protocol<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>protocol, port<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>port, senderhostname<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>host,
</span></span><span style="display:flex;"><span>               zbconf<span style="color:#f92672">=</span>options<span style="color:#f92672">.</span>conf)
</span></span><span style="display:flex;"><span>cnt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> cnt <span style="color:#f92672">&lt;</span> options<span style="color:#f92672">.</span>count:                                               
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> options<span style="color:#f92672">.</span>overview:
</span></span><span style="display:flex;"><span>api<span style="color:#f92672">.</span>check_overview()
</span></span><span style="display:flex;"><span>time<span style="color:#f92672">.</span>sleep(options<span style="color:#f92672">.</span>interval)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">elif</span> options<span style="color:#f92672">.</span>queue:
</span></span><span style="display:flex;"><span>api<span style="color:#f92672">.</span>check_queue(options<span style="color:#f92672">.</span>queue)
</span></span><span style="display:flex;"><span>time<span style="color:#f92672">.</span>sleep(options<span style="color:#f92672">.</span>interval)
</span></span><span style="display:flex;"><span>cnt <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span> main()</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è„šæœ¬ä½¿ç”¨æ–¹å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>--mqhost</code>ï¼š<code>RabbitMQ</code><!-- raw HTML omitted -->æœåŠ¡å™¨<!-- raw HTML omitted --><code>ip</code></li>
<li><code>--host</code>ï¼š<code>zabbix server</code><!-- raw HTML omitted -->ä¸Šé…ç½®çš„<!-- raw HTML omitted --><code>host</code><!-- raw HTML omitted -->åå­—<!-- raw HTML omitted --></li>
<li><code>--queue</code>ï¼š<!-- raw HTML omitted -->é˜Ÿåˆ—åå­—<!-- raw HTML omitted --></li>
<li><code>-o</code>ï¼š<!-- raw HTML omitted -->è·å–<!-- raw HTML omitted --><code>overview</code><!-- raw HTML omitted -->æ•°æ®<!-- raw HTML omitted --></li>
<li><code>-c</code>ï¼š<!-- raw HTML omitted -->æ‰§è¡Œ<code>5</code>æ¬¡<!-- raw HTML omitted --></li>
<li><code>-i</code>ï¼š<!-- raw HTML omitted -->é—´éš”<code>12</code>ç§’<!-- raw HTML omitted --></li>
<li><code>--help</code>ï¼š<!-- raw HTML omitted -->æŸ¥çœ‹å¸®åŠ©ï¼Œæœ‰å…¶ä»–å‚æ•°å¯é€‰<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mqMon.py -o â€“mqhost 192.168.55.241 â€“host ser01-rabbitmq -c <span style="color:#ae81ff">5</span> -i <span style="color:#ae81ff">12</span>  	<span style="color:#75715e"># ç›‘æ§`mq`æ€»ä½“æƒ…å†µ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mqMon.py â€“queue wxq_msg_send â€“mqhost 192.168.55.241 â€“host ser01-rabbitmq -c <span style="color:#ae81ff">5</span> -i <span style="color:#ae81ff">12</span>  	<span style="color:#75715e"># ç›‘æ§é˜Ÿåˆ—æƒ…å†µ</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="monitor">Monitor</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Monitor</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_zabbix">Install_Zabbix</h1>

<h2 id="éƒ¨ç½²zabbixç›‘æ§ç³»ç»Ÿ">éƒ¨ç½²<code>Zabbix</code>ç›‘æ§ç³»ç»Ÿ</h2>
<h3 id="åŸºç¡€é…ç½®ç¯å¢ƒè¦æ±‚">åŸºç¡€é…ç½®ç¯å¢ƒè¦æ±‚</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.zabbix.com/manuals" rel="external" target="_self"><code>Zabbix</code>éƒ¨ç½²æ–‡æ¡£</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.zabbix.com/cn/download" rel="external" target="_self">ä¸‹è½½å®‰è£…<code>Zabbix</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->éƒ¨ç½²<!-- raw HTML omitted --><code>Zabbix</code><!-- raw HTML omitted -->ç¡¬ä»¶è¦æ±‚<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>å¹³å°</th>
<th>CPU/å†…å­˜</th>
<th>æ•°æ®åº“</th>
<th>å—ç›‘æ§çš„ä¸»æœº</th>
</tr>
</thead>
<tbody>
<tr>
<td>å°å‹</td>
<td><code>CentOS</code></td>
<td>è™šæ‹Ÿè®¾å¤‡</td>
<td><code>MySQL InnoDB</code></td>
<td>100</td>
</tr>
<tr>
<td>ä¸­å‹</td>
<td><code>CentOS</code></td>
<td><code>2ä¸ªCPUå†…æ ¸/2GB</code></td>
<td><code>MySQL InnoDB</code></td>
<td>500</td>
</tr>
<tr>
<td>å¤§å‹</td>
<td><code>RedHat Enterprise Linux</code></td>
<td><code>4ä¸ªCPUå†…æ ¸/8GB RAID10</code></td>
<td><code>MySQL InnoDB</code>æˆ– <code>PostgreSQL</code></td>
<td>&gt;1000</td>
</tr>
<tr>
<td>è¶…å¤§å‹</td>
<td><code>RedHat Enterprise Linux</code></td>
<td><code>8ä¸ªCPUå†…æ ¸/16GB RAID10</code></td>
<td><code>MySQL InnoDB</code>æˆ– <code>PostgreSQL</code></td>
<td>&gt;10000</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->éƒ¨ç½²<!-- raw HTML omitted --><code>Zabbix</code><!-- raw HTML omitted -->æ•°æ®åº“ç‰ˆæœ¬è¦æ±‚<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>æ•°æ®åº“</th>
<th>æ”¯æŒç‰ˆæœ¬</th>
<th>æ¨èç‰ˆæœ¬</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MySQL/Percona</code></td>
<td><code>5.7.28-8.0.X</code></td>
<td><code>8.0.X</code></td>
<td>å¦‚æœ<code>MySQL</code>æˆ–<code>Percona</code>ç”¨ä½œ<code>Zabbix</code>åç«¯æ•°æ®åº“ï¼Œåˆ™éœ€è¦ã€‚éœ€è¦<code>InnoDB</code>å¼•æ“ã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨<code>MariaDB Connector/C</code>åº“æ¥æ„å»ºæœåŠ¡å™¨/ä»£ç†</td>
</tr>
<tr>
<td><code>MariaDB</code></td>
<td><code>10.0.37-10.6.X</code></td>
<td><code>10.5.X</code></td>
<td><code>InnoDB</code>å¼•æ“æ˜¯å¿…éœ€çš„ã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨<code>MariaDB Connector/C</code> åº“æ¥æ„å»ºæœåŠ¡å™¨/ä»£ç†</td>
</tr>
<tr>
<td><code>PostgreSQL</code></td>
<td><code>10.9-13.X</code></td>
<td><code>12.X.X</code>æˆ–æ›´æ–°</td>
<td>ä½¿ç”¨<code>PostgreSQL</code>ä½œä¸º<code>Zabbix</code>åç«¯æ•°æ®åº“ã€‚<!-- raw HTML omitted -->å»ºè®®ä½¿ç”¨<code>PostgreSQL 8.3</code>ä»¥ä¸Šçš„ç‰ˆæœ¬, ä»¥ <a href="http://www.postgresql.org/docs/8.3/static/release-8-3.html" rel="external" target="_self">æä¾›æ›´å¥½çš„VACUUMæ€§èƒ½</a>ã€‚</td>
</tr>
<tr>
<td><code>SQLite</code></td>
<td><code>3.3.5-3.34.X</code></td>
<td><code>3.3X.X</code></td>
<td>ä»…æ”¯æŒ<code>Zabbix</code>ä»£ç†ã€‚å¦‚æœ<code>SQLite</code>ç”¨ä½œ<code>Zabbix</code>ä»£ç†æ•°æ®åº“</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start mariadb
</span></span><span style="display:flex;"><span>$ mysql -uroot -e <span style="color:#e6db74">&#34;create database zabbix character set utf8mb4 collate utf8mb4_bin;&#34;</span> 
</span></span><span style="display:flex;"><span>$ mysql -uroot -e <span style="color:#e6db74">&#34;create user &#39;zabbix&#39;@&#39;localhost&#39; identified by &#39;zabbix&#39;;&#34;</span>   
</span></span><span style="display:flex;"><span>$ mysql -uroot -e <span style="color:#e6db74">&#34;grant all privileges on zabbix.* to &#39;zabbix&#39;@&#39;localhost&#39;;&#34;</span>
</span></span><span style="display:flex;"><span>$ mysql -uroot -e <span style="color:#e6db74">&#34;flush privileges;&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Zabbix</code><!-- raw HTML omitted -->å‰å‡†å¤‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¸è½½åŸæœ‰æ•°æ®åº“ï¼Œå®‰è£…é«˜ç‰ˆæœ¬<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum remove -y mariadb*</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºç”¨æˆ·<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ groupadd --system zabbix
</span></span><span style="display:flex;"><span>$ useradd --system -g zabbix -d /usr/lib/zabbix -s /sbin/nologin -c <span style="color:#e6db74">&#34;Zabbix Monitoring System&#34;</span> zabbix</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºæ‰€éœ€ç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir /opt/<span style="color:#f92672">{</span>src,zabbix<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$ chown zabbix:zabbix /opt/*</span></span></code></pre></div><ul>
<li>3.4 <!-- raw HTML omitted -->å®‰è£…ä¾èµ–<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install epel-release wget unixODBC-devel net-snmp-devel libevent-devel <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>libxml2-devel libcurl-devel java-1.6.0-openjdk-devel gcc gcc-c++ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>mariadb mariadb-server mariadb-devel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install go
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Debian ç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>$ sudo apt-get install libxml2 libxml2-dev libsnmp-dev libevent-dev openjdk-11-jdk <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>libcurl4-openssl-dev </span></span></code></pre></div></blockquote>
<hr>
<h3 id="å®‰è£…zabbix-server">å®‰è£…<code>Zabbix Server</code></h3>
<ul>
<li>
<ol>
<li><a href="https://cdn.zabbix.com/zabbix/sources/stable/" rel="external" target="_self">ä¸‹è½½<code>Zabbix Server</code>ç¼–è¯‘å®‰è£…åŒ…</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /opt/src/ https://cdn.zabbix.com/zabbix/sources/stable/6.0/zabbix-6.0.14.tar.gz</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->è§£å‹é…ç½®<!-- raw HTML omitted --><code>Zabbix Server</code><!-- raw HTML omitted -->å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tar -zxvf /opt/src/zabbix-6.0.14.tar.gz -C /opt/src/
</span></span><span style="display:flex;"><span>$ cd /opt/src/zabbix-6.0.14/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¼–è¯‘å®‰è£…è·¯å¾„</span>
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/opt/zabbix --enable-server --enable-agent --enable-ipv6 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-net-snmp --with-libcurl --with-libxml2 --enable-java --with-openssl <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-mysql<span style="color:#f92672">=</span>/usr/local/mysql/bin/mysql_config
</span></span><span style="display:flex;"><span>$ make -j2 <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æ‹·è´<!-- raw HTML omitted --><code>Zabbix Server</code><!-- raw HTML omitted -->å¯åŠ¨æ–‡ä»¶ç»™äºˆæ‰§è¡Œæƒé™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp /opt/src/zabbix-6.0.14/misc/init.d/fedora/core/zabbix_* /etc/init.d/  
</span></span><span style="display:flex;"><span>$ chmod +x /etc/init.d/zabbix_*</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å¯åŠ¨æ•°æ®åº“å¯¼å…¥<!-- raw HTML omitted --><code>Zabbix SQL</code><!-- raw HTML omitted -->æ–‡ä»¶åå†å¯åŠ¨<!-- raw HTML omitted --><code>Zabbix Server</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ll /opt/src/zabbix-6.0.14/database/mysql/ | grep *.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mysql -uzabbix -p<span style="color:#e6db74">&#39;zabbix&#39;</span> zabbix &lt; /opt/src/zabbix-6.0.14/database/mysql/schema.sql
</span></span><span style="display:flex;"><span>$ mysql -uzabbix -p<span style="color:#e6db74">&#39;zabbix&#39;</span> zabbix &lt; /opt/src/zabbix-6.0.14/database/mysql/images.sql
</span></span><span style="display:flex;"><span>$ mysql -uzabbix -p<span style="color:#e6db74">&#39;zabbix&#39;</span> zabbix &lt; /opt/src/zabbix-6.0.14/database/mysql/data.sql
</span></span><span style="display:flex;"><span>$ mysql -uzabbix -p<span style="color:#e6db74">&#39;zabbix&#39;</span> zabbix &lt; /opt/src/zabbix-6.0.14/database/mysql/double.sql
</span></span><span style="display:flex;"><span>$ mysql -uzabbix -p<span style="color:#e6db74">&#39;zabbix&#39;</span> zabbix &lt; /opt/src/zabbix-6.0.14/database/mysql/history_pk_prepare.sql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>zabbix_server</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/zabbix/etc/zabbix_server.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DBHost=localhost  	# æ•°æ®åº“åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DBName=zabbix  	# æ•°æ®åº“å
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DBUser=root  	# è¿æ¥æ•°æ®åº“çš„ç”¨æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DBPassword=123456  	# å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DBSocket=/home/ops/opt/mysql/mysql.sock  	# æ•°æ®åº“sockæ–‡ä»¶è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DBPort=3306  	# ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LogFile=/opt/zabbix_server/logs/zabbix_server.log  	# æ—¥å¿—æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PidFile=/opt/zabbix_server/logs/zabbix_server.pid  	# ä¿å­˜pidçš„æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SocketDir=/opt/zabbix/logs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->æ‹·è´<!-- raw HTML omitted --><code>Zabbix</code><!-- raw HTML omitted -->å‰ç«¯æ–‡ä»¶ï¼Œåˆ°<!-- raw HTML omitted --><code>Nginx</code>çš„<code>web</code><!-- raw HTML omitted -->ç›®å½•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cp -rf /opt/src/zabbix-6.0.14/ui/* /usr/local/nginx/html/zabbix/</span></span></code></pre></div></blockquote>
<hr>
<h3 id="dockerå®‰è£…zabbix-server"><code>Docker</code>å®‰è£…<code>Zabbix Server</code></h3>
<blockquote>
<ul>
<li><a href="https://www.zabbix.com/documentation/6.0/en/manual/installation/containers" rel="external" target="_self">ä»<code>Docker</code>å®¹å™¨å®‰è£…</a>ã€<a href="https://www.leeks.info/zh_CN/latest/index.html" rel="external" target="_self">æ¬¢è¿ä½¿ç”¨<code>Leeks</code>çš„ç¬”è®°</a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li>åˆ›å»ºä¸“ç”¨äº<code>Zabbix</code>ç»„ä»¶å®¹å™¨çš„ç½‘ç»œ</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker network create --subnet 172.20.0.0/16 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--ip-range 172.20.100.0/20 zabbix-net</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>å¯åŠ¨ç©º<code>MySQL</code>æœåŠ¡å™¨å®ä¾‹æ•°æ®åº“<code>8.0</code>ä»¥ä¸Š</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -v /etc/localtime:/etc/localtime <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --name mysql-server -t <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e MYSQL_DATABASE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e MYSQL_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e MYSQL_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>zabbix_pwd<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>root_pwd<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --network<span style="color:#f92672">=</span>zabbix-net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --restart unless-stopped <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -d mysql:8.0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --character-set-server<span style="color:#f92672">=</span>utf8 --collation-server<span style="color:#f92672">=</span>utf8_bin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --default-authentication-plugin<span style="color:#f92672">=</span>mysql_native_password</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li>å¯åŠ¨<code>Zabbix Java</code>ç½‘å…³å®ä¾‹</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -v /etc/localtime:/etc/localtime <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --name zabbix-java-gateway -t <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --network<span style="color:#f92672">=</span>zabbix-net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   --restart unless-stopped <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -d zabbix/zabbix-java-gateway:alpine-6.0-latest</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li>å¯åŠ¨<code>Zabbix</code>æœåŠ¡å™¨å®ä¾‹å¹¶å°†è¯¥å®ä¾‹ä¸åˆ›å»ºçš„<code>MySQL</code>æœåŠ¡å™¨å®ä¾‹é“¾æ¥</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>å¯åŠ¨<code>Zabbix</code>æœåŠ¡å™¨å®ä¾‹å¹¶å°†è¯¥å®ä¾‹ä¸åˆ›å»ºçš„<code>MySQL</code>æœåŠ¡å™¨å®ä¾‹é“¾æ¥</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker volume create zabbix-server-volume
</span></span><span style="display:flex;"><span>$ docker run -v /etc/localtime:/etc/localtime <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --name zabbix-server-mysql -t <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --link zabbix-web-service:zabbix-web-service <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e DB_SERVER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mysql-server&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_DATABASE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>zabbix_pwd<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>root_pwd<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e ZBX_JAVAGATEWAY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix-java-gateway&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e ZBX_STARTREPORTWRITERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e ZBX_WEBSERVICEURL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://zabbix-web-service:10053/report&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -v zabbix-server-volume:/etc/zabbix <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -v <span style="color:#e6db74">${</span>server_dir<span style="color:#e6db74">}</span>/server/alertscripts:/usr/lib/zabbix/alertscripts <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -v <span style="color:#e6db74">${</span>server_dir<span style="color:#e6db74">}</span>/server/externalscripts:/usr/lib/zabbix/externalscripts <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -v <span style="color:#e6db74">${</span>server_dir<span style="color:#e6db74">}</span>/server/modules:/usr/lib/zabbix/modules <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --network<span style="color:#f92672">=</span>zabbix-net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -p 10051:10051 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --restart unless-stopped <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -d zabbix/zabbix-server-mysql:alpine-6.0-latest</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li>å¯åŠ¨<code>Zabbix Web</code>ç•Œé¢å¹¶å°†å®ä¾‹ä¸åˆ›å»ºçš„<code>MySQL</code>æœåŠ¡å™¨å’Œ<code>Zabbix</code>æœåŠ¡å™¨å®ä¾‹é“¾æ¥</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Zabbix Web</code>ç•Œé¢å®ä¾‹å‘ä¸»æœºå…¬å¼€<code>80/TCP</code>ç«¯å£ <code>HTTP</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -v /etc/localtime:/etc/localtime <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --name zabbix-web-nginx-mysql -t <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e ZBX_SERVER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix-server-mysql&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e DB_SERVER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mysql-server&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_DATABASE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;zabbix&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>zabbix_pwd<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>root_pwd<span style="color:#e6db74">}</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -e ZBX_SERVER_NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>zabbix_server_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --network<span style="color:#f92672">=</span>zabbix-net <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -p 8080:8080 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      --restart unless-stopped <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>      -d zabbix/zabbix-web-nginx-mysql:alpine-6.0-latest</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li>å®‰è£…<code>Zabbix Proxy</code>æœåŠ¡</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run --name zabbix-proxy-mysql <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e DB_SERVER_HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mysql-server&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e MYSQL_USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;user&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e MYSQL_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;some-password&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e ZBX_HOSTNAME<span style="color:#f92672">=</span>some-hostname <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -e ZBX_SERVER_HOST<span style="color:#f92672">=</span>some-zabbix-server <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>   -d zabbix/zabbix-proxy-mysql:alpine-6.0-latest</span></span></code></pre></div></blockquote>
<hr>
<h3 id="é…ç½®nginxä½¿æµè§ˆå™¨è®¿é—®zabbix">é…ç½®<code>Nginx</code>ä½¿æµè§ˆå™¨è®¿é—®<code>Zabbix</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat &gt;/usr/local/nginx/conf/vhosts/zabbix.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> listen 80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> server_name zabbix.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> location / {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     root   /usr/local/nginx/html/zabbix;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     index  index.php index.html index.htm;  	# æ·»åŠ &#34;index.php&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # tcp socket é€šä¿¡æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> location ~ \.php$ {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     root	/usr/local/nginx/html/zabbix;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_pass  127.0.0.1:9000;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_index index.php;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;  	# fastcgi_paramè¡Œæ”¹æˆè¿™ä¸ªã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     include  fastcgi_params;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # Unix socke é€šä¿¡æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> location ~ \.php(.*)$ {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     root	/usr/local/nginx/html/zabbix;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_pass unix:/tmp/php7.sock;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_index index.php;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_split_path_info ^((?U).+\.php)(/?.+)$;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_param PATH_INFO $fastcgi_path_info;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     include  fastcgi_params;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> } 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> error_page 404 http://zabbix.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> access_log  /usr/local/nginx/logs/zabbix-access.log  main;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> error_log   /usr/local/nginx/logs/zabbix-error.log  info;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="å¯åŠ¨zabbixæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯">å¯åŠ¨<code>Zabbix</code>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Debian ç³»ç»Ÿéœ€æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>$ sudo ln -s /usr/local/mysql/lib/libmysqlclient.so.20 /usr/lib/libmysqlclient.so.20
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /opt/zabbix/sbin/zabbix_server  	<span style="color:#75715e"># å¯åŠ¨ Zabbix Server</span>
</span></span><span style="display:flex;"><span>$ /opt/zabbix/sbin/zabbix_agentd  	<span style="color:#75715e"># å¯åŠ¨ Zabbix Agentd</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="å¤„ç†è®¿é—®é¡µé¢åæ²¡æœ‰ä¸­æ–‡é€‰é¡¹">å¤„ç†è®¿é—®é¡µé¢åæ²¡æœ‰ä¸­æ–‡é€‰é¡¹</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ—å‡ºè¯´æœ‰æ”¯æŒçš„è¯­è¨€</span>
</span></span><span style="display:flex;"><span>$ locale -a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¦‚æœæ²¡æœ‰æƒ³è¦çš„è¯­è¨€ç¯å¢ƒï¼Œæ‰“å¼€ä¸‹æ–¹æ–‡ä»¶æ‰¾åˆ°éœ€è¦çš„è¯­è¨€å–æ¶ˆæ³¨é‡Š</span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;/etc/locale.gen<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># zh_CN.UTF-8 UTF-8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡è½½è¯­è¨€ç¯å¢ƒ</span>
</span></span><span style="display:flex;"><span>$ sudo locale-gen
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡å¯PHPä½¿é…ç½®ç”Ÿæ•ˆï¼Œç„¶ååˆ·æ–°æµè§ˆå™¨</span>
</span></span><span style="display:flex;"><span>$ sudo /etc/init.d/php-fpm restart</span></span></code></pre></div></blockquote>
<hr>
<h3 id="webé¡µé¢é…ç½®zabbix"><code>web</code>é¡µé¢é…ç½®<code>zabbix</code></h3>
<blockquote>
<p><a href="#R-image-7645e66d00c42505a5f266012b2dfa13" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-08-45.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7645e66d00c42505a5f266012b2dfa13"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-08-45.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->ä¸‹æ–¹å›¾ç‰‡æ˜¾ç¤ºè¦ä¿®æ”¹çš„<!-- raw HTML omitted --><code>PHP</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶,ä¿®æ”¹åé‡å¯<!-- raw HTML omitted --><code>php-fpm</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/post_max_size = 8M/post_max_size = 16M/g&#34;</span> /usr/local/php/etc/php.ini  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/max_execution_time = 30/max_execution_time = 300/g&#34;</span> /usr/local/php/etc/php.ini  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/max_input_time = 60/max_input_time = 300/g&#34;</span> /usr/local/php/etc/php.ini </span></span></code></pre></div><p><a href="#R-image-bebd85742f9d43cd9c3ce59afcb0b15b" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-11-47.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bebd85742f9d43cd9c3ce59afcb0b15b"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-11-47.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->è¿æ¥æ•°æ®åº“æŠ¥é”™<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ln -s /var/lib/mysql/mysql.sock /tmp/</span></span></code></pre></div><p><a href="#R-image-b77346fbde264fac46bed5185f17d98e" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-13-46.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b77346fbde264fac46bed5185f17d98e"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-13-46.png"></a></p>
<p><a href="#R-image-bf42bb60ea5e7968b79622826e13819b" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-15-02.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bf42bb60ea5e7968b79622826e13819b"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-15-02.png"></a></p>
<p><a href="#R-image-053051777b24686d730fc53b8bc97535" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-15-52.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-053051777b24686d730fc53b8bc97535"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-15-52.png"></a></p>
<p><a href="#R-image-dcd3ede899acef32f3df0ea234d4e665" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-16-37.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-dcd3ede899acef32f3df0ea234d4e665"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-16-37.png"></a></p>
<p><a href="#R-image-0a29a087918764f9bc3f9770ad0f3a20" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-17-40.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0a29a087918764f9bc3f9770ad0f3a20"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-17-40.png"></a></p>
<p><a href="#R-image-0ca843b509146bd5b078761716f32341" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-18-45.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0ca843b509146bd5b078761716f32341"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-18-45.png"></a></p>
<ul>
<li><!-- raw HTML omitted --><strong>é»˜è®¤å¸æˆ·ï¼š</strong><!-- raw HTML omitted --><code>Admin</code><!-- raw HTML omitted -->ï¼Œ<strong>é»˜è®¤å¯†ç ï¼š</strong><!-- raw HTML omitted --><code>zabbix</code></li>
</ul>
<p><a href="#R-image-ae95777879f433b9d7a42fc1bc0c9f7d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-20-31.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ae95777879f433b9d7a42fc1bc0c9f7d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server/Snipaste_2022-09-14_23-20-31.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->å¤„ç†å›¾å½¢æ±‰å­—ä¹±ç <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rz /usr/local/nginx/html/assets/fonts
</span></span><span style="display:flex;"><span>$ mv simhei.ttf DejaVuSans.ttf</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ç¼–è¯‘å®‰è£…zabbix-agent">ç¼–è¯‘å®‰è£…<code>Zabbix Agent</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->éƒ¨ç½²å‰å‡†å¤‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir /opt/<span style="color:#f92672">{</span>src,zabbix-agent<span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><a href="https://cdn.zabbix.com/zabbix/binaries/stable/" rel="external" target="_self">ä¸‹è½½å®‰è£…åŒ…</a><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install wget
</span></span><span style="display:flex;"><span>$ wget -P /opt/src/ 
</span></span><span style="display:flex;"><span>https://cdn.zabbix.com/zabbix/binaries/stable/6.0/6.0.14/zabbix_agent-6.0.14-linux-3.0-amd64-static.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar -zxvf /opt/src/zabbix_agent-6.0.14-linux-3.0-amd64-static.tar.gz -C /opt/zabbix-agent </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Zabbix Agent</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/zabbix-agent/conf/zabbix_agentd.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Server=127.0.0.1  	# æ·»åŠ Zabbix ServeræœåŠ¡å™¨IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ServerActive=127.0.0.1  	# æ›¿æ¢ä¸ºZabbix ServeræœåŠ¡å™¨IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Hostname=æœ¬æœºä¸»æœºå  	# è¢«ç›‘æ§ç«¯è‡ªå·±çš„ä¸»æœºå
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">AllowKey=system.run[*]  	# ç›‘æ§å¼‚å¸¸åï¼Œæ˜¯å¦å…è®¸æœåŠ¡å™¨è¿œç¨‹è¿‡æ¥æ‰§è¡Œå‘½ä»¤ï¼Œå¦‚é‡å¯æŸä¸ªæœåŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">UnsafeUserParameters=1  	# æ˜¯å¦å…è®¸è‡ªå®šä¹‰keyç›‘æ§
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Zabbix Agent</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/zabbix-agent/sbin/zabbix_agentd -c /opt/zabbix-agent/conf/zabbix_agentd.conf</span></span></code></pre></div></blockquote>
<hr>
<h2 id="é…ç½®zabbixé€šä¿¡åŠ å¯†">é…ç½®<code>Zabbix</code>é€šä¿¡åŠ å¯†</h2>
<ul>
<li>
<ol>
<li>ç”³è¯·è¯ä¹¦</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆcaç§é’¥</span>
</span></span><span style="display:flex;"><span>$ openssl genrsa <span style="color:#ae81ff">2048</span> &gt; ca.key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨caç§é’¥å»ºç«‹caè¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ openssl req -new -x509 -nodes -days <span style="color:#ae81ff">1000</span> -key ca.key -subj /CN<span style="color:#f92672">=</span>Signing<span style="color:#ae81ff">\ </span>CA/OU<span style="color:#f92672">=</span>Development<span style="color:#ae81ff">\ </span>group/O<span style="color:#f92672">=</span>Zabbix<span style="color:#ae81ff">\ </span>SIA/DC<span style="color:#f92672">=</span>zabbix/DC<span style="color:#f92672">=</span>com &gt; ca.crt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”ŸæˆæœåŠ¡å™¨csrè¯ä¹¦è¯·æ±‚æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ openssl req -newkey rsa:2048 -days <span style="color:#ae81ff">1000</span> -nodes -keyout server.key -subj /CN<span style="color:#f92672">=</span>server/OU<span style="color:#f92672">=</span>Development<span style="color:#ae81ff">\ </span>group/O<span style="color:#f92672">=</span>Zabbix<span style="color:#ae81ff">\ </span>SIA/DC<span style="color:#f92672">=</span>zabbix/DC<span style="color:#f92672">=</span>com &gt; server.csr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨caè¯ä¹¦ä¸ç§é’¥ç­¾å‘æœåŠ¡å™¨è¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ openssl x509 -req -in server.csr -days <span style="color:#ae81ff">1000</span> -CA ca.crt -CAkey ca.key -set_serial <span style="color:#ae81ff">01</span> &gt; server.crt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿæˆå®¢æˆ·ç«¯csrè¯ä¹¦è¯·æ±‚æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ openssl req -newkey rsa:2048 -days <span style="color:#ae81ff">1000</span> -nodes -keyout client.key -subj /CN<span style="color:#f92672">=</span>client/OU<span style="color:#f92672">=</span>Development<span style="color:#ae81ff">\ </span>group/O<span style="color:#f92672">=</span>Zabbix<span style="color:#ae81ff">\ </span>SIA/DC<span style="color:#f92672">=</span>zabbix/DC<span style="color:#f92672">=</span>com &gt; client.csr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨caè¯ä¹¦ä¸ç§é’¥ç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦</span>
</span></span><span style="display:flex;"><span>$ openssl x509 -req -in client.csr -days <span style="color:#ae81ff">1000</span> -CA ca.crt -CAkey ca.key -set_serial <span style="color:#ae81ff">01</span> &gt; client.crt</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>é…ç½®<code>Zabbix Server</code>æœåŠ¡ç«¯</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/zabbix/etc/zabbix_server.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹TLSCAFileé…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSCAFile=/opt/zabbix_server/zabbix_crt/ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹TLSCertFileé…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSCertFile=/opt/zabbix_server/zabbix_crt/server.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹TLSKeyFileé…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSKeyFile=/opt/zabbix_server/zabbix_crt/server.key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li>é…ç½®<code>Zabbix Agent</code>ç«¯</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>é…ç½®<code>PSK</code>åŠ å¯†</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/zabbix-agent/conf/zabbix_agentd.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSPSKIdentity= PSK Name  	# ä¸€è‡´æ€§å…±äº«å¯†é’¥åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSPSKFile= PSK File  	# PSK å…±äº«å¯†é’¥æ–‡ä»¶å­˜æ”¾è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>é…ç½®è¯ä¹¦åŠ å¯†</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/zabbix-agent/conf/zabbix_agentd.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹agentè¿æ¥æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSConnect=cert
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹ä¼ å…¥æ•°æ®è¿æ¥æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSAccept=cert
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹TLSCAFileé…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSCAFile=/opt/zabbix_agent/zabbix_crt/ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹TLSCertFileé…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSCertFile=/opt/zabbix_agent/zabbix_crt/client.crt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹TLSKeyFileé…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TLSKeyFile=/opt/zabbix_agent/zabbix_crt/client.key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_prometheus">Install_Prometheus</h1>

<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="prometheus"><code>Prometheus</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://prometheus.io/docs/introduction/first_steps/" rel="external" target="_self"><code>Prometheus</code>å®˜ç½‘</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://yunlzheng.gitbook.io/prometheus-book" rel="external" target="_self"><code>prometheus-book</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/prometheus" rel="external" target="_self"><code>Github-Prometheus</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://blog.gmem.cc/prometheus-study-note" rel="external" target="_self"><code>Prometheus</code>å­¦ä¹ ç¬”è®°</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://blog.51cto.com/qiangsh/3093700" rel="external" target="_self"><code>Prometheus</code>ä»‹ç»å’Œä½¿ç”¨</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://juejin.im/post/5d79d804e51d453b7779d5ce" rel="external" target="_self"><code>Prometheus</code>+<code>Grafana</code>è¯¦è§£</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/qianjingchen/articles/9578341.html" rel="external" target="_self"><code>Prometheus</code>è‡ªå®šä¹‰ç›‘æ§éƒ¨ç½²</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://prometheus.io/docs/instrumenting/clientlibs/" rel="external" target="_self"><code>Prometheus  CLIENT LIBRARIES</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://juejin.im/post/5d397c2fe51d45775e33f64a" rel="external" target="_self">ä½¿ç”¨<code>Prometheus</code>+<code>Grafana</code>å¿«é€Ÿæ‰“é€ é«˜é€¼æ ¼ç›‘æ§å¹³å°</a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æ¦‚è¿°<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><code>Prometheus</code>æ˜¯ä¸€ä¸ªå¼€æºç›‘æ§ç³»ç»Ÿï¼Œå®ƒå‰èº«æ˜¯<a href="https://soundcloud.com" rel="external" target="_self"><code>SoundCloud</code></a>çš„å‘Šè­¦å·¥å…·åŒ…ã€‚ä»<code>2012</code>å¹´å¼€å§‹ï¼Œè®¸å¤šå…¬å¸å’Œç»„ç»‡å¼€å§‹ä½¿ç”¨<code>Prometheus</code>ã€‚è¯¥é¡¹ç›®çš„å¼€å‘äººå‘˜å’Œç”¨æˆ·ç¤¾åŒºéå¸¸æ´»è·ƒï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘äººå‘˜å’Œç”¨æˆ·å‚ä¸åˆ°è¯¥é¡¹ç›®ä¸­ã€‚ç›®å‰å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¼€æºé¡¹ç›®ï¼Œä¸”ä¸ä¾èµ–äºä»»ä½•å…¬å¸ã€‚ä¸ºäº†å¼ºè°ƒè¿™ç‚¹å’Œæ˜ç¡®è¯¥é¡¹ç›®æ²»ç†ç»“æ„ï¼Œ<code>Prometheus</code>åœ¨<code>2016</code>å¹´ç»§<a href="https://kubernetes.io" rel="external" target="_self"><code>Kurberntes</code></a>ä¹‹åï¼ŒåŠ å…¥äº†<a href="https://www.cncf.io" rel="external" target="_self"><code>Cloud Native Computing Foundation</code></a></p>
<ul>
<li>1.1 <code>prometheus</code><!-- raw HTML omitted -->ç‰¹ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¤šç»´åº¦æ•°æ®æ¨¡å‹ï¼Œä¸€ä¸ªæ—¶é—´åºåˆ—ç”±ä¸€ä¸ªåº¦é‡æŒ‡æ ‡å’Œå¤šä¸ªæ ‡ç­¾é”®å€¼å¯¹ç¡®å®š<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->çµæ´»çš„æŸ¥è¯¢è¯­è¨€ï¼Œå¯¹æ”¶é›†çš„æ—¶è®¸æ•°æ®è¿›è¡Œé‡ç»„<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¼ºå¤§çš„æ•°æ®å¯è§†åŒ–åŠŸèƒ½ï¼Œé™¤äº†å†…ç½®çš„æµè§ˆå™¨ï¼Œä¹Ÿæ”¯æŒ<!-- raw HTML omitted --><code>grafana</code><!-- raw HTML omitted -->é›†æˆ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é«˜æ•ˆå­˜å‚¨ï¼Œå†…å­˜åŠ æœ¬åœ°ç£ç›˜ï¼Œå¯é€šè¿‡åŠŸèƒ½åˆ†ç‰‡å’Œè”ç›Ÿæ¥æ‹“å±•æ€§èƒ½<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->è¿ç»´ç®€å•ï¼Œåªä¾èµ–äºæœ¬åœ°ç£ç›˜ï¼Œ<!-- raw HTML omitted --><code>go</code><!-- raw HTML omitted -->äºŒè¿›åˆ¶å®‰è£…åŒ…æ²¡æœ‰ä»»ä½•å…¶ä»–ä¾èµ– <!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ç²¾ç®€å‘Šè­¦<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->éå¸¸å¤šçš„å®¢æˆ·ç«¯åº“<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æä¾›äº†è®¸å¤šå¯¼å‡ºå™¨æ¥æ”¶é›†å¸¸ç”¨ç³»ç»ŸæŒ‡æ ‡<!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->æ•°æ®æ¨¡å‹ <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><code>Prometheus</code>ä»æ ¹æœ¬ä¸Šå­˜å‚¨çš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯æ—¶é—´åºåˆ—æ•°æ®ï¼ˆ<code>Time Serie Data</code>ï¼Œç®€ç§°æ—¶åºæ•°æ®ï¼‰ã€‚æ—¶åºæ•°æ®æ˜¯å…·æœ‰æ—¶é—´æˆ³çš„æ•°æ®æµï¼Œè¯¥æ•°æ®æµå±äºæŸä¸ªåº¦é‡æŒ‡æ ‡ï¼ˆ<code>Metric</code>ï¼‰å’Œè¯¥åº¦é‡æŒ‡æ ‡ä¸‹çš„å¤šä¸ªæ ‡ç­¾ï¼ˆ<code>Label</code>ï¼‰ã€‚é™¤äº†æä¾›å­˜å‚¨åŠŸèƒ½ï¼Œ<code>Prometheus</code>è¿˜å¯ä»¥åˆ©ç”¨æŸ¥è¯¢è¡¨è¾¾å¼æ¥æ‰§è¡Œéå¸¸çµæ´»å’Œå¤æ‚çš„æŸ¥è¯¢ã€‚</p>
<ul>
<li>
<p><!-- raw HTML omitted -->åº¦é‡æŒ‡æ ‡å’Œæ ‡ç­¾<!-- raw HTML omitted --></p>
<p>æ¯ä¸ªæ—¶é—´åºåˆ—ï¼ˆ<code>Time Serie</code>ï¼Œç®€ç§°æ—¶åºï¼‰ç”±åº¦é‡æŒ‡æ ‡å’Œä¸€ç»„æ ‡ç­¾é”®å€¼å¯¹å”¯ä¸€ç¡®å®šã€‚</p>
</li>
<li>
<p>åº¦é‡æŒ‡æ ‡åç§°æè¿°äº†è¢«ç›‘æ§ç³»ç»Ÿçš„æŸä¸ªæµ‹é‡ç‰¹å¾ï¼ˆæ¯”å¦‚<code>http_requests_total</code>è¡¨ç¤º<code>http</code>è¯·æ±‚æ€»æ•°ï¼‰ã€‚åº¦é‡æŒ‡æ ‡åç§°ç”±<code>ASCII</code>å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œå†’å·ç»„æˆï¼Œé¡»åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼<code>[a-zA-Z_:][a-zA-Z0-9_:]*</code>ã€‚</p>
</li>
<li>
<p>æ ‡ç­¾å¼€å¯äº†<code>Prometheus</code>çš„å¤šç»´æ•°æ®æ¨¡å‹ã€‚å¯¹äºåŒä¸€ä¸ªåº¦é‡æŒ‡æ ‡ï¼Œä¸åŒæ ‡ç­¾å€¼ç»„åˆä¼šå½¢æˆç‰¹å®šç»´åº¦çš„æ—¶åºã€‚<code>Prometheus</code>çš„æŸ¥è¯¢è¯­è¨€å¯ä»¥é€šè¿‡åº¦é‡æŒ‡æ ‡å’Œæ ‡ç­¾å¯¹æ—¶åºæ•°æ®è¿›è¡Œè¿‡æ»¤å’Œèšåˆã€‚æ”¹å˜ä»»ä½•åº¦é‡æŒ‡æ ‡ä¸Šçš„ä»»ä½•æ ‡ç­¾å€¼ï¼Œéƒ½ä¼šå½¢æˆæ–°çš„æ—¶åºã€‚æ ‡ç­¾åç§°å¯ä»¥åŒ…å«<code>ASCII</code>å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œé¡»åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼<code>[a-zA-Z_][a-zA-Z0-9_]*</code>ï¼Œå¸¦æœ‰ _ ä¸‹åˆ’çº¿çš„æ ‡ç­¾åç§°ä¿ç•™ä¸ºå†…éƒ¨ä½¿ç”¨ã€‚æ ‡ç­¾å€¼å¯ä»¥åŒ…å«ä»»æ„<code>Unicode</code>å­—ç¬¦ï¼ŒåŒ…æ‹¬ä¸­æ–‡ã€‚</p>
</li>
<li>
<p><!-- raw HTML omitted -->é‡‡æ ·å€¼(<code>Sample</code>)<!-- raw HTML omitted --></p>
</li>
</ul>
<blockquote>
<p>æ—¶åºæ•°æ®å…¶å®å°±æ˜¯ä¸€ç³»åˆ—é‡‡æ ·å€¼ã€‚æ¯ä¸ªé‡‡æ ·å€¼åŒ…æ‹¬ï¼š</p>
<ul>
<li><!-- raw HTML omitted -->ä¸€ä¸ª<code>64</code>ä½çš„æµ®ç‚¹æ•°å€¼  <!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä¸€ä¸ªç²¾ç¡®åˆ°æ¯«ç§’çš„æ—¶é—´æˆ³  <!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->æ³¨è§£(<code>Notation</code>)<!-- raw HTML omitted --></li>
</ul>
<p>ä¸€ä¸ªæ³¨è§£ç”±ä¸€ä¸ªåº¦é‡æŒ‡æ ‡å’Œä¸€ç»„æ ‡ç­¾é”®å€¼å¯¹æ„æˆã€‚å½¢å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>metric name<span style="color:#f92672">]{[</span>label name<span style="color:#f92672">]=[</span>label value<span style="color:#f92672">]</span>, ...<span style="color:#f92672">}</span>  </span></span></code></pre></div><p>ä¾‹å¦‚ï¼Œåº¦é‡æŒ‡æ ‡ä¸º<code>api_http_requests_total</code>ï¼Œæ ‡ç­¾ä¸º<code>method=&quot;POST&quot;</code>ã€<code>handler=&quot;/messages&quot;</code>çš„æ³¨è§£è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>api_http_requests_total<span style="color:#f92672">{</span>method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span>, handler<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/messages&#34;</span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åº¦é‡æŒ‡æ ‡ç±»å‹ <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¡æ•°å™¨(<code>Counter</code>)<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>è®¡æ•°å™¨æ˜¯ä¸€ç§ç´¯è®¡å‹çš„åº¦é‡æŒ‡æ ‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªåªèƒ½é€’å¢çš„æ•°å€¼ã€‚è®¡æ•°å™¨ä¸»è¦ç”¨äºç»Ÿè®¡ç±»ä¼¼äºæœåŠ¡è¯·æ±‚æ•°ã€ä»»åŠ¡å®Œæˆæ•°å’Œé”™è¯¯å‡ºç°æ¬¡æ•°è¿™æ ·çš„æ•°æ®</code></pre></div><ul>
<li><!-- raw HTML omitted -->è®¡é‡å™¨(<code>Gauge</code>)<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>è®¡é‡å™¨è¡¨ç¤ºä¸€ä¸ªæ—¢å¯ä»¥å¢åŠ , åˆå¯ä»¥å‡å°‘çš„åº¦é‡æŒ‡æ ‡å€¼ã€‚è®¡é‡å™¨ä¸»è¦ç”¨äºæµ‹é‡ç±»ä¼¼äºæ¸©åº¦ã€å†…å­˜ä½¿ç”¨é‡è¿™æ ·çš„ç¬æ—¶æ•°æ®</code></pre></div><ul>
<li><!-- raw HTML omitted -->ç›´æ–¹å›¾(<code>Histogram</code>)<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>ç›´æ–¹å›¾å¯¹è§‚å¯Ÿç»“æœï¼ˆé€šå¸¸æ˜¯è¯·æ±‚æŒç»­æ—¶é—´æˆ–è€…å“åº”å¤§å°è¿™æ ·çš„æ•°æ®ï¼‰è¿›è¡Œé‡‡æ ·ï¼Œå¹¶åœ¨å¯é…ç½®çš„æ¡¶ä¸­å¯¹å…¶è¿›è¡Œç»Ÿè®¡ã€‚æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥äº§ç”Ÿç›´æ–¹å›¾ï¼ˆå‡è®¾åº¦é‡æŒ‡æ ‡ä¸º ï¼‰ï¼š  </code></pre></div><ul>
<li><!-- raw HTML omitted -->æŒ‰æ¡¶è®¡æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>ç›¸å½“äº&lt;basename&gt;_bucket{le=&#34;&lt;upper inclusive bound&gt;&#34;}</code></pre></div><ul>
<li><!-- raw HTML omitted -->é‡‡æ ·å€¼æ€»å’Œ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>ç›¸å½“äº &lt;basename&gt;_sum  </code></pre></div><ul>
<li><!-- raw HTML omitted -->é‡‡æ ·å€¼æ€»æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>ç›¸å½“äº &lt;basename&gt;_count ï¼Œä¹Ÿç­‰åŒäºæŠŠæ‰€æœ‰é‡‡æ ·å€¼æ”¾åˆ°ä¸€ä¸ªæ¡¶é‡Œæ¥è®¡æ•° &lt;basename&gt;_bucket{le=&#34;+Inf&#34;}</code></pre></div><ul>
<li><!-- raw HTML omitted -->æ±‡æ€»(<code>Summary</code>)<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>ç±»ä¼¼äºç›´æ–¹å›¾ï¼Œæ±‡æ€»ä¹Ÿå¯¹è§‚å¯Ÿç»“æœè¿›è¡Œé‡‡æ ·ã€‚é™¤äº†å¯ä»¥ç»Ÿè®¡é‡‡æ ·å€¼æ€»å’Œå’Œæ€»æ•°ï¼Œå®ƒè¿˜èƒ½å¤ŸæŒ‰åˆ†ä½æ•°ç»Ÿè®¡ã€‚æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥äº§ç”Ÿæ±‡æ€»ï¼ˆå‡è®¾åº¦é‡æŒ‡æ ‡ä¸º ï¼‰ï¼š</code></pre></div><ul>
<li><!-- raw HTML omitted -->é‡‡æ ·å€¼æ€»å’Œ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>ç›¸å½“äº &lt;basename&gt;_sum</code></pre></div><ul>
<li><!-- raw HTML omitted -->é‡‡æ ·å€¼æ€»æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>ç›¸å½“äº &lt;basename&gt;_count  </code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ä»»åŠ¡(<code>Job</code>)å’Œå®ä¾‹(<code>Instance</code>)<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p>åœ¨<code>Prometheus</code>é‡Œï¼Œå¯ä»¥ä»ä¸­æŠ“å–é‡‡æ ·å€¼çš„ç«¯ç‚¹ç§°ä¸ºå®ä¾‹ï¼Œä¸ºäº†æ€§èƒ½æ‰©å±•è€Œå¤åˆ¶å‡ºæ¥çš„å¤šä¸ªè¿™æ ·çš„å®ä¾‹å½¢æˆäº†ä¸€ä¸ªä»»åŠ¡</p>
<ul>
<li><!-- raw HTML omitted -->ä¾‹å¦‚ä¸‹é¢çš„<!-- raw HTML omitted --><code>api-server</code><!-- raw HTML omitted -->ä»»åŠ¡æœ‰å››ä¸ªç›¸åŒçš„å®ä¾‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>job: api-server
instance 1: 1.2.3.4:5670
instance 2: 1.2.3.4:5671
instance 3: 5.6.7.8:5670
instance 4: 5.6.7.8:5671</code></pre></div><p>â€‹	<code>Prometheus</code>æŠ“å–å®Œé‡‡æ ·å€¼åï¼Œä¼šè‡ªåŠ¨ç»™é‡‡æ ·å€¼æ·»åŠ ä¸‹é¢çš„æ ‡ç­¾å’Œå€¼ï¼š</p>
<ul>
<li>
<p><code>job:</code><!-- raw HTML omitted --> æŠ“å–æ‰€å±ä»»åŠ¡<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>instance</code><!-- raw HTML omitted -->ï¼š æŠ“å–æ¥æºå®ä¾‹<!-- raw HTML omitted --></p>
<p>å¦å¤–æ¯æ¬¡æŠ“å–æ—¶ï¼Œ<code>Prometheus</code>è¿˜ä¼šè‡ªåŠ¨åœ¨ä»¥ä¸‹æ—¶åºé‡Œæ’å…¥é‡‡æ ·å€¼ï¼š</p>
</li>
<li>
<p><code>up{job=&quot;[job-name]&quot;, instance=&quot;instance-id&quot;}</code><!-- raw HTML omitted -->ï¼šé‡‡æ ·å€¼ä¸º 1 è¡¨ç¤ºå®ä¾‹å¥åº·ï¼Œå¦åˆ™ä¸ºä¸å¥åº·<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>scrape_duration_seconds{job=&quot;[job-name]&quot;, instance=&quot;[instance-id]&quot;}</code><!-- raw HTML omitted -->ï¼šé‡‡æ ·å€¼ä¸ºæœ¬æ¬¡æŠ“å–æ¶ˆè€—æ—¶é—´<!-- raw HTML omitted --></p>
</li>
<li>
<p><code>scrape_samples_post_metric_relabeling{job=&quot;&lt;job-name&gt;&quot;, instance=&quot;&lt;instance-id&gt;&quot;}</code><!-- raw HTML omitted -->ï¼šé‡‡æ ·å€¼ä¸ºé‡æ–°æ‰“æ ‡ç­¾åçš„é‡‡æ ·å€¼ä¸ªæ•°  <!-- raw HTML omitted --></p>
</li>
<li>
<p><code>scrape_samples_scraped{job=&quot;&lt;job-name&gt;&quot;, instance=&quot;&lt;instance-id&gt;&quot;}</code><!-- raw HTML omitted -->ï¼šé‡‡æ ·å€¼ä¸ºæœ¬æ¬¡æŠ“å–åˆ°çš„é‡‡æ ·å€¼ä¸ªæ•°  <!-- raw HTML omitted --></p>
</li>
</ul>
</blockquote>
<hr>
<h3 id="prometheusä¸å…¶ä»–ç›‘æ§ç³»ç»Ÿå¯¹æ¯”"><code>Prometheus</code>ä¸å…¶ä»–ç›‘æ§ç³»ç»Ÿå¯¹æ¯”</h3>
<ul>
<li>
<ol>
<li><code>Prometheus vs Zabbix</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.zabbix.com" rel="external" target="_self"><code>Zabbix</code></a><!-- raw HTML omitted -->ä½¿ç”¨çš„æ˜¯<!-- raw HTML omitted --><code>C</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>PHP</code>, <code>Prometheus</code><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Golang</code><!-- raw HTML omitted -->æ•´ä½“è€Œè¨€<!-- raw HTML omitted --><code>Prometheus</code><!-- raw HTML omitted -->è¿è¡Œé€Ÿåº¦æ›´å¿«ä¸€ç‚¹<!-- raw HTML omitted --></li>
<li><code>Zabbix</code><!-- raw HTML omitted -->å±äºä¼ ç»Ÿä¸»æœºç›‘æ§ï¼Œä¸»è¦ç”¨äºç‰©ç†ä¸»æœºã€äº¤æ¢æœºã€ç½‘ç»œç­‰ç›‘æ§ï¼Œ<!-- raw HTML omitted --><code>Prometheus</code><!-- raw HTML omitted -->ä¸ä»…é€‚ç”¨ä¸»æœºç›‘æ§ï¼Œè¿˜é€‚ç”¨äº<!-- raw HTML omitted --><code>Cloud</code>ã€<code>SaaS</code>ã€<code>Openstack</code>ã€<code>Container</code><!-- raw HTML omitted -->ç›‘æ§<!-- raw HTML omitted --></li>
<li><code>Zabbix</code><!-- raw HTML omitted -->åœ¨ä¼ ç»Ÿä¸»æœºç›‘æ§æ–¹é¢ï¼Œæœ‰æ›´ä¸°å¯Œçš„æ’ä»¶<!-- raw HTML omitted --></li>
<li><code>Zabbix</code><!-- raw HTML omitted -->å¯ä»¥åœ¨<!-- raw HTML omitted --><code>WebGui</code><!-- raw HTML omitted -->ä¸­é…ç½®å¾ˆå¤šäº‹æƒ…ï¼Œ<!-- raw HTML omitted --><code>Prometheus</code><!-- raw HTML omitted -->éœ€è¦æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶é…ç½®<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>Prometheus vs Nagios</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.nagios.org" rel="external" target="_self"><code>Nagios</code></a><!-- raw HTML omitted -->æ•°æ®ä¸æ”¯æŒè‡ªå®šä¹‰<!-- raw HTML omitted --><code>Labels</code><!-- raw HTML omitted -->, ä¸æ”¯æŒæŸ¥è¯¢ï¼Œå‘Šè­¦ä¹Ÿä¸æ”¯æŒå»å™ªã€åˆ†ç»„, æ²¡æœ‰æ•°æ®å­˜å‚¨ï¼Œå¦‚æœæƒ³æŸ¥è¯¢å†å²çŠ¶æ€ï¼Œéœ€è¦å®‰è£…æ’ä»¶<!-- raw HTML omitted --></li>
<li><code>Nagios</code><!-- raw HTML omitted -->æ˜¯ä¸Šä¸–çºª 90 å¹´ä»£çš„ç›‘æ§ç³»ç»Ÿï¼Œæ¯”è¾ƒé€‚åˆå°é›†ç¾¤æˆ–é™æ€ç³»ç»Ÿçš„ç›‘æ§<!-- raw HTML omitted --><code>Nagios</code><!-- raw HTML omitted -->å¤ªå¤è€ï¼Œå¾ˆå¤šç‰¹æ€§éƒ½æ²¡æœ‰<!-- raw HTML omitted --><code>Prometheus</code><!-- raw HTML omitted -->è¦ä¼˜ç§€å¾ˆå¤š<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><code>Prometheus vs Sensu</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://sensu.io" rel="external" target="_self"><code>Sensu</code></a><!-- raw HTML omitted -->å¹¿ä¹‰ä¸Šè®²æ˜¯<!-- raw HTML omitted --><code>Nagios</code><!-- raw HTML omitted -->çš„å‡çº§ç‰ˆæœ¬ï¼Œå®ƒè§£å†³äº†å¾ˆå¤š<!-- raw HTML omitted --><code>Nagios</code><!-- raw HTML omitted -->çš„é—®é¢˜ï¼Œå¦‚æœä½ å¯¹<!-- raw HTML omitted --><code>Nagios</code><!-- raw HTML omitted -->å¾ˆç†Ÿæ‚‰ï¼Œä½¿ç”¨<!-- raw HTML omitted --><code>Sensu</code><!-- raw HTML omitted -->æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©<!-- raw HTML omitted --></li>
<li><code>Sensu</code><!-- raw HTML omitted -->ä¾èµ–<!-- raw HTML omitted --><code>RabbitMQ</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>Redis</code><!-- raw HTML omitted -->ï¼Œæ•°æ®å­˜å‚¨ä¸Šæ‰©å±•æ€§æ›´å¥½<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>Prometheus vs InfluxDB</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.influxdata.com" rel="external" target="_self"><code>InflusDB</code></a><!-- raw HTML omitted -->æ˜¯ä¸€ä¸ªå¼€æºçš„æ—¶åºæ•°æ®åº“ï¼Œä¸»è¦ç”¨äºå­˜å‚¨æ•°æ®ï¼Œå¦‚æœæƒ³æ­å»ºç›‘æ§å‘Šè­¦ç³»ç»Ÿï¼Œéœ€è¦ä¾èµ–å…¶ä»–ç³»ç»Ÿ<!-- raw HTML omitted --></li>
<li><code>InfluxDB</code><!-- raw HTML omitted -->åœ¨å­˜å‚¨æ°´å¹³æ‰©å±•ä»¥åŠé«˜å¯ç”¨æ–¹é¢åšçš„æ›´å¥½, æ¯•ç«Ÿæ ¸å¿ƒæ˜¯æ•°æ®åº“<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h3 id="altermanageræ ¸å¿ƒæ¦‚å¿µ"><code>altermanager</code>æ ¸å¿ƒæ¦‚å¿µ</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åˆ†ç»„<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>åˆ†ç»„å°†ç±»ä¼¼æ€§è´¨çš„è­¦æŠ¥åˆ†ç±»ä¸ºå•ä¸ªé€šçŸ¥ã€‚åœ¨è®¸å¤šç³»ç»Ÿä¸€æ¬¡æ€§å¤±è´¥å¹¶ä¸”æ•°ç™¾åˆ°æ•°åƒä¸ªè­¦æŠ¥å¯èƒ½åŒæ—¶å‘ç”Ÿçš„è¾ƒå¤§ä¸­æ–­æœŸé—´ï¼Œè¿™å°¤å…¶æœ‰ç”¨</li>
<li>ç¤ºä¾‹ï¼šå‘ç”Ÿç½‘ç»œåˆ†åŒºæ—¶ï¼Œç¾¤é›†ä¸­æ­£åœ¨è¿è¡Œæ•°åæˆ–æ•°ç™¾ä¸ªæœåŠ¡å®ä¾‹ã€‚ä¸€åŠçš„æœåŠ¡å®ä¾‹æ— æ³•å†è®¿é—®æ•°æ®åº“ã€‚<code>Prometheus</code>ä¸­çš„è­¦æŠ¥è§„åˆ™é…ç½®ä¸ºåœ¨æ¯ä¸ªæœåŠ¡å®ä¾‹æ— æ³•ä¸æ•°æ®åº“é€šä¿¡æ—¶å‘é€è­¦æŠ¥ã€‚ç»“æœï¼Œæ•°ç™¾ä¸ªè­¦æŠ¥è¢«å‘é€åˆ°<code>Alertmanager</code></li>
<li>ä½œä¸ºç”¨æˆ·ï¼Œäººä»¬åªæƒ³è·å¾—å•ä¸ªé¡µé¢ï¼ŒåŒæ—¶ä»èƒ½å¤Ÿç¡®åˆ‡åœ°çœ‹åˆ°å“ªäº›æœåŠ¡å®ä¾‹å—åˆ°å½±å“ã€‚å› æ­¤ï¼Œå¯ä»¥å°†<code>Alertmanager</code>é…ç½®ä¸ºæŒ‰ç¾¤é›†å’Œ<code>alertname</code>å¯¹è­¦æŠ¥è¿›è¡Œåˆ†ç»„ï¼Œä»¥ä¾¿å‘é€å•ä¸ªç´§å‡‘é€šçŸ¥</li>
<li>é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„è·¯ç”±æ ‘é…ç½®è­¦æŠ¥çš„åˆ†ç»„ï¼Œåˆ†ç»„é€šçŸ¥çš„å®šæ—¶ä»¥åŠè¿™äº›é€šçŸ¥çš„æ¥æ”¶å™¨</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->æŠ‘åˆ¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>å¦‚æœæŸäº›å…¶ä»–è­¦æŠ¥å·²ç»è§¦å‘ï¼Œåˆ™æŠ‘åˆ¶æ˜¯æŠ‘åˆ¶æŸäº›è­¦æŠ¥çš„é€šçŸ¥çš„æ¦‚å¿µã€‚ç¤ºä¾‹ï¼šæ­£åœ¨è§¦å‘è­¦æŠ¥ï¼Œé€šçŸ¥æ— æ³•è®¿é—®æ•´ä¸ªé›†ç¾¤ã€‚<code>Alertmanager</code>å¯ä»¥é…ç½®ä¸ºåœ¨è¯¥ç‰¹å®šè­¦æŠ¥è§¦å‘æ—¶å°†ä¸è¯¥é›†ç¾¤æœ‰å…³çš„æ‰€æœ‰å…¶ä»–è­¦æŠ¥é™éŸ³ã€‚è¿™å¯ä»¥é˜²æ­¢æ•°ç™¾æˆ–æ•°åƒä¸ªä¸å®é™…é—®é¢˜æ— å…³çš„è§¦å‘è­¦æŠ¥çš„é€šçŸ¥ã€‚é€šè¿‡<code>Alertmanager</code>çš„é…ç½®æ–‡ä»¶é…ç½®ç¦æ­¢</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æ²‰é»˜<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>3æ²‰é»˜æ˜¯åœ¨ç»™å®šæ—¶é—´å†…ç®€å•åœ°é™éŸ³è­¦æŠ¥çš„ç®€å•æ–¹æ³•ã€‚åŸºäºåŒ¹é…å™¨é…ç½®é™é»˜ï¼Œå°±åƒè·¯ç”±æ ‘ä¸€æ ·ã€‚æ£€æŸ¥ä¼ å…¥è­¦æŠ¥å®ƒä»¬æ˜¯å¦åŒ¹é…æ´»åŠ¨é™é»˜çš„æ‰€æœ‰ç›¸ç­‰æˆ–æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å™¨ã€‚å¦‚æœä»–ä»¬è¿™æ ·åšï¼Œåˆ™ä¸ä¼šå‘é€è¯¥è­¦æŠ¥çš„é€šçŸ¥ã€‚åœ¨<code>Alertmanager</code>çš„<code>Web</code>ç•Œé¢ä¸­é…ç½®äº†é™éŸ³</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å®¢æˆ·ç«¯è¡Œä¸º<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Alertmanager</code>å¯¹å…¶å®¢æˆ·çš„è¡Œä¸ºæœ‰ç‰¹æ®Šè¦æ±‚ã€‚è¿™äº›ä»…é€‚ç”¨äºä¸ä½¿ç”¨<code>Prometheus</code>å‘é€è­¦æŠ¥çš„é«˜çº§ç”¨ä¾‹</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->é«˜å¯ç”¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>Alertmanager</code>æ”¯æŒé…ç½®ä»¥åˆ›å»ºç”¨äºé«˜å¯ç”¨æ€§çš„é›†ç¾¤ã€‚è¿™å¯ä»¥ä½¿ç”¨<code>--cluster- *</code>æ ‡å¿—è¿›è¡Œé…ç½®ã€‚é‡è¦çš„æ˜¯ä¸è¦åœ¨<code>Prometheus</code>å’Œå®ƒçš„<code>Alertmanagers</code>ä¹‹é—´åŠ è½½å¹³è¡¡æµé‡ï¼Œè€Œæ˜¯å°†<code>Prometheus</code>æŒ‡å‘æ‰€æœ‰<code>Alertmanagers</code>çš„åˆ—è¡¨</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->ç›‘æ§è¦ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>ç›‘æ§æ–¹å¼</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¡¬ä»¶ç›‘æ§</td>
<td>æ¸©åº¦ã€ç¡¬ä»¶æ•…éšœç­‰</td>
</tr>
<tr>
<td>ç³»ç»Ÿç›‘æ§</td>
<td><code>CPU</code>ã€å†…å­˜ã€ç¡¬ç›˜ã€ç½‘å¡æµé‡ã€<code>TCP</code>çŠ¶æ€ã€è¿›ç¨‹æ•°</td>
</tr>
<tr>
<td>åº”ç”¨ç›‘æ§</td>
<td><code>Nginx</code>ã€<code>Tomcat</code>ã€<code>PHP</code>ã€<code>MySQL</code>ã€<code>Redis</code>ç­‰</td>
</tr>
<tr>
<td>æ—¥å¿—ç›‘æ§</td>
<td>ç³»ç»Ÿæ—¥å¿—ã€æœåŠ¡æ—¥å¿—ã€è®¿é—®æ—¥å¿—ã€é”™è¯¯æ—¥å¿—</td>
</tr>
<tr>
<td>å®‰å…¨ç›‘æ§</td>
<td><code>WAF</code>ã€æ•æ„Ÿæ–‡ä»¶ç›‘æ§</td>
</tr>
<tr>
<td><code>API</code>ç›‘æ§</td>
<td>å¯ç”¨æ€§ã€æ¥å£è¯·æ±‚ã€ç›¸åº”æ—¶é—´</td>
</tr>
<tr>
<td>ä¸šåŠ¡ç›‘æ§</td>
<td>ä¾‹å¦‚ç”µå•†ç½‘ç«™ã€æ¯åˆ†é’Ÿç”Ÿæˆå¤šå°‘è®¢å•ã€æ³¨å†Œç”¨æˆ·å¤šå°‘ã€æ¨å¹¿æ´»åŠ¨æ•ˆæœ</td>
</tr>
<tr>
<td>æµé‡åˆ†æ</td>
<td>æ ¹æ®æµé‡è·å–ç”¨æˆ·ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·åœ°ç†ä½ç½®ã€æŸé¡µé¢è®¿é—®çŠ¶æ€ã€é¡µé¢åœç•™æ—¶é—´ç­‰</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Counter</code></td>
<td>é€’å¢è®¡æ•°å™¨ <code>eg</code>ï¼š <code>API</code></td>
</tr>
<tr>
<td><code>Gauge</code></td>
<td>å¯ä»¥ä»»æ„å˜åŒ–çš„æ•°å€¼ <code>eg. cpu</code>å ç”¨ç‡</td>
</tr>
<tr>
<td><code>Histogram</code></td>
<td>å¯¹ä¸€æ®µæ—¶é—´èŒƒå›´å†…æ•°æ®è¿›è¡Œé‡‡æ ·ï¼Œå¹¶å¯¹æ‰€æœ‰æ•°å€¼æ±‚å’Œä¸ç»Ÿè®¡æ•°é‡<code>eg</code>æŸ±çŠ¶å›¾</td>
</tr>
<tr>
<td><code>Summary</code></td>
<td>ä¸<code>Histogram</code>ç±»ä¼¼</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="å®‰è£…éƒ¨ç½²">å®‰è£…éƒ¨ç½²</h3>
<h4 id="prometheuså®‰è£…"><code>prometheus</code>å®‰è£…</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><a href="https://prometheus.io/docs/prometheus/latest/installation/" rel="external" target="_self"><code>docker</code>å®‰è£…</a><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/prometheus/<span style="color:#f92672">{</span>conf,logs,data<span style="color:#f92672">}</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker run --detach --name prometheus <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--restart always --publish 19090:9090 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume /opt/prometheus/data:/data <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--volume /opt/prometheus/conf:/etc/prometheus <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--config.file<span style="color:#f92672">=</span>/opt/prometheus/conf/prometheus.yml <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>prom/prometheus:v2.40.0  	<span style="color:#75715e"># --config.file ä½¿ç”¨é¢å¤–å·</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/docker-compost/prometheus/docker-compose.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">version: &#34;3&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">services:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">prometheus:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">container_name: prometheus  # å¯åŠ¨ååç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">image: &#39;prom/prometheus:v2.40.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># image: &#39;prom/prometheus:v2.40.4&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># image: &#39;prom/prometheus:v2.40.3&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">restart: always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hostname: &#39;prometheus&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">environment:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  TZ: Asia/Shanghai
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;19090:9090&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      volumes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;/opt/prometheus/data:/data&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;/opt/prometheus/conf:/etc/prometheus&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker-compose up -d</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><a href="https://prometheus.io/docs/prometheus/latest/getting_started/" rel="external" target="_self">äºŒè¿›åˆ¶å®‰è£…</a><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt/src <span style="color:#f92672">&amp;&amp;</span> wget https://github.com/prometheus/prometheus/releases/download/v2.40.0/prometheus-2.40.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar -zxf prometheus-2.40.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv prometheus-2.40.0.linux-amd64 prometheus  
</span></span><span style="display:flex;"><span>$ chown root.root prometheus -R </span></span></code></pre></div><ul>
<li>2.1 <!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/prometheus.service <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Prometheus
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://prometheus.io/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=simple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/prometheus/prometheus --config.file=/opt/prometheus/prometheus.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecReload=/bin/kill -HUP $MAINPID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure  	# æˆ–è€…ä½¿ç”¨ always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StandardOutput=syslog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StandardError=syslog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogIdentifier=prometheus
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">User=user_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Group=user_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=65535
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>å¯åŠ¨æœåŠ¡ã€ä»¥åŠè®¾ç½®å¼€æœºè‡ªå¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup ./prometheus --config.file<span style="color:#f92672">=</span>prometheus.yml 2&gt;&amp;<span style="color:#ae81ff">1</span> 1&gt;prometheus.log &amp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl enable prometheus
</span></span><span style="display:flex;"><span>$ systemctl start prometheus</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ netstat -lntup |grep prometheus
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::9090                 :::*                    LISTEN      16655/prometheus</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æºç å®‰è£…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ go get github.com/prometheus/prometheus/cmd/...  
</span></span><span style="display:flex;"><span>$ prometheus --config.file<span style="color:#f92672">=</span>your_config.yml  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆ–è€…make build  </span>
</span></span><span style="display:flex;"><span>$ mkdir -p $GOPATH/src/github.com/prometheus
</span></span><span style="display:flex;"><span>$ cd $GOPATH/src/github.com/prometheus
</span></span><span style="display:flex;"><span>$ git clone https://github.com/prometheus/prometheus.git
</span></span><span style="display:flex;"><span>$ cd prometheus
</span></span><span style="display:flex;"><span>$ make build
</span></span><span style="display:flex;"><span>$ ./prometheus --config.file<span style="color:#f92672">=</span>your_config.yml</span></span></code></pre></div></blockquote>
<hr>
<h4 id="alertmanagerå®‰è£…"><code>alertmanager</code>å®‰è£…</h4>
<ul>
<li>
<ol>
<li><code>docker</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://quay.io/repository/prometheus/alertmanager?tab=tags&tag=latest" rel="external" target="_self"><code>Alertmanager</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/alertmanager/<span style="color:#f92672">{</span>conf,logs,data<span style="color:#f92672">}</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker run --detach --name alertmanager <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --restart always --publish 19093:9093 --publish 19094:9094 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --volume /opt/alertmanager/data:/data <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --volume /opt/alertmanager/conf:/etc/alertmanager <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  quay.io/prometheus/alertmanager:latest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/opt/docker-compost/alertmanager/docker-compose.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">version: &#34;3&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  services:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    alertmanager:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      container_name: alertmanager  # å¯åŠ¨ååç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      image: &#39;quay.io/prometheus/alertmanager:latest&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      # image: &#39;quay.io/prometheus/alertmanager:v0.24.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      # image: &#39;quay.io/prometheus/alertmanager:v0.23.0&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      restart: always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      hostname: &#39;alertmanager&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      environment:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        TZ: Asia/Shanghai
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      ports:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;19093:9093&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;19094:9094&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      volumes:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;/opt/alertmanager/data:/data&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - &#39;/opt/alertmanager/conf:/etc/alertmanager&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker-compose up -d</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->äºŒè¿›åˆ¶å®‰è£…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt <span style="color:#f92672">&amp;&amp;</span> wget -c https://github.com/prometheus/alertmanager/releases/download/v0.24.0/alertmanager-0.24.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxf alertmanager-0.24.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv alertmanager-0.24.0.linux-amd64 alertmanager
</span></span><span style="display:flex;"><span>$ chown root.root alertmanager -R</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/alertmanager.service <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=Alertmanager
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://prometheus.io/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=simple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/alertmanager/alertmanager --config.file=/opt/alertmanager/alertmanager.yml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯åŠ¨æœåŠ¡ã€ä»¥åŠè®¾ç½®å¼€æœºè‡ªå¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup ./alertmanager --config.file<span style="color:#f92672">=</span>alertmanager.yml 2&gt;&amp;<span style="color:#ae81ff">1</span> 1&gt;alertmanager.log &amp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl enable alertmanager
</span></span><span style="display:flex;"><span>$ systemctl start alertmanager</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å¯åŠ¨æœåŠ¡çš„ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ netstat -lntup |grep alertmanager
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::9094                 :::*                    LISTEN      17237/alertmanager
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::9093                 :::*                    LISTEN      17237/alertmanager
</span></span><span style="display:flex;"><span>udp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::9094                 :::*                                17237/alertmanager</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç¼–è¯‘å®‰è£…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ GO15VENDOREXPERIMENT<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> go get github.com/prometheus/alertmanager/cmd/...
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cd $GOPATH/src/github.com/prometheus/alertmanager</span>
</span></span><span style="display:flex;"><span>$ alertmanager --config.file<span style="color:#f92672">=</span>&lt;your_file&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰‹åŠ¨æºç æ„å»º</span>
</span></span><span style="display:flex;"><span>$ mkdir -p $GOPATH/src/github.com/prometheus
</span></span><span style="display:flex;"><span>$ cd $GOPATH/src/github.com/prometheus
</span></span><span style="display:flex;"><span>$ git clone https://github.com/prometheus/alertmanager.git
</span></span><span style="display:flex;"><span>$ cd alertmanager
</span></span><span style="display:flex;"><span>$ make build
</span></span><span style="display:flex;"><span>$ ./alertmanager --config.file<span style="color:#f92672">=</span>&lt;your_file&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># amtoolæ„å»º</span>
</span></span><span style="display:flex;"><span>$ make build BINARIES<span style="color:#f92672">=</span>amtool</span></span></code></pre></div></blockquote>
<hr>
<h4 id="èŠ‚ç‚¹å®‰è£…node_export">èŠ‚ç‚¹å®‰è£…<code>node_export</code></h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ©ç”¨<!-- raw HTML omitted --><code>node_export</code><!-- raw HTML omitted -->æ¥ç›‘æ§ä¸»æœºï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†å¾ˆå¤šå…¶ä»–çš„<!-- raw HTML omitted --><code>export</code><!-- raw HTML omitted -->å¯ä»¥ç”¨æ¥ç›´æ¥ä½¿ç”¨<!-- raw HTML omitted --></li>
<li><a href="https://prometheus.io/docs/instrumenting/exporters/" rel="external" target="_self"><code>EXPORTERS AND INTEGRATIONS</code></a></li>
<li><a href="https://prometheus.io/docs/guides/node-exporter/" rel="external" target="_self">ä½¿ç”¨<code>NODE EXPORTER</code>ç›‘æ§<code>LINUX</code>ä¸»æœºæŒ‡æ ‡</a></li>
<li><a href="https://grafana.com/grafana/dashboards/8919-1-node-exporter-for-prometheus-dashboard-cn-0413-consulmanager/" rel="external" target="_self"><code>1 Node Exporter Dashboard 22/04/13 ConsulManager</code>è‡ªåŠ¨åŒæ­¥ç‰ˆ</a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->äºŒè¿›åˆ¶å®‰è£…  <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt <span style="color:#f92672">&amp;&amp;</span> wget -c https://github.com/prometheus/node_exporter/releases/download/v1.4.0/node_exporter-1.4.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxvf node_exporter-1.4.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv node_exporter-1.4.0.linux-amd64 node_exporter
</span></span><span style="display:flex;"><span>$ chown root.root node_exporter -R</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/node_exporter.service <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=node_exporter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://prometheus.io/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=simple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/node_exporter/node_exporter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯åŠ¨æœåŠ¡ã€ä»¥åŠè®¾ç½®å¼€æœºè‡ªå¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup ./node_exporter --config.file<span style="color:#f92672">=</span>node_exporter.yml 2&gt;&amp;<span style="color:#ae81ff">1</span> 1&gt;node_exporter.log &amp;  
</span></span><span style="display:flex;"><span>$ systemctl enable node_exporter
</span></span><span style="display:flex;"><span>$ systemctl start node_exporter</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ netstat -lntup |grep node_export
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::9100                 :::*                    LISTEN      4551/node_exporter</span></span></code></pre></div></blockquote>
<hr>
<h4 id="éƒ¨ç½²cadvisoré‡‡é›†æº">éƒ¨ç½²<code>cAdvisor</code>é‡‡é›†æº</h4>
<ul>
<li>
<ol>
<li><code>Docker</code><!-- raw HTML omitted -->éƒ¨ç½²<!-- raw HTML omitted --><code>cAdvisor</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://grafana.com/grafana/dashboards/893-main/" rel="external" target="_self"><code>Docker and system monitoring Grafana dashboard</code></a></li>
<li><a href="https://grafana.com/grafana/dashboards/10585-docker-dashboard/" rel="external" target="_self"><code>Grafana Docker Dashboard</code></a></li>
<li><a href="https://grafana.com/grafana/dashboards/16314-docker-container-os-node-node-exporter-cadvisor/?tab=revisions" rel="external" target="_self"><code>docker container &amp; OS node(node_exporter, cadvisor)</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -d --name<span style="color:#f92672">=</span>cadvisor <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -p 8080:8080 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /:/rootfs:ro <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /var/run:/var/run:rw <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /sys:/sys:ro <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /var/lib/docker/:/var/lib/docker:ro <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  google/cadvisor:v0.33.0</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹æŒ‡æ ‡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ http://&lt;ç›®æ ‡èŠ‚ç‚¹IP&gt;:8080/metrics</span></span></code></pre></div></blockquote>
<hr>
<h4 id="æ•°æ®åº“æœåŠ¡å™¨éƒ¨ç½²mysqld_exporter">æ•°æ®åº“æœåŠ¡å™¨éƒ¨ç½²<code>mysqld_exporter</code></h4>
<blockquote>
<ul>
<li><a href="https://grafana.com/grafana/dashboards/17320-1-mysqld-exporter-dashboard-22-11-06/" rel="external" target="_self"><code>1 Mysqld Exporter Dashboard 22/11/06ä¸­æ–‡ç‰ˆ</code></a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->äºŒè¿›åˆ¶å®‰è£…  <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt <span style="color:#f92672">&amp;&amp;</span> wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.14.0/mysqld_exporter-0.14.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxvf mysqld_exporter-0.14.0.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv mysqld_exporter-0.14.0.linux-amd64 mysqld_exporter  
</span></span><span style="display:flex;"><span>$ chown -R root. mysqld_exporter  </span></span></code></pre></div><ul>
<li><code>mysqld_exporter</code><!-- raw HTML omitted -->éœ€è¦è¿æ¥<!-- raw HTML omitted --><code>Mysql</code><!-- raw HTML omitted -->ï¼Œé¦–å…ˆä¸ºå®ƒåˆ›å»ºç”¨æˆ·å¹¶èµ‹äºˆæ‰€éœ€çš„æƒé™<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> REPLICATION CLIENT, PROCESS <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;exporter&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123456&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">ON</span> performance_schema.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;exporter&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">flush</span> <span style="color:#66d9ef">privileges</span>;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åœ¨æ•°æ®åº“æœåŠ¡å™¨<!-- raw HTML omitted --><code>mysqld_exporter</code><!-- raw HTML omitted -->ç›®å½•ä¸‹åˆ›å»º<!-- raw HTML omitted --><code>.my.cnf</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/mysqld_exporter/.my.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[client]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">user=mysql_monitor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=mysql_monitor
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/mysqld_exporter.service <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=mysql_exporter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://prometheus.io/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=simple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/mysqld_exporter/mysqld_exporter --config.my-cnf=/opt/mysqld_exporter/.my.cnf 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯åŠ¨æœåŠ¡ã€ä»¥åŠè®¾ç½®å¼€æœºè‡ªå¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./mysqld_exporter  --config.my-cnf<span style="color:#f92672">=</span>/opt/mysqld_exporter/.my.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl enable mysqld_exporter
</span></span><span style="display:flex;"><span>$ systemctl start mysqld_exporter</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ss -unplt|grep mysqld_exporter
</span></span><span style="display:flex;"><span>tcp    LISTEN     <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">128</span>    <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:9104               <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:*                   users:<span style="color:#f92672">((</span><span style="color:#e6db74">&#34;mysqld_exporter&#34;</span>,pid<span style="color:#f92672">=</span>7339,fd<span style="color:#f92672">=</span>3<span style="color:#f92672">))</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="éƒ¨ç½²pushgatewayæ¨é€ç½‘å…³">éƒ¨ç½²<code>pushgateway</code>(æ¨é€ç½‘å…³)</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->äºŒè¿›åˆ¶å®‰è£…  <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt <span style="color:#f92672">&amp;&amp;</span> wget -c https://github.com/prometheus/pushgateway/releases/download/v1.4.3/pushgateway-1.4.3.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxf pushgateway-1.4.3.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv pushgateway-1.4.3.linux-amd64 pushgateway
</span></span><span style="display:flex;"><span>$ chown root.root pushgateway -R</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/pushgateway.service <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=pushgateway
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=https://prometheus.io/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=simple
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/pushgateway/pushgateway
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=on-failure
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯åŠ¨æœåŠ¡ã€ä»¥åŠè®¾ç½®å¼€æœºè‡ªå¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nohup ./pushgateway --config.file<span style="color:#f92672">=</span>node_exporter.yml 2&gt;&amp;<span style="color:#ae81ff">1</span> 1&gt;node_exporter.log &amp;  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl enable pushgateway
</span></span><span style="display:flex;"><span>$ systemctl start pushgateway</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ netstat -lntup |grep push
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::9091                 :::*                    LISTEN      5982/pushgateway</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_open_falcon">Install_Open_Falcon</h1>

<h2 id="éƒ¨ç½²open-falconæœåŠ¡">éƒ¨ç½²<code>Open Falcon</code>æœåŠ¡</h2>
<h3 id="open-falconæ¶æ„"><code>Open-falcon</code>æ¶æ„</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä»‹ç»<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><code>OpenFalcon</code>æ˜¯ä¸€æ¬¾ä¼ä¸šçº§ã€é«˜å¯ç”¨ã€å¯æ‰©å±•çš„å¼€æºç›‘æ§è§£å†³æ–¹æ¡ˆã€‚æ­¤é¡¹ç›®æœ€åˆç”±å°ç±³å…¬å¸å‘èµ·ï¼Œå°ç±³è¿ç»´å›¢é˜Ÿä»äº’è”ç½‘å…¬å¸çš„éœ€æ±‚å‡ºå‘ï¼Œæ ¹æ®å¤šå¹´çš„è¿ç»´ç»éªŒï¼Œç»“åˆ<code>SRE</code>ã€<code>SA</code>ã€<code>DEVS</code>çš„ä½¿ç”¨ç»éªŒå’Œåé¦ˆï¼Œå¼€å‘çš„ä¸€å¥—é¢å‘äº’è”ç½‘çš„ä¼ä¸šçº§å¼€æºç›‘æ§äº§å“ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸º<code>v2.0</code>ã€‚ç›®å‰æœ‰å‡ åå®¶å…¬å¸ä¸åŒç¨‹åº¦ä½¿ç”¨<code>OpenFalcon</code>ä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ç›‘æ§è§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¼˜ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>é‡‡é›†å™¨è‡ªåŠ¨å‘ç°ï¼Œæ”¯æŒ<code>falcon-agent</code>ã€<code>snmp</code>ã€æ”¯æŒç”¨æˆ·ä¸»åŠ¨pushæ•°æ®ã€ç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶</li>
<li>æ”¯æŒæ¯ä¸ªå‘¨æœŸä¸Šäº¿æ¬¡çš„æ•°æ®é‡‡é›†ã€å‘Šè­¦åˆ¤å®šã€å†å²æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢</li>
<li>é«˜æ•ˆçš„åˆ†åŒºã€æ”¯æŒç›‘æ§ç­–ç•¥æ¨¡æ¿ã€æ¨¡æ¿ç»§æ‰¿å’Œè¦†ç›–ã€å¤šç§å‘Šè­¦æ–¹å¼ã€æ”¯æŒå‘Šè­¦å›è°ƒ</li>
<li>å•èŠ‚ç‚¹èƒ½æ”¯æŒ200ä¸‡<code>metric</code>çš„ä¸ŠæŠ¥ã€å½’æ¡£ã€å­˜å‚¨</li>
<li>å…¶å­˜å‚¨é‡‡ç”¨<code>rrdtool</code>å½’æ¡£ï¼Œç§’çº§è¿”å›ä¸Šç™¾ä¸ª<code>metric</code>ä¸€å¹´çš„å†å²æ•°æ®</li>
<li>å¤šç»´åº¦çš„æ•°æ®å±•ç¤ºï¼Œå¯ç”±ç”¨æˆ·è‡ªå®šä¹‰<code>Screen</code></li>
<li>é€šè¿‡å„ç§æ’ä»¶ç›®å‰æ”¯æŒ<code>Linux</code>ã€<code>Windows</code>ã€<code>Mysql</code>ã€<code>Redis</code>ã€<code>Memache</code>ã€<code>RabbitMQ</code>å’Œäº¤æ¢æœºç›‘æ§</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç›‘æ§èŒƒå›´<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>OpenFalcon</code>æ”¯æŒç³»ç»ŸåŸºç¡€ç›‘æ§ï¼Œç¬¬ä¸‰æ–¹æœåŠ¡ç›‘æ§ï¼Œ<code>JVM</code>ç›‘æ§ï¼Œä¸šåŠ¡åº”ç”¨ç›‘æ§</li>
<li>åŸºç¡€ç›‘æ§æŒ‡<code>Linux</code>å¹³å°çš„ç³»ç»ŸæŒ‡æ ‡ç›‘æ§ï¼ŒåŒ…æ‹¬<code>CPU</code>ã€<code>Load</code>ã€å†…å­˜ã€ç£ç›˜ã€<code>IO</code>ã€ç½‘ç»œç­‰ï¼Œè¿™äº›æŒ‡æ ‡ç”±<code>OpenFalcon</code>çš„<code>agent</code>èŠ‚ç‚¹ç›´æ¥æ”¯æŒï¼Œæ— éœ€æ’ä»¶</li>
<li><code>JVM</code>ç›‘æ§ä¸»è¦é€šè¿‡æ’ä»¶å®Œæˆï¼Œæ’ä»¶é€šè¿‡<code>JVM</code>å¼€æ”¾çš„<code>JMX</code>é€šä¿¡ç«¯å£ï¼Œè·å–åˆ°<code>JVM</code>å‚æ•°æŒ‡æ ‡ï¼Œå¹¶æ¨é€åˆ°<code>agent</code>èŠ‚ç‚¹ï¼Œå†ç”±<code>agent</code>å‘é€åˆ°<code>OpenFalcon</code></li>
<li>ç¬¬ä¸‰æ–¹æœåŠ¡ç›‘æ§æŒ‡ä¸€äº›å¸¸è§æœåŠ¡ç›‘æ§ï¼ŒåŒ…æ‹¬<code>MySQL</code>ã€<code>Redis</code>ã€<code>Nginx</code>ç­‰ï¼Œ<code>OpenFalcon</code>å®˜ç½‘æä¾›äº†å¾ˆå¤šç¬¬ä¸‰æ–¹æœåŠ¡çš„ç›‘æ§æ’ä»¶ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®ç°æ’ä»¶ï¼Œå®šä¹‰é‡‡é›†æŒ‡æ ‡ã€‚è€Œé‡‡é›†åˆ°çš„æŒ‡æ ‡ï¼Œä¹Ÿæ˜¯é€šè¿‡æ’ä»¶å…ˆå‘é€ç»™<code>agent</code>ï¼Œå†ç”±agentå‘é€åˆ°<code>OpenFalcon</code></li>
<li>ä¸šåŠ¡åº”ç”¨ç›‘æ§ä¸»è¦æ˜¯ç›‘æ§ä¼ä¸šè‡ªä¸»å¼€å‘çš„åº”ç”¨æœåŠ¡ã€‚ç”±ä¼ä¸šæ ¹æ®ä¸šåŠ¡éœ€è¦å®šä¹‰é‡‡é›†æŒ‡æ ‡ï¼Œè‡ªå®ç°æ’ä»¶ã€‚å°†è·å–åˆ°çš„é‡‡é›†æŒ‡æ ‡å‘é€åˆ°<code>agen</code>tï¼Œå†ç”±<code>agent</code>å‘é€åˆ°<code>OpenFalcon</code></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>openfalcon</code><!-- raw HTML omitted -->æ•°æ®æµå‘<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>å¸¸è§çš„<code>OpenFalcon</code>åŒ…å«<code>transfer</code>ã€<code>hbs</code>ã€<code>agent</code>ã€<code>judge</code>ã€<code>graph</code>ã€<code>API</code>å‡ ä¸ªè¿›ç¨‹ã€‚ä½†æ²¡æœ‰æä¾›ç”¨æˆ·ç•Œé¢ã€‚ç”¨æˆ·ç•Œé¢çš„è§£å†³æ–¹æ¡ˆæ˜¯<code>OpenFalcon</code>å®˜æ–¹æä¾›çš„<code>Dashboard</code>ï¼Œç”±<code>python</code>ç¼–å†™çš„ä¸€ä¸ªWebæœåŠ¡ã€‚<code>Dashboard</code>è°ƒç”¨<code>OpenFalcon</code>çš„<code>API</code>èŠ‚ç‚¹<code>REST</code>ï¼Œå®Œæˆç”¨æˆ·è®¤è¯ï¼ŒæŸ¥è¯¢å†å²ç­‰æ“ä½œã€‚</li>
<li>ä»¥ä¸‹æ˜¯å„ä¸ªèŠ‚ç‚¹çš„æ•°æ®æµå‘å›¾ï¼Œä¸»æ•°æ®æµå‘æ˜¯<code>agent</code>-&gt;<code>transfer</code>-&gt;<code>judge/graph</code>ï¼š</li>
</ul>
<p><a href="#R-image-82bdc1d54e16d76f2fd62ddbb28213ea" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-82bdc1d54e16d76f2fd62ddbb28213ea"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer.jpg"></a></p>
<p><a href="#R-image-7d7d8c1b2e44c3a512faf34cee833436" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7d7d8c1b2e44c3a512faf34cee833436"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-1.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->æ¨¡å—<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-2e1844c7f7f08e8795401040ba17c540" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-2.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2e1844c7f7f08e8795401040ba17c540"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-2.jpg"></a></p>
<p><a href="#R-image-d01129951ea2b4b0a086b3f5758f37e0" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-3.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d01129951ea2b4b0a086b3f5758f37e0"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-3.png"></a></p>
<p><a href="#R-image-012807d9a6d17760f47c2d59cfe1974f" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-4.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-012807d9a6d17760f47c2d59cfe1974f"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/transfer-4.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->ç»„ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><code>Agent</code>: æ˜¯ç”¨äºé‡‡é›†è¢«éƒ¨ç½²æœºå™¨ä¸Šçš„ç›‘æ§æ•°æ®ï¼Œæ¯éš”<code>60</code>ç§’<code>push</code>ç»™<code>Transfer</code>æ¨¡å—ã€‚<code>agent</code>ä¸<code>Transfer</code>å»ºç«‹çš„æ˜¯é•¿è¿æ¥ï¼ˆæ¯•ç«Ÿæ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ï¼ŒçŸ­è¿æ¥å¼€é”€å¤ªå¤§ï¼‰ã€‚æ¯å°è¦è¢«ç›‘æ§çš„æœºå™¨éƒ½è¦éƒ¨ç½²è¯¥æ¨¡å—ï¼Œå®ƒæ¶ˆè€—çš„èµ„æºå¾ˆå°ï¼Œä¸ç”¨å¤ªæ‹…å¿ƒè¿™ä¸€ç‚¹ã€‚åŒæ—¶<code>agent</code>æä¾›äº†ä¸€ä¸ª<code>http</code>æ¥å£<code>/v1/push</code>ç”¨äºæ¥æ”¶ç”¨æˆ·æ‰‹å·¥<code>push</code>çš„ä¸€äº›æ•°æ®ï¼Œç„¶åé€šè¿‡é•¿è¿æ¥è¿…é€Ÿè½¬å‘ç»™<code>Transfer</code>ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯¹äºæŸäº›è‡ªå·±é¡¹ç›®æ¥å£çš„ç›‘æ§å°±æ˜¯é€šè¿‡æ­¤æ–¹å¼æ¥è¿›è¡Œä¸Šä¼ çš„</p>
</li>
<li>
<p><code>transfer</code>ï¼š æ˜¯æ•°æ®è½¬å‘æœåŠ¡ã€‚å®ƒæ¥æ”¶<code>agent</code>ä¸ŠæŠ¥çš„æ•°æ®ï¼Œç„¶åæŒ‰ç…§å“ˆå¸Œè§„åˆ™è¿›è¡Œæ•°æ®åˆ†ç‰‡ã€å¹¶å°†åˆ†ç‰‡åçš„æ•°æ®åˆ†åˆ«<code>push</code>ç»™<code>graph</code>å’Œ<code>judge</code>ç­‰ç»„ä»¶</p>
</li>
<li>
<p><code>graph</code>æ˜¯å­˜å‚¨ç»˜å›¾æ•°æ®çš„ç»„ä»¶ã€‚<code>graph</code>ç»„ä»¶æ¥æ”¶<code>transfer</code>ç»„ä»¶æ¨é€ä¸Šæ¥çš„ç›‘æ§æ•°æ®ï¼ŒåŒæ—¶å¤„ç†<code>query</code>ç»„ä»¶çš„æŸ¥è¯¢è¯·æ±‚ã€è¿”å›ç»˜å›¾æ•°æ®</p>
</li>
<li>
<p><code>query</code>ç»„ä»¶ï¼Œæä¾›ç»Ÿä¸€çš„ç»˜å›¾æ•°æ®æŸ¥è¯¢å…¥å£ã€‚<code>query</code>ç»„ä»¶æ¥æ”¶æŸ¥è¯¢è¯·æ±‚ï¼Œæ ¹æ®ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å»ç›¸åº”çš„<code>graph</code>å®ä¾‹æŸ¥è¯¢ä¸åŒç›‘æ§é¡¹çš„æ•°æ®ï¼Œç„¶åæ±‡æ€»æ‹¿åˆ°çš„æ•°æ®ï¼Œæœ€åç»Ÿä¸€è¿”å›ç»™ç”¨æˆ·</p>
</li>
<li>
<p><code>dashboard</code>æ˜¯é¢å‘ç”¨æˆ·çš„æŸ¥è¯¢ç•Œé¢ã€‚åœ¨è¿™é‡Œï¼Œç”¨æˆ·å¯ä»¥çœ‹åˆ°<code>push</code>åˆ°<code>graph</code>ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œå¹¶æŸ¥çœ‹å…¶è¶‹åŠ¿å›¾</p>
</li>
<li>
<p>é‚®ä»¶çŸ­ä¿¡å‘é€æ¨¡å—ï¼Œè¿™ä¸ªç»„ä»¶æ²¡æœ‰ä»£ç ï¼Œéœ€è¦å„ä¸ªå…¬å¸è‡ªè¡Œæä¾›ã€‚ç›‘æ§ç³»ç»Ÿäº§ç”ŸæŠ¥è­¦äº‹ä»¶ä¹‹åéœ€è¦å‘é€æŠ¥è­¦é‚®ä»¶æˆ–è€…æŠ¥è­¦çŸ­ä¿¡ï¼Œå„ä¸ªå…¬å¸å¯èƒ½æœ‰è‡ªå·±çš„é‚®ä»¶æœåŠ¡å™¨ï¼Œæœ‰è‡ªå·±çš„é‚®ä»¶å‘é€æ–¹æ³•ï¼›æœ‰è‡ªå·±çš„çŸ­ä¿¡é€šé“ï¼Œæœ‰è‡ªå·±çš„çŸ­ä¿¡å‘é€æ–¹æ³•ã€‚<code>falcon</code>ä¸ºäº†é€‚é…å„ä¸ªå…¬å¸ï¼Œåœ¨æ¥å…¥æ–¹æ¡ˆä¸Šåšäº†ä¸€ä¸ªè§„èŒƒï¼Œéœ€è¦å„å…¬å¸æä¾›<code>http</code>çš„çŸ­ä¿¡å’Œé‚®ä»¶å‘é€æ¥å£</p>
</li>
<li>
<p><code>Sender</code>ï¼š 6 ä¸­æåˆ°å„ä¸ªå…¬å¸ä¼šæä¾›é‚®ä»¶ã€çŸ­ä¿¡å‘é€æ¥å£ï¼Œä½†æ˜¯äº§ç”Ÿäº†æŠ¥è­¦ä¹‹åå°±ç«‹é©¬è°ƒç”¨è¿™äº›æ¥å£å‘é€æŠ¥è­¦ï¼Œæ˜¯ä¸åˆé€‚çš„ã€‚å› ä¸ºè¿™äº›æ¥å£å¯èƒ½æ— æ³•å¤„ç†å·¨å¤§çš„å¹¶å‘é‡ï¼Œè€Œä¸”æ¥å£æœ¬èº«çš„å¤„ç†é€Ÿåº¦å¯èƒ½ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œè¿™ä¼šæ‹–æ…¢æˆ‘ä»¬çš„å¤„ç†é€»è¾‘ã€‚æ‰€ä»¥ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹å¼æ˜¯æŠŠé‚®ä»¶ã€çŸ­ä¿¡å‘é€è¿™ä¸ªäº‹æƒ…åšæˆå¼‚æ­¥çš„ã€‚<code>Sender</code>æä¾›ä¸€ä¸ªçŸ­ä¿¡<code>redis</code>é˜Ÿåˆ—ï¼Œæä¾›ä¸€ä¸ªé‚®ä»¶<code>redis</code>é˜Ÿåˆ—ã€‚å½“æœ‰çŸ­ä¿¡è¦å‘é€çš„æ—¶å€™ï¼Œç›´æ¥å°†çŸ­ä¿¡å†…å®¹å†™å…¥çŸ­ä¿¡<code>redis</code>é˜Ÿåˆ—å³å¯ï¼Œå½“æœ‰é‚®ä»¶è¦å‘é€çš„æ—¶å€™ï¼Œç›´æ¥å°†é‚®ä»¶å†…å®¹å†™å…¥é‚®ä»¶<code>redis</code>é˜Ÿåˆ—ã€‚é’ˆå¯¹æ¯ä¸ªé˜Ÿåˆ—ï¼Œåé¢æœ‰ä¸€ä¸ªé¢„è®¾å¤§å°çš„<code>worker</code>çº¿ç¨‹æ± æ¥å¤„ç†ã€‚æœ‰äº†é˜Ÿåˆ—çš„ç¼“å†²ï¼Œå³ä¾¿æŸä¸ªæ—¶åˆ»äº§ç”Ÿäº†å¤§é‡æŠ¥è­¦ï¼Œé€ æˆé‚®ä»¶ã€çŸ­ä¿¡å‘é€çš„çªå‘æµé‡ï¼Œä¹Ÿä¸ä¼šå¯¹é‚®ä»¶ã€çŸ­ä¿¡å‘é€æ¥å£é€ æˆå†²å‡»</p>
</li>
<li>
<p><code>Fe</code>è¿™æ˜¯<code>Go</code>ç‰ˆæœ¬çš„<code>UIC</code>ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„<code>web</code>å…¥å£ï¼Œå› ä¸ºç›‘æ§ç»„ä»¶ä¼—å¤šï¼Œè®°å¿†<code>ip</code>ã€<code>port</code>å»è®¿é—®è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦ã€‚<code>fe</code>åƒæ˜¯ä¸€ä¸ªç›‘æ§çš„<code>hao123.</code>å°±æ˜¯ä¸ºäº†ç”¨æˆ·ä½¿ç”¨æ–¹ä¾¿é…ç½®çš„ä¸€ä¸ªwebæµè§ˆå™¨æ“ä½œç•Œé¢</p>
</li>
<li>
<p><code>Portal</code>æ˜¯ç”¨æ¥é…ç½®æŠ¥è­¦ç­–ç•¥çš„,å’Œ<code>HBS</code>ä¸€èµ·æè¿°</p>
</li>
<li>
<p><code>HBS(Heartbeat Server)</code>ï¼š</p>
</li>
</ul>
<blockquote>
<ul>
<li><code>Portal</code>çš„æ•°æ®åº“ä¸­æœ‰ä¸€ä¸ª<code>host</code>è¡¨ï¼Œç»´æŠ¤äº†å…¬å¸æ‰€æœ‰æœºå™¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚<code>hostname</code>ã€<code>ip</code>ç­‰ç­‰ã€‚<code>HBS</code>ç¬¬ä¸€ä¸ªåŠŸèƒ½ï¼š<code>agent</code>å‘é€å¿ƒè·³ä¿¡æ¯ç»™<code>HBS</code>çš„æ—¶å€™ï¼Œä¼šæŠŠ<code>hostname</code>ã€<code>ip</code>ã€<code>agent</code> <code>version</code>ã€<code>plugin version</code>ç­‰ä¿¡æ¯å‘Šè¯‰<code>HBS</code>ï¼Œ<code>HBS</code>è´Ÿè´£æ›´æ–°<code>host</code>è¡¨</li>
<li><code>Agent</code>åªé‡‡é›†ç”¨æˆ·é…ç½®çš„ç›‘æ§é¡¹ã€‚æ¯”å¦‚ç”¨æˆ·é…ç½®äº†å¯¹æŸä¸ªæœºå™¨<code>80</code>ç«¯å£çš„ç›‘æ§ï¼Œæˆ‘ä»¬æ‰ä¼šå»é‡‡é›†è¿™ä¸ªæœºå™¨<code>80</code>ç«¯å£çš„å­˜æ´»æ€§ã€‚é‚£<code>agent</code>å¦‚ä½•çŸ¥é“è‡ªå·±åº”è¯¥é‡‡é›†å“ªäº›ç«¯å£å’Œè¿›ç¨‹å‘¢ï¼Ÿå‘<code>HBS</code>è¦ï¼Œ<code>HBS</code>å»è¯»å–<code>Portal</code>çš„æ•°æ®åº“ï¼Œè¿”å›ç»™<code>agent</code></li>
<li><code>Judge</code>éœ€è¦è·å–æ‰€æœ‰çš„æŠ¥è­¦ç­–ç•¥ï¼Œè®©<code>Judge</code>å»è¯»å–<code>Portal</code>çš„<code>DB</code>ä¹ˆï¼Ÿä¸å¤ªå¥½ã€‚å› ä¸º<code>Judge</code>çš„å®ä¾‹æ•°ç›®æ¯”è¾ƒå¤šï¼Œå¦‚æœå…¬å¸æœ‰å‡ åä¸‡æœºå™¨ï¼Œ<code>Judge</code>å®ä¾‹æ•°ç›®å¯èƒ½ä¼šæ˜¯å‡ ç™¾ä¸ªï¼Œå‡ ç™¾ä¸ª<code>Judge</code>å®ä¾‹å»è®¿é—®<code>Portal</code>æ•°æ®åº“ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å‹åŠ›ã€‚æ—¢ç„¶<code>HBS</code>æ— è®ºå¦‚ä½•éƒ½è¦è®¿é—®<code>Portal</code>çš„æ•°æ®åº“äº†ï¼Œé‚£å°±è®©<code>HBS</code>å»è·å–æ‰€æœ‰çš„æŠ¥è­¦ç­–ç•¥ç¼“å­˜åœ¨å†…å­˜é‡Œï¼Œç„¶å<code>Judge</code>å»å‘<code>HBS</code>è¯·æ±‚ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¯¹<code>Portal DB</code>çš„å‹åŠ›å°±ä¼šå¤§å¤§å‡å°</li>
</ul>
</blockquote>
<ul>
<li><code>Judge Judge</code>ç”¨äºå‘Šè­¦åˆ¤æ–­ï¼Œ<code>agent</code>å°†æ•°æ®<code>push</code>ç»™<code>Transfer</code>ï¼Œ<code>Transfer</code>ä¸ä½†ä¼šè½¬å‘ç»™<code>Graph</code>ç»„ä»¶æ¥ç»˜å›¾ï¼Œè¿˜ä¼šè½¬å‘ç»™<code>Judge</code>ç”¨äºåˆ¤æ–­æ˜¯å¦è§¦å‘å‘Šè­¦ã€‚å› ä¸ºç›‘æ§ç³»ç»Ÿæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œä¸€å°æœºå™¨æ˜¾ç„¶æ˜¯æä¸å®šçš„ï¼Œæ‰€ä»¥å¿…é¡»è¦æœ‰ä¸ªæ•°æ®åˆ†ç‰‡æ–¹æ¡ˆã€‚<code>Transfer</code>é€šè¿‡ä¸€è‡´æ€§å“ˆå¸Œæ¥åˆ†ç‰‡ï¼Œæ¯ä¸ª<code>Judge</code>å°±åªéœ€è¦å¤„ç†ä¸€å°éƒ¨åˆ†æ•°æ®å°±å¯ä»¥äº†ã€‚æ‰€ä»¥åˆ¤æ–­å‘Šè­¦çš„åŠŸèƒ½ä¸èƒ½æ”¾åœ¨ç›´æ¥çš„æ•°æ®æ¥æ”¶ç«¯<code>Transfer</code>ï¼Œè€Œåº”è¯¥æ”¾åˆ°<code>Transfer</code>åé¢çš„ç»„ä»¶é‡Œï¼Œå°±æœ‰äº†<code>Judge.</code></li>
<li><code>Links</code>æ˜¯ä¸ºæŠ¥è­¦åˆå¹¶åŠŸèƒ½å†™çš„ç»„ä»¶ã€‚å¦‚æœä½ ä¸æƒ³ä½¿ç”¨æŠ¥è­¦åˆå¹¶åŠŸèƒ½ï¼Œè¿™ä¸ªç»„ä»¶æ˜¯æ— éœ€å®‰è£…çš„ã€‚ä¸€èˆ¬ä¸ä¼šç”¨åˆ°</li>
<li><code>alarm</code>æ¨¡å—æ˜¯å¤„ç†æŠ¥è­¦<code>event</code>çš„ï¼Œ<code>judge</code>äº§ç”Ÿçš„æŠ¥è­¦<code>event</code>å†™å…¥<code>redis</code>ï¼Œ<code>alarm</code>ä»<code>redis</code>è¯»å–å¤„ç†ï¼ŒæŠ¥è­¦<code>event</code>çš„å¤„ç†é€»è¾‘å¹¶éä»…ä»…æ˜¯å‘é‚®ä»¶ã€å‘çŸ­ä¿¡è¿™ä¹ˆç®€å•ã€‚ä¸ºäº†èƒ½å¤Ÿè‡ªåŠ¨åŒ–å¯¹<code>event</code>åšå¤„ç†ï¼Œ<code>alarm</code>éœ€è¦æ”¯æŒåœ¨äº§ç”Ÿ<code>event</code>çš„æ—¶å€™å›è°ƒç”¨æˆ·æä¾›çš„æ¥å£ï¼›æœ‰çš„æ—¶å€™æŠ¥è­¦çŸ­ä¿¡ã€é‚®ä»¶å¤ªå¤šï¼Œå¯¹äºä¼˜å…ˆçº§æ¯”è¾ƒä½çš„æŠ¥è­¦ï¼Œå¸Œæœ›åšæŠ¥è­¦åˆå¹¶ï¼Œè¿™äº›é€»è¾‘éƒ½æ˜¯åœ¨<code>alarm</code>ä¸­åšçš„</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="7">
<li><!-- raw HTML omitted -->æµç¨‹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>ç›®æ ‡æœåŠ¡å™¨è¿è¡Œ<code>agent</code></li>
<li><code>agent</code>é‡‡é›†å„ç±»ç›‘æ§é¡¹æ•°å€¼ï¼Œä¼ ç»™<code>transfer</code></li>
<li><code>transfer</code>æ ¡éªŒå’Œæ•´ç†ç›‘æ§é¡¹æ•°å€¼ï¼Œåšä¸€è‡´æ€§<code>hash</code>åˆ†ç‰‡ï¼Œä¼ ç»™å¯¹åº”çš„<code>judge</code>æ¨¡å—ä»¥éªŒè¯æ˜¯å¦è§¦å‘å‘Šè­¦</li>
<li><code>transfer</code>æ•´ç†ç›‘æ§é¡¹æ•°å€¼ï¼Œåšä¸€è‡´æ€§<code>hash</code>åˆ†ç‰‡ï¼Œä¼ è¾“ç»™<code>graph</code>ä»¥è¿›è¡Œæ•°æ®çš„å­˜å‚¨</li>
<li><code>judge</code>æ ¹æ®å…·ä½“æŠ¥è­¦ç­–ç•¥æˆ–é˜ˆå€¼è¿›è¡Œå‘Šè­¦åˆ¤æ–­ï¼Œå¦‚è§¦å‘å‘Šè­¦åˆ™ç»„è£…å‘Šè­¦<code>event</code>äº‹ä»¶ï¼Œå†™å…¥ç¼“å­˜é˜Ÿåˆ—</li>
<li><code>alarm</code>å’Œ<code>sender</code>æ ¹æ®<code>event</code>äº‹ä»¶ä¸­çš„åˆ¤å®šç»“æœï¼Œæ‰§è¡Œ<code>event</code>ï¼Œåƒç”¨æˆ·ç»„å‘é€çŸ­ä¿¡æˆ–é‚®ä»¶</li>
<li><code>graph</code>æ”¶åˆ°ç›‘æ§é¡¹æ•°æ®åï¼Œå°†æ•°æ®å­˜å‚¨æˆ<code>RRD</code>æ–‡ä»¶æ ¼å¼ï¼Œè¿›è¡Œå½’æ¡£ï¼Œå¹¶æä¾›æŸ¥è¯¢æ¥å£</li>
<li><code>query</code>å°†è°ƒç”¨<code>graph</code>çš„æŸ¥è¯¢æ¥å£ï¼Œå°†ç›‘æ§æ•°æ®ä¼ é€åˆ°<code>dashboard</code>ä»¥è¿›è¡Œé¡µé¢å±•ç¤º</li>
<li><code>dashboard</code>åˆ™æ¸²æŸ“é¡µé¢ï¼Œå±•ç¤ºæ›²çº¿æŠ¥è¡¨å›¾ç­‰</li>
<li><code>portal</code>æä¾›é¡µé¢ä¾›ç”¨æˆ·é…ç½®æœºå™¨åˆ†ç»„ã€æŠ¥è­¦ç­–ç•¥ã€è¡¨è¾¾å¼ã€<code>nodata</code>ç­‰é…ç½®</li>
</ul>
</blockquote>
<hr>
<h3 id="open-falconéƒ¨ç½²"><code>Open-falcon</code>éƒ¨ç½²</h3>
<blockquote>
<ul>
<li><code>Open-Falcon</code><!-- raw HTML omitted -->ä¸ºå‰åç«¯åˆ†ç¦»çš„æ¶æ„ï¼ŒåŒ…å«<!-- raw HTML omitted --><code>backend</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>frontend</code><!-- raw HTML omitted -->ä¸¤éƒ¨åˆ†<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å‰ç«¯(å®¢æˆ·ç«¯)å’Œåç«¯(æœåŠ¡ç«¯)<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç¯å¢ƒå‡†å¤‡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>redis</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y redis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>$ redis-server &amp;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è£…<!-- raw HTML omitted --><code>mysql</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è§£å‹åˆ°<!-- raw HTML omitted --><code>/usr/local</code><!-- raw HTML omitted -->ç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget http://ftp.iij.ad.jp/pub/db/mysql/Downloads/MySQL-5.7/mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç§»åŠ¨è‡³è¯¥ç›®å½•<!-- raw HTML omitted --><code>cd /usr/local/mysql</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mv mysql-5.7.22-linux-glibc2.12-x86_64 /usr/local/mysql</span></span></code></pre></div><ul>
<li><code>rpm -qa | grep mariadb</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rpm -e mariadb-libs â€“nodeps</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºæ•°æ®åº“ç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir data</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>mysql</code><!-- raw HTML omitted -->ç³»ç»Ÿç»„å’Œç³»ç»Ÿç”¨æˆ·å¹¶ä¸å»ºç«‹å®¶ç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ groupadd -r mysql <span style="color:#f92672">&amp;&amp;</span> useradd -r -g mysql -s /bin/false -M mysql</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æˆæƒç»™<!-- raw HTML omitted --><code>mysql</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chown -R mysql:mysql .</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åšä¸ªè½¯é“¾æ¥<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ln -s /usr/local/mysql/bin/* /usr/local/bin</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¼–å†™ä¸»é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/my.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[mysqld]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basedir=/usr/local/mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">datadir=/usr/local/mysql/data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pid-file=/usr/local/mysql/data/mysqld.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socket=/usr/local/mysql/mysql.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-error=/usr/local/mysql/data/mysql.err
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[client]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socket=/usr/local/mysql/mysql.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆå§‹åŒ–æ•°æ®åº“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqld --initialize --user<span style="color:#f92672">=</span>mysql --basedir<span style="color:#f92672">=</span>/usr/local/mysql --datadir<span style="color:#f92672">=</span>/usr/local/mysql/data</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç§»åŠ¨è‡³<!-- raw HTML omitted --><code>support-files</code><!-- raw HTML omitted -->ç›®å½•ä¸‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd support-files</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¤åˆ¶å¯åŠ¨æœåŠ¡è‡³<!-- raw HTML omitted --><code>/etc/init.d/mysqld</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp mysql.server /etc/init.d/mysqld</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>mysql</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /etc/init.d/mysqld start</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ‰¾å¯†ç <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /usr/local/mysql/data/mysql.err</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç™»å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysql -uroot -p<span style="color:#e6db74">&#39;å¯†ç &#39;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹å¯†ç <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ alter user root@localhost identified by <span style="color:#e6db74">&#39;123&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆå§‹åŒ–<!-- raw HTML omitted --><code>mysql</code><!-- raw HTML omitted -->è¡¨ç»“æ„<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /tmp/ <span style="color:#f92672">&amp;&amp;</span> git clone https://github.com/open-falcon/falcon-plus.git 
</span></span><span style="display:flex;"><span>$ cd /tmp/falcon-plus/scripts/mysql/db_schema/
</span></span><span style="display:flex;"><span>$ mysql -h 127.0.0.1 -u root -p &lt; 1_uic-db-schema.sql
</span></span><span style="display:flex;"><span>$ mysql -h 127.0.0.1 -u root -p &lt; 2_portal-db-schema.sql
</span></span><span style="display:flex;"><span>$ mysql -h 127.0.0.1 -u root -p &lt; 3_dashboard-db-schema.sql
</span></span><span style="display:flex;"><span>$ mysql -h 127.0.0.1 -u root -p &lt; 4_graph-db-schema.sql
</span></span><span style="display:flex;"><span>$ mysql -h 127.0.0.1 -u root -p &lt; 5_alarms-db-schema.sql
</span></span><span style="display:flex;"><span>$ rm -rf /tmp/falcon-plus/</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Go</code><!-- raw HTML omitted -->è¯­è¨€å¼€å‘ç¯å¢ƒ(éœ€è¦<code>epel</code>æº)<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install golang -y</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>go</code><!-- raw HTML omitted -->çš„å®‰è£…è·¯å¾„<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ find / -name go</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è®¾ç½®ç¯å¢ƒå˜é‡<!-- raw HTML omitted --><code>GOROOT</code>å’Œ<code>GOPATH</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export GOROOT<span style="color:#f92672">=</span>/usr/lib/golang
</span></span><span style="display:flex;"><span>$ export GOPATH<span style="color:#f92672">=</span>/home</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ç‰ˆæœ¬<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://github.com/open-falcon/falcon-plus/releases/download/v0.2.1/open-falcon-v0.2.1.tar.gz</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¯åŠ¨åç«¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»ºå·¥ä½œç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export FALCON_HOME<span style="color:#f92672">=</span>/home/work
</span></span><span style="display:flex;"><span>$ export WORKSPACE<span style="color:#f92672">=</span>$FALCON_HOME/open-falcon
</span></span><span style="display:flex;"><span>$ mkdir -p $WORKSPACE</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è§£å‹äºŒè¿›åˆ¶åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tar -xzvf open-falcon-v0.2.1.tar.gz -C $WORKSPACE</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åœ¨ä¸€å°æœºå™¨ä¸Šå¯åŠ¨æ‰€æœ‰çš„åç«¯ç»„ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --><code>cfg.json</code></p>
<p>éƒ¨åˆ†æ¨¡å—ä¾èµ–è¿æ¥æ•°æ®åº“ï¼Œå› ä¸ºå¦‚æœä¸ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œ<code>aggregator</code>æ¨¡å—ä¼šå‡ºç°æ— æ³•å¯åŠ¨ï¼Œ<code>graph</code>ã€<code>hbs</code>ã€<code>nodata</code>ã€<code>api</code>ã€<code>alarm</code>æ¨¡å—ä¼šå‡ºç°å¼€å¯ä¸æŠ¥é”™ä½†æ˜¯çŠ¶æ€ä¸ºå¼€å¯å¤±è´¥çš„æƒ…å†µã€‚</p>
<p>å¦‚æœéœ€è¦æ¯ä¸ªæ¨¡å—éƒ½èƒ½æ­£å¸¸å¯åŠ¨ï¼Œéœ€è¦å°†ä¸Šé¢æ¨¡å—çš„<code>cfg.json</code>çš„æ•°æ®åº“ä¿¡æ¯è¿›è¡Œä¿®æ”¹ï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>æ¨¡å—</th>
<th>é…ç½®æ–‡ä»¶æ‰€åœ¨è·¯å¾„</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aggregator</code></td>
<td><code>/home/work/aggregator/config/cfg.json</code></td>
</tr>
<tr>
<td><code>graph</code></td>
<td><code>/home/work/graph/config/cfg.json</code></td>
</tr>
<tr>
<td><code>hbs</code></td>
<td><code>/home/work/hbs/config/cfg.json</code></td>
</tr>
<tr>
<td><code>nodata</code></td>
<td><code>/home/work/nodata/config/cfg.json</code></td>
</tr>
<tr>
<td><code>api</code></td>
<td><code>/home/work/api/config/cfg.json</code></td>
</tr>
<tr>
<td><code>alarm</code></td>
<td><code>/home/work/alarm/config/cfg.json</code></td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd $WORKSPACE
</span></span><span style="display:flex;"><span>$ ./open-falcon start
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥æ‰€æœ‰æ¨¡å—çš„å¯åŠ¨çŠ¶å†µ</span>
</span></span><span style="display:flex;"><span>$ ./open-falcon check</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å®‰è£…å‰ç«¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»ºå·¥ä½œç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export HOME<span style="color:#f92672">=</span>/home/work
</span></span><span style="display:flex;"><span>$ export WORKSPACE<span style="color:#f92672">=</span>$HOME/open-falcon
</span></span><span style="display:flex;"><span>$ mkdir -p $WORKSPACE
</span></span><span style="display:flex;"><span>$ cd $WORKSPACE</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å…‹éš†å‰ç«¯ç»„ä»¶<!-- raw HTML omitted --><code>diamante</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd $WORKSPACE
</span></span><span style="display:flex;"><span>$ git clone https://github.com/open-falcon/dashboard.git</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å®‰è£…ä¾èµ–åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y python-virtualenv
</span></span><span style="display:flex;"><span>$ yum install -y python-devel
</span></span><span style="display:flex;"><span>$ yum install -y openldap-devel
</span></span><span style="display:flex;"><span>$ yum install -y mysql-devel
</span></span><span style="display:flex;"><span>$ yum groupinstall <span style="color:#e6db74">&#34;Development tools&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd $WORKSPACE/dashboard/
</span></span><span style="display:flex;"><span>$ virtualenv ./env
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./env/bin/pip install -r pip_requirements.txt -i https://pypi.douban.com/simple</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dashboardçš„é…ç½®æ–‡ä»¶ä¸ºï¼š <span style="color:#e6db74">&#39;rrd/config.py&#39;</span>ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># API_ADDR è¡¨ç¤ºåç«¯apiç»„ä»¶çš„åœ°å€</span>
</span></span><span style="display:flex;"><span>API_ADDR <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://127.0.0.1:8080/api/v1&#34;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ ¹æ®å®é™…æƒ…å†µï¼Œä¿®æ”¹PORTAL_DB_*, é»˜è®¤ç”¨æˆ·åä¸ºrootï¼Œé»˜è®¤å¯†ç ä¸º&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ ¹æ®å®é™…æƒ…å†µï¼Œä¿®æ”¹ALARM_DB_*, é»˜è®¤ç”¨æˆ·åä¸ºrootï¼Œé»˜è®¤å¯†ç ä¸º&#34;&#34;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åœ¨ç”Ÿäº§ç¯å¢ƒå¯åŠ¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ bash control start
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœæ­¢</span>
</span></span><span style="display:flex;"><span>$ bash control stop
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹æ—¥å¿—</span>
</span></span><span style="display:flex;"><span>$ Bash control tail</span></span></code></pre></div><ul>
<li><code>dashboard</code><!-- raw HTML omitted -->ç”¨æˆ·ç®¡ç†<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0"><code>dashbordæ²¡æœ‰é»˜è®¤åˆ›å»ºä»»ä½•è´¦å·åŒ…æ‹¬ç®¡ç†è´¦å·ï¼Œéœ€è¦ä½ é€šè¿‡é¡µé¢è¿›è¡Œæ³¨å†Œè´¦å·ã€‚
æƒ³æ‹¥æœ‰ç®¡ç†å…¨å±€çš„è¶…çº§ç®¡ç†å‘˜è´¦å·ï¼Œéœ€è¦æ‰‹åŠ¨æ³¨å†Œç”¨æˆ·åä¸ºrootçš„è´¦å·ï¼ˆç¬¬ä¸€ä¸ªå¸å·åç§°ä¸ºrootçš„ç”¨æˆ·ä¼šè¢«è‡ªåŠ¨è®¾ç½®ä¸ºè¶…çº§ç®¡ç†å‘˜ï¼‰ã€‚
è¶…çº§ç®¡ç†å‘˜å¯ä»¥ç»™æ™®é€šç”¨æˆ·åˆ†é…æƒé™ç®¡ç†ã€‚

å°æç¤ºï¼šæ³¨å†Œè´¦å·èƒ½å¤Ÿè¢«ä»»ä½•æ‰“å¼€dashboardé¡µé¢çš„äººæ³¨å†Œï¼Œæ‰€ä»¥å½“ç»™ç›¸å…³çš„äººæ³¨å†Œå®Œè´¦å·åï¼Œéœ€è¦å»å…³é—­æ³¨å†Œè´¦å·åŠŸèƒ½ã€‚åªéœ€è¦å»ä¿®æ”¹apiç»„ä»¶çš„é…ç½®æ–‡ä»¶cfg.jsonï¼Œå°†signup_disableé…ç½®é¡¹ä¿®æ”¹ä¸ºtrueï¼Œé‡å¯apiå³å¯ã€‚å½“éœ€è¦ç»™äººå¼€è´¦å·çš„æ—¶å€™ï¼Œå†å°†é…ç½®é€‰é¡¹æ”¹å›å»ï¼Œç”¨å®Œå†å…³æ‰å³å¯ã€‚</code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->è¢«ç›‘æ§ç«¯é…ç½®<!-- raw HTML omitted --><code>agent</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>agent</code><!-- raw HTML omitted -->éœ€è¦éƒ¨ç½²åˆ°æ‰€æœ‰è¦è¢«ç›‘æ§çš„æœºå™¨ä¸Šï¼Œæ¯”å¦‚å…¬å¸æœ‰10ä¸‡å°æœºå™¨ï¼Œé‚£å°±è¦éƒ¨ç½²10ä¸‡ä¸ª<!-- raw HTML omitted --><code>agent</code>ã€‚<code>agent</code><!-- raw HTML omitted -->æœ¬èº«èµ„æºæ¶ˆè€—å¾ˆå°‘ï¼Œä¸ç”¨æ‹…å¿ƒ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é…ç½®è¯´æ˜ï¼šé…ç½®æ–‡ä»¶å¿…é¡»å«<!-- raw HTML omitted --><code>cfg.json</code><!-- raw HTML omitted -->ï¼Œå¯ä»¥åŸºäº<!-- raw HTML omitted --><code>cfg.example.json</code><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;debug&#34;</span>: true,  	<span style="color:#75715e"># æ§åˆ¶ä¸€äº›debugä¿¡æ¯çš„è¾“å‡ºï¼Œç”Ÿäº§ç¯å¢ƒé€šå¸¸è®¾ç½®ä¸ºfalse</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;hostname&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,  	<span style="color:#75715e"># agenté‡‡é›†äº†æ•°æ®å‘ç»™transferï¼Œendpointå°±è®¾ç½®ä¸ºäº†hostnameï¼Œé»˜è®¤é€šè¿‡`hostname`è·å–ï¼Œå¦‚æœé…ç½®ä¸­é…ç½®äº†hostnameï¼Œå°±ç”¨é…ç½®ä¸­çš„</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;ip&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#75715e"># agentä¸hbså¿ƒè·³çš„æ—¶å€™ä¼šæŠŠè‡ªå·±çš„ipåœ°å€å‘ç»™hbsï¼Œagentä¼šè‡ªåŠ¨æ¢æµ‹æœ¬æœºipï¼Œå¦‚æœä¸æƒ³è®©agentè‡ªåŠ¨æ¢æµ‹ï¼Œå¯ä»¥æ‰‹å·¥ä¿®æ”¹è¯¥é…ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;plugin&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;enabled&#34;</span>: false,  	<span style="color:#75715e"># é»˜è®¤ä¸å¼€å¯æ’ä»¶æœºåˆ¶</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;dir&#34;</span>: <span style="color:#e6db74">&#34;./plugin&#34;</span>,  	<span style="color:#75715e"># æŠŠæ”¾ç½®æ’ä»¶è„šæœ¬çš„git repo cloneåˆ°è¿™ä¸ªç›®å½•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;git&#34;</span>: <span style="color:#e6db74">&#34;https://github.com/open-falcon/plugin.git&#34;</span>, <span style="color:#75715e"># æ”¾ç½®æ’ä»¶è„šæœ¬çš„git repoåœ°å€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logs&#34;</span>: <span style="color:#e6db74">&#34;./logs&#34;</span>  	<span style="color:#75715e"># æ’ä»¶æ‰§è¡Œçš„logï¼Œå¦‚æœæ’ä»¶æ‰§è¡Œæœ‰é—®é¢˜ï¼Œå¯ä»¥å»è¿™ä¸ªç›®å½•çœ‹log</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;heartbeat&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;enabled&#34;</span>: true,  	<span style="color:#75715e"># æ­¤å¤„enabledè¦è®¾ç½®ä¸ºtrue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;addr&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1:6030&#34;</span>, <span style="color:#75715e"># hbsçš„åœ°å€ï¼Œç«¯å£æ˜¯hbsçš„rpcç«¯å£</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;interval&#34;</span>: 60,  	<span style="color:#75715e"># å¿ƒè·³å‘¨æœŸï¼Œå•ä½æ˜¯ç§’</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;timeout&#34;</span>: <span style="color:#ae81ff">1000</span>  	<span style="color:#75715e"># è¿æ¥hbsçš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;transfer&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;enabled&#34;</span>: true, 
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;addrs&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;127.0.0.1:18433&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">]</span>,  	<span style="color:#75715e"># transferçš„åœ°å€ï¼Œç«¯å£æ˜¯transferçš„rpcç«¯å£, å¯ä»¥æ”¯æŒå†™å¤šä¸ªtransferçš„åœ°å€ï¼Œagentä¼šä¿è¯HA</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;interval&#34;</span>: 60,  	<span style="color:#75715e"># é‡‡é›†å‘¨æœŸï¼Œå•ä½æ˜¯ç§’ï¼Œå³agentä¸€åˆ†é’Ÿé‡‡é›†ä¸€æ¬¡æ•°æ®å‘ç»™transfer</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;timeout&#34;</span>: <span style="color:#ae81ff">1000</span>  	<span style="color:#75715e"># è¿æ¥transferçš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;http&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;enabled&#34;</span>: true,  	<span style="color:#75715e"># æ˜¯å¦è¦ç›‘å¬httpç«¯å£</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;listen&#34;</span>: <span style="color:#e6db74">&#34;:1988&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;backdoor&#34;</span>: false
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;collector&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ifacePrefix&#34;</span>: <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;eth&#34;</span>, <span style="color:#e6db74">&#34;em&#34;</span><span style="color:#f92672">]</span>,  	<span style="color:#75715e"># é»˜è®¤é…ç½®åªä¼šé‡‡é›†ç½‘å¡åç§°å‰ç¼€æ˜¯ethã€emçš„ç½‘å¡æµé‡ï¼Œé…ç½®ä¸ºç©ºå°±ä¼šé‡‡é›†æ‰€æœ‰çš„ï¼Œloçš„ä¹Ÿä¼šé‡‡é›†ã€‚å¯ä»¥ä»/proc/net/devçœ‹åˆ°å„ä¸ªç½‘å¡çš„æµé‡ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mountPoint&#34;</span>: <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;default_tags&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;ignore&#34;</span>: <span style="color:#f92672">{</span>  	<span style="color:#75715e"># é»˜è®¤é‡‡é›†äº†200å¤šä¸ªmetricï¼Œå¯ä»¥é€šè¿‡ignoreè®¾ç½®ä¸ºä¸é‡‡é›†</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cpu.busy&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.bytes.free&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.bytes.total&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.bytes.used&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.bytes.used.percent&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.inodes.total&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.inodes.free&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.inodes.used&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;df.inodes.used.percent&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.memtotal&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.memused&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.memused.percent&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.memfree&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.swaptotal&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.swapused&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mem.swapfree&#34;</span>: true
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è¿›ç¨‹ç®¡ç†<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./open-falcon start agent  	<span style="color:#75715e"># å¯åŠ¨è¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>$ ./open-falcon stop agent  	<span style="color:#75715e"># åœæ­¢è¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>$ ./open-falcon monitor agent  	<span style="color:#75715e"># æŸ¥çœ‹æ—¥å¿—</span></span></span></code></pre></div><ul>
<li>
<p><!-- raw HTML omitted -->éªŒè¯<!-- raw HTML omitted --></p>
<p>çœ‹<code>var</code>ç›®å½•ä¸‹çš„<code>log</code>æ˜¯å¦æ­£å¸¸ï¼Œæˆ–è€…æµè§ˆå™¨è®¿é—®å…¶<code>1988</code>ç«¯å£ã€‚å¦å¤–<code>agent</code>æä¾›äº†ä¸€ä¸ª<code>--check</code>å‚æ•°ï¼Œå¯ä»¥æ£€æŸ¥<code>agent</code>æ˜¯å¦å¯ä»¥æ­£å¸¸è·‘åœ¨å½“å‰æœºå™¨ä¸Š</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./falcon-agent --check</span></span></code></pre></div><ul>
<li>
<p><code>/v1/push</code><!-- raw HTML omitted -->æ¥å£<!-- raw HTML omitted --></p>
<p>è®¾è®¡åˆè¡·æ˜¯ä¸å¸Œæœ›ç”¨æˆ·ç›´æ¥è¿åˆ°<code>Transfer</code>å‘é€æ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡<code>agent</code>çš„<code>/v1/push</code>æ¥å£è½¬å‘ï¼Œæ¥å£ä½¿ç”¨èŒƒä¾‹ï¼š</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ts<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>date +%s<span style="color:#e6db74">`</span>; curl -X POST -d <span style="color:#e6db74">&#34;[{\&#34;metric\&#34;: \&#34;metric.demo\&#34;, \&#34;endpoint\&#34;: \&#34;qd-open-falcon-judge01.hd\&#34;, \&#34;timestamp\&#34;: </span>$ts<span style="color:#e6db74">,\&#34;step\&#34;: 60,\&#34;value\&#34;: 9,\&#34;counterType\&#34;: \&#34;GAUGE\&#34;,\&#34;tags\&#34;: \&#34;project=falcon,module=judge\&#34;}]&#34;</span> http://127.0.0.1:1988/v1/push</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_nightingale">Install_Nightingale</h1>

<h2 id="nightingaleéƒ¨ç½²"><code>Nightingale</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><a href="https://github.com/ccfos/nightingale" rel="external" target="_self"><code>Nightingale</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_grafana">Install_Grafana</h1>

<h2 id="éƒ¨ç½²grafana">éƒ¨ç½²<code>Grafana</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://grafana.com/grafana/download?platform=linux" rel="external" target="_self"><code>Download Grafana</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://grafana.com/grafana/download?pg=graf-deployment-options&plcmt=deploy-box-1" rel="external" target="_self"><code>Download Grafana</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><code>Docker</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker run -d --name<span style="color:#f92672">=</span>grafana -p 3000:3000 grafana/grafana-enterprise</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>tar.gz</code><!-- raw HTML omitted -->äºŒè¿›åˆ¶åŒ…å®‰è£…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://dl.grafana.com/enterprise/release/grafana-enterprise-9.4.7.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar -zxvf grafana-enterprise-9.4.7.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ mv grafana-enterprise-9.4.7 /opt/apps/grafana
</span></span><span style="display:flex;"><span>$ /opt/apps/grafana/bin/grafana-server</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><code>rpm</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://dl.grafana.com/enterprise/release/grafana-enterprise-9.3.0-1.x86_64.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum localinstall grafana-6.3.3-1.x86_64.rpm -y</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è®¾ç½®å¼€æœºè‡ªå¯ï¼š<!-- raw HTML omitted --><code>web</code><!-- raw HTML omitted -->é¡µé¢<!-- raw HTML omitted --><code>3000</code><!-- raw HTML omitted -->ç™»å½•ä¿¡æ¯ï¼š<!-- raw HTML omitted --><strong><code>admin/admin</code></strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl enable grafana-server.service
</span></span><span style="display:flex;"><span>$ systemctl start grafana-server.service</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å®‰è£…æ’ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ grafana-cli plugins install grafana-piechart-panel
</span></span><span style="display:flex;"><span>$ systemctl restart grafana-server</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_zabbix">Configure_Zabbix</h1>

<h2 id="é…ç½®zabbix-job">é…ç½®<code>Zabbix Job</code></h2>
<ul>
<li>
<ol>
<li><code>Zabbix-Agen</code><!-- raw HTML omitted -->æµ‹è¯•æœåŠ¡ç«¯<!-- raw HTML omitted -->ã€<a href="https://www.cnblogs.com/zhuochong/p/10361947.html" rel="external" target="_self"><code>Zabbix</code>ç›‘æ§é…ç½®</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><code>abbix_get</code>ï¼š<code>-s</code>ï¼šå®¢æˆ·ç«¯åœ°å€ï¼Œ<code>-p</code>ï¼šå®¢æˆ·ç«¯ç«¯å£ï¼Œ<code>-k</code>ï¼šé”®å€¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ bin/zabbix_get -s <span style="color:#e6db74">&#34;zabbix_agent IP&#34;</span> -k agent.ping -p <span style="color:#ae81ff">10050</span> <span style="color:#75715e"># get value</span>
</span></span><span style="display:flex;"><span>$ cp /usr/share/fonts/wqy-microhei/wqy-microhei.ttc nginx/html/zabbix/fonts/DejaVuSans.ttf</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å‹åŠ›æµ‹è¯•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ab -c <span style="color:#ae81ff">10</span> -n <span style="color:#ae81ff">1000000</span> http://192.168.56.11:8080/</span></span></code></pre></div></blockquote>
<hr>
<h3 id="é…ç½®zabbixç”¨æˆ·">é…ç½®<code>Zabbix</code>ç”¨æˆ·</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åˆ›å»ºé…ç½®ç”¨æˆ·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-9f849c0817100efd3cf720a97595e6c3" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-28-48.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9f849c0817100efd3cf720a97595e6c3"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-28-48.png"></a></p>
<p><a href="#R-image-101a97f38b4a02e035ebe95234d170d9" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-34-55.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-101a97f38b4a02e035ebe95234d170d9"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-34-55.png"></a></p>
</blockquote>
<hr>
<h3 id="åˆ›å»ºä¸»æœºæˆ–è€…ä¸»æœºç»„">åˆ›å»ºä¸»æœºæˆ–è€…ä¸»æœºç»„</h3>
<blockquote>
<p><a href="#R-image-af4e79e683acd6c37c1a1d8d835d963d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/host_groups_redis.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-af4e79e683acd6c37c1a1d8d835d963d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/host_groups_redis.png"></a></p>
<p><a href="#R-image-fb2091b40c270db12d29fb7330be3d3d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/host_groups_web.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fb2091b40c270db12d29fb7330be3d3d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/host_groups_web.png"></a></p>
<p><a href="#R-image-8099c2fe988def0cb529033125d968e1" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-38-06.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8099c2fe988def0cb529033125d968e1"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-38-06.png"></a></p>
<p><a href="#R-image-5a73736b2b338efe0c47d8d8fb75d37a" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-43-33.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5a73736b2b338efe0c47d8d8fb75d37a"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-03_18-43-33.png"></a></p>
</blockquote>
<hr>
<h3 id="é…ç½®zabbixç›‘æ§ç«¯å£å‘Šè­¦">é…ç½®<code>Zabbix</code>ç›‘æ§ç«¯å£å‘Šè­¦</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç›‘æ§ç«¯å£<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»ºã€é…ç½®ç›‘æ§é¡¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-55d43fd960eddfa4987ecb6079f6f9b1" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-26-45.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-55d43fd960eddfa4987ecb6079f6f9b1"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-26-45.png"></a></p>
<p><a href="#R-image-acfc78a1bd89834331edfb07e45fad61" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-28-55.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-acfc78a1bd89834331edfb07e45fad61"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-28-55.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»ºã€é…ç½®è§¦å‘å™¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-b729cd1278f74a957d0dd08621ba37c4" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-30-18.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b729cd1278f74a957d0dd08621ba37c4"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-30-18.png"></a></p>
<p><a href="#R-image-aee38248d81cb3e133e028593a85089a" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-31-54.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-aee38248d81cb3e133e028593a85089a"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Job/Snipaste_2023-04-04_13-31-54.png"></a></p>
</blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_zabbix_grafana">Configure_Zabbix_Grafana</h1>

<h2 id="é…ç½®zabbixgrafanaç›‘æ§å±•ç¤º">é…ç½®<code>Zabbix+Grafana</code>ç›‘æ§å±•ç¤º</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.zabbix.com/cn/integrations/grafana" rel="external" target="_self"><code>Zabbix+Grafana</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://grafana.com/grafana/dashboards/?plcmt=footer&dataSource=alexanderzobnin-zabbix-datasource" rel="external" target="_self"><code>Grafana Dashboards</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://blog.csdn.net/sinat_33622098/article/details/116007072" rel="external" target="_self"><code>Grafana</code>ä¹‹<code>telegram</code>æŠ¥è­¦é…ç½®</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/starsliao/ConsulManager" rel="external" target="_self"><code>ConsulManager</code>å®ç°<code>Prometheus</code>ç›‘æ§ç›®æ ‡</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://grafana.com/grafana/dashboards/9965-1-blackbox-exporter-dashboard-20220412/" rel="external" target="_self"><code>Blackbox Exporter Dashboard 2022/04/12</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://grafana.com/grafana/dashboards/8919-1-node-exporter-for-prometheus-dashboard-cn-0413-consulmanager/" rel="external" target="_self"><code>1 Node Exporter Dashboard 22/04/13 ConsulManager</code>è‡ªåŠ¨åŒæ­¥ç‰ˆ</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Grafana</code><!-- raw HTML omitted -->ä¸­æ–‡ç•Œé¢<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/apps/grafana/conf/defaults.ini<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_language = en-US  	# ä¿®æ”¹ä¸ºï¼šdefault_language = zh-CN
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ grafana-cli plugins install grafana-zh-cn-panel</span></span></code></pre></div></blockquote>
<ul>
<li><code>Grafana</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><a href="https://grafana.com/grafana/plugins/alexanderzobnin-zabbix-app/?tab=installation" rel="external" target="_self"><code>Zabbix</code>æ’ä»¶</a><!-- raw HTML omitted -->åˆ°æŒ‡å®šç›®å½•<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>--pluginsDir=</code><!-- raw HTML omitted -->æŒ‡å®šæ’ä»¶å®‰è£…ç›®å½•<!-- raw HTML omitted --></li>
<li><code>alexanderzobnin-zabbix-app</code><!-- raw HTML omitted -->è¦å®‰è£…çš„æ’ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/apps/grafana/bin/grafana-cli --pluginsDir<span style="color:#f92672">=</span>/opt/apps/grafana/data/plugins plugins install alexanderzobnin-zabbix-app</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<a href="https://grafana.com/grafana/plugins/grafana-image-renderer/?tab=installation" rel="external" target="_self"><code>Grafana Image Renderer</code></a>å›¾åƒæ’ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/apps/grafana/bin/grafana-cli --pluginsDir<span style="color:#f92672">=</span>/opt/apps/grafana/data/plugins plugins install grafana-image-renderer</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯ç”¨å›¾ç‰‡å‘é€å‚æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/apps/grafana/conf/defaults.ini<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">capture = false  	# ä¿®æ”¹ä¸ºï¼štrue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">upload_external_image_storage = false  	# ä¿®æ”¹ä¸ºï¼štrue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>Grafana</code><!-- raw HTML omitted -->é¡µé¢é…ç½®<!-- raw HTML omitted --><code>Zabbix</code><!-- raw HTML omitted -->æ•°æ®æº<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-8033a6ccebea8b07abd6aacf605b117e" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-04-35.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8033a6ccebea8b07abd6aacf605b117e"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-04-35.png"></a></p>
<p><a href="#R-image-13d3133184585802f97280b4eca6d603" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-02-57.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-13d3133184585802f97280b4eca6d603"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-02-57.png"></a></p>
<p><a href="#R-image-31def027bf9ec7b4b22282cbb57b2d86" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-05-53.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-31def027bf9ec7b4b22282cbb57b2d86"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-05-53.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Zabbix</code><!-- raw HTML omitted -->æ•°æ®æºåˆ›å»º<!-- raw HTML omitted --><code>Grafana</code><!-- raw HTML omitted -->ä»ªè¡¨ç›˜<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-789d9d04ff43c9dd70f9116406f7630d" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-18-40.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-789d9d04ff43c9dd70f9116406f7630d"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Grafana_Server/Snipaste_2023-04-04_20-18-40.png"></a></p>
</blockquote>
<ul>
<li><code>Grafana</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Telegram</code><!-- raw HTML omitted -->å‘Šè­¦<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="#R-image-8f715af80942b09023eeb5753fd98e33" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Telegram/Snipaste_2023-04-04_20-40-56.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8f715af80942b09023eeb5753fd98e33"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Telegram/Snipaste_2023-04-04_20-40-56.png"></a></p>
<p><a href="#R-image-782d7724d0a2c2b8295f25c4268e7465" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Telegram/Snipaste_2023-04-04_21-09-21.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-782d7724d0a2c2b8295f25c4268e7465"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Zabbix_Server_Telegram/Snipaste_2023-04-04_21-09-21.png"></a></p>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_prometheus">Configure_Prometheus</h1>

<h2 id="é…ç½®prometheus">é…ç½®<code>Prometheus</code></h2>
<h3 id="prometheusçš„yamlæ–‡ä»¶ç¼–å†™"><code>Prometheus</code>çš„<code>yaml</code>æ–‡ä»¶ç¼–å†™</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/prometheus/prometheus.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># my global config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">global:  	# å…¨å±€é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">scrape_interval:     15s # é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯15sæ‹‰å–ä¸€æ¬¡ç›®æ ‡é‡‡æ ·ç‚¹æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># scrape_timeout is set to the global default (10s).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Alertmanager configuration
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alerting:  	# æŠ¥è­¦é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alertmanagers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - static_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - targets:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      # - alertmanager:9093
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#remote_write:  	# ç”¨äºè¿œç¨‹å­˜å‚¨å†™é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#remote_read:  	# ç”¨äºè¿œç¨‹è¯»é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Load rules once and periodically evaluate them according to the global &#39;evaluation_interval&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rule_files:  	# è§„åˆ™é…ç½®ï¼Œä¸»è¦æ˜¯é…ç½®ï¼šæŠ¥è­¦è§„åˆ™
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # - &#34;rules/*.yml&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # - &#34;first_rules.yml&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # - &#34;second_rules.yml&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># A scrape configuration containing exactly one endpoint to scrape:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Here it&#39;s Prometheus itself.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">scrape_configs:  	# æŠ“å–é…ç½®ï¼Œä¸»è¦é…ç½®æŠ“å–å®¢æˆ·ç«¯ç›¸å…³
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - job_name: &#39;prometheus&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # metrics_path defaults to &#39;/metrics&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # scheme defaults to &#39;http&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    static_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - targets: [&#39;localhost:9090&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - job_name: &#39;node&#39;  	# ä»»åŠ¡åï¼Œä½¿ç”¨node_exportæ’ä»¶è·å–æœåŠ¡å™¨ç›‘æ§æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    static_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - targets:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;localhost:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;swoft_1:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;swoft_2:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;175_web:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;176_web:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;177_admin:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_0:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_1:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_2:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_3:9100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - job_name: &#39;mysql&#39;  	# ä½¿ç”¨mysqld_exporteræ’ä»¶è·å–Mysqlç›‘æ§æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    static_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - targets:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_0:9104&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_1:9104&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_2:9104&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;mysql_redis_3:9104&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - job_name: &#39;container&#39;  	# ä½¿ç”¨cAdvisor è·å–åˆ°çš„å®¹å™¨ç›‘æ§æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    static_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - targets: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;&lt;èŠ‚ç‚¹01çš„IP&gt;:8080&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - &#39;&lt;èŠ‚ç‚¹02çš„IP&gt;:8080&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="é…ç½®prometheus-webé¡µé¢">é…ç½®<code>Prometheus web</code>é¡µé¢</h3>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->æµè§ˆå™¨è®¿é—®ï¼š<!-- raw HTML omitted --><code>IP:9090</code></p>
</li>
<li>
<p><code>shell</code><!-- raw HTML omitted -->å‘½ä»¤åˆ›å»º<!-- raw HTML omitted --></p>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;some_metric 3.14&#34;</span> | curl --data-binary @- http://localhost:9091/metrics/job/some_job</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å‘é€å¤æ‚æ•°æ®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF | curl --data-binary @- http://localhost:9091/metrics/job/some_job/instance/some_instance
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># TYPE some_metric counter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">some_metric{label=&#34;val1&#34;} 42
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># TYPE another_metric gauge
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># HELP another_metric Just an example.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">another_metric 2398.283
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ æ•°æ®æº<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->æ·»åŠ <!-- raw HTML omitted --><code>prometheus</code><!-- raw HTML omitted -->ï¼Œå¡«å†™<!-- raw HTML omitted --><code>prometheus</code><!-- raw HTML omitted -->çš„ç®¡ç†åœ°å€<!-- raw HTML omitted --></p>
</li>
<li>
<p><!-- raw HTML omitted -->å¯¼å…¥<!-- raw HTML omitted --><code>dashboard</code></p>
</li>
<li>
<p><!-- raw HTML omitted -->é€šè¿‡<!-- raw HTML omitted --><a href="https://grafana.com/grafana/dashboards" rel="external" target="_self"><code>grafana</code>å®˜ç½‘</a><!-- raw HTML omitted -->ä»ªè¡¨ç›˜æ·»åŠ å¯¹åº”ä»ªè¡¨ç›˜<!-- raw HTML omitted --></p>
</li>
<li>
<p><!-- raw HTML omitted -->å¸¸ç”¨ä»ªè¡¨ç›˜<!-- raw HTML omitted --></p>
</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="é…ç½®grafana">é…ç½®<code>grafana</code></h3>
<blockquote>
<ul>
<li><code>grafana</code><!-- raw HTML omitted -->å‘Šè­¦é‚®ä»¶é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>grafana</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ <!-- raw HTML omitted --><code>Email</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
<li><a href="https://grafana.com/grafana/dashboards/" rel="external" target="_self"><code>Grafana Dashboards</code></a></li>
<li><a href="https://github.com/starsliao/ConsulManager" rel="external" target="_self"><code>ConsulManager</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/grafana/grafana.ini<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[smtp]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">enabled = true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host = smtp.163.com:465
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">user = 18329903316
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># If the password contains # or ; you have to wrap it with trippel quotes. Ex &#34;&#34;&#34;#password;&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password = xxxxxxxxxxxx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;cert_file =
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;key_file =
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;skip_verify = false
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">from_address = 18329903316@163.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;from_name = Grafana
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;ehlo_identity = dashboard.exmple.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>grafana web</code><!-- raw HTML omitted -->ç•Œé¢é…ç½®<!-- raw HTML omitted --><code>Notification channels</code></li>
</ul>
<blockquote>
</blockquote>
<ul>
<li><code>alter</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->âš ï¸ï¼š<!-- raw HTML omitted --><code>Template variables are not supported in alert queries</code><!-- raw HTML omitted -->åœ¨æŸ¥è¯¢ä¸­ä¸èƒ½ä½¿ç”¨æ¨¡ç‰ˆè¯­æ³•ï¼Œä¸ç„¶æ— æ³•åˆ›å»ºå‘Šè­¦<!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="é…ç½®prometheusç›‘æ§nginx">é…ç½®<code>Prometheus</code>ç›‘æ§<code>Nginx</code></h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->ç›‘æ§æ’ä»¶<!-- raw HTML omitted --><code>nginx-module-vts</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone git://github.com/vozlt/nginx-module-vts.git </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é‡æ–°ç¼–è¯‘<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->æ”¯æŒæ’ä»¶<!-- raw HTML omitted --><code>nginx-module-vts</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx-1.12.2 --user<span style="color:#f92672">=</span>nginx --group<span style="color:#f92672">=</span>nginx --with-http_stub_status_module  --with-http_ssl_module &gt; --add-module<span style="color:#f92672">=</span>/usr/local/nginx-module-vts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ make</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‹·è´é‡æ–°ç¼–è¯‘åçš„<!-- raw HTML omitted --><code>Nginx</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nginx -s stop
</span></span><span style="display:flex;"><span>$ <span style="color:#ae81ff">\c</span>p ./objs/nginx /usr/local/nginx/sbin/</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->ä¸»é…ç½®æ–‡ä»¶<!-- raw HTML omitted --><code>nginx.conf</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;nginx.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.....
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">### Prometheus é…ç½®   
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vhost_traffic_status_zone;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vhost_traffic_status_filter_by_host on;  	# æ‰“å¼€vhostè¿‡æ»¤
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">### Prometheus é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">.....
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">location /status {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         # vhost_traffic_status off;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         vhost_traffic_status_display;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         vhost_traffic_status_display_format html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½<!-- raw HTML omitted --><code>nginx-vts-exporter</code><!-- raw HTML omitted -->ç›‘æ§æ’ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /opt <span style="color:#f92672">&amp;&amp;</span> wget -c https://github.com/hnlq715/nginx-vts-exporter/releases/download/&gt; v0.10.3/nginx-vts-exporter-0.10.3.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>$ tar xf nginx-vts-exporter-0.10.3.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>./nginx-vts-exporter -nginx.scrape_timeout <span style="color:#ae81ff">10</span> -nginx.scrape_uri 
</span></span><span style="display:flex;"><span>http://10.10.16.107/status/format/json &amp;  	<span style="color:#75715e"># å¯åŠ¨nginx Vhost Traffic</span>
</span></span><span style="display:flex;"><span>http://10.10.16.107/status  	<span style="color:#75715e"># è®¿é—®nginxä¸»æœºå„èŠ‚ç‚¹çŠ¶æ€</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="é…ç½®alertmanagerå‘Šè­¦">é…ç½®<code>Alertmanager</code>å‘Šè­¦</h3>
<ul>
<li><!-- raw HTML omitted -->å‘Šè­¦è§„åˆ™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><a href="https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/" rel="external" target="_self"><code>ALERTING RULES</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;rules/general.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">groups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name: general.rules  	# æŠ¥è­¦è§„åˆ™ç»„åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # ä»»ä½•å®ä¾‹5åˆ†é’Ÿå†…æ— æ³•è®¿é—®å‘å‡ºå‘Šè­¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - alert: InstanceDown
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    expr: up == 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for: 5m  	# æŒç»­æ—¶é—´ ï¼Œ è¡¨ç¤ºæŒç»­ä¸€åˆ†é’Ÿè·å–ä¸åˆ°ä¿¡æ¯ï¼Œåˆ™è§¦å‘æŠ¥è­¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      severity: page  # è‡ªå®šä¹‰æ ‡ç­¾ error
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      summary: &#34;Instance {{ $labels.instance }} åœæ­¢å·¥ä½œ down&#34;  	# è‡ªå®šä¹‰æ‘˜è¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: &#34;{{ $labels.instance }} of job {{ $labels.job }} å·²ç»åœæ­¢5åˆ†é’Ÿä»¥ä¸Š has been down for more than 5 minutes.&#34;  	# è‡ªå®šä¹‰å…·ä½“æè¿°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;rules/node.yml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">groups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name: node.rules
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - alert: NodeFilesystemUsage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    expr: 100 - (node_filesystem_free_bytes{fstype=~&#34;ext4|xfs&#34;} / node_filesystem_size_bytes{fstype=~&#34;ext4|xfs&#34;} * 100) &gt; 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for: 2m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      severity: warning
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      summary: &#34;{{$labels.instance}}: {{$labels.mountpoint }} åˆ†åŒºä½¿ç”¨è¿‡é«˜&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: &#34;{{$labels.instance}}: {{$labels.mountpoint }} åˆ†åŒºä½¿ç”¨å¤§äº 80% (å½“å‰å€¼: {{ $value }})&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - alert: NodeMemoryUsage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    expr: 100 - (node_memory_MemFree_bytes+node_memory_Cached_bytes+node_memory_Buffers_bytes) / node_memory_MemTotal_bytes * 100 &gt; 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for: 2m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      severity: warning
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      summary: &#34;{{$labels.instance}}: å†…å­˜ä½¿ç”¨è¿‡é«˜&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: &#34;{{$labels.instance}}: å†…å­˜ä½¿ç”¨å¤§äº 80% (å½“å‰å€¼: {{ $value }})&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - alert: NodeCPUUsage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    expr: 100 - (avg(irate(node_cpu_seconds_total{mode=&#34;idle&#34;}[5m])) by (instance) * 100) &gt; 80
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for: 2m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      severity: warning
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      summary: &#34;{{$labels.instance}}: CPUä½¿ç”¨è¿‡é«˜&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: &#34;{{$labels.instance}}: CPUä½¿ç”¨å¤§äº 80% (å½“å‰å€¼: {{ $value }})&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cat rules/reload.yml 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">groups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- name: prometheus.rules
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  rules:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - alert: AlertmanagerReloadFailed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    expr: alertmanager_config_last_reload_successful == 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for: 10m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      severity: warning
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      summary: &#34;{{$labels.instance}}: Alertmanageré…ç½®é‡æ–°åŠ è½½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: &#34;{{$labels.instance}}: Alertmanageré…ç½®é‡æ–°åŠ è½½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - alert: PrometheusReloadFailed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    expr: prometheus_config_last_reload_successful == 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for: 10m
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    labels:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      severity: warning
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    annotations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      summary: &#34;{{$labels.instance}}: Prometheusé…ç½®é‡æ–°åŠ è½½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      description: &#34;{{$labels.instance}}: Prometheusé…ç½®é‡æ–°åŠ è½½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">route</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">receiver</span>: <span style="color:#e6db74">&#39;default-receiver&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">group_wait</span>: <span style="color:#ae81ff">30s</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">group_interval</span>: <span style="color:#ae81ff">5m</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">repeat_interval</span>: <span style="color:#ae81ff">4h</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">group_by</span>: [<span style="color:#ae81ff">cluster, alertname]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">routes</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">receiver</span>: <span style="color:#e6db74">&#39;database-pager&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">group_wait</span>: <span style="color:#ae81ff">10s</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">match_re</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">service</span>: <span style="color:#ae81ff">mysql|cassandra</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">receiver</span>: <span style="color:#e6db74">&#39;frontend-pager&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">group_by</span>: [<span style="color:#ae81ff">product, environment]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">match</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">team</span>: <span style="color:#ae81ff">frontend</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">receivers</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">â€˜database-pager</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">email_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- to: &#39;</span><span style="color:#ae81ff">zhenliang369@163.com&#39;</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">â€˜frontend-pager</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">email_configs:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- to: &#39;</span><span style="color:#ae81ff">zhenliang369@163.com&#39; </span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_open_falcon">Configure_Open_Falcon</h1>

<h2 id="open-falconé…ç½®"><code>Open-falcon</code>é…ç½®</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹ç›‘æ§æ•°æ®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><a href="https://www.cnblogs.com/kevingrace/p/5570488.html" rel="external" target="_self"><code>Linux</code>ä¸‹<code>smokeping</code>ç½‘ç»œç›‘æ§ç¯å¢ƒéƒ¨ç½²è®°å½•</a></p>
</li>
<li>
<p><code>agent</code>åªè¦éƒ¨ç½²åˆ°æœºå™¨ä¸Šï¼Œå¹¶ä¸”é…ç½®å¥½äº†<code>heartbeat</code>å’Œ<code>transfer</code>å°±è‡ªåŠ¨é‡‡é›†æ•°æ®äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥å»<code>dashboard</code>ä¸Šé¢æœç´¢ç›‘æ§æ•°æ®æŸ¥çœ‹äº†ã€‚<code>dashboard</code>æ˜¯ä¸ª<code>web&gt; </code>é¡¹ç›®ï¼Œæµè§ˆå™¨è®¿é—®ä¹‹ã€‚å·¦ä¾§è¾“å…¥<code>endpoint</code>æœç´¢ï¼Œ<code>endpoint</code>æ˜¯ä»€ä¹ˆï¼Ÿåº”è¯¥ç”¨ä»€ä¹ˆæœç´¢ï¼Ÿå¯¹äº<code>agent</code>é‡‡é›†çš„æ•°æ®<code>endpoint</code>éƒ½æ˜¯æœºå™¨åï¼Œå»ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œ<code>hostname</code>&gt; ï¼Œçœ‹åˆ°çš„è¾“å‡ºå°±æ˜¯<code>endpoint</code>ï¼Œæ‹¿ç€<code>hostname</code>å»æœç´¢ã€‚</p>
</li>
<li>
<p>é€‰ä¸­å‰é¢çš„å¤é€‰æ¡†ï¼Œç‚¹å‡»â€œæŸ¥çœ‹<code>counter</code>åˆ—è¡¨â€ï¼Œå¯ä»¥åˆ—å‡ºéš¶å±äºè¿™ä¸ª<code>endpoint</code>çš„<code>counter</code>å‡å¦‚æˆ‘ä»¬è¦æŸ¥çœ‹<code>cpu.busy</code>ï¼Œåœ¨<code>counter</code>æœç´¢æ¡†ä¸­è¾“å…¥<code>cpu</code>&gt; å¹¶å›è½¦ã€‚çœ‹åˆ°<code>cpu.busy</code>äº†å§ï¼Œç‚¹å‡»ï¼Œä¼šçœ‹åˆ°ä¸€ä¸ªæ–°é¡µé¢ï¼Œå›¾è¡¨ä¸­å°±æ˜¯è¿™ä¸ªæœºå™¨çš„<code>cpu.busy</code>&gt; çš„è¿‘ä¸€å°æ—¶æ•°æ®äº†ï¼Œæƒ³çœ‹æ›´é•¿æ—¶é—´çš„ï¼Ÿå³ä¸Šè§’æœ‰ä¸ªå°ä¸‰è§’ï¼Œå±•å¼€èœå•ï¼Œå¯ä»¥é€‰æ‹©æ›´é•¿çš„æ—¶é—´è·¨åº¦</p>
</li>
</ul>
<p><a href="#R-image-eb5e6a2569ad6536135a727ffc867833" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-eb5e6a2569ad6536135a727ffc867833"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard.png"></a></p>
<p><a href="#R-image-8529978f604361f5ed2761225dedd877" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-cpu.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8529978f604361f5ed2761225dedd877"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-cpu.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®æŠ¥è­¦ç­–ç•¥<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->é…ç½®æŠ¥è­¦æ¥æ”¶äºº<!-- raw HTML omitted --></p>
<p><code>falcon</code>çš„æŠ¥è­¦æ¥æ”¶äººä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æ‰‹æœºå·ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„é‚®ç®±ï¼Œå› ä¸ºæ‰‹æœºå·ã€é‚®ç®±éƒ½æ˜¯å®¹æ˜“å‘ç”Ÿå˜åŒ–çš„ï¼Œå¦‚æœå˜åŒ–äº†å»ä¿®æ”¹æ‰€æœ‰ç›¸å…³é…ç½®é‚£å°±å¤ªéº»çƒ¦äº†ã€‚æˆ‘ä»¬æŠŠç”¨&gt; æˆ·çš„è”ç³»ä¿¡æ¯ç»´æŠ¤åœ¨ä¸€ä¸ªå« <code>å¸æˆ·/Profile</code> é‡Œï¼Œä»¥åå¦‚æœè¦ä¿®æ”¹æ‰‹æœºå·ã€é‚®ç®±ï¼Œåªè¦ä¿®æ”¹è‡ªå·±çš„å¸æˆ·ä¿¡æ¯å³å¯ã€‚æŠ¥è­¦æ¥æ”¶äººä¹Ÿä¸æ˜¯å•ä¸ªçš„äººï¼Œè€Œæ˜¯ä¸€ä¸ªç»„ï¼ˆ<code>Teams</code>ï¼‰ï¼Œæ¯”å¦‚<code>&gt; falcon</code>è¿™ä¸ªç³»ç»Ÿçš„ä»»ä½•ç»„ä»¶å‡ºé—®é¢˜äº†ï¼Œéƒ½åº”è¯¥å‘æŠ¥è­¦ç»™<code>falcon</code>çš„è¿ç»´å’Œå¼€å‘äººå‘˜ï¼Œå‘ç»™<code>falcon</code>è¿™ä¸ªå›¢é˜Ÿï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ–°å‘˜å·¥å…¥èŒåªè¦åŠ å…¥<code>falcon</code>è¿™ä¸ª<code>Team</code>&gt; å³å¯ï¼›å‘˜å·¥ç¦»èŒï¼Œåªè¦ä»<code>falcon</code>è¿™ä¸ª<code>Team</code>åˆ æ‰å³å¯ã€‚</p>
</li>
</ul>
<p><a href="#R-image-e41a286958559f94d84a25773dd95058" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-profile.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e41a286958559f94d84a25773dd95058"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-profile.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ æŠ¥è­¦ç»„ï¼Œæ·»åŠ æˆå‘˜<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-376e8ec88604791a94e8581038a89807" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-group.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-376e8ec88604791a94e8581038a89807"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-group.png"></a></p>
<p><a href="#R-image-8f6aa5dd9959504c3c0003d0df5816cb" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-group-1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8f6aa5dd9959504c3c0003d0df5816cb"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/dashboard-group-1.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»º<!-- raw HTML omitted --><code>HostGroup</code></li>
</ul>
<blockquote>
<ul>
<li>æ¯”å¦‚æˆ‘ä»¬è¦å¯¹<code>falcon-judge</code>è¿™ä¸ªç»„ä»¶åšç«¯å£ç›‘æ§ï¼Œé‚£é¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>HostGroup</code>ï¼ŒæŠŠæ‰€æœ‰éƒ¨ç½²äº†<code>falcon-judge</code>&gt; è¿™ä¸ªæ¨¡å—çš„æœºå™¨éƒ½å¡è¿›å»ï¼Œä»¥åè¦æ‰©å®¹æˆ–ä¸‹çº¿æœºå™¨çš„æ—¶å€™ç›´æ¥ä»è¿™ä¸ª<code>HostGroup</code>å¢åˆ æœºå™¨å³å¯ï¼ŒæŠ¥è­¦ç­–ç•¥ä¼šè‡ªåŠ¨ç”Ÿæ•ˆã€å¤±æ•ˆã€‚å’±ä»¬ä¸ºè¿™ä¸ª<code>HostGroup</code>å–åä¸ºï¼š<code>&gt; sa.dev.falcon.judge</code>ï¼Œè¿™ä¸ªåç§°æœ‰è®²ç©¶ï¼Œ<code>sa</code>æ˜¯æˆ‘ä»¬éƒ¨é—¨ï¼Œ<code>dev</code>æ˜¯æˆ‘ä»¬ç»„ï¼Œ<code>falcon</code>æ˜¯é¡¹ç›®åï¼Œ<code>judge</code>&gt; æ˜¯ç»„ä»¶åï¼Œä¼ è¾¾å‡ºäº†å¾ˆå¤šä¿¡æ¯ï¼Œè¿™æ ·å‘½åæ¯”è¾ƒå®¹æ˜“ç®¡ç†ï¼Œæ¨èå¤§å®¶è¿™ä¹ˆåš</li>
</ul>
<p><a href="#R-image-87f0d1485e35389ce3d44a8dbf4309db" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/hostgroups.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-87f0d1485e35389ce3d44a8dbf4309db"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/hostgroups.png"></a></p>
<ul>
<li>åœ¨å¾€ç»„é‡ŒåŠ æœºå™¨çš„æ—¶å€™å¦‚æœæŠ¥é”™ï¼Œéœ€è¦æ£€æŸ¥<code>portal</code>çš„æ•°æ®åº“ä¸­<code>host</code>è¡¨ï¼Œçœ‹é‡Œè¾¹æ˜¯å¦æœ‰ç›¸å…³æœºå™¨ã€‚é‚£<code>host</code>è¡¨ä¸­çš„æœºå™¨ä»å“ªé‡Œæ¥å‘¢ï¼Ÿ<code>agent</code>æœ‰ä¸ª<code>heartbeat(hbs)</code>&gt; çš„é…ç½®ï¼Œ<code>agent</code>æ¯åˆ†é’Ÿä¼šå‘å¿ƒè·³ç»™<code>hbs</code>ï¼ŒæŠŠè‡ªå·±çš„<code>ip</code>ã€<code>hostname</code>ã€<code>agent version</code>ç­‰ä¿¡æ¯å‘Šè¯‰<code>hbs</code>ï¼Œ<code>hbs</code>è´Ÿè´£å†™å…¥<code>host</code>è¡¨ã€‚å¦‚æœ<code>host</code>&gt; è¡¨ä¸­æ²¡æ•°æ®ï¼Œéœ€è¦æ£€æŸ¥è¿™æ¡é“¾è·¯æ˜¯å¦é€šç•…</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»ºç­–ç•¥æ¨¡æ¿<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>portal</code>æœ€ä¸Šé¢æœ‰ä¸ª<code>Templates</code>é“¾æ¥ï¼Œè¿™å°±æ˜¯ç­–ç•¥æ¨¡æ¿ç®¡ç†çš„å…¥å£ã€‚æˆ‘ä»¬è¿›å»ä¹‹ååˆ›å»ºä¸€ä¸ªæ¨¡æ¿ï¼Œåç§°å§‘ä¸”ä¹Ÿå«ï¼š<code>sa.dev.falcon.judge.tpl</code>ï¼Œä¸<code>HostGroup</code>&gt; åç§°ç›¸åŒï¼Œåœ¨é‡Œè¾¹é…ç½®ä¸€ä¸ªç«¯å£ç›‘æ§ï¼Œé€šå¸¸è¿›ç¨‹ç›‘æ§æœ‰ä¸¤ç§æ‰‹æ®µï¼Œä¸€ä¸ªæ˜¯è¿›ç¨‹æœ¬èº«æ˜¯å¦å­˜æ´»ï¼Œä¸€ä¸ªæ˜¯ç«¯å£æ˜¯å¦åœ¨ç›‘å¬ï¼Œæ­¤å¤„æˆ‘ä»¬ä½¿ç”¨ç«¯å£ç›‘æ§</li>
</ul>
<p><a href="#R-image-5ed6a6f52b14dd4012cf751877cd06a8" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5ed6a6f52b14dd4012cf751877cd06a8"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template.png"></a></p>
<p><a href="#R-image-2eb327cf7afa1c160059d08476788af1" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template-1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2eb327cf7afa1c160059d08476788af1"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template-1.png"></a></p>
<ul>
<li>å³ä¸Šè§’é‚£ä¸ªåŠ å·æŒ‰é’®æ˜¯ç”¨äºå¢åŠ ç­–ç•¥çš„ï¼Œä¸€ä¸ªæ¨¡æ¿ä¸­å¯ä»¥æœ‰å¤šä¸ªç­–ç•¥ï¼Œæ­¤å¤„æˆ‘ä»¬åªæ·»åŠ äº†ä¸€ä¸ªã€‚ä¸‹é¢å¯ä»¥é…ç½®æŠ¥è­¦æ¥æ”¶äººï¼Œæ­¤å¤„å¡«å†™çš„æ˜¯<code>falcon</code>ï¼Œè¿™æ˜¯ä¹‹å‰åœ¨<code>UIC</code>&gt; ä¸­åˆ›å»ºçš„<code>Team</code>ã€‚</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å°†<!-- raw HTML omitted --><code>HostGroup</code><!-- raw HTML omitted -->ä¸æ¨¡æ¿ç»‘å®š<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ä¸€ä¸ªæ¨¡æ¿æ˜¯å¯ä»¥ç»‘å®šåˆ°å¤šä¸ª<code>HostGroup</code>çš„ï¼Œç°åœ¨æˆ‘ä»¬é‡æ–°å›åˆ°<code>HostGroups</code>é¡µé¢ï¼Œæ‰¾åˆ°<code>sa.dev.falcon.judge</code>è¿™ä¸ª<code>HostGroup</code>&gt; ï¼Œå³ä¾§æœ‰å‡ ä¸ªè¶…é“¾æ¥ï¼Œç‚¹å‡»ã€templatesã€‘è¿›å…¥ä¸€ä¸ªæ–°é¡µé¢ï¼Œè¾“å…¥æ¨¡æ¿åç§°ï¼Œç»‘å®šä¸€ä¸‹å°±è¡Œäº†</li>
</ul>
<p><a href="#R-image-04046e4d03ddb567b485a279ab1fdea1" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/hostgroups-tempates.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-04046e4d03ddb567b485a279ab1fdea1"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/hostgroups-tempates.png"></a></p>
<p><a href="#R-image-d61775525ec7de728789351eb4460d3e" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/hostgroups-tempates-1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d61775525ec7de728789351eb4460d3e"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/hostgroups-tempates-1.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->è¡¥å……<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ä¸Šé¢æ­¥éª¤åšå®Œäº†ï¼Œä¹Ÿå°±é…ç½®å®Œäº†ã€‚å¦‚æœ<code>judge</code>ç»„ä»¶å®•æœºï¼Œç«¯å£ä¸å†ç›‘å¬äº†ï¼Œå°±ä¼šæŠ¥è­¦ã€‚ä¸è¿‡å¤§å®¶ä¸è¦ä¸ºäº†æµ‹è¯•æŠ¥è­¦æ•ˆæœï¼Œç›´æ¥æŠŠ<code>judge</code>ç»„ä»¶ç»™å¹²æ‰äº†ï¼Œå› ä¸º<code>judge</code>&gt; æœ¬èº«å°±æ˜¯è´Ÿè´£åˆ¤æ–­æŠ¥è­¦çš„ï¼ŒæŠŠå®ƒå¹²æ‰äº†ï¼Œé‚£å°±æ²¡æ³•åˆ¤æ–­äº†â€¦â€¦æ‰€ä»¥è¯´<code>falcon</code>&gt; ç°åœ¨å¹¶ä¸å®Œå–„ï¼Œæ²¡æ³•ç”¨æ¥ç›‘æ§æœ¬èº«çš„ç»„ä»¶ã€‚ä¸ºäº†æµ‹è¯•ï¼Œå¤§å®¶å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ç«¯å£ç›‘æ§çš„ç­–ç•¥é…ç½®ï¼Œæ”¹æˆä¸€ä¸ªæ²¡æœ‰åœ¨ç›‘å¬çš„ç«¯å£ï¼Œè¿™æ ·å°±è§¦å‘æŠ¥è­¦äº†</li>
<li>ä¸Šé¢çš„ç­–ç•¥åªæ˜¯å¯¹<code>falcon-judge</code>åšäº†ç«¯å£ç›‘æ§ï¼Œé‚£å¦‚æœæˆ‘ä»¬è¦å¯¹<code>falcon</code>è¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰æœºå™¨åŠ ä¸€äº›è´Ÿè½½ç›‘æ§ï¼Œåº”è¯¥å¦‚ä½•åšå‘¢ï¼Ÿ</li>
<li>åˆ›å»ºä¸€ä¸ª<code>HostGroupï¼šsa.dev.falcon</code>ï¼ŒæŠŠæ‰€æœ‰<code>falcon</code>çš„æœºå™¨éƒ½å¡è¿›å»</li>
<li>åˆ›å»ºä¸€ä¸ªæ¨¡æ¿ï¼š<code>sa.dev.falcon.common</code>ï¼Œæ·»åŠ ä¸€äº›åƒ<code>ping</code>, <code>df.bytes.free.percent</code>, <code>load.5min</code>ç­‰ç­–ç•¥</li>
<li>å°†<code>sa.dev.falcon.common</code>ç»‘å®šåˆ°<code>sa.dev.falcon</code>è¿™ä¸ª<code>HostGroup</code></li>
</ul>
<p><a href="#R-image-5b82481a012ceb5de7fc9f1ab565754c" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template-2.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5b82481a012ceb5de7fc9f1ab565754c"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template-2.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->é…ç½®ç­–ç•¥è¡¨è¾¾å¼<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç­–ç•¥è¡¨è¾¾å¼ï¼Œå³<!-- raw HTML omitted --><code>expression</code></li>
</ul>
<p><a href="#R-image-6c0fcbe09495aacc8ad4da92de0c32e1" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/expressions.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6c0fcbe09495aacc8ad4da92de0c32e1"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/expressions.png"></a></p>
<ul>
<li>
<p>ä¸Šä¾‹ä¸­çš„é…ç½®ä¼ è¾¾å‡ºçš„æ„æ€æ˜¯ï¼š<code>endpoint=aggregator</code>å¹¶ä¸”<code>metric=cpu.busy</code>çš„æ‰€æœ‰çš„ç›‘æ§æŒ‡æ ‡ï¼Œåªè¦è¿ç»­<code>3</code>æ¬¡<code>&gt;= 0.5</code>åˆ™æŠ¥è­¦ç»™<code>falcon-test1</code>&gt; è¿™ä¸ªæŠ¥è­¦ç»„ã€‚</p>
</li>
<li>
<p><code>expression</code>æ— éœ€ç»‘å®šåˆ°<code>HostGroup</code>ï¼Œ<code>enjoy it</code></p>
</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="nodataé…ç½®"><code>Nodata</code>é…ç½®</h3>
<blockquote>
<blockquote>
<ul>
<li>ä½¿ç”¨<code>Nodata</code>ï¼Œéœ€è¦è¿›è¡Œä¸¤ä¸ªé…ç½®: <code>Nodata</code>é…ç½®å’Œç­–ç•¥é…ç½®ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬ä»¥ä¸€ä¸ªä¾‹å­ï¼Œè®²è¿°å¦‚ä½•ä½¿ç”¨<code>Nodata</code>æä¾›çš„æœåŠ¡</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ç”¨æˆ·éœ€æ±‚<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å½“æœºå™¨åˆ†ç»„<code>cop.xiaomi_owt.inf_pdl.falcon</code>ä¸‹çš„æ‰€æœ‰æœºå™¨ï¼Œå…¶é‡‡é›†æŒ‡æ ‡<code>agent.alive</code> ä¸ŠæŠ¥ä¸­æ–­æ—¶ï¼Œé€šçŸ¥ç”¨æˆ·</li>
</ul>
</blockquote>
<ul>
<li><code>nodata</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è¿›å…¥<!-- raw HTML omitted --><code>Nodata</code><!-- raw HTML omitted -->é…ç½®ä¸»é¡µï¼Œå¯ä»¥çœ‹åˆ°<!-- raw HTML omitted --><code>Nodata</code><!-- raw HTML omitted -->é…ç½®åˆ—è¡¨<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-8817273edb38393c43c2161e8519b6f7" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/nodata.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8817273edb38393c43c2161e8519b6f7"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/nodata.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->ç‚¹å‡»å³ä¸Šè§’çš„æ·»åŠ æŒ‰é’®ï¼Œæ·»åŠ <!-- raw HTML omitted --><code>nodata</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-b92c1cd28fe0048695cd71d24c015d97" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/nodata-1.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b92c1cd28fe0048695cd71d24c015d97"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/nodata-1.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->è¿›è¡Œå®Œä¸Šè¿°é…ç½®åï¼Œåˆ†ç»„<!-- raw HTML omitted --><code>cop.xiaomi_owt.inf_pdl.falcon</code><!-- raw HTML omitted -->ä¸‹çš„æ‰€æœ‰æœºå™¨ï¼Œå…¶é‡‡é›†é¡¹<!-- raw HTML omitted --> <code>agent.alive</code>&lt;&gt; font color=red&gt;ä¸ŠæŠ¥ä¸­æ–­åï¼Œ<!-- raw HTML omitted --><code>nodata</code><!-- raw HTML omitted -->æœåŠ¡å°±ä¼šè¡¥å‘ä¸€ä¸ªå–å€¼ä¸º<!-- raw HTML omitted --><code>-1.0</code>ã€<code>agent.alive</code><!-- raw HTML omitted -->&gt; çš„ç›‘æ§æ•°æ®ç»™ç›‘æ§ç³»ç»Ÿ<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ç­–ç•¥é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>é…ç½®äº†<code>Nodata</code>åï¼Œå¦‚æœæœ‰æ•°æ®ä¸ŠæŠ¥ä¸­æ–­çš„æƒ…å†µï¼Œ<code>Nodata</code>é…ç½®ä¸­çš„é»˜è®¤å€¼å°±ä¼šè¢«ä¸ŠæŠ¥ã€‚æˆ‘ä»¬å¯ä»¥é’ˆå¯¹è¿™ä¸ªé»˜è®¤å€¼ï¼Œè®¾ç½®æŠ¥è­¦ï¼›åªè¦æ”¶åˆ°äº†é»˜è®¤å€¼ï¼Œå°±è®¤ä¸ºå‘ç”Ÿäº†æ•°æ®ä¸ŠæŠ¥&gt; çš„ä¸­æ–­ï¼ˆå¦‚æœä½ è®¾ç½®çš„é»˜è®¤å€¼ï¼Œå¯èƒ½ä¸æ­£å¸¸ä¸ŠæŠ¥çš„æ•°æ®ç›¸ç­‰ï¼Œé‚£ä¹ˆè¯·ä¿®æ”¹ä½ çš„<code>Nodata</code>é…ç½®ã€ä½¿é»˜è®¤å€¼æœ‰åˆ«äºæ­£å¸¸å€¼ï¼‰ã€‚å°†æ­¤ç­–ç•¥ï¼Œç»‘å®šåˆ°åˆ†ç»„<code>&gt; cop.xiaomi_owt.inf_pdl.falcon</code>å³å¯ã€‚</li>
</ul>
<p><a href="#R-image-769a54787e65f3de8eeee5cb1dbf26b8" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template-3.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-769a54787e65f3de8eeee5cb1dbf26b8"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/template-3.png"></a></p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æ³¨æ„äº‹é¡¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>é…ç½®åç§°<code>name</code>ï¼Œè¦å…¨å±€å”¯ä¸€ã€‚è¿™æ˜¯ä¸ºäº†æ–¹ä¾¿<code>Nodata</code>é…ç½®çš„ç®¡ç†ã€‚</li>
<li>ç›‘æ§å®ä¾‹<code>endpoint</code>, å¯ä»¥æ˜¯æœºå™¨åˆ†ç»„ã€æœºå™¨åæˆ–è€…å…¶ä»– è¿™ä¸‰ç§ç±»å‹ï¼Œåªèƒ½é€‰æ‹©å…¶ä¸­çš„ä¸€ç§ã€‚åŒä¸€ç±»å‹ï¼Œæ”¯æŒå¤šä¸ªè®°å½•ï¼Œä½†å»ºè®®ä¸è¶…è¿‡5ä¸ªï¼Œå¤šæ¡è®°å½•æ¢è¡Œåˆ†å‰²ã€æ¯è¡Œä¸€æ¡&gt; è®°å½•ã€‚é€‰æ‹©æœºå™¨åˆ†ç»„æ—¶ï¼Œç³»ç»Ÿä¼šå¸®å¿™å±•å¼€æˆå…·ä½“æœºå™¨åï¼Œæ”¯æŒåŠ¨æ€ç”Ÿæ•ˆã€‚ç›‘æ§å®ä½“ä¸æ˜¯æœºå™¨åæ—¶ï¼Œåªèƒ½é€‰æ‹©â€œå…¶ä»–â€ç±»å‹ã€‚</li>
<li>ç›‘æ§æŒ‡æ ‡<code>metric</code>ã€‚</li>
<li>æ•°æ®æ ‡ç­¾<code>tags</code>ï¼Œå¤šä¸ª<code>tag</code>è¦ç”¨é€—å·éš”å¼€ã€‚å¿…é¡»å¡«å†™å®Œæ•´çš„<code>tags</code>ä¸²ï¼Œå› ä¸º<code>nodata</code>ä¼šæŒ‰ç…§æ­¤<code>tags</code>ä¸²ï¼Œå»å®Œå…¨åŒ¹é…ã€ç­›é€‰ç›‘æ§æ•°æŒ‡æ ‡é¡¹ã€‚</li>
<li>æ•°æ®ç±»å‹<code>type</code>ï¼Œåªæ”¯æŒåŸå§‹å€¼ç±»å‹<code>GAUGE</code>ã€‚å› ä¸ºï¼Œ<code>nodata</code>åªåº”è¯¥ç›‘æ§ &ldquo;ç‰¹å¾æŒ‡æ ‡&rdquo;(å¦‚<code>agent.alive</code>)ï¼Œ&ldquo;ç‰¹å¾æŒ‡æ ‡&quot;éƒ½æ˜¯<code>GAUGE</code>ç±»å‹çš„</li>
<li>é‡‡é›†å‘¨æœŸ<code>step</code>ï¼Œå•ä½æ˜¯ç§’ã€‚å¿…é¡»å¡«å†™ å®Œæ•´<code>&amp;</code>çœŸå®<code>step</code>ã€‚è¯¥å­—æ®µä¸å®Œæ•´ æˆ–è€… ä¸çœŸå®ï¼Œå°†ä¼šå¯¼è‡´<code>nodata</code>ç›‘æ§çš„è¯¯æŠ¥ã€æ¼æŠ¥ã€‚</li>
<li>è¡¥å‘å€¼<code>default</code>ï¼Œå¿…é¡»æœ‰åˆ«äºä¸ŠæŠ¥çš„çœŸå®æ•°æ®ã€‚æ¯”å¦‚ï¼Œ<code>cpu.idle</code>çš„å–å€¼èŒƒå›´æ˜¯[0,100]ï¼Œé‚£ä¹ˆå®ƒçš„<code>nodata</code>é»˜è®¤å–å€¼ åªèƒ½å–å°äº<code>0</code>æˆ–è€…å¤§äº<code>100</code>&gt; çš„å€¼ã€‚å¦åˆ™ï¼Œä¼šå‘ç”Ÿè¯¯æŠ¥ã€æ¼æŠ¥</li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="æŠ¥è­¦å‡½æ•°è¯´æ˜">æŠ¥è­¦å‡½æ•°è¯´æ˜</h3>
<blockquote>
<ul>
<li>è¯´æ˜ï¼š<code>#</code>åé¢çš„æ•°å­—çš„æœ€å¤§å€¼ï¼Œå³åœ¨<code>judge</code>å†…å­˜ä¸­ä¿ç•™æœ€è¿‘å‡ ä¸ªç‚¹ï¼Œæ˜¯æ”¯æŒè‡ªå®šä¹‰çš„</li>
</ul>
<blockquote>
<ul>
<li><code>all(#3)</code>: æœ€æ–°çš„<code>3</code>ä¸ªç‚¹éƒ½æ»¡è¶³é˜ˆå€¼æ¡ä»¶åˆ™æŠ¥è­¦</li>
<li><code>max(#3)</code>: å¯¹äºæœ€æ–°çš„<code>3</code>ä¸ªç‚¹ï¼Œå…¶æœ€å¤§å€¼æ»¡è¶³é˜ˆå€¼æ¡ä»¶åˆ™æŠ¥è­¦</li>
<li><code>min(#3)</code>: å¯¹äºæœ€æ–°çš„<code>3</code>ä¸ªç‚¹ï¼Œå…¶æœ€å°å€¼æ»¡è¶³é˜ˆå€¼æ¡ä»¶åˆ™æŠ¥è­¦</li>
<li><code>sum(#3)</code>: å¯¹äºæœ€æ–°çš„<code>3</code>ä¸ªç‚¹ï¼Œå…¶å’Œæ»¡è¶³é˜ˆå€¼æ¡ä»¶åˆ™æŠ¥è­¦</li>
<li><code>avg(#3)</code>: å¯¹äºæœ€æ–°çš„<code>3</code>ä¸ªç‚¹ï¼Œå…¶å¹³å‡å€¼æ»¡è¶³é˜ˆå€¼æ¡ä»¶åˆ™æŠ¥è­¦</li>
<li><code>diff(#3)</code>: æ‹¿æœ€æ–°<code>push</code>ä¸Šæ¥çš„ç‚¹ï¼ˆè¢«å‡æ•°ï¼‰ï¼Œä¸å†å²æœ€æ–°çš„<code>3</code>ä¸ªç‚¹ï¼ˆ<code>3</code>ä¸ªå‡æ•°ï¼‰ç›¸å‡ï¼Œå¾—åˆ°<code>3</code>ä¸ªå·®ï¼Œåªè¦æœ‰ä¸€ä¸ªå·®æ»¡è¶³é˜ˆå€¼æ¡ä»¶åˆ™æŠ¥è­¦</li>
<li><code>pdiff(#3)</code>: æ‹¿æœ€æ–°<code>push</code>ä¸Šæ¥çš„ç‚¹ï¼Œä¸å†å²æœ€æ–°çš„<code>3</code>ä¸ªç‚¹ç›¸å‡ï¼Œå¾—åˆ°<code>3</code>ä¸ªå·®ï¼Œå†å°†<code>3</code>ä¸ªå·®å€¼åˆ†åˆ«é™¤ä»¥å‡æ•°ï¼Œå¾—åˆ°<code>3</code>ä¸ªå•†å€¼ï¼Œåªè¦æœ‰ä¸€ä¸ªå•†å€¼æ»¡è¶³é˜ˆå€¼åˆ™æŠ¥è­¦</li>
<li><code>lookup(#2,3)</code>: æœ€æ–°çš„<code>3</code>ä¸ªç‚¹ä¸­æœ‰<code>2</code>ä¸ªæ»¡è¶³æ¡ä»¶åˆ™æŠ¥è­¦ï¼›</li>
<li><code>stddev(#7) = 3</code>ï¼šç¦»ç¾¤ç‚¹æ£€æµ‹å‡½æ•°ï¼Œå–æœ€æ–°<strong>7</strong>ä¸ªç‚¹çš„æ•°æ®åˆ†åˆ«è®¡ç®—å¾—åˆ°ä»–ä»¬çš„æ ‡å‡†å·®å’Œå‡å€¼ï¼Œåˆ†åˆ«è®¡ä¸º<code>Ïƒ</code>å’Œ<code>Î¼</code>ï¼Œå…¶ä¸­å½“å‰å€¼è®¡ä¸º<code>X</code>ï¼Œé‚£ä¹ˆå½“<code>X</code>è½åœ¨åŒºé—´ [Î¼-3Ïƒ, Î¼+3Ïƒ] ä¹‹å¤–æ—¶ï¼Œåˆ™è®¤ä¸ºå½“å‰å€¼æ³¢åŠ¨è¿‡å¤§ï¼Œè§¦å‘æŠ¥è­¦ï¼›æ›´å¤šè¯·å‚è€ƒ<code>3-sigma</code>ç®—æ³•ï¼šhttps://en.wikipedia.org/wiki/68%E2%80%9395%E2%80%9399.7_ruleã€‚</li>
</ul>
</blockquote>
<ul>
<li>æœ€å¸¸ç”¨çš„å°±æ˜¯<code>all</code>å‡½æ•°äº†ï¼Œæ¯”å¦‚<code>cpu.idle</code> <code>all(#3) &lt; 5</code>ï¼Œè¡¨ç¤º<code>cpu.idle</code>çš„å€¼è¿ç»­<code>3</code>æ¬¡å°äº<code>5%</code>åˆ™æŠ¥è­¦ã€‚</li>
<li><code>lookup</code>ä¸ºéè¿ç»­æ€§æŠ¥è­¦å‡½æ•°ï¼Œé€‚ç”¨äºåœ¨ä¸€å®šèŒƒå›´å†…å®¹å¿ç›‘æ§æŒ‡æ ‡æŠ–åŠ¨çš„åœºæ™¯ï¼Œæ¯”å¦‚æŸä¸ªä¸»æœºçš„<code>cpu.busy</code>å¿½é«˜å¿½ä½ï¼Œä½¿ç”¨<code>all(#1)&gt;80</code>æ˜æ˜¾è¿‡äºä¸¥æ ¼ï¼Œä¼šäº§ç”Ÿå¤§é‡æŠ¥è­¦å¹²æ‰°è§†çº¿ï¼Œä½¿ç”¨<code>all(#3)&gt;80</code>åˆ™è¿ç»­ä¸‰æ¬¡åé«˜çš„æ¦‚ç‡å¾ˆå°ï¼Œå¯èƒ½æ°¸è¿œä¸ä¼šè§¦å‘æŠ¥è­¦ï¼Œä¸èƒ½å¸®åŠ©æˆ‘ä»¬å‘ç°ç³»ç»Ÿçš„ä¸ç¨³å®šï¼Œé‚£ä¹ˆå¦‚æœä½¿ç”¨<code>lookup(#3,5)</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“<code>cpu.busy</code>æœ€è¿‘æŠ–åŠ¨é¢‘ç¹ï¼Œè¶…è¿‡äº†æˆ‘ä»¬å®¹å¿çš„ç•Œçº¿ã€‚</li>
<li>æ–°å¢ <code>stddev</code> å‡½æ•°ï¼ŒåŸºäºé«˜æ–¯åˆ†å¸ƒçš„ç¦»ç¾¤ç‚¹æ£€æµ‹æ–¹å¼ï¼Œæ¯”å¦‚<code>cpu.idle</code> <code>stddev(#5) = 3</code> ï¼Œè¡¨ç¤ºè·å–<code>cpu.idle</code>çš„å†å²<code>5</code>ä¸ªç‚¹æ•°æ®ï¼Œè®¡ç®—å¾—åˆ°ä»–ä»¬çš„æ ‡å‡†å·®å’Œå‡å€¼ï¼Œåˆ†åˆ«è®¡ä¸º<code>Ïƒ</code>å’Œ<code>Î¼</code>ï¼Œçœ‹å…¶æ˜¯å¦åˆ†å¸ƒåœ¨<code>(Î¼-3Ïƒ,Î¼+3Ïƒ)</code>èŒƒå›´ä¹‹å†…ï¼Œå¦‚æœä¸åœ¨èŒƒå›´ä¹‹å†…åˆ™æŠ¥è­¦ã€‚</li>
</ul>
</blockquote>
<hr>
<h3 id="screençš„ä½¿ç”¨"><code>screen</code>çš„ä½¿ç”¨</h3>
<blockquote>
<ul>
<li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>screen</code>æå‰å°†å›¾åƒå®šåˆ¶å¥½ï¼Œè€Œä¸ç”¨æ¯æ¬¡éƒ½å»æœç´¢å‡ºå›¾ï¼Œè¿™æ ·å°±å®ç°äº†ç±»ä¼¼çš„cactiå›¾åƒå±•ç¤ºåŠŸèƒ½ã€‚</li>
</ul>
<p><a href="#R-image-d03022a8fc922294c22c60dae5019c56" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d03022a8fc922294c22c60dae5019c56"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen.jpg"></a></p>
<p><a href="#R-image-781d15c1996fcae1ade1ca009ce49a96" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-falcon.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-781d15c1996fcae1ade1ca009ce49a96"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-falcon.jpg"></a></p>
<p><a href="#R-image-98907549dd0aff62e2bb1532fd942638" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-1.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-98907549dd0aff62e2bb1532fd942638"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-1.jpg"></a></p>
<p><a href="#R-image-d174c6258eb168926aaa848793c33dcc" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-2.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d174c6258eb168926aaa848793c33dcc"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-2.jpg"></a></p>
<p><a href="#R-image-ed64cfbbf2bf127f6d2b0dc6cf058afa" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-3.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ed64cfbbf2bf127f6d2b0dc6cf058afa"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-3.jpg"></a></p>
<p><a href="#R-image-043d667308d0870514555658e9ef14b8" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-4.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-043d667308d0870514555658e9ef14b8"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-4.jpg"></a></p>
<p><a href="#R-image-50261cce1007bf70905a928d92b2a09b" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-5.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-50261cce1007bf70905a928d92b2a09b"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-5.jpg"></a></p>
<p><a href="#R-image-cdcaad447c25a7a2ecbd5274a64b7387" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-6.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cdcaad447c25a7a2ecbd5274a64b7387"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Monitor_Server/Open-Falcon_Server/screen-6.jpg"></a></p>
<p><!-- raw HTML omitted -->æ³¨ï¼š<!-- raw HTML omitted --><code>graph</code><!-- raw HTML omitted -->å¯ä»¥åŠ å¤šä¸ª<!-- raw HTML omitted --></p>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="nosql">Nosql</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Nosql</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_scylladb">Install_Scylladb</h1>

<h2 id="scylladbéƒ¨ç½²"><code>Scylladb</code>éƒ¨ç½²</h2>
<h3 id="å•èŠ‚ç‚¹éƒ¨ç½²scylladb">å•èŠ‚ç‚¹éƒ¨ç½²<code>Scylladb</code></h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.scylladb.com/stable/getting-started/os-support.html" rel="external" target="_self">ç³»ç»Ÿè¦æ±‚</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.scylladb.com/" rel="external" target="_self"><code>ScyllaDB</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.scylladb.com/download/?platform=ubuntu-22.04&version=scylla-5.1#open-source" rel="external" target="_self"><code>ScyllaDB</code>æ–‡æ¡£</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/scylladb/scylladb/" rel="external" target="_self"><code>Github-Scylla</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://docs.scylladb.com/stable/operating-scylla/admin.html#cqlsh-networking" rel="external" target="_self"><code>Scylla</code>ä½¿ç”¨ç«¯å£</a></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>ç«¯å£</th>
<th>åè®®</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>9042</td>
<td><code>TCP</code></td>
<td><code>CQL</code>ã€æœ¬åœ°ä¼ è¾“ç«¯å£ï¼š <code>native_transport_port</code></td>
</tr>
<tr>
<td>9142</td>
<td><code>TCP</code></td>
<td><code>SSL</code> <code>CQL</code>ä½¿ç”¨åŠ å¯†æ–¹å¼ç”±å®¢æˆ·ç«¯åˆ°èŠ‚ç‚¹</td>
</tr>
<tr>
<td>7000</td>
<td><code>TCP</code></td>
<td><code>Inter-node communication</code> (<code>RPC</code>) èŠ‚ç‚¹é—´é€šä¿¡</td>
</tr>
<tr>
<td>7001</td>
<td><code>TCP</code></td>
<td><code>SSL inter-node communication</code> (<code>RPC</code>) ä½¿ç”¨<code>SSL</code>èŠ‚ç‚¹é—´é€šä¿¡</td>
</tr>
<tr>
<td>7199</td>
<td><code>TCP</code></td>
<td><code>JMX management</code>ã€<code>JMX</code>ç®¡ç†</td>
</tr>
<tr>
<td>10000</td>
<td><code>TCP</code></td>
<td><code>Scylla REST API</code></td>
</tr>
<tr>
<td>9180</td>
<td><code>TCP</code></td>
<td><code>Prometheus API</code>æ™®ç½—ç±³ä¿®æ–¯<code>API</code></td>
</tr>
<tr>
<td>9100</td>
<td><code>TCP</code></td>
<td><code>node_exporter</code> (<code>Optionally</code>ï¼šå¯é€‰)</td>
</tr>
<tr>
<td>9160</td>
<td><code>TCP</code></td>
<td><code>Scylla client port</code> (<code>Thrift</code>) <code>Scylla</code>å®¢æˆ·ç«¯ç«¯å£</td>
</tr>
<tr>
<td>19042</td>
<td><code>TCP</code></td>
<td><code>Native shard-aware transport port</code>æœ¬æœºåˆ†ç‰‡æ„ŸçŸ¥ä¼ è¾“ç«¯å£</td>
</tr>
<tr>
<td>19142</td>
<td><code>TCP</code></td>
<td><code>Native shard-aware transport port</code> (<code>ssl</code>) æœ¬æœºåˆ†ç‰‡æ„ŸçŸ¥ä¼ è¾“ç«¯å£ (<code>ssl</code>)</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><code>Install Openjdk 8 or 11</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /etc/apt/keyrings
</span></span><span style="display:flex;"><span>$ gpg --homedir /tmp --no-default-keyring --keyring /etc/apt/keyrings/scylladb.gpg --keyserver hkp://keyserver.ubuntu.com:80Â --recv-keys d0a112e067426ab2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget -O /etc/apt/sources.list.d/scylla.list http://downloads.scylladb.com/deb/debian/scylla-5.1.list</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>scylla</code><!-- raw HTML omitted -->å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ apt-get update
</span></span><span style="display:flex;"><span>$ apt-get install -y scylla </span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ—å‡ºå¯ç”¨å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ apt-cache madison scylla</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¼€å§‹å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ apt-get install scylla<span style="color:#f92672">{</span>,-server,-jmx,-tools,-tools-core,-kernel-conf,-node-exporter,-conf,-python3<span style="color:#f92672">}=</span>4.6.1-0.20220328.2309d6b51-1  	<span style="color:#75715e"># 4.6.1-0.20220328.2309d6b51-1 ä¸ºå®‰è£…åŒ…</span></span></span></code></pre></div><ul>
<li>1.4 <!-- raw HTML omitted -->å°†<!-- raw HTML omitted --><code>Java</code><!-- raw HTML omitted -->è®¾ç½®ä¸º<!-- raw HTML omitted --><code>1.8</code><!-- raw HTML omitted -->ç‰ˆæœ¬<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ apt-get update
</span></span><span style="display:flex;"><span>$ apt-get install -y openjdk-8-jre-headless
</span></span><span style="display:flex;"><span>$ update-java-alternatives --jre-headless -s java-1.8.0-openjdk-amd64</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->è¿è¡Œ<!-- raw HTML omitted --><code>scylla_setup</code><!-- raw HTML omitted -->è„šæœ¬æ¥è°ƒæ•´ç³»ç»Ÿè®¾ç½®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ scylla_setup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to run check your kernel version?
</span></span><span style="display:flex;"><span>Yes - runs a  script to verify that the kernel <span style="color:#66d9ef">for</span> this instance qualifies to run Scylla. No - skips the kernel check.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># æ˜¯å¦æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to verify the ScyllaDB packages are installed?
</span></span><span style="display:flex;"><span>Yes - runs a script to confirm that ScyllaDB is installed. No - skips the installation check.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># æ˜¯å¦éªŒè¯ ScyllaDB è½¯ä»¶åŒ…å·²å®‰è£…</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want the Scylla server service to automatically start when the Scylla node boots?
</span></span><span style="display:flex;"><span>Yes - Scylla server service automatically starts on Scylla node boot. No - skips this step. Note you will have to start the Scylla Server service manually.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># æ˜¯å¦å…è®¸Scyllaå¼€æœºè‡ªå¯</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Created symlink /etc/systemd/system/multi-user.target.wants/scylla-server.service â†’ /lib/systemd/system/scylla-server.service.
</span></span><span style="display:flex;"><span>Do you want to enable Scylla to check <span style="color:#66d9ef">if</span> there is a newer version of Scylla available?
</span></span><span style="display:flex;"><span>Yes - start the Scylla-housekeeping service to check <span style="color:#66d9ef">for</span> a newer version. This check runs periodically. No - skips this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>NO  	<span style="color:#75715e"># æ˜¯å¦æ£€æŸ¥Scylla æ˜¯ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to setup Network Time Protocol<span style="color:#f92672">(</span>NTP<span style="color:#f92672">)</span> to auto-synchronize the current time on the node?
</span></span><span style="display:flex;"><span>Yes - enables time-synchronization. This keeps the correct time on the node. No - skips this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># æ˜¯å¦å¯ç”¨NTPæ—¶é—´åŒæ­¥</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to setup RAID and XFS?
</span></span><span style="display:flex;"><span>It is recommended to use RAID and XFS <span style="color:#66d9ef">for</span> Scylla data. If you <span style="color:#66d9ef">select</span> yes, you will be prompted to choose the unmounted disks to use <span style="color:#66d9ef">for</span> Scylla data. Selected disks are formatted as part of the process.
</span></span><span style="display:flex;"><span>Yes - choose a disk/disks to format and setup <span style="color:#66d9ef">for</span> RAID and XFS. No - skip this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># æ˜¯å¦è®¾ç½®RAIDå’ŒXFS æ˜¯ï¼šå°†ä¼šæ ¼å¼åŒ–ç£ç›˜</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to enable coredumps?
</span></span><span style="display:flex;"><span>Yes - sets up coredump to allow a post-mortem analysis of the Scylla state just prior to a crash. No - skips this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>  	<span style="color:#75715e"># æ˜¯å¦å…è®¸coredumpåœ¨å´©æºƒä¹‹å‰å¯¹ScyllaçŠ¶æ€è¿›è¡Œäº‹ååˆ†æ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to setup a system-wide customized configuration <span style="color:#66d9ef">for</span> Scylla?
</span></span><span style="display:flex;"><span>Yes - setup the sysconfig file. No - skips this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  <span style="color:#75715e"># æ˜¯å¦ä¸ºScyllaè®¾ç½®ç³»ç»ŸèŒƒå›´è‡ªå®šä¹‰é…ç½®</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want IOTune to study your disks IO profile and adapt Scylla to it? <span style="color:#f92672">(</span>*WARNING* Saying NO here means the node will not boot in production mode unless you configure the I/O Subsystem manually!<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Yes - let iotune study my disk<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>. Note that this action will take a few minutes. No - skip this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># æ˜¯å¦è®©IOTuneç ”ç©¶æ‚¨çš„ç£ç›˜IOé…ç½®æ–‡ä»¶å¹¶ä½¿Scyllaé€‚åº”å®ƒï¼Œå¦â€æ„å‘³ç€æ‰‹åŠ¨é…ç½® I/O å­ç³»ç»Ÿï¼Œå¦åˆ™èŠ‚ç‚¹å°†ä¸ä¼šä»¥ç”Ÿäº§æ¨¡å¼å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to set the CPU scaling governor to Performance level on boot?
</span></span><span style="display:flex;"><span>Yes - sets the CPU scaling governor to performance level. No - skip this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># æ˜¯å¦å…è®¸åœ¨å¼•å¯¼æ—¶å°†CPUç¼©æ”¾è°ƒæ§å™¨è®¾ç½®ä¸ºæ€§èƒ½çº§åˆ«</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to enable fstrim service?
</span></span><span style="display:flex;"><span>Yes - runs fstrim on your SSD. No - skip this step.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>yes/NO<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># æ˜¯å¦å¯ç”¨fstrim æœåŠ¡</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Will Scylla be the only service on this host?
</span></span><span style="display:flex;"><span>Answer yes to lock all memory to Scylla, to prevent swapout. Answer no to <span style="color:#66d9ef">do</span> nothing.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>YES  	<span style="color:#75715e"># Scyllaæ˜¯ä¸æ˜¯è¯¥ä¸»æœºä¸Šçš„å”¯ä¸€æœåŠ¡ï¼Œæ˜¯ï¼šå°†å†…å­˜é”å®šåˆ°Scyllaï¼Œä»¥é˜²æ­¢æ¢å‡º</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Do you want to configure rsyslog to send log to a remote repository?
</span></span><span style="display:flex;"><span>Answer yes to setup rsyslog to a remote server, Answer no to <span style="color:#66d9ef">do</span> nothing.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>YES/no<span style="color:#f92672">]</span>no  	<span style="color:#75715e"># æ˜¯å¦é…ç½®rsyslogå°†æ—¥å¿—å‘é€åˆ°è¿œç¨‹å­˜å‚¨åº“</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Scylla</code><!-- raw HTML omitted -->æ•°æ®åº“æœåŠ¡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start scylla-server
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹æ˜¯å¦å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>$ systemctl status scylla-server</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nodetool status
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿è¡Œcqlsh è¿æ¥åˆ°æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ cqlsh
</span></span><span style="display:flex;"><span>$ cqlsh&gt; help  	<span style="color:#75715e"># ä½¿ç”¨helpå¸®åŠ©å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿è¡Œ cassandra-stress</span>
</span></span><span style="display:flex;"><span>$ cqlsh&gt; cassandra-stress write -mode cql3 native</span></span></code></pre></div></blockquote>
<hr>
<h3 id="éƒ¨ç½²scylladbé›†ç¾¤">éƒ¨ç½²<code>Scylladb</code>é›†ç¾¤</h3>
<h4 id="å•æ•°æ®ä¸­å¿ƒscyllaé›†ç¾¤æ¨¡å¼">å•æ•°æ®ä¸­å¿ƒ<code>Scylla</code>é›†ç¾¤æ¨¡å¼</h4>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.scylladb.com/stable/operating-scylla/procedures/cluster-management/create-cluster.html" rel="external" target="_self">åˆ›å»º<code>Scylla</code>é›†ç¾¤ - å•æ•°æ®ä¸­å¿ƒ <code>DC</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="å¤šæ•°æ®ä¸­å¿ƒscyllaé›†ç¾¤æ¨¡å¼">å¤šæ•°æ®ä¸­å¿ƒ<code>Scylla</code>é›†ç¾¤æ¨¡å¼</h4>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.scylladb.com/stable/operating-scylla/procedures/cluster-management/create-cluster-multidc.html" rel="external" target="_self">åˆ›å»º<code>Scylla</code>é›†ç¾¤ - å¤šæ•°æ®ä¸­å¿ƒ <code>DC</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_redis">Install_Redis</h1>

<h2 id="rediså®‰è£…"><code>Redis</code>å®‰è£…</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://download.redis.io/releases/" rel="external" target="_self"><code>Redis</code>å®‰è£…åŒ…</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><code>Redis</code><!-- raw HTML omitted -->ä¾èµ–<!-- raw HTML omitted --><code>gcc</code><!-- raw HTML omitted -->ä¸<!-- raw HTML omitted --><code>gcc-c++</code><!-- raw HTML omitted -->ï¼Œè€Œ<!-- raw HTML omitted --><code>Redis5.0</code><!-- raw HTML omitted -->ä»¥ä¸Šéœ€è¦æ›´é«˜ç‰ˆæœ¬<!-- raw HTML omitted --><code>gcc</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Gcc</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Debianç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>$ sudo apt-get install wget gcc make pkg-config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install gcc gcc-c++ centos-release-scl wget git</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å®‰è£…é«˜ç‰ˆæœ¬<!-- raw HTML omitted --><code>gcc</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸´æ—¶ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;scl enable devtoolset-9 bash&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ åˆ°ç¯å¢ƒå˜é‡æ°¸ä¹…ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;source /opt/rh/devtoolset-9/enable&#34;</span> &gt;&gt;/etc/profile
</span></span><span style="display:flex;"><span>$ source /etc/profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;scl enable devtoolset-9 bash&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span style="display:flex;"><span>$ source ~/.bashrc   <span style="color:#75715e"># ä½¿æ›´æ”¹ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¦‚æœå‡ºç°ä¸èƒ½è·³è½¬rootæ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>$ sudo scl enable devtoolset-9 bash</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Redis</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½<!-- raw HTML omitted --><code>tar</code><!-- raw HTML omitted -->åŒ…åˆ°æŒ‡å®šç›®å¹¶è§£å‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://download.redis.io/releases/redis-6.2.6.tar.gz  	<span style="color:#75715e"># ä¸‹è½½åˆ°æŒ‡å®šç›®å½•</span>
</span></span><span style="display:flex;"><span>$ sudo wget -P /usr/local/src/ https://download.redis.io/redis-stable.tar.gz</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è§£å‹åˆ°æŒ‡å®šç›®å½•å¹¶é‡å‘½å<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /usr/local/redis <span style="color:#f92672">&amp;&amp;</span> tar zxvf /usr/local/src/redis-6.2.6.tar.gz -C /usr/local/redis --strip-components <span style="color:#ae81ff">1</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>redis</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/redis
</span></span><span style="display:flex;"><span>$ make MALLOC<span style="color:#f92672">=</span>libc BUILD_TLS<span style="color:#f92672">=</span>yes  	<span style="color:#75715e"># æœ‰äº›ç‰ˆæœ¬æˆ–è€…äº‘éœ€è¦ BUILD_TLS=yes å‚æ•°</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ‰§è¡Œå®‰è£…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ make PREFIX<span style="color:#f92672">=</span>/usr/local/redis install </span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --><code>daemonize</code><!-- raw HTML omitted -->å‚æ•°èƒ½åå°å¯åŠ¨ä»¥åŠä½¿ç”¨å¯†ç è¿æ¥<!-- raw HTML omitted --><!-- raw HTML omitted -->æ³¨é‡Šä¸å¯ä»¥åœ¨è¡Œå°¾<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;# redisåå°è¿è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">daemonize yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Redisçš„pidæ–‡ä»¶å­˜æ”¾ä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pidfile /usr/local/redis/logs/redis_6379.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Redisçš„æ—¥å¿—æ–‡ä»¶å­˜æ”¾ä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">logfile /usr/local/redis/logs/redis_6379.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç«¯å£å·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port 6379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æœ€å¥½æ˜¯æœ¬æœºIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">bind 192.168.176.131
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è¶…æ—¶æ—¶é—´300ç§’ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">timeout 300
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç¼“å­˜åº“çš„ä¸ªæ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">databases 8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å°†æ•°æ®åº“è½¬å‚¨åˆ°çš„æ–‡ä»¶å
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dbfilename dump-16379.db
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ•°æ®å­˜æ”¾ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dir /opt/data/redis/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¸»åº“å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">masterauth password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è¿æ¥å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">requirepass password &#39;</span>&gt; /usr/local/redis/redis.conf</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Redis</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/redis/bin/redis-server /usr/local/redis/redis.conf</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç¼–å†™å¸¸è§„å¯åŠ¨æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;#!/bin/sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Simple Redis init.d script conceived to work on Linux systems
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># as it does use of the /proc filesystem.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># chkconfig:   2345 90 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># description:  Redis is a persistent key-value database
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">REDISPORT=6379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EXEC=/usr/local/redis/bin/redis-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CLIEXEC=/usr/local/redis/bin/redis-cli
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$CLIEXEC -a &#34;Redis&#34; -p $REDISPORT shutdown
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PIDFILE=/var/run/redis_${REDISPORT}.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CONF=&#34;/usr/local/redis/redis.conf&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">case &#34;$1&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  if [ -f $PIDFILE ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;$PIDFILE exists, process is already running or crashed&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Starting Redis server...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          $EXEC $CONF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  if [ ! -f $PIDFILE ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;$PIDFILE does not exist, process is not running&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          PID=$(cat $PIDFILE)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Stopping ...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          $CLIEXEC -p $REDISPORT shutdown
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          while [ -x /proc/${PID} ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              echo &#34;Waiting for Redis to shutdown ...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              sleep 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          echo &#34;Redis stopped&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">*)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  echo &#34;Please use start or stop as first argument&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">esac&#39;</span> &gt; /etc/init.d/redis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chmod +x /etc/init.d/redis
</span></span><span style="display:flex;"><span>$ chkconfig redis on
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨å¹¶æŸ¥çœ‹ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>$ service redis start
</span></span><span style="display:flex;"><span>$ netstat -nuplt | grep <span style="color:#ae81ff">6379</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ç¼–å†™æŒ‡å®šç›®å½•å¯åŠ¨æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;## ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">REDIS_PATH=&#34;/opt/apps/redis&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sql_conf_dir=&#39;</span>/opt/apps/redis<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sql_conf_file=$(ls $sql_conf_dir/* |egrep conf$)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sql_user=&#39;</span>admin<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_redis(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  sql_pid=$(ps -ef |egrep redis-server |egrep -v root |awk &#39;</span><span style="color:#f92672">{</span>print $2<span style="color:#f92672">}</span><span style="color:#e6db74">&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  [ ! -z ${sql_pid} ] &amp;&amp; echo -e &#34;\n\033[31mredis running...\033[0m\n&#34; &amp;&amp; exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  su ${sql_user} -s /bin/bash -c &#34;${REDIS_PATH}/bin/redis-server ${sql_conf_file}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">stop_redis(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  sql_pid=$(ps -ef |egrep redis-server |egrep -v root |awk &#39;</span><span style="color:#f92672">{</span>print $2<span style="color:#f92672">}</span><span style="color:#e6db74">&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  [ -z ${sql_pid} ] &amp;&amp; echo -e &#34;\n\033[31mredis not run...\033[0m\n&#34; &amp;&amp; exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  su swadmin -s /bin/bash -c &#34;kill ${sql_pid}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">### Finally the input handling.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">case &#34;$1&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  start_redis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  stop_redis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">*)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  echo &#34;Usage: service redis {start|stop}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">esac
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">exit &#39;</span>&gt; /etc/init.d/redis
</span></span><span style="display:flex;"><span>$ chmod +x /etc/init.d/redis
</span></span><span style="display:flex;"><span>$ chkconfig redis on</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->éƒ¨ç½²è„šæœ¬<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;redis-install.sh<span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#34;N;56isource /opt/rh/devtoolset-9/enable&#34;  /etc/profile  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">id swadmin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ $? -ne 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åˆ›å»ºæ™®é€šç”¨æˆ·éƒ¨ç½²è¿è¡ŒRedis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">groupadd swadmin &amp;&amp; useradd -g swadmin swadmi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;20210623@123&#34;|passwd --stdin2 swadmin &amp;&gt;/dev/null   # ç»™swadminç”¨æˆ·è®¾ç½®å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mkdir -p /opt/{src,conf,data,apps} /opt/data/{data_17693,data_17694,data_17695,data_16303}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">chown -R swadmin. /opt/* 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;#####   Start/Stop Service   #####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Cmnd_Alias SWADMIN_START_SERVICES = /etc/init.d/redis, /opt/*  # æˆäºˆæ™®é€šç”¨æˆ·å¯åŠ¨åœæ­¢æƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">swadmin ALL=(ALL)NOPASSWD:SWADMIN_START_SERVICES&#34; &gt;/etc/sudoers.d/swadmin 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">chmod 660 /etc/sudoers.d/swadmin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Redisä¾èµ–gcc ä¸gcc-c++,#Redis5.0ä»¥ä¸Šéœ€è¦é«˜ç‰ˆæœ¬gcc  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum -y install gcc gcc-c++ centos-release-scl wget git
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#39;scl enable devtoolset-9 bash&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;source /opt/rh/devtoolset-9/enable&#34; &gt;&gt;/etc/profile
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">source /etc/profile
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¦‚é‡å› ç¼ºå°‘gccæŠ¥é”™å…ˆæ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## make distclean å†meke
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">su swadmin -c &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">git clone https://admin:&#34;frTd3KbJct_pgoBstA5f&#34;@gitlab.com/usererge/redis-conf.git /opt/conf/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wget -P /opt/src/ http://download.redis.io/releases/redis-5.0.7.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mkdir -p /opt/apps/redis &amp;&amp; tar zxvf /opt/src/redis-5.0.7.tar.gz -C /opt/apps/redis --strip-components 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd /opt/apps/redis/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">make MALLOC=libc 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">make PREFIX=/opt/apps/redis install
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/redis/src/redis-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/conf/redis-conf/re_17693.conf &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">source /etc/profile  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_redis_cluster">Install_Redis_Cluster</h1>

<h2 id="redisé›†ç¾¤éƒ¨ç½²"><code>Redis</code>é›†ç¾¤éƒ¨ç½²</h2>
<h3 id="redisä¸»ä»æ¨¡å¼"><code>Redis</code>ä¸»ä»æ¨¡å¼</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å•èŠ‚ç‚¹<!-- raw HTML omitted -->ä¸»ä»æ¨¡å¼éœ€è¦ä¿®æ”¹<!-- raw HTML omitted -->ç«¯å£<!-- raw HTML omitted -->ä»¥åŠé…ç½®æ–‡ä»¶</li>
<li><!-- raw HTML omitted -->ä¸»èŠ‚ç‚¹<!-- raw HTML omitted --><code>redis.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>daemonize yes  	<span style="color:#75715e"># redisåå°è¿è¡Œ</span>
</span></span><span style="display:flex;"><span>pidfile /usr/local/redis/logs/redis_6379.pid  	<span style="color:#75715e"># Redisçš„pidæ–‡ä»¶å­˜æ”¾ä½ç½®</span>
</span></span><span style="display:flex;"><span>logfile /usr/local/redis/logs/redis_6379.log  	<span style="color:#75715e"># Redisçš„æ—¥å¿—æ–‡ä»¶å­˜æ”¾ä½ç½®</span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">6379</span>  	<span style="color:#75715e"># ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>bind 192.168.176.131  	<span style="color:#75715e"># æœ€å¥½æ˜¯æœ¬æœºIP</span>
</span></span><span style="display:flex;"><span>timeout <span style="color:#ae81ff">300</span>  	<span style="color:#75715e"># è¶…æ—¶æ—¶é—´300ç§’                                        </span>
</span></span><span style="display:flex;"><span>databases <span style="color:#ae81ff">8</span>  	<span style="color:#75715e"># ç¼“å­˜åº“çš„ä¸ªæ•° </span>
</span></span><span style="display:flex;"><span>dbfilename dump-16379.db  	<span style="color:#75715e"># å°†æ•°æ®åº“è½¬å‚¨åˆ°çš„æ–‡ä»¶å</span>
</span></span><span style="display:flex;"><span>dir ./  	<span style="color:#75715e"># æ•°æ®å­˜æ”¾ç›®å½•</span>
</span></span><span style="display:flex;"><span>masterauth password  	<span style="color:#75715e"># ä¸»åº“å¯†ç </span>
</span></span><span style="display:flex;"><span>requirepass password  	<span style="color:#75715e"># ç™»å½•è¿æ¥å¯†ç </span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä»èŠ‚ç‚¹<!-- raw HTML omitted --><code>redis.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶ï¼Œç¬¬äºŒå°ä»èŠ‚ç‚¹ä¿®æ”¹ï¼š<!-- raw HTML omitted --><code>bind</code><!-- raw HTML omitted -->ä¸ºè‡ªå·±æœåŠ¡å™¨æœ¬èº«<!-- raw HTML omitted --><code>ip</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>daemonize yes  	<span style="color:#75715e"># redisåå°è¿è¡Œ</span>
</span></span><span style="display:flex;"><span>pidfile /usr/local/redis/logs/redis_6379.pid  	<span style="color:#75715e"># ä¸åŒå®ä¾‹ä¿®æ”¹ä¸ºå¯¹åº”pidæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>logfile /usr/local/redis/logs/redis_6379.log
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>bind 192.168.176.132
</span></span><span style="display:flex;"><span>timeout <span style="color:#ae81ff">300</span>
</span></span><span style="display:flex;"><span>databases <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>dbfilename dump-16379.db
</span></span><span style="display:flex;"><span>dir ./  	<span style="color:#75715e"># æ•°æ®å­˜æ”¾ç›®å½•</span>
</span></span><span style="display:flex;"><span>masterauth <span style="color:#ae81ff">123456</span>  	<span style="color:#75715e"># å¡«å†™ä¸»åº“å¯†ç </span>
</span></span><span style="display:flex;"><span>requirepass <span style="color:#ae81ff">123456</span>  	<span style="color:#75715e"># ç™»å½•è¿æ¥å¯†ç </span>
</span></span><span style="display:flex;"><span>slaveof 192.168.176.131 <span style="color:#ae81ff">6379</span>  	<span style="color:#75715e"># è¿æ¥çš„ä¸»åº“IPå’Œç«¯å£å·</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="redis-clusteræ¨¡å¼"><code>Redis Cluster</code>æ¨¡å¼</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é›†ç¾¤æ¨¡å¼æœ€å°‘6ä¸ªèŠ‚ç‚¹<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dir /usr/local/redis-cluster/data/redis-6379  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºå¯¹åº”å®ä¾‹æ•°æ®å­˜æ”¾ç›®å½•</span>
</span></span><span style="display:flex;"><span>pidfile /usr/local/redis-cluster/logs/redis_6379.pid  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºå¯¹åº”å®ä¾‹ï¼šPid</span>
</span></span><span style="display:flex;"><span>logfile /usr/local/redis-cluster/logs/redis_6379.log  	<span style="color:#75715e"># ä¿®æ”¹ä¸ºå¯¹åº”å®ä¾‹ </span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">6379</span>  	<span style="color:#75715e"># ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>cluster-enabled yes  	<span style="color:#75715e"># å¼€å¯é›†ç¾¤æ¨¡å¼ï¼ŒæŠŠæ³¨é‡Š#å»æ‰</span>
</span></span><span style="display:flex;"><span>cluster-config-file /usr/local/redis-cluster/conf/redis_16379.conf  	<span style="color:#75715e"># ä¸åŒå®ä¾‹ä¿®æ”¹ä¸ºå¯¹åº”</span>
</span></span><span style="display:flex;"><span>cluster-node-timeout <span style="color:#ae81ff">10000</span>  	<span style="color:#75715e"># è¯·æ±‚è¶…æ—¶ï¼Œè®¾ç½®10ç§’</span>
</span></span><span style="display:flex;"><span>appendonly yes  	<span style="color:#75715e"># aofæ—¥å¿—å¼€å¯ï¼Œæœ‰éœ€è¦å°±å¼€å¯ï¼Œå®ƒä¼šæ¯æ¬¡å†™æ“ä½œéƒ½è®°å½•ä¸€æ¡æ—¥å¿—</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>Redis5.0</code><!-- raw HTML omitted -->ä»¥ä¸Šç‰ˆæœ¬ä½¿ç”¨<!-- raw HTML omitted --><code>Redis-cli</code><!-- raw HTML omitted -->å®¢æˆ·ç«¯éƒ¨ç½²<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->éƒ¨ç½²é›†ç¾¤éœ€è¦<!-- raw HTML omitted --><!-- raw HTML omitted -->é˜²ç«å¢™å¼€æ”¾é›†ç¾¤ç«¯å£<!-- raw HTML omitted --><!-- raw HTML omitted -->äº’é€šå¦‚ç«¯å£æ˜¯ï¼š<!-- raw HTML omitted --><code>6379</code> <!-- raw HTML omitted -->é›†ç¾¤ç«¯å£å°±æ˜¯ï¼š<!-- raw HTML omitted --><code>16379</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/apps/redis/bin/redis-cli -a password --cluster create --cluster-replicas <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> 192.168.213.128:6379 192.168.213.128:6380 192.168.213.128:6381 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> 192.168.213.129:6379 192.168.213.129:6380 192.168.213.129:6381</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è„šæœ¬éƒ¨ç½²<!-- raw HTML omitted --><code>Redis-Cluster</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;#!bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pkill redis-server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd /opt/conf/redis-conf/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#39;</span>s/^#cluster-enabled/cluster-enabled/<span style="color:#e6db74">&#39; re_17693.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cat re_17693.conf |tee re_1769{4..5}.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">chown -R swadmin. *
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#34;s/17693/17694/g&#34; re_17694.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#34;s/17693/17695/g&#34; re_17695.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17693.conf &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17694.conf &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17695.conf &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --permanent --new-ipset=redis_whitelist --type=hash:ip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --permanent --add-rich-rule &#39;</span>rule family<span style="color:#f92672">=</span>ipv4 source ipset<span style="color:#f92672">=</span>redis_whitelist port protocol<span style="color:#f92672">=</span>tcp port<span style="color:#f92672">=</span>27693-27695 accept<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --permanent --add-rich-rule &#39;</span>rule family<span style="color:#f92672">=</span>ipv4 source ipset<span style="color:#f92672">=</span>redis_whitelist port protocol<span style="color:#f92672">=</span>tcp port<span style="color:#f92672">=</span>17693-17695 accept<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">read -p &#34;è¯·è¾“å…¥å¯¹æ–¹æœåŠ¡å™¨IP:&#34; IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --permanent --ipset=redis_whitelist --add-entry=$IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">firewall-cmd --reload
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#echo &#39;</span>yes<span style="color:#e6db74">&#39; |/opt/apps/redis/bin/redis-cli -a \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9tN6GFGK60Jk8BNkBJM611GwA66uDFeG \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--cluster create --cluster-replicas 1 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.213.128:17693  192.168.213.128:17694 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.213.128:17695  192.168.213.129:17693 \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.213.129:17694  192.168.213.129:17695  #åˆ›å»ºé›†ç¾¤å‘½ä»¤æ ¹æ®IPå’Œç«¯å£ä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>&gt;redis-cluster.sh</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="dockeréƒ¨ç½²redisé›†ç¾¤"><code>docker</code>éƒ¨ç½²<code>Redis</code>é›†ç¾¤</h3>
<ul>
<li>
<ol>
<li><a href="https://www.jianshu.com/p/b7dea62bcd8b" rel="external" target="_self"><code>Docker</code>æ–¹å¼éƒ¨ç½²<code>redis-cluster</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;docker-install-redis-cluster.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#------------ bootstrap the cluster nodes --------------------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_cmd=&#39;redis-server --port 6379 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000 --appendonly yes --masterauth Redis --requirepass Redis&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">redis_image=&#39;redis:5.0-rc&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">network_name=&#39;redis_cluster_net&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker network create $network_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo $network_name &#34; created&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#---------- create the cluster ------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for port in `seq 6379 6384`; do \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker run -d --name &#34;redis-&#34;$port -p $port:6379 --net $network_name $redis_image $start_cmd;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;created redis cluster node redis-&#34;$port
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cluster_hosts=&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for port in `seq 6379 6384`; do \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hostip=`docker inspect -f &#39;{{(index .NetworkSettings.Networks &#34;redis_cluster_net&#34;).IPAddress}}&#39; &#34;redis-&#34;$port`;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;IP for cluster node redis-&#34;$port &#34;is&#34; $hostip
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cluster_hosts=&#34;$cluster_hosts$hostip:6379 &#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;cluster hosts &#34;$cluster_hosts
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;creating cluster....&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#39;yes&#39; | docker run -i --rm --restart=always -v /etc/localtime:/etc/localtime --net $network_name $redis_image redis-cli  -a Redis --cluster create $cluster_hosts --cluster-replicas 1;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="redis-50ä»¥ä¸‹ç‰ˆæœ¬"><code>Redis 5.0</code>ä»¥ä¸‹ç‰ˆæœ¬</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.myfreax.com/how-to-install-ruby-on-centos-7/" rel="external" target="_self">å¦‚ä½•åœ¨<code>CentOS 7</code>ä¸Šå®‰è£…<code>Ruby</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.jianshu.com/p/e4847f3926d1" rel="external" target="_self"><code>CentOS 7</code>å®‰è£…<code>Ruby on Rails</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/xuliangxing/p/7132656.html" rel="external" target="_self"><code>Linux</code>å®‰è£…<code>Ruby</code>è¯¦è§£(åœ¨çº¿å’Œç¦»çº¿å®‰è£…)</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/tommy-huang/p/7279796.html" rel="external" target="_self"><code>CentOS 7</code>é€šè¿‡<code>RVM</code>æ¥å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„<code>Ruby</code></a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="å®‰è£…ruby">å®‰è£…<code>Ruby</code></h4>
<blockquote>
<ul>
<li><code>Redis 5.0</code>ä»¥ä¸‹ç‰ˆæœ¬ä½¿ç”¨<code>Ruby</code>æ–¹å¼å®‰è£…<code>Redis</code>é›†ç¾¤</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum install gcc-c++ patch readline readline-devel zlib zlib-devel libyaml-devel libffi-devel openssl-devel make bzip2 autoconf automake libtool bison iconv-devel -y   #å®‰è£…ä¾èµ–åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gpg2 --keyserver hkp://keys.gnupg.net --recv-keys D39DC0E3    #å®‰è£…RVM
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">curl -sSL https://rvm.io/mpapis.asc | gpg2 --import -
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">curl -sSL https://rvm.io/pkuczynski.asc | gpg2 --import -
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">curl -L get.rvm.io | bash -s stable
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">source /etc/profile.d/rvm.sh    #è®¾å®šrvmç¯å¢ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm -v          #æŸ¥çœ‹æ˜¯å¦å®‰è£…æ­£å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm list known  #æŸ¥è¯¢å½“å‰Rubyçš„ç‰ˆæœ¬åˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm install 2.4.6   #å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Ruby
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ruby -v             #æµ‹è¯•æ˜¯å¦æˆåŠŸ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm use 2.4.6  --default     #åœ¨å®‰è£…å¤šä¸ªç‰ˆæœ¬rubyç¯å¢ƒä¸‹æŒ‡å®šé»˜è®¤ç‰ˆæœ¬ï¼šè¿™é‡Œè®²2.4.6 ä½œä¸ºé»˜è®¤rubyç‰ˆæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rvm system --default    #ä½¿ç”¨ä¼šç³»ç»Ÿé»˜è®¤ç‰ˆæœ¬Ruby
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gem install redis       å‡†å¤‡rubygem redisä¾èµ–
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span> &gt;install-ruby.sh</span></span></code></pre></div></blockquote>
<hr>
<h4 id="æ‹·è´redis-tribrbåˆ°é›†ç¾¤æ ¹ç›®å½•">æ‹·è´<code>redis-trib.rb</code>åˆ°é›†ç¾¤æ ¹ç›®å½•</h4>
<blockquote>
<ul>
<li><code>redis-trib.rb</code> æ˜¯<code>redis</code>å®˜æ–¹æ¨å‡ºçš„ç®¡ç†<code>redis</code>é›†ç¾¤ çš„å·¥å…·ï¼Œé›†æˆåœ¨<code>redis</code>çš„æºç <code>src</code>ç›®å½•ä¸‹ï¼Œå°†åŸºäº <code>redis</code>æä¾›çš„ é›†ç¾¤å‘½ä»¤ å°è£…æˆ ç®€å•ã€ä¾¿æ·ã€å®ç”¨ çš„ æ“ä½œå·¥å…·</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp /opt/apps/redis/src/redis-trib.rb /opt/apps/redis/</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>redis-trib.rb</code><!-- raw HTML omitted -->å‘½ä»¤ç¯å¢ƒæ˜¯å¦æ­£ç¡®ï¼Œè¾“å‡ºå¦‚ä¸‹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./redis-trib.rb 
</span></span><span style="display:flex;"><span>Usage: redis-trib &lt;command&gt; &lt;options&gt; &lt;arguments ...&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  create          host1:port1 ... hostN:portN
</span></span><span style="display:flex;"><span>                  --replicas &lt;arg&gt;
</span></span><span style="display:flex;"><span>  check           host:port
</span></span><span style="display:flex;"><span>  info            host:port
</span></span><span style="display:flex;"><span>  fix             host:port
</span></span><span style="display:flex;"><span>                  --timeout &lt;arg&gt;
</span></span><span style="display:flex;"><span>  reshard         host:port
</span></span><span style="display:flex;"><span>                  --from &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --to &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --slots &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --yes
</span></span><span style="display:flex;"><span>                  --timeout &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --pipeline &lt;arg&gt;
</span></span><span style="display:flex;"><span>  rebalance       host:port
</span></span><span style="display:flex;"><span>                  --weight &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --auto-weights
</span></span><span style="display:flex;"><span>                  --use-empty-masters
</span></span><span style="display:flex;"><span>                  --timeout &lt;arg&gt;
</span></span><span style="display:flex;"><span>                  --simulate
</span></span><span style="display:flex;"><span>                  --pipeline &lt;arg&gt;</span></span></code></pre></div><ul>
<li><code>redis-trib.rb</code><!-- raw HTML omitted -->æ˜¯<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->ä½œè€…ç”¨<!-- raw HTML omitted --><code>ruby</code><!-- raw HTML omitted -->å®Œæˆçš„ã€‚<!-- raw HTML omitted --><code>redis-trib.rb</code><!-- raw HTML omitted -->å‘½ä»¤è¡Œå·¥å…· çš„å…·ä½“åŠŸèƒ½å¦‚ä¸‹:  <!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>create</code></td>
<td>åˆ›å»ºé›†ç¾¤</td>
</tr>
<tr>
<td><code>check</code></td>
<td>æ£€æŸ¥é›†ç¾¤</td>
</tr>
<tr>
<td><code>info</code></td>
<td>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</td>
</tr>
<tr>
<td><code>fix</code></td>
<td>ä¿®å¤é›†ç¾¤</td>
</tr>
<tr>
<td><code>reshard</code></td>
<td>åœ¨çº¿è¿ç§»<code>slot</code></td>
</tr>
<tr>
<td><code>rebalance</code></td>
<td>å¹³è¡¡é›†ç¾¤èŠ‚ç‚¹<code>slot</code>æ•°é‡</td>
</tr>
<tr>
<td><code>add-node</code></td>
<td>å°†æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</td>
</tr>
<tr>
<td><code>del-node</code></td>
<td>ä»é›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹</td>
</tr>
<tr>
<td><code>set-timeout</code></td>
<td>è®¾ç½®é›†ç¾¤èŠ‚ç‚¹é—´å¿ƒè·³è¿æ¥çš„è¶…æ—¶æ—¶é—´</td>
</tr>
<tr>
<td><code>call</code></td>
<td>åœ¨é›†ç¾¤å…¨éƒ¨èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤</td>
</tr>
<tr>
<td><code>import</code></td>
<td>å°†å¤–éƒ¨<code>redis</code>æ•°æ®å¯¼å…¥é›†ç¾¤</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->è¿è¡Œå‘½ä»¤å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17693.conf &amp;
</span></span><span style="display:flex;"><span>$ /opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17694.conf &amp;
</span></span><span style="display:flex;"><span>$ /opt/apps/redis/bin/redis-server /opt/conf/redis-conf/re_17695.conf &amp;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åœ¨æ¯ä¸ª<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->èŠ‚ç‚¹çš„<!-- raw HTML omitted --><code>redis.conf</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬éƒ½é…ç½®äº†<!-- raw HTML omitted --><code>cluster-config-file</code><!-- raw HTML omitted -->çš„æ–‡ä»¶è·¯å¾„ï¼Œé›†ç¾¤å¯åŠ¨æ—¶<!-- raw HTML omitted --><code>conf</code><!-- raw HTML omitted -->ç›®å½•ä¼šæ–°ç”Ÿæˆ é›†ç¾¤ èŠ‚ç‚¹é…ç½®æ–‡ä»¶ã€‚æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨å¦‚ä¸‹ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install tree
</span></span><span style="display:flex;"><span>$ tree -L <span style="color:#ae81ff">3</span> .
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>â”œâ”€â”€ bin
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ redis-benchmark
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ redis-check-aof
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ redis-check-rdb
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ redis-cli
</span></span><span style="display:flex;"><span>â”‚   â”œâ”€â”€ redis-sentinel -&gt; redis-server
</span></span><span style="display:flex;"><span>â”‚   â””â”€â”€ redis-server
</span></span><span style="display:flex;"><span>â”œâ”€â”€ nodes-6379.conf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ redis.conf
</span></span><span style="display:flex;"><span>â””â”€â”€ redis-trib.rb</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->é…ç½®å¯†ç <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /usr/local/rvm/gems/ruby-2.4.6/gems/redis-4.1.3/lib/redis/client.rb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># frozen_string_literal: true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>require_relative <span style="color:#e6db74">&#34;errors&#34;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#34;socket&#34;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#34;cgi&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>class Redis
</span></span><span style="display:flex;"><span>class Client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> DEFAULTS <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   :url <span style="color:#f92672">=</span>&gt; lambda <span style="color:#f92672">{</span> ENV<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;REDIS_URL&#34;</span><span style="color:#f92672">]</span> <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>   :scheme <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;redis&#34;</span>,
</span></span><span style="display:flex;"><span>   :host <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
</span></span><span style="display:flex;"><span>   :port <span style="color:#f92672">=</span>&gt; 6379,
</span></span><span style="display:flex;"><span>   :path <span style="color:#f92672">=</span>&gt; nil,
</span></span><span style="display:flex;"><span>   :timeout <span style="color:#f92672">=</span>&gt; 5.0,
</span></span><span style="display:flex;"><span>   :password <span style="color:#f92672">=</span>&gt; Redis,  	<span style="color:#75715e"># é…ç½®å¯†ç </span>
</span></span><span style="display:flex;"><span>   :db <span style="color:#f92672">=</span>&gt; 0,
</span></span><span style="display:flex;"><span>   :driver <span style="color:#f92672">=</span>&gt; nil,
</span></span><span style="display:flex;"><span>   :id <span style="color:#f92672">=</span>&gt; nil,
</span></span><span style="display:flex;"><span>   :tcp_keepalive <span style="color:#f92672">=</span>&gt; 0,
</span></span><span style="display:flex;"><span>   :reconnect_attempts <span style="color:#f92672">=</span>&gt; 1,
</span></span><span style="display:flex;"><span>   :reconnect_delay <span style="color:#f92672">=</span>&gt; 0,
</span></span><span style="display:flex;"><span>   :reconnect_delay_max <span style="color:#f92672">=</span>&gt; 0.5,
</span></span><span style="display:flex;"><span>   :inherit_socket <span style="color:#f92672">=</span>&gt; false
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>redis-trib</code><!-- raw HTML omitted -->å…³è”é›†ç¾¤èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŒ‰ç…§ä»ä¸»åˆ°ä»çš„æ–¹å¼ä»å·¦åˆ°å³ä¾æ¬¡æ’åˆ— 6 ä¸ª<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->èŠ‚ç‚¹ï¼Œå¦‚æœä¸é€šä¸¤ä¸ªé—®é¢˜ï¼šå¯†ç ã€é˜²ç«å¢™<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;yes&#39;</span>|./redis-trib.rb create --replicas <span style="color:#ae81ff">1</span> 192.168.176.142:6379 192.168.176.143:6379 192.168.176.144:6379 192.168.176.145:6379 192.168.176.142:6380 192.168.176.143:6380 192.168.176.144:6380 192.168.176.145:6380  
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Creating cluster
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing hash slots allocation on <span style="color:#ae81ff">8</span> nodes...
</span></span><span style="display:flex;"><span>Using <span style="color:#ae81ff">4</span> masters:
</span></span><span style="display:flex;"><span>192.168.176.142:6379
</span></span><span style="display:flex;"><span>192.168.176.143:6379
</span></span><span style="display:flex;"><span>192.168.176.144:6379
</span></span><span style="display:flex;"><span>192.168.176.145:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.176.143:6380 to 192.168.176.142:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.176.142:6380 to 192.168.176.143:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.176.145:6380 to 192.168.176.144:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.176.144:6380 to 192.168.176.145:6379
</span></span><span style="display:flex;"><span>M: 157bd250dd382b95a9289d8b44fd2cfd466fea98 192.168.176.142:6379
</span></span><span style="display:flex;"><span>   slots:0-4095 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>M: c6df79e7c60c03921b69e4d4342507e8d4d2afbd 192.168.176.143:6379
</span></span><span style="display:flex;"><span>   slots:4096-8191 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>M: a463232f96c66cd7f27395253b65d0be8909656e 192.168.176.144:6379
</span></span><span style="display:flex;"><span>   slots:8192-12287 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>M: 44b244a188185835b42d4489eac614e7f81b4cf8 192.168.176.145:6379
</span></span><span style="display:flex;"><span>   slots:12288-16383 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>S: 1cafdeeb6cb52bb96dd16ac84d2242f59973f83a 192.168.176.142:6380
</span></span><span style="display:flex;"><span>   replicates c6df79e7c60c03921b69e4d4342507e8d4d2afbd
</span></span><span style="display:flex;"><span>S: a6d87fb995f3f5e98e2a09f4b5a3078f7221a257 192.168.176.143:6380
</span></span><span style="display:flex;"><span>   replicates 157bd250dd382b95a9289d8b44fd2cfd466fea98
</span></span><span style="display:flex;"><span>S: 31a3f0b03244d30bbc7e47acc0ec06d327b62860 192.168.176.144:6380
</span></span><span style="display:flex;"><span>   replicates 44b244a188185835b42d4489eac614e7f81b4cf8
</span></span><span style="display:flex;"><span>S: fc22025eb5db7cc0d55fe7dc11a3c368daa468bb 192.168.176.145:6380
</span></span><span style="display:flex;"><span>   replicates a463232f96c66cd7f27395253b65d0be8909656e
</span></span><span style="display:flex;"><span>Can I set the above configuration? <span style="color:#f92672">(</span>type <span style="color:#e6db74">&#39;yes&#39;</span> to accept<span style="color:#f92672">)</span>: yes     <span style="color:#75715e">#æ­¤å¤„è¾“å…¥ï¼šyesã€ç„¶åredis-trib.rb å¼€å§‹æ‰§è¡Œ èŠ‚ç‚¹æ¡æ‰‹ å’Œ æ§½åˆ†é… æ“ä½œï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Nodes configuration updated
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Assign a different config epoch to each node
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> the cluster to join....
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check <span style="color:#f92672">(</span>using node 192.168.176.142:6379<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 157bd250dd382b95a9289d8b44fd2cfd466fea98 192.168.176.142:6379
</span></span><span style="display:flex;"><span>   slots:0-4095 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: 31a3f0b03244d30bbc7e47acc0ec06d327b62860 192.168.176.144:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 44b244a188185835b42d4489eac614e7f81b4cf8
</span></span><span style="display:flex;"><span>M: a463232f96c66cd7f27395253b65d0be8909656e 192.168.176.144:6379
</span></span><span style="display:flex;"><span>   slots:8192-12287 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 44b244a188185835b42d4489eac614e7f81b4cf8 192.168.176.145:6379
</span></span><span style="display:flex;"><span>   slots:12288-16383 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: fc22025eb5db7cc0d55fe7dc11a3c368daa468bb 192.168.176.145:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates a463232f96c66cd7f27395253b65d0be8909656e
</span></span><span style="display:flex;"><span>M: c6df79e7c60c03921b69e4d4342507e8d4d2afbd 192.168.176.143:6379
</span></span><span style="display:flex;"><span>   slots:4096-8191 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: a6d87fb995f3f5e98e2a09f4b5a3078f7221a257 192.168.176.143:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 157bd250dd382b95a9289d8b44fd2cfd466fea98
</span></span><span style="display:flex;"><span>S: 1cafdeeb6cb52bb96dd16ac84d2242f59973f83a 192.168.176.142:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates c6df79e7c60c03921b69e4d4342507e8d4d2afbd
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check <span style="color:#66d9ef">for</span> open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All <span style="color:#ae81ff">16384</span> slots covered.</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><code>redis</code><!-- raw HTML omitted -->é›†ç¾¤å®Œæ•´æ€§æ£€<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<code>redis-trib.rb check</code>å‘½ä»¤æ£€æµ‹ä¹‹å‰åˆ›å»ºçš„ ä¸¤ä¸ªé›†ç¾¤ æ˜¯å¦æˆåŠŸï¼Œ<code>check</code>å‘½ä»¤åªéœ€è¦ç»™å‡ºé›†ç¾¤ä¸­ ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹åœ°å€ å°±å¯ä»¥å®Œæˆ æ•´ä¸ªé›†ç¾¤ çš„ æ£€æŸ¥å·¥ä½œï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./redis-trib.rb check 192.168.176.145:6379 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check <span style="color:#f92672">(</span>using node 192.168.176.142:6379<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 157bd250dd382b95a9289d8b44fd2cfd466fea98 192.168.176.142:6379
</span></span><span style="display:flex;"><span>   slots:0-4095 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: 31a3f0b03244d30bbc7e47acc0ec06d327b62860 192.168.176.144:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 44b244a188185835b42d4489eac614e7f81b4cf8
</span></span><span style="display:flex;"><span>M: a463232f96c66cd7f27395253b65d0be8909656e 192.168.176.144:6379
</span></span><span style="display:flex;"><span>   slots:8192-12287 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 44b244a188185835b42d4489eac614e7f81b4cf8 192.168.176.145:6379
</span></span><span style="display:flex;"><span>   slots:12288-16383 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: fc22025eb5db7cc0d55fe7dc11a3c368daa468bb 192.168.176.145:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates a463232f96c66cd7f27395253b65d0be8909656e
</span></span><span style="display:flex;"><span>M: c6df79e7c60c03921b69e4d4342507e8d4d2afbd 192.168.176.143:6379
</span></span><span style="display:flex;"><span>   slots:4096-8191 <span style="color:#f92672">(</span><span style="color:#ae81ff">4096</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: a6d87fb995f3f5e98e2a09f4b5a3078f7221a257 192.168.176.143:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 157bd250dd382b95a9289d8b44fd2cfd466fea98
</span></span><span style="display:flex;"><span>S: 1cafdeeb6cb52bb96dd16ac84d2242f59973f83a 192.168.176.142:6380
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates c6df79e7c60c03921b69e4d4342507e8d4d2afbd
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check <span style="color:#66d9ef">for</span> open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All <span style="color:#ae81ff">16384</span> slots covered.</span></span></code></pre></div></blockquote>
<hr>
<h3 id="redis-sentinelæ¨¡å¼"><code>Redis Sentinel</code>æ¨¡å¼</h3>
<blockquote>
<ul>
<li><code>Redis Sentinel</code>å“¨å…µæ¨¡å¼</li>
<li><!-- raw HTML omitted -->èŠ‚ç‚¹-1<!-- raw HTML omitted --><code>sentinel_16380.conf</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>protected-mode no
</span></span><span style="display:flex;"><span>bind 192.168.176.131  	<span style="color:#75715e"># æœ¬æœºIP</span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">16380</span>
</span></span><span style="display:flex;"><span>daemonize yes
</span></span><span style="display:flex;"><span>sentinel monitor master 192.168.176.131 <span style="color:#ae81ff">6379</span> <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># ä¸»IPä¸ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>sentinel down-after-milliseconds master <span style="color:#ae81ff">5000</span>  	<span style="color:#75715e"># æŒ‡å®šä¸»èŠ‚ç‚¹åº”ç­”å“¨å…µsentinelçš„æœ€å¤§æ—¶é—´é—´éš”ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå“¨å…µä¸»è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼Œé»˜è®¤30ç§’</span>
</span></span><span style="display:flex;"><span>sentinel failover-timeout master <span style="color:#ae81ff">180000</span>  	<span style="color:#75715e"># æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´failover-timeoutï¼Œé»˜è®¤ä¸‰åˆ†é’Ÿï¼Œå¯ä»¥ç”¨åœ¨ä»¥ä¸‹è¿™äº›æ–¹é¢</span>
</span></span><span style="display:flex;"><span>sentinel parallel-syncs master <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æŒ‡å®šäº†åœ¨å‘ç”Ÿfailoverä¸»å¤‡åˆ‡æ¢æ—¶ï¼Œæœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªslaveåŒæ—¶å¯¹æ–°çš„masterè¿›è¡ŒåŒæ­¥ã€‚è¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆfailoveræ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ï¼›åä¹‹ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œå°±æ„å‘³ç€è¶Šå¤šçš„slaveå› ä¸ºreplicationè€Œä¸å¯ç”¨ã€‚å¯ä»¥é€šè¿‡å°†è¿™ä¸ªå€¼è®¾ä¸º1ï¼Œæ¥ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªslaveï¼Œå¤„äºä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚</span>
</span></span><span style="display:flex;"><span>sentinel auth-pass master <span style="color:#ae81ff">123456</span>  	<span style="color:#75715e"># å½“åœ¨Rediså®ä¾‹ä¸­å¼€å¯äº†requirepass &lt;foobared&gt;ï¼Œæ‰€æœ‰è¿æ¥Rediså®ä¾‹çš„å®¢æˆ·ç«¯éƒ½è¦æä¾›å¯†ç </span>
</span></span><span style="display:flex;"><span>logfile /var/log/redis/sentinel_16380.log</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->èŠ‚ç‚¹2~3<!-- raw HTML omitted --><code>centinel_16380.conf </code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>protected-mode no
</span></span><span style="display:flex;"><span>bind 192.168.176.132  	<span style="color:#75715e"># æ­¤å¤„ä¿®æ”¹ä¸ºæœ¬æœºIP</span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">16380</span>
</span></span><span style="display:flex;"><span>daemonize yes
</span></span><span style="display:flex;"><span>sentinel monitor master 192.168.176.131 <span style="color:#ae81ff">6379</span> <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># ä¸»IPä¸ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>sentinel down-after-milliseconds master <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span>sentinel failover-timeout master <span style="color:#ae81ff">180000</span>
</span></span><span style="display:flex;"><span>sentinel parallel-syncs master <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>sentinel auth-pass master <span style="color:#ae81ff">123456</span>
</span></span><span style="display:flex;"><span>logfile /var/log/redis/sentinel_16380.log</span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_cassandra">Install_Cassandra</h1>

<h2 id="cassandra"><code>Cassandra</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://cassandra.apache.org/doc/latest/cassandra/getting_started/index.html" rel="external" target="_self">å¼€æº<code>NoSQL</code>æ•°æ®åº“<code>Cassandra</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_aerospike">Install_Aerospike</h1>

<h2 id="aerospike"><code>Aerospike</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://aerospike.com/" rel="external" target="_self"><code>Aerospike</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://docs.aerospike.com/server/operations/install" rel="external" target="_self"><code>Aerospike</code>å®‰è£…æ–‡æ¡£</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_redis">Configure_Redis</h1>

<h2 id="ç¼–å†™å¯åŠ¨æ–‡ä»¶">ç¼–å†™å¯åŠ¨æ–‡ä»¶</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://juejin.cn/post/6844903661223542792" rel="external" target="_self">æ·±å…¥å‰–æ<code>Redis</code>ç³»åˆ—</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/kismetv/p/9137897.html" rel="external" target="_self">æ·±å…¥å­¦ä¹ <code>Redis</code>æŒä¹…åŒ–</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/hopeofthevillage/p/11535683.html" rel="external" target="_self"><code>Redis</code>é›†ç¾¤å¢åŠ èŠ‚ç‚¹å’Œåˆ é™¤èŠ‚ç‚¹</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/tair-opensource/RedisShake" rel="external" target="_self"><code>RedisShake</code></a>ã€<a href="https://github.com/tair-opensource/RedisShake/releases/download/v4.1.1/redis-shake-linux-amd64.tar.gz" rel="external" target="_self">redis-shake-linux-amd64.tar.gz</a></td>
<td><code>Redis</code>è¿ç§»å·¥å…·</td>
</tr>
<tr>
<td><a href="https://www.volcengine.com/docs/6293/78099" rel="external" target="_self"><code>redis-shake</code>ä½¿ç”¨<code>RDB</code>æ–‡ä»¶è¿ç§»æ•°æ®</a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="redisæ¡Œé¢è¿æ¥å·¥å…·"><code>Redis</code>æ¡Œé¢è¿æ¥å·¥å…·</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>https://github.com/uglide/RedisDesktopManager/releases/tag/0.8.8  	<span style="color:#75715e"># ä¸‹è½½å®¢æˆ·ç«¯è¿æ¥å·¥å…· Redis 0.8.8  </span>
</span></span><span style="display:flex;"><span>https://github.com/uglide/RedisDesktopManager/releases/tag/0.9.3  	<span style="color:#75715e"># ä¸‹è½½å®¢æˆ·ç«¯è¿æ¥å·¥å…· Redis 0.9.3</span>
</span></span><span style="display:flex;"><span>https://github.com/qishibo/AnotherRedisDesktopManager/releases  	<span style="color:#75715e"># windowsç³»ç»Ÿè¿œç¨‹è¿æ¥å·¥å…·</span>
</span></span><span style="display:flex;"><span>https://github.com/quick123official/quick_redis_blog/releases </span></span></code></pre></div></blockquote>
<hr>
<h3 id="rediså¸¸ç”¨å‘½ä»¤"><code>Redis</code>å¸¸ç”¨å‘½ä»¤</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹Rediså…·ä½“IPè¿æ¥æ•° </span>
</span></span><span style="display:flex;"><span>$ netstat -n |grep <span style="color:#ae81ff">17693</span> |awk <span style="color:#e6db74">&#39;/^tcp/ {print $5}&#39;</span>| awk -F: <span style="color:#e6db74">&#39;{print $1}&#39;</span>|sort | uniq -c | sort -rn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç»Ÿè®¡Redisåœ¨çº¿äººæ•°</span>
</span></span><span style="display:flex;"><span>$ redis-cli -h 127.0.0.1 -p <span style="color:#ae81ff">6379</span> -c -a <span style="color:#e6db74">&#34;password&#34;</span> KEYS SPORTS:session:* 2&lt;/dev/null | awk <span style="color:#e6db74">&#34;{print </span>$2<span style="color:#e6db74">}&#34;</span>| awk -F<span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#e6db74">&#39; {print $2,$3}&#39;</span>| sed -e <span style="color:#e6db74">&#34;s/^/</span><span style="color:#e6db74">${</span>date<span style="color:#e6db74">}</span><span style="color:#e6db74">: /g&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; type é”®å€¼  	<span style="color:#75715e">#  æŸ¥çœ‹å€¼çš„ç±»å‹</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; HGET  	<span style="color:#75715e"># è·å–é”®å€¼æ•°æ®</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; HGETALL  	<span style="color:#75715e"># è·å–é”®å€¼æ•°æ®</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG GET databases  	<span style="color:#75715e"># æ•°æ®åº“çš„æ•°é‡</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; INFO keyspace  	<span style="color:#75715e"># ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºå®šä¹‰äº†æŸäº›é”®çš„æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; SELECT <span style="color:#ae81ff">14</span>  	<span style="color:#75715e"># åˆ‡æ¢14db</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; info clients  	<span style="color:#75715e"># æŸ¥çœ‹å®¢æˆ·ç«¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; client list  	<span style="color:#75715e"># åˆ—å‡ºæ‰€æœ‰è¿æ¥</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG GET maxclients  	<span style="color:#75715e"># è·å–æ”¯æŒæœ€å¤§è¿æ¥æ•°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; save  <span style="color:#75715e"># æ”¶åˆ°è§¦å‘rdbå­˜å‚¨æ•°æ®</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG SET appendonly yes  <span style="color:#75715e"># åŠ¨æ€é…ç½®</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; save
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; shutdown save <span style="color:#75715e"># å®‰å…¨é€€å‡ºå¹¶å­˜å‚¨æ•°æ®</span>
</span></span><span style="display:flex;"><span>not connected&gt; </span></span></code></pre></div><p><a href="#R-image-fc3046f0cd230245890cb00969cd8166" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Redis_Server/Snipaste_2022-07-01_13-19-44.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fc3046f0cd230245890cb00969cd8166"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Redis_Server/Snipaste_2022-07-01_13-19-44.png"></a></p>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="rsyncd">Rsyncd</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Rsyncd</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_timesyncd">Install_TimeSyncd</h1>

<h2 id="éƒ¨ç½²æ—¶é—´åŒæ­¥æœåŠ¡">éƒ¨ç½²æ—¶é—´åŒæ­¥æœåŠ¡</h2>
<h3 id="éƒ¨ç½²ntpæ—¶é—´åŒæ­¥æœåŠ¡">éƒ¨ç½²<code>NTP</code>æ—¶é—´åŒæ­¥æœåŠ¡</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸‹è½½å®‰è£…åŒ…ã€è§£å‹ã€é…ç½®ã€å®‰è£…<!-- raw HTML omitted --><a href="http://www.ntp.org/" rel="external" target="_self"><code>NTP</code>å®˜ç½‘</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/
</span></span><span style="display:flex;"><span>$ curl -O https://www.eecis.udel.edu/~ntp/ntp_spool/ntp4/ntp-4.2.8p13.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxvf ntp-4.2.8p13.tar.gz
</span></span><span style="display:flex;"><span>$ cd ntp-4.2.8p13
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/ntp --enable-all-clocks --enable-parse-clocks
</span></span><span style="display:flex;"><span>$ make <span style="color:#f92672">&amp;&amp;</span> make install
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ³¨ï¼šå¦‚ä»¥ä¸Šä¸‹è½½åœ°å€æ— æ³•è®¿é—®,è¯·ä»ntpå®˜æ–¹æ‰‹åŠ¨ä¸‹è½½ï¼šhttp://www.ntp.org/downloads.html</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>ntp.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>restrict default nomodify notrap noquery</code><!-- raw HTML omitted -->æ›¿æ¢ä¸º<!-- raw HTML omitted --><code>restrict default nomodify</code><!-- raw HTML omitted -->å…è®¸ä»»ä½•å®¢æˆ·æœº<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->è¿›è¡Œæ—¶é—´åŒæ­¥<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>restrict default nomodify notrap noquery</code><!-- raw HTML omitted -->é»˜è®¤æ‹’ç»æ‰€æœ‰ä¹‹åå¢åŠ ä¸€è¡Œï¼š<!-- raw HTML omitted --><code>restrict 192.168.18.0 mask 255.255.255.0 nomodify</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /etc/ntp.conf
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–¹å¼ä¸€ã€ä½¿ç”¨åŸŸåè¿æ¥ï¼Œè¦ç»è¿‡DNSè§£æï¼Œé€Ÿåº¦æ…¢ã€‚</span>
</span></span><span style="display:flex;"><span>ntpdate pool.ntp.org
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–¹å¼äºŒã€ä½¿ç”¨IPè¿æ¥ï¼Œè¶…çº§å¿«ã€‚</span>
</span></span><span style="display:flex;"><span>ntpdate 120.24.81.91</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä»¥å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨<!-- raw HTML omitted --><code>ntpd</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>ntpd</code><!-- raw HTML omitted -->å¯åŠ¨åï¼Œå®¢æˆ·æœºè¦ç­‰å‡ åˆ†é’Ÿå†ä¸å…¶è¿›è¡Œæ—¶é—´åŒæ­¥ï¼Œå¦åˆ™ä¼šæç¤º<!-- raw HTML omitted --><code>no server suitable for synchronization found</code><!-- raw HTML omitted -->é”™è¯¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/ntp/bin/ntpd -c /etc/ntp.conf -p /tmp/ntpd.pid</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->åœ¨å®¢æˆ·æœºå™¨é…ç½®è®¡åˆ’ä»»åŠ¡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ¯å¤©çš„5ç‚¹13åˆ†ã€9ç‚¹13åˆ†ã€14ç‚¹13åˆ†ã€19ç‚¹13åˆ†ä¸æ—¶é—´åŒæ­¥æœåŠ¡å™¨è¿›è¡ŒåŒæ­¥<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y ntpdate
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;13 5,9,14,19 * * * /usr/sbin/ntpdate 192.168.18.2&#34;</span> &gt;&gt;/var/spool/cron/root</span></span></code></pre></div></blockquote>
<hr>
<h3 id="éƒ¨ç½²chronyæ—¶é—´åŒæ­¥æœåŠ¡å°†æ›¿ä»£ntpæœåŠ¡">éƒ¨ç½²<code>Chrony</code>æ—¶é—´åŒæ­¥æœåŠ¡ã€‚å°†æ›¿ä»£<code>NTP</code>æœåŠ¡</h3>
<ul>
<li>
<ol>
<li><a href="https://chrony.tuxfamily.org/" rel="external" target="_self"><code>Chrony</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install chrony
</span></span><span style="display:flex;"><span>$ systemctl enable chronyd.service <span style="color:#f92672">&amp;&amp;</span> systemctl start chronyd.service</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_rsync">Install_Rsync</h1>

<h2 id="rsyncéƒ¨ç½²"><code>Rsync</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ³¨æ„ï¼š<!-- raw HTML omitted -->ä¸¤å°æœåŠ¡å™¨<!-- raw HTML omitted -->éƒ½éœ€è¦å®‰è£…<!-- raw HTML omitted --><code>Rsync</code><!-- raw HTML omitted -->æœåŠ¡ï¼Œ åªå¯åŠ¨æºæœåŠ¡å™¨ä¸Šçš„<!-- raw HTML omitted --><code>Rsync</code></li>
</ul>
<table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-a</code></td>
<td>åŒ…å«ï¼š<code>-rtplgoD</code> ç­‰é€‰é¡¹</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>åŒæ­¥ç›®å½•é€‰é¡¹</td>
</tr>
<tr>
<td><code>-v</code></td>
<td>æ˜¾ç¤ºåŒæ­¥çš„ç›®å½•æ–‡ä»¶ä¿¡æ¯</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>ä¿ç•™è½¯è¿æ¥</td>
</tr>
<tr>
<td><code>-L</code></td>
<td>åŒæ­¥è½¯é“¾æ¥æ—¶æŠŠæºæ–‡ä»¶ä¹Ÿç»™åŒæ­¥</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>ä¿æŒæ–‡ä»¶æƒé™å±æ€§</td>
</tr>
<tr>
<td><code>-o</code></td>
<td>ä¿æŒæ–‡ä»¶å±ä¸»</td>
</tr>
<tr>
<td><code>-g</code></td>
<td>ä¿æŒæ–‡ä»¶å±ç»„</td>
</tr>
<tr>
<td><code>-D</code></td>
<td>ä¿æŒè®¾å¤‡æ–‡ä»¶ä¿¡æ¯</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>ä¿æŒæ–‡ä»¶æ—¶é—´å±æ€§</td>
</tr>
<tr>
<td><code>-delete</code></td>
<td>åˆ é™¤<!-- raw HTML omitted -->ç›®æ ‡æœåŠ¡å™¨<!-- raw HTML omitted -->ç›®å½•ä¸­<!-- raw HTML omitted -->æºæœåŠ¡å™¨<!-- raw HTML omitted -->æ²¡æœ‰çš„æ–‡ä»¶</td>
</tr>
<tr>
<td><code>-exclude</code></td>
<td>å¿½ç•¥ä¸éœ€è¦åŒæ­¥çš„ç›®å½•æ–‡ä»¶</td>
</tr>
<tr>
<td><code>-P</code></td>
<td>æ˜¾ç¤ºåŒæ­¥è¿‡ç¨‹ï¼Œé€Ÿç‡ç­‰ï¼Œæ¯”<code>-v</code>æ›´åŠ è¯¦ç»†</td>
</tr>
<tr>
<td><code>-u</code></td>
<td>å¦‚æœ<!-- raw HTML omitted -->ç›®æ ‡æœåŠ¡å™¨<!-- raw HTML omitted -->æ¯”<!-- raw HTML omitted -->æºæœåŠ¡å™¨<!-- raw HTML omitted -->ç›®å½•æ–‡ä»¶æ–°<!-- raw HTML omitted -->åˆ™ä¸åŒæ­¥<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><code>-z</code></td>
<td>åŒæ­¥æ—¶å‹ç¼©ç›®å½•æ–‡ä»¶</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="æºæœåŠ¡å™¨">æºæœåŠ¡å™¨</h3>
<blockquote>
<ul>
<li></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;username:password&#34;</span> &gt;&gt;/etc/rsyncd.namelist  	<span style="color:#75715e"># åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç”¨æˆ·å¯†ç </span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/rsyncd.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sample rsyncd.conf configuration file
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># GLOBAL OPTIONS å…¨å±€é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># motd file=/etc/motd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># log file=/var/log/rsyncd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># for pid file, do not use /var/run/rsync.pid if
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># you are going to run rsync out of the init.d script.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># The init.d script does its own pid file handling,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># so omit the &#34;pid file&#34; line completely in that case.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># pid file=/var/run/rsyncd.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># syslog facility=daemon
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># socket options=
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># MODULE OPTIONS æŒ‰ç»„é…ç½®é€‰é¡¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ftp]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	comment = public archive
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# è¦åŒæ­¥çš„ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	path = /var/www/pub
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	use chroot = yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # max connections=10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	lock file = /var/lock/rsyncd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # é»˜è®¤åªè¯»ï¼Œå¦‚æœæºè¦æ¨é€ç›®å½•æ–‡ä»¶åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œ ç›®æ ‡æœåŠ¡å™¨ä¸Šéœ€è¦ä¿®æ”¹ä¸ºï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	read only = yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	list = yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	uid = nobody
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	gid = nogroup
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# exclude = 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# exclude from = 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# include =
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# include from =
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# æˆæƒè®¿é—®çš„ç”¨æˆ·å
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# auth users = username
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# æˆæƒè®¿é—®çš„ç”¨æˆ·çš„å¯†ç æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# secrets file = /etc/rsyncd.secrets
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	strict modes = yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# hosts allow =
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# hosts deny =
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	ignore errors = no
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	ignore nonreadable = yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	transfer logging = no
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# log format = %t: host %h (%a) %o %f (%l bytes). Total %b bytes.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	timeout = 600
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	refuse options = checksum dry-run
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	dont compress = *.gz *.tgz *.zip *.z *.rpm *.deb *.iso *.bz2 *.tbz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æƒé™ä¸€å®šè¦é™åˆ¶ä¸ºæœ€å°ï¼Œ</span>
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">600</span> /etc/rsyncd.namelist
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># killè¿›ç¨‹é‡å¯</span>
</span></span><span style="display:flex;"><span>$ kill -9 rsync
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¾åå°è¿è¡Œæ–¹å¼å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>$ rsync --daemon</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ç›®æ ‡æœåŠ¡å™¨">ç›®æ ‡æœåŠ¡å™¨</h3>
<blockquote>
<ul>
<li>æŸ¥çœ‹æºæœåŠ¡å™¨ä¸‹ç›®å½•èµ„æº</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rsync --list-only æºæœåŠ¡å™¨IP::ftp/  	<span style="color:#75715e"># ftp ä¸ºç»„å</span></span></span></code></pre></div><ul>
<li>åŒæ­¥æºç›®å½•ä¸‹èµ„æº</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rsync -avz æºæœåŠ¡å™¨IP::ftp/ /usr/local/nginx/html</span></span></code></pre></div><ul>
<li>ä½¿ç”¨ç”¨æˆ·å¯†ç æ–¹å¼æŸ¥çœ‹æºæœåŠ¡å™¨èµ„æº</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ rsync --list-only username@æºæœåŠ¡å™¨IP::ftp/  	<span style="color:#75715e"># ftp ä¸ºç»„å</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®¢æˆ·ç«¯ä¿å­˜å¯†ç </span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;password&#34;</span> &gt;&gt;/etc/rsyncd.passwordlist 
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">600</span> /etc/rsyncd.passwordlist 
</span></span><span style="display:flex;"><span>$ rsync --list-only --password-file<span style="color:#f92672">=</span>/etc/rsyncd.passwordlist username@æºæœåŠ¡å™¨IP::ftp/  	<span style="color:#75715e"># ftp ä¸ºç»„å</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="å®‰è£…é…ç½®inotifyæ—¶æ—¶æ£€æµ‹æœåŠ¡">å®‰è£…é…ç½®<code>Inotify</code>æ—¶æ—¶æ£€æµ‹æœåŠ¡</h3>
<blockquote>
<ul>
<li>
<ol>
<li>å®‰è£…ä»¥åŠé…ç½®ç›‘æ§ç›®å½•</li>
</ol>
</li>
</ul>
<table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>å®Œæ•´å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-r</code></td>
<td><code>--recursive</code></td>
<td>é€’å½’æŸ¥è¯¢ç›®å½•</td>
</tr>
<tr>
<td><code>-q</code></td>
<td><code>--qulet</code></td>
<td>åªæ‰“å°ç›‘æ§äº‹ä»¶ä¿¡æ¯</td>
</tr>
<tr>
<td><code>-m</code></td>
<td><code>--monitor</code></td>
<td>å§‹ç»ˆä¿æŒç›‘æ§çŠ¶æ€</td>
</tr>
<tr>
<td><code>--excludel</code></td>
<td></td>
<td>æ’é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¸åŒºåˆ†å¤§å°å†™</td>
</tr>
<tr>
<td><code>--timefmt</code></td>
<td></td>
<td>æŒ‡å®šäº‹ä»¶è¾“å‡ºæ ¼å¼</td>
</tr>
<tr>
<td><code>--format</code></td>
<td></td>
<td>ä½¿ç”¨æŒ‡å®šçš„è¾“å‡ºç±»ä¼¼å­—ç¬¦ä¸²æ ¼å¼</td>
</tr>
<tr>
<td><code>-e</code></td>
<td>`&ndash;event[-e</td>
<td>&ndash;event &hellip;]accessmodifyattrb`</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://github.com/inotify-tools/inotify-tools/releases/download/3.20.2.2/inotify-tools-3.20.2.2.tar.gz
</span></span><span style="display:flex;"><span>$ tar zxvf inotify-tools-3.20.2.2.tar.gz
</span></span><span style="display:flex;"><span>$ cd inotify-tools-3.20.2.2/
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/inotify
</span></span><span style="display:flex;"><span>$ make <span style="color:#f92672">&amp;&amp;</span> make install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç›‘æ§ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ inotifywait -mrq --timefmt <span style="color:#e6db74">&#39;%Y-%m-%d %H:%M:%S&#39;</span> --format <span style="color:#e6db74">&#39;%T %w%f %e&#39;</span> -e close_write,modify,delete,create,attrib,move //usr/local/nginx/html/</span></span></code></pre></div><ul>
<li>ä½¿ç”¨è„šæœ¬ç›‘æ§</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;inotifywait_rsync.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç›‘æ§ç›®å½•ï¼Œ æœ‰å˜åŒ–æ¨é€åˆ°ç›®æ ‡æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">inotifywait -mrq --timefmt &#39;%Y-%m-%d %H:%M:%S&#39; --format &#39;%T %w%f %e&#39; -e close_write,modify,delete,create,attrib,move //usr/local/nginx/html/ | while read file
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     rsync -az --delete --password-file=/etc/rsyncd.passwordlist /usr/local/nginx/html username@æºæœåŠ¡å™¨IP::ftp/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_lsyncd">Install_Lsyncd</h1>

<h2 id="lsyncdéƒ¨ç½²"><code>Lsyncd</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li>**<code>Lsyncd</code>**æ˜¯ä¸€ä¸ªå®æ—¶æ–‡ä»¶åŒæ­¥å·¥å…·ï¼Œå®ƒå¯ä»¥ç›‘è§†æŒ‡å®šçš„ç›®å½•æ ‘ï¼Œä¸€æ—¦æ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼ˆå¦‚åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ï¼‰ï¼Œå°±ä¼šç«‹å³å°†è¿™äº›å˜åŒ–åŒæ­¥åˆ°å¦ä¸€ä¸ªç›®æ ‡ä½ç½®ã€‚å®ƒä¸»è¦ç”¨äºåœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´ä¿æŒæ–‡ä»¶å¤¹å†…å®¹åŒæ­¥ï¼Œå¹¶ä¸”å¯ä»¥å®ç°é«˜æ•ˆçš„å¢é‡åŒæ­¥</li>
<li><strong>ä¸»è¦ç‰¹ç‚¹å’Œç”¨é€”ï¼š</strong></li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>å®æ—¶ç›‘æ§å’ŒåŒæ­¥</strong>ï¼š</p>
<p><code>Lsyncd</code>ä½¿ç”¨è½®è¯¢æˆ–æ–‡ä»¶ç³»ç»Ÿçš„é€šçŸ¥æœºåˆ¶ï¼ˆå¦‚<code>inotify</code>ï¼‰æ¥å®æ—¶ç›‘æ§æ–‡ä»¶ç³»ç»Ÿçš„å˜åŒ–ã€‚</p>
<p>å½“ç›‘æ§çš„ç›®å½•å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå¯ä»¥å¿«é€Ÿå“åº”å¹¶å°†å˜æ›´å†…å®¹åŒæ­¥åˆ°ç›®æ ‡ä½ç½®ã€‚</p>
</li>
<li>
<p><strong>å¢é‡åŒæ­¥</strong>ï¼š</p>
<p><code>Lsyncd</code>ä¸ä¼šç®€å•åœ°å…¨é‡å¤åˆ¶æ–‡ä»¶ï¼Œè€Œæ˜¯é€šè¿‡å¢é‡æ–¹å¼åŒæ­¥æ–‡ä»¶å˜æ›´ï¼Œæé«˜äº†åŒæ­¥æ•ˆç‡ã€‚</p>
</li>
<li>
<p><strong>çµæ´»çš„é…ç½®</strong>ï¼š</p>
<p>å¯ä»¥é€šè¿‡ç®€å•çš„é…ç½®æ–‡ä»¶å®šä¹‰ç›‘æ§æºç›®å½•å’Œç›®æ ‡ä½ç½®ï¼Œä»¥åŠå®šä¹‰åŒæ­¥è§„åˆ™å’Œè¡Œä¸ºã€‚</p>
<p>æ”¯æŒé€šè¿‡<code>Lua</code>è„šæœ¬æ¥è‡ªå®šä¹‰å¤„ç†é€»è¾‘ï¼Œå¦‚è¿‡æ»¤å™¨ã€æ’é™¤è§„åˆ™ç­‰ã€‚</p>
</li>
<li>
<p><strong>è·¨å¹³å°æ”¯æŒ</strong>ï¼š</p>
<p><code>Lsyncd</code>å¯ä»¥è¿è¡Œåœ¨å¤šç§æ“ä½œç³»ç»Ÿä¸Šï¼ŒåŒ…æ‹¬<code>Linux</code>ã€<code>BSD</code>å’Œ<code>macOS</code>ç­‰ã€‚</p>
</li>
<li>
<p><strong>é«˜å¯é æ€§å’Œå¯æ‰©å±•æ€§</strong>ï¼š</p>
<p><code>Lsyncd</code>è®¾è®¡ç”¨äºé«˜å¯é æ€§çš„æ–‡ä»¶åŒæ­¥ï¼Œå¯ä»¥å¤„ç†å¤§é‡çš„æ–‡ä»¶ç³»ç»Ÿå˜æ›´å’ŒåŒæ­¥ä»»åŠ¡ã€‚</p>
<p>å¯ä»¥é…ç½®æˆä¸ºé›†ç¾¤ç¯å¢ƒä¸‹çš„ä¸€éƒ¨åˆ†ï¼Œä»¥å®ç°æ›´å¤æ‚çš„åŒæ­¥å’Œå¤‡ä»½ç­–ç•¥ã€‚</p>
</li>
</ul>
</blockquote>
<ul>
<li><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ–‡ä»¶åŒæ­¥</strong>ï¼š</p>
<p>åœ¨å¤šå°æœåŠ¡å™¨ä¹‹é—´åŒæ­¥é‡è¦æ–‡ä»¶ï¼Œç¡®ä¿æ–‡ä»¶å†…å®¹çš„ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ã€‚</p>
</li>
<li>
<p><strong>å®æ—¶å¤‡ä»½å’Œæ•°æ®ä¿æŠ¤</strong>ï¼š</p>
<p>å°†é‡è¦æ•°æ®å³æ—¶å¤‡ä»½åˆ°å¦ä¸€ä¸ªä½ç½®ï¼Œä»¥åº”å¯¹æ„å¤–æ•°æ®ä¸¢å¤±æˆ–æŸåçš„æƒ…å†µã€‚</p>
</li>
<li>
<p><strong>ç½‘ç«™å’Œåº”ç”¨ç¨‹åºéƒ¨ç½²</strong>ï¼š</p>
<p>åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šéƒ¨ç½²ç›¸åŒçš„ç½‘ç«™æˆ–åº”ç”¨ç¨‹åºä»£ç ï¼Œç¡®ä¿æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„å†…å®¹å§‹ç»ˆä¿æŒåŒæ­¥ã€‚</p>
</li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…æ‰©å±•å·¥å…·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install expect epel-release lsyncd</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç”Ÿæˆå¯†é’¥å®ç°ç»µå¯†ç™»å½•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ssh-keygen -t rsa -P <span style="color:#e6db74">&#34;&#34;</span> -f ~/.ssh/id_rsa  	<span style="color:#75715e"># -tæŒ‡å®šSSHå¯†é’¥çš„ç®—æ³•ä¸ºRSAç®—æ³•ï¼Œ-Pè®¾ç½®å¯†ç ä¸ºç©ºï¼Œ-fæŒ‡å®šç”Ÿæˆçš„å¯†é’¥æ–‡ä»¶å­˜æ”¾ä½ç½®</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>expect</code><!-- raw HTML omitted -->å·¥å…·ä½¿è„šæœ¬æ¨é€å¯†é’¥<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ expect <span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spawn ssh-copy-id myadmin@$IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">expect &#34;(yes/no)?&#34; {send &#34;yes\r&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">expect &#34;password:&#34; {send &#34;$passwd\r&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">expect &#34;#&#34; {send &#34;exit\r&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ç»™äºˆæ™®é€šç”¨æˆ·æˆæƒï¼Œä½¿æ™®é€šç”¨æˆ·å¯ä»¥ä½¿ç”¨<!-- raw HTML omitted --><code>Lsyncd</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;#####  	Start/Stop Service  	#####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Cmnd_Alias MYADMIN_START_SERVICES = /etc/lsyncd.conf, /usr/bin/lsyncd, /bin/rsync, /var/log/lsyncd/*
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">myadmin ALL=(ALL)NOPASSWD:MYADMIN_START_SERVICES 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span> &gt;&gt;/etc/sudoers.d/myadmin
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">660</span> /etc/sudoers.d/myadmin</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ç¼–å†™<!-- raw HTML omitted --><code>Lsyncd.conf</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;--insistï¼šç»§ç»­è¿è¡Œï¼Œå³ä½¿æœ‰å¤±è´¥çš„ç›®æ ‡ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--statusIntervalï¼šå¤šå°‘ç§’å†™å…¥æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯10s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--syncä¸ºåŒæ­¥é…ç½®ï¼Œéƒ¨åˆ†å‚æ•°å¦‚ä¸‹ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--sourceï¼šæœ¬åœ°æ–‡ä»¶ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--hostï¼šè¿œç¨‹æœåŠ¡å™¨åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--targetdirï¼šè¿œç¨‹ç›®æ ‡ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--portï¼šç›®å‰ä¸»æœºSSHç«¯å£å·ï¼Œé»˜è®¤ä¸º22
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">settings {  --settingsä¸ºå…¨å±€é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> logfile = &#34;</span>/var/log/lsyncd/lsyncd.log<span style="color:#e6db74">&#34;,  --logfileï¼šæ—¥å¿—æ–‡ä»¶è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> statusFile = &#34;</span>/var/log/lsyncd/lsyncd.status<span style="color:#e6db74">&#34;, --statusFileï¼šè¿›ç¨‹è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> inotifyMode = &#34;</span>CloseWrite or Modify<span style="color:#e6db74">&#34;,   
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> maxProcesses = 100, --sshåŒæ­¥ä¿®æ”¹ä¸º&#34;</span>1<span style="color:#e6db74">&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> maxDelays    = 10,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sync {  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> default.rsyncssh,  --# sshåŒæ­¥æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> source = &#34;</span>/opt/backup<span style="color:#e6db74">&#34;,  --æºæœåŠ¡å™¨ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> host=&#34;</span>192.168.40.198<span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> targetdir=&#34;</span>/opt/backup/<span style="color:#e6db74">&#34;, --ç›®æ ‡æœåŠ¡å™¨ç›®å½•ï¼ŒæºæœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨ç›¸åŒ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> delay = 1,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> rsync = {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     binary = &#34;</span>/usr/bin/rsync<span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     archive = true,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     compress = false,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     verbose = true,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sync {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> default.rsync,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> source = &#34;</span>/data/nginx/cache<span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> target =&#34;</span>root@192.168.32.11:/data/nginx/cache<span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> delay  = 1,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> rsync = {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     binary = &#34;</span>/usr/bin/rsync<span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     archive = true,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     compress = false,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     verbose = true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">} &#34;</span>&gt;&gt;/etc/lsyncd.conf</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->ç»™äºˆæƒé™ï¼Œ å¯åŠ¨<!-- raw HTML omitted --><code>Lsyncd</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chown -R myadmin. /var/log/lsyncd
</span></span><span style="display:flex;"><span>$ lsyncd -nodaemon /etc/lsyncd.conf  	<span style="color:#75715e"># è¿è¡ŒæŸ¥çœ‹ä¸‹æ˜¯å¦æœ‰æŠ¥é”™  </span>
</span></span><span style="display:flex;"><span>$ systemctl enable lsyncd <span style="color:#f92672">&amp;&amp;</span> systemctl start lsyncd</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="script">Script</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Script</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="how_to_write_shell_scripts">How_To_Write_Shell_Scripts</h1>

<h2 id="shellè„šæœ¬ç¼–å†™"><code>Shell</code>è„šæœ¬ç¼–å†™</h2>
<h3 id="æ‰§è¡Œæ–¹å¼">æ‰§è¡Œæ–¹å¼</h3>
<blockquote>
<ul>
<li><code>sh -n bash.sh</code><!-- raw HTML omitted -->è°ƒè¯•æ¨¡å¼è¿è¡Œï¼š<!-- raw HTML omitted --><code>-n</code></li>
<li><code>sh -vx bash.sh</code><!-- raw HTML omitted -->æ‰“å°è°ƒè¯•æ¨¡å¼è¿è¡Œæ—¥å¿—ï¼š<!-- raw HTML omitted --><code>-vx</code></li>
<li><code>bash</code><!-- raw HTML omitted -->æ‰§è¡Œç¯å¢ƒ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç™»å½•<!-- raw HTML omitted --><code>bash</code><!-- raw HTML omitted -->æ‰§è¡Œ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ç³»ç»Ÿçº§</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/etc/profile
</span></span><span style="display:flex;"><span>/etc/bashrc</span></span></code></pre></div><ul>
<li>ç”¨æˆ·çº§</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>~/.bash_profile
</span></span><span style="display:flex;"><span>~/.bashrc</span></span></code></pre></div></blockquote>
<ul>
<li>é€€å‡º<code>bash</code>æ‰§è¡Œ</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>~/.bash_history
</span></span><span style="display:flex;"><span>~/.bash_logout</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->è·å–æ–‡ä»¶å<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ basename  	<span style="color:#75715e"># è·å–æœ€åæ–‡ä»¶å: basename /etc/passwd</span>
</span></span><span style="display:flex;"><span>$ dirname  	<span style="color:#75715e"># è·å–æ–‡ä»¶åå‰ç¼€</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è„šæœ¬è¡¥å…¨ã€å°æ¸¸æˆ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install bash-completion  	<span style="color:#75715e"># è„šæœ¬è¡¥å…¨æœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ sudo apt-get install jq  	<span style="color:#75715e"># å®‰è£…jsonæ ¼å¼æŸ¥çœ‹æœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ yum -y install sl  	<span style="color:#75715e"># å°ç«è½¦</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vim scripts.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:set ff<span style="color:#f92672">=</span>unix  	<span style="color:#75715e"># è½¬æ¢æ¢è¡Œç¬¦</span>
</span></span><span style="display:flex;"><span>:set paste  	<span style="color:#75715e"># è§£å†³æ–‡æœ¬ç²˜è´´åé”™ä¹±</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å½“å‰æ‰§è¡Œ<!-- raw HTML omitted --><code>shell</code><!-- raw HTML omitted -->è„šæœ¬ä»¥åŠåµŒå…¥å…¶ä»–è¯­è¨€<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ source shell.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;#!/usr/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;</span>hello bash<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">. shell.sh  	# åœ¨å…¶ä»–è„šæœ¬ä¸­å¼•ç”¨æ­¤è„šæœ¬ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åµŒå…¥pythonè„šæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/usr/bin/python &lt;&lt;-EOF  #&#34;</span>-<span style="color:#e6db74">&#34;æ”¯æŒTabé”®,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">print &#34;</span>hello python<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF &#34;</span>&gt;bash.sh</span></span></code></pre></div></blockquote>
<hr>
<h3 id="crontabè®¡åˆ’ä»»åŠ¡"><code>crontab</code>è®¡åˆ’ä»»åŠ¡</h3>
<blockquote>
<ul>
<li><code>crontab</code>è®¡åˆ’ä»»åŠ¡</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ man crontab
</span></span><span style="display:flex;"><span>@reboot ï¼šé‡å¯åè¿è¡Œä¸€æ¬¡ã€‚
</span></span><span style="display:flex;"><span>@yearly ï¼šæ¯å¹´è¿è¡Œä¸€æ¬¡ï¼Œå³ã€‚ â€œ0 <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span> *â€ã€‚
</span></span><span style="display:flex;"><span>@annually ï¼šæ¯å¹´è¿è¡Œä¸€æ¬¡ï¼Œå³ã€‚ â€œ0 <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span> *â€ã€‚
</span></span><span style="display:flex;"><span>@monthly ï¼šæ¯æœˆè¿è¡Œä¸€æ¬¡ï¼Œå³ã€‚ â€œ0 <span style="color:#ae81ff">1</span> * *â€ã€‚
</span></span><span style="display:flex;"><span>@weekly ï¼šæ¯å‘¨è¿è¡Œä¸€æ¬¡ï¼Œå³ã€‚ â€œ0 * * 0â€ã€‚
</span></span><span style="display:flex;"><span>@daily ï¼šæ¯å¤©è¿è¡Œä¸€æ¬¡ï¼Œå³ã€‚ â€œ0 * * *â€ã€‚
</span></span><span style="display:flex;"><span>@hourly ï¼šæ¯å°æ—¶è¿è¡Œä¸€æ¬¡ï¼Œå³ã€‚ â€œ* * * *â€ã€‚
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ls -l /var/spool/cron/root
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ls -l /var/spool/cron/crontabs/root  	<span style="color:#75715e"># Debianç³»ç»Ÿ</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="testæ¡ä»¶æµ‹è¯•"><code>test</code>æ¡ä»¶æµ‹è¯•</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ man test</span></span></code></pre></div></blockquote>
<hr>
<h3 id="shellè„šæœ¬é¢œè‰²"><code>Shell</code>è„šæœ¬é¢œè‰²</h3>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->è‹¥å­—ç¬¦ä¸²ä¸­å‡ºç°ä»¥ä¸‹å­—ç¬¦ï¼Œåˆ™ç‰¹åˆ«åŠ ä»¥å¤„ç†ï¼Œè€Œä¸ä¼šå°†å®ƒå½“æˆä¸€èˆ¬æ–‡å­—è¾“å‡ºéœ€è¦ä½¿ç”¨ï¼š<!-- raw HTML omitted --><code>-e</code></p>
</li>
<li>
<p><!-- raw HTML omitted -->è„šæœ¬æ–‡å­—é¢œè‰²<!-- raw HTML omitted --></p>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>30m:ç°è‰²ã€31m:çº¢è‰²ã€32m:ç»¿è‰²ã€33m:é»„è‰²ã€34m:è“è‰²ã€35m:ç´«è‰²ã€36m:æµ…è“è‰²ã€37m:ç™½è‰²  	<span style="color:#75715e"># æ–‡å­—é¢œè‰² </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo -e <span style="color:#e6db74">&#34;\e[1;30mæˆ‘æ˜¯ç°è‰² \e[0m&#34;</span>  	<span style="color:#75715e"># æ–‡å­—è‰²å·30~37ï¼Œ&#34;\e[0m&#34;:æ¢å¤åŸæœ¬è‰²å· </span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è„šæœ¬èƒŒæ™¯é¢œè‰²<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>40m:ç°è‰²ã€41m:çº¢è‰²ã€42m:ç»¿è‰²ã€43m:é»„è‰²ã€44m:è“è‰²ã€45m:ç´«è‰²ã€46m:æµ…è“è‰²ã€47m:ç™½è‰²  	<span style="color:#75715e"># èƒŒæ™¯é¢œè‰²</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo -e <span style="color:#e6db74">&#34;\e[1;40mæˆ‘æ˜¯ç°è‰² \e[0m&#34;</span>  	<span style="color:#75715e"># èƒŒæ™¯è‰²å·40~47ï¼Œ&#34;\e[0m&#34;:æ¢å¤åŸæœ¬è‰²å· </span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ–‡æœ¬æ ¼å¼æ§åˆ¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>1m:ç²—ä½“ã€4m:ä¸‹åˆ’çº¿ã€7m:åæ˜¾ã€25h:æ˜¾ç¤ºå…‰æ ‡
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34;\033[?25h&#34;</span> æ˜¾ç¤ºå…‰æ ‡
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34;\033[?25l&#34;</span> éšè—å…‰æ ‡</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="å˜é‡">å˜é‡</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>IP<span style="color:#f92672">=</span>192.168.1.1  	<span style="color:#75715e"># æ˜¾ç¤ºèµ‹å€¼</span>
</span></span><span style="display:flex;"><span>echo $IP
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>read -p <span style="color:#e6db74">&#34;è¯·è¾“å…¥ IP: &#34;</span> IP 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é”®ç›˜è¯»å…¥èµ‹å€¼: IP:ä¸ºå˜é‡å, ä¸€æ¬¡æ€§å¯ä»¥å®šä¹‰å¤šä¸ªå˜é‡åï¼šread -p &#34;è¯·è¾“å…¥ä½ çš„å§“åï¼Œå¹´é¾„ï¼Œæ€§åˆ«: &#34; name age sex  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>./ping.sh  192.168.1.1  192.168.1.2  
</span></span><span style="display:flex;"><span>$1           $2  <span style="color:#75715e"># ä½ç½®å˜é‡</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¯å¢ƒå˜é‡(ç³»ç»Ÿå˜é‡)</span>
</span></span><span style="display:flex;"><span>è®¾ç½®ç¯å¢ƒå˜é‡
</span></span><span style="display:flex;"><span>export IP<span style="color:#f92672">=</span>192.168.1.1
</span></span><span style="display:flex;"><span>export IP  	<span style="color:#75715e"># å˜é‡å</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># /etc/profile</span>
</span></span><span style="display:flex;"><span>PATH<span style="color:#f92672">=</span>$PATH:/new/bin
</span></span><span style="display:flex;"><span>export PATH
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># è‡ªå®šä¹‰å˜é‡</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="å˜é‡è¿ç®—">å˜é‡è¿ç®—</h4>
<ul>
<li>
<ol>
<li>æ•´æ•°è¿ç®—</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ–¹å¼ä¸€<!-- raw HTML omitted --><code>expr</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ expr <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">\*</span> <span style="color:#ae81ff">2</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ–¹å¼äºŒ<!-- raw HTML omitted --><code>$(())</code><!-- raw HTML omitted --># è„šæœ¬å¸¸ç”¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#66d9ef">$((</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#66d9ef">))</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ–¹å¼ä¸‰<!-- raw HTML omitted --><code>let</code><!-- raw HTML omitted -->  # è„šæœ¬å¸¸ç”¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>let i++ 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å…ˆèµ‹å€¼,åè¿ç®—: x=i :x=1ã€i=2</span>
</span></span><span style="display:flex;"><span>i<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>let x<span style="color:#f92672">=</span>i++
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å…ˆè¿ç®—,åèµ‹å€¼: ++j :y=2ã€j=2</span>
</span></span><span style="display:flex;"><span>j<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>let y<span style="color:#f92672">=</span>++j  	</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>å°æ•°è¿ç®—</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;2*4&#34;</span> |bc
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;2^4&#34;</span> |bc  	<span style="color:#75715e"># bcçš„æ¬¡æ–¹: ^</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;scale=2;6/4&#34;</span> |bc
</span></span><span style="display:flex;"><span>$ awk <span style="color:#e6db74">&#39;BEGIN{print 1/2}&#39;</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="åˆ é™¤æ›¿æ¢å˜é‡">åˆ é™¤ã€æ›¿æ¢å˜é‡</h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#  	# ä»å¤´å¾€ååˆ é™¤</span>
</span></span><span style="display:flex;"><span>%  	<span style="color:#75715e"># ä»åå¾€å¤´åˆ é™¤</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>:0:3<span style="color:#f92672">}</span>  	<span style="color:#75715e"># åˆ‡ç‰‡</span>
</span></span><span style="display:flex;"><span>/  	<span style="color:#75715e"># å†…å®¹æ›¿æ¢</span>
</span></span><span style="display:flex;"><span>-  	<span style="color:#75715e"># å˜é‡æ›¿ä»£</span>
</span></span><span style="display:flex;"><span>:-  	<span style="color:#75715e">#å˜é‡æ›¿ä»£ï¼Œå¯æ›¿ä»£ç©ºå€¼ã€+ã€:+ã€=ã€:=ã€?ã€:?ã€</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç™¾åº¦åŸŸåä¸¾ä¾‹:www.baidu.com</span>
</span></span><span style="display:flex;"><span>url<span style="color:#f92672">=</span>www.baidu.com
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">${</span>url#*.<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>baidu.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">${</span>url#*bai<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>du.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">${</span>url##*.<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>com</span></span></code></pre></div></blockquote>
<hr>
<h3 id="expectä½¿ç”¨"><code>expect</code>ä½¿ç”¨</h3>
<blockquote>
<ul>
<li>**<code>Expect</code>**æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·ï¼Œç”¨äºä¸äº¤äº’å¼ç¨‹åºè¿›è¡Œäº¤äº’ã€‚å®ƒå…è®¸ä½ ç¼–å†™è„šæœ¬æ¥æ¨¡æ‹Ÿäººç±»ç”¨æˆ·ä¸ç¨‹åºçš„äº¤äº’è¿‡ç¨‹ï¼Œä»è€Œè‡ªåŠ¨åŒ–æ‰§è¡Œé‚£äº›é€šå¸¸éœ€è¦äººå·¥å¹²é¢„çš„ä»»åŠ¡</li>
<li><strong>ä¸»è¦ç‰¹ç‚¹å’Œç”¨é€”ï¼š</strong></li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>è‡ªåŠ¨åŒ–äº¤äº’</strong>ï¼š</p>
<p><code>Expect</code>è„šæœ¬å¯ä»¥ç¼–å†™ä¸ºæ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥å’Œå¤„ç†ç¨‹åºè¾“å‡ºçš„è¡Œä¸ºã€‚å®ƒé€šè¿‡æ•è·å’Œåˆ†æç¨‹åºçš„è¾“å‡ºï¼Œå¹¶æ ¹æ®é¢„å®šä¹‰çš„è§„åˆ™è‡ªåŠ¨å“åº”ï¼Œæ¥æ‰§è¡Œæ‰€éœ€çš„æ“ä½œã€‚</p>
</li>
<li>
<p><strong>ä¸äº¤äº’å¼ç¨‹åºé›†æˆ</strong>ï¼š</p>
<p>é€‚ç”¨äºéœ€è¦ç”¨æˆ·è¾“å…¥æˆ–æœŸæœ›ç‰¹å®šå“åº”çš„ç¨‹åºï¼Œä¾‹å¦‚é…ç½®ç®¡ç†å·¥å…·ã€ç½‘ç»œè®¾å¤‡é…ç½®ã€æ•°æ®åº“ç®¡ç†ç­‰ã€‚</p>
</li>
<li>
<p><strong>ç®€åŒ–å¤æ‚ä»»åŠ¡</strong>ï¼š</p>
<p>å¯ä»¥é€šè¿‡<code>Expect</code>è‡ªåŠ¨åŒ–æ‰§è¡Œå¤æ‚çš„ç³»ç»Ÿç®¡ç†ä»»åŠ¡ï¼Œå¦‚å®‰è£…å’Œé…ç½®è½¯ä»¶ã€æ‰§è¡Œå¤‡ä»½å’Œæ¢å¤æ“ä½œã€æ¨¡æ‹Ÿç”¨æˆ·ä¼šè¯ç­‰ã€‚</p>
</li>
<li>
<p><strong>åŸºäº<code>TCL</code>è¯­è¨€</strong>ï¼š</p>
<p><code>Expect</code>çš„è„šæœ¬è¯­è¨€åŸºäº<code>TCL</code>ï¼ˆ<code>Tool Command Language</code>ï¼‰ï¼Œè¿™ä½¿å¾—å®ƒç»“åˆäº†<code>TCL</code>çš„å¼ºå¤§ç¼–ç¨‹èƒ½åŠ›å’Œ<code>Expect</code>æä¾›çš„äº¤äº’å¼è‡ªåŠ¨åŒ–åŠŸèƒ½ã€‚</p>
</li>
</ul>
</blockquote>
<ul>
<li><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>ç³»ç»Ÿç®¡ç†å’Œè‡ªåŠ¨åŒ–è¿ç»´</strong>ï¼š</p>
<p>æ‰¹é‡é…ç½®å’Œç®¡ç†æœåŠ¡å™¨å’Œç½‘ç»œè®¾å¤‡ã€‚</p>
</li>
<li>
<p><strong>æµ‹è¯•å’Œä»¿çœŸ</strong>ï¼š</p>
<p>è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼Œæ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºä»¥æµ‹è¯•ç¨‹åºçš„äº¤äº’æ€§ã€‚</p>
</li>
<li>
<p><strong>åº”ç”¨ç¨‹åºéƒ¨ç½²</strong>ï¼š</p>
<p>åœ¨å¤šä¸ªç¯å¢ƒä¸­è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œé…ç½®åº”ç”¨ç¨‹åºã€‚</p>
</li>
<li>
<p><strong>è¿œç¨‹ç®¡ç†</strong>ï¼š</p>
<p>é€šè¿‡<code>SSH</code>æˆ–<code>Telnet</code>ç­‰åè®®è¿›è¡Œè¿œç¨‹ç®¡ç†å’Œæ“ä½œã€‚</p>
</li>
</ul>
</blockquote>
<ul>
<li><strong>ç¤ºä¾‹ï¼š</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0"><code class="language-expect" data-lang="expect">#!/usr/bin/expect

set username &#34;your_username&#34;
set password &#34;your_password&#34;
set hostname &#34;remote_host&#34;

spawn ssh $username@$hostname
expect &#34;password:&#34;
send &#34;$password\r&#34;
expect &#34;$ &#34;
send &#34;ls -l\r&#34;
expect &#34;$ &#34;
send &#34;exit\r&#34;
expect eof</code></pre></div></blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;expect.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/use/bin/expect
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spawn ssh  root@192.168.1.1  	# spawn:å¼€å¯ä¸€ä¸ªä¼šè¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">expect {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;yes/no&#34; { send &#34;yes\r&#34;; exp_continue }  	# send:ä¼ é€å‚æ•°ï¼Œ\r:å›è½¦é”®, exp_continue:æ²¡å‡ºç°&#34;yes/no&#34;ä¹Ÿæäº¤ ç¬¬äºŒæ¬¡è¿æ¥ä¸ä¼šå‡ºç°ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;password:&#34; { send &#34;å¯†ç \r&#34; };
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">interact  	# åœç•™åœ¨è¢«è¿æ¥ç³»ç»Ÿä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="è¿ç®—ç¬¦ä½¿ç”¨">è¿ç®—ç¬¦ä½¿ç”¨</h3>
<h4 id="å…³ç³»æ•°å€¼è¿ç®—ç¬¦">å…³ç³»(æ•°å€¼)è¿ç®—ç¬¦</h4>
<blockquote>
<table>
<thead>
<tr>
<th>å…³ç³»(æ•°å€¼)è¿ç®—ç¬¦</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-eq</code>ã€<code>==</code></td>
<td>ç­‰äºï¼šæ£€æµ‹ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¿”å›<code>true</code></td>
<td><code>[ $a -eq $b ]</code> è¿”å›ï¼š<code>false</code></td>
</tr>
<tr>
<td><code>-ne</code>ã€<code>!=</code></td>
<td>ä¸ç­‰äºï¼š æ£€æµ‹ä¸¤ä¸ªæ•°æ˜¯å¦ä¸ç›¸ç­‰ï¼Œä¸ç›¸ç­‰è¿”å›<code>true</code></td>
<td><code>[ $a -ne $b ]</code> è¿”å›ï¼š<code>true</code></td>
</tr>
<tr>
<td><code>-gt</code>ã€<code>&gt;</code></td>
<td>å¤§äºï¼šæ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å¤§äºå³è¾¹çš„æ•°ï¼Œå¦‚æœæ˜¯è¿”å›ï¼š<code>true</code></td>
<td><code>[ $a -gt $b ]</code> è¿”å›ï¼š<code>false</code></td>
</tr>
<tr>
<td><code>-lt</code>ã€<code>&lt;</code></td>
<td>å°äºï¼šæ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å°äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯è¿”å›ï¼š<code>true</code></td>
<td><code>[ $a -lt $b ]</code> è¿”å›ï¼š<code>true</code></td>
</tr>
<tr>
<td><code>-ge</code>ã€<code>&gt;=</code></td>
<td>å¤§äºç­‰äºï¼šæ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å¤§äºç­‰äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯è¿”å›ï¼š<code>true</code></td>
<td><code>[ $a -ge $b ]</code> è¿”å›ï¼š<code>false</code></td>
</tr>
<tr>
<td><code>-le</code>ã€<code>&lt;=</code></td>
<td>å°äºç­‰äºï¼šæ£€æµ‹å·¦è¾¹çš„æ•°æ˜¯å¦å°äºç­‰äºå³è¾¹çš„ï¼Œå¦‚æœæ˜¯è¿”å›ï¼š<code>true</code></td>
<td><code>[ $a -le $b ]</code> è¿”å›ï¼š<code>frue</code></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="å­—ç¬¦ä¸²è¿ç®—ç¬¦">å­—ç¬¦ä¸²è¿ç®—ç¬¦</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å­—ç¬¦ä¸²éƒ½ç”¨åŒå¼•å·å¼•èµ·æ¥<!-- raw HTML omitted --><code>&quot; &quot;</code></li>
</ul>
<table>
<thead>
<tr>
<th>å­—ç¬¦ä¸²è¿ç®—ç¬¦</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>=</code></td>
<td>ç­‰äºï¼šæ£€æµ‹ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¿”å›ï¼š<code>true</code></td>
<td><code>[ &quot;$a&quot; = &quot;$b&quot; ]</code> è¿”å›ï¼š<code>false</code></td>
</tr>
<tr>
<td><code>!=</code></td>
<td>ä¸ç­‰äºï¼šæ£€æµ‹ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰è¿”å›ï¼š<code>true</code></td>
<td><code>[ &quot;$a&quot; != &quot;$b&quot; ]</code> è¿”å›ï¼š<code>true</code></td>
</tr>
<tr>
<td><code>-z</code></td>
<td>è¡¨ç¤º 0ï¼šæ£€æµ‹å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º0ï¼Œä¸º0è¿”å›ï¼š<code>true</code></td>
<td><code>[ -z &quot;$a&quot; ]</code> è¿”å›ï¼š<code>false</code></td>
</tr>
<tr>
<td><code>-n</code></td>
<td>è¡¨ç¤ºé0ï¼šæ£€æµ‹å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º0ï¼Œä¸ä¸º0è¿”å›ï¼š<code>true</code></td>
<td><code>[ -n &quot;$a&quot; ]</code></td>
</tr>
<tr>
<td><code>$</code></td>
<td>ä¸ä¸ºç©ºï¼šæ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºè¿”å›ï¼š<code>true</code></td>
<td><code>[ $a ]</code> è¿”å›ï¼š<code>true</code></td>
</tr>
<tr>
<td><code>str</code></td>
<td>æ£€æµ‹<code>str</code>æ˜¯å¦ä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œå¦‚æœä¸ºç©ºè¿”å›ï¼š<code>false</code></td>
<td><code>[ $a ]</code> ä¸æ˜¯å‡çš„</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="é€»è¾‘è¿ç®—ç¬¦">é€»è¾‘è¿ç®—ç¬¦</h4>
<blockquote>
<table>
<thead>
<tr>
<th>é€»è¾‘è¿ç®—ç¬¦</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&amp;&amp;</code></td>
<td>é€»è¾‘çš„ï¼š<code>and</code>ï¼Œå’Œ/å¹¶ä¸”ï¼šçš„æ„æ€</td>
<td><code>[[ $a -lt 100 &amp;&amp; $b -gt 100 ]]</code> è¿”å›ï¼š<code>false</code>ï¼Œ<!-- raw HTML omitted --><code>./configure &amp;&amp; make &amp;&amp; make install</code></td>
</tr>
<tr>
<td><code>||</code></td>
<td>é€»è¾‘çš„ï¼š<code>or</code>ï¼Œæˆ–è€…/å¦åˆ™ï¼šçš„æ„æ€</td>
<td><code>[[ $a -lt 100 || $b -gt 100 ]]</code> è¿”å›ï¼š<code>true</code>ï¼Œ<!-- raw HTML omitted --> <code>cat /opt/a.txt || touch /opt/a.txt</code></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="å¸ƒå°”è¿ç®—ç¬¦">å¸ƒå°”è¿ç®—ç¬¦</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¸ƒå°”è¿ç®—ç¬¦åªæœ‰ï¼šçœŸ(<code>True</code>)/å‡(<code>False</code>)<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>å¸ƒå°”è¿ç®—ç¬¦</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>!</code></td>
<td>éï¼šè¿ç®—ç¬¦ï¼šè¡¨è¾¾å¼ä¸º<code>true</code>åˆ™è¿”å›<code>false</code>ï¼Œ å¦åˆ™è¿”å›ï¼š<code>true</code></td>
<td><code>[ ! false ]</code> è¿”å›ï¼š<code>true</code></td>
</tr>
<tr>
<td><code>-o</code></td>
<td>æˆ–ï¼šè¿ç®—ç¬¦ï¼šæœ‰ä¸€ä¸ªè¡¨è¾¾å¼ä¸ºï¼š<code>true</code>åˆ™è¿”å›<code>true</code></td>
<td><code>[ $a -lt 20 -o $b -gt 100 ]</code>ï¼Œ è¿”å›ï¼š<code>true</code></td>
</tr>
<tr>
<td><code>-a</code></td>
<td>ä¸ï¼šè¿ç®—ç¬¦ï¼šä¸¤ä¸ªè¡¨è¾¾å¼éƒ½ä¸ºï¼š<code>true</code>æ‰è¿”å›ï¼š<code>true</code></td>
<td><code>[ $a -lt 20 -a $b -gt 100 ]</code>ï¼Œ è¿”å›ï¼š<code>false</code></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="ç®—æ•°è¿ç®—ç¬¦">ç®—æ•°è¿ç®—ç¬¦</h4>
<blockquote>
<table>
<thead>
<tr>
<th>ç®—æ•°è¿ç®—ç¬¦</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>+</code></td>
<td>åŠ æ³•ï¼Œ<code>Python</code><!-- raw HTML omitted -->ä¸­æ”¯æŒï¼šå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å…ƒç»„åˆå¹¶<!-- raw HTML omitted --></td>
<td><code>expr $a + $b</code>ç»“æœä¸º30</td>
</tr>
<tr>
<td><code>-</code></td>
<td>å‡æ³•ï¼Œ<code>Python</code><!-- raw HTML omitted -->ä¸­æ”¯æŒï¼šé›†åˆï¼Œæ±‚å·®å¼‚<!-- raw HTML omitted --></td>
<td><code>expr $a - $b</code>ç»“æœä¸º<code>-10</code></td>
</tr>
<tr>
<td><code>*</code></td>
<td>ä¹˜æ³•ï¼Œ<code>Python</code><!-- raw HTML omitted -->ä¸­æ”¯æŒï¼šå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å…ƒç»„ï¼Œå¤åˆ¶<!-- raw HTML omitted --></td>
<td><code>expr $a \* $b</code>ç»“æœä¸º200</td>
</tr>
<tr>
<td><code>/</code></td>
<td>é™¤æ³•ï¼Œ<code>Python</code><!-- raw HTML omitted -->ä¸­æ•´æ•°ç›¸é™¤å¾—åˆ°æµ®ç‚¹æ•°<code>float</code>ï¼Œ<code>//</code>ä¸ºæ•´é™¤<!-- raw HTML omitted --></td>
<td><code>expr $b / $a</code>ç»“æœä¸º2</td>
</tr>
<tr>
<td><code>%</code></td>
<td>å–ä½™(æ¨¡ä½™)</td>
<td><code>expr $b % $a</code>ç»“æœä¸º0</td>
</tr>
<tr>
<td><code>=</code></td>
<td>èµ‹å€¼</td>
<td><code>a=$b</code>å°†æŠŠå˜é‡<code>b</code>èµ‹å€¼ç»™<code>a</code></td>
</tr>
<tr>
<td><code>==</code></td>
<td>ç›¸ç­‰ï¼šç”¨äºæ¯”è¾ƒä¸¤ä¸ªæ•°å­—ï¼Œç›¸åŒåˆ™è¿”å›ï¼š<code>true</code></td>
<td><code>[ $a == $b ]</code> è¿”å›ï¼š<code>false</code></td>
</tr>
<tr>
<td><code>**</code></td>
<td>å¹‚è¿ç®—ï¼Œå‡ çš„æ¬¡æ–¹</td>
<td>2çš„5æ¬¡æ–¹=<code>2*2</code>=<code>4*2</code>=<code>8*2</code>=<code>16*2</code>=32</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="æ–‡ä»¶æµ‹è¯•">æ–‡ä»¶æµ‹è¯•</h4>
<blockquote>
<table>
<thead>
<tr>
<th>æ–‡ä»¶å‚æ•°</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-e</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™ä¸ºçœŸ</td>
<td>`[ -e dir</td>
</tr>
<tr>
<td><code>-r</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”å½“å‰ç”¨æˆ·å¯è¯»åˆ™ä¸ºçœŸï¼Œæ˜¯å¦å¯ä»¥è¯»å–</td>
<td><code>[ -r $file ]</code></td>
</tr>
<tr>
<td><code>-w</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”å½“å‰ç”¨æˆ·å¯å†™åˆ™ä¸ºçœŸï¼Œæ˜¯å¦æœ‰å¯ä»¥å†™å…¥</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-x</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”å½“å‰ç”¨æˆ·å¯æ‰§è¡Œåˆ™ä¸ºçœŸï¼Œæ˜¯å¦æœ‰æ‰§è¡Œæƒé™</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-s</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå­—ç¬¦åˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-d</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”ä¸ºç›®å½•åˆ™ä¸ºçœŸ</td>
<td><code>[ -d /home ]</code> æ˜¯å¦ä¸ºç›®å½•<!-- raw HTML omitted --><code>[ ! -d /home ]</code> å–å</td>
</tr>
<tr>
<td><code>-f</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”ä¸ºæ™®é€šæ–‡ä»¶åˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-c</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”ä¸ºå­—ç¬¦å‹ç‰¹æ®Šæ–‡ä»¶åˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-b</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”ä¸ºå—ç‰¹æ®Šæ–‡ä»¶åˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-g</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”è®¾ç½®<code>SGID</code>åˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-k</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”è®¾ç½®äº†<code>ç²˜ç€ä½(Sticky Bit)</code>åˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”æ˜¯ï¼šåç®¡é“ï¼Œåˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-u</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”è®¾ç½®<code>SUID</code>åˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”æ–‡ä»¶æè¿°ç¬¦å·²æ‰“å¼€å¹¶ä¸ç»ˆç«¯å…³è”åˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-z</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”å¤§äº<code>0</code>åˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-o</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”å½“å‰ç”¨æˆ·æ˜¯æ–‡ä»¶æ‰€æœ‰è€…åˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-S</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”æ˜¯<code>socket</code>æ–‡ä»¶åˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-L</code></td>
<td>å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”æ˜¯è¿æ¥æ–‡ä»¶åˆ™ä¸ºçœŸ</td>
<td>&mdash;</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="ä¼ å‚å‚æ•°å¤„ç†">ä¼ å‚å‚æ•°å¤„ç†</h4>
<blockquote>
<table>
<thead>
<tr>
<th>å‚æ•°å¤„ç†</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$#</code></td>
<td>ä¼ å…¥è„šæœ¬çš„å‚æ•°ä¸ªæ•°</td>
<td><code>[ $# -eq 0 ]</code></td>
</tr>
<tr>
<td><code>$*</code></td>
<td>ä¼ å…¥è„šæœ¬çš„æ‰€æœ‰å‚æ•°</td>
<td>å¦‚<code>&quot;$*&quot;</code>ç”¨<code>&quot; &quot;</code>æ‹¬èµ·æ¥çš„æƒ…å†µï¼Œä»¥<code>&quot;$1 $2 ... $n&quot;</code>çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°</td>
</tr>
<tr>
<td><code>$$</code></td>
<td>å½“å‰<code>shell</code>çš„è¿›ç¨‹å·ï¼Œå¯¹äº<code>shell</code>è„šæœ¬ï¼Œè¿™æ˜¯å®ƒä»¬æ‰§è¡Œçš„è¿›ç¨‹<code>ID</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>$!</code></td>
<td><code>Shell</code>åå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹<code>Process</code>çš„<code>PID</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>$@</code></td>
<td>ä¸<code>$*</code>ç›¸åŒï¼Œä½†æ˜¯ä½¿ç”¨æ—¶åŠ å¼•å·ï¼Œå¹¶åœ¨å¼•å·ä¸­è¿”å›æ¯ä¸ªå‚æ•°ï¼Œå¦‚<code>&quot;$@&quot;</code>ç”¨<code>&quot; &quot;</code>æ‹¬èµ·æ¥ï¼Œä»¥<code>&quot;$1&quot; &quot;$2&quot; ... &quot;$n&quot;</code>çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°</td>
<td>å…¶ä¸­<code>$@</code>ä¸<code>$*</code>æ­£å¸¸æƒ…å†µä¸‹ä¸€æ ·ï¼Œå½“åœ¨è„šæœ¬ä¸­å°†<code>$*</code>åŠ ä¸ŠåŒå¼•å·ä½œä¸º<code>â€œ$*â€</code>å¼•ç”¨æ—¶ï¼Œæ­¤æ—¶å°†è¾“å…¥çš„æ‰€æœ‰å‚æ•°å½“åšä¸€ä¸ªæ•´ä½“å­—ç¬¦ä¸²å¯¹å¾…ã€‚æ¯”å¦‚è¾“å…¥å‚æ•°æœ‰<code>a b c</code>ä¸‰ä¸ªå‚æ•°ï¼Œåˆ™<code>â€œ$*â€</code>è¡¨ç¤º<code>â€œa b câ€</code>ä¸€ä¸ªå­—ç¬¦ä¸²</td>
</tr>
<tr>
<td><code>$-</code></td>
<td>æ˜¾ç¤º<code>shell</code>ä½¿ç”¨çš„å½“å‰é€‰é¡¹ï¼Œä¸<code>set</code>å‘½ä»¤åŠŸèƒ½ç›¸åŒ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>$?</code></td>
<td>æ˜¾ç¤ºæœ€åå‘½ä»¤é€€å‡ºçŠ¶æ€ï¼Œ0è¡¨ç¤ºæ²¡æœ‰é”™è¯¯ï¼Œå…¶ä»–ä»»ä½•å€¼è¡¨æ˜æœ‰é”™è¯¯</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>$0</code></td>
<td>å½“å‰è„šæœ¬æ–‡ä»¶å</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>$1ï½$n</code></td>
<td>è¿™äº›å˜é‡å¯¹åº”è°ƒç”¨è„šæœ¬çš„å‚æ•°ï¼Œè¿™é‡Œçš„<code>n</code>æ˜¯å¯¹åº”äºå‚æ•°ä½ç½®çš„æ­£åè¿›åˆ¶æ•°(ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>$1</code>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯<code>$2</code>ï¼Œä¾æ­¤ç±»æ¨)</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>$#</code></td>
<td>æä¾›ç»™è„šæœ¬çš„å‚æ•°æ•°é‡</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>$</code></td>
<td>å½“å‰è¿è¡Œè„šæœ¬çš„è¿›ç¨‹<code>ID</code>å·</td>
<td>&mdash;</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="printfçš„è½¬ä¹‰åºåˆ—"><code>Printf</code>çš„è½¬ä¹‰åºåˆ—</h4>
<blockquote>
<table>
<thead>
<tr>
<th><code>printf</code>çš„è½¬ä¹‰åºåˆ—</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\a</code></td>
<td>è­¦å‘Šå­—ç¬¦ï¼Œé€šå¸¸ä¸º<code>ASCII</code>çš„<code>BEL</code>å­—ç¬¦</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>\b</code></td>
<td>åé€€</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>\c</code></td>
<td>æŠ‘åˆ¶(ä¸æ˜¾ç¤º)è¾“å‡ºç»“æœä¸­ä»»ä½•ç»“å°¾çš„æ¢è¡Œå­—ç¬¦(åªåœ¨<code>%</code>æ ¼å¼æŒ‡ç¤ºç¬¦æ§åˆ¶ä¸‹çš„å‚æ•°å­—ç¬¦ä¸²ä¸­æœ‰æ•ˆ)ï¼Œè€Œä¸”ä»»ä½•ç•™åœ¨å‚æ•°é‡Œçš„å­—ç¬¦ï¼Œä»»ä½•æ¥ä¸‹æ¥çš„å‚æ•°ä»¥åŠä»»ä½•ç•™åœ¨æ ¼å¼å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Œéƒ½è¢«å¿½ç•¥</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>\f</code></td>
<td>æ¢é¡µ<code>formfedd</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>\n</code></td>
<td>æ¢è¡Œ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>\r</code></td>
<td>å›è½¦<code>Carriage return</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>\t</code></td>
<td>æ°´å¹³åˆ¶è¡¨ç¬¦ï¼Œç±»ä¼¼ï¼š<code>Tab</code>é”®ï¼Œå››ä¸ªç©ºæ ¼é”®</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>\v</code></td>
<td>å‚ç›´åˆ¶è¡¨ç¬¦</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>\\</code></td>
<td>ä¸€ä¸ªå­—é¢ä¸Šçš„åæ–œæ å­—ç¬¦</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>\ddd</code></td>
<td>è¡¨ç¤º1åˆ°3ä½æ•°å…«è¿›åˆ¶å€¼å¾—å­—ç¬¦ï¼Œä»…åœ¨æ ¼å¼å­—ç¬¦ä¸²ä¸­æœ‰æ•ˆ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>\0ddd</code></td>
<td>è¡¨ç¤º1åˆ°3ä½å¾—å…«è¿›åˆ¶å­—ç¬¦</td>
<td>&mdash;</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ ¼å¼åŒ–è¾“å‡ºä¸¤ç§æ–¹å¼</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬ä¸€ç§</span>
</span></span><span style="display:flex;"><span>$ echo -e  <span style="color:#e6db74">&#34;a\tb&#34;</span>ï¼Œ<span style="color:#ae81ff">\t</span>:Tab<span style="color:#f92672">(</span>é”®<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬äºŒç§</span>
</span></span><span style="display:flex;"><span>$ printf <span style="color:#e6db74">&#34;%-10s %-8s %-4s\n&#34;</span> å§“å æ€§åˆ« ä½“é‡kg  
</span></span><span style="display:flex;"><span>$ printf <span style="color:#e6db74">&#34;%-10s %-8s %-4.2f\n&#34;</span> éƒ­é– ç”· 66.1234
</span></span><span style="display:flex;"><span>$ printf <span style="color:#e6db74">&#34;%-10s %-8s %-4.2f\n&#34;</span> æ¨è¿‡ ç”· 48.6543
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>%s %c %d %f  	<span style="color:#75715e"># éƒ½æ˜¯æ ¼å¼æ›¿ä»£ç¬¦ï¼Œ</span>
</span></span><span style="display:flex;"><span>ï¼…s  	<span style="color:#75715e"># è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ</span>
</span></span><span style="display:flex;"><span>ï¼…d  	<span style="color:#75715e"># æ•´å‹è¾“å‡ºï¼Œ</span>
</span></span><span style="display:flex;"><span>ï¼…c  	<span style="color:#75715e"># è¾“å‡ºä¸€ä¸ªå­—ç¬¦ï¼Œ</span>
</span></span><span style="display:flex;"><span>ï¼…f  	<span style="color:#75715e"># è¾“å‡ºå®æ•°ï¼Œä»¥å°æ•°å½¢å¼è¾“å‡ºã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>%-10s  	<span style="color:#75715e"># æŒ‡ä¸€ä¸ªå®½åº¦ä¸º 10 ä¸ªå­—ç¬¦ï¼ˆ- è¡¨ç¤ºå·¦å¯¹é½ï¼Œæ²¡æœ‰åˆ™è¡¨ç¤ºå³å¯¹é½ï¼‰ï¼Œä»»ä½•å­—ç¬¦éƒ½ä¼šè¢«æ˜¾ç¤ºåœ¨ 10 ä¸ªå­—ç¬¦å®½çš„å­—ç¬¦å†…ï¼Œå¦‚æœä¸è¶³åˆ™è‡ªåŠ¨ä»¥ç©ºæ ¼å¡«å……ï¼Œè¶…è¿‡ä¹Ÿä¼šå°†å†…å®¹å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥ã€‚</span>
</span></span><span style="display:flex;"><span>%-4.2f  	<span style="color:#75715e"># æŒ‡æ ¼å¼åŒ–ä¸ºå°æ•°ï¼Œå…¶ä¸­ .2 æŒ‡ä¿ç•™2ä½å°æ•°ã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ printf <span style="color:#e6db74">&#34;\e[?2004l&#34;</span>  	<span style="color:#75715e"># è§£å†³å‘½ä»¤è¡Œç»ˆç«¯å¤åˆ¶ç²˜è´´å‡ºç° 0~ 1~ é—®é¢˜ï¼Œæ‹¬å·ç²˜è´´æ¨¡å¼ã€‚ æˆ–è€…ï¼šreset</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="è¿ç®—ç¬¦æè¿°">è¿ç®—ç¬¦æè¿°</h4>
<blockquote>
<table>
<thead>
<tr>
<th>è¿ç®—ç¬¦æè¿°</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>()</code></td>
<td>æ”¹å˜ä¼˜å…ˆé¡ºåºï¼Œ</td>
<td>å°æ‹¬å·å­<code>shell</code>ä¸­æ‰§è¡Œå‘½ä»¤ï¼š<code>(ls)</code></td>
</tr>
<tr>
<td><code>(())</code></td>
<td>æ•°å€¼æ¯”è¾ƒï¼Œè¿ç®—</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>$()</code></td>
<td>å‘½ä»¤æ›¿æ¢ã€ç›¸å½“äºåæ’‡å·: ``</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>$(())</code></td>
<td>æ•´æ•°è¿ç®—</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>[]</code></td>
<td>æ¡ä»¶æµ‹è¯•ã€åŒ¹é…æ–¹æ‹¬å·ä¸­ä»»æ„<code>ä¸€ä¸ª</code>å­—ç¬¦</td>
<td><code>[a-z] [0-9] [a-zA-Z0-9] å–å:[^a-zA-Z0-9]</code></td>
</tr>
<tr>
<td><code>[[]]</code></td>
<td>æ¡ä»¶æµ‹è¯•ï¼Œæ”¯æŒæ­£åˆ™ <code>=~</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>$[]</code></td>
<td>æ•´æ•°è¿ç®—</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>{}</code></td>
<td>æ‰“æ‹¬å·ä½¿ç”¨æ–¹å¼</td>
<td><code>mkdir -pv /opt/{aaa/{111,222},bbb}ã€cp nginx.conf{,.bak}ã€{1..9}</code></td>
</tr>
<tr>
<td><code>${}</code></td>
<td>&mdash;</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>~1</code></td>
<td>çš„è¡¥å……</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>!</code></td>
<td>é€»è¾‘å¦å®š</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>!~</code></td>
<td>é€»è¾‘å¦å®šï¼šäºŒè¿›åˆ¶åè½¬ï¼ˆä¸€ä¸ªè¡¥ç ï¼‰</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>&lt;&lt;</code></td>
<td>å·¦ç§»</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>&gt;&gt;</code></td>
<td>å³ç§»</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>=~</code></td>
<td>åŒ¹é…æ¨¡å¼</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>&amp;</code></td>
<td><code>Bitwise</code>å’Œ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>^</code></td>
<td>æŒ‰ä½&quot;ç‹¬å æˆ–&quot;</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>|</code></td>
<td>æŒ‰ä½&quot;åŒ…å®¹æ€§&quot; æˆ–</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>++</code></td>
<td>é€’å¢</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>---</code></td>
<td>é€’å‡</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>*=</code></td>
<td>å·¦ä¾§ä¹˜ä»¥å³ä¾§å¹¶æ›´æ–°å·¦ä¾§</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>/=</code></td>
<td>å°†å·¦ä¾§é™¤ä»¥</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>+=</code></td>
<td>å°†å·¦ä¾§æ·»åŠ åˆ°å³ä¾§å¹¶æ›´æ–°å·¦ä¾§</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>-+</code></td>
<td>å°†å³ä¾§å‡å»å·¦ä¾§å¹¶æ›´æ–°å·¦ä¾§</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>^=</code></td>
<td>&ldquo;ç‹¬å æˆ–&quot;å·¦ä¾§åˆ°å³ä¾§å¹¶æ›´æ–°å·¦ä¾§</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>%=</code></td>
<td>å·¦ä¾§é™¤ä»¥å³ä¾§ï¼Œä½™æ•°æ›´æ–°å†å·¦ä¾§</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>;</code></td>
<td>æ‰§è¡Œå¤šä¸ªå‘½ä»¤</td>
<td><code>cat /etc/passwd; ls</code></td>
</tr>
<tr>
<td><code>\</code></td>
<td>è½¬æ„ç¬¦</td>
<td><code>&quot;touch  linux\ nginxã€\t:Tab(é”®)ã€\n:(æ¢è¡Œ)ã€\c:(ä¸æ¢è¡Œè¾“å‡º)&quot;</code></td>
</tr>
<tr>
<td><code>true</code></td>
<td>æ°¸è¿œè¿”å›ä¸ºçœŸ<code>0</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>false</code></td>
<td>æ°¸è¿œè¿”å›ä¸ºå‡<code>1</code></td>
<td>&mdash;</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="æ¡ä»¶è¯­å¥">æ¡ä»¶è¯­å¥</h4>
<blockquote>
<table>
<thead>
<tr>
<th>æ¡ä»¶è¯­å¥</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>if</code></td>
<td>å¦‚æœä»€ä¹ˆä»€ä¹ˆ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>then</code></td>
<td>ç„¶åæ€ä¹ˆæ€ä¹ˆ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>elif</code></td>
<td>å…¶å®ƒæ€ä¹ˆæ€ä¹ˆï¼Œ<code>elif</code>æ˜¯<code>if</code>æœ‰å¤šä¸ªè¯­å¥æ¡ä»¶</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>else</code></td>
<td>å¦åˆ™æ€ä¹ˆæ€ä¹ˆ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>fi</code></td>
<td>ç»“æŸï¼š<code>if</code>åˆ¤æ–­å¥ç»“æŸè¯­</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>case</code></td>
<td>å¾ªç¯è¯­å¥å¼€å§‹å®šä¹‰</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>esac</code></td>
<td>å¾ªç¯è¯­å¥ç»“æŸå®šä¹‰</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>while</code></td>
<td>æ¡ä»¶ä¸ºçœŸå¾ªç¯</td>
<td>å¤–å¾ªç¯æ§åˆ¶è¡Œæ•°ï¼Œå†…å¾ªç¯æ§åˆ¶åˆ—æ•°ï¼Œå†…å¾ªç¯å°äºç­‰äºå¤–å¾ªç¯</td>
</tr>
<tr>
<td><code>unitl</code></td>
<td>æ¡ä»¶ä¸ºå‡å¾ªç¯</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>select</code></td>
<td>å¾ªç¯ã€æŸ¥è¯¢</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>in</code></td>
<td>åœ¨ä»€ä¹ˆä»€ä¹ˆ</td>
<td><code>Python</code><!-- raw HTML omitted -->ä¸­æ”¯æŒï¼šå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸ï¼Œæ£€æµ‹å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä¸ä¹‹ç›¸åçš„æ˜¯ï¼š<!-- raw HTML omitted --><code>not in</code></td>
</tr>
<tr>
<td><code>do</code></td>
<td>åš/æ‰§è¡Œä»€ä¹ˆä»€ä¹ˆ</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>done</code></td>
<td>ç»“æŸå¾ªç¯</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>unset</code></td>
<td>åˆ é™¤å˜é‡</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>readonly</code></td>
<td>åªè¯»å˜é‡</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>read</code></td>
<td>è¯»å–è¾“å…¥å˜é‡å</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>clear</code></td>
<td>åˆ é™¤ã€æ¸…é™¤</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>break</code></td>
<td>è·³å‡ºæ•´ä¸ªå¾ªç¯ï¼Œ<code>n</code>æŒ‡å®šçš„ç¬¬<code>n</code>ä¸ªå°é—­å¾ªç¯ï¼Œé€€å‡ºå¯ä»¥æ˜¯<code>1ã€2ã€3</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>continue</code></td>
<td>å½“å‰è¿­ä»£å¾ªç¯é€€å‡º</td>
<td>&mdash;</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="é‡å®šå‘å‚æ•°">é‡å®šå‘å‚æ•°</h4>
<blockquote>
<table>
<thead>
<tr>
<th>é‡å®šå‘</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>command &gt; file</code></td>
<td>å°†è¾“å‡ºé‡å®šå‘åˆ°ï¼š<code>file</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>command &lt; file</code></td>
<td>å°†è¾“å…¥é‡å®šå‘åˆ°ï¼š<code>file</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>command &gt;&gt; file</code></td>
<td>å°†è¾“å‡ºä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ°ï¼š<code>file</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>n &gt; file</code></td>
<td>å°†æ–‡ä»¶æè¿°ç¬¦ä¸º<code>n</code>çš„æ–‡ä»¶é‡å®šå‘åˆ°ï¼š<code>file</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>n &gt;&gt; file</code></td>
<td>å°†æ–‡ä»¶æè¿°ç¬¦ä¸º<code>n</code>çš„æ–‡ä»¶ä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ°ï¼š<code>file</code></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>n &gt;&amp; m</code></td>
<td>å°†è¾“å‡ºæ–‡ä»¶<code>m</code>å’Œ<code>n</code>åˆå¹¶</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>n &lt;&amp; m</code></td>
<td>å°†è¾“å…¥æ–‡ä»¶<code>m</code>å’Œ<code>n</code>åˆå¹¶</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>&lt;&lt; tag</code></td>
<td>å°†å¼€å§‹æ ‡è®°<code>tag</code>å’Œç»“æŸæ ‡è®°<code>tag</code>ä¹‹é—´çš„å†…å®¹ä½œä¸ºè¾“å…¥</td>
<td>&mdash;</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h4 id="å¤šè¡Œæ³¨é‡Š">å¤šè¡Œæ³¨é‡Š</h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>:<span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:&lt;&lt;<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:&lt;&lt;!
</span></span><span style="display:flex;"><span>!</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å®æˆ˜è„šæœ¬">å®æˆ˜è„šæœ¬</h3>
<h4 id="å®æˆ˜è„šæœ¬ä¸€">å®æˆ˜è„šæœ¬ä¸€</h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;#!/usr/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æç¤ºç”¨æˆ·æ²¡æœ‰åŠ å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ $# -eq 0 ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo &#34;æ‰§è¡Œæ–¹å¼: `basename $0` æ–‡ä»¶å(file)&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> exit  # é€€å‡º
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æç¤ºè¾“å…¥çš„ä¸æ˜¯æ–‡ä»¶: ! å–å:ä¸æ˜¯æ–‡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -f $1 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo &#34;é”™è¯¯çš„æ–‡ä»¶å&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ­£ç¡®æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for IP in `cat $1`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">do 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> ping -c1 $IP &amp;&gt;/dev/null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> if [ $? -eq 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     echo &#34;${IP} is up&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     echo &#34;${IP} is down&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span> &gt;ping.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./ping.sh ip.txt</span></span></code></pre></div></blockquote>
<hr>
<h4 id="å®æˆ˜è„šæœ¬äºŒ">å®æˆ˜è„šæœ¬äºŒ</h4>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;#!/usr/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">read -p &#34;è¯·è¾“å…¥æ•°å­—: &#34; num
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">while true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    if [[ &#34;$num&#34; =~ ^[0-9]+$ ]];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        break   # è·³å‡ºå¾ªç¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#34;ä½ è¾“å…¥çš„ä¸æ˜¯æ•°å­—ï¼ï¼ï¼&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        read -p &#34;è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥: &#34; num
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">read -p &#34;è¯·è¾“å…¥åˆ›å»ºçš„ç”¨æˆ·é¦–å­—æ¯: &#34; prefix
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ -z &#34;$prefix&#34; ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    echo &#34;é”™è¯¯çš„é¦–å­—æ¯(prefix)&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for i in `seq $num`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    user=$prefix$i
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    useradd $user
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    echo &#34;123&#34; |passwd --stdin $user &amp;&gt;/dev/null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    if [ $? -eq 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#34;$user åˆ›å»ºæˆåŠŸ&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done  &#39;</span> &gt;useradd.sh</span></span></code></pre></div></blockquote>
<hr>
<h4 id="å®æˆ˜è„šæœ¬ä¸‰">å®æˆ˜è„šæœ¬ä¸‰</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ¸…ç†<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->ç¼“å­˜<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;/opt/delete-cache.sh&#39;</span> &gt;&gt;/home/neek/.bash_profile  	<span style="color:#75715e"># ç™»å½•å³æ‰§è¡Œè„šæœ¬</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;delete-cache.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/usr/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#trap &#34;&#34; HUP INT OUIT TSTP #é˜²æ­¢åœ¨è„šæœ¬ä¸­é€€å‡º
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#clear
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">directory=/opt/data/cache
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/usr/bin/ansible web -i /etc/ansible/hosts -m shell  -a &#34;/usr/bin/rm -rf ${directory}/directory.log&#34; -f 5 &amp;&gt;/dev/null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/usr/bin/rm -rf /opt/data/Tenant.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/usr/bin/ls ${directory}/ |tee /opt/data/Tenant.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -e &#34;\e[1;36m \t\t\t+------------------------------------------+\t\t\t \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -e &#34;\e[1;31m \t\t\t|	      	æ¸…ç†ç§Ÿæˆ·ç¼“å­˜		   |\t\t\t \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -e &#34;\e[1;36m \t\t\t+------------------------------------------+\t\t\t \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -e &#34;\e[1;36m \t\t\t|   (0) é€€å‡º				   |\t\t\t \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -e &#34;\e[1;33m \t\t\t|   (1)è¾“å…¥è¦åˆ é™¤çš„ç›®å½•ä¾‹å¦‚ï¼šh5ã€webã€ldyã€‚|\t\t\t \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -e &#34;\e[1;31m \t\t\t|   (2)è¾“å…¥&#39;2&#39;åˆ é™¤ç§Ÿæˆ·ç›®å½•ä¸‹æ‰€æœ‰ç¼“å­˜	   |\t\t\t \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -e &#34;\e[1;31m \t\t\t|   (3)è¾“å…¥&#39;3&#39;åˆ é™¤æ‰€æœ‰ç§Ÿæˆ·ç¼“å­˜		   |\t\t\t \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -e &#34;\e[1;36m \t\t\t+------------------------------------------+\t\t\t \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -en &#34;\e[1;36mé€‰æ‹©è¦æ¸…ç†çš„ç§Ÿæˆ·ç¼“å­˜[0-3]: \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">read ID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">while :;do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	if [[ &#34;$ID&#34; =~ ^[0-9]$ ]];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		break
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		echo -en &#34;\e[1;31mè¾“å…¥é”™è¯¯è¯·é‡æ–°è¾“å…¥[0-3]: \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		read ID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">while :;do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	case $ID in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		0)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 exit;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		1)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 echo -en &#34;\e[1;36mè¯·è¾“å…¥ç§Ÿæˆ·ç›®å½•: \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 read  Name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 /usr/bin/ls ${directory}/${Name}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 echo -en &#34;\e[1;36mè¯·è¾“å…¥è¦æ¸…ç†ç¼“å­˜çš„ç»ˆç«¯:h5ã€webã€ldyä¸­çš„ä¸€ä¸ªï¼š \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 read  cache
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 if [ -d ${directory}/${Name}/${cache}/ ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			/usr/bin/ansible web -i /etc/ansible/hosts -m shell  -a &#34;rm -rf ${directory}/${Name}/${cache}&#34; -f 5 &amp;&gt;/dev/null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			echo &#34;å·²æ¸…ç†ç§Ÿæˆ·${Name}ç›®å½•ä¸‹${cache}ç›®å½•ä¸­çš„ç¼“å­˜&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			echo &#34;ç›®å½•ä¸å­˜åœ¨&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 fi;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		2)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 echo -en &#34;\e[1;36mè¯·è¾“å…¥è¦æ¸…ç†ç¼“å­˜çš„ç§Ÿæˆ·ç›®å½•: \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 read  Name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	 	 if [ -d ${directory}/${Name} ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			/usr/bin/ansible web -i /etc/ansible/hosts -m shell  -a &#34;rm -rf ${directory}/${Name}/*&#34; -f 5 &amp;&gt;/dev/null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			echo &#34;å·²æ¸…ç†ç§Ÿæˆ·${Name}ç›®å½•ä¸‹æ‰€æœ‰ç¼“å­˜&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 fi;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		3)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 echo -en &#34;\e[1;31mç¡®è®¤è¦æ¸…ç†æ‰€æœ‰ç§Ÿæˆ·ç¼“å­˜å—[y/n]: \e[0m&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 read y
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		 if [ &#34;$y&#34; = &#34;y&#34; ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			/usr/bin/ansible web -i /etc/ansible/hosts -m shell  -a &#34;rm -rf ${directory}/*&#34; -f 5 &amp;&gt;/dev/null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			echo &#34;å·²æ¸…ç†æ‰€æœ‰ç§Ÿæˆ·ç¼“å­˜&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			for mk in `cat /opt/data/Tenant.txt`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				/usr/bin/ansible web -i /etc/ansible/hosts -m shell  -a &#34;/usr/bin/mkdir -pv ${directory}/${mk} &gt;&gt;${directory}/directory.log&#34; -f 5 &amp;&gt;/dev/null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				if [ $? -eq 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					echo &#34;${mk} create ok&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">					echo &#34;${mk} create error&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">				fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			echo &#34;è¾“å…¥ä¸æ˜¯â€™yâ€˜é€€å‡º&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		fi;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	esac
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h4 id="å®æˆ˜è„šæœ¬å››">å®æˆ˜è„šæœ¬å››</h4>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹ç³»ç»Ÿ<!-- raw HTML omitted --><code>IP</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;Update-Ip.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;###input ip you want change to ### &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ipfront=192.168.0.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">read -p &#34;è¯·è¾“å…¥ç»“å°¾IP:&#34; ip1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ip=&#34;${ipfront}${ip1}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;###ip====&#34; $ip &#34;###&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">eth=`find /etc/sysconfig/network-scripts/ -name &#34;ifcfg-e*&#34; |sort |head -1 |awk -F/ &#39;{print $5}&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ethfile=&#34;/etc/sysconfig/network-scripts/$eth&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;${ethfile}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#34;s/BOOTPROTO=&#39;dhcp&#39;/BOOTPROTO=&#39;static&#39;/g&#34; &#34;${ethfile}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sed -i &#34;s/^ONBOOT=no/ONBOOT=yes/g&#34; &#34;${ethfile}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">testfile=&#34;/etc/sysconfig/network-scripts/test&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;IPADDR=${ip}&#34; &gt;&gt;${ethfile}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;NETMASK=255.255.255.0&#34; &gt;&gt;${ethfile}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;GATEWAY=192.168.0.1&#34; &gt;&gt;${ethfile}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;DNS1=8.8.8.8&#34; &gt;&gt;${ethfile}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;DNS2=1.1.1.1&#34; &gt;&gt;${ethfile}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">systemctl restart network
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo $?
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="é…ç½®linuxç³»ç»Ÿç™»å½•å‘Šè­¦">é…ç½®<code>Linux</code>ç³»ç»Ÿç™»å½•å‘Šè­¦</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>sshd</code><!-- raw HTML omitted -->ç™»å½•å‘Šè­¦<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/ssh/sshrc<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/sh
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_TOKEN=&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_GROUP_ID=&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è·å–ç”¨æˆ·ã€IPåœ°å€ã€æ—¶é—´å’ŒæœåŠ¡å™¨ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_NAME=$USER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">HOST_NAME=$(hostname -s)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATA_TIME=$(date +&#34;%F %H:%M:%S&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LOCALHOST=$(hostname -I | awk &#39;{print $1}&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LOGGIN_IP=$(echo $SSH_CLIENT | awk &#39;{print $1}&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ„é€ é€šçŸ¥æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">msg=&#34;æœ‰ç™½åå•ä¹‹å¤–çš„ IP ç™»å½•æœåŠ¡å™¨ï¼Œè¯·éªŒè¯:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">User: ${USER_NAME}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Host: ${LOCALHOST}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Login IP: ${LOGGIN_IP}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Login Time: ${DATA_TIME}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Host Name: ${HOST_NAME}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å®šä¹‰ä¿¡ä»»çš„IPåœ°å€åˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IP_WhiteList=&#39;192.168.1.100&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">result=$(echo ${IP_WhiteList} | grep &#34;${LOGGIN_IP}&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ &#34;${result}&#34; != &#34;&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        exit 0  # å¦‚æœåœ¨ä¿¡ä»»åˆ—è¡¨ä¸­ï¼Œé€€å‡ºè„šæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${msg}&#34; &gt; /dev/null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="storage">Storage</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Storage</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_nfs">Install_NFS</h1>

<h1 id="nfséƒ¨ç½²"><code>NFS</code>éƒ¨ç½²</h1>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo apt-get install nfs-kernel-server  	<span style="color:#75715e"># Debianç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>$ yum install -y nfs-utils rpcbind  	<span style="color:#75715e"># CentOSç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install nfs-utils  	<span style="color:#75715e"># ç›®å½•æŒ‚è½½èŠ‚ç‚¹åªå®‰è£…ä¸å¯åŠ¨</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹ä½¿ç”¨çš„é»˜è®¤ç«¯å£<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>$ rpcinfo -p localhost
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Centos</span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;/etc/sysconfig/nfs&lt;-EOF
</span></span><span style="display:flex;"><span>STATD_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">4004</span>
</span></span><span style="display:flex;"><span>MOUNTD_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">2049</span>
</span></span><span style="display:flex;"><span>RQUOTAD_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">4001</span>
</span></span><span style="display:flex;"><span>LOCKD_TCPPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">32768</span>
</span></span><span style="display:flex;"><span>LOCKD_UDPPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">32768</span>
</span></span><span style="display:flex;"><span>EOF
</span></span><span style="display:flex;"><span>$ systemctl restart nfs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Debian</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/default/nfs-kernel-server<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RPCMOUNTDOPTS=&#34;--port 2045&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl restart rpcbind.service
</span></span><span style="display:flex;"><span>$ systemctl restart nfs-server.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl restart nfs-kernel-server</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å‡†å¤‡æŒ‚è½½ç›®å½•ï¼Œæˆæƒ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -pv /opt/data/nfs   <span style="color:#75715e"># å‡†å¤‡å…±äº«ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ chown -R user_naem:user_name /opt/data <span style="color:#f92672">&amp;&amp;</span> chmod <span style="color:#ae81ff">755</span> -R /opt/data/</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŒ‚è½½ç›®å½•å®ç°å…±äº«<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>è®¿é—®æƒé™è®¾ç½®</li>
</ul>
<blockquote>
<ul>
<li><code>ro</code><!-- raw HTML omitted -->ï¼šè®¾ç½®è¾“å‡ºç›®å½•ï¼šåªè¯»<!-- raw HTML omitted --></li>
<li><code>rw</code><!-- raw HTML omitted -->ï¼šè®¾ç½®è¾“å‡ºç›®å½•ï¼šè¯»å†™<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>ç”¨æˆ·æ˜ å°„é€‰é¡¹</li>
</ul>
<blockquote>
<ul>
<li><code>all_squash</code><!-- raw HTML omitted -->ï¼šå°†è¿œç¨‹è®¿é—®çš„æ‰€æœ‰æ™®é€šç”¨æˆ·åŠæ‰€å±ç»„éƒ½æ˜ å°„ä¸ºåŒ¿åç”¨æˆ·æˆ–ç”¨æˆ·ç»„<!-- raw HTML omitted --><code>nfsnobody</code></li>
<li><code>no_all_squash</code><!-- raw HTML omitted -->ï¼šä¸<code>all_squash</code>å–åï¼šé»˜è®¤è®¾ç½®<!-- raw HTML omitted --></li>
<li><code>root_squash</code><!-- raw HTML omitted -->ï¼š<code>root</code>ç”¨æˆ·å¯¹å…±äº«ç›®å½•åªæœ‰æ™®é€šç”¨æˆ·æƒé™ï¼Œé™åˆ¶<code>root</code>ï¼šé»˜è®¤è®¾ç½®<!-- raw HTML omitted --></li>
<li><code>no_root_squash</code><!-- raw HTML omitted -->ï¼šæœ‰æ­¤é€‰é¡¹ï¼Œ<code>root</code>ç”¨æˆ·å¯¹å…±äº«ç›®å½•æ‹¥æœ‰è‡³é«˜æƒé™ï¼Œå°±åƒå¯¹æœ¬æœºç›®å½•ä¸€æ ·æ“ä½œ<!-- raw HTML omitted --></li>
<li><code>anonuid=xxx</code><!-- raw HTML omitted -->ï¼šå°†è¿œç¨‹è®¿é—®çš„æ‰€æœ‰ç”¨æˆ·éƒ½æ˜ å°„ä¸ºåŒ¿åç”¨æˆ·ï¼Œå¹¶æŒ‡å®šè¯¥ç”¨æˆ·ä¸ºæœ¬åœ°ç”¨æˆ·<!-- raw HTML omitted --><code>UID=xxx</code></li>
<li><code>anongid=xxx</code><!-- raw HTML omitted -->ï¼šå°†è¿œç¨‹è®¿é—®çš„æ‰€æœ‰ç”¨æˆ·ç»„éƒ½æ˜ å°„ä¸ºåŒ¿åç”¨æˆ·ç»„è´¦æˆ·ï¼Œå¹¶æŒ‡å®šè¯¥åŒ¿åç”¨æˆ·ç»„è´¦æˆ·ä¸ºæœ¬åœ°ç”¨æˆ·ç»„è´¦æˆ·<!-- raw HTML omitted --><code>GID=xxx</code></li>
</ul>
</blockquote>
<ul>
<li>å…¶ä»–é€‰é¡¹</li>
</ul>
<blockquote>
<ul>
<li><code>secure</code><!-- raw HTML omitted -->ï¼š<code>NFS</code>é€šè¿‡<code>1024</code>ä»¥ä¸‹çš„å®‰å…¨<code>TCP/IP</code>ç«¯å£å‘é€ï¼šé»˜è®¤è®¾ç½®<!-- raw HTML omitted --></li>
<li><code>insecure</code><!-- raw HTML omitted -->ï¼š<code>NFS</code>é€šè¿‡<code>1024</code>ä»¥ä¸Šç«¯å£å‘é€<!-- raw HTML omitted --></li>
<li><code>sync</code><!-- raw HTML omitted -->ï¼šåŒæ­¥æ¨¡å¼ï¼Œå†…å­˜ä¸­çš„æ•°æ®æ—¶æ—¶å†™å…¥ç£ç›˜<!-- raw HTML omitted --></li>
<li><code>async</code><!-- raw HTML omitted -->ï¼šä¸åŒæ­¥ï¼ŒæŠŠå†…å­˜ä¸­çš„æ•°æ®å®šæœŸå†™å…¥ç£ç›˜<!-- raw HTML omitted --></li>
<li><code>wdelay</code><!-- raw HTML omitted -->ï¼šæ£€æŸ¥æ˜¯å¦æœ‰ç›¸å…³çš„å†™æ“ä½œï¼Œå¦‚æœæœ‰åˆ™å°†è¿™äº›å†™æ“ä½œä¸€èµ·æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ï¼šé»˜è®¤è®¾ç½®<!-- raw HTML omitted --></li>
<li><code>no_wdelay</code><!-- raw HTML omitted -->ï¼šè‹¥æœ‰å†™æ“ä½œåˆ™ç«‹å³æ‰§è¡Œï¼Œåº”ä¸<code>sync</code>é…åˆä½¿ç”¨<!-- raw HTML omitted --></li>
<li><code>subtree</code><!-- raw HTML omitted -->ï¼šè‹¥è¾“å‡ºç›®å½•æ˜¯ä¸€ä¸ªå­ç›®å½•ï¼Œåˆ™<code>NFS</code>æœåŠ¡å™¨å°†æ£€æŸ¥å…¶çˆ¶ç›®å½•çš„æƒé™ï¼šé»˜è®¤è®¾ç½®<!-- raw HTML omitted --></li>
<li><code>no_subtree</code><!-- raw HTML omitted -->ï¼šå³ä½¿è¾“å‡ºç›®å½•æ˜¯ä¸€ä¸ªå­ç›®å½•ï¼Œ<code>NFS</code>æœåŠ¡å™¨ä¹Ÿä¸æ£€æŸ¥å…¶çˆ¶ç›®å½•çš„æƒé™ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>æˆäºˆå¤šä¸ª<code>IP</code>ç½‘æ®µè®¿é—®<code>NFS</code>éœ€è¦ä½¿ç”¨<!-- raw HTML omitted -->ç©ºæ ¼<!-- raw HTML omitted -->åˆ†éš”<code>192.168.80.0/24 172.16.8.0/24</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;&gt;/etc/exports<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/logs 192.168.80.0/32(rw,sync,no_root_squash,no_all_squash,no_subtree_check)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/data/redis 192.168.80.0/24 172.16.8.0/24(rw,sync,no_root_squash,no_all_squash,no_subtree_check)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åŠ è½½é…ç½®ã€å¯åŠ¨æœåŠ¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ exportfs -r  	<span style="color:#75715e"># åŠ è½½é…ç½®</span>
</span></span><span style="display:flex;"><span>$ systemctl start rpcbind <span style="color:#f92672">&amp;&amp;</span> systemctl enable rpcbind
</span></span><span style="display:flex;"><span>$ systemctl start nfs <span style="color:#f92672">&amp;&amp;</span> systemctl enable nfs  	<span style="color:#75715e"># ä¿®æ”¹/etc/exports é…ç½®æ–‡ä»¶åè¦é‡å¯nfs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Debian ç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>$ sudo systemctl restart nfs-server</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ£€æµ‹æ˜¯å¦æŒ‚è½½æˆåŠŸ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo showmount -e 192.168.18.100  	<span style="color:#75715e"># æµ‹è¯•ç›®å½•æ˜¯å¦æŒ‚è½½æˆåŠŸ</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é«˜å¯ç”¨å¤‡ä»½æ–¹å¼ï¼Œåœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œå¦‚ä¸‹æŒ‚è½½å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mount -t nfs 192.168.18.100:/opt/data/redis /opt/data/redis
</span></span><span style="display:flex;"><span>$ mount -t nfs 192.168.18.100:/opt/data/jenkins /opt/data/jenkins</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç½‘ç»œè¿œç¨‹æŒ‚è½½ï¼Œç„¶åå†æ‰§è¡Œ<code>mount</code>æŒ‚è½½å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;&gt;/etc/fstab<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IPåœ°å€:/opt/nginx/logs   /opt/nginx/logs    nfs     defaults        0 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mount -t  nfs 192.168.18.100:/opt/data/redis /opt/data/redis
</span></span><span style="display:flex;"><span>$ mount -t  nfs 192.168.18.100:/opt/data/jenkins /opt/data/jenkins</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹æŒ‚è½½æƒ…å†µ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä»¥æ ‘ç»“æ„æ–¹å¼åˆ—å‡ºï¼šapt install util-linux</span>
</span></span><span style="display:flex;"><span>$ findmnt  	<span style="color:#75715e"># -tï¼šæŒ‡å®šæ–‡ä»¶ç±»å‹ï¼Œä¾‹å¦‚ï¼šfindmnt -t nfs4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ lsblk -f
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mount</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¸è½½æŒ‚è½½çš„ç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ umount -l /opt/data/jenkins  	<span style="color:#75715e"># -lï¼šå¼ºåˆ¶ï¼ŒåŠ æœ¬åœ°ç›®å½•</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_moosefs">Install_MooseFS</h1>

<h2 id="moosefs"><code>MooseFS</code></h2>
<blockquote>
<ul>
<li>
<p><a href="https://moosefs.com/support/#documentation" rel="external" target="_self"><code>MooseFS</code></a></p>
<p><code>MooseFS[MFS]</code>æ˜¯ä¸€ä¸ªå…·æœ‰å®¹é”™æ€§ï¼Œé«˜å¯ç”¨ï¼Œé«˜æ€§èƒ½ï¼Œæ‰©å±•æ€§å¼ºçš„ç½‘ç»œ<a href="https://cloud.tencent.com/product/chdfs?from_column=20065&from=20065" rel="external" target="_self">åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</a>ã€‚ä»–å°†æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªå­˜å‚¨<a href="https://cloud.tencent.com/product/cpm?from_column=20065&from=20065" rel="external" target="_self">ç‰©ç†æœåŠ¡å™¨</a>ä¸Šï¼Œè¿™äº›å­˜å‚¨æœåŠ¡å™¨å¯¹ç”¨æˆ·è€Œè¨€å°±æ˜¯ä¸€å—è™šæ‹Ÿç£ç›˜ï¼Œå®ƒç¬¦åˆ<code>POSIX</code>å¹¶ä¸”åƒä»»ä½•å…¶ä»–ç±»UNIXæ–‡ä»¶ç³»ç»Ÿä¸€æ ·æ”¯æŒ</p>
</li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_minio">Install_Minio</h1>

<h2 id="minioéƒ¨ç½²"><code>Minio</code>éƒ¨ç½²</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://min.io/docs/minio/kubernetes/upstream/" rel="external" target="_self"><code>Minio</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://min.io/docs/minio/linux/index.html" rel="external" target="_self"><code>Linux</code>å®‰è£…<code>Minio</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_fastdfs">Install_FastDFS</h1>

<h2 id="fastdfsåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ"><code>FastDFS</code>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å‚è€ƒæ–‡æ¡£<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://blog.csdn.net/kongdeqian1988/article/details/36930875" rel="external" target="_self"><code>FastDFS</code>æµ·é‡æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ–¹æ¡ˆ</a></td>
<td></td>
</tr>
<tr>
<td><a href="http://blog.csdn.net/mr_smile2014/article/details/52118541" rel="external" target="_self"><code>Fastdfs</code>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¹‹æ–‡ä»¶åŒæ­¥æœºåˆ¶</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://blog.csdn.net/ssoul_liu/article/details/51059139" rel="external" target="_self"><code>FastDFS</code>ç¯å¢ƒé…ç½®åŠ<code>php FastDFS</code>æ‰©å±•å®‰è£…</a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>FastDFS</code><!-- raw HTML omitted -->è®¿é—®æµç¨‹å›¾<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-bd2047e1a362a418deeaefe973c0df9f" class="lightbox-link"><img alt="FastDFS-Access flow" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Distributed_File_Server/FastDFS-Access-flow.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bd2047e1a362a418deeaefe973c0df9f"><img alt="FastDFS-Access flow" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/Distributed_File_Server/FastDFS-Access-flow.png"></a></p>
</blockquote>
<hr>
<h3 id="ä¸‹è½½å®‰è£…fastdfsä»¥åŠæ‰©å±•å®‰è£…åŒ…">ä¸‹è½½å®‰è£…<code>FastDFS</code>ä»¥åŠæ‰©å±•å®‰è£…åŒ…</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸‹è½½å®‰è£…<!-- raw HTML omitted --><code>libfastcommon</code><!-- raw HTML omitted -->æ‰©å±•åŒ…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ $ yum -y install gcc gcc-c++ wget
</span></span><span style="display:flex;"><span>$ mkdir -p /opt/fastdfs/<span style="color:#f92672">{</span>client,data,logs<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -Sæ‰“å°æœåŠ¡å™¨å“åº”ã€-Oå°†æ–‡ä»¶å†™å…¥æ–‡ä»¶ã€-P å¤§På°†æ–‡ä»¶ä¸‹è½½æŒ‡å®šç›®å½•</span>
</span></span><span style="display:flex;"><span>$ wget -P -S -O /usr/local/src/libfastcommon.tar.gz https://github.com/happyfish100/libfastcommon/archive/refs/tags/V1.0.45.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/libfastcommon.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…libfastcommon</span>
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/libfastcommon-1.0.45/  
</span></span><span style="display:flex;"><span>$ ./make.sh  
</span></span><span style="display:flex;"><span>$ ./make.sh install</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¸‹è½½å®‰è£…<!-- raw HTML omitted --><code>FastDFS</code><!-- raw HTML omitted -->ä¸»åŒ…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget -P -S -O /usr/local/src/fastdfs.tar.gz https://github.com/happyfish100/fastdfs/archive/refs/tags/V6.07.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/fastdfs.tar.gz -C /usr/local/src/</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>FastDFS</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>make.sh</code><!-- raw HTML omitted -->å®šä¹‰é»˜è®¤å·¥ä½œç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹é»˜è®¤ä¸»ç›®å½•ï¼šTARGET_PREFIX=$DESTDIR/usr 3è¡Œå·¦å³</span>
</span></span><span style="display:flex;"><span>$ sed -ri <span style="color:#e6db74">&#34;s#IR/usr#IR/opt/fastdfs#&#34;</span> /usr/local/src/fastdfs-6.07/make.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹é»˜è®¤é…ç½®æ–‡ä»¶ç›®å½• ï¼šTARGET_CONF_PATH=$DESTDIR/etc/fdfs 4è¡Œå·¦å³</span>
</span></span><span style="display:flex;"><span>$ sed -ri <span style="color:#e6db74">&#34;s#IR/etc/fdfs#IR/opt/fastdfs#&#34;</span> /usr/local/src/fastdfs-6.07/make.sh 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¼–è¯‘å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/fastdfs-6.07/
</span></span><span style="display:flex;"><span>$ ./make.sh  
</span></span><span style="display:flex;"><span>$ ./make.sh install  
</span></span><span style="display:flex;"><span>$ <span style="color:#ae81ff">\c</span>p /usr/local/src/fastdfs-6.07/conf/* /opt/fastdfs/</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>tracker.conf</code><!-- raw HTML omitted -->æ–‡ä»¶é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ›¿æ¢å­˜å‚¨æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶çš„åŸºæœ¬è·¯å¾„ï¼Œ23è¡Œå·¦å³</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s#/home/yuqing/fastdfs#/opt/fastdfs/data#g&#34;</span> /opt/fastdfs/tracker.conf</span></span></code></pre></div><ul>
<li>2.1.3 <!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>storage.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#  å·¥ä½œç›®å½• 49è¡Œå·¦å³</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s#/home/yuqing/fastdfs#/opt/fastdfs#g&#34;</span> /opt/fastdfs/storage.conf  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹é…ç½®trackeræœåŠ¡å™¨ï¼Œè™½ç„¶æ˜¯åŒä¸€å°æœºå™¨ä¸Šï¼Œä½†æ˜¯ä¸èƒ½å†™127.0.0.1ã€‚è¿™é¡¹é…ç½®å¯ä»¥å‡ºç°ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œ145è¡Œå·¦å³</span>
</span></span><span style="display:flex;"><span>$ sed -ri <span style="color:#e6db74">&#34;/tracker_server = /c\\tracker_server = </span><span style="color:#e6db74">${</span>FastDFSæœåŠ¡æ‰€åœ¨æœåŠ¡å™¨IP<span style="color:#e6db74">}</span><span style="color:#e6db74">:22122&#34;</span> /etc/fdfs/storage.conf  	</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>client.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s#/home/yuqing/fastdfs#/opt/fastdfs#g&#34;</span> /opt/fastdfs/client.conf
</span></span><span style="display:flex;"><span>$ sed -ri <span style="color:#e6db74">&#34;/tracker_server = /c\\tracker_server = </span><span style="color:#e6db74">${</span>FastDFSæœåŠ¡æ‰€åœ¨æœåŠ¡å™¨IP<span style="color:#e6db74">}</span><span style="color:#e6db74">:22122&#34;</span> /opt/fastdfs/client.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>http.tracker_server_port<span style="color:#f92672">=</span><span style="color:#ae81ff">9270</span>  	<span style="color:#75715e"># æ ¹æ®éœ€è¦ä¿®æ”¹ç«¯å£å·</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>mod_fastdfs.conf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>é…ç½®<code>mod_fastdfs.conf</code>æ–‡ä»¶æ³¨æ„ä¸€äº›é—®é¢˜</li>
<li><code>mod_fastdfs.conf</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸­<!-- raw HTML omitted --><code>tracker_server</code><!-- raw HTML omitted -->çš„ç«¯å£åº”è¯¥è·Ÿ<!-- raw HTML omitted --><code>tracker.conf</code><!-- raw HTML omitted -->ä¸­<!-- raw HTML omitted --><code>port</code><!-- raw HTML omitted -->ä¸€è‡´<!-- raw HTML omitted --></li>
<li><code>mod_fastdfs.conf</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸­<!-- raw HTML omitted --><code>storage_server_port</code><!-- raw HTML omitted -->çš„ç«¯å£åº”è¯¥è·Ÿ<!-- raw HTML omitted --><code>storage.conf</code><!-- raw HTML omitted -->ä¸­<!-- raw HTML omitted --><code>port</code><!-- raw HTML omitted -->ä¸€è‡´<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cp /usr/local/src/fastdfs-6.07/docker/dockerfile_local/conf/mod_fastdfs.conf /opt/fastdfs/
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s#/home/dfs#/opt/fastdfs#g&#34;</span> /opt/fastdfs/mod_fastdfs.conf  
</span></span><span style="display:flex;"><span>$ sed -ri <span style="color:#e6db74">&#34;/tracker_server=/c\\tracker_server=</span><span style="color:#e6db74">${</span>FastDFSæœåŠ¡æ‰€åœ¨æœåŠ¡å™¨IP<span style="color:#e6db74">}</span><span style="color:#e6db74">:22122&#34;</span> /opt/fastdfs/mod_fastdfs.conf</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å…¶ä»–é…ç½®æˆ–æ–‡ä»¶è™½ç„¶ä¸ç”¨ä¿®æ”¹ï¼Œ<!-- raw HTML omitted --><code>fastdfs-nginx-module</code><!-- raw HTML omitted -->æ¨¡å—ä¼šç”¨åˆ°ä¸€äº›é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>anti-steal.jpg</code></li>
<li><code>http.conf</code></li>
<li><code>mime.types</code></li>
</ul>
</blockquote>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>tracker</code><!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted --><code>storage</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ fdfs_trackerd /opt/fastdfs/tracker.conf start
</span></span><span style="display:flex;"><span>$ fdfs_storaged /opt/fastdfs/storage.conf start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹æ—¥å¿—</span>
</span></span><span style="display:flex;"><span>$ tail -n10 /opt/fastdfs/logs/storaged.log 
</span></span><span style="display:flex;"><span>mkdir data path: F7 ...
</span></span><span style="display:flex;"><span>mkdir data path: F8 ...
</span></span><span style="display:flex;"><span>mkdir data path: F9 ...
</span></span><span style="display:flex;"><span>mkdir data path: FA ...
</span></span><span style="display:flex;"><span>mkdir data path: FB ...  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ç”¨<!-- raw HTML omitted --><code>fdfs_test</code><!-- raw HTML omitted -->æµ‹è¯•ä¸Šä¼ <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/bin/fdfs_upload_file /etc/fdfs/client.conf ~/512x512bb.jpg
</span></span><span style="display:flex;"><span>group1/M00/00/00/wKjVgWCEOCaABaIQAABPt05CHsw699.jpg</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ä¸‹è½½å®‰è£…<!-- raw HTML omitted --><code>fastdfs-nginx-module</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>nginx</code><!-- raw HTML omitted -->ç¼–è¯‘æ·»åŠ æ”¯æŒæ¨¡å—<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¸‹è½½æ”¯æŒnginxæ’ä»¶</span>
</span></span><span style="display:flex;"><span>$ wget -P -S -O /usr/local/src/fastdfs-nginx-module.tar.gz https://github.com/happyfish100/fastdfs-nginx-module/archive/refs/tags/V1.22.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/fastdfs-nginx-module.tar.gz -C /usr/local/src/  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ æ¨¡å—</span>
</span></span><span style="display:flex;"><span>$ ./configure --add-module<span style="color:#f92672">=</span>../fastdfs-nginx-module-master/src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®æ–‡ä»¶æ·»åŠ é…ç½®å¯ç”¨æ¨¡å—</span>
</span></span><span style="display:flex;"><span>$ vim /usr/local/nginx/conf/nginx.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 80ç«¯å£ä¸­æ·»åŠ </span>
</span></span><span style="display:flex;"><span>location ~/group<span style="color:#f92672">([</span>0-9<span style="color:#f92672">])</span>/M00 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     ngx_fastdfs_module;
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ å¦‚ä¸‹è¡Œï¼Œå°† /group1/M00 æ˜ å°„åˆ° /ljzsg/fastdfs/file/data</span>
</span></span><span style="display:flex;"><span> location /group1/M00 <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     alias /ljzsg/fastdfs/file/data;
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configur_storage">Configur_Storage</h1>

<h2 id="å­˜å‚¨">å­˜å‚¨</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.ceph.com/en/quincy/" rel="external" target="_self"><code>Ceph</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="http://docs.minio.org.cn/docs/" rel="external" target="_self"><code>MinIO</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://hadoop.apache.org/" rel="external" target="_self"><code>Hadoop</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://moosefs.com/" rel="external" target="_self"><code>MooseFS</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.gluster.org/" rel="external" target="_self"><code>GlusterFS</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="service_management">Service_Management</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Service_Management</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_apollo">Install_Apollo</h1>

<h2 id="apolloéƒ¨ç½²"><code>Apollo</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li><a href="https://github.com/apolloconfig/apollo" rel="external" target="_self"><code>Apollo</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_nacos">Install_Nacos</h1>

<h2 id="nacoséƒ¨ç½²"><code>Nacos</code>éƒ¨ç½²</h2>
<blockquote>
<ul>
<li>
<p><a href="https://github.com/alibaba/nacos/tags" rel="external" target="_self"><code>Nacos</code>ä¸‹è½½åœ°å€</a></p>
</li>
<li>
<p><!-- raw HTML omitted -->ç¯å¢ƒå‡†å¤‡<!-- raw HTML omitted --></p>
<p><code>Nacos</code>ä¾èµ–<code>Java</code>ç¯å¢ƒæ¥è¿è¡Œã€‚å¦‚æœæ‚¨æ˜¯ä»ä»£ç å¼€å§‹æ„å»ºå¹¶è¿è¡Œ<code>Nacos</code>ï¼Œè¿˜éœ€è¦ä¸ºæ­¤é…ç½® <code>Maven</code>ç¯å¢ƒï¼Œè¯·ç¡®ä¿æ˜¯åœ¨ä»¥ä¸‹ç‰ˆæœ¬ç¯å¢ƒä¸­å®‰è£…ä½¿ç”¨:</p>
</li>
</ul>
<blockquote>
<ul>
<li><code>64 bit OS</code>ï¼Œæ”¯æŒ<code>Linux/Unix/Mac/Windows</code>ï¼Œæ¨èé€‰ç”¨<code>Linux/Unix/Mac</code>ã€‚</li>
<li><code>64 bit JDK 1.8+</code>ä¸‹è½½ <code>&amp;</code> é…ç½®ã€‚</li>
<li><code>Maven 3.2.x+</code>ä¸‹è½½<code>&amp;</code>é…ç½®ã€‚</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½å®‰è£…åŒ…ã€è§£å‹ã€é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://github.com/alibaba/nacos/releases/download/2.0.4/nacos-server-2.0.4.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar -zxvf nacos-server-2.0.4.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºæ•°æ®åº“ã€å¯¼å…¥æ¨¡æ¿æ•°æ®</span>
</span></span><span style="display:flex;"><span>mysql&gt; source  nacos/conf/nacos-mysql.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹é…ç½®</span>
</span></span><span style="display:flex;"><span>$ vim nacos/conf/application.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>db.url.0<span style="color:#f92672">=</span>jdbc:mysql://127.0.0.1:16303/nacos?characterEncoding<span style="color:#f92672">=</span>utf8&amp;connectTimeout<span style="color:#f92672">=</span>1000&amp;socketTimeout<span style="color:#f92672">=</span>3000&amp;autoReconnect<span style="color:#f92672">=</span>true&amp;useUnicode<span style="color:#f92672">=</span>true&amp;useSSL<span style="color:#f92672">=</span>false&amp;serverTimezone<span style="color:#f92672">=</span>UTC  	<span style="color:#75715e"># é…ç½®è¿æ¥æ•°æ®åº“åœ°å€</span>
</span></span><span style="display:flex;"><span>db.user<span style="color:#f92672">=</span>nacos  	<span style="color:#75715e"># è¿æ¥æ•°æ®åº“ç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>db.password<span style="color:#f92672">=</span>password  	<span style="color:#75715e"># è¿æ¥æ•°æ®åº“å¯†ç </span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="nacoså•èŠ‚ç‚¹å¯åŠ¨"><code>Nacos</code>å•èŠ‚ç‚¹å¯åŠ¨</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å•èŠ‚ç‚¹å¯åŠ¨(standaloneä»£è¡¨ç€å•æœºæ¨¡å¼è¿è¡Œ)</span>
</span></span><span style="display:flex;"><span>$ sh startup.sh -m standalone
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æœåŠ¡æ³¨å†Œ</span>
</span></span><span style="display:flex;"><span>$ curl -X POST <span style="color:#e6db74">&#39;http://127.0.0.1:8848/nacos/v1/ns/instance?serviceName=nacos.naming.serviceName&amp;ip=20.18.7.10&amp;port=8080&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æœåŠ¡å‘ç°</span>
</span></span><span style="display:flex;"><span>$ curl -X GET <span style="color:#e6db74">&#39;http://127.0.0.1:8848/nacos/v1/ns/instance/list?serviceName=nacos.naming.serviceName&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘å¸ƒé…ç½®</span>
</span></span><span style="display:flex;"><span>$ curl -X POST <span style="color:#e6db74">&#34;http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=nacos.cfg.dataId&amp;group=test&amp;content=HelloWorld&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–é…ç½®</span>
</span></span><span style="display:flex;"><span>$ curl -X GET <span style="color:#e6db74">&#34;http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=nacos.cfg.dataId&amp;group=test&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å…³é—­æœåŠ¡å™¨</span>
</span></span><span style="display:flex;"><span>$ sh shutdown.sh</span></span></code></pre></div></blockquote>
<hr>
<h3 id="nacosé›†ç¾¤éƒ¨ç½²"><code>Nacos</code>é›†ç¾¤éƒ¨ç½²</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->èŠ‚ç‚¹ä¹‹é—´é˜²ç«å¢™å¼€æ”¾<!-- raw HTML omitted --><!-- raw HTML omitted --><strong>9849ã€8848ã€7848ã€1001</strong><!-- raw HTML omitted --><!-- raw HTML omitted -->ç«¯å£ï¼Œ<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><!-- raw HTML omitted --><strong>9849ã€1001</strong>æœåŠ¡ç«¯<!-- raw HTML omitted --><code>gRPC</code><!-- raw HTML omitted -->è¯·æ±‚æœåŠ¡ç«¯ç«¯å£ï¼Œç”¨äºæœåŠ¡é—´åŒæ­¥ç­‰<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>nacos</code><!-- raw HTML omitted -->é›†ç¾¤é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim nacos/conf/cluster.conf
</span></span><span style="display:flex;"><span>192.168.1.10:8848
</span></span><span style="display:flex;"><span>192.168.1.11:8848
</span></span><span style="display:flex;"><span>192.168.1.12:8848</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶ä»¥åŠé…ç½®æ•°æ®åº“è¿æ¥<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim nacos/conf/application.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Specify local server&#39;s IP:</span>
</span></span><span style="display:flex;"><span>nacos.inetutils.ip-address<span style="color:#f92672">=</span>192.168.30.144  	<span style="color:#75715e"># æœ¬æœºæœåŠ¡å™¨IP</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#*************** Config Module Related Configurations ***************#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### If user MySQL as datasource:</span>
</span></span><span style="display:flex;"><span>spring.datasource.platform<span style="color:#f92672">=</span>mysql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Count of DB:</span>
</span></span><span style="display:flex;"><span>db.num<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>db.url.0<span style="color:#f92672">=</span>jdbc:mysql://127.0.0.1:16303/nacos?characterEncoding<span style="color:#f92672">=</span>utf8&amp;connectTimeout<span style="color:#f92672">=</span>1000&amp;socketTimeout<span style="color:#f92672">=</span>3000&amp;autoReconnect<span style="color:#f92672">=</span>true&amp;useUnicode<span style="color:#f92672">=</span>true&amp;useSSL<span style="color:#f92672">=</span>false&amp;serverTimezone<span style="color:#f92672">=</span>UTC  	<span style="color:#75715e"># é…ç½®è¿æ¥æ•°æ®åº“åœ°å€</span>
</span></span><span style="display:flex;"><span>db.user<span style="color:#f92672">=</span>nacos  	<span style="color:#75715e"># è¿æ¥æ•°æ®åº“ç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>db.password<span style="color:#f92672">=</span>password  	<span style="color:#75715e"># è¿æ¥æ•°æ®åº“å¯†ç </span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é›†ç¾¤å¯åŠ¨ï¼ˆä½¿ç”¨å¤–ç½®æ•°æ®åº“ï¼‰<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ bash startup.sh</span></span></code></pre></div></blockquote>
<hr>
<h3 id="kuberneteséƒ¨ç½²nacos"><code>Kubernetes</code>éƒ¨ç½²<code>Nacos</code></h3>
<blockquote>
<ul>
<li><a href="https://nacos.io/zh-cn/docs/use-nacos-with-kubernetes.html" rel="external" target="_self"><code>Kubernetes</code>éƒ¨ç½²<code>Nacos</code></a></li>
</ul>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_mesos">Install_Mesos</h1>

<h2 id="apache-mesos"><code>Apache Mesos</code></h2>
<blockquote>
<ul>
<li>
<p><a href="https://mesos.apache.org/documentation/latest/" rel="external" target="_self"><code>Apache Mesos</code></a></p>
<p><code>Mesos</code>æ˜¯ä¸€ä¸ªå¼€æºçš„é›†ç¾¤ç®¡ç†æ¡†æ¶ï¼Œå®ƒå¯ä»¥å°†æ•°æ®ä¸­å¿ƒ/é›†ç¾¤æ”¾åœ¨ä¸€å°ç”µè„‘é‡Œè¿è¡Œï¼Œå¯¹å¤–æä¾›ç®€å•çš„<code>API</code>ï¼ŒåŒæ—¶éšè—å†…éƒ¨çš„å¾ˆå¤šå¤æ‚æ¶æ„</p>
</li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_hive">Install_Hive</h1>

<h2 id="apache-hive"><code>Apache Hive</code></h2>
<blockquote>
<ul>
<li>
<p><a href="https://hive.apache.org/" rel="external" target="_self"><code>Apache Hive</code></a></p>
<p><code>Apache Hive</code>æ˜¯å¯å®ç°å¤§è§„æ¨¡åˆ†æçš„åˆ†å¸ƒå¼å®¹é”™æ•°æ®ä»“åº“ç³»ç»Ÿã€‚è¯¥æ•°æ®ä»“åº“é›†ä¸­å­˜å‚¨ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥è½»æ¾å¯¹æ­¤ç±»ä¿¡æ¯è¿›è¡Œåˆ†æï¼Œä»è€Œåšå‡ºæ˜æ™ºçš„æ•°æ®é©±åŠ¨å†³ç­–ã€‚<code>Hive</code>è®©ç”¨æˆ·å¯ä»¥åˆ©ç”¨<code>SQL</code>è¯»å–ã€å†™å…¥å’Œç®¡ç†<code>PB</code>çº§æ•°æ®ã€‚</p>
<p><code>Hive</code>å»ºç«‹åœ¨<code>Apache Hadoop</code>åŸºç¡€ä¹‹ä¸Šï¼Œåè€…æ˜¯ä¸€ç§å¼€æºæ¡†æ¶ï¼Œå¯è¢«ç”¨äºé«˜æ•ˆå­˜å‚¨ä¸å¤„ç†å¤§å‹æ•°æ®é›†ã€‚å› æ­¤ï¼Œ<code>Hive</code>ä¸<code>Hadoop</code>ç´§å¯†é›†æˆï¼Œå…¶è®¾è®¡å¯å¿«é€Ÿå¯¹<code>PB</code>çº§æ•°æ®è¿›è¡Œæ“ä½œã€‚<code>Hive</code>çš„ä¸ä¼—ä¸åŒä¹‹å¤„åœ¨äºå®ƒå¯ä»¥åˆ©ç”¨<code>Apache Tez</code>æˆ–<code>MapReduce</code>é€šè¿‡ç±»ä¼¼äº<code>SQL</code>çš„ç•Œé¢æŸ¥è¯¢å¤§å‹æ•°æ®é›†ã€‚</p>
</li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_consul">Install_Consul</h1>

<h2 id="consul"><code>Consul</code></h2>
<blockquote>
<ul>
<li>
<p><a href="https://www.consul.io/" rel="external" target="_self"><code>Consul</code></a></p>
</li>
<li>
<p><a href="https://zhuanlan.zhihu.com/p/126064282" rel="external" target="_self">5åˆ†é’Ÿçœ‹æ‡‚å¾®æœåŠ¡<code>Consul</code>ç‰¹æ€§åŠæ­å»º</a></p>
<p><code>Consul</code>æ˜¯<code>HashiCorp</code>å…¬å¸æ¨å‡ºçš„å¼€æºå·¥å…·ï¼Œ<code>Consul</code>ç”±<code>Go</code>è¯­è¨€å¼€å‘ï¼Œéƒ¨ç½²èµ·æ¥éå¸¸å®¹æ˜“ï¼Œåªéœ€è¦æå°‘çš„å¯æ‰§è¡Œç¨‹åºå’Œé…ç½®æ–‡ä»¶ï¼Œå…·æœ‰ç»¿è‰²ã€è½»é‡çº§çš„ç‰¹ç‚¹ã€‚<code>Consul</code>æ˜¯<code>åˆ†å¸ƒå¼</code>çš„ã€<code>é«˜å¯ç”¨</code>çš„ã€ <code>å¯æ¨ªå‘æ‰©å±•</code>çš„ç”¨äºå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿçš„æœåŠ¡å‘ç°ä¸é…ç½®</p>
</li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="web">Web</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Web</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="website_optimization_advertise">Website_Optimization_Advertise</h1>

<h2 id="ç½‘ç«™ä¼˜åŒ–">ç½‘ç«™ä¼˜åŒ–</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://juejin.cn/post/7015464868237017119" rel="external" target="_self">åšå®¢æ¥å…¥è°·æ­Œå¹¿å‘Š<code>Google Ads</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://blog.csdn.net/fullbug/article/details/123894727" rel="external" target="_self"><code>hexo</code>åšå®¢åŠ å…¥<code>51LA</code>ç½‘ç«™æµé‡ç»Ÿè®¡</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="website_http_status_messages">Website_HTTP_Status_Messages</h1>

<h2 id="webæœåŠ¡çŠ¶æ€ç "><code>Web</code>æœåŠ¡çŠ¶æ€ç </h2>
<blockquote>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status#%E4%BF%A1%E6%81%AF%E5%93%8D%E5%BA%94" rel="external" target="_self"><code>HTTP</code></a></li>
<li><a href="https://www.tencentcloud.com/zh/document/product/1145/58009" rel="external" target="_self"><code>EdgeOne</code>è‡ªå®šä¹‰çš„çŠ¶æ€ç </a></li>
</ul>
</blockquote>
<h3 id="100199ä¿¡æ¯å“åº”"><code>100~199</code>ä¿¡æ¯å“åº”</h3>
<blockquote>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/100" rel="external" target="_self"><code>100 Continue</code></a></td>
<td>æœåŠ¡å™¨ä»…æ¥æ”¶åˆ°éƒ¨åˆ†è¯·æ±‚ï¼Œä½†æ˜¯ä¸€æ—¦æœåŠ¡å™¨å¹¶æ²¡æœ‰æ‹’ç»è¯¥è¯·æ±‚ï¼Œå®¢æˆ·ç«¯åº”è¯¥ç»§ç»­å‘é€å…¶ä½™çš„è¯·æ±‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/101" rel="external" target="_self"><code>101 Switching Protocols</code></a></td>
<td>æœåŠ¡å™¨è½¬æ¢åè®®ï¼šæœåŠ¡å™¨å°†éµå®ˆä»å®¢æˆ·çš„è¯·æ±‚è½¬æ¢åˆ°å¦å¤–ä¸€ç§åè®®</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/102" rel="external" target="_self"><code>102 Processing</code></a></td>
<td>æ­¤ä»£ç è¡¨ç¤ºæœåŠ¡å™¨å·²æ”¶åˆ°å¹¶æ­£åœ¨å¤„ç†è¯¥è¯·æ±‚ï¼Œä½†å½“å‰æ²¡æœ‰å“åº”å¯ç”¨</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/103" rel="external" target="_self"><code>103 Early Hints</code></a></td>
<td>æ­¤çŠ¶æ€ä»£ç ä¸»è¦ç”¨äºä¸<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Link" rel="external" target="_self"><code>Link</code></a>é“¾æ¥å¤´ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å…è®¸ç”¨æˆ·ä»£ç†åœ¨æœåŠ¡å™¨å‡†å¤‡å“åº”é˜¶æ®µæ—¶å¼€å§‹é¢„åŠ è½½<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Attributes/rel/preload" rel="external" target="_self"><code>preloading</code></a>èµ„æº</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="200299æˆåŠŸå“åº”"><code>200ï½299</code>æˆåŠŸå“åº”</h3>
<blockquote>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/200" rel="external" target="_self"><code>200 OK</code></a></td>
<td>è¯·æ±‚æˆåŠŸ(å…¶åæ˜¯å¯¹<code>GET</code>å’Œ<code>POST</code>è¯·æ±‚çš„åº”ç­”æ–‡æ¡£ã€‚)</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/201" rel="external" target="_self"><code>201 Created</code></a></td>
<td>è¯¥è¯·æ±‚å·²æˆåŠŸï¼Œå¹¶å› æ­¤åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„èµ„æºã€‚è¿™é€šå¸¸æ˜¯åœ¨ POST è¯·æ±‚ï¼Œæˆ–æ˜¯æŸäº› PUT è¯·æ±‚ä¹‹åè¿”å›çš„å“åº”</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/202" rel="external" target="_self"><code>202 Accepted</code></a></td>
<td>è¯·æ±‚å·²ç»æ¥æ”¶åˆ°ï¼Œä½†è¿˜æœªå“åº”ï¼Œæ²¡æœ‰ç»“æœã€‚æ„å‘³ç€ä¸ä¼šæœ‰ä¸€ä¸ªå¼‚æ­¥çš„å“åº”å»è¡¨æ˜å½“å‰è¯·æ±‚çš„ç»“æœï¼Œé¢„æœŸå¦å¤–çš„è¿›ç¨‹å’ŒæœåŠ¡å»å¤„ç†è¯·æ±‚ï¼Œæˆ–è€…æ‰¹å¤„ç†</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/203" rel="external" target="_self"><code>203 Non-Authoritative Information</code></a></td>
<td>æœåŠ¡å™¨å·²æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†è¿”å›çš„å®ä½“å¤´éƒ¨å…ƒä¿¡æ¯ä¸æ˜¯åœ¨åŸå§‹æœåŠ¡å™¨ä¸Šæœ‰æ•ˆçš„ç¡®å®šé›†åˆï¼Œè€Œæ˜¯æ¥è‡ªæœ¬åœ°æˆ–è€…ç¬¬ä¸‰æ–¹çš„æ‹·è´ã€‚å½“å‰çš„ä¿¡æ¯å¯èƒ½æ˜¯åŸå§‹ç‰ˆæœ¬çš„å­é›†æˆ–è€…è¶…é›†ã€‚ä¾‹å¦‚ï¼ŒåŒ…å«èµ„æºçš„å…ƒæ•°æ®å¯èƒ½å¯¼è‡´åŸå§‹æœåŠ¡å™¨çŸ¥é“å…ƒä¿¡æ¯çš„è¶…é›†ã€‚ä½¿ç”¨æ­¤çŠ¶æ€ç ä¸æ˜¯å¿…é¡»çš„ï¼Œè€Œä¸”åªæœ‰åœ¨å“åº”ä¸ä½¿ç”¨æ­¤çŠ¶æ€ç ä¾¿ä¼šè¿”å›<code>200 OK</code>çš„æƒ…å†µä¸‹æ‰æ˜¯åˆé€‚çš„</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/204" rel="external" target="_self"><code>204 No Content</code></a></td>
<td>æ²¡æœ‰æ–°æ–‡æ¡£ã€‚æµè§ˆå™¨åº”è¯¥ç»§ç»­æ˜¾ç¤ºåŸæ¥çš„æ–‡æ¡£ã€‚å¦‚æœç”¨æˆ·å®šæœŸåœ°åˆ·æ–°é¡µé¢è€Œ<code>Servlet</code>å¯ä»¥ç¡®å®šç”¨æˆ·æ–‡æ¡£è¶³å¤Ÿæ–°ï¼Œè¿™ä¸ªçŠ¶æ€ä»£ç æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/205" rel="external" target="_self"><code>205 Reset Content</code></a></td>
<td>æ²¡æœ‰æ–°æ–‡æ¡£ã€‚ä½†æµè§ˆå™¨åº”è¯¥é‡ç½®å®ƒæ‰€æ˜¾ç¤ºçš„å†…å®¹ã€‚ç”¨æ¥å¼ºåˆ¶æµè§ˆå™¨æ¸…æ¥šè¡¨å•è¾“å…¥å†…å®¹ã€‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/206" rel="external" target="_self"><code>206 Partial Content</code></a></td>
<td>å®¢æˆ·å‘é€äº†ä¸€ä¸ªå¸¦æœ‰<code>Range(èŒƒå›´)</code>çš„å¤´<code>GET</code>è¯·æ±‚ï¼ŒæœåŠ¡å™¨å®Œæˆäº†ä»–</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/207" rel="external" target="_self"><code>207 Multi-Status</code></a></td>
<td>å¯¹äºå¤šä¸ªçŠ¶æ€ä»£ç éƒ½å¯èƒ½åˆé€‚çš„æƒ…å†µï¼Œä¼ è¾“æœ‰å…³å¤šä¸ªèµ„æºçš„ä¿¡æ¯</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/208" rel="external" target="_self"><code>208 Already Reported</code></a></td>
<td>åœ¨<code>DAV</code>é‡Œé¢ä½¿ç”¨ <code>&lt;dav:propstat&gt;</code> å“åº”å…ƒç´ ä»¥é¿å…é‡å¤æšä¸¾å¤šä¸ªç»‘å®šçš„å†…éƒ¨æˆå‘˜åˆ°åŒä¸€ä¸ªé›†åˆ</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/226" rel="external" target="_self"><code>226 IM Used</code></a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="300399é‡å®šå‘æ¶ˆæ¯"><code>300ï½399</code>é‡å®šå‘æ¶ˆæ¯</h3>
<blockquote>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/300" rel="external" target="_self"><code>300 Multiple Choice</code></a></td>
<td>å¤šé‡é€‰æ‹©ã€‚é“¾æ¥åˆ—è¡¨ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©æŸé“¾æ¥è¾¾åˆ°ç›®çš„åœ°ã€‚æœ€å¤šå…è®¸äº”ä¸ªåœ°å€ã€‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/301" rel="external" target="_self"><code>301 Moved Permanently</code></a></td>
<td>è¯·æ±‚èµ„æºçš„<code>URL</code>å·²æ°¸ä¹…æ›´æ”¹ã€‚åœ¨å“åº”ä¸­ç»™å‡ºäº†æ–°çš„<code>URL</code></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/302" rel="external" target="_self"><code>302 Found</code></a></td>
<td>æ­¤å“åº”ä»£ç è¡¨ç¤ºæ‰€è¯·æ±‚èµ„æºçš„<code>URI</code>å·²<strong>æš‚æ—¶</strong>æ›´æ”¹ã€‚æœªæ¥å¯èƒ½ä¼šå¯¹<code>URI</code>è¿›è¡Œè¿›ä¸€æ­¥çš„æ”¹å˜ã€‚å› æ­¤ï¼Œå®¢æˆ·æœºåº”è¯¥åœ¨å°†æ¥çš„è¯·æ±‚ä¸­ä½¿ç”¨è¿™ä¸ªç›¸åŒçš„<code>URI</code></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/303" rel="external" target="_self"><code>303 See Other</code></a></td>
<td>æœåŠ¡å™¨å‘é€æ­¤å“åº”ï¼Œä»¥æŒ‡ç¤ºå®¢æˆ·ç«¯é€šè¿‡ä¸€ä¸ª<code>GET</code>è¯·æ±‚åœ¨å¦ä¸€ä¸ª<code>URI</code>ä¸­è·å–æ‰€è¯·æ±‚çš„èµ„æº</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/304" rel="external" target="_self"><code>304 Not Modified</code></a></td>
<td>è¿™æ˜¯ç”¨äºç¼“å­˜çš„ç›®çš„ã€‚å®ƒå‘Šè¯‰å®¢æˆ·ç«¯å“åº”è¿˜æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œå› æ­¤å®¢æˆ·ç«¯å¯ä»¥ç»§ç»­ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜ç‰ˆæœ¬çš„å“åº”</td>
</tr>
<tr>
<td><code>305 Use Proxy</code></td>
<td>åœ¨<code>HTTP</code>è§„èŒƒä¸­å®šä¹‰ï¼Œä»¥æŒ‡ç¤ºè¯·æ±‚çš„å“åº”å¿…é¡»è¢«ä»£ç†è®¿é—®ã€‚ç”±äºå¯¹ä»£ç†çš„å¸¦å†…é…ç½®çš„å®‰å…¨è€ƒè™‘ï¼Œå®ƒå·²è¢«å¼ƒç”¨</td>
</tr>
<tr>
<td><code>306 Unused</code></td>
<td>æ­¤å“åº”ä»£ç ä¸å†ä½¿ç”¨ï¼›å®ƒåªæ˜¯ä¿ç•™ã€‚å®ƒæ›¾åœ¨<code>HTTP/1.1</code>è§„èŒƒçš„æ—©æœŸç‰ˆæœ¬ä¸­ä½¿ç”¨è¿‡ã€‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/307" rel="external" target="_self"><code>307 Temporary Redirect</code></a></td>
<td>æœåŠ¡å™¨å‘é€æ­¤å“åº”ï¼Œä»¥æŒ‡ç¤ºå®¢æˆ·ç«¯ä½¿ç”¨åœ¨å‰ä¸€ä¸ªè¯·æ±‚ä¸­ä½¿ç”¨çš„ç›¸åŒæ–¹æ³•åœ¨å¦ä¸€ä¸ª<code>URI</code>ä¸Šè·å–æ‰€è¯·æ±‚çš„èµ„æºã€‚è¿™ä¸<code>302 Found HTTP</code>å“åº”ä»£ç å…·æœ‰ç›¸åŒçš„è¯­ä¹‰ï¼Œä½†ç”¨æˆ·ä»£ç† <em>ä¸èƒ½</em> æ›´æ”¹æ‰€ä½¿ç”¨çš„<code>HTTP</code>æ–¹æ³•ï¼šå¦‚æœåœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚ä¸­ä½¿ç”¨äº†<code>POST</code>ï¼Œåˆ™åœ¨ç¬¬äºŒä¸ªè¯·æ±‚ä¸­å¿…é¡»ä½¿ç”¨<code>POST</code></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/308" rel="external" target="_self"><code>308 Permanent Redirect</code></a></td>
<td>è¿™æ„å‘³ç€èµ„æºç°åœ¨æ°¸ä¹…ä½äºç”±<code>Location:</code> HTTP Response æ ‡å¤´æŒ‡å®šçš„å¦ä¸€ä¸ª<code>URI</code>ã€‚è¿™ä¸ <code>301 Moved Permanently</code> HTTP å“åº”ä»£ç å…·æœ‰ç›¸åŒçš„è¯­ä¹‰ï¼Œä½†ç”¨æˆ·ä»£ç†ä¸èƒ½æ›´æ”¹æ‰€ä½¿ç”¨çš„<code>HTTP</code>æ–¹æ³•ï¼šå¦‚æœåœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚ä¸­ä½¿ç”¨<code>POST</code>ï¼Œåˆ™å¿…é¡»åœ¨ç¬¬äºŒä¸ªè¯·æ±‚ä¸­ä½¿ç”¨<code>POST</code>ã€‚</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="400499å®¢æˆ·ç«¯é”™è¯¯å“åº”"><code>400ï½499</code>å®¢æˆ·ç«¯é”™è¯¯å“åº”</h3>
<blockquote>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/400" rel="external" target="_self"><code>400 Bad Request</code></a></td>
<td>å®¢æˆ·ç«¯è¯·æ±‚ä¸åˆæ³•ï¼ˆä¾‹å¦‚ï¼Œé”™è¯¯çš„è¯·æ±‚è¯­æ³•ã€æ— æ•ˆçš„è¯·æ±‚æ¶ˆæ¯å¸§æˆ–æ¬ºéª—æ€§çš„è¯·æ±‚è·¯ç”±ï¼‰ï¼ŒæœåŠ¡å™¨æ— æ³•æˆ–ä¸ä¼šå¤„ç†è¯·æ±‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/401" rel="external" target="_self"><code>401 Unauthorized</code></a></td>
<td>è™½ç„¶<code>HTTP</code>æ ‡å‡†æŒ‡å®šäº†<code>unauthorized</code>ï¼Œä½†ä»è¯­ä¹‰ä¸Šæ¥è¯´ï¼Œè¿™ä¸ªå“åº”æ„å‘³ç€<code>unauthenticated</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å¿…é¡»å¯¹è‡ªèº«è¿›è¡Œèº«ä»½éªŒè¯æ‰èƒ½è·å¾—è¯·æ±‚çš„å“åº”</td>
</tr>
<tr>
<td><code>401.1</code></td>
<td>ç™»å½•å¤±è´¥ã€‚</td>
</tr>
<tr>
<td><code>401.2</code></td>
<td>æœåŠ¡å™¨é…ç½®å¯¼è‡´ç™»å½•å¤±è´¥ã€‚</td>
</tr>
<tr>
<td><code>401.3</code></td>
<td>ç”±äº<code>ACL</code>å¯¹èµ„æºçš„é™åˆ¶è€Œæœªè·å¾—æˆæƒã€‚</td>
</tr>
<tr>
<td><code>401.4</code></td>
<td>ç­›é€‰å™¨æˆæƒå¤±è´¥ã€‚</td>
</tr>
<tr>
<td><code>401.5</code></td>
<td><code>ISAPI/CGI</code>åº”ç”¨ç¨‹åºæˆæƒå¤±è´¥</td>
</tr>
<tr>
<td><code>401.7</code></td>
<td>è®¿é—®è¢«<code>Web</code>æœåŠ¡å™¨ä¸Šçš„<code>URL</code>æˆæƒç­–ç•¥æ‹’ç»ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º<code>IIS 6.0</code>æ‰€ä¸“ç”¨</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/402" rel="external" target="_self"><code>402 Payment Required</code></a></td>
<td>æ­¤å“åº”ä»£ç ä¿ç•™ä¾›å°†æ¥ä½¿ç”¨ã€‚åˆ›å»ºæ­¤ä»£ç çš„æœ€åˆç›®çš„æ˜¯å°†å…¶ç”¨äºæ•°å­—æ”¯ä»˜ç³»ç»Ÿï¼Œä½†æ˜¯æ­¤çŠ¶æ€ä»£ç å¾ˆå°‘ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸å­˜åœ¨æ ‡å‡†çº¦å®š</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/403" rel="external" target="_self"><code>403 Forbidden</code></a></td>
<td>å®¢æˆ·ç«¯æ²¡æœ‰è®¿é—®å†…å®¹çš„æƒé™ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯æœªç»æˆæƒçš„ï¼Œå› æ­¤æœåŠ¡å™¨æ‹’ç»æä¾›è¯·æ±‚çš„èµ„æºã€‚ä¸<code>401 Unauthorized</code>ä¸åŒï¼ŒæœåŠ¡å™¨çŸ¥é“å®¢æˆ·ç«¯çš„èº«ä»½</td>
</tr>
<tr>
<td><code>403.1</code></td>
<td>æ‰§è¡Œè®¿é—®è¢«ç¦æ­¢</td>
</tr>
<tr>
<td><code>403.2</code></td>
<td>è¯»è®¿é—®è¢«ç¦æ­¢</td>
</tr>
<tr>
<td><code>403.3</code></td>
<td>å†™è®¿é—®è¢«ç¦æ­¢</td>
</tr>
<tr>
<td><code>403.4</code></td>
<td>è¦æ±‚<code>SSL</code></td>
</tr>
<tr>
<td><code>403.5</code></td>
<td>è¦æ±‚<code>SSL 128</code></td>
</tr>
<tr>
<td><code>403.6</code></td>
<td><code>IP</code>åœ°å€è¢«æ‹’ç»</td>
</tr>
<tr>
<td><code>403.7</code></td>
<td>è¦æ±‚å®¢æˆ·ç«¯è¯ä¹¦</td>
</tr>
<tr>
<td><code>403.8</code></td>
<td>ç«™ç‚¹è®¿é—®è¢«æ‹’ç»</td>
</tr>
<tr>
<td><code>403.9</code></td>
<td>ç”¨æˆ·æ•°è¿‡å¤š</td>
</tr>
<tr>
<td><code>403.10</code></td>
<td>é…ç½®æ— æ•ˆ</td>
</tr>
<tr>
<td><code>403.11</code></td>
<td>å¯†ç æ›´æ”¹</td>
</tr>
<tr>
<td><code>403.12</code></td>
<td>æ‹’ç»è®¿é—®æ˜ å°„è¡¨</td>
</tr>
<tr>
<td><code>403.13</code></td>
<td>å®¢æˆ·ç«¯è¯ä¹¦è¢«åŠé”€</td>
</tr>
<tr>
<td><code>403.14</code></td>
<td>æ‹’ç»ç›®å½•åˆ—è¡¨</td>
</tr>
<tr>
<td><code>403.15</code></td>
<td>è¶…å‡ºå®¢æˆ·ç«¯è®¿é—®è®¸å¯</td>
</tr>
<tr>
<td><code>403.16</code></td>
<td>å®¢æˆ·ç«¯è¯ä¹¦ä¸å—ä¿¡ä»»æˆ–æ— æ•ˆ</td>
</tr>
<tr>
<td><code>403.17</code></td>
<td>å®¢æˆ·ç«¯è¯ä¹¦å·²è¿‡æœŸæˆ–å°šæœªç”Ÿæ•ˆ</td>
</tr>
<tr>
<td><code>403.18</code></td>
<td>å†å½“å‰çš„åº”ç”¨ç¨‹åºæ± ä¸­ä¸èƒ½æ‰§è¡Œæ‰€è¯·æ±‚çš„URLã€‚è¿™ä¸ªé”™è¯¯ç ä¸º<code>IIS 6.0</code>æ‰€ä¸“ç”¨ã€‚</td>
</tr>
<tr>
<td><code>403.19</code></td>
<td>ä¸èƒ½ä¸ºè¿™ä¸ªåº”ç”¨ç¨‹åºæ± ä¸­çš„å®¢æˆ·ç«¯æ‰§è¡Œ<code>CGI</code>ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º<code>IIS 6.0</code>æ‰€ä¸“ç”¨</td>
</tr>
<tr>
<td><code>403.20</code></td>
<td><code>Passport</code>ç™»å½•å¤±è´¥ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º<code>IIS 6.0</code>æ‰€ä¸“ç”¨</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/404" rel="external" target="_self"><code>404 Not Found</code></a></td>
<td>æœåŠ¡å™¨æ‰¾ä¸åˆ°è¯·æ±‚çš„èµ„æºã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œè¿™æ„å‘³ç€æ— æ³•è¯†åˆ«<code>URL</code>ã€‚åœ¨<code>API</code>ä¸­ï¼Œè¿™ä¹Ÿå¯èƒ½æ„å‘³ç€ç«¯ç‚¹æœ‰æ•ˆï¼Œä½†èµ„æºæœ¬èº«ä¸å­˜åœ¨ã€‚æœåŠ¡å™¨ä¹Ÿå¯ä»¥å‘é€æ­¤å“åº”ï¼Œè€Œä¸æ˜¯ <code>403 Forbidden</code>ï¼Œä»¥å‘æœªç»æˆæƒçš„å®¢æˆ·ç«¯éšè—èµ„æºçš„å­˜åœ¨ã€‚è¿™ä¸ªå“åº”ä»£ç å¯èƒ½æ˜¯æœ€å¹¿ä¸ºäººçŸ¥çš„ï¼Œå› ä¸ºå®ƒç»å¸¸å‡ºç°åœ¨ç½‘ç»œä¸Š</td>
</tr>
<tr>
<td><code>404.0</code></td>
<td>(æ— )-æ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶æˆ–ç›®å½•</td>
</tr>
<tr>
<td><code>404.1</code></td>
<td>æ— æ³•åœ¨æ‰€è¯·æ±‚çš„ç«¯å£ä¸Šè®¿é—®<code>Web</code>ç«™ç‚¹</td>
</tr>
<tr>
<td><code>404.2</code></td>
<td><code>Web</code>æœåŠ¡æ‰©å±•é”å®šç­–ç•¥ç»„ç»‡æœ¬è¯·æ±‚</td>
</tr>
<tr>
<td><code>404.3</code></td>
<td><code>MIME</code>æ˜ å°„ç­–ç•¥é˜»æ­¢æœ¬è¯·æ±‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/405" rel="external" target="_self"><code>405 Method Not Allowed</code></a></td>
<td>æœåŠ¡å™¨çŸ¥é“è¯·æ±‚æ–¹æ³•ï¼Œä½†ç›®æ ‡èµ„æºä¸æ”¯æŒè¯¥æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œ<code>API</code>å¯èƒ½ä¸å…è®¸è°ƒç”¨<code>DELETE</code>æ¥åˆ é™¤èµ„æºã€‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/406" rel="external" target="_self"><code>406 Not Acceptable</code></a></td>
<td>å½“<code>web</code>æœåŠ¡å™¨åœ¨æ‰§è¡Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Content_negotiation#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%A9%B1%E5%8A%A8%E5%9E%8B%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E6%9C%BA%E5%88%B6" rel="external" target="_self">æœåŠ¡ç«¯é©±åŠ¨å‹å†…å®¹åå•†æœºåˆ¶</a>åï¼Œæ²¡æœ‰å‘ç°ä»»ä½•ç¬¦åˆç”¨æˆ·ä»£ç†ç»™å®šæ ‡å‡†çš„å†…å®¹æ—¶ï¼Œå°±ä¼šå‘é€æ­¤å“åº”ï¼ŒæœåŠ¡å™¨ç”Ÿæˆçš„å“åº”æ— æ³•è¢«å®¢æˆ·ç«¯æ‰€æ¥å—</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/407" rel="external" target="_self"><code>407 Proxy Authentication Required</code></a></td>
<td>ç±»ä¼¼äº<code>401 Unauthorized</code>ï¼Œä½†æ˜¯ç”¨æˆ·å¿…é¡»é¦–å…ˆä½¿ç”¨ä»£ç†æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼Œè¿™æ ·è¯·æ±‚æ‰ä¼šè¢«å¤„ç†</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/408" rel="external" target="_self"><code>408 Request Timeout</code></a></td>
<td>æ­¤å“åº”ç”±ä¸€äº›æœåŠ¡å™¨åœ¨ç©ºé—²è¿æ¥ä¸Šå‘é€ï¼Œå³ä½¿å®¢æˆ·ç«¯ä¹‹å‰æ²¡æœ‰ä»»ä½•è¯·æ±‚ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨æƒ³å…³é—­è¿™ä¸ªæœªä½¿ç”¨çš„è¿æ¥ã€‚ç”±äºä¸€äº›æµè§ˆå™¨ï¼Œå¦‚<code>Chrome</code>ã€<code>Firefox 27+</code>æˆ–<code>IE9</code>ï¼Œä½¿ç”¨<code>HTTP</code>é¢„è¿æ¥æœºåˆ¶æ¥åŠ é€Ÿå†²æµªï¼Œæ‰€ä»¥è¿™ç§å“åº”è¢«ä½¿ç”¨å¾—æ›´å¤šã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰äº›æœåŠ¡å™¨åªæ˜¯å…³é—­äº†è¿æ¥è€Œæ²¡æœ‰å‘é€æ­¤æ¶ˆæ¯</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/409" rel="external" target="_self"><code>409 Conflict</code></a></td>
<td>è¯·æ±‚ä¸æœåŠ¡å™¨çš„å½“å‰çŠ¶æ€å†²çªï¼Œè¯·æ±‚æ— æ³•è¢«å®Œæˆ</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/410" rel="external" target="_self"><code>410 Gone</code></a></td>
<td>å½“è¯·æ±‚çš„å†…å®¹å·²ä»æœåŠ¡å™¨ä¸­æ°¸ä¹…åˆ é™¤ä¸”<strong>é¡µé¢ä¸å¯ç”¨</strong>ä¹Ÿæ²¡æœ‰è½¬å‘åœ°å€æ—¶ï¼Œå°†å‘é€æ­¤å“åº”ã€‚å®¢æˆ·ç«¯éœ€è¦åˆ é™¤ç¼“å­˜å’ŒæŒ‡å‘èµ„æºçš„é“¾æ¥ã€‚<code>HTTP</code>è§„èŒƒæ‰“ç®—å°†æ­¤çŠ¶æ€ä»£ç ç”¨äº<strong>æœ‰é™æ—¶é—´çš„ä¿ƒé”€æœåŠ¡</strong>ã€‚<code>API</code>ä¸åº”è¢«è¿«æŒ‡å‡ºå·²ä½¿ç”¨æ­¤çŠ¶æ€ä»£ç åˆ é™¤çš„èµ„æº</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/411" rel="external" target="_self"><code>411 Length Required</code></a></td>
<td>æœåŠ¡ç«¯æ‹’ç»è¯¥è¯·æ±‚å› ä¸º<code>Content-Length</code>å¤´éƒ¨å­—æ®µæœªå®šä¹‰ä½†æ˜¯æœåŠ¡ç«¯éœ€è¦å®ƒ</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/412" rel="external" target="_self"><code>412 Precondition Failed</code></a></td>
<td>å®¢æˆ·ç«¯åœ¨å…¶å¤´æ–‡ä»¶ä¸­æŒ‡å‡ºäº†æœåŠ¡å™¨ä¸æ»¡è¶³çš„å…ˆå†³æ¡ä»¶</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/413" rel="external" target="_self"><code>413 Payload Too Large</code></a></td>
<td>è¯·æ±‚å®ä½“å¤§äºæœåŠ¡å™¨å®šä¹‰çš„é™åˆ¶ã€‚æœåŠ¡å™¨å¯èƒ½ä¼šå…³é—­è¿æ¥ï¼Œæˆ–åœ¨æ ‡å¤´å­—æ®µåè¿”å›é‡è¯•<code>Retry-After</code></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/414" rel="external" target="_self"><code>414 URI Too Long</code></a></td>
<td>å®¢æˆ·ç«¯è¯·æ±‚çš„<code>URI</code>æ¯”æœåŠ¡å™¨æ„¿æ„æ¥æ”¶çš„é•¿åº¦é•¿ã€‚å½“<code>post</code>è¯·æ±‚è¢«è½¬æ¢ä¸ºå¸¦æœ‰å¾ˆé•¿çš„æŸ¥è¯¢ä¿¡æ¯çš„<code>get</code>è¯·æ±‚æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µ</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/415" rel="external" target="_self"><code>415 Unsupported Media Type</code></a></td>
<td>æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚æ•°æ®çš„åª’ä½“æ ¼å¼ï¼Œå› æ­¤æœåŠ¡å™¨æ‹’ç»è¯·æ±‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/416" rel="external" target="_self"><code>416 Range Not Satisfiable</code></a></td>
<td>æ— æ³•æ»¡è¶³è¯·æ±‚ä¸­<code>Range</code>æ ‡å¤´å­—æ®µæŒ‡å®šçš„èŒƒå›´ã€‚è¯¥èŒƒå›´å¯èƒ½è¶…å‡ºäº†ç›®æ ‡<code>URI</code>æ•°æ®çš„å¤§å°ï¼Œ<code>range</code>èŒƒå›´å¼‚å¸¸ï¼Œå¦‚**<code>rangeStart&lt; 0</code><strong>ã€</strong><code>rangeStart&gt;rangeEnd</code><strong>ã€</strong><code>rangeStart&gt;FileSize</code>**</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/417" rel="external" target="_self"><code>417 Expectation Failed</code></a></td>
<td>æ­¤å“åº”ä»£ç è¡¨ç¤ºæœåŠ¡å™¨æ— æ³•æ»¡è¶³<code>Expect</code>è¯·æ±‚æ ‡å¤´å­—æ®µæ‰€æŒ‡ç¤ºçš„æœŸæœ›</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/418" rel="external" target="_self"><code>418 I'm a teapot</code></a></td>
<td>æœåŠ¡ç«¯æ‹’ç»ç”¨èŒ¶å£¶ç…®å’–å•¡ã€‚ç¬‘è¯å…¸æ•…æ¥æº<a href="https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E5%92%96%E5%95%A1%E5%A3%B6%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE" rel="external" target="_self">èŒ¶å£¶å†²æ³¡å’–å•¡</a><!-- raw HTML omitted -->å¯¹äºæ¥å…¥<code>EdgeOne</code>çš„åŸŸåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºåŸŸååˆ†é…æœåŠ¡èŠ‚ç‚¹ï¼Œä¸”å¯¹åº”çš„èŠ‚ç‚¹å‡ä¼šä¸‹å‘è¯¥åŸŸåçš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­æ–‡ä»¶å†…å®¹å–å†³äºåŸŸåçš„é…ç½®ï¼Œå¦‚æºç«™ã€ç¼“å­˜ã€å¤´éƒ¨ç­‰ã€‚å½“è¯·æ±‚å‘é€ç»™èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹ä¼šè¯»å–åŸŸåçš„é…ç½®æ–‡ä»¶ï¼Œå½“å‘ç°é…ç½®æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œåˆ™å“åº”<code>418</code>çŠ¶æ€ç ã€‚ ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ï¼š<code>http://example.com/test.jpg</code>ï¼Œåˆ™èŠ‚ç‚¹ä¼šè¯»å–åŸŸå <code>example.com</code>çš„é…ç½®æ–‡ä»¶ï¼Œå¯èƒ½ç”±äºç»‘å®šäº†<code>é example.com</code> åŸŸåçš„æœåŠ¡èŠ‚ç‚¹ï¼Œ<code>CNAME</code>é…ç½®é”™è¯¯æˆ–è€…è°ƒåº¦ç³»ç»Ÿå¼‚å¸¸ç­‰åŸå› ï¼Œå®¢æˆ·ç«¯ä¼šæ¥æ”¶åˆ°<code>418</code>å“åº”ã€‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/421" rel="external" target="_self"><code>421 Misdirected Request</code></a></td>
<td>è¯·æ±‚è¢«å®šå‘åˆ°æ— æ³•ç”Ÿæˆå“åº”çš„æœåŠ¡å™¨ã€‚è¿™å¯ä»¥ç”±æœªé…ç½®ä¸ºé’ˆå¯¹è¯·æ±‚<code>URI</code>ä¸­åŒ…å«çš„æ–¹æ¡ˆå’Œæƒé™ç»„åˆç”Ÿæˆå“åº”çš„æœåŠ¡å™¨å‘é€</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/422" rel="external" target="_self"><code>422 Unprocessable Entity</code></a></td>
<td>è¯·æ±‚æ ¼å¼æ­£ç¡®ï¼Œä½†ç”±äºè¯­ä¹‰é”™è¯¯è€Œæ— æ³•éµå¾ª</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/423" rel="external" target="_self"><code>423 Locked</code></a></td>
<td>æ­£åœ¨è®¿é—®çš„èµ„æºå·²é”å®š<!-- raw HTML omitted -->è§¦å‘è¯·æ±‚å›ç¯ï¼Œæœ‰ä»¥ä¸‹ 2 ä¸ªåœºæ™¯ï¼š<!-- raw HTML omitted --><code>CDN-Loop</code>å¤´éƒ¨çš„<code>Loops</code>æ•°å€¼<code>â‰¥ 16</code>ï¼Œè¯¦æƒ…è¯·å‚è§ <a href="https://www.tencentcloud.com/document/product/1145/54211#3840f0f9-aacb-408f-a519-31c89191b9ac" rel="external" target="_self"><code>CDN-Loop</code></a><!-- raw HTML omitted -->åŒä¸€ä¸ªè¯·æ±‚ï¼Œä¸¤æ¬¡ç»è¿‡åŒä¸€å°èŠ‚ç‚¹è®¾å¤‡</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/424" rel="external" target="_self"><code>424 Failed Dependency</code></a></td>
<td>ç”±äºå‰ä¸€ä¸ªè¯·æ±‚å¤±è´¥ï¼Œè¯·æ±‚å¤±è´¥</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/425" rel="external" target="_self"><code>425 Too Early</code></a></td>
<td>è¡¨ç¤ºæœåŠ¡å™¨ä¸æ„¿æ„å†’é™©å¤„ç†å¯èƒ½è¢«é‡æ’­çš„è¯·æ±‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/426" rel="external" target="_self"><code>426 Upgrade Required</code></a></td>
<td>æœåŠ¡å™¨æ‹’ç»ä½¿ç”¨å½“å‰åè®®æ‰§è¡Œè¯·æ±‚ï¼Œä½†åœ¨å®¢æˆ·ç«¯å‡çº§åˆ°å…¶ä»–åè®®åå¯èƒ½æ„¿æ„è¿™æ ·åšã€‚ æœåŠ¡ç«¯å‘é€å¸¦æœ‰<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Upgrade" rel="external" target="_self"><code>Upgrade</code></a>å­—æ®µçš„<code>426</code>å“åº” æ¥è¡¨æ˜å®ƒæ‰€éœ€çš„åè®®ï¼ˆä»¬ï¼‰</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/428" rel="external" target="_self"><code>428 Precondition Required</code></a></td>
<td>æºæœåŠ¡å™¨è¦æ±‚è¯·æ±‚æ˜¯æœ‰æ¡ä»¶çš„ã€‚æ­¤å“åº”æ—¨åœ¨é˜²æ­¢&rsquo;ä¸¢å¤±æ›´æ–°&rsquo;é—®é¢˜ï¼Œå³å½“ç¬¬ä¸‰æ–¹ä¿®æ”¹æœåŠ¡å™¨ä¸Šçš„çŠ¶æ€æ—¶ï¼Œå®¢æˆ·ç«¯<code>GET</code>è·å–èµ„æºçš„çŠ¶æ€ï¼Œå¯¹å…¶è¿›è¡Œä¿®æ”¹å¹¶å°†å…¶<code>PUT</code>æ”¾å›æœåŠ¡å™¨ï¼Œä»è€Œå¯¼è‡´å†²çª</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/429" rel="external" target="_self"><code>429 Too Many Requests</code></a></td>
<td>ç”¨æˆ·åœ¨ç»™å®šçš„æ—¶é—´å†…å‘é€äº†å¤ªå¤šè¯·æ±‚ï¼ˆ<strong>é™åˆ¶è¯·æ±‚é€Ÿç‡</strong>ï¼‰</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/431" rel="external" target="_self"><code>431 Request Header Fields Too Large</code></a></td>
<td>æœåŠ¡å™¨ä¸æ„¿æ„å¤„ç†è¯·æ±‚ï¼Œå› ä¸ºå…¶å¤´å­—æ®µå¤ªå¤§ã€‚åœ¨å‡å°è¯·æ±‚å¤´å­—æ®µçš„å¤§å°åï¼Œå¯ä»¥é‡æ–°æäº¤è¯·æ±‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/451" rel="external" target="_self"><code>451 Unavailable For Legal Reasons</code></a></td>
<td>ç”¨æˆ·ä»£ç†è¯·æ±‚äº†æ— æ³•åˆæ³•æä¾›çš„èµ„æºï¼Œä¾‹å¦‚æ”¿åºœå®¡æŸ¥çš„ç½‘é¡µ</td>
</tr>
<tr>
<td><code>EdgeOne</code>è‡ªå®šä¹‰çŠ¶æ€ç ï¼š499</td>
<td>å®¢æˆ·ç«¯è¯·æ±‚åˆ°èŠ‚ç‚¹ï¼Œè¿˜æ²¡ç­‰åˆ°èŠ‚ç‚¹å“åº”å°±ä¸»åŠ¨æ–­å¼€è¯·æ±‚ï¼Œå¦‚å…³é—­è¯·æ±‚é¡µé¢ç­‰ï¼Œåˆ™æ—¥å¿—&amp;ç›‘æ§ä¼šè®°å½•ä¸º<code>499</code>çŠ¶æ€ç </td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="500599æœåŠ¡å™¨é”™è¯¯å“åº”"><code>500ï½599</code>æœåŠ¡å™¨é”™è¯¯å“åº”</h3>
<blockquote>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/500" rel="external" target="_self"><code>500 Internal Server Error</code></a></td>
<td>è¯·æ±‚æœªå®Œæˆã€‚æœåŠ¡å™¨é‡åˆ°äº†ä¸çŸ¥é“å¦‚ä½•å¤„ç†çš„æƒ…å†µ</td>
</tr>
<tr>
<td><code>500.12</code></td>
<td>åº”ç”¨ç¨‹åºæ­£å¿™äºåœ¨<code>Web</code>æœåŠ¡å™¨ä¸Šé‡å¯</td>
</tr>
<tr>
<td><code>500.13</code></td>
<td><code>Web</code>æœåŠ¡å™¨å¤ªå¿™</td>
</tr>
<tr>
<td><code>500.15</code></td>
<td>ä¸å…è®¸ç›´æ¥è¯·æ±‚<code>Global.asa</code></td>
</tr>
<tr>
<td><code>500.16</code></td>
<td><code>UNC</code>æˆæƒå‡­æ®ä¸æ­£ç¡®ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º<code>IIS 6.0</code>æ‰€ä¸“ç”¨</td>
</tr>
<tr>
<td><code>500.18</code></td>
<td><code>URL</code>æˆæƒå­˜å‚¨ä¸èƒ½æ‰“å¼€ã€‚è¿™ä¸ªé”™è¯¯ä»£ç ä¸º<code>IIS 6.0</code>æ‰€ä¸“ç”¨</td>
</tr>
<tr>
<td><code>500.100</code></td>
<td>å†…éƒ¨<code>ASP</code>é”™è¯¯</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/501" rel="external" target="_self"><code>501 Not Implemented</code></a></td>
<td>æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚æ–¹æ³•ï¼Œå› æ­¤æ— æ³•å¤„ç†ã€‚æœåŠ¡å™¨éœ€è¦æ”¯æŒçš„å”¯äºŒæ–¹æ³•ï¼ˆå› æ­¤ä¸èƒ½è¿”å›æ­¤ä»£ç ï¼‰æ˜¯<code>GET and HEAD</code></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/502" rel="external" target="_self"><code>502 Bad Gateway</code></a></td>
<td>è¯·æ±‚æœªå®Œæˆã€‚æœåŠ¡å™¨ä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªæ— æ•ˆçš„å“åº”</td>
</tr>
<tr>
<td><code>502.1</code></td>
<td><code>CGI</code>åº”ç”¨ç¨‹åºè¶…æ—¶</td>
</tr>
<tr>
<td><code>502.2</code></td>
<td><code>CGI</code>åº”ç”¨ç¨‹åºå‡ºé”™</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/503" rel="external" target="_self"><code>503 Service Unavailable</code></a></td>
<td>æœåŠ¡å™¨æ²¡æœ‰å‡†å¤‡å¥½å¤„ç†è¯·æ±‚ï¼Œå¸¸è§åŸå› æ˜¯<strong>æœåŠ¡å™¨ä¸´æ—¶è¿‡è½½</strong>æˆ–<strong>å½“æœº</strong> è¯·æ³¨æ„ï¼Œä¸æ­¤å“åº”ä¸€èµ·ï¼Œåº”å‘é€è§£é‡Šé—®é¢˜çš„ç”¨æˆ·å‹å¥½é¡µé¢ã€‚è¿™ä¸ªå“åº”åº”è¯¥ç”¨äºä¸´æ—¶æ¡ä»¶å’Œå¦‚æœå¯èƒ½çš„è¯ï¼Œ<code>HTTP</code>æ ‡å¤´<code>Retry-After</code>å­—æ®µåº”è¯¥åŒ…å«æ¢å¤æœåŠ¡ä¹‹å‰çš„ä¼°è®¡æ—¶é—´ã€‚ç½‘ç«™ç®¡ç†å‘˜è¿˜å¿…é¡»æ³¨æ„ä¸æ­¤å“åº”ä¸€èµ·å‘é€çš„ä¸ç¼“å­˜ç›¸å…³çš„æ ‡å¤´ï¼Œå› ä¸ºè¿™äº›ä¸´æ—¶æ¡ä»¶å“åº”é€šå¸¸ä¸åº”è¢«ç¼“å­˜</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/504" rel="external" target="_self"><code>504 Gateway Timeout</code></a></td>
<td>å½“æœåŠ¡å™¨å……å½“ç½‘å…³ä¸”<strong>æ— æ³•åŠæ—¶è·å¾—å“åº”</strong>æ—¶ã€<!-- raw HTML omitted -->åç«¯æœåŠ¡æ‰§è¡Œè¶…æ—¶ï¼ˆæ•°æ®åº“å–æ•°æ®å¾ˆæ…¢çš„æ—¶å€™ã€åç«¯è´Ÿè½½å¾ˆé«˜ã€è¿æ¥è¶…æ—¶ï¼‰ï¼Œ<code>Nginx</code>é»˜è®¤çš„ç­‰å¾…æ—¶é—´æ˜¯<code>60</code>ç§’ï¼Œè¶…è¿‡<code>60</code>ç§’<code>Nginx</code>å°±ä¼šè¿”å›<!-- raw HTML omitted --><code>504</code></td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/505" rel="external" target="_self"><code>505 HTTP Version Not Supported</code></a></td>
<td>æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚ä¸­ä½¿ç”¨çš„<code>HTTP</code>ç‰ˆæœ¬</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/506" rel="external" target="_self"><code>506 Variant Also Negotiates</code></a></td>
<td>æœåŠ¡å™¨å­˜åœ¨å†…éƒ¨é…ç½®é”™è¯¯ï¼šæ‰€é€‰çš„å˜ä½“èµ„æºè¢«é…ç½®ä¸ºå‚ä¸é€æ˜å†…å®¹åå•†æœ¬èº«ï¼Œå› æ­¤ä¸æ˜¯åå•†è¿‡ç¨‹ä¸­çš„é€‚å½“ç»ˆç‚¹</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/507" rel="external" target="_self"><code>507 Insufficient Storage</code></a></td>
<td>æ— æ³•åœ¨èµ„æºä¸Šæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå› ä¸ºæœåŠ¡å™¨æ— æ³•å­˜å‚¨æˆåŠŸå®Œæˆè¯·æ±‚æ‰€éœ€çš„è¡¨ç¤º</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/508" rel="external" target="_self"><code>508 Loop Detected</code></a></td>
<td>æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶æ£€æµ‹åˆ°æ— é™å¾ªç¯</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/510" rel="external" target="_self"><code>510 Not Extended</code></a></td>
<td>æœåŠ¡å™¨éœ€è¦å¯¹è¯·æ±‚è¿›è¡Œè¿›ä¸€æ­¥æ‰©å±•æ‰èƒ½å®Œæˆè¯·æ±‚</td>
</tr>
<tr>
<td><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/511" rel="external" target="_self"><code>511 Network Authentication Required</code></a></td>
<td>æŒ‡ç¤ºå®¢æˆ·ç«¯éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯æ‰èƒ½è·å¾—ç½‘ç»œè®¿é—®æƒé™</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="websocketçŠ¶æ€ç "><code>WebSocket</code>çŠ¶æ€ç </h2>
<blockquote>
<ul>
<li><code>websocat</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ websocat <span style="color:#e6db74">&#34;wss://your-websocket-url&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>wscat</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wscat -c <span style="color:#e6db74">&#34;wss://your-websocket-url&#34;</span> </span></span></code></pre></div></blockquote>
<ul>
<li>æ­£å¸¸å…³é—­</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1000</strong>: æ­£å¸¸å…³é—­(<code>Normal Closure</code>)</p>
<p>è¿™æ„å‘³ç€<code>WebSocket</code>è¿æ¥å·²å»ºç«‹å¹¶ä¸”è¯·æ±‚å·²å®Œæˆã€‚ä¼šè¯å¤„äºç©ºé—²çŠ¶æ€æ—¶ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æ­¤çŠ¶æ€ï¼Œä»è€Œå¯¼è‡´è¿æ¥è¶…æ—¶</p>
</li>
</ul>
</blockquote>
<ul>
<li>æœåŠ¡å™¨å…³é—­</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1001</strong>: åŒºåŸŸæˆ–ç»ˆç«¯è®¾å¤‡ç¦»å¼€<code>Going Away</code>)</p>
<p>æœåŠ¡å™¨æ­£åœ¨å…³é—­ï¼Œæˆ–ç”±äºå®¢æˆ·ç«¯ç¦»å¼€æˆ–è€…ç»ˆç«¯è®¾å¤‡å…³é—­ï¼Œè¿æ¥å³å°†å…³é—­</p>
</li>
</ul>
</blockquote>
<ul>
<li>åè®®é”™è¯¯</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1002</strong>: åè®®é”™è¯¯(<code>Protocol Error</code>)</p>
<p>è¡¨ç¤ºç«¯ç‚¹ç”±äºåè®®é”™è¯¯ï¼ŒæœåŠ¡å™¨ä¸èƒ½å¤„ç†è¯·æ±‚è€Œç»ˆæ­¢è¿æ¥</p>
</li>
</ul>
</blockquote>
<ul>
<li>æ— æ³•æ¥å—</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1003</strong>: ä¸æ”¯æŒçš„æ•°æ®ç±»å‹(<code>Unsupported Data</code>)</p>
<p>æ­¤çŠ¶æ€ä»£ç è¡¨ç¤ºé”™è¯¯çŠ¶æ€ï¼Œå…¶ä¸­ç«¯ç‚¹ä»¥æ— æ³•æ¥å—çš„æ ¼å¼æ¥æ”¶æ•°æ®è€Œç»ˆæ­¢è¿æ¥ã€‚ç«¯ç‚¹ä»…æ”¯æŒæ–‡æœ¬æ•°æ®ï¼Œå¦‚æœå®ƒæ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„äºŒè¿›åˆ¶æ¶ˆæ¯æˆ–ä½¿ç”¨ä¸å—æ”¯æŒçš„æ ¼å¼çš„æ¶ˆæ¯ï¼Œå¯èƒ½ä¼šæ˜¾ç¤ºæ­¤çŠ¶æ€ä»£ç </p>
</li>
</ul>
</blockquote>
<ul>
<li>è¿æ¥è¶…æ—¶</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1004</strong>: ä¿ç•™çŠ¶æ€ç (<code>Reserved</code>)</p>
<p>è¿™ä¸ªçŠ¶æ€ç åœ¨<code>WebSocket</code>åè®®ä¸­æ˜¯ä¿ç•™çš„ï¼Œé€šå¸¸åœ¨å®ç°ä¸­ä¸ä¼šè¢«ä½¿ç”¨ã€‚å®ƒå¯èƒ½åœ¨æœªæ¥è¢«å®šä¹‰ç”¨äºæŸäº›ç‰¹å®šçš„ç›®çš„</p>
</li>
</ul>
</blockquote>
<ul>
<li>æ–­è¨€å¤±è´¥</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1005</strong>: æ— çŠ¶æ€ç (<code>No Status Received</code>)</p>
<p>è¿™ä¸ªçŠ¶æ€ç ä¹Ÿæ˜¯ä¿ç•™çš„ï¼Œè¡¨ç¤ºè¿æ¥å…³é—­æ—¶æ²¡æœ‰è¿”å›çŠ¶æ€ç ã€‚é€šå¸¸ï¼Œå®ƒç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨æ¥è¡¨ç¤ºå…³é—­æ—¶æœªåŒ…å«çŠ¶æ€ç çš„æƒ…å†µ</p>
</li>
</ul>
</blockquote>
<ul>
<li>å¤„ç†è¿‡å¿«</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1006</strong>: å¼‚å¸¸å…³é—­(<code>Abnormal Closure</code>)</p>
<p>è¿æ¥ç”±äºé”™è¯¯æˆ–å¼‚å¸¸è¢«å…³é—­ï¼Œæ²¡æœ‰æ”¶åˆ°å…³é—­å¸§</p>
</li>
</ul>
</blockquote>
<ul>
<li>ä¸ç¬¦åˆåè®®</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1007</strong>: ä¸ä¸€è‡´çš„æ•°æ®(<code>Invalid Frame Payload Data</code>)</p>
<p>æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªæ ¼å¼ä¸ç¬¦åˆåè®®çš„æ•°æ®å¸§</p>
</li>
</ul>
</blockquote>
<ul>
<li>æ¶æ„å…³é—­</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1008</strong>: ä¸åˆé€‚çš„å…³é—­(<code>Policy Violation</code>)</p>
<p>æ­¤çŠ¶æ€ä»£ç è¡¨ç¤ºé”™è¯¯çŠ¶æ€ï¼Œç«¯ç‚¹å› æ”¶åˆ°è¿åå…¶ç­–ç•¥çš„æ¶ˆæ¯è€Œç»ˆæ­¢è¿æ¥ã€‚æ­¤çŠ¶æ€ä¸ºé€šç”¨çŠ¶æ€ï¼Œå½“å…¶ä»–çŠ¶æ€ä»£ç ï¼ˆä¾‹å¦‚<code>1003</code>æˆ–<code>1009</code>ï¼‰ä¸é€‚ç”¨æ—¶æ˜¾ç¤ºã€‚å¦‚æœéœ€è¦éšè—ç­–ç•¥æˆ–æˆæƒå¤±è´¥ï¼ˆä¾‹å¦‚ç­¾åè¿‡æœŸï¼‰ï¼Œæ‚¨è¿˜ä¼šçœ‹åˆ°æ­¤çŠ¶æ€æ˜¾ç¤º</p>
</li>
</ul>
</blockquote>
<ul>
<li>æ•°æ®å¤ªå¤§</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1009</strong>: æ¶ˆæ¯å¤ªå¤§(<code>Message Too Big</code>)</p>
<p>æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚çš„æ¶ˆæ¯ï¼Œå› ä¸ºå®ƒå¤ªå¤§</p>
</li>
</ul>
</blockquote>
<ul>
<li>æ‰©å±•æœªåå•†</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1010</strong>: æ‰©å±•æœªåå•†(<code>Missing Extension</code>)</p>
<p>æœåŠ¡å™¨éœ€è¦å®¢æˆ·ç«¯æ”¯æŒæŸäº›æ‰©å±•ï¼Œä½†å®¢æˆ·ç«¯æ²¡æœ‰åå•†è¿™äº›æ‰©å±•</p>
</li>
</ul>
</blockquote>
<ul>
<li>æœåŠ¡å™¨é”™è¯¯</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1011</strong>: æœåŠ¡å™¨é”™è¯¯(<code>Internal Server Error</code>)</p>
<p>æ­¤çŠ¶æ€ä»£ç è¡¨ç¤ºé”™è¯¯çŠ¶æ€ï¼Œå…¶ä¸­æœåŠ¡å™¨å› é‡åˆ°æ„å¤–æƒ…å†µæˆ–å†…éƒ¨é”™è¯¯è€Œå¯¼è‡´æ— æ³•å®Œæˆè¯·æ±‚è€Œç»ˆæ­¢è¿æ¥</p>
</li>
</ul>
</blockquote>
<ul>
<li>æœåŠ¡é‡å¯</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1012</strong>: æœåŠ¡å™¨é‡å¯(<code>Service Restart</code>)</p>
<p>æœåŠ¡å™¨æ­£åœ¨é‡å¯</p>
</li>
</ul>
</blockquote>
<ul>
<li>ä¸ç¬¦åˆåè®®çš„æ“ä½œ</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>1013</strong>: ä¸æ”¯æŒçš„æ“ä½œ(<code>Try Again Later</code>)</p>
<p>æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ï¼Œå› ä¸ºå®ƒå½“å‰æ— æ³•æ”¯æŒæ“ä½œï¼Œå»ºè®®ç¨åé‡è¯•</p>
</li>
</ul>
</blockquote>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install-nginx">Install Nginx</h1>

<h2 id="å®‰è£…nginx">å®‰è£…<code>nginx</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.dedecms.com/" rel="external" target="_self"><code>DedeCms</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.discuz.net/" rel="external" target="_self"><code>Discuz!</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://wordpress.com/zh-cn/" rel="external" target="_self"><code>WordPress</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/bettershop/LaikeTui" rel="external" target="_self"><code>LaikeTui</code></a></td>
<td>æ¥å®¢æ¨å•†åŸ</td>
</tr>
<tr>
<td><a href="https://github.com/crmeb/CRMEB?tab=readme-ov-file" rel="external" target="_self"><code>CRMEB</code></a></td>
<td>å•†åŸ</td>
</tr>
<tr>
<td><a href="https://www.drupal.org/" rel="external" target="_self"><code>drupal CMS</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://tengine.taobao.org/" rel="external" target="_self"><code>Nginx-Tengine</code></a>ã€<a href="https://github.com/alibaba/tengine" rel="external" target="_self"><code>Nginx_Github_Tengine</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://openresty.org/cn/" rel="external" target="_self"><code>Nginx-OpenResty</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cainiao.io/archives/988" rel="external" target="_self"><code>CentOS7</code>ä¸Šç¼–è¯‘å®‰è£…<code>Tengine</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://metasploit.com/" rel="external" target="_self"><code>Metasploit</code>æ¸—é€é¶æœº</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/digininja/DVWA" rel="external" target="_self"><code>DVWA</code>æ¸—é€æµ‹è¯•é¶æœº</a></td>
<td></td>
</tr>
<tr>
<td><a href="http://redtiger.labs.overthewire.org/" rel="external" target="_self">çº¢è™çš„é»‘å®¢<code>SQL</code>æ³¨å…¥</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://nginx.org/en/docs/" rel="external" target="_self"><code>nginx documentation</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.businessprocessincubator.com/content/top-20-python-based-cms-that-every-developer-should-know/" rel="external" target="_self">æ¯ä¸ªå¼€å‘äººå‘˜éƒ½åº”è¯¥çŸ¥é“çš„åŸºäº<code>Python</code>çš„<code>20</code>å¤§<code>CMS</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.hws.com/soft/wzs/" rel="external" target="_self">æŠ¤å«ç¥</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…ä¾èµ–æ‰©å±•åŒ…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Debian ç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>$ sudo apt-get install libpcre3 libpcre3-dev zlib1g-dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum -y install wget gcc gcc-c++ pcre-devel zlib-devel openssl openssl-devel</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>root</code><!-- raw HTML omitted -->ç”¨æˆ·ä¸‹è½½<!-- raw HTML omitted --><code>nginx</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget http://nginx.org/download/nginx-1.20.2.tar.gz -P /usr/local/src/
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/nginx-1.20.2.tar.gz  -C /usr/local/src/</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è¿›å…¥åˆ°è§£å‹åçš„ç›®å½•è¿›è¡Œç¼–è¯‘å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>SSL/TLS</code><!-- raw HTML omitted -->å’Œå®‰å…¨æ¨¡å—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p>**<code>--with-http_ssl_module</code>**ä½¿ç”¨<code>HTTPS</code>åè®®æ¥<!-- raw HTML omitted -->åŠ å¯†<!-- raw HTML omitted -->å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡
**<code>--with-http_limit_conn_module</code>**é™åˆ¶è¿æ¥æ•°
**<code>--with-http_limit_req_module</code>**é™åˆ¶è¯·æ±‚é€Ÿç‡
**<code>--with-http_realip_module</code>**ç”¨äºä»ä»£ç†æœåŠ¡å™¨ä¸­è·å–çœŸå®çš„å®¢æˆ·ç«¯<code>IP</code>åœ°å€ï¼Œè§£å†³å®¢æˆ·ç«¯<code>IP</code>è¢«ä¼ªé€ çš„é—®é¢˜<br>
**<code>--with-http_access_module</code>**æä¾›<code>IP</code>åœ°å€è®¿é—®æ§åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥é™åˆ¶è®¿é—®æŸäº›<code>IP</code>æˆ–<code>IP</code>èŒƒå›´<br>
**<code>--with-http_auth_basic_module</code>**æä¾›åŸºæœ¬çš„<code>HTTP</code>è®¤è¯åŠŸèƒ½ï¼Œå¯ä»¥å®ç°åŸºäºç”¨æˆ·åå’Œå¯†ç çš„è®¤è¯<br>
**<code>--with-http_userid_module</code>**æä¾›åŸºäº<code>Cookie</code>çš„ä¼šè¯è·Ÿè¸ªåŠŸèƒ½</p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æ€§èƒ½ä¼˜åŒ–æ¨¡å—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p>**<code>--with-http_v2_module</code>**æ”¯æŒ HTTP/2 åè®®ï¼Œå¯ä»¥æé«˜æ€§èƒ½å’Œå¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œæä¾›äº†<!-- raw HTML omitted -->å¤šè·¯å¤ç”¨ã€å¤´éƒ¨å‹ç¼©å’ŒæœåŠ¡å™¨æ¨é€<!-- raw HTML omitted -->ç­‰åŠŸèƒ½
**<code>--with-http_stub_status_module</code>**å…è®¸æŸ¥çœ‹<code>Nginx</code>å®ä¾‹è¿è¡Œ<!-- raw HTML omitted -->çŠ¶æ€ä¿¡æ¯<!-- raw HTML omitted -->ï¼Œå¦‚æ´»åŠ¨è¿æ¥ã€å¤„ç†çš„è¯·æ±‚æ•°ç­‰<br>
**<code>--with-http_gzip_static_module</code>**å…è®¸<code>Nginx</code>ç›´æ¥æä¾›å·²ç»<!-- raw HTML omitted -->å‹ç¼©<!-- raw HTML omitted -->çš„é™æ€æ–‡ä»¶ï¼Œé¿å…é‡å¤å‹ç¼©ï¼Œå‡å°‘æœåŠ¡å™¨è´Ÿè½½<br>
**<code>--with-http_upstream_module</code>**æ”¯æŒ<!-- raw HTML omitted -->è´Ÿè½½å‡è¡¡<!-- raw HTML omitted --><br>
**<code>--with-http_proxy_module</code>**æä¾›ä»£ç†åŠŸèƒ½ï¼Œå¯ä»¥å°†è¯·æ±‚ä»£ç†åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Š<br>
**<code>--with-stream_ssl_module</code>**æ”¯æŒæµå¼<code>SSL/TLS</code>ï¼Œé€‚ç”¨äº<code>TCP</code>ä»£ç†å’Œè´Ÿè½½å‡è¡¡</p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æ–‡ä»¶å¤„ç†æ¨¡å—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p>**<code>--with-http_dav_module</code>**æä¾›<code>HTTP</code>åè®®çš„æ‰©å±•åŠŸèƒ½ï¼Œæ”¯æŒæ–‡ä»¶çš„ä¸Šä¼ ã€åˆ é™¤ã€å¤åˆ¶ã€ç§»åŠ¨ç­‰æ“ä½œ<br>
**<code>--with-http_flv_module</code>**å…è®¸<code>Nginx</code>æä¾›<code>FLV</code>è§†é¢‘æµæœåŠ¡<br>
**<code>--with-http_mp4_module</code>**å…è®¸<code>Nginx</code>å¤„ç†<code>MP4</code>æ ¼å¼çš„è§†é¢‘æ–‡ä»¶ï¼Œå¹¶æ”¯æŒ<code>HTTP</code>æ–­ç‚¹ç»­ä¼ <br>
**<code>--with-http_image_filter_module</code>**æä¾›å›¾åƒå¤„ç†åŠŸèƒ½ï¼Œå¯ä»¥å¯¹å›¾åƒè¿›è¡Œç¼©æ”¾ã€è£å‰ªç­‰æ“ä½œ</p>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->å…¶ä»–æ¨¡å—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p>**<code>--with-pcre</code>**æä¾›æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒï¼Œä½¿<code>Nginx</code>èƒ½å¤Ÿä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œ<code>URL</code>é‡å†™ã€è¿‡æ»¤ç­‰æ“ä½œ<br>
**<code>--with-http_sub_module</code>**å…è®¸åœ¨å“åº”å†…å®¹ä¸­è¿›è¡Œç®€å•çš„<!-- raw HTML omitted -->å­—ç¬¦ä¸²æ›¿æ¢<!-- raw HTML omitted -->æ“ä½œ<br>
**<code>--with-http_slice_module</code>**ç”¨äºå°†å¤§æ–‡ä»¶åˆ†å‰²æˆæ›´å°çš„å—è¿›è¡Œ<!-- raw HTML omitted -->åˆ†ç‰‡ä¼ è¾“<!-- raw HTML omitted -->
**<code>--with-http_addition_module</code>**å…è®¸åœ¨å“åº”çš„å¤´éƒ¨å’Œä¸»ä½“ä¸­<!-- raw HTML omitted -->æ’å…¥é¢å¤–çš„å†…å®¹<!-- raw HTML omitted -->ï¼Œå¦‚æ·»åŠ è‡ªå®šä¹‰çš„<code>HTTP</code>å¤´éƒ¨æˆ–å“åº”ç‰‡æ®µ<br>
**<code>--with-http_rewrite_module</code>**æä¾›<code>URL</code>é‡å†™åŠŸèƒ½ï¼Œæ”¯æŒå¤æ‚çš„<code>URL</code>é‡å†™è§„åˆ™</p>
</blockquote>
<ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/nginx-1.20.2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®</span>
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --with-http_ssl_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_v2_module --with-http_stub_status_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-pcre --with-http_gzip_static_module --with-http_dav_module  <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_addition_module  --with-http_sub_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_flv_module  --with-http_mp4_module
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¼–è¯‘ã€å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ make -j4 <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶ <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## chkconfig: - 99 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## description: Nginx Service Control Script
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PROG=&#34;/usr/local/nginx/sbin/nginx&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PIDF=&#34;/usr/local/nginx/logs/nginx.pid&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">case &#34;$1&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        $PROG
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        kill -3 $(cat $PIDF)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        restart)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        $0 stop &amp;&gt; /dev/null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        if [ $? -ne 0 ] ; then continue ; fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        $0 start
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        reload)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        kill -1 $(cat $PIDF)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        *)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#34;Userage: $0 { start | stop | restart | reload }&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">esac
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">exit 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span> &gt;/etc/init.d/nginx</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->èµ‹äºˆæ‰§è¡Œæƒé™ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯  <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chmod +x /etc/init.d/nginx
</span></span><span style="display:flex;"><span>$ chkconfig --add nginx
</span></span><span style="display:flex;"><span>$ chkconfig nginx on
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨nginxæœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ /usr/local/nginx/sbin/nginx
</span></span><span style="display:flex;"><span>$ netstat -nuplt | grep :80</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->éå¸¸è§„å®‰è£…<!-- raw HTML omitted --><code>Nginx</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>3.1 <!-- raw HTML omitted -->åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ›å»ºï¼Œèµ‹äºˆæƒé™<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åˆ¤æ–­æ˜¯å¦å­˜åœ¨  </span>
</span></span><span style="display:flex;"><span>$ id myadmin 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸å­˜åœ¨åˆ›å»º</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $? -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    groupadd group <span style="color:#f92672">&amp;&amp;</span> useradd -g myadmin myadmin
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;password&#34;</span>|passwd --stdin myadmin &amp;&gt;/dev/null
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># èµ‹äºˆæƒé™</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;#####  	Start/Stop Service  	#####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Cmnd_Alias MYADMIN_START_SERVICES = /opt/*, /usr/bin/kill, /etc/init.d/nginx, /opt/data/nginx/sbin/nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">myadmin ALL=(ALL)NOPASSWD:MYADMIN_START_SERVICES&#34;</span> &gt;/etc/sudoers.d/myadmin
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">660</span> /etc/sudoers.d/myadmin</span></span></code></pre></div><ul>
<li>3.2 <!-- raw HTML omitted -->åˆ›å»ºç›®å½•,èµ‹äºˆæƒé™  <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/<span style="color:#f92672">{</span>apps,src,conf,scripts<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chown -R admin:admin /opt/*</span></span></code></pre></div><ul>
<li>3.3 <!-- raw HTML omitted -->è¿›å…¥è§£å‹ç›®å½•ï¼Œé…ç½®ã€ç¼–è¯‘ã€å®‰è£… <!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p>3.3.1 <!-- raw HTML omitted --><code>nginx-auth-ldapã€--with-http_auth_request_module</code><!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ su admin -c <span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd /opt/src/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wget http://nginx.org/download/nginx-1.20.2.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">tar -zxvf nginx-1.20.2.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd nginx-1.20.2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">./configure --prefix=/opt/lucky/nginx \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-http_stub_status_module --with-http_ssl_module \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-http_gzip_static_module --with-ipv6 --with-stream \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-stream_ssl_module --with-http_v2_module \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-pcre --with-http_gzip_static_module \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-http_dav_module --with-http_addition_module \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-http_sub_module --with-http_flv_module \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">--with-http_mp4_module --with-stream --user=myadmin --group=myadminÂ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">make -j4 &amp;&amp; make install
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo /opt/data/nginx/sbin/nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo &#34;</span>alias nginx<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sudo /etc/init.d/nginx&#39;</span><span style="color:#e6db74">&#34; &gt;&gt;/home/myadmin/.bashrc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>$ ss -unplt|grep <span style="color:#ae81ff">80</span></span></span></code></pre></div></blockquote>
<ul>
<li>3.4 <!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶ <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/init.d/nginx<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">NGINX_PATH=&#34;/opt/apps/nginx&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_nginx(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ${NGINX_PATH}/sbin/nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">stop_nginx(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	${NGINX_PATH}/sbin/nginx -s stop
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">reload_nginx(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	${NGINX_PATH}/sbin/nginx -s reload
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">check_nginx(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	${NGINX_PATH}/sbin/nginx -t
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">### Finally the input handling.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">case &#34;$1&#34; in
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  start)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        start_nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  stop)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        stop_nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  reload)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        reload_nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  -t)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        check_nginx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  *)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#34;Usage: service nginx {start|stop|reload|-t}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">esac
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>$ chmod +x /etc/init.d/nginx
</span></span><span style="display:flex;"><span>$ chkconfig --add nginx
</span></span><span style="display:flex;"><span>$ chkconfig nginx on</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/usr/lib/systemd/system/nginx.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=nginx - high performance web server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Documentation=http://nginx.org/en/docs/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network-online.target remote-fs.target nss-lookup.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=forking
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PidFile=/var/run/nginx.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecReload=/usr/local/nginx/sbin/nginx -s reload
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStop=/usr/local/nginx/sbin/nginx -s stop
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecQuit=/usr/local/nginx/sbin/nginx -s quit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ExecReload=/bin/kill -s HUP $MAINPID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ExecStop=/bin/kill -s QUIT $MAINPID
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PrivateTmp=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl daemon-reload
</span></span><span style="display:flex;"><span>$ systemctl enable nginx.service <span style="color:#f92672">&amp;&amp;</span> systemctl start nginx</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ·»åŠ ç³»ç»Ÿç¯å¢ƒå˜é‡ã€é˜²ç«å¢™æ”¾è¡Œ<!-- raw HTML omitted --><code>httpã€https</code><!-- raw HTML omitted -->æœåŠ¡<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;N;56iexport PATH=/usr/local/nginx/sbin:</span>$PATH<span style="color:#e6db74">&#34;</span> /etc/profile
</span></span><span style="display:flex;"><span>$ source /etc/profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --zone<span style="color:#f92672">=</span>public --add-service<span style="color:#f92672">={</span>http,https<span style="color:#f92672">}</span> --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_nginx_third_party_modules">Install_Nginx_Third_Party_Modules</h1>

<h2 id="geoip2å®šä½æ¨¡å—"><code>GeoIP2</code>å®šä½æ¨¡å—</h2>
<blockquote>
<ul>
<li><code>GeoIP2</code><!-- raw HTML omitted -->æ¨¡å—ä¾èµ–<!-- raw HTML omitted --><code>libmaxminddb</code>åº“</li>
<li><a href="https://www.miyuru.lk/geoiplegacy" rel="external" target="_self"><code>GeoIP Legacy Databases</code></a></li>
</ul>
</blockquote>
<h3 id="libmaxminddbåº“"><code>libmaxminddb</code>åº“</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$  wget -c https://github.com/maxmind/libmaxminddb/releases/download/1.7.1/libmaxminddb-1.7.1.tar.gz -P /usr/local/src  	<span style="color:#75715e"># ä¸‹è½½åˆ°æŒ‡å®šç›®å½•ä¸‹:-cæ–­ç‚¹ç»­ä¼ ã€-Pä¸‹è½½æŒ‡å®šç›®å½•ï¼Œ  </span>
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/libmaxminddb-1.7.1.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/libmaxminddb-1.7.1
</span></span><span style="display:flex;"><span>$ ./configure
</span></span><span style="display:flex;"><span>$ make -j6 <span style="color:#f92672">&amp;&amp;</span> make install</span></span></code></pre></div></blockquote>
<h3 id="å®‰è£…geoip2">å®‰è£…<code>GeoIP2</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/leev/ngx_http_geoip2_module.git /usr/local/nginx/ngx_http_geoip2_module
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --add-module<span style="color:#f92672">=</span>/usr/local/nginx/ngx_http_geoip2_module</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ngx_brotliå‹ç¼©ç®—æ³•"><code>ngx_brotli</code>å‹ç¼©ç®—æ³•</h2>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä¸‹è½½å®‰è£…<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¸‹è½½ç®—æ³•åŒ…ï¼Œæ‰§è¡Œæ›´æ–°ngx_brotliä¾èµ–ç®—æ³•ï¼Œç®—æ³•ä¾èµ–è‡ªåŠ¨ä¸‹è½½</span>
</span></span><span style="display:flex;"><span>$ wget -c https://codeload.github.com/google/brotli/tar.gz/refs/tags/v1.1.0 -P /usr/local/src
</span></span><span style="display:flex;"><span>$ tar zxvf /usr/local/src/brotli-1.1.0.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸‹è½½å®‰è£…æ¨¡å—</span>
</span></span><span style="display:flex;"><span>$ git clone https://github.com/google/ngx_brotli /usr/local/nginx/ngx_brotli
</span></span><span style="display:flex;"><span>$ cd /usr/local/nginx/ngx_brotli
</span></span><span style="display:flex;"><span>$ git submodule update --init  	<span style="color:#75715e"># æ›´æ–°ngx_brotliä»¥æ¥ç®—æ³•</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mv /usr/local/src/brotli-1.1.0/* /usr/local/nginx/ngx_brotli/deps/brotli/</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->åŠ¨æ€ç¼–è¯‘<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/nginx-1.20.2
</span></span><span style="display:flex;"><span>$ ./configure --with-compat --add-dynamic-module<span style="color:#f92672">=</span>/usr/local/src/ngx_brotli --prefix<span style="color:#f92672">=</span>/usr/local/nginx
</span></span><span style="display:flex;"><span>$ make modules
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‹·è´æ¨¡å—å’Œä¸»ç¨‹åºåˆ°Nginxå®‰è£…ç›®å½•ä¸‹æ–°åˆ›å»ºçš„æ–‡ä»¶å¤¹å†…ï¼šmodules</span>
</span></span><span style="display:flex;"><span>$ cp /usr/local/src/nginx-1.20.2/objs/ngx_http_brotli_static_module.so /usr/local/nginx/modules/ngx_http_brotli_static_module.so
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp /usr/local/src/nginx-1.20.2/objs/ngx_http_brotli_filter_module.so /usr/local/nginx/modules/ngx_http_brotli_filter_module.so
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp /usr/local/src/nginx-1.20.2/objs/nginx /usr/local/nginx/sbin/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨ngixn.confé…ç½®æ–‡ä»¶æœ€ä¸Šé¢åŠ¨æ€åŠ è½½æ¨¡å—</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/usr/local/nginx/conf/nginx.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">load_module /usr/local/nginx/modules/ngx_http_brotli_filter_module.so;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">load_module /usr/local/nginx/modules/ngx_http_brotli_static_module.so;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->é™æ€ç¼–è¯‘<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/src/nginx-1.20.2
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --add-module<span style="color:#f92672">=</span>/usr/local/nginx/ngx_brotli</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h2 id="nginx-redis2æ¨¡å—"><code>Nginx-Redis2</code>æ¨¡å—</h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://github.com/openresty/redis2-nginx-module" rel="external" target="_self"><code>Redis2-Nginx-Module</code></a></li>
</ol>
</li>
<li><!-- raw HTML omitted -->å†™å…¥è¯·æ±‚<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>location <span style="color:#f92672">=</span> /foo <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    default_type text/html;
</span></span><span style="display:flex;"><span>    redis2_query auth password;
</span></span><span style="display:flex;"><span>    set $value <span style="color:#e6db74">&#39;first&#39;</span>;  	<span style="color:#75715e"># è®¾ç½®ä¸€ä¸ªå˜é‡</span>
</span></span><span style="display:flex;"><span>    redis2_query set one $value;  <span style="color:#75715e"># å˜é‡å†™å…¥å€¼</span>
</span></span><span style="display:flex;"><span>    redis2_pass 127.0.0.1:6379;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><ul>
<li><code>get</code><!-- raw HTML omitted -->è·å–å€¼<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>location <span style="color:#f92672">=</span> /get <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    default_type text/html;
</span></span><span style="display:flex;"><span>    redis2_pass 127.0.0.1:6379;
</span></span><span style="display:flex;"><span>    redis2_query auth password;
</span></span><span style="display:flex;"><span>    set_unescape_uri $key $arg_key;  <span style="color:#75715e"># ç¬¬ä¸‰æ–¹è½¬ä¹‰æ¨¡å—ï¼šngx_set_misc è¿›è¡Œurlç¼–ç è½¬ä¹‰</span>
</span></span><span style="display:flex;"><span>    redis2_query get $key;  	<span style="color:#75715e"># è·å–é”®å€¼</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h2 id="stickyä¼šè¯ä¿æŒæ¨¡å—"><code>Sticky</code>ä¼šè¯ä¿æŒæ¨¡å—</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#sticky" rel="external" target="_self">å®˜ç½‘<code>Sticky</code>æ–‡æ¡£</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/bymaximus/nginx-sticky-module-ng" rel="external" target="_self"><code>Github</code>ä»£ç æ‰˜ç®¡<code>Sticky</code>æ–‡æ¡£</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng/src/master/" rel="external" target="_self"><code>Google</code>å¼€å‘<code>Sticky</code>æ¨¡å—æ‰˜ç®¡åœ¨<code>Bitbuckey</code></a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone git clone https://huanggua1234@bitbucket.org/nginx-goodies/nginx-sticky-module-ng.git
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --add-module<span style="color:#f92672">=</span>/usr/local/nginx/nginx_goodies-nginx-sticky-module-ng-c78b7dd79d0d
</span></span><span style="display:flex;"><span>$ make
</span></span><span style="display:flex;"><span>$ make upgrade  	<span style="color:#75715e"># æ£€æµ‹ç”„åˆ«ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œæ£€æŸ¥å¥½åæ‹·è´æ›¿æ¢makeåçš„å¯æ‰§è¡Œæ–‡ä»¶</span></span></span></code></pre></div><ul>
<li>
<ol>
<li><code>openssl</code><!-- raw HTML omitted -->ç¼–è¯‘æŠ¥é”™ä¿®æ”¹åŸæ–‡ä»¶ï¼Œåœ¨ç¬¬12è¡Œæ·»åŠ ä¸€ä¸‹ä¸¤è¡Œå†…å®¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;ngx_http_sticky_misc.c<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#include &lt;openssl/sha.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#include &lt;openssl/md5.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>
<ol start="2">
<li>ä½¿ç”¨<code>Sticky</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>name=route</code><!-- raw HTML omitted -->ä¸‹å‘<!-- raw HTML omitted --><code>cookie</code><!-- raw HTML omitted -->åç§°<!-- raw HTML omitted --></li>
<li><code>expires=6h;</code><!-- raw HTML omitted -->å®šä¹‰è¿‡æœŸæ—¶é—´<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;upstream.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sticky;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server 192.168.1.1:8080;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server 192.168.1.2:8080;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h2 id="concatåˆå¹¶è¯·æ±‚æ¨¡å—"><code>concat</code>åˆå¹¶è¯·æ±‚æ¨¡å—</h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://github.com/alibaba/nginx-http-concat" rel="external" target="_self"><code>Alibaba Concat</code>è¯·æ±‚åˆå¹¶æ¨¡å—</a></li>
</ol>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/alibaba/nginx-http-concat.git /usr/local/nginx/nginx-http-concat
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/nginx-1.20.2/
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --add-module<span style="color:#f92672">=</span>/usr/local/nginx/nginx-http-concat</span></span></code></pre></div></blockquote>
<hr>
<h2 id="slab_statå…±äº«å†…å­˜çš„çŠ¶æ€ä¿¡æ¯"><code>slab_stat</code>å…±äº«å†…å­˜çš„çŠ¶æ€ä¿¡æ¯</h2>
<blockquote>
<ul>
<li><a href="https://tengine.taobao.org/document_cn/ngx_slab_stat_cn.html" rel="external" target="_self"><code>ngx_slab_stat</code></a></li>
</ul>
</blockquote>
<hr>
<h2 id="upstream_checkåç«¯æœåŠ¡ç«¯å£æ£€æµ‹æ¨¡å—"><code>upstream_check</code>åç«¯æœåŠ¡ç«¯å£æ£€æµ‹æ¨¡å—</h2>
<blockquote>
<ul>
<li>
<ol>
<li>è®¿é—®<code>http://ip/status</code><!-- raw HTML omitted -->å°±çœ‹åˆ°ç›‘æ§é¡µé¢<!-- raw HTML omitted --></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="http://tengine.taobao.org/document_cn/http_upstream_check_cn.html" rel="external" target="_self"><code>Tengine.taobao ngx_http_upstream_check_module</code></a></li>
</ol>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git clone https://github.com/yaoweibin/nginx_upstream_check_module.git /usr/local/nginx/nginx_upstream_check_module  	<span style="color:#75715e"># ä¸‹è½½æ£€æµ‹åŒ…  </span>
</span></span><span style="display:flex;"><span>$ cd /usr/local/src/nginx-1.20.2/
</span></span><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/nginx --add-module<span style="color:#f92672">=</span>/usr/local/nginx/nginx_upstream_check_module</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ngx_cache_purgeç¼“å­˜æ¸…ç†æ¨¡å—"><code>ngx_cache_purge</code>ç¼“å­˜æ¸…ç†æ¨¡å—</h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://github.com/FRICKLE/ngx_cache_purge" rel="external" target="_self"><code>Ngx_cache_purge</code></a></li>
</ol>
</li>
<li><!-- raw HTML omitted -->ç›¸åŒä½ç½®è¯­æ³•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    proxy_cache_path  /tmp/cache  keys_zone<span style="color:#f92672">=</span>tmpcache:10m;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            proxy_pass         http://127.0.0.1:8000;
</span></span><span style="display:flex;"><span>            proxy_cache        tmpcache;
</span></span><span style="display:flex;"><span>            proxy_cache_key    $uri$is_args$args;
</span></span><span style="display:flex;"><span>            proxy_cache_purge  PURGE from 127.0.0.1;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å•ç‹¬ä½ç½®è¯­æ³•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    proxy_cache_path  /tmp/cache  keys_zone<span style="color:#f92672">=</span>tmpcache:10m;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        location / <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            proxy_pass         http://127.0.0.1:8000;
</span></span><span style="display:flex;"><span>            proxy_cache        tmpcache;
</span></span><span style="display:flex;"><span>            proxy_cache_key    $uri$is_args$args;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        location ~ /purge<span style="color:#f92672">(</span>/.*<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            allow              127.0.0.1;
</span></span><span style="display:flex;"><span>            deny               all;
</span></span><span style="display:flex;"><span>            proxy_cache_purge  tmpcache $1$is_args$args;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="configure_nginx">Configure_Nginx</h1>

<h2 id="é…ç½®nginx">é…ç½®<code>Nginx</code></h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.freenom.com/zh/index.html?lang=zh" rel="external" target="_self">å…è´¹åŸŸåç”³è¯·</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://vercel.com/" rel="external" target="_self"><code>Vercel CDN</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://beian.miit.gov.cn/#/Integrated/index" rel="external" target="_self">å·¥ä¿¡éƒ¨å¤‡æ¡ˆæŸ¥è¯¢</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.serverhunter.com/" rel="external" target="_self">æŸ¥æ‰¾ä¾¿å®œæœåŠ¡å™¨</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.cnblogs.com/zhongyehai/category/1406152.html?page=1" rel="external" target="_self">éšç¬”åˆ†ç±» - <code>Nginx</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://fly.io/" rel="external" target="_self"><code>fly.io</code>è¾¹ç¼˜æœåŠ¡å™¨</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://porkbun.com/" rel="external" target="_self"><code>Porkbun</code>åŸŸåè´­ä¹°å•†</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.domcomp.com/" rel="external" target="_self"><code>Domcomp</code>åŸŸåä»·æ ¼å¯¹æ¯”ç½‘ç«™</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://tld-list.com/" rel="external" target="_self"><code>TLD List</code>åŸŸåä»·æ ¼å¯¹æ¯”ç½‘ç«™</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/oneinstack/oneinstack" rel="external" target="_self"><code>Oneinstack</code></a></td>
<td>æœåŠ¡å®‰è£…è„šæœ¬</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><code>ab</code><!-- raw HTML omitted -->å‹åŠ›æµ‹è¯•å·¥å…·<!-- raw HTML omitted -->ï¼Œ<a href="https://www.charlesproxy.com/" rel="external" target="_self"><code>Charles</code>æŠ“åŒ…å·¥å…·</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install httpd-tools
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ab -n <span style="color:#ae81ff">50</span> -c <span style="color:#ae81ff">20</span> http://127.0.0.1/index.html  	<span style="color:#75715e"># -nï¼šæ€»å…±å‘èµ·çš„è¯·æ±‚æ•°ï¼Œè¿™é‡Œè®¾ç½®ä¸º50ã€</span>
</span></span><span style="display:flex;"><span>								<span style="color:#75715e"># -cï¼šåŒæ—¶å¹¶å‘çš„è¯·æ±‚ï¼Œè¿™é‡Œè®¾ç½®ä¸º20ä¸ªã€</span>
</span></span><span style="display:flex;"><span>								<span style="color:#75715e"># -kï¼šæ˜¯å¦å¼€å¯é•¿è¿æ¥</span></span></span></code></pre></div><ul>
<li><code>ab</code><!-- raw HTML omitted -->æ¢æµ‹åˆ°æ€§èƒ½æŒ‡æ ‡<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Concurrency Level</code><!-- raw HTML omitted -->ï¼šè®¾å®šçš„å¹¶å‘æ•°<!-- raw HTML omitted --></li>
<li><code>Time taken for tests</code><!-- raw HTML omitted -->ï¼šå‹æµ‹æ€»å…±èŠ±è´¹çš„æ—¶é—´<!-- raw HTML omitted --></li>
<li><code>Complete requests</code><!-- raw HTML omitted -->ï¼šæ€»è¯·æ±‚æ•°<!-- raw HTML omitted --></li>
<li><code>Failed requests</code><!-- raw HTML omitted -->ï¼šå¤±è´¥çš„ä¸ªæ•°<!-- raw HTML omitted --></li>
<li><code>Requests per second</code><!-- raw HTML omitted -->ï¼šæ¯ç§’è¯·æ±‚æ•°<!-- raw HTML omitted --><code>TPS</code></li>
<li><code>Time per request</code><!-- raw HTML omitted -->ï¼šä»å®¢æˆ·ç«¯æ¥çœ‹ï¼Œä¸€ä¸ªè¯·æ±‚éœ€è¦ç”¨åˆ°çš„æ—¶é—´<!-- raw HTML omitted --></li>
<li><code>Time per request</code><!-- raw HTML omitted -->ï¼šä»æœåŠ¡ç«¯æ¥çœ‹ï¼Œå¤„ç†ä¸€ä¸ªè¯·æ±‚è¦èŠ±è´¹çš„æ—¶é—´<!-- raw HTML omitted --></li>
<li><code>Transfer rate</code><!-- raw HTML omitted -->ï¼šä¼ è¾“çš„é€Ÿç‡<!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="2">
<li><code>Nginx</code><!-- raw HTML omitted -->åŸºäº<!-- raw HTML omitted --><code>Lua</code><!-- raw HTML omitted -->åš<!-- raw HTML omitted --><code>Waf</code><!-- raw HTML omitted -->è§„åˆ™è¿‡æ»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://github.com/loveshell/ngx_lua_waf" rel="external" target="_self"><code>ngx_lua_waf</code></a></li>
</ul>
</blockquote>
<hr>
<h3 id="logrodateä½¿ç”¨"><code>logrodate</code>ä½¿ç”¨</h3>
<blockquote>
<ul>
<li></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ man logrotate  	<span style="color:#75715e">#  æŸ¥çœ‹ä½¿ç”¨è¯¦æƒ… </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/logrotate.d/nginx<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/nginx/logs/*.log{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">copytruncate  	# ç”¨äºè¿˜åœ¨æ‰“å¼€ä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼ŒæŠŠå½“å‰æ—¥å¿—å¤‡ä»½å¹¶æˆªæ–­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">daily  	# å®‰æ—¥æœŸè½®è½¬æ—¥å¿—ï¼šdaily(å¤©)ã€weekly(æœˆ)ã€monthly(æœˆ)ã€yearly(å¹´)ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dateext  	# æ–‡ä»¶åç¼€æ˜¯æ—¥æœŸæ ¼å¼,ä¹Ÿå°±æ˜¯åˆ‡å‰²åæ–‡ä»¶æ˜¯:xxx.log-20150828.gz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rotate 7  	# æŒ‡å®šæ—¥å¿—æ–‡ä»¶åˆ é™¤ä¹‹å‰è½¬å‚¨çš„æ¬¡æ•°ï¼Œ0æŒ‡æ²¡æœ‰å¤‡ä»½ï¼Œ7æŒ‡ä¿ç•™7ä¸ªå¤‡ä»½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">missingok  	# å¦‚æœæ—¥å¿—ä¸å­˜åœ¨åˆ™å¿½ç•¥è¯¥è­¦å‘Šä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">compress  	# é€šè¿‡gzipå‹ç¼©è½¬å‚¨ä»¥åçš„æ—¥å¿—ï¼ˆgzip -d xxx.gzè§£å‹ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">notifempty  	# å¦‚æœæ˜¯ç©ºæ–‡ä»¶çš„è¯ï¼Œä¸è½¬å‚¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">size 100k	# åœ¨æ—¥å¿—å¤§å°å¤§äº logsizeï¼ˆä¾‹å¦‚ 100Kï¼Œ4Mï¼‰æ—¶è½®æ¢
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">su root root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">} 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰‹åŠ¨è°ƒè¯•éªŒè¯ï¼š-d</span>
</span></span><span style="display:flex;"><span>$ /usr/sbin/logrotate -d /etc/logrotate.d/nginx
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰‹åŠ¨å¼ºåˆ¶æ‰§è¡Œï¼š-f</span>
</span></span><span style="display:flex;"><span>$ /usr/sbin/logrotate -f /etc/logrotate.d/nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–°å¢åˆªé™¤7å¤©ä»¥å‰logå®šæ™‚è…³æœ¬  </span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;###nginxè¶…éä¸ƒå¤©logåˆªé™¤
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1 0 * * * /bin/bash /opt/scripts/DEL_NGINX.sh &gt;&gt; ~/del_tom.log 2&gt;&amp;1&#34;</span> &gt;&gt; /var/spool/cron/admin</span></span></code></pre></div></blockquote>
<hr>
<h3 id="jsonæ—¥å¿—æ ¼å¼"><code>Json</code>æ—¥å¿—æ ¼å¼</h3>
<blockquote>
<table>
<thead>
<tr>
<th>å˜é‡å</th>
<th>æè¿°</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>'&quot;@timestamp&quot;:&quot;$time_iso8601&quot;,'</code></td>
<td><code>ISO 8601</code>æ ‡å‡†æ ¼å¼çš„å½“åœ°æ—¶é—´</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;uri&quot;:&quot;$uri&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;args&quot;:&quot;$args&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;host&quot;:&quot;$host&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;https&quot;:&quot;$https&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;scheme&quot;:&quot;$scheme&quot;,' </code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;domain&quot;:&quot;$domain&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;status&quot;:&quot;$status&quot;,'</code></td>
<td><code>HTTP</code>è¯·æ±‚çŠ¶æ€ç </td>
<td><code>200 403 499 502 503</code></td>
</tr>
<tr>
<td><code>'&quot;request&quot;:&quot;$request&quot;,'</code></td>
<td>è¯·æ±‚çš„<code>URI</code>å’Œ<code>HTTP</code>åè®®</td>
<td><code>&quot;GET /api/img/home/logo-aipay.png HTTP/1.1&quot;</code></td>
</tr>
<tr>
<td><code>'&quot;hostname&quot;:&quot;$hostname&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_host&quot;:&quot;$http_host&quot;,'</code></td>
<td>è®¿é—®çš„åŸŸåæˆ–è€…<code>IP</code></td>
<td><code>www.domain.com</code><!-- raw HTML omitted -->192.168.1.1</td>
</tr>
<tr>
<td><code>'&quot;time_local&quot;:&quot;$time_local&quot;,'</code></td>
<td>é€šç”¨æ—¥å¿—æ ¼å¼ä¸­çš„æœ¬åœ°æ—¶é—´</td>
<td><code>18/Jul/2021:13:00:00 +0800</code></td>
</tr>
<tr>
<td><code>'&quot;ssl_cipher&quot;:&quot;$ssl_cipher&quot;,'</code></td>
<td>äº¤æ¢æ•°æ®ä¸­çš„ç®—æ³•</td>
<td><code>RC4-SHA</code></td>
</tr>
<tr>
<td><code>'&quot;requesturl&quot;:&quot;$request_uri&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;remote_addr&quot;:&quot;$remote_addr&quot;,'</code></td>
<td>å®¢æˆ·ç«¯åœ°å€</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;remote_user&quot;:&quot;$remote_user&quot;,'</code></td>
<td>å®¢æˆ·ç«¯ç”¨æˆ·åç§°</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;server_addr&quot;:&quot;$server_addr&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_cookie&quot;:&quot;$http_cookie&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_gp_xreal&quot;:&quot;$http_GP_IP&quot;,' </code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;ssl_protocol&quot;:&quot;$ssl_protocol&quot;,'</code></td>
<td><code>SSL</code>åè®®ç‰ˆæœ¬</td>
<td><code>TLSv1</code></td>
</tr>
<tr>
<td><code>'&quot;request_body&quot;:&quot;$request_body&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;request_time&quot;:&quot;$request_time&quot;,' </code></td>
<td>æ•´ä¸ªè¯·æ±‚çš„æ€»æ—¶é—´</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_referer&quot;:&quot;$http_referer&quot;,' </code></td>
<td>è·³è½¬æ¥æº</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;client_realip&quot;:&quot;$clientRealIp&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;upstream_addr&quot;:&quot;$upstream_addr&quot;,'</code></td>
<td><code>upstream</code>ä»£ç†çš„åç«¯æœåŠ¡åœ°å€</td>
<td><code>java tomcat php</code></td>
</tr>
<tr>
<td><code>'&quot;request_length&quot;:&quot;$request_length&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;upstream_status&quot;:&quot;$upstream_status&quot;,'</code></td>
<td><code>upstream</code>çŠ¶æ€ç </td>
<td><code>200 403 499 502 503</code></td>
</tr>
<tr>
<td><code>'&quot;body_bytes_sent&quot;:&quot;$body_bytes_sent&quot;,'</code></td>
<td>å‘é€ç»™å®¢æˆ·çš„æ–‡ä»¶å¤§å°</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,'</code></td>
<td>ç”¨æˆ·æµè§ˆå™¨è®¿é—®ç±»å‹</td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_wangsu_xreal&quot;:&quot;$http_cdn_src_IP&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_ali_xreal&quot;:&quot;$http_Ali_CDN_Real_IP&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_cf_xreal&quot;:&quot;$http_CF_Connecting_IP&quot;,'</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>'&quot;http_x_forwarded_for&quot;:&quot;$http_x_forwarded_for&quot;,'</code></td>
<td></td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>'&quot;upstream_response_time&quot;:&quot;$upstream_response_time&quot;,'</code></td>
<td>è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œ<code>upstream</code>å“åº”æ—¶é—´</td>
<td>&mdash;</td>
</tr>
<tr>
<td><code>'&quot;proxy_add_x_forwarded_for&quot;:&quot;$proxy_add_x_forwarded_for&quot;,'</code></td>
<td>&mdash;</td>
<td>&mdash;</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">log_format</span> <span style="color:#e6db74">json</span> <span style="color:#e6db74">escape=json</span>  <span style="color:#e6db74">&#39;</span>{<span style="color:#f92672">&#34;@timestamp&#34;:&#34;$time_iso8601&#34;,&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;client_realip&#34;:&#34;</span>$clientRealIp&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;remote_addr&#34;:&#34;</span>$remote_addr&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;status&#34;:&#34;</span>$status&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;upstream_status&#34;:&#34;</span>$upstream_status&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request_time&#34;:&#34;</span>$request_time&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;upstream_response_time&#34;:&#34;</span>$upstream_response_time&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;upstream_addr&#34;:&#34;</span>$upstream_addr&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request&#34;:&#34;</span>$request&#34;,&#39;
</span></span><span style="display:flex;"><span>  	<span style="color:#e6db74">&#39;&#34;http_scheme&#34;:&#34;</span>$http_X_Forwarded_Proto&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;server_name&#34;:&#34;</span>$host&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;uri&#34;:&#34;</span>$uri&#34;,&#39;
</span></span><span style="display:flex;"><span>  	<span style="color:#e6db74">&#39;&#34;request_body&#34;:&#34;</span>$request_body&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;body_bytes_sent&#34;:&#34;</span>$body_bytes_sent&#34;,&#39;
</span></span><span style="display:flex;"><span>  	<span style="color:#e6db74">&#39;&#34;bytes_sent&#34;:&#34;</span>$body_bytes_sent&#34;, <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request_length&#34;:&#34;</span>$request_length&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_referer&#34;:&#34;</span>$http_referer&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_wangsu_xreal&#34;:&#34;</span>$http_cdn_src_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_ali_xreal&#34;:&#34;</span>$http_Ali_CDN_Real_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_cf_xreal&#34;:&#34;</span>$http_CF_Connecting_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_gp_xreal&#34;:&#34;</span>$http_GP_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_x_forwarded_for&#34;:&#34;</span>$proxy_add_x_forwarded_for&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_user_agent&#34;:&#34;</span>$http_user_agent&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;xdevice&#34;:&#34;</span>$http_x_device&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;xversion&#34;:&#34;</span>$http_x_version&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;trace-id&#34;:&#34;</span>$http_x_trace_id&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;uid&#34;:&#34;</span>$http_x_id&#34;&#39;
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span><span style="color:#960050;background-color:#1e0010">}</span><span style="color:#e6db74">&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">è¿™é‡Œæ³¨æ„ä½¿ç”¨ä¸‹åˆ’çº¿ï¼Œ</span></span></span></code></pre></div><ul>
<li><code>Json</code><!-- raw HTML omitted -->æ–¹å¼æŸ¥çœ‹æ—¥å¿—<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tail -n1 /var/log/nginx/gitlab.log | awk -F <span style="color:#e6db74">&#39;&#34;&#39;</span> <span style="color:#e6db74">&#39;{if($3 == &#34;x.x.x.x&#34; &amp;&amp; $6 != &#34;403&#34;) {print $0}}&#39;</span> | jq</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ç³»ç»Ÿæ’æŸ¥">ç³»ç»Ÿæ’æŸ¥</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># URLè§£ç ã€ç¼–ç </span>
</span></span><span style="display:flex;"><span>$ yum -y install gridsite-clients
</span></span><span style="display:flex;"><span>$ tail -n10 nginx.logs | awk -F <span style="color:#e6db74">&#39;[:]&#39;</span> <span style="color:#e6db74">&#39;{print $24}&#39;</span> | xargs urlencode -d decode
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åå°åŠ ç™½</span>
</span></span><span style="display:flex;"><span>$ sed -Ei <span style="color:#e6db74">&#34;s@((([0-9]{1,3}\.?){4})+)@\1|{{ ip }}@&#34;</span> /usr/local/nginx/conf/vhosts/ white_list.ini
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤åŠ ç™½</span>
</span></span><span style="display:flex;"><span>$ sed -Ei <span style="color:#e6db74">&#34;s@((\|?){{ ip }}\|?)@\2@&#34;</span> /usr/local/nginx/conf/vhosts/ white_list.ini
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ’æŸ¥ç³»ç»Ÿä¸­å†…å­˜å ç”¨å‰ 5 çš„è¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>$ ps -eo pid,ppid,cmd,%mem,%cpu --sort<span style="color:#f92672">=</span>-%mem |head -5
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nginx</span>
</span></span><span style="display:flex;"><span>$ netstat -ntu|awk <span style="color:#e6db74">&#39;{print $5}&#39;</span>|cut -d: -f1|wc -l  	<span style="color:#75715e"># æŸ¥çœ‹æ–‡ä»¶æ‰“å¼€æ•°é‡</span>
</span></span><span style="display:flex;"><span>$ netstat -n | awk <span style="color:#e6db74">&#39;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&#39;</span>  	<span style="color:#75715e"># æŸ¥çœ‹æœåŠ¡å™¨ç½‘ç»œè´Ÿè½½</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tail -n100 /opt/logs/nginx/web_access.log |awk <span style="color:#e6db74">&#39;{print $1}&#39;</span> |sort -rn |uniq -c |sort -rn |head
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘½ä»¤è¡Œè·¨åŸŸæµ‹è¯• -iï¼šå…è®¸è·¨åŸŸçš„åŸŸåï¼Œ-Hï¼šè®¿é—®åŸŸå</span>
</span></span><span style="display:flex;"><span>$ curl -i https://baidu.com/text.txt -H <span style="color:#e6db74">&#34;Origin: http://www.example.com&#34;</span></span></span></code></pre></div><ul>
<li>æ‰“å¼€æµè§ˆå™¨æŒ‰<code>F12</code>ç„¶åè®¿é—®è·¨åŸŸåŸŸåï¼ŒæŸ¥çœ‹æ˜¯å¦æ˜¾ç¤ºæœ‰ï¼š<code>access-control-allow-origin: *</code>è·¨åŸŸå‚æ•°</li>
</ul>
</blockquote>
<hr>
<h3 id="nginxconfé…ç½®æ–‡ä»¶"><code>nginx.conf</code>é…ç½®æ–‡ä»¶</h3>
<blockquote>
<ul>
<li><code>pcretest</code>å…è®¸ç”¨æˆ·ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­æµ‹è¯•å’Œè°ƒè¯•<code>PCRE</code>æ­£åˆ™è¡¨è¾¾å¼çš„è¡Œä¸ºå’ŒåŠŸèƒ½</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pcretest
</span></span><span style="display:flex;"><span>PCRE version 8.43 2019-02-23
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  re&gt; /<span style="color:#f92672">(</span><span style="color:#ae81ff">\d</span>+<span style="color:#f92672">)</span><span style="color:#ae81ff">\.</span><span style="color:#f92672">(</span><span style="color:#ae81ff">\d</span>+<span style="color:#f92672">)</span><span style="color:#ae81ff">\.</span><span style="color:#f92672">(</span><span style="color:#ae81ff">\d</span>+<span style="color:#f92672">)</span><span style="color:#ae81ff">\.</span><span style="color:#f92672">(</span><span style="color:#ae81ff">\d</span>+<span style="color:#f92672">)</span>/
</span></span><span style="display:flex;"><span>data&gt; 192.168.1.1
</span></span><span style="display:flex;"><span> 0: 192.168.1.1
</span></span><span style="display:flex;"><span> 1: <span style="color:#ae81ff">192</span>
</span></span><span style="display:flex;"><span> 2: <span style="color:#ae81ff">168</span>
</span></span><span style="display:flex;"><span> 3: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span> 4: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ pcretest -f patterns.txt -e <span style="color:#e6db74">&#34;input-string&#34;</span></span></span></code></pre></div><table>
<thead>
<tr>
<th>ä»£ç </th>
<th>æè¿°</th>
<th>å…ƒå­—ç¬¦</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.</code></td>
<td>åŒ¹é…é™¤æ¢è¡Œç¬¦æ„å¤–çš„ä»»æ„å­—ç¬¦</td>
<td></td>
</tr>
<tr>
<td><code>\w</code></td>
<td>åŒ¹é…å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€æ±‰å­—ç­‰</td>
<td></td>
</tr>
<tr>
<td><code>\s</code></td>
<td>åŒ¹é…ä»»æ„çš„ç©ºç™½ç¬¦</td>
<td></td>
</tr>
<tr>
<td><code>\d</code></td>
<td>åŒ¹é…æ•°å­—</td>
<td></td>
</tr>
<tr>
<td><code>\b</code></td>
<td>åŒ¹é…å•è¯çš„å¼€å§‹æˆ–ç»“æŸ</td>
<td></td>
</tr>
<tr>
<td><code>^</code></td>
<td>åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹</td>
<td></td>
</tr>
<tr>
<td><code>$</code></td>
<td>åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ</td>
<td></td>
</tr>
<tr>
<td><code>()</code></td>
<td>åˆ†ç»„</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>ä»£ç </th>
<th>è¯´æ˜</th>
<th>é‡å¤</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>é‡å¤é›¶æ¬¡æˆ–æ›´å¤šæ¬¡</td>
<td></td>
</tr>
<tr>
<td><code>+</code></td>
<td>é‡å¤ä¸€æ¬¡æˆ–æ›´å¤šæ¬¡</td>
<td></td>
</tr>
<tr>
<td><code>?</code></td>
<td>é‡å¤é›¶æ¬¡æˆ–ä¸€æ¬¡</td>
<td></td>
</tr>
<tr>
<td><code>{n}</code></td>
<td>é‡å¤<code>n</code>æ¬¡</td>
<td></td>
</tr>
<tr>
<td><code>{n,}</code></td>
<td>é‡å¤<code>n</code>æ¬¡æˆ–æ›´å¤šæ¬¡</td>
<td></td>
</tr>
<tr>
<td><code>{n,m}</code></td>
<td>é‡å¤<code>n</code>æ¬¡åˆ°<code>m</code>æ¬¡</td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># ç”¨æˆ·å’Œç»„: user nobody nogroup;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">user</span> <span style="color:#e6db74">nobody</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nginxè¿›ç¨‹æ•°ï¼Œautoä¸ºè‡ªåŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">worker_processes</span> <span style="color:#e6db74">auto</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">worker_cpu_affinity</span>  <span style="color:#e6db74">auto</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆulimit -nï¼‰ä¸ nginx è¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯ nginx åˆ†é…è¯·æ±‚å¹¶ä¸æ˜¯é‚£ä¹ˆå‡åŒ€ï¼Œæ‰€ä»¥æœ€å¥½ä¸ ulimit -n çš„å€¼ä¿æŒä¸€è‡´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">worker_rlimit_nofile</span> <span style="color:#ae81ff">51200</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">error_log</span> <span style="color:#e6db74">/usr/local/nginx/logs/web_error.log</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pid</span> <span style="color:#e6db74">/usr/local/nginx/logs/nginx.pid</span>;</span></span></code></pre></div><ul>
<li><code>events</code><!-- raw HTML omitted -->å‚æ•°é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">events</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ä½¿ç”¨epollçš„I/Oæ¨¡å‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">use</span> <span style="color:#e6db74">epoll</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># æ¯ä¸ªè¿›ç¨‹å…è®¸çš„æœ€å¤šè¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">worker_connections</span>  <span style="color:#ae81ff">2048</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">multi_accept</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>	}</span></span></code></pre></div></blockquote>
<ul>
<li><code>http</code><!-- raw HTML omitted -->å‚æ•°é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">http</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">log_format</span> <span style="color:#e6db74">main</span> <span style="color:#e6db74">&#39;</span>$remote_addr <span style="color:#e6db74">-</span> $remote_user <span style="color:#e6db74">[</span>$time_iso8601] <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;fwf[</span>$http_x_forwarded_for] <span style="color:#e6db74">tip[</span>$http_true_client_ip] <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;</span>$upstream_addr $upstream_response_time $request_time <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;</span>$http_host $request <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;&#34;</span>$status&#34; $body_bytes_sent $request_body <span style="color:#e6db74">&#34;</span>$http_referer&#34; <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;&#34;</span>$http_accept_language&#34; <span style="color:#e6db74">&#34;</span>$http_user_agent&#34; <span style="color:#e6db74">&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">access_log</span>  <span style="color:#e6db74">/usr/local/nginx/logs/web_access.log</span>  <span style="color:#e6db74">main</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># è°ƒç”¨ mime.types è¯·æ±‚å¤´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span>             <span style="color:#e6db74">mime.types</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># é»˜è®¤æ•°æ®æµæ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">default_type</span>        <span style="color:#e6db74">application/octet-stream</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># åŸºæœ¬é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/basic.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ç¼“å­˜é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e"># include inc.d/cache.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># fastcgi é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/fastcgi.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># å‹ç¼©é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/compaction.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># IP é™åˆ¶é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/ip-limits.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># è¯·æ±‚å¤´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/proxy_set_header.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># æ—¥å¿—é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/logs.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># è®¿é—®é¢‘ç‡é™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/limit-speed.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># è·¨åŸŸ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/cross-domain.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># åä»£ç¼“å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">inc.d/reverse-proxy.ini</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">vhosts/*.conf</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">include</span> <span style="color:#e6db74">vhosts/*/*.conf</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åŸºæœ¬é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/basic.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹luaè„šæœ¬åä¸é‡å¯nginxé…ç½®ï¼Œ å¯¹æœåŠ¡æ€§èƒ½ä¸å‹å¥½ï¼Œè„šæœ¬ç¼–å†™æœŸé—´ä½¿ç”¨æ­¤é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">lua_code_cache</span> <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”Ÿå‘½ä¸€ä¸ªåç§°ä¸ºï¼šshared_dataï¼Œå¤§å°ï¼š1Mbå†…å­˜ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">lua_shared_dict</span> <span style="color:#e6db74">shared_data</span> <span style="color:#ae81ff">1m</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ˜¾ç¤ºjsonæ•°æ®ä¸­æ–‡ä¹±ç é—®é¢˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">charset</span> <span style="color:#e6db74">utf-8</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é›¶æ‹·è´æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">sendfile</span>	<span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½œç”¨ï¼šsendfileå¼€å¯çš„æƒ…å†µä¸‹ï¼Œæé«˜ç½‘ç»œåŒ…çš„ä¼ è¾“æ•ˆç‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">tcp_nopush</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">tcp_nodelay</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># keepalive è¶…æ—¶æ—¶é—´ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">keepalive_timeout</span>  <span style="color:#ae81ff">90</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸€ä¸ªTcpå¤ç”¨ä¸­ï¼Œå¯ä»¥å¹¶å‘æ¥å—çš„è¯·æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">keepalive_requests</span> <span style="color:#ae81ff">1000</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">server_names_hash_max_size</span> <span style="color:#ae81ff">1024</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nginxå…³æ‰ç‰ˆæœ¬å·
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">server_tokens</span> <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">server_names_hash_bucket_size</span> <span style="color:#ae81ff">128</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">large_client_header_buffers</span> <span style="color:#ae81ff">8</span> <span style="color:#ae81ff">128k</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">client_max_body_size</span> <span style="color:#ae81ff">8m</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">client_body_buffer_size</span> <span style="color:#ae81ff">16m</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">client_header_buffer_size</span> <span style="color:#ae81ff">4k</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸é…ç½®æˆ–è€…æ˜¯off,è¯·æ±‚å¤´ä¸­çš„è‡ªå®šä¹‰è¯·æ±‚å¤´ç”¨ - è¿æ¥æ˜¯æ”¯æŒçš„ï¼Œä¸è¦é…ç½® _ æ¥æ¥æ”¶,å¦‚æœæ˜¯ä¸‹åˆ’çº¿ _ è‡ªå®šä¹‰è¯·æ±‚å¤´ä¼šä¸¢å¤±
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">underscores_in_headers</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_buffer_size</span> <span style="color:#ae81ff">32k</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¯»å–ä¸Šæ¸¸æœåŠ¡å™¨èµ„æºï¼Œè¾¹è¯»è¾¹å‘é€æ•°æ®èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">proxy_buffering</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨å†…å­˜ä¸­åˆ’åˆ†32ä¸ª128Kå¤§å°çš„å†…å­˜ç¼“å†²å—ï¼Œç¼“å†²æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">proxy_buffers</span> <span style="color:#ae81ff">32</span> <span style="color:#ae81ff">128k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_connect_timeout</span> <span style="color:#ae81ff">60</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_read_timeout</span> <span style="color:#ae81ff">60</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_send_timeout</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¯»å–proxy_passæ•°æ®å†™å…¥åˆ°ç£ç›˜çš„æœ€å¤§å€¼ï¼Œé»˜è®¤1Gï¼Œ0:è¡¨ç¤ºå…³é—­ç¼“å­˜é™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">proxy_max_temp_file_size</span> <span style="color:#ae81ff">1024m</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_busy_buffers_size</span> <span style="color:#ae81ff">128k</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¼“å­˜æ–‡ä»¶å¤¹å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">proxy_temp_file_write_size</span> <span style="color:#ae81ff">128k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_headers_hash_max_size</span> <span style="color:#ae81ff">51200</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_headers_hash_bucket_size</span> <span style="color:#ae81ff">6400</span>;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç¼“å­˜é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/cache.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰“å¼€æ–‡ä»¶æŒ‡å®šç¼“å­˜ï¼Œé»˜è®¤æ²¡å¯ç”¨ï¼ŒmaxæŒ‡å®šç¼“å­˜æ•°é‡ï¼Œå»ºè®®å’Œæ‰“å¼€æ–‡ä»¶æ•°ä¸€è‡´ï¼Œinactiveæ˜¯æŒ‡ç»è¿‡å¤šé•¿æ—¶é—´æ–‡ä»¶æ²¡è¢«è¯·æ±‚ååˆ é™¤ç¼“å­˜ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">open_file_cache</span> <span style="color:#e6db74">max=102400</span> <span style="color:#e6db74">inactive=20s</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ˜¯æŒ‡å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡ç¼“å­˜çš„æœ‰æ•ˆä¿¡æ¯ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">open_file_cache_valid</span> <span style="color:#e6db74">30s</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># open_file_cache æŒ‡ä»¤ä¸­çš„ inactive å‚æ•°æ—¶é—´å†…æ–‡ä»¶çš„æœ€å°‘ä½¿ç”¨æ¬¡æ•°ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶åœ¨ inactive æ—¶é—´å†…ä¸€æ¬¡æ²¡è¢«ä½¿ç”¨ï¼Œå®ƒå°†è¢«ç§»é™¤
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">open_file_cache_min_uses</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡ä»¤ä¸º FastCGI ç¼“å­˜æŒ‡å®šä¸€ä¸ªè·¯å¾„ï¼Œç›®å½•ç»“æ„ç­‰çº§ï¼Œå…³é”®å­—åŒºåŸŸå­˜å‚¨æ—¶é—´å’Œéæ´»åŠ¨åˆ é™¤æ—¶é—´ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fastcgi_cache_path</span> <span style="color:#e6db74">/usr/local/nginx/fastcgi_cache</span> <span style="color:#e6db74">levels=1:2</span> <span style="color:#e6db74">keys_zone=TEST:10m</span> <span style="color:#e6db74">inactive=5m</span>;</span></span></code></pre></div><ul>
<li><code>fastcgi</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/fastcgi.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fastcgi_connect_timeout</span> <span style="color:#ae81ff">300</span>;  	<span style="color:#75715e"># æŒ‡å®šè¿æ¥åˆ°åç«¯ FastCGI çš„è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fastcgi_send_timeout</span> <span style="color:#ae81ff">300</span>;  	<span style="color:#75715e"># å‘ FastCGI ä¼ é€è¯·æ±‚çš„è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fastcgi_read_timeout</span> <span style="color:#ae81ff">300</span>;  	<span style="color:#75715e"># æ¥æ”¶ FastCGI åº”ç­”çš„è¶…æ—¶æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fastcgi_buffer_size</span> <span style="color:#ae81ff">64k</span>;  	<span style="color:#75715e"># æŒ‡å®šè¯»å–FastCGIåº”ç­”ç¬¬ä¸€éƒ¨åˆ†éœ€ç”¨å¤šå¤§ç¼“å†²åŒº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fastcgi_buffers</span> <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">64k</span>;  	<span style="color:#75715e"># æŒ‡å®šæœ¬åœ°éœ€ç”¨å¤šå°‘å’Œå¤šå¤§ç¼“å†²åŒºç¼“å†²FastCGIçš„åº”ç­”ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fastcgi_busy_buffers_size</span> <span style="color:#ae81ff">128k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fastcgi_temp_file_write_size</span> <span style="color:#ae81ff">128k</span>;  	<span style="color:#75715e"># åœ¨å†™å…¥ fastcgi_temp_path æ—¶å°†ç”¨å¤šå¤§çš„æ•°æ®å—ï¼Œé»˜è®¤å€¼æ˜¯ fastcgi_buffers çš„ä¸¤å€ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># fastcgi_cache TEST  	# å¼€å¯FastCGIç¼“å­˜å¹¶ä¸”ä¸ºå…¶åˆ¶å®šä¸€ä¸ªåç§°ï¼Œå¯ä»¥æœ‰æ•ˆé™ä½CPU è´Ÿè½½ï¼Œå¹¶ä¸”é˜²æ­¢ 502 é”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># fastcgi_cache_valid 200 302 1h;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># fastcgi_cache_valid 301 1d;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># fastcgi_cache_valid any 1m;  	# ä¸ºæŒ‡å®šåº”ç­”ä»£ç æŒ‡å®šç¼“å­˜æ—¶é—´,å¦‚å°†200,302åº”ç­”ç¼“å­˜ä¸€å°æ—¶,301åº”ç­”ç¼“å­˜1å¤©.å…¶ä»–ä¸º1åˆ†é’Ÿã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#66d9ef">fastcgi_cache_min_uses</span> <span style="color:#ae81ff">1</span>;  	<span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#66d9ef">ç¼“å­˜åœ¨</span> <span style="color:#e6db74">fastcgi_cache_pathæŒ‡ä»¤inactiveå‚æ•°å€¼æ—¶é—´å†…çš„æœ€å°‘ä½¿ç”¨æ¬¡æ•°,å¦‚æœåœ¨5åˆ†é’Ÿå†…æŸæ–‡ä»¶1æ¬¡ä¹Ÿæ²¡æœ‰è¢«ä½¿ç”¨,é‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°†è¢«ç§»é™¤ã€‚</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å‹ç¼©é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/compaction.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># brotliå‹ç¼©ç®—æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">brotli</span>			<span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">brotli_comp_level</span>	<span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">brotli_buffers</span>		<span style="color:#ae81ff">16</span> <span style="color:#ae81ff">8k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">brotli_min_length</span>	<span style="color:#ae81ff">256</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">brotli_types</span>		<span style="color:#e6db74">text/plain</span> <span style="color:#e6db74">application/javascript</span> <span style="color:#e6db74">application/x-javascript</span> <span style="color:#e6db74">text/javascript</span> <span style="color:#e6db74">text/css</span> <span style="color:#e6db74">application/xml</span> <span style="color:#e6db74">application/json</span> <span style="color:#e6db74">image/jpeg</span> <span style="color:#e6db74">image/gif</span> <span style="color:#e6db74">image/png</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">brotli_window</span>		<span style="color:#ae81ff">512k</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gzipå‹ç¼©ç®—æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">gzip</span>	<span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_comp_level</span>  <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©ï¼š64ä½æ“ä½œç³»ç»Ÿä¸ºï¼š16 8kï¼Œ32ä½æ“ä½œç³»ç»Ÿï¼š32 4k
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">gzip_buffers</span>     <span style="color:#ae81ff">16</span> <span style="color:#ae81ff">8k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_min_length</span>  <span style="color:#ae81ff">1k</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_types</span>       <span style="color:#e6db74">text/plain</span> <span style="color:#e6db74">application/javascript</span> <span style="color:#e6db74">application/x-javascript</span> <span style="color:#e6db74">text/javascript</span> <span style="color:#e6db74">text/css</span> <span style="color:#e6db74">application/xml</span> <span style="color:#e6db74">application/xml+rss</span> <span style="color:#e6db74">application/json</span> <span style="color:#e6db74">text/xml</span> <span style="color:#e6db74">image/jpeg</span> <span style="color:#e6db74">image/gif</span> <span style="color:#e6db74">image/png</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_disable</span>     <span style="color:#e6db74">&#34;msie6&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_http_version</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">.1</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_vary</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_proxied</span>     <span style="color:#e6db74">any</span> <span style="color:#e6db74">expired</span> <span style="color:#e6db74">no-cache</span> <span style="color:#e6db74">no-store</span> <span style="color:#e6db74">private</span> <span style="color:#e6db74">auth</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">gzip_disable</span> <span style="color:#e6db74">&#34;MSIE</span> <span style="color:#e6db74">[1-6]\.&#34;</span>;</span></span></code></pre></div><ul>
<li><code>IP</code><!-- raw HTML omitted -->é™åˆ¶é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/ip-limits.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $http_upgrade $connection_upgrade {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">default</span> <span style="color:#e6db74">upgrade</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#39;&#39;</span>	<span style="color:#e6db74">close</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $http_cdn-src-IP $ali_xreal {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;&#34;</span>   $http_Ali-CDN-Real-IP;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">~^(?P&lt;firstAddr&gt;[0-9\.]+),?.*$</span> $firstAddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $ali_xreal $cf_xreal {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;&#34;</span>  $http_CF-Connecting-IP;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">~^(?P&lt;firstAddr&gt;[0-9\.]+),?.*$</span> $firstAddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $cf_xreal  $gp_xreal {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;&#34;</span> $http_GP_IP;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">~^(?P&lt;firstAddr&gt;[0-9\.]+),?.*$</span> $firstAddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $gp_xreal  $xrealip {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;&#34;</span> $http_x_forwarded_for ;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">~^(?P&lt;firstAddr&gt;[0-9\.]+),?.*$</span> $firstAddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $xrealip  $clientRealIp {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;&#34;</span> $remote_addr;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">~^(?P&lt;firstAddr&gt;[0-9\.]+),?.*$</span> $firstAddr;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####  	GeoIPè®¿é—®IPé™åˆ¶  #####
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># geoip_country	GeoIP/GeoIP.dat;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># geoip_city		GeoIP/GeoLiteCity.dat;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># geoip_proxy		0.0.0.0/0;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># geoip_proxy_recursive on;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># geo $remote_addr $ip_whitelist {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	default 0;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	include ip.conf;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">geoip2</span> <span style="color:#e6db74">/usr/local/nginx/conf/GeoLite2-Country/GeoLite2-Country.mmdb</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">$geoip2_data_country_code</span> <span style="color:#e6db74">country</span> <span style="color:#e6db74">iso_code</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">$geoip2_data_country_name</span> <span style="color:#e6db74">country</span> <span style="color:#e6db74">iso_code</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">geoip2</span> <span style="color:#e6db74">/usr/local/nginx/conf/GeoLite2-City/GeoLite2-City.mmdb</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">$geoip2_data_city_name</span> <span style="color:#e6db74">city</span> <span style="color:#e6db74">iso_code</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®1: å…è®¸æ‰€æœ‰å›½å®¶è®¿é—®ï¼Œé™¤äº†ç¾å›½å’Œæ—¥æœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">map</span> $geoip2_data_country_code $allowed_country {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">default</span> <span style="color:#e6db74">yes</span>;  	<span style="color:#75715e"># é»˜è®¤é…ç½® yesï¼šå…è®¸æ‰€æœ‰ï¼Œnoï¼šæ‹’ç»æ‰€æœ‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">US</span> <span style="color:#e6db74">no</span>;  	<span style="color:#75715e"># å•ç‹¬é…ç½®æ‹’ç»
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">JP</span> <span style="color:#e6db74">no</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">CN</span> <span style="color:#e6db74">yes</span>;  	<span style="color:#75715e"># å•ç‹¬é…ç½®å…è®¸ï¼Œå‰ææ˜¯ï¼šdefault no;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># geoip_country /usr/local/nginx/GeoIP/GeoIP.dat;  # Geoipæ‰€åœ¨ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># map $geoip_country_code $allowed_country {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	default yes;    # å…è®¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#	CN no;      # ä¸­å›½å¤§é™†åŒºå‘½åä¸ºno
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#66d9ef">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è¯·æ±‚å¤´<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/proxy_set_header.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_set_header</span> <span style="color:#e6db74">X-Real-IP</span> $clientRealIp;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $remote_addr;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $proxy_add_x_forwarded_for;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ—¥å¿—é…ç½®ï¼Œä»¥åŠé…ç½®<!-- raw HTML omitted --><code>Json</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/logs.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">map</span> $upstream_response_time $upstream_response_timer {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">default</span> $upstream_response_time;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;&#34;</span>        <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">log_format</span> <span style="color:#e6db74">json</span> <span style="color:#e6db74">escape=json</span>  <span style="color:#e6db74">&#39;</span>{<span style="color:#f92672">&#34;@timestamp&#34;:&#34;$time_iso8601&#34;,&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;client_realip&#34;:&#34;</span>$clientRealIp&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;remote_addr&#34;:&#34;</span>$remote_addr&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;status&#34;:&#34;</span>$status&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;upstream_status&#34;:&#34;</span>$upstream_status&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request_time&#34;:&#34;</span>$request_time&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;upstream_response_time&#34;:&#34;</span>$upstream_response_time&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;upstream_addr&#34;:&#34;</span>$upstream_addr&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request&#34;:&#34;</span>$request&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_scheme&#34;:&#34;</span>$http_X_Forwarded_Proto&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;server_name&#34;:&#34;</span>$host&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;uri&#34;:&#34;</span>$uri&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request_body&#34;:&#34;</span>$request_body&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;body_bytes_sent&#34;:&#34;</span>$body_bytes_sent&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;bytes_sent&#34;:&#34;</span>$body_bytes_sent&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;request_length&#34;:&#34;</span>$request_length&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_referer&#34;:&#34;</span>$http_referer&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_wangsu_xreal&#34;:&#34;</span>$http_cdn_src_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_ali_xreal&#34;:&#34;</span>$http_Ali_CDN_Real_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_cf_xreal&#34;:&#34;</span>$http_CF_Connecting_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_gp_xreal&#34;:&#34;</span>$http_GP_IP&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_x_forwarded_for&#34;:&#34;</span>$proxy_add_x_forwarded_for&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;http_user_agent&#34;:&#34;</span>$http_user_agent&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;xdevice&#34;:&#34;</span>$http_x_device&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;xversion&#34;:&#34;</span>$http_x_version&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;trace-id&#34;:&#34;</span>$http_x_trace_id&#34;,&#39;
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#39;&#34;uid&#34;:&#34;</span>$http_x_id&#34;&#39;
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;</span><span style="color:#960050;background-color:#1e0010">}</span><span style="color:#e6db74">&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">è¿™é‡Œæ³¨æ„ä½¿ç”¨ä¸‹åˆ’çº¿ï¼Œ</span>		</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->è®¿é—®é¢‘ç‡é™åˆ¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/limit-speed.ini; 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é™é€Ÿé…ç½®æŒ‡ä»¤
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">limit_conn_log_level</span> <span style="color:#e6db74">error</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®¢æˆ·ç«¯å¹¶å‘è®¿é—®æ•°é™åˆ¶ï¼Œåå­—ä¸ºip_limitï¼Œå¤§å°ä¸º15Mbçš„å†…å­˜ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">limit_conn_zone</span> $binary_remote_addr <span style="color:#e6db74">zone=ip_limit:15m</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®¢æˆ·ç«¯ qps é¢‘ç‡è®¿é—®é™åˆ¶é…ç½®ã€åˆ†é…ä¸€ä¸ª10Mbçš„å†…å­˜ç©ºé—´ï¼ŒåŒä¸€ä¸ªIPä¸€ç§’é’Ÿå…è®¸5r(5æ¬¡è¯·æ±‚)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">limit_req_zone</span> $binary_remote_addr <span style="color:#e6db74">zone=one:10m</span> <span style="color:#e6db74">rate=5r/s</span>;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·¨åŸŸé…ç½®<!-- raw HTML omitted --></li>
<li>
<ul>
<li><a href="https://blog.csdn.net/weixin_37288522/article/details/123838801" rel="external" target="_self">åˆ†ç‰‡ä¸‹è½½</a></li>
</ul>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/cross-domain.ini;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">add_header</span> <span style="color:#e6db74">Access-Control-Allow-Origin</span> <span style="color:#e6db74">*</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">add_header</span> <span style="color:#e6db74">Accept-Ranges</span> <span style="color:#e6db74">bytes</span>;  <span style="color:#75715e"># åˆ†æ®µä¸‹è½½é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">add_header</span> <span style="color:#e6db74">Access-Control-Allow-Methods</span> <span style="color:#e6db74">GET,POST,OPTIONS</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">add_header</span> <span style="color:#e6db74">Access-Control-Allow-Headers</span> <span style="color:#e6db74">DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization</span>;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åä»£ç¼“å­˜<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#75715e"># include inc.d/reverse-proxy.ini; 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¼“å­˜ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">proxy_temp_path</span>   <span style="color:#e6db74">/opt/cache/www</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åä»£ç¼“å­˜é…ç½®ï¼Œkeys_zone=baidu:1024m ä¸­çš„ï¼š1024mæ˜¯åœ¨å†…å­˜ä¸­å ç”¨çš„ç©ºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">proxy_cache_path</span> <span style="color:#e6db74">/opt/cache/www/jd</span> <span style="color:#e6db74">levels=1:2</span> <span style="color:#e6db74">keys_zone=jd:1024m</span> <span style="color:#e6db74">inactive=1h</span> <span style="color:#e6db74">max_size=10g</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_cache_path</span> <span style="color:#e6db74">/opt/cache/www/ali</span> <span style="color:#e6db74">levels=1:2</span> <span style="color:#e6db74">keys_zone=ali:1024m</span> <span style="color:#e6db74">inactive=1h</span> <span style="color:#e6db74">max_size=10g</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">proxy_cache_path</span> <span style="color:#e6db74">/opt/cache/www/baidu</span> <span style="color:#e6db74">levels=1:2</span> <span style="color:#e6db74">keys_zone=baidu:1024m</span> <span style="color:#e6db74">inactive=1h</span> <span style="color:#e6db74">max_size=10g</span>;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="confå­é…ç½®æ–‡ä»¶"><code>conf</code>å­é…ç½®æ–‡ä»¶</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://zyan.cc/nginx_php_v5" rel="external" target="_self"><code>Nginx</code>ä¸»é…ç½®æ–‡ä»¶å‚è€ƒèµ„æ–™</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><code>server</code><!-- raw HTML omitted -->å‚æ•°é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><blockquote>
<ul>
<li><code>HSTS</code><!-- raw HTML omitted -->å®‰å…¨ç­–ç•¥æœºåˆ¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Strict-Transport-Security</code>è¿™æ˜¯<code>HSTS</code>å¤´éƒ¨çš„åç§°ã€‚<code>HSTS</code>æ˜¯ä¸€ç§<code>web</code>å®‰å…¨ç­–ç•¥æœºåˆ¶ï¼Œå¸®åŠ©ä¿æŠ¤ç½‘ç«™å…å—ä¸­é—´äººæ”»å‡»ï¼Œç¡®ä¿ç”¨æˆ·ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å§‹ç»ˆä½¿ç”¨<code>HTTPS</code></li>
<li><code>max-age</code>æŒ‡å®šäº†æµè§ˆå™¨åº”å½“ç¼“å­˜è¯¥ç­–ç•¥çš„æœ‰æ•ˆæ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œ<code>86400</code>ç§’ç­‰äº<code>24</code>å°æ—¶</li>
<li><code>includeSubdomains</code>è¿™ä¸ªå‚æ•°æŒ‡ç¤ºæµè§ˆå™¨å¯¹æ‰€æœ‰å­åŸŸåä¹Ÿåº”ç”¨<code>HSTS</code>ç­–ç•¥</li>
<li><code>preload</code>å‚æ•°åï¼Œåº”è¯¥ç¡®ä¿ç½‘ç«™å§‹ç»ˆæ”¯æŒ<code>HTTPS</code>ï¼Œå¦åˆ™ä¼šå¯¼è‡´è®¿é—®é”™è¯¯ã€‚</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">add_header</span> <span style="color:#e6db74">Strict-Transport-Security</span> <span style="color:#e6db74">&#34;max-age=86400</span>; <span style="color:#f92672">includeSubdomains</span>; <span style="color:#f92672">preload&#34;</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
<ul>
<li><code>server_name</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span> <span style="color:#e6db74">default_server</span>;  	<span style="color:#75715e"># å¦‚æœæ²¡æœ‰å…¶ä»–serverå—åŒ¹é…è¯·æ±‚çš„Hostå¤´ï¼Œä½¿ç”¨è¿™ä¸ªä½œä¸ºé»˜è®¤å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">443</span> <span style="color:#e6db74">ssl</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">8443</span> <span style="color:#e6db74">ssl</span> <span style="color:#e6db74">proxy_protocol</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">ssl</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># ç¬¬ä¸€ä¸ªåŸŸåé»˜è®¤ä¸ºä¸»åŸŸåï¼Œ.domain.comåŒ¹é… äºŒçº§ä¸»åŸŸåä»¥åŠæ‰€æœ‰ä¾ * çš„æ³›åŸŸåï¼Œ^baidu\d+\.com åŒ…å«ä»»æ„æ•°å­—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">server_name</span> <span style="color:#e6db74">domain.com</span> <span style="color:#e6db74">.domain.com</span>$ <span style="color:#e6db74">^baidu\d+\.com</span>$;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># ç¦æ­¢ä¸»åŸŸåè¿”å›å“åº”ï¼Œ å¼€å¯ä¸ºï¼šon
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">server_name_in_redirect</span> <span style="color:#66d9ef">off</span>; 
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è¯ä¹¦é…ç½®<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">ssl_certificate</span>      <span style="color:#e6db74">certs/domain/domain.com.crt</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">ssl_certificate_key</span>  <span style="color:#e6db74">certs/domain/domain.com.key</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">include</span> <span style="color:#e6db74">certs/ssl-options.conf</span>  	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ssl_dhparam certs/domain/dhparam.pem;  	# ä½¿ç”¨éå¯¹ç§°åŠ å¯†ä½¿ç”¨çš„å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">}</span> </span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;certs/ssl-options.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	ssl_session_cache    shared:SSL:10m;  	# ä¸ºäº†é™ä½æ¡æ‰‹å¼€å¯10mç¼“å­˜ï¼Œ1må¯ä»¥æœ‰4000ä¸ªè¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	ssl_session_timeout  30m;  	# mä¸ºåˆ†é’Ÿï¼Œ è¿™é‡Œè®¾ç½®ä¸º 30åˆ†é’Ÿè¶…æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ssl_prefer_server_ciphers on;  	# å¼€å¯ä½¿ç”¨åè®®ä¸æµè§ˆå™¨é€šè®¯ 	
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	ssl_ciphers &#39;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:!RC4:!MD5:!aNULL:!NULL&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # ä¼˜å…ˆä½¿ç”¨æœåŠ¡å™¨é…ç½®çš„åŠ å¯†å¥—ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	resolver 8.8.8.8 valid=300;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	resolver_timeout 10s;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # å¼€å¯ OCSP Stapling
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	ssl_stapling on;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # éªŒè¯ OCSP å“åº”
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	ssl_stapling_verify on;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¼ºè·³è¯ä¹¦ä»¥åŠä¸»åŸŸå<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># httpå¼ºè·³443ï¼Œ æˆ–ä½¿ç”¨ $host å­—æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span> $scheme = <span style="color:#e6db74">http</span> <span style="color:#e6db74">)</span>{ 
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">return</span> <span style="color:#ae81ff">301</span> <span style="color:#e6db74">https://</span>$server_name$request_uri; 
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># å¼ºè·³ä¸»åŸŸå
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span> $host <span style="color:#e6db74">!=</span> <span style="color:#e6db74">&#39;domain.com&#39;</span> <span style="color:#e6db74">)</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">rewrite</span> <span style="color:#e6db74">^(.*)</span>$ <span style="color:#e6db74">https://domain.com/</span>$1 <span style="color:#e6db74">permanent</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># é¿å…ç›´æ¥è¿”å› 404ï¼Œè€Œæ˜¯è¿”å›åº”ç”¨çš„ä¸»å…¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">try_files</span> $uri $uri/ <span style="color:#e6db74">/index.html</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><code>location</code><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>location</code><!-- raw HTML omitted -->åŒ¹é…è§„åˆ™ä»¥åŠä¼˜å…ˆçº§ï¼š<!-- raw HTML omitted --><code>=</code> <strong>&gt;</strong> <code>^~</code>  <strong>&gt;</strong>  <code>~</code>  <strong>&gt;</strong>  <code>~*</code></p>
<p><!-- raw HTML omitted -->ç²¾ç¡®åŒ¹é…<!-- raw HTML omitted -->å’Œ<!-- raw HTML omitted -->å‰ç¼€åŒ¹é…<!-- raw HTML omitted -->ä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„ï¼Œä¸€æ—¦åŒ¹é…åˆ°ä¸€ä¸ªå°±ç›´æ¥èµ°æ­¤<code>location</code>ï¼Œåˆ™ä¸ä¼šå†å¾€ä¸‹åŒ¹é…ã€‚
<!-- raw HTML omitted -->æ­£åˆ™åŒ¹é…<!-- raw HTML omitted -->å°±ç®—åŒ¹é…åˆ°ä¸€ä¸ª<code>location</code>ï¼Œä¹Ÿè¿˜æ˜¯ä¼šæ¥ç€åŒ¹é…ï¼Œçœ‹æ—¶å€™è¿˜æœ‰æ¯”å½“å‰<code>location</code>æ›´å®Œæ•´ï¼Œæ›´åŒ¹é…çš„<code>location</code>å­˜åœ¨ï¼Œåé¢æ²¡æœ‰äº†ï¼Œæ‰åŒ¹é…æœ¬èº«</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>æ­£åˆ™ç¬¦å·</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç©º</td>
<td><code>location</code>åæ²¡æœ‰å‚æ•°ç›´æ¥è·Ÿç€<strong>æ ‡å‡†</strong><code>URI</code>ï¼Œè¡¨ç¤ºå‰ç¼€åŒ¹é…ï¼Œä»£è¡¨è·Ÿè¯·æ±‚ä¸­çš„ <code>URI</code>ä»å¤´å¼€å§‹åŒ¹é…ã€‚</td>
</tr>
<tr>
<td><code>=</code></td>
<td>ç”¨äº<strong>æ ‡å‡†</strong><code>URI</code>å‰ï¼Œè¦æ±‚è¯·æ±‚å­—ç¬¦ä¸²ä¸å…¶<!-- raw HTML omitted -->ç²¾å‡†åŒ¹é…<!-- raw HTML omitted -->ï¼ŒæˆåŠŸåˆ™ç«‹å³å¤„ç†ï¼Œ<code>nginx</code>åœæ­¢æœç´¢å…¶ä»–åŒ¹é…</td>
</tr>
<tr>
<td><code>^~</code></td>
<td>ä½¿ç”¨<!-- raw HTML omitted -->å‰ç¼€åŒ¹é…<!-- raw HTML omitted -->ï¼Œç”¨äº<strong>æ ‡å‡†</strong><code>URI</code>å‰ï¼Œå¹¶è¦æ±‚ä¸€æ—¦åŒ¹é…åˆ°å°±ä¼šç«‹å³å¤„ç†ï¼Œä¸å†å»åŒ¹é…å…¶ä»–çš„é‚£äº›ä¸ªæ­£åˆ™<code>URI</code>ï¼Œä¸€èˆ¬ç”¨æ¥<!-- raw HTML omitted -->åŒ¹é…ç›®å½•<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><code>~</code></td>
<td>è¡¨ç¤ºå¼€å§‹<!-- raw HTML omitted -->æ­£åˆ™åŒ¹é…<!-- raw HTML omitted -->ï¼Œè¡¨ç¤º<code>URI</code>åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œ <!-- raw HTML omitted -->åŒºåˆ†å¤§å°å†™<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><code>~*</code></td>
<td>è¡¨ç¤ºæ­£åˆ™åŒ¹é…<!-- raw HTML omitted -->ä¸åŒºåˆ†å¤§å°å†™<!-- raw HTML omitted --></td>
</tr>
<tr>
<td><code>~ \~*</code></td>
<td>è¡¨ç¤ºæ‰§è¡Œä¸€ä¸ªæ­£åˆ™åŒ¹é…ï¼ˆï¼‰</td>
</tr>
<tr>
<td>`/(xxx</td>
<td>xxx</td>
</tr>
<tr>
<td><code>@</code></td>
<td><code>@</code>å®šä¹‰ä¸€ä¸ªå‘½åçš„<code>location</code>ï¼Œ<code>@</code>å®šä¹‰çš„<code>locaiton</code>åå­—ä¸€èˆ¬ç”¨åœ¨å†…éƒ¨è·³è½¬ï¼Œç±»ä¼¼å˜é‡é¥®ç”¨ï¼Œä¾‹å¦‚<code>error_page</code>, <code>try_files</code>å‘½ä»¤ä¸­ã€‚å®ƒçš„åŠŸèƒ½ç±»ä¼¼äºç¼–ç¨‹ä¸­çš„<code>goto(è½¬åˆ°)</code></td>
</tr>
<tr>
<td><code>/</code></td>
<td>ä»»ä½•æ²¡æœ‰åŒ¹é…æˆåŠŸçš„ï¼Œéƒ½ä¼šåŒ¹é…è¿™é‡Œå¤„ç†</td>
</tr>
<tr>
<td><code>$</code></td>
<td>è¡¨ç¤º<!-- raw HTML omitted -->æ­£åˆ™ç»“æŸç¬¦<!-- raw HTML omitted -->å·</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># è¿™ä¸ªéå¸¸é‡è¦ï¼Œå¦‚æœgitåº“é‡Œæœ‰å¤§æ–‡ä»¶ï¼Œè®¾ç½®å¤ªå°ï¼Œæ–‡ä»¶pushä¼šå¤±è´¥ï¼Œæ ¹æ®æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">client_max_body_size</span> <span style="color:#ae81ff">50m</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ç¦ç”¨é‡å®šå‘å¤„ç†ï¼Œé»˜è®¤é‡å®šå‘ï¼šdefault
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_redirect</span> <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># ä»¥ä¸‹ç¡®ä¿ gitlabä¸­é¡¹ç›®çš„ url æ˜¯åŸŸåè€Œä¸æ˜¯ http://gitï¼Œä¸å¯ç¼ºå°‘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-IP</span> $remote_addr;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-Port</span> $remote_port;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_connect_timeout</span> <span style="color:#e6db74">15s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_read_timeout</span> <span style="color:#e6db74">600s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_send_timeout</span> <span style="color:#e6db74">60s</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è®¾å®šå¯ä¿¡çš„ä»£ç†æœåŠ¡å™¨çš„ IP åœ°å€æˆ– CIDR
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># set_real_ip_from 192.168.1.0/24;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># ä»æŒ‡å®šçš„è¯·æ±‚å¤´æå–çœŸå® IP åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># real_ip_header X-Real-IP;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># real_ip_recursive off;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># real_ip_recursive on;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># real_ip_header X-Forwarded_For;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># è®¾ç½®httpç‰ˆæœ¬ä¸º1.1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_http_version</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">.1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å‡çº§åè®®å¤´ websocket
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Upgrade</span> $http_upgrade;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Connection</span> <span style="color:#e6db74">&#34;upgrade&#34;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å‡çº§åè®®å¤´ä¸ºhttps
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Upgrade-Insecure-Requests</span> <span style="color:#ae81ff">1</span>;   
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-Proto</span> <span style="color:#e6db74">https</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">add_header</span> <span style="color:#e6db74">Content-Security-Policy</span> <span style="color:#e6db74">upgrade-insecure-requests</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">add_header</span> <span style="color:#e6db74">Nginx-Cache</span> <span style="color:#e6db74">â€œ</span>$upstream_cache_statusâ€;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># nginx åå‘ä»£ç†åˆ° gitlab å®¹å™¨æš´éœ²çš„ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://127.0.0.1:8080</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">index</span> <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å¯ç”¨å®¢æˆ·ç«¯å¹¶å‘è®¿é—®æ•°é™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># limit_conn_status 503;  	# è¿”å›çŠ¶æ€å—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># limit_conn_log_level warn;  	# è¿”å›æ—¥å¿—çº§åˆ«
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># limit_rate 50;  	# æ¯ç§’è¿”å›å­—èŠ‚ï¼Œ50ä»£è¡¨50å­—èŠ‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># limit_conn addr 1;  	# å…è®¸ä¸€ä¸ªè¯·æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å¯ç”¨é¢‘ç‡é™åˆ¶ï¼Œburstï¼šè®¿é—®æ¬¡æ•°ï¼Œé¢‘ç‡é™åˆ¶ä¼˜å…ˆçº§é«˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e"># limit_req zone=one burst=1 nodelay;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">location</span> <span style="color:#e6db74">/ip</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">return</span> <span style="color:#ae81ff">200</span> <span style="color:#e6db74">&#34;Client</span> <span style="color:#e6db74">real</span> <span style="color:#e6db74">ip:</span> $remote_addr\n&#34;;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># å¦‚æœå‡ºç°404ï¼Œ å¯èƒ½éœ€è¦é’ˆå¯¹æŸä¸ªæ¥å£é…ç½® location
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">location</span> = <span style="color:#e6db74">/alive</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://upstream_api</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_http_version</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">.1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Upgrade</span> $http_upgrade;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_connect_timeout</span> <span style="color:#e6db74">180s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_read_timeout</span> <span style="color:#e6db74">180s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_send_timeout</span> <span style="color:#e6db74">180s</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> <span style="color:#e6db74">^~</span> <span style="color:#e6db74">/v1</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_buffering</span> <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://upstream_api</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_http_version</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">.1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Upgrade</span> $http_upgrade;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_connect_timeout</span> <span style="color:#e6db74">180s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_read_timeout</span> <span style="color:#e6db74">180s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_send_timeout</span> <span style="color:#e6db74">180s</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">.*\.(gif|jpg|jpeg|png|bmp|swf)$</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://127.0.0.1:8082</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_redirect</span> <span style="color:#e6db74">default</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $remote_addr;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">add_header</span> <span style="color:#e6db74">Nginx-Cache</span> <span style="color:#e6db74">&#34;</span>$upstream_cache_status&#34;;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">expires</span> <span style="color:#e6db74">30d</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">.*\.(js|css)?$</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">expires</span> <span style="color:#e6db74">12h</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">/\.</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">deny</span> <span style="color:#e6db74">all</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># è¿‡æ»¤åªå…è®¸GETï¼ŒHEADå’ŒPOSTæ–¹æ³•è¯·æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span>$request_method <span style="color:#e6db74">!~</span> <span style="color:#e6db74">^(GET|HEAD|POST)</span>$ <span style="color:#e6db74">)</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">return</span> <span style="color:#ae81ff">444</span>;
</span></span><span style="display:flex;"><span>	}   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">### é˜»æ­¢User-Agents,å¦‚æ‰«æå™¨ï¼Œæœºå™¨äººä»¥åŠæ»¥ç”¨ä½ æœåŠ¡å™¨çš„åƒåœ¾é‚®ä»¶å‘é€è€…ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span>$http_user_agent ~<span style="color:#e6db74">*</span> <span style="color:#e6db74">LWP::Simple|BBBike|wget|&#34;Windows</span> <span style="color:#ae81ff">5</span><span style="color:#e6db74">.1&#34;)</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">return</span> <span style="color:#ae81ff">405</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ç¦æ­¢<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->è®¿é—®<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><a href="https://developer.aliyun.com/article/548497" rel="external" target="_self"><code>Nginx</code>ç¦æ­¢<code>IP</code>è®¿é—® åªå…è®¸åŸŸåè®¿é—®</a></li>
<li><!-- raw HTML omitted -->æ–¹å¼ä¸€<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">server_name</span> <span style="color:#e6db74">www.domain.com</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span>$host <span style="color:#e6db74">!=</span> <span style="color:#e6db74">&#39;www.domain.com&#39;)</span>{ <span style="color:#f92672">return</span> <span style="color:#ae81ff">403</span>; }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ–¹å¼äºŒ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ ä¸€ä¸ª<!-- raw HTML omitted --><code>server</code>ï¼Œ<!-- raw HTML omitted -->æ–°åŠ çš„<!-- raw HTML omitted --><code>server</code><!-- raw HTML omitted -->ï¼ˆæ³¨æ„æ˜¯æ–°å¢ï¼Œå¹¶ä¸æ˜¯åœ¨åŸæœ‰çš„<!-- raw HTML omitted --><code>server</code><!-- raw HTML omitted -->åŸºç¡€ä¸Šä¿®æ”¹ï¼‰ <!-- raw HTML omitted --></li>
<li><code>rewrite</code><!-- raw HTML omitted -->é‡å®šå‘<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>å¼€å§‹å­—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.</code></td>
<td>åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦</td>
</tr>
<tr>
<td><code>?</code></td>
<td>é‡å¤0æ¬¡æˆ–1æ¬¡</td>
</tr>
<tr>
<td><code>+</code></td>
<td>é‡å¤1æ¬¡æˆ–å¤šæ¬¡</td>
</tr>
<tr>
<td><code>*</code></td>
<td>æœ€å°‘è¿æ¥æ•°ã€é‚£ä¸ªæœºå™¨è¿æ¥æ•°å°‘å°±åˆ†å‘</td>
</tr>
<tr>
<td><code>\d</code></td>
<td>åŒ¹é…æ•°å­—</td>
</tr>
<tr>
<td><code>^</code></td>
<td>åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹</td>
</tr>
<tr>
<td><code>$</code></td>
<td>åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ</td>
</tr>
<tr>
<td><code>{n}</code></td>
<td>é‡å¤<code>n</code>æ­¤</td>
</tr>
<tr>
<td><code>{n,}</code></td>
<td>é‡å¤<code>n</code>æˆ–æ›´å¤šæ¬¡</td>
</tr>
<tr>
<td><code>[c]</code></td>
<td>åŒ¹é…å•ä¸ªå­—ç¬¦<code>c</code></td>
</tr>
<tr>
<td><code>[a-z]</code>ï¼Œ<code>[A-Z]</code></td>
<td>åŒ¹é…<code>a-z</code>å°å†™å­—æ¯çš„ä»»æ„ä¸€ä¸ªï¼Œ<code>[^a-z]</code>è¡¨ç¤ºå–åï¼ŒåŒ¹é…<code>A-z</code>å¤§å†™å­—æ¯ä¸­ä»»æ„ä¸€ä¸ªï¼Œ<code>[^A-Z]</code>è¡¨ç¤ºå–å</td>
</tr>
<tr>
<td><code>[0-9]</code></td>
<td>åŒ¹é…<code>0-9</code>æ•°å­—çš„ä»»æ„ä¸€ä¸ªï¼Œ<code>[^0-9]</code>è¡¨ç¤ºå–å</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>ç»“å°¾å®šä¹‰å­—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>last</code></td>
<td>åŒ¹é…å®Œæˆåï¼Œç»§ç»­å‘ä¸‹åŒ¹é…æ–°çš„<code>location URL</code>è§„åˆ™</td>
</tr>
<tr>
<td><code>break</code></td>
<td>åŒ¹é…å®Œæˆå³åœæ­¢å‘ä¸‹åŒ¹é…</td>
</tr>
<tr>
<td><code>redirect</code></td>
<td>è¿”å›302ä¸´æ—¶é‡å®šå‘ã€åœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬ååœ°å€</td>
</tr>
<tr>
<td><code>permanent</code></td>
<td>è¿”å›301æ°¸ä¹…é‡å®šå‘ã€åœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬ååœ°å€</td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span> <span style="color:#e6db74">dufault</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">server_name</span> <span style="color:#e6db74">_</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">return</span> <span style="color:#ae81ff">403</span>;  	<span style="color:#75715e"># ç›´æ¥è¿”å›ä¸€ä¸ª403
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">rewrite</span> <span style="color:#e6db74">^(.*)</span> <span style="color:#e6db74">http://domain.com</span> <span style="color:#e6db74">permanent</span>;  	<span style="color:#75715e"># æˆ–è€…è·³è½¬åˆ°å…¶ä»–åŸŸå
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¦æ­¢IPè®¿é—® 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">server</span> { 
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span> <span style="color:#e6db74">default</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">server_name</span> <span style="color:#e6db74">_</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">server_name</span>  <span style="color:#e6db74">domain.com</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">return</span> <span style="color:#ae81ff">500</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æ–‡ä»¶ä¸‹è½½<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># å¯ç”¨ç›®å½•æµè§ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">autoindex</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># è®¾ç½®ä¸ºoff æ—¶ï¼Œæ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼Œæ˜“äºç†è§£çš„å•ä½ï¼ˆå¦‚ KBã€MB ç­‰ï¼‰ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">autoindex_exact_size</span> <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># è®¾ç½®ä¸ºon æ—¶ï¼Œæ˜¾ç¤ºçš„æ—¶é—´å°†æ ¹æ®æœåŠ¡å™¨çš„æœ¬åœ°æ—¶é—´æ¥æ˜¾ç¤º
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#f92672">autoindex_localtime</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">location</span> ~ {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æ—¥å¿—åˆ‡å‰²<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span>$time_iso8601 ~ <span style="color:#e6db74">&#34;^(\d</span>{<span style="color:#f92672">4})-(\d{2})-(\d{2})&#34;)</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">set</span> $year $1;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">set</span> $month $2;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">set</span> $day $3;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">error_page</span> <span style="color:#ae81ff">404</span> <span style="color:#e6db74">http://domain.com</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">access_log</span>  <span style="color:#e6db74">/home/logs/nginx/domain.access_</span>$year-$month-$day.log  <span style="color:#e6db74">main</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">error_log</span>   <span style="color:#e6db74">/home/logs/nginx/domain.error.log</span>  <span style="color:#e6db74">info</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®è·³è½¬<!-- raw HTML omitted --><code>Web</code><!-- raw HTML omitted -->æˆ–<!-- raw HTML omitted --><code>H5</code></li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://blog.csdn.net/weixin_34128501/article/details/91370181?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-4.vipsorttest&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-4.vipsorttest" rel="external" target="_self"><code>nginx</code>é…ç½®æ‰‹æœºç«¯<code>PC</code>ç«¯è®¿é—®ä¸åŒçš„é¡¹ç›®</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://blog.csdn.net/weixin_37008947/article/details/105725236" rel="external" target="_self"><code>nginx</code>æ ¹æ®<code>PC</code>ç«¯è¿˜æ˜¯æ‰‹æœºç«¯è®¾ç½®ä¸åŒçš„ç½‘ç«™æ ¹ç›®å½•</a></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">root</span> <span style="color:#e6db74">/var/www/web/pc</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">index</span>  <span style="color:#e6db74">index.php</span> <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">location</span> <span style="color:#e6db74">^~</span> <span style="color:#e6db74">/api</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">rewrite</span> <span style="color:#e6db74">^/api/(.*)</span>$ <span style="color:#e6db74">/</span>$1 <span style="color:#e6db74">break</span>;
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://swofit/</span>;
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-IP</span> $remote_addr;
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-Port</span> $remote_port;
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å¦‚æœæ˜¯æ‰‹æœºç§»åŠ¨ç«¯è®¿é—®å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span> $http_user_agent ~<span style="color:#e6db74">*</span> <span style="color:#e6db74">&#34;(MIDP)|(WAP)|(UP.Browser)|(Smartphone)|(Obigo)|(Mobile)|(AU.Browser)|(wxd.Mms)|(WxdB.Browser)|(CLDC)|(UP.Link)|(KM.Browser)|(UCWEB)|(SEMC-Browser)|(Mini)|(Symbian)|(Palm)|(Nokia)|(Panasonic)|(MOT-)|(SonyEricsson)|(NEC-)|(Alcatel)|(Ericsson)|(BENQ)|(BenQ)|(Amoisonic)|(Amoi-)|(Capitel)|(PHILIPS)|(SAMSUNG)|(Lenovo)|(Mitsu)|(Motorola)|(SHARP)|(WAPPER)|(LG-)|(LG/)|(EG900)|(CECT)|(Compal)|(kejian)|(Bird)|(BIRD)|(G900/V1.0)|(Arima)|(CTL)|(TDG)|(Daxian)|(DAXIAN)|(DBTEL)|(Eastcom)|(EASTCOM)|(PANTECH)|(Dopod)|(Haier)|(HAIER)|(KONKA)|(KEJIAN)|(LENOVO)|(Soutec)|(SOUTEC)|(SAGEM)|(SEC-)|(SED-)|(EMOL-)|(INNO55)|(ZTE)|(iPhone)|(ipad)|(Android)|(Windows</span> <span style="color:#e6db74">CE)|(Wget)|(Java)|(curl)|(Opera)|(htc)|(blackberry)&#34;</span> <span style="color:#e6db74">)</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">root</span> <span style="color:#e6db74">/var/www/web/mobile</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">index</span> <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">try_files</span> $uri $uri/ <span style="color:#e6db74">@router</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">.*\.(gif|jpg|jpeg|png|bmp|swf)$</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">expires</span>      <span style="color:#e6db74">30d</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">.*\.(js|css)?$</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">expires</span>      <span style="color:#e6db74">12h</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">/\.</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">deny</span> <span style="color:#e6db74">all</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">if</span> <span style="color:#e6db74">(</span>$time_iso8601 ~ <span style="color:#e6db74">&#34;^(\d</span>{<span style="color:#f92672">4})-(\d{2})-(\d{2})&#34;)</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">set</span> $year $1;
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">set</span> $month $2;
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">set</span> $day $3;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">error_page</span> <span style="color:#ae81ff">404</span> <span style="color:#e6db74">http://domian.com</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">access_log</span>  <span style="color:#e6db74">/home/logs/nginx/domain.access_</span>$year-$month-$day.log  <span style="color:#e6db74">main</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">error_log</span>   <span style="color:#e6db74">/home/logs/nginx/domain.error.log</span>  <span style="color:#e6db74">info</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆ–è€…ä½¿ç”¨ä¸‹é¢æ–¹æ³•ã€try_filesç”¨äºæŒ‰é¡ºåºæ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è¿”å›æ–‡ä»¶å†…å®¹ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œé…çš„å¯¹åº”è§„åˆ™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">root</span> <span style="color:#e6db74">/opt/www/cms-web</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">index</span>  <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">try_files</span> $uri $uri/ <span style="color:#e6db74">/index.html</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">location</span> <span style="color:#e6db74">/m/</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">alias</span> <span style="color:#e6db74">/opt/www/cms-web/m/</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">index</span>  <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">try_files</span> $uri $uri/ <span style="color:#e6db74">/m/index.html</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
<ul>
<li><code>Nginx</code><!-- raw HTML omitted -->ä»£ç†<!-- raw HTML omitted --><code>Gitlab</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">listen</span> <span style="color:#ae81ff">80</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">listen</span> <span style="color:#ae81ff">443</span> <span style="color:#e6db74">ssl</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">listen</span> <span style="color:#ae81ff">8081</span> <span style="color:#e6db74">ssl</span> <span style="color:#e6db74">default_server</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># æ­¤åŸŸåæ˜¯æä¾›ç»™æœ€ç»ˆç”¨æˆ·çš„è®¿é—®åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">server_name</span> <span style="color:#e6db74">gitlab.com</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># é¿å…ç›´æ¥è¿”å› 404ï¼Œè€Œæ˜¯è¿”å›åº”ç”¨çš„ä¸»å…¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">try_files</span> $uri $uri/ <span style="color:#e6db74">/index.html</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ä¸»é¡µé¢ä¸å…è®¸ç¼“å­˜ï¼ˆé¿å…é¡¹ç›®å‡çº§ ç©ºç™½é¡µçš„é—®é¢˜ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">location</span> <span style="color:#e6db74">/index.html</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">add_header</span> <span style="color:#e6db74">Expires</span> <span style="color:#e6db74">-1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">add_header</span> <span style="color:#e6db74">Cache-Control</span> <span style="color:#e6db74">no-cache</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># è¿™ä¸ªéå¸¸é‡è¦ï¼Œå¦‚æœgitåº“é‡Œæœ‰å¤§æ–‡ä»¶ï¼Œè®¾ç½®å¤ªå°ï¼Œæ–‡ä»¶pushä¼šå¤±è´¥ï¼Œæ ¹æ®æƒ…å†µè°ƒæ•´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">client_max_body_size</span> <span style="color:#ae81ff">50m</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_redirect</span> <span style="color:#66d9ef">off</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># ä»¥ä¸‹ç¡®ä¿ gitlabä¸­é¡¹ç›®çš„ url æ˜¯åŸŸåè€Œä¸æ˜¯ http://gitï¼Œä¸å¯ç¼ºå°‘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-IP</span> $remote_addr;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å‡çº§åè®®å¤´ websocket
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_http_version</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">.1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Upgrade</span> $http_upgrade;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Connection</span> <span style="color:#e6db74">&#34;upgrade&#34;</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å‡çº§åè®®å¤´ä¸ºhttps
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Upgrade-Insecure-Requests</span> <span style="color:#ae81ff">1</span>;   
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Forwarded-Proto</span> <span style="color:#e6db74">https</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">add_header</span> <span style="color:#e6db74">Content-Security-Policy</span> <span style="color:#e6db74">upgrade-insecure-requests</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># nginx åå‘ä»£ç†åˆ° gitlab å®¹å™¨æš´éœ²çš„ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://127.0.0.1:8080</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">index</span> <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">error_page</span> <span style="color:#ae81ff">404</span> <span style="color:#e6db74">http://gitlab.com</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">access_log</span>  <span style="color:#e6db74">/usr/local/nginx/logs/gitlab.access.log</span>  <span style="color:#e6db74">main</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">error_log</span>   <span style="color:#e6db74">/usr/local/nginx/logs/gitlab.error.log</span>  <span style="color:#e6db74">info</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">}</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
</blockquote>
</blockquote>
<hr>
<h3 id="nginxé›†ç¾¤åå‘ä»£ç†"><code>nginx</code>é›†ç¾¤ï¼Œåå‘ä»£ç†</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->é›†ç¾¤ä»‹ç»<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>é›†ç¾¤å°±æ˜¯ä¸€ç»„ç›¸äº’ç‹¬ç«‹çš„è®¡ç®—æœºï¼Œåˆ©ç”¨é«˜é€Ÿç›¸åŒçš„é€šä¿¡ç½‘ç»œç»„æˆä¸€ä¸ªè¾ƒå¤§çš„è®¡ç®—æœºæœåŠ¡ç³»ç»Ÿï¼Œæ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹éƒ½å¯ä»¥å„è‡ªè¿è¡ŒæœåŠ¡ï¼Œå¹¶ä¸”èƒ½å½¼æ­¤é€šä¿¡ï¼ŒååŒå‘å®¢æˆ·æä¾›æœåŠ¡ã€‚ç»Ÿä¸€ç®¡ç†çš„æ¨¡å¼ã€‚ç”¨æˆ·è¯·æ±‚é›†ç¾¤ç³»ç»Ÿæ—¶ï¼Œé›†ç¾¤ç³»ç»Ÿç»™ç”¨æˆ·çš„æ„Ÿå—æ˜¯ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡å™¨ï¼Œå®é™…ä¸Šç”¨æˆ·è¯·æ±‚çš„æ˜¯ä¸€ç»„é›†ç¾¤æœåŠ¡å™¨</li>
<li>æ‰“å¼€è°·æ­Œã€ç™¾åº¦çš„é¡µé¢ï¼Œçœ‹åˆ°èµ·æ¥æ˜¯å¥½ç®€å•ã€ä¹Ÿè®¸ä½ è§‰å¾—å‡ åˆ†é’Ÿå¯ä»¥åˆ¶ä½œå‡ºç±»ä¼¼çš„ç½‘é¡µï¼Œè€Œå®é™…ä¸Šï¼Œè¿™ä¸ªé¡µé¢èƒŒåæ˜¯ç”±æˆåƒä¸Šä¸‡å°æœåŠ¡å™¨ååŒå·¥ä½œçš„ç»“æœã€‚é‚£ä¹ˆå¤šå°æœåŠ¡å™¨ç»´æŠ¤å’Œç®¡ç†ï¼Œä»¥åŠç›¸äº’åè°ƒå·¥ä½œå°±æ˜¯è¯»è€…æœªæ¥çš„å·¥ä½œèŒè´£</li>
<li>ä¸€èˆ¬æ˜¯æŒ‡åœ¨é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¤±æ•ˆçš„æƒ…å†µä¸‹ï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ä»»åŠ¡ä¼šè‡ªåŠ¨è½¬ç§»åˆ°å…¶ä»–æ­£å¸¸çš„èŠ‚ç‚¹ä¸Šã€‚æ­¤è¿‡ç¨‹å¹¶ä¸å½±å“æ•´ä¸ªé›†ç¾¤çš„è¿è¡Œ</li>
<li>å½“é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ç³»ç»Ÿå‘ç”Ÿæ•…éšœæ—¶ï¼Œè¿è¡Œç€çš„é›†ç¾¤æœåŠ¡ä¼šè¿…é€Ÿåšå‡ºååº”ï¼Œå°†è¯¥ç³»ç»Ÿçš„æœåŠ¡åˆ†é…åˆ°é›†ç¾¤ä¸­å…¶ä»–æ­£åœ¨å·¥ä½œçš„ç³»ç»Ÿä¸Šè¿è¡Œã€‚è€ƒè™‘åˆ°è®¡ç®—æœºç¡¬ä»¶å’Œè½¯ä»¶çš„å®¹é”™æ€§ï¼Œé«˜å¯ç”¨æ€§é›†ç¾¤çš„ä¸»è¦ç›®çš„æ˜¯ä½¿é›†ç¾¤çš„æ•´ä½“æœåŠ¡å°½å¯èƒ½å¯ç”¨ã€‚å¦‚æœé«˜å¯ç”¨æ€§é›†ç¾¤ä¸­çš„ä¸»èŠ‚ç‚¹å‘ç”Ÿäº†æ•…éšœï¼Œé‚£ä¹ˆè¿™æ®µæ—¶é—´å†…å°†ç”±å¤‡èŠ‚ç‚¹ä»£æ›¿å®ƒã€‚å¤‡èŠ‚ç‚¹é€šå¸¸æ˜¯ä¸»èŠ‚ç‚¹çš„é•œåƒã€‚å½“å®ƒä»£æ›¿ä¸»èŠ‚ç‚¹æ—¶ï¼Œå®ƒå¯ä»¥å®Œå…¨æ¥ç®¡ä¸»èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬<code>IP</code>åœ°å€åŠå…¶ä»–èµ„æºï¼‰æä¾›æœåŠ¡ï¼Œå› æ­¤ï¼Œä½¿é›†ç¾¤ç³»ç»Ÿç¯å¢ƒå¯¹äºç”¨æˆ·æ¥è¯´æ˜¯ä¸€è‡´çš„ï¼Œå³ä¸ä¼šå½±å“ç”¨æˆ·çš„è®¿é—®ã€‚é«˜å¯ç”¨æ€§é›†ç¾¤ä½¿æœåŠ¡å™¨ç³»ç»Ÿçš„è¿è¡Œé€Ÿåº¦å’Œå“åº”é€Ÿåº¦ä¼šå°½å¯èƒ½çš„å¿«ã€‚å®ƒä»¬ç»å¸¸åˆ©ç”¨åœ¨å¤šå°æœºå™¨ä¸Šè¿è¡Œçš„å†—ä½™èŠ‚ç‚¹å’ŒæœåŠ¡æ¥ç›¸äº’è·Ÿè¸ªã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹å¤±è´¥ï¼Œå®ƒçš„æ›¿è¡¥è€…å°†åœ¨å‡ ç§’é’Ÿæˆ–æ›´çŸ­æ—¶é—´å†…æ¥ç®¡å®ƒçš„èŒè´£ã€‚å› æ­¤ï¼Œå¯¹äºç”¨æˆ·è€Œè¨€ï¼Œé›†ç¾¤é‡Œçš„ä»»æ„ä¸€å°æœºå™¨å®•æœºï¼Œä¸šåŠ¡éƒ½ä¸ä¼šå—å½±å“</li>
<li>é«˜æ€§èƒ½è®¡ç®—é›†ç¾¤ä¹Ÿç§°å¹¶è¡Œè®¡ç®—ã€‚é€šå¸¸ï¼Œé«˜æ€§èƒ½è®¡ç®—é›†ç¾¤æ¶‰åŠä¸ºé›†ç¾¤å¼€å‘çš„å¹¶è¡Œåº”ç”¨ç¨‹åºï¼Œä»¥è§£å†³å¤æ‚çš„ç§‘å­¦é—®é¢˜ï¼ˆå¤©æ°”é¢„æŠ¥ã€çŸ³æ²¹å‹˜æ¢ã€æ ¸ååº”æ¨¡æ‹Ÿç­‰ï¼‰ã€‚é«˜æ€§èƒ½è®¡ç®—é›†ç¾¤å¯¹å¤–å°±å¥½åƒä¸€ä¸ªè¶…çº§è®¡ç®—æœºï¼Œè¿™ç§è¶…çº§è®¡ç®—æœºå†…éƒ¨ç”±æ•°åè‡³ä¸Šä¸‡ä¸ªç‹¬ç«‹æœåŠ¡å™¨ç»„æˆï¼Œå¹¶ä¸”åœ¨å…¬å…±æ¶ˆæ¯ä¼ é€’å±‚ä¸Šè¿›è¡Œé€šä¿¡ä»¥è¿è¡Œå¹¶è¡Œåº”ç”¨ç¨‹åºã€‚åœ¨è€ç”·å­©çš„å·¥ä½œä¸­å®é™…æ˜¯æŠŠä»»åŠ¡åˆ‡æˆè›‹ç³•ï¼Œç„¶åä¸‹å‘åˆ°é›†ç¾¤èŠ‚ç‚¹è®¡ç®—ï¼Œè®¡ç®—åè¿”å›ç»“æœï¼Œç„¶åç»§ç»­é¢†æ–°ä»»åŠ¡è®¡ç®—ï¼Œå¦‚æ­¤å¾€å¤</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é›†ç¾¤çš„ä¼˜åŠ¿ç‰¹ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é«˜æ€§èƒ½<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å»‰ä»·æ€§<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¯ä¼¸ç¼©æ€§<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é«˜å¯ç”¨æ€§<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é€æ˜æ€§<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¯ç®¡ç†æ€§<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¯ç¼–ç¨‹æ€§<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->é›†ç¾¤åˆ†ç±»<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->è´Ÿè½½å‡è¡¡é›†ç¾¤<!-- raw HTML omitted -->(<code>Load balancing clusters</code>)ç®€ç§°<code>LBC</code>æˆ–è€…<code>LB</code></li>
<li><!-- raw HTML omitted -->é«˜å¯ç”¨æ€§é›†ç¾¤<!-- raw HTML omitted -->(<code>High-availavlability (HA) clusters</code>)ç®€ç§°<code>HAC</code></li>
<li><!-- raw HTML omitted -->é«˜æ€§èƒ½è®¡ç®—é›†ç¾¤<!-- raw HTML omitted -->(<code>Hight-perfomance (HPC) clusters</code>)ç®€ç§°<code>HPC</code></li>
<li><!-- raw HTML omitted -->ç½‘æ ¼è®¡ç®—<!-- raw HTML omitted -->(<code>Grid computing</code>)</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->è´Ÿè½½å‡è¡¡é›†ç¾¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>è´Ÿè½½å‡è¡¡é›†ç¾¤ä¸ºäº†å¼ºä¼ä¸šæä¾›æ›´ä¸ºå®ç”¨ã€æ€§ä»·æ¯”æ›´é«˜çš„ç³»ç»Ÿæ¶æ„è§£å†³æ–¹æ¡ˆã€‚è´Ÿè½½å‡è¡¡é›†ç¾¤å¯ä»¥å°†å¾ˆå¤šå®¢æˆ·é›†ä¸­è®¿é—®è´Ÿè½½å‹åŠ›å°½å¯èƒ½åœ°å¹³å‡åˆ†æ‘Šåœ¨è®¡ç®—æœºé›†ç¾¤ä¸­å¤„ç†ã€‚å®¢æˆ·è®¿é—®è¯·æ±‚è´Ÿè½½åŒ…æ‹¬åº”ç”¨ç¨‹åºå¤„ç†è´Ÿè½½å’Œç½‘ç»œæµé‡è´Ÿè½½ã€‚è¿™æ ·ä½¿åŒä¸€ç»„åº”ç”¨ç¨‹åºä¸ºå¤§é‡ç”¨æˆ·æä¾›æœåŠ¡çš„æ¨¡å¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ‰¿æ‹…ä¸€å®šçš„è®¿é—®æ±‚è´Ÿè½½å‹åŠ›å¹¶ä¸”å¯ä»¥å®ç°è®¿é—®è¯·æ±‚åœ¨å„èŠ‚ç‚¹ä¹‹é—´åŠ¨æ€åˆ†é…ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡</li>
<li>è´Ÿè½½å‡è¡¡ï¼ˆ<code>LoadBalance</code>ï¼‰é›†ç¾¤æä¾›äº†ä¸€ç§å»‰ä»·ã€æœ‰æ•ˆã€é€æ˜çš„æ–¹æ³•ï¼Œæ¥æ‰©å±•ç½‘ç»œè®¾å¤‡å’ŒæœåŠ¡å™¨çš„è´Ÿè½½ã€å¸¦å®½å’Œååé‡ï¼ŒåŒæ—¶åŠ å¼ºäº†ç½‘ç»œæ•°æ®å¤„ç†èƒ½åŠ›ï¼Œæé«˜äº†ç½‘ç»œçš„çµæ´»æ€§å’Œå¯ç”¨æ€§</li>
<li>æŠŠå•å°è®¡ç®—æœºæ— æ³•æ‰¿å—çš„å¤§è§„æ¨¡å¹¶å‘è®¿é—®æˆ–æ•°æ®æµé‡åˆ†æ‹…åˆ°å¤šå°èŠ‚ç‚¹è®¾å¤‡ä¸Šï¼Œåˆ†åˆ«è¿›è¡Œå¤„ç†ï¼Œå‡å°‘ç”¨æˆ·ç­‰å¾…å“åº”çš„æ—¶é—´ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li>
<li>å•ä¸ªé‡è´Ÿè½½çš„è¿ç®—åˆ†æ‹…åˆ°å¤šå°èŠ‚ç‚¹è®¾å¤‡ä¸Šåšå¹¶è¡Œå¤„ç†ï¼Œæ¯ä¸ªèŠ‚ç‚¹è®¾å¤‡å¤„ç†ç»“æŸåï¼Œå°†ç»“æœæ±‡æ€»ï¼Œè¿”å›ç»™ç”¨æˆ·ï¼Œç³»ç»Ÿå¤„ç†èƒ½åŠ›å¾—åˆ°å¤§å¹…åº¦æé«˜</li>
<li><code>7Ã—24</code>å°æ—¶çš„æœåŠ¡ä¿è¯ï¼Œä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰é™åé¢èŠ‚ç‚¹è®¾å¤‡å®•æœºï¼Œä¸èƒ½å½±å“ä¸šåŠ¡</li>
<li>åœ¨è´Ÿè½½å‡è¡¡é›†ç¾¤ä¸­ï¼ŒåŒç»„é›†ç¾¤çš„æ‰€æœ‰è®¡ç®—æœºèŠ‚ç‚¹éƒ½åº”è¯¥æä¾›ç›¸åŒçš„æœåŠ¡ã€‚é›†ç¾¤è´Ÿè½½å‡è¡¡å™¨ä¼šæˆªè·æ‰€æœ‰å¯¹è¯¥æœåŠ¡çš„å…¥ç«™è¯·æ±‚ã€‚ç„¶åå°†è¿™äº›è¯·æ±‚å°½å¯èƒ½åœ°å¹³å‡åœ°åˆ†é…åœ¨æ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹ä¸Š</li>
</ul>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->è´Ÿè½½å‡è¡¡é›†ç¾¤çš„ä½œç”¨ <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ†æ‹…ç”¨æˆ·è®¿é—®è¯·æ±‚åŠæ•°æ®æµé‡ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ - ä¿æŒä¸šåŠ¡è¿ç»­æ€§ï¼Œå³<!-- raw HTML omitted --><code>7Ã—24</code><!-- raw HTML omitted -->å°æ—¶æœåŠ¡ï¼ˆé«˜å¯ç”¨æ€§ï¼‰<!-- raw HTML omitted --></li>
<li>äº<code>Web</code><!-- raw HTML omitted -->ä¸šåŠ¡åŠæ•°æ®åº“ä»åº“ç­‰æœåŠ¡å™¨çš„ä¸šåŠ¡<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->è´Ÿè½½å‡è¡¡é›†ç¾¤å…¸å‹çš„å¼€æºè½¯ä»¶åŒ…æ‹¬<!-- raw HTML omitted --><code>LVS</code>ã€<code>Nginx</code>ã€<code>Haproxy</code>ç­‰</li>
<li><!-- raw HTML omitted -->é«˜å¯ç”¨æ€§é›†ç¾¤çš„ä½œç”¨ <!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å½“ä¸€å°æœºå™¨å®•æœºæ—¶ï¼Œå¦å¤–ä¸€å°æœºå™¨æ¥ç®¡å®•æœºçš„æœºå™¨çš„<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->èµ„æºå’ŒæœåŠ¡èµ„æºï¼Œæä¾›æœåŠ¡<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¸¸ç”¨äºä¸æ˜“å®ç°è´Ÿè½½å‡è¡¡çš„åº”ç”¨ï¼Œæ¯”å¦‚è´Ÿè½½å‡è¡¡å™¨ï¼Œä¸»æ•°æ®åº“ã€ä¸»å­˜å‚¨å¯¹ä¹‹é—´<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->é«˜å¯ç”¨æ€§é›†ç¾¤å¸¸ç”¨çš„å¼€æºè½¯ä»¶åŒ…æ‹¬<!-- raw HTML omitted --><code>Keepalived</code>ã€<code>Heartbeat</code>ç­‰</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->è¿ç»´ä¸­å¸¸è§çš„é›†ç¾¤è½¯ç¡¬ä»¶äº§å“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>äº’è”ç½‘ä¼ä¸šå¸¸ç”¨çš„å¼€æºé›†ç¾¤è½¯ä»¶æœ‰ï¼š<code>Nginx</code>ã€<code>LVS</code>ã€<code>Haproxy</code>ã€<code>Keepalived</code>ã€<code>Heartbeat</code>ã€‚äº’è”ç½‘ä¼ä¸šå¸¸ç”¨çš„å•†ä¸šé›†ç¾¤ç¡¬ä»¶æœ‰ï¼š<code>F5</code>ã€<code>Netscaler</code>ã€<code>Rad-ware</code>ã€<code>A10</code>ç­‰ï¼Œå·¥ä½œæ¨¡å¼ç›¸å½“äº<code>Haproxy</code>çš„å·¥ä½œæ¨¡å¼ã€‚æ·˜å®ã€èµ¶é›†ç½‘ã€æ–°æµªç­‰å…¬å¸æ›¾ä½¿ç”¨è¿‡<code>Netscaler</code>è´Ÿè½½å‡è¡¡äº§å“ã€‚é›†ç¾¤ç¡¬ä»¶<code>Netscaler</code>çš„äº§å“</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->é›†ç¾¤è½¯ç¡¬ä»¶äº§å“å¦‚ä½•é€‰å‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>å½“ä¼ä¸šä¸šåŠ¡é‡è¦ï¼ŒæŠ€æœ¯åŠ›é‡åˆè–„å¼±ï¼Œå¹¶ä¸”å¸Œæœ›å‡ºé’±è´­ä¹°äº§å“åŠè·å–æ›´å¥½çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥é€‰æ‹©ç¡¬ä»¶è´Ÿè½½å‡è¡¡äº§å“ï¼Œå¦‚<code>F5</code>ã€<code>Netscaler</code>ã€<code>Radware</code>ç­‰ï¼Œæ­¤ç±»å…¬å¸å¤šä¸ºä¼ ç»Ÿçš„å¤§å‹éäº’è”ç½‘ä¼ä¸šï¼Œå¦‚é“¶è¡Œã€è¯åˆ¸ã€é‡‘èä¸šåŠå®é©¬ã€å¥”é©°å…¬å¸ç­‰</li>
<li>å¯¹äºé—¨æˆ·ç½‘ç«™æ¥è¯´ï¼Œå¤§å¤šä¼šå¹¶ç”¨è½¯ä»¶åŠç¡¬ä»¶äº§å“æ¥åˆ†æ‹…å•ä¸€äº§å“çš„é£é™©ï¼Œå¦‚æ·˜å®ã€è…¾è®¯ã€æ–°æµªç­‰ã€‚èèµ„äº†çš„ä¼ä¸šä¼šè´­ä¹°ç¡¬ä»¶äº§å“ï¼Œå¦‚èµ¶é›†ç­‰ç½‘ç«™</li>
<li>ä¸­å°å‹äº’è”ç½‘ä¼ä¸šï¼Œç”±äºèµ·æ­¥é˜¶æ®µæ— åˆ©æ¶¦å¯èµšæˆ–è€…åˆ©æ¶¦å¾ˆä½ï¼Œä¼šå¸Œæœ›é€šè¿‡ä½¿ç”¨å¼€æºå…è´¹çš„æ–¹æ¡ˆæ¥è§£å†³é—®é¢˜ï¼Œå› æ­¤ä¼šé›‡ä½£ä¸“é—¨çš„è¿ç»´äººå‘˜è¿›è¡Œç»´æŠ¤ã€‚ä¾‹å¦‚ï¼š<code>51CTO</code>ç­‰</li>
</ul>
</blockquote>
<p>ç›¸æ¯”è¾ƒè€Œè¨€ï¼Œå•†ä¸šçš„è´Ÿè½½å‡è¡¡äº§å“æˆæœ¬é«˜ï¼Œæ€§èƒ½å¥½ï¼Œæ›´ç¨³å®šï¼Œç¼ºç‚¹æ˜¯ä¸èƒ½äºŒæ¬¡å¼€å‘ï¼Œå¼€æºçš„è´Ÿè½½å‡è¡¡è½¯ä»¶å¯¹è¿ç»´äººå‘˜çš„èƒ½åŠ›è¦æ±‚è¾ƒé«˜ï¼Œå¦‚æœè¿ç»´åŠå¼€å‘èƒ½åŠ›å¼ºï¼Œé‚£ä¹ˆå¼€æºçš„è´Ÿè½½å‡è¡¡è½¯ä»¶æ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œç›®å‰çš„äº’è”ç½‘è¡Œä¸šæ›´å€¾å‘äºä½¿ç”¨å¼€æºçš„è´Ÿè½½å‡è¡¡è½¯ä»¶</p>
<ul>
<li><!-- raw HTML omitted -->å¦‚ä½•é€‰æ‹©å¼€æºé›†ç¾¤è½¯ä»¶äº§å“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>ä¸­å°ä¼ä¸šäº’è”ç½‘å…¬å¸ç½‘ç«™åœ¨å¹¶å‘è®¿é—®å’Œæ€»è®¿é—®é‡ä¸æ˜¯å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œå»ºè®®é¦–é€‰<code>Nginx</code>è´Ÿè½½å‡è¡¡ï¼Œç†ç”±æ˜¯<code>Nginx</code>è´Ÿè½½å‡è¡¡é…ç½®ç®€å•ã€ä½¿ç”¨æ–¹ä¾¿ã€å®‰å…¨ç¨³å®šã€ç¤¾åŒºæ´»è·ƒï¼Œä½¿ç”¨çš„äººé€æ¸å¢å¤šï¼Œæˆä¸ºæµè¡Œè¶‹åŠ¿ï¼Œå¦å¤–ä¸€ä¸ªå®ç°è´Ÿè½½å‡è¡¡çš„ç±»ä¼¼äº§å“ä¸º<code>Haproxy</code>ï¼ˆæ”¯æŒ<code>L4</code>å’Œ<code>L7</code>è´Ÿè½½ï¼ŒåŒæ ·ä¼˜ç§€ï¼Œä½†ç¤¾åŒºä¸å¦‚<code>Nginx</code>æ´»è·ƒï¼‰</li>
<li>å¦‚æœè¦è€ƒè™‘<code>Nginx</code>è´Ÿè½½å‡è¡¡çš„é«˜å¯ç”¨åŠŸèƒ½ï¼Œå»ºè®®é¦–é€‰<code>Keepalived</code>è½¯ä»¶ï¼Œç†ç”±æ˜¯å®‰è£…å’Œé…ç½®ç®€å•ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œå®‰å…¨ç¨³å®šï¼Œä¸<code>Keepalived</code>æœåŠ¡ç±»ä¼¼çš„é«˜å¯ç”¨è½¯ä»¶è¿˜æœ‰<code>Heartbeat</code>ï¼ˆä½¿ç”¨æ¯”è¾ƒå¤æ‚ï¼Œä¸å»ºè®®åˆå­¦è€…ä½¿ç”¨ï¼‰</li>
<li>å¦‚æœæ˜¯å¤§å‹ä¼ä¸šäº’è”ç½‘å…¬å¸ï¼Œè´Ÿè½½å‡è¡¡äº§å“å¯ä»¥ä½¿ç”¨<code>LVS</code>+<code>Keepalived</code>åœ¨å‰ç«¯åšå››å±‚è½¬å‘ï¼ˆä¸€èˆ¬æ˜¯ä¸»å¤‡æˆ–ä¸»ä¸»ï¼Œå¦‚æœéœ€è¦æ‰©å±•å¯ä»¥ä½¿ç”¨<code>DNS</code>æˆ–å‰ç«¯ä½¿ç”¨<code>OSPF</code>ï¼‰ï¼Œåç«¯ä½¿ç”¨<code>Nginx</code>æˆ–è€…<code>Haproxy</code>åš<code>7</code>å±‚è½¬å‘ï¼ˆå¯ä»¥æ‰©å±•åˆ°ç™¾å°ï¼‰ï¼Œå†åé¢æ˜¯åº”ç”¨æœåŠ¡å™¨ï¼Œå¦‚æœæ˜¯æ•°æ®åº“ä¸å­˜å‚¨çš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨ï¼Œå»ºè®®é€‰æ‹©<code>LVS</code>+<code>Heart-beat</code>ï¼Œ<code>LVS</code>æ”¯æŒ<code>TCP</code>è½¬å‘ä¸”<code>DR</code>æ¨¡å¼æ•ˆç‡å¾ˆé«˜ï¼Œ<code>Heartbeat</code>å¯ä»¥é…åˆ<code>drbd</code>ï¼Œä¸ä½†å¯ä»¥è¿›è¡Œ<code>VIP</code>çš„åˆ‡æ¢ï¼Œè¿˜å¯ä»¥æ”¯æŒå—è®¾å¤‡çº§åˆ«çš„æ•°æ®åŒæ­¥ï¼ˆ<code>drbd</code>ï¼‰ï¼Œä»¥åŠèµ„æºæœåŠ¡çš„ç®¡ç†</li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡æ¦‚å¿µ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>ä¸¥æ ¼åœ°è¯´ï¼Œ<code>Nginx</code>ä»…ä»…æ˜¯ä½œä¸º<code>Nginx Proxy</code>åå‘ä»£ç†ä½¿ç”¨çš„ï¼Œå› ä¸ºè¿™ä¸ªåå‘ä»£ç†åŠŸèƒ½è¡¨ç°çš„æ•ˆæœæ˜¯è´Ÿè½½å‡è¡¡é›†ç¾¤çš„æ•ˆæœï¼Œæ‰€ä»¥æœ¬æ–‡ç§°ä¹‹ä¸º<code>Nginx</code>è´Ÿè½½å‡è¡¡ã€‚é‚£ä¹ˆï¼Œåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</li>
<li>æ™®é€šè´Ÿè½½å‡è¡¡è½¯ä»¶ï¼Œä¾‹å¦‚å¤§åé¼é¼çš„<code>LVS</code>ï¼Œå…¶å®ç°çš„åŠŸèƒ½åªæ˜¯å¯¹è¯·æ±‚æ•°æ®åŒ…çš„è½¬å‘ï¼ˆä¹Ÿå¯èƒ½ä¼šæ”¹å†™æ•°æ®åŒ…ï¼‰ã€ä¼ é€’ï¼Œå…¶ä¸­<code>DR</code>æ¨¡å¼æ˜æ˜¾çš„ç‰¹å¾æ˜¯ä»è´Ÿè½½å‡è¡¡ä¸‹é¢çš„èŠ‚ç‚¹æœåŠ¡å™¨æ¥çœ‹ï¼Œæ¥æ”¶åˆ°çš„è¯·æ±‚è¿˜æ˜¯æ¥è‡ªè®¿é—®è´Ÿè½½å‡è¡¡å™¨çš„å®¢æˆ·ç«¯çš„çœŸå®ç”¨æˆ·ï¼Œè€Œåå‘ä»£ç†å°±ä¸ä¸€æ ·äº†ï¼Œåå‘ä»£ç†æ¥æ”¶è®¿é—®ç”¨æˆ·çš„è¯·æ±‚åï¼Œä¼šä»£ç†ç”¨æˆ·é‡æ–°å‘èµ·è¯·æ±‚ä»£ç†ä¸‹çš„èŠ‚ç‚¹æœåŠ¡å™¨ï¼Œæœ€åæŠŠæ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ç”¨æˆ·ï¼Œåœ¨èŠ‚ç‚¹æœåŠ¡å™¨çœ‹æ¥ï¼Œè®¿é—®çš„èŠ‚ç‚¹æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ç”¨æˆ·å°±æ˜¯åå‘ä»£ç†æœåŠ¡å™¨äº†ï¼Œè€ŒéçœŸå®çš„ç½‘ç«™è®¿é—®ç”¨æˆ·</li>
<li>ä¸€å¥è¯ï¼Œ<code>LVS</code>ç­‰çš„è´Ÿè½½å‡è¡¡æ˜¯è½¬å‘ç”¨æˆ·è¯·æ±‚çš„æ•°æ®åŒ…ï¼Œè€Œ<code>Nginx</code>åå‘ä»£ç†æ˜¯æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚ç„¶åé‡æ–°å‘èµ·è¯·æ±‚å»è¯·æ±‚å…¶åé¢çš„èŠ‚ç‚¹ã€‚2. å®ç°<code>Nginx</code>è´Ÿè½½å‡è¡¡çš„ç»„ä»¶è¯´æ˜å®ç°<code>Nginx</code>è´Ÿè½½å‡è¡¡çš„ç»„ä»¶ä¸»è¦æœ‰ä¸¤ä¸ª</li>
</ul>
<p><a href="#R-image-805c207453f78664eb37c1d22aed9af8" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/37fcolxnhiou5s9t0pb0vm8l/image_1akuo4vrcpke1vb010f3rdd14gi9.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-805c207453f78664eb37c1d22aed9af8"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/37fcolxnhiou5s9t0pb0vm8l/image_1akuo4vrcpke1vb010f3rdd14gi9.png"></a></p>
<p><a href="#R-image-17efa8e6ac3038f61405ebf24ea14048" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/xd2ms7ck0a33wxf36vwwktgs/image_1akv2ig1519723ljs261b4d1kbo9.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-17efa8e6ac3038f61405ebf24ea14048"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/xd2ms7ck0a33wxf36vwwktgs/image_1akv2ig1519723ljs261b4d1kbo9.png"></a></p>
<p><a href="#R-image-6be87a9c882bf2754337e520403b41b2" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/7dalazu3amny9rg192ing2l9/image_1akv2hcu286b1piavpv9jdsunm.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6be87a9c882bf2754337e520403b41b2"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/7dalazu3amny9rg192ing2l9/image_1akv2hcu286b1piavpv9jdsunm.png"></a></p>
<p><a href="#R-image-afbe0a1d3ae6d9ae2988d4df4e6213c9" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/c4i7xy39l9tymsjbb0fem2l1/image_1akv8kcjorbhsq917bq9h382t13.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-afbe0a1d3ae6d9ae2988d4df4e6213c9"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/c4i7xy39l9tymsjbb0fem2l1/image_1akv8kcjorbhsq917bq9h382t13.png"></a></p>
<p><a href="#R-image-cc78097093ce0a6a560c94f7a5b464b4" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/f3esrb2do4bgexfvltp6l9im/%E5%8F%82%E6%95%B01.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cc78097093ce0a6a560c94f7a5b464b4"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/f3esrb2do4bgexfvltp6l9im/%E5%8F%82%E6%95%B01.jpg"></a></p>
<p><a href="#R-image-e1bd5f527791fd59d257bf059e50dd64" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/x676usyjxgo3idhklzrkqaz5/%E5%8F%82%E6%95%B02.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e1bd5f527791fd59d257bf059e50dd64"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/x676usyjxgo3idhklzrkqaz5/%E5%8F%82%E6%95%B02.jpg"></a></p>
<p><a href="#R-image-c1baca44773bd604c52dc64ddacf50cd" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/i9cazzd6tqyik5hpa0opxjuc/image_1akvc4rs112et1noc12s3d711h49.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c1baca44773bd604c52dc64ddacf50cd"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="http://static.zybuluo.com/WindWhisperer/i9cazzd6tqyik5hpa0opxjuc/image_1akvc4rs112et1noc12s3d711h49.png"></a></p>
<ul>
<li><!-- raw HTML omitted -->å®ç°è´Ÿè½½å‡è¡¡ç»„ä»¶è¯´æ˜<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th><code>Nginx http</code>åŠŸèƒ½æ¨¡å—</th>
<th>æ¨¡å—è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ngx_http_proxy_module</code></td>
<td><code>proxy</code>ä»£ç†æ¨¡å—ï¼Œç”¨æˆ·æŠŠè¯·æ±‚æŠ›ç»™èŠ‚ç‚¹æœåŠ¡å™¨æˆ–<code>upstream</code>æœåŠ¡æ± </td>
</tr>
<tr>
<td><code>ngx_http_upstream_module</code></td>
<td>è´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œå¯ä»¥å®ç°ç½‘ç«™è´Ÿè½½å‡è¡¡åŠŸèƒ½åŠèŠ‚ç‚¹å¥åº·æ£€æŸ¥</td>
</tr>
</tbody>
</table>
<ul>
<li><code>nginx upstream</code><!-- raw HTML omitted -->æ¨¡å—<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Nginx</code>çš„è´Ÿè½½å‡è¡¡åŸºäº<code>ngx_http_upstream_module</code>æ‰€æ”¯æŒçš„ä»£ç†æ–¹å¼åŒ…æ‹¬<code>proxy_pass</code>ã€<code>fastcgi_pass</code>ã€<code>memcached_pass</code>ç­‰</li>
<li><code>rr</code><!-- raw HTML omitted -->ï¼šè½®è¯¢ï¼ˆæ€§èƒ½ç›¸è¿‘ï¼Œä¸šåŠ¡ä¸€æ ·ï¼‰<!-- raw HTML omitted --></li>
<li><code>wrr</code><!-- raw HTML omitted -->ï¼šæƒé‡è½®è¯¢<!-- raw HTML omitted --></li>
<li><code>ip_hash;</code><!-- raw HTML omitted -->ï¼šæ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>hash</code><!-- raw HTML omitted -->ç»“æœåˆ†é…ã€åŒä¸€ä¸ª<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->å›ºå®šè®¿é—®åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨<!-- raw HTML omitted --></li>
<li><code>hash $request_uri;</code><!-- raw HTML omitted -->ï¼šæ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®<!-- raw HTML omitted --><code>IP</code>çš„<code>hash</code><!-- raw HTML omitted -->ç»“æœåˆ†é…ã€åŒä¸€ä¸ª<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->å›ºå®šè®¿é—®åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨<!-- raw HTML omitted -->ï¼Œ<code>$cookie_jsessionid;</code><!-- raw HTML omitted -->æŒ‰ç…§åç«¯åˆ†é…<!-- raw HTML omitted --><code>JSESSIONID</code><!-- raw HTML omitted -->è¿›è¡Œè´Ÿè½½<!-- raw HTML omitted --></li>
<li><code>least_conn;</code><!-- raw HTML omitted -->ï¼šæœ€å°‘è¿æ¥æ•°ã€åˆ†é…ç»™è¿æ¥æ•°æœ€å°‘çš„åç«¯æœåŠ¡å™¨<!-- raw HTML omitted --></li>
<li><code>serverÂ IP:port xxx;</code><!-- raw HTML omitted -->ï¼šå­—æ®µ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>down;</code><!-- raw HTML omitted -->ï¼š å½“å‰<!-- raw HTML omitted --><code>server</code><!-- raw HTML omitted -->æš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡<!-- raw HTML omitted --></li>
<li><code>backup;</code><!-- raw HTML omitted -->ï¼šé¢„ç•™å¤‡ä»½æœåŠ¡å™¨ï¼Œåªæœ‰ä¸»å‚ä¸èŠ‚ç‚¹<!-- raw HTML omitted --><code>down</code>æ‰æ‰å¯ç”¨</li>
<li><code>weigh=3;</code><!-- raw HTML omitted -->ï¼šåŠ æƒè½®è¯¢ã€å€¼è¶Šå¤§åˆ†é…åˆ°è®¿é—®å‡ ç‡è¶Šé«˜<!-- raw HTML omitted --></li>
<li><code>check=3</code><!-- raw HTML omitted -->ï¼šå¼€å¯å¯¹è¯¥æœåŠ¡å™¨å¥åº·æ£€æŸ¥<!-- raw HTML omitted --></li>
<li><code>inter</code><!-- raw HTML omitted -->ï¼šè®¾ç½®è¿ç»­ä¸¤æ¬¡å¥åº·æ£€æŸ¥çš„é—´éš”æ—¶é—´ï¼Œå•ä½æ¯«ç§’ï¼Œé»˜è®¤å€¼<!-- raw HTML omitted --><code>2000</code></li>
<li><code>rise</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šå¤šå°‘æ¬¡è¿ç»­æˆåŠŸå¥åº·æ£€æŸ¥åï¼Œå³å¯è®¤å®šæœåŠ¡å™¨å¯ç”¨çŠ¶æ€<!-- raw HTML omitted --></li>
<li><code>max_fails=3</code><!-- raw HTML omitted -->ï¼šæŒ‡å®šå¤šå°‘æ¬¡ä¸æˆåŠŸåï¼Œå³è®¤ä¸ºå®•æœºçŠ¶æ€ï¼Œé»˜è®¤å€¼<!-- raw HTML omitted --><code>1</code></li>
<li><code>fail_timeout=10 </code><!-- raw HTML omitted -->ï¼šç»è¿‡<!-- raw HTML omitted --><code>max_fails</code><!-- raw HTML omitted -->å¤±è´¥åï¼Œåœ¨<!-- raw HTML omitted --><code>fail_timeout</code><!-- raw HTML omitted -->æ—¶é—´å†…ä¸å†å»è¯·æ±‚å®ƒï¼Œ<!-- raw HTML omitted --><code>fail_timeout</code><!-- raw HTML omitted -->é»˜è®¤æ˜¯<!-- raw HTML omitted --><code>10s</code></li>
<li><code>maxconnï¼š</code>ï¼š</li>
</ul>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è´Ÿè½½å‡è¡¡UDPè½¬å‘</span>
</span></span><span style="display:flex;"><span>stream <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    upstream dns <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®IPçš„hashç»“æœåˆ†é…ã€åŒä¸€ä¸ªIPå›ºå®šè®¿é—®åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨</span>
</span></span><span style="display:flex;"><span>        ip_hash;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># æœ€å°‘è¿æ¥æ•°ã€åˆ†é…ç»™è¿æ¥æ•°æœ€å°‘çš„åç«¯æœåŠ¡å™¨</span>
</span></span><span style="display:flex;"><span>        least_conn;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å½“å‰serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡</span>
</span></span><span style="display:flex;"><span>        server 192.168.111.99:10086 down;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># é¢„ç•™å¤‡ä»½æœåŠ¡å™¨ï¼Œåªæœ‰ä¸»å‚ä¸èŠ‚ç‚¹downæ‰æ‰å¯ç”¨</span>
</span></span><span style="display:flex;"><span>        server 192.168.111.100:10086 weigh<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> backup;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># weighï¼šåŠ æƒè½®è¯¢ã€å€¼è¶Šå¤§åˆ†é…åˆ°è®¿é—®å‡ ç‡è¶Šé«˜ï¼Œmax_failsï¼šå…è®¸è¯·æ±‚å¤±è´¥æ¬¡æ•°ï¼Œfail_timeoutï¼šç»è¿‡max_failså¤±è´¥åï¼ŒæœåŠ¡æš‚å®šæ—¶é—´ã€mac_connsï¼šé™åˆ¶æœ€å¤§è¿æ¥æ•°</span>
</span></span><span style="display:flex;"><span>        server 192.168.111.100:10086 weigh<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> max_fails<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> fail_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span> max_conns<span style="color:#f92672">=</span>128;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å‘ä¸Šæ¸¸æœåŠ¡å™¨ä¿ç•™çš„è¿æ¥æ•°</span>
</span></span><span style="display:flex;"><span>        keepalive 300;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># è¿æ¥ä¿ç•™æ—¶é—´ã€é»˜è®¤60ç§’ï¼Œ</span>
</span></span><span style="display:flex;"><span>		keepalive_timeout 60;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># ä¸€ä¸ªTcpå¤ç”¨ä¸­å¯ä»¥å¹¶å‘æ¥æ”¶çš„è¯·æ±‚æ•°</span>
</span></span><span style="display:flex;"><span>		keepalive_requests 1000;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>check interval<span style="color:#f92672">=</span><span style="color:#ae81ff">3000</span> rise<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> fall<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span> type<span style="color:#f92672">=</span>http;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># check interval=3000 rise=2 fall=5 timeout=1000 type=http;</span>
</span></span><span style="display:flex;"><span>ä¸Šé¢é…ç½®çš„æ„æ€æ˜¯ï¼Œå¯¹staticã€uploadã€è¿™ä¸ªè´Ÿè½½å‡è¡¡æ¡ç›®ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ¯éš”3ç§’æ£€æµ‹ä¸€æ¬¡ï¼Œè¯·æ±‚2æ¬¡æ­£å¸¸åˆ™æ ‡è®°realserverçŠ¶æ€ä¸ºupï¼Œå¦‚æœæ£€æµ‹5æ¬¡éƒ½å¤±è´¥ï¼Œåˆ™æ ‡è®°realserverçš„çŠ¶æ€ä¸ºdownï¼Œè¶…æ—¶æ—¶é—´ä¸º1ç§’ï¼Œæ£€æŸ¥çš„åè®®æ˜¯httpã€‚</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®è½¬å‘åˆ°<!-- raw HTML omitted --><code>Mysql</code></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ <!-- raw HTML omitted --><code>--with-stream</code><!-- raw HTML omitted -->æ¨¡å—æ”¯æŒ<!-- raw HTML omitted --><code>TCP/UDP</code><!-- raw HTML omitted -->åè®®<!-- raw HTML omitted --></li>
<li><a href="https://cloud.tencent.com/developer/article/1768431" rel="external" target="_self"><code>Nginx</code>ä»£ç†è½¬å‘<code>Mysql</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nginx -V
</span></span><span style="display:flex;"><span>configure arguments: --prefix<span style="color:#f92672">=</span>/usr/local/nginx --with-stream</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é…ç½®<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>conf</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸­<!-- raw HTML omitted --><code>server</code><!-- raw HTML omitted -->å­—æ®µ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">stream</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">upstream</span> <span style="color:#e6db74">cloudsocket</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">hash</span> $remote_addr <span style="color:#e6db74">consistent</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">server</span> 192.168.182.155:<span style="color:#ae81ff">3306</span> <span style="color:#e6db74">weight=5</span> <span style="color:#e6db74">max_fails=3</span> <span style="color:#e6db74">fail_timeout=30s</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">server</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">listen</span> <span style="color:#ae81ff">3306</span>;     <span style="color:#75715e"># æ•°æ®åº“æœåŠ¡å™¨ç›‘å¬ç«¯å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_connect_timeout</span> <span style="color:#e6db74">10s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_timeout</span> <span style="color:#e6db74">300s</span>;      <span style="color:#75715e"># å®¢æˆ·ç«¯ä¸ä»£ç†ä¹‹é—´çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœ5åˆ†é’Ÿå†…æ²¡æ“ä½œå°†è‡ªåŠ¨æ–­å¼€ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">cloudsocket</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è´Ÿè½½å‡è¡¡UDPè½¬å‘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">stream</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">upstream</span> <span style="color:#e6db74">dns</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">ip_hash</span>;  	<span style="color:#75715e"># æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®IPçš„hashç»“æœåˆ†é…ã€åŒä¸€ä¸ªIPå›ºå®šè®¿é—®åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">hash</span> $request_uri;  	<span style="color:#75715e"># æŒ‰ç…§è®¿é—®URLçš„hashç»“æœåˆ†é…è¯·æ±‚ã€æ¯ä¸ªURLå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">least_conn</span>;  	<span style="color:#75715e"># æœ€å°‘è¿æ¥æ•°ã€åˆ†é…ç»™è¿æ¥æ•°æœ€å°‘çš„åç«¯æœåŠ¡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">server</span> 192.168.111.99:<span style="color:#ae81ff">10086</span> <span style="color:#e6db74">down</span>;  	<span style="color:#75715e"># å½“å‰serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">server</span> 192.168.111.100:<span style="color:#ae81ff">10086</span> <span style="color:#e6db74">backup</span>;  	<span style="color:#75715e"># é¢„ç•™å¤‡ä»½æœåŠ¡å™¨ï¼Œåªæœ‰ä¸»å‚ä¸èŠ‚ç‚¹downæ‰æ‰å¯ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">server</span> 192.168.111.100:<span style="color:#ae81ff">10086</span> <span style="color:#e6db74">weigh=3</span> <span style="color:#e6db74">max_fails=3</span> <span style="color:#e6db74">fail_timeout=10</span> <span style="color:#e6db74">max_conns=128</span>;  	<span style="color:#75715e"># weighï¼šåŠ æƒè½®è¯¢ã€å€¼è¶Šå¤§åˆ†é…åˆ°è®¿é—®å‡ ç‡è¶Šé«˜ï¼Œmax_failsï¼šå…è®¸è¯·æ±‚å¤±è´¥æ¬¡æ•°ï¼Œfail_timeoutï¼šç»è¿‡max_failså¤±è´¥åï¼ŒæœåŠ¡æš‚å®šæ—¶é—´ã€mac_connsï¼šé™åˆ¶æœ€å¤§è¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">server</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">listen</span> 192.168.111.98:<span style="color:#ae81ff">10086</span> <span style="color:#e6db74">udp</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_responses</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_timeout</span> <span style="color:#e6db74">20s</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_bind</span> $server_addr:$remote_port;
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">dns</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div></blockquote>
</blockquote>
</blockquote>
<hr>
<h3 id="nginxä½¿ç”¨luaè„šæœ¬"><code>Nginx</code>ä½¿ç”¨<code>Lua</code>è„šæœ¬</h3>
<blockquote>
<ul>
<li><code>set_by_lua</code><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->å˜é‡<!-- raw HTML omitted --></li>
<li><code>loa_by_lua</code><!-- raw HTML omitted -->æ—¥å¿—<!-- raw HTML omitted --></li>
<li><code>access_by_lua</code><!-- raw HTML omitted -->è®¿é—®æ§åˆ¶<!-- raw HTML omitted --></li>
<li><code>rewrite_by_lua</code><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>uri</code></li>
<li><code>boy_filter_by_lua</code><!-- raw HTML omitted -->ä¿®æ”¹å“åº”ä½“<!-- raw HTML omitted --></li>
<li><code>header_filter_by_lua</code><!-- raw HTML omitted -->ä¿®æ”¹å“åº”å¤´<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span> <span style="color:#e6db74">lua.erge.com</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/lua</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">default_type</span> <span style="color:#e6db74">text/html</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ç›´æ¥ä½¿ç”¨luaè¯­è¨€æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">content_by_lua</span> <span style="color:#e6db74">&#39;ngx_say(&#34;&lt;p&gt;Hello</span> <span style="color:#e6db74">World!!!&lt;/p&gt;&#34;)&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å¼•ç”¨luaè„šæœ¬æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">content_by_lua_file</span> <span style="color:#e6db74">conf/lua/hello.lua</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><ul>
<li><code>lua</code><!-- raw HTML omitted -->è„šæœ¬<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/hello.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx_say(&#34;&lt;p&gt;Hello World!!!&lt;/p&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->è¯·æ±‚å¤´ä¿¡æ¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/headers.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">local headers = ngx_req.get_headers()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;Host : &#34;, headers[&#34;Host&#34;], &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;user-agent : &#34;, headers[&#34;user-agent&#34;], &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;user-agent : &#34;, headers.user_agent, &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for key, values in pairs(headers)do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   if type(values) == &#39;table&#39; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       ngx.say(key, &#34; : &#34;, table.concat(values, &#34;,&#34;), &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       ngx.say(key, &#34; : &#34;, values, &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–<!-- raw HTML omitted --><code>Post</code><!-- raw HTML omitted -->è¯·æ±‚å‚æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/post.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.req.read_body()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;Post Args Begin&#34;, &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">local post_args = ngx.req.get_post_args()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for key,values in pairs(post_args) do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    if type(values) == &#34;table&#34; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ngx.say(key, &#34; : &#34;, table.concat(values, &#34;, &#34;), &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ngx.say(key, &#34; : &#34;, values, &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–<!-- raw HTML omitted --><code>Nginx</code><!-- raw HTML omitted -->ç‰ˆæœ¬<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/nginx_version.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;http_version : &#34;, ngx.req.http_version(), &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–è¯·æ±‚æ–¹æ³•<!-- raw HTML omitted --><code>GETã€POSTã€PUT</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/method.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;get_method : &#34;, ngx.req.get_method(), &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åŸå§‹çš„è¯·æ±‚å†…å®¹<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/original.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;raw_hader : &#34;, ngx.req.raw_header(), &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>body</code><!-- raw HTML omitted -->å†…å®¹ä½“<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/body.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;get_body_date() : &#34;, ngx.req.get_body_data(), &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><code>Nginx</code><!-- raw HTML omitted -->å…¨å±€å†…å­˜ç¼“å­˜<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/lua/shared.lua<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">local shared_data = ngx.shared.shared_data  	# è·å–ç¼“å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">local key = shared_data:get(&#34;key&#34;)  	# ç¼“å­˜é‡Œé¢å–å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if not key then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    key = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    shared_data:set(&#34;key&#34;, key)  	# è°ƒç”¨set æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ngx.say(&#34;lazy set key &#34;, key, &#34;&lt;br/&gt;&#34;)  	# ç­‰äºä»€ä¹ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">end
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">key = shared_data:incr(&#34;key&#34;, 1)  	# è‡ªå¢åŠ ä¸€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ngx.say(&#34;key=&#34;, key, &#34;&lt;br/&gt;&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><a href="https://github.com/openresty/lua-resty-lrucache" rel="external" target="_self"><code>lua-resty-lrucache</code></a><!-- raw HTML omitted -->ç¼“å­˜<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;conf/vhosts/server.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    listen 80;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server_name lua.erge.com;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    location /lua {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        default_type text/html;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # ç›´æ¥ä½¿ç”¨luaè¯­è¨€æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        content_by_lua &#39;ngx_say(&#34;&lt;p&gt;Hello World!!!&lt;/p&gt;&#34;)&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # å¼•ç”¨luaè„šæœ¬æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        content_by_lua_file conf/lua/hello.lua;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        content_by_lua_block {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            require(&#34;my/cache&#34;).go()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="è¿‡æ»¤ç™»å½•å’ŒçŠ¶æ€ç ">è¿‡æ»¤ç™»å½•å’ŒçŠ¶æ€ç </h3>
<blockquote>
<ul>
<li>è„šæœ¬ä½¿ç”¨<code>nslookup</code>å‘½ä»¤è·å–ç”¨æˆ·<code>IP</code>åœ°å€çš„è¿œç¨‹ä¸»æœºåï¼Œå¹¶ä½¿ç”¨<code>curl</code>å‘½ä»¤è·å–è¿œç¨‹ä¸»æœºçš„çŠ¶æ€ç ã€‚ç„¶åï¼Œå®ƒå°†æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„åŸŸåå’ŒçŠ¶æ€ç æ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ˜¾ç¤º<code>Access granted</code>å¦åˆ™æ˜¾ç¤º<code>Access denied</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰å…è®¸ç™»å½•çš„åŸŸåå’ŒçŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>ALLOWED_DOMAINS<span style="color:#f92672">=(</span><span style="color:#e6db74">&#34;example.com&#34;</span> <span style="color:#e6db74">&#34;example.org&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>ALLOWED_STATUS_CODES<span style="color:#f92672">=(</span><span style="color:#e6db74">&#34;200&#34;</span> <span style="color:#e6db74">&#34;301&#34;</span> <span style="color:#e6db74">&#34;302&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–ç”¨æˆ·IPåœ°å€</span>
</span></span><span style="display:flex;"><span>USER_IP<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo $SSH_CLIENT | awk <span style="color:#e6db74">&#39;{print $1}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–ç”¨æˆ·ç™»å½•æ—¶è¿œç¨‹ä¸»æœºçš„åŸŸåå’ŒçŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>REMOTE_DOMAIN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>nslookup $USER_IP | awk -F<span style="color:#e6db74">&#39;=&#39;</span> <span style="color:#e6db74">&#39;/name/{print $2}&#39;</span> | sed <span style="color:#e6db74">&#39;s/\.$//&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>REMOTE_STATUS_CODE<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl -s -o /dev/null -I -w <span style="color:#e6db74">&#34;%{http_code}&#34;</span> http://$REMOTE_DOMAIN<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„åŸŸåå’ŒçŠ¶æ€ç æ˜¯å¦è¢«å…è®¸</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34; </span><span style="color:#e6db74">${</span>ALLOWED_DOMAINS[*]<span style="color:#e6db74">}</span><span style="color:#e6db74"> &#34;</span> <span style="color:#f92672">=</span>~ <span style="color:#e6db74">&#34; </span><span style="color:#e6db74">${</span>REMOTE_DOMAIN<span style="color:#e6db74">}</span><span style="color:#e6db74"> &#34;</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34; </span><span style="color:#e6db74">${</span>ALLOWED_STATUS_CODES[*]<span style="color:#e6db74">}</span><span style="color:#e6db74"> &#34;</span> <span style="color:#f92672">=</span>~ <span style="color:#e6db74">&#34; </span><span style="color:#e6db74">${</span>REMOTE_STATUS_CODE<span style="color:#e6db74">}</span><span style="color:#e6db74"> &#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Access granted to </span>$REMOTE_DOMAIN<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Access denied to </span>$REMOTE_DOMAIN<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span></span></span></code></pre></div></blockquote>
<ul>
<li>ç¤ºä¾‹è„šæœ¬ï¼Œå®ƒä¼šè¿‡æ»¤ç½‘ç«™åå°ç™»å½•çš„<code>IP</code>åœ°å€å’ŒçŠ¶æ€ç ï¼Œå°†ä¸åœ¨é¢„å®šä¹‰æ–‡ä»¶åˆ—è¡¨ä¸­çš„IPåœ°å€å‘é€åˆ°<code>Telegram</code>é€šçŸ¥ç»„ã€‚</li>
</ul>
<blockquote>
<ul>
<li>è„šæœ¬ä¼šæ£€æŸ¥è¿œç¨‹ä¸»æœºçš„çŠ¶æ€ç æ˜¯å¦ä¸º<code>200</code>ã€‚å¦‚æœæ˜¯ï¼Œåˆ™å®ƒå°†ä»æ–‡ä»¶ä¸­æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„IPåœ°å€æ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ˜¾ç¤º<code>Access granted</code>ï¼Œå¦åˆ™å°†å‘é€<code>Telegram</code>å‘Šè­¦ï¼Œå¹¶æ˜¾ç¤º<code>Access denied</code>ã€‚è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦å°†<code>YOUR_TELEGRAM_API_TOKEN</code>å’Œ<code>YOUR_TELEGRAM_CHAT_ID</code>æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„<code>Telegram API Token</code>å’Œ<code>Chat ID</code>ã€‚</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é¢„å®šä¹‰å…è®¸ç™»å½•çš„IPåœ°å€åˆ—è¡¨æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>ALLOWED_IP_LIST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;allowed_ips.txt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰Telegramé€šçŸ¥ç»„çš„API Tokenå’ŒChat ID</span>
</span></span><span style="display:flex;"><span>TELEGRAM_API_TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YOUR_TELEGRAM_API_TOKEN&#34;</span>
</span></span><span style="display:flex;"><span>TELEGRAM_CHAT_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YOUR_TELEGRAM_CHAT_ID&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–ç”¨æˆ·IPåœ°å€</span>
</span></span><span style="display:flex;"><span>USER_IP<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo $SSH_CLIENT | awk <span style="color:#e6db74">&#39;{print $1}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–ç”¨æˆ·ç™»å½•æ—¶è¿œç¨‹ä¸»æœºçš„çŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>REMOTE_STATUS_CODE<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl -s -o /dev/null -I -w <span style="color:#e6db74">&#34;%{http_code}&#34;</span> http://example.com/login<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„çŠ¶æ€ç æ˜¯å¦ä¸º200</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span> -eq <span style="color:#e6db74">&#34;200&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„IPåœ°å€æ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> grep -Fxq <span style="color:#e6db74">&#34;</span>$USER_IP<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span>$ALLOWED_IP_LIST<span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;Access granted to </span>$USER_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        exit <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å‘é€Telegramå‘Šè­¦</span>
</span></span><span style="display:flex;"><span>        MESSAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Unauthorized login attempt from IP </span>$USER_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://api.telegram.org/bot</span>$TELEGRAM_API_TOKEN<span style="color:#e6db74">/sendMessage&#34;</span>
</span></span><span style="display:flex;"><span>        curl -s -X POST $URL -d chat_id<span style="color:#f92672">=</span>$TELEGRAM_CHAT_ID -d text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$MESSAGE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;Access denied to </span>$USER_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Access denied to </span>$USER_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span></span></span></code></pre></div></blockquote>
<ul>
<li>ç¤ºä¾‹è„šæœ¬ï¼Œç”¨äºè¿‡æ»¤ç½‘ç«™åå°ç™»å½•<code>URL</code>çš„<code>IP</code>åœ°å€å’ŒçŠ¶æ€ç ï¼Œå°†ä¸åœ¨é¢„å®šä¹‰æ–‡ä»¶åˆ—è¡¨ä¸­çš„<code>IP</code>åœ°å€å‘é€åˆ°<code>Telegram</code>é€šçŸ¥ç»„ã€‚</li>
</ul>
<blockquote>
<ul>
<li>è„šæœ¬ä¼šå‘é€ä¸€ä¸ª<code>HTTP</code>è¯·æ±‚æ¥æ£€æŸ¥ç½‘ç«™åå°ç™»å½•<code>URL</code>çš„<code>IP</code>åœ°å€å’ŒçŠ¶æ€ç ã€‚å¦‚æœçŠ¶æ€ç ä¸º<code>200</code>ï¼Œåˆ™å®ƒå°†ä»<code>HTTP</code>å“åº”ä¸­æå–è¿œç¨‹ä¸»æœºçš„IPåœ°å€ï¼Œå¹¶ä»æ–‡ä»¶ä¸­æ£€æŸ¥å®ƒæ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ˜¾ç¤º<code>Access granted</code>ï¼Œå¦åˆ™å°†å‘é€<code>Telegram</code>å‘Šè­¦ï¼Œå¹¶æ˜¾ç¤º<code>Access denied</code>ã€‚è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦å°†<code>YOUR_TELEGRAM_API_TOKEN</code>å’Œ<code>YOUR_TELEGRAM_CHAT_ID</code>æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„<code>Telegram API Token</code>å’Œ<code>Chat ID</code>ï¼Œå¹¶æ ¹æ®éœ€è¦ä¿®æ”¹<code>LOGIN_URL</code>å’Œ<code>REQUEST_HEADERS</code>ã€‚</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é¢„å®šä¹‰å…è®¸ç™»å½•çš„IPåœ°å€åˆ—è¡¨æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>ALLOWED_IP_LIST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;allowed_ips.txt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰éœ€è¦æ£€æŸ¥çš„ç½‘ç«™åå°ç™»å½•URLå’Œè¯·æ±‚å¤´ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>LOGIN_URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://example.com/admin/login&#34;</span>
</span></span><span style="display:flex;"><span>REQUEST_HEADERS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-H &#39;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:90.0) Gecko/20100101 Firefox/90.0&#39; -H &#39;Accept-Language: en-US,en;q=0.5&#39;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰Telegramé€šçŸ¥ç»„çš„API Tokenå’ŒChat ID</span>
</span></span><span style="display:flex;"><span>TELEGRAM_API_TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YOUR_TELEGRAM_API_TOKEN&#34;</span>
</span></span><span style="display:flex;"><span>TELEGRAM_CHAT_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YOUR_TELEGRAM_CHAT_ID&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–ç”¨æˆ·IPåœ°å€</span>
</span></span><span style="display:flex;"><span>USER_IP<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl -s -o /dev/null -w <span style="color:#e6db74">&#34;%{http_code}:%{remote_ip}&#34;</span> $LOGIN_URL -H <span style="color:#e6db74">&#34;</span>$REQUEST_HEADERS<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–è¿œç¨‹ä¸»æœºçš„çŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>REMOTE_STATUS_CODE<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$USER_IP<span style="color:#e6db74">&#34;</span> | cut -d<span style="color:#e6db74">&#39;:&#39;</span> -f1<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„çŠ¶æ€ç æ˜¯å¦ä¸º200</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span> -eq <span style="color:#e6db74">&#34;200&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è·å–è¿œç¨‹ä¸»æœºçš„IPåœ°å€</span>
</span></span><span style="display:flex;"><span>    REMOTE_IP<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$USER_IP<span style="color:#e6db74">&#34;</span> | cut -d<span style="color:#e6db74">&#39;:&#39;</span> -f2<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æ£€æŸ¥è¿œç¨‹ä¸»æœºçš„IPåœ°å€æ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> grep -Fxq <span style="color:#e6db74">&#34;</span>$REMOTE_IP<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span>$ALLOWED_IP_LIST<span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;Access granted to </span>$REMOTE_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        exit <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å‘é€Telegramå‘Šè­¦</span>
</span></span><span style="display:flex;"><span>        MESSAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Unauthorized login attempt from IP </span>$REMOTE_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://api.telegram.org/bot</span>$TELEGRAM_API_TOKEN<span style="color:#e6db74">/sendMessage&#34;</span>
</span></span><span style="display:flex;"><span>        curl -s -X POST $URL -d chat_id<span style="color:#f92672">=</span>$TELEGRAM_CHAT_ID -d text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$MESSAGE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        echo <span style="color:#e6db74">&#34;Access denied to </span>$REMOTE_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Access denied with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span></span></span></code></pre></div></blockquote>
<ul>
<li>ç¨å¾®ä¿®æ”¹çš„è„šæœ¬ï¼Œç”¨äºè¿‡æ»¤ç½‘ç«™åå°ç™»å½•æ—¥å¿—æ–‡ä»¶ä¸­çš„<code>URL</code>ã€<code>IP</code>åœ°å€å’ŒçŠ¶æ€ç ï¼Œå°†ä¸åœ¨é¢„å®šä¹‰æ–‡ä»¶åˆ—è¡¨ä¸­çš„<code>IP</code>åœ°å€å‘é€åˆ°<code>Telegram</code>é€šçŸ¥ç»„ï¼š</li>
</ul>
<blockquote>
<ul>
<li>è¯¥è„šæœ¬ä¼šä»æ—¥å¿—æ–‡ä»¶ä¸­è¿‡æ»¤å‡ºç™»å½•<code>URL</code>ã€<code>IP</code>åœ°å€å’ŒçŠ¶æ€ç ä¿¡æ¯ï¼Œå¹¶éå†è¿™äº›ä¿¡æ¯ã€‚å¯¹äºæ¯ä¸ª<code>IP</code>åœ°å€å’ŒçŠ¶æ€ç ï¼Œå®ƒå°†æ£€æŸ¥çŠ¶æ€ç æ˜¯å¦ä¸º<code>200</code>ï¼Œç„¶åæ£€æŸ¥<code>IP</code>åœ°å€æ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ˜¾ç¤º<code>Access granted</code>ï¼Œå¦åˆ™å°†å‘é€<code>Telegram</code>å‘Šè­¦ï¼Œå¹¶æ˜¾ç¤º<code>Access denied</code>ã€‚è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦å°†<code>YOUR_TELEGRAM_API_TOKEN</code>å’Œ<code>YOUR_TELEGRAM_CHAT_ID</code>æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„<code>Telegram API Token</code>å’Œ<code>Chat ID</code>ï¼Œå¹¶æ ¹æ®éœ€è¦ä¿®æ”¹<code>ALLOWED_IP_LIST</code>å’Œ<code>LOG_FILE</code>ã€‚</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é¢„å®šä¹‰å…è®¸ç™»å½•çš„IPåœ°å€åˆ—è¡¨æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>ALLOWED_IP_LIST<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;allowed_ips.txt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰éœ€è¦æ£€æŸ¥çš„ç½‘ç«™åå°ç™»å½•æ—¥å¿—æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>LOG_FILE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/var/log/nginx/access.log&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®šä¹‰Telegramé€šçŸ¥ç»„çš„API Tokenå’ŒChat ID</span>
</span></span><span style="display:flex;"><span>TELEGRAM_API_TOKEN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YOUR_TELEGRAM_API_TOKEN&#34;</span>
</span></span><span style="display:flex;"><span>TELEGRAM_CHAT_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;YOUR_TELEGRAM_CHAT_ID&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨grepå‘½ä»¤ä»æ—¥å¿—æ–‡ä»¶ä¸­è¿‡æ»¤å‡ºç™»å½•URLã€IPåœ°å€å’ŒçŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>LOG_FILTER<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>grep -E <span style="color:#e6db74">&#39;\/admin\/login.*HTTP\/1\.[01]&#34; 200&#39;</span> $LOG_FILE | awk <span style="color:#e6db74">&#39;{print $1, $7, $9}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># éå†è¿‡æ»¤å‡ºçš„æ—¥å¿—ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> read -r log_info; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># åˆ†åˆ«æå–IPåœ°å€å’ŒçŠ¶æ€ç </span>
</span></span><span style="display:flex;"><span>    REMOTE_IP<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$log_info<span style="color:#e6db74">&#34;</span> | awk <span style="color:#e6db74">&#39;{print $1}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>    REMOTE_STATUS_CODE<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;</span>$log_info<span style="color:#e6db74">&#34;</span> | awk <span style="color:#e6db74">&#39;{print $2}&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æ£€æŸ¥çŠ¶æ€ç æ˜¯å¦ä¸º200</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">&#34;</span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span> -eq <span style="color:#e6db74">&#34;200&#34;</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># æ£€æŸ¥IPåœ°å€æ˜¯å¦åœ¨å…è®¸çš„åˆ—è¡¨ä¸­</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> grep -Fxq <span style="color:#e6db74">&#34;</span>$REMOTE_IP<span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span>$ALLOWED_IP_LIST<span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>            echo <span style="color:#e6db74">&#34;Access granted to </span>$REMOTE_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># å‘é€Telegramå‘Šè­¦</span>
</span></span><span style="display:flex;"><span>            MESSAGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Unauthorized login attempt from IP </span>$REMOTE_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://api.telegram.org/bot</span>$TELEGRAM_API_TOKEN<span style="color:#e6db74">/sendMessage&#34;</span>
</span></span><span style="display:flex;"><span>            curl -s -X POST $URL -d chat_id<span style="color:#f92672">=</span>$TELEGRAM_CHAT_ID -d text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$MESSAGE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            echo <span style="color:#e6db74">&#34;Access denied to </span>$REMOTE_IP<span style="color:#e6db74"> with status code </span>$REMOTE_STATUS_CODE<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span> <span style="color:#f92672">&lt;&lt;&lt;</span> <span style="color:#e6db74">&#34;</span>$LOG_FILTER<span style="color:#e6db74">&#34;</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="work_order">Work_Order</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Work_Order</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_ferry">Install_Ferry</h1>

<h2 id="å®‰è£…ferryå·¥å•ç³»ç»Ÿ">å®‰è£…<code>Ferry</code>å·¥å•ç³»ç»Ÿ</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/lanyulei/ferry" rel="external" target="_self"><code>Github Ferry</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.fdevops.com/docs/ferry-tutorial-document/introduction" rel="external" target="_self">å®‰è£…<code>Ferry</code>å®˜æ–¹æ–‡æ¡£</a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä»¥æ¥æœåŠ¡ç‰ˆæœ¬è¦æ±‚<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>MySQL &gt; 5.7</code></li>
<li><code>Go &gt;= 1.14</code></li>
<li><code>Redis</code></li>
<li><code>node &gt;= v12</code>(ç¨³å®šç‰ˆæœ¬)</li>
<li><code>npm &gt;= v6.14.8</code></li>
<li><!-- raw HTML omitted -->è‹¥æ˜¯å®‰è£…å‡ºé”™ï¼Œè¯·å…ˆç¡®è®¤<!-- raw HTML omitted --><code>redis</code><!-- raw HTML omitted -->åŠ<!-- raw HTML omitted --><code>MySQL</code><!-- raw HTML omitted -->æ˜¯å¦å®‰è£…é…ç½®æˆåŠŸ<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h3 id="éƒ¨ç½²æ–¹å¼">éƒ¨ç½²æ–¹å¼</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.fdevops.com/docs/ferry-tutorial-document/install" rel="external" target="_self">æ‰‹åŠ¨éƒ¨ç½²</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.fdevops.com/docs/ferry-tutorial-document/juebenbushu" rel="external" target="_self">è„šæœ¬è‡ªåŠ¨éƒ¨ç½²</a></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="å¯¼èˆªé¡µ">å¯¼èˆªé¡µ</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/Tencent/bk-sops" rel="external" target="_self"><code>bk-sops</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://bk.tencent.com/download/" rel="external" target="_self">è“é²¸æ™ºäº‘</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://nas.asmrs.xyz:48091/archives/easy-nav" rel="external" target="_self">éƒ¨ç½²å¯¼èˆªé¡µ</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://zhuanlan.zhihu.com/p/109425587" rel="external" target="_self">è‡ªå·±æ­å»ºå¯¼èˆªé¡µ</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/zhuima/daohang" rel="external" target="_self"><code>OP</code>å†…éƒ¨å¯¼èˆªç³»ç»Ÿ</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://post.smzdm.com/p/ag82pkd3/" rel="external" target="_self">å¨è”é€š<code>web</code>å¯¼èˆªé¡µ</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://zhuanlan.zhihu.com/p/441573312" rel="external" target="_self">éƒ¨ç½²ä¸€ä¸ªç®€å•çš„å¯¼èˆªé¡µ</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://cloud.tencent.com/developer/article/1655221" rel="external" target="_self">è¿ç»´å†…éƒ¨ç½‘å€å¯¼èˆªç³»ç»Ÿ</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="docker">Docker</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Docker</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_docker">Use_Docker</h1>

<h2 id="ä½¿ç”¨docker">ä½¿ç”¨<code>Docker</code></h2>
<h3 id="dockerå‘½ä»¤"><code>Docker</code>å‘½ä»¤</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç°æœ‰å¯åŠ¨ä¸­å®¹å™¨æ‰“åŒ…æˆé•œåƒ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker commit f61b39f3bb7e flanneld:<span style="color:#66d9ef">$(</span>date  <span style="color:#e6db74">&#34;+%Y%m%d%H%M%S&#34;</span><span style="color:#66d9ef">)</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ„å»ºé•œåƒ<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker build -t container_name/nginx:<span style="color:#66d9ef">$(</span>date +%Y%m%d%H%M<span style="color:#66d9ef">)</span> --rm .</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‰“æ ‡ç­¾<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ tag ä½¿ç”¨å¸®åŠ©</span>
</span></span><span style="display:flex;"><span>$ docker tag -h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker tag nginx:v1 container_name/nginx:<span style="color:#e6db74">`</span>date +%Y%m%d%H%M<span style="color:#e6db74">`</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ¨é€åˆ°è¿œç¨‹ä»“åº“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker push container_name/nginx:tagname
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¨é€åˆ°è‡ªå»ºharbor</span>
</span></span><span style="display:flex;"><span>$ docker tag SOURCE_IMAGE<span style="color:#f92672">[</span>:TAG<span style="color:#f92672">]</span> 192.168.35.128:9527/test/IMAGE<span style="color:#f92672">[</span>:TAG<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¨é€é•œåƒåˆ°å½“å‰é¡¹ç›®</span>
</span></span><span style="display:flex;"><span>$ docker push 192.168.35.128:9527/test/IMAGE<span style="color:#f92672">[</span>:TAG<span style="color:#f92672">]</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯åŠ¨åœæ­¢å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker-compose -f /opt/docker-compose.yml down &gt;&gt; $log 2&gt;&amp;<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>$ docker-compose -f /opt/docker-compose.yml up -d &gt;&gt; $log 2&gt;&amp;<span style="color:#ae81ff">1</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="dockerfileæ–‡ä»¶"><code>Dockerfile</code>æ–‡ä»¶</h3>
<blockquote>
<ul>
<li>d</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> nginx  	# æ„å»ºé•œåƒåŸºäºå“ªä¸ªé•œåƒ</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">MAINTAINER</span><span style="color:#e6db74">ï¼šé•œåƒç»´æŠ¤è€…å§“åæˆ–é‚®ç®±åœ°å€</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> yum -y install wget <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> wget -O redis.tar.gz <span style="color:#e6db74">&#34;http://download.redis.io/releases/redis-5.0.3.tar.gz&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> tar -xvf redis.tar.gz  	<span style="color:#75715e"># æ˜¯åœ¨ docker buildã€‚æ„å»ºé•œåƒæ‰§è¡Œçš„å‘½ä»¤ï¼Œæ¯ä¸€æ¬¡RUNéƒ½ä¼šæ„å»ºä¸€å±‚</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;/etc/nginx/nginx.conf&#34;</span>] <span style="color:#75715e"># å˜å‚ï¼Œè¿è¡Œå®¹å™¨æ—¶æ‰§è¡Œçš„shellç¯å¢ƒï¼Œå¦‚æœæœ‰å¤šä¸ªåˆ™ä»¥æœ€åä¸€ä¸ªä¸ºå‡†ï¼Œä¹Ÿå¯ä»¥ä¸ºENTRYPOINTæä¾›å‚æ•°</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">VOLUME</span><span style="color:#e6db74">ï¼šæŒ‡å®šå®¹å™¨æŒ‚è½½ç‚¹åˆ°å®¿ä¸»æœºè‡ªåŠ¨ç”Ÿæˆçš„ç›®å½•æˆ–å…¶ä»–å®¹å™¨ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰åˆ™ä½¿ç”¨é»˜è®¤</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> &lt;ç”¨æˆ·å&gt;[:&lt;ç”¨æˆ·ç»„&gt;]  	# ä¸ºRUNã€CMDã€å’Œ ENTRYPOINT æ‰§è¡Œå‘½ä»¤æŒ‡å®šè¿è¡Œç”¨æˆ·å’Œå¦‚æœæ²¡æœ‰å®šä¹‰åˆ™ä½¿ç”¨é»˜è®¤</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> &lt;å·¥ä½œç›®å½•è·¯å¾„&gt;  # ä¸º RUNã€CMDã€ENTRYPOINTã€COPY å’Œ ADD è®¾ç½®å·¥ä½œç›®å½•ï¼Œå°±æ˜¯åˆ‡æ¢ç›®å½•</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>HEALTHCHECHï¼šå¥åº·æ£€æŸ¥<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ARG</span>ï¼šå˜é‡å±æ€§å€¼ï¼Œä¸åœ¨å®¹å™¨å†…éƒ¨èµ·ä½œç”¨ï¼Œåªæœ‰ docker build çš„è¿‡ç¨‹ä¸­æœ‰æ•ˆ<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 80 443  	# å£°æ˜å®¹å™¨çš„æœåŠ¡ç«¯å£ï¼ˆä»…ä»…æ˜¯å£°æ˜ï¼‰ï¼Œä½¿ç”¨ç«¯å£éœ€è¦åšæ˜ å°„</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span>ï¼šè®¾ç½®å®¹å™¨ç¯å¢ƒå˜é‡<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span>ï¼šæ‹·è´æ–‡ä»¶æˆ–ç›®å½•åˆ°å®¹å™¨ä¸­ï¼Œå¦‚æœæ˜¯URLæˆ–å‹ç¼©åŒ…ä¾¿ä¼šè‡ªåŠ¨ä¸‹è½½æˆ–è‡ªåŠ¨è§£å‹<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> hom?.txt /opt/data/  	<span style="color:#75715e"># æ‹·è´æ–‡ä»¶æˆ–ç›®å½•åˆ°å®¹å™¨ä¸­ï¼Œè·ŸADDç±»ä¼¼ï¼Œä½†ä¸å…·å¤‡è‡ªåŠ¨ä¸‹è½½æˆ–è§£å‹çš„åŠŸèƒ½</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;nginx&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>] <span style="color:#75715e"># å®šå‚ï¼Œè¿è¡Œå®¹å™¨æ—¶æ‰§è¡Œçš„shellå‘½ä»¤ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ª ENTRYPOINT æŒ‡ä»¤ï¼Œä»…æœ€åä¸€ä¸ªç”Ÿæ•ˆ</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="docker-composeæ–‡ä»¶"><code>docker-compose</code>æ–‡ä»¶</h3>
<blockquote>
<ul>
<li><code>docker-compose-test.yml</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#34;3&#34;</span>    <span style="color:#75715e"># docker-composeç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:   <span style="color:#75715e"># å®šä¹‰container</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mysql</span>:    <span style="color:#75715e"># containeråç§°-ç›¸å½“äº--name web</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">mysql </span> <span style="color:#75715e"># å¯åŠ¨ååç§°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">network_mode</span>: <span style="color:#ae81ff">bridge</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">mysql:8     </span> <span style="color:#75715e"># imageæ¥æº</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">MYSQL_ROOT_PASSWORD</span>: <span style="color:#e6db74">&#34;root&#34;</span>   <span style="color:#75715e"># è®¾ç½®rootè´¦å·å¯†ç </span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">MYSQL_USER</span>: <span style="color:#e6db74">&#34;user_name&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">MYSQL_PASSWORD</span>: <span style="color:#e6db74">&#34;password&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">MYSQL_DATABASE</span>: <span style="color:#e6db74">&#34;databases_name&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">MYSQL_ALLOW_EMPTY_PASSWORD</span>: <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asia/Shanghai          </span> <span style="color:#75715e"># æŒ‡å®šä¸œå…«æ—¶åŒº</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">user</span>: <span style="color:#e6db74">&#34;1001:1001&#34;</span>   <span style="color:#75715e"># å¯åŠ¨åå®¹å™¨ä¸­ç”¨æˆ·idå’Œç»„idï¼Œä¹Ÿå¯ä»¥æŒ‡å®šç”¨æˆ·åå’Œç»„å</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ulimits</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memlock</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">soft</span>: -<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hard</span>: -<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:    <span style="color:#75715e"># è®¾ç½®æŒä¹…åŒ–æ˜ å°„å…³ç³»ï¼Œ</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">../data/mysql:/var/lib/mysql</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">../conf/mysql/conf.d:/etc/mysql/conf.d</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">../conf/mysql/my.cnf:/etc/mysql/my.cnf</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;/etc/localtime:/etc/localtime:ro&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:      <span style="color:#75715e"># æŒ‡å®šç«¯å£æ˜ å°„</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;3306:3306&#34;</span>     <span style="color:#75715e"># ç«¯å£æ˜ å°„å…³ç³» å’Œportsä¸€èµ·ç›¸å½“äº-p 9001:9989</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:   <span style="color:#75715e"># æŒ‡å®šnetwork-ç›¸å½“äº--network springboot</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">overlay</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">springboot</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ipv4_address</span>: <span style="color:#ae81ff">172.20.0.6</span>    <span style="color:#75715e"># æŒ‡å®šå®¹å™¨ipåœ°å€-ç›¸å½“äº--ip 172.20.0.6</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;--lower_case_table_names=1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#      - &#34;--init-connect=&#39;SET NAMES UTF8MB4;&#39;&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;--character-set-server=utf8mb4&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;--collation-server=utf8mb4_unicode_ci&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####  	ç¬¬äºŒä¸ªå®¹å™¨eså‚æ•°é…ç½®  	#####</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">es</span>:   <span style="color:#75715e"># containeråç§°-ç›¸å½“äº--name es</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">docker.elastic.co/elasticsearch/elasticsearch:7.11.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">es</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">discovery.type=single-node</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;ES_JAVA_OPTS=-Xms512m -Xmx512m&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ulimits</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memlock</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">soft</span>: -<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hard</span>: -<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;../data/es:/usr/share/elasticsearch/data&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;/etc/localtime:/etc/localtime:ro&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;../conf/es/ik:/usr/share/elasticsearch/plugins/ik&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9100</span>:<span style="color:#ae81ff">9100</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">9200</span>:<span style="color:#ae81ff">9200</span>   <span style="color:#75715e"># å‰é¢ä¸ºå®¿ä¸»æœºæ˜ å°„ç«¯å£ï¼Œåé¢ä¸ºå®¹å™¨å†…ç«¯å£</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">overlay</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rabbit</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">rabbit</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">rabbitmq:3-management</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">RABBITMQ_DEFAULT_USER</span>: <span style="color:#e6db74">&#34;user_name&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">RABBITMQ_DEFAULT_PASS</span>: <span style="color:#e6db74">&#34;password&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">RABBITMQ_DEFAULT_VHOST</span>: <span style="color:#e6db74">&#34;develop&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;5672:5672&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;15672:15672&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;/etc/localtime:/etc/localtime:ro&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">overlay</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####  	ç¬¬ä¸‰ä¸ªå®¹å™¨rediså‚æ•°é…ç½®  	##### </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">redis</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">redis</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">redis:6</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;6379:6379&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#34;redis-server --requirepass password&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;/etc/localtime:/etc/localtime:ro&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">overlay</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;7474:7474&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;7687:7687&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">overlay</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####  	ç¬¬å››ä¸ªå®¹å™¨å‚æ•°é…ç½®  	#####</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">javaapp</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name </span>: <span style="color:#ae81ff">javaapp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image </span>: <span style="color:#ae81ff">javaapp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">context</span>: <span style="color:#ae81ff">./</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">dockerfile</span>: <span style="color:#ae81ff">./javaapp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;/etc/localtime:/etc/localtime:ro&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;/tmp/logs:/opt/logs&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;../service/javaapp-0.0.1-SNAPSHOT.jar:/javaapp-0.0.1-SNAPSHOT.jar&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">LOCAL_TEST</span>: <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">MYSQL_URL</span>: <span style="color:#e6db74">&#34;jdbc:mysql://mysql:3306/gcgdata?characterEncoding=utf-8&amp;useSSL=true&amp;serverTimezone=GMT&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">MYSQL_USER</span>: <span style="color:#e6db74">&#34;user_name&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">MYSQL_PASSWD</span>: <span style="color:#e6db74">&#34;password&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">REDIS_HOST</span>: <span style="color:#e6db74">&#34;redis&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">REDIS_PORT</span>: <span style="color:#e6db74">&#34;6379&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">REDIS_PASSWD</span>: <span style="color:#e6db74">&#34;password&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">RABBITMQ_HOST</span>: <span style="color:#e6db74">&#34;rabbit&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">RABBITMQ_PORT</span>: <span style="color:#e6db74">&#34;5672&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">RABBITMQ_USER</span>: <span style="color:#e6db74">&#34;user_name&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">RABBITMQ_PASSWD</span>: <span style="color:#e6db74">&#34;password&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">RABBITMQ_VHOST</span>: <span style="color:#e6db74">&#34;develop&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">RABBITMQ_SSL_ENABLED</span>: <span style="color:#e6db74">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ES_SCHEME</span>: <span style="color:#e6db74">&#34;http&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ES_HOSTS</span>: <span style="color:#e6db74">&#34;es:9200&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ES_USER</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ES_PASSWD</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">XXXAPP_USER_DEFAULTAVATAR</span>: <span style="color:#e6db74">&#34;https://oss.domain.com/xxx/default/icon_user_default.png&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">XXXAPP_USER_NICKNAMEPREFIX</span>: <span style="color:#e6db74">&#34;xxx_&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">XXXAPP_URL_PREFIX</span>: <span style="color:#e6db74">&#34;http://domain.com/appApi&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">XXXAPP_SHARE_URL</span>: <span style="color:#e6db74">&#39;{scheme}://domain.com/{inviteCode}&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">XXXAPP_DOWNLOAD_URL_IOS_STORE</span>: <span style="color:#e6db74">&#34;http://fir.domain.com/downapple?randStr=3psgechs0g&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">CN_MSG_URL</span>: <span style="color:#e6db74">&#39;http://IP:8000&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">DEFAUTL_SMS_URL</span>: <span style="color:#e6db74">&#34;http://IP:80001&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">DEFAULT_SMS_CONTENT</span>: <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">XXX_DOMAINS</span>: <span style="color:#e6db74">&#34;http://domain.com,http://domain.vip&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">XXX_API_DOMAINS</span>: <span style="color:#e6db74">&#34;http://domain.com,http://domain.vip&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">FORBID_MOBILE</span>: <span style="color:#e6db74">&#34;165,171,172,1700,1701,1702,162,1703,1705,1706,1704,1707,1708,1709,167&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">DATA_CENTER_ID</span>: <span style="color:#e6db74">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">XXX_SHARE_DOMAINS</span>: <span style="color:#e6db74">&#34;domain.vip&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">QINIU_AK</span>: <span style="color:#e6db74">&#34;gXAT245FwtyTFqutHpouoc7oKg8tsfOUaawjTkqe&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">QINIU_KK</span>: <span style="color:#e6db74">&#34;YCMdEVi2cdZPqKm6N5dHv8H6UNdGAtDJ2OQBwI9G&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">QINIU_BUCKET</span>: <span style="color:#e6db74">&#34;ossprod&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">mysql</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">es</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">rabbit</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">redis</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">overlay</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####  	ç¬¬äº”ä¸ªå®¹å™¨å‚æ•°é…ç½®  	##### </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nginx</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;/etc/localtime:/etc/localtime:ro&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;../conf/nginx/nginx.conf:/etc/nginx/nginx.conf&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;../conf/nginx/mime.types:/etc/nginx/mime.types&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;../conf/nginx/conf.d:/etc/nginx/conf.d&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;../html:/usr/share/nginx/html&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;80:80&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#    depends_on:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">overlay</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">overlay</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">networks</span>:   <span style="color:#75715e"># å®šä¹‰network-ç›¸å½“äº docker network create --subnet=172.20.0.0/24 springboot è¯¥å‘½ä»¤åˆ›å»ºçš„networké»˜è®¤ä¹Ÿæ˜¯æ¡¥æ¥æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">springboot</span>:   <span style="color:#75715e"># networkåç§°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">driver</span>: <span style="color:#ae81ff">bridge     </span> <span style="color:#75715e"># å®šä¹‰networkç±»å‹ä¸ºæ¡¥æ¥æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ipam</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">driver</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">subnet</span>: <span style="color:#ae81ff">172.20.0.0</span><span style="color:#ae81ff">/24    </span> <span style="color:#75715e"># æŒ‡å®šç½‘æ®µä¿¡æ¯</span></span></span></code></pre></div></blockquote>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_docker">Install_Docker</h1>

<h2 id="dockeréƒ¨ç½²"><code>Docker</code>éƒ¨ç½²</h2>
<h3 id="debianéƒ¨ç½²docker"><code>Debian</code>éƒ¨ç½²<code>Docker</code></h3>
<blockquote>
<ul>
<li>å¸è½½æ‰€æœ‰å†²çªçš„åŒ…</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ <span style="color:#66d9ef">for</span> pkg in docker.io docker-doc docker-compose podman-docker containerd runc; <span style="color:#66d9ef">do</span> sudo apt-get remove $pkg; <span style="color:#66d9ef">done</span></span></span></code></pre></div></blockquote>
<ul>
<li>è®¾ç½®<code>Docker</code>çš„<code>apt</code>å­˜å‚¨åº“</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ Dockerçš„å®˜æ–¹GPGå¯†é’¥</span>
</span></span><span style="display:flex;"><span>$ sudo apt-get update
</span></span><span style="display:flex;"><span>$ sudo apt-get install ca-certificates curl
</span></span><span style="display:flex;"><span>$ sudo install -m <span style="color:#ae81ff">0755</span> -d /etc/apt/keyrings
</span></span><span style="display:flex;"><span>$ sudo curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc
</span></span><span style="display:flex;"><span>$ sudo chmod a+r /etc/apt/keyrings/docker.asc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å°†å­˜å‚¨åº“æ·»åŠ åˆ° Apt æº</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#e6db74">&#34;deb [arch=</span><span style="color:#66d9ef">$(</span>dpkg --print-architecture<span style="color:#66d9ef">)</span><span style="color:#e6db74"> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  </span><span style="color:#66d9ef">$(</span>. /etc/os-release <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;</span>$VERSION_CODENAME<span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74"> stable&#34;</span> | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span><span style="display:flex;"><span>$ sudo apt-get update</span></span></code></pre></div></blockquote>
<ul>
<li>æŒ‰ç…§<code>Docker</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…æœ€æ–°ç‰ˆæœ¬ </span>
</span></span><span style="display:flex;"><span>$ sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ—å‡ºå¯ç”¨çš„ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ apt-cache madison docker-ce | awk <span style="color:#e6db74">&#39;{ print $3 }&#39;</span>
</span></span><span style="display:flex;"><span>5:26.1.0-1~debian.12~bookworm
</span></span><span style="display:flex;"><span>5:26.0.2-1~debian.12~bookworm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ VERSION_STRING<span style="color:#f92672">=</span>5:26.1.0-1~debian.12~bookworm
</span></span><span style="display:flex;"><span>$ sudo apt-get install docker-ce<span style="color:#f92672">=</span>$VERSION_STRING docker-ce-cli<span style="color:#f92672">=</span>$VERSION_STRING containerd.io docker-buildx-plugin docker-compose-plugin</span></span></code></pre></div></blockquote>
<ul>
<li>å¯åŠ¨</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo systemctl enable docker <span style="color:#f92672">&amp;&amp;</span> sudo systemctl start docker</span></span></code></pre></div></blockquote>
<ul>
<li>é…ç½®æ™®é€šç”¨æˆ·åŠ å…¥<code>Docker</code>ç»„</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo usermod -aG docker user_name</span></span></code></pre></div></blockquote>
<ul>
<li>é…ç½®<code>docker-compose</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ln -s /usr/libexec/docker/cli-plugins/docker-compose /usr/bin/docker-compose</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="centoséƒ¨ç½²docker"><code>CentOS</code>éƒ¨ç½²<code>Docker</code></h3>
<blockquote>
<ul>
<li>å¸è½½æ—§ç‰ˆæœ¬</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo yum remove docker <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-client <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-client-latest <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-common <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-latest <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-latest-logrotate <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-logrotate <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>                  docker-engine</span></span></code></pre></div></blockquote>
<ul>
<li>ä½¿ç”¨<code>rpm</code>å­˜å‚¨åº“å®‰è£…</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo yum install -y yum-utils
</span></span><span style="display:flex;"><span>$ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span></span></code></pre></div></blockquote>
<ul>
<li>å®‰è£…<code>Docker Engine</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…æœ€æ–°ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…ç‰¹å®šç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ yum list docker-ce --showduplicates | sort -r
</span></span><span style="display:flex;"><span>docker-ce.x86_64    3:26.1.3-1.el9    docker-ce-stable
</span></span><span style="display:flex;"><span>docker-ce.x86_64    3:26.1.2-1.el9    docker-ce-stable
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io docker-buildx-plugin docker-compose-plugin</span></span></code></pre></div></blockquote>
<ul>
<li>å¯åŠ¨</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ $ sudo systemctl enable docker <span style="color:#f92672">&amp;&amp;</span> sudo systemctl start docker</span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_linux">Use_Linux</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Use_Linux</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="system_optimization">System_Optimization</h1>

<h2 id="linuxç³»ç»Ÿä¼˜åŒ–"><code>Linux</code>ç³»ç»Ÿä¼˜åŒ–</h2>
<h3 id="ç³»ç»Ÿåˆå§‹åŒ–">ç³»ç»Ÿåˆå§‹åŒ–</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install vim lrzsz epel-release
</span></span><span style="display:flex;"><span>$ yum -y update
</span></span><span style="display:flex;"><span>$ setenforce <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> sed -i <span style="color:#e6db74">&#34;s/SELINUX=enforcing/SELINUX=disabled/g&#34;</span> /etc/selinux/config</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ä¼˜åŒ–ç³»ç»Ÿå†…æ ¸">ä¼˜åŒ–ç³»ç»Ÿå†…æ ¸</h3>
<ul>
<li>
<ol>
<li><a href="https://wiki.archlinux.org/title/sysctl#Installation" rel="external" target="_self">ç³»ç»Ÿæ§åˆ¶</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo  <span style="color:#e6db74">&#34;# æ‰€æœ‰é…ç½®éƒ½æ˜¯ï¼š0ï¼šä¸ºå…³é—­ï¼Œ1ï¼šä¸ºå¼€å¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å…³é—­ipv6
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.conf.all.disable_ipv6 = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.conf.default.disable_ipv6 = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è°ƒæ•´ IPv6
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.conf.default.router_solicitations = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.conf.default.accept_ra_rtr_pref = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.conf.default.accept_ra_pinfo = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.conf.default.accept_ra_defrtr = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.conf.default.autoconf = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.conf.default.dad_transmits = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.conf.default.max_addresses = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¿½ç•¥ ICMP å›æ˜¾è¯·æ±‚ã€è®¾ç½®æœåŠ¡å™¨ç¦ping
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.icmp_echo_ignore_all = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.icmp.echo_ignore_all = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é¿å…æ”¾å¤§æ”»å‡»
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.icmp_echo_ignore_broadcasts = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¼€å¯æ¶æ„icmpé”™è¯¯æ¶ˆæ¯ä¿æŠ¤
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.icmp_ignore_bogus_error_responses = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¼€å¯/å…³é—­è·¯ç”±è½¬å‘ 1ï¼šä¸ºå¼€å¯ï¼Œ0ï¼šä¸ºå…³é—­
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.ip_forward = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.all.forwarding = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.conf.all.forwarding = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¼€å¯åå‘è·¯å¾„è¿‡æ»¤ã€é€šè¿‡å¯ç”¨åå‘è·¯å¾„è¿‡æ»¤ï¼Œå†…æ ¸å°†å¯¹ä»æœºå™¨ä¸Šæ‰€æœ‰æ¥å£æ¥æ”¶åˆ°çš„æ•°æ®åŒ…è¿›è¡ŒæºéªŒè¯ã€‚è¿™å¯ä»¥é˜²æ­¢æ”»å‡»è€…ä½¿ç”¨ IP æ¬ºéª—æ–¹æ³•é€ æˆä¼¤å®³
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.default.rp_filter = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.all.rp_filter = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ‰“å¼€å¹¶è®°å½•æ¬ºéª—ã€æºè·¯ç”±å’Œé‡å®šå‘æ•°æ®åŒ…
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.default.log_martians = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.all.log_martians = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¤„ç†æ— æºè·¯ç”±çš„åŒ…
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.all.accept_source_route = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.default.accept_source_route = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å…³é—­sysrqåŠŸèƒ½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kernel.sysrq = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># coreæ–‡ä»¶åä¸­æ·»åŠ pidä½œä¸ºæ‰©å±•å
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kernel.core_uses_pid = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># TCP/IP å †æ ˆåŠ å›ºã€å¼€å¯SYNCookies,å½“å‡ºç°SYNç­‰å¾…é˜Ÿåˆ—æº¢å‡ºæ—¶,å¯ç”¨cookies æ¥å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_syncookies = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kernel.msgmnb = 65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kernel.msgmax = 65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¼˜åŒ– LB ç«¯å£ä½¿ç”¨ å¢åŠ ç³»ç»Ÿæ–‡ä»¶æè¿°ç¬¦é™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fs.file-max = 65535
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å…è®¸æ›´å¤šçš„ PIDï¼ˆä»¥å‡å°‘ç¿»è½¬é—®é¢˜ï¼‰ï¼› å¯èƒ½ä¼šç ´åæŸäº›ç¨‹åº 32768
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kernel.pid_max = 65535
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è®¾ç½®æœ€å¤§å†…å­˜å…±äº«æ®µå¤§å°bytes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kernel.shmmax = 68719476736
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kernel.shmall = 4294967296
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¯ç”¨timewaitå¿«é€Ÿå›æ”¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_tw_recycle = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_sack = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_window_scaling = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¢åŠ ä¸“ç”¨äºç½‘ç»œæ¥å£çš„å†…å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.core.rmem_default = 1048576
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.core.rmem_max = 16777216
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.core.wmem_default = 1048576
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.core.wmem_max = 16777216
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.core.optmem_max = 65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_rmem = 4096 1048576 2097152
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_wmem = 4096 65536 16777216
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.udp_rmem_min = 8192
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.udp_wmem_min = 8192
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¯ç”¨ TCP å¿«é€Ÿæ‰“å¼€ã€é€šè¿‡åœ¨å‘é€æ–¹çš„åˆå§‹ TCP SYN æœŸé—´å¯ç”¨æ•°æ®äº¤æ¢æ¥å¸®åŠ©å‡å°‘ç½‘ç»œå»¶è¿Ÿã€‚ä½¿ç”¨è¯¥å€¼3è€Œä¸æ˜¯é»˜è®¤å€¼1å…è®¸
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_fastopen = 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¢åŠ æœ€å¤§è¿æ¥æ•°ã€è­¦å‘Šï¼šå¢åŠ æ­¤å€¼å¯èƒ½åªä¼šæé«˜é«˜è´Ÿè½½æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œå¹¶å¯èƒ½å¯¼è‡´å¤„ç†é€Ÿåº¦å˜æ…¢ï¼ˆä¾‹å¦‚å•çº¿ç¨‹é˜»å¡æœåŠ¡å™¨ï¼‰æˆ–å·¥ä½œçº¿ç¨‹/è¿›ç¨‹æ•°é‡ä¸è¶³
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># net.core.somaxconn = 8192
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¸‹è¿°å†…å­˜å•ä½æ˜¯é¡µï¼Œè€Œä¸æ˜¯å­—èŠ‚ã€‚å¯å‚è€ƒçš„ä¼˜åŒ–å€¼æ˜¯:786432 1048576 1572864
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># net.ipv4.tcp_tw_len = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¢åŠ æ¥æ”¶é˜Ÿåˆ—çš„å¤§å°ã€æ¯ä¸ªç½‘ç»œæ¥å£æ¥æ”¶æ•°æ®åŒ…çš„é€Ÿç‡æ¯”å†…æ ¸å¤„ç†è¿™äº›åŒ…çš„é€Ÿç‡å¿«æ—¶ï¼Œå…è®¸é€åˆ°é˜Ÿåˆ—çš„æ•°æ®åŒ…çš„æœ€å¤§æ•°ç›®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.core.netdev_max_backlog = 262144
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># é™åˆ¶ä»…ä»…æ˜¯ä¸ºäº†é˜²æ­¢ç®€å•çš„DoS æ”»å‡»
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_max_orphans = 3276800
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># è°ƒæ•´æŒ‚èµ·çš„è¿æ¥å¤„ç†ã€æœªæ”¶åˆ°å®¢æˆ·ç«¯ç¡®è®¤ä¿¡æ¯çš„è¿æ¥è¯·æ±‚çš„æœ€å¤§å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_max_syn_backlog = 8192
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç­‰å¾…æ—¶é—´ï¼Œé»˜è®¤æ˜¯:180000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_max_tw_buckets = 6000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¼€å¯é‡ç”¨ã€‚å…è®¸å°†TIME-WAIT sockets é‡æ–°ç”¨äºæ–°çš„TCP è¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_tw_reuse = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_fin_timeout = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_slow_start_after_idle = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># TCP æ—¶é—´æˆ³
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_timestamps = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å†…æ ¸æ”¾å¼ƒå»ºç«‹è¿æ¥ä¹‹å‰å‘é€SYNACK åŒ…çš„æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_synack_retries = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å†…æ ¸æ”¾å¼ƒå»ºç«‹è¿æ¥ä¹‹å‰å‘é€SYN åŒ…çš„æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_syn_retries = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_mem = 94500000 915000000 927000000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¯ç”¨ MTU æ¢æµ‹ã€æœ€å¤§ä¼ è¾“å•å…ƒ (MTU)è¶Šé•¿ï¼Œæ€§èƒ½è¶Šå¥½ï¼Œä½†å¯é æ€§è¶Šå·®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># net.ipv4.tcp_mtu_probing = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># æ›´æ”¹ TCP ä¿æ´»å‚æ•°ã€å½“keepalive èµ·ç”¨çš„æ—¶å€™ï¼ŒTCP å‘é€keepalive æ¶ˆæ¯çš„é¢‘åº¦ã€‚ç¼ºçœæ˜¯2 å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_keepalive_time = 60
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_keepalive_intvl = 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_keepalive_probes = 6
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_keepalive_time = 30
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¢åŠ ä¸´æ—¶ç«¯å£èŒƒå›´ã€å…è®¸ç³»ç»Ÿæ‰“å¼€çš„ç«¯å£èŒƒå›´
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.ip_local_port_range = 1024 65000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¿®æ”¹é˜²ç«å¢™è¡¨å¤§å°ï¼Œé»˜è®¤65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># net.netfilter.nf_conntrack_max=655350
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># net.netfilter.nf_conntrack_tcp_timeout_established=1200
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¯é€‰å€¼ï¼š0ã€1ã€2ï¼Œ1ï¼Œ è¡¨ç¤ºå†…æ ¸å…è®¸åˆ†é…æ‰€æœ‰çš„ç‰©ç†å†…å­˜ï¼Œè€Œä¸ç®¡å½“å‰çš„å†…å­˜çŠ¶æ€å¦‚ä½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vm.overcommit_memory=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vm.swappiness = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç¦ç”¨ ICMP é‡å®šå‘ã€ç¡®ä¿æ— äººèƒ½ä¿®æ”¹è·¯ç”±è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.all.accept_redirects = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.default.accept_redirects = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.all.secure_redirects = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.default.secure_redirects = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.conf.all.accept_redirects = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv6.conf.default.accept_redirects = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># åœ¨éè·¯ç”±å™¨ä¸Šç¦ç”¨ ICMP é‡å®šå‘å‘é€
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.all.send_redirects = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.conf.default.send_redirects = 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Other tunings
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.tcp_no_metrics_save = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vm.min_free_kbytes = 65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å¯ç”¨ BBR æ‹¥å¡æ§åˆ¶ç®—æ³•å¯ä»¥å¸®åŠ©å®ç°æ›´é«˜çš„å¸¦å®½å’Œæ›´ä½çš„äº’è”ç½‘æµé‡å»¶è¿Ÿã€‚é¦–å…ˆï¼ŒåŠ è½½æ¨¡å—tcp_bbrã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># net.core.default_qdisc = cake
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># net.ipv4.tcp_congestion_control = bbr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å°†è„å­—èŠ‚è®¾ç½®ä¸ºè¶³å¤Ÿå°çš„å€¼ã€ä¾‹å¦‚ 4M
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># vm.dirty_background_bytes = 4194304
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># vm.dirty_bytes = 4194304
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ç£ç›˜IOé…ç½®ï¼Œlinuxä¼šè®¾ç½®40%çš„å¯ç”¨å†…å­˜ç”¨æ¥åšç³»ç»Ÿcacheï¼Œå½“flushæ•°æ®æ—¶è¿™40%å†…å­˜ä¸­çš„æ•°æ®ç”±äºå’ŒIOåŒæ­¥é—®é¢˜å¯¼è‡´è¶…æ—¶(120s)ï¼Œæ‰€å°†40%å‡å°åˆ°10%ï¼Œé¿å…è¶…æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># vm.dirty_ratio=10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># vm.dirty_background_ratio=5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># nfs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fs.nfs.nfs_callback_tcpport = 32764
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fs.nfs.nlm_tcpport = 32768
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fs.nfs.nlm_udpport = 32768 &#34;</span> &gt;&gt; /etc/sysctl.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sysctl -p  	<span style="color:#75715e"># é‡è½½ä½¿ä¹‹ç”Ÿæ•ˆ</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="ä¿®æ”¹ç³»ç»Ÿulimit">ä¿®æ”¹ç³»ç»Ÿ<code>Ulimit</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¸´æ—¶ä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>$ ulimit -n <span style="color:#ae81ff">65535</span>  	
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†™åˆ°é…ç½®æ–‡ä»¶æ°¸ä¹…ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft nproc 65535  	# soft è½¯é™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nproc 65535  	# hard ç¡¬é™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">root soft nofile 65535  	# é’ˆå¯¹ç”¨æˆ·å•ç‹¬åšé™åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">root hard nofile 65535
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft nofile 25535
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* hard nofile 25535
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft memlock unlimited
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">* soft memlock unlimited &#34;</span> &gt;&gt;/etc/security/limits.conf</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ä¿®æ”¹sshd">ä¿®æ”¹<code>sshd</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;AllowUsers myadmin@0.0.0.0/0&#34;</span> &gt;&gt;/etc/ssh/sshd_config
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;AllowUsers myadmin@192.168.0.115&#34;</span> &gt;&gt;/etc/ssh/sshd_config  	<span style="color:#75715e"># é™åˆ¶ç”¨æŒ‡å®šIPç™»å½•</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;StrictHostKeyChecking no&#34;</span> &gt;&gt;/etc/ssh/sshd_config  	<span style="color:#75715e"># å…³é—­é¦–æ¬¡è¿æ¥è¯¢é—® </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¦æ­¢rootç”¨æˆ·è¿œç¨‹ç™»å½•æœåŠ¡å™¨</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/#PermitRootLogin yes/PermitRootLogin no/g&#34;</span> /etc/ssh/sshd_config
</span></span><span style="display:flex;"><span>$ systemctl restart sshd  </span></span></code></pre></div></blockquote>
<hr>
<h3 id="ä¼˜åŒ–ç³»ç»ŸæœåŠ¡cgroup">ä¼˜åŒ–ç³»ç»ŸæœåŠ¡<code>Cgroup</code></h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># é™åˆ¶CPU</span>
</span></span><span style="display:flex;"><span>$ mkdir /sys/fs/cgroup/cpu,cpuacct/cgroup_mysql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;30000&#34;</span> &gt;/sys/fs/cgroup/cpu,cpuacct/cgroup_mysql/cpu.cfs_quota_us
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;mysql pid&#34;</span> &gt;/sys/fs/cgroup/cpu,cpuacct/cgroup_mysql/task
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é™åˆ¶å†…å­˜ï¼Œ é™åˆ¶å•ä½ä¸ºï¼šå­—èŠ‚(Bytes)</span>
</span></span><span style="display:flex;"><span>$ mkdir /sys/fs/cgroup/memory/cgroup_mysql
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;1073741824&#34;</span> &gt;/sys/fs/cgroup/memory/cgroup_mysql/memory.limit_in_bytes  	<span style="color:#75715e"># 1G ä¸ºï¼š1073741824Bytes(å­—èŠ‚)</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;mysql pid&#34;</span> &gt;/sys/fs/cgroup/memory/cgroup_mysql/task</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ä¼˜åŒ–histsizeæ˜¾ç¤ºæ“ä½œæ—¶é—´è¿æ¥ipä»¥åŠç”¨æˆ·">ä¼˜åŒ–<code>HISTSIZE</code>æ˜¾ç¤ºæ“ä½œæ—¶é—´ã€è¿æ¥<code>IP</code>ä»¥åŠç”¨æˆ·</h3>
<ul>
<li>
<ol>
<li><a href="https://www.51cto.com/article/639680.html" rel="external" target="_self">è°åŠ¨äº†æˆ‘çš„ä¸»æœº? ä¹‹æ´»ç”¨<code>History</code>å‘½ä»¤</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="https://ftp.gnu.org/gnu/" rel="external" target="_self">ä¸‹è½½<code>GNU</code>è½¯ä»¶</a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç›‘æ§ç™»é™†è¿‡ç³»ç»Ÿçš„ç”¨æˆ·ã€IPåœ°å€ã€æ“ä½œå‘½ä»¤ä»¥åŠæ“ä½œæ—¶é—´</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;export HISTTIMEFORMAT=&#34;</span>%F %T <span style="color:#e6db74">`</span>who <span style="color:#ae81ff">\-</span>u am i 2&gt;/dev/null | awk <span style="color:#e6db74">&#39;{print $NF}&#39;</span> | sed <span style="color:#ae81ff">\-</span>e <span style="color:#e6db74">&#39;s/[()]//g&#39;</span><span style="color:#e6db74">`</span> <span style="color:#e6db74">`</span>whoami<span style="color:#e6db74">`</span> <span style="color:#e6db74">&#34;&#34;</span> &gt;&gt;/etc/profile.d/history.sh</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted --><code>Ubuntu</code>å®‰è£…<code>messages</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo apt-get install --reinstall rsyslog
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/rsyslog.d/50-default.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">*.=info;*.=notice;*.=warn;\  	# 31 è¡Œå·¦å³å–æ¶ˆæ³¨é‡Š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     auth,authpriv.none;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     cron,daemon.none;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     mail,news.none          -/var/log/messages
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>$ sudo service rsyslog restart</span></span></code></pre></div><ul>
<li>3.1 <!-- raw HTML omitted --><code>Ubuntu</code>å®‰è£…<code>bash</code><!-- raw HTML omitted --></li>
</ul>
<p><a href="#R-image-e5c28887dad385389e810acd635f5834" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Snipaste_2023-03-02_18-13-52.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e5c28887dad385389e810acd635f5834"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Snipaste_2023-03-02_18-13-52.png"></a></p>
<p><a href="#R-image-79ecd95dbafe5cda4c8d5bc7448e08e2" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/imgs/master/System-Architecture-Planning-Diagram/Snipaste_2023-03-02_18-15-53.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-79ecd95dbafe5cda4c8d5bc7448e08e2"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/imgs/master/System-Architecture-Planning-Diagram/Snipaste_2023-03-02_18-15-53.png"></a></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo wget https://ftp.gnu.org/gnu/bash/bash-5.2.tar.gz
</span></span><span style="display:flex;"><span>$ sudo tar zxvf bash-5.2.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/usr/local/src/bash-5.2/bashhist.c<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hdrlen = snprintf (loghdr, sizeof(loghdr), &#34;HISTORY: PID=%d UID=%d User=%s &#34;, getpid(), current_user.uid, current_user.user_name, line);  	# 843 è¡Œå·¦å³æ·»åŠ  User=%s current_user.user_name, line
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;/usr/local/src/bash-5.2/config-top.h<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/* #define SSH_SOURCE_BASHRC */  	# 113 è¡Œå·¦å³å¤åˆ¶ä¸€ä»½ å»æ‰æ³¨é‡Š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#define SSH_SOURCE_BASHRC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/* #define SYSLOG_HISTORY */  	# 128 è¡Œå·¦å³å¤åˆ¶ä¸€ä»½ å»æ‰æ³¨é‡Š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#define SYSLOG_HISTORY
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®ã€ç¼–è¯‘ã€å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ sudo ./configure --prefix<span style="color:#f92672">=</span>/usr/local/bash
</span></span><span style="display:flex;"><span>$ sudo make
</span></span><span style="display:flex;"><span>$ sudo make install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ç”¨æˆ·ç¯å¢ƒæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;/etc/passwd<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">user_name:x:1000:1000:user_name:/home/user_name:/usr/local/bash/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="å®‰è£…é…ç½®linuxç³»ç»Ÿçš„irqå‡è¡¡å·¥å…·irqbalance-">å®‰è£…é…ç½®<code>Linux</code>ç³»ç»Ÿçš„<code>IRQ</code>å‡è¡¡å·¥å…·<code>Irqbalance </code></h3>
<ul>
<li>
<ol>
<li>å®‰è£…é…ç½®</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo apt-get update
</span></span><span style="display:flex;"><span>$ sudo apt-get install irqbalance
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;&gt;/etc/default/irqbalance<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ENABLED=&#34;1&#34;  	# ENABLED=1 è¡¨ç¤ºå¯ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">BALANCE_INTERVAL=1  	# BALANCE_INTERVAL=1 è¡¨ç¤ºæ¯ç§’è¿›è¡Œä¸€æ¬¡ IRQ å‡è¡¡
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo systemctl restart irqbalance.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>$ cat /proc/interrupts</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å…³é—­é€æ˜å¤§é¡µ">å…³é—­é€æ˜å¤§é¡µ</h3>
<ul>
<li>
<ol>
<li>ä¿®æ”¹<code>grub.conf</code>æ–‡ä»¶</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç¡®å®æ˜¯å¦å¼€å¯</span>
</span></span><span style="display:flex;"><span>$ cat /sys/kernel/mm/redhat_transparent_hugepage/enabled
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>always<span style="color:#f92672">]</span> madvise never  	<span style="color:#75715e"># [always] è¡¨ç¤ºå¼€å¯</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ grep HugePage /proc/meminfo
</span></span><span style="display:flex;"><span>AnonHugePages:    <span style="color:#ae81ff">585728</span> kB  	<span style="color:#75715e"># ä¸æ˜¯ 0 å°±ä»£è¡¨å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹grub.confæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ cat &gt;&gt;/etc/grub.conf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kernel /vmlinuz-2.6.32-431.el6.x86_64 ro root=/dev/mapper/vg_linuxbase-lv_root rd_NO_LUKS LANG=en_US.UTF-8 rd_LVM_LV=vg_linuxbase/lv_root rd_NO_MD rd_LVM_LV=vg_linuxbase/lv_swap SYSFONT=latarcyrheb-sun16 crashkernel=auto  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet transparent_hugepage=never  	# åœ¨kernel è¡Œæ–°æ·»å‚æ•°é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡å¯ä¸»æœº</span>
</span></span><span style="display:flex;"><span>$ shutdown -Fr now</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>ä½¿ç”¨è„šæœ¬æ–¹å¼</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> test -f /sys/kernel/mm/transparent_hugepage/enabled; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span> echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> test -f /sys/kernel/mm/transparent_hugepage/defrag; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span> echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="è°ƒèŠ‚cpué¢‘ç‡">è°ƒèŠ‚CPUé¢‘ç‡</h3>
<ul>
<li>
<ol>
<li>ä¸å®‰è£…å·¥å…·æ–¹å¼</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat /proc/cpuinfo | sudo grep MHz
</span></span><span style="display:flex;"><span>$ sudo echo performance | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor &gt;/dev/null</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li>ä½¿ç”¨<code>cpupower</code>å·¥å…·</li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo apt-get install linux-cpupower -y æˆ–è€… apt-get install -y linux-tools-<span style="color:#66d9ef">$(</span>uname -r<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>$ sudo cpupower -c all frequency-set -g performance  	<span style="color:#75715e"># è®¾ç½®æ‰€æœ‰CPUä¸ºæ€§èƒ½æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>$ sudo cpupower -c all frequency-set -g powersave  	<span style="color:#75715e"># è®¾ç½®æ‰€æœ‰CPUä¸ºèŠ‚èƒ½æ¨¡å¼</span>
</span></span><span style="display:flex;"><span>$ sudo cpupower -c all frequency-info  	<span style="color:#75715e"># æŸ¥çœ‹å½“å‰æ‰€æœ‰CPUçš„ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>$ sudo watch -n <span style="color:#ae81ff">1</span> cpupower monitor  	<span style="color:#75715e"># CPUå®æ—¶é¢‘ç‡æŸ¥çœ‹</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="ä¿®æ”¹ç³»ç»Ÿioè°ƒåº¦ç®—æ³•">ä¿®æ”¹ç³»ç»Ÿ<code>I/O</code>è°ƒåº¦ç®—æ³•</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cat /sys/block/sda/queue/scheduler  	<span style="color:#75715e"># sda ç£ç›˜åç§° </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mq-deadline<span style="color:#f92672">]</span> none  	<span style="color:#75715e"># ä»£è¡¨ä½¿ç”¨å¾—æ˜¯ [mq-deadline]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸´æ—¶ä¿®æ”¹ä¸ºï¼šnoop ç®—æ³•</span>
</span></span><span style="display:flex;"><span>$ echo noop &gt;/sys/block/sda/queue/scheduler
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ°¸ä¹…ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>$ cp -p /boot/grub/menu.lst /boot/grub/menu.lst-backup  	<span style="color:#75715e"># æå‰å¤‡ä»½é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo cat &gt;&gt;/boot/grub/menu.lst<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kernel /vmlinuz-2.6.16.60-0.91.1-smp root=/dev/sysvg/root splash=silent splash=off showopts elevator=noop  	# è¡Œæœ€åæ·»åŠ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="system_architecture_planning_diagram">System_Architecture_Planning_Diagram</h1>

<h2 id="system-architecture-planning-diagram"><code>System Architecture Planning Diagram</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœ¨çº¿ååŒç¼–å†™ç³»ç»Ÿ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th><a href="https://github.com/phachon/mm-wiki" rel="external" target="_self"><code>MM-wiki</code></a></th>
<th><a href="https://github.com/requarks/wiki" rel="external" target="_self"><code>WiKi.js</code></a></th>
<th><a href="https://www.atlassian.com/zh/software/confluence" rel="external" target="_self"><code>Confluence</code></a></th>
<th><a href="https://github.com/GitbookIO/gitbook" rel="external" target="_self"><code>GitBook</code>å¤šäººåä½œæ–‡æ¡£</a>ã€<!-- raw HTML omitted --><a href="https://zhuanlan.zhihu.com/p/108276695" rel="external" target="_self"><code>GitBook</code>å®‰è£…éƒ¨ç½²å®æ“æ‰‹å†Œ</a>ã€<!-- raw HTML omitted --><a href="https://cloud.tencent.com/developer/article/1605621" rel="external" target="_self"><code>CentOS7</code>ä¸‹éƒ¨ç½²<code>GitBook</code></a></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.oschina.net/news/204901/mrdoc-0-8-1-released" rel="external" target="_self"><code>MrDoc</code>åœ¨çº¿æ–‡æ¡£ç³»ç»Ÿ</a></td>
<td><a href="https://www.mediawiki.org/wiki/MediaWiki" rel="external" target="_self"><code>MediaWiki</code></a></td>
<td><a href="https://github.com/docsifyjs/docsify/" rel="external" target="_self"><code>Docsify</code></a></td>
<td><a href="https://typecho.org/" rel="external" target="_self"><code>Typecho</code></a></td>
</tr>
<tr>
<td><a href="https://www.dokuwiki.org/dokuwiki" rel="external" target="_self"><code>DokuWiki</code></a></td>
<td><a href="https://worktile.com/kb/p/19579" rel="external" target="_self">å¼€æºå…è´¹çš„<code>Wiki</code>ç³»ç»Ÿ</a></td>
<td><a href="https://swagger.io/" rel="external" target="_self"><code>swagger API</code>æ¥å£æ–‡æ¡£å¼€å‘</a></td>
<td><a href="https://github.com/mindoc-org/mindoc" rel="external" target="_self"><code>MinDoc</code></a></td>
</tr>
<tr>
<td><a href="https://www.notion.so/pricing" rel="external" target="_self"><code>notion</code></a></td>
<td><a href="https://github.com/lanyulei/fiy" rel="external" target="_self"><code>Go CMDB</code></a></td>
<td><a href="https://www.cnblogs.com/Erik_Xu/p/10092028.html" rel="external" target="_self"><code>Kubernetes</code>-è“é²¸<code>CMDB</code></a></td>
<td><a href="https://learnku.com/articles/45958" rel="external" target="_self">åˆ†äº«<code>10</code>ä¸ªæˆ‘å¸¸é€›çš„å›½å¤–æŠ€æœ¯ç¤¾åŒº</a>ã€<a href="https://cloud.tencent.com/developer/news/398171" rel="external" target="_self">11ä¸ªå›½å¤–ITæŠ€æœ¯äº¤æµç½‘ç«™æ±‡æ€»</a></td>
</tr>
<tr>
<td><a href="https://www.onlyoffice.com/download-docs.aspx?from=helpcenter#docs-community" rel="external" target="_self"><code>OnlyOffice</code></a></td>
<td><a href="https://www.libreoffice.org/discover/libreoffice/" rel="external" target="_self"><code>LibreOffice</code></a></td>
<td><a href="https://www.openoffice.org/" rel="external" target="_self"><code>Apache OpenOffice</code></a></td>
<td><a href="https://www.freeoffice.com/zh/" rel="external" target="_self"><code>freeoffice</code></a></td>
</tr>
<tr>
<td><a href="https://ngx.hk/" rel="external" target="_self"><code>Ngx</code></a>ã€<a href="https://www.youtube.com/channel/UCJYkp0cVLaTzk488qnwyPLw" rel="external" target="_self"><code>Youtube</code></a></td>
<td><a href="https://blog.laoda.de/" rel="external" target="_self">æˆ‘ä¸æ˜¯å’•å’•é¸½<code>Youtube</code></a></td>
<td><a href="https://www.youtube.com/@deeplearncloud/playlists" rel="external" target="_self">å°é©¬æŠ€æœ¯</a></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker pull swaggerapi/swagger-editor:v4.9.1
</span></span><span style="display:flex;"><span>$ docker run -d -p 19090:8080 swaggerapi/swagger-editor:v4.9.1</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><a href="https://blog.csdn.net/yanhanhui1/article/details/103134944" rel="external" target="_self">æŠŠ<code>Kali Linux</code>è£…è¿›<code>U</code>ç›˜ä½¿å…¶å¯ä»¥åœ¨<code>UEFI</code>çš„æœºå™¨ä¸Šå¯åŠ¨ä½¿ç”¨</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><!-- raw HTML omitted --><code>CICD Network Architecture</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-4208ec1ed50e5d280e6944f4f4e38fce" class="lightbox-link"><img alt="CICD Network Architecture" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/CICD-Network-Architecture.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4208ec1ed50e5d280e6944f4f4e38fce"><img alt="CICD Network Architecture" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/CICD-Network-Architecture.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted --><code>Client Online Process</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-179186415a97b2e5b8972cd304db0036" class="lightbox-link"><img alt="Client Online Process" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Client-Online-Process.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-179186415a97b2e5b8972cd304db0036"><img alt="Client Online Process" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Client-Online-Process.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted --><code>Initial Architecture Diagram</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-610659a8e4ac0ec2a80dd7b7849dc6b8" class="lightbox-link"><img alt="Initial Architecture Diagram" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Initial-Architecture-Diagram.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-610659a8e4ac0ec2a80dd7b7849dc6b8"><img alt="Initial Architecture Diagram" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Initial-Architecture-Diagram.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted --><code>Jnekins Process</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-e5758460bd5f97ef42dffb8090ca1117" class="lightbox-link"><img alt="Jnekins Process" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Jnekins-Process.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e5758460bd5f97ef42dffb8090ca1117"><img alt="Jnekins Process" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Jnekins-Process.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="7">
<li><!-- raw HTML omitted --><code>Jumpserver Master</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-5e87353774ab1dfba3f7be6352947973" class="lightbox-link"><img alt="Jumpserver Master" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Jumpserver-Master.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5e87353774ab1dfba3f7be6352947973"><img alt="Jumpserver Master" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Jumpserver-Master.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="8">
<li><!-- raw HTML omitted --><code>K8s Online process</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-2cf4b52d5f9de280145c6800a14cdf39" class="lightbox-link"><img alt="K8s Online process" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/K8s-Online-process.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2cf4b52d5f9de280145c6800a14cdf39"><img alt="K8s Online process" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/K8s-Online-process.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="9">
<li><!-- raw HTML omitted --><code>Lua-Games</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-b66860fd06af5afbcc742f0fd19aebe4" class="lightbox-link"><img alt="Lua-Games" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Lua-Games.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b66860fd06af5afbcc742f0fd19aebe4"><img alt="Lua-Games" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Lua-Games.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="10">
<li><!-- raw HTML omitted --><code>Online Process</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-7944310be4374e58077fcad482279b37" class="lightbox-link"><img alt="Online Process" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Online-Process.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7944310be4374e58077fcad482279b37"><img alt="Online Process" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Online-Process.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="11">
<li><!-- raw HTML omitted --><code>Server Code Online process</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-22573e3568b38b96630904d290b507a9" class="lightbox-link"><img alt="Server Code Online process" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Server-Code-Online-process.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-22573e3568b38b96630904d290b507a9"><img alt="Server Code Online process" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Server-Code-Online-process.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="12">
<li><!-- raw HTML omitted --><code>Zabbix Monitor And Alert</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="#R-image-9795a36d079996b6116afa5821ee0c61" class="lightbox-link"><img alt="Zabbix Monitor And Alert" class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Zabbix-Monitor-And-Alert.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9795a36d079996b6116afa5821ee0c61"><img alt="Zabbix Monitor And Alert" class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/Zabbix-Monitor-And-Alert.png"></a></p>
</blockquote>
<ul>
<li>
<ol start="13">
<li>è¿ç»´ä½“ç³»</li>
</ol>
</li>
</ul>
<blockquote>
<p><a href="https://www.unixhot.com/page/ops" rel="external" target="_self">è¿ç»´æ¶æ„å±‚çº§/è¿ç»´è§’åº¦</a></p>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="regular_expression">Regular_Expression</h1>

<h2 id="æ­£åˆ™è¡¨è¾¾å¼">æ­£åˆ™è¡¨è¾¾å¼</h2>
<blockquote>
<ul>
<li><a href="https://www.runoob.com/regexp/regexp-rule.html" rel="external" target="_self">æ­£åˆ™è¡¨è¾¾å¼</a></li>
</ul>
</blockquote>
<hr>
<h3 id="è¿ç®—ç¬¦ä¼˜å…ˆçº§">è¿ç®—ç¬¦ä¼˜å…ˆçº§</h3>
<blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">è¿ç®—ç¬¦</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>\</code></td>
<td style="text-align:left">è½¬ä¹‰ç¬¦</td>
</tr>
<tr>
<td style="text-align:left"><code>()</code>ï¼Œ<code>(?:)</code>ï¼Œ<code>(?=)</code>ï¼Œ<code>[]</code></td>
<td style="text-align:left">åœ†æ‹¬å·å’Œæ–¹æ‹¬å·</td>
</tr>
<tr>
<td style="text-align:left"><code>*</code>ï¼Œ<code>+</code>ï¼Œ<code>?</code>ï¼Œ<code>{n}</code>ï¼Œ<code>{n,}</code>ï¼Œ<code>{n,m}</code></td>
<td style="text-align:left">é™å®šç¬¦</td>
</tr>
<tr>
<td style="text-align:left"><code>^</code>ï¼Œ<code>$</code>ï¼Œ<code>\</code>ä»»ä½•å…ƒå­—ç¬¦ã€ä»»ä½•å­—ç¬¦</td>
<td style="text-align:left">å®šä½ç‚¹å’Œåºåˆ—ï¼ˆå³ï¼šä½ç½®å’Œé¡ºåºï¼‰</td>
</tr>
<tr>
<td style="text-align:left"><code>|</code></td>
<td style="text-align:left">æ›¿æ¢ï¼Œ&ldquo;æˆ–&quot;æ“ä½œ å­—ç¬¦å…·æœ‰é«˜äºæ›¿æ¢è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ï¼Œä½¿å¾—<code>m|food</code>åŒ¹é…<code>m</code>æˆ–<code>food</code>ã€‚è‹¥è¦åŒ¹é…<code>mood</code>æˆ–<code>food</code>ï¼Œè¯·ä½¿ç”¨æ‹¬å·åˆ›å»ºå­è¡¨è¾¾å¼ï¼Œä»è€Œäº§ç”Ÿ<code>(m|f)ood</code>ã€‚</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="éæ‰“å°å­—ç¬¦">éæ‰“å°å­—ç¬¦</h3>
<blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">å­—ç¬¦</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>\cx</code></td>
<td style="text-align:left">åŒ¹é…ç”±<code>x</code>æŒ‡æ˜çš„æ§åˆ¶å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ <code>\cM</code>åŒ¹é…ä¸€ä¸ª<code>Control-M</code>æˆ–<!-- raw HTML omitted -->å›è½¦ç¬¦<!-- raw HTML omitted -->ã€‚<code>x</code>çš„å€¼å¿…é¡»ä¸º<code>A-Z</code>æˆ–<code>a-z</code>ä¹‹ä¸€ã€‚å¦åˆ™ï¼Œå°†<code>c </code>ä¸ºä¸€ä¸ªåŸä¹‰çš„<code>c</code>å­—ç¬¦ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\f</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦ã€‚ç­‰ä»·äº<code>\x0c</code>å’Œ<code>\cL</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\n</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ç­‰ä»·äº<code>\x0a</code>å’Œ<code>\cJ</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\r</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ã€‚ç­‰ä»·äº<code>\x0d</code>å’Œ<code>\cM</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\s</code></td>
<td style="text-align:left">åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äº<code>[ \f\n\r\t\v]</code>ã€‚æ³¨æ„<code>Unicode</code>æ­£åˆ™è¡¨è¾¾å¼ä¼šåŒ¹é…å…¨è§’ç©ºæ ¼ç¬¦ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\S</code></td>
<td style="text-align:left">åŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ã€‚ç­‰ä»·äº <code>[^ \f\n\r\t\v]</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\t</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº<code>\x09</code>å’Œ<code>\cI</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\v</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº<code>\x0b</code>å’Œ<code>\cK</code>ã€‚</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="ç‰¹æ®Šå­—ç¬¦">ç‰¹æ®Šå­—ç¬¦</h3>
<blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">ç‰¹åˆ«å­—ç¬¦</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>$</code></td>
<td style="text-align:left">åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“å°¾ä½ç½®ã€‚å¦‚æœè®¾ç½®äº†<code>RegExp</code>å¯¹è±¡çš„<code>Multiline</code>å±æ€§ï¼Œåˆ™<code>$</code>ä¹ŸåŒ¹é…<code>\n</code>æˆ–<code>\r</code>ã€‚è¦åŒ¹é…<code>$</code>å­—ç¬¦æœ¬èº«ï¼Œè¯·ä½¿ç”¨<code>\$</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>()</code></td>
<td style="text-align:left">æ ‡è®°ä¸€ä¸ªå­è¡¨è¾¾å¼çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚å­è¡¨è¾¾å¼å¯ä»¥è·å–ä¾›ä»¥åä½¿ç”¨ã€‚è¦åŒ¹é…è¿™äº›å­—ç¬¦ï¼Œè¯·ä½¿ç”¨<code>\(</code>å’Œ<code>\)</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>*</code></td>
<td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚è¦åŒ¹é…<code>*</code>å­—ç¬¦ï¼Œè¯·ä½¿ç”¨<code>\*</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>+</code></td>
<td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚è¦åŒ¹é…<code>+</code>å­—ç¬¦ï¼Œè¯·ä½¿ç”¨<code>\+</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>.</code></td>
<td style="text-align:left">åŒ¹é…é™¤æ¢è¡Œç¬¦<code>\n</code>ä¹‹å¤–çš„ä»»ä½•å•å­—ç¬¦ã€‚è¦åŒ¹é…<code>.</code>ï¼Œè¯·ä½¿ç”¨<code>\.</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>[</code></td>
<td style="text-align:left">æ ‡è®°ä¸€ä¸ªä¸­æ‹¬å·è¡¨è¾¾å¼çš„å¼€å§‹ã€‚è¦åŒ¹é…<code>[</code>ï¼Œè¯·ä½¿ç”¨<code>\[</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>?</code></td>
<td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼Œæˆ–æŒ‡æ˜ä¸€ä¸ªéè´ªå©ªé™å®šç¬¦ã€‚è¦åŒ¹é…<code>?</code>å­—ç¬¦ï¼Œè¯·ä½¿ç”¨<code>\?</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\</code></td>
<td style="text-align:left">å°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºæˆ–ç‰¹æ®Šå­—ç¬¦ã€æˆ–åŸä¹‰å­—ç¬¦ã€æˆ–å‘åå¼•ç”¨ã€æˆ–å…«è¿›åˆ¶è½¬ä¹‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œ <code>n</code>åŒ¹é…å­—ç¬¦<code>n</code>ã€‚<code>\n</code>åŒ¹é…æ¢è¡Œç¬¦ã€‚åºåˆ—<code>\\</code>åŒ¹é…<code>\</code>ï¼Œè€Œ<code>\(</code>åˆ™åŒ¹é…<code>(</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>^</code></td>
<td style="text-align:left">åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ï¼Œé™¤éåœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œå½“è¯¥ç¬¦å·åœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ—¶ï¼Œè¡¨ç¤ºä¸æ¥å—è¯¥æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­çš„å­—ç¬¦é›†åˆã€‚è¦åŒ¹é…<code>^</code>å­—ç¬¦æœ¬èº«ï¼Œè¯·ä½¿ç”¨<code>\^</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>{</code></td>
<td style="text-align:left">æ ‡è®°é™å®šç¬¦è¡¨è¾¾å¼çš„å¼€å§‹ã€‚è¦åŒ¹é…<code>{</code>ï¼Œè¯·ä½¿ç”¨<code>\{</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left">`</td>
<td style="text-align:left">`</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="é™å®šç¬¦">é™å®šç¬¦</h3>
<blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">å­—ç¬¦</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>*</code></td>
<td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚<code>zo\</code>èƒ½åŒ¹é…<code>z</code>ä»¥åŠ<code>zoo</code>ã€‚<code>*</code>ç­‰ä»·äº<code>{0,}</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>+</code></td>
<td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>zo+</code>èƒ½åŒ¹é…<code>zo</code>ä»¥åŠ<code>zoo</code>ï¼Œä½†ä¸èƒ½åŒ¹é…<code>z</code>ã€‚<code>+</code>ç­‰ä»·äº<code>{1,}</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>?</code></td>
<td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>do(es)?</code>å¯ä»¥åŒ¹é…<code>do</code>ã€ <code>does</code>ã€<code>doxy</code>ä¸­çš„<code>do</code>å’Œ<code>does</code>ã€‚<code>?</code> ç­‰ä»·äº<code>{0,1}</code></td>
</tr>
<tr>
<td style="text-align:left"><code>{n}</code></td>
<td style="text-align:left"><code>n</code>æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„<code>n</code>æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>o{2}</code>ä¸èƒ½åŒ¹é…<code>Bob</code>ä¸­çš„<code>o</code>ï¼Œä½†æ˜¯èƒ½åŒ¹é…<code>food</code>ä¸­çš„ä¸¤ä¸ª<code>o</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>{n,}</code></td>
<td style="text-align:left"><code>n</code>æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é…<code>n</code>æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>o{2,}</code>ä¸èƒ½åŒ¹é…<code>Bob</code>ä¸­çš„<code>o</code>ï¼Œä½†èƒ½åŒ¹é…<code>foooood</code>ä¸­çš„æ‰€æœ‰<code>o</code>ã€‚<code>o{1,}</code>ç­‰ä»·äº<code>o+</code>ã€‚<code>o{0,}</code>åˆ™ç­‰ä»·äº<code>o\*</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>{n,m}</code></td>
<td style="text-align:left"><code>m</code>å’Œ<code>n</code>å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œå…¶ä¸­<code>n &lt;= m</code>ã€‚æœ€å°‘åŒ¹é…<code>n</code>æ¬¡ä¸”æœ€å¤šåŒ¹é…<code>m</code>æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>o{1,3}</code>å°†åŒ¹é…<code>fooooood</code>ä¸­çš„å‰ä¸‰ä¸ª <code>o</code>ã€‚<code>o{0,1}</code>ç­‰ä»·äº<code>o?</code>ã€‚è¯·æ³¨æ„åœ¨é€—å·å’Œä¸¤ä¸ªæ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="å®šä½ç¬¦">å®šä½ç¬¦</h3>
<blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">å­—ç¬¦</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>^</code></td>
<td style="text-align:left">åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²å¼€å§‹çš„ä½ç½®ã€‚å¦‚æœè®¾ç½®äº†<code>RegExp</code>å¯¹è±¡çš„<code>Multiline</code>å±æ€§ï¼Œ<code>^</code>è¿˜ä¼šä¸<code>\n</code>æˆ–<code>\r</code>ä¹‹åçš„ä½ç½®åŒ¹é…ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>$</code></td>
<td style="text-align:left">åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²ç»“å°¾çš„ä½ç½®ã€‚å¦‚æœè®¾ç½®äº†<code>RegExp</code>å¯¹è±¡çš„<code>Multiline</code>å±æ€§ï¼Œ<code>$</code>è¿˜ä¼šä¸<code>\n</code>æˆ–<code>\r</code>ä¹‹å‰çš„ä½ç½®åŒ¹é…ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\b</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªå•è¯è¾¹ç•Œï¼Œå³å­—ä¸ç©ºæ ¼é—´çš„ä½ç½®ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\B</code></td>
<td style="text-align:left">éå•è¯è¾¹ç•ŒåŒ¹é…ã€‚</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="ä¿®é¥°ç¬¦">ä¿®é¥°ç¬¦</h3>
<blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">ä¿®é¥°ç¬¦</th>
<th style="text-align:left">å«ä¹‰</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>i</code></td>
<td style="text-align:left"><code>ignore</code> - ä¸åŒºåˆ†å¤§å°å†™</td>
<td style="text-align:left">å°†åŒ¹é…è®¾ç½®ä¸ºä¸åŒºåˆ†å¤§å°å†™ï¼Œæœç´¢æ—¶ä¸åŒºåˆ†å¤§å°å†™: <code>A</code>å’Œ<code>a</code>æ²¡æœ‰åŒºåˆ«ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>g</code></td>
<td style="text-align:left"><code>global</code> - å…¨å±€åŒ¹é…</td>
<td style="text-align:left">æŸ¥æ‰¾æ‰€æœ‰çš„åŒ¹é…é¡¹ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>m</code></td>
<td style="text-align:left"><code>multi line</code> - å¤šè¡ŒåŒ¹é…</td>
<td style="text-align:left">ä½¿è¾¹ç•Œå­—ç¬¦<code>^</code>å’Œ<code>$</code>åŒ¹é…æ¯ä¸€è¡Œçš„å¼€å¤´å’Œç»“å°¾ï¼Œè®°ä½æ˜¯å¤šè¡Œï¼Œè€Œä¸æ˜¯æ•´ä¸ªå­—ç¬¦ä¸²çš„å¼€å¤´å’Œç»“å°¾ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>s</code></td>
<td style="text-align:left">ç‰¹æ®Šå­—ç¬¦åœ†ç‚¹ <strong>.</strong> ä¸­åŒ…å«æ¢è¡Œç¬¦ <code>\n</code></td>
<td style="text-align:left">é»˜è®¤æƒ…å†µä¸‹çš„åœ†ç‚¹ <strong>.</strong> æ˜¯åŒ¹é…é™¤æ¢è¡Œç¬¦<code>\n</code>ä¹‹å¤–çš„ä»»ä½•å­—ç¬¦ï¼ŒåŠ ä¸Š<code>s</code>ä¿®é¥°ç¬¦ä¹‹å, <strong>.</strong> ä¸­åŒ…å«æ¢è¡Œç¬¦<code>\n</code>ã€‚</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="å…ƒå­—ç¬¦">å…ƒå­—ç¬¦</h3>
<blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">å­—ç¬¦</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>\</code></td>
<td style="text-align:left">å°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ã€æˆ–ä¸€ä¸ªåŸä¹‰å­—ç¬¦ã€æˆ–ä¸€ä¸ª å‘åå¼•ç”¨ã€æˆ–ä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œ<code>n</code>åŒ¹é…å­—ç¬¦<code>n</code>ã€‚<code>\n</code>åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚åºåˆ—<code>\\</code>åŒ¹é… &ldquo;&quot; è€Œ<code>\(</code>åˆ™åŒ¹é…<code>(</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>^</code></td>
<td style="text-align:left">åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ã€‚å¦‚æœè®¾ç½®äº†<code>RegExp</code>å¯¹è±¡çš„<code>Multiline</code>å±æ€§ï¼Œ<code>^</code>ä¹ŸåŒ¹é…<code>\n</code>æˆ–<code>\r</code>ä¹‹åçš„ä½ç½®ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>$</code></td>
<td style="text-align:left">åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“æŸä½ç½®ã€‚å¦‚æœè®¾ç½®äº†<code>RegExp</code>å¯¹è±¡çš„<code>Multiline</code>å±æ€§ï¼Œ<code>$</code>ä¹ŸåŒ¹é…<code>\n</code>æˆ–<code>\r</code>ä¹‹å‰çš„ä½ç½®ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>*</code></td>
<td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>zo*</code>èƒ½åŒ¹é…<code>z</code>ä»¥åŠ<code>zoo</code>ã€‚<code>*</code>ç­‰ä»·äº<code>{0,}</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>+</code></td>
<td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>zo+</code>èƒ½åŒ¹é…<code>zo</code>ä»¥åŠ<code>zoo</code>ï¼Œä½†ä¸èƒ½åŒ¹é…<code>z</code>ã€‚<code>+</code>ç­‰ä»·äº<code>{1,}</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>?</code></td>
<td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>do(es)?</code>å¯ä»¥åŒ¹é…<code>do</code>æˆ–<code>does</code>ã€‚? ç­‰ä»·äº<code>{0,1}</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>{n}</code></td>
<td style="text-align:left"><code>n</code>æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„<code>n</code>æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>o{2}</code>ä¸èƒ½åŒ¹é…<code>Bob</code>ä¸­çš„<code>o</code>ï¼Œä½†æ˜¯èƒ½åŒ¹é…<code>food</code>ä¸­çš„ä¸¤ä¸ª<code>o</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>{n,}</code></td>
<td style="text-align:left"><code>n</code>æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é…<code>n</code>æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>o{2,}</code>ä¸èƒ½åŒ¹é…<code>Bob</code>ä¸­çš„<code>o</code>ï¼Œä½†èƒ½åŒ¹é…<code>foooood</code>ä¸­çš„æ‰€æœ‰<code>o</code>ã€‚<code>o{1,}</code>ç­‰ä»·äº<code>o+</code>ã€‚<code>o{0,}</code>åˆ™ç­‰ä»·äº<code>o*</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>{n,m}</code></td>
<td style="text-align:left"><code>m</code>å’Œ<code>n</code>å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œå…¶ä¸­<code>n &lt;= m</code>ã€‚æœ€å°‘åŒ¹é…<code>n</code>æ¬¡ä¸”æœ€å¤šåŒ¹é…<code>m</code>æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>o{1,3}</code>å°†åŒ¹é…<code>fooooood</code>ä¸­çš„å‰ä¸‰ä¸ª<code>o</code>ã€‚<code>o{0,1}</code>ç­‰ä»·äº<code>o?</code>ã€‚è¯·æ³¨æ„åœ¨é€—å·å’Œä¸¤ä¸ªæ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>?</code></td>
<td style="text-align:left">å½“è¯¥å­—ç¬¦ç´§è·Ÿåœ¨ä»»ä½•ä¸€ä¸ªå…¶ä»–é™åˆ¶ç¬¦<code>(*, +, ?, {n}, {n,}, {n,m})</code>åé¢æ—¶ï¼ŒåŒ¹é…æ¨¡å¼æ˜¯éè´ªå©ªçš„ã€‚éè´ªå©ªæ¨¡å¼å°½å¯èƒ½å°‘çš„åŒ¹é…æ‰€æœç´¢çš„å­—ç¬¦ä¸²ï¼Œè€Œé»˜è®¤çš„è´ªå©ªæ¨¡å¼åˆ™å°½å¯èƒ½å¤šçš„åŒ¹é…æ‰€æœç´¢çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå­—ç¬¦ä¸² <code>oooo</code>ï¼Œ<code>o+?</code>å°†åŒ¹é…å•ä¸ª<code>o</code>ï¼Œè€Œ<code>o+</code>å°†åŒ¹é…æ‰€æœ‰<code>o</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>.</code></td>
<td style="text-align:left">åŒ¹é…é™¤æ¢è¡Œç¬¦<code>(\nã€\r)</code>ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚è¦åŒ¹é…åŒ…æ‹¬<code>\n</code>åœ¨å†…çš„ä»»ä½•å­—ç¬¦ï¼Œè¯·ä½¿ç”¨åƒ`(.</td>
</tr>
<tr>
<td style="text-align:left"><code>(pattern)</code></td>
<td style="text-align:left">åŒ¹é…<code>pattern</code>å¹¶è·å–è¿™ä¸€åŒ¹é…ã€‚æ‰€è·å–çš„åŒ¹é…å¯ä»¥ä»äº§ç”Ÿçš„<code>Matches</code>é›†åˆå¾—åˆ°ï¼Œåœ¨<code>VBScript</code>ä¸­ä½¿ç”¨ <code>SubMatches</code>é›†åˆï¼Œåœ¨<code>JScript</code>ä¸­åˆ™ä½¿ç”¨<code>$0â€¦$9</code>å±æ€§ã€‚è¦åŒ¹é…åœ†æ‹¬å·å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ <code>\(</code>æˆ–<code>\)</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>(?:pattern)</code></td>
<td style="text-align:left">åŒ¹é…<code>pattern</code>ä½†ä¸è·å–åŒ¹é…ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯ä¸€ä¸ªéè·å–åŒ¹é…ï¼Œä¸è¿›è¡Œå­˜å‚¨ä¾›ä»¥åä½¿ç”¨ã€‚è¿™åœ¨ä½¿ç”¨ &ldquo;æˆ–&rdquo; å­—ç¬¦`(</td>
</tr>
<tr>
<td style="text-align:left"><code>(?=pattern)</code></td>
<td style="text-align:left">æ­£å‘è‚¯å®šé¢„æŸ¥<code>look ahead positive assert</code>ï¼Œåœ¨ä»»ä½•åŒ¹é…<code>pattern</code>çš„å­—ç¬¦ä¸²å¼€å§‹å¤„åŒ¹é…æŸ¥æ‰¾å­—ç¬¦ä¸²ã€‚è¿™æ˜¯ä¸€ä¸ªéè·å–åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥åŒ¹é…ä¸éœ€è¦è·å–ä¾›ä»¥åä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œ`Windows(?=95</td>
</tr>
<tr>
<td style="text-align:left"><code>(?!pattern)</code></td>
<td style="text-align:left">æ­£å‘å¦å®šé¢„æŸ¥<code>negative assert</code>ï¼Œåœ¨ä»»ä½•ä¸åŒ¹é…<code>pattern</code>çš„å­—ç¬¦ä¸²å¼€å§‹å¤„åŒ¹é…æŸ¥æ‰¾å­—ç¬¦ä¸²ã€‚è¿™æ˜¯ä¸€ä¸ªéè·å–åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥åŒ¹é…ä¸éœ€è¦è·å–ä¾›ä»¥åä½¿ç”¨ã€‚ä¾‹å¦‚`Windows(?!95</td>
</tr>
<tr>
<td style="text-align:left"><code>(?&lt;=pattern)</code></td>
<td style="text-align:left">åå‘<code>look behind</code>è‚¯å®šé¢„æŸ¥ï¼Œä¸æ­£å‘è‚¯å®šé¢„æŸ¥ç±»ä¼¼ï¼Œåªæ˜¯æ–¹å‘ç›¸åã€‚ä¾‹å¦‚ï¼Œ`(?&lt;=95</td>
</tr>
<tr>
<td style="text-align:left"><code>(?&lt;!pattern)</code></td>
<td style="text-align:left">åå‘å¦å®šé¢„æŸ¥ï¼Œä¸æ­£å‘å¦å®šé¢„æŸ¥ç±»ä¼¼ï¼Œåªæ˜¯æ–¹å‘ç›¸åã€‚ä¾‹å¦‚`(?&lt;!95</td>
</tr>
<tr>
<td style="text-align:left">`x</td>
<td style="text-align:left">y`</td>
</tr>
<tr>
<td style="text-align:left"><code>[xyz]</code></td>
<td style="text-align:left">å­—ç¬¦é›†åˆã€‚åŒ¹é…æ‰€åŒ…å«çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ<code>[abc]</code>å¯ä»¥åŒ¹é…<code>plain</code>ä¸­çš„<code>a</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>[^xyz]</code></td>
<td style="text-align:left">è´Ÿå€¼å­—ç¬¦é›†åˆã€‚åŒ¹é…æœªåŒ…å«çš„ä»»æ„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ <code>[^abc]</code>å¯ä»¥åŒ¹é…<code>plain</code>ä¸­çš„<code>p</code>ã€<code>l</code>ã€<code>i</code>ã€<code>n</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>[a-z]</code></td>
<td style="text-align:left">å­—ç¬¦èŒƒå›´ã€‚åŒ¹é…æŒ‡å®šèŒƒå›´å†…çš„ä»»æ„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ<code>[a-z]</code>å¯ä»¥åŒ¹é…<code>a</code>åˆ°<code>z</code>èŒƒå›´å†…çš„ä»»æ„å°å†™å­—æ¯å­—ç¬¦ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>[^a-z]</code></td>
<td style="text-align:left">è´Ÿå€¼å­—ç¬¦èŒƒå›´ã€‚åŒ¹é…ä»»ä½•ä¸åœ¨æŒ‡å®šèŒƒå›´å†…çš„ä»»æ„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ<code>[^a-z]</code>å¯ä»¥åŒ¹é…ä»»ä½•ä¸åœ¨<code>a</code>åˆ°<code>z</code>èŒƒå›´å†…çš„ä»»æ„å­—ç¬¦ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\b</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªå•è¯è¾¹ç•Œï¼Œä¹Ÿå°±æ˜¯æŒ‡å•è¯å’Œç©ºæ ¼é—´çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œ <code>er\b</code>å¯ä»¥åŒ¹é…<code>never</code>ä¸­çš„<code>er</code>ï¼Œä½†ä¸èƒ½åŒ¹é… <code>verb</code>ä¸­çš„<code>er</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\B</code></td>
<td style="text-align:left">åŒ¹é…éå•è¯è¾¹ç•Œã€‚<code>er\B</code>èƒ½åŒ¹é…<code>verb</code>ä¸­çš„<code>er</code>ï¼Œä½†ä¸èƒ½åŒ¹é…<code>never</code>ä¸­çš„<code>er</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\cx</code></td>
<td style="text-align:left">åŒ¹é…ç”±<code>x</code>æŒ‡æ˜çš„æ§åˆ¶å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ <code>\cM</code>åŒ¹é…ä¸€ä¸ª<code>Control-M</code>æˆ–å›è½¦ç¬¦ã€‚<code>x</code>çš„å€¼å¿…é¡»ä¸º<code>A-Z</code>æˆ–<code>a-z</code>ä¹‹ä¸€ã€‚å¦åˆ™ï¼Œå°†<code>c</code>è§†ä¸ºä¸€ä¸ªåŸä¹‰çš„<code>c</code>å­—ç¬¦ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\d</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äº<code>[0-9]</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\D</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªéæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äº <code>[^0-9]</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\f</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦ã€‚ç­‰ä»·äº<code>\x0c</code>å’Œ<code>\cL</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\n</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ç­‰ä»·äº<code>\x0a</code>å’Œ<code>\cJ</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\r</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ã€‚ç­‰ä»·äº<code>\x0d</code>å’Œ<code>\cM</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\s</code></td>
<td style="text-align:left">åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äº<code>[ \f\n\r\t\v]</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\S</code></td>
<td style="text-align:left">åŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ã€‚ç­‰ä»·äº <code>[^ \f\n\r\t\v]</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\t</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº<code>\x09</code>å’Œ<code>\cI</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\v</code></td>
<td style="text-align:left">åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº<code>\x0b</code>å’Œ<code>\cK</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\w</code></td>
<td style="text-align:left">åŒ¹é…å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€‚ç­‰ä»·äº<code>[A-Za-z0-9_]</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\W</code></td>
<td style="text-align:left">åŒ¹é…éå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€‚ç­‰ä»·äº<code>[^A-Za-z0-9_]</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\xn</code></td>
<td style="text-align:left">åŒ¹é…<code>n</code>ï¼Œå…¶ä¸­<code>n</code>ä¸ºåå…­è¿›åˆ¶è½¬ä¹‰å€¼ã€‚åå…­è¿›åˆ¶è½¬ä¹‰å€¼å¿…é¡»ä¸ºç¡®å®šçš„ä¸¤ä¸ªæ•°å­—é•¿ã€‚ä¾‹å¦‚ï¼Œ<code>\x41</code>åŒ¹é… &ldquo;A&rdquo;ã€‚<code>\x041</code>åˆ™ç­‰ä»·äº<code>\x04</code>&amp;<code>1</code>ã€‚æ­£åˆ™è¡¨è¾¾å¼ä¸­å¯ä»¥ä½¿ç”¨ ASCII ç¼–ç ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\num</code></td>
<td style="text-align:left">åŒ¹é…<code>num</code>ï¼Œå…¶ä¸­<code>num</code>æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚å¯¹æ‰€è·å–çš„åŒ¹é…çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œ<code>(.)\1</code>åŒ¹é…ä¸¤ä¸ªè¿ç»­çš„ç›¸åŒå­—ç¬¦ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\n</code></td>
<td style="text-align:left">æ ‡è¯†ä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰å€¼æˆ–ä¸€ä¸ªå‘åå¼•ç”¨ã€‚å¦‚æœ<code>\n</code>ä¹‹å‰è‡³å°‘<code>n</code>ä¸ªè·å–çš„å­è¡¨è¾¾å¼ï¼Œåˆ™<code>n</code>ä¸ºå‘åå¼•ç”¨ã€‚å¦åˆ™ï¼Œå¦‚æœ<code>n</code>ä¸ºå…«è¿›åˆ¶æ•°å­—<code>(0-7)</code>ï¼Œåˆ™<code>n</code>ä¸ºä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰å€¼ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\nm</code></td>
<td style="text-align:left">æ ‡è¯†ä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰å€¼æˆ–ä¸€ä¸ªå‘åå¼•ç”¨ã€‚å¦‚æœ<code>\nm</code>ä¹‹å‰è‡³å°‘æœ‰<code>nm</code>ä¸ªè·å¾—å­è¡¨è¾¾å¼ï¼Œåˆ™<code>nm</code>ä¸ºå‘åå¼•ç”¨ã€‚å¦‚æœ<code>\nm</code>ä¹‹å‰è‡³å°‘æœ‰<code>n</code>ä¸ªè·å–ï¼Œåˆ™<code>n</code>ä¸ºä¸€ä¸ªåè·Ÿæ–‡å­—<code>m</code>çš„å‘åå¼•ç”¨ã€‚å¦‚æœå‰é¢çš„æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œè‹¥<code>n</code>å’Œ<code>m</code>å‡ä¸ºå…«è¿›åˆ¶æ•°å­—<code>(0-7)</code>ï¼Œåˆ™<code>\nm</code>å°†åŒ¹é…å…«è¿›åˆ¶è½¬ä¹‰å€¼<code>nm</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\nml</code></td>
<td style="text-align:left">å¦‚æœ<code>n</code>ä¸ºå…«è¿›åˆ¶æ•°å­—<code>(0-3)</code>ï¼Œä¸”<code>m</code>å’Œ<code>l</code>å‡ä¸ºå…«è¿›åˆ¶æ•°å­—<code>(0-7)</code>ï¼Œåˆ™åŒ¹é…å…«è¿›åˆ¶è½¬ä¹‰å€¼<code>nml</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>\un</code></td>
<td style="text-align:left">åŒ¹é…<code>n</code>ï¼Œå…¶ä¸­<code>n</code>æ˜¯ä¸€ä¸ªç”¨å››ä¸ªåå…­è¿›åˆ¶æ•°å­—è¡¨ç¤ºçš„<code>Unicode</code>å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ<code>\u00A9</code>åŒ¹é…ç‰ˆæƒç¬¦å·<code>(?)</code>ã€‚</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="linux_document">Linux_Document</h1>

<h2 id="å·¥å…·è½¯ä»¶">å·¥å…·ã€è½¯ä»¶</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/kingToolbox/WindTerm" rel="external" target="_self"><code>WindTerm</code></a></td>
<td>é€‚ç”¨äº<code>DevOps</code>çš„æ›´å¿«ã€æ›´å¥½çš„<code>SSH/Telnet/Serial/Shell/Sftp</code>å®¢æˆ·ç«¯</td>
</tr>
<tr>
<td><a href="https://www.hostbuf.com/t/988.html" rel="external" target="_self"><code>FinalShell</code></a></td>
<td><code>FinalShell</code>æ˜¯ä¸€ä½“åŒ–çš„çš„æœåŠ¡å™¨,ç½‘ç»œç®¡ç†è½¯ä»¶,ä¸ä»…æ˜¯sshå®¢æˆ·ç«¯,è¿˜æ˜¯åŠŸèƒ½å¼ºå¤§çš„å¼€å‘,è¿ç»´å·¥å…·,å……åˆ†æ»¡è¶³å¼€å‘,è¿ç»´éœ€æ±‚</td>
</tr>
<tr>
<td><a href="https://mobaxterm.mobatek.net/" rel="external" target="_self"><code>MobaXterm</code></a></td>
<td>å¸¦æœ‰<code>X11</code>æœåŠ¡å™¨ã€é€‰é¡¹å¡å¼<code>SSH</code>å®¢æˆ·ç«¯ã€ç½‘ç»œå·¥å…·ç­‰çš„å¢å¼ºå‹<code>Windows</code>ç»ˆç«¯</td>
</tr>
<tr>
<td><a href="https://termius.com/pricing" rel="external" target="_self"><code>Termius</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://hyper.is/#installation" rel="external" target="_self"><code>Hyper</code></a></td>
<td><code>Hyper</code>æ˜¯ä¸€ä¸ªåŸºäº<code>Electron</code>çš„ç»ˆç«¯ï¼ŒåŸºäº<code>HTML/CSS/JS</code>æ„å»ºï¼Œå®Œå…¨å¯æ‰©å±•ï¼Œä»å‘½ä»¤è¡Œå®‰è£…ä¸»é¢˜å’Œæ’ä»¶ã€‚<code>hyper i hyper-rose-pine</code>ã€<code>hyper-rose-pine installed successfully!</code></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="ç¤¾åŒºå®˜ç½‘æ–‡æ¡£">ç¤¾åŒºã€å®˜ç½‘æ–‡æ¡£</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.truenas.com/docs/core/gettingstarted/install/" rel="external" target="_self"><code>TrueNAS</code></a></td>
<td>å­˜å‚¨</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="åšå®¢">åšå®¢</h2>
<blockquote>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="linux_conmmon_commands">Linux_Conmmon_Commands</h1>

<h2 id="linuxå¸¸ç”¨å‘½ä»¤æ€»ç»“"><code>Linux</code>å¸¸ç”¨å‘½ä»¤æ€»ç»“</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç”Ÿæˆå¯†ç <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://rockylinux.org/" rel="external" target="_self"><code>Rocky Linux</code></a></td>
<td><code>Centos</code>ç³»ç»Ÿçš„æ›¿ä»£å“</td>
</tr>
<tr>
<td><a href="https://www.debian.org/releases/stable/" rel="external" target="_self"><code>Debian Stable</code></a></td>
<td><code>Debian</code>ç³»ç»Ÿé•œåƒ</td>
</tr>
<tr>
<td><a href="https://www.alpinelinux.org/" rel="external" target="_self"><code>Alpine Linux</code></a></td>
<td><code>Linux</code>é«˜å±±ç³»ç»Ÿé•œåƒ</td>
</tr>
<tr>
<td><a href="https://wangchujiang.com/linux-command/" rel="external" target="_self"><code>Linux</code></a></td>
<td><code>Linux</code>å‘½ä»¤æœç´¢</td>
</tr>
<tr>
<td><a href="https://www.linuxcool.com/" rel="external" target="_self"><code>Linux</code>å‘½ä»¤å¤§å…¨(æ‰‹å†Œ)</a></td>
<td><code>Linux</code>å‘½ä»¤å¤§å…¨(æ‰‹å†Œ)</td>
</tr>
<tr>
<td><a href="https://www.runoob.com/linux/linux-command-manual.html" rel="external" target="_self">èœé¸Ÿ<code>Linux</code>å‘½ä»¤å¤§å…¨</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://ftp.isc.org/isc/bind9/" rel="external" target="_self"><code>Dig</code>å‘½ä»¤</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->å¦‚æœå¤åˆ¶å¯†é’¥åˆ°å®¢æˆ·ç«¯åä¸ç”Ÿæ•ˆï¼Œ ä¼˜å…ˆæ’æŸ¥å®¿ä¸»å®¶ç›®å½•æƒé™<!-- raw HTML omitted --> <code>/home/user</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl rand -base64 <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>$ gpg --gen-random --armor <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">14</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ gzip -d     <span style="color:#75715e"># è§£å‹ç¼©  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ kill -9 <span style="color:#e6db74">`</span>ps -ef |grep xxx|awk <span style="color:#e6db74">&#39;{print $2}&#39;</span> <span style="color:#e6db74">`</span>  	<span style="color:#75715e"># æ€æ‰æœåŠ¡è¿›ç¨‹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è°·æ­Œäº‘æ™®é€šç”¨æˆ·è¿œç¨‹ç™»å½•</span>
</span></span><span style="display:flex;"><span>$ chown -R user:user /home/user
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">600</span> authorized_keys  	<span style="color:#75715e"># æ¬¡æ–‡ä»¶ä¸€å®šå±ä¸»è¯»å†™ï¼Œå…¶ä»–ä¸º0 </span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="yumå‘½ä»¤"><code>yum</code>å‘½ä»¤</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum install -y nodejs  	<span style="color:#75715e"># å®‰è£…node</span>
</span></span><span style="display:flex;"><span>$ yum install -y chrony  	<span style="color:#75715e"># è®¾ç½®æ—¶é—´æœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ yum install -y psmisc  	<span style="color:#75715e"># å®‰è£…killall</span>
</span></span><span style="display:flex;"><span>$ yum install -y epel-release  	<span style="color:#75715e"># å®‰è£…epelæº</span>
</span></span><span style="display:flex;"><span>$ yum whatprovides ifconfig  	<span style="color:#75715e"># æŸ¥æ‰¾æŸä¸ªå‘½ä»¤å±äºé‚£ä¸ªrpmåŒ…  </span>
</span></span><span style="display:flex;"><span>$ yum -y groupinstall <span style="color:#e6db74">&#34;GNOME Desktop&#34;</span>  	<span style="color:#75715e"># Linuxå‘½ä»¤è¡Œå®‰è£…å›¾å½¢åŒ–</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‡çº§gccåˆ°6.3ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ yum -y install centos-release-scl
</span></span><span style="display:flex;"><span>$ yum -y install devtoolset-6-gcc devtoolset-6-gcc-c++ devtoolset-6-binutils
</span></span><span style="display:flex;"><span>$ scl enable devtoolset-6 bash
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;source /opt/rh/devtoolset-6/enable&#34;</span> &gt;&gt;/etc/profile
</span></span><span style="display:flex;"><span>$ source /etc/profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é«˜ç‰ˆæœ¬node.jséœ€å‡çº§gccã€7.3ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ yum -y install centos-release-scl
</span></span><span style="display:flex;"><span>$ yum -y install devtoolset-7-gcc devtoolset-7-gcc-c++ devtoolset-7-binutils
</span></span><span style="display:flex;"><span>$ scl enable devtoolset-7 bash
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;source /opt/rh/devtoolset-7/enable&#34;</span> &gt;&gt;/etc/profile
</span></span><span style="display:flex;"><span>$ source /etc/profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‡çº§gccåˆ°9ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;scl enable devtoolset-9 bash&#39;</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;source /opt/rh/devtoolset-9/enable&#34;</span> &gt;&gt;/etc/profile
</span></span><span style="display:flex;"><span>$ source /etc/profile</span></span></code></pre></div></blockquote>
<hr>
<h3 id="findå‘½ä»¤"><code>find</code>å‘½ä»¤</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ find . -type f -size +500M  	<span style="color:#75715e"># æŸ¥è¯¢å½“å‰è¶…è¿‡500Mçš„æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ find . -type f -exec ls -l <span style="color:#f92672">{}</span> <span style="color:#ae81ff">\Í¾</span>  	<span style="color:#75715e"># æŸ¥è¯¢å½“å‰æ–‡ä»¶ï¼Œå¹¶ä»¥é•¿æ ¼å¼åˆ—å‡º</span>
</span></span><span style="display:flex;"><span>$ find . -type f -exec chmod <span style="color:#ae81ff">644</span> <span style="color:#f92672">{}</span> <span style="color:#ae81ff">\;</span>   <span style="color:#75715e"># f:ä»£è¡¨æ–‡ä»¶ï¼Œè®¾ç½®644æƒé™</span>
</span></span><span style="display:flex;"><span>$ find . -type d -exec chmod <span style="color:#ae81ff">755</span> <span style="color:#f92672">{}</span> <span style="color:#ae81ff">\;</span>   <span style="color:#75715e"># dä»£è¡¨ç›®å½•ï¼Œè®¾ç½®755æƒé™</span>
</span></span><span style="display:flex;"><span>$ find ./* -type f -mtime +15 | xargs ls -lt  	<span style="color:#75715e"># è¿‡æ»¤å‡ºæ¥æ–‡ä»¶æŒ‰æ—¶é—´æ’åº</span>
</span></span><span style="display:flex;"><span>$ find . -type f -mtime -30 -exec gzip -c ./* &gt;/tmp/nginx-wwwlogs-09-27.gz <span style="color:#f92672">{}</span> <span style="color:#ae81ff">\;</span>  	<span style="color:#75715e"># atimeï¼šæœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ï¼Œctimeï¼šæœ€åä¸€æ¬¡æ”¹å˜æƒé™æ—¶é—´ï¼Œmtimeï¼šæœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´</span>
</span></span><span style="display:flex;"><span>$ find . -name <span style="color:#e6db74">&#34;*.log&#34;</span> -exec cp <span style="color:#f92672">{}</span> test <span style="color:#ae81ff">\Í¾</span>  	<span style="color:#75715e"># æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹ä»¥.logç»“å°¾æ–‡ä»¶ï¼Œ</span>
</span></span><span style="display:flex;"><span>													<span style="color:#75715e"># æ‹·è´å¹¶ä¸”æ–°æ–‡ä»¶é‡æ–°å‘½åä¸ºï¼štest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ find . -name <span style="color:#e6db74">&#34;*.log&#34;</span> -mtime +5 -ok rm <span style="color:#f92672">{}</span> <span style="color:#ae81ff">\Í¾</span>  	<span style="color:#75715e"># å’Œ-execçš„ä½œç”¨ç›¸åŒï¼Œ</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># åªä¸è¿‡ä»¥ä¸€ç§æ›´ä¸ºå®‰å…¨çš„æ¨¡å¼æ¥æ‰§è¡Œè¯¥å‚æ•°æ‰€ç»™å‡ºçš„shellå‘½ä»¤ï¼Œ</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># åœ¨æ‰§è¡Œæ¯ä¸€ä¸ªå‘½ä»¤ä¹‹å‰ï¼Œéƒ½ä¼šç»™å‡ºæç¤ºï¼Œè®©ç”¨æˆ·æ¥ç¡®å®šæ˜¯å¦æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ find . -name <span style="color:#e6db74">&#34;*.log&#34;</span> -mtime +6 -exec du -sh <span style="color:#f92672">{}</span> <span style="color:#ae81ff">\;</span>  	<span style="color:#75715e"># æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹ä»¥.logç»“å°¾å¹¶è¶…è¿‡ä¸ƒå¤©çš„æ–‡ä»¶å¤§å°</span>
</span></span><span style="display:flex;"><span>$ find /etc -name <span style="color:#e6db74">&#34;passwd*&#34;</span> -exec grep <span style="color:#e6db74">&#34;root&#34;</span> <span style="color:#f92672">{}</span> <span style="color:#ae81ff">\Í¾</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥æ‰¾å¹¶ä¸”æ‰“åŒ…</span>
</span></span><span style="display:flex;"><span>$ find /your/directory/path -name <span style="color:#e6db74">&#34;*.tar&#34;</span> -exec tar -xvf <span style="color:#f92672">{}</span> <span style="color:#ae81ff">\;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥æ‰¾å¹¶æ‰“åŒ…åˆ°æŒ‡å®šç›®å½•</span>
</span></span><span style="display:flex;"><span>$ find /your/directory/path -name <span style="color:#e6db74">&#34;*.tar&#34;</span> -exec tar -xvf <span style="color:#f92672">{}</span> -C /path/to/extracted/directory <span style="color:#ae81ff">\;</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="nodenpmå‘½ä»¤"><code>nodeã€npm</code>å‘½ä»¤</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum groupinstall <span style="color:#e6db74">&#34;Development Tools&#34;</span> <span style="color:#e6db74">&#34;Development Libraries&#34;</span>
</span></span><span style="display:flex;"><span>$ yum install make automake gcc gcc-c++ kernel-devel
</span></span><span style="display:flex;"><span>$ yum -y install install build-essential
</span></span><span style="display:flex;"><span>$ curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh | bash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nvm ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>$ nvm install 18.0.0  	<span style="color:#75715e"># å®‰è£… nodejs 18.0.0</span>
</span></span><span style="display:flex;"><span>$ nvm ls  	<span style="color:#75715e"># åˆ—å‡ºå·²ç»å®‰è£…çš„nodeç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ nvm use v12.13.0  	<span style="color:#75715e"># åˆ‡æ¢nodeç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ nvm alias default v12.13.0  	<span style="color:#75715e"># æŒ‡å®šé»˜è®¤çš„nodeç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ npm install -g n  	<span style="color:#75715e"># å®‰è£…næ¨¡å—</span>
</span></span><span style="display:flex;"><span>$ n  	<span style="color:#75715e"># é€‰æ‹©ç‰ˆæœ¬ç›´æ¥ç”¨nå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ n v10.16.0  	<span style="color:#75715e"># &#34;n&#34;åŠ ç‰ˆæœ¬å·,ç”¨nå‘½ä»¤ä¸‹è½½æ‰€éœ€çš„ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>$ n latest  	<span style="color:#75715e"># ä¸‹è½½æœ€æ–°ç‰ˆ</span>
</span></span><span style="display:flex;"><span>$ n rm ç‰ˆæœ¬å·  	<span style="color:#75715e"># åˆ é™¤ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># buildæ‰§è¡Œæ‰“åŒ…å‘½ä»¤ã€å¦‚æœdistç›®å½•å­˜åœ¨åˆ é™¤ã€node_modulesç›®å½•å¯é€‰æ‹©åˆ é™¤æˆ–è€…ä¿ç•™</span>
</span></span><span style="display:flex;"><span>$ npm install
</span></span><span style="display:flex;"><span>$ npm run build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…wscat æµ‹è¯•websocket</span>
</span></span><span style="display:flex;"><span>$ npm install -g wscat 
</span></span><span style="display:flex;"><span>$ ./wscat --connect ws://192.168.2.210
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ curl -i <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#34;Upgrade: websocket&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#34;Sec-WebSocket-Key: AQIDBAUGBwgJCgsMDQ4PEA==&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#34;Sec-WebSocket-Version: 13&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --header <span style="color:#e6db74">&#34;Connection: upgrade&#34;</span> <span style="color:#ae81ff">\ </span><span style="color:#75715e">#ç›´æ¥è®¿é—®åç«¯æœåŠ¡çš„ Websocket éœ€è¦å¸¦ä¸Šè¯¥å¤´éƒ¨</span>
</span></span><span style="display:flex;"><span>http://192.168.1.141 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Build complete.
</span></span><span style="display:flex;"><span>Tip: built files are meant to be served over an HTTP server.
</span></span><span style="display:flex;"><span>Opening index.html over file:// won<span style="color:#960050;background-color:#1e0010">&#39;</span>t work.
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¤„ç†åŠæ³•ã€åœ¨npm run build è¿è¡Œå®Œä¹‹åï¼Œå†è¿è¡Œ</span>
</span></span><span style="display:flex;"><span>$ cd dist
</span></span><span style="display:flex;"><span>$ npm install -g http-server  	<span style="color:#75715e"># è¯¥å‘½ä»¤åªéœ€æ‰§è¡Œä¸€æ¬¡,å®‰è£…è¿‡ä¹‹å, ä»¥åå°±ä¸éœ€è¦é‡å¤å®‰è£…äº†.hs</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="åå°è¿è¡Œå‘½ä»¤">åå°è¿è¡Œå‘½ä»¤</h3>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>ä½¿ç”¨æ–¹å¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>nohup</code></td>
<td><code>$ nohup &amp;</code></td>
<td>ä½¿ç”¨<code>nohup</code>+ <code>&amp;</code>è®©æœåŠ¡åå°è¿è¡Œ</td>
</tr>
<tr>
<td><code>setsid</code></td>
<td><code>$ setsid</code></td>
<td></td>
</tr>
<tr>
<td><code>screen</code></td>
<td><code>$ screen</code></td>
<td><code>screen</code>å±äºç¬¬ä¸‰æ–¹å·¥å…·éœ€è¦å•ç‹¬å®‰è£…</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>screen</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install screen  	<span style="color:#75715e"># å®‰è£…  </span>
</span></span><span style="display:flex;"><span>$ screen  	<span style="color:#75715e"># å¯åŠ¨  </span>
</span></span><span style="display:flex;"><span>$ screen ls  	<span style="color:#75715e"># æŸ¥çœ‹  </span>
</span></span><span style="display:flex;"><span>$ screen r è¿›ç¨‹å·  	<span style="color:#75715e"># è¿›å…¥ç¨‹åº </span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨ï¼š<!-- raw HTML omitted --><code>screen [-opts] [cmd [args]æˆ–ï¼šscreen -r [host.tty]</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># é€‰é¡¹ï¼š</span>
</span></span><span style="display:flex;"><span>-4  	<span style="color:#75715e"># ä»…å°†ä¸»æœºåè§£æä¸ºIPv4åœ°å€ã€‚  </span>
</span></span><span style="display:flex;"><span>-6  	<span style="color:#75715e"># ä»…å°†ä¸»æœºåè§£æä¸ºIPv6åœ°å€ã€‚</span>
</span></span><span style="display:flex;"><span>-a  	<span style="color:#75715e"># å¼ºåˆ¶æ‰€æœ‰åŠŸèƒ½è¿›å…¥æ¯ä¸ªçª—å£çš„termcapã€‚</span>
</span></span><span style="display:flex;"><span>-A  	<span style="color:#75715e"># - [r | R]ä½¿æ‰€æœ‰çª—å£é€‚åº”æ–°çš„æ˜¾ç¤ºå®½åº¦å’Œé«˜åº¦ã€‚</span>
</span></span><span style="display:flex;"><span>-c  	<span style="color:#75715e"># fileè¯»å–é…ç½®æ–‡ä»¶è€Œä¸æ˜¯&#39;.screenrc&#39;ã€‚</span>
</span></span><span style="display:flex;"><span>-d  	<span style="color:#75715e"># ï¼ˆ-rï¼‰åˆ†ç¦»å…¶ä»–æ­£åœ¨è¿è¡Œçš„å±å¹•ï¼ˆå¹¶åœ¨æ­¤å¤„é‡æ–°è¿æ¥ï¼‰ã€‚</span>
</span></span><span style="display:flex;"><span>-dmS  	<span style="color:#75715e"># nameä½œä¸ºå®ˆæŠ¤ç¨‹åºå¯åŠ¨ï¼šå¤„äºåˆ†ç¦»æ¨¡å¼çš„å±å¹•ä¼šè¯ã€‚</span>
</span></span><span style="display:flex;"><span>-D  	<span style="color:#75715e"># ï¼ˆ-rï¼‰åˆ†ç¦»å’Œæ³¨é”€è¿œç¨‹ï¼ˆå¹¶åœ¨æ­¤å¤„é‡æ–°è¿æ¥ï¼‰ã€‚</span>
</span></span><span style="display:flex;"><span>-D  	<span style="color:#75715e"># -RRæ‰§è¡Œå±å¹•ä¼šè¯æ‰€éœ€çš„ä»»ä½•æ“ä½œã€‚</span>
</span></span><span style="display:flex;"><span>-e  	<span style="color:#75715e"># xyæ›´æ”¹å‘½ä»¤å­—ç¬¦ã€‚</span>
</span></span><span style="display:flex;"><span>-f  	<span style="color:#75715e"># æµæ§åˆ¶å¼€å¯ï¼Œ-fn=å…³é—­ï¼Œ-fa=autoã€‚-h linesè®¾ç½®å›æ»šå†å²è®°å½•ç¼“å†²åŒºçš„å¤§å°ã€‚</span>
</span></span><span style="display:flex;"><span>-i  	<span style="color:#75715e"># å½“æµé‡æ§åˆ¶æ‰“å¼€æ—¶ï¼Œä¸­æ–­è¾“å‡ºæ›´å¿«ã€‚</span>
</span></span><span style="display:flex;"><span>-l  	<span style="color:#75715e"># ç™»å½•æ¨¡å¼æ‰“å¼€ï¼ˆupdate /var/run/utmp,-ln = offã€‚</span>
</span></span><span style="display:flex;"><span>-ls  	<span style="color:#75715e"># [åŒ¹é…]æˆ–-listä»€ä¹ˆéƒ½ä¸åšï¼Œåªåˆ—å‡ºæˆ‘ä»¬çš„SockDir [åœ¨å¯èƒ½çš„æ¯”èµ›ä¸­]ã€‚</span>
</span></span><span style="display:flex;"><span>-L  	<span style="color:#75715e"># æ‰“å¼€è¾“å‡ºæ—¥å¿—è®°å½•ã€‚</span>
</span></span><span style="display:flex;"><span>-m  	<span style="color:#75715e"># å¿½ç•¥$ STYå˜é‡ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å±å¹•ä¼šè¯ã€‚</span>
</span></span><span style="display:flex;"><span>-O  	<span style="color:#75715e"># é€‰æ‹©æœ€ä½³è¾“å‡ºè€Œä¸æ˜¯ç²¾ç¡®çš„vt100ä»¿çœŸã€‚</span>
</span></span><span style="display:flex;"><span>-p  	<span style="color:#75715e"># windowé¢„é€‰æŒ‡å®šçš„çª—å£ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</span>
</span></span><span style="display:flex;"><span>-q  	<span style="color:#75715e"># å®‰é™çš„å¯åŠ¨ã€‚å¦‚æœä¸æˆåŠŸï¼Œåˆ™é€€å‡ºéé›¶è¿”å›ç ã€‚</span>
</span></span><span style="display:flex;"><span>-Q  	<span style="color:#75715e"># Commandså°†å“åº”å‘é€åˆ°æŸ¥è¯¢è¿‡ç¨‹çš„stdoutã€‚</span>
</span></span><span style="display:flex;"><span>-r  	<span style="color:#75715e"># [session]é‡æ–°è¿æ¥åˆ°åˆ†ç¦»çš„å±å¹•è¿›ç¨‹ã€‚</span>
</span></span><span style="display:flex;"><span>-R  	<span style="color:#75715e"># å¦‚æœå¯èƒ½é‡æ–°è¿æ¥ï¼Œå¦åˆ™å¯åŠ¨æ–°ä¼šè¯ã€‚</span>
</span></span><span style="display:flex;"><span>-s  	<span style="color:#75715e"># shell shellæ‰§è¡Œè€Œä¸æ˜¯$ SHELLã€‚</span>
</span></span><span style="display:flex;"><span>-S  	<span style="color:#75715e"># socknameå°†æ­¤ä¼šè¯å‘½åä¸º&lt;pid&gt; .socknameè€Œä¸æ˜¯&lt;pid&gt;ã€‚&lt;tty&gt;ã€‚&lt;host&gt;ã€‚</span>
</span></span><span style="display:flex;"><span>-t  	<span style="color:#75715e"># titleè®¾ç½®æ ‡é¢˜ã€‚ï¼ˆçª—å£çš„åå­—ï¼‰ã€‚</span>
</span></span><span style="display:flex;"><span>-T  	<span style="color:#75715e"># æœ¯è¯­ä½¿ç”¨æœ¯è¯­ä½œä¸ºWindowsçš„$ TERMï¼Œè€Œä¸æ˜¯â€œå±å¹•â€ã€‚</span>
</span></span><span style="display:flex;"><span>-U  	<span style="color:#75715e"># å‘Šè¯‰å±å¹•ä½¿ç”¨UTF-8ç¼–ç ã€‚</span>
</span></span><span style="display:flex;"><span>-v  	<span style="color:#75715e"># æ‰“å°â€œå±å¹•ç‰ˆæœ¬4.01.00develï¼ˆGNUï¼‰2-May-06â€ã€‚</span>
</span></span><span style="display:flex;"><span>-wipe  	<span style="color:#75715e"># [match]ä»€ä¹ˆéƒ½ä¸åšï¼Œåªæ˜¯æ¸…ç†SockDir [åœ¨å¯èƒ½çš„æ¯”èµ›ä¸­]ã€‚</span>
</span></span><span style="display:flex;"><span>-x  	<span style="color:#75715e"># é™„åŠ åˆ°æœªåˆ†ç¦»çš„å±å¹•ã€‚ï¼ˆå¤šæ˜¾ç¤ºæ¨¡å¼ï¼‰ã€‚</span>
</span></span><span style="display:flex;"><span>-X  	<span style="color:#75715e"># åœ¨æŒ‡å®šçš„ä¼šè¯ä¸­æ‰§è¡Œ&lt;cmd&gt;ä½œä¸ºå±å¹•å‘½ä»¤ã€‚</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="ç³»ç»Ÿæ’æŸ¥æŠ“åŒ…åˆ†æå‘½ä»¤">ç³»ç»Ÿæ’æŸ¥ã€æŠ“åŒ…ã€åˆ†æå‘½ä»¤</h3>
<blockquote>
<ul>
<li><a href="https://github.com/esnet/iperf" rel="external" target="_self"><code>iperf</code></a>ã€</li>
<li><a href="https://www.w3cschool.cn/linuxc/linuxc-ujgo3lgk.html" rel="external" target="_self"><code>Linux</code>å‘½ä»¤ã€å·¥å…·</a></li>
<li><a href="https://juejin.cn/post/6994232948618690591" rel="external" target="_self"><code>wireshark</code>çš„å‘½ä»¤è¡ŒæŠ“åŒ…å·¥å…·<code>tshark</code></a>ã€<a href="https://www.cnblogs.com/liun1994/p/6142505.html" rel="external" target="_self"><code>Wireshark</code>å‘½ä»¤è¡Œå·¥å…·<code>tshark</code>è¯¦è§£(å«ä¾‹å­)-01</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ss  	<span style="color:#75715e"># è¿æ¥æŸ¥çœ‹å·¥å…·</span>
</span></span><span style="display:flex;"><span>$ iperf3  	<span style="color:#75715e"># ç½‘ç»œæ€§èƒ½æµ‹è¯•å·¥å…·</span>
</span></span><span style="display:flex;"><span>$ ethtool  	<span style="color:#75715e"># è¯Šæ–­å·¥å…·</span>
</span></span><span style="display:flex;"><span>$ tcpdump  	<span style="color:#75715e"># æŠ“åŒ…å·¥å…·</span>
</span></span><span style="display:flex;"><span>$ tracert  	<span style="color:#75715e"># è¿½è¸ªè·¯ç”±å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ nethogs  	<span style="color:#75715e"># æŒ‰è¿›ç¨‹æŸ¥çœ‹æµé‡å ç”¨</span>
</span></span><span style="display:flex;"><span>$ iptraf  	<span style="color:#75715e"># æŒ‰è¿æ¥/ç«¯å£æŸ¥çœ‹æµé‡</span>
</span></span><span style="display:flex;"><span>$ ifstat  	<span style="color:#75715e"># æŒ‰è®¾å¤‡æŸ¥çœ‹æµé‡</span>
</span></span><span style="display:flex;"><span>$ pidof nginx  	<span style="color:#75715e"># è·å–æœåŠ¡è¿è¡Œçš„pid</span>
</span></span><span style="display:flex;"><span>$ strace -p pid  	<span style="color:#75715e"># æŸ¥çœ‹è¿›ç¨‹å·¥ä½œ</span>
</span></span><span style="display:flex;"><span>$ tcptraceroute  	<span style="color:#75715e"># è·¯ç”±è¿½è¸ªå·¥å…·</span>
</span></span><span style="display:flex;"><span>$ ifup/ifdown  	<span style="color:#75715e"># å¯åŠ¨å’Œåœæ­¢ç½‘å¡,å¯ä»¥æ¥ç½‘å¡åï¼šifup eth0ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å…¶å®ƒæ’æŸ¥å‘½ä»¤: dstat, slurm, nload, bmon</span>
</span></span><span style="display:flex;"><span>$ sudo opensnoop-bpfcc  	<span style="color:#75715e"># å®‰è£…ç›®å½•åœ¨ï¼š/usr/sbin/</span>
</span></span><span style="display:flex;"><span>$ wireshark  	<span style="color:#75715e"># å‘½ä»¤è¡ŒæŠ“åŒ…å·¥å…·</span></span></span></code></pre></div><ul>
<li><a href="https://github.com/iovisor/bcc/blob/master/INSTALL.md" rel="external" target="_self"><code>Installing BCC</code></a></li>
<li><a href="https://github.com/iovisor/bcc" rel="external" target="_self"><code>BPF Compiler Collection (BCC)</code></a></li>
<li><code>TCP</code><strong>ä¼ è¾“æ§åˆ¶åè®®</strong></li>
</ul>
<blockquote>
<ul>
<li>
<p><code>SYN</code><strong>åŒæ­¥</strong>åŒ…ï¼Œç”¨äºå»ºç«‹è¿æ¥</p>
<p><strong>åŠŸèƒ½</strong>: ç”¨äºå»ºç«‹è¿æ¥ã€‚<code>SYN</code>åŒ…æ˜¯<code>TCP</code>ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­çš„ç¬¬ä¸€æ­¥</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€<code>SYN</code>åŒ…ä»¥å¼€å§‹è¿æ¥çš„å»ºç«‹</p>
</li>
<li>
<p><code>SYN-ACK</code><strong>åŒæ­¥-ç¡®è®¤</strong>åŒ…ï¼Œå“åº” <code>SYN</code>åŒ…ä»¥ç¡®è®¤å»ºç«‹è¿æ¥</p>
<p><strong>åŠŸèƒ½</strong>: ç”¨äºå“åº”<code>SYN</code>åŒ…ï¼Œå¹¶ç¡®è®¤æ¥æ”¶åˆ°çš„<code>SYN</code>åŒ…ï¼Œè¡¨ç¤ºæœåŠ¡å™¨å‡†å¤‡å»ºç«‹è¿æ¥</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å›å¤<code>SYN-ACK</code>åŒ…ï¼Œä½œä¸ºä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬äºŒæ­¥</p>
</li>
<li>
<p><code>ACK</code><strong>ç¡®è®¤</strong>åŒ…ï¼Œç”¨äºç¡®è®¤æ•°æ®åŒ…çš„æ¥æ”¶</p>
<p><strong>åŠŸèƒ½</strong>: ç”¨äºç¡®è®¤æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ã€‚<code>ACK</code>åŒ…æ˜¯<code>TCP</code>åè®®ä¸­çš„ç¡®è®¤æœºåˆ¶</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„<code>SYN-ACK</code>åŒ…åï¼Œå‘é€<code>ACK</code>åŒ…ä»¥å®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥</p>
</li>
<li>
<p><code>FIN</code><strong>ç»“æŸ</strong>åŒ…ï¼Œç”¨äºç»“æŸè¿æ¥</p>
<p><strong>åŠŸèƒ½</strong>: ç”¨äºç»“æŸè¿æ¥ã€‚<code>FIN</code>åŒ…æ˜¯ TCP`å››æ¬¡æŒ¥æ‰‹ä¸­çš„ä¸€éƒ¨åˆ†</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: è¿æ¥çš„ä¸€æ–¹å‘é€<code>FIN</code>åŒ…ï¼Œè¡¨ç¤ºè¯¥ç«¯å·²ç»å®Œæˆæ•°æ®å‘é€å¹¶å¸Œæœ›å…³é—­è¿æ¥</p>
</li>
<li>
<p><code>RST</code><strong>é‡ç½®</strong>åŒ…ï¼Œç”¨äºé‡ç½®è¿æ¥</p>
<p><strong>åŠŸèƒ½</strong>: ç”¨äºå¼ºåˆ¶é‡ç½®è¿æ¥ï¼Œç«‹å³ç»ˆæ­¢è¿æ¥ã€‚<code>RST</code>åŒ…ç”¨äºé€šçŸ¥å¯¹æ–¹è¿æ¥å‘ç”Ÿå¼‚å¸¸ï¼Œéœ€è¦ç«‹å³å…³é—­</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: å½“å‘ç”Ÿé”™è¯¯æˆ–ä¸éœ€è¦çš„è¿æ¥æ—¶ä½¿ç”¨ï¼Œå¦‚ç«¯å£æœªå¼€æ”¾ã€åº”ç”¨å¼‚å¸¸ç­‰</p>
</li>
<li>
<p><code>PSH</code><strong>æ¨é€</strong>åŒ…ï¼Œç”¨äºæ¨é€æ•°æ®ï¼Œè¦æ±‚æ¥æ”¶æ–¹ç«‹å³å¤„ç†</p>
<p><strong>åŠŸèƒ½</strong>: ç”¨äºé€šçŸ¥æ¥æ”¶æ–¹ç«‹å³å¤„ç†æ•°æ®ï¼Œè€Œä¸æ˜¯ç­‰å¾…ç¼“å†²åŒºå¡«æ»¡</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: å‘é€æ–¹å¸Œæœ›æ¥æ”¶æ–¹ç«‹å³å¤„ç†æ•°æ®ï¼Œé€šå¸¸ç”¨äºå®æ—¶åº”ç”¨</p>
</li>
<li>
<p><code>URG</code><strong>ç´§æ€¥</strong>åŒ…ï¼ŒæŒ‡ç¤ºç´§æ€¥æ•°æ®</p>
<p><strong>åŠŸèƒ½</strong>: æŒ‡ç¤ºæ•°æ®ä¸­çš„ç´§æ€¥ä¿¡æ¯ï¼Œå¹¶é€šçŸ¥æ¥æ”¶æ–¹ä¼˜å…ˆå¤„ç†è¿™äº›æ•°æ®</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: æ•°æ®åŒ…ä¸­åŒ…å«ç´§æ€¥æ•°æ®ï¼Œè¦æ±‚æ¥æ”¶æ–¹ç«‹å³å¤„ç†</p>
</li>
</ul>
</blockquote>
<ul>
<li><code>UDP</code><strong>ç”¨æˆ·æ•°æ®æŠ¥åè®®</strong></li>
</ul>
<blockquote>
<ul>
<li>
<p>æ•°æ®æŠ¥<code>Datagram</code></p>
<p><strong>åŠŸèƒ½</strong>: è¿™æ˜¯<code>UDP</code>åè®®ä¸­æœ€åŸºæœ¬çš„åŒ…ç±»å‹ï¼ŒåŒ…å«äº†æ•°æ®çš„å®Œæ•´å†…å®¹å’Œå¿…è¦çš„å¤´éƒ¨ä¿¡æ¯</p>
<p><strong>ç»„æˆéƒ¨åˆ†</strong>:</p>
<ul>
<li><strong>å¤´éƒ¨</strong>:
<ul>
<li><strong>æºç«¯å£å·</strong>ï¼ˆ16 ä½ï¼‰</li>
<li><strong>ç›®çš„ç«¯å£å·</strong>ï¼ˆ16 ä½ï¼‰</li>
<li><strong>é•¿åº¦</strong>ï¼ˆ16 ä½ï¼‰ï¼šåŒ…æ‹¬å¤´éƒ¨å’Œæ•°æ®çš„æ€»é•¿åº¦</li>
<li><strong>æ ¡éªŒå’Œ</strong>ï¼ˆ16 ä½ï¼‰ï¼šç”¨äºæ£€æµ‹æ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦å‡ºç°é”™è¯¯</li>
</ul>
</li>
<li><strong>æ•°æ®</strong>: å®é™…ä¼ è¾“çš„æ•°æ®å†…å®¹</li>
</ul>
</li>
<li>
<p>ç©ºæ•°æ®æŠ¥<code>Empty Datagram</code></p>
<p><strong>åŠŸèƒ½</strong>: ä¸€ä¸ªæ²¡æœ‰æ•°æ®è´Ÿè½½çš„ UDP æ•°æ®æŠ¥ï¼Œä¸»è¦ç”¨äºä¿æŒè¿æ¥çš„çŠ¶æ€æˆ–ä½œä¸ºä¿¡å·é‡ã€‚</p>
<p><strong>åœºæ™¯</strong>: ä¾‹å¦‚ï¼Œå¿ƒè·³æ£€æµ‹æˆ–ç½‘ç»œæµ‹è¯•ç­‰åœºæ™¯ä¸­ï¼Œå¯èƒ½ä¼šä½¿ç”¨ç©ºæ•°æ®æŠ¥æ¥ä¿æŒè¿æ¥æˆ–æ£€æŸ¥ç½‘ç»œçŠ¶æ€</p>
</li>
<li>
<p><code>UDP</code>åè®®ç‰¹ç‚¹</p>
<p><strong>æ— è¿æ¥</strong>: <code>UDP</code>ä¸å»ºç«‹è¿æ¥ï¼Œæ¯ä¸ªæ•°æ®æŠ¥éƒ½æ˜¯ç‹¬ç«‹çš„</p>
<p><strong>æ— åº</strong>: æ•°æ®åŒ…çš„é¡ºåºä¸ä¿è¯ï¼Œå› æ­¤æ¥æ”¶æ–¹å¯èƒ½æ”¶åˆ°ä¹±åºçš„æ•°æ®</p>
<p><strong>æ— å¯é æ€§</strong>: <code>UDP</code>ä¸ä¿è¯æ•°æ®åŒ…çš„äº¤ä»˜ï¼Œä¹Ÿæ²¡æœ‰é‡ä¼ æœºåˆ¶ã€‚å¦‚æœæ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼Œ<code>UDP</code>ä¸ä¼šè¿›è¡Œé‡å‘</p>
<p><strong>æ— æµé‡æ§åˆ¶</strong>: <code>UDP</code>ä¸æ§åˆ¶æ•°æ®æµé‡ï¼Œä¹Ÿä¸è¿›è¡Œæµé‡è°ƒèŠ‚</p>
</li>
<li>
<p><code>UDP</code>æ•°æ®æŠ¥çš„åŸºæœ¬ç»“æ„</p>
<p><strong>å¤´éƒ¨</strong><code>Header</code>:</p>
<ul>
<li><strong>æºç«¯å£å·</strong>: è¡¨ç¤ºå‘é€æ–¹çš„ç«¯å£</li>
<li><strong>ç›®çš„ç«¯å£å·</strong>: è¡¨ç¤ºæ¥æ”¶æ–¹çš„ç«¯å£</li>
<li><strong>é•¿åº¦</strong>: åŒ…æ‹¬å¤´éƒ¨å’Œæ•°æ®çš„æ€»é•¿åº¦</li>
<li><strong>æ ¡éªŒå’Œ</strong>: ç”¨äºæ£€æŸ¥æ•°æ®çš„å®Œæ•´æ€§</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®</strong><code>Data</code>:</p>
<ul>
<li>å®é™…ä¼ è¾“çš„åº”ç”¨æ•°æ®</li>
</ul>
</li>
</ul>
</blockquote>
<p><a href="#R-image-2ca108a0151145c5b19ed67d433f96de" class="lightbox-link"><img class="border lazy lightbox noshadow figure-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/bcc_tracing_tools_2019.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2ca108a0151145c5b19ed67d433f96de"><img class="border lazy lightbox noshadow lightbox-image" loading="lazy" src="https://raw.githubusercontent.com/usermice/images/master/System-Architecture-Planning-Diagram/bcc_tracing_tools_2019.png"></a></p>
</blockquote>
<hr>
<h3 id="å¿«æ·é”®">å¿«æ·é”®</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ é™¤å¿«æ·é”®<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ctrl + d</code></td>
<td>åˆ é™¤å…‰æ ‡æ‰€åœ¨ä½ç½®ä¸Šçš„å­—ç¬¦ç›¸å½“äº<code>VIM</code>é‡Œ<code>x</code>æˆ–è€…<code>dl </code></td>
</tr>
<tr>
<td><code>ctrl + h</code></td>
<td>åˆ é™¤å…‰æ ‡æ‰€åœ¨ä½ç½®å‰çš„å­—ç¬¦ç›¸å½“äº<code>VIM</code>é‡Œ<code>hx</code>æˆ–è€…<code>dh</code></td>
</tr>
<tr>
<td><code>ctrl + k </code></td>
<td>åˆ é™¤å…‰æ ‡åé¢æ‰€æœ‰å­—ç¬¦ç›¸å½“äº<code>VIM</code>é‡Œ<code>d shift+$</code></td>
</tr>
<tr>
<td><code>ctrl + u </code></td>
<td>åˆ é™¤å…‰æ ‡å‰é¢æ‰€æœ‰å­—ç¬¦ç›¸å½“äº<code>VIM</code>é‡Œ<code>d shift+^ </code></td>
</tr>
<tr>
<td><code>ctrl + w</code></td>
<td>åˆ é™¤å…‰æ ‡å‰ä¸€ä¸ªå•è¯ç›¸å½“äº<code>VIM</code>é‡Œ<code>db</code></td>
</tr>
<tr>
<td><code>ctrl + y </code></td>
<td>æ¢å¤<code>ctrl+u</code>ä¸Šæ¬¡æ‰§è¡Œæ—¶åˆ é™¤çš„å­—ç¬¦</td>
</tr>
<tr>
<td><code>ctrl + ?</code></td>
<td>æ’¤æ¶ˆå‰ä¸€æ¬¡è¾“å…¥</td>
</tr>
<tr>
<td><code>alt + r</code></td>
<td>æ’¤æ¶ˆå‰ä¸€æ¬¡åŠ¨ä½œ</td>
</tr>
<tr>
<td><code>alt + d</code></td>
<td>åˆ é™¤å…‰æ ‡æ‰€åœ¨ä½ç½®çš„åå•è¯</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->ç§»åŠ¨å¿«æ·é”®<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ctrl + a</code></td>
<td>å°†å…‰æ ‡ç§»åŠ¨åˆ°å‘½ä»¤è¡Œå¼€å¤´ç›¸å½“äº<code>VIM</code>é‡Œ<code>shift+^</code></td>
</tr>
<tr>
<td><code>ctrl + e</code></td>
<td>å°†å…‰æ ‡ç§»åŠ¨åˆ°å‘½ä»¤è¡Œç»“å°¾å¤„ç›¸å½“äº<code>VIM</code>é‡Œ<code>shift+$</code></td>
</tr>
<tr>
<td><code>ctrl + f</code></td>
<td>å…‰æ ‡å‘åç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ç›¸å½“äº<code>VIM</code>é‡Œ<code>l</code></td>
</tr>
<tr>
<td><code>ctrl + b</code></td>
<td>å…‰æ ‡å‘å‰ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ç›¸å½“äº<code>VIM</code>é‡Œ<code>h</code></td>
</tr>
<tr>
<td><code>ctrl + æ–¹å‘é”®å·¦é”®</code></td>
<td>å…‰æ ‡ç§»åŠ¨åˆ°å‰ä¸€ä¸ªå•è¯å¼€å¤´</td>
</tr>
<tr>
<td><code>ctrl + æ–¹å‘é”®å³é”®</code></td>
<td>å…‰æ ‡ç§»åŠ¨åˆ°åä¸€ä¸ªå•è¯ç»“å°¾</td>
</tr>
<tr>
<td><code>ctrl + x</code></td>
<td>åœ¨ä¸Šæ¬¡å…‰æ ‡æ‰€åœ¨å­—ç¬¦å’Œå½“å‰å…‰æ ‡æ‰€åœ¨å­—ç¬¦ä¹‹é—´è·³è½¬</td>
</tr>
<tr>
<td><code>alt + f</code></td>
<td>è·³åˆ°å…‰æ ‡æ‰€åœ¨ä½ç½®å•è¯å°¾éƒ¨</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->æ›¿æ¢å¿«æ·é”®<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ctrl + t</code></td>
<td>å°†å…‰æ ‡å½“å‰å­—ç¬¦ä¸å‰é¢ä¸€ä¸ªå­—ç¬¦æ›¿æ¢</td>
</tr>
<tr>
<td><code>alt + t</code></td>
<td>äº¤æ¢ä¸¤ä¸ªå…‰æ ‡å½“å‰æ‰€å¤„ä½ç½®å•è¯å’Œå…‰æ ‡å‰ä¸€ä¸ªå•è¯</td>
</tr>
<tr>
<td><code>alt + u</code></td>
<td>æŠŠå…‰æ ‡å½“å‰ä½ç½®å•è¯å˜ä¸ºå¤§å†™</td>
</tr>
<tr>
<td><code>alt + l</code></td>
<td>æŠŠå…‰æ ‡å½“å‰ä½ç½®å•è¯å˜ä¸ºå°å†™</td>
</tr>
<tr>
<td><code>alt + c</code></td>
<td>æŠŠå…‰æ ‡å½“å‰ä½ç½®å•è¯å¤´ä¸€ä¸ªå­—æ¯å˜ä¸ºå¤§å†™</td>
</tr>
<tr>
<td><code>^oldstr^newstr</code></td>
<td>æ›¿æ¢å‰ä¸€æ¬¡å‘½ä»¤ä¸­å­—ç¬¦ä¸²å†å²å‘½ä»¤ç¼–è¾‘</td>
</tr>
<tr>
<td><code>ctrl + p</code></td>
<td>è¿”å›ä¸Šä¸€æ¬¡è¾“å…¥å‘½ä»¤å­—ç¬¦</td>
</tr>
<tr>
<td><code>ctrl + r</code></td>
<td>è¾“å…¥å•è¯æœç´¢å†å²å‘½ä»¤</td>
</tr>
<tr>
<td><code>alt + p</code></td>
<td>è¾“å…¥å­—ç¬¦æŸ¥æ‰¾ä¸å­—ç¬¦ç›¸æ¥è¿‘çš„å†å²å‘½ä»¤</td>
</tr>
<tr>
<td><code>alt + &gt;</code></td>
<td>è¿”å›ä¸Šä¸€æ¬¡æ‰§è¡Œå‘½ä»¤</td>
</tr>
</tbody>
</table>
<ul>
<li><!-- raw HTML omitted -->å…¶å®ƒæ“ä½œ<!-- raw HTML omitted --></li>
</ul>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ctrl + c</code></td>
<td>å¦èµ·ä¸€è¡Œ</td>
</tr>
<tr>
<td><code>ctrl + r</code></td>
<td>è¾“å…¥å•è¯æœç´¢å†å²å‘½ä»¤</td>
</tr>
<tr>
<td><code>ctrl + s</code></td>
<td>é”ä½ç»ˆç«¯</td>
</tr>
<tr>
<td><code>ctrl + q</code></td>
<td>è§£é”ç»ˆç«¯</td>
</tr>
<tr>
<td><code>ctrl + l</code></td>
<td>æ¸…å±ç›¸å½“äºå‘½ä»¤<code>clear</code></td>
</tr>
<tr>
<td><code>ctrl + c</code></td>
<td>å¦èµ·ä¸€è¡Œ</td>
</tr>
<tr>
<td><code>ctrl + i</code></td>
<td>ç±»ä¼¼<code>TAB</code>å¥è¡¥å…¨åŠŸèƒ½</td>
</tr>
<tr>
<td><code>ctrl + o</code></td>
<td>é‡å¤æ‰§è¡Œå‘½ä»¤</td>
</tr>
<tr>
<td><code>alt + æ•°å­—é”®</code></td>
<td>æ“ä½œ</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="systemctlå‘½ä»¤"><code>systemctl</code>å‘½ä»¤</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl list-unit-files  	<span style="color:#75715e"># åˆ—å‡ºæ‰€æœ‰æœåŠ¡çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>$ systemctl list-dependencies     <span style="color:#75715e"># åˆ—å‡ºæ‰€æœ‰æœåŠ¡ä»¥åŠä¾èµ–çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl list-unit-files --type<span style="color:#f92672">=</span>service|grep enabled   <span style="color:#75715e"># æŸ¥çœ‹å¼€å¯çš„æœåŠ¡</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="å®‰è£…kvmvnc">å®‰è£…<code>KVM</code>ã€<code>VNC</code></h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>KVM</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install virt-manager
</span></span><span style="display:flex;"><span>$ virsh list --all
</span></span><span style="display:flex;"><span>$ virsh start server_15
</span></span><span style="display:flex;"><span>$ virsh autostart server_15  	<span style="color:#75715e"># å¼€æœºè‡ªå¯</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ£€æŸ¥åœ¨/etc/libvirt/qemu/autostart/ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªï¼ˆè™šæ‹Ÿæœºå.xmlï¼‰æ–‡ä»¶</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>vnc</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install vnc*
</span></span><span style="display:flex;"><span>$ vncserver
</span></span><span style="display:flex;"><span>$ netstat -nuptl
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-port<span style="color:#f92672">=</span>5905/tcp --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span><span style="display:flex;"><span>è½¯ä»¶åŒ… tigervnc-server-1.8.0-13.el7.x86_64 å·²å®‰è£…å¹¶ä¸”æ˜¯æœ€æ–°ç‰ˆæœ¬
</span></span><span style="display:flex;"><span>è½¯ä»¶åŒ… tigervnc-1.8.0-13.el7.x86_64 å·²å®‰è£…å¹¶ä¸”æ˜¯æœ€æ–°ç‰ˆæœ¬
</span></span><span style="display:flex;"><span>è½¯ä»¶åŒ… tigervnc-server-module-1.8.0-13.el7.x86_64 å·²å®‰è£…å¹¶ä¸”æ˜¯æœ€æ–°ç‰ˆæœ¬</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å…¶ä»–å‘½ä»¤">å…¶ä»–å‘½ä»¤</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»ºã€åˆ é™¤ç”¨æˆ·ä»¥åŠç”¨æˆ·ç»„å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ useradd  	<span style="color:#75715e"># æ·»åŠ ç”¨æˆ·è¯­æ³•ï¼šuseradd ç”¨æˆ·å,ä¾‹å­:useradd oldboy</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># -u:æŒ‡å®šuidï¼Œ-g:æ·»åŠ ä¸»ç»„ï¼Œ-G:æ·»åŠ ç”¨æˆ·é™„å±ç»„ï¼Œ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># -s:æŒ‡å®šç™»å½•çš„shellï¼Œ-e:æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œ-M:ä¸åˆ›å»ºå®¶ç›®å½•ï¼Œ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># -D:ä¿®æ”¹/etc/default/useraddå‚æ•°ï¼Œä¸€èˆ¬ç”¨ vi ç›´æ¥ç¼–è¾‘ã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ usermod  	<span style="color:#75715e"># -d:æŒ‡å®šå°±æ”¹ç›®å½•,-g:æ”¹ä¸»ç»„,-G:é™„åŠ ç»„</span>
</span></span><span style="display:flex;"><span>$ chage  	<span style="color:#75715e"># è®¾ç½®æˆ–ä¿®æ”¹ç”¨æˆ·å¯†ç æœ‰æ•ˆæœŸé™,-e:ä¿®æ”¹å¯†ç æ–‡ä»¶,-l:æŸ¥çœ‹å¯†ç æœ‰æ•ˆæœŸ</span>
</span></span><span style="display:flex;"><span>$ userdel  	<span style="color:#75715e"># åˆ é™¤ç”¨æˆ·,-r:åˆ é™¤å®¶ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ groups  	<span style="color:#75715e"># æŸ¥çœ‹ç”¨æˆ·å±ç»„</span>
</span></span><span style="display:flex;"><span>$ groupadd  	<span style="color:#75715e"># æ·»åŠ ç»„group</span>
</span></span><span style="display:flex;"><span>$ groupdel  	<span style="color:#75715e"># åˆ é™¤ç»„</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºã€ä¿®æ”¹å¯†ç <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ passwd  	<span style="color:#75715e"># ä¸ºç”¨æˆ·è®¾ç½®æˆ–ä¿®æ”¹å¯†ç ,ä¾‹å­:passwd oldboy ä¸ºoldboyè®¾ç½®ä¿®æ”¹å¯†ç ,ç›´æ¥passwdæ˜¯å½“å‰ç”¨æˆ·ä¿®æ”¹å¯†ç ã€‚</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;123456&#34;</span>|passwd --stdin username  	<span style="color:#75715e"># éäº¤äº’å¼æ›´æ”¹å¯†ç ï¼Œä¸€èˆ¬ç”¨äºè„šæœ¬ä½¿ç”¨</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æƒé™ã€æ›´æ”¹ã€æˆäºˆæ“ä½œ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ su  	<span style="color:#75715e"># åˆ‡æ¢ç”¨æˆ·èº«ä»½ - åŠ è½½ç¯å¢ƒå˜é‡ -cä»¥æŒ‡å®šç”¨æˆ·èº«ä»½æ‰§è¡Œä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>$ sudo  	<span style="color:#75715e"># å¯ä»¥è®©æ™®é€šç”¨æˆ·æ‹¥æœ‰rootæƒé™å»æ‰§è¡Œå‘½ä»¤,sudoé…ç½®æ–‡ä»¶/etc/sudoers</span>
</span></span><span style="display:flex;"><span>$ visudo  	<span style="color:#75715e"># é€šè¿‡visudoç¼–è¾‘/etc/sudoers,å¯ä»¥å»æ£€æŸ¥é…ç½®æ–‡ä»¶çš„è¯­æ³•ã€‚</span>
</span></span><span style="display:flex;"><span>$ alias  	<span style="color:#75715e"># æŸ¥çœ‹å’Œè®¾ç½®åˆ«å,ä¾‹å­:æŸ¥çœ‹åˆ«åç›´æ¥è¾“å…¥alias,è®¾ç½®åˆ«å:alias cp=&#39;cp -i&#39;</span>
</span></span><span style="display:flex;"><span>$ unalias  	<span style="color:#75715e"># å–æ¶ˆåˆ«å unalias cp</span>
</span></span><span style="display:flex;"><span>$ chmod  	<span style="color:#75715e"># æ›´æ”¹åŠè®¾ç½®æ–‡ä»¶å¯¹åº”æƒé™</span>
</span></span><span style="display:flex;"><span>$ chown  	<span style="color:#75715e"># æ›´æ”¹åŠè®¾ç½®æ–‡ä»¶å¯¹åº”çš„ç”¨æˆ·å’Œç»„</span>
</span></span><span style="display:flex;"><span>$ last  	<span style="color:#75715e"># æ˜¾ç¤ºç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼Œ /var/log/wtmpæ•°æ®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ lastlog  	<span style="color:#75715e"># æ‰€æœ‰ç”¨æˆ·æœ€è¿‘ç™»å½•çš„æƒ…å†µ</span>
</span></span><span style="display:flex;"><span>$ umask  	<span style="color:#75715e"># æ§åˆ¶æ–‡ä»¶é»˜è®¤æƒé™</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹ã€æŸ¥æ‰¾å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><a href="https://segmentfault.com/a/1190000041912631" rel="external" target="_self"><code>jq</code>å‘½ä»¤ç”¨æ³•æ€»ç»“</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ id  	<span style="color:#75715e"># æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯å’Œç»„ä¿¡æ¯ã€</span>
</span></span><span style="display:flex;"><span>$ w  	<span style="color:#75715e"># æ˜¾ç¤ºç™»å½•ä¿¡æ¯ åŠæ“ä½œä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>$ who  	<span style="color:#75715e"># æ˜¾ç¤ºè°ç™»å½•</span>
</span></span><span style="display:flex;"><span>$ ps  	<span style="color:#75715e"># æŸ¥æ‰¾å¯åŠ¨çš„æœåŠ¡</span>
</span></span><span style="display:flex;"><span>$ cd  	<span style="color:#75715e"># åˆ‡æ¢ç›®å½•ï¼Œä¾‹å­:cd /etc</span>
</span></span><span style="display:flex;"><span>$ pwd  	<span style="color:#75715e"># print work directoryæ‰“å°å·¥ä½œç›®å½•(æ˜¾ç¤ºå½“å‰æ‰€åœ¨è·¯å¾„)</span>
</span></span><span style="display:flex;"><span>$ cat  	<span style="color:#75715e"># æŸ¥çœ‹æ–‡ä»¶å†…å®¹ ä¾‹å­:cat oldboy.txt,-n:æ˜¾ç¤ºè¡Œå·</span>
</span></span><span style="display:flex;"><span>$ wc  	<span style="color:#75715e"># æ˜¾ç¤º,-l(lines)æ€»è¡Œæ•°ï¼Œ-L:æœ€å¤§è¡Œçš„é•¿åº¦ã€‚</span>
</span></span><span style="display:flex;"><span>$ nl  	<span style="color:#75715e"># nl - number linesæ˜¾ç¤ºè¡Œå·</span>
</span></span><span style="display:flex;"><span>$ jq  	<span style="color:#75715e"># è½»é‡çº§å‘½ä»¤è¡ŒJSONå¤„ç†å™¨ï¼Œ-rï¼šå»é™¤å­—ç¬¦ä¸²å¼•å·ï¼Œ&#34;,&#34;ï¼šé€—å·æ‰§è¡Œå¤šä¸ªå‚æ•°ï¼Œcat text.jsonl | jq -r &#39;.status&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ls  	<span style="color:#75715e"># list(åˆ—è¡¨)åˆ—è¡¨ç›®å½•æ–‡ä»¶ä¾‹å­ï¼šls /ï¼Œåˆ—å‡ºæ ¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ã€ç›®å½•</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># -a(all)æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶(åŒ…æ‹¬éšè—æ–‡ä»¶)ï¼Œé»˜è®¤ä¸æ˜¾ç¤ºä»¥&#34;.&#34;å¼€å¤´çš„éšè—æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># -l(long)é•¿æ ¼å¼ï¼Œ-d(directorys)æŸ¥çœ‹ç›®å½•ï¼Œ-t:æŒ‰ä¿®æ”¹æ—¶é—´æ’åºï¼Œ-r:åè½¬æ’åº(å€’åº)ï¼Œ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># -p:ç»™ç›®å½•ç»“å°¾åŠ æ–œçº¿ï¼Œ-F:ç»™ä¸åŒæ–‡ä»¶ç»“å°¾åŠ ä¸åŒæ ‡è¯†ï¼Œ-i:æ‰“å°æ–‡ä»¶çš„ç´¢å¼•å·</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># --color=auto:æ˜¾ç¤ºé¢œè‰²ï¼Œ-h:äººç±»å¯è¯»,--time-style=long-iso</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ iotop -oP  	<span style="color:#75715e"># æ—¶æ—¶æŸ¥çœ‹ç£ç›˜IOæƒ…å†µ</span>
</span></span><span style="display:flex;"><span>$ pgrep  	<span style="color:#75715e"># ä»¥åç§°ä¸ºä¾æ®ä»è¿è¡Œè¿›ç¨‹é˜Ÿåˆ—ä¸­æŸ¥æ‰¾è¿›ç¨‹ï¼Œå¹¶æ˜¾ç¤ºæŸ¥æ‰¾åˆ°çš„è¿›ç¨‹idï¼Œä¾‹å¦‚ï¼špgrep mysqld</span>
</span></span><span style="display:flex;"><span>$ date +%s  	<span style="color:#75715e"># è·å–æ—¶é—´æˆ³</span>
</span></span><span style="display:flex;"><span>$ file  	<span style="color:#75715e"># æŸ¥çœ‹æ–‡ä»¶çš„ç±»å‹</span>
</span></span><span style="display:flex;"><span>$ stat  	<span style="color:#75715e"># æ˜¾ç¤ºæ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»ŸçŠ¶æ€(æŸ¥çœ‹æ–‡ä»¶å±æ€§)			</span>
</span></span><span style="display:flex;"><span>$ head  	<span style="color:#75715e"># å¤´ï¼Œå¤´éƒ¨è¯»å–æ–‡ä»¶çš„å‰nè¡Œ,é»˜è®¤å‰10è¡Œ,-næ•°å­—,ä¹ æƒ¯-5,å¿½ç•¥-nã€‚</span>
</span></span><span style="display:flex;"><span>$ tail  	<span style="color:#75715e"># å°¾ï¼Œå°¾å·´è¾“å‡ºæ–‡ä»¶çš„ånè¡Œ,é»˜è®¤å10è¡Œ,-næ•°å­—ï¼Œä¹ æƒ¯-5,å¿½ç•¥-nã€‚</span>
</span></span><span style="display:flex;"><span>$ less  	<span style="color:#75715e"># å’Œmoreç›¸åå›è½¦ä¸€æ¬¡ä¸€è¡Œï¼Œç©ºæ ¼å‘ä¸‹ä¸€æ¬¡ä¸€å±ï¼ŒæŒ‰bå¯ä»¥ä¸€æ¬¡å›é€€ä¸€å±ã€‚</span>
</span></span><span style="display:flex;"><span>$ more  	<span style="color:#75715e"># æŒ‰é¡µä¸€æ¬¡ä¸€å±ã€‚å›è½¦ä¸€æ¬¡ä¸€è¡Œï¼Œç©ºæ ¼å‘ä¸‹ä¸€æ¬¡ä¸€å±ã€‚ä¸èƒ½å›é€€ã€‚</span>
</span></span><span style="display:flex;"><span>$ history  	<span style="color:#75715e"># æŸ¥çœ‹åŠæ¸…ç†å†å²è®°å½•-cæ¸…ç©ºæ‰€æœ‰,-dåˆ é™¤æŒ‡å®šå†å²è®°å½•</span>
</span></span><span style="display:flex;"><span>$ tree  	<span style="color:#75715e"># å¤§æ ‘çš„æ„æ€ï¼Œæ˜¾ç¤ºç›®å½•æ ‘,-L layerå±‚æ•°,-dæ˜¾ç¤ºç›®å½•</span>
</span></span><span style="display:flex;"><span>$ xargs  	<span style="color:#75715e"># ä»æ ‡æ³¨ä½ è¾“å…¥è·å–å†…å®¹åˆ›å»ºå’Œæ‰§è¡Œå‘½ä»¤-næ•°å­—,åˆ†ç»„</span>
</span></span><span style="display:flex;"><span>$ which  	<span style="color:#75715e"># æŸ¥çœ‹äºŒè¿›åˆ¶å‘½ä»¤æ‰€åœ¨è·¯å¾„(ä»PATHå˜é‡æ‰€åœ¨çš„è·¯åŠ²æŸ¥æ‰¾)</span>
</span></span><span style="display:flex;"><span>$ whereis  	<span style="color:#75715e"># æŸ¥æ‰¾æ–‡ä»¶çš„å¸®åŠ©ã€æºä»£ç ï¼Œ-b:äºŒè¿›åˆ¶54ã€</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># locate find files by name åªèƒ½æŸ¥updatedbåº“é‡Œå†…å®¹ï¼Œ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># locateä»/var/lib/mlocate/mlocate.dbæŸ¥æ‰¾ç›®å½•ã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ find  	<span style="color:#75715e"># -name æŒ‰åç§°æŸ¥æ‰¾ï¼Œ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># -type æŒ‰ç±»å‹æŸ¥æ‰¾ï¼Œ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># f(file)æ–‡ä»¶ï¼Œd(directory)ç›®å½•ï¼Œc(character)å­—ç¬¦ï¼Œ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># b(block)å—è®¾å¤‡ï¼Œs(socket)ï¼Œl(link)é“¾æ¥ï¼Œ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># -mtime æŒ‰æ—¶é—´æŸ¥æ‰¾ï¼Œ+7:7å¤©ä»¥å‰ï¼Œ-7æœ€è¿‘7å¤©ï¼Œ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -mtime -ctime -atimeï¼å–åï¼Œ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -a:andå¹¶ä¸”ï¼Œ-o:or æˆ–è€…ï¼Œ-maxdepthæŸ¥æ‰¾æ·±åº¦ï¼Œï¼permï¼šæŒ‰æƒé™æŸ¥æ‰¾</span>
</span></span><span style="display:flex;"><span>$ netstat -lnutp -a
</span></span><span style="display:flex;"><span>$ lsof list open file</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å…³æœºã€é‡å¯å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ init  	<span style="color:#75715e"># æŒ‰åé¢å¯¹åº”çš„æ•°å­—åˆ‡æ¢è¿è¡Œçº§åˆ«ï¼Œä¾‹å¦‚:init 6é‡å¯æœåŠ¡å™¨</span>
</span></span><span style="display:flex;"><span>$ reboot  	<span style="color:#75715e"># ç­‰åŒäºï¼šinit 6ï¼Œä»¥åŠï¼šshutdown -r nowï¼šç«‹å³é‡å¯</span>
</span></span><span style="display:flex;"><span>$ poweroff  	<span style="color:#75715e"># å…³æœº</span>
</span></span><span style="display:flex;"><span>$ runlevel  	<span style="color:#75715e"># æŸ¥çœ‹å½“å‰ç³»ç»Ÿè¿è¡Œçº§åˆ«</span>
</span></span><span style="display:flex;"><span>$ shutdown  	<span style="color:#75715e"># (haltã€init 0)å…³æœºï¼Œshutdown -h nowï¼šç«‹å³å…³æœºï¼Œ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -rï¼šä»£è¡¨é‡å¯ï¼Œå¯æŒ‰éœ€è¦å®šæ—¶é‡å¯ï¼Œ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -hï¼šä»£è¡¨å…³æœºï¼Œå¯æŒ‰éœ€è¦å®šæ—¶å…³æœºã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chkconfig  	<span style="color:#75715e"># è®¾ç½®æœåŠ¡å¼€æœºè‡ªå¯åŠ¨å‘½ä»¤, --list:æŸ¥çœ‹è‡ªåŠ¨æœåŠ¡ï¼Œ--level levels</span>
</span></span><span style="display:flex;"><span>$ chkconfig --list  	<span style="color:#75715e"># åˆ—å‡ºæ‰€æœ‰æœåŠ¡å¼€æœºåœ¨é‚£ä¸ªè¿è¡Œçº§åˆ«æƒ…å†µä¸‹å¯åŠ¨æˆ–å…³é—­</span>
</span></span><span style="display:flex;"><span>$ chkconfig --list network  	<span style="color:#75715e"># æŸ¥çœ‹æŒ‡å®šæœåŠ¡åœ¨è¿è¡Œçº§åˆ«ä¸‹æ˜¯å¦è‡ªå¯æˆ–å…³é—­</span>
</span></span><span style="display:flex;"><span>$ chkconfig --level levels sshd off<span style="color:#f92672">[</span>on<span style="color:#f92672">]</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹ç³»ç»Ÿå‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dmesg  	<span style="color:#75715e"># å‘½ä»¤ç”¨äºæ˜¾ç¤ºå¼€æœºä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>$ uname  	<span style="color:#75715e"># æ‰“å°ç³»ç»Ÿä¿¡æ¯,-m32or64,-rå†…æ ¸ç‰ˆæœ¬,-a(all),-n(æ˜¾ç¤ºä¸»æœºå)hostname å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>$ hostname  	<span style="color:#75715e"># æ˜¾ç¤ºå’Œè®¾ç½®ä¸»æœºåé»˜è®¤æ˜¯æ˜¾ç¤ºä¸»æœºåï¼Œè®¾ç½®ä¸»æœºåå¯ä»¥ hostname åå­—(ä¸´æ—¶ç”Ÿæ•ˆ)</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºã€ä¿®æ”¹æ–‡ä»¶å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vi  	<span style="color:#75715e"># ç¼–è¾‘å™¨ï¼Œä¾‹å­ï¼švi oldboy.txt</span>
</span></span><span style="display:flex;"><span>$ vim  	<span style="color:#75715e"># å¤æ‚ç¼–è¾‘å™¨ï¼ŒåŠŸèƒ½å¤æ‚,é«˜äº®ï¼Œå†™shell/pythonè„šæœ¬ç”¨</span>
</span></span><span style="display:flex;"><span>$ mv  	<span style="color:#75715e"># move ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•</span>
</span></span><span style="display:flex;"><span>$ cp  	<span style="color:#75715e"># copyæ‹·è´æ–‡ä»¶æˆ–ç›®å½•ï¼Œé»˜è®¤ä¸èƒ½æ‹·è´ç›®å½•ï¼Œ</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># -r:é€’å½’ï¼Œç”¨äºå¤åˆ¶ç›®å½•ã€‚-a:ç›¸å½“äº-pdrï¼Œ</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># -p:è¿åŒæ¡£æ¡ˆçš„å±æ€§ä¸€èµ·å¤åˆ¶è¿‡å»ï¼Œè€Œéä½¿ç”¨é»˜è®¤å±æ€§ã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ rm  	<span style="color:#75715e"># remove åˆ é™¤ç›®å½•å’Œæ–‡ä»¶ï¼Œ-f(force)å¼ºåˆ¶ï¼Œ-r(recursive)é€’å½’ã€ç”¨äºåˆ é™¤å¤šçº§ç›®å½•ï¼Œ</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># åˆ é™¤å‘½ä»¤è¦æ…ç”¨ï¼Œéå¸¸å±é™©ï¼Œåˆ é™¤å‰ä¸€å®šè¦å…ˆå¤‡ä»½ä¸€ä»½ã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ touch  	<span style="color:#75715e"># åˆ›å»ºæ–‡ä»¶æˆ–æ›´æ–°æ–‡ä»¶çš„æ—¶é—´æˆ³ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ›å»ºæ–°æ–‡ä»¶ï¼Œ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># å¦‚æœå­˜åœ¨æ”¹å˜æ–‡ä»¶çš„è®¿é—®æ—¶é—´atimeç­‰æ—¶é—´æˆ³ä¿¡æ¯ã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo  	<span style="color:#75715e"># æ‰“å°è¾“å‡ºå†…å®¹ï¼Œé…åˆ &#34;&gt;&#34; æˆ– &#34;&gt;&gt;&#34; å¯ä»¥ä¸ºæ–‡ä»¶è¦†ç›–åŠè¿½åŠ å†…å®¹ï¼Œ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># è¿˜æœ‰ä¸€ä¸ªè¾ƒå¤æ‚ä¸å¸¸ç”¨çš„ç±»ä¼¼å‘½ä»¤printfã€‚-n:ä¸æ¢è¡Œè¾“å‡º,-e:å¯ä»¥ä¸€èµ·ä½¿ç”¨ï¼š-e &#34;\n&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mkdir  	<span style="color:#75715e"># make directorys åˆ›å»ºç›®å½•ï¼Œä¾‹å­ï¼šmkdir /opt/data åœ¨/optç›®å½•ä¸‹åˆ›å»ºdataç›®å½•ï¼Œ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># -pï¼šé€’å½’åˆ›å»ºç›®å½•ã€mkdir -p /opt/{data/conf,logs}ã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ rsync -avz --exclude<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*.out&#39;</span> --delete </span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ç£ç›˜å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ du  	<span style="color:#75715e"># æŸ¥çœ‹æ–‡ä»¶å’Œç›®å½•å¤§å°,-sh</span>
</span></span><span style="display:flex;"><span>$ df  	<span style="color:#75715e"># æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ï¼š-iã€-hã€-Tæ–‡ä»¶ç±»å‹</span>
</span></span><span style="display:flex;"><span>$ dd  	<span style="color:#75715e"># è½¬æ¢æˆ–è€…å¤åˆ¶æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>$ fsck  	<span style="color:#75715e"># ç£ç›˜æ£€æŸ¥</span>
</span></span><span style="display:flex;"><span>$ fdisk  	<span style="color:#75715e"># ç£ç›˜åˆ†åŒºå·¥å…·å°äº2T</span>
</span></span><span style="display:flex;"><span>$ tune2fs  	<span style="color:#75715e"># ä¿®æ”¹æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>$ megacli  	<span style="color:#75715e"># æŸ¥çœ‹raidä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>$ mount  	<span style="color:#75715e"># -t type -o é€‰é¡¹</span>
</span></span><span style="display:flex;"><span>$ umount  	<span style="color:#75715e"># å¸è½½ï¼Œå¼ºåˆ¶å¸è½½ï¼š-lF</span>
</span></span><span style="display:flex;"><span>$ parted  	<span style="color:#75715e"># åˆ†åŒºå·¥å…·ï¼ˆå¸¸ç”¨äº2Tçš„æ–‡ä»¶ç³»ç»Ÿï¼‰</span>
</span></span><span style="display:flex;"><span>$ mkswap  	<span style="color:#75715e"># æ ¼å¼åŒ–swapåˆ†åŒº</span>
</span></span><span style="display:flex;"><span>$ dumpe2fs  	<span style="color:#75715e"># æŸ¥çœ‹extæ–‡ä»¶ç³»ç»Ÿä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>$ dumper2fs  	<span style="color:#75715e"># æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿå†…éƒ¨ä¿¡æ¯(å…ƒæ•°æ®)</span>
</span></span><span style="display:flex;"><span>$ ipmitools  	<span style="color:#75715e"># æŸ¥çœ‹ç¡¬ä»¶ç³»ç»Ÿå·¥å…·</span>
</span></span><span style="display:flex;"><span>$ resize2fs  	<span style="color:#75715e"># è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°ï¼ˆLVM drbdï¼‰</span>
</span></span><span style="display:flex;"><span>$ partprobe  	<span style="color:#75715e"># æŠŠåˆ†åŒºè¡¨çš„ä¿®æ”¹å˜åŒ–é€šçŸ¥å†…æ ¸</span>
</span></span><span style="display:flex;"><span>$ mkfs.ext4  	<span style="color:#75715e"># (mkfs -t ext4 )æ ¼å¼åŒ– -b block -I inode</span>
</span></span><span style="display:flex;"><span>$ swapon/swapoff  	<span style="color:#75715e"># ä½¿ç”¨swapåˆ†åŒºï¼Œä¾‹å¦‚swapon /dev/sdb1</span></span></span></code></pre></div><ul>
<li><code>Linux</code><!-- raw HTML omitted -->ä¸‰å‰‘å®¢<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><a href="http://blog.51yip.com/shell/985.html/comment-page-1#comment-25486" rel="external" target="_self"><code>awk</code>æ˜¯å‘½ä»¤è¿˜æ˜¯ç¼–ç¨‹è¯­è¨€</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tr  	<span style="color:#75715e"># æ›¿æ¢translate or delete characters(é€ä¸ªå­—ç¬¦æ›¿æ¢)</span>
</span></span><span style="display:flex;"><span>$ seq  	<span style="color:#75715e"># sequenceåºåˆ— -sæŒ‡å®šåˆ†éš”ç¬¦,seq -s&#34; &#34; -f&#34;str%03g&#34; 9 11 str009 str010 str011</span>
</span></span><span style="display:flex;"><span>$ sed  	<span style="color:#75715e"># stream editorlinuxä¸‰å‰‘å®¢è€äºŒï¼Œæµç¼–è¾‘å™¨ï¼Œå®ç°å¯¹æ–‡ä»¶çš„å¢åˆ æ”¹æ›¿æ¢æŸ¥ï¼Œ</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># å‚æ•°ï¼š-n:å–æ¶ˆé»˜è®¤è¾“å‡ºï¼Œ-i:ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œ-e:å…è®¸å¤šé¡¹ç¼–è¾‘åŠŸèƒ½ï¼Œ-p:æ‰“å°ï¼Œ</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># sä¸gè”åˆä½¿ç”¨æ—¶,è¡¨ç¤ºå¯¹å½“å‰è¡Œå…¨å±€åŒ¹é…æ›¿æ¢ï¼Œs:å¸¸è¯´çš„æŸ¥æ‰¾å¹¶æ›¿æ¢,ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æ›¿æ¢æˆå¦ä¸€ä¸ª</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># \ï¼šä½¿ç”¨è½¬ä¹‰ç¬¦</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># sed -i s#oldboy#oldgirl#g a.txt #:æ˜¯åˆ†éš”ç¬¦ï¼Œå¯ä»¥ç”¨/@ç­‰æ›¿æ¢ã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -n  <span style="color:#e6db74">&#39;/10\/Sep\/2022:20:00:00/,/10\/Sep\/2022:21:00/p&#39;</span> app.jsonl | awk -F <span style="color:#e6db74">&#39;[&#34;,]+&#39;</span> <span style="color:#e6db74">&#39;{print $10,$13}&#39;</span> |grep -v <span style="color:#ae81ff">200</span> | sort |uniq -c | sort -nr | head -10
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ awk  	<span style="color:#75715e"># è¿‡æ»¤ã€è¾“å‡ºå†…å®¹ï¼Œ$1:ç¬¬ä¸€åˆ—ï¼Œ$2:ç¬¬äºŒåˆ—ä¾æ¬¡ç±»æ¨ï¼Œä½†$0:è¡¨ç¤ºä¸€è¡Œï¼Œ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># NR:è¡Œå·ï¼ŒNF:è¡¨ç¤ºæœ€åç»“å°¾ä¸€åˆ—ï¼Œ-F:æŒ‡å®šåˆ†éš”ç¬¦ã€ä½¿ç”¨ï¼š[]å¯ä»¥è¿‡æ»¤å¤šä¸ªå‚æ•°ï¼Œ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># awk -F &#39;[:]&#39; &#39;NR==1 {print $1,$4,$NF}&#39; /etc/passwd</span>
</span></span><span style="display:flex;"><span>$ awk <span style="color:#e6db74">&#39;$0 &gt;= &#34;2023/12/01 00:00:00&#34; &amp;&amp; $0 &lt;= &#34;2023/12/01 23:59:59&#34;&#39;</span> live_go_chat_pre.log &gt; 2023-12-01.txt
</span></span><span style="display:flex;"><span>$ cat nginx.jsonl | awk -F <span style="color:#e6db74">&#39;&#34;&#39;</span> <span style="color:#e6db74">&#39;{if($50 != &#34;XXXIP&#34; &amp;&amp; $50 == &#34;XXXIP&#34;) {print $0}}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ grep  	<span style="color:#75715e"># linuxä¸‰å‰‘å®¢è€ä¸‰è¿‡æ»¤éœ€è¦çš„å†…å®¹ï¼Œä¾‹å­ï¼šgrep -v oldboy test.txtï¼Œ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># grepä¸€èˆ¬å¸¸ç”¨å‚æ•°:</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -a:åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œä»¥æ–‡ä»¶æ–‡ä»¶çš„æ–¹å¼æœç´ æ•°æ®</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -c:è®¡ç®—æ‰¾åˆ°&#39;æœç´¢å­—ç¬¦ä¸²&#39;çš„æ¬¡æ•°</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -o:ä»…æ˜¾ç¤ºå‡ºåŒ¹é…regexpçš„å†…å®¹(ç”¨äºç»Ÿè®¡å‡ºç°åœ¨æ–‡ä¸­çš„æ¬¡æ•°)</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -i:ä¸åŒºåˆ†å¤§å°å†™ï¼Œæ‰€ä»¥å¤§å°å†™è§†ä¸ºç›¸åŒ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -n:åŒ¹é…çš„å†…å®¹åœ¨å…¶è¡Œé¦–æ˜¾ç¤ºè¡Œå·</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -v:åå‘é€‰æ‹©ï¼Œå³æ˜¾ç¤ºæ²¡æœ‰&#39;æœç´¢å­—ç¬¦ä¸²&#39;å†…å®¹çš„é‚£ä¸€è¡Œ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -E:æ‰©å±•çš„grepï¼Œå³egrep</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -v:åé¢æ¥è¦æ’é™¤çš„å†…å®¹</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -n:å¯¹åŒ¹é…çš„å†…å®¹æ‰“å°è¡Œå·</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -w:æŒ‰å•è¯æœç´¢ï¼Œç›¸å½“äº\ \bã€‚</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># Context control:</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -B:(before)é™¤äº†æ˜¾ç¤ºåŒ¹é…çš„ä¸€è¡Œä¹‹å¤–,å¹¶æ˜¾ç¤ºè¯¥è¡Œä¹‹å‰çš„numè¡Œ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -A:(after)é™¤äº†æ˜¾ç¤ºåŒ¹é…çš„ä¸€è¡Œä¹‹å¤–,å¹¶æ˜¾ç¤ºè¯¥è¡Œä¹‹åçš„numè¡Œ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># -C:(Context)é™¤äº†æ˜¾ç¤ºåŒ¹é…çš„ä¸€è¡Œä¹‹å¤–,å¹¶æ˜¾ç¤ºè¯¥è¡Œä¹‹å‰åå„numè¡Œ</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># --color=auto:å¯¹è¿‡æ»¤çš„åŒ¹é…çš„å­—ç¬¦ä¸²åŠ é¢œè‰²</span>
</span></span><span style="display:flex;"><span>$ sort  	<span style="color:#75715e"># æ’åºå‘½ä»¤ï¼Œ-nï¼šä¾ç…§æ•°å€¼çš„å¤§å°æ’åºï¼Œ-rï¼šä»¥ç›¸åçš„é¡ºåºæ¥æ’åº</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ uniq  	<span style="color:#75715e"># å»é‡å‘½ä»¤ï¼Œ-cæˆ–--count åœ¨æ¯åˆ—æ—è¾¹æ˜¾ç¤ºè¯¥è¡Œé‡å¤å‡ºç°çš„æ¬¡æ•°</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å…¶ä»–å‘½ä»¤<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>:set fileformat<span style="color:#f92672">=</span>unix  	<span style="color:#75715e"># windows æ¢è¡Œç¬¦ç¼“å­˜Linux</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo -e <span style="color:#e6db74">&#34;\033[?25h&#34;</span>  	<span style="color:#75715e"># æ˜¾ç¤ºå…‰æ ‡</span>
</span></span><span style="display:flex;"><span>$ dos2unix bash.sh
</span></span><span style="display:flex;"><span>$ ln  	<span style="color:#75715e"># åˆ›å»ºè½¯ç¡¬è¿æ¥,-sè½¯(readlink)ã€ä¿®æ”¹è½¯è¿æ¥ï¼šln -snf æºæ–‡ä»¶åœ°å€ é“¾æ¥åç§°ï¼Œ ln -s dist_commit proï¼Œln -s dist_commit preï¼Œ </span>
</span></span><span style="display:flex;"><span>$ cut  	<span style="color:#75715e"># åˆ‡å‰² å–åˆ—,-dåˆ†éš”ç¬¦,-få–åˆ—,-cå­—ç¬¦</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar  	<span style="color:#75715e"># z:å‹ç¼©ã€c:å¤‡ä»½ã€v:å±å¹•è¾“å‡ºè¿‡ç¨‹ã€f:æŒ‡å®šå¤‡ä»½æ–‡ä»¶ã€j:bzip2å‹ç¼©/è§£å‹ç¼©ã€</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># x:å½’æ¡£ä¸­æå–æ–‡ä»¶ X N:æ—¥æœŸæ ¼å¼ã€p:ä¿ç•™åŸæ¥çš„æ–‡ä»¶æƒé™ä¸å±æ€§ã€</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># P:ä½¿ç”¨æ–‡ä»¶åçš„ç»å¯¹è·¯å¾„ï¼Œä¸ç§»é™¤æ–‡ä»¶åç§°å‰çš„â€œ/â€å·ã€</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># C:ä»…å‹ç¼©æŒ‡å®šç›®å½•é‡Œçš„å†…å®¹æˆ–è§£å‹ç¼©åˆ°æŒ‡å®šç›®å½•ã€</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># --exclude=/usr/local/nginx/log:æ’é™¤ä¸éœ€è¦æ‰“åŒ…ç›®å½•</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># tar -c --lzma -f nginx-logs.tar.lzma /opt/logs/nginx æé™å‹ç¼©æ ¼å¼</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># tar zcvf /opt/backup/nginx-$(date +%F).tar.gz --exclude=/usr/local/nginx/log nginx å¿½ç•¥log ç›®å½•å‹ç¼©</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget  	<span style="color:#75715e"># ä¸‹è½½ -q å®‰é™ -O æŒ‡å®šæ–‡ä»¶å</span>
</span></span><span style="display:flex;"><span>$ curl  	<span style="color:#75715e"># -IæŸ¥çœ‹å“åº”headerä¿¡æ¯ -så®‰é™çš„ -wè·å–</span>
</span></span><span style="display:flex;"><span>$ lynx  	<span style="color:#75715e"># å‘½ä»¤è¡Œçº¯æ–‡æœ¬æµè§ˆå™¨</span>
</span></span><span style="display:flex;"><span>$ test  	<span style="color:#75715e"># æµ‹è¯•å‘½ä»¤ï¼Œ-f:æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œ-d:æµ‹è¯•ç›®å½•æ˜¯å¦å­˜åœ¨</span>
</span></span><span style="display:flex;"><span>$ crontab  	<span style="color:#75715e"># è®¡åˆ’ä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡æ²¡æ‰§è¡Œéœ€è¦æŸ¥çœ‹æ–‡ä»¶æƒé™ï¼š/var/spool/cron/crontabs/root æ˜¯å¦ä¸ºï¼š600æƒé™ï¼Œä»¥åŠç»„æƒé™æ˜¯å¦å±äºï¼šcrontab</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ split  	<span style="color:#75715e"># æ‰‹åŠ¨åˆ‡å‰²æ—¥å¿—ã€æ–‡ä»¶ï¼Œ-bï¼šæŒ‡å®šæ–‡ä»¶å‹ç¼©åå¤§å°ï¼Œ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># -dï¼šæŒ‡å®šæ–‡ä»¶å‘½åç¼€ä½¿ç”¨æ•°å­—(é»˜è®¤ä½¿ç”¨å­—æ¯)ï¼Œ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># -a 3ï¼šæŒ‡å®šåç¼€æ–‡ä»¶åæ˜¯ä¸‰ä½æ•°ï¼Œä¸¾ä¾‹ï¼š</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># split -b 200M nginx.log -d -a 3 nginx.logï¼ŒæŒ‰ç…§nginx.logåç¼€æ·»åŠ å‘½å</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ diff -c -a -r cms1 cms2  	<span style="color:#75715e"># -a:é€è¡Œæ¯”è¾ƒæ–‡æœ¬æ–‡ä»¶ã€</span>
</span></span><span style="display:flex;"><span>									<span style="color:#75715e"># -c:æ˜¾ç¤ºå…¨éƒ¨å†…æ–‡ï¼Œå¹¶æ ‡å‡ºä¸åŒä¹‹å¤„ã€ </span>
</span></span><span style="display:flex;"><span>									<span style="color:#75715e"># -r:æ¯”è¾ƒå­ç›®å½•ä¸­çš„æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>									
</span></span><span style="display:flex;"><span>$ kill -l  	<span style="color:#75715e"># è·å–kill ä¿¡å·æŒ‡ä»¤</span>
</span></span><span style="display:flex;"><span> 1<span style="color:#f92672">)</span> SIGHUP       2<span style="color:#f92672">)</span> SIGINT       3<span style="color:#f92672">)</span> SIGQUIT      4<span style="color:#f92672">)</span> SIGILL       5<span style="color:#f92672">)</span> SIGTRAP
</span></span><span style="display:flex;"><span> 6<span style="color:#f92672">)</span> SIGABRT      7<span style="color:#f92672">)</span> SIGBUS       8<span style="color:#f92672">)</span> SIGFPE       9<span style="color:#f92672">)</span> SIGKILL     10<span style="color:#f92672">)</span> SIGUSR1
</span></span><span style="display:flex;"><span>11<span style="color:#f92672">)</span> SIGSEGV     12<span style="color:#f92672">)</span> SIGUSR2     13<span style="color:#f92672">)</span> SIGPIPE     14<span style="color:#f92672">)</span> SIGALRM     15<span style="color:#f92672">)</span> SIGTERM
</span></span><span style="display:flex;"><span>16<span style="color:#f92672">)</span> SIGSTKFLT   17<span style="color:#f92672">)</span> SIGCHLD     18<span style="color:#f92672">)</span> SIGCONT     19<span style="color:#f92672">)</span> SIGSTOP     20<span style="color:#f92672">)</span> SIGTSTP
</span></span><span style="display:flex;"><span>21<span style="color:#f92672">)</span> SIGTTIN     22<span style="color:#f92672">)</span> SIGTTOU     23<span style="color:#f92672">)</span> SIGURG      24<span style="color:#f92672">)</span> SIGXCPU     25<span style="color:#f92672">)</span> SIGXFSZ
</span></span><span style="display:flex;"><span>26<span style="color:#f92672">)</span> SIGVTALRM   27<span style="color:#f92672">)</span> SIGPROF     28<span style="color:#f92672">)</span> SIGWINCH    29<span style="color:#f92672">)</span> SIGIO       30<span style="color:#f92672">)</span> SIGPWR
</span></span><span style="display:flex;"><span>31<span style="color:#f92672">)</span> SIGSYS      34<span style="color:#f92672">)</span> SIGRTMIN    35<span style="color:#f92672">)</span> SIGRTMIN+1  36<span style="color:#f92672">)</span> SIGRTMIN+2  37<span style="color:#f92672">)</span> SIGRTMIN+3
</span></span><span style="display:flex;"><span>38<span style="color:#f92672">)</span> SIGRTMIN+4  39<span style="color:#f92672">)</span> SIGRTMIN+5  40<span style="color:#f92672">)</span> SIGRTMIN+6  41<span style="color:#f92672">)</span> SIGRTMIN+7  42<span style="color:#f92672">)</span> SIGRTMIN+8
</span></span><span style="display:flex;"><span>43<span style="color:#f92672">)</span> SIGRTMIN+9  44<span style="color:#f92672">)</span> SIGRTMIN+10 45<span style="color:#f92672">)</span> SIGRTMIN+11 46<span style="color:#f92672">)</span> SIGRTMIN+12 47<span style="color:#f92672">)</span> SIGRTMIN+13
</span></span><span style="display:flex;"><span>48<span style="color:#f92672">)</span> SIGRTMIN+14 49<span style="color:#f92672">)</span> SIGRTMIN+15 50<span style="color:#f92672">)</span> SIGRTMAX-14 51<span style="color:#f92672">)</span> SIGRTMAX-13 52<span style="color:#f92672">)</span> SIGRTMAX-12
</span></span><span style="display:flex;"><span>53<span style="color:#f92672">)</span> SIGRTMAX-11 54<span style="color:#f92672">)</span> SIGRTMAX-10 55<span style="color:#f92672">)</span> SIGRTMAX-9  56<span style="color:#f92672">)</span> SIGRTMAX-8  57<span style="color:#f92672">)</span> SIGRTMAX-7
</span></span><span style="display:flex;"><span>58<span style="color:#f92672">)</span> SIGRTMAX-6  59<span style="color:#f92672">)</span> SIGRTMAX-5  60<span style="color:#f92672">)</span> SIGRTMAX-4  61<span style="color:#f92672">)</span> SIGRTMAX-3  62<span style="color:#f92672">)</span> SIGRTMAX-2</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->è·å–å…¬ç½‘<!-- raw HTML omitted --><code>IP</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl ip.gs
</span></span><span style="display:flex;"><span>$ curl -4 ip.gs
</span></span><span style="display:flex;"><span>$ curl -6 ip.gs
</span></span><span style="display:flex;"><span>$ curl ip.sb
</span></span><span style="display:flex;"><span>$ curl -4 ip.sb
</span></span><span style="display:flex;"><span>$ curl -6 ip.sb
</span></span><span style="display:flex;"><span>$ curl cip.cc
</span></span><span style="display:flex;"><span>$ curl -4 cip.cc
</span></span><span style="display:flex;"><span>$ curl icanhazip.com
</span></span><span style="display:flex;"><span>$ curl -4 icanhazip.com
</span></span><span style="display:flex;"><span>$ curl -6 icanhazip.com
</span></span><span style="display:flex;"><span>$ curl api.ipify.org
</span></span><span style="display:flex;"><span>$ curl -4 api.ipify.org
</span></span><span style="display:flex;"><span>$ curl bot.whatismyipaddress.com
</span></span><span style="display:flex;"><span>$ curl -4 bot.whatismyipaddress.com
</span></span><span style="display:flex;"><span>$ curl -6 bot.whatismyipaddress.com
</span></span><span style="display:flex;"><span>$ curl ipinfo.io/ip
</span></span><span style="display:flex;"><span>$ curl -4 ipinfo.io/ip
</span></span><span style="display:flex;"><span>$ curl ipecho.net/plain
</span></span><span style="display:flex;"><span>$ curl -4 ipecho.net/plain
</span></span><span style="display:flex;"><span>$ curl ipinfo.io
</span></span><span style="display:flex;"><span>$ curl -4 ipinfo.io
</span></span><span style="display:flex;"><span>$ curl -4 myip.ipip.net
</span></span><span style="display:flex;"><span>$ curl -4 ifconfig.me
</span></span><span style="display:flex;"><span>$ curl -4 http://members.3322.org/dyndns/getip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ curl ifconfig.me
</span></span><span style="display:flex;"><span>$ curl icanhazip.com
</span></span><span style="display:flex;"><span>$ curl curlmyip.com
</span></span><span style="display:flex;"><span>$ curl ip.appspot.com
</span></span><span style="display:flex;"><span>$ curl ipinfo.io/ip
</span></span><span style="display:flex;"><span>$ curl ipecho.net/plain
</span></span><span style="display:flex;"><span>$ curl www.trackip.net/i
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¡¥å……</span>
</span></span><span style="display:flex;"><span>$ curl ip.sb
</span></span><span style="display:flex;"><span>$ curl ip.6655.com/ip.aspx
</span></span><span style="display:flex;"><span>$ curl whatismyip.akamai.com
</span></span><span style="display:flex;"><span>$ wget -qO - ifconfig.co
</span></span><span style="display:flex;"><span>$ dig +short myip.opendns.com @resolver1.opendns.com
</span></span><span style="display:flex;"><span>$ curl ident.me
</span></span><span style="display:flex;"><span>$ curl v4.ident.me
</span></span><span style="display:flex;"><span>$ curl v6.ident.me
</span></span><span style="display:flex;"><span>$ curl inet-ip.info
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿”å›IPå’Œåœ°åŒº</span>
</span></span><span style="display:flex;"><span>$ curl ip.6655.com/ip.aspx?area<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>$ curl 1111.ip138.com/ic.asp
</span></span><span style="display:flex;"><span>$ curl ip.cn
</span></span><span style="display:flex;"><span>$ curl cip.cc</span></span></code></pre></div><ul>
<li><code>history</code>å†å²å‘½ä»¤æ·»åŠ æ—¶é—´</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ˜¾ç¤ºæ—¶é—´</span>
</span></span><span style="display:flex;"><span>export HISTTIMEFORMAT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;%F %T&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¯¦ç»†æ˜¾ç¤º</span>
</span></span><span style="display:flex;"><span>export HISTTIMEFORMAT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;%F %T </span><span style="color:#66d9ef">$(</span>who -u 2&gt;/dev/null | awk <span style="color:#e6db74">&#39;{print $NF}&#39;</span>| sed <span style="color:#e6db74">&#39;s/[()]//g&#39;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74"> </span><span style="color:#66d9ef">$(</span>whoami<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_cloud_foundry">Install_Cloud_Foundry</h1>

<h2 id="heading"></h2>
<blockquote>
<ul>
<li>
<p><a href="https://docs.cloudfoundry.org/#read-the-docs" rel="external" target="_self"><code>Cloud Foundry</code></a></p>
<p><code>Cloud Foundr</code>yæ˜¯ä¸€ä¸ªå¼€æºçš„å¹³å°å³æœåŠ¡<code>PaaS</code>ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œå¯ä»¥è®©å¼€å‘è€…ä½¿ç”¨ä»»ä½•è¯­è¨€ã€æ¡†æ¶å’Œå·¥å…·ï¼Œåœ¨ä»»ä½•äº‘ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚ å®ƒçš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š 1. å¤šäº‘æ”¯æŒï¼š<code>Cloud Foundry</code>æ”¯æŒå¤šç§ä¸åŒçš„äº‘å¹³å°ï¼ŒåŒ…æ‹¬<code>Amazon Web Servicesï¼ˆAWSï¼‰</code>ã€<code>Google Cloud Platformï¼ˆGCPï¼‰</code>ã€<code>Microsoft Azure</code>ã€<code>IBM Cloud</code>ã€<code>OpenStack</code>å’Œ<code>VMWare vSphere</code>ç­‰ã€‚ 2. è‡ªåŠ¨ä¼¸ç¼©ï¼š<code>Cloud Foundry</code>å¯ä»¥è‡ªåŠ¨ä¼¸ç¼©ï¼Œæ ¹æ®è´Ÿè½½æƒ…å†µå¢åŠ æˆ–å‡å°‘å®ä¾‹æ•°é‡ï¼Œä»¥ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚ 3. å¯é çš„è¿è¡Œæ—¶ç¯å¢ƒï¼š<code>Cloud Foundry</code>æœ‰ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œå¯ä»¥åœ¨å¤šä¸ªäº‘ä¸Šæä¾›ç¨³å®šçš„æœåŠ¡ã€‚ 4. äº‘æœåŠ¡æ”¯æŒï¼š<code>Cloud Foundry</code>æ”¯æŒå¤šç§ä¸åŒçš„äº‘æœåŠ¡ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€å­˜å‚¨ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç›‘æ§ç­‰ï¼Œå¯ä»¥è®©å¼€å‘è€…æ›´æ–¹ä¾¿å¿«æ·åœ°éƒ¨ç½²å’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚ 5. ç®€åŒ–å¼€å‘æµç¨‹ï¼š<code>Cloud Foundry</code>æä¾›äº†ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„å‘½ä»¤è¡Œç•Œé¢ï¼Œå¯ä»¥è®©å¼€å‘è€…è½»æ¾çš„éƒ¨ç½²å’Œç®¡ç†åº”ç”¨ç¨‹åºï¼Œç®€åŒ–å¼€å‘æµç¨‹</p>
</li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          </section>
          </section>
        </div>
      </main>
    </div>
    <script src="../../js/clipboard.min.js?1727790691" defer></script>
    <script src="../../js/perfect-scrollbar.min.js?1727790691" defer></script>
    <script src="../../js/d3/d3-color.min.js?1727790691" defer></script>
    <script src="../../js/d3/d3-dispatch.min.js?1727790691" defer></script>
    <script src="../../js/d3/d3-drag.min.js?1727790691" defer></script>
    <script src="../../js/d3/d3-ease.min.js?1727790691" defer></script>
    <script src="../../js/d3/d3-interpolate.min.js?1727790691" defer></script>
    <script src="../../js/d3/d3-selection.min.js?1727790691" defer></script>
    <script src="../../js/d3/d3-timer.min.js?1727790691" defer></script>
    <script src="../../js/d3/d3-transition.min.js?1727790691" defer></script>
    <script src="../../js/d3/d3-zoom.min.js?1727790691" defer></script>
    <script src="../../js/js-yaml.min.js?1727790691" defer></script>
    <script src="../../js/mermaid.min.js?1727790691" defer></script>
    <script>
      window.themeUseMermaid = JSON.parse("{ \"securityLevel\": \"loose\" }");
    </script>
    <script src="../../js/theme.js?1727790691" defer></script>
  </body>
</html>
