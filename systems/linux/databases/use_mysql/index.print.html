<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="æ•°æ®åº“ä½¿ç”¨ æ•°æ®ç»“æ„å¯è§†åŒ– æ•°æ®ç»“æ„å¯è§†åŒ– æ•°æ®åº“è¿æ¥å·¥å…· åç§°åœ°å€ æè¿° WorkBenCh MySQLäº§å“æ¡£æ¡ˆ ä¸‹è½½MySQL-8.0çš„ç´¢å¼• Mysqlæ·±å…¥å­¦ä¹ ç¬”è®° SQLyogæ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…· DBeaveræ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…· Mysql WorkBenChèœå•ä¸­æ–‡æ±‰åŒ– Navicat Premium 15å®‰è£…ä¸æ¿€æ´» Navicat Premium 16ä¸‹è½½ä¸å®‰è£…ç ´è§£æ•™ç¨‹ ä½¿ç”¨é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶åœ¨Unix/Linux å®‰è£…MySQL Navicat Premium 15æ°¸ä¹…ç ´è§£æ¿€æ´»å·¥å…·åŠå®‰è£…æ•™ç¨‹ æ•°æ®åº“å¸¸ç”¨å‘½ä»¤ æ•°æ®åº“å‘½ä»¤ è¯´æ˜ ä¸¾ä¾‹ select ä»æ•°æ®åº“ä¸­æå–æ•°æ® æŸ¥çœ‹ç”¨æˆ·æ•°æ®ï¼šselect user,host from mysql.">
    <meta name="author" content="äºŒå“¥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/s2-1.png">
    <meta name="twitter:title" content="Use_Mysql :: Hugo Relearn Theme">
    <meta name="twitter:description" content="æ•°æ®åº“ä½¿ç”¨ æ•°æ®ç»“æ„å¯è§†åŒ– æ•°æ®ç»“æ„å¯è§†åŒ– æ•°æ®åº“è¿æ¥å·¥å…· åç§°åœ°å€ æè¿° WorkBenCh MySQLäº§å“æ¡£æ¡ˆ ä¸‹è½½MySQL-8.0çš„ç´¢å¼• Mysqlæ·±å…¥å­¦ä¹ ç¬”è®° SQLyogæ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…· DBeaveræ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…· Mysql WorkBenChèœå•ä¸­æ–‡æ±‰åŒ– Navicat Premium 15å®‰è£…ä¸æ¿€æ´» Navicat Premium 16ä¸‹è½½ä¸å®‰è£…ç ´è§£æ•™ç¨‹ ä½¿ç”¨é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶åœ¨Unix/Linux å®‰è£…MySQL Navicat Premium 15æ°¸ä¹…ç ´è§£æ¿€æ´»å·¥å…·åŠå®‰è£…æ•™ç¨‹ æ•°æ®åº“å¸¸ç”¨å‘½ä»¤ æ•°æ®åº“å‘½ä»¤ è¯´æ˜ ä¸¾ä¾‹ select ä»æ•°æ®åº“ä¸­æå–æ•°æ® æŸ¥çœ‹ç”¨æˆ·æ•°æ®ï¼šselect user,host from mysql.">
    <meta property="og:url" content="https://erge.blog/systems/linux/databases/use_mysql/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Use_Mysql :: Hugo Relearn Theme">
    <meta property="og:description" content="æ•°æ®åº“ä½¿ç”¨ æ•°æ®ç»“æ„å¯è§†åŒ– æ•°æ®ç»“æ„å¯è§†åŒ– æ•°æ®åº“è¿æ¥å·¥å…· åç§°åœ°å€ æè¿° WorkBenCh MySQLäº§å“æ¡£æ¡ˆ ä¸‹è½½MySQL-8.0çš„ç´¢å¼• Mysqlæ·±å…¥å­¦ä¹ ç¬”è®° SQLyogæ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…· DBeaveræ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…· Mysql WorkBenChèœå•ä¸­æ–‡æ±‰åŒ– Navicat Premium 15å®‰è£…ä¸æ¿€æ´» Navicat Premium 16ä¸‹è½½ä¸å®‰è£…ç ´è§£æ•™ç¨‹ ä½¿ç”¨é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶åœ¨Unix/Linux å®‰è£…MySQL Navicat Premium 15æ°¸ä¹…ç ´è§£æ¿€æ´»å·¥å…·åŠå®‰è£…æ•™ç¨‹ æ•°æ®åº“å¸¸ç”¨å‘½ä»¤ æ•°æ®åº“å‘½ä»¤ è¯´æ˜ ä¸¾ä¾‹ select ä»æ•°æ®åº“ä¸­æå–æ•°æ® æŸ¥çœ‹ç”¨æˆ·æ•°æ®ï¼šselect user,host from mysql.">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Systems">
    <meta property="article:published_time" content="2024-06-17T19:50:04+08:00">
    <meta property="article:modified_time" content="2024-06-17T19:50:04+08:00">
    <meta property="og:image" content="https://erge.blog/images/s2-1.png">
    <meta itemprop="name" content="Use_Mysql :: Hugo Relearn Theme">
    <meta itemprop="description" content="æ•°æ®åº“ä½¿ç”¨ æ•°æ®ç»“æ„å¯è§†åŒ– æ•°æ®ç»“æ„å¯è§†åŒ– æ•°æ®åº“è¿æ¥å·¥å…· åç§°åœ°å€ æè¿° WorkBenCh MySQLäº§å“æ¡£æ¡ˆ ä¸‹è½½MySQL-8.0çš„ç´¢å¼• Mysqlæ·±å…¥å­¦ä¹ ç¬”è®° SQLyogæ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…· DBeaveræ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…· Mysql WorkBenChèœå•ä¸­æ–‡æ±‰åŒ– Navicat Premium 15å®‰è£…ä¸æ¿€æ´» Navicat Premium 16ä¸‹è½½ä¸å®‰è£…ç ´è§£æ•™ç¨‹ ä½¿ç”¨é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶åœ¨Unix/Linux å®‰è£…MySQL Navicat Premium 15æ°¸ä¹…ç ´è§£æ¿€æ´»å·¥å…·åŠå®‰è£…æ•™ç¨‹ æ•°æ®åº“å¸¸ç”¨å‘½ä»¤ æ•°æ®åº“å‘½ä»¤ è¯´æ˜ ä¸¾ä¾‹ select ä»æ•°æ®åº“ä¸­æå–æ•°æ® æŸ¥çœ‹ç”¨æˆ·æ•°æ®ï¼šselect user,host from mysql.">
    <meta itemprop="datePublished" content="2024-06-17T19:50:04+08:00">
    <meta itemprop="dateModified" content="2024-06-17T19:50:04+08:00">
    <meta itemprop="wordCount" content="2988">
    <meta itemprop="image" content="https://erge.blog/images/s2-1.png">
    <title>Use_Mysql :: Hugo Relearn Theme</title>
    <link href="../../../../images/favicon.ico?1723803344" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../../css/fontawesome-all.min.css?1723803345" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/fontawesome-all.min.css?1723803345" rel="stylesheet"></noscript>
    <link href="../../../../css/nucleus.css?1723803345" rel="stylesheet">
    <link href="../../../../css/auto-complete.css?1723803345" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/auto-complete.css?1723803345" rel="stylesheet"></noscript>
    <link href="../../../../css/perfect-scrollbar.min.css?1723803345" rel="stylesheet">
    <link href="../../../../css/fonts.css?1723803345" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/fonts.css?1723803345" rel="stylesheet"></noscript>
    <link href="../../../../css/theme.css?1723803345" rel="stylesheet">
    <link href="../../../../css/theme-relearn-auto.css?1723803345" rel="stylesheet" id="R-variant-style">
    <link href="../../../../css/chroma-relearn-auto.css?1723803345" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../../css/variant.css?1723803345" rel="stylesheet">
    <link href="../../../../css/print.css?1723803345" rel="stylesheet" media="print">
    <link href="../../../../css/format-print.css?1723803345" rel="stylesheet">
    <script src="../../../../js/variant.js?1723803345"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../../systems/linux/databases/use_mysql/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/linux/databases/"><span itemprop="name">Databases</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Use_Mysql</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../../systems/linux/databases/install_canal/" title="Install_Canal (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../../systems/linux/databases/install_mysql/" title="Install_Mysql (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_mysql">Use_Mysql</h1>

<h1 id="æ•°æ®åº“ä½¿ç”¨">æ•°æ®åº“ä½¿ç”¨</h1>
<h2 id="æ•°æ®ç»“æ„å¯è§†åŒ–">æ•°æ®ç»“æ„å¯è§†åŒ–</h2>
<blockquote>
<ul>
<li><a href="https://www.cs.usfca.edu/~galles/visualization/" rel="external" target="_self">æ•°æ®ç»“æ„å¯è§†åŒ–</a></li>
</ul>
</blockquote>
<hr>
<h2 id="æ•°æ®åº“è¿æ¥å·¥å…·">æ•°æ®åº“è¿æ¥å·¥å…·</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://downloads.mysql.com/archives/workbench/" rel="external" target="_self"><code>WorkBenCh</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://downloads.mysql.com/archives/community/" rel="external" target="_self"><code>MySQL</code>äº§å“æ¡£æ¡ˆ</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://mirrors.cloud.tencent.com/mysql/downloads/MySQL-8.0/" rel="external" target="_self">ä¸‹è½½<code>MySQL-8.0</code>çš„ç´¢å¼•</a></td>
<td></td>
</tr>
<tr>
<td><a href="http://www.notedeep.com/page/282" rel="external" target="_self"><code>Mysql</code>æ·±å…¥å­¦ä¹ ç¬”è®°</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://sqlyog.softonic.cn/" rel="external" target="_self"><code>SQLyog</code>æ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…·</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://dbeaver.io/download/" rel="external" target="_self"><code>DBeaver</code>æ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…·</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/pifeifei/mysql-workbench-zh-cn" rel="external" target="_self"><code>Mysql WorkBenCh</code>èœå•ä¸­æ–‡æ±‰åŒ–</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.jianshu.com/p/4113cd5ef139" rel="external" target="_self"><code>Navicat Premium 15</code>å®‰è£…ä¸æ¿€æ´»</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://learnku.com/articles/67706" rel="external" target="_self"><code>Navicat Premium 16</code>ä¸‹è½½ä¸å®‰è£…ç ´è§£æ•™ç¨‹</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/8.0/en/binary-installation.html" rel="external" target="_self">ä½¿ç”¨é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶åœ¨<code>Unix/Linux </code>å®‰è£…<code>MySQL</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.jianshu.com/p/523c132006aa" rel="external" target="_self"><code>Navicat Premium 15</code>æ°¸ä¹…ç ´è§£æ¿€æ´»å·¥å…·åŠå®‰è£…æ•™ç¨‹</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="æ•°æ®åº“å¸¸ç”¨å‘½ä»¤">æ•°æ®åº“å¸¸ç”¨å‘½ä»¤</h2>
<blockquote>
<table>
<thead>
<tr>
<th>æ•°æ®åº“å‘½ä»¤</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>select</code></td>
<td>ä»æ•°æ®åº“ä¸­æå–æ•°æ®</td>
<td>æŸ¥çœ‹ç”¨æˆ·æ•°æ®ï¼š<code>select user,host from mysql.user \G;</code></td>
</tr>
<tr>
<td><code>update</code></td>
<td>æ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®</td>
<td></td>
</tr>
<tr>
<td><code>delete</code></td>
<td>ä»æ•°æ®åº“ä¸­åˆ é™¤æ•°æ®</td>
<td></td>
</tr>
<tr>
<td><code>insert into</code></td>
<td>å‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ®</td>
<td>æ’å…¥æ•°æ®ï¼š<code>insert into tiantian.tt1 values(1,'lisi');</code></td>
</tr>
<tr>
<td><code>create database</code></td>
<td>åˆ›å»ºæ–°æ•°æ®åº“</td>
<td>åˆ›å»ºæ•°æ®åº“ï¼š<code>create database tiantian;</code></td>
</tr>
<tr>
<td><code>alter database</code></td>
<td>æ›´æ”¹æ•°æ®åº“</td>
<td></td>
</tr>
<tr>
<td><code>create table</code></td>
<td>åˆ›å»ºè¡¨</td>
<td>åˆ›å»ºæ•°æ®è¡¨ï¼š<code>create table tiantian.tt1(id int, name varchar(50));</code></td>
</tr>
<tr>
<td><code>alter table</code></td>
<td>æ›´æ”¹è¡¨</td>
<td></td>
</tr>
<tr>
<td><code>drop table</code></td>
<td>åˆ é™¤è¡¨</td>
<td></td>
</tr>
<tr>
<td><code>create index</code></td>
<td>åˆ›å»ºç´¢å¼•(æœç´¢é”®)</td>
<td></td>
</tr>
<tr>
<td><code>drop index</code></td>
<td>åˆ é™¤ç´¢å¼•</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>Where</code>è¯­å¥ä¸­çš„è¿ç®—ç¬¦</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>=</code></td>
<td>ç­‰äº</td>
<td></td>
</tr>
<tr>
<td><code>&lt;&gt;</code></td>
<td>ä¸ç­‰äºï¼šåœ¨<code>SQL</code>çš„ä¸€äº›ç‰ˆæœ¬ä¸­ï¼Œæ”¹æ“ä½œç¬¦è¢«å†™æˆ<code>!=</code></td>
<td></td>
</tr>
<tr>
<td><code>&gt;</code></td>
<td>å¤§äº</td>
<td></td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td>å°äº</td>
<td></td>
</tr>
<tr>
<td><code>&gt;=</code></td>
<td>å¤§äºç­‰äº</td>
<td></td>
</tr>
<tr>
<td><code>&lt;=</code></td>
<td>å°äºç­‰äº</td>
<td></td>
</tr>
<tr>
<td><code>BETWEEN</code></td>
<td>åœ¨æŸä¸ªèŒƒå›´å†…</td>
<td></td>
</tr>
<tr>
<td><code>LIKE</code></td>
<td>æœç´¢æŸç§æ¨¡å¼</td>
<td></td>
</tr>
<tr>
<td><code>IN</code></td>
<td>æŒ‡å®šé’ˆå¯¹æŸä¸ªåˆ—çš„å¤šä¸ªå¯èƒ½å€¼</td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="æŸ¥è¯¢è¿æ¥æ•°">æŸ¥è¯¢è¿æ¥æ•°</h3>
<blockquote>
<ul>
<li>
<!-- raw HTML omitted -->
</li>
<li><strong>æŸ¥çœ‹å½“å‰æ´»åŠ¨çº¿ç¨‹çŠ¶æ€</strong></li>
</ul>
<blockquote>
<ul>
<li><code>Threads_cached</code><!-- raw HTML omitted -->ç¼“å­˜çš„çº¿ç¨‹æ•°é‡ï¼Œè¿™äº›çº¿ç¨‹å¤„äºç¡çœ çŠ¶æ€ä»¥å¤‡å¤ç”¨<!-- raw HTML omitted --></li>
<li><code>Threads_connected</code><!-- raw HTML omitted -->å½“å‰æ‰“å¼€çš„è¿æ¥æ•°<!-- raw HTML omitted --></li>
<li><code>Threads_created</code><!-- raw HTML omitted -->ä¸ºå¤„ç†è¿æ¥è€Œåˆ›å»ºçš„çº¿ç¨‹æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> status <span style="color:#66d9ef">like</span>  <span style="color:#e6db74">&#39;Threads%&#39;</span>; </span></span></code></pre></div><ul>
<li>å¦‚æœ<code>Threads_created</code>å¾ˆå¤§ï¼Œæ‚¨å¯èƒ½éœ€è¦å¢åŠ <code>thread_cache_size</code>çš„å€¼ã€‚ç¼“å­˜å¤±è¯¯ç‡å¯ä»¥é€šè¿‡<code>Threads_created/Connections</code>è®¡ç®—</li>
</ul>
</blockquote>
<ul>
<li><strong>æ˜¾ç¤ºç”¨æˆ·æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> full processlist;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æŸ¥çœ‹æœ€å¤§é“¾æ¥æ•°</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%max_connections%&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸´æ—¶å¢åŠ è¿æ¥æ•°ï¼Œé…ç½®æ–‡ä»¶å¢åŠ å‚æ•°ï¼šmax_connections=4000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> GLOBAL max_connections<span style="color:#f92672">=</span><span style="color:#ae81ff">4000</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æŸ¥çœ‹è¿æ¥çš„ç”¨æˆ·å’Œ</strong><code>IP</code><strong>ä»¥åŠè¶…æ—¶æ—¶é—´</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹è¿æ¥çš„ç”¨æˆ·å’ŒIPä»¥åŠè¶…æ—¶æ—¶é—´ï¼Œæˆ–è€…ä½¿ç”¨ï¼šcount(*) ç»Ÿè®¡æ€»ç»Ÿè¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> information_schema.processlist;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>çœ‹è¿æ¥çš„ç”¨æˆ·å’Œæ¯ä¸ª</strong><code>IP</code><strong>çš„è¿æ¥æ€»æ•°åœ°å€</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">substring_index</span>(host, <span style="color:#e6db74">&#39;:&#39;</span>,<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">AS</span> host_ip,<span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>,db,state,<span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">FROM</span> information_schema.processlist <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> state,host_ip,<span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>,db;</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="æŸ¥è¯¢æ…¢è¯­å¥">æŸ¥è¯¢æ…¢è¯­å¥</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢å ç”¨è¶…æ—¶æ…¢è¯­å¥
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> information_schema.processlist <span style="color:#66d9ef">where</span> Command <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;Sleep&#39;</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">Time</span> <span style="color:#66d9ef">desc</span> <span style="color:#960050;background-color:#1e0010">\</span>G;</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ä¸‰ç§ä¿®æ”¹å¯†ç æ–¹å¼">ä¸‰ç§ä¿®æ”¹å¯†ç æ–¹å¼</h3>
<blockquote>
<ul>
<li><strong>ç¬¬ä¸€ç§ä¿®æ”¹æ–¹å¼ï¼Œ</strong><code>8.0</code><strong>ç”¨æ­¤æ–¹æ³•</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123&#39;</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">with</span> mysql_native_password <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;newpassword&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>ç¬¬äºŒç§ä¿®æ”¹æ–¹å¼</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> password <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span><span style="color:#f92672">=</span><span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#39;newpassword&#39;</span>);</span></span></code></pre></div></blockquote>
<ul>
<li><strong>ç¬¬ä¸‰ç§ä¿®æ”¹æ–¹å¼</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> mysql.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">set</span> authentication_string<span style="color:#f92672">=</span><span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#39;123qwe&#39;</span>) <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;root&#39;</span> <span style="color:#66d9ef">and</span> Host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;localhost&#39;</span>; </span></span></code></pre></div></blockquote>
<ul>
<li><strong>æ›´æ”¹å¯†ç ä¸º</strong><code>123456</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> destoon_member <span style="color:#66d9ef">set</span> password<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">â€™</span><span style="color:#ae81ff">14</span>e1b600b1fd579f47433b88e8d85291<span style="color:#960050;background-color:#1e0010">â€²</span> <span style="color:#66d9ef">where</span>
</span></span><span style="display:flex;"><span>username<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">â€™</span>admin<span style="color:#960050;background-color:#1e0010">â€™</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>å¿˜è®°æ•°æ®åº“å¯†ç </strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> cat <span style="color:#f92672">&gt;/</span>etc<span style="color:#f92672">/</span>my.cnf<span style="color:#f92672">&lt;&lt;-</span>EOF
</span></span><span style="display:flex;"><span>[mysqld]  	<span style="color:#75715e"># åœ¨é…ç½®æ–‡ä»¶ä¸­æœ€ä¸Šé¢æ·»åŠ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>skip<span style="color:#f92672">-</span><span style="color:#66d9ef">grant</span><span style="color:#f92672">-</span><span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span>EOF
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡å¯mysqlæœåŠ¡  ç›´æ¥ä½¿ç”¨ mysql -uroot -p ä¸è¾“å…¥å¯†ç ç›´æ¥å›è½¦è¿›å…¥ ä¿®æ”¹å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">set</span> authentication_string<span style="color:#f92672">=</span><span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#39;root&#39;</span>);</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="æ•°æ®åº“å¤‡ä»½è¿˜åŸ">æ•°æ®åº“å¤‡ä»½ã€è¿˜åŸ</h3>
<h4 id="å¤‡ä»½">å¤‡ä»½</h4>
<ul>
<li>
<ol>
<li><strong>ä½¿ç”¨<code>mysqldump</code>å¤‡ä»½æ•°æ®åº“</strong></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><strong>æ‰‹åŠ¨å¤‡ä»½</strong></li>
</ul>
<blockquote>
<ul>
<li><code>--all-databases</code><!-- raw HTML omitted -->å¤‡ä»½æ‰€æœ‰æ•°æ®åº“<!-- raw HTML omitted --></li>
<li><code>-B, --databases</code><!-- raw HTML omitted -->å¤‡ä»½æ—¶æŒ‡å®šæ•°æ®åº“<!-- raw HTML omitted --></li>
<li><code>--tables</code><!-- raw HTML omitted -->å¤‡ä»½æ—¶æŒ‡å®šæ•°æ®è¡¨<!-- raw HTML omitted --></li>
<li><code> --triggers</code><!-- raw HTML omitted -->åœ¨å¤‡ä»½æ—¶åŒ…æ‹¬è§¦å‘å™¨<!-- raw HTML omitted --></li>
<li><code>--routines</code><!-- raw HTML omitted -->åœ¨å¤‡ä»½æ—¶åŒ…æ‹¬å­˜å‚¨è¿‡ç¨‹<!-- raw HTML omitted --></li>
<li><code>--events</code><!-- raw HTML omitted -->åœ¨å¤‡ä»½æ—¶åŒ…æ‹¬äº‹ä»¶<!-- raw HTML omitted --></li>
<li><code>-S, --socket</code><!-- raw HTML omitted -->æœåŠ¡å™¨é€šä¿¡æ—¶è¦ä½¿ç”¨çš„å¥—æ¥å­—æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>--flush-logs</code>å‚æ•°ç”¨äºåœ¨å¤‡ä»½ä¹‹å‰åˆ·æ–°<code>MySQL</code>çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œç¡®ä¿å¤‡ä»½åŒ…å«æœ€æ–°çš„æ•°æ®æ›´æ–°</li>
<li><code>--skip-lock-tables</code>å‚æ•°å…è®¸åœ¨å¯¼å‡º<code>MySQL</code>æ•°æ®åº“è¡¨æ—¶è·³è¿‡å¯¹è¡¨çš„é”å®šæ“ä½œï¼Œé€‚ç”¨äºéœ€è¦æœ€å°åŒ–æ•°æ®åº“åœæœºæ—¶é—´æˆ–å¯¹å¯¼å‡ºè¿‡ç¨‹å½±å“è¾ƒå°çš„æƒ…å†µ</li>
<li><code>--lock-tables=false</code><!-- raw HTML omitted -->ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œ<!-- raw HTML omitted --><code>mysqldump</code> <!-- raw HTML omitted -->ä¼šé”å®šè¡¨ï¼Œä»¥ç¡®ä¿å¤‡ä»½çš„ä¸€è‡´æ€§ã€‚å¦‚æœä½ ä¸éœ€è¦é”å®šè¡¨ï¼Œå¯ä»¥ä½¿ç”¨<!-- raw HTML omitted --><code>--lock-tables=false</code><!-- raw HTML omitted -->å‚æ•°<!-- raw HTML omitted --></li>
<li><code>--column-statistics=0</code><!-- raw HTML omitted -->ï¼šç¦ç”¨ç»Ÿè®¡ä¿¡æ¯ï¼Œåœ¨<!-- raw HTML omitted --><code>MySQL8</code><!-- raw HTML omitted -->é»˜è®¤æƒ…å†µä¸‹ï¼Œå°è¯•æ”¶é›†æ¯ä¸ªåˆ—çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè¿™äº›ç»Ÿè®¡ä¿¡æ¯åŒ…æ‹¬æ¯ä¸ªåˆ—çš„æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼å’Œæ ‡å‡†å·®ç­‰ï¼Œä»¥ä¾¿ä¼˜åŒ–æŸ¥è¯¢è®¡åˆ’å’Œæ‰§è¡Œ<!-- raw HTML omitted --></li>
<li><code>--no-autocommit</code> å‚æ•°ç¦ç”¨è‡ªåŠ¨æäº¤æ¨¡å¼ï¼Œåœ¨å¤‡ä»½è¿‡ç¨‹ä¸­ä½¿ç”¨äº‹åŠ¡æ¥ç¡®ä¿å¤‡ä»½çš„ä¸€è‡´æ€§ï¼Œå¹¶å‡å°‘å¯¹æ•°æ®åº“çš„é”å®šæ—¶é—´ã€‚</li>
<li><code>--master-data</code> å‚æ•°åœ¨å¤‡ä»½è¾“å‡ºä¸­åŒ…å«äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åå’Œä½ç½®ä¿¡æ¯ï¼Œå¯¹äºä¸»ä»å¤åˆ¶ç¯å¢ƒä¸­çš„æ•°æ®åº“æ¢å¤å°¤å…¶æœ‰ç”¨</li>
<li><code>--single-transaction</code> å‚æ•°ç”¨äºä½¿ç”¨å•ä¸ªäº‹åŠ¡è¿›è¡Œå¤‡ä»½ï¼Œé€‚ç”¨äº InnoDB å­˜å‚¨å¼•æ“ï¼Œé¿å…äº†å¤‡ä»½æœŸé—´çš„é”è¡¨æ“ä½œã€‚</li>
<li><code>--set-gtid-purged=OFF</code><!-- raw HTML omitted -->ï¼šå¦‚æœæºåº“å¼€å¯äº†<!-- raw HTML omitted --><code>GTID</code><!-- raw HTML omitted -->ç‰¹æ€§ï¼Œä½¿ç”¨<!-- raw HTML omitted --><code>mysqldump</code><!-- raw HTML omitted -->å¯¼å‡ºæ•°æ®æ—¶ï¼Œå­˜åœ¨éœ€è¦<!-- raw HTML omitted --><code>super</code><!-- raw HTML omitted -->æƒé™æ‰§è¡Œçš„è¯­å¥ï¼š<!-- raw HTML omitted --><code>SET @@SESSION.SQL_LOG_BIN= 0;</code>ï¼Œ<code>SET @@GLOBAL.GTID_PURGED=Â´18f9a804-343b-11e5-a21d-b083fed01601:1-2;</code></li>
<li><strong>å¤‡ä»½ç”¨æˆ·æƒé™</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">SELECT</span>,RELOAD,<span style="color:#66d9ef">LOCK</span> <span style="color:#66d9ef">TABLES</span>,REPLICATION CLIENT,<span style="color:#66d9ef">SHOW</span> VIEW,EVENT,<span style="color:#66d9ef">TRIGGER</span>,PROCESS <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;backup&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;passwoord&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>å¤‡ä»½å¤šä¸ªæ•°æ®åº“</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /bin/mysql -u root -p<span style="color:#e6db74">&#39;password&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /tmp/mysqld.sock  -e <span style="color:#e6db74">&#39;show databases;&#39;</span>| <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>grep -E -v <span style="color:#e6db74">&#34;sys|mysql|information_schema|performance_schema|Database&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>|grep -E <span style="color:#e6db74">&#34;.*datebases1</span>$<span style="color:#e6db74">|.*datebases2</span>$<span style="color:#e6db74">&#34;</span> | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>xargs /bin/mysqldump -u root -p<span style="color:#e6db74">&#39;password&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /tmp/mysqld.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--single-transaction --no-autocommit <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> --skip-lock-tables --databases &gt;<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>-datebases_name.sql</span></span></code></pre></div></blockquote>
<ul>
<li><strong>å¯¼å‡ºå…¨éƒ¨åº“</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqldump -uroot -p<span style="color:#e6db74">&#39;passowrd&#39;</span> --all-databases &gt; /tmp/all_databases.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysqldump -u root -p<span style="color:#e6db74">&#39;passowrd&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /tmp/mysqld.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--all-databases --lock-tables<span style="color:#f92672">=</span>false <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--routines --single_transaction --flush-logs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--skip-lock-tables --master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| gzip &gt;/tmp/mysql-all-<span style="color:#e6db74">`</span>date +%F_%H%M%S<span style="color:#e6db74">`</span>.sql.gz </span></span></code></pre></div></blockquote>
<ul>
<li><strong>å¯¼å‡ºå•ä¸ªåº“</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqldump -uroot -p --databases databases_name &gt; /tmp/databases_name.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /bin/mysqldump -uroot -p<span style="color:#e6db74">&#39;passowrd&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--set-gtid-purged<span style="color:#f92672">=</span>OFF --single-transaction <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> --flush-logs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /tmp/mysqld.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--databases database_name | gzip &gt;/tmp/database<span style="color:#e6db74">`</span>date +%F_%H%M%S<span style="color:#e6db74">`</span>.sql.gz</span></span></code></pre></div></blockquote>
<ul>
<li><strong>å¯¼å‡ºæŒ‡å®šè¡¨</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqldump -uroot -p --databases databases_name --tables tables_name &gt; /tmp/databases_name_tables_name.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ bin/mysql -u root -p<span style="color:#e6db74">&#39;password&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /tmp/mysqld.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e <span style="color:#e6db74">&#39;select table_name from information_schema.tables where table_schema like &#34;game\-center\_ali&#34;;&#39;</span>|egrep <span style="color:#e6db74">&#34;.*record&#34;</span> | xargs /bin/mysqldump -u root -p<span style="color:#e6db74">&#39;password&#39;</span> -S /tmp/mysqld.sock  --databases databases_name --tables tables_name &gt;/tmp/tables_name.sql</span></span></code></pre></div></blockquote>
<ul>
<li><strong>å¯¼å‡ºè¡¨ç»“æ„åŠ <code>-d</code>å‚æ•°</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /bin/mysqldump -d -uroot -p<span style="color:#e6db74">&#39;passowrd&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /opt/data/data_3306/mysql.sock --databases database_name &gt; database_name.sql</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><strong>ä½¿ç”¨<code>Mysql</code>è„šæœ¬å¤‡ä»½å¹¶é€šçŸ¥<code>Telegram</code></strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/script/Backup_Mysql.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATA=$(date +%F_%H%M%S)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## set ff=unix # ä¿®æ”¹æ¢è¡Œç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®šä¹‰å¤‡ä»½ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MYSQL_BACKUP_PATH=/opt/backup/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®šä¹‰Telegram æœºå™¨äººIDå’ŒæŠ¥è­¦ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_BOT_ID=&#39;Telegram BOT_ID:BOT_Key&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_GROUP_ID=&#39;GROUP_ID&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®šä¹‰è¿æ¥æ•°æ®åº“ è´¦æˆ·å¯†ç IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_NAME=&#39;backup&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_PASSWORD=&#39;pass&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATABASES=&#39;databases name&#39;  	# å¤‡ä»½è¡¨ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_HOST_1=&#39;IP_1&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_HOST_2=&#39;IP_2&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## è¿‡æ»¤æ•°æ®åº“, xargså’Œsed &#39;1d&#39;æ•ˆæœä¸€æ ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATABASES_1=`/bin/mysql -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h&#34;${USER_HOST_1}&#34; -e &#39;show databases;&#39; | grep -E -v &#34;sys|mysql|information_schema|performance_schema|Database&#34; | /bin/xargs`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## DATABASES_2=`/bin/mysql -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h&#34;${USER_HOST_2}&#34; -e &#39;show databases;&#39; | grep -E -v &#34;sys|mysql|information_schema|performance_schema|Database&#34; | sed &#39;1d&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## æ£€æµ‹å¤‡ä»½ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»º
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## /bin/test -d /opt/backup
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">function TEST_BACKUP_DIR() {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -d ${MYSQL_BACKUP_PATH} ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/bin/mkdir -p ${MYSQL_BACKUP_PATH}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å§‹å‡†å¤‡å¤‡ä»½æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd ${MYSQL_BACKUP_PATH}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=å¼€å§‹å¤‡ä»½ï¼š${DATABASES_1} ${DATABASES_2} æ•°æ®åº“&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for i in ${DATABASES_1};do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/usr/local/mysql/bin/mysqldump -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h${USER_HOST_1} --single-transaction --no-autocommit --master-data=1 --skip-lock-tables ${i} &gt; ${MYSQL_BACKUP_PATH}${i}-`date +%F`.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ $? -eq 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> /bin/tar -zcvf ${MYSQL_BACKUP_PATH}${i}-`date +%F`.tar.gz ${i}-`date +%F`.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${DATABASES_1} ${DATABASES_2} æ•°æ®åº“å¤‡ä»½å®Œæˆ&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${DATABASES_1} ${DATABASES_2} æ•°æ®åº“å¤‡ä»½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/bin/rm -rf ${MYSQL_BACKUP_PATH}*.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¤‡ä»½æ•°æ®è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">function BACKUP_MYSQL_TABLES() {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	cd ${MYSQL_BACKUP_PATH}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	for DATABASES in ${DATABASES_1};do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	TABLES_1=$(/bin/mysql -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h&#34;${USER_HOST_1}&#34; ${DATABASES} -e &#34;show tables;&#34;|sed &#39;1d&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		for I in ${TABLES_1};do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			/usr/local/mysql/bin/mysqldump -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h${USER_HOST_1} --single-transaction --no-autocommit --master-data=1 --skip-lock-tables ${I} &gt; ${MYSQL_BACKUP_PATH}${i}-`date +%F`.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		/bin/tar -zcvf ${MYSQL_BACKUP_PATH}${DATABASES}-`date +%F`.tar.gz *.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		/bin/rm -rf ${MYSQL_BACKUP_PATH}*.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	done	
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	if [ $? -eq 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${DATABASES_1} ${DATABASES_2} æ•°æ®åº“å¤‡ä»½å®Œæˆ&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${DATABASES_1} ${DATABASES_2} æ•°æ®åº“å¤‡ä»½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/bin/find ${MYSQL_BACKUP_PATH} -name &#34;databases-*&#34; -mtime +15 -exec  rm  {} \;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="è¿˜åŸ">è¿˜åŸ</h4>
<blockquote>
<ul>
<li><strong>æ•°æ®åº“è¿˜åŸã€å¯¼å…¥</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬ä¸€ç§æ–¹å¼</span>
</span></span><span style="display:flex;"><span>$ /bin/mysql -u root -p<span style="color:#e6db74">&#39;passowrd&#39;</span> -S /opt/data/data_16303/mysql.sock &lt; /root/all.sql  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬äºŒç§æ–¹å¼  </span>
</span></span><span style="display:flex;"><span>mysql&gt; use mysql;
</span></span><span style="display:flex;"><span>mysql&gt; source /root/databases.sql  	<span style="color:#75715e"># å½“å‰ç›®å½•ç»å¯¹è·¯å¾„</span></span></span></code></pre></div></blockquote>
<ul>
<li><code>.qp</code><strong>æ–‡ä»¶æ•°æ®åº“æ¢å¤</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ xbstream -x -p <span style="color:#ae81ff">4</span> &lt; ./databases.qp -C /opt/mysql/backup</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="ä½¿ç”¨perconaå¤‡ä»½å·¥å…·">ä½¿ç”¨<code>percona</code>å¤‡ä»½å·¥å…·</h4>
<blockquote>
<ul>
<li><a href="https://segmentfault.com/a/1190000019305858" rel="external" target="_self"><code>Linux</code>è¿ç»´ <code>mysql</code>æ•°æ®åº“çš„å¤‡ä»½ä¸æ¢å¤</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1119183" rel="external" target="_self"><code>innobackupex</code>å¤‡ä»½æ¢å¤<code>+</code>å¢é‡å¤‡ä»½ä¸æ¢å¤</a></li>
<li><code>innobackupex</code>ï¼šæ›´å¤šé«˜çº§ç®¡ç†åŠŸèƒ½å’Œè‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬</li>
<li><code>xtrabackup</code>ï¼šéœ€è¦åŸºæœ¬çš„ç‰©ç†å¤‡ä»½å’Œæ¢å¤åŠŸèƒ½ï¼Œå¹¶ä¸”æ„¿æ„æ‰‹åŠ¨ç®¡ç†å¤‡ä»½æµç¨‹</li>
<li>å®‰è£…<a href="https://www.percona.com/software/mysql-database/percona-xtrabackup" rel="external" target="_self"><code>XtraBackup</code></a></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ yumæº</span>
</span></span><span style="display:flex;"><span>$ wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6.repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…ä¾èµ–åŒ…</span>
</span></span><span style="display:flex;"><span>$ yum -y install perl perl-devel libaio libaio-devel perl-Time-HiRes perl-DBD-MySQL
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸‹è½½rpmåŒ…</span>
</span></span><span style="display:flex;"><span>$ wget https://downloads.percona.com/downloads/Percona-XtraBackup-2.4/Percona-XtraBackup-2.4.27/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.27-1.el7.x86_64.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ yum -y install percona-xtrabackup-24-2.4.27-1.el7.x86_64.rpm</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æ‰‹åŠ¨å¤‡ä»½</strong></li>
</ul>
<blockquote>
<ul>
<li><strong>å®Œæ•´ä»¥åŠå¢é‡å¤‡ä»½</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å®Œæ•´å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>$ innobackupex --host<span style="color:#f92672">=</span>IP --user<span style="color:#f92672">=</span>name --password<span style="color:#f92672">=</span><span style="color:#ae81ff">123456</span> --prot<span style="color:#f92672">=</span><span style="color:#ae81ff">3306</span> --no-timestamp /opt/backup/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¢é‡å¤‡ä»½  åŸºäºå…¨é‡å¤‡ä»½å®ç°å¢é‡å¤‡ä»½ï¼Œå¢é‡å¤‡ä»½åªæ”¯æŒInnodb</span>
</span></span><span style="display:flex;"><span>$ innobackupex --host<span style="color:#f92672">=</span>IP --user<span style="color:#f92672">=</span>root --password<span style="color:#f92672">=</span><span style="color:#ae81ff">123456</span> --prot<span style="color:#f92672">=</span><span style="color:#ae81ff">3306</span> --no-timestamp --incremental /opt/backup/ --incremental-basedir<span style="color:#f92672">=</span>/opt/backup/<span style="color:#66d9ef">$(</span>date +%F_%T<span style="color:#66d9ef">)</span></span></span></code></pre></div></blockquote>
<ul>
<li><strong>æ•°æ®åº“æ¢å¤æµç¨‹</strong></li>
</ul>
<blockquote>
<ul>
<li><code>--decompress</code><!-- raw HTML omitted -->è¯¥é€‰é¡¹è¡¨ç¤ºè§£å‹<!-- raw HTML omitted --><code>--compress</code><!-- raw HTML omitted -->é€‰é¡¹å‹ç¼©æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>--parallel</code><!-- raw HTML omitted -->è¯¥é€‰é¡¹è¡¨ç¤ºå…è®¸å¤šä¸ªæ–‡ä»¶åŒæ—¶è§£å‹ã€‚ä¸ºäº†è§£å‹ï¼Œ<!-- raw HTML omitted --><code>qpress</code><!-- raw HTML omitted -->å·¥å…·å¿…é¡»æœ‰å®‰è£…å¹¶ä¸”è®¿é—®è¿™ä¸ªæ–‡ä»¶çš„æƒé™ã€‚è¿™ä¸ªè¿›ç¨‹å°†åœ¨åŒä¸€ä¸ªä½ç½®ç§»é™¤åŸæ¥çš„å‹ç¼©/åŠ å¯†æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>--apply-log</code><!-- raw HTML omitted -->è¯¥é€‰é¡¹è¡¨ç¤ºåŒ<!-- raw HTML omitted --><code>xtrabackup</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>--prepare</code><!-- raw HTML omitted -->å‚æ•°,ä¸€èˆ¬æƒ…å†µä¸‹,åœ¨å¤‡ä»½å®Œæˆåï¼Œæ•°æ®å°šä¸”ä¸èƒ½ç”¨äºæ¢å¤æ“ä½œï¼Œå› ä¸ºå¤‡ä»½çš„æ•°æ®ä¸­å¯èƒ½ä¼šåŒ…å«å°šæœªæäº¤çš„äº‹åŠ¡æˆ–å·²ç»æäº¤ä½†å°šæœªåŒæ­¥è‡³æ•°æ®æ–‡ä»¶ä¸­çš„äº‹åŠ¡ã€‚å› æ­¤ï¼Œæ­¤æ—¶æ•°æ® æ–‡ä»¶ä»å¤„ç†ä¸ä¸€è‡´çŠ¶æ€<!-- raw HTML omitted --></li>
<li><code>--apply-log</code><!-- raw HTML omitted -->çš„ä½œç”¨æ˜¯é€šè¿‡å›æ»šæœªæäº¤çš„äº‹åŠ¡åŠåŒæ­¥å·²ç»æäº¤çš„äº‹åŠ¡è‡³æ•°æ®æ–‡ä»¶ä½¿æ•°æ®æ–‡ä»¶å¤„äºä¸€è‡´æ€§çŠ¶æ€<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 1.æ‹·è´å¤‡ä»½åˆ°data3306(åªæ‹·è´æ—¥æœŸæ–‡ä»¶å¤¹ä¸‹é¢çš„æ–‡ä»¶)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2.cd /opt/data3306</span>
</span></span><span style="display:flex;"><span>$ innobackupex --defaults-file<span style="color:#f92672">=</span>/opt/conf/my_3306.cnf --decompress --parallel<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span> ./
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3.åˆ é™¤æ‰€æœ‰.qpæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4.æ¢å¤æ•°æ®åº“(å…¨é‡)</span>
</span></span><span style="display:flex;"><span>$ cd /opt/data3306
</span></span><span style="display:flex;"><span>$ innobackupex --defaults-file<span style="color:#f92672">=</span>/opt/conf/my_3306.cnf --apply-log  --use-memory<span style="color:#f92672">=</span>4G ./</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æ‰‹åŠ¨æ¢å¤</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ service mysql stop
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆå§‹åŒ–å…¨é‡å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ innobackupex --apply-log --redo-only /opt/backup/ --incremental-dir<span style="color:#f92672">=</span>/opt/backup/<span style="color:#66d9ef">$(</span>date +%F_%T<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆå§‹åŒ–æ•´åˆå¢é‡å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>$ innobackupex --apply-log --redo-only /data/backup/2017-08-24_22-57-43 --incremental-dir<span style="color:#f92672">=</span>/data/backup/2017-08-24_23-10-21
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠæ•´åˆå¥½çš„å¢é‡å†æ¬¡åˆå§‹åŒ–</span>
</span></span><span style="display:flex;"><span>$ innobackupex --apply-log  /data/backup/2017-08-24_22-57-43
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¤‡ä»½MySQLä¸‹dataæ•°æ®ç›®å½•è¦æ¢å¤çš„æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ mv  /usr/local/mysql/data/ceshi/  /opt/backup/<span style="color:#66d9ef">$(</span>date +%F_%T<span style="color:#66d9ef">)</span>/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠæ•´åˆåçš„å…¨é‡å¤‡ä»½ç›®å½•ä¸‹è¦æ¢å¤çš„æ•°æ®åº“å¤åˆ¶åˆ°MySQLä¸‹dataç›®å½•</span>
</span></span><span style="display:flex;"><span>$ cp -a  /opt/backup/quanliang/ceshi /usr/local/mysql/data/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°èµ‹äºˆå±ç»„mysqlæƒé™</span>
</span></span><span style="display:flex;"><span>$ chown -R mysql.mysql   /usr/local/mysql/data/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ service mysql start</span></span></code></pre></div></blockquote>
<ul>
<li><strong>ä½¿ç”¨<code>--copy</code>å‚æ•°å®ç°å¤‡ä»½æ¢å¤</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ service mysql stop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠdataæ•°æ®ç›®å½•ä¸‹æ•°æ®è¿›è¡Œå¤‡ä»½</span>
</span></span><span style="display:flex;"><span>$ cp -a  /usr/local/mysql/data/* /opt/backup/<span style="color:#66d9ef">$(</span>date +%F_%T<span style="color:#66d9ef">)</span>/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠè¦æ¢å¤çš„æ•°æ®å¤‡ä»½ç”Ÿæˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ innobackupex  --apply-log --redo-only /opt/backup/quanliang/ceshi_danku/  	<span style="color:#75715e"># è¿™ä¸ªæ˜¯å•åº“å¤‡ä»½ç›®å½•</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># dataç›®å½•å¿…é¡»ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>$ innobackupex  --copy-back /opt/backup/quanliang/ceshi_danku/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°èµ‹äºˆå±ç»„æƒé™</span>
</span></span><span style="display:flex;"><span>$ chown -R mysql.mysql /usr/local/mysql/data/
</span></span><span style="display:flex;"><span>$ service mysql start</span></span></code></pre></div></blockquote>
<ul>
<li><strong>ä½¿ç”¨<code>Mysql</code>è„šæœ¬å¤‡ä»½å¹¶é€šçŸ¥é’‰é’‰æ¥å£</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/script/Backup_Mysql_innobackupex.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ***************************************************************#
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##  Create: DBA
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ***************************************************************#
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## echo `hostname -I` |sed &#39;s/ /#/g&#39; -  &gt;/tmp/ipaddr.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å®šä¹‰Telegram æœºå™¨äººIDå’ŒæŠ¥è­¦ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_BOT_ID=&#39;Telegram bot_id:bot_key&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_GROUP_ID=&#39;GROUP_ID&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IP_ADDRE=$(hostname -I |awk &#39;{print $1}&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_NAME=&#39;backup&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_PASSWORD=&#39;IvV8BhpvHb/7EA==&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATABASES=&#39;databases name&#39; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backup_time=`date +&#39;%Y%m%d%m&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backup_base=&#34;/opt/backup/dbback&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backup_dir=&#34;$backup_base/full&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backup_log=&#34;$backup_base/log/xtra_${backup_time}.log&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">slave_days=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## é’‰é’‰æ¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">function SendToDingding_error(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #Dingding_Url=&#34;https://oapi.dingtalk.com/robot/send?access_token=d5201a579163dc6045b6da6d8dbc1cdc1d935698050971ceddb5a8956e9507ee&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Dingding_Url=&#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage?chat_id=${TELEGRAM_GROUP_ID}&amp;text=%22${IP_ADDRE}mysqlbak%20failure!Please check %22&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # å‘é€é’‰é’‰æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> curl &#34;${Dingding_Url}&#34; -H &#39;Content-Type: application/json&#39; -d &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     \&#34;actionCard\&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;title\&#34;: \&#34;$1\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;text\&#34;: \&#34;$2\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;hideAvatar\&#34;: \&#34;0\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;btnOrientation\&#34;: \&#34;0\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;btns\&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                 \&#34;title\&#34;: \&#34;$1\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                 \&#34;actionURL\&#34;: \&#34;\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     \&#34;msgtype\&#34;: \&#34;actionCard\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®‰è£…å¤‡ä»½å·¥å…· innobackupex æˆ– xtrabackup
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -x /usr/bin/innobackupex ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     yum -y install  http://www.percona.com/downloads/percona-release/redhat/0.1-4/percona-release-0.1-4.noarch.rpm
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     yum -y install percona-xtrabackup-24 qpress
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å§‹åˆ›å»ºç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -d ${backup_dir} ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mkdir -p ${backup_dir}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -d ${backup_base}/log ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mkdir -p ${backup_base}/log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_time=`date +&#39;%Y%m%d_%H:%M:%S&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_file=`date +&#39;%Y-%m-%d_%H-%M-%S&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å§‹å¤‡ä»½æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -e &#34;`date +&#39;%Y-%m-%d %H:%M:%S&#39;` å¼€å§‹ç‰©ç†å¤‡ä»½æ•°æ®åº“ ${ipaddr} ...&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/usr/bin/innobackupex --defaults-file=/opt/conf/my_16303.cnf --user=${backup_user} --password=${backup_password} --host=&#39;localhost&#39; --socket=/opt/data/data_16303/mysql.sock --use-memory=1G --compress --compress-threads=32 --parallel=3 --slave-info ${backup_dir} 2&gt;&gt;${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ $? -ne 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;`date +&#39;%Y%m%d_%H:%M:%S&#39;` å¤‡ä»½æ•°æ®åº“å‘ç”Ÿé”™è¯¯,å…·ä½“çœ‹æ—¥å¿—&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Subject=&#34;ç‰©ç†å¤‡ä»½xtraå¤‡ä»½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Body=&#34;&#39;${ipaddr}&#39;_ç‰©ç†å¤‡ä»½å¤±è´¥,è¯·å‚è€ƒæ—¥å¿—:${backup_log}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> SendToDingding_error $Subject $Body
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd ${backup_dir}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file_time=`date +&#39;%Y-%m-%d&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flie_name=`ls -l | grep &#34;$file_time&#34;|tail -n 1|awk &#39;{print $9}&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">tar -zcf ${file_time}.tar.gz ${flie_name}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rm -rf ${flie_name}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## rsync -avz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -z &#34;`tail -1 ${backup_log} | grep &#39;completed OK&#39;`&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> finish_time=`date +&#39;%Y%m%d_%H:%M:%S&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> file_size=`du -sm ${backup_dir} |awk &#39;{print $1}&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;${ipaddr}æ•°æ®åº“xtrabackupç‰©ç†å¤‡ä»½å·¥ä½œå®Œæˆ!\n å¼€å§‹æ—¶é—´ï¼š${start_time} ç»“æŸæ—¶é—´ï¼š${finish_time}\n å¤‡ä»½ç›®å½•${backup_dir}\n
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">å¤‡ä»½æ–‡ä»¶å¤§å°${file_size} MB&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # åˆ é™¤ä»¥å‰çš„å¤‡ä»½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;`date +&#39;%Y%m%d_%H:%M:%S&#39;` å¼€å§‹åˆ é™¤${slave_days}å¤©ä»¥å‰çš„å¤‡ä»½&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> cd ${backup_base}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> for tfile in $(/usr/bin/find ${backup_dir}  -mindepth 1 -maxdepth 1 -mtime +${slave_days})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      cd ${backup_dir} &amp;&amp; rm -rf ${tfile} 2&gt;&gt;${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      echo -e &#34;---- delete file :${file} -----&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;`date +&#39;%Y%m%d_%H%M%S&#39;` åˆ é™¤${slave_days}å¤©ä»¥å‰çš„å¤‡ä»½-å®Œæˆ&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> find $backup_base/log  -mindepth 1 -maxdepth 1  -mtime +${slave_days} -type f |xargs  rm -f
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;`date +&#39;%Y%m%d_%H:%M:%S&#39;` å¤‡ä»½æ•°æ®åº“å‘ç”Ÿé”™è¯¯,å…·ä½“çœ‹æ—¥å¿—&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Subject=&#34;ç‰©ç†å¤‡ä»½xtraå¤‡ä»½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Body=&#34;${ipaddr}_ç‰©ç†å¤‡ä»½å¤±è´¥,è¯·å‚è€ƒæ—¥å¿—:${backup_log}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> SendToDingding_error $Subject $Body
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="æŸ¥çœ‹å¯¼å‡ºæ¸…ç†binlogæ—¥å¿—">æŸ¥çœ‹ã€å¯¼å‡ºã€æ¸…ç†<code>binlog</code>æ—¥å¿—</h3>
<ul>
<li>
<ol>
<li><strong>æŸ¥çœ‹<code>binlog</code></strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šæŸ¥è¯¢ mysql-bin.000002è¿™ä¸ªæ–‡ä»¶ï¼Œä»posç‚¹:624å¼€å§‹æŸ¥èµ·ï¼Œåç§»2è¡Œï¼ˆå³ä¸­é—´è·³è¿‡2ä¸ªï¼‰ï¼ŒæŸ¥è¯¢10æ¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> binlog events <span style="color:#66d9ef">in</span> <span style="color:#e6db74">&#39;mysql-bin.000002&#39;</span> <span style="color:#66d9ef">from</span> <span style="color:#ae81ff">624</span> <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">\</span>G;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><strong>å¯¼å‡ºæ•°æ®åº“<code>binlog</code>æ—¥å¿—</strong></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>--base64-output=</code>ï¼š<code>decode-rows</code><!-- raw HTML omitted -->å°†è¡Œäº‹ä»¶è§£ç ä¸ºæ³¨é‡Šä¼ª<!-- raw HTML omitted --><code>SQL</code><!-- raw HTML omitted -->è¯­å¥<!-- raw HTML omitted --></li>
<li><code>--no-defaults</code></li>
<li><code>--database=&quot;æ•°æ®åº“å&quot;</code>ï¼š<!-- raw HTML omitted -->ä»…åˆ—å‡ºæ­¤æ•°æ®åº“çš„æ¡ç›®(ä»…é™æœ¬åœ°æ—¥å¿—)<!-- raw HTML omitted --></li>
<li><code>--start-datetime=''</code>ï¼š<!-- raw HTML omitted --><!-- raw HTML omitted -->å¼€å§‹æ—¶é—´<!-- raw HTML omitted -->å‚æ•°å¿…é¡»æ˜¯æœ¬åœ°æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œæ ¼å¼ä¸é™<code>MySQL</code>æœåŠ¡å™¨æ¥å—<code>DATETIME</code>å’Œ<code>TIMESTAMP</code>ç±»å‹ï¼Œä¾‹å¦‚ï¼š<!-- raw HTML omitted --><code>2004-12-25 11:25:56</code></li>
<li><code>--stop-datetime=''</code>ï¼š<!-- raw HTML omitted --><!-- raw HTML omitted -->ç»“æŸæ—¶é—´<!-- raw HTML omitted -->å‚æ•°å¿…é¡»æ˜¯æœ¬åœ°æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œæ ¼å¼ä¸é™<code>MySQL</code>æœåŠ¡å™¨æ¥å—<code>DATETIME</code>å’Œ<code>TIMESTAMP</code>ç±»å‹ï¼Œä¾‹å¦‚ï¼š<!-- raw HTML omitted --><code>2004-12-25 11:25:56</code></li>
<li><code>--start-position=875</code>ï¼š<!-- raw HTML omitted -->åç§»é‡å¼€å§‹è¯»å–ä½ç½®<!-- raw HTML omitted --></li>
<li><code>--stop-position=954</code>ï¼š<!-- raw HTML omitted -->åç§»é‡åœæ­¢è¯»å–ä½ç½®<!-- raw HTML omitted --></li>
<li><code>-v</code>ï¼š<!-- raw HTML omitted -->ä»è¡Œäº‹ä»¶ä¸­é‡å»ºä¼ª<!-- raw HTML omitted --><code>SQL</code><!-- raw HTML omitted -->è¯­å¥ï¼Œ<!-- raw HTML omitted --><code>-vv</code><!-- raw HTML omitted -->æ·»åŠ å¯¹åˆ—æ•°æ®ç±»å‹çš„æ³¨é‡Š<!-- raw HTML omitted --></li>
<li><code>-r</code>ï¼š<!-- raw HTML omitted -->ç›´æ¥è¾“å‡ºåˆ°ç»™å®šçš„æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /bin/mysqlbinlog <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--base64-output<span style="color:#f92672">=</span>decode-rows <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-defaults --database<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;æ•°æ®åº“å&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--start-datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2019-04-11 00:00:00&#39;</span> <span style="color:#ae81ff">\ </span> 	<span style="color:#75715e"># å¼€å§‹æ—¶é—´</span>
</span></span><span style="display:flex;"><span>--stop-datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2019-04-11 15:00:00&#39;</span> <span style="color:#ae81ff">\ </span> 	<span style="color:#75715e"># ç»“æŸæ—¶é—´</span>
</span></span><span style="display:flex;"><span>-v /opt/data/mysql/mysql-bin.000007 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-r /opt/binlog<span style="color:#e6db74">`</span>date <span style="color:#e6db74">&#39;+%F&#39;</span><span style="color:#e6db74">`</span>.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–¹æ³•äºŒ</span>
</span></span><span style="display:flex;"><span>$ /bin/mysqlbinlog <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-defaults --database<span style="color:#f92672">=</span>db <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--start-datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2019-04-11 00:00:00&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--stop-datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2019-04-11 15:00:00&#39;</span> mysql-bin.000007 | more
</span></span><span style="display:flex;"><span>mysqlbinlog <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--base64-output<span style="color:#f92672">=</span>decode-rows <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--start-position<span style="color:#f92672">=</span><span style="color:#ae81ff">2966</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--stop-position<span style="color:#f92672">=</span><span style="color:#ae81ff">2966</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v mysql-bin.000125</span></span></code></pre></div><ul>
<li><strong>ä»<code>binlog</code>æ—¥å¿—ä¸­å¾—<code>DELETE</code>åˆ é™¤æ¢æˆ<code>INSERT INTO</code>æ’å…¥è¯­å¥</strong></li>
</ul>
<blockquote>
<p><a href="https://www.cnblogs.com/yhq1314/p/13970044.html" rel="external" target="_self"><code>mysql binlg delete</code>è¯­å¥è§£æä¸º<code>insert</code>è¯­å¥</a></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ find /path/to/binlog/directory -name <span style="color:#e6db74">&#34;binlog.*&#34;</span> -printf <span style="color:#e6db74">&#34;%T@ %p\n&#34;</span> | sort -n | cut -d<span style="color:#e6db74">&#39; &#39;</span> -f2- | xargs mysqlbinlog &gt; combined_binlog.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ find ./ -name <span style="color:#e6db74">&#34;mysql-bin.266*&#34;</span> -printf <span style="color:#e6db74">&#34;%T@ %p\n&#34;</span> | sort -n | cut -d<span style="color:#e6db74">&#39; &#39;</span> -f2- | xargs /usr/local/mysql/bin/mysqlbinlog -vv  --base64-output<span style="color:#f92672">=</span>DECODE-ROWS --set-charset<span style="color:#f92672">=</span>UTF8 mysql-bin.266770 --database<span style="color:#f92672">=</span>databases_name -r new_binlog.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####  	è§£æbinlogå¹¶è¿˜åŸæˆæ’å…¥è¯­å¥  	#####</span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysqlbinlog -vv --base64-output<span style="color:#f92672">=</span>DECODE-ROWS --set-charset<span style="color:#f92672">=</span>UTF8 mysql-bin.merged.9 --database<span style="color:#f92672">=</span>databases_name &gt;&gt;/mnt/new_binlog.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åªè¿‡æ»¤æŸä¸ªæ•°æ®åº“ä¸­çš„æŸä¸ªè¡¨ä¸­çš„åˆ é™¤è¯­å¥</span>
</span></span><span style="display:flex;"><span>$ cat new_binlog.sql | awk <span style="color:#e6db74">&#39;/DELETE FROM/ &amp;&amp; (/databases_name.tables_name/ || /`databases_name`.`tables_name`/) { while(1) { print $0; getline; if($0 !~ /^###/) { break; }; }}&#39;</span> &gt; new_binlog-1.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å»æ‰ï¼š###</span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-1.sql new_binlog-2.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/^### //g&#39;</span> new_binlog-2.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤è¯­å¥æ›¿æ¢ä¸ºæ’å…¥è¯­å¥</span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-2.sql new_binlog-3.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/^DELETE FROM/INSERT INTO/g&#34;</span> new_binlog-3.sql 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¡ä»¶æ›¿æ¢ä¸ºå€¼</span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-3.sql new_binlog-4.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/^WHERE/VALUES(/g&#34;</span> new_binlog-4.sql 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># @21 è¿™é‡Œè¦çœ‹è§£æåçš„å…·ä½“è¡Œæ•°ï¼Œ </span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-4.sql new_binlog-5.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/@21=.*/a );&#39;</span> new_binlog-5.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat new_binlog-5.sql | awk -F<span style="color:#e6db74">&#34;=|/*&#34;</span> <span style="color:#e6db74">&#39;{ if($0 ~ /^INSERT|^VALUES|^);/) { print $0; } else { printf $2&#34;,&#34;; };}&#39;</span> &gt;new_binlog-6.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp  new_binlog-6.sql new_binlog-7.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/,);</span>$<span style="color:#e6db74">/);/g&#34;</span> new_binlog-7.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-7.sql new_binlog-8.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/,INSERT/);INSERT/g&#39;</span> new_binlog-8.sql</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="3">
<li><strong>æ¸…ç†<code>binlog</code></strong></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.cnblogs.com/xxoome/p/9802684.html" rel="external" target="_self"><code>mysql binlog</code>æ—¥å¿—è‡ªåŠ¨æ¸…ç†åŠæ‰‹åŠ¨åˆ é™¤</a>ã€<a href="https://developer.aliyun.com/article/712256" rel="external" target="_self"><code>Mysql</code>æ¸…ç†<code>binlog</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æ¸…é™¤MySQL-bin.010æ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">PURGE</span> MASTER LOGS <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;MySQL-bin.010&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…é™¤2008-06-22 13:00:00å‰binlogæ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">PURGE</span> MASTER LOGS <span style="color:#66d9ef">BEFORE</span> <span style="color:#e6db74">&#39;2008-06-22 13:00:00&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…é™¤3å¤©å‰binlogæ—¥å¿—BEFOREï¼Œå˜é‡çš„dateè‡ªå˜é‡å¯ä»¥ä¸º&#39;YYYY-MM-DD hh:mm:ss&#39;æ ¼å¼ã€‚ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">PURGE</span> MASTER LOGS <span style="color:#66d9ef">BEFORE</span> <span style="color:#a6e22e">DATE_SUB</span>( <span style="color:#a6e22e">NOW</span>( ), <span style="color:#66d9ef">INTERVAL</span> <span style="color:#ae81ff">3</span> DAY);</span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆ›å»ºæˆæƒåˆ é™¤ç”¨æˆ·">åˆ›å»ºã€æˆæƒã€åˆ é™¤ç”¨æˆ·</h3>
<ul>
<li>
<ol>
<li><strong>åˆ›å»ºã€æˆæƒ</strong></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><strong><code>5.7.*</code>ä¸€ä¸‹åˆ›å»ºä»¥åŠæˆæƒ</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">on</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> root<span style="color:#f92672">@</span><span style="color:#e6db74">&#39;10.14.23.%&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123456&#39;</span>;  	<span style="color:#75715e"># 192.168.%.% è¡¨ç¤ºç½‘æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> <span style="color:#66d9ef">database</span>.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#34;password&#34;</span>;</span></span></code></pre></div><ul>
<li><strong><code>Myslq 8.0</code>è¯­å¥æ‰§è¡Œï¼Œ<code>8.0</code>ç‰ˆæœ¬ä¹‹ååˆ›å»ºç”¨æˆ·å’Œæˆæƒåˆ†å¼€äº†</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºç”¨æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;127.0.0.1&#39;</span> <span style="color:#66d9ef">IDENTIFIED</span> <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;passowrd&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆäºˆæƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;127.0.0.1&#39;</span> <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">OPTION</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤æƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">REVOKE</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">ON</span> databasename.tablename <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;host&#39;</span>; </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><strong>åˆ›å»ºä»åº“ç”¨æˆ·å¹¶æˆå¤åˆ¶æƒé™</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>MySQL<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> replication slave, replication client <span style="color:#66d9ef">on</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;lisi&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;10.14.23.%&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123456&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><strong>æ’¤é”€ç”¨æˆ·æƒé™</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">REVOKE</span> privilege <span style="color:#66d9ef">ON</span> databasename.tablename <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;host&#39;</span>;  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><strong>åˆ é™¤ç”¨æˆ·ã€æ•°æ®</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;host&#39;</span>;  	<span style="color:#75715e"># å¦‚æœæ˜¯å½“å‰ç™»é™†ç”¨æˆ·ç”¨SET PASSWORD = PASSWORD(&#34;newpassword&#34;); 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">â€˜</span>xx<span style="color:#960050;background-color:#1e0010">â€™</span> <span style="color:#66d9ef">and</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;xx&#39;</span>;  	<span style="color:#75715e"># æˆæƒæŸ¥çœ‹æ•°æ®åº“ç”¨æˆ·ï¼ˆclintï¼‰ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> mysql.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;slave&#34;</span> <span style="color:#66d9ef">and</span> host<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;10.14.23.%&#34;</span>;  </span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆ›å»ºåº“è¡¨">åˆ›å»ºåº“ã€è¡¨</h3>
<ul>
<li>
<ol>
<li><strong>åˆ›å»ºåº“</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> db2 <span style="color:#66d9ef">character</span> <span style="color:#66d9ef">set</span> utf8 <span style="color:#66d9ef">collate</span> utf8_general_ci;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><strong>åˆ›å»ºè¡¨</strong></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>NOT NULL</code>ï¼š<!-- raw HTML omitted -->æ¯ä¸€è¡Œéƒ½å¿…é¡»å«æœ‰å€¼ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰ï¼Œ<code>null</code>å€¼æ˜¯ä¸å…è®¸çš„<!-- raw HTML omitted --></li>
<li><code>DEFAULT value</code>ï¼š<!-- raw HTML omitted -->è®¾ç½®é»˜è®¤å€¼<!-- raw HTML omitted --></li>
<li><code>UNSIGNED</code>ï¼š<!-- raw HTML omitted -->ä½¿ç”¨æ— ç¬¦å·æ•°å€¼ç±»å‹ï¼Œ<!-- raw HTML omitted --><code>0</code><!-- raw HTML omitted -->åŠæ­£æ•°<!-- raw HTML omitted --></li>
<li><code>AUTO INCREMENT</code>ï¼š<!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>MySQL</code><!-- raw HTML omitted -->å­—æ®µçš„å€¼åœ¨æ–°å¢è®°å½•æ—¶æ¯æ¬¡è‡ªåŠ¨å¢é•¿<!-- raw HTML omitted --><code>1</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> databases_name.<span style="color:#a6e22e">tables_name</span>(id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>, name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">50</span>)<span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)  	<span style="color:#75715e"># not null ä¸ä¸ºç©º
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®æ•°æ®è¡¨ä¸­æ¯æ¡è®°å½•çš„å”¯ä¸€æ ‡è¯†ã€‚ é€šå¸¸åˆ—çš„ PRIMARY KEY è®¾ç½®ä¸º ID æ•°å€¼ï¼Œä¸AUTO_INCREMENT ä¸€èµ·ä½¿ç”¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#f92672">`</span>databases_name<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>tables_name<span style="color:#f92672">`</span>(name) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#39;lisi&#39;</span>);
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)  	<span style="color:#75715e"># ä¸å†™id
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#f92672">`</span>databases_name<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>tables_name<span style="color:#f92672">`</span>(id,content,add_time) <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">4</span>,<span style="color:#e6db74">&#39;Text&#39;</span>,<span style="color:#e6db74">&#39;2023-01-11 02:52:54&#39;</span>);</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><strong>æŒ‰æ—¥æœŸåˆ é™¤è¡¨</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">USE</span> example_db;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> table_name <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">WHERE</span> table_schema <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;example_db&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">CONCAT</span>(<span style="color:#e6db74">&#39;DROP TABLE IF EXISTS &#39;</span>, table_name, <span style="color:#e6db74">&#39;;&#39;</span>) <span style="color:#66d9ef">AS</span> sql_statement <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">WHERE</span> table_schema <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;example_db&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> table_name <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">WHERE</span> table_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;prefix_%&#39;</span> <span style="color:#66d9ef">AND</span> table_name <span style="color:#66d9ef">BETWEEN</span> <span style="color:#e6db74">&#39;prefix_2022-02-01&#39;</span> <span style="color:#66d9ef">AND</span> <span style="color:#e6db74">&#39;prefix_2022-03-01&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">CONCAT</span>(<span style="color:#e6db74">&#39;DROP TABLE IF EXISTS &#39;</span>, table_name, <span style="color:#e6db74">&#39;;&#39;</span>) <span style="color:#66d9ef">AS</span> sql_statement <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">WHERE</span> table_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;prefix_%&#39;</span> <span style="color:#66d9ef">AND</span> table_name <span style="color:#66d9ef">BETWEEN</span> <span style="color:#e6db74">&#39;prefix_2022-02-01&#39;</span> <span style="color:#66d9ef">AND</span> <span style="color:#e6db74">&#39;prefix_2022-03-01&#39;</span>;</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æŸ¥è¯¢åº“è¡¨å®¹é‡å¤§å°">æŸ¥è¯¢åº“ã€è¡¨å®¹é‡å¤§å°</h3>
<blockquote>
<ul>
<li><strong>æŸ¥è¯¢æ‰€æœ‰åº“å®¹é‡å¤§å°</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>table_schema <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(table_rows) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è®°å½•æ•°&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(data_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(index_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç´¢å¼•å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(DATA_FREE<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç¢ç‰‡å ç”¨(MB)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.<span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> table_schema
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#a6e22e">sum</span>(data_length) <span style="color:#66d9ef">desc</span>, <span style="color:#a6e22e">sum</span>(index_length) <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æŸ¥çœ‹æŒ‡å®šåº“çš„å®¹é‡å¤§å°</strong></li>
</ul>
<blockquote>
<ul>
<li>æŸ¥çœ‹<code>MySQL</code>ã€ŒæŒ‡å®šåº“ã€çš„å®¹é‡å¤§å°ï¼š<code>database_name</code>æ›´æ”¹ä¸ºè¦æŸ¥è¯¢çš„åº“</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>table_schema <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(table_rows) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è®°å½•æ•°&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(data_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(index_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç´¢å¼•å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(DATA_FREE<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç¢ç‰‡å ç”¨(MB)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.<span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> table_schema<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;database_name&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> data_length <span style="color:#66d9ef">desc</span>, index_length <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æŸ¥çœ‹æŒ‡å®šåº“ä¸­æ‰€æœ‰è¡¨çš„å®¹é‡å¤§å°</strong></li>
</ul>
<blockquote>
<ul>
<li>æŸ¥çœ‹<code>MySQL</code>ã€ŒæŒ‡å®šåº“ã€ä¸­ã€Œæ‰€æœ‰è¡¨ã€çš„å®¹é‡å¤§å°</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>table_schema <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span>table_name <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è¡¨å&#39;</span>,
</span></span><span style="display:flex;"><span>table_rows <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è®°å½•æ•°&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(data_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(index_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç´¢å¼•å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(DATA_FREE<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç¢ç‰‡å ç”¨(MB)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.<span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> table_schema<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;database_name&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> data_length <span style="color:#66d9ef">desc</span>, index_length <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><strong>æŸ¥çœ‹æŒ‡å®šåº“ä¸­æŒ‡å®šè¡¨çš„å®¹é‡å¤§å°</strong></li>
</ul>
<blockquote>
<ul>
<li>æŸ¥çœ‹<code>MySQL</code>ã€ŒæŒ‡å®šåº“ã€ä¸­ã€ŒæŒ‡å®šè¡¨ã€çš„å®¹é‡å¤§å°ï¼šå°†ä»£ç ä¸­<code>database_name</code>æ•°æ®åº“åæ”¹ä¸ºä½ è¦æŸ¥è¯¢çš„æ•°æ®åº“åï¼Œ<code>tables_name</code>æ”¹ä¸ºä½ è¦æŸ¥è¯¢çš„è¡¨å</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>table_schema <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span>table_name <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è¡¨å&#39;</span>,
</span></span><span style="display:flex;"><span>table_rows <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è®°å½•æ•°&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(data_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(index_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç´¢å¼•å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(DATA_FREE<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç¢ç‰‡å ç”¨(MB)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.<span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> table_schema<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;database_name&#39;</span><span style="color:#66d9ef">and</span> table_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tables_name&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> data_length <span style="color:#66d9ef">desc</span>, index_length <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢å¹¶ä¸”è¿›è¡ŒAESè§£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#a6e22e">aes_decrypt</span>(<span style="color:#a6e22e">from_base64</span>(mobile),<span style="color:#e6db74">&#39;key&#39;</span>,<span style="color:#e6db74">&#39;åŠ å¯†æ©ç &#39;</span>) <span style="color:#66d9ef">from</span> yl_users <span style="color:#66d9ef">where</span> member <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><strong>æ’æŸ¥<code>Mysql</code>å ç”¨å†…å­˜åŸå› </strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹MySQLçš„Pid</span>
</span></span><span style="display:flex;"><span>$ ps -ef | grep -i mysqld
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹MySQLå®æ—¶æ“ä½œç³»ç»Ÿçº¿ç¨‹Pid</span>
</span></span><span style="display:flex;"><span>$ top -p <span style="color:#e6db74">&#34;Mysql Pid&#34;</span> -H
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ•°æ®åº“ä¸­æŸ¥çœ‹Pid å…·ä½“æ“ä½œå†…å®¹</span>
</span></span><span style="display:flex;"><span>Mysql&gt; SELECT THREAD_ID,name ,PROCESSLIST_ID FROM <span style="color:#e6db74">`</span>performance_schema<span style="color:#e6db74">`</span>.threads WHERE THREAD_OS_ID <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Mysql Pid&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ ¹æ®è·å–åˆ°MySQLä¸­çš„ Thread_id è·å–SQL</span>
</span></span><span style="display:flex;"><span>mysql&gt; SELECT SQL_TEXT FROM <span style="color:#e6db74">`</span>performance_schema<span style="color:#e6db74">`</span>.events_statements_current WHERE THREAD_ID <span style="color:#f92672">=</span> Thread_id;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">###########################</span>
</span></span><span style="display:flex;"><span>mysql&gt; SELECT VARIABLE_NAME,VARIABLE_VALUE, CONCAT<span style="color:#f92672">(</span>VARIABLE_VALUE/1024/1024,<span style="color:#e6db74">&#39; MB&#39;</span><span style="color:#f92672">)</span> AS VARIABLE_VALUE_MB FROM information_schema.SESSION_VARIABLES WHERE VARIABLE_NAME IN <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;innodb_buffer_pool_size&#39;</span>,<span style="color:#e6db74">&#39;innodb_log_buffer_size&#39;</span>,<span style="color:#e6db74">&#39;innodb_additional_mem_pool_size&#39;</span>,<span style="color:#e6db74">&#39;key_buffer_size&#39;</span>,<span style="color:#e6db74">&#39;query_cache_size&#39;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; SHOW VARIABLES LIKE <span style="color:#e6db74">&#39;%show_compatibility_56%&#39;</span>;
</span></span><span style="display:flex;"><span>mysql&gt; SET GLOBAL show_compatibility_56<span style="color:#f92672">=</span>on;</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å…¶ä»–å‘½ä»¤">å…¶ä»–å‘½ä»¤</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># MySQL-master,æŸ¥çœ‹æ•°æ®åº“åç§»é‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> master status;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> reset master;  <span style="color:#75715e"># æ¸…ç†resetæ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»åº“æ‰§è¡Œï¼Œæµ‹è¯•è¿æ¥ä¸»åº“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span><span style="color:#66d9ef">show</span> grants;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> mysql_secure_installation  	<span style="color:#75715e"># mysqlå®‰å…¨é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Enter current password <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">root</span> (enter <span style="color:#66d9ef">for</span> none):  	<span style="color:#75715e"># è¾“å…¥è¿›å…¥æ•°æ®åº“å¯†ç ï¼Œé»˜è®¤ä¸ºç©ºï¼ŒæŒ‰å›è½¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">Set</span> root password<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]  	<span style="color:#75715e"># è®¾ç½®mysqlæ•°æ®åº“rootç”¨æˆ·çš„å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Remove anonymous users<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]  	<span style="color:#75715e"># ç§»é™¤åŒ¿åç”¨æˆ·Y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Disallow root login remotely<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]  	<span style="color:#75715e"># ä¸å…è®¸rootç”¨æˆ·è¿œç¨‹ç™»é™†Y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Remove test <span style="color:#66d9ef">database</span> <span style="color:#66d9ef">and</span> access <span style="color:#66d9ef">to</span> it<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]  	<span style="color:#75715e"># ç§»é™¤testæ•°æ®åº“å’Œè®¿é—®Y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Reload privilege <span style="color:#66d9ef">tables</span> now<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç­›é€‰æ•°æ®ä¸åŒå€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">distinct</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">15</span> <span style="color:#66d9ef">and</span> (<span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;é€‰é¡¹&#39;</span> <span style="color:#66d9ef">or</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;é€‰é¡¹&#39;</span>);
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#960050;background-color:#1e0010">åˆ—åã€åˆ—å</span> <span style="color:#66d9ef">desc</span>(<span style="color:#960050;background-color:#1e0010">é™åº</span>)<span style="color:#960050;background-color:#1e0010">ã€</span><span style="color:#66d9ef">asc</span>(<span style="color:#960050;background-color:#1e0010">å‡åºã€é»˜è®¤å‡åº</span>);
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># æŸ¥çœ‹å‰ä¸¤æ¡æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;é¦–ä¸ªå…³é”®å­—%&#39;</span>;  	<span style="color:#75715e"># %åŒ¹é…æ‰€æœ‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%xx%&#39;</span>;  	<span style="color:#75715e"># åå‘æŸ¥æ‰¾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">in</span> (<span style="color:#e6db74">&#39;å…³é”®å­—&#39;</span>,<span style="color:#960050;background-color:#1e0010">â€˜å…³é”®å­—â€™</span>)<span style="color:#960050;background-color:#1e0010">ï¼›</span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">between</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">and</span> <span style="color:#ae81ff">20</span>;  	<span style="color:#75715e"># é€‰å–1åˆ°20ä¹‹é—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">between</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">and</span> <span style="color:#ae81ff">20</span>;  	<span style="color:#75715e"># å–å
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> (<span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">between</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">and</span> <span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">and</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">in</span> (<span style="color:#e6db74">&#39;å…³é”®å­—&#39;</span>)<span style="color:#960050;background-color:#1e0010">ï¼›</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ–°ã€æ›´æ”¹æ•°æ®æ•°æ®ä»¥åŠç”¨æˆ·æƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">set</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;333&#39;</span>, <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cn&#39;</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;xxx&#39;</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">set</span> host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;root&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹æ•°æ®åº“åŒæ­¥çº¿ç¨‹mysql
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> global sync_binlog<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> global innodb_flush_log_at_trx_commit<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹sqlçº¿ç¨‹æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> STOP SLAVE SQL_THREAD;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SET</span> GLOBAL slave_parallel_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;LOGICAL_CLOCK&#39;</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SET</span> GLOBAL slave_parallel_workers<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>;  	
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> START SLAVE SQL_THREAD;	</span></span></code></pre></div></blockquote>
<hr>
<h2 id="mysqlæŸ¥è¯¢é”è¡¨è¯­å¥"><code>MySQL</code>æŸ¥è¯¢é”è¡¨è¯­å¥</h2>
<ul>
<li>
<ol>
<li><a href="https://www.cnblogs.com/better-farther-world2099/articles/14721482.html" rel="external" target="_self"><code>MySQL</code>æŸ¥è¯¢é”è¡¨è¯­å¥</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><strong>æŸ¥è¯¢æ˜¯å¦é”è¡¨</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> OPEN <span style="color:#66d9ef">TABLES</span> <span style="color:#66d9ef">where</span> In_use <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>;</span></span></code></pre></div><ul>
<li><strong>æŸ¥çœ‹æ­£åœ¨é”çš„äº‹åŠ¡</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_LOCKS; </span></span></code></pre></div><ul>
<li><strong>æŸ¥çœ‹ç­‰å¾…é”çš„äº‹åŠ¡</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_LOCK_WAITS;</span></span></code></pre></div><ul>
<li><strong>æŸ¥çœ‹å½“å‰çš„äº‹åŠ¡</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_TRX;</span></span></code></pre></div><ul>
<li><strong>æŸ¥çœ‹å½“å‰é”å®šçš„äº‹åŠ¡</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_LOCKS;</span></span></code></pre></div><ul>
<li><strong>æŸ¥çœ‹å½“å‰ç­‰é”çš„äº‹åŠ¡</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_LOCK_WAITS;</span></span></code></pre></div><ul>
<li><strong>æŸ¥è¯¢æ­»é”è¯¦æƒ…</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> r.trx_id waiting_trx_id,r.trx_mysql_thread_id waiting_thread,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">TIMESTAMPADD</span>(SECOND,r.trx_wait_started,<span style="color:#66d9ef">CURRENT_TIMESTAMP</span>) wait_time,
</span></span><span style="display:flex;"><span>r.trx_query waiting_query,
</span></span><span style="display:flex;"><span>l.lock_table waiting_table_lock,
</span></span><span style="display:flex;"><span>b.trx_id blocking_trx_id,b.trx_mysql_thread_id blocking_thread,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SUBSTRING</span>(p.<span style="color:#f92672">`</span>HOST<span style="color:#f92672">`</span>,<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">INSTR</span>(p.<span style="color:#f92672">`</span>HOST<span style="color:#f92672">`</span>,<span style="color:#e6db74">&#39;:&#39;</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) blocking_host,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SUBSTRING</span>(p.<span style="color:#f92672">`</span>HOST<span style="color:#f92672">`</span>,<span style="color:#a6e22e">INSTR</span>(p.<span style="color:#f92672">`</span>HOST<span style="color:#f92672">`</span>,<span style="color:#e6db74">&#39;:&#39;</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>) blocking_port,
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">IF</span>(p.COMMAND <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sleep&#39;</span>,p.<span style="color:#66d9ef">TIME</span>,<span style="color:#ae81ff">0</span>) idle_in_trx,
</span></span><span style="display:flex;"><span>b.trx_query blocking_query
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.INNODB_LOCK_WAITS w
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.INNODB_TRX b <span style="color:#66d9ef">ON</span> b.trx_id <span style="color:#f92672">=</span> w.blocking_lock_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.INNODB_TRX r <span style="color:#66d9ef">ON</span> r.trx_id <span style="color:#f92672">=</span> w.requesting_trx_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.INNODB_LOCKS l <span style="color:#66d9ef">ON</span> l.lock_id <span style="color:#f92672">=</span> w.requested_lock_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> information_schema.<span style="color:#f92672">`</span>PROCESSLIST<span style="color:#f92672">`</span> p <span style="color:#66d9ef">ON</span> p.id <span style="color:#f92672">=</span> b.trx_mysql_thread_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> wait_time <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<hr>
<h2 id="é…ç½®æ•°æ®åº“ä¸»ä»å¤åˆ¶">é…ç½®æ•°æ®åº“ä¸»ä»å¤åˆ¶</h2>
<ul>
<li>
<ol>
<li><strong>ä¸»æ•°æ®åº“é…ç½®ä»¥åŠæˆæƒ</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ID</span>
</span></span><span style="display:flex;"><span>$ server_id<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>hostname -I |awk <span style="color:#e6db74">&#34;{print </span>$1<span style="color:#e6db74">}&#34;</span>|awk -F<span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#e6db74">&#34;{print </span>$4<span style="color:#e6db74">}&#34;</span><span style="color:#e6db74">`</span>  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/server-id = 16303110/server-id = 16303</span>$server_id<span style="color:#e6db74">/g&#34;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆæƒä»åº“è¿æ¥è´¦æˆ·å¯†ç </span>
</span></span><span style="display:flex;"><span>mysql&gt; grant replication slave on *.* to myuser@<span style="color:#e6db74">&#39;host IP&#39;</span> identified by <span style="color:#e6db74">&#39;password&#39;</span>;
</span></span><span style="display:flex;"><span>mysql&gt; flush privileges;
</span></span><span style="display:flex;"><span>mysql&gt; reset master; <span style="color:#e6db74">&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><strong>é…ç½®ä»åº“è¿æ¥ä¸»åº“</strong></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ID</span>
</span></span><span style="display:flex;"><span>$ server_id<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>hostname -I |awk <span style="color:#e6db74">&#39;{print $1}&#39;</span>|awk -F<span style="color:#e6db74">&#39;.&#39;</span> <span style="color:#e6db74">&#39;{print $4}&#39;</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/server-id = 16303110/server-id = 16303</span>$server_id<span style="color:#e6db74">/g&#34;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®è¿æ¥ä¸»åº“</span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p -S /tmp/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e <span style="color:#e6db74">&#34;CHANGE MASTER TO MASTER_HOST=&#39;127.0.0.1&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_USER=&#39;myuser&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PASSWORD=&#39;password&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PORT=16303, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_LOG_FILE=&#39;mysql-bin.000001&#39;, \  	# ä¸»æœºshow master status;ä¸­çš„File
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_LOG_POS=154,MASTER_CONNECT_RETRY=15;&#34;</span>  	<span style="color:#75715e"># ä¸»æœºshow master status;ä¸­çš„Position.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p -S /tmp/mysql.sock -e <span style="color:#e6db74">&#34;start slave;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p -S /tmp/mysql.sock -e <span style="color:#e6db74">&#34;show slave status\G&#34;</span></span></span></code></pre></div><ul>
<li><strong>é…ç½®å¤šæºå¤åˆ¶</strong></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p -S /tmp/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e <span style="color:#e6db74">&#34;CHANGE MASTER TO MASTER_HOST=&#39;127.0.0.1&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_USER=&#39;myuser&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PASSWORD=&#39;password&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PORT=16303, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">master_auto_position=1  for  channel &#39;rep_master_1&#39;;&#34;</span>  	<span style="color:#75715e"># åå•†ã€å®šä¹‰é¢‘é“å‡ ä¸ªä¸»æœºå®šä¹‰å‡ æ¬¡ã€‚</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h2 id="æ•°æ®åº“å¼€å¯gtidæµç¨‹">æ•°æ®åº“å¼€å¯<code>GTID</code>æµç¨‹</h2>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å¦‚æœå¯ä»¥å…ˆæš‚åœä¸šåŠ¡ï¼ŒæŸ¥è¯¢æ˜¯å¦è¿˜æœ‰ä¸šåŠ¡è¿æ¥</span>
</span></span><span style="display:flex;"><span>mysql&gt; show processlist;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»ä»ä¾æ¬¡æ‰§è¡Œï¼šä¸»åº“æ‰§è¡Œå¥½åï¼Œå»ä»åº“æ‰§è¡Œ ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY<span style="color:#f92672">=</span>WARN;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢ä¸»ä»é”™è¯¯æ—¥å¿—ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰æŠ¥é”™ï¼Œåœ¨åšä¸‹ä¸€æ­¥</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»åº“æ‰§è¡Œå¥½åï¼Œå»ä»åº“æ‰§è¡Œ ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY<span style="color:#f92672">=</span>ON;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»åº“æ‰§è¡Œå¥½åï¼Œå»ä»åº“æ‰§è¡Œ ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.GTID_MODE<span style="color:#f92672">=</span>OFF_PERMISSIVE;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»åº“æ‰§è¡Œå¥½åï¼Œå»ä»åº“æ‰§è¡Œ ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.GTID_MODE<span style="color:#f92672">=</span>ON_PERMISSIVE;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»åº“æŸ¥è¯¢ï¼šç­‰å¾…ä»åº“è¿™ä¸ªçŠ¶æ€å˜ä¸º0</span>
</span></span><span style="display:flex;"><span>mysql&gt; show status like <span style="color:#e6db74">&#39;ONGOING_ANONYMOUS_TRANSACTION_COUNT&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»ä»æ‰§è¡Œï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.gtid_mode<span style="color:#f92672">=</span>on;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»åº“æ‰§è¡Œï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; stop slave;
</span></span><span style="display:flex;"><span>mysql&gt; change master to master_auto_position<span style="color:#f92672">=</span>1;
</span></span><span style="display:flex;"><span>mysql&gt; start slave;</span></span></code></pre></div></blockquote>
<hr>
<h2 id="mysqlå¼€å¯æ—¥å¿—å®¡è®¡"><code>Mysql</code>å¼€å¯æ—¥å¿—å®¡è®¡</h2>
<blockquote>
<ul>
<li></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¿æ¥æ•°æ®åº“æ‰§è¡Œè¯­å¥ï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; CREATE TABLE <span style="color:#e6db74">`</span>mysql<span style="color:#e6db74">`</span>.<span style="color:#e6db74">`</span>audit_login<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>ID<span style="color:#e6db74">`</span> bigint NOT NULL AUTO_INCREMENT COMMENT <span style="color:#e6db74">&#39;è‡ªå¢ID&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>USER<span style="color:#e6db74">`</span> varchar<span style="color:#f92672">(</span>128<span style="color:#f92672">)</span>  NOT NULL COMMENT <span style="color:#e6db74">&#39;æ•°æ®åº“ä¸­çš„ç”¨æˆ·&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>HOST<span style="color:#e6db74">`</span> varchar<span style="color:#f92672">(</span>64<span style="color:#f92672">)</span>  DEFAULT NULL COMMENT <span style="color:#e6db74">&#39;ç™»å½•çš„IP&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>DB<span style="color:#e6db74">`</span> varchar<span style="color:#f92672">(</span>64<span style="color:#f92672">)</span>  DEFAULT NULL COMMENT <span style="color:#e6db74">&#39;è®¿é—®çš„æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>PROCESSLIST_ID<span style="color:#e6db74">`</span> bigint NOT NULL COMMENT <span style="color:#e6db74">&#39;ç”¨æˆ·è¿æ¥&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>LOGIN_TIME<span style="color:#e6db74">`</span> datetime<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> DEFAULT CURRENT_TIMESTAMP<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> COMMENT <span style="color:#e6db74">&#39;ç™»å½•æ—¶é—´&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>UPDATE_TIME<span style="color:#e6db74">`</span> datetime<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> DEFAULT CURRENT_TIMESTAMP<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> ON UPDATE CURRENT_TIMESTAMP<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> COMMENT <span style="color:#e6db74">&#39;è®°å½•è¿™è¡Œæ•°æ®ä¸Šæ¬¡è¢«ä¿®æ”¹çš„æ—¶é—´,é»˜è®¤ç­‰äºLOGIN_TIME&#39;</span>,
</span></span><span style="display:flex;"><span>PRIMARY KEY <span style="color:#f92672">(</span><span style="color:#e6db74">`</span>ID<span style="color:#e6db74">`</span><span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>KEY <span style="color:#e6db74">`</span>IDX_USER<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span><span style="color:#e6db74">`</span>USER<span style="color:#e6db74">`</span><span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>KEY <span style="color:#e6db74">`</span>IDX_HOST<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span><span style="color:#e6db74">`</span>HOST<span style="color:#e6db74">`</span><span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>KEY <span style="color:#e6db74">`</span>IDX_LOGIN_TIME<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span><span style="color:#e6db74">`</span>LOGIN_TIME<span style="color:#e6db74">`</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span> ENGINE<span style="color:#f92672">=</span>InnoDB COMMENT <span style="color:#e6db74">&#34;ç”¨æˆ·ç™»å½•å®¡è®¡æ—¥å¿—è¡¨&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢æˆæƒSQLï¼Œå¤åˆ¶æŸ¥è¯¢å‡ºæ¥çš„SQLè¯­å¥ï¼Œæ‰§è¡Œæˆæƒ</span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#66d9ef">select</span> concat<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;grant select,insert on mysql.audit_login to &#39;&#34;</span>,user,<span style="color:#e6db74">&#34;&#39;@&#39;&#34;</span>,host,<span style="color:#e6db74">&#34;&#39;;&#34;</span><span style="color:#f92672">)</span> grants_sql from mysql.user where user not in <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;mysql.session&#39;</span>,<span style="color:#e6db74">&#39;mysql.sys&#39;</span><span style="color:#f92672">)</span> and Super_priv<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;N&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰§è¡Œï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; set global init_connect<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;insert into mysql.audit_login(USER,HOST,DB,PROCESSLIST_ID) values(current_user(),substring_index(user(),&#39;@&#39;,-1),database(),connection_id());&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®å‚æ•°æ–‡ä»¶ï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysqld<span style="color:#f92672">]</span> 
</span></span><span style="display:flex;"><span>init_connect<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;insert into mysql.audit_login(USER,HOST,DB,PROCESSLIST_ID) values(current_user(),substring_index(user(),&#39;@&#39;,-1),database(),connection_id());&#34;</span>;  <span style="color:#75715e">#DBA add</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æœ€åæ‰§è¡Œçœ‹çœ‹æœ‰æ²¡æœ‰æ•°æ®ï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#66d9ef">select</span> * from mysql.audit_login;</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ä¸»ä»è·³è¿‡å¤åˆ¶é”™è¯¯">ä¸»ä»è·³è¿‡å¤åˆ¶é”™è¯¯</h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://blog.51cto.com/arthur376/1969935" rel="external" target="_self">ä¸»ä»è·³è¿‡å¤åˆ¶é”™è¯¯</a></li>
</ol>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># åœæ­¢å¤åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> slave stop;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾å®šè·³è¿‡ä¸€ä¸ªäº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SET</span> GLOBAL SQL_SLAVE_SKIP_COUNTER <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°å¼€å¯å¤åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span>slave start
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿™æ ·å°±æ­£å¸¸äº†ï¼Œä½†æ˜¯ï¼Œå½“ç„¶è¿˜æ˜¯è¦æŠŠæ•°æ®ä¿®æ”¹ä¸Šå»
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span><span style="color:#66d9ef">update</span> <span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">set</span> <span style="color:#960050;background-color:#1e0010">ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="sqlä¼˜åŒ–å®¡æ ¸å¹³å°å·¥å…·"><code>SQL</code>ä¼˜åŒ–ã€å®¡æ ¸å¹³å°å·¥å…·</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…<a href="https://guide.yearning.io/install.html" rel="external" target="_self"><code>Yearning</code></a><code>SQL</code>å®¡æ ¸å·¥å…·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é»˜è®¤è´¦å·/å¯†ç ï¼š<!-- raw HTML omitted --><code>admin/Yearning_admin</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install wget unzip
</span></span><span style="display:flex;"><span>$ wget -P /opt/src/ https://github.com/cookieY/Yearning/releases/download/v3.1.0/Yearning-v3.1.0-linux-amd64.zip  
</span></span><span style="display:flex;"><span>$ unzip -d /opt/yearning /opt/src/Yearning-v3.1.0-linux-amd64.zip  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/Port = &#34;</span>3306<span style="color:#e6db74">&#34;/Port = &#34;</span>16303<span style="color:#e6db74">&#34;/g&#34;</span> /opt/apps/yearning/conf.toml  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/Password = &#39;xxxx&#39;/Password = &#39;p@ssw0rd&#39;/g&#34;</span> /opt/apps/yearning/conf.toml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /bin/mysql -uroot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -S /opt/data/data_16303/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -p -e <span style="color:#e6db74">&#34;create database Yearning DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ bin/mysql -uroot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -S /opt/data/data_16303/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -p -e <span style="color:#e6db74">&#34;grant all on *.* to root@&#39;127.0.0.1&#39; identified by &#34;</span>p@ssw0rd<span style="color:#e6db74">&#34;;&#34;</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./Yearning install  	<span style="color:#75715e"># å…ˆåˆå§‹åŒ–</span>
</span></span><span style="display:flex;"><span>$ ./Yearning run
</span></span><span style="display:flex;"><span>$ ./Yearning run --push <span style="color:#e6db74">&#34;åŸŸåã€æˆ–è€…IPåœ°å€&#34;</span> --port <span style="color:#e6db74">&#34;8000&#34;</span>  	<span style="color:#75715e"># æŒ‡å®šåŸŸåç«¯å£æ–¹å¼å¯åŠ¨</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å®‰è£…ç¾å›¢<code>SQL</code>ä¼˜åŒ–å·¥å…·<a href="https://github.com/Meituan-Dianping/SQLAdvisor/blob/master/doc/QUICK_START.md" rel="external" target="_self"><code>SQL-Advisor</code></a><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://segmentfault.com/a/1190000022883633" rel="external" target="_self"><code>MySQL-SQLAdvisor</code>çš„ç®€å•å®‰è£…ä½¿ç”¨</a></li>
<li><a href="https://tech.meituan.com/2017/03/09/sqladvisor-pr.html" rel="external" target="_self">ç¾å›¢ç‚¹è¯„<code>SQL</code>ä¼˜åŒ–å·¥å…·<code>SQLAdvisor</code>å¼€æº</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install git wget cmake libaio-devel libffi-devel glib2 glib2-devel  
</span></span><span style="display:flex;"><span>$ yum -y install --enablerepo<span style="color:#f92672">=</span>Percona56 Percona-Server-shared-56  
</span></span><span style="display:flex;"><span>$ git clone https://github.com/Meituan-Dianping/SQLAdvisor.git /opt/src/sqladvisor  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd /opt/src/sqladvisor
</span></span><span style="display:flex;"><span>$ cmake -DBUILD_CONFIG<span style="color:#f92672">=</span>mysql_release <span style="color:#ae81ff">\ </span>
</span></span><span style="display:flex;"><span> -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span>debug <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span>/usr/local/sqlparser ./
</span></span><span style="display:flex;"><span>$ make <span style="color:#f92672">&amp;&amp;</span> make install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. DCMAKE_INSTALL_PREFIXä¸ºsqlparseråº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶çš„å®‰è£…ç›®å½•ï¼Œå…¶ä¸­libç›®å½•åŒ…å«åº“æ–‡ä»¶libsqlparser.soï¼Œincludeç›®å½•åŒ…å«æ‰€éœ€çš„æ‰€æœ‰å¤´æ–‡ä»¶ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. DCMAKE_INSTALL_PREFIXå€¼å°½é‡ä¸è¦ä¿®æ”¹ï¼Œåé¢å®‰è£…ä¾èµ–è¿™ä¸ªç›®å½•ã€‚  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd SQLAdvisor/sqladvisor/
</span></span><span style="display:flex;"><span>$ cmake -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span>debug ./
</span></span><span style="display:flex;"><span>$ make
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨æœ¬è·¯å¾„ä¸‹ç”Ÿæˆä¸€ä¸ªsqladvisorå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™å³æ˜¯æˆ‘ä»¬æƒ³è¦</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;sql.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[sqladvisor]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">username=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dbname=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sqls=sql1;sql2;sql3....
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cmd: ./sqladvisor -f sql.cnf  -v 1</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><a href="https://www.justdojava.com/2021/07/20/canal/" rel="external" target="_self">ç›‘å¬<code>MySQL binlog</code>å®ç°æ•°æ®å˜åŒ–åçš„å®æ—¶é€šçŸ¥</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://github.com/alibaba/canal" rel="external" target="_self"><code>Github Alibaba Canal</code></a></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>explain</code><!-- raw HTML omitted -->çš„ä½¿ç”¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://developer.aliyun.com/article/1104750#slide-12" rel="external" target="_self"><code>Mysql</code>ä¼˜åŒ–é«˜çº§ç¯‡</a></li>
<li><code>explain</code>+<code>sql</code>è¯­å¥</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> Tables_name;</span></span></code></pre></div><blockquote>
<ul>
<li><code>id</code>ï¼šè¡¨çš„è¯»å–é¡ºåº</li>
<li><code>select_type</code>ï¼šæ•°æ®è¯»å–æ“ä½œçš„æ“ä½œç±»å‹</li>
<li><code>possible_keys</code>ï¼šå“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨</li>
<li><code>key</code>ï¼šå“ªäº›ç´¢å¼•è¢«å®é™…ä½¿ç”¨</li>
<li><code>ref</code>ï¼šè¡¨ä¹‹é—´çš„å¼•ç”¨</li>
<li><code>rows</code>ï¼šæ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢</li>
</ul>
</blockquote>
</blockquote>
<ul>
<li>
<ol start="5">
<li><code>SQL</code>å®¡è®¡</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://www.jianshu.com/p/513b7c95e1e8" rel="external" target="_self"><code>MySQL</code>å®¡è®¡æ’ä»¶ä»‹ç»</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥æ•°æ®åº“å®‰è£…å®¡è®¡æ’ä»¶</span>
</span></span><span style="display:flex;"><span>mysql&gt; INSTALL PLUGIN server_audit SONAME <span style="color:#e6db74">&#39;server_audit.so&#39;</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.07 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; show plugins;
</span></span><span style="display:flex;"><span>+----------------------------+--------+--------------------+-----------------+---------+
</span></span><span style="display:flex;"><span>| Name                       | Status | Type               | Library         | License |
</span></span><span style="display:flex;"><span>+----------------------------+--------+--------------------+-----------------+---------+
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>| SERVER_AUDIT               | ACTIVE | AUDIT              | server_audit.so | GPL     |
</span></span><span style="display:flex;"><span>+----------------------------+--------+--------------------+-----------------+---------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ audit åˆå§‹å‚æ•°é…ç½®</span>
</span></span><span style="display:flex;"><span>mysql&gt; show variables like <span style="color:#e6db74">&#39;%audit%&#39;</span>;
</span></span><span style="display:flex;"><span>+-------------------------------+-----------------------+
</span></span><span style="display:flex;"><span>| Variable_name                 | Value                 |
</span></span><span style="display:flex;"><span>+-------------------------------+-----------------------+
</span></span><span style="display:flex;"><span>| server_audit_events           |                       |
</span></span><span style="display:flex;"><span>| server_audit_excl_users       |                       |
</span></span><span style="display:flex;"><span>| server_audit_file_path        | server_audit.log      |
</span></span><span style="display:flex;"><span>| server_audit_file_rotate_now  | OFF                   |
</span></span><span style="display:flex;"><span>| server_audit_file_rotate_size | <span style="color:#ae81ff">1000000</span>               |
</span></span><span style="display:flex;"><span>| server_audit_file_rotations   | <span style="color:#ae81ff">9</span>                     |
</span></span><span style="display:flex;"><span>| server_audit_incl_users       |                       |
</span></span><span style="display:flex;"><span>| server_audit_loc_info         |                       |
</span></span><span style="display:flex;"><span>| server_audit_logging          | OFF                   |
</span></span><span style="display:flex;"><span>| server_audit_mode             | <span style="color:#ae81ff">1</span>                     |
</span></span><span style="display:flex;"><span>| server_audit_output_type      | file                  |
</span></span><span style="display:flex;"><span>| server_audit_query_log_limit  | <span style="color:#ae81ff">1024</span>                  |
</span></span><span style="display:flex;"><span>| server_audit_syslog_facility  | LOG_USER              |
</span></span><span style="display:flex;"><span>| server_audit_syslog_ident     | mysql-server_auditing |
</span></span><span style="display:flex;"><span>| server_audit_syslog_info      |                       |
</span></span><span style="display:flex;"><span>| server_audit_syslog_priority  | LOG_INFO              |
</span></span><span style="display:flex;"><span>+-------------------------------+-----------------------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨çº¿å¼€å¯å®¡è®¡</span>
</span></span><span style="display:flex;"><span>mysql&gt; set global server_audit_logging<span style="color:#f92672">=</span>on;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.00 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; set global server_audit_events<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;connect,table,query_ddl,query_dcl,query_dml_no_select&#39;</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.00 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; set global server_audit_file_path <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/data/mysql/logs/server_audit.log&#39;</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.00 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; set global server_audit_file_rotate_size<span style="color:#f92672">=</span>104857600;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows affected <span style="color:#f92672">(</span>0.01 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># [mysqld]ä¸‹æ·»åŠ ä»¥ä¸‹é…ç½® ä½¿å¾—æ°¸ä¹…ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>server_audit<span style="color:#f92672">=</span>FORCE_PLUS_PERMANENT
</span></span><span style="display:flex;"><span>server_audit_logging<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span>server_audit_file_path<span style="color:#f92672">=</span>/data/mysql/logs/server_audit.log         
</span></span><span style="display:flex;"><span>server_audit_events<span style="color:#f92672">=</span>connect,table,query_ddl,query_dcl,query_dml_no_select
</span></span><span style="display:flex;"><span>server_audit_file_rotate_size<span style="color:#f92672">=</span><span style="color:#ae81ff">104857600</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

        </div>
      </main>
    </div>
    <script src="../../../../js/clipboard.min.js?1723803345" defer></script>
    <script src="../../../../js/perfect-scrollbar.min.js?1723803345" defer></script>
    <script src="../../../../js/theme.js?1723803345" defer></script>
  </body>
</html>
