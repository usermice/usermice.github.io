<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="å®‰è£…Mysql-PXC ä¼ä¸šä¸»æµMySQLé«˜å¯ç”¨é›†ç¾¤æ¶æ„ä¸‰éƒ¨æ›²ä¹‹PXC åœ¨Dockerå®¹å™¨ä¸­è¿è¡ŒPercona XtraDBé›†ç¾¤ dockerå®‰è£…Mysql-PXC $ cat &gt;install-mysql-pxc.sh&lt;&lt;-EOF #!/bin/bash sudo yum -y remove docker \ docker-client \ docker-client-latest \ docker-common \ docker-latest docker-latest-logrotate docker-logrotate \ docker-engine sudo yum install -y yum-utils sudo yum-config-manager --add-repo \ https://download.">
    <meta name="author" content="äºŒå“¥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/s2-1.png">
    <meta name="twitter:title" content="Install_Mysql_PXC :: Hugo Relearn Theme">
    <meta name="twitter:description" content="å®‰è£…Mysql-PXC ä¼ä¸šä¸»æµMySQLé«˜å¯ç”¨é›†ç¾¤æ¶æ„ä¸‰éƒ¨æ›²ä¹‹PXC åœ¨Dockerå®¹å™¨ä¸­è¿è¡ŒPercona XtraDBé›†ç¾¤ dockerå®‰è£…Mysql-PXC $ cat &gt;install-mysql-pxc.sh&lt;&lt;-EOF #!/bin/bash sudo yum -y remove docker \ docker-client \ docker-client-latest \ docker-common \ docker-latest docker-latest-logrotate docker-logrotate \ docker-engine sudo yum install -y yum-utils sudo yum-config-manager --add-repo \ https://download.">
    <meta property="og:url" content="https://erge.blog/systems/linux/databases/install_mysql_pxc/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Install_Mysql_PXC :: Hugo Relearn Theme">
    <meta property="og:description" content="å®‰è£…Mysql-PXC ä¼ä¸šä¸»æµMySQLé«˜å¯ç”¨é›†ç¾¤æ¶æ„ä¸‰éƒ¨æ›²ä¹‹PXC åœ¨Dockerå®¹å™¨ä¸­è¿è¡ŒPercona XtraDBé›†ç¾¤ dockerå®‰è£…Mysql-PXC $ cat &gt;install-mysql-pxc.sh&lt;&lt;-EOF #!/bin/bash sudo yum -y remove docker \ docker-client \ docker-client-latest \ docker-common \ docker-latest docker-latest-logrotate docker-logrotate \ docker-engine sudo yum install -y yum-utils sudo yum-config-manager --add-repo \ https://download.">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Systems">
    <meta property="article:published_time" content="2024-06-17T21:53:29+08:00">
    <meta property="article:modified_time" content="2024-06-17T21:53:29+08:00">
    <meta property="og:image" content="https://erge.blog/images/s2-1.png">
    <meta itemprop="name" content="Install_Mysql_PXC :: Hugo Relearn Theme">
    <meta itemprop="description" content="å®‰è£…Mysql-PXC ä¼ä¸šä¸»æµMySQLé«˜å¯ç”¨é›†ç¾¤æ¶æ„ä¸‰éƒ¨æ›²ä¹‹PXC åœ¨Dockerå®¹å™¨ä¸­è¿è¡ŒPercona XtraDBé›†ç¾¤ dockerå®‰è£…Mysql-PXC $ cat &gt;install-mysql-pxc.sh&lt;&lt;-EOF #!/bin/bash sudo yum -y remove docker \ docker-client \ docker-client-latest \ docker-common \ docker-latest docker-latest-logrotate docker-logrotate \ docker-engine sudo yum install -y yum-utils sudo yum-config-manager --add-repo \ https://download.">
    <meta itemprop="datePublished" content="2024-06-17T21:53:29+08:00">
    <meta itemprop="dateModified" content="2024-06-17T21:53:29+08:00">
    <meta itemprop="wordCount" content="679">
    <meta itemprop="image" content="https://erge.blog/images/s2-1.png">
    <title>Install_Mysql_PXC :: Hugo Relearn Theme</title>
    <link href="../../../../images/favicon.ico?1720186644" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../../css/fontawesome-all.min.css?1720186645" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/fontawesome-all.min.css?1720186645" rel="stylesheet"></noscript>
    <link href="../../../../css/nucleus.css?1720186645" rel="stylesheet">
    <link href="../../../../css/auto-complete.css?1720186645" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/auto-complete.css?1720186645" rel="stylesheet"></noscript>
    <link href="../../../../css/perfect-scrollbar.min.css?1720186645" rel="stylesheet">
    <link href="../../../../css/fonts.css?1720186645" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../css/fonts.css?1720186645" rel="stylesheet"></noscript>
    <link href="../../../../css/theme.css?1720186645" rel="stylesheet">
    <link href="../../../../css/theme-relearn-auto.css?1720186645" rel="stylesheet" id="R-variant-style">
    <link href="../../../../css/chroma-relearn-auto.css?1720186645" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../../css/variant.css?1720186645" rel="stylesheet">
    <link href="../../../../css/print.css?1720186645" rel="stylesheet" media="print">
    <link href="../../../../css/format-print.css?1720186645" rel="stylesheet">
    <script src="../../../../js/variant.js?1720186645"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../../systems/linux/databases/install_mysql_pxc/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../systems/linux/databases/"><span itemprop="name">Databases</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Install_Mysql_PXC</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../../systems/linux/databases/install_otter/" title="Install_Otter (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../../systems/linux/databases/install_mysql_router/" title="Install_MySQL_Router (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_mysql_pxc">Install_Mysql_PXC</h1>

<h2 id="å®‰è£…mysql-pxc">å®‰è£…<code>Mysql-PXC</code></h2>
<blockquote>
<ul>
<li><a href="https://blog.51cto.com/sumongodb/1956086" rel="external" target="_self">ä¼ä¸šä¸»æµ<code>MySQL</code>é«˜å¯ç”¨é›†ç¾¤æ¶æ„ä¸‰éƒ¨æ›²ä¹‹<code>PXC</code></a></li>
<li><a href="https://www.percona.com/doc/percona-xtradb-cluster/LATEST/install/docker.html" rel="external" target="_self">åœ¨<code>Docker</code>å®¹å™¨ä¸­è¿è¡Œ<code>Percona XtraDB</code>é›†ç¾¤</a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><code>docker</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Mysql-PXC</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;install-mysql-pxc.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo yum -y remove docker \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-client \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-client-latest \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-common \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-latest 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-latest-logrotate 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-logrotate \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-engine  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo yum install -y yum-utils
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo yum-config-manager --add-repo \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">https://download.docker.com/linux/centos/docker-ce.repo  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo yum install -y docker-ce docker-ce-cli containerd.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo systemctl start docker
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo systemctl enable docker
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mkdir -p /opt/data/{data-3306.data-3307,data-3308}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker network create pxc-network  	# åˆ›å»ºç½‘ç»œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker run -i -d -p 3306:3306 -v /etc/localtime:/etc/localtime -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=cluster1 --name=node1 --privileged=true --net=pxc-network percona/percona-xtradb-cluster:5.7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 15
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker run -i -d -p 3307:3306 -v /etc/localtime:/etc/localtime -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=cluster1 -e CLUSTER_JOIN=node1 --name=node2 --privileged=true --net=pxc-network percona/percona-xtradb-cluster:5.7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker run -i -d -p 3308:3306 -v /etc/localtime:/etc/localtime -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=cluster1 -e CLUSTER_JOIN=node1 --name=node3 --privileged=true --net=pxc-network percona/percona-xtradb-cluster:5.7  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker exec -it node1 /usr/bin/mysql -uroot -proot -e &#34;show status like &#39;wsrep%&#39;;&#34;  	# ç™»å½•æ•°æ®åº“æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€, ä¿®æ”¹å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># show status like &#39;wsrep%&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>Yum</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>PXC</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->æœ€å°‘å‡†å¤‡ä¸‰å°æœåŠ¡å™¨ï¼Œåœ¨ä¸‰å°æœåŠ¡å™¨ä¸ŠåŒæ­¥æ‰§è¡Œå‘½ä»¤<!-- raw HTML omitted --></p>
</li>
<li>
<p><!-- raw HTML omitted -->å…ˆå¸è½½ç³»ç»Ÿè‡ªå¸¦æ•°æ®åº“ï¼Œé˜²ç«å¢™å¼€æ”¾åŒæ­¥ç«¯å£ï¼š<!-- raw HTML omitted -->4567<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;pxc-install.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum -y remove mariadb* 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum install -y https://repo.percona.com/yum/percona-release-latest.noarch.rpm  	# å®‰è£… PXC çš„ Yum æº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum install Percona-XtraDB-Cluster-57 -y  	# å®‰è£… PXC æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">systemctl enable mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">systemctl start mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pass=`grep &#34;temporary password&#34; /var/log/mysqld.log |awk &#39;{print $11}&#39;` 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=`openssl rand -base64 14`  	# ç”Ÿæˆéšå³å¯†ç   
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mysql -uroot -p$pass -e &#34;alter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;$password&#39;;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mysql -uroot -p$password -e &#34; flush privileges;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å…³é—­æ‰€æœ‰èŠ‚ç‚¹æ•°æ®åº“ã€å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl stop mysql</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>my.cnf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/my.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[mysqld]  	# å¿…é¡»å®šä¹‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">!includedir /etc/my.cnf.d/  	# åŸæœ‰ä¸åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">!includedir /etc/percona-xtradb-cluster.conf.d/  	# åŸæœ‰ä¸åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_provider=/usr/lib64/galera3/libgalera_smm.so  	# æä¾›ç¨‹åºçš„è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_cluster_name=pxc-cluster  	# å®šä¹‰çš„é›†ç¾¤åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_cluster_address=gcomm://192.168.2.11,192.168.2.12,192.168.2.13  # æ‰€æœ‰çš„é›†ç¾¤èŠ‚ç‚¹IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_node_name=pxc1  	# å®šä¹‰æœ¬æœºçš„åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_node_address=192.168.2.11  	# å®šä¹‰æœ¬æœºIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_sst_method=xtrabackup-v2  	# åŒæ­¥æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_sst_auth=sstuser:password  	# æä¾›åŒæ­¥å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pxc_strict_mode=ENFORCING  	# ä¸¥æ ¼æ¨¡å¼(å¼ºåˆ¶æ‰§è¡Œ)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">binlog_format=ROW  	# è¡Œæ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_storage_engine=InnoDB  	# é»˜è®¤å­˜å‚¨å¼•æ“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">innodb_autoinc_lock_mode=2  	# è‡ªå¢é”å®šæ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å…ˆå¯åŠ¨ä¸»èŠ‚ç‚¹ï¼Œç¡®ä¿ä¸»åº“æ•°æ®åŒæ­¥åˆ°å…¶ä»–ä»èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>wsrep_cluster_size=1</code>è¡¨ç¤ºé›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ å·²ç»è¿æ¥å¹¶ä¸”çŠ¶æ€æ—¶<code>primary</code>éšæ—¶å†™å…¥æ•°æ®åˆ°é›†ç¾¤ï¼Œå†åŠ å…¥å…¶ä»–ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹å‰ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªSSTï¼ˆState Snapshot Transferï¼‰è´¦å·ç”¨äºé›†ç¾¤é—´é€šä¿¡ï¼Œå¿…é¡»å’Œä¸»æœº<code>my.cnf</code>é…ç½®çš„å‚æ•°ä¸€è‡´</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl restart mysql@bootstrap.service
</span></span><span style="display:flex;"><span>$ mysql -uroot -p$password -e <span style="color:#e6db74">&#34;show status like &#39;wsrep%&#39;;&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ ç”¨æˆ·å¹¶ä¸”èµ‹äºˆæƒé™ <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysql -uroot -p$password -e <span style="color:#e6db74">&#34;CREATE USER &#39;sstuser&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;password&#39;;&#34;</span>  
</span></span><span style="display:flex;"><span>$ mysql -uroot -p$password -e <span style="color:#e6db74">&#34;GRANT RELOAD, LOCK TABLES, PROCESS, REPLICATION CLIENT ON *.* TO &#39;sstuser&#39;@&#39;localhost&#39;;&#34;</span>
</span></span><span style="display:flex;"><span>$ mysql -uroot -p$password -e <span style="color:#e6db74">&#34;FLUSH PRIVILEGES;&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åœ¨ä»èŠ‚ç‚¹ä¾æ¬¡å¯åŠ¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>PXC</code><!-- raw HTML omitted -->å¯¼å‡ºæ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqldump -uroot -p --skip_add_locks --skip-lock-tables  LY_report  &gt; /root/LY_report<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>.sql</span></span></code></pre></div><ul>
<li><a href="http://www.dboracle.com/archivers/%E5%BC%BA%E8%A1%8C%E5%85%B3%E6%9C%BA%E4%B9%8B%E5%90%8E%EF%BC%8Cpercona-xtradb-cluster%E9%9B%86%E7%BE%A4%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8.html" rel="external" target="_self">å¼ºè¡Œå…³æœºä¹‹åï¼Œ<code>PERCONA XTRADB CLUSTER</code>é›†ç¾¤æ— æ³•å¯åŠ¨</a></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>grastate.dat</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/var/lib/mysql/grastate.dat<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># GALERA saved state
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">version: 2.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">uuid:    8050b2ae-5de7-11ea-b72e-1b7d1643b17c
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">seqno:   975
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">safe_to_bootstrap: 0  	# æ­¤å€¼å¤§çš„å…ˆå¯åŠ¨ã€å¦‚æœéƒ½æ˜¯ 0ï¼Œæ‰¾ä¸ªä¿®æ”¹æˆ 1 å³å¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>4.1.2 <!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /etc/percona-xtradb-cluster.conf.d/my.cnf  
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>client<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>socket<span style="color:#f92672">=</span>/var/lib/mysql/mysql.sock
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysql<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>prompt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\u@db2 \R:\m:\s [\d]&gt; &#34;</span>
</span></span><span style="display:flex;"><span>no-auto-rehash
</span></span><span style="display:flex;"><span>server-id<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># server-idæ¯ä¸ªæœåŠ¡å™¨å”¯ä¸€</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿™é‡Œå®šä¹‰æ•°æ®ç›®å½•å’Œæ—¥å¿—ç›®å½•</span>
</span></span><span style="display:flex;"><span>datadir<span style="color:#f92672">=</span>/var/lib/mysql
</span></span><span style="display:flex;"><span>socket<span style="color:#f92672">=</span>/var/lib/mysql/mysql.sock
</span></span><span style="display:flex;"><span>log-error<span style="color:#f92672">=</span>/var/log/mysqld.log
</span></span><span style="display:flex;"><span>pid-file<span style="color:#f92672">=</span>/var/run/mysqld/mysqld.pid
</span></span><span style="display:flex;"><span>log-bin <span style="color:#f92672">=</span> /var/lib/mysql/mybinlog
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>log_slave_updates
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bind-address <span style="color:#f92672">=</span> 0.0.0.0  	<span style="color:#75715e"># ç›‘å¬åœ°å€</span>
</span></span><span style="display:flex;"><span>port <span style="color:#f92672">=</span> <span style="color:#ae81ff">3306</span>  	<span style="color:#75715e"># ç›‘å¬ç«¯å£</span>
</span></span><span style="display:flex;"><span>default_storage_engine<span style="color:#f92672">=</span>InnoDB  	<span style="color:#75715e"># é»˜è®¤æ•°æ®åº“å¼•æ“</span>
</span></span><span style="display:flex;"><span>character-set-server <span style="color:#f92672">=</span> utf8mb4  	<span style="color:#75715e"># å­—ç¬¦é›†</span>
</span></span><span style="display:flex;"><span>collation-server <span style="color:#f92672">=</span> utf8mb4_general_ci  	<span style="color:#75715e"># æ’åºè§„åˆ™</span>
</span></span><span style="display:flex;"><span>max_connections <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>  	<span style="color:#75715e"># æœ€å¤§è¿æ¥æ•°</span>
</span></span><span style="display:flex;"><span>open_files_limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">65535</span>  	<span style="color:#75715e"># é™åˆ¶æ‰“å¼€æ–‡ä»¶æ•°</span>
</span></span><span style="display:flex;"><span>default-time-zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;+8:00&#39;</span>  	<span style="color:#75715e"># é»˜è®¤æ—¶åŒº</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®æ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«</span>
</span></span><span style="display:flex;"><span>transaction_isolation <span style="color:#f92672">=</span> REPEATABLE-READ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®è¶…æ—¶æ—¶é—´</span>
</span></span><span style="display:flex;"><span>interactive_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>wait_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>connect_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>lock_wait_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">3600</span>
</span></span><span style="display:flex;"><span>max_allowed_packet <span style="color:#f92672">=</span> 64M  	<span style="color:#75715e"># é™åˆ¶æ•°æ®åº“æœåŠ¡å™¨æ¥æ”¶æ•°æ®åŒ…çš„å¤§å°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®æ’åºå’Œjoinçš„bufferå¤§å°</span>
</span></span><span style="display:flex;"><span>sort_buffer_size <span style="color:#f92672">=</span> 4M
</span></span><span style="display:flex;"><span>join_buffer_size <span style="color:#f92672">=</span> 4M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®binlog</span>
</span></span><span style="display:flex;"><span>binlog_format<span style="color:#f92672">=</span>ROW
</span></span><span style="display:flex;"><span>expire_logs_days<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¼€å¯binlogæ ¡éªŒåŠŸèƒ½</span>
</span></span><span style="display:flex;"><span>binlog_checksum <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>binlog_cache_size <span style="color:#f92672">=</span> 4M
</span></span><span style="display:flex;"><span>sync_binlog <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æ¯1æ¬¡æäº¤å˜æ›´åç«‹åˆ»å°†binlogè½ç›˜</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®performance_schema</span>
</span></span><span style="display:flex;"><span>performance_schema <span style="color:#f92672">=</span> on
</span></span><span style="display:flex;"><span>performance_schema_instrument <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%memory%=on&#39;</span>
</span></span><span style="display:flex;"><span>performance_schema_instrument <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%lock%=on&#39;</span>
</span></span><span style="display:flex;"><span>skip-external-locking <span style="color:#f92672">=</span> on
</span></span><span style="display:flex;"><span>skip-name-resolve <span style="color:#f92672">=</span> on  	<span style="color:#75715e"># ç¦ç”¨åŸŸåè§£æ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¦ç”¨è½¯é“¾æ¥</span>
</span></span><span style="display:flex;"><span>symbolic-links<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>back_log <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ…¢æ—¥å¿—æŸ¥è¯¢é…ç½®</span>
</span></span><span style="display:flex;"><span>slow_query_log <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>long_query_time <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>slow_query_log_file <span style="color:#f92672">=</span> /var/log/mysqld/slow.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®æ¯ä¸ªEVENTéƒ½è¦æ‰§è¡Œåˆ·ç›˜æ“ä½œ</span>
</span></span><span style="display:flex;"><span>sync_master_info <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>sync_relay_log_info <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>sync_relay_log <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>log_slave_updates <span style="color:#f92672">=</span> on
</span></span><span style="display:flex;"><span>relay_log_recovery <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>relay_log_purge <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>master_info_repository <span style="color:#f92672">=</span> TABLE
</span></span><span style="display:flex;"><span>relay_log_info_repository <span style="color:#f92672">=</span> TABLE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># InnoDBå¼•æ“é…ç½®</span>
</span></span><span style="display:flex;"><span>innodb_file_per_table <span style="color:#f92672">=</span> on
</span></span><span style="display:flex;"><span>innodb_checksums <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_checksum_algorithm <span style="color:#f92672">=</span> crc32
</span></span><span style="display:flex;"><span>innodb_status_file <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_status_output <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_status_output_locks <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_stats_on_metadata <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_open_files <span style="color:#f92672">=</span> <span style="color:#ae81ff">65535</span>
</span></span><span style="display:flex;"><span>innodb_flush_method <span style="color:#f92672">=</span> O_DIRECT
</span></span><span style="display:flex;"><span>innodb_flush_sync <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_flush_neighbors <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¯ä¸ªäº‹åŠ¡æäº¤åç«‹å³åˆ·æ–°binlogæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>innodb_flush_log_at_trx_commit <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_innodb&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_server&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_dml&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_ddl&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_trx&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_os&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_purge&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_log&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_lock&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_buffer&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_index&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_ibuf_system&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_buffer_page&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_adaptive_hash&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SQL modeé…ç½®ï¼Œè¿™é‡Œæ˜¯é»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>sql_mode <span style="color:#f92672">=</span> ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># GTIDé…ç½®</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#gtid_mode = on</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#enforce_gtid_consistency = 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># wsrepé…ç½®</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This changes how InnoDB autoincrement locks are managed and is a requirement for Galera</span>
</span></span><span style="display:flex;"><span>innodb_autoinc_lock_mode<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>wsrep_cluster_name<span style="color:#f92672">=</span>pxc-cluster  	<span style="color:#75715e"># Cluster nameé›†ç¾¤åç§°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>wsrep_cluster_address<span style="color:#f92672">=</span>gcomm://10.14.23.78:4567,10.14.23.180:4567,10.14.23.181:4567
</span></span><span style="display:flex;"><span>wsrep_provider<span style="color:#f92672">=</span>/usr/lib64/galera3/libgalera_smm.so
</span></span><span style="display:flex;"><span><span style="color:#75715e">#If wsrep_node_name is not specified,  then system hostname will be used</span>
</span></span><span style="display:flex;"><span>wsrep_node_name <span style="color:#f92672">=</span> db2
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Slave thread to use</span>
</span></span><span style="display:flex;"><span>wsrep_slave_threads<span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SST method</span>
</span></span><span style="display:flex;"><span>wsrep_sst_method<span style="color:#f92672">=</span>xtrabackup-v2
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Node IP address</span>
</span></span><span style="display:flex;"><span>wsrep_node_address <span style="color:#f92672">=</span> 10.14.23.180
</span></span><span style="display:flex;"><span>wsrep_sst_receive_address <span style="color:#f92672">=</span> 10.14.23.180
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Authentication for SST method</span>
</span></span><span style="display:flex;"><span>wsrep_sst_auth<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sstuser:sstuser_password&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pxc_strict_mode allowed values: DISABLED,PERMISSIVE,ENFORCING,MASTER</span>
</span></span><span style="display:flex;"><span>pxc_strict_mode<span style="color:#f92672">=</span>ENFORCING
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysqld_safe<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>pid-file <span style="color:#f92672">=</span> /var/run/mysqld/mysqld.pid
</span></span><span style="display:flex;"><span>socket   <span style="color:#f92672">=</span> /var/lib/mysql/mysql.sock
</span></span><span style="display:flex;"><span>nice     <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

        </div>
      </main>
    </div>
    <script src="../../../../js/clipboard.min.js?1720186645" defer></script>
    <script src="../../../../js/perfect-scrollbar.min.js?1720186645" defer></script>
    <script src="../../../../js/theme.js?1720186645" defer></script>
  </body>
</html>
