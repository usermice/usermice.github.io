<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <meta name="author" content="äºŒå“¥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/s2-1.png">
    <meta name="twitter:title" content="Databases :: Hugo Relearn Theme">
    <meta property="og:url" content="https://erge.blog/systems/linux/databases/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Databases :: Hugo Relearn Theme">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://erge.blog/images/s2-1.png">
    <meta itemprop="name" content="Databases :: Hugo Relearn Theme">
    <meta itemprop="datePublished" content="2024-06-13T00:23:11+08:00">
    <meta itemprop="dateModified" content="2024-06-13T00:23:11+08:00">
    <meta itemprop="image" content="https://erge.blog/images/s2-1.png">
    <title>Databases :: Hugo Relearn Theme</title>
    <link href="../../../images/favicon.ico?1719333223" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../../css/fontawesome-all.min.css?1719333224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fontawesome-all.min.css?1719333224" rel="stylesheet"></noscript>
    <link href="../../../css/nucleus.css?1719333224" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1719333224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/auto-complete.css?1719333224" rel="stylesheet"></noscript>
    <link href="../../../css/perfect-scrollbar.min.css?1719333224" rel="stylesheet">
    <link href="../../../css/fonts.css?1719333224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fonts.css?1719333224" rel="stylesheet"></noscript>
    <link href="../../../css/theme.css?1719333224" rel="stylesheet">
    <link href="../../../css/theme-relearn-auto.css?1719333224" rel="stylesheet" id="R-variant-style">
    <link href="../../../css/chroma-relearn-auto.css?1719333224" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../../css/variant.css?1719333224" rel="stylesheet">
    <link href="../../../css/print.css?1719333224" rel="stylesheet" media="print">
    <link href="../../../css/format-print.css?1719333224" rel="stylesheet">
    <script src="../../../js/variant.js?1719333224"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../../systems/linux/databases/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/"><span itemprop="name">Systems</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../systems/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Databases</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/email/install_iredmail/" title="Install_iRedMail (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../../systems/linux/databases/update_mysql5-7_to_mysql8/" title="Update_Mysql5 7_To_Mysql8 (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="databases">Databases</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Databases</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="update_mysql5-7_to_mysql8">Update_Mysql5 7_To_Mysql8</h1>

<h2 id="mysql-57-å‡çº§åˆ°mysql-8"><code>Mysql 5.7 </code>å‡çº§åˆ°<code>Mysql 8</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸‹è½½è§£å‹<code>Mysql 8</code>å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz -P /usr/local/src/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar -xvf /usr/local/src/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz -C  /usr/local/src/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mv /usr/local/src/mysql-8.0.21-linux-glibc2.12-x86_64  /usr/local/mysql8</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ä¿®æ”¹<code>Mysql</code>çš„<code>cnf</code>æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<p><!-- raw HTML omitted -->åªæ›´æ”¹å·¥ä½œç›®å½•ï¼Œä¸æ›´æ”¹ data æ•°æ®ç›®å½•<!-- raw HTML omitted --></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sed  -i <span style="color:#e6db74">&#34;s#/usr/local/mysql#/usr/local/mysql8#g&#34;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/sql_mode/#sql_mode/g&#39;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;20i sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION&#39;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;20i default_authentication_plugin=mysql_native_password&#39;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/query_cache_size/#query_cache_size/g&#39;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/query_cache_limit/#query_cache_limit/g&#39;</span> /etc/my.cnf</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->å¤‡ä»½<code>Mysql</code>æ•°æ®ã€ç›®å½•ï¼Œåœæ­¢ç°æœ‰<!-- raw HTML omitted --><code>Mysql</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p<span style="color:#e6db74">&#39;password&#39;</span> -S /opt/data/data_16303/mysql.sock -e <span style="color:#e6db74">&#34;set global innodb_fast_shutdown=0;&#34;</span>
</span></span><span style="display:flex;"><span>$ mysql -uroot -p<span style="color:#e6db74">&#39;password&#39;</span> -S /opt/data/data_16303/mysql.sock -e <span style="color:#e6db74">&#34;shutdown;&#34;</span>
</span></span><span style="display:flex;"><span>$ cp -r /usr/local/mysql/data<span style="color:#f92672">{</span>,.bak<span style="color:#f92672">}</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å¯åŠ¨<!-- raw HTML omitted --><code>Mysql 8</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/mysql8/bin/mysqld --defaults-file<span style="color:#f92672">=</span>/etc/my.cnf --user<span style="color:#f92672">=</span>mysql &amp;
</span></span><span style="display:flex;"><span>$ mv /usr/local/mysql  /usr/local/src/mysql-5.7-<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>.bak</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å‡çº§æˆåŠŸ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/mysql8/bin/mysql -uroo -p<span style="color:#e6db74">&#39;password&#39;</span> -S /tmp/mysql.sock -e <span style="color:#e6db74">&#34;select version();&#34;</span> | tail -1<span style="color:#e6db74">`</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_ydb">Install_Ydb</h1>

<h2 id="éƒ¨ç½²ydbå•èŠ‚ç‚¹æ•°æ®åº“">éƒ¨ç½²<code>Ydb</code>å•èŠ‚ç‚¹æ•°æ®åº“</h2>
<blockquote>
<ol>
<li><code>Ydb</code><!-- raw HTML omitted -->ä½¿ç”¨ç«¯å£<!-- raw HTML omitted --></li>
</ol>
<table>
<thead>
<tr>
<th>ç«¯å£</th>
<th>åè®®</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>2135~2136</td>
<td><code>TCP</code></td>
<td>ç”¨äºå®¢æˆ·ç«¯-é›†ç¾¤äº¤äº’çš„<code>GRPC</code></td>
</tr>
<tr>
<td>19001~19002</td>
<td><code>TCP</code></td>
<td>é›†ç¾¤å†…èŠ‚ç‚¹äº¤äº’äº’è¿</td>
</tr>
<tr>
<td>8765~8766</td>
<td><code>TCP</code></td>
<td>é›†ç¾¤ç›‘æ§çš„<code>HTTP</code>æ¥å£</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>
<ol>
<li><a href="https://ydb.tech/" rel="external" target="_self"><code>Ydb</code></a>æ•°æ®åº“ã€<a href="https://github.com/ydb-platform/ydb" rel="external" target="_self"><code>Github-Ydb</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ç³»ç»Ÿè¦æ±‚<!-- raw HTML omitted --><code>Ubuntu 20.04ã€Debian 11ã€Fedora34</code><!-- raw HTML omitted -->ç­‰ä»¥ä¸Šç‰ˆæœ¬ç³»ç»Ÿ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mkdir -p /opt/<span style="color:#f92672">{</span>ydb,ydb-cli<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$ cd /opt/ydb/
</span></span><span style="display:flex;"><span>$ curl https://binaries.ydb.tech/local_scripts/install.sh | bash</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯åŠ¨ã€åœæ­¢<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç£ç›˜å¯åŠ¨ä½¿ç”¨ï¼Œç£ç›˜æœ€å°‘ä¸èƒ½ä½äº 80G</span>
</span></span><span style="display:flex;"><span>$ ./start.sh disk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†…å­˜å¯åŠ¨ï¼Œå†…å­˜å¯åŠ¨æœåŠ¡å™¨é‡å¯æ•°æ®ä¸¢å¤±</span>
</span></span><span style="display:flex;"><span>$ ./start.sh ram
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœæ­¢</span>
</span></span><span style="display:flex;"><span>$ ./stop.sh</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->éƒ¨ç½²<!-- raw HTML omitted --><code>Ydb-cli</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -sSL https://storage.yandexcloud.net/yandexcloud-ydb/install.sh | bash
</span></span><span style="display:flex;"><span>$ source /root/.bashrc</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Ydb-cli</code>æŸ¥è¯¢</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpc://localhost:2136 -d /Root/test scheme ls
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ydb -e grpc://nodeip:2136 -d /Root/testdb workload stock init
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨YDB Webé¡µé¢</span>
</span></span><span style="display:flex;"><span>$ ydb -e grpc://nodeip:2136 -d /Root/testdb workload stock run add-rand-order -s <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ydb -e grpc://192.168.88.112:2136 -d /Root/testdb topic read orders/updates -c ilnaz --wait --format<span style="color:#f92672">=</span>newline-delimited</span></span></code></pre></div></blockquote>
<hr>
<h2 id="éƒ¨ç½²é›†ç¾¤æ¨¡å¼">éƒ¨ç½²é›†ç¾¤æ¨¡å¼</h2>
<h3 id="å®‰è£…å‰å‡†å¤‡">å®‰è£…å‰å‡†å¤‡</h3>
<blockquote>
<ol>
<li><a href="https://ydb.tech/en/docs/deploy/manual/deploy-ydb-on-premises" rel="external" target="_self">åœ¨è™šæ‹Ÿæˆ–è£¸æœºæœåŠ¡å™¨ä¸Šéƒ¨ç½²<code>YDB</code>é›†ç¾¤</a></li>
</ol>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è™šæ‹Ÿæœºç³»ç»Ÿå®‰è£…å¥½åï¼Œé‡æ–°æ·»åŠ <!-- raw HTML omitted --><code>NVMe(v)</code>ç±»å‹ç£ç›˜</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å‡†å¤‡ç¯å¢ƒã€ç”¨æˆ·<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo groupadd ydb
</span></span><span style="display:flex;"><span>$ sudo useradd ydb -g ydb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo usermod -aG disk ydb  	<span style="color:#75715e"># ä¸ºäº†ç¡®ä¿YDBå¯ä»¥è®¿é—®å—ç£ç›˜æ¥è¿è¡Œï¼Œæ‚¨éœ€è¦å°†è¿›ç¨‹æ‰€æœ‰è€…æ·»åŠ åˆ°diskç»„ä¸­</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ apt install sudo  	<span style="color:#75715e"># ä½¿ç”¨rootç”¨æˆ·å®‰è£…sudo</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;name  ALL=(ALL:ALL) ALL&#34;</span> &gt;&gt;/etc/sudoers
</span></span><span style="display:flex;"><span>$ sudo apt install curl parted</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åœ¨æ‰€é€‰ç£ç›˜ä¸Šåˆ›å»ºåˆ†åŒº<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo parted /dev/nvme0n1 mklabel gpt -s
</span></span><span style="display:flex;"><span>$ sudo parted -a optimal /dev/nvme0n1 mkpart primary 0% 100%
</span></span><span style="display:flex;"><span>$ sudo parted /dev/nvme0n1 name <span style="color:#ae81ff">1</span> ydb_disk_ssd_01
</span></span><span style="display:flex;"><span>$ sudo partx --u /dev/nvme0n1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo parted /dev/nvme0n2 mklabel gpt -s
</span></span><span style="display:flex;"><span>$ sudo parted -a optimal /dev/nvme0n2 mkpart primary 0% 100%
</span></span><span style="display:flex;"><span>$ sudo parted /dev/nvme0n2 name <span style="color:#ae81ff">1</span> ydb_disk_ssd_02
</span></span><span style="display:flex;"><span>$ sudo partx --u /dev/nvme0n2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo parted /dev/nvme0n3 mklabel gpt -s
</span></span><span style="display:flex;"><span>$ sudo parted -a optimal /dev/nvme0n3 mkpart primary 0% 100%
</span></span><span style="display:flex;"><span>$ sudo parted /dev/nvme0n3 name <span style="color:#ae81ff">1</span> ydb_disk_ssd_03
</span></span><span style="display:flex;"><span>$ sudo partx --u /dev/nvme0n3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç³»ç»Ÿä¸Šå°†å‡ºç°ä¸€ä¸ªæ ‡æœ‰ç£ç›˜çš„ç£ç›˜ </span>
</span></span><span style="display:flex;"><span>$ ll /dev/disk/by-partlabel/</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ä¸‹è½½å¹¶è§£å‹åŒ…å«<code>ydbd</code>å¯æ‰§è¡Œæ–‡ä»¶å’Œ<code>YDB</code>è¿è¡Œæ‰€éœ€åº“çš„å­˜æ¡£<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo chown -R ydb:ydb /opt
</span></span><span style="display:flex;"><span>$ mkdir -p /opt/<span style="color:#f92672">{</span>ydb/<span style="color:#f92672">{</span>cfg,secure,certs,log<span style="color:#f92672">}</span>,ydbd-stable-linux-amd64<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ curl -L https://binaries.ydb.tech/ydbd-stable-linux-amd64.tar.gz | tar -xz --strip-component<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> -C /opt/ydbd-stable-linux-amd64</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å°†å¯æ‰§è¡Œæ–‡ä»¶å’Œåº“å¤åˆ¶åˆ°é€‚å½“çš„ç›®å½•<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cp -iR /opt/ydbd-stable-linux-amd64/bin /opt/ydb/
</span></span><span style="display:flex;"><span>$ sudo cp -iR /opt/ydbd-stable-linux-amd64/lib /opt/ydb/</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ä½¿ç”¨ä»¥ä¸‹å†…ç½®å‘½ä»¤æ ¼å¼åŒ–ç£ç›˜<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib /opt/ydb/bin/ydbd admin bs disk obliterate /dev/disk/by-partlabel/ydb_disk_ssd_01
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib /opt/ydb/bin/ydbd admin bs disk obliterate /dev/disk/by-partlabel/ydb_disk_ssd_02
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib /opt/ydb/bin/ydbd admin bs disk obliterate /dev/disk/by-partlabel/ydb_disk_ssd_03</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å‡†å¤‡è¯ä¹¦ä½¿ç”¨ä¿æŠ¤æ¨¡å¼">å‡†å¤‡è¯ä¹¦ä½¿ç”¨ä¿æŠ¤æ¨¡å¼</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å‡†å¤‡<code>CA</code>æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ydb/cfg/ca.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ ca ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_ca = CA_default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ CA_default ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_days = 365
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">database = /opt/ydb/secure/index.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">serial = /opt/ydb/secure/serial.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_md = sha256
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">copy_extensions = copy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">unique_subject = no
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ req ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">prompt=no
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">distinguished_name = distinguished_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">x509_extensions = extensions
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ distinguished_name ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">organizationName = YDB
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">commonName = YDB CA
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ extensions ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">keyUsage = critical,digitalSignature,nonRepudiation,keyEncipherment,keyCertSign
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basicConstraints = critical,CA:true,pathlen:1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ signing_policy ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">organizationName = supplied
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">commonName = optional
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ signing_node_req ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">keyUsage = critical,digitalSignature,keyEncipherment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">extendedKeyUsage = serverAuth,clientAuth
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Used to sign client certificates. ç”¨äºç­¾ç½²å®¢æˆ·ç«¯è¯ä¹¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ signing_client_req ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">keyUsage = critical,digitalSignature,keyEncipherment
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">extendedKeyUsage = clientAuth
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ›å»º<code>CA</code>å¯†é’¥<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl genrsa -out /opt/ydb/certs/ca.key <span style="color:#ae81ff">2048</span></span></span></code></pre></div><ul>
<li>2.1 <!-- raw HTML omitted -->åˆ›å»ºç§æœ‰è¯ä¹¦é¢å‘æœºæ„<code>CA</code>è¯ä¹¦<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl req -new -x509 -config /opt/ydb/cfg/ca.cnf -key /opt/ydb/certs/ca.key -out /opt/ydb/certs/ca.crt -days <span style="color:#ae81ff">1830</span> -batch</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åˆ›å»ºæ–‡æœ¬æ•°æ®åº“å’Œ<code>OpenSSL</code>è¯ä¹¦ç´¢å¼•æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ touch /opt/ydb/secure/index.txt
</span></span><span style="display:flex;"><span>$ echo <span style="color:#ae81ff">01</span> &gt;/opt/ydb/secure/serial.txt</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->åˆ›å»º<code>node.cnf</code>å…·æœ‰ä»¥ä¸‹å†…å®¹çš„é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ydb/cfg/node.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># OpenSSL node configuration file
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ req ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">prompt = no
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">distinguished_name = distinguished_name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">req_extensions = extensions
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ distinguished_name ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">organizationName = YDB
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[ extensions ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">subjectAltName = DNS:&lt;node&gt;.&lt;domain&gt;  	# èŠ‚ç‚¹IPæˆ–è€…åŸŸå
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºè¯ä¹¦å¯†é’¥<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl genrsa -out /opt/ydb/certs/node.key <span style="color:#ae81ff">2048</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚<code>CSR</code><!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl req -new -sha256 -config /opt/ydb/cfg/node.cnf -key /opt/ydb/certs/node.key -out /opt/ydb/secure/node.csr -batch</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºèŠ‚ç‚¹è¯ä¹¦<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ openssl ca -config /opt/ydb/cfg/ca.cnf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -keyfile /opt/ydb/certs/ca.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -cert /opt/ydb/certs/ca.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -policy signing_policy <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -extensions signing_node_req <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -out /opt/ydb/certs/node.crt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -outdir /opt/ydb/certs/ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -in /opt/ydb/secure/node.csr -batch</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å°†è¯ä¹¦å’ŒèŠ‚ç‚¹å¯†é’¥å¤åˆ¶åˆ°å®‰è£…æ–‡ä»¶å¤¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo -u ydb cp certs/ca.crt certs/node.crt certs/node.key /opt/ydb/certs/</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ä¸ºydbå‡†å¤‡é›†ç¾¤é…ç½®æ–‡ä»¶">ä¸º<code>YDB</code>å‡†å¤‡é›†ç¾¤é…ç½®æ–‡ä»¶</h3>
<blockquote>
<ul>
<li><a href="https://ydb.tech/en/docs/deploy/configuration/config" rel="external" target="_self">é›†ç¾¤é…ç½®</a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->é›†ç¾¤ç±»å‹ã€åœ¨é›†ç¾¤æ¯ä¸ªèŠ‚ç‚¹ä¸­æ·»åŠ <!-- raw HTML omitted --><code>/opt/ydb/cfg/config.yaml</code>ä¿å­˜<code>YDB</code> é…ç½®æ–‡ä»¶</li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://github.com/ydb-platform/ydb/blob/main/ydb/deploy/yaml_config_examples/block-4-2.yaml" rel="external" target="_self"><code>block-4-2</code></a><!-- raw HTML omitted -->ç”¨äºå•æ•°æ®ä¸­å¿ƒé›†ç¾¤<!-- raw HTML omitted --></li>
<li><a href="https://github.com/ydb-platform/ydb/blob/main/ydb/deploy/yaml_config_examples/mirror-3dc-9-nodes.yaml" rel="external" target="_self"><code>mirror-3dc</code></a><!-- raw HTML omitted -->ç”¨äºç”± 9 ä¸ªèŠ‚ç‚¹ç»„æˆçš„è·¨æ•°æ®ä¸­å¿ƒé›†ç¾¤<!-- raw HTML omitted --></li>
<li><a href="https://github.com/ydb-platform/ydb/blob/main/ydb/deploy/yaml_config_examples/mirror-3dc-3-nodes.yaml" rel="external" target="_self"><code>mirror-3dc-3nodes</code></a><!-- raw HTML omitted -->ç”¨äºç”± 3 ä¸ªèŠ‚ç‚¹ç»„æˆçš„è·¨æ•°æ®ä¸­å¿ƒé›†ç¾¤<!-- raw HTML omitted --></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åœ¨<code>host_configs</code>éƒ¨åˆ†ä¸­ï¼ŒæŒ‡å®šæ¯ä¸ªç¾¤é›†èŠ‚ç‚¹ä¸Šæ‰€æœ‰ç£ç›˜ç±»å‹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯ç”¨ç£ç›˜ç§ç±»ï¼šå›ºæ€ç¡¬ç›˜ï¼š<code>SSD</code>ã€<code>NVME</code>ã€<code>HDD</code><!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">host_configs</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">drive</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/dev/disk/by-partlabel/ydb_disk_ssd_01</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">SSD  	# å¯ç”¨ç£ç›˜ç§ç±»ï¼šSSDã€NVMEã€HDD</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">host_config_id</span>: <span style="color:#ae81ff">1</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åœ¨è¯¥<code>hosts</code>éƒ¨åˆ†ä¸­ï¼ŒæŒ‡å®šæ¯ä¸ªèŠ‚ç‚¹çš„<code>FQDN</code>ã€å®ƒä»¬çš„é…ç½®å’Œåœ¨<code>data_center</code>æˆ–ä¸­çš„ä½ç½®<code>rack</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨<!-- raw HTML omitted --><code>/etc/hosts</code><!-- raw HTML omitted -->æ–‡ä»¶ä¸‹åšæ˜ å°„ï¼š<!-- raw HTML omitted --><code>IP:hostname</code><!-- raw HTML omitted -->é¿å…ä¸å¿…è¦éº»çƒ¦æ‰€æœ‰ä¸»æœºåå¿…é¡»éƒ½æ˜¯å°å†™å­—æ¯<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">hosts</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">host</span>: <span style="color:#ae81ff">node1.ydb.tech</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">host_config_id</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">walle_location</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">body</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">data_center</span>: <span style="color:#e6db74">&#39;zone-a&#39;</span>  	<span style="color:#75715e"># å¡«å†™ hostname</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rack</span>: <span style="color:#e6db74">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">host</span>: <span style="color:#ae81ff">node2.ydb.tech</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">host_config_id</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">walle_location</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">body</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">data_center</span>: <span style="color:#e6db74">&#39;zone-b&#39;</span>  	<span style="color:#75715e"># å¡«å†™ hostname</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rack</span>: <span style="color:#e6db74">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">host</span>: <span style="color:#ae81ff">node3.ydb.tech</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">host_config_id</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">walle_location</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">body</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">data_center</span>: <span style="color:#e6db74">&#39;zone-c&#39;</span>  	<span style="color:#75715e"># å¡«å†™ hostname</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rack</span>: <span style="color:#e6db74">&#39;1&#39;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->å¯ç”¨ç”¨æˆ·èº«ä»½éªŒè¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨<code>YDB</code>é›†ç¾¤ä¸­å¯ç”¨è®¤è¯å’Œç”¨æˆ·è®¿é—®å·®å¼‚åŒ–ç‰¹æ€§ï¼Œåœ¨<code>domains_config</code>éƒ¨åˆ†æ·»åŠ ä»¥ä¸‹å‚æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">domains_config</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">security_config</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enforce_user_token_requirement</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">monitoring_allowed_sids</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;root&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;ADMINS&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;DATABASE-ADMINS&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">administration_allowed_sids</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;root&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;ADMINS&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;DATABASE-ADMINS&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">viewer_allowed_sids</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;root&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;ADMINS&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;DATABASE-ADMINS&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->åœ¨<code>YDB</code>é…ç½®æ–‡ä»¶ä¸­å¯ç”¨æµé‡åŠ å¯†æ¨¡å¼<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åœ¨<code>interconnect_config</code>å’Œ<code>grpc_config</code>éƒ¨åˆ†ä¸­ï¼ŒæŒ‡å®šè¯ä¹¦ã€å¯†é’¥å’Œ<code>CA</code>è¯ä¹¦çš„è·¯å¾„<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">interconnect_config</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">start_tcp</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">encryption_mode</span>: <span style="color:#ae81ff">OPTIONAL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path_to_certificate_file</span>: <span style="color:#e6db74">&#34;/opt/ydb/certs/node.crt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path_to_private_key_file</span>: <span style="color:#e6db74">&#34;/opt/ydb/certs/node.key&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path_to_ca_file</span>: <span style="color:#e6db74">&#34;/opt/ydb/certs/ca.crt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">grpc_config</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">cert</span>: <span style="color:#e6db74">&#34;/opt/ydb/certs/node.crt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;/opt/ydb/certs/node.key&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ca</span>: <span style="color:#e6db74">&#34;/opt/ydb/certs/ca.crt&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="6">
<li><!-- raw HTML omitted -->å®Œæ•´<!-- raw HTML omitted --><code>block-4-2</code>é…ç½®<!-- raw HTML omitted -->é¿å…ä¸å¿…è¦éº»çƒ¦æ‰€æœ‰ä¸»æœºåå¿…é¡»éƒ½æ˜¯å°å†™å­—æ¯<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/ydb/cfg/config.yaml<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># YDB configuration options and their values
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># are described in documentaion https://ydb.tech/en/docs/deploy/configuration/config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># static erasure is the parameter that
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># describes the fault tolerance mode of the
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># cluster. See docs for more details https://ydb.tech/en/docs/deploy/configuration/config#domains-blob
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">static_erasure: mirror-3-dc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host_configs: # the list of available host configurations in the cluster.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- drive:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - path: /dev/disk/by-partlabel/ydb_disk_ssd_01    # path of the first disk in the host configration.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: NVME                                       # kind of the disk: available kinds are SSD, NVME, HDD
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - path: /dev/disk/by-partlabel/ydb_disk_ssd_02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - path: /dev/disk/by-partlabel/ydb_disk_ssd_03
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  host_config_id: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">hosts:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- host: debian-1-88-110       # storage node DNS name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  host_config_id: 1                 # numeric host configuration template identifier
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  walle_location:                   # this parameter describes where host is located.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    body: 1                         # string representing a host serial number.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    data_center: &#39;debian-1-88-110&#39;           # string representing the datacenter / availability zone where the host is located.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                    # if cluster is deployed using mirror-3-dc fault tolerance mode, all hosts must be distributed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                    # across 3 datacenters.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    rack: &#39;1&#39;                       # string representing a rack identifier where the host is located.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                    # if cluster is deployed using block-4-2 erasure, all hosts should be distrubited
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                    # accross at least 8 racks.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- host: ubuntu-1-88-111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  host_config_id: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  walle_location:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    body: 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    data_center: &#39;ubuntu-1-88-111&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    rack: &#39;2&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- host: ubuntu-2-88-112
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  host_config_id: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  walle_location:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    body: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    data_center: &#39;ubuntu-2-88-112&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    rack: &#39;3&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">domains_config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # There can be only one root domain in a cluster. Domain name prefixes all scheme objects names, e.g. full name of a table table1 in database db1.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  # in a cluster with domains_config.domain.name parameter set to Root would be equal to /Root/db1/table1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  domain:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Root
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    storage_pool_types:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - kind: nvme
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      pool_config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        box_id: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # fault tolerance mode name - none, block-4-2, or mirror-3-dc..
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # See docs for more details https://ydb.tech/en/docs/deploy/configuration/config#domains-blob
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        erasure_species: mirror-3-dc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        kind: nvme
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        geometry:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          realm_level_begin: 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          realm_level_end: 20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          domain_level_begin: 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          domain_level_end: 256
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        pdisk_filter:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - property:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - type: NVME  # device type to match host_configs.drive.type
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        vdisk_kind: Default
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  state_storage:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - ring:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      node: [1, 2, 3]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      nto_select: 3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ssid: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">table_service_config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  sql_version: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">actor_system_config:          # the configuration of the actor system which descibes how cores of the instance are distributed
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  executor:                   # accross different types of workloads in the instance.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: System              # system executor of the actor system. in this executor YDB launches system type of workloads, like system tablets
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                              # and reads from storage.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    threads: 2                # the number of threads allocated to system executor.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: BASIC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: User                # user executor of the actor system. In this executor YDB launches user workloads, like datashard activities,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                              # queries and rpc calls.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    threads: 3                # the number of threads allocated to user executor.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: BASIC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: Batch               # user executor of the actor system. In this executor YDB launches batch operations, like scan queries, table
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                              # compactions, background compactions.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    threads: 2                # the number of threads allocated to the batch executor.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: BASIC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: IO                  # the io executor. In this executor launches sync operations and writes logs.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    threads: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    time_per_mailbox_micro_secs: 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: IO
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - name: IC                  # the interconnect executor which YDB uses for network communications accross different nodes of the cluster.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    spin_threshold: 10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    threads: 1                # the number of threads allocated to the interconnect executor.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    time_per_mailbox_micro_secs: 100
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    type: BASIC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  scheduler:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    progress_threshold: 10000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    resolution: 256
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    spin_threshold: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">blob_storage_config:         # configuration of static blobstorage group.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                             # YDB uses this group to store system tablets&#39; data, like SchemeShard
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  service_set:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    groups:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - erasure_species: mirror-3-dc # fault tolerance mode name for the static group
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      rings:          # in mirror-3-dc must have exactly 3 rings or availability zones
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - fail_domains:  # first record: fail domains of the static group describe where each vdisk of the static group should be located.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: debian-1-88-110
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: debian-1-88-110
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: debian-1-88-110
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_03
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - fail_domains: # second ring: fail domains of the static group describe where each vdisk of the static group should be located.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: ubuntu-1-88-111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: ubuntu-1-88-111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: ubuntu-1-88-111
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_03
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      - fail_domains: # third ring: fail domains of the static group describe where each vdisk of the static group should be located.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: ubuntu-2-88-112
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_01
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: ubuntu-2-88-112
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_02
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        - vdisk_locations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          - node_id: ubuntu-2-88-112
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            pdisk_category: NVME
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            path: /dev/disk/by-partlabel/ydb_disk_ssd_03
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">channel_profile_config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  profile:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  - channel:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - erasure_species: mirror-3-dc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      pdisk_category: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      storage_pool_kind: nvme
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - erasure_species: mirror-3-dc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      pdisk_category: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      storage_pool_kind: nvme
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - erasure_species: mirror-3-dc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      pdisk_category: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      storage_pool_kind: nvme
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    profile_id: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">interconnect_config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    start_tcp: true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    encryption_mode: OPTIONAL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    path_to_certificate_file: &#34;/opt/ydb/certs/node.crt&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    path_to_private_key_file: &#34;/opt/ydb/certs/node.key&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    path_to_ca_file: &#34;/opt/ydb/certs/ca.crt&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">grpc_config:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    cert: &#34;/opt/ydb/certs/node.crt&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    key: &#34;/opt/ydb/certs/node.key&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ca: &#34;/opt/ydb/certs/ca.crt&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="å¯åŠ¨æ•°æ®åº“é™æ€èŠ‚ç‚¹">å¯åŠ¨æ•°æ®åº“é™æ€èŠ‚ç‚¹</h3>
<h4 id="æ‰‹åŠ¨æ–¹å¼å¯åŠ¨">æ‰‹åŠ¨æ–¹å¼å¯åŠ¨</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å¯åŠ¨<code>/Root/testdb</code>æ•°æ®åº“çš„<code>YDB</code>åŠ¨æ€èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>&lt;nodeN.ydb.tech&gt;</code><!-- raw HTML omitted -->è¿è¡Œé™æ€èŠ‚ç‚¹çš„æœåŠ¡å™¨çš„<code>FQDN</code>åœ¨å“ªé‡Œ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šè¿è¡Œé¢å¤–çš„åŠ¨æ€èŠ‚ç‚¹ä»¥ç¡®ä¿æ•°æ®åº“å¯ç”¨æ€§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo su - ydb
</span></span><span style="display:flex;"><span>$ cd /opt/ydb
</span></span><span style="display:flex;"><span>$ export LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib
</span></span><span style="display:flex;"><span>/opt/ydb/bin/ydbd server --log-level <span style="color:#ae81ff">3</span> --tcp --yaml-config /opt/ydb/cfg/config.yaml --grpc-port <span style="color:#ae81ff">2135</span> --ic-port <span style="color:#ae81ff">19001</span> --mon-port <span style="color:#ae81ff">8765</span> --node static &gt;/opt/ydb/log/static-node.out 2&gt;/opt/ydb/log/static-node.err &amp;&gt;</span></span></code></pre></div></blockquote>
<hr>
<h4 id="ä½¿ç”¨systemdæ–¹å¼å¯åŠ¨">ä½¿ç”¨<code>systemd</code>æ–¹å¼å¯åŠ¨</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>/etc/systemd/system/ydbd-storage.service</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/systemd/system/ydbd-storage.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=YDB storage node
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network-online.target rc-local.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Wants=network-online.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StartLimitInterval=10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StartLimitBurst=15
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RestartSec=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">User=ydb  	# æ ¹æ®ç”¨æˆ·ä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PermissionsStartOnly=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StandardOutput=/var/log/ydb.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StandardError=/var/log/ydb.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogIdentifier=ydbd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogFacility=daemon
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogLevel=err
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Environment=LD_LIBRARY_PATH=/opt/ydb/lib
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/ydb/bin/ydbd server --log-level 3 --syslog --tcp --yaml-config  /opt/ydb/cfg/config.yaml --grpc-port 2135 --ic-port 19001 --mon-port 8765 --node static
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitCORE=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitMEMLOCK=3221225472
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¯åŠ¨æœåŠ¡å™¨ã€æŸ¥çœ‹çŠ¶æ€<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo systemctl start ydbd-storage
</span></span><span style="display:flex;"><span>$ sudo systemctl status ydbd-storage</span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆå§‹åŒ–é›†ç¾¤">åˆå§‹åŒ–é›†ç¾¤</h3>
<h4 id="ä¸ä½¿ç”¨èº«ä»½éªŒè¯æ–¹å¼åˆå§‹åŒ–é›†ç¾¤">ä¸ä½¿ç”¨èº«ä»½éªŒè¯æ–¹å¼åˆå§‹åŒ–é›†ç¾¤</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœ¨å…¶ä¸­ä¸€ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šï¼Œè¿è¡Œå‘½ä»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib
</span></span><span style="display:flex;"><span>/opt/ydb/bin/ydbd admin blobstorage config init --yaml-file  /opt/ydb/cfg/config.yaml
</span></span><span style="display:flex;"><span>$ echo $?</span></span></code></pre></div></blockquote>
<hr>
<h4 id="ä½¿ç”¨èº«ä»½éªŒè¯æ–¹å¼åˆå§‹åŒ–é›†ç¾¤">ä½¿ç”¨èº«ä»½éªŒè¯æ–¹å¼åˆå§‹åŒ–é›†ç¾¤</h4>
<blockquote>
<p>è¦åœ¨å¯ç”¨ç”¨æˆ·è®¤è¯æ¨¡å¼çš„é›†ç¾¤ä¸­æ‰§è¡Œç®¡ç†å‘½ä»¤ï¼ˆåŒ…æ‹¬é›†ç¾¤åˆå§‹åŒ–ã€æ•°æ®åº“åˆ›å»ºã€ç£ç›˜ç®¡ç†ç­‰ï¼‰ï¼Œæ‚¨å¿…é¡»é¦–å…ˆä½¿ç”¨<code>YDB CLI</code>å®¢æˆ·ç«¯<code>2.0.0</code>æˆ–æ›´é«˜ç‰ˆæœ¬è·å–è®¤è¯ä»¤ç‰Œã€‚<a href="https://ydb.tech/en/docs/reference/ydb-cli/install" rel="external" target="_self">æ‚¨å¿…é¡»æŒ‰ç…§å®‰è£…è¯´æ˜</a>å°†<code>YDB CLI</code>å®¢æˆ·ç«¯å®‰è£…åœ¨ä»»ä½•å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®é›†ç¾¤èŠ‚ç‚¹çš„è®¡ç®—æœºä¸Šï¼ˆä¾‹å¦‚ï¼Œåœ¨å…¶ä¸­ä¸€ä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸Šï¼‰ã€‚</p>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç¬¬ä¸€æ¬¡å®‰è£…é›†ç¾¤æ—¶ï¼Œå®ƒåªæœ‰ä¸€ä¸ª<code>root</code>å¯†ç ä¸ºç©ºçš„å¸æˆ·ï¼Œå› æ­¤è·å–ä»¤ç‰Œçš„å‘½ä»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->ä»»ä½•é›†ç¾¤æœåŠ¡å™¨éƒ½å¯ä»¥æŒ‡å®šä¸ºè¿æ¥æœåŠ¡å™¨ï¼ˆ<code>-e</code>æˆ–<code>--endpoint</code>å‚æ•°ï¼‰<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpc://&lt;node1.ydb.tech&gt;:2135 -d /Root --user root --no-password auth get-token --force &gt;token-file</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å¦‚æœå¯ç”¨äº†<!-- raw HTML omitted --><code>TLS</code>æµé‡ä¿æŠ¤ï¼Œè¯·ä½¿ç”¨å—ä¿æŠ¤çš„<code>grpcs</code>åè®®è€Œä¸æ˜¯<code>grpc</code>ä¸Šé¢å‘½ä»¤ä¸­çš„åè®®ï¼Œå¹¶åœ¨å‚æ•°ä¸­é¢å¤–æŒ‡å®š<code>CA</code>è¯ä¹¦çš„è·¯å¾„<code>--ca-file</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpcs://&lt;node1.ydb.tech&gt;:2135 -d /Root --ca-file /opt/ydb/certs/ca.crt --user root --no-password auth get-token --force &gt;token-file</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œèº«ä»½éªŒè¯ä»¤ç‰Œå°†è¢«å†™å…¥<code>token-file</code>. åªéœ€è¦å°†æ­¤æ–‡ä»¶å¤åˆ¶åˆ°ç¨åè¦è¿è¡Œé›†ç¾¤åˆå§‹åŒ–å’Œæ•°æ®åº“åˆ›å»ºå‘½ä»¤çš„é›†ç¾¤èŠ‚ç‚¹ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨æ­¤é›†ç¾¤èŠ‚ç‚¹ä¸Šè¿è¡Œå‘½ä»¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib
</span></span><span style="display:flex;"><span>/opt/ydb/bin/ydbd -f token-file admin blobstorage config init --yaml-file  /opt/ydb/cfg/config.yaml
</span></span><span style="display:flex;"><span>$ echo $?</span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆ›å»ºæ•°æ®åº“">åˆ›å»ºæ•°æ®åº“</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->è¦ä½¿ç”¨è¡¨ï¼Œæ‚¨éœ€è¦è‡³å°‘åˆ›å»ºä¸€ä¸ªæ•°æ®åº“å¹¶è¿è¡Œä¸€ä¸ªè¿›ç¨‹æ¥ä¸ºè¯¥æ•°æ®åº“æä¾›æœåŠ¡ï¼ˆåŠ¨æ€èŠ‚ç‚¹ï¼‰ä¸ä½¿ç”¨ä»¤ç‰Œ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>/Root</code><!-- raw HTML omitted -->: æ ¹åŸŸçš„åç§°ï¼Œå¿…é¡»ä¸<!-- raw HTML omitted --><code>domains_config</code>. <code>domain</code>. <code>name</code><!-- raw HTML omitted -->åœ¨é›†ç¾¤é…ç½®æ–‡ä»¶ä¸­è®¾ç½®<!-- raw HTML omitted --></li>
<li><code>testdb</code><!-- raw HTML omitted -->: åˆ›å»ºçš„æ•°æ®åº“åç§°<!-- raw HTML omitted --></li>
<li><code>ssd:1</code><!-- raw HTML omitted -->ï¼šå­˜å‚¨æ± çš„åç§°å’Œæ± ä¸­å—çš„ç¼–å·ã€‚æ± åç§°é€šå¸¸è¡¨ç¤ºæ•°æ®å­˜å‚¨è®¾å¤‡çš„ç±»å‹ï¼Œå¹¶ä¸”å¿…é¡»ä¸<!-- raw HTML omitted --><code>storage_pool_types</code>. <code>kind</code><!-- raw HTML omitted -->é‡Œé¢çš„è®¾ç½®<!-- raw HTML omitted --><code>domains_config</code>ã€‚<code>domain</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶çš„å…ƒç´ <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib /opt/ydb/bin/ydbd admin database /Root/testdb create ssd:1</span></span></code></pre></div><ul>
<li>
<p><!-- raw HTML omitted -->ä½¿ç”¨ä»¤ç‰Œæ–‡ä»¶çš„æ•°æ®åº“åˆ›å»ºå‘½ä»¤<!-- raw HTML omitted --></p>
<p>å¦‚æœåœ¨é›†ç¾¤ä¸­å¯ç”¨äº†ç”¨æˆ·è®¤è¯æ¨¡å¼ï¼Œåˆ™å¿…é¡»å°†è®¤è¯ä»¤ç‰Œä¼ é€’ç»™æ•°æ®åº“åˆ›å»ºå‘½ä»¤ã€‚<a href="https://ydb.tech/en/docs/deploy/manual/deploy-ydb-on-premises#initialize-cluster" rel="external" target="_self">é›†ç¾¤åˆå§‹åŒ–</a>éƒ¨åˆ†æè¿°äº†è·å–ä»¤ç‰Œçš„è¿‡ç¨‹</p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib /opt/ydb/bin/ydbd -f token-file admin database /Root/testdb create ssd:1</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å¯åŠ¨æ•°æ®åº“åŠ¨æ€èŠ‚ç‚¹">å¯åŠ¨æ•°æ®åº“åŠ¨æ€èŠ‚ç‚¹</h3>
<h4 id="æ‰‹åŠ¨æ–¹å¼å¯åŠ¨-1">æ‰‹åŠ¨æ–¹å¼å¯åŠ¨</h4>
<ul>
<li>
<ol>
<li>å¯åŠ¨<code>/Root/testdb</code><!-- raw HTML omitted -->æ•°æ®åº“çš„<code>YDB</code>åŠ¨æ€èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>&lt;nodeN.ydb.tech&gt;</code><!-- raw HTML omitted -->è¿è¡Œé™æ€èŠ‚ç‚¹çš„æœåŠ¡å™¨çš„<code>FQDN</code>åœ¨å“ªé‡Œ<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šè¿è¡Œé¢å¤–çš„åŠ¨æ€èŠ‚ç‚¹ä»¥ç¡®ä¿æ•°æ®åº“å¯ç”¨æ€§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo su - ydb
</span></span><span style="display:flex;"><span>$ cd /opt/ydb
</span></span><span style="display:flex;"><span>$ export LD_LIBRARY_PATH<span style="color:#f92672">=</span>/opt/ydb/lib
</span></span><span style="display:flex;"><span>/opt/ydb/bin/ydbd server --grpc-port <span style="color:#ae81ff">2136</span> --ic-port <span style="color:#ae81ff">19002</span> --mon-port <span style="color:#ae81ff">8766</span> --yaml-config  /opt/ydb/cfg/config.yaml --tenant /Root/testdb --node-broker &lt;node1.ydb.tech&gt;:2135 --node-broker &lt;node2.ydb.tech&gt;:2135 --node-broker &lt;node3.ydb.tech&gt;:2135</span></span></code></pre></div></blockquote>
<hr>
<h4 id="ä½¿ç”¨systemdæ–¹å¼å¯åŠ¨-1">ä½¿ç”¨<code>Systemd</code>æ–¹å¼å¯åŠ¨</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç¼–å†™å¯åŠ¨æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->åˆ›å»ºä¸€ä¸ªåä¸º<!-- raw HTML omitted --><code>/etc/systemd/system/ydbd-testdb.service</code><!-- raw HTML omitted -->ä»¥ä¸‹å†…å®¹çš„é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/systemd/system/ydbd-testdb.service<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=YDB testdb dynamic node
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=network-online.target rc-local.service
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Wants=network-online.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StartLimitInterval=10
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StartLimitBurst=15
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Restart=always
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">RestartSec=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">User=ydb
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PermissionsStartOnly=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StandardOutput=syslog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">StandardError=syslog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogIdentifier=ydbd
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogFacility=daemon
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SyslogLevel=err
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Environment=LD_LIBRARY_PATH=/opt/ydb/lib
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/opt/ydb/bin/ydbd server --grpc-port 2136 --ic-port 19002 --mon-port 8766 --yaml-config  /opt/ydb/cfg/config.yaml --tenant /Root/testdb --node-broker &lt;node1.ydb.tech&gt;:2135 --node-broker &lt;node2.ydb.tech&gt;:2135 --node-broker &lt;node3.ydb.tech&gt;:2135
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitNOFILE=65536
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitCORE=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LimitMEMLOCK=32212254720
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>å¯åŠ¨<code>/Root/testdb</code><!-- raw HTML omitted -->æ•°æ®åº“çš„<code>YDB</code>åŠ¨æ€èŠ‚ç‚¹<!-- raw HTML omitted --><!-- raw HTML omitted -->åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šè¿è¡Œé¢å¤–çš„åŠ¨æ€èŠ‚ç‚¹ä»¥ç¡®ä¿æ•°æ®åº“å¯ç”¨æ€§<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo systemctl start ydbd-testdb</span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆå§‹å¸æˆ·è®¾ç½®">åˆå§‹å¸æˆ·è®¾ç½®</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åœ¨é›†ç¾¤é…ç½®æ–‡ä»¶ä¸­å¯ç”¨äº†èº«ä»½éªŒè¯æ¨¡å¼ï¼Œåˆ™å¿…é¡»åœ¨ä½¿ç”¨<code>YDB</code>é›†ç¾¤ä¹‹å‰å®Œæˆåˆå§‹å¸æˆ·è®¾ç½®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><code>YDB</code>é›†ç¾¤çš„åˆå§‹å®‰è£…ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>root</code>å¯†ç ä¸ºç©ºçš„å¸æˆ·ï¼Œä»¥åŠ<a href="https://ydb.tech/en/docs/cluster/access" rel="external" target="_self">è®¿é—®ç®¡ç†</a>éƒ¨åˆ†ä¸­æè¿°çš„ä¸€ç»„æ ‡å‡†ç”¨æˆ·ç»„</p>
</li>
<li>
<p>è¦åœ¨åˆ›å»ºçš„<code>YDB</code>é›†ç¾¤ä¸­æ‰§è¡Œåˆå§‹å¸æˆ·è®¾ç½®ï¼Œ<a href="https://ydb.tech/en/docs/reference/ydb-cli/install" rel="external" target="_self">æŒ‰ç…§æ–‡æ¡£</a>ä¸­çš„æè¿°å®‰è£…<code>YDB CLI</code></p>
</li>
<li>
<p><code>&lt;node.ydb.tech&gt;</code>æ˜¯è¿è¡Œæ”¯æŒ<code>/Root/testdb</code>æ•°æ®åº“çš„åŠ¨æ€èŠ‚ç‚¹çš„æœåŠ¡å™¨çš„<code>FQDN</code></p>
</li>
<li>
<p>åœ¨è¿è¡Œå¸æˆ·åˆ›å»ºå’Œç»„åˆ†é…å‘½ä»¤æ—¶ï¼Œ<code>YDB CLI</code>å®¢æˆ·ç«¯å°†è¯·æ±‚<code>root</code>ç”¨æˆ·å¯†ç ã€‚<a href="https://ydb.tech/en/docs/reference/ydb-cli/profile/" rel="external" target="_self">æ‚¨å¯ä»¥æŒ‰ç…§<code>YDB CLI</code>æ–‡æ¡£</a>ä¸­çš„è¯´æ˜åˆ›å»ºè¿æ¥é…ç½®æ–‡ä»¶ï¼Œä»è€Œé¿å…è¾“å…¥å¤šä¸ªå¯†ç </p>
</li>
<li>
<p>å¦‚æœé›†ç¾¤ä¸­å¯ç”¨äº†<code>TLS</code>æµé‡ä¿æŠ¤ï¼Œè¯·ä½¿ç”¨å—ä¿æŠ¤çš„<code>grpcs</code>åè®®è€Œä¸æ˜¯<code>grpc</code>ä¸Šé¢å‘½ä»¤ä¸­çš„åè®®ï¼Œå¹¶åœ¨å‚æ•°ä¸­æŒ‡å®š<code>CA</code>è¯ä¹¦çš„è·¯å¾„<code>--ca-file</code>ï¼ˆæˆ–å°†å…¶ä¿å­˜åœ¨è¿æ¥é…ç½®æ–‡ä»¶ä¸­ï¼‰</p>
</li>
<li>
<p><code>root</code><!-- raw HTML omitted -->ä¸ºè´¦æˆ·è®¾ç½®å¯†ç <!-- raw HTML omitted --></p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpc://&lt;node.ydb.tech&gt;:2136 -d /Root/testdb --user root --no-password yql -s <span style="color:#e6db74">&#39;ALTER USER root PASSWORD &#34;passw0rd&#34;&#39;</span>  	<span style="color:#75715e"># å°†passw0rdå€¼æ›¿æ¢ä¸ºè‡ªå·±å®šä¹‰å¯†ç   </span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->åˆ›å»ºå…¶ä»–å¸æˆ·<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpc://&lt;node.ydb.tech&gt;:2136 -d /Root/testdb --user root yql -s <span style="color:#e6db74">&#39;CREATE USER user1 PASSWORD &#34;passw0rd&#34;&#39;</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->é€šè¿‡å°†å®ƒä»¬åŒ…å«åœ¨é›†æˆç»„ä¸­æ¥è®¾ç½®å¸æˆ·æƒé™<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpc://&lt;node.ydb.tech&gt;:2136 -d /Root/testdb --user root yql -s <span style="color:#e6db74">&#39;ALTER GROUP `ADMINS` ADD USER user1&#39;</span></span></span></code></pre></div></blockquote>
<hr>
<h3 id="æµ‹è¯•åˆ›å»ºçš„æ•°æ®åº“">æµ‹è¯•åˆ›å»ºçš„æ•°æ®åº“</h3>
<ul>
<li>
<ol>
<li><a href="https://ydb.tech/en/docs/reference/ydb-cli/install" rel="external" target="_self">æŒ‰ç…§æ–‡æ¡£</a>ä¸­çš„æè¿°å®‰è£…<code>YDB CLI</code>ï¼Œåˆ›å»ºä¸€ä¸ª<code>test_table</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>&lt;node.ydb.tech&gt;</code>è¿è¡Œæ”¯æŒ<code>/Root/testdb</code>æ•°æ®åº“çš„åŠ¨æ€èŠ‚ç‚¹çš„æœåŠ¡å™¨çš„<code>FQDN</code>åœ¨å“ªé‡Œ</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpc://&lt;node.ydb.tech&gt;:2136 -d /Root/testdb scripting yql --script <span style="color:#e6db74">&#39;CREATE TABLE `testdir/test_table` (id Uint64, title Utf8, PRIMARY KEY (id));&#39;</span></span></span></code></pre></div><ul>
<li>é›†ç¾¤å¼€å¯äº†<code>TLS</code>æµé‡ä¿æŠ¤æˆ–ç”¨æˆ·è®¤è¯æ–¹å¼</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ydb -e grpcs://&lt;node.ydb.tech&gt;:2136 -d /Root/testdb --ca-file ydb-ca.crt --user root scripting yql --script <span style="color:#e6db74">&#39;CREATE TABLE `testdir/test_table` (id Uint64, title Utf8, PRIMARY KEY (id));&#39;</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_postgresql">Install_PostgreSQL</h1>

<h2 id="å®‰è£…postgresqlæ•°æ®åº“">å®‰è£…<code>PostgreSQL</code>æ•°æ®åº“</h2>
<ul>
<li>
<ol>
<li><a href="https://www.postgresql.org/ftp/source/" rel="external" target="_self"><code>PostgreSQL</code></a>ã€<a href="https://download.postgresql.org/pub/" rel="external" target="_self"><code>Download-PostgreSQL</code></a>ã€<a href="https://ftp.postgresql.org/pub/" rel="external" target="_self"><code>FTP-PostgreSQL</code></a></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install c++ gcc-c++ readline-devel zlib-devel
</span></span><span style="display:flex;"><span>$ curl -o /usr/local/src/postgresql-15.0.tar.gz  https://ftp.postgresql.org/pub/source/v15.0/postgresql-15.0.tar.gz
</span></span><span style="display:flex;"><span>$ tar -zxvf postgresql-15.0.tar.gz 
</span></span><span style="display:flex;"><span>$ cd postgresql-15.0
</span></span><span style="display:flex;"><span>$ view INSTALL</span></span></code></pre></div><ul>
<li>å®‰è£…</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./configure --prefix<span style="color:#f92672">=</span>/usr/local/postgresql
</span></span><span style="display:flex;"><span>$ make world
</span></span><span style="display:flex;"><span>$ make install-world
</span></span><span style="display:flex;"><span>$ adduser postgres  	<span style="color:#75715e"># åˆ›å»ºç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>$ mkdir -p /usr/local/postgresql/data
</span></span><span style="display:flex;"><span>$ chown -R postgres. /usr/local/postgresql/data
</span></span><span style="display:flex;"><span>$ su - postgres
</span></span><span style="display:flex;"><span>$ /usr/local/postgresql/bin/initdb -D /usr/local/postgresql/data
</span></span><span style="display:flex;"><span>$ /usr/local/postgresql/bin/pg_ctl -D /usr/local/postgresql/data -l logfile start</span></span></code></pre></div><ul>
<li>é…ç½®<code>Postgresql</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ vim /usr/local/postgresql/data/postgresql.conf
</span></span><span style="display:flex;"><span>listen_addresses <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;192.168.88.0/24&#39;</span>  	<span style="color:#75715e"># å¼€å¯è¿œç¨‹è®¿é—®  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vim /usr/local/postgresql/data/pg_hba.conf
</span></span><span style="display:flex;"><span><span style="color:#75715e"># IPv4 local connections:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿¡ä»»è¿œç¨‹è¿æ¥,ä¿®æ”¹å¦‚ä¸‹å†…å®¹ï¼Œä¿¡ä»»æŒ‡å®šæœåŠ¡å™¨è¿æ¥,identä¿®æ”¹ä¸ºMD5</span>
</span></span><span style="display:flex;"><span>host    all            all      127.0.0.1/32      md5
</span></span><span style="display:flex;"><span>host    all            all      10.1.8.0/24        md5</span></span></code></pre></div><ul>
<li>ä½¿ç”¨<code>PostgreSQL</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ su - postgres  	<span style="color:#75715e"># åˆ‡æ¢è¿›å»</span>
</span></span><span style="display:flex;"><span>$ psql  	<span style="color:#75715e"># è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#ae81ff">\l</span>  	<span style="color:#75715e"># åˆ—å‡ºæ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#ae81ff">\d</span>u  	<span style="color:#75715e"># åˆ—å‡ºç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#ae81ff">\c</span> mydb  	<span style="color:#75715e"># è¿›å…¥æ•°æ®åº“</span></span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_otter">Install_Otter</h1>

<h2 id="otteræ•°æ®æ¬è¿"><code>Otter</code>æ•°æ®æ¬è¿</h2>
<blockquote>
<ul>
<li><a href="https://github.com/alibaba/otter" rel="external" target="_self"><code>Otter</code></a></li>
</ul>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_mysql_pxc">Install_Mysql_PXC</h1>

<h2 id="å®‰è£…mysql-pxc">å®‰è£…<code>Mysql-PXC</code></h2>
<blockquote>
<ul>
<li><a href="https://blog.51cto.com/sumongodb/1956086" rel="external" target="_self">ä¼ä¸šä¸»æµ<code>MySQL</code>é«˜å¯ç”¨é›†ç¾¤æ¶æ„ä¸‰éƒ¨æ›²ä¹‹<code>PXC</code></a></li>
<li><a href="https://www.percona.com/doc/percona-xtradb-cluster/LATEST/install/docker.html" rel="external" target="_self">åœ¨<code>Docker</code>å®¹å™¨ä¸­è¿è¡Œ<code>Percona XtraDB</code>é›†ç¾¤</a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><code>docker</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>Mysql-PXC</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;install-mysql-pxc.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo yum -y remove docker \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-client \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-client-latest \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-common \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-latest 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-latest-logrotate 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-logrotate \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker-engine  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo yum install -y yum-utils
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo yum-config-manager --add-repo \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">https://download.docker.com/linux/centos/docker-ce.repo  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo yum install -y docker-ce docker-ce-cli containerd.io
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo systemctl start docker
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sudo systemctl enable docker
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mkdir -p /opt/data/{data-3306.data-3307,data-3308}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker network create pxc-network  	# åˆ›å»ºç½‘ç»œ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker run -i -d -p 3306:3306 -v /etc/localtime:/etc/localtime -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=cluster1 --name=node1 --privileged=true --net=pxc-network percona/percona-xtradb-cluster:5.7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 15
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker run -i -d -p 3307:3306 -v /etc/localtime:/etc/localtime -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=cluster1 -e CLUSTER_JOIN=node1 --name=node2 --privileged=true --net=pxc-network percona/percona-xtradb-cluster:5.7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker run -i -d -p 3308:3306 -v /etc/localtime:/etc/localtime -e MYSQL_ROOT_PASSWORD=root -e CLUSTER_NAME=cluster1 -e CLUSTER_JOIN=node1 --name=node3 --privileged=true --net=pxc-network percona/percona-xtradb-cluster:5.7  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">docker exec -it node1 /usr/bin/mysql -uroot -proot -e &#34;show status like &#39;wsrep%&#39;;&#34;  	# ç™»å½•æ•°æ®åº“æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€, ä¿®æ”¹å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># show status like &#39;wsrep%&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>Yum</code><!-- raw HTML omitted -->å®‰è£…<!-- raw HTML omitted --><code>PXC</code></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>
<p><!-- raw HTML omitted -->æœ€å°‘å‡†å¤‡ä¸‰å°æœåŠ¡å™¨ï¼Œåœ¨ä¸‰å°æœåŠ¡å™¨ä¸ŠåŒæ­¥æ‰§è¡Œå‘½ä»¤<!-- raw HTML omitted --></p>
</li>
<li>
<p><!-- raw HTML omitted -->å…ˆå¸è½½ç³»ç»Ÿè‡ªå¸¦æ•°æ®åº“ï¼Œé˜²ç«å¢™å¼€æ”¾åŒæ­¥ç«¯å£ï¼š<!-- raw HTML omitted -->4567<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;pxc-install.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum -y remove mariadb* 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum install -y https://repo.percona.com/yum/percona-release-latest.noarch.rpm  	# å®‰è£… PXC çš„ Yum æº
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yum install Percona-XtraDB-Cluster-57 -y  	# å®‰è£… PXC æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">systemctl enable mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">systemctl start mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pass=`grep &#34;temporary password&#34; /var/log/mysqld.log |awk &#39;{print $11}&#39;` 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=`openssl rand -base64 14`  	# ç”Ÿæˆéšå³å¯†ç   
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mysql -uroot -p$pass -e &#34;alter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;$password&#39;;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mysql -uroot -p$password -e &#34; flush privileges;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å…³é—­æ‰€æœ‰èŠ‚ç‚¹æ•°æ®åº“ã€å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl stop mysql</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->ä¿®æ”¹<!-- raw HTML omitted --><code>my.cnf</code><!-- raw HTML omitted -->é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/etc/my.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[mysqld]  	# å¿…é¡»å®šä¹‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">!includedir /etc/my.cnf.d/  	# åŸæœ‰ä¸åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">!includedir /etc/percona-xtradb-cluster.conf.d/  	# åŸæœ‰ä¸åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_provider=/usr/lib64/galera3/libgalera_smm.so  	# æä¾›ç¨‹åºçš„è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_cluster_name=pxc-cluster  	# å®šä¹‰çš„é›†ç¾¤åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_cluster_address=gcomm://192.168.2.11,192.168.2.12,192.168.2.13  # æ‰€æœ‰çš„é›†ç¾¤èŠ‚ç‚¹IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_node_name=pxc1  	# å®šä¹‰æœ¬æœºçš„åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_node_address=192.168.2.11  	# å®šä¹‰æœ¬æœºIP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_sst_method=xtrabackup-v2  	# åŒæ­¥æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wsrep_sst_auth=sstuser:password  	# æä¾›åŒæ­¥å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pxc_strict_mode=ENFORCING  	# ä¸¥æ ¼æ¨¡å¼(å¼ºåˆ¶æ‰§è¡Œ)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">binlog_format=ROW  	# è¡Œæ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_storage_engine=InnoDB  	# é»˜è®¤å­˜å‚¨å¼•æ“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">innodb_autoinc_lock_mode=2  	# è‡ªå¢é”å®šæ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->å…ˆå¯åŠ¨ä¸»èŠ‚ç‚¹ï¼Œç¡®ä¿ä¸»åº“æ•°æ®åŒæ­¥åˆ°å…¶ä»–ä»èŠ‚ç‚¹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>wsrep_cluster_size=1</code>è¡¨ç¤ºé›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ å·²ç»è¿æ¥å¹¶ä¸”çŠ¶æ€æ—¶<code>primary</code>éšæ—¶å†™å…¥æ•°æ®åˆ°é›†ç¾¤ï¼Œå†åŠ å…¥å…¶ä»–ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹å‰ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªSSTï¼ˆState Snapshot Transferï¼‰è´¦å·ç”¨äºé›†ç¾¤é—´é€šä¿¡ï¼Œå¿…é¡»å’Œä¸»æœº<code>my.cnf</code>é…ç½®çš„å‚æ•°ä¸€è‡´</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl restart mysql@bootstrap.service
</span></span><span style="display:flex;"><span>$ mysql -uroot -p$password -e <span style="color:#e6db74">&#34;show status like &#39;wsrep%&#39;;&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ·»åŠ ç”¨æˆ·å¹¶ä¸”èµ‹äºˆæƒé™ <!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysql -uroot -p$password -e <span style="color:#e6db74">&#34;CREATE USER &#39;sstuser&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;password&#39;;&#34;</span>  
</span></span><span style="display:flex;"><span>$ mysql -uroot -p$password -e <span style="color:#e6db74">&#34;GRANT RELOAD, LOCK TABLES, PROCESS, REPLICATION CLIENT ON *.* TO &#39;sstuser&#39;@&#39;localhost&#39;;&#34;</span>
</span></span><span style="display:flex;"><span>$ mysql -uroot -p$password -e <span style="color:#e6db74">&#34;FLUSH PRIVILEGES;&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åœ¨ä»èŠ‚ç‚¹ä¾æ¬¡å¯åŠ¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ systemctl start mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><code>PXC</code><!-- raw HTML omitted -->å¯¼å‡ºæ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqldump -uroot -p --skip_add_locks --skip-lock-tables  LY_report  &gt; /root/LY_report<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>.sql</span></span></code></pre></div><ul>
<li><a href="http://www.dboracle.com/archivers/%E5%BC%BA%E8%A1%8C%E5%85%B3%E6%9C%BA%E4%B9%8B%E5%90%8E%EF%BC%8Cpercona-xtradb-cluster%E9%9B%86%E7%BE%A4%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8.html" rel="external" target="_self">å¼ºè¡Œå…³æœºä¹‹åï¼Œ<code>PERCONA XTRADB CLUSTER</code>é›†ç¾¤æ— æ³•å¯åŠ¨</a></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>grastate.dat</code><!-- raw HTML omitted -->æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/var/lib/mysql/grastate.dat<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># GALERA saved state
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">version: 2.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">uuid:    8050b2ae-5de7-11ea-b72e-1b7d1643b17c
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">seqno:   975
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">safe_to_bootstrap: 0  	# æ­¤å€¼å¤§çš„å…ˆå¯åŠ¨ã€å¦‚æœéƒ½æ˜¯ 0ï¼Œæ‰¾ä¸ªä¿®æ”¹æˆ 1 å³å¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><ul>
<li>4.1.2 <!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /etc/percona-xtradb-cluster.conf.d/my.cnf  
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>client<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>socket<span style="color:#f92672">=</span>/var/lib/mysql/mysql.sock
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysql<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>prompt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\u@db2 \R:\m:\s [\d]&gt; &#34;</span>
</span></span><span style="display:flex;"><span>no-auto-rehash
</span></span><span style="display:flex;"><span>server-id<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># server-idæ¯ä¸ªæœåŠ¡å™¨å”¯ä¸€</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿™é‡Œå®šä¹‰æ•°æ®ç›®å½•å’Œæ—¥å¿—ç›®å½•</span>
</span></span><span style="display:flex;"><span>datadir<span style="color:#f92672">=</span>/var/lib/mysql
</span></span><span style="display:flex;"><span>socket<span style="color:#f92672">=</span>/var/lib/mysql/mysql.sock
</span></span><span style="display:flex;"><span>log-error<span style="color:#f92672">=</span>/var/log/mysqld.log
</span></span><span style="display:flex;"><span>pid-file<span style="color:#f92672">=</span>/var/run/mysqld/mysqld.pid
</span></span><span style="display:flex;"><span>log-bin <span style="color:#f92672">=</span> /var/lib/mysql/mybinlog
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>log_slave_updates
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bind-address <span style="color:#f92672">=</span> 0.0.0.0  	<span style="color:#75715e"># ç›‘å¬åœ°å€</span>
</span></span><span style="display:flex;"><span>port <span style="color:#f92672">=</span> <span style="color:#ae81ff">3306</span>  	<span style="color:#75715e"># ç›‘å¬ç«¯å£</span>
</span></span><span style="display:flex;"><span>default_storage_engine<span style="color:#f92672">=</span>InnoDB  	<span style="color:#75715e"># é»˜è®¤æ•°æ®åº“å¼•æ“</span>
</span></span><span style="display:flex;"><span>character-set-server <span style="color:#f92672">=</span> utf8mb4  	<span style="color:#75715e"># å­—ç¬¦é›†</span>
</span></span><span style="display:flex;"><span>collation-server <span style="color:#f92672">=</span> utf8mb4_general_ci  	<span style="color:#75715e"># æ’åºè§„åˆ™</span>
</span></span><span style="display:flex;"><span>max_connections <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>  	<span style="color:#75715e"># æœ€å¤§è¿æ¥æ•°</span>
</span></span><span style="display:flex;"><span>open_files_limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">65535</span>  	<span style="color:#75715e"># é™åˆ¶æ‰“å¼€æ–‡ä»¶æ•°</span>
</span></span><span style="display:flex;"><span>default-time-zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;+8:00&#39;</span>  	<span style="color:#75715e"># é»˜è®¤æ—¶åŒº</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®æ•°æ®åº“äº‹åŠ¡éš”ç¦»çº§åˆ«</span>
</span></span><span style="display:flex;"><span>transaction_isolation <span style="color:#f92672">=</span> REPEATABLE-READ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®è¶…æ—¶æ—¶é—´</span>
</span></span><span style="display:flex;"><span>interactive_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>wait_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>connect_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>lock_wait_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">3600</span>
</span></span><span style="display:flex;"><span>max_allowed_packet <span style="color:#f92672">=</span> 64M  	<span style="color:#75715e"># é™åˆ¶æ•°æ®åº“æœåŠ¡å™¨æ¥æ”¶æ•°æ®åŒ…çš„å¤§å°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®æ’åºå’Œjoinçš„bufferå¤§å°</span>
</span></span><span style="display:flex;"><span>sort_buffer_size <span style="color:#f92672">=</span> 4M
</span></span><span style="display:flex;"><span>join_buffer_size <span style="color:#f92672">=</span> 4M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®binlog</span>
</span></span><span style="display:flex;"><span>binlog_format<span style="color:#f92672">=</span>ROW
</span></span><span style="display:flex;"><span>expire_logs_days<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¼€å¯binlogæ ¡éªŒåŠŸèƒ½</span>
</span></span><span style="display:flex;"><span>binlog_checksum <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>binlog_cache_size <span style="color:#f92672">=</span> 4M
</span></span><span style="display:flex;"><span>sync_binlog <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>  	<span style="color:#75715e"># æ¯1æ¬¡æäº¤å˜æ›´åç«‹åˆ»å°†binlogè½ç›˜</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®performance_schema</span>
</span></span><span style="display:flex;"><span>performance_schema <span style="color:#f92672">=</span> on
</span></span><span style="display:flex;"><span>performance_schema_instrument <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%memory%=on&#39;</span>
</span></span><span style="display:flex;"><span>performance_schema_instrument <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%lock%=on&#39;</span>
</span></span><span style="display:flex;"><span>skip-external-locking <span style="color:#f92672">=</span> on
</span></span><span style="display:flex;"><span>skip-name-resolve <span style="color:#f92672">=</span> on  	<span style="color:#75715e"># ç¦ç”¨åŸŸåè§£æ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¦ç”¨è½¯é“¾æ¥</span>
</span></span><span style="display:flex;"><span>symbolic-links<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>back_log <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ…¢æ—¥å¿—æŸ¥è¯¢é…ç½®</span>
</span></span><span style="display:flex;"><span>slow_query_log <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>long_query_time <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>slow_query_log_file <span style="color:#f92672">=</span> /var/log/mysqld/slow.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®æ¯ä¸ªEVENTéƒ½è¦æ‰§è¡Œåˆ·ç›˜æ“ä½œ</span>
</span></span><span style="display:flex;"><span>sync_master_info <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>sync_relay_log_info <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>sync_relay_log <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>log_slave_updates <span style="color:#f92672">=</span> on
</span></span><span style="display:flex;"><span>relay_log_recovery <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>relay_log_purge <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>master_info_repository <span style="color:#f92672">=</span> TABLE
</span></span><span style="display:flex;"><span>relay_log_info_repository <span style="color:#f92672">=</span> TABLE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># InnoDBå¼•æ“é…ç½®</span>
</span></span><span style="display:flex;"><span>innodb_file_per_table <span style="color:#f92672">=</span> on
</span></span><span style="display:flex;"><span>innodb_checksums <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_checksum_algorithm <span style="color:#f92672">=</span> crc32
</span></span><span style="display:flex;"><span>innodb_status_file <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_status_output <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_status_output_locks <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_stats_on_metadata <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_open_files <span style="color:#f92672">=</span> <span style="color:#ae81ff">65535</span>
</span></span><span style="display:flex;"><span>innodb_flush_method <span style="color:#f92672">=</span> O_DIRECT
</span></span><span style="display:flex;"><span>innodb_flush_sync <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_flush_neighbors <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¯ä¸ªäº‹åŠ¡æäº¤åç«‹å³åˆ·æ–°binlogæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>innodb_flush_log_at_trx_commit <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_innodb&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_server&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_dml&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_ddl&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_trx&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_os&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_purge&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_log&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_lock&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_buffer&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_index&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_ibuf_system&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_buffer_page&#34;</span>
</span></span><span style="display:flex;"><span>innodb_monitor_enable<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module_adaptive_hash&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SQL modeé…ç½®ï¼Œè¿™é‡Œæ˜¯é»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>sql_mode <span style="color:#f92672">=</span> ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># GTIDé…ç½®</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#gtid_mode = on</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#enforce_gtid_consistency = 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># wsrepé…ç½®</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This changes how InnoDB autoincrement locks are managed and is a requirement for Galera</span>
</span></span><span style="display:flex;"><span>innodb_autoinc_lock_mode<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>wsrep_cluster_name<span style="color:#f92672">=</span>pxc-cluster  	<span style="color:#75715e"># Cluster nameé›†ç¾¤åç§°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>wsrep_cluster_address<span style="color:#f92672">=</span>gcomm://10.14.23.78:4567,10.14.23.180:4567,10.14.23.181:4567
</span></span><span style="display:flex;"><span>wsrep_provider<span style="color:#f92672">=</span>/usr/lib64/galera3/libgalera_smm.so
</span></span><span style="display:flex;"><span><span style="color:#75715e">#If wsrep_node_name is not specified,  then system hostname will be used</span>
</span></span><span style="display:flex;"><span>wsrep_node_name <span style="color:#f92672">=</span> db2
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Slave thread to use</span>
</span></span><span style="display:flex;"><span>wsrep_slave_threads<span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SST method</span>
</span></span><span style="display:flex;"><span>wsrep_sst_method<span style="color:#f92672">=</span>xtrabackup-v2
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Node IP address</span>
</span></span><span style="display:flex;"><span>wsrep_node_address <span style="color:#f92672">=</span> 10.14.23.180
</span></span><span style="display:flex;"><span>wsrep_sst_receive_address <span style="color:#f92672">=</span> 10.14.23.180
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Authentication for SST method</span>
</span></span><span style="display:flex;"><span>wsrep_sst_auth<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sstuser:sstuser_password&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pxc_strict_mode allowed values: DISABLED,PERMISSIVE,ENFORCING,MASTER</span>
</span></span><span style="display:flex;"><span>pxc_strict_mode<span style="color:#f92672">=</span>ENFORCING
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysqld_safe<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>pid-file <span style="color:#f92672">=</span> /var/run/mysqld/mysqld.pid
</span></span><span style="display:flex;"><span>socket   <span style="color:#f92672">=</span> /var/lib/mysql/mysql.sock
</span></span><span style="display:flex;"><span>nice     <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>EOF</span></span></code></pre></div></blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_mysql_router">Install_MySQL_Router</h1>

<h2 id="mysql-router"><code>MySQL Router</code></h2>
<blockquote>
<ul>
<li><code>MySQL Router</code>æ˜¯<code>MySQL</code>å®˜æ–¹æä¾›çš„è·¯ç”±å™¨å’Œè´Ÿè½½å‡è¡¡å™¨</li>
<li>æ”¯æŒåŸºäºè½®è¯¢æˆ–è‡ªåŠ¨æ£€æµ‹åˆ°çš„æœåŠ¡å™¨çŠ¶æ€çš„è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥å°†è¯»å†™è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„<code>MySQL</code>æœåŠ¡å™¨</li>
<li><code>MySQL Router</code>æä¾›äº†ç®€å•çš„é…ç½®å’Œç®¡ç†æ¥å£ï¼Œé€‚åˆ<code>MySQL</code>å®˜æ–¹äº§å“çš„ç¯å¢ƒ</li>
<li><a href="https://dev.mysql.com/doc/mysql-router/8.0/en/" rel="external" target="_self"><code>MySQL Router</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_maxscale">Install_MaxScale</h1>

<h2 id="maxscaleè½»é‡çº§æ•°æ®åº“ä»£ç†"><code>MaxScaleè½»é‡çº§</code>æ•°æ®åº“ä»£ç†</h2>
<blockquote>
<ul>
<li><code>MaxScale</code>æ˜¯<code>MariaDB</code>å¼€å‘çš„ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®åº“ä»£ç†å’Œè·¯ç”±å™¨</li>
<li>æ”¯æŒé«˜çº§çš„æŸ¥è¯¢è·¯ç”±å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼ŒåŒ…æ‹¬è¯»å†™åˆ†ç¦»ã€æ•…éšœåˆ‡æ¢å’Œé«˜å¯ç”¨æ€§</li>
<li><code>MaxScale</code>æä¾›äº†ä¸°å¯Œçš„æ’ä»¶å’Œæ¨¡å—åŒ–æ¶æ„ï¼Œå¯ä»¥è½»æ¾æ‰©å±•å…¶åŠŸèƒ½</li>
<li><a href="https://mariadb.com/kb/en/maxscale/" rel="external" target="_self"><code>MaxScale</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_proxysql">Install_ProxySQL</h1>

<h2 id="proxysqlä»£ç†"><code>ProxySQL</code>ä»£ç†</h2>
<blockquote>
<ul>
<li><code>ProxySQL</code>æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„<code>MySQL</code>ä»£ç†ï¼Œæ”¯æŒæ•°æ®åº“è¿æ¥æ± ã€æŸ¥è¯¢ç¼“å­˜ã€è´Ÿè½½å‡è¡¡å’Œè¯»å†™åˆ†ç¦»</li>
<li>å®ƒå¯ä»¥æ ¹æ®<code>SQL</code>æŸ¥è¯¢ç±»å‹ï¼ˆè¯»æˆ–å†™ï¼‰å°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„<code>MySQL</code>æœåŠ¡å™¨</li>
<li><code>ProxySQL</code>æä¾›äº†ä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è°ƒæ•´è´Ÿè½½å‡è¡¡ç­–ç•¥å’Œè¿æ¥æ± ç®¡ç†</li>
<li><a href="https://proxysql.com/" rel="external" target="_self"><code>ProxySQL</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_manticore_search">Install_Manticore_Search</h1>

<h2 id="manticoresearch"><code>manticoresearch</code></h2>
<blockquote>
<ul>
<li>æ˜“äºä½¿ç”¨çš„å¼€æºå¿«é€Ÿæœç´¢æ•°æ®åº“.</li>
<li><a href="https://manticoresearch.com/" rel="external" target="_self"><code>Manticore Search</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_canal">Install_Canal</h1>

<h2 id="canalæ•°æ®åº“å¢é‡æ—¥å¿—è§£æ"><code>Canal</code>æ•°æ®åº“å¢é‡æ—¥å¿—è§£æ</h2>
<blockquote>
<ul>
<li><a href="https://github.com/alibaba/canal" rel="external" target="_self"><code>Canal</code></a></li>
</ul>
</blockquote>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="use_mysql">Use_Mysql</h1>

<h1 id="æ•°æ®åº“ä½¿ç”¨">æ•°æ®åº“ä½¿ç”¨</h1>
<h2 id="æ•°æ®ç»“æ„å¯è§†åŒ–">æ•°æ®ç»“æ„å¯è§†åŒ–</h2>
<blockquote>
<ul>
<li><a href="https://www.cs.usfca.edu/~galles/visualization/" rel="external" target="_self">æ•°æ®ç»“æ„å¯è§†åŒ–</a></li>
</ul>
</blockquote>
<hr>
<h2 id="æ•°æ®åº“è¿æ¥å·¥å…·">æ•°æ®åº“è¿æ¥å·¥å…·</h2>
<blockquote>
<table>
<thead>
<tr>
<th>åç§°åœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://downloads.mysql.com/archives/workbench/" rel="external" target="_self"><code>WorkBenCh</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://downloads.mysql.com/archives/community/" rel="external" target="_self"><code>MySQL</code>äº§å“æ¡£æ¡ˆ</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://mirrors.cloud.tencent.com/mysql/downloads/MySQL-8.0/" rel="external" target="_self">ä¸‹è½½<code>MySQL-8.0</code>çš„ç´¢å¼•</a></td>
<td></td>
</tr>
<tr>
<td><a href="http://www.notedeep.com/page/282" rel="external" target="_self"><code>Mysql</code>æ·±å…¥å­¦ä¹ ç¬”è®°</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://sqlyog.softonic.cn/" rel="external" target="_self"><code>SQLyog</code>æ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…·</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://dbeaver.io/download/" rel="external" target="_self"><code>DBeaver</code>æ•°æ®åº“å®¢æˆ·ç«¯è¿æ¥å·¥å…·</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/pifeifei/mysql-workbench-zh-cn" rel="external" target="_self"><code>Mysql WorkBenCh</code>èœå•ä¸­æ–‡æ±‰åŒ–</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.jianshu.com/p/4113cd5ef139" rel="external" target="_self"><code>Navicat Premium 15</code>å®‰è£…ä¸æ¿€æ´»</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://learnku.com/articles/67706" rel="external" target="_self"><code>Navicat Premium 16</code>ä¸‹è½½ä¸å®‰è£…ç ´è§£æ•™ç¨‹</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://dev.mysql.com/doc/refman/8.0/en/binary-installation.html" rel="external" target="_self">ä½¿ç”¨é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶åœ¨<code>Unix/Linux </code>å®‰è£…<code>MySQL</code></a></td>
<td></td>
</tr>
<tr>
<td><a href="https://www.jianshu.com/p/523c132006aa" rel="external" target="_self"><code>Navicat Premium 15</code>æ°¸ä¹…ç ´è§£æ¿€æ´»å·¥å…·åŠå®‰è£…æ•™ç¨‹</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="æ•°æ®åº“å¸¸ç”¨å‘½ä»¤">æ•°æ®åº“å¸¸ç”¨å‘½ä»¤</h2>
<blockquote>
<table>
<thead>
<tr>
<th>æ•°æ®åº“å‘½ä»¤</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>select</code></td>
<td>ä»æ•°æ®åº“ä¸­æå–æ•°æ®</td>
<td>æŸ¥çœ‹ç”¨æˆ·æ•°æ®ï¼š<code>select user,host from mysql.user \G;</code></td>
</tr>
<tr>
<td><code>update</code></td>
<td>æ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®</td>
<td></td>
</tr>
<tr>
<td><code>delete</code></td>
<td>ä»æ•°æ®åº“ä¸­åˆ é™¤æ•°æ®</td>
<td></td>
</tr>
<tr>
<td><code>insert into</code></td>
<td>å‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ®</td>
<td>æ’å…¥æ•°æ®ï¼š<code>insert into tiantian.tt1 values(1,'lisi');</code></td>
</tr>
<tr>
<td><code>create database</code></td>
<td>åˆ›å»ºæ–°æ•°æ®åº“</td>
<td>åˆ›å»ºæ•°æ®åº“ï¼š<code>create database tiantian;</code></td>
</tr>
<tr>
<td><code>alter database</code></td>
<td>æ›´æ”¹æ•°æ®åº“</td>
<td></td>
</tr>
<tr>
<td><code>create table</code></td>
<td>åˆ›å»ºè¡¨</td>
<td>åˆ›å»ºæ•°æ®è¡¨ï¼š<code>create table tiantian.tt1(id int, name varchar(50));</code></td>
</tr>
<tr>
<td><code>alter table</code></td>
<td>æ›´æ”¹è¡¨</td>
<td></td>
</tr>
<tr>
<td><code>drop table</code></td>
<td>åˆ é™¤è¡¨</td>
<td></td>
</tr>
<tr>
<td><code>create index</code></td>
<td>åˆ›å»ºç´¢å¼•(æœç´¢é”®)</td>
<td></td>
</tr>
<tr>
<td><code>drop index</code></td>
<td>åˆ é™¤ç´¢å¼•</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>Where</code>è¯­å¥ä¸­çš„è¿ç®—ç¬¦</th>
<th>è¯´æ˜</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>=</code></td>
<td>ç­‰äº</td>
<td></td>
</tr>
<tr>
<td><code>&lt;&gt;</code></td>
<td>ä¸ç­‰äºï¼šåœ¨<code>SQL</code>çš„ä¸€äº›ç‰ˆæœ¬ä¸­ï¼Œæ”¹æ“ä½œç¬¦è¢«å†™æˆ<code>!=</code></td>
<td></td>
</tr>
<tr>
<td><code>&gt;</code></td>
<td>å¤§äº</td>
<td></td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td>å°äº</td>
<td></td>
</tr>
<tr>
<td><code>&gt;=</code></td>
<td>å¤§äºç­‰äº</td>
<td></td>
</tr>
<tr>
<td><code>&lt;=</code></td>
<td>å°äºç­‰äº</td>
<td></td>
</tr>
<tr>
<td><code>BETWEEN</code></td>
<td>åœ¨æŸä¸ªèŒƒå›´å†…</td>
<td></td>
</tr>
<tr>
<td><code>LIKE</code></td>
<td>æœç´¢æŸç§æ¨¡å¼</td>
<td></td>
</tr>
<tr>
<td><code>IN</code></td>
<td>æŒ‡å®šé’ˆå¯¹æŸä¸ªåˆ—çš„å¤šä¸ªå¯èƒ½å€¼</td>
<td></td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h3 id="æŸ¥è¯¢æ•°æ®åº“è¿æ¥æ•°">æŸ¥è¯¢æ•°æ®åº“è¿æ¥æ•°</h3>
<blockquote>
<ul>
<li>
<!-- raw HTML omitted -->
</li>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å½“å‰æ´»åŠ¨çº¿ç¨‹çŠ¶æ€<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>Threads_cached</code><!-- raw HTML omitted -->ç¼“å­˜çš„çº¿ç¨‹æ•°é‡ï¼Œè¿™äº›çº¿ç¨‹å¤„äºç¡çœ çŠ¶æ€ä»¥å¤‡å¤ç”¨<!-- raw HTML omitted --></li>
<li><code>Threads_connected</code><!-- raw HTML omitted -->å½“å‰æ‰“å¼€çš„è¿æ¥æ•°<!-- raw HTML omitted --></li>
<li><code>Threads_created</code><!-- raw HTML omitted -->ä¸ºå¤„ç†è¿æ¥è€Œåˆ›å»ºçš„çº¿ç¨‹æ•°<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> status <span style="color:#66d9ef">like</span>  <span style="color:#e6db74">&#39;Threads%&#39;</span>; </span></span></code></pre></div><ul>
<li>å¦‚æœ<code>Threads_created</code>å¾ˆå¤§ï¼Œæ‚¨å¯èƒ½éœ€è¦å¢åŠ <code>thread_cache_size</code>çš„å€¼ã€‚ç¼“å­˜å¤±è¯¯ç‡å¯ä»¥é€šè¿‡<code>Threads_created/Connections</code>è®¡ç®—</li>
</ul>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->æ˜¾ç¤ºç”¨æˆ·æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> full processlist;</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹æœ€å¤§é“¾æ¥æ•°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%max_connections%&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸´æ—¶å¢åŠ è¿æ¥æ•°ï¼Œé…ç½®æ–‡ä»¶å¢åŠ å‚æ•°ï¼šmax_connections=4000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> GLOBAL max_connections<span style="color:#f92672">=</span><span style="color:#ae81ff">4000</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹è¿æ¥çš„ç”¨æˆ·å’Œ<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->ä»¥åŠè¶…æ—¶æ—¶é—´<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹è¿æ¥çš„ç”¨æˆ·å’ŒIPä»¥åŠè¶…æ—¶æ—¶é—´ï¼Œæˆ–è€…ä½¿ç”¨ï¼šcount(*) ç»Ÿè®¡æ€»ç»Ÿè¿æ¥æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> information_schema.processlist;</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->çœ‹è¿æ¥çš„ç”¨æˆ·å’Œæ¯ä¸ª<!-- raw HTML omitted --><code>IP</code><!-- raw HTML omitted -->çš„è¿æ¥æ€»æ•°åœ°å€<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">substring_index</span>(host, <span style="color:#e6db74">&#39;:&#39;</span>,<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">AS</span> host_ip,<span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>,db,state,<span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">FROM</span> information_schema.processlist <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> state,host_ip,<span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>,db;</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ul>
</blockquote>
<hr>
<h3 id="æŸ¥è¯¢æ•°æ®åº“æ…¢è¯­å¥">æŸ¥è¯¢æ•°æ®åº“æ…¢è¯­å¥</h3>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢å ç”¨è¶…æ—¶æ…¢è¯­å¥
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> information_schema.processlist <span style="color:#66d9ef">where</span> Command <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;Sleep&#39;</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">Time</span> <span style="color:#66d9ef">desc</span> <span style="color:#960050;background-color:#1e0010">\</span>G;</span></span></code></pre></div></blockquote>
<hr>
<h3 id="ä¸‰ç§ä¿®æ”¹æ•°æ®åº“å¯†ç ">ä¸‰ç§ä¿®æ”¹æ•°æ®åº“å¯†ç </h3>
<blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ç¬¬ä¸€ç§ä¿®æ”¹æ–¹å¼ï¼Œ<code>8.0</code>ç”¨æ­¤æ–¹æ³•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123&#39;</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">with</span> mysql_native_password <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;newpassword&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->ç¬¬äºŒç§ä¿®æ”¹æ–¹å¼<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> password <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span><span style="color:#f92672">=</span><span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#39;newpassword&#39;</span>);</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç¬¬ä¸‰ç§ä¿®æ”¹æ–¹å¼<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> mysql.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">set</span> authentication_string<span style="color:#f92672">=</span><span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#39;123qwe&#39;</span>) <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;root&#39;</span> <span style="color:#66d9ef">and</span> Host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;localhost&#39;</span>; </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->æ›´æ”¹å¯†ç ä¸º<!-- raw HTML omitted --><code>123456</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> destoon_member <span style="color:#66d9ef">set</span> password<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">â€™</span><span style="color:#ae81ff">14</span>e1b600b1fd579f47433b88e8d85291<span style="color:#960050;background-color:#1e0010">â€²</span> <span style="color:#66d9ef">where</span>
</span></span><span style="display:flex;"><span>username<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">â€™</span>admin<span style="color:#960050;background-color:#1e0010">â€™</span>;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->å¿˜è®°æ•°æ®åº“å¯†ç <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> cat <span style="color:#f92672">&gt;/</span>etc<span style="color:#f92672">/</span>my.cnf<span style="color:#f92672">&lt;&lt;-</span>EOF
</span></span><span style="display:flex;"><span>[mysqld]  	<span style="color:#75715e"># åœ¨é…ç½®æ–‡ä»¶ä¸­æœ€ä¸Šé¢æ·»åŠ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>skip<span style="color:#f92672">-</span><span style="color:#66d9ef">grant</span><span style="color:#f92672">-</span><span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span>EOF
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡å¯mysqlæœåŠ¡  ç›´æ¥ä½¿ç”¨ mysql -uroot -p ä¸è¾“å…¥å¯†ç ç›´æ¥å›è½¦è¿›å…¥ ä¿®æ”¹å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">set</span> authentication_string<span style="color:#f92672">=</span><span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#39;root&#39;</span>);</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="æ•°æ®åº“å¤‡ä»½è¿˜åŸ">æ•°æ®åº“å¤‡ä»½ã€è¿˜åŸ</h3>
<h4 id="æ•°æ®åº“å¤‡ä»½">æ•°æ®åº“å¤‡ä»½</h4>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>mysqldump</code><!-- raw HTML omitted -->å¤‡ä»½æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>æ‰‹åŠ¨å¤‡ä»½</li>
</ul>
<blockquote>
<ul>
<li><code>--set-gtid-purged=OFF</code><!-- raw HTML omitted -->ï¼šå¦‚æœæºåº“å¼€å¯äº†<!-- raw HTML omitted --><code>GTID</code><!-- raw HTML omitted -->ç‰¹æ€§ï¼Œä½¿ç”¨<!-- raw HTML omitted --><code>mysqldump</code><!-- raw HTML omitted -->å¯¼å‡ºæ•°æ®æ—¶ï¼Œå­˜åœ¨éœ€è¦<!-- raw HTML omitted --><code>super</code><!-- raw HTML omitted -->æƒé™æ‰§è¡Œçš„è¯­å¥ï¼š<!-- raw HTML omitted --><code>SET @@SESSION.SQL_LOG_BIN= 0;</code>ï¼Œ<code>SET @@GLOBAL.GTID_PURGED=Â´18f9a804-343b-11e5-a21d-b083fed01601:1-2;</code></li>
<li><code>--all-databases --triggers --routines --events</code></li>
<li><code>--column-statistics=0</code><!-- raw HTML omitted -->ï¼šé€šè¿‡æ­¤å‚æ•°ç¦ç”¨å®ƒï¼Œç”±äº<!-- raw HTML omitted --><code>MySQL8</code><!-- raw HTML omitted -->ä¸­é»˜è®¤å¯ç”¨çš„æ–°æ ‡å¿—æ‰€è‡´<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->å¤‡ä»½ç”¨æˆ·æƒé™<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">SELECT</span>,RELOAD,<span style="color:#66d9ef">LOCK</span> <span style="color:#66d9ef">TABLES</span>,REPLICATION CLIENT,<span style="color:#66d9ef">SHOW</span> VIEW,EVENT,<span style="color:#66d9ef">TRIGGER</span>,PROCESS <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;backup&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;passwoord&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¤‡ä»½å¤šä¸ªæ•°æ®åº“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /bin/mysql -u root -p<span style="color:#e6db74">&#39;password&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /opt/data/data_3303/mysql.sock  -e <span style="color:#e6db74">&#39;show databases;&#39;</span>| <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>grep -E -v <span style="color:#e6db74">&#34;sys|mysql|information_schema|performance_schema|Database&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>|grep -E <span style="color:#e6db74">&#34;.*datebases1</span>$<span style="color:#e6db74">|.*datebases2</span>$<span style="color:#e6db74">&#34;</span> | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>xargs /bin/mysqldump -u root -p<span style="color:#e6db74">&#39;password&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /opt/data/data_3306/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--single-transaction --no-autocommit <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> --skip-lock-tables --databases &gt;<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>-datebases_name.sql</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯¼å‡ºå…¨éƒ¨åº“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqldump -uroot -p --all-databases &gt; /tmp/all_databases.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysqldump -u root -p<span style="color:#e6db74">&#39;passowrd&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /opt/data/data_3306/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--all-databases --lock-tables<span style="color:#f92672">=</span>false <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--routines --single_transaction --flush-logs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--skip-lock-tables --master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>| gzip &gt;/tmp/mysql-all-<span style="color:#e6db74">`</span>date +%F_%H%M%S<span style="color:#e6db74">`</span>.sql.gz </span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯¼å‡ºå•ä¸ªåº“<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqldump -uroot -p --databases databases_name &gt; /tmp/databases_name.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /bin/mysqldump -uroot -p<span style="color:#e6db74">&#39;passowrd&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--set-gtid-purged<span style="color:#f92672">=</span>OFF --single-transaction <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> --flush-logs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /opt/data/data_3306/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>database | gzip &gt;/tmp/database<span style="color:#e6db74">`</span>date +%F_%H%M%S<span style="color:#e6db74">`</span>.sql.gz</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯¼å‡ºæŒ‡å®šè¡¨<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqldump -uroot -p --databases databases_name tables_name &gt; /tmp/databases_name_tables_name.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ bin/mysql -u root -p<span style="color:#e6db74">&#39;password&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /opt/data/data_3306/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e <span style="color:#e6db74">&#39;select table_name from information_schema.tables where table_schema like &#34;game\-center\_ali&#34;;&#39;</span>|egrep <span style="color:#e6db74">&#34;.*record&#34;</span> | xargs /bin/mysqldump -u root -p<span style="color:#e6db74">&#39;password&#39;</span> -S /opt/data/data_16303/mysql.sock  databases_name -t --tables &gt;/tmp/tables_name.sql</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->å¯¼å‡ºè¡¨ç»“æ„åŠ <!-- raw HTML omitted --><code>-d</code><!-- raw HTML omitted -->å‚æ•°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /bin/mysqldump -d -uroot -p<span style="color:#e6db74">&#39;passowrd&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /opt/data/data_3306/mysql.sock database_name &gt; database_name.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /bin/mysqldump -d -uroot -p<span style="color:#e6db74">&#39;passowrd&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-S /opt/data/data_3306/mysql.sock --databases database_name &gt; database_name.sql</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Mysql</code><!-- raw HTML omitted -->è„šæœ¬å¤‡ä»½å¹¶é€šçŸ¥<!-- raw HTML omitted --><code>Telegram</code></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/script/Backup_Mysql.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATA=$(date +%F_%H%M%S)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## set ff=unix # ä¿®æ”¹æ¢è¡Œç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®šä¹‰å¤‡ä»½ç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MYSQL_BACKUP_PATH=/opt/backup/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®šä¹‰Telegram æœºå™¨äººIDå’ŒæŠ¥è­¦ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_BOT_ID=&#39;Telegram BOT_ID:BOT_Key&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_GROUP_ID=&#39;GROUP_ID&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®šä¹‰è¿æ¥æ•°æ®åº“ è´¦æˆ·å¯†ç IP
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_NAME=&#39;backup&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_PASSWORD=&#39;pass&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATABASES=&#39;databases name&#39;  	# å¤‡ä»½è¡¨ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_HOST_1=&#39;IP_1&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_HOST_2=&#39;IP_2&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## è¿‡æ»¤æ•°æ®åº“, xargså’Œsed &#39;1d&#39;æ•ˆæœä¸€æ ·
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATABASES_1=`/bin/mysql -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h&#34;${USER_HOST_1}&#34; -e &#39;show databases;&#39; | grep -E -v &#34;sys|mysql|information_schema|performance_schema|Database&#34; | /bin/xargs`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## DATABASES_2=`/bin/mysql -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h&#34;${USER_HOST_2}&#34; -e &#39;show databases;&#39; | grep -E -v &#34;sys|mysql|information_schema|performance_schema|Database&#34; | sed &#39;1d&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## æ£€æµ‹å¤‡ä»½ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»º
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## /bin/test -d /opt/backup
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">function TEST_BACKUP_DIR() {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -d ${MYSQL_BACKUP_PATH} ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/bin/mkdir -p ${MYSQL_BACKUP_PATH}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å§‹å‡†å¤‡å¤‡ä»½æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd ${MYSQL_BACKUP_PATH}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=å¼€å§‹å¤‡ä»½ï¼š${DATABASES_1} ${DATABASES_2} æ•°æ®åº“&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for i in ${DATABASES_1};do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/usr/local/mysql/bin/mysqldump -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h${USER_HOST_1} --single-transaction --no-autocommit --master-data=1 --skip-lock-tables ${i} &gt; ${MYSQL_BACKUP_PATH}${i}-`date +%F`.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ $? -eq 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> /bin/tar -zcvf ${MYSQL_BACKUP_PATH}${i}-`date +%F`.tar.gz ${i}-`date +%F`.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${DATABASES_1} ${DATABASES_2} æ•°æ®åº“å¤‡ä»½å®Œæˆ&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${DATABASES_1} ${DATABASES_2} æ•°æ®åº“å¤‡ä»½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/bin/rm -rf ${MYSQL_BACKUP_PATH}*.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¤‡ä»½æ•°æ®è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">function BACKUP_MYSQL_TABLES() {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	cd ${MYSQL_BACKUP_PATH}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	for DATABASES in ${DATABASES_1};do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	TABLES_1=$(/bin/mysql -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h&#34;${USER_HOST_1}&#34; ${DATABASES} -e &#34;show tables;&#34;|sed &#39;1d&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		for I in ${TABLES_1};do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">			/usr/local/mysql/bin/mysqldump -u${USER_NAME} -p&#34;${USER_PASSWORD}&#34; -h${USER_HOST_1} --single-transaction --no-autocommit --master-data=1 --skip-lock-tables ${I} &gt; ${MYSQL_BACKUP_PATH}${i}-`date +%F`.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		/bin/tar -zcvf ${MYSQL_BACKUP_PATH}${DATABASES}-`date +%F`.tar.gz *.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		/bin/rm -rf ${MYSQL_BACKUP_PATH}*.sql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	done	
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	if [ $? -eq 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${DATABASES_1} ${DATABASES_2} æ•°æ®åº“å¤‡ä»½å®Œæˆ&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		/bin/curl -X POST &#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage&#34; -d &#34;chat_id=${TELEGRAM_GROUP_ID}&amp;text=${DATABASES_1} ${DATABASES_2} æ•°æ®åº“å¤‡ä»½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/bin/find ${MYSQL_BACKUP_PATH} -name &#34;databases-*&#34; -mtime +15 -exec  rm  {} \;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="æ•°æ®åº“è¿˜åŸ">æ•°æ®åº“è¿˜åŸ</h4>
<blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æ•°æ®åº“è¿˜åŸã€å¯¼å…¥<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬ä¸€ç§æ–¹å¼</span>
</span></span><span style="display:flex;"><span>$ /bin/mysql -u root -p<span style="color:#e6db74">&#39;passowrd&#39;</span> -S /opt/data/data_16303/mysql.sock &lt; /root/all.sql  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¬¬äºŒç§æ–¹å¼  </span>
</span></span><span style="display:flex;"><span>mysql&gt; use mysql;
</span></span><span style="display:flex;"><span>mysql&gt; source /root/databases.sql  	<span style="color:#75715e"># å½“å‰ç›®å½•ç»å¯¹è·¯å¾„</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><code>.qp</code><!-- raw HTML omitted -->æ–‡ä»¶æ•°æ®åº“æ¢å¤<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ xbstream -x -p <span style="color:#ae81ff">4</span> &lt; ./databases.qp -C /opt/mysql/backup</span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h4 id="ä½¿ç”¨perconaå¤‡ä»½å·¥å…·">ä½¿ç”¨<code>percona</code>å¤‡ä»½å·¥å…·</h4>
<blockquote>
<ul>
<li><a href="https://segmentfault.com/a/1190000019305858" rel="external" target="_self"><code>Linux</code>è¿ç»´ <code>mysql</code>æ•°æ®åº“çš„å¤‡ä»½ä¸æ¢å¤</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1119183" rel="external" target="_self"><code>innobackupex</code>å¤‡ä»½æ¢å¤<code>+</code>å¢é‡å¤‡ä»½ä¸æ¢å¤</a></li>
<li><code>innobackupex</code>ï¼šæ›´å¤šé«˜çº§ç®¡ç†åŠŸèƒ½å’Œè‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬</li>
<li><code>xtrabackup</code>ï¼šéœ€è¦åŸºæœ¬çš„ç‰©ç†å¤‡ä»½å’Œæ¢å¤åŠŸèƒ½ï¼Œå¹¶ä¸”æ„¿æ„æ‰‹åŠ¨ç®¡ç†å¤‡ä»½æµç¨‹</li>
<li>å®‰è£…<a href="https://www.percona.com/software/mysql-database/percona-xtrabackup" rel="external" target="_self"><code>XtraBackup</code></a></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ yumæº</span>
</span></span><span style="display:flex;"><span>$ wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6.repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…ä¾èµ–åŒ…</span>
</span></span><span style="display:flex;"><span>$ yum -y install perl perl-devel libaio libaio-devel perl-Time-HiRes perl-DBD-MySQL
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸‹è½½rpmåŒ…</span>
</span></span><span style="display:flex;"><span>$ wget https://downloads.percona.com/downloads/Percona-XtraBackup-2.4/Percona-XtraBackup-2.4.27/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.27-1.el7.x86_64.rpm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ yum -y install percona-xtrabackup-24-2.4.27-1.el7.x86_64.rpm</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‰‹åŠ¨å¤‡ä»½<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->å®Œæ•´ä»¥åŠå¢é‡å¤‡ä»½<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å®Œæ•´å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>$ innobackupex --host<span style="color:#f92672">=</span>IP --user<span style="color:#f92672">=</span>name --password<span style="color:#f92672">=</span><span style="color:#ae81ff">123456</span> --prot<span style="color:#f92672">=</span><span style="color:#ae81ff">3306</span> --no-timestamp /opt/backup/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¢é‡å¤‡ä»½  åŸºäºå…¨é‡å¤‡ä»½å®ç°å¢é‡å¤‡ä»½ï¼Œå¢é‡å¤‡ä»½åªæ”¯æŒInnodb</span>
</span></span><span style="display:flex;"><span>$ innobackupex --host<span style="color:#f92672">=</span>IP --user<span style="color:#f92672">=</span>root --password<span style="color:#f92672">=</span><span style="color:#ae81ff">123456</span> --prot<span style="color:#f92672">=</span><span style="color:#ae81ff">3306</span> --no-timestamp --incremental /opt/backup/ --incremental-basedir<span style="color:#f92672">=</span>/opt/backup/<span style="color:#66d9ef">$(</span>date +%F_%T<span style="color:#66d9ef">)</span></span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ•°æ®åº“æ¢å¤æµç¨‹<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li><code>--decompress</code><!-- raw HTML omitted -->è¯¥é€‰é¡¹è¡¨ç¤ºè§£å‹<!-- raw HTML omitted --><code>--compress</code><!-- raw HTML omitted -->é€‰é¡¹å‹ç¼©æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>--parallel</code><!-- raw HTML omitted -->è¯¥é€‰é¡¹è¡¨ç¤ºå…è®¸å¤šä¸ªæ–‡ä»¶åŒæ—¶è§£å‹ã€‚ä¸ºäº†è§£å‹ï¼Œ<!-- raw HTML omitted --><code>qpress</code><!-- raw HTML omitted -->å·¥å…·å¿…é¡»æœ‰å®‰è£…å¹¶ä¸”è®¿é—®è¿™ä¸ªæ–‡ä»¶çš„æƒé™ã€‚è¿™ä¸ªè¿›ç¨‹å°†åœ¨åŒä¸€ä¸ªä½ç½®ç§»é™¤åŸæ¥çš„å‹ç¼©/åŠ å¯†æ–‡ä»¶<!-- raw HTML omitted --></li>
<li><code>--apply-log</code><!-- raw HTML omitted -->è¯¥é€‰é¡¹è¡¨ç¤ºåŒ<!-- raw HTML omitted --><code>xtrabackup</code><!-- raw HTML omitted -->çš„<!-- raw HTML omitted --><code>--prepare</code><!-- raw HTML omitted -->å‚æ•°,ä¸€èˆ¬æƒ…å†µä¸‹,åœ¨å¤‡ä»½å®Œæˆåï¼Œæ•°æ®å°šä¸”ä¸èƒ½ç”¨äºæ¢å¤æ“ä½œï¼Œå› ä¸ºå¤‡ä»½çš„æ•°æ®ä¸­å¯èƒ½ä¼šåŒ…å«å°šæœªæäº¤çš„äº‹åŠ¡æˆ–å·²ç»æäº¤ä½†å°šæœªåŒæ­¥è‡³æ•°æ®æ–‡ä»¶ä¸­çš„äº‹åŠ¡ã€‚å› æ­¤ï¼Œæ­¤æ—¶æ•°æ® æ–‡ä»¶ä»å¤„ç†ä¸ä¸€è‡´çŠ¶æ€<!-- raw HTML omitted --></li>
<li><code>--apply-log</code><!-- raw HTML omitted -->çš„ä½œç”¨æ˜¯é€šè¿‡å›æ»šæœªæäº¤çš„äº‹åŠ¡åŠåŒæ­¥å·²ç»æäº¤çš„äº‹åŠ¡è‡³æ•°æ®æ–‡ä»¶ä½¿æ•°æ®æ–‡ä»¶å¤„äºä¸€è‡´æ€§çŠ¶æ€<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 1.æ‹·è´å¤‡ä»½åˆ°data3306(åªæ‹·è´æ—¥æœŸæ–‡ä»¶å¤¹ä¸‹é¢çš„æ–‡ä»¶)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2.cd /opt/data3306</span>
</span></span><span style="display:flex;"><span>$ innobackupex --defaults-file<span style="color:#f92672">=</span>/opt/conf/my_3306.cnf --decompress --parallel<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span> ./
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3.åˆ é™¤æ‰€æœ‰.qpæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4.æ¢å¤æ•°æ®åº“(å…¨é‡)</span>
</span></span><span style="display:flex;"><span>$ cd /opt/data3306
</span></span><span style="display:flex;"><span>$ innobackupex --defaults-file<span style="color:#f92672">=</span>/opt/conf/my_3306.cnf --apply-log  --use-memory<span style="color:#f92672">=</span>4G ./</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æ‰‹åŠ¨æ¢å¤<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ service mysql stop
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆå§‹åŒ–å…¨é‡å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ innobackupex --apply-log --redo-only /opt/backup/ --incremental-dir<span style="color:#f92672">=</span>/opt/backup/<span style="color:#66d9ef">$(</span>date +%F_%T<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆå§‹åŒ–æ•´åˆå¢é‡å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>$ innobackupex --apply-log --redo-only /data/backup/2017-08-24_22-57-43 --incremental-dir<span style="color:#f92672">=</span>/data/backup/2017-08-24_23-10-21
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠæ•´åˆå¥½çš„å¢é‡å†æ¬¡åˆå§‹åŒ–</span>
</span></span><span style="display:flex;"><span>$ innobackupex --apply-log  /data/backup/2017-08-24_22-57-43
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¤‡ä»½MySQLä¸‹dataæ•°æ®ç›®å½•è¦æ¢å¤çš„æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ mv  /usr/local/mysql/data/ceshi/  /opt/backup/<span style="color:#66d9ef">$(</span>date +%F_%T<span style="color:#66d9ef">)</span>/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠæ•´åˆåçš„å…¨é‡å¤‡ä»½ç›®å½•ä¸‹è¦æ¢å¤çš„æ•°æ®åº“å¤åˆ¶åˆ°MySQLä¸‹dataç›®å½•</span>
</span></span><span style="display:flex;"><span>$ cp -a  /opt/backup/quanliang/ceshi /usr/local/mysql/data/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°èµ‹äºˆå±ç»„mysqlæƒé™</span>
</span></span><span style="display:flex;"><span>$ chown -R mysql.mysql   /usr/local/mysql/data/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ service mysql start</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>--copy</code><!-- raw HTML omitted -->å‚æ•°å®ç°å¤‡ä»½æ¢å¤<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ service mysql stop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠdataæ•°æ®ç›®å½•ä¸‹æ•°æ®è¿›è¡Œå¤‡ä»½</span>
</span></span><span style="display:flex;"><span>$ cp -a  /usr/local/mysql/data/* /opt/backup/<span style="color:#66d9ef">$(</span>date +%F_%T<span style="color:#66d9ef">)</span>/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŠŠè¦æ¢å¤çš„æ•°æ®å¤‡ä»½ç”Ÿæˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ innobackupex  --apply-log --redo-only /opt/backup/quanliang/ceshi_danku/  	<span style="color:#75715e"># è¿™ä¸ªæ˜¯å•åº“å¤‡ä»½ç›®å½•</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># dataç›®å½•å¿…é¡»ä¸ºç©º</span>
</span></span><span style="display:flex;"><span>$ innobackupex  --copy-back /opt/backup/quanliang/ceshi_danku/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°èµ‹äºˆå±ç»„æƒé™</span>
</span></span><span style="display:flex;"><span>$ chown -R mysql.mysql /usr/local/mysql/data/
</span></span><span style="display:flex;"><span>$ service mysql start</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->ä½¿ç”¨<!-- raw HTML omitted --><code>Mysql</code><!-- raw HTML omitted -->è„šæœ¬å¤‡ä»½å¹¶é€šçŸ¥é’‰é’‰æ¥å£<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/script/Backup_Mysql_innobackupex.sh<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ***************************************************************#
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">##  Create: DBA
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ***************************************************************#
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## echo `hostname -I` |sed &#39;s/ /#/g&#39; -  &gt;/tmp/ipaddr.txt
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># å®šä¹‰Telegram æœºå™¨äººIDå’ŒæŠ¥è­¦ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_BOT_ID=&#39;Telegram bot_id:bot_key&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TELEGRAM_GROUP_ID=&#39;GROUP_ID&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">IP_ADDRE=$(hostname -I |awk &#39;{print $1}&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_NAME=&#39;backup&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">USER_PASSWORD=&#39;IvV8BhpvHb/7EA==&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DATABASES=&#39;databases name&#39; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backup_time=`date +&#39;%Y%m%d%m&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backup_base=&#34;/opt/backup/dbback&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backup_dir=&#34;$backup_base/full&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">backup_log=&#34;$backup_base/log/xtra_${backup_time}.log&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">slave_days=0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## é’‰é’‰æ¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">function SendToDingding_error(){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> #Dingding_Url=&#34;https://oapi.dingtalk.com/robot/send?access_token=d5201a579163dc6045b6da6d8dbc1cdc1d935698050971ceddb5a8956e9507ee&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Dingding_Url=&#34;https://api.telegram.org/bot${TELEGRAM_BOT_ID}/sendMessage?chat_id=${TELEGRAM_GROUP_ID}&amp;text=%22${IP_ADDRE}mysqlbak%20failure!Please check %22&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # å‘é€é’‰é’‰æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> curl &#34;${Dingding_Url}&#34; -H &#39;Content-Type: application/json&#39; -d &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     \&#34;actionCard\&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;title\&#34;: \&#34;$1\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;text\&#34;: \&#34;$2\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;hideAvatar\&#34;: \&#34;0\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;btnOrientation\&#34;: \&#34;0\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         \&#34;btns\&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                 \&#34;title\&#34;: \&#34;$1\&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                 \&#34;actionURL\&#34;: \&#34;\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     \&#34;msgtype\&#34;: \&#34;actionCard\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å®‰è£…å¤‡ä»½å·¥å…· innobackupex æˆ– xtrabackup
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -x /usr/bin/innobackupex ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     yum -y install  http://www.percona.com/downloads/percona-release/redhat/0.1-4/percona-release-0.1-4.noarch.rpm
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     yum -y install percona-xtrabackup-24 qpress
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å§‹åˆ›å»ºç›®å½•
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -d ${backup_dir} ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mkdir -p ${backup_dir}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -d ${backup_base}/log ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> mkdir -p ${backup_base}/log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_time=`date +&#39;%Y%m%d_%H:%M:%S&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">start_file=`date +&#39;%Y-%m-%d_%H-%M-%S&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å§‹å¤‡ä»½æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">echo -e &#34;`date +&#39;%Y-%m-%d %H:%M:%S&#39;` å¼€å§‹ç‰©ç†å¤‡ä»½æ•°æ®åº“ ${ipaddr} ...&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/usr/bin/innobackupex --defaults-file=/opt/conf/my_16303.cnf --user=${backup_user} --password=${backup_password} --host=&#39;localhost&#39; --socket=/opt/data/data_16303/mysql.sock --use-memory=1G --compress --compress-threads=32 --parallel=3 --slave-info ${backup_dir} 2&gt;&gt;${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ $? -ne 0 ];then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;`date +&#39;%Y%m%d_%H:%M:%S&#39;` å¤‡ä»½æ•°æ®åº“å‘ç”Ÿé”™è¯¯,å…·ä½“çœ‹æ—¥å¿—&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Subject=&#34;ç‰©ç†å¤‡ä»½xtraå¤‡ä»½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Body=&#34;&#39;${ipaddr}&#39;_ç‰©ç†å¤‡ä»½å¤±è´¥,è¯·å‚è€ƒæ—¥å¿—:${backup_log}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> SendToDingding_error $Subject $Body
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> exit 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">cd ${backup_dir}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file_time=`date +&#39;%Y-%m-%d&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">flie_name=`ls -l | grep &#34;$file_time&#34;|tail -n 1|awk &#39;{print $9}&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">tar -zcf ${file_time}.tar.gz ${flie_name}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">rm -rf ${flie_name}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## rsync -avz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if [ ! -z &#34;`tail -1 ${backup_log} | grep &#39;completed OK&#39;`&#34; ]; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> finish_time=`date +&#39;%Y%m%d_%H:%M:%S&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> file_size=`du -sm ${backup_dir} |awk &#39;{print $1}&#39;`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;${ipaddr}æ•°æ®åº“xtrabackupç‰©ç†å¤‡ä»½å·¥ä½œå®Œæˆ!\n å¼€å§‹æ—¶é—´ï¼š${start_time} ç»“æŸæ—¶é—´ï¼š${finish_time}\n å¤‡ä»½ç›®å½•${backup_dir}\n
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">å¤‡ä»½æ–‡ä»¶å¤§å°${file_size} MB&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> # åˆ é™¤ä»¥å‰çš„å¤‡ä»½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;`date +&#39;%Y%m%d_%H:%M:%S&#39;` å¼€å§‹åˆ é™¤${slave_days}å¤©ä»¥å‰çš„å¤‡ä»½&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> cd ${backup_base}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> for tfile in $(/usr/bin/find ${backup_dir}  -mindepth 1 -maxdepth 1 -mtime +${slave_days})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   do
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      cd ${backup_dir} &amp;&amp; rm -rf ${tfile} 2&gt;&gt;${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      echo -e &#34;---- delete file :${file} -----&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   done
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;`date +&#39;%Y%m%d_%H%M%S&#39;` åˆ é™¤${slave_days}å¤©ä»¥å‰çš„å¤‡ä»½-å®Œæˆ&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> find $backup_base/log  -mindepth 1 -maxdepth 1  -mtime +${slave_days} -type f |xargs  rm -f
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> echo -e &#34;`date +&#39;%Y%m%d_%H:%M:%S&#39;` å¤‡ä»½æ•°æ®åº“å‘ç”Ÿé”™è¯¯,å…·ä½“çœ‹æ—¥å¿—&#34; &gt;&gt; ${backup_log}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Subject=&#34;ç‰©ç†å¤‡ä»½xtraå¤‡ä»½å¤±è´¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> Body=&#34;${ipaddr}_ç‰©ç†å¤‡ä»½å¤±è´¥,è¯·å‚è€ƒæ—¥å¿—:${backup_log}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> SendToDingding_error $Subject $Body
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">exit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h3 id="æŸ¥çœ‹å¯¼å‡ºæ¸…ç†binlogæ—¥å¿—">æŸ¥çœ‹ã€å¯¼å‡ºã€æ¸…ç†<code>binlog</code>æ—¥å¿—</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->æŸ¥çœ‹<!-- raw HTML omitted --><code>binlog</code></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æŒ‡å®šæŸ¥è¯¢ mysql-bin.000002è¿™ä¸ªæ–‡ä»¶ï¼Œä»posç‚¹:624å¼€å§‹æŸ¥èµ·ï¼Œåç§»2è¡Œï¼ˆå³ä¸­é—´è·³è¿‡2ä¸ªï¼‰ï¼ŒæŸ¥è¯¢10æ¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> binlog events <span style="color:#66d9ef">in</span> <span style="color:#e6db74">&#39;mysql-bin.000002&#39;</span> <span style="color:#66d9ef">from</span> <span style="color:#ae81ff">624</span> <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">\</span>G;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å¯¼å‡ºæ•°æ®åº“<!-- raw HTML omitted --><code>binlog</code><!-- raw HTML omitted -->æ—¥å¿—<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>--base64-output=</code>ï¼š<code>decode-rows</code><!-- raw HTML omitted -->å°†è¡Œäº‹ä»¶è§£ç ä¸ºæ³¨é‡Šä¼ª<!-- raw HTML omitted --><code>SQL</code><!-- raw HTML omitted -->è¯­å¥<!-- raw HTML omitted --></li>
<li><code>--no-defaults</code></li>
<li><code>--database=&quot;æ•°æ®åº“å&quot;</code>ï¼š<!-- raw HTML omitted -->ä»…åˆ—å‡ºæ­¤æ•°æ®åº“çš„æ¡ç›®(ä»…é™æœ¬åœ°æ—¥å¿—)<!-- raw HTML omitted --></li>
<li><code>--start-datetime=''</code>ï¼š<!-- raw HTML omitted --><!-- raw HTML omitted -->å¼€å§‹æ—¶é—´<!-- raw HTML omitted -->å‚æ•°å¿…é¡»æ˜¯æœ¬åœ°æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œæ ¼å¼ä¸é™<code>MySQL</code>æœåŠ¡å™¨æ¥å—<code>DATETIME</code>å’Œ<code>TIMESTAMP</code>ç±»å‹ï¼Œä¾‹å¦‚ï¼š<!-- raw HTML omitted --><code>2004-12-25 11:25:56</code></li>
<li><code>--stop-datetime=''</code>ï¼š<!-- raw HTML omitted --><!-- raw HTML omitted -->ç»“æŸæ—¶é—´<!-- raw HTML omitted -->å‚æ•°å¿…é¡»æ˜¯æœ¬åœ°æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œæ ¼å¼ä¸é™<code>MySQL</code>æœåŠ¡å™¨æ¥å—<code>DATETIME</code>å’Œ<code>TIMESTAMP</code>ç±»å‹ï¼Œä¾‹å¦‚ï¼š<!-- raw HTML omitted --><code>2004-12-25 11:25:56</code></li>
<li><code>--start-position=875</code>ï¼š<!-- raw HTML omitted -->åç§»é‡å¼€å§‹è¯»å–ä½ç½®<!-- raw HTML omitted --></li>
<li><code>--stop-position=954</code>ï¼š<!-- raw HTML omitted -->åç§»é‡åœæ­¢è¯»å–ä½ç½®<!-- raw HTML omitted --></li>
<li><code>-v</code>ï¼š<!-- raw HTML omitted -->ä»è¡Œäº‹ä»¶ä¸­é‡å»ºä¼ª<code>SQL</code>è¯­å¥ï¼Œ<code>-vv</code>æ·»åŠ å¯¹åˆ—æ•°æ®ç±»å‹çš„æ³¨é‡Š<!-- raw HTML omitted --></li>
<li><code>-r</code>ï¼š<!-- raw HTML omitted -->ç›´æ¥è¾“å‡ºåˆ°ç»™å®šçš„æ–‡ä»¶<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /bin/mysqlbinlog <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--base64-output<span style="color:#f92672">=</span>decode-rows <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-defaults --database<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;æ•°æ®åº“å&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--start-datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2019-04-11 00:00:00&#39;</span> <span style="color:#ae81ff">\ </span> 	<span style="color:#75715e"># å¼€å§‹æ—¶é—´</span>
</span></span><span style="display:flex;"><span>--stop-datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2019-04-11 15:00:00&#39;</span> <span style="color:#ae81ff">\ </span> 	<span style="color:#75715e"># ç»“æŸæ—¶é—´</span>
</span></span><span style="display:flex;"><span>-v /opt/data/mysql/mysql-bin.000007 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-r /opt/binlog<span style="color:#e6db74">`</span>date <span style="color:#e6db74">&#39;+%F&#39;</span><span style="color:#e6db74">`</span>.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ–¹æ³•äºŒ</span>
</span></span><span style="display:flex;"><span>$ /bin/mysqlbinlog <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--no-defaults --database<span style="color:#f92672">=</span>db <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--start-datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2019-04-11 00:00:00&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--stop-datetime<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2019-04-11 15:00:00&#39;</span> mysql-bin.000007 | more
</span></span><span style="display:flex;"><span>mysqlbinlog <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--base64-output<span style="color:#f92672">=</span>decode-rows <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--start-position<span style="color:#f92672">=</span><span style="color:#ae81ff">2966</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--stop-position<span style="color:#f92672">=</span><span style="color:#ae81ff">2966</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-v mysql-bin.000125</span></span></code></pre></div><ul>
<li>2.1 <!-- raw HTML omitted -->ä»<code>binlog</code>æ—¥å¿—ä¸­å¾—<code>DELETE</code>åˆ é™¤æ¢æˆ<code>INSERT INTO</code>æ’å…¥è¯­å¥<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<p><a href="https://www.cnblogs.com/yhq1314/p/13970044.html" rel="external" target="_self"><code>mysql binlg delete</code>è¯­å¥è§£æä¸º<code>insert</code>è¯­å¥</a></p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¿‡æ»¤éåˆ é™¤è¯­å¥</span>
</span></span><span style="display:flex;"><span>$ sed -n <span style="color:#e6db74">&#39;/^###/&#39;</span>p /opt/binlog<span style="color:#e6db74">`</span>date <span style="color:#e6db74">&#39;+%F&#39;</span><span style="color:#e6db74">`</span>.sql  &gt;/opt/binlog<span style="color:#e6db74">`</span>date <span style="color:#e6db74">&#39;+%F&#39;</span><span style="color:#e6db74">`</span>.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å»æ‰#å·</span>
</span></span><span style="display:flex;"><span>$ sed <span style="color:#e6db74">&#39;s/### //g&#39;</span> /opt/binlog<span style="color:#e6db74">`</span>date <span style="color:#e6db74">&#39;+%F&#39;</span><span style="color:#e6db74">`</span>.sql &gt;/opt/binlog<span style="color:#e6db74">`</span>date <span style="color:#e6db74">&#39;+%F&#39;</span><span style="color:#e6db74">`</span>.sql
</span></span><span style="display:flex;"><span>$ sed <span style="color:#e6db74">&#39;s#/\*.*\*/#,#g&#39;</span> c.txt &gt;d.txt
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¦‚æœæœ‰å¯Œæ–‡æœ¬é‡Œé¢å«æ³¨é‡Šè¯­å¥å®¹æ˜“å‡ºé”™å¯ä»¥æ›´ç²¾ç»†åŒ¹é…</span>
</span></span><span style="display:flex;"><span>$ sed <span style="color:#e6db74">&#39;s#/\*.*\*/###   @#,#g&#39;</span> c.txt &gt;d.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat /opt/binlog<span style="color:#e6db74">`</span>date <span style="color:#e6db74">&#39;+%F&#39;</span><span style="color:#e6db74">`</span>.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ find /path/to/binlog/directory -name <span style="color:#e6db74">&#34;binlog.*&#34;</span> -printf <span style="color:#e6db74">&#34;%T@ %p\n&#34;</span> | sort -n | cut -d<span style="color:#e6db74">&#39; &#39;</span> -f2- | xargs mysqlbinlog &gt; combined_binlog.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ find ./ -name <span style="color:#e6db74">&#34;mysql-bin.266*&#34;</span> -printf <span style="color:#e6db74">&#34;%T@ %p\n&#34;</span> | sort -n | cut -d<span style="color:#e6db74">&#39; &#39;</span> -f2- | xargs /usr/local/mysql/bin/mysqlbinlog -vv  --base64-output<span style="color:#f92672">=</span>DECODE-ROWS --set-charset<span style="color:#f92672">=</span>UTF8 mysql-bin.266770 --database<span style="color:#f92672">=</span>databases_name -r new_binlog.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####  	è§£æbinlogå¹¶è¿˜åŸæˆæ’å…¥è¯­å¥  	#####</span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysqlbinlog -vv --base64-output<span style="color:#f92672">=</span>DECODE-ROWS --set-charset<span style="color:#f92672">=</span>UTF8 mysql-bin.merged.9 --database<span style="color:#f92672">=</span>databases_name &gt;&gt;/mnt/new_binlog.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åªè¿‡æ»¤æŸä¸ªæ•°æ®åº“ä¸­çš„æŸä¸ªè¡¨ä¸­çš„åˆ é™¤è¯­å¥</span>
</span></span><span style="display:flex;"><span>$ cat new_binlog.sql | awk <span style="color:#e6db74">&#39;/DELETE FROM/ &amp;&amp; (/databases_name.tables_name/ || /`databases_name`.`tables_name`/) { while(1) { print $0; getline; if($0 !~ /^###/) { break; }; }}&#39;</span> &gt; new_binlog-1.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å»æ‰ï¼š###</span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-1.sql new_binlog-2.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/^### //g&#39;</span> new_binlog-2.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤è¯­å¥æ›¿æ¢ä¸ºæ’å…¥è¯­å¥</span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-2.sql new_binlog-3.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/^DELETE FROM/INSERT INTO/g&#34;</span> new_binlog-3.sql 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¡ä»¶æ›¿æ¢ä¸ºå€¼</span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-3.sql new_binlog-4.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/^WHERE/VALUES(/g&#34;</span> new_binlog-4.sql 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># @21 è¿™é‡Œè¦çœ‹è§£æåçš„å…·ä½“è¡Œæ•°ï¼Œ </span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-4.sql new_binlog-5.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;/@21=.*/a );&#39;</span> new_binlog-5.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat new_binlog-5.sql | awk -F<span style="color:#e6db74">&#34;=|/*&#34;</span> <span style="color:#e6db74">&#39;{ if($0 ~ /^INSERT|^VALUES|^);/) { print $0; } else { printf $2&#34;,&#34;; };}&#39;</span> &gt;new_binlog-6.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp  new_binlog-6.sql new_binlog-7.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/,);</span>$<span style="color:#e6db74">/);/g&#34;</span> new_binlog-7.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cp new_binlog-7.sql new_binlog-8.sql
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/,INSERT/);INSERT/g&#39;</span> new_binlog-8.sql</span></span></code></pre></div></blockquote>
</blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æ¸…ç†<code>binlog</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li>3.1 <a href="https://www.cnblogs.com/xxoome/p/9802684.html" rel="external" target="_self"><code>mysql binlog</code>æ—¥å¿—è‡ªåŠ¨æ¸…ç†åŠæ‰‹åŠ¨åˆ é™¤</a>ã€<a href="https://developer.aliyun.com/article/712256" rel="external" target="_self"><code>Mysql</code>æ¸…ç†<code>binlog</code></a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æ¸…é™¤MySQL-bin.010æ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">PURGE</span> MASTER LOGS <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;MySQL-bin.010&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…é™¤2008-06-22 13:00:00å‰binlogæ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">PURGE</span> MASTER LOGS <span style="color:#66d9ef">BEFORE</span> <span style="color:#e6db74">&#39;2008-06-22 13:00:00&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ¸…é™¤3å¤©å‰binlogæ—¥å¿—BEFOREï¼Œå˜é‡çš„dateè‡ªå˜é‡å¯ä»¥ä¸º&#39;YYYY-MM-DD hh:mm:ss&#39;æ ¼å¼ã€‚ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">PURGE</span> MASTER LOGS <span style="color:#66d9ef">BEFORE</span> <span style="color:#a6e22e">DATE_SUB</span>( <span style="color:#a6e22e">NOW</span>( ), <span style="color:#66d9ef">INTERVAL</span> <span style="color:#ae81ff">3</span> DAY);</span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆ›å»ºæˆæƒåˆ é™¤ç”¨æˆ·">åˆ›å»ºã€æˆæƒã€åˆ é™¤ç”¨æˆ·</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åˆ›å»ºã€æˆæƒ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>5.7.*</code><!-- raw HTML omitted -->ä¸€ä¸‹åˆ›å»ºä»¥åŠæˆæƒ<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">on</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> root<span style="color:#f92672">@</span><span style="color:#e6db74">&#39;10.14.23.%&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123456&#39;</span>;  	<span style="color:#75715e"># 192.168.%.% è¡¨ç¤ºç½‘æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> <span style="color:#66d9ef">database</span>.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#34;password&#34;</span>;</span></span></code></pre></div><ul>
<li><code>Myslq 8.0</code><!-- raw HTML omitted -->è¯­å¥æ‰§è¡Œï¼Œ<code>8.0</code>ç‰ˆæœ¬ä¹‹ååˆ›å»ºç”¨æˆ·å’Œæˆæƒåˆ†å¼€äº†<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºç”¨æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;127.0.0.1&#39;</span> <span style="color:#66d9ef">IDENTIFIED</span> <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;passowrd&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆäºˆæƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;127.0.0.1&#39;</span> <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">OPTION</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ é™¤æƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">REVOKE</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">ON</span> databasename.tablename <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;host&#39;</span>; </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ›å»ºä»åº“ç”¨æˆ·å¹¶æˆå¤åˆ¶æƒé™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>MySQL<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> replication slave, replication client <span style="color:#66d9ef">on</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;lisi&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;10.14.23.%&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123456&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æ’¤é”€ç”¨æˆ·æƒé™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">REVOKE</span> privilege <span style="color:#66d9ef">ON</span> databasename.tablename <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;host&#39;</span>;  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->åˆ é™¤ç”¨æˆ·ã€æ•°æ®<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;host&#39;</span>;  	<span style="color:#75715e"># å¦‚æœæ˜¯å½“å‰ç™»é™†ç”¨æˆ·ç”¨SET PASSWORD = PASSWORD(&#34;newpassword&#34;); 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">â€˜</span>xx<span style="color:#960050;background-color:#1e0010">â€™</span> <span style="color:#66d9ef">and</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;xx&#39;</span>;  	<span style="color:#75715e"># æˆæƒæŸ¥çœ‹æ•°æ®åº“ç”¨æˆ·ï¼ˆclintï¼‰ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> mysql.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;slave&#34;</span> <span style="color:#66d9ef">and</span> host<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;10.14.23.%&#34;</span>;  </span></span></code></pre></div></blockquote>
<hr>
<h3 id="åˆ›å»ºåº“è¡¨">åˆ›å»ºåº“ã€è¡¨</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->åˆ›å»ºåº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> db2 <span style="color:#66d9ef">character</span> <span style="color:#66d9ef">set</span> utf8 <span style="color:#66d9ef">collate</span> utf8_general_ci;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ›å»ºè¡¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><code>NOT NULL</code>ï¼š<!-- raw HTML omitted -->æ¯ä¸€è¡Œéƒ½å¿…é¡»å«æœ‰å€¼ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰ï¼Œ<code>null</code>å€¼æ˜¯ä¸å…è®¸çš„<!-- raw HTML omitted --></li>
<li><code>DEFAULT value</code>ï¼š<!-- raw HTML omitted -->è®¾ç½®é»˜è®¤å€¼<!-- raw HTML omitted --></li>
<li><code>UNSIGNED</code>ï¼š<!-- raw HTML omitted -->ä½¿ç”¨æ— ç¬¦å·æ•°å€¼ç±»å‹ï¼Œ<!-- raw HTML omitted --><code>0</code><!-- raw HTML omitted -->åŠæ­£æ•°<!-- raw HTML omitted --></li>
<li><code>AUTO INCREMENT</code>ï¼š<!-- raw HTML omitted -->è®¾ç½®<!-- raw HTML omitted --><code>MySQL</code><!-- raw HTML omitted -->å­—æ®µçš„å€¼åœ¨æ–°å¢è®°å½•æ—¶æ¯æ¬¡è‡ªåŠ¨å¢é•¿<!-- raw HTML omitted --><code>1</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> databases_name.<span style="color:#a6e22e">tables_name</span>(id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>, name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">50</span>)<span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)  	<span style="color:#75715e"># not null ä¸ä¸ºç©º
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®æ•°æ®è¡¨ä¸­æ¯æ¡è®°å½•çš„å”¯ä¸€æ ‡è¯†ã€‚ é€šå¸¸åˆ—çš„ PRIMARY KEY è®¾ç½®ä¸º ID æ•°å€¼ï¼Œä¸AUTO_INCREMENT ä¸€èµ·ä½¿ç”¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#f92672">`</span>databases_name<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>tables_name<span style="color:#f92672">`</span>(name) <span style="color:#66d9ef">values</span>(<span style="color:#e6db74">&#39;lisi&#39;</span>);
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)  	<span style="color:#75715e"># ä¸å†™id
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#f92672">`</span>databases_name<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>tables_name<span style="color:#f92672">`</span>(id,content,add_time) <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">4</span>,<span style="color:#e6db74">&#39;Text&#39;</span>,<span style="color:#e6db74">&#39;2023-01-11 02:52:54&#39;</span>);</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->æŒ‰æ—¥æœŸåˆ é™¤è¡¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">USE</span> example_db;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> table_name <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">WHERE</span> table_schema <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;example_db&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">CONCAT</span>(<span style="color:#e6db74">&#39;DROP TABLE IF EXISTS &#39;</span>, table_name, <span style="color:#e6db74">&#39;;&#39;</span>) <span style="color:#66d9ef">AS</span> sql_statement <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">WHERE</span> table_schema <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;example_db&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> table_name <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">WHERE</span> table_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;prefix_%&#39;</span> <span style="color:#66d9ef">AND</span> table_name <span style="color:#66d9ef">BETWEEN</span> <span style="color:#e6db74">&#39;prefix_2022-02-01&#39;</span> <span style="color:#66d9ef">AND</span> <span style="color:#e6db74">&#39;prefix_2022-03-01&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#a6e22e">CONCAT</span>(<span style="color:#e6db74">&#39;DROP TABLE IF EXISTS &#39;</span>, table_name, <span style="color:#e6db74">&#39;;&#39;</span>) <span style="color:#66d9ef">AS</span> sql_statement <span style="color:#66d9ef">FROM</span> information_schema.<span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">WHERE</span> table_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;prefix_%&#39;</span> <span style="color:#66d9ef">AND</span> table_name <span style="color:#66d9ef">BETWEEN</span> <span style="color:#e6db74">&#39;prefix_2022-02-01&#39;</span> <span style="color:#66d9ef">AND</span> <span style="color:#e6db74">&#39;prefix_2022-03-01&#39;</span>;</span></span></code></pre></div></blockquote>
<hr>
<h3 id="æŸ¥è¯¢åº“è¡¨å®¹é‡å¤§å°">æŸ¥è¯¢åº“ã€è¡¨å®¹é‡å¤§å°</h3>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥è¯¢æ‰€æœ‰åº“å®¹é‡å¤§å°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>table_schema <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(table_rows) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è®°å½•æ•°&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(data_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(index_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç´¢å¼•å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(DATA_FREE<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç¢ç‰‡å ç”¨(MB)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.<span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> table_schema
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#a6e22e">sum</span>(data_length) <span style="color:#66d9ef">desc</span>, <span style="color:#a6e22e">sum</span>(index_length) <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹æŒ‡å®šåº“çš„å®¹é‡å¤§å°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>æŸ¥çœ‹<code>MySQL</code>ã€ŒæŒ‡å®šåº“ã€çš„å®¹é‡å¤§å°ï¼š<code>database_name</code>æ›´æ”¹ä¸ºè¦æŸ¥è¯¢çš„åº“</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>table_schema <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(table_rows) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è®°å½•æ•°&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(data_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(index_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç´¢å¼•å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">truncate</span>(DATA_FREE<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç¢ç‰‡å ç”¨(MB)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.<span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> table_schema<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;database_name&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> data_length <span style="color:#66d9ef">desc</span>, index_length <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹æŒ‡å®šåº“ä¸­æ‰€æœ‰è¡¨çš„å®¹é‡å¤§å°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>æŸ¥çœ‹<code>MySQL</code>ã€ŒæŒ‡å®šåº“ã€ä¸­ã€Œæ‰€æœ‰è¡¨ã€çš„å®¹é‡å¤§å°</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>table_schema <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span>table_name <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è¡¨å&#39;</span>,
</span></span><span style="display:flex;"><span>table_rows <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è®°å½•æ•°&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(data_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(index_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç´¢å¼•å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(DATA_FREE<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç¢ç‰‡å ç”¨(MB)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.<span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> table_schema<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;database_name&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> data_length <span style="color:#66d9ef">desc</span>, index_length <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹æŒ‡å®šåº“ä¸­æŒ‡å®šè¡¨çš„å®¹é‡å¤§å°<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<ul>
<li>æŸ¥çœ‹<code>MySQL</code>ã€ŒæŒ‡å®šåº“ã€ä¸­ã€ŒæŒ‡å®šè¡¨ã€çš„å®¹é‡å¤§å°ï¼šå°†ä»£ç ä¸­<code>database_name</code>æ•°æ®åº“åæ”¹ä¸ºä½ è¦æŸ¥è¯¢çš„æ•°æ®åº“åï¼Œ<code>tables_name</code>æ”¹ä¸ºä½ è¦æŸ¥è¯¢çš„è¡¨å</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>table_schema <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span>table_name <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è¡¨å&#39;</span>,
</span></span><span style="display:flex;"><span>table_rows <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;è®°å½•æ•°&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(data_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;æ•°æ®å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(index_length<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç´¢å¼•å®¹é‡(MB)&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">truncate</span>(DATA_FREE<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#39;ç¢ç‰‡å ç”¨(MB)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.<span style="color:#66d9ef">tables</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> table_schema<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;database_name&#39;</span><span style="color:#66d9ef">and</span> table_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tables_name&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> data_length <span style="color:#66d9ef">desc</span>, index_length <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
</blockquote>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢å¹¶ä¸”è¿›è¡ŒAESè§£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#a6e22e">aes_decrypt</span>(<span style="color:#a6e22e">from_base64</span>(mobile),<span style="color:#e6db74">&#39;key&#39;</span>,<span style="color:#e6db74">&#39;åŠ å¯†æ©ç &#39;</span>) <span style="color:#66d9ef">from</span> yl_users <span style="color:#66d9ef">where</span> member <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->æ’æŸ¥<!-- raw HTML omitted --><code>Mysql</code><!-- raw HTML omitted -->å ç”¨å†…å­˜åŸå› <!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹MySQLçš„Pid</span>
</span></span><span style="display:flex;"><span>$ ps -ef | grep -i mysqld
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹MySQLå®æ—¶æ“ä½œç³»ç»Ÿçº¿ç¨‹Pid</span>
</span></span><span style="display:flex;"><span>$ top -p <span style="color:#e6db74">&#34;Mysql Pid&#34;</span> -H
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ•°æ®åº“ä¸­æŸ¥çœ‹Pid å…·ä½“æ“ä½œå†…å®¹</span>
</span></span><span style="display:flex;"><span>Mysql&gt; SELECT THREAD_ID,name ,PROCESSLIST_ID FROM <span style="color:#e6db74">`</span>performance_schema<span style="color:#e6db74">`</span>.threads WHERE THREAD_OS_ID <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Mysql Pid&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ ¹æ®è·å–åˆ°MySQLä¸­çš„ Thread_id è·å–SQL</span>
</span></span><span style="display:flex;"><span>mysql&gt; SELECT SQL_TEXT FROM <span style="color:#e6db74">`</span>performance_schema<span style="color:#e6db74">`</span>.events_statements_current WHERE THREAD_ID <span style="color:#f92672">=</span> Thread_id;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">###########################</span>
</span></span><span style="display:flex;"><span>mysql&gt; SELECT VARIABLE_NAME,VARIABLE_VALUE, CONCAT<span style="color:#f92672">(</span>VARIABLE_VALUE/1024/1024,<span style="color:#e6db74">&#39; MB&#39;</span><span style="color:#f92672">)</span> AS VARIABLE_VALUE_MB FROM information_schema.SESSION_VARIABLES WHERE VARIABLE_NAME IN <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;innodb_buffer_pool_size&#39;</span>,<span style="color:#e6db74">&#39;innodb_log_buffer_size&#39;</span>,<span style="color:#e6db74">&#39;innodb_additional_mem_pool_size&#39;</span>,<span style="color:#e6db74">&#39;key_buffer_size&#39;</span>,<span style="color:#e6db74">&#39;query_cache_size&#39;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql&gt; SHOW VARIABLES LIKE <span style="color:#e6db74">&#39;%show_compatibility_56%&#39;</span>;
</span></span><span style="display:flex;"><span>mysql&gt; SET GLOBAL show_compatibility_56<span style="color:#f92672">=</span>on;</span></span></code></pre></div></blockquote>
<hr>
<h3 id="å…¶ä»–å‘½ä»¤">å…¶ä»–å‘½ä»¤</h3>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># MySQL-master,æŸ¥çœ‹æ•°æ®åº“åç§»é‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> master status;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> reset master;  <span style="color:#75715e"># æ¸…ç†resetæ—¥å¿—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»åº“æ‰§è¡Œï¼Œæµ‹è¯•è¿æ¥ä¸»åº“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span><span style="color:#66d9ef">show</span> grants;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> mysql_secure_installation  	<span style="color:#75715e"># mysqlå®‰å…¨é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Enter current password <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">root</span> (enter <span style="color:#66d9ef">for</span> none):  	<span style="color:#75715e"># è¾“å…¥è¿›å…¥æ•°æ®åº“å¯†ç ï¼Œé»˜è®¤ä¸ºç©ºï¼ŒæŒ‰å›è½¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">Set</span> root password<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]  	<span style="color:#75715e"># è®¾ç½®mysqlæ•°æ®åº“rootç”¨æˆ·çš„å¯†ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Remove anonymous users<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]  	<span style="color:#75715e"># ç§»é™¤åŒ¿åç”¨æˆ·Y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Disallow root login remotely<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]  	<span style="color:#75715e"># ä¸å…è®¸rootç”¨æˆ·è¿œç¨‹ç™»é™†Y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Remove test <span style="color:#66d9ef">database</span> <span style="color:#66d9ef">and</span> access <span style="color:#66d9ef">to</span> it<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]  	<span style="color:#75715e"># ç§»é™¤testæ•°æ®åº“å’Œè®¿é—®Y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Reload privilege <span style="color:#66d9ef">tables</span> now<span style="color:#f92672">?</span> [Y<span style="color:#f92672">/</span>n]   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç­›é€‰æ•°æ®ä¸åŒå€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">distinct</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">15</span> <span style="color:#66d9ef">and</span> (<span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;é€‰é¡¹&#39;</span> <span style="color:#66d9ef">or</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;é€‰é¡¹&#39;</span>);
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#960050;background-color:#1e0010">åˆ—åã€åˆ—å</span> <span style="color:#66d9ef">desc</span>(<span style="color:#960050;background-color:#1e0010">é™åº</span>)<span style="color:#960050;background-color:#1e0010">ã€</span><span style="color:#66d9ef">asc</span>(<span style="color:#960050;background-color:#1e0010">å‡åºã€é»˜è®¤å‡åº</span>);
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">2</span>  	<span style="color:#75715e"># æŸ¥çœ‹å‰ä¸¤æ¡æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;é¦–ä¸ªå…³é”®å­—%&#39;</span>;  	<span style="color:#75715e"># %åŒ¹é…æ‰€æœ‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%xx%&#39;</span>;  	<span style="color:#75715e"># åå‘æŸ¥æ‰¾
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">in</span> (<span style="color:#e6db74">&#39;å…³é”®å­—&#39;</span>,<span style="color:#960050;background-color:#1e0010">â€˜å…³é”®å­—â€™</span>)<span style="color:#960050;background-color:#1e0010">ï¼›</span>
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">between</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">and</span> <span style="color:#ae81ff">20</span>;  	<span style="color:#75715e"># é€‰å–1åˆ°20ä¹‹é—´
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">between</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">and</span> <span style="color:#ae81ff">20</span>;  	<span style="color:#75715e"># å–å
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">where</span> (<span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">between</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">and</span> <span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">and</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">in</span> (<span style="color:#e6db74">&#39;å…³é”®å­—&#39;</span>)<span style="color:#960050;background-color:#1e0010">ï¼›</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ›´æ–°ã€æ›´æ”¹æ•°æ®æ•°æ®ä»¥åŠç”¨æˆ·æƒé™
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> <span style="color:#960050;background-color:#1e0010">è¡¨å</span> <span style="color:#66d9ef">set</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;333&#39;</span>, <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cn&#39;</span> <span style="color:#66d9ef">where</span> <span style="color:#960050;background-color:#1e0010">åˆ—å</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;xxx&#39;</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">set</span> host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;root&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹æ•°æ®åº“åŒæ­¥çº¿ç¨‹mysql
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> global sync_binlog<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> global innodb_flush_log_at_trx_commit<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹sqlçº¿ç¨‹æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> STOP SLAVE SQL_THREAD;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SET</span> GLOBAL slave_parallel_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;LOGICAL_CLOCK&#39;</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SET</span> GLOBAL slave_parallel_workers<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>;  	
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> START SLAVE SQL_THREAD;	</span></span></code></pre></div></blockquote>
<hr>
<h2 id="mysqlæŸ¥è¯¢é”è¡¨è¯­å¥"><code>MySQL</code>æŸ¥è¯¢é”è¡¨è¯­å¥</h2>
<ul>
<li>
<ol>
<li><a href="https://www.cnblogs.com/better-farther-world2099/articles/14721482.html" rel="external" target="_self"><code>MySQL</code>æŸ¥è¯¢é”è¡¨è¯­å¥</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->æŸ¥è¯¢æ˜¯å¦é”è¡¨<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> OPEN <span style="color:#66d9ef">TABLES</span> <span style="color:#66d9ef">where</span> In_use <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹æ­£åœ¨é”çš„äº‹åŠ¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_LOCKS; </span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹ç­‰å¾…é”çš„äº‹åŠ¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_LOCK_WAITS;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å½“å‰çš„äº‹åŠ¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_TRX;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å½“å‰é”å®šçš„äº‹åŠ¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_LOCKS;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥çœ‹å½“å‰ç­‰é”çš„äº‹åŠ¡<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> INFORMATION_SCHEMA.INNODB_LOCK_WAITS;</span></span></code></pre></div><ul>
<li><!-- raw HTML omitted -->æŸ¥è¯¢æ­»é”è¯¦æƒ…<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> r.trx_id waiting_trx_id,r.trx_mysql_thread_id waiting_thread,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">TIMESTAMPADD</span>(SECOND,r.trx_wait_started,<span style="color:#66d9ef">CURRENT_TIMESTAMP</span>) wait_time,
</span></span><span style="display:flex;"><span>r.trx_query waiting_query,
</span></span><span style="display:flex;"><span>l.lock_table waiting_table_lock,
</span></span><span style="display:flex;"><span>b.trx_id blocking_trx_id,b.trx_mysql_thread_id blocking_thread,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SUBSTRING</span>(p.<span style="color:#f92672">`</span>HOST<span style="color:#f92672">`</span>,<span style="color:#ae81ff">1</span>,<span style="color:#a6e22e">INSTR</span>(p.<span style="color:#f92672">`</span>HOST<span style="color:#f92672">`</span>,<span style="color:#e6db74">&#39;:&#39;</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) blocking_host,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SUBSTRING</span>(p.<span style="color:#f92672">`</span>HOST<span style="color:#f92672">`</span>,<span style="color:#a6e22e">INSTR</span>(p.<span style="color:#f92672">`</span>HOST<span style="color:#f92672">`</span>,<span style="color:#e6db74">&#39;:&#39;</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>) blocking_port,
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">IF</span>(p.COMMAND <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sleep&#39;</span>,p.<span style="color:#66d9ef">TIME</span>,<span style="color:#ae81ff">0</span>) idle_in_trx,
</span></span><span style="display:flex;"><span>b.trx_query blocking_query
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> information_schema.INNODB_LOCK_WAITS w
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.INNODB_TRX b <span style="color:#66d9ef">ON</span> b.trx_id <span style="color:#f92672">=</span> w.blocking_lock_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.INNODB_TRX r <span style="color:#66d9ef">ON</span> r.trx_id <span style="color:#f92672">=</span> w.requesting_trx_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.INNODB_LOCKS l <span style="color:#66d9ef">ON</span> l.lock_id <span style="color:#f92672">=</span> w.requested_lock_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> information_schema.<span style="color:#f92672">`</span>PROCESSLIST<span style="color:#f92672">`</span> p <span style="color:#66d9ef">ON</span> p.id <span style="color:#f92672">=</span> b.trx_mysql_thread_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> wait_time <span style="color:#66d9ef">desc</span>;</span></span></code></pre></div></blockquote>
<hr>
<h2 id="é…ç½®æ•°æ®åº“ä¸»ä»å¤åˆ¶">é…ç½®æ•°æ®åº“ä¸»ä»å¤åˆ¶</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->ä¸»æ•°æ®åº“é…ç½®ä»¥åŠæˆæƒ<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ID</span>
</span></span><span style="display:flex;"><span>$ server_id<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>hostname -I |awk <span style="color:#e6db74">&#34;{print </span>$1<span style="color:#e6db74">}&#34;</span>|awk -F<span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#e6db74">&#34;{print </span>$4<span style="color:#e6db74">}&#34;</span><span style="color:#e6db74">`</span>  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/server-id = 16303110/server-id = 16303</span>$server_id<span style="color:#e6db74">/g&#34;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æˆæƒä»åº“è¿æ¥è´¦æˆ·å¯†ç </span>
</span></span><span style="display:flex;"><span>mysql&gt; grant replication slave on *.* to myuser@<span style="color:#e6db74">&#39;host IP&#39;</span> identified by <span style="color:#e6db74">&#39;password&#39;</span>;
</span></span><span style="display:flex;"><span>mysql&gt; flush privileges;
</span></span><span style="display:flex;"><span>mysql&gt; reset master; <span style="color:#e6db74">&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->é…ç½®ä»åº“è¿æ¥ä¸»åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹ID</span>
</span></span><span style="display:flex;"><span>$ server_id<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>hostname -I |awk <span style="color:#e6db74">&#39;{print $1}&#39;</span>|awk -F<span style="color:#e6db74">&#39;.&#39;</span> <span style="color:#e6db74">&#39;{print $4}&#39;</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/server-id = 16303110/server-id = 16303</span>$server_id<span style="color:#e6db74">/g&#34;</span> /etc/my.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®è¿æ¥ä¸»åº“</span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p -S /tmp/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e <span style="color:#e6db74">&#34;CHANGE MASTER TO MASTER_HOST=&#39;127.0.0.1&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_USER=&#39;myuser&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PASSWORD=&#39;password&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PORT=16303, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_LOG_FILE=&#39;mysql-bin.000001&#39;, \  	# ä¸»æœºshow master status;ä¸­çš„File
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_LOG_POS=154,MASTER_CONNECT_RETRY=15;&#34;</span>  	<span style="color:#75715e"># ä¸»æœºshow master status;ä¸­çš„Position.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p -S /tmp/mysql.sock -e <span style="color:#e6db74">&#34;start slave;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p -S /tmp/mysql.sock -e <span style="color:#e6db74">&#34;show slave status\G&#34;</span></span></span></code></pre></div><ul>
<li>2.1 <!-- raw HTML omitted -->é…ç½®å¤šæºå¤åˆ¶<!-- raw HTML omitted --></li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql -uroot -p -S /tmp/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-e <span style="color:#e6db74">&#34;CHANGE MASTER TO MASTER_HOST=&#39;127.0.0.1&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_USER=&#39;myuser&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PASSWORD=&#39;password&#39;, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">MASTER_PORT=16303, \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">master_auto_position=1  for  channel &#39;rep_master_1&#39;;&#34;</span>  	<span style="color:#75715e"># åå•†ã€å®šä¹‰é¢‘é“å‡ ä¸ªä¸»æœºå®šä¹‰å‡ æ¬¡ã€‚</span></span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<h2 id="æ•°æ®åº“å¼€å¯gtidæµç¨‹">æ•°æ®åº“å¼€å¯<code>GTID</code>æµç¨‹</h2>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># å¦‚æœå¯ä»¥å…ˆæš‚åœä¸šåŠ¡ï¼ŒæŸ¥è¯¢æ˜¯å¦è¿˜æœ‰ä¸šåŠ¡è¿æ¥</span>
</span></span><span style="display:flex;"><span>mysql&gt; show processlist;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»ä»ä¾æ¬¡æ‰§è¡Œï¼šä¸»åº“æ‰§è¡Œå¥½åï¼Œå»ä»åº“æ‰§è¡Œ ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY<span style="color:#f92672">=</span>WARN;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢ä¸»ä»é”™è¯¯æ—¥å¿—ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰æŠ¥é”™ï¼Œåœ¨åšä¸‹ä¸€æ­¥</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»åº“æ‰§è¡Œå¥½åï¼Œå»ä»åº“æ‰§è¡Œ ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY<span style="color:#f92672">=</span>ON;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»åº“æ‰§è¡Œå¥½åï¼Œå»ä»åº“æ‰§è¡Œ ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.GTID_MODE<span style="color:#f92672">=</span>OFF_PERMISSIVE;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»åº“æ‰§è¡Œå¥½åï¼Œå»ä»åº“æ‰§è¡Œ ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.GTID_MODE<span style="color:#f92672">=</span>ON_PERMISSIVE;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»åº“æŸ¥è¯¢ï¼šç­‰å¾…ä»åº“è¿™ä¸ªçŠ¶æ€å˜ä¸º0</span>
</span></span><span style="display:flex;"><span>mysql&gt; show status like <span style="color:#e6db74">&#39;ONGOING_ANONYMOUS_TRANSACTION_COUNT&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸»ä»æ‰§è¡Œï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; SET @@GLOBAL.gtid_mode<span style="color:#f92672">=</span>on;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»åº“æ‰§è¡Œï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; stop slave;
</span></span><span style="display:flex;"><span>mysql&gt; change master to master_auto_position<span style="color:#f92672">=</span>1;
</span></span><span style="display:flex;"><span>mysql&gt; start slave;</span></span></code></pre></div></blockquote>
<hr>
<h2 id="mysqlå¼€å¯æ—¥å¿—å®¡è®¡"><code>Mysql</code>å¼€å¯æ—¥å¿—å®¡è®¡</h2>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># è¿æ¥æ•°æ®åº“æ‰§è¡Œè¯­å¥ï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; CREATE TABLE <span style="color:#e6db74">`</span>mysql<span style="color:#e6db74">`</span>.<span style="color:#e6db74">`</span>audit_login<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>ID<span style="color:#e6db74">`</span> bigint NOT NULL AUTO_INCREMENT COMMENT <span style="color:#e6db74">&#39;è‡ªå¢ID&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>USER<span style="color:#e6db74">`</span> varchar<span style="color:#f92672">(</span>128<span style="color:#f92672">)</span>  NOT NULL COMMENT <span style="color:#e6db74">&#39;æ•°æ®åº“ä¸­çš„ç”¨æˆ·&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>HOST<span style="color:#e6db74">`</span> varchar<span style="color:#f92672">(</span>64<span style="color:#f92672">)</span>  DEFAULT NULL COMMENT <span style="color:#e6db74">&#39;ç™»å½•çš„IP&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>DB<span style="color:#e6db74">`</span> varchar<span style="color:#f92672">(</span>64<span style="color:#f92672">)</span>  DEFAULT NULL COMMENT <span style="color:#e6db74">&#39;è®¿é—®çš„æ•°æ®åº“&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>PROCESSLIST_ID<span style="color:#e6db74">`</span> bigint NOT NULL COMMENT <span style="color:#e6db74">&#39;ç”¨æˆ·è¿æ¥&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>LOGIN_TIME<span style="color:#e6db74">`</span> datetime<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> DEFAULT CURRENT_TIMESTAMP<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> COMMENT <span style="color:#e6db74">&#39;ç™»å½•æ—¶é—´&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>UPDATE_TIME<span style="color:#e6db74">`</span> datetime<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> DEFAULT CURRENT_TIMESTAMP<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> ON UPDATE CURRENT_TIMESTAMP<span style="color:#f92672">(</span>3<span style="color:#f92672">)</span> COMMENT <span style="color:#e6db74">&#39;è®°å½•è¿™è¡Œæ•°æ®ä¸Šæ¬¡è¢«ä¿®æ”¹çš„æ—¶é—´,é»˜è®¤ç­‰äºLOGIN_TIME&#39;</span>,
</span></span><span style="display:flex;"><span>PRIMARY KEY <span style="color:#f92672">(</span><span style="color:#e6db74">`</span>ID<span style="color:#e6db74">`</span><span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>KEY <span style="color:#e6db74">`</span>IDX_USER<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span><span style="color:#e6db74">`</span>USER<span style="color:#e6db74">`</span><span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>KEY <span style="color:#e6db74">`</span>IDX_HOST<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span><span style="color:#e6db74">`</span>HOST<span style="color:#e6db74">`</span><span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>KEY <span style="color:#e6db74">`</span>IDX_LOGIN_TIME<span style="color:#e6db74">`</span> <span style="color:#f92672">(</span><span style="color:#e6db74">`</span>LOGIN_TIME<span style="color:#e6db74">`</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span> ENGINE<span style="color:#f92672">=</span>InnoDB COMMENT <span style="color:#e6db74">&#34;ç”¨æˆ·ç™»å½•å®¡è®¡æ—¥å¿—è¡¨&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥è¯¢æˆæƒSQLï¼Œå¤åˆ¶æŸ¥è¯¢å‡ºæ¥çš„SQLè¯­å¥ï¼Œæ‰§è¡Œæˆæƒ</span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#66d9ef">select</span> concat<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;grant select,insert on mysql.audit_login to &#39;&#34;</span>,user,<span style="color:#e6db74">&#34;&#39;@&#39;&#34;</span>,host,<span style="color:#e6db74">&#34;&#39;;&#34;</span><span style="color:#f92672">)</span> grants_sql from mysql.user where user not in <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;mysql.session&#39;</span>,<span style="color:#e6db74">&#39;mysql.sys&#39;</span><span style="color:#f92672">)</span> and Super_priv<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;N&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‰§è¡Œï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; set global init_connect<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;insert into mysql.audit_login(USER,HOST,DB,PROCESSLIST_ID) values(current_user(),substring_index(user(),&#39;@&#39;,-1),database(),connection_id());&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®å‚æ•°æ–‡ä»¶ï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysqld<span style="color:#f92672">]</span> 
</span></span><span style="display:flex;"><span>init_connect<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;insert into mysql.audit_login(USER,HOST,DB,PROCESSLIST_ID) values(current_user(),substring_index(user(),&#39;@&#39;,-1),database(),connection_id());&#34;</span>;  <span style="color:#75715e">#DBA add</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æœ€åæ‰§è¡Œçœ‹çœ‹æœ‰æ²¡æœ‰æ•°æ®ï¼š</span>
</span></span><span style="display:flex;"><span>mysql&gt; <span style="color:#66d9ef">select</span> * from mysql.audit_login;</span></span></code></pre></div></blockquote>
<hr>
<h2 id="ä¸»ä»è·³è¿‡å¤åˆ¶é”™è¯¯">ä¸»ä»è·³è¿‡å¤åˆ¶é”™è¯¯</h2>
<blockquote>
<ul>
<li>
<ol>
<li><a href="https://blog.51cto.com/arthur376/1969935" rel="external" target="_self">ä¸»ä»è·³è¿‡å¤åˆ¶é”™è¯¯</a></li>
</ol>
</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="color:#75715e"># åœæ­¢å¤åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> slave stop;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è®¾å®šè·³è¿‡ä¸€ä¸ªäº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SET</span> GLOBAL SQL_SLAVE_SKIP_COUNTER <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡æ–°å¼€å¯å¤åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span>slave start
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿™æ ·å°±æ­£å¸¸äº†ï¼Œä½†æ˜¯ï¼Œå½“ç„¶è¿˜æ˜¯è¦æŠŠæ•°æ®ä¿®æ”¹ä¸Šå»
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mysql<span style="color:#f92672">&gt;</span><span style="color:#66d9ef">update</span> <span style="color:#66d9ef">tables</span> <span style="color:#66d9ef">set</span> <span style="color:#960050;background-color:#1e0010">ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span></span></span></code></pre></div></blockquote>
<hr>
<h2 id="sqlä¼˜åŒ–å®¡æ ¸å¹³å°å·¥å…·"><code>SQL</code>ä¼˜åŒ–ã€å®¡æ ¸å¹³å°å·¥å…·</h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…<a href="https://guide.yearning.io/install.html" rel="external" target="_self"><code>Yearning</code></a><code>SQL</code>å®¡æ ¸å·¥å…·<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->é»˜è®¤è´¦å·/å¯†ç ï¼š<!-- raw HTML omitted --><code>admin/Yearning_admin</code></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install wget unzip
</span></span><span style="display:flex;"><span>$ wget -P /opt/src/ https://github.com/cookieY/Yearning/releases/download/v3.1.0/Yearning-v3.1.0-linux-amd64.zip  
</span></span><span style="display:flex;"><span>$ unzip -d /opt/yearning /opt/src/Yearning-v3.1.0-linux-amd64.zip  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/Port = &#34;</span>3306<span style="color:#e6db74">&#34;/Port = &#34;</span>16303<span style="color:#e6db74">&#34;/g&#34;</span> /opt/apps/yearning/conf.toml  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/Password = &#39;xxxx&#39;/Password = &#39;p@ssw0rd&#39;/g&#34;</span> /opt/apps/yearning/conf.toml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /bin/mysql -uroot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -S /opt/data/data_16303/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -p -e <span style="color:#e6db74">&#34;create database Yearning DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ bin/mysql -uroot <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -S /opt/data/data_16303/mysql.sock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -p -e <span style="color:#e6db74">&#34;grant all on *.* to root@&#39;127.0.0.1&#39; identified by &#34;</span>p@ssw0rd<span style="color:#e6db74">&#34;;&#34;</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ./Yearning install  	<span style="color:#75715e"># å…ˆåˆå§‹åŒ–</span>
</span></span><span style="display:flex;"><span>$ ./Yearning run
</span></span><span style="display:flex;"><span>$ ./Yearning run --push <span style="color:#e6db74">&#34;åŸŸåã€æˆ–è€…IPåœ°å€&#34;</span> --port <span style="color:#e6db74">&#34;8000&#34;</span>  	<span style="color:#75715e"># æŒ‡å®šåŸŸåç«¯å£æ–¹å¼å¯åŠ¨</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->å®‰è£…ç¾å›¢<code>SQL</code>ä¼˜åŒ–å·¥å…·<a href="https://github.com/Meituan-Dianping/SQLAdvisor/blob/master/doc/QUICK_START.md" rel="external" target="_self"><code>SQL-Advisor</code></a><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://segmentfault.com/a/1190000022883633" rel="external" target="_self"><code>MySQL-SQLAdvisor</code>çš„ç®€å•å®‰è£…ä½¿ç”¨</a></li>
<li><a href="https://tech.meituan.com/2017/03/09/sqladvisor-pr.html" rel="external" target="_self">ç¾å›¢ç‚¹è¯„<code>SQL</code>ä¼˜åŒ–å·¥å…·<code>SQLAdvisor</code>å¼€æº</a></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install git wget cmake libaio-devel libffi-devel glib2 glib2-devel  
</span></span><span style="display:flex;"><span>$ yum -y install --enablerepo<span style="color:#f92672">=</span>Percona56 Percona-Server-shared-56  
</span></span><span style="display:flex;"><span>$ git clone https://github.com/Meituan-Dianping/SQLAdvisor.git /opt/src/sqladvisor  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd /opt/src/sqladvisor
</span></span><span style="display:flex;"><span>$ cmake -DBUILD_CONFIG<span style="color:#f92672">=</span>mysql_release <span style="color:#ae81ff">\ </span>
</span></span><span style="display:flex;"><span> -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span>debug <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> -DCMAKE_INSTALL_PREFIX<span style="color:#f92672">=</span>/usr/local/sqlparser ./
</span></span><span style="display:flex;"><span>$ make <span style="color:#f92672">&amp;&amp;</span> make install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. DCMAKE_INSTALL_PREFIXä¸ºsqlparseråº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶çš„å®‰è£…ç›®å½•ï¼Œå…¶ä¸­libç›®å½•åŒ…å«åº“æ–‡ä»¶libsqlparser.soï¼Œincludeç›®å½•åŒ…å«æ‰€éœ€çš„æ‰€æœ‰å¤´æ–‡ä»¶ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. DCMAKE_INSTALL_PREFIXå€¼å°½é‡ä¸è¦ä¿®æ”¹ï¼Œåé¢å®‰è£…ä¾èµ–è¿™ä¸ªç›®å½•ã€‚  </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cd SQLAdvisor/sqladvisor/
</span></span><span style="display:flex;"><span>$ cmake -DCMAKE_BUILD_TYPE<span style="color:#f92672">=</span>debug ./
</span></span><span style="display:flex;"><span>$ make
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨æœ¬è·¯å¾„ä¸‹ç”Ÿæˆä¸€ä¸ªsqladvisorå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™å³æ˜¯æˆ‘ä»¬æƒ³è¦</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ cat &gt;sql.cnf<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[sqladvisor]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">username=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">password=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">host=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">port=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dbname=xx
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sqls=sql1;sql2;sql3....
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cmd: ./sqladvisor -f sql.cnf  -v 1</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><a href="https://www.justdojava.com/2021/07/20/canal/" rel="external" target="_self">ç›‘å¬<code>MySQL binlog</code>å®ç°æ•°æ®å˜åŒ–åçš„å®æ—¶é€šçŸ¥</a></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://github.com/alibaba/canal" rel="external" target="_self"><code>Github Alibaba Canal</code></a></li>
</ul>
</blockquote>
<ul>
<li>
<ol start="4">
<li><code>explain</code><!-- raw HTML omitted -->çš„ä½¿ç”¨<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><a href="https://developer.aliyun.com/article/1104750#slide-12" rel="external" target="_self"><code>Mysql</code>ä¼˜åŒ–é«˜çº§ç¯‡</a></li>
<li><code>explain</code>+<code>sql</code>è¯­å¥</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">explain</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> Tables_name;</span></span></code></pre></div><blockquote>
<ul>
<li><code>id</code>ï¼šè¡¨çš„è¯»å–é¡ºåº</li>
<li><code>select_type</code>ï¼šæ•°æ®è¯»å–æ“ä½œçš„æ“ä½œç±»å‹</li>
<li><code>possible_keys</code>ï¼šå“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨</li>
<li><code>key</code>ï¼šå“ªäº›ç´¢å¼•è¢«å®é™…ä½¿ç”¨</li>
<li><code>ref</code>ï¼šè¡¨ä¹‹é—´çš„å¼•ç”¨</li>
<li><code>rows</code>ï¼šæ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢</li>
</ul>
</blockquote>
</blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="install_mysql">Install_Mysql</h1>

<h2 id="éƒ¨ç½²mysql-57">éƒ¨ç½²<code>Mysql 5.7</code></h2>
<blockquote>
<ul>
<li><a href="https://www.cnblogs.com/lyhabc/p/6136227.html" rel="external" target="_self">ä»0å¼€å§‹æ­å»º<code>SQL Server AlwaysOn</code>ç¬¬å››ç¯‡-é…ç½®å¼‚åœ°æœºæˆ¿èŠ‚ç‚¹</a></li>
<li><a href="https://downloads.mysql.com/archives/" rel="external" target="_self"><code>Mysql</code>äº§å“æ¡£æ¡ˆ</a></li>
</ul>
</blockquote>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…æ‰©å±•ä¸‹è½½<code>Mysql</code>å¹¶è§£å‹å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Debianç³»ç»Ÿ</span>
</span></span><span style="display:flex;"><span>$ sudo apt-get install build-essential cmake bison libncurses5-dev libssl-dev pkg-config g++ libaio1 libnuma1 libncurses5
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CentOS </span>
</span></span><span style="display:flex;"><span>$ yum -y remove mariadb* mariadb
</span></span><span style="display:flex;"><span>$ yum -y install numactl libaio* wget git epel-release
</span></span><span style="display:flex;"><span>$ yum -y install  https://mirrors.cloud.tencent.com/percona/release/7/RPMS/noarch/percona-release-0.1-4.noarch.rpm
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/gpgcheck = 1/gpgcheck = 0/g&#34;</span> /etc/yum.repos.d/percona-release.repo
</span></span><span style="display:flex;"><span>$ yum -y install percona-xtrabackup-24 qpress
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ tar -zxvf /usr/local/src/mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz -C /usr/local/src/
</span></span><span style="display:flex;"><span>$ cp -r /usr/local/src/mysql-5.7.28-linux-glibc2.12-x86_64 /usr/local/mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->è®¾ç½®æƒé™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ groupadd mysql
</span></span><span style="display:flex;"><span>$ useradd -r -g mysql mysql
</span></span><span style="display:flex;"><span>$ cd /usr/local/
</span></span><span style="display:flex;"><span>$ chown -R mysql:mysql ./mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åˆå§‹åŒ–æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cd /usr/local/mysql/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ bin/mysqld --initialize --user<span style="color:#f92672">=</span>mysql --basedir<span style="color:#f92672">=</span>/usr/local/mysql --datadir<span style="color:#f92672">=</span>/usr/local/mysql/data
</span></span><span style="display:flex;"><span>$ bin/mysql_ssl_rsa_setup --datadir<span style="color:#f92672">=</span>/usr/local/mysql/data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chown -R mysql:mysql /usr/local/mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqld --verbose --help  	<span style="color:#75715e"># æŸ¥çœ‹å®Œæ•´åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;[mysqld]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">character_set_server=utf8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">init_connect=&#39;</span>SET NAMES utf8<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basedir=/usr/local/mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">datadir=/usr/local/mysql/data  	# æ•°æ®ç›®å½•æœ€å¥½å¤–æŒ‚
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socket=/tmp/mysql.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å¯binlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-bin = mysql-bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">binlog_format = ROW
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">expire_logs_days = 7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server-id=3306110  	# ç«¯å£åŠ æœ¬æœºIPæœ€åå‡ ä½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ä¸åŒºåˆ†å¤§å°å†™ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lower_case_table_names = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ä¸å¼€å¯sqlä¸¥æ ¼æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sql_mode = &#34;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-error=/usr/local/mysql/data/mysqld.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pid-file=/usr/local/mysql/data/mysqld.pid&#39;</span> &gt; /etc/my.cnf</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ä¿®æ”¹å¯åŠ¨æ–‡ä»¶é…ç½®å‚æ•°å¹¶å¯åŠ¨æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqlconf<span style="color:#f92672">=</span>/etc/init.d/mysqld
</span></span><span style="display:flex;"><span>$ cp /usr/local/mysql/support-files/mysql.server  $mysqlconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;46s,basedir=,basedir=/usr/local/mysql,&#39;</span> $mysqlconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;47s,datadir=,datadir=/usr/local/mysql/data,&#39;</span> $mysqlconf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ service mysqld start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ è½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/mysql/bin/mysql /usr/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>$ netstat -nuplt | grep :3306
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é˜²ç«å¢™å¼€æ”¾ç«¯å£</span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --new-ipset<span style="color:#f92672">=</span>db_whitelist --type<span style="color:#f92672">=</span>hash:ip  
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --add-rich-rule<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rule family=&#39;ipv4&#39; source ipset=&#39;db_whitelist&#39; port port=&#39;16303&#39; protocol=&#39;tcp&#39; accept&#34;</span>  
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<hr>
<h2 id="å®‰è£…mysql-8">å®‰è£…<code>Mysql 8</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…æ‰©å±•ä¸‹è½½<code>Mysql</code>å¹¶è§£å‹å®‰è£…åŒ…<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y remove mariadb* mariadb
</span></span><span style="display:flex;"><span>$ yum -y install ncurses-compat-libs wget git epel-release
</span></span><span style="display:flex;"><span>$ yum -y install  https://mirrors.cloud.tencent.com/percona/release/7/RPMS/noarch/percona-release-0.1-4.noarch.rpm
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/gpgcheck = 1/gpgcheck = 0/g&#34;</span> /etc/yum.repos.d/percona-release.repo
</span></span><span style="display:flex;"><span>$ yum -y install percona-xtrabackup-24 qpress numactl libaio*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mkdir -p /usr/local/mysql <span style="color:#f92672">&amp;&amp;</span> tar -xvf /usr/local/src/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz -C /usr/local/mysql --strip-components <span style="color:#ae81ff">1</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->è®¾ç½®æƒé™<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ groupadd mysql
</span></span><span style="display:flex;"><span>$ useradd -r -g mysql mysql
</span></span><span style="display:flex;"><span>$ cd /usr/local/
</span></span><span style="display:flex;"><span>$ chown -R mysql:mysql ./mysql</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->åˆå§‹åŒ–æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysqld --initialize --user<span style="color:#f92672">=</span>mysql --basedir<span style="color:#f92672">=</span>/usr/local/mysql --datadir<span style="color:#f92672">=</span>/usr/local/mysql/data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysql_ssl_rsa_setup --datadir<span style="color:#f92672">=</span>/usr/local/mysql/data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ /usr/local/mysql/bin/mysqld_safe --datadir<span style="color:#f92672">=</span>/usr/local/mysql/data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chown -R mysql:mysql /usr/local/mysql </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ä¿®æ”¹é…ç½®æ–‡ä»¶<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;[mysqld]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">character_set_server=utf8mb4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">init_connect=&#39;</span>SET NAMES utf8<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basedir=/usr/local/mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">datadir=/usr/local/mysql/data
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socket=/tmp/mysql.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## å¼€å¯binlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-bin = mysql-bin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">binlog_format = ROW
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">expire_logs_days = 7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server-id=3306110  	# ç«¯å£åŠ æœ¬æœºIPæœ€åå‡ ä½
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ä¸åŒºåˆ†å¤§å°å†™ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lower_case_table_names = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## ä¸å¼€å¯sqlä¸¥æ ¼æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">## sql_mode = &#34;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sql_mode=&#39;</span>STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default_authentication_plugin= mysql_native_password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-error=/var/log/mysqld.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pid-file=/usr/local/mysql/data/mysqld.pid&#39;</span> &gt;/etc/my.cnf</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ä¿®æ”¹å¯åŠ¨æ–‡ä»¶é…ç½®å‚æ•°å¹¶å¯åŠ¨æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqlconf<span style="color:#f92672">=</span>/etc/init.d/mysqld
</span></span><span style="display:flex;"><span>$ cp /usr/local/mysql/support-files/mysql.server $mysqlconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;46s,basedir=,basedir=/usr/local/mysql,&#39;</span> $mysqlconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;47s,datadir=,datadir=/usr/local/mysql/data,&#39;</span> $mysqlconf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ service mysqld start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ è½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/mysql/bin/mysql /usr/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>$ netstat -nuplt | grep :3306
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é˜²ç«å¢™å¼€æ”¾ç«¯å£</span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --new-ipset<span style="color:#f92672">=</span>db_whitelist --type<span style="color:#f92672">=</span>hash:ip  
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --add-rich-rule<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rule family=&#39;ipv4&#39; source ipset=&#39;db_whitelist&#39; port port=&#39;16303&#39; protocol=&#39;tcp&#39; accept&#34;</span>  
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<hr>
<h2 id="æ™®é€šç”¨æˆ·éƒ¨ç½²mysql-8">æ™®é€šç”¨æˆ·éƒ¨ç½²<code>Mysql 8</code></h2>
<ul>
<li>
<ol>
<li><!-- raw HTML omitted -->å®‰è£…æ‰©å±•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># Linux8/Red Hat8(EL8)ï¼šè¿™äº›å¹³å°é»˜è®¤ä¸å®‰è£…æ–‡ä»¶/lib64/libtinfo.so.5ï¼ŒMySQLå®¢æˆ·ç«¯bin/mysqléœ€è¦è¯¥æ–‡ä»¶æ¥å®‰è£…</span>
</span></span><span style="display:flex;"><span>$ yum -y install ncurses-compat-libs wget git epel-release
</span></span><span style="display:flex;"><span>$ yum -y install  http://www.percona.com/downloads/percona-release/redhat/0.1-4/percona-release-0.1-4.noarch.rpm  
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#34;s/gpgcheck = 1/gpgcheck = 0/g&#34;</span> /etc/yum.repos.d/percona-release.repo
</span></span><span style="display:flex;"><span>$ yum -y install percona-xtrabackup-24 qpress numactl libaio*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget -P /usr/local/src/ https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="2">
<li><!-- raw HTML omitted -->åˆ›å»ºç”¨æˆ·ä»¥åŠç¨‹åºä½¿ç”¨ç›®å½•<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ groupadd myadmin <span style="color:#f92672">&amp;&amp;</span> useradd -g myadmin myadmin  	<span style="color:#75715e"># åˆ›å»ºç¨‹åºè¿è¡Œç”¨æˆ·  </span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;password&#34;</span>|passwd --stdin myadmin &amp;&gt;/dev/null
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mkdir -p /opt/<span style="color:#f92672">{</span>apps,conf,src,backup,scripts,dataï¼Œlogs<span style="color:#f92672">}</span> /opt/data/<span style="color:#f92672">{</span>data_16303,data_16304<span style="color:#f92672">}</span> /opt/logs/mysql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$echo <span style="color:#e6db74">&#34;#####  Start/Stop Service  #####
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Cmnd_Alias MYADMIN_START_SERVICES = /etc/init.d/mysql, /etc/init.d/mysql.server, /opt/*  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">swadmin ALL=(ALL)NOPASSWD:MYADMIN_START_SERVICES &#34;</span>&gt;/etc/sudoers.d/myadmin  
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">660</span> /etc/sudoers.d/myadmin  </span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="3">
<li><!-- raw HTML omitted -->ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œæ–¹ä¾¿ä½¿ç”¨é…ç½®æ–‡ä»¶åˆå§‹åŒ–æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#39;[mysqld]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">character_set_server=utf8mb4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">init_connect=&#39;</span>SET NAMES utf8<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">basedir=/opt/apps/mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">datadir=/opt/data/data_16303
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">socket=/tmp/mysql.sock
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¸åŒºåˆ†å¤§å°å†™ 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lower_case_table_names = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># ä¸å¼€å¯sqlä¸¥æ ¼æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># sql_mode = &#34;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-error=/opt/logs/mysql/mysqld.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pid-file=/opt/data/data_16303/mysqld.pid&#39;</span> &gt; /opt/conf/mysql/mysql_master_16303.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chown -R myadmin:myadmin /opt/*</span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="4">
<li><!-- raw HTML omitted -->ä½¿ç”¨æ™®é€šç”¨æˆ·ä¸‹è½½å®‰è£…<code>Mysql 8</code><!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ su myadmin -c <span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wget -P /opt/src/ https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">mkdir -p /opt/apps/mysql &amp;&amp; tar xvf /opt/src/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz -C /opt/apps/mysql --strip-components 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">chmod 750 /opt/apps/mysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/mysql/bin/mysqld --defaults-file=/opt/conf/mysql/my.cnf --initialize-insecure --user=myadmin
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/mysql/bin/mysql_ssl_rsa_setup --defaults-file=/opt/conf/mysql/my.cnf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/opt/apps/mysql/bin/mysqld_safe --defaults-file=/opt/conf/mysql/my.cnf --user=myadmin &amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sleep 8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span></span></span></code></pre></div></blockquote>
<ul>
<li>
<ol start="5">
<li><!-- raw HTML omitted -->ä¿®æ”¹å¯åŠ¨æ–‡ä»¶é…ç½®å‚æ•°å¹¶å¯åŠ¨æ•°æ®åº“<!-- raw HTML omitted --></li>
</ol>
</li>
</ul>
<blockquote>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mysqlconf<span style="color:#f92672">=</span>/etc/init.d/mysqld
</span></span><span style="display:flex;"><span>$ cp /opt/apps/mysql/support-files/mysql.serverr $mysqlconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;46s,basedir=,basedir=/opt/apps/mysql,&#39;</span> $mysqlconf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;47s,datadir=,datadir=/opt/data/data_16303,&#39;</span> $mysqlconf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;alias nginx=&#39;sudo /etc/init.d/nginx&#39;  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alias tomcat=&#39;sudo /etc/init.d/tomcat&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alias mysqld=&#39;sudo /etc/init.d/mysqld&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">alias redis=&#39;sudo /etc/init.d/redis&#39; &#34;</span>&gt;&gt;/home/myadmin/.bashrc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span>$ service mysqld start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ è½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span>$ ln -s /usr/local/mysql/bin/mysql /usr/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>$ netstat -nuplt | grep :3306
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é˜²ç«å¢™å¼€æ”¾ç«¯å£</span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --new-ipset<span style="color:#f92672">=</span>db_whitelist --type<span style="color:#f92672">=</span>hash:ip  
</span></span><span style="display:flex;"><span>$ firewall-cmd --permanent --add-rich-rule<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rule family=&#39;ipv4&#39; source ipset=&#39;db_whitelist&#39; port port=&#39;16303&#39; protocol=&#39;tcp&#39; accept&#34;</span>  
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload</span></span></code></pre></div></blockquote>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="../../../js/clipboard.min.js?1719333224" defer></script>
    <script src="../../../js/perfect-scrollbar.min.js?1719333224" defer></script>
    <script src="../../../js/theme.js?1719333224" defer></script>
  </body>
</html>
