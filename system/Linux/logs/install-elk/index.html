<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.125.4"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="Install ELK"><meta itemprop=description content="Install-ELK"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://erge.blog/imgs/s2-1.jpg"><meta itemprop=keywords content="Logs,Elasticsearch,Logstash,Kibana"><meta property="og:type" content="article"><meta property="og:title" content="Install ELK"><meta property="og:description" content="Install-ELK"><meta property="og:image" content="/imgs/s2-1.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://erge.blog/system/linux/logs/install-elk/"><meta property="og:site_name" content="二哥"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="二哥"><meta property="article:published_time" content="2022-07-29 14:56:10 +0800 CST"><meta property="article:modified_time" content="2022-11-15 14:56:10 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.0d420b6f564e6674edd4354ea71c0458a83f95ad464a75114b23d72515b1456c.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"install-elk","permalink":"https://erge.blog/system/linux/logs/install-elk/","title":"Install ELK","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>Install ELK - 二哥</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>二哥</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Linux、Kubernetes、Docker、Python、CI/CD、Jenkins、Mysql、Nginx、Gitlab、Ansible、Zabbix</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-Home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-th hvr-icon"></i>分类</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>0</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-tools"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-tools hvr-icon"></i>工具</a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>站点示例</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-Commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#部署elasticsearch弹性搜索数据存储服务>部署<code>Elasticsearch</code>弹性搜索、数据存储服务</a><ul><li><a href=#安装elasticsearch-head插件>安装<code>elasticsearch-head</code>插件</a></li></ul></li><li><a href=#部署logstash日志收集服务>部署<code>Logstash</code>日志收集服务</a></li><li><a href=#部署beats日志收集服务>部署<code>Beats</code>日志收集服务</a></li><li><a href=#filebeat轻量型日志采集器><code>Filebeat</code>轻量型日志采集器</a></li><li><a href=#部署kibana图形化展示官方文档>部署<code>Kibana</code>图形化展示官方文档</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=二哥 src=/imgs/img-lazy-loading.gif data-src=/imgs/s2-1.jpg><p class=site-author-name itemprop=name>二哥</p><div class=site-description itemprop=description>The man who has made up his mind to win will never say impossible – Napoleon Bonaparte</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>0</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>51</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>149</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=qq%e5%8f%b7 title="QQ → qq号" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-qq fa-fw hvr-icon"></i>
QQ
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/lisenhui title="知乎 → https://www.zhihu.com/people/lisenhui" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=qq@qq.com title="E-Mail → qq@qq.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://weibo.com/yourname title="Weibo → https://weibo.com/yourname" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-weibo fa-fw hvr-icon"></i>
Weibo
</a></span><span class=links-of-social-item><a href="https://www.youtube.com/watch?v=RgKAFK5djSk" title="Youtube → https://www.youtube.com/watch?v=RgKAFK5djSk" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
Youtube
</a></span><span class=links-of-social-item><a href=https://github.com/elkan1788 title="Github → https://github.com/elkan1788" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/hugo-next rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://erge.blog/system/linux/logs/install-elk/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/s2-1.jpg"><meta itemprop=name content="二哥"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="二哥"><meta itemprop=description content="The man who has made up his mind to win will never say impossible – Napoleon Bonaparte"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Install ELK"><meta itemprop=description content="Install-ELK"></span><header class=post-header><h1 class=post-title itemprop="name headline">Install ELK
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/System/Linux/Logs/Install-ELK.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2022-07-29 14:56:10 +0800 CST" itemprop="dateCreated datePublished" datetime="2022-07-29 14:56:10 +0800 CST">2022-07-29
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title=修改时间：2022-11-15T14:56:10+08:00 itemprop=dateModified datetime=2022-11-15T14:56:10+08:00>2022-11-15</time>
</span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/logs itemprop=url rel=index><span itemprop=name>Logs</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>4048</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>9分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/system/linux/logs/install-elk/><i class="fa fa-sync fa-spin"></i>
</span></span><span class=post-meta-item title><span class=post-meta-item-icon><i class="far fa-comments"></i>
</span><span class=post-meta-item-text title=评论>评论：
</span><span id=comments-count class=waline-comment-count data-path=/system/linux/logs/install-elk/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=部署elasticsearch弹性搜索数据存储服务>部署<code>Elasticsearch</code>弹性搜索、数据存储服务
<a class=header-anchor href=#%e9%83%a8%e7%bd%b2elasticsearch%e5%bc%b9%e6%80%a7%e6%90%9c%e7%b4%a2%e6%95%b0%e6%8d%ae%e5%ad%98%e5%82%a8%e6%9c%8d%e5%8a%a1></a></h2><div class="note info"><ul><li><ol><li><code>Elasticsearch</code><font color=red>简介</font>
<a href=https://www.elastic.co/guide/index.html title=官方文档 rel="noopener external nofollow noreferrer" target=_blank class=exturl>官方文档
<i class="fa fa-external-link-alt"></i></a></li></ol></li></ul><blockquote><ul><li>1.1
<a href=https://blog.csdn.net/u012332735/article/details/54946355 title="<code>Elasticsearch</code>常用插件集合" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Elasticsearch</code>常用插件集合
<i class="fa fa-external-link-alt"></i></a></li></ul><p>是一个基于<code>Lucene</code>的开源分布式搜索服务器。
特点：分布式，零配置，自动发现，索引自动分片，索引副本机制，<code>restful</code>风格接口，多数据源， 自动搜索负载等。
它提供了一个分布式多用户能力的全文搜索引擎，基于<code>RESTful web</code>接口。
<code>Elasticsearch</code>是用<code>Java</code>开发的，并作为<code>Apache</code>许可条款下的开放源码发布，是第二流行的企业搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。
在<code>elasticsearch</code>中，所有节点的数据是均等的。</p><ul><li>1.2
<a href=https://www.cnblogs.com/hahaha111122222/p/13139809.html title="<code>ELK</code>基于<code>ElastAlert</code>实现日志的微信报警" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>ELK</code>基于<code>ElastAlert</code>实现日志的微信报警
<i class="fa fa-external-link-alt"></i></a></li></ul></blockquote><ul><li><ol start=2><li><a href=https://www.elastic.co/cn/downloads/elasticsearch title="下载<code>elasticsearch-8.1</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl>下载<code>elasticsearch-8.1</code>
<i class="fa fa-external-link-alt"></i></a></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.1.3-linux-x86_64.tar.gz
</span></span><span style=display:flex><span>$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.1.3-linux-x86_64.tar.gz.sha512
</span></span><span style=display:flex><span>$ sha512sum -c elasticsearch-8.1.3-linux-x86_64.tar.gz.sha512
</span></span><span style=display:flex><span>$ tar -xzf elasticsearch-8.1.3-linux-x86_64.tar.gz
</span></span><span style=display:flex><span>$ cd elasticsearch-8.1.3/ 
</span></span></code></pre></div></blockquote><ul><li><ol start=3><li><font color=red>修改</font><code>Elasticsearch</code><font color=red>配置文件</font></li></ol></li></ul><blockquote><ul><li>3.1 <font color=red>修改</font><code>Elasticsearch</code><font color=red>主配置文件</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd /opt/elasticsearch/config
</span></span><span style=display:flex><span>$ cp elasticsearch.yml<span style=color:#f92672>{</span>,.bak<span style=color:#f92672>}</span>  	<span style=color:#75715e># 提前给配置文件做个备份</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 17行、组名(同一个组，组名必须一致)</span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#34;/cluster.name:/a\\cluster.name: cluster-1&#34;</span> elasticsearch.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 23行、节点名称，建议和主机名一致</span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#34;/node.name:/a\\node.name: server-1&#34;</span> elasticsearch.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 33行、数据存放的路径</span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#34;/path.data:/a\\path.data: /opt/elasticsearch/data&#34;</span> elasticsearch.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 37行、日志存放的路径</span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#34;/path.logs:/a\\path.logs: /opt/elasticsearch/logs&#34;</span> elasticsearch.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 43行、 锁住内存，不被使用到交换分区去(通常在内部不足时，休眠的程序内存信息会交换到交换分区)</span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#34;/bootstrap.memory_lock:/a\\bootstrap.memory_lock: false&#34;</span> elasticsearch.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 56行、网络设置，建议填写本机IP或者0.0.0.0</span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#34;/network.host:/a\\network.host: 0.0.0.0&#34;</span> elasticsearch.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 61行、开启端口</span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#34;/http.port:/a\\http.port: 9200&#34;</span> elasticsearch.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 74行、和节点名称一致</span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#34;/cluster.initial_master_nodes:/a\\cluster.initial_master_nodes: [&#34;</span>server_1<span style=color:#e6db74>&#34;]&#34;</span> elasticsearch.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;http.cors.enabled: true  	# 支持跨域
</span></span></span><span style=display:flex><span><span style=color:#e6db74>xpack.security.enabled: true  	# 启用安全性检查
</span></span></span><span style=display:flex><span><span style=color:#e6db74>xpack.security.transport.ssl.enabled: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74># discovery.zen.ping.multicast.enabled: false  	# 集群模式，从节点关闭多播
</span></span></span><span style=display:flex><span><span style=color:#e6db74># discovery.zen.ping.unicast.hosts: [&#34;</span>10.18.41.31<span style=color:#e6db74>&#34;,&#34;</span>10.18.41.137<span style=color:#e6db74>&#34;  	# 集群模式，从节点配置主服务器和自己的地址
</span></span></span><span style=display:flex><span><span style=color:#e6db74>http.cors.allow-origin: &#34;</span>*<span style=color:#e6db74>&#34;  	# 范围  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 手动创建系统索引
</span></span></span><span style=display:flex><span><span style=color:#e6db74>action.auto_create_index: .monitoring*,.watches,.triggered_watches,.watcher-history*,.ml* &#34;</span> &gt;&gt;elasticsearch.yml
</span></span></code></pre></div><ul><li>3.2 <font color=red>修改</font><code>Elasticsearch</code><font color=red>资源限制配置文件</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 调整jvm.options文件的32、和33行</span>
</span></span><span style=display:flex><span>$ cd /opt/elasticsearch/config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#34;/## -Xms4g/a\\-Xms512m&#34;</span> jvm.options
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#34;/## -Xmx4g/a\\-Xmx512m&#34;</span> jvm.options
</span></span></code></pre></div></blockquote><ul><li><ol start=4><li><font color=red>启动服务并开启<mark>防火墙：9200</mark>端口</font></li></ol></li></ul><blockquote><ul><li>4.1 <font color=red>配置</font><code>Ulimit</code><font color=red>调整进程的最大文件描述符</font></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ ulimit -n <span style=color:#ae81ff>65535</span>
</span></span><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;* soft nofile 65536
</span></span></span><span style=display:flex><span><span style=color:#e6db74>* hard nofile 65536
</span></span></span><span style=display:flex><span><span style=color:#e6db74>* soft nproc 32000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>* hard nproc 32000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>* hard memlock unlimited
</span></span></span><span style=display:flex><span><span style=color:#e6db74>* soft memlock unlimited &#34;</span>&gt;&gt;/etc/security/limits.conf
</span></span></code></pre></div></blockquote><ul><li>4.2 <font color=red>配置</font><code>vm.max_map_count</code><font color=red>最大虚拟内存区域</font></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;vm.max_map_count=655360&#34;</span> &gt;&gt;/etc/sysctl.conf
</span></span></code></pre></div></blockquote><ul><li>4.3 <font color=red>修改权限启动服务开放防火墙</font></li></ul><blockquote><ul><li>4.3.1 <font color=red><strong>9200端口</strong>：</font>用于所有通过<code>HTTP</code>协议进行的<code>API</code>调用。包括搜索、聚合、监控、以及其他任何使用<code>HTTP</code>协议的请求。所有的客户端库都会使用该端口与<code>ElasticSearch</code>进行交互。</li><li>4.3.2 <font color=red><strong>9300端口</strong>：</font>是一个自定义的二进制协议，用于集群中各节点之间的通信。用于诸如集群变更、主节点选举、节点加入/离开、分片分配等事项。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ chown -R user:user /opt/elasticsearch  	<span style=color:#75715e># 普通用户启动</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cd /opt/elasticsearch/
</span></span><span style=display:flex><span>$ ./bin/elasticsearch-setup-passwords interactive  	<span style=color:#75715e># 设置密码，修改密码也是一样。</span>
</span></span><span style=display:flex><span>$ ./bin/elasticsearch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 此命令来判断是init启动还是systemctl启动</span>
</span></span><span style=display:flex><span>$ ps -p <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 当systemd启用了日志记录，日志信息使用可用journalctl的命令</span>
</span></span><span style=display:flex><span>$ journalctl - f
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 列出elasticsearch服务的日记帐分录</span>
</span></span><span style=display:flex><span>$ journalctl - unit elasticsearch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 要从给定时间开始列出elasticsearch服务的日记帐分录：</span>
</span></span><span style=display:flex><span>$ journalctl --unit elasticsearch --since  <span style=color:#e6db74>&#34;2016-10-30 18:17:16&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 检查Elasticsearch</span>
</span></span><span style=display:flex><span>$  curl -i -XGET http://127.0.0.1:9200
</span></span></code></pre></div></blockquote></blockquote></div><h3 id=安装elasticsearch-head插件>安装<code>elasticsearch-head</code>插件
<a class=header-anchor href=#%e5%ae%89%e8%a3%85elasticsearch-head%e6%8f%92%e4%bb%b6></a></h3><div class="note info"><ul><li><ol><li><font color=red>下载启动</font><code>elasticsearch-head</code><mark>防火墙开放：9100</mark><font color=red>端口</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd /opt/
</span></span><span style=display:flex><span>$ git clone git://github.com/mobz/elasticsearch-head.git
</span></span><span style=display:flex><span>$ cd elasticsearch-head
</span></span><span style=display:flex><span>$ npm install
</span></span><span style=display:flex><span>$ npm run start
</span></span><span style=display:flex><span><span style=color:#75715e>#  grunt server  	# 或者使用  grunt 启动</span>
</span></span><span style=display:flex><span>$ curl http://localhost:9100/  	<span style=color:#75715e># 登录浏览器输入地址访问</span>
</span></span></code></pre></div></blockquote></div><h2 id=部署logstash日志收集服务>部署<code>Logstash</code>日志收集服务
<a class=header-anchor href=#%e9%83%a8%e7%bd%b2logstash%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e6%9c%8d%e5%8a%a1></a></h2><div class="note info"><ul><li><ol><li><code>Logstash</code><font color=red>简介</font>、
<a href=https://www.elastic.co/guide/en/logstash/master/index.html title=官方文档 rel="noopener external nofollow noreferrer" target=_blank class=exturl>官方文档
<i class="fa fa-external-link-alt"></i></a></li></ol></li></ul><blockquote><p>是一个完全开源工具，可以对你的日志进行收集、过滤、分析，并将其存储供以后使用（如，搜索），<code>logstash</code>带有一个<code>web</code>界面，搜索和展示所有日志。</p><ul><li>1.1 <code>input{}</code>：<code>logstash</code><font color=red>从日志文件中调用函数输入</font></li><li>1.2 <code>output{}</code>：<code>logstash</code><font color=red>从日志文件中调用函数输出</font></li><li>1.2 <code>stdin{}</code>：<code>logstash</code><font color=red>从标准输入中收集日志</font></li><li>1.3 <code>stdout{} </code>：<code>logstash</code><font color=red>从标准输出日志</font></li><li>1.4 <code>syslog</code>：<code>logstash</code><font color=red>从系统日志程序中收集日志</font></li><li>1.5 <code>tcp</code>：<code>logstash</code><font color=red>从</font><code>TCP</code><font color=red>程序端口中收集日志</font></li><li>1.6 <code>udp</code>：<code>logstash</code><font color=red>从</font><code>UDP</code><font color=red>程序端口中收集日志</font></li><li>1.7 <code>rubuydebug</code>：<font color=red>通过</font><code>rubuy</code><font color=red>库进行收集</font></li><li>1.8 <code>multiline</code>：<font color=red>多行模块</font></li></ul></blockquote><ul><li><ol start=2><li><a href=https://www.elastic.co/cn/downloads/logstash title="下载、解压<code>Logstash</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl>下载、解压<code>Logstash</code>
<i class="fa fa-external-link-alt"></i></a></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ wget https://artifacts.elastic.co/downloads/logstash/logstash-8.3.3-linux-x86_64.tar.gz
</span></span><span style=display:flex><span>$ tar zxvf logstash-8.3.3-linux-x86_64.tar.gz
</span></span></code></pre></div></blockquote><ul><li><ol start=3><li><font color=red>配置</font><code>Logstash</code><font color=red>的</font><code>conf</code><font color=red>文件收集</font><code>Nginx</code><font color=red>日志</font></li></ol></li></ul><blockquote><table><thead><tr><th>名称地址</th><th>描述</th></tr></thead><tbody><tr><td><a href=https://www.elastic.co/guide/en/logstash/current/configuration.html title=参考官网标准输入输出 rel="noopener external nofollow noreferrer" target=_blank class=exturl>参考官网标准输入输出
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://www.elastic.co/guide/en/logstash/current/configuration-file-structure.html title=参考官网函数输入输出 rel="noopener external nofollow noreferrer" target=_blank class=exturl>参考官网函数输入输出
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html title=参考官网收集系统日志 rel="noopener external nofollow noreferrer" target=_blank class=exturl>参考官网收集系统日志
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://www.elastic.co/guide/en/logstash/current/event-dependent-configuration.html title="参考官网收集<code>Java</code>日志" rel="noopener external nofollow noreferrer" target=_blank class=exturl>参考官网收集<code>Java</code>日志
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://www.elastic.co/guide/en/logstash/current/plugins-codecs-multiline.html title="参考官网使用<code>multiline</code>多行模式" rel="noopener external nofollow noreferrer" target=_blank class=exturl>参考官网使用<code>multiline</code>多行模式
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;Settings: Default filter workers: 4
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Logstash startup completed
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>input {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>file {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>type =&gt; &#34;</span>nginx-error-log<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>path =&gt; &#34;</span>/usr/local/nginx/logs/*error*.log<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>start_position =&gt; &#34;</span>beginning<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}file {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>type =&gt; &#34;</span>nginx-access-log<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>path =&gt; &#34;</span>/usr/local/nginx/logs/*access*.log<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>start_position =&gt; &#34;</span>beginning<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>codec =&gt; json
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>output {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>if [type] =~ &#34;</span>nginx-error-log<span style=color:#e6db74>&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>elasticsearch {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>hosts =&gt; [&#34;</span>elasticsearch服务所在IP:9200<span style=color:#e6db74>&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>index =&gt; &#34;</span>mayi-nginx-error--%<span style=color:#f92672>{</span>+YYYY.MM.dd<span style=color:#f92672>}</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}else if [type] =~ &#34;</span>nginx-access-log<span style=color:#e6db74>&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>elasticsearch {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>hosts =&gt; [&#34;</span>elasticsearch服务所在IP:9200<span style=color:#e6db74>&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>index =&gt; &#34;</span>mayi-nginx-access-%<span style=color:#f92672>{</span>+YYYY.MM.dd<span style=color:#f92672>}</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>} &#34;</span> &gt;&gt;/opt/elk/logstash/data/nginx-log.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#######  </span>
</span></span><span style=display:flex><span>$ cat &gt;logstash.yml<span style=color:#e6db74>&lt;&lt;-EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>input {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    redis {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        host =&gt; &#34;Redis 服务所在IP&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        port =&gt; &#34;6379&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        password =&gt; &#34;password&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        data_type =&gt; &#34;list&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        key =&gt; &#34;filebeat&#34; #从redis中导入的key，与filebeat输出对应
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        type =&gt; &#34;redis-input&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        db =&gt; 0 #导入key的数据库，默认为0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>filter {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # 判断redis字符串在不在自己定义的新字段中，用于区分日志类型，做对应的处理
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    if &#39;redis&#39; in [app] {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # 聚合redis日志
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        grok {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		   # 自定义匹配日志内容，默认一条日志从上到下只会匹配一次对的。且只会匹配一个字段，如需要匹配多个字段，需进行严格匹配
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		   patterns_dir =&gt; [&#34;/opt/elk/patterns_time&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		   # grok提供很多自带的正则，可供使用
</span></span></span><span style=display:flex><span><span style=color:#e6db74>           match =&gt; { &#34;message&#34; =&gt; &#34;%{LOGTIME</span>:log_time<span style=color:#f92672>}</span><span style=color:#e6db74>&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		   # （?&lt;自定义的&gt;要匹配的内容）
</span></span></span><span style=display:flex><span><span style=color:#e6db74>           match =&gt; { &#34;</span>message<span style=color:#e6db74>&#34; =&gt; &#34;</span><span style=color:#f92672>(</span>?&lt;log_time&gt;%<span style=color:#f92672>{</span>TIMESTAMP_ISO8601<span style=color:#f92672>})</span>.*session <span style=color:#f92672>(</span>?&lt;session&gt;.*<span style=color:#ae81ff>\S</span>$<span style=color:#f92672>)</span><span style=color:#e6db74>&#34;}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        date {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		    # 修改采集时间为日志里的时间
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            match =&gt; [&#34;</span>log_time<span style=color:#e6db74>&#34;, &#34;</span>yyyy-MM-dd HH:mm<span style=color:#e6db74>&#34;,&#34;</span>dd MMM yyyy HH:mm:ss.SSS<span style=color:#e6db74>&#34; ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            locale =&gt; &#34;</span>en<span style=color:#e6db74>&#34;}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ruby {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            code =&gt; &#34;</span>event.set<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;timestamp&#39;</span>, event.get<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;@timestamp&#39;</span><span style=color:#f92672>)</span>.time.localtime - 8*60*60<span style=color:#f92672>)</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ruby {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            code =&gt; &#34;</span>event.set<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;@timestamp&#39;</span>,event.get<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;timestamp&#39;</span><span style=color:#f92672>))</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        mutate {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		      # 转换字段类型，用于聚合操作
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              convert =&gt; { &#34;</span>session<span style=color:#e6db74>&#34; =&gt; &#34;</span>string<span style=color:#e6db74>&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>			  # 删除无用字段
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              remove_field =&gt; [&#34;</span>log_time<span style=color:#e6db74>&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	 # 将logstash时间转化中国时间,logstash默认为utc时间，比中国时间慢8个小时（修改的是采集时间，对日志时间没有影响）
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     ruby {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        code =&gt; &#34;</span>event.set<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;timestamp&#39;</span>, event.get<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;@timestamp&#39;</span><span style=color:#f92672>)</span>.time.localtime + 8*60*60<span style=color:#f92672>)</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     ruby {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        code =&gt; &#34;</span>event.set<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;@timestamp&#39;</span>,event.get<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;timestamp&#39;</span><span style=color:#f92672>))</span><span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     mutate {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        remove_field =&gt; [&#34;</span>timestamp<span style=color:#e6db74>&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>output {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # 用于调试
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # stdout{ codec =&gt; rubydebug }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    #####  创建线上环境索引  ######
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   if &#39;online_82&#39; in [app] {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        elasticsearch {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          action =&gt; &#34;</span>index<span style=color:#e6db74>&#34; #The operation on ES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          hosts =&gt; &#34;</span>127.0.0.1:9200<span style=color:#e6db74>&#34; # ElasticSearch host, can be array.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		  # 输出到es中的索引
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          index =&gt; &#34;</span>online_82_%<span style=color:#f92672>{</span>+YYYY.MM.dd<span style=color:#f92672>}</span><span style=color:#e6db74>&#34; #The index to write data to.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          user =&gt; &#34;</span>elastic<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          password =&gt; &#34;</span>dtyn!@<span style=color:#e6db74>$&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		 # 对应filebeat中[tags],用对应索引进行判断
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      if [tags][0] == &#39;count&#39; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        elasticsearch {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          action =&gt; &#34;</span>index<span style=color:#e6db74>&#34; #The operation on ES
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          hosts =&gt; &#34;</span>127.0.0.1:9200<span style=color:#e6db74>&#34; #ElasticSearch host, can be array.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          index =&gt; &#34;</span>online_82_redis_count<span style=color:#e6db74>&#34; #The index to write data to.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          user =&gt; &#34;</span>elastic<span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          password =&gt; &#34;</span>dtyn!@$<span style=color:#e6db74>&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span></code></pre></div></blockquote><ul><li><ol start=4><li><font color=red>检查配置、启动服务</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 添加&#34;--configtest&#34;或者&#34;-t&#34;参数检查配置语法是否有误</span>
</span></span><span style=display:flex><span>$ /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/nginx.conf --config.test_and_exit
</span></span><span style=display:flex><span><span style=color:#75715e># 启动程序后台运行&#34;&amp;&#34;</span>
</span></span><span style=display:flex><span>$ nohup /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/nginx.conf &amp;
</span></span><span style=display:flex><span><span style=color:#75715e># &#34;screen&#34; 启动另一个终端 </span>
</span></span><span style=display:flex><span>$ /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/nginx.conf
</span></span><span style=display:flex><span>$ screen -ls
</span></span><span style=display:flex><span>$ screen -r <span style=color:#ae81ff>16582</span>
</span></span></code></pre></div></blockquote></div><h2 id=部署beats日志收集服务>部署<code>Beats</code>日志收集服务
<a class=header-anchor href=#%e9%83%a8%e7%bd%b2beats%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e6%9c%8d%e5%8a%a1></a></h2><blockquote><table><thead><tr><th>名称地址</th><th>描述</th></tr></thead><tbody><tr><td><a href=https://www.elastic.co/guide/en/beats/libbeat/current/index.html title=官方文档 rel="noopener external nofollow noreferrer" target=_blank class=exturl>官方文档
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td><a href=https://www.elastic.co/cn/downloads/beats/ title="选择一个<code>Beat</code>任何<code>Beat</code>皆可" rel="noopener external nofollow noreferrer" target=_blank class=exturl>选择一个<code>Beat</code>任何<code>Beat</code>皆可
<i class="fa fa-external-link-alt"></i></a></td><td></td></tr><tr><td></td><td></td></tr></tbody></table></blockquote><h2 id=filebeat轻量型日志采集器><code>Filebeat</code>轻量型日志采集器
<a class=header-anchor href=#filebeat%e8%bd%bb%e9%87%8f%e5%9e%8b%e6%97%a5%e5%bf%97%e9%87%87%e9%9b%86%e5%99%a8></a></h2><div class="note info"><ul><li><ol><li><a href=https://www.elastic.co/cn/downloads/beats/filebeat title="下载安装<code>Filebeat</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl>下载安装<code>Filebeat</code>
<i class="fa fa-external-link-alt"></i>
</a>、
<a href=https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation-configuration.html title="<code>Filebeat</code>安装配置编辑" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Filebeat</code>安装配置编辑
<i class="fa fa-external-link-alt"></i></a></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.3.3-linux-x86_64.tar.gz
</span></span><span style=display:flex><span>$ tar xzvf filebeat-8.3.3-linux-x86_64.tar.gz
</span></span></code></pre></div></blockquote><ul><li><ol start=2><li><font color=red>配置</font><code>Filebeat</code></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># elasticsearch</span>
</span></span><span style=display:flex><span>output.elasticsearch:
</span></span><span style=display:flex><span>hosts: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;https://myEShost:9200&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>username: <span style=color:#e6db74>&#34;filebeat_internal&#34;</span>
</span></span><span style=display:flex><span>password: <span style=color:#e6db74>&#34;YOUR_PASSWORD&#34;</span> 
</span></span><span style=display:flex><span>ssl:
</span></span><span style=display:flex><span>enabled: true
</span></span><span style=display:flex><span>ca_trusted_fingerprint: <span style=color:#e6db74>&#34;b9a10bbe64ee9826abeda6546fc988c8bf798b41957c33d05db736716513dc9c&#34;</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># kibana</span>
</span></span><span style=display:flex><span>setup.kibana:
</span></span><span style=display:flex><span>host: <span style=color:#e6db74>&#34;mykibanahost:5601&#34;</span> 
</span></span><span style=display:flex><span>username: <span style=color:#e6db74>&#34;my_kibana_user&#34;</span>  
</span></span><span style=display:flex><span>password: <span style=color:#e6db74>&#34;{pwd}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cat &gt;filebeat.yml<span style=color:#e6db74>&lt;&lt;-EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>filebeat.inputs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- type: log
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  enabled: True # True表示收集
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # pasths配置收集日志的路径，支持配置多条路径，及多目录
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  paths:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - /opt/app/nacos-1.3.2/nacos/bin/logs/*.log
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # tags 标记;可以用来区分日志,这是一个列表可以写多个标记
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  tags: [&#34;nacos&#34;] 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # fileds创建新的字段，默认是二级字段，可以自定义多个key: value
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  fields:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    app: test_71_nacos-1.3.2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # 让新建的字段变成顶级字段，减少不必要的资源开销
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  fields_under_root: true 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # 让filebeat采集最新的日志变化，忽略掉之前旧日志
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  tail_files: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # 下边这几项可以不用
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # filebeat依靠文件描述符识别文件，当发生重命名或移动，filebeat依然采集的原文件。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  close_renamed: false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # 等待再次检查文件的时间，默认是10s
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  max_backoff: 1s
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # 此选项指定等待时间的增加速度,1表示禁用回算算法
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  backoff_factor: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74># ====== Outputs ======
</span></span></span><span style=display:flex><span><span style=color:#e6db74># --------- reids output ------------
</span></span></span><span style=display:flex><span><span style=color:#e6db74>output.redis:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  hosts: [&#34;Redis服务所在IP:6379&#34;] # 输出到redis的ip端口号
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  password: &#34;password&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  key: &#34;filebeat&#34; # 输出到redis中的key，这个key是一个列表，llen key查看长度  lrange key 0 -1 查看列表所有的值
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  timeout: 30 # 连接redis超时时间，默认为5s
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>output.elasticsearch:
</span></span></span><span style=display:flex><span><span style=color:#e6db74> hosts: [&#34;&lt;节点01的IP&gt;:9200&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74> template.name: &#34;filebeat&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74> template.path: &#34;filebeat.template.json&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74> template.overwrite: false
</span></span></span><span style=display:flex><span><span style=color:#e6db74> username: &#34;elastic&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74> password: &#34;changeme&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 拓展
</span></span></span><span style=display:flex><span><span style=color:#e6db74>filbeat也可以采集jar堆栈日志
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 堆栈日志的格式：多行日志内容为一条日志
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- type: log
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  enabled: True
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  paths:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - /opt/app/nacos-1.3.2/nacos/bin/logs/*.log
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  multiline:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # 自定义每条日志的开头
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    pattern: &#39;\# Time: \d{4}-\d{2}-\d{2}&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	# 定义模式是否被否定,默认值为false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	negate: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	# 与模式不匹配的连续行将追加到匹配的上一行
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	match: after
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cat &gt;filebeat.yml<span style=color:#e6db74>&lt;&lt;-EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>filebeat.config.inputs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  enabled: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  path: /etc/filebeat/input.d/*.yml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  reload.enabled: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  reload.period: 10s
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>filebeat.config.modules:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  path: ${path.config}/modules.d/*.yml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  reload.enabled: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>setup.template.settings:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  index.number_of_shards: 3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>processors:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - drop_fields:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      fields: [&#34;agent.ephemeral_id&#34;, &#34;agent.hostname&#34;, &#34;agent.id&#34;, &#34;agent.name&#34;, &#34;agent.type&#34;, &#34;agent.version&#34;, &#34;headers&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - rename:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      fields:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - from: &#34;url&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          to: &#34;url_host&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ignore_missing: false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      fail_on_error: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>output.elasticsearch:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  hosts: [&#34;&#34;&lt;节点01的IP&gt;:9200&#34;&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  api_key: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  index: &#34;nginx-%{[fields.application]}-%{+yyyy.MM.dd}&#34;  # fields.application参数修改
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  indices:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    when.equals:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      fields.application: [&#39;app-docker-nginx_access&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>setup.ilm.enabled: false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 自定义模板格式
</span></span></span><span style=display:flex><span><span style=color:#e6db74>setup.template.name: &#34;nginx&#34;  	# 模板名称
</span></span></span><span style=display:flex><span><span style=color:#e6db74>setup.template.pattern: &#34;nginx-*&#34;  	# 匹配模板类型
</span></span></span><span style=display:flex><span><span style=color:#e6db74>setup.template.enabled: false  	# false：不使用默认模板，true：使用默认模板
</span></span></span><span style=display:flex><span><span style=color:#e6db74>setup.template.overwrite: true  	# 是否覆盖原来模板
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cat &gt;/etc/filebeat/input.d/app-docker-nginx_access.yml<span style=color:#e6db74>&lt;&lt;-EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>filebeat.inputs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>- type: log
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  enabled: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  paths:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - /usr/local/nginx/logs/gitlab.log
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  fields:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    application: app-docker-nginx_access
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # 开启 json日志格式
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  json.keys_under_root: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  json.overwrite_keys: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  json.message_key: message
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  json.add_error_key: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 输出位置
</span></span></span><span style=display:flex><span><span style=color:#e6db74>output.elasticsearch:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  hosts: [&#34;192.168.1.1:9200&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div></blockquote><ul><li><ol start=3><li><font color=red>列出以及使用模块</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ ./filebeat modules list
</span></span><span style=display:flex><span>$ ./filebeat modules enable nginx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- module: nginx
</span></span><span style=display:flex><span>  access:
</span></span><span style=display:flex><span>    enabled: true
</span></span><span style=display:flex><span>    var.paths: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;/var/log/nginx/access.log*&#34;</span><span style=color:#f92672>]</span> 
</span></span></code></pre></div></blockquote><ul><li><ol start=4><li><font color=red>检测启动</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ ./filebeat setup -e
</span></span><span style=display:flex><span>$ chown root filebeat.yml 
</span></span><span style=display:flex><span>$ chown root modules.d/nginx.yml 
</span></span><span style=display:flex><span>$ ./filebeat -e
</span></span></code></pre></div></blockquote></div><h2 id=部署kibana图形化展示官方文档>部署<code>Kibana</code>图形化展示官方文档
<a class=header-anchor href=#%e9%83%a8%e7%bd%b2kibana%e5%9b%be%e5%bd%a2%e5%8c%96%e5%b1%95%e7%a4%ba%e5%ae%98%e6%96%b9%e6%96%87%e6%a1%a3></a></h2><div class="note info"><ul><li><ol><li><code>Kibana</code><font color=red>简介</font>、
<a href=https://www.elastic.co/guide/en/kibana/current/index.html title="部署<code>Kibana</code>图形化展示官方文档" rel="noopener external nofollow noreferrer" target=_blank class=exturl>部署<code>Kibana</code>图形化展示官方文档
<i class="fa fa-external-link-alt"></i></a></li></ol></li></ul><blockquote><p>是一个基于浏览器页面的<code>Elasticsearch</code>前端展示工具，也是一个开源和免费的工具，
<code>Kibana</code>可以为<code>Logstash</code>和<code>ElasticSearch</code>提供的日志分析友好的<code>Web</code>界面，可以帮你汇总、分析和搜索重要数据日志</p></blockquote><ul><li><ol start=2><li><a href=https://elastic.co/cn/downloads/kibana title="下载、解压<code>Kibana</code>图形化展示工具" rel="noopener external nofollow noreferrer" target=_blank class=exturl>下载、解压<code>Kibana</code>图形化展示工具
<i class="fa fa-external-link-alt"></i></a></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ curl -O https://artifacts.elastic.co/downloads/kibana/kibana-8.3.3-linux-x86_64.tar.gz
</span></span><span style=display:flex><span>$ curl https://artifacts.elastic.co/downloads/kibana/kibana-8.3.3-linux-x86_64.tar.gz.sha512 | sha512sum -c - 
</span></span><span style=display:flex><span>$ tar -zxvf kibana-8.3.3-linux-x86_64.tar.gz
</span></span><span style=display:flex><span>$ cd kibana-8.3.3/ 
</span></span></code></pre></div></blockquote><ul><li><ol start=3><li><font color=red>修改配置文件</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd /usr/local/src/kibana-8.3.3/config
</span></span><span style=display:flex><span>$ cp kibana.yml<span style=color:#f92672>{</span>,.bak<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 6行左右、去掉注释</span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#34;/server.port:/a\\server.port: 5601&#34;</span> kibana.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 11行左右、去掉注释，修改为本机IP</span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#39;/server.host:/a\\server.host: &#34;Kibana服务所在IP&#34;&#39;</span> kibana.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 43行左右、去掉注释，修改为elssticsearch的IP地址和端口</span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#39;/elasticsearch.host:/a\\elasticsearch.host: [&#34;http://elssticsearch服务所在IP:9200&#34;]&#39;</span> kibana.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 49行左右、设置访问用户名密码</span>
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#39;/#elasticsearch.username:/a\\elasticsearch.username: &#34;username&#34;&#39;</span> kibana.yml
</span></span><span style=display:flex><span>$ sed -i <span style=color:#e6db74>&#39;/#elasticsearch.password:/a\\elasticsearch.password: &#34;password&#34;&#39;</span> kibana.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># sed -i &#39;/kibana.index:/a\\kibana.index: &#34;.kibana&#34;&#39; kibana.yml  	# 新版不存在此参数</span>
</span></span></code></pre></div></blockquote><ul><li><ol start=4><li><font color=red>启动服务、处理不能删除索引问题</font></li></ol></li></ul><blockquote><ul><li>4.1 <mark>防火墙开放：5601</mark><font color=red>端口</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 检测启动方式  </span>
</span></span><span style=display:flex><span>$ ps -p <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ ./bin/kibana
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 命令行执行</span>
</span></span><span style=display:flex><span>$ curl -XPUT -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> http://localhost:9200/_all/_settings -d <span style=color:#e6db74>&#39;{&#34;index.blocks.read_only_allow_delete&#34;:null}&#39;</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 浏览器</span>
</span></span><span style=display:flex><span>PUT _settings
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;index&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;blocks&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;read_only_allow_delete&#34;</span>: <span style=color:#e6db74>&#34;false&#34;</span>
</span></span><span style=display:flex><span>           <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>       <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cat &gt;delete-es-index.sh<span style=color:#e6db74>&lt;&lt;-EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#e6db74>date=`date -d &#34;7 days ago&#34; +%Y.%m.%d`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>curl -XDELETE -u &#39;elastic:dtyn!@$&#39; http://localhost:9200/*{$date}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div></blockquote></div></div><footer class=post-footer><div class=post-tags><a href=/tags/logs>Logs
</a><a href=/tags/elasticsearch>Elasticsearch
</a><a href=/tags/logstash>Logstash
</a><a href=/tags/kibana>Kibana</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="二哥 - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="二哥 - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
Install ELK</li><li class=post-copyright-author><strong>本文作者： </strong>二哥</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://erge.blog/system/linux/logs/install-elk/ title="Install ELK">https://erge.blog/system/linux/logs/install-elk/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i>
</span><span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/atom.xml><span class=icon><i class="fa fa-rss"></i>
</span><span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/system/linux/logs/install-graylog/ rel=next title="Install Graylog"><i class="fa fa-chevron-left"></i> Install Graylog</a></div><div class="post-nav-prev post-nav-item"><a href=/system/linux/system-architecture-planning-diagram/ rel=prev title="System Architecture Planning Diagram">System Architecture Planning Diagram
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div><div class=comment-switch><span class=first-comment>Giscus</span>
<span class=switch-btn></span>
<span class=second-comment>Waline</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=waline-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2024
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>二哥</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.125.4 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>粤ICP备 18047355-1 号</a>
<img src=/imgs/gongan.png alt=沪公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011402009770" target=_blank>沪公网安备 31011402009770 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel>
</a><a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云>
</a><a target=_blank href=https://webify.cloudbase.net title=Webify>Webify
</a><span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script><script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://erge.blog/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.b0c78e5a4df586ee46d02716ffa91a4a322e56763e04e91eb2ba052c9469ed02.js defer></script></body></html>