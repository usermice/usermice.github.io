<!doctype html><html lang=zh-CN data-theme=light><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.125.4"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="Install K8s KubeSphere"><meta itemprop=description content="Install-K8s-KubeSphere"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="http://localhost:1313/imgs/s2-1.jpg"><meta itemprop=keywords content="Kubernetes,KubeSphere"><meta property="og:type" content="article"><meta property="og:title" content="Install K8s KubeSphere"><meta property="og:description" content="Install-K8s-KubeSphere"><meta property="og:image" content="/imgs/s2-1.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="http://localhost:1313/system/linux/kubernetes/install-k8s-kubesphere/"><meta property="og:site_name" content="二哥"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="二哥"><meta property="article:published_time" content="2022-09-26 17:57:03 +0800 CST"><meta property="article:modified_time" content="2022-11-15 17:57:03 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"install-k8s-kubesphere","permalink":"http://localhost:1313/system/linux/kubernetes/install-k8s-kubesphere/","title":"Install K8s KubeSphere","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>Install K8s KubeSphere - 二哥</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>二哥</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Linux、Kubernetes、Docker、Python、CI/CD、Jenkins、Mysql、Nginx、Gitlab、Ansible、Zabbix</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-Home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-th hvr-icon"></i>分类</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>0</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-tools"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-tools hvr-icon"></i>工具</a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>站点示例</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-Commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#在现有kubernetes上安装kubesphere-web管理系统>在现有<code>Kubernetes</code>上安装<code>KubeSphere Web</code>管理系统</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=二哥 src=/imgs/img-lazy-loading.gif data-src=/imgs/s2-1.jpg><p class=site-author-name itemprop=name>二哥</p><div class=site-description itemprop=description>The man who has made up his mind to win will never say impossible – Napoleon Bonaparte</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>0</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>52</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>149</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=qq%e5%8f%b7 title="QQ → qq号" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-qq fa-fw hvr-icon"></i>
QQ
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/lisenhui title="知乎 → https://www.zhihu.com/people/lisenhui" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=qq@qq.com title="E-Mail → qq@qq.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://weibo.com/yourname title="Weibo → https://weibo.com/yourname" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-weibo fa-fw hvr-icon"></i>
Weibo
</a></span><span class=links-of-social-item><a href="https://www.youtube.com/watch?v=RgKAFK5djSk" title="Youtube → https://www.youtube.com/watch?v=RgKAFK5djSk" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
Youtube
</a></span><span class=links-of-social-item><a href=https://github.com/elkan1788 title="Github → https://github.com/elkan1788" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/hugo-next rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=http://localhost:1313/system/linux/kubernetes/install-k8s-kubesphere/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/s2-1.jpg"><meta itemprop=name content="二哥"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="二哥"><meta itemprop=description content="The man who has made up his mind to win will never say impossible – Napoleon Bonaparte"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Install K8s KubeSphere"><meta itemprop=description content="Install-K8s-KubeSphere"></span><header class=post-header><h1 class=post-title itemprop="name headline">Install K8s KubeSphere
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/System/Linux/Kubernetes/Install-K8s-KubeSphere.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2022-09-26 17:57:03 +0800 CST" itemprop="dateCreated datePublished" datetime="2022-09-26 17:57:03 +0800 CST">2022-09-26
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title=修改时间：2022-11-15T17:57:03+08:00 itemprop=dateModified datetime=2022-11-15T17:57:03+08:00>2022-11-15</time>
</span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/kubernetes itemprop=url rel=index><span itemprop=name>Kubernetes</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>3033</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>7分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/system/linux/kubernetes/install-k8s-kubesphere/><i class="fa fa-sync fa-spin"></i>
</span></span><span class=post-meta-item title><span class=post-meta-item-icon><i class="far fa-comments"></i>
</span><span class=post-meta-item-text title=评论>评论：
</span><span id=comments-count class=waline-comment-count data-path=/system/linux/kubernetes/install-k8s-kubesphere/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=在现有kubernetes上安装kubesphere-web管理系统>在现有<code>Kubernetes</code>上安装<code>KubeSphere Web</code>管理系统
<a class=header-anchor href=#%e5%9c%a8%e7%8e%b0%e6%9c%89kubernetes%e4%b8%8a%e5%ae%89%e8%a3%85kubesphere-web%e7%ae%a1%e7%90%86%e7%b3%bb%e7%bb%9f></a></h2><div class="note info"><blockquote><ul><li><ol><li><a href=https://kuboard.cn/ title="<code>Kuboard</code>一款免费的<code>Kubernetes</code>管理界面" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Kuboard</code>一款免费的<code>Kubernetes</code>管理界面
<i class="fa fa-external-link-alt"></i></a></li></ol></li><li><ol start=2><li><a href=https://kubeoperator.io/ title="<code>KubeOperator</code>可视化的<code>Web UI</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>KubeOperator</code>可视化的<code>Web UI</code>
<i class="fa fa-external-link-alt"></i></a></li></ol></li></ul></blockquote><ul><li><ol><li>如需在<code>Kubernetes</code>上安装<code>KubeSphere 3.3.0</code>，您的<code>Kubernetes</code>版本必须为：<code>v1.19.x，v1.20.x，v1.21.x，v1.22.x 或 v1.23.x</code>（实验性支持）</li></ol></li><li><ol start=2><li><font color=red>确保您的机器满足最低硬件要求：</font><code>CPU > 1核</code>、<code>内存 > 2GB</code></li></ol></li><li><ol start=3><li><font color=red>在安装之前，需要配置</font><code>Kubernetes</code><font color=red>集群中的</font><code>默认</code><font color=red>存储类型，以便实现动态供应</font></li></ol></li><li><ol start=4><li><font color=red>配置</font><code>NFS</code><font color=red>的动态供应的默认存储类</font></li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat &gt;/opt/k8s/yaml/data-storage.yaml<span style=color:#e6db74>&lt;&lt;-EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74># 创建一个存储类
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: storage.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: StorageClass
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   	name: nfs-storage
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   	annotations:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   		storageclass.kubernetes.io/is-default-class: &#34;true&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>provisioner: k8s-sigs.io/nfs-subdir-external-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>parameters:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   	archiveOnDelete: &#34;true&#34;  	# 删除pv的时候，pv的内容是否要备份
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   	name: nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   	labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   		app: nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   	# replace with namespace where provisioner is deployed
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   	namespace: default
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   	replicas: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   	strategy:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   		type: Recreate
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   	selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   		matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   			app: nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   	template:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   		metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   			labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   				app: nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   		spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   			serviceAccountName: nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   			containers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>				- name: nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>				  image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/nfs-subdir-external-provisioner:v4.0.2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>				  # resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>					  # limits:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>						  # cpu: 10m
</span></span></span><span style=display:flex><span><span style=color:#e6db74>					  # requests:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>						  # cpu: 10m
</span></span></span><span style=display:flex><span><span style=color:#e6db74>				  volumeMounts:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>					  - name: nfs-client-root
</span></span></span><span style=display:flex><span><span style=color:#e6db74>						mountPath: /persistentvolumes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>				  env:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>					  - name: PROVISIONER_NAME
</span></span></span><span style=display:flex><span><span style=color:#e6db74>						value: k8s-sigs.io/nfs-subdir-external-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>					  - name: NFS_SERVER
</span></span></span><span style=display:flex><span><span style=color:#e6db74>						value: 192.168.94.110  	# 指定自己nfs服务器地址
</span></span></span><span style=display:flex><span><span style=color:#e6db74>					  - name: NFS_PATH  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>						value: /opt/data/kubesphere  	# nfs服务器共享的目录
</span></span></span><span style=display:flex><span><span style=color:#e6db74>			volumes:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>				- name: nfs-client-root
</span></span></span><span style=display:flex><span><span style=color:#e6db74>				  nfs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>					  server: 192.168.94.110
</span></span></span><span style=display:flex><span><span style=color:#e6db74>					  path: /opt/data/kubesphere
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # replace with namespace where provisioner is deployed
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    namespace: default
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: nfs-client-provisioner-runner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>rules:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - apiGroups: [&#34;&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      resources: [&#34;nodes&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - apiGroups: [&#34;&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      resources: [&#34;persistentvolumes&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;, &#34;create&#34;, &#34;delete&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - apiGroups: [&#34;&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      resources: [&#34;persistentvolumeclaims&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;, &#34;update&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - apiGroups: [&#34;storage.k8s.io&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      resources: [&#34;storageclasses&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - apiGroups: [&#34;&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      resources: [&#34;events&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      verbs: [&#34;create&#34;, &#34;update&#34;, &#34;patch&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ClusterRoleBinding
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: run-nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>subjects:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      name: nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      # replace with namespace where provisioner is deployed
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      namespace: default
</span></span></span><span style=display:flex><span><span style=color:#e6db74>roleRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: nfs-client-provisioner-runner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Role
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: leader-locking-nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # replace with namespace where provisioner is deployed
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    namespace: default
</span></span></span><span style=display:flex><span><span style=color:#e6db74>rules:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - apiGroups: [&#34;&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      resources: [&#34;endpoints&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;, &#34;create&#34;, &#34;update&#34;, &#34;patch&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: RoleBinding
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: leader-locking-nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    # replace with namespace where provisioner is deployed
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    namespace: default
</span></span></span><span style=display:flex><span><span style=color:#e6db74>subjects:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      name: nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      # replace with namespace where provisioner is deployed
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      namespace: default
</span></span></span><span style=display:flex><span><span style=color:#e6db74>roleRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    kind: Role
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: leader-locking-nfs-client-provisioner
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div></blockquote><ul><li><ol start=5><li><font color=red>配置集群指标监控组件</font>
<a href=https://github.com/kubernetes-sigs/metrics-server title="<code>Kubernetes</code>指标服务器" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>Kubernetes</code>指标服务器
<i class="fa fa-external-link-alt"></i></a></li></ol></li></ul><blockquote><ul><li>5.1 <code>- --kubelet-insecure-tls</code>：<code>kubelet</code>的<code>10250</code>端口使用的是<code>https</code>协议，连接需要验证<code>tls</code>证书，<code>--kubelet-insecure-tls</code><font color=red>不验证客户端证书，仅用于测试目的</font></li><li>5.2
<a href=https://github.com/kubernetes/kube-state-metrics title="<code>kube-state-metrics</code>" rel="noopener external nofollow noreferrer" target=_blank class=exturl><code>kube-state-metrics</code>
<i class="fa fa-external-link-alt"></i></a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat &gt;/opt/k8s/yaml/metrics_server.yaml<span style=color:#e6db74>&lt;&lt;-EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        k8s-app: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    namespace: kube-system
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        k8s-app: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        rbac.authorization.k8s.io/aggregate-to-admin: &#34;true&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        rbac.authorization.k8s.io/aggregate-to-edit: &#34;true&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        rbac.authorization.k8s.io/aggregate-to-view: &#34;true&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: system:aggregated-metrics-reader
</span></span></span><span style=display:flex><span><span style=color:#e6db74>rules:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - apiGroups:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - metrics.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - pods
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - nodes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      verbs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - get
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - list
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - watch
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        k8s-app: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: system:metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>rules:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - apiGroups:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - pods
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - nodes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - nodes/stats
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - namespaces
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - configmaps
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      verbs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - get
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - list
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - watch
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: RoleBinding
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        k8s-app: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: metrics-server-auth-reader
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    namespace: kube-system
</span></span></span><span style=display:flex><span><span style=color:#e6db74>roleRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    kind: Role
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: extension-apiserver-authentication-reader
</span></span></span><span style=display:flex><span><span style=color:#e6db74>subjects:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      name: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      namespace: kube-system
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ClusterRoleBinding
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        k8s-app: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: metrics-server:system:auth-delegator
</span></span></span><span style=display:flex><span><span style=color:#e6db74>roleRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: system:auth-delegator
</span></span></span><span style=display:flex><span><span style=color:#e6db74>subjects:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      name: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      namespace: kube-system
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ClusterRoleBinding
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        k8s-app: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: system:metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>roleRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    apiGroup: rbac.authorization.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: system:metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>subjects:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      name: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      namespace: kube-system
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        k8s-app: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    namespace: kube-system
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - name: https
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          port: 443
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          protocol: TCP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          targetPort: https
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        k8s-app: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        k8s-app: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    namespace: kube-system
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            k8s-app: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    strategy:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        rollingUpdate:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            maxUnavailable: 0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    template:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                k8s-app: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            containers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                - args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    - --cert-dir=/tmp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    - --kubelet-insecure-tls
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    - --secure-port=4443
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    - --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    - --kubelet-use-node-status-port
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    image: k8s.gcr.io/metrics-server/metrics-server:v0.6.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    # image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/metrics-server:v0.4.3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    imagePullPolicy: IfNotPresent
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    livenessProbe:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        failureThreshold: 3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        httpGet:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            path: /livez
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            port: https
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            scheme: HTTPS
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        periodSeconds: 10
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    name: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        - containerPort: 4443
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                          name: https
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                          protocol: TCP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    readinessProbe:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        failureThreshold: 3
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        httpGet:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            path: /readyz
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            port: https
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            scheme: HTTPS
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        periodSeconds: 10
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    securityContext:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        readOnlyRootFilesystem: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        runAsNonRoot: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        runAsUser: 1000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    volumeMounts:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        - mountPath: /tmp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                          name: tmp-dir
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            nodeSelector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                kubernetes.io/os: linux
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            priorityClassName: system-cluster-critical
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            serviceAccountName: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            volumes:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                - emptyDir: {}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  name: tmp-dir
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: apiregistration.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: APIService
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        k8s-app: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: v1beta1.metrics.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    group: metrics.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    groupPriorityMinimum: 100
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    insecureSkipTLSVerify: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    service:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        name: metrics-server
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        namespace: kube-system
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    version: v1beta1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    versionPriority: 100
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><ul><li>5.1 <font color=red>执行命令查看</font><code>Node</code>节点结果</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl top nodes
</span></span><span style=display:flex><span>NAME            CPU<span style=color:#f92672>(</span>cores<span style=color:#f92672>)</span>   CPU%   MEMORY<span style=color:#f92672>(</span>bytes<span style=color:#f92672>)</span>   MEMORY%   
</span></span><span style=display:flex><span>k8s-master-01   148m         7%     3690Mi          46%       
</span></span><span style=display:flex><span>k8s-node-01     35m          1%     492Mi           8%        
</span></span><span style=display:flex><span>k8s-node-02     32m          1%     358Mi           6%
</span></span></code></pre></div><ul><li>5.2 <font color=red>执行命令查看</font><code>Pod</code>状态</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$  kubectl top pods -A
</span></span><span style=display:flex><span>NAMESPACE       NAME                                        CPU<span style=color:#f92672>(</span>cores<span style=color:#f92672>)</span>  MEMORY<span style=color:#f92672>(</span>bytes<span style=color:#f92672>)</span>   
</span></span><span style=display:flex><span>default         nfs-client-provisioner-6f9769d4c4-h6jw9     3m           12Mi 
</span></span><span style=display:flex><span>ingress-nginx   ingress-nginx-controller-5fd8bfcbdc-bzppj   2m           96Mi
</span></span><span style=display:flex><span>kube-flannel    kube-flannel-ds-6tl2b                       5m           33Mi
</span></span><span style=display:flex><span>kube-flannel    kube-flannel-ds-n4k68                       3m           33Mi 
</span></span><span style=display:flex><span>kube-flannel    kube-flannel-ds-zkqhz                       3m           33Mi 
</span></span><span style=display:flex><span>kube-system     coredns-64897985d-6r9ds                     2m           17Mi
</span></span><span style=display:flex><span>kube-system     coredns-64897985d-fwmz5                     2m           14Mi
</span></span><span style=display:flex><span>kube-system     etcd-k8s-master-01                          20m          112Mi
</span></span><span style=display:flex><span>kube-system     kube-apiserver-k8s-master-01                63m          237Mi
</span></span><span style=display:flex><span>kube-system     kube-controller-manager-k8s-master-01       20m          50Mi 
</span></span><span style=display:flex><span>kube-system     kube-proxy-blnt7                            1m           18Mi 
</span></span><span style=display:flex><span>kube-system     kube-proxy-k5gkm                            1m           17Mi
</span></span><span style=display:flex><span>kube-system     kube-proxy-xpvqr                            1m           17Mi
</span></span><span style=display:flex><span>kube-system     kube-scheduler-k8s-master-01                5m           21Mi
</span></span><span style=display:flex><span>kube-system     metrics-server-658c4cf555-bpfcf             5m           19Mi
</span></span></code></pre></div></blockquote><ul><li><ol start=6><li><font color=red>下载、安装</font><code>KubeSphere</code>的<code>yaml</code>文件</li></ol></li></ul><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ wget -P /opt/k8s/yaml/kubesphere/ https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/kubesphere-installer.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ wget -P /opt/k8s/yaml/kubesphere/ https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/cluster-configuration.yaml
</span></span></code></pre></div><ul><li>6.1 修改<code>cluster-configuration</code>文件<code>启用可插拔组件</code></li></ul><blockquote><ul><li>6.1.1
<a href=https://kubesphere.com.cn/docs/v3.3/pluggable-components/overview/ title="官网<mark>启用可插拔组件</mark>" rel="noopener external nofollow noreferrer" target=_blank class=exturl>官网<mark>启用可插拔组件</mark>
<i class="fa fa-external-link-alt"></i></a></li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterConfiguration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ks-installer</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>kubesphere-system</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v3.3.0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>persistence</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>storageClass</span>: <span style=color:#e6db74>&#34;&#34;</span>  	<span style=color:#75715e># If there is no default StorageClass in your cluster, you need to specify an existing StorageClass here.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>authentication</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>jwtSecret</span>: <span style=color:#e6db74>&#34;&#34;</span>  	<span style=color:#75715e># Keep the jwtSecret consistent with the Host Cluster. Retrieve the jwtSecret by executing &#34;kubectl -n kubesphere-system get cm kubesphere-config -o yaml | grep -v &#34;apiVersion&#34; | grep jwtSecret&#34; on the Host Cluster.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>local_registry</span>: <span style=color:#e6db74>&#34;&#34;</span>  	<span style=color:#75715e># Add your private registry address if it is needed.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># dev_tag: &#34;&#34;  	# Add your kubesphere image tag you want to install, by default it&#39;s same as ks-installer release version.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>etcd</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>monitoring</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># 启用或禁用 etcd 监控仪表板安装。 在启用之前，您必须为 etcd 创建一个 Secret， 启用修改为：true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>endpointIps</span>: <span style=color:#ae81ff>192.168.94.110</span>  	<span style=color:#75715e># etcd 集群 EndpointIps。 这里可以是一堆IP。</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2379</span>  	<span style=color:#75715e># etcd port.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tlsEnable</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>common</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>core</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>console</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>enableMultiLogin</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># Enable or disable simultaneous logins. It allows different users to log in with the same account at the same time.</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>port</span>: <span style=color:#ae81ff>30880</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># apiserver:  	# Enlarge the apiserver and controller manager&#39;s resource requests and limits for the large cluster</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#  resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># controllerManager:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#  resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>redis</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># 启用 Redis 功能，修改为：true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>enableHA</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumeSize</span>: <span style=color:#ae81ff>2Gi  	# Redis PVC size.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>openldap</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># 启用轻量级目录协议，修改为：true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumeSize</span>: <span style=color:#ae81ff>2Gi  	# openldap PVC size.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>minio</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumeSize</span>: <span style=color:#ae81ff>20Gi  	# Minio PVC size.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>monitoring</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># type: external  	# Whether to specify the external prometheus stack, and need to modify the endpoint at the next line.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>endpoint</span>: <span style=color:#ae81ff>http://prometheus-operated.kubesphere-monitoring-system.svc:9090</span> <span style=color:#75715e># Prometheus endpoint to get metrics data.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>GPUMonitoring</span>:  	<span style=color:#75715e># Enable or disable the GPU-related metrics. If you enable this switch but have no GPU resources, Kubesphere will set it to zero.</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gpu</span>:  	<span style=color:#75715e># Install GPUKinds. The default GPU kind is nvidia.com/gpu. Other GPU kinds can be added here according to your needs.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>kinds</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>resourceName</span>: <span style=color:#e6db74>&#34;nvidia.com/gpu&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>resourceType</span>: <span style=color:#e6db74>&#34;GPU&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>default</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>es</span>:   <span style=color:#75715e># Storage backend for logging, events and auditing.</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># master:</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#   volumeSize: 4Gi  # The volume size of Elasticsearch master nodes.</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#   replicas: 1      # The total number of master nodes. Even numbers are not allowed.</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># data:</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#   volumeSize: 20Gi  # The volume size of Elasticsearch data nodes.</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#   replicas: 1  	# The total number of data nodes.</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>logMaxAge</span>: <span style=color:#ae81ff>7</span>  	<span style=color:#75715e># Log retention time in built-in Elasticsearch. It is 7 days by default.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>elkPrefix</span>: <span style=color:#ae81ff>logstash  	# The string making up index names. The index name will be formatted as ks-&lt;elk_prefix&gt;-log.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>basicAuth</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>username</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>externalElasticsearchHost</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>externalElasticsearchPort</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>alerting:  	# (CPU: 0.1 Core, Memory</span>: <span style=color:#ae81ff>100</span> <span style=color:#ae81ff>MiB) It enables users to customize alerting policies to send messages to receivers in time with different time intervals and alerting levels to choose from.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># 启用或禁用 KubeSphere 警报系统，修改为：true</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># thanosruler:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   replicas: 1</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>auditing</span>:  	<span style=color:#75715e># Provide a security-relevant chronological set of records，recording the sequence of activities happening on the platform, initiated by different tenants.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># 启用或禁用 KubeSphere 审计日志系统，修改为：true</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># operator:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># webhook:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>devops:  	# (CPU: 0.47 Core, Memory</span>: <span style=color:#ae81ff>8.6</span> <span style=color:#ae81ff>G) Provide an out-of-the-box CI/CD system based on Jenkins, and automated workflow tools including Source-to-Image &amp; Binary-to-Image.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># 启用或禁用 KubeSphere DevOps 系统，修改为：true</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>jenkinsMemoryLim</span>: <span style=color:#ae81ff>2Gi  	# Jenkins memory limit.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>jenkinsMemoryReq</span>: <span style=color:#ae81ff>1500Mi  	# Jenkins memory request.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>jenkinsVolumeSize</span>: <span style=color:#ae81ff>8Gi  	# Jenkins volume size.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>jenkinsJavaOpts_Xms</span>: <span style=color:#ae81ff>1200m  	# The following three fields are JVM parameters.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>jenkinsJavaOpts_Xmx</span>: <span style=color:#ae81ff>1600m</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>jenkinsJavaOpts_MaxRAM</span>: <span style=color:#ae81ff>2g</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>events</span>:  	<span style=color:#75715e># Provide a graphical web console for Kubernetes Events exporting, filtering and alerting in multi-tenant Kubernetes clusters.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># 启用或禁用 KubeSphere 事件系统，修改为：true</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># operator:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># exporter:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ruler:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   enabled: true</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   replicas: 2</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>logging:  	# (CPU: 57 m, Memory</span>: <span style=color:#ae81ff>2.76</span> <span style=color:#ae81ff>G) Flexible logging functions are provided for log query, collection and management in a unified console. Additional log collectors can be added, such as Elasticsearch, Kafka and Fluentd.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># 启用或禁用 KubeSphere 日志系统，修改为：true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>logsidecar</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># resources: {}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>metrics_server:  	# (CPU: 56 m, Memory</span>: <span style=color:#ae81ff>44.35</span> <span style=color:#ae81ff>MiB) It enables HPA (Horizontal Pod Autoscaler).</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>  	<span style=color:#75715e># 启用或禁用监控指标服务器，从hub.docker官方拉取镜像，网络不好会报网络错误，如果已提前安装请忽略，修改为：true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>monitoring</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>storageClass</span>: <span style=color:#e6db74>&#34;&#34;</span>  	<span style=color:#75715e># If there is an independent StorageClass you need for Prometheus, you can specify it here. The default StorageClass is used by default.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>node_exporter</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>port</span>: <span style=color:#ae81ff>9100</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># kube_rbac_proxy:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># kube_state_metrics:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># prometheus:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   replicas: 1  # Prometheus replicas are responsible for monitoring different segments of data source and providing high availability.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   volumeSize: 20Gi  # Prometheus PVC size.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   operator:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># alertmanager:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   replicas: 1  	# AlertManager Replicas.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># notification_manager:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   operator:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   proxy:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#     resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gpu</span>:  	<span style=color:#75715e># GPU monitoring-related plug-in installation.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>nvidia_dcgm_exporter</span>:  	<span style=color:#75715e># Ensure that gpu resources on your hosts can be used normally, otherwise this plug-in will not work properly.</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>  	<span style=color:#75715e># Check whether the labels on the GPU hosts contain &#34;nvidia.com/gpu.present=true&#34; to ensure that the DCGM pod is scheduled to these nodes.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># resources: {}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>multicluster</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>clusterRole</span>: <span style=color:#ae81ff>none  # host | member | none </span> <span style=color:#75715e># You can install a solo cluster, or specify it as the Host or Member Cluster.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>network</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>networkpolicy</span>: <span style=color:#75715e># Network policies allow network isolation within the same cluster, which means firewalls can be set up between certain instances (Pods).</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Make sure that the CNI network plugin used by the cluster supports NetworkPolicy. There are a number of CNI network plugins that support NetworkPolicy, including Calico, Cilium, Kube-router, Romana and Weave Net.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># 启用或禁用网络策略，修改为：true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ippool</span>: <span style=color:#75715e># Use Pod IP Pools to manage the Pod network address space. Pods to be created can be assigned IP addresses from a Pod IP Pool.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>none</span> <span style=color:#75715e># 如果 Calico 用作您的 CNI 插件，请为此字段指定“calico”。 “none”表示 Pod IP 池已禁用</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>topology</span>: <span style=color:#75715e># Use Service Topology to view Service-to-Service communication based on Weave Scope.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>none</span> <span style=color:#75715e># Specify &#34;weave-scope&#34; for this field to enable Service Topology. &#34;none&#34; means that Service Topology is disabled.</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>openpitrix</span>: <span style=color:#75715e># An App Store that is accessible to all platform tenants. You can use it to manage apps across their entire lifecycle.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>store</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># 启用或禁用 KubeSphere 应用商店，修改为：true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>servicemesh</span>:  	<span style=color:#75715e># (0.3 Core, 300 MiB) Provide fine-grained traffic management, observability and tracing, and visualized traffic topology.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># 基础组件（试点）。 启用或禁用 KubeSphere 服务网格（基于 Istio）微服务治理功能，修改为：true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>istio</span>:  <span style=color:#75715e># Customizing the istio installation configuration, refer to https://istio.io/latest/docs/setup/additional-setup/customize-installation/</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>components</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ingressGateways</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>istio-ingressgateway</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cni</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>edgeruntime</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>  	<span style=color:#75715e># 将边缘节点添加到集群并在边缘节点上部署工作负载，启动边缘计算服务，修改为：true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kubeedge</span>:  	<span style=color:#75715e># kubeedge configurations</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>cloudCore</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>cloudHub</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>advertiseAddress</span>: <span style=color:#75715e># At least a public IP address or an IP address which can be accessed by edge nodes must be provided.</span>
</span></span><span style=display:flex><span>            - <span style=color:#e6db74>&#34;&#34;</span>            <span style=color:#75715e># Note that once KubeEdge is enabled, CloudCore will malfunction if the address is not provided.</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>cloudhubNodePort</span>: <span style=color:#e6db74>&#34;30000&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>cloudhubQuicNodePort</span>: <span style=color:#e6db74>&#34;30001&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>cloudhubHttpsNodePort</span>: <span style=color:#e6db74>&#34;30002&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>cloudstreamNodePort</span>: <span style=color:#e6db74>&#34;30003&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>tunnelNodePort</span>: <span style=color:#e6db74>&#34;30004&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># resources: {}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># hostNetWork: false</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>iptables-manager</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span> 
</span></span><span style=display:flex><span>        <span style=color:#f92672>mode</span>: <span style=color:#e6db74>&#34;external&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># resources: {}</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># edgeService:</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>gatekeeper</span>:        <span style=color:#75715e># Provide admission policy and rule management, A validating (mutating TBA) webhook that enforces CRD-based policies executed by Open Policy Agent.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>   <span style=color:#75715e># Enable or disable Gatekeeper.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># controller_manager:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># audit:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#   resources: {}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>terminal</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># image: &#39;alpine:3.15&#39; # There must be an nsenter program in the image</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>600</span>  	<span style=color:#75715e># Container timeout, if set to 0, no timeout will be used. The unit is seconds</span>
</span></span></code></pre></div><ul><li>6.2 <font color=red>修改好配置后安装</font><code>KubeSphere</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl apply -f kubesphere-installer.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl apply -f cluster-configuration.yaml
</span></span></code></pre></div><ul><li>6.3 <font color=red>跟踪安装进度</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl logs -n kubesphere-system <span style=color:#66d9ef>$(</span>kubectl get pod -n kubesphere-system -l <span style=color:#e6db74>&#39;app in (ks-install, ks-installer)&#39;</span> -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.items[0].metadata.name}&#39;</span><span style=color:#66d9ef>)</span> -f
</span></span></code></pre></div><ul><li>6.4 查看所有<code>Pod</code>是否在<code>KubeSphere</code><font color=red>的相关命名空间中正常运行</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl get svc/ks-console -n kubesphere-system
</span></span></code></pre></div><ul><li>6.5 解决<code>prometheus-k8s</code>的<code>pods</code><font color=red>因为证书不能启动</font></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ kubectl -n kubesphere-monitoring-system create secret generic kube-etcd-client-certs  --from-file<span style=color:#f92672>=</span>etcd-client-ca.crt<span style=color:#f92672>=</span>/etc/kubernetes/pki/etcd/ca.crt  --from-file<span style=color:#f92672>=</span>etcd-client.crt<span style=color:#f92672>=</span>/etc/kubernetes/pki/apiserver-etcd-client.crt  --from-file<span style=color:#f92672>=</span>etcd-client.key<span style=color:#f92672>=</span>/etc/kubernetes/pki/apiserver-etcd-client.key
</span></span></code></pre></div><ul><li>6.6 <font color=red>使用浏览器访问</font><code>KubeSphere</code>放行：<code>30880</code>端口</li></ul><blockquote><ul><li>6.6.1 <font color=red><strong>默认用户名：</strong></font><code>admin</code></li><li>6.6.2 <font color=red><strong>默认密码：</strong></font><code>P@88w0rd</code></li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>$ http://IP:30880
</span></span></code></pre></div></blockquote></div></div><footer class=post-footer><div class=post-tags><a href=/tags/kubernetes>Kubernetes
</a><a href=/tags/kubesphere>KubeSphere</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="二哥 - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="二哥 - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
Install K8s KubeSphere</li><li class=post-copyright-author><strong>本文作者： </strong>二哥</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=http://localhost:1313/system/linux/kubernetes/install-k8s-kubesphere/ title="Install K8s KubeSphere">http://localhost:1313/system/linux/kubernetes/install-k8s-kubesphere/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i>
</span><span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/atom.xml><span class=icon><i class="fa fa-rss"></i>
</span><span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/system/linux/ldap/install-kerberos/ rel=next title="Install Kerberos"><i class="fa fa-chevron-left"></i> Install Kerberos</a></div><div class="post-nav-prev post-nav-item"><a href=/system/linux/databases/configure-mycat/ rel=prev title="Configure Mycat">Configure Mycat
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div><div class=comment-switch><span class=first-comment>Giscus</span>
<span class=switch-btn></span>
<span class=second-comment>Waline</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=waline-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2024
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>二哥</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.125.4 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>粤ICP备 18047355-1 号</a>
<img src=/imgs/gongan.png alt=沪公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011402009770" target=_blank>沪公网安备 31011402009770 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel>
</a><a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云>
</a><a target=_blank href=https://webify.cloudbase.net title=Webify>Webify
</a><span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script><script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"http://localhost:1313/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.js defer></script></body></html>