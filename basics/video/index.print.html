<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.125.4">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="">
    <meta name="author" content="二哥">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://erge.blog/images/hero.png">
    <meta name="twitter:title" content="Video :: Hugo Relearn Theme">
    <meta property="og:url" content="https://erge.blog/basics/video/">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <meta property="og:title" content="Video :: Hugo Relearn Theme">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://erge.blog/images/hero.png">
    <meta itemprop="name" content="Video :: Hugo Relearn Theme">
    <meta itemprop="datePublished" content="2024-06-13T01:37:19+08:00">
    <meta itemprop="dateModified" content="2024-06-13T01:37:19+08:00">
    <meta itemprop="image" content="https://erge.blog/images/hero.png">
    <title>Video :: Hugo Relearn Theme</title>
    <link href="../../images/favicon.ico?1723803344" rel="icon" type="image/x-icon" sizes="any">
    <link href="../../css/fontawesome-all.min.css?1723803345" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fontawesome-all.min.css?1723803345" rel="stylesheet"></noscript>
    <link href="../../css/nucleus.css?1723803345" rel="stylesheet">
    <link href="../../css/auto-complete.css?1723803345" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/auto-complete.css?1723803345" rel="stylesheet"></noscript>
    <link href="../../css/perfect-scrollbar.min.css?1723803345" rel="stylesheet">
    <link href="../../css/fonts.css?1723803345" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fonts.css?1723803345" rel="stylesheet"></noscript>
    <link href="../../css/theme.css?1723803345" rel="stylesheet">
    <link href="../../css/theme-relearn-auto.css?1723803345" rel="stylesheet" id="R-variant-style">
    <link href="../../css/chroma-relearn-auto.css?1723803345" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../css/variant.css?1723803345" rel="stylesheet">
    <link href="../../css/print.css?1723803345" rel="stylesheet" media="print">
    <link href="../../css/format-print.css?1723803345" rel="stylesheet">
    <script src="../../js/variant.js?1723803345"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/erge.blog';
      window.index_js_url="../../index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red', 'my-branding' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>Partial intended to be overwritten to add custom headers, like CSS or any other info
<style>
    
</style>


  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../basics/video/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>



          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../basics/"><span itemprop="name">Basics</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Video</span><meta itemprop="position" content="2"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">


            <div class="topbar-button topbar-button-prev" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../basics/hugo_theme_next/custom_files/" title="Custom_Files (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="show" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../basics/video/video_download/" title="Video_Download (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>



          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="video">Video</h1>


            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Video</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="video_download">Video_Download</h1>

<h2 id="视频下载">视频下载</h2>
<blockquote>
<ul>
<li><a href="https://www.videolan.org/" rel="external" target="_self"><code>VLC media player</code>视频播放器</a></li>
<li><a href="https://streamja.com/" rel="external" target="_self"><code>Streamja</code>视频保存</a></li>
</ul>
</blockquote>
<hr>
<ul>
<li><strong><code>Youtube</code>视频下载</strong></li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted --><a href="https://github.com/yt-dlp/yt-dlp" rel="external" target="_self"><code>yt-dlp</code></a>工具使用、使用查看&quot;完整播放列表&quot;、获取完整列表链接<!-- raw HTML omitted --></li>
<li><a href="https://you-get.org/" rel="external" target="_self"><code>you-get</code></a></li>
<li><a href="https://bilishare.com/tech/youtube-dl/2021/03/14/youtube-dl.html" rel="external" target="_self"><code>Youtube-dl</code>的详细使用方法</a></li>
</ul>
<blockquote>
<ul>
<li><code>-f</code><!-- raw HTML omitted -->：选择格式为最优的<!-- raw HTML omitted --><code>mp4</code><!-- raw HTML omitted -->格式<!-- raw HTML omitted --></li>
<li><code>-k</code><!-- raw HTML omitted -->：保存文件<!-- raw HTML omitted --></li>
<li><code>-c</code><!-- raw HTML omitted -->：断点续传<!-- raw HTML omitted --></li>
<li><code>-i</code><!-- raw HTML omitted -->：忽略错误<!-- raw HTML omitted --></li>
<li><code>-r, --limit-rate=600K</code><!-- raw HTML omitted -->：最大下载速率/秒（以字节为单位）<!-- raw HTML omitted --></li>
<li><code>--yes-playlist、--playlist-items 8,15,20,23</code><!-- raw HTML omitted -->：指定仅下载播放列表中的<code>8,15,20,23</code>这几集视频<!-- raw HTML omitted --></li>
<li><code>-output 'TJ_%(id)s.%(ext)s'</code><!-- raw HTML omitted -->：泰迦拼音首字母缩写 + 视频的ID号 + 格式(.mp4)<!-- raw HTML omitted --></li>
<li><code>-x --audio-format mp3</code><!-- raw HTML omitted -->：下载歌曲，到<code>mp3</code>格式<!-- raw HTML omitted --></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ./yt-dlp --yes-playlist -f best<span style="color:#f92672">[</span>ext<span style="color:#f92672">=</span>mp4<span style="color:#f92672">]</span> --limit-rate<span style="color:#f92672">=</span>1024K -k -c -i https://www.youtube.com/playlist?list<span style="color:#f92672">=</span>PL6YsTaFq7KcMH0cljmGf7F0jK0fdUov10  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ youtube-dl -f best<span style="color:#f92672">[</span>ext<span style="color:#f92672">=</span>mp4<span style="color:#f92672">]</span> -k -c -i --playlist-items 8,15,20,23 https://www.youtube.com/playlist?list<span style="color:#f92672">=</span>PL6YzOVgBYcEZSB30tzuXeSAhNX3nwu4Wd  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ youtube-dl -f best<span style="color:#f92672">[</span>ext<span style="color:#f92672">=</span>mp4<span style="color:#f92672">]</span> -k -c -i --output <span style="color:#e6db74">&#39;TJ_%(id)s.%(ext)s&#39;</span> https://www.youtube.com/playlist?list<span style="color:#f92672">=</span>PL6YzOVgBYcEZSB30tzuXeSAhNX3nwu4Wd  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ youtube-dl -x --audio-format mp3 https://www.youtube.com/watch?v<span style="color:#f92672">=</span>Sm_EGqzs2aA  </span></span></code></pre></div></blockquote>
</blockquote>
<hr>
<ul>
<li>
<ol start="2">
<li><strong><code>bilibili</code>视频下载</strong></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><!-- raw HTML omitted -->哔哩哔哩<code>UWP</code>：下载器<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted --><a href="https://github.com/leiurayer/downkyi" rel="external" target="_self">哔哩下载姬</a><!-- raw HTML omitted --></li>
<li><a href="https://mp.weixin.qq.com/s/i0Cw3sxTFiRnQztDmzN0JQ" rel="external" target="_self"><code>B</code>站视频下载神器</a></li>
<li><a href="http://client.jijidown.com/" rel="external" target="_self">唧唧<code>Down</code></a></li>
<li><a href="https://www.flvcd.com/index.htm" rel="external" target="_self">硕鼠</a></li>
<li><a href="https://csser.top/" rel="external" target="_self"><code>bilibili</code>哔哩哔哩下载助手</a></li>
</ul>
</blockquote>
<hr>
<ul>
<li>
<ol start="3">
<li><strong><code>Python</code>爬取视频</strong></li>
</ol>
</li>
</ul>
<blockquote>
<ul>
<li><strong><code>Ffmpeg</code>安装合并软件</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ yum -y install epel-release
</span></span><span style="display:flex;"><span>$ yum -y install yasm gcc
</span></span><span style="display:flex;"><span>$ make <span style="color:#f92672">&amp;&amp;</span> make install
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;export PATH=</span>$PATH<span style="color:#e6db74">:/usr/local/ffmpeg/bin&#34;</span> &gt;&gt;/etc/profile
</span></span><span style="display:flex;"><span>$ source /etc/profile</span></span></code></pre></div><ul>
<li><strong><code>Python</code>爬虫脚本</strong></li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;/opt/python/Python_Reptile_Youtube.py<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/usr/bin/python3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39; pip3 install requests --upgrade &#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import requests   # 数据请求模块
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import re     # 正则表达式模块，把数据解析为结构化数据，分别有：parsel、lxml、re
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import json  # 数据类型处理模块
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">from tqdm import tqdm   #进度条配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import os    # 处理文件和目录
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import pprint # 格式化输出模块
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import subprocess # 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 发送请求获取数据
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">headers = {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	# 身份信息
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#39;cookie&#39;: &#39;VISITOR_INFO1_LIVE=9qZVrzB27uI; PREF=f4=4000000&amp;tz=Asia.Shanghai; _ga=GA1.2.621834420.1648121145; _gcl_au=1.1.1853038046.1648121145; NID=511=Zc1APdmEbCD-iqVNVgI_vD_0S3LVI3XSfl-wUZEvvMU2MLePFKsQCaKUlUtchHSg-kWEVMGOhWUbxpQMwHeIuLjhxaslwniMh1OsjVfmOeTfhpwcRYpMgqpZtNQ7qQApY21xEObCvIez6DCMbjRhRQ5P7siOD3X87QX0CFyUxmY; OTZ=6430350_24_24__24_; GPS=1; YSC=0E115KqM_-I; GOOGLE_ABUSE_EXEMPTION=ID=d02004902c3d0f4d:TM=1648620854:C=r:IP=47.57.243.77-:S=YmZXPW7dxbu83bDuauEpXpE; CONSISTENCY=AGDxDeNysJ2boEmzRP4v6cwgg4NsdN4-FYQKHCGhA0AeW1QjFIU1Ejq1j8l6lwAc6c-pYTJiSaQItZ1M6QeI1pQ3wictnWXTOZ6_y8EKlt0Y_JdakwW6srR39-NLuPgSgXrXwtS0XTUGXpdnt4k3JjQ&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # 防盗链
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#39;referer&#39;: &#39;https://www.youtube.com/&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # 浏览器基本信息
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#39;user-agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.84 Safari/537.36&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">url = &#39;https://www.youtube.com/watch?v=HuCsEvYPURs&amp;list=PL2Kp-qxDDM0GKCurzpJ448Hr_dxVdPjLp&amp;index=2&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 发送请求，网站自己补全一下
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">response = requests.get(url=url, headers=headers)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">print(response.text)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 匹配json数据，.*：匹配任意字符0~N次，?：非贪婪匹配、数据过长有可能截断，
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">json_str = re.findall(&#39;var ytInitialPlayerResponse = (.*?);var&#39;, response.text)[0]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># json字符串转变为字典
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">json_data = json.loads(json_str)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 提取视频链接
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">video_url = json_data[&#39;streamingData&#39;][&#39;adaptiveFormats&#39;][0][&#39;url&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 提取音频链接
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">audio_url = json_data[&#39;streamingData&#39;][&#39;adaptiveFormats&#39;][-2][&#39;url&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 提取标题
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">title = json_data[&#39;videoDetails&#39;][&#39;title&#39;]  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 替换掉标题当中的空格
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">title = title.replace(&#39; &#39;, &#39;&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 替换掉标题当中的不合法字符
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">title = re.sub(r&#39;[\/:|?*&#34;&lt;&gt;]&#39;, &#39;&#39;, title)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># print(video_url)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># print(audio_url)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># print(title)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 向视频链接发送请求
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">video = requests.get(video_url, stream=True)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 获取视频大小
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file_size = int(video.headers.get(&#39;Content-Length&#39;))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 初始化进度条大小
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">video_pbar = tqdm(total=file_size)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 开始保存视频
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">with open(f&#39;{title}.mp4&#39;, mode=&#39;wb&#39;) as f:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # 把视频分成 1024 * 1024 * 2 为等分的大小 进行遍历
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for video_chunk in video.iter_content(1024*1024*2):
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 写入数据
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        f.write(video_chunk)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 更新进度条
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        video_pbar.set_description(f&#39;正在下载：{title}视频中......&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 更新进度条长度
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        video_pbar.update(1024*1024*2)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # 下载完毕
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    video_pbar.set_description(&#39;下载完成！&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # 关闭进度条
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    video_pbar.close()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># 音频同理
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">audio = requests.get(audio_url, stream=True)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file_size = int(audio.headers.get(&#39;Content-Length&#39;))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">audio_pbar = tqdm(total=file_size)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">with open(f&#39;{title}.mp3&#39;, mode=&#39;wb&#39;) as f:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    for audio_chunk in audio.iter_content(1024*1024*2):
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        f.write(audio_chunk)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        audio_pbar.set_description(f&#39;正在下载：{title}音频中......&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        audio_pbar.update(1024*1024*2)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    audio_pbar.set_description(&#39;下载完成！&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    audio_pbar.close()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">def merge(title):
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    print(&#39;视频合成开始：&#39;, title)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # ffmpeg = r&#39;D:\Download\ffmpeg\bin\ffmpeg.exe -i &#39; + title + &#39;.mp4 -i &#39; + title + &#39;.mp3 -acodec copy -vcodec copy &#39; + title + &#39;-out.mp4&#39; # windows系统
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ffmpeg = r&#39;ffmpeg -i &#39; + title + &#39;.mp4 -i &#39; + title + &#39;.mp3 -acodec copy -vcodec copy &#39; + title + &#39;-out.mp4&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    os.popen(ffmpeg)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    print(&#39;视频合成结束：&#39;, title)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">merge(title)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat &gt;Python_Reptile_Youtube-01.py<span style="color:#e6db74">&lt;&lt;-EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#!/usr/bin/python3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pip3 install requests --upgrade 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">pip3 install tqdm --upgrade
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import requests   # 数据请求模块
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import re     # 正则表达式模块
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import json  # 数据类型处理模块
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">from tqdm import tqdm   #进度条配置
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import os    # 处理文件和目录
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">import pprint # 格式化输出模块
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">for page in range(1, 151):
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    print(f&#39;\n=====================   正在爬取第{page}章视频数据   ======================&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # 下载其他视频列表，请更换视频链接
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    url = &#39;https://www.youtube.com/watch?v=3ytZtZXQNHE&amp;list=PL2Kp-qxDDM0HrLhEmmbdbuC5PfItF38nN&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # 定义获取服务器返回数据函数
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    def get_response(html_url):
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 定义请求客户端
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        headers = {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#39;referer&#39;: &#39;https://www.youtube.com/&#39;, # 防盗链配置，防盗链作用：告诉服务器，我们发送请求的URL地址，是从哪里过来的
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#39;user-agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.84 Safari/537.36&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        response = requests.get(url=html_url, headers=headers) # 发送数据请求
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # return 返回出去数据
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        return response
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # 定义获取视频信息函数 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    def get_video_info(html_url):
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        response = get_response(html_url)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 正则表达式匹配出来的数据是列表 [0] 索引取0 取出列表内的内容：字符串
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        html_data = re.findall(&#39;var ytInitialPlayerResponse = (.*?);var&#39;, response.text)[0]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 像json字典数据，把字符串转成json字典数据
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        json_data = json.loads(html_data)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # pprint.pprint(json_data) # 格式化打印输出，用于查找网址关键字
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 提取标题
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        title = json_data[&#39;videoDetails&#39;][&#39;title&#39;]  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        title = title.replace(&#39; &#39;, &#39;&#39;) # 替换掉标题当中的空格
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        title = re.sub(r&#39;[\/:|?*&#34;&lt;&gt;]&#39;, &#39;&#39;, title) # 替换掉标题当中的不合法字符
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 数据解析、键值对取值、提取视频链接
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        video_url = json_data[&#39;streamingData&#39;][&#39;adaptiveFormats&#39;][0][&#39;url&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 数据解析、键值对取值、提取音频链接
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        audio_url = json_data[&#39;streamingData&#39;][&#39;adaptiveFormats&#39;][-2][&#39;url&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 取出的数据保存到列表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        video_info = [title, audio_url, video_url]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # return 返回出去数据
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        return video_info
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    # 定义保存视频音频数据函数
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    def save(title, audio_url, video_url):
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 音频/视频/图片/特定格式文件、都以二进制数据进行保存
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 向音频链接发送请求、获取音频大小、初始化进度条大小、开始保存音频
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        audio = requests.get(audio_url, stream=True)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        file_size = int(audio.headers.get(&#39;Content-Length&#39;))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        audio_pbar = tqdm(total=file_size)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        with open(f&#39;{title}.mp3&#39;, mode=&#39;wb&#39;) as f:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            for audio_chunk in audio.iter_content(1024*1024*2):
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                f.write(audio_chunk)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                audio_pbar.set_description(f&#39;正在下载：{title}音频中......&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                audio_pbar.update(1024*1024*2)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            audio_pbar.set_description(&#39;下载完成！&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            audio_pbar.close()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        # 向音视频接发送请求、获取视频大小、初始化进度条大小、开始保存视频
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        video = requests.get(video_url, stream=True)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        file_size = int(video.headers.get(&#39;Content-Length&#39;))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        video_pbar = tqdm(total=file_size)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        with open(f&#39;{title}.mp4&#39;, mode=&#39;wb&#39;) as f:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # 把视频分成 1024 * 1024 * 2 为等分的大小 进行遍历
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            for video_chunk in video.iter_content(1024*1024*2):
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                # 写入数据
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                f.write(video_chunk)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                # 更新进度条
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                video_pbar.set_description(f&#39;正在下载：{title}视频中......&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                # 更新进度条长度
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                video_pbar.update(1024*1024*2)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # 下载完毕
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            video_pbar.set_description(&#39;下载完成！&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # 关闭进度条
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            video_pbar.close()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    video_info = get_video_info(url)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    save(video_info[0], video_info[1], video_info[2])
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    def merge(title):
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        print(&#39;视频合成开始：&#39;, title)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        FFMPEG = f&#39;ffmpeg -i &#39; + title + &#39;.mp4 -i &#39; + title + &#39;.mp3 -acodec copy -vcodec copy &#39; + title + &#39;-out.mp4&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        subprocess.Popen(FFMPEG, shell=True)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        print(&#39;视频合成结束：&#39;, title)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    merge(title)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span></span></span></code></pre></div></blockquote>

            <footer class="footline">
            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="../../js/clipboard.min.js?1723803345" defer></script>
    <script src="../../js/perfect-scrollbar.min.js?1723803345" defer></script>
    <script src="../../js/theme.js?1723803345" defer></script>
  </body>
</html>
